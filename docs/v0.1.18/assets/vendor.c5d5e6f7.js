function $N(a,l){return l.forEach(function(h){Object.keys(h).forEach(function(s){if(s!=="default"&&!(s in a)){var c=Object.getOwnPropertyDescriptor(h,s);Object.defineProperty(a,s,c.get?c:{enumerable:!0,get:function(){return h[s]}})}})}),Object.freeze(a)}var Ol,Dt,cS,Ml,lS,uS,hS,rd={},dS=[],JN=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;function _o(a,l){for(var h in l)a[h]=l[h];return a}function fS(a){var l=a.parentNode;l&&l.removeChild(a)}function $e(a,l,h){var s,c,E,m={};for(E in l)E=="key"?s=l[E]:E=="ref"?c=l[E]:m[E]=l[E];if(arguments.length>2&&(m.children=arguments.length>3?Ol.call(arguments,2):h),typeof a=="function"&&a.defaultProps!=null)for(E in a.defaultProps)m[E]===void 0&&(m[E]=a.defaultProps[E]);return Il(a,m,s,c,null)}function Il(a,l,h,s,c){var E={type:a,props:l,key:h,ref:s,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:c??++cS};return Dt.vnode!=null&&Dt.vnode(E),E}function pS(){return{current:null}}function pr(a){return a.children}function mi(a,l){this.props=a,this.context=l}function Ys(a,l){if(l==null)return a.__?Ys(a.__,a.__.__k.indexOf(a)+1):null;for(var h;l<a.__k.length;l++)if((h=a.__k[l])!=null&&h.__e!=null)return h.__e;return typeof a.type=="function"?Ys(a):null}function mS(a){var l,h;if((a=a.__)!=null&&a.__c!=null){for(a.__e=a.__c.base=null,l=0;l<a.__k.length;l++)if((h=a.__k[l])!=null&&h.__e!=null){a.__e=a.__c.base=h.__e;break}return mS(a)}}function S_(a){(!a.__d&&(a.__d=!0)&&Ml.push(a)&&!id.__r++||uS!==Dt.debounceRendering)&&((uS=Dt.debounceRendering)||lS)(id)}function id(){for(var a;id.__r=Ml.length;)a=Ml.sort(function(l,h){return l.__v.__b-h.__v.__b}),Ml=[],a.some(function(l){var h,s,c,E,m,S;l.__d&&(m=(E=(h=l).__v).__e,(S=h.__P)&&(s=[],(c=_o({},E)).__v=E.__v+1,x_(S,E,c,h.__n,S.ownerSVGElement!==void 0,E.__h!=null?[m]:null,s,m??Ys(E),E.__h),ES(s,E),E.__e!=m&&mS(E)))})}function _S(a,l,h,s,c,E,m,S,d,M){var C,I,b,p,x,P,A,T=s&&s.__k||dS,_=T.length;for(h.__k=[],C=0;C<l.length;C++)if((p=h.__k[C]=(p=l[C])==null||typeof p=="boolean"?null:typeof p=="string"||typeof p=="number"||typeof p=="bigint"?Il(null,p,null,null,p):Array.isArray(p)?Il(pr,{children:p},null,null,null):p.__b>0?Il(p.type,p.props,p.key,null,p.__v):p)!=null){if(p.__=h,p.__b=h.__b+1,(b=T[C])===null||b&&p.key==b.key&&p.type===b.type)T[C]=void 0;else for(I=0;I<_;I++){if((b=T[I])&&p.key==b.key&&p.type===b.type){T[I]=void 0;break}b=null}x_(a,p,b=b||rd,c,E,m,S,d,M),x=p.__e,(I=p.ref)&&b.ref!=I&&(A||(A=[]),b.ref&&A.push(b.ref,null,p),A.push(I,p.__c||x,p)),x!=null?(P==null&&(P=x),typeof p.type=="function"&&p.__k!=null&&p.__k===b.__k?p.__d=d=gS(p,d,a):d=vS(a,p,b,T,x,d),M||h.type!=="option"?typeof h.type=="function"&&(h.__d=d):a.value=""):d&&b.__e==d&&d.parentNode!=a&&(d=Ys(b))}for(h.__e=P,C=_;C--;)T[C]!=null&&(typeof h.type=="function"&&T[C].__e!=null&&T[C].__e==h.__d&&(h.__d=Ys(s,C+1)),xS(T[C],T[C]));if(A)for(C=0;C<A.length;C++)SS(A[C],A[++C],A[++C])}function gS(a,l,h){var s,c;for(s=0;s<a.__k.length;s++)(c=a.__k[s])&&(c.__=a,l=typeof c.type=="function"?gS(c,l,h):vS(h,c,c,a.__k,c.__e,l));return l}function go(a,l){return l=l||[],a==null||typeof a=="boolean"||(Array.isArray(a)?a.some(function(h){go(h,l)}):l.push(a)),l}function vS(a,l,h,s,c,E){var m,S,d;if(l.__d!==void 0)m=l.__d,l.__d=void 0;else if(h==null||c!=E||c.parentNode==null)e:if(E==null||E.parentNode!==a)a.appendChild(c),m=null;else{for(S=E,d=0;(S=S.nextSibling)&&d<s.length;d+=2)if(S==c)break e;a.insertBefore(c,E),m=E}return m!==void 0?m:c.nextSibling}function eF(a,l,h,s,c){var E;for(E in h)E==="children"||E==="key"||E in l||od(a,E,null,h[E],s);for(E in l)c&&typeof l[E]!="function"||E==="children"||E==="key"||E==="value"||E==="checked"||h[E]===l[E]||od(a,E,l[E],h[E],s)}function bS(a,l,h){l[0]==="-"?a.setProperty(l,h):a[l]=h==null?"":typeof h!="number"||JN.test(l)?h:h+"px"}function od(a,l,h,s,c){var E;e:if(l==="style")if(typeof h=="string")a.style.cssText=h;else{if(typeof s=="string"&&(a.style.cssText=s=""),s)for(l in s)h&&l in h||bS(a.style,l,"");if(h)for(l in h)s&&h[l]===s[l]||bS(a.style,l,h[l])}else if(l[0]==="o"&&l[1]==="n")E=l!==(l=l.replace(/Capture$/,"")),l=l.toLowerCase()in a?l.toLowerCase().slice(2):l.slice(2),a.l||(a.l={}),a.l[l+E]=h,h?s||a.addEventListener(l,E?TS:yS,E):a.removeEventListener(l,E?TS:yS,E);else if(l!=="dangerouslySetInnerHTML"){if(c)l=l.replace(/xlink[H:h]/,"h").replace(/sName$/,"s");else if(l!=="href"&&l!=="list"&&l!=="form"&&l!=="tabIndex"&&l!=="download"&&l in a)try{a[l]=h??"";break e}catch(m){}typeof h=="function"||(h!=null&&(h!==!1||l[0]==="a"&&l[1]==="r")?a.setAttribute(l,h):a.removeAttribute(l))}}function yS(a){this.l[a.type+!1](Dt.event?Dt.event(a):a)}function TS(a){this.l[a.type+!0](Dt.event?Dt.event(a):a)}function x_(a,l,h,s,c,E,m,S,d){var M,C,I,b,p,x,P,A,T,_,g,O=l.type;if(l.constructor!==void 0)return null;h.__h!=null&&(d=h.__h,S=l.__e=h.__e,l.__h=null,E=[S]),(M=Dt.__b)&&M(l);try{e:if(typeof O=="function"){if(A=l.props,T=(M=O.contextType)&&s[M.__c],_=M?T?T.props.value:M.__:s,h.__c?P=(C=l.__c=h.__c).__=C.__E:("prototype"in O&&O.prototype.render?l.__c=C=new O(A,_):(l.__c=C=new mi(A,_),C.constructor=O,C.render=nF),T&&T.sub(C),C.props=A,C.state||(C.state={}),C.context=_,C.__n=s,I=C.__d=!0,C.__h=[]),C.__s==null&&(C.__s=C.state),O.getDerivedStateFromProps!=null&&(C.__s==C.state&&(C.__s=_o({},C.__s)),_o(C.__s,O.getDerivedStateFromProps(A,C.__s))),b=C.props,p=C.state,I)O.getDerivedStateFromProps==null&&C.componentWillMount!=null&&C.componentWillMount(),C.componentDidMount!=null&&C.__h.push(C.componentDidMount);else{if(O.getDerivedStateFromProps==null&&A!==b&&C.componentWillReceiveProps!=null&&C.componentWillReceiveProps(A,_),!C.__e&&C.shouldComponentUpdate!=null&&C.shouldComponentUpdate(A,C.__s,_)===!1||l.__v===h.__v){C.props=A,C.state=C.__s,l.__v!==h.__v&&(C.__d=!1),C.__v=l,l.__e=h.__e,l.__k=h.__k,l.__k.forEach(function(R){R&&(R.__=l)}),C.__h.length&&m.push(C);break e}C.componentWillUpdate!=null&&C.componentWillUpdate(A,C.__s,_),C.componentDidUpdate!=null&&C.__h.push(function(){C.componentDidUpdate(b,p,x)})}C.context=_,C.props=A,C.state=C.__s,(M=Dt.__r)&&M(l),C.__d=!1,C.__v=l,C.__P=a,M=C.render(C.props,C.state,C.context),C.state=C.__s,C.getChildContext!=null&&(s=_o(_o({},s),C.getChildContext())),I||C.getSnapshotBeforeUpdate==null||(x=C.getSnapshotBeforeUpdate(b,p)),g=M!=null&&M.type===pr&&M.key==null?M.props.children:M,_S(a,Array.isArray(g)?g:[g],l,h,s,c,E,m,S,d),C.base=l.__e,l.__h=null,C.__h.length&&m.push(C),P&&(C.__E=C.__=null),C.__e=!1}else E==null&&l.__v===h.__v?(l.__k=h.__k,l.__e=h.__e):l.__e=tF(h.__e,l,h,s,c,E,m,d);(M=Dt.diffed)&&M(l)}catch(R){l.__v=null,(d||E!=null)&&(l.__e=S,l.__h=!!d,E[E.indexOf(S)]=null),Dt.__e(R,l,h)}}function ES(a,l){Dt.__c&&Dt.__c(l,a),a.some(function(h){try{a=h.__h,h.__h=[],a.some(function(s){s.call(h)})}catch(s){Dt.__e(s,h.__v)}})}function tF(a,l,h,s,c,E,m,S){var d,M,C,I=h.props,b=l.props,p=l.type,x=0;if(p==="svg"&&(c=!0),E!=null){for(;x<E.length;x++)if((d=E[x])&&(d===a||(p?d.localName==p:d.nodeType==3))){a=d,E[x]=null;break}}if(a==null){if(p===null)return document.createTextNode(b);a=c?document.createElementNS("http://www.w3.org/2000/svg",p):document.createElement(p,b.is&&b),E=null,S=!1}if(p===null)I===b||S&&a.data===b||(a.data=b);else{if(E=E&&Ol.call(a.childNodes),M=(I=h.props||rd).dangerouslySetInnerHTML,C=b.dangerouslySetInnerHTML,!S){if(E!=null)for(I={},x=0;x<a.attributes.length;x++)I[a.attributes[x].name]=a.attributes[x].value;(C||M)&&(C&&(M&&C.__html==M.__html||C.__html===a.innerHTML)||(a.innerHTML=C&&C.__html||""))}if(eF(a,b,I,c,S),C)l.__k=[];else if(x=l.props.children,_S(a,Array.isArray(x)?x:[x],l,h,s,c&&p!=="foreignObject",E,m,E?E[0]:h.__k&&Ys(h,0),S),E!=null)for(x=E.length;x--;)E[x]!=null&&fS(E[x]);S||("value"in b&&(x=b.value)!==void 0&&(x!==a.value||p==="progress"&&!x)&&od(a,"value",x,I.value,!1),"checked"in b&&(x=b.checked)!==void 0&&x!==a.checked&&od(a,"checked",x,I.checked,!1))}return a}function SS(a,l,h){try{typeof a=="function"?a(l):a.current=l}catch(s){Dt.__e(s,h)}}function xS(a,l,h){var s,c;if(Dt.unmount&&Dt.unmount(a),(s=a.ref)&&(s.current&&s.current!==a.__e||SS(s,null,l)),(s=a.__c)!=null){if(s.componentWillUnmount)try{s.componentWillUnmount()}catch(E){Dt.__e(E,l)}s.base=s.__P=null}if(s=a.__k)for(c=0;c<s.length;c++)s[c]&&xS(s[c],l,typeof a.type!="function");h||a.__e==null||fS(a.__e),a.__e=a.__d=void 0}function nF(a,l,h){return this.constructor(a,h)}function Dl(a,l,h){var s,c,E;Dt.__&&Dt.__(a,l),c=(s=typeof h=="function")?null:h&&h.__k||l.__k,E=[],x_(l,a=(!s&&h||l).__k=$e(pr,null,[a]),c||rd,rd,l.ownerSVGElement!==void 0,!s&&h?[h]:c?null:l.firstChild?Ol.call(l.childNodes):null,E,!s&&h?h:c?c.__e:l.firstChild,s),ES(E,a)}function AS(a,l){Dl(a,l,AS)}function rF(a,l,h){var s,c,E,m=_o({},a.props);for(E in l)E=="key"?s=l[E]:E=="ref"?c=l[E]:m[E]=l[E];return arguments.length>2&&(m.children=arguments.length>3?Ol.call(arguments,2):h),Il(a.type,m,s||a.key,c||a.ref,null)}function Sr(a,l){var h={__c:l="__cC"+hS++,__:a,Consumer:function(s,c){return s.children(c)},Provider:function(s){var c,E;return this.getChildContext||(c=[],(E={})[l]=this,this.getChildContext=function(){return E},this.shouldComponentUpdate=function(m){this.props.value!==m.value&&c.some(S_)},this.sub=function(m){c.push(m);var S=m.componentWillUnmount;m.componentWillUnmount=function(){c.splice(c.indexOf(m),1),S&&S.call(m)}}),s.children}};return h.Provider.__=h.Consumer.contextType=h}Ol=dS.slice,Dt={__e:function(a,l){for(var h,s,c;l=l.__;)if((h=l.__c)&&!h.__)try{if((s=h.constructor)&&s.getDerivedStateFromError!=null&&(h.setState(s.getDerivedStateFromError(a)),c=h.__d),h.componentDidCatch!=null&&(h.componentDidCatch(a),c=h.__d),c)return h.__E=h}catch(E){a=E}throw a}},cS=0,mi.prototype.setState=function(a,l){var h;h=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=_o({},this.state),typeof a=="function"&&(a=a(_o({},h),this.props)),a&&_o(h,a),a!=null&&this.__v&&(l&&this.__h.push(l),S_(this))},mi.prototype.forceUpdate=function(a){this.__v&&(this.__e=!0,a&&this.__h.push(a),S_(this))},mi.prototype.render=pr,Ml=[],lS=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,id.__r=0,hS=0;var ja,xr,PS,Ks=0,A_=[],CS=Dt.__b,RS=Dt.__r,OS=Dt.diffed,MS=Dt.__c,IS=Dt.unmount;function Qs(a,l){Dt.__h&&Dt.__h(xr,a,Ks||l),Ks=0;var h=xr.__H||(xr.__H={__:[],__h:[]});return a>=h.__.length&&h.__.push({}),h.__[a]}function un(a){return Ks=1,ad(NS,a)}function ad(a,l,h){var s=Qs(ja++,2);return s.t=a,s.__c||(s.__=[h?h(l):NS(void 0,l),function(c){var E=s.t(s.__[0],c);s.__[0]!==E&&(s.__=[E,s.__[1]],s.__c.setState({}))}],s.__c=xr),s.__}function Vt(a,l){var h=Qs(ja++,3);!Dt.__s&&C_(h.__H,l)&&(h.__=a,h.__H=l,xr.__H.__h.push(h))}function na(a,l){var h=Qs(ja++,4);!Dt.__s&&C_(h.__H,l)&&(h.__=a,h.__H=l,xr.__h.push(h))}function zt(a){return Ks=5,Vn(function(){return{current:a}},[])}function DS(a,l,h){Ks=6,na(function(){typeof a=="function"?a(l()):a&&(a.current=l())},h==null?h:h.concat(a))}function Vn(a,l){var h=Qs(ja++,7);return C_(h.__H,l)&&(h.__=a(),h.__H=l,h.__h=a),h.__}function Gt(a,l){return Ks=8,Vn(function(){return a},l)}function cn(a){var l=xr.context[a.__c],h=Qs(ja++,9);return h.c=a,l?(h.__==null&&(h.__=!0,l.sub(xr)),l.props.value):a.__}function wS(a,l){Dt.useDebugValue&&Dt.useDebugValue(l?l(a):a)}function iF(a){var l=Qs(ja++,10),h=un();return l.__=a,xr.componentDidCatch||(xr.componentDidCatch=function(s){l.__&&l.__(s),h[1](s)}),[h[0],function(){h[1](void 0)}]}function oF(){A_.forEach(function(a){if(a.__P)try{a.__H.__h.forEach(sd),a.__H.__h.forEach(P_),a.__H.__h=[]}catch(l){a.__H.__h=[],Dt.__e(l,a.__v)}}),A_=[]}Dt.__b=function(a){xr=null,CS&&CS(a)},Dt.__r=function(a){RS&&RS(a),ja=0;var l=(xr=a.__c).__H;l&&(l.__h.forEach(sd),l.__h.forEach(P_),l.__h=[])},Dt.diffed=function(a){OS&&OS(a);var l=a.__c;l&&l.__H&&l.__H.__h.length&&(A_.push(l)!==1&&PS===Dt.requestAnimationFrame||((PS=Dt.requestAnimationFrame)||function(h){var s,c=function(){clearTimeout(E),LS&&cancelAnimationFrame(s),setTimeout(h)},E=setTimeout(c,100);LS&&(s=requestAnimationFrame(c))})(oF)),xr=void 0},Dt.__c=function(a,l){l.some(function(h){try{h.__h.forEach(sd),h.__h=h.__h.filter(function(s){return!s.__||P_(s)})}catch(s){l.some(function(c){c.__h&&(c.__h=[])}),l=[],Dt.__e(s,h.__v)}}),MS&&MS(a,l)},Dt.unmount=function(a){IS&&IS(a);var l=a.__c;if(l&&l.__H)try{l.__H.__.forEach(sd)}catch(h){Dt.__e(h,l.__v)}};var LS=typeof requestAnimationFrame=="function";function sd(a){var l=xr;typeof a.__c=="function"&&a.__c(),xr=l}function P_(a){var l=xr;a.__c=a.__(),xr=l}function C_(a,l){return!a||a.length!==l.length||l.some(function(h,s){return h!==a[s]})}function NS(a,l){return typeof l=="function"?l(a):l}function FS(a,l){for(var h in l)a[h]=l[h];return a}function R_(a,l){for(var h in a)if(h!=="__source"&&!(h in l))return!0;for(var s in l)if(s!=="__source"&&a[s]!==l[s])return!0;return!1}function wl(a){this.props=a}function Ll(a,l){function h(c){var E=this.props.ref,m=E==c.ref;return!m&&E&&(E.call?E(null):E.current=null),l?!l(this.props,c)||!m:R_(this.props,c)}function s(c){return this.shouldComponentUpdate=h,$e(a,c)}return s.displayName="Memo("+(a.displayName||a.name)+")",s.prototype.isReactComponent=!0,s.__f=!0,s}(wl.prototype=new mi).isPureReactComponent=!0,wl.prototype.shouldComponentUpdate=function(a,l){return R_(this.props,a)||R_(this.state,l)};var BS=Dt.__b;Dt.__b=function(a){a.type&&a.type.__f&&a.ref&&(a.props.ref=a.ref,a.ref=null),BS&&BS(a)};var aF=typeof Symbol!="undefined"&&Symbol.for&&Symbol.for("react.forward_ref")||3911;function Oi(a){function l(h,s){var c=FS({},h);return delete c.ref,a(c,(s=h.ref||s)&&(typeof s!="object"||"current"in s)?s:null)}return l.$$typeof=aF,l.render=l,l.prototype.isReactComponent=l.__f=!0,l.displayName="ForwardRef("+(a.displayName||a.name)+")",l}var US=function(a,l){return a==null?null:go(go(a).map(l))},Nl={map:US,forEach:US,count:function(a){return a?go(a).length:0},only:function(a){var l=go(a);if(l.length!==1)throw"Children.only";return l[0]},toArray:go},sF=Dt.__e;Dt.__e=function(a,l,h){if(a.then){for(var s,c=l;c=c.__;)if((s=c.__c)&&s.__c)return l.__e==null&&(l.__e=h.__e,l.__k=h.__k),s.__c(a,l)}sF(a,l,h)};var VS=Dt.unmount;function Fl(){this.__u=0,this.t=null,this.__b=null}function kS(a){var l=a.__.__c;return l&&l.__e&&l.__e(a)}function jS(a){var l,h,s;function c(E){if(l||(l=a()).then(function(m){h=m.default||m},function(m){s=m}),s)throw s;if(!h)throw l;return $e(h,E)}return c.displayName="Lazy",c.__f=!0,c}function qs(){this.u=null,this.o=null}Dt.unmount=function(a){var l=a.__c;l&&l.__R&&l.__R(),l&&a.__h===!0&&(a.type=null),VS&&VS(a)},(Fl.prototype=new mi).__c=function(a,l){var h=l.__c,s=this;s.t==null&&(s.t=[]),s.t.push(h);var c=kS(s.__v),E=!1,m=function(){E||(E=!0,h.__R=null,c?c(S):S())};h.__R=m;var S=function(){if(!--s.__u){if(s.state.__e){var M=s.state.__e;s.__v.__k[0]=function I(b,p,x){return b&&(b.__v=null,b.__k=b.__k&&b.__k.map(function(P){return I(P,p,x)}),b.__c&&b.__c.__P===p&&(b.__e&&x.insertBefore(b.__e,b.__d),b.__c.__e=!0,b.__c.__P=x)),b}(M,M.__c.__P,M.__c.__O)}var C;for(s.setState({__e:s.__b=null});C=s.t.pop();)C.forceUpdate()}},d=l.__h===!0;s.__u++||d||s.setState({__e:s.__b=s.__v.__k[0]}),a.then(m,m)},Fl.prototype.componentWillUnmount=function(){this.t=[]},Fl.prototype.render=function(a,l){if(this.__b){if(this.__v.__k){var h=document.createElement("div"),s=this.__v.__k[0].__c;this.__v.__k[0]=function E(m,S,d){return m&&(m.__c&&m.__c.__H&&(m.__c.__H.__.forEach(function(M){typeof M.__c=="function"&&M.__c()}),m.__c.__H=null),(m=FS({},m)).__c!=null&&(m.__c.__P===d&&(m.__c.__P=S),m.__c=null),m.__k=m.__k&&m.__k.map(function(M){return E(M,S,d)})),m}(this.__b,h,s.__O=s.__P)}this.__b=null}var c=l.__e&&$e(pr,null,a.fallback);return c&&(c.__h=null),[$e(pr,null,l.__e?null:a.children),c]};var zS=function(a,l,h){if(++h[1]===h[0]&&a.o.delete(l),a.props.revealOrder&&(a.props.revealOrder[0]!=="t"||!a.o.size))for(h=a.u;h;){for(;h.length>3;)h.pop()();if(h[1]<h[0])break;a.u=h=h[2]}};function cF(a){return this.getChildContext=function(){return a.context},a.children}function lF(a){var l=this,h=a.i;l.componentWillUnmount=function(){Dl(null,l.l),l.l=null,l.i=null},l.i&&l.i!==h&&l.componentWillUnmount(),a.__v?(l.l||(l.i=h,l.l={nodeType:1,parentNode:h,childNodes:[],appendChild:function(s){this.childNodes.push(s),l.i.appendChild(s)},insertBefore:function(s,c){this.childNodes.push(s),l.i.appendChild(s)},removeChild:function(s){this.childNodes.splice(this.childNodes.indexOf(s)>>>1,1),l.i.removeChild(s)}}),Dl($e(cF,{context:l.context},a.__v),l.l)):l.l&&l.componentWillUnmount()}function cd(a,l){return $e(lF,{__v:a,i:l})}(qs.prototype=new mi).__e=function(a){var l=this,h=kS(l.__v),s=l.o.get(a);return s[0]++,function(c){var E=function(){l.props.revealOrder?(s.push(c),zS(l,a,s)):c()};h?h(E):E()}},qs.prototype.render=function(a){this.u=null,this.o=new Map;var l=go(a.children);a.revealOrder&&a.revealOrder[0]==="b"&&l.reverse();for(var h=l.length;h--;)this.o.set(l[h],this.u=[1,0,this.u]);return a.children},qs.prototype.componentDidUpdate=qs.prototype.componentDidMount=function(){var a=this;this.o.forEach(function(l,h){zS(a,h,l)})};var GS=typeof Symbol!="undefined"&&Symbol.for&&Symbol.for("react.element")||60103,uF=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|fill|flood|font|glyph(?!R)|horiz|marker(?!H|W|U)|overline|paint|stop|strikethrough|stroke|text(?!L)|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,hF=function(a){return(typeof Symbol!="undefined"&&typeof Symbol()=="symbol"?/fil|che|rad/i:/fil|che|ra/i).test(a)};function HS(a,l,h){return l.__k==null&&(l.textContent=""),Dl(a,l),typeof h=="function"&&h(),a?a.__c:null}function WS(a,l,h){return AS(a,l),typeof h=="function"&&h(),a?a.__c:null}mi.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(a){Object.defineProperty(mi.prototype,a,{configurable:!0,get:function(){return this["UNSAFE_"+a]},set:function(l){Object.defineProperty(this,a,{configurable:!0,writable:!0,value:l})}})});var XS=Dt.event;function dF(){}function fF(){return this.cancelBubble}function pF(){return this.defaultPrevented}Dt.event=function(a){return XS&&(a=XS(a)),a.persist=dF,a.isPropagationStopped=fF,a.isDefaultPrevented=pF,a.nativeEvent=a};var YS,KS={configurable:!0,get:function(){return this.class}},QS=Dt.vnode;Dt.vnode=function(a){var l=a.type,h=a.props,s=h;if(typeof l=="string"){for(var c in s={},h){var E=h[c];c==="value"&&"defaultValue"in h&&E==null||(c==="defaultValue"&&"value"in h&&h.value==null?c="value":c==="download"&&E===!0?E="":/ondoubleclick/i.test(c)?c="ondblclick":/^onchange(textarea|input)/i.test(c+l)&&!hF(h.type)?c="oninput":/^on(Ani|Tra|Tou|BeforeInp)/.test(c)?c=c.toLowerCase():uF.test(c)?c=c.replace(/[A-Z0-9]/,"-$&").toLowerCase():E===null&&(E=void 0),s[c]=E)}l=="select"&&s.multiple&&Array.isArray(s.value)&&(s.value=go(h.children).forEach(function(m){m.props.selected=s.value.indexOf(m.props.value)!=-1})),l=="select"&&s.defaultValue!=null&&(s.value=go(h.children).forEach(function(m){m.props.selected=s.multiple?s.defaultValue.indexOf(m.props.value)!=-1:s.defaultValue==m.props.value})),a.props=s}l&&h.class!=h.className&&(KS.enumerable="className"in h,h.className!=null&&(s.class=h.className),Object.defineProperty(s,"className",KS)),a.$$typeof=GS,QS&&QS(a)};var qS=Dt.__r;Dt.__r=function(a){qS&&qS(a),YS=a.__c};var ZS={ReactCurrentDispatcher:{current:{readContext:function(a){return YS.__n[a.__c].props.value}}}},mF="17.0.2";function $S(a){return $e.bind(null,a)}function ra(a){return!!a&&a.$$typeof===GS}function ia(a){return ra(a)?rF.apply(null,arguments):a}function JS(a){return!!a.__k&&(Dl(null,a),!0)}function ex(a){return a&&(a.base||a.nodeType===1&&a)||null}var tx=function(a,l){return a(l)},nx=function(a,l){return a(l)},_F=pr,ei={useState:un,useReducer:ad,useEffect:Vt,useLayoutEffect:na,useRef:zt,useImperativeHandle:DS,useMemo:Vn,useCallback:Gt,useContext:cn,useDebugValue:wS,version:"17.0.2",Children:Nl,render:HS,hydrate:WS,unmountComponentAtNode:JS,createPortal:cd,createElement:$e,createContext:Sr,createFactory:$S,cloneElement:ia,createRef:pS,Fragment:pr,isValidElement:ra,findDOMNode:ex,Component:mi,PureComponent:wl,memo:Ll,forwardRef:Oi,flushSync:nx,unstable_batchedUpdates:tx,StrictMode:pr,Suspense:Fl,SuspenseList:qs,lazy:jS,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:ZS},gF=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:ei,version:mF,Children:Nl,render:HS,hydrate:WS,unmountComponentAtNode:JS,createPortal:cd,createFactory:$S,cloneElement:ia,isValidElement:ra,findDOMNode:ex,PureComponent:wl,memo:Ll,forwardRef:Oi,flushSync:nx,unstable_batchedUpdates:tx,StrictMode:_F,Suspense:Fl,SuspenseList:qs,lazy:jS,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:ZS,createElement:$e,createContext:Sr,createRef:pS,Fragment:pr,Component:mi,useState:un,useReducer:ad,useEffect:Vt,useLayoutEffect:na,useRef:zt,useImperativeHandle:DS,useMemo:Vn,useCallback:Gt,useContext:cn,useDebugValue:wS,useErrorBoundary:iF}),Fe=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function vF(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}function rx(a){if(a.__esModule)return a;var l=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(a).forEach(function(h){var s=Object.getOwnPropertyDescriptor(a,h);Object.defineProperty(l,h,s.get?s:{enumerable:!0,get:function(){return a[h]}})}),l}var bF=function(a,l){for(var h=[],s=0;s<a.length;s++){var c=l(a[s],s);yF(c)?h.push.apply(h,c):h.push(c)}return h},yF=Array.isArray||function(a){return Object.prototype.toString.call(a)==="[object Array]"},TF=ix;function ix(a,l,h){a instanceof RegExp&&(a=ox(a,h)),l instanceof RegExp&&(l=ox(l,h));var s=ax(a,l,h);return s&&{start:s[0],end:s[1],pre:h.slice(0,s[0]),body:h.slice(s[0]+a.length,s[1]),post:h.slice(s[1]+l.length)}}function ox(a,l){var h=l.match(a);return h?h[0]:null}ix.range=ax;function ax(a,l,h){var s,c,E,m,S,d=h.indexOf(a),M=h.indexOf(l,d+1),C=d;if(d>=0&&M>0){if(a===l)return[d,M];for(s=[],E=h.length;C>=0&&!S;)C==d?(s.push(C),d=h.indexOf(a,C+1)):s.length==1?S=[s.pop(),M]:(c=s.pop(),c<E&&(E=c,m=M),M=h.indexOf(l,C+1)),C=d<M&&d>=0?d:M;s.length&&(S=[E,m])}return S}var EF=bF,sx=TF,SF=PF,cx="\0SLASH"+Math.random()+"\0",lx="\0OPEN"+Math.random()+"\0",O_="\0CLOSE"+Math.random()+"\0",ux="\0COMMA"+Math.random()+"\0",hx="\0PERIOD"+Math.random()+"\0";function M_(a){return parseInt(a,10)==a?parseInt(a,10):a.charCodeAt(0)}function xF(a){return a.split("\\\\").join(cx).split("\\{").join(lx).split("\\}").join(O_).split("\\,").join(ux).split("\\.").join(hx)}function AF(a){return a.split(cx).join("\\").split(lx).join("{").split(O_).join("}").split(ux).join(",").split(hx).join(".")}function dx(a){if(!a)return[""];var l=[],h=sx("{","}",a);if(!h)return a.split(",");var s=h.pre,c=h.body,E=h.post,m=s.split(",");m[m.length-1]+="{"+c+"}";var S=dx(E);return E.length&&(m[m.length-1]+=S.shift(),m.push.apply(m,S)),l.push.apply(l,m),l}function PF(a){return a?(a.substr(0,2)==="{}"&&(a="\\{\\}"+a.substr(2)),Zs(xF(a),!0).map(AF)):[]}function CF(a){return"{"+a+"}"}function RF(a){return/^-?0\d/.test(a)}function OF(a,l){return a<=l}function MF(a,l){return a>=l}function Zs(a,l){var h=[],s=sx("{","}",a);if(!s||/\$$/.test(s.pre))return[a];var c=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(s.body),E=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(s.body),m=c||E,S=s.body.indexOf(",")>=0;if(!m&&!S)return s.post.match(/,.*\}/)?(a=s.pre+"{"+s.body+O_+s.post,Zs(a)):[a];var d;if(m)d=s.body.split(/\.\./);else if(d=dx(s.body),d.length===1&&(d=Zs(d[0],!1).map(CF),d.length===1)){var C=s.post.length?Zs(s.post,!1):[""];return C.map(function(Y){return s.pre+d[0]+Y})}var M=s.pre,C=s.post.length?Zs(s.post,!1):[""],I;if(m){var b=M_(d[0]),p=M_(d[1]),x=Math.max(d[0].length,d[1].length),P=d.length==3?Math.abs(M_(d[2])):1,A=OF,T=p<b;T&&(P*=-1,A=MF);var _=d.some(RF);I=[];for(var g=b;A(g,p);g+=P){var O;if(E)O=String.fromCharCode(g),O==="\\"&&(O="");else if(O=String(g),_){var R=x-O.length;if(R>0){var N=new Array(R+1).join("0");g<0?O="-"+N+O.slice(1):O=N+O}}I.push(O)}}else I=EF(d,function(j){return Zs(j,!1)});for(var V=0;V<I.length;V++)for(var U=0;U<C.length;U++){var L=M+I[V]+C[U];(!l||m||L)&&h.push(L)}return h}var IF=_i;_i.Minimatch=mr;var Bl={sep:"/"};try{Bl=require("path")}catch(a){}var I_=_i.GLOBSTAR=mr.GLOBSTAR={},DF=SF,fx={"!":{open:"(?:(?!(?:",close:"))[^/]*?)"},"?":{open:"(?:",close:")?"},"+":{open:"(?:",close:")+"},"*":{open:"(?:",close:")*"},"@":{open:"(?:",close:")"}},D_="[^/]",w_=D_+"*?",wF="(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?",LF="(?:(?!(?:\\/|^)\\.).)*?",px=NF("().*{}+?[]^$\\!");function NF(a){return a.split("").reduce(function(l,h){return l[h]=!0,l},{})}var mx=/\/+/;_i.filter=FF;function FF(a,l){return l=l||{},function(h,s,c){return _i(h,a,l)}}function _x(a,l){a=a||{},l=l||{};var h={};return Object.keys(l).forEach(function(s){h[s]=l[s]}),Object.keys(a).forEach(function(s){h[s]=a[s]}),h}_i.defaults=function(a){if(!a||!Object.keys(a).length)return _i;var l=_i,h=function(c,E,m){return l.minimatch(c,E,_x(a,m))};return h.Minimatch=function(c,E){return new l.Minimatch(c,_x(a,E))},h};mr.defaults=function(a){return!a||!Object.keys(a).length?mr:_i.defaults(a).Minimatch};function _i(a,l,h){if(typeof l!="string")throw new TypeError("glob pattern string required");return h||(h={}),!h.nocomment&&l.charAt(0)==="#"?!1:l.trim()===""?a==="":new mr(l,h).match(a)}function mr(a,l){if(!(this instanceof mr))return new mr(a,l);if(typeof a!="string")throw new TypeError("glob pattern string required");l||(l={}),a=a.trim(),Bl.sep!=="/"&&(a=a.split(Bl.sep).join("/")),this.options=l,this.set=[],this.pattern=a,this.regexp=null,this.negate=!1,this.comment=!1,this.empty=!1,this.make()}mr.prototype.debug=function(){};mr.prototype.make=BF;function BF(){if(!this._made){var a=this.pattern,l=this.options;if(!l.nocomment&&a.charAt(0)==="#"){this.comment=!0;return}if(!a){this.empty=!0;return}this.parseNegate();var h=this.globSet=this.braceExpand();l.debug&&(this.debug=console.error),this.debug(this.pattern,h),h=this.globParts=h.map(function(s){return s.split(mx)}),this.debug(this.pattern,h),h=h.map(function(s,c,E){return s.map(this.parse,this)},this),this.debug(this.pattern,h),h=h.filter(function(s){return s.indexOf(!1)===-1}),this.debug(this.pattern,h),this.set=h}}mr.prototype.parseNegate=UF;function UF(){var a=this.pattern,l=!1,h=this.options,s=0;if(!h.nonegate){for(var c=0,E=a.length;c<E&&a.charAt(c)==="!";c++)l=!l,s++;s&&(this.pattern=a.substr(s)),this.negate=l}}_i.braceExpand=function(a,l){return gx(a,l)};mr.prototype.braceExpand=gx;function gx(a,l){if(l||(this instanceof mr?l=this.options:l={}),a=typeof a=="undefined"?this.pattern:a,typeof a=="undefined")throw new TypeError("undefined pattern");return l.nobrace||!a.match(/\{.*\}/)?[a]:DF(a)}mr.prototype.parse=VF;var ld={};function VF(a,l){if(a.length>1024*64)throw new TypeError("pattern is too long");var h=this.options;if(!h.noglobstar&&a==="**")return I_;if(a==="")return"";var s="",c=!!h.nocase,E=!1,m=[],S=[],d,M=!1,C=-1,I=-1,b=a.charAt(0)==="."?"":h.dot?"(?!(?:^|\\/)\\.{1,2}(?:$|\\/))":"(?!\\.)",p=this;function x(){if(d){switch(d){case"*":s+=w_,c=!0;break;case"?":s+=D_,c=!0;break;default:s+="\\"+d;break}p.debug("clearStateChar %j %j",d,s),d=!1}}for(var P=0,A=a.length,T;P<A&&(T=a.charAt(P));P++){if(this.debug("%s	%s %s %j",a,P,s,T),E&&px[T]){s+="\\"+T,E=!1;continue}switch(T){case"/":return!1;case"\\":x(),E=!0;continue;case"?":case"*":case"+":case"@":case"!":if(this.debug("%s	%s %s %j <-- stateChar",a,P,s,T),M){this.debug("  in class"),T==="!"&&P===I+1&&(T="^"),s+=T;continue}p.debug("call clearStateChar %j",d),x(),d=T,h.noext&&x();continue;case"(":if(M){s+="(";continue}if(!d){s+="\\(";continue}m.push({type:d,start:P-1,reStart:s.length,open:fx[d].open,close:fx[d].close}),s+=d==="!"?"(?:(?!(?:":"(?:",this.debug("plType %j %j",d,s),d=!1;continue;case")":if(M||!m.length){s+="\\)";continue}x(),c=!0;var _=m.pop();s+=_.close,_.type==="!"&&S.push(_),_.reEnd=s.length;continue;case"|":if(M||!m.length||E){s+="\\|",E=!1;continue}x(),s+="|";continue;case"[":if(x(),M){s+="\\"+T;continue}M=!0,I=P,C=s.length,s+=T;continue;case"]":if(P===I+1||!M){s+="\\"+T,E=!1;continue}if(M){var g=a.substring(I+1,P);try{RegExp("["+g+"]")}catch(te){var O=this.parse(g,ld);s=s.substr(0,C)+"\\["+O[0]+"\\]",c=c||O[1],M=!1;continue}}c=!0,M=!1,s+=T;continue;default:x(),E?E=!1:px[T]&&!(T==="^"&&M)&&(s+="\\"),s+=T}}for(M&&(g=a.substr(I+1),O=this.parse(g,ld),s=s.substr(0,C)+"\\["+O[0],c=c||O[1]),_=m.pop();_;_=m.pop()){var R=s.slice(_.reStart+_.open.length);this.debug("setting tail",s,_),R=R.replace(/((?:\\{2}){0,64})(\\?)\|/g,function(te,B,G){return G||(G="\\"),B+B+G+"|"}),this.debug(`tail=%j
   %s`,R,R,_,s);var N=_.type==="*"?w_:_.type==="?"?D_:"\\"+_.type;c=!0,s=s.slice(0,_.reStart)+N+"\\("+R}x(),E&&(s+="\\\\");var V=!1;switch(s.charAt(0)){case".":case"[":case"(":V=!0}for(var U=S.length-1;U>-1;U--){var L=S[U],j=s.slice(0,L.reStart),Y=s.slice(L.reStart,L.reEnd-8),W=s.slice(L.reEnd-8,L.reEnd),re=s.slice(L.reEnd);W+=re;var ne=j.split("(").length-1,ge=re;for(P=0;P<ne;P++)ge=ge.replace(/\)[+*?]?/,"");re=ge;var _e="";re===""&&l!==ld&&(_e="$");var ce=j+Y+re+_e+W;s=ce}if(s!==""&&c&&(s="(?=.)"+s),V&&(s=b+s),l===ld)return[s,c];if(!c)return zF(a);var ie=h.nocase?"i":"";try{var Z=new RegExp("^"+s+"$",ie)}catch(te){return new RegExp("$.")}return Z._glob=a,Z._src=s,Z}_i.makeRe=function(a,l){return new mr(a,l||{}).makeRe()};mr.prototype.makeRe=kF;function kF(){if(this.regexp||this.regexp===!1)return this.regexp;var a=this.set;if(!a.length)return this.regexp=!1,this.regexp;var l=this.options,h=l.noglobstar?w_:l.dot?wF:LF,s=l.nocase?"i":"",c=a.map(function(E){return E.map(function(m){return m===I_?h:typeof m=="string"?GF(m):m._src}).join("\\/")}).join("|");c="^(?:"+c+")$",this.negate&&(c="^(?!"+c+").*$");try{this.regexp=new RegExp(c,s)}catch(E){this.regexp=!1}return this.regexp}_i.match=function(a,l,h){h=h||{};var s=new mr(l,h);return a=a.filter(function(c){return s.match(c)}),s.options.nonull&&!a.length&&a.push(l),a};mr.prototype.match=jF;function jF(a,l){if(this.debug("match",a,this.pattern),this.comment)return!1;if(this.empty)return a==="";if(a==="/"&&l)return!0;var h=this.options;Bl.sep!=="/"&&(a=a.split(Bl.sep).join("/")),a=a.split(mx),this.debug(this.pattern,"split",a);var s=this.set;this.debug(this.pattern,"set",s);var c,E;for(E=a.length-1;E>=0&&(c=a[E],!c);E--);for(E=0;E<s.length;E++){var m=s[E],S=a;h.matchBase&&m.length===1&&(S=[c]);var d=this.matchOne(S,m,l);if(d)return h.flipNegate?!0:!this.negate}return h.flipNegate?!1:this.negate}mr.prototype.matchOne=function(a,l,h){var s=this.options;this.debug("matchOne",{this:this,file:a,pattern:l}),this.debug("matchOne",a.length,l.length);for(var c=0,E=0,m=a.length,S=l.length;c<m&&E<S;c++,E++){this.debug("matchOne loop");var d=l[E],M=a[c];if(this.debug(l,d,M),d===!1)return!1;if(d===I_){this.debug("GLOBSTAR",[l,d,M]);var C=c,I=E+1;if(I===S){for(this.debug("** at the end");c<m;c++)if(a[c]==="."||a[c]===".."||!s.dot&&a[c].charAt(0)===".")return!1;return!0}for(;C<m;){var b=a[C];if(this.debug(`
globstar while`,a,C,l,I,b),this.matchOne(a.slice(C),l.slice(I),h))return this.debug("globstar found match!",C,m,b),!0;if(b==="."||b===".."||!s.dot&&b.charAt(0)==="."){this.debug("dot detected!",a,C,l,I);break}this.debug("globstar swallow a segment, and continue"),C++}return!!(h&&(this.debug(`
>>> no match, partial?`,a,C,l,I),C===m))}var p;if(typeof d=="string"?(s.nocase?p=M.toLowerCase()===d.toLowerCase():p=M===d,this.debug("string match",d,M,p)):(p=M.match(d),this.debug("pattern match",d,M,p)),!p)return!1}if(c===m&&E===S)return!0;if(c===m)return h;if(E===S){var x=c===m-1&&a[c]==="";return x}throw new Error("wtf?")};function zF(a){return a.replace(/\\(.)/g,"$1")}function GF(a){return a.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}var ud;(function(a){a.V0_3="0.3",a.V0_4="0.4"})(ud||(ud={}));var Mi;(function(a){a.V0_2="0.2",a.V0_3="0.3"})(Mi||(Mi={}));const vx=Object.keys(ud);ud.V0_4;const bx=Object.keys(Mi),hd=Mi.V0_3;var qt;(function(a){a.Inputs="inputs",a.Outputs="outputs",a.State="state",a.Definition="definition",a.DefinitionUpdateRequest="definitionupdaterequest",a.Error="error",a.UrlHashUpdate="urlhashupdate",a.Message="Message"})(qt||(qt={}));var Br;(function(a){a.InputsUpdate="InputsUpdate",a.OutputsUpdate="OutputsUpdate",a.SetupIframeClientRequest="SetupIframeClientRequest",a.SetupIframeServerResponseAck="SetupIframeServerResponseAck",a.PluginRequest="SetupIframeServerPluginRequestResponseAck",a.HashParamsUpdate="HashParamsUpdate"})(Br||(Br={}));var vo;(function(a){a.InputsUpdate="InputsUpdate",a.MessageAck="MessageAck",a.SetupIframeServerResponse="SetupIframeServerResponse"})(vo||(vo={}));var L_;(function(a){a.State="metapage/state"})(L_||(L_={}));const Yi="metapage/definition",oa="metapage/state",yx=bx[bx.length-1],HF=vx[vx.length-1];var Ul={exports:{}};(function(a,l){(function(h,s){a.exports=s()})(Fe,function(){var h=/^v?(?:\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+))?(?:-[\da-z\-]+(?:\.[\da-z\-]+)*)?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i;function s(I,b){return I.indexOf(b)===-1?I.length:I.indexOf(b)}function c(I){var b=I.replace(/^v/,"").replace(/\+.*$/,""),p=s(b,"-"),x=b.substring(0,p).split(".");return x.push(b.substring(p+1)),x}function E(I){return isNaN(Number(I))?I:Number(I)}function m(I){if(typeof I!="string")throw new TypeError("Invalid argument expected string");if(!h.test(I))throw new Error("Invalid argument not valid semver ('"+I+"' received)")}function S(I,b){[I,b].forEach(m);for(var p=c(I),x=c(b),P=0;P<Math.max(p.length-1,x.length-1);P++){var A=parseInt(p[P]||0,10),T=parseInt(x[P]||0,10);if(A>T)return 1;if(T>A)return-1}var _=p[p.length-1],g=x[x.length-1];if(_&&g){var O=_.split(".").map(E),R=g.split(".").map(E);for(P=0;P<Math.max(O.length,R.length);P++){if(O[P]===void 0||typeof R[P]=="string"&&typeof O[P]=="number")return-1;if(R[P]===void 0||typeof O[P]=="string"&&typeof R[P]=="number"||O[P]>R[P])return 1;if(R[P]>O[P])return-1}}else if(_||g)return _?-1:1;return 0}var d=[">",">=","=","<","<="],M={">":[1],">=":[0,1],"=":[0],"<=":[-1,0],"<":[-1]};function C(I){if(typeof I!="string")throw new TypeError("Invalid operator type, expected string but got "+typeof I);if(d.indexOf(I)===-1)throw new TypeError("Invalid operator, expected one of "+d.join("|"))}return S.validate=function(I){return typeof I=="string"&&h.test(I)},S.compare=function(I,b,p){C(p);var x=S(I,b);return M[p].indexOf(x)>-1},S})})(Ul);var dd={exports:{}};(function(a){var l=Object.prototype.hasOwnProperty,h="~";function s(){}Object.create&&(s.prototype=Object.create(null),new s().__proto__||(h=!1));function c(d,M,C){this.fn=d,this.context=M,this.once=C||!1}function E(d,M,C,I,b){if(typeof C!="function")throw new TypeError("The listener must be a function");var p=new c(C,I||d,b),x=h?h+M:M;return d._events[x]?d._events[x].fn?d._events[x]=[d._events[x],p]:d._events[x].push(p):(d._events[x]=p,d._eventsCount++),d}function m(d,M){--d._eventsCount==0?d._events=new s:delete d._events[M]}function S(){this._events=new s,this._eventsCount=0}S.prototype.eventNames=function(){var M=[],C,I;if(this._eventsCount===0)return M;for(I in C=this._events)l.call(C,I)&&M.push(h?I.slice(1):I);return Object.getOwnPropertySymbols?M.concat(Object.getOwnPropertySymbols(C)):M},S.prototype.listeners=function(M){var C=h?h+M:M,I=this._events[C];if(!I)return[];if(I.fn)return[I.fn];for(var b=0,p=I.length,x=new Array(p);b<p;b++)x[b]=I[b].fn;return x},S.prototype.listenerCount=function(M){var C=h?h+M:M,I=this._events[C];return I?I.fn?1:I.length:0},S.prototype.emit=function(M,C,I,b,p,x){var P=h?h+M:M;if(!this._events[P])return!1;var A=this._events[P],T=arguments.length,_,g;if(A.fn){switch(A.once&&this.removeListener(M,A.fn,void 0,!0),T){case 1:return A.fn.call(A.context),!0;case 2:return A.fn.call(A.context,C),!0;case 3:return A.fn.call(A.context,C,I),!0;case 4:return A.fn.call(A.context,C,I,b),!0;case 5:return A.fn.call(A.context,C,I,b,p),!0;case 6:return A.fn.call(A.context,C,I,b,p,x),!0}for(g=1,_=new Array(T-1);g<T;g++)_[g-1]=arguments[g];A.fn.apply(A.context,_)}else{var O=A.length,R;for(g=0;g<O;g++)switch(A[g].once&&this.removeListener(M,A[g].fn,void 0,!0),T){case 1:A[g].fn.call(A[g].context);break;case 2:A[g].fn.call(A[g].context,C);break;case 3:A[g].fn.call(A[g].context,C,I);break;case 4:A[g].fn.call(A[g].context,C,I,b);break;default:if(!_)for(R=1,_=new Array(T-1);R<T;R++)_[R-1]=arguments[R];A[g].fn.apply(A[g].context,_)}}return!0},S.prototype.on=function(M,C,I){return E(this,M,C,I,!1)},S.prototype.once=function(M,C,I){return E(this,M,C,I,!0)},S.prototype.removeListener=function(M,C,I,b){var p=h?h+M:M;if(!this._events[p])return this;if(!C)return m(this,p),this;var x=this._events[p];if(x.fn)x.fn===C&&(!b||x.once)&&(!I||x.context===I)&&m(this,p);else{for(var P=0,A=[],T=x.length;P<T;P++)(x[P].fn!==C||b&&!x[P].once||I&&x[P].context!==I)&&A.push(x[P]);A.length?this._events[p]=A.length===1?A[0]:A:m(this,p)}return this},S.prototype.removeAllListeners=function(M){var C;return M?(C=h?h+M:M,this._events[C]&&m(this,C)):(this._events=new s,this._eventsCount=0),this},S.prototype.off=S.prototype.removeListener,S.prototype.addListener=S.prototype.on,S.prefixed=h,S.EventEmitter=S,a.exports=S})(dd);var fd;(function(a){a.mp_debug="mp_debug"})(fd||(fd={}));const WF=()=>{try{return window!==window.top}catch(a){return!1}};class XF extends dd.exports.EventEmitter{constructor(){super();this._definition={version:Mi.V0_3,metaframes:{}},this.getDefinition=this.getDefinition.bind(this)}error(l){throw"Subclass should implement"}getDefinition(){return this._definition}}var YF=globalThis&&globalThis.__awaiter||function(a,l,h,s){function c(E){return E instanceof h?E:new h(function(m){m(E)})}return new(h||(h=Promise))(function(E,m){function S(C){try{M(s.next(C))}catch(I){m(I)}}function d(C){try{M(s.throw(C))}catch(I){m(I)}}function M(C){C.done?E(C.value):c(C.value).then(S,d)}M((s=s.apply(a,l||[])).next())})};const Tx=a=>{if(a===null)throw"Metapage definition cannot be null";if(typeof a=="string")try{a=JSON.parse(a)}catch(h){throw`Cannot parse into JSON:
${a}`}let l;switch(QF(a.version)){case Mi.V0_2:{l=Tx(KF(a));break}case Mi.V0_3:{l=a;break}default:console.warn(`Metapage definition version=${a.version} but we only know up to version ${hd}. Assuming the definition is compatible, but it's the future!`),l=a;break}return l},KF=a=>(a.version=Mi.V0_3,a),pd=(a,l)=>{if(!l)return!1;let h=!1;return Object.keys(l).forEach(s=>{h=!0,l[s]===void 0?delete a[s]:a[s]=l[s]}),h},QF=a=>{if(a=="latest")return hd;if(Ul.exports.compare(a,"0.2","<"))throw`Unknown version: ${a}`;return Ul.exports.compare(a,"0.2",">=")&&Ul.exports.compare(a,Mi.V0_3,"<")?Mi.V0_2:Ul.exports.compare(a,"0.3",">=")?Mi.V0_3:(console.log(`Could not match version=${a} to any known version, assuming ${hd}`),hd)},N_=()=>{const a=new URLSearchParams(window.location.search).get(fd.mp_debug);return a==="true"||a==="1"},qF=a=>a.filter(h=>new URLSearchParams(window.location.search).has(h)).length>0,ZF=(a=8)=>$F(a),Ex="abcdefghijklmnopqrstuvwxyz0123456789",$F=(a=8)=>{for(var l="",h=Ex.length,s=0;s<a;s++)l+=Ex.charAt(Math.floor(Math.random()*h));return l},F_=(a,l,h)=>{l=l||"000",l&&l.trim()==""&&(l=void 0);let s;if(typeof a=="string"?s=a:typeof a=="number"?s=a+"":s=JSON.stringify(a,null,"  "),l&&l.trim()!=""){var c=`color: #${l}`;h&&(c=`${c}; background: #${h}`),s=`%c${s}`,window.console.log(s,c)}else window.console.log(s)},Sx=a=>eB(JF(a)),JF=a=>{var l=0;for(let h=0;h<a.length;h++)l=a.charCodeAt(h)+((l<<5)-l);return l},eB=a=>{var l=(a&16777215).toString(16).toUpperCase();return"00000".substring(0,6-l.length)+l},B_=()=>document.readyState=="complete"||document.readyState=="interactive",U_=()=>YF(void 0,void 0,void 0,function*(){return B_()?Promise.resolve():new Promise(a=>{if(B_()){a();return}let l=!1;window.addEventListener("load",()=>{l||(l=!0,a())}),setTimeout(()=>{!l&&B_()&&(l=!0,a())},200)})});var xx=globalThis&&globalThis.__awaiter||function(a,l,h,s){function c(E){return E instanceof h?E:new h(function(m){m(E)})}return new(h||(h=Promise))(function(E,m){function S(C){try{M(s.next(C))}catch(I){m(I)}}function d(C){try{M(s.throw(C))}catch(I){m(I)}}function M(C){C.done?E(C.value):c(C.value).then(S,d)}M((s=s.apply(a,l||[])).next())})};class Ax extends dd.exports.EventEmitter{constructor(l,h,s,c,E,m=!1){super();if(this.inputs={},this.outputs={},this._disposables=[],this._rpcListeners=[],this._loaded=!1,this._onLoaded=[],this._sendInputsAfterRegistration=!1,this._plugin=!1,this._cachedEventInputsUpdate={iframeId:void 0,inputs:void 0},this._cachedEventOutputsUpdate={iframeId:null,inputs:null},!h.startsWith("http")){for(;h.startsWith("/");)h=h.substr(1);h=window.location.protocol+"//"+window.location.hostname+(window.location.port&&window.location.port!=""?":"+window.location.port:"")+"/"+h}this.url=h,this._metapage=l;var S=new URL(this.url);m&&S.searchParams.set(fd.mp_debug,"true"),this.url=S.href,this.id=s,this._debug=m,this._parentId=c,this._color=Sx(this.id),this._consoleBackgroundColor=E,this._iframe=document.createElement("iframe"),this._iframe.name=this.id;const d=this;this.iframe=new Promise(M=>{U_().then(()=>xx(this,void 0,void 0,function*(){if(d._iframe){const C=yield d.getDefinition();if(!d._iframe)return;(C==null?void 0:C.allow)&&(d._iframe.allow=C.allow),d._iframe.src=this.url,M(d._iframe)}}))}),this.ack=this.ack.bind(this),this.dispose=this.dispose.bind(this),this.getDefinition=this.getDefinition.bind(this),this.getDefinitionUrl=this.getDefinitionUrl.bind(this),this.setPlugin=this.setPlugin.bind(this),this.hasPermissionsDefinition=this.hasPermissionsDefinition.bind(this),this.hasPermissionsState=this.hasPermissionsState.bind(this),this.log=this.log.bind(this),this.logInternal=this.logInternal.bind(this),this.onInput=this.onInput.bind(this),this.onInputs=this.onInputs.bind(this),this.onOutput=this.onOutput.bind(this),this.onOutputs=this.onOutputs.bind(this),this.register=this.register.bind(this),this.registered=this.registered.bind(this),this.sendInputs=this.sendInputs.bind(this),this.sendOrBufferPostMessage=this.sendOrBufferPostMessage.bind(this),this.sendRpc=this.sendRpc.bind(this),this.sendRpcInternal=this.sendRpcInternal.bind(this),this.setInput=this.setInput.bind(this),this.setInputs=this.setInputs.bind(this),this.setMetapage=this.setMetapage.bind(this),this.setOutput=this.setOutput.bind(this),this.setOutputs=this.setOutputs.bind(this),this.setPlugin=this.setPlugin.bind(this),this.addListenerReturnDisposer=this.addListenerReturnDisposer.bind(this),this.isDisposed=this.isDisposed.bind(this)}addListenerReturnDisposer(l,h){return super.addListener(l,h),()=>{super.removeListener(l,h)}}setPlugin(){if(this._loaded)throw"Cannot setPlugin after MetapageIFrameRpcClient already loaded";return this._plugin=!0,this}setMetapage(l){return this._metapage=l,this}hasPermissionsState(){return this._definition!==void 0&&this._definition.inputs!==void 0&&this._definition.inputs[oa]!==void 0}hasPermissionsDefinition(){return this._definition!==void 0&&this._definition.inputs!==void 0&&this._definition.inputs[Yi]!==void 0}getDefinitionUrl(){var l=new URL(this.url);return l.pathname=l.pathname+(l.pathname.endsWith("/")?"metaframe.json":"/metaframe.json"),l.href}getDefinition(){return xx(this,void 0,void 0,function*(){if(this._definition)return this._definition;var l=this.getDefinitionUrl();try{const h=yield window.fetch(l);if(h.ok){const s=yield h.json();return this._definition=s,this._definition}else this.emit(qt.Error,`Failed to fetch: ${l}
Status: ${h.status}
Status text: ${h.statusText}`)}catch(h){this.emit(qt.Error,`Failed to fetch: ${l}
Error: ${h}`)}})}setInput(l,h){console.assert(!!l);var s={};s[l]=h,this.setInputs(s)}setInputs(l){if(this.log({m:"MetapageIFrameRpcClient",inputs:l}),!pd(this.inputs,l))return this;if(this._loaded||(this._sendInputsAfterRegistration=!0),this._iframe.parentNode&&this._loaded&&this.sendInputs(l),this.emit(qt.Inputs,this.inputs),this._metapage.listenerCount(qt.Inputs)>0){var h={};h[this.id]=l,this._metapage.emit(qt.Inputs,h)}return this}setOutput(l,h){console.assert(!!l);var s={};s[l]=h,this.setOutputs(s)}setOutputs(l){if(!!pd(this.outputs,l)&&(this.emit(qt.Outputs,l),this._metapage.listenerCount(qt.Outputs)>0)){var h={};h[this.id]=this.outputs,this._metapage.emit(qt.Outputs,h)}}onInputs(l){return this.addListenerReturnDisposer(qt.Inputs,l)}onInput(l,h){var s=function(c){c.hasOwnProperty(l)&&h(c[l])};return this.addListenerReturnDisposer(qt.Inputs,s)}onOutputs(l){return this.addListenerReturnDisposer(qt.Outputs,l)}onOutput(l,h){var s=function(c){c.hasOwnProperty(l)&&h(c[l])};return this.addListenerReturnDisposer(qt.Outputs,s)}isDisposed(){return this.inputs===void 0}dispose(){for(super.removeAllListeners();this._disposables&&this._disposables.length>0;){const l=this._disposables.pop();l&&l()}this._rpcListeners=void 0,this.inputs=void 0,this.outputs=void 0,this._iframe&&this._iframe.parentNode&&this._iframe.parentNode.removeChild(this._iframe),this._iframe=void 0,this._bufferMessages=void 0,this._bufferTimeout&&(window.clearInterval(this._bufferTimeout),this._bufferTimeout=void 0),this._metapage=void 0}register(){var l={iframeId:this.id,parentId:this._parentId,plugin:this._plugin,state:{inputs:this.inputs},version:yx};this.sendRpcInternal(vo.SetupIframeServerResponse,l)}registered(l){if(this.log({m:"MetapageIFrameRpcClient.registered",inputs:this.inputs}),!this._loaded){if(!l)throw"Cannot register without a version";for(this.version=l,this._loaded=!0;this._onLoaded&&this._onLoaded.length>0;)this._onLoaded.pop()();this._sendInputsAfterRegistration&&this.sendInputs(this.inputs)}}sendInputs(l){this.sendRpc(vo.InputsUpdate,{inputs:l,parentId:this._parentId})}sendRpc(l,h){if(this._iframe.parentNode&&this._loaded)this.sendRpcInternal(l,h);else{this._metapage.error("sending rpc later");const s=this;this._onLoaded.push(()=>{s.sendRpcInternal(l,h)})}}ack(l){if(this.log("\u2692 \u2692 \u2692 calling ack"),this._debug){this.log("\u2692 \u2692 \u2692 sending ack from client to frame");var h={message:l};this.sendRpc(vo.MessageAck,h)}else this.log("\u2692 \u2692 \u2692 NOT sending ack from client to frame since not debug mode")}log(l){!this._debug||this.logInternal(l)}logInternal(l){let h;typeof l=="string"?h=l:typeof l=="string"?h=l+"":h=JSON.stringify(l),F_(`Metapage[${this._parentId}] Metaframe[${this.id}] ${h}`,this._color,this._consoleBackgroundColor)}sendRpcInternal(l,h){const s={id:"_",iframeId:this.id,jsonrpc:"2.0",method:l,params:h,parentId:this._parentId};this._iframe?this.sendOrBufferPostMessage(s):this._metapage.error(`Cannot send to child iframe messageJSON=${JSON.stringify(s).substr(0,200)}`)}sendOrBufferPostMessage(l){if(this._iframe&&this._iframe.contentWindow)this._iframe.contentWindow.postMessage(l,this.url);else if(this._bufferMessages)this._bufferMessages.push(l);else{this._bufferMessages=[l];const h=this;this._bufferTimeout=window.setInterval(function(){h._iframe&&h._iframe.contentWindow&&(h._bufferMessages.forEach(s=>h._iframe.contentWindow.postMessage(s,h.url)),window.clearInterval(h._bufferTimeout),h._bufferTimeout=void 0,h._bufferMessages=void 0)},0)}}}var tB=globalThis&&globalThis.__awaiter||function(a,l,h,s){function c(E){return E instanceof h?E:new h(function(m){m(E)})}return new(h||(h=Promise))(function(E,m){function S(C){try{M(s.next(C))}catch(I){m(I)}}function d(C){try{M(s.throw(C))}catch(I){m(I)}}function M(C){C.done?E(C.value):c(C.value).then(S,d)}M((s=s.apply(a,l||[])).next())})},Px;(function(a){a.all="all",a.delta="delta"})(Px||(Px={}));const Cx=()=>({metaframes:{inputs:{},outputs:{}},plugins:{inputs:{},outputs:{}}}),nB="bcbcbc";class Ii extends XF{constructor(l){super();this._state=Cx(),this._metaframes={},this._plugins={},this._pluginOrder=[],this.debug=N_(),this._internalReceivedMessageCounter=0,this._cachedInputLookupMap={},this._inputMap={},this._id=l&&l.id?l.id:ZF(),this._consoleBackgroundColor=l&&l.color?l.color:nB,this.addPipe=this.addPipe.bind(this),this.dispose=this.dispose.bind(this),this.addMetaframe=this.addMetaframe.bind(this),this.addPlugin=this.addPlugin.bind(this),this.getInputsFromOutput=this.getInputsFromOutput.bind(this),this.getMetaframe=this.getMetaframe.bind(this),this.getMetaframeIds=this.getMetaframeIds.bind(this),this.getMetaframeOrPlugin=this.getMetaframeOrPlugin.bind(this),this.getMetaframes=this.getMetaframes.bind(this),this.getPlugin=this.getPlugin.bind(this),this.getPluginIds=this.getPluginIds.bind(this),this.getState=this.getState.bind(this),this.getStateMetaframes=this.getStateMetaframes.bind(this),this.isValidJSONRpcMessage=this.isValidJSONRpcMessage.bind(this),this.log=this.log.bind(this),this.logInternal=this.logInternal.bind(this),this.metaframeIds=this.metaframeIds.bind(this),this.metaframes=this.metaframes.bind(this),this.onMessage=this.onMessage.bind(this),this.pluginIds=this.pluginIds.bind(this),this.plugins=this.plugins.bind(this),this.removeAll=this.removeAll.bind(this),this.removeMetaframe=this.removeMetaframe.bind(this),this.removePlugin=this.removePlugin.bind(this),this.setDebugFromUrlParams=this.setDebugFromUrlParams.bind(this),this.setDefinition=this.setDefinition.bind(this),this.setInput=this.setInput.bind(this),this.setInputs=this.setInputs.bind(this),this.setInputStateOnly=this.setInputStateOnly.bind(this),this.setMetaframeClientInputAndSentClientEvent=this.setMetaframeClientInputAndSentClientEvent.bind(this),this.setOutputStateOnly=this.setOutputStateOnly.bind(this),this.setState=this.setState.bind(this),this.updatePluginsWithDefinition=this.updatePluginsWithDefinition.bind(this),this._emitDefinitionEvent=this._emitDefinitionEvent.bind(this),U_().then(()=>{window.addEventListener("message",this.onMessage),this.log("Initialized")})}static from(l,h){if(l==null)throw"Metapage definition cannot be null";if(typeof l=="string")try{l=JSON.parse(l)}catch(c){throw"Cannot parse into JSON:\n${metaPageDef}"}var s=new Ii;return s.setDefinition(l)}addListenerReturnDisposer(l,h){return super.addListener(l,h),()=>{super.removeListener(l,h)}}setDebugFromUrlParams(){return this.debug=qF(["MP_DEBUG","DEBUG","debug","mp_debug"]),this}getState(){return this._state}setState(l){this._state=l,this.getMetaframeIds().forEach(h=>{this.getMetaframe(h).setInputs(this._state.metaframes.inputs[h]),this.getMetaframe(h).setOutputs(this._state.metaframes.outputs[h])}),this.getPluginIds().forEach(h=>{this.getPlugin(h).setInputs(this._state.plugins.inputs[h]),this.getPlugin(h).setOutputs(this._state.plugins.outputs[h])}),this.emit(qt.State,this._state)}getStateMetaframes(){return this._state.metaframes}getDefinition(){return this._definition}setDefinition(l,h){const s=Tx(l);return s.metaframes&&Object.keys(s.metaframes).forEach(c=>{if(s.plugins&&s.plugins.includes(c))throw this.emitErrorMessage(`Plugin with url=${c} matches metaframe. Metaframe ids and plugin urls are not allowed to collide`),`Plugin with url=${c} matches metaframe. Metaframe ids and plugin urls are not allowed to collide`;var E=s.metaframes[c];if(typeof E!="object")throw this.emitErrorMessage(`Metaframe "${c}" is not an object`),`Metaframe "${c}" is not an object`;if(!E.url)throw this.emitErrorMessage(`Metaframe "${c}" missing field: url`),`Metaframe "${c}" missing field: url`}),this._definition=s,Object.keys(this._metaframes).forEach(c=>{(!s.metaframes||!s.metaframes[c])&&this.removeMetaframe(c)}),Object.keys(this._plugins).forEach(c=>{s.plugins&&!s.plugins.includes(c)&&this.removePlugin(c)}),this._pluginOrder=s.plugins?s.plugins:[],h&&(this._state=h),s.metaframes&&Object.keys(s.metaframes).forEach(c=>{if(!this._metaframes.hasOwnProperty(c)){const E=s.metaframes[c];this.addMetaframe(c,E)}}),s.plugins&&s.plugins.forEach(c=>{this._plugins.hasOwnProperty(c)||this.addPlugin(c)}),window.setTimeout(()=>{this._emitDefinitionEvent(),h&&this.emit(qt.State,this._state)},0),this}_emitDefinitionEvent(){const l={definition:this._definition,metaframes:this._metaframes,plugins:this._plugins};this.emit(qt.Definition,l)}addPipe(l,h){this._inputMap[l]||(this._inputMap[l]=[]),this._inputMap[l].push(h)}removeMetaframe(l){!this._metaframes[l]||(this._metaframes[l].dispose(),delete this._metaframes[l],delete this._state.metaframes.inputs[l],delete this._state.metaframes.outputs[l],delete this._inputMap[l],Object.keys(this._inputMap).forEach(h=>{var s;const c=this._inputMap[h];let E=0;for(;E<=c.length;)((s=c[E])===null||s===void 0?void 0:s.metaframe)===l?c.splice(E,1):E++}),this._cachedInputLookupMap={})}removePlugin(l){!this._plugins[l]||(this._plugins[l].dispose(),delete this._plugins[l],delete this._state.plugins.inputs[l],delete this._state.plugins.outputs[l])}removeAll(){Object.keys(this._metaframes).forEach(l=>this._metaframes[l].dispose()),Object.keys(this._plugins).forEach(l=>this._plugins[l].dispose()),this._metaframes={},this._plugins={},this._state=Cx(),this._inputMap={},this._cachedInputLookupMap={}}metaframes(){return this.getMetaframes()}metaframeIds(){return this.getMetaframeIds()}getMetaframeIds(){return Object.keys(this._metaframes)}getMetaframes(){return Object.assign({},this._metaframes)}plugins(){return Object.assign({},this._plugins)}pluginIds(){return this.getPluginIds()}getPluginIds(){return this._pluginOrder.slice(0)}getMetaframe(l){return this._metaframes[l]}getPlugin(l){return this._plugins[l]}addMetaframe(l,h){if(!l)throw"addMetaframe missing metaframeId";if(!h)throw"addMetaframe missing definition";if(this._metaframes[l])throw this.emitErrorMessage(`Existing metaframe for id=${l}`),`Existing metaframe for id=${l}`;if(!h.url)throw this.emitErrorMessage(`Metaframe definition missing url id=${l}`),`Metaframe definition missing url id=${l}`;var s=new Ax(this,h.url,l,this._id,this._consoleBackgroundColor,this.debug).setMetapage(this);return this._metaframes[l]=s,s.addListener(qt.Error,c=>{this.emit(qt.Error,{metaframeId:s.id,metaframeUrl:s.url,error:c})}),h.inputs&&h.inputs.forEach(c=>this.addPipe(l,c)),s.setInputs(this._state.metaframes.inputs[l]),s}addPlugin(l){if(!l)throw"Plugin missing url";const h=new Ax(this,l,l,this._id,this._consoleBackgroundColor,this.debug).setInputs(this._state.plugins.inputs[l]).setMetapage(this).setPlugin();return rB(this,h),this._plugins[l]=h,h}dispose(){super.removeAllListeners(),window.removeEventListener("message",this.onMessage),this._metaframes&&Object.keys(this._metaframes).forEach(l=>this._metaframes[l].dispose()),this._plugins&&Object.keys(this._plugins).forEach(l=>this._plugins[l].dispose()),this._id=void 0,this._metaframes=void 0,this._plugins=void 0,this._state=void 0,this._cachedInputLookupMap=void 0,this._inputMap=void 0}log(l,h,s){!this.debug||this.logInternal(l,h,s)}error(l){this.logInternal(l,"f00",this._consoleBackgroundColor),this.emitErrorMessage(`${l}`)}emitErrorMessage(l){this.emit(qt.Error,l)}getInputsFromOutput(l,h){if(this._cachedInputLookupMap[l]||(this._cachedInputLookupMap[l]={}),!this._cachedInputLookupMap[l][h]){var s=[];this._cachedInputLookupMap[l][h]=s,Object.keys(this._inputMap).forEach(c=>{c!==l&&this._inputMap[c].forEach(E=>{if(E.metaframe==l&&IF(h,E.source)){var m=E.target;(!E.target||E.target.startsWith("*")||E.target==="")&&(m=h),s.push({metaframe:c,pipe:m})}})})}return this._cachedInputLookupMap[l][h]}isValidJSONRpcMessage(l){if(l.jsonrpc!=="2.0")return!1;switch(l.method){case Br.SetupIframeClientRequest:return!0;default:var s=l.iframeId;return!(s&&!(l.parentId===this._id&&(this._metaframes[s]||this._plugins[s])))}}setInput(l,h,s){this.setInputStateOnly(l,h,s),this.setMetaframeClientInputAndSentClientEvent(l,h,s),this.emit(qt.State,this._state),this.emit(qt.Inputs,this._state)}setMetaframeClientInputAndSentClientEvent(l,h,s){if(typeof l=="object"){if(h||s)throw"bad arguments, see API docs";const c=l;Object.keys(c).forEach(E=>{var m=E,S=c[m];if(typeof S!="object")throw"bad arguments, see API docs";var d=this._metaframes[m];d?d.setInputs(S):this.error("No iframe id=$metaframeId")})}else if(typeof l=="string"){const c=this._metaframes[l];if(c==null&&this.error(`No iframe id=${l}`),typeof h=="string")c.setInput(h,s);else if(typeof h=="object")c.setInputs(h);else throw"bad arguments, see API docs"}else throw"bad arguments, see API docs"}setInputs(l,h,s){this.setInput(l,h,s)}setOutputStateOnly(l,h,s){this._setStateOnly(!1,l,h,s)}setInputStateOnly(l,h,s){this._setStateOnly(!0,l,h,s)}_setStateOnly(l,h,s,c){if(typeof h=="object"){if(s||c)throw"If first argument is an object, subsequent args should be undefined";const E=h;Object.keys(E).forEach(m=>{var S=E[m];if(typeof S!="object")throw"Object values must be objects";const d=this._metaframes.hasOwnProperty(m);if(!d&&!this._plugins.hasOwnProperty(m))throw"No metaframe or plugin: ${metaframeId}";const M=d?l?this._state.metaframes.inputs:this._state.metaframes.outputs:l?this._state.plugins.inputs:this._state.plugins.outputs;M[m]=M[m]?M[m]:{},Object.keys(S).forEach(C=>{S[C]===void 0?delete M[m][C]:M[m][C]=S[C]})})}else if(typeof h=="string"){const E=h,m=this._metaframes.hasOwnProperty(E);if(!m&&!this._plugins.hasOwnProperty(E))throw`No metaframe or plugin: ${E}`;const S=m?l?this._state.metaframes.inputs:this._state.metaframes.outputs:l?this._state.plugins.inputs:this._state.plugins.outputs;if(typeof s=="string"){S[E]=S[E]?S[E]:{};const d=s;c===void 0?delete S[E][d]:S[E][d]=c}else if(typeof s=="object"){S[E]=S[E]?S[E]:{};const d=s;Object.keys(d).forEach(M=>{d[M]===void 0?delete S[E][M]:S[E][M]=d[M]})}else throw"Second argument must be a string or an object"}else throw"First argument must be a string or an object"}getMetaframeOrPlugin(l){var h=this._metaframes[l];return h||(h=this._plugins[l]),h}onMessage(l){if(typeof l.data=="object"){const m=l.data;if(!this.isValidJSONRpcMessage(m))return;var h=m.method;const S=m.iframeId;if(!S)return;const d=this.getMetaframeOrPlugin(S),M=this._plugins[S];switch(m._messageCount=++this._internalReceivedMessageCounter,this.debug&&this.log(`processing ${JSON.stringify(m,null,"  ").substr(0,500)}`),h){case Br.SetupIframeClientRequest:d&&d.register();break;case Br.SetupIframeServerResponseAck:if(d){const I=m.params;d.registered(I.version)}break;case Br.OutputsUpdate:const C=m.params;if(this._metaframes[S]){var s=this._metaframes[S];this.setOutputStateOnly(S,C),s.setOutputs(C),this.emit(qt.State,this._state);var c=!1;const I=Object.keys(C),b={};I.forEach((p,x)=>{const P=this.getInputsFromOutput(S,p);P.length>0&&P.forEach(A=>{b[A.metaframe]||(b[A.metaframe]={}),b[A.metaframe][A.pipe]=C[p],this.setInputStateOnly(A.metaframe,A.pipe,C[p]),c=!0})}),Object.keys(b).forEach(p=>{this._metaframes[p].setInputs(b[p])}),c&&this.emit(qt.State,this._state),this.debug&&s.ack({jsonrpc:m,state:this._state})}else if(this._plugins[S]){const I=!C[oa]&&!C[Yi];I&&this.setOutputStateOnly(S,C),this._plugins[S].setOutputs(C),I&&this.emit(qt.State,this._state),this.debug&&this._plugins[S].ack({jsonrpc:m,state:this._state})}else this.error("missing metaframe/plugin=$metaframeId");break;case Br.InputsUpdate:var E=m.params;if(this.debug&&this.log(`inputs ${JSON.stringify(E)} from ${S}`),this._metaframes[S])this.setInputStateOnly(S,E),this._metaframes[S].setInputs(E),this.emit(qt.State,this._state),this.debug&&this._metaframes[S].ack({jsonrpc:m,state:this._state});else if(this._plugins[S]){const I=!E[oa]&&!E[Yi];I&&this.setInputStateOnly(S,E),this._plugins[S].setInputs(E),I&&this.emit(qt.State,this._state),this.debug&&this._plugins[S].ack({jsonrpc:m,state:this._state})}else console.error(`InputsUpdate failed no metaframe or plugin id: "${S}"`),this.error(`InputsUpdate failed no metaframe or plugin id: "${S}"`);break;case Br.PluginRequest:M&&d&&d.hasPermissionsState()&&(d.setInput(oa,this._state),this.debug&&d.ack({jsonrpc:m,state:this._state}));break;case Br.HashParamsUpdate:if(!M&&d){const I=m.params,b=new URL(d.url);b.hash=I.hash,d.url=b.href,this._definition.metaframes[I.metaframe].url=b.href,this.emit(qt.UrlHashUpdate,m.params),this._emitDefinitionEvent()}break;default:this.debug&&this.log(`Unknown RPC method: "${h}"`)}this.emit(qt.Message,m)}}updatePluginsWithDefinition(){this.getDefinition(),Object.values(this._plugins).forEach(l=>{l.hasPermissionsDefinition()&&iB(l)})}logInternal(l,h,s){s=s||this._consoleBackgroundColor;let c;typeof l=="string"?c=l:typeof l=="number"?c=l+"":c=JSON.stringify(l),c=this._id?`Metapage[${this._id}] ${c}`:c,F_(c,h,s)}}Ii.version=yx;Ii.DEFINITION=qt.Definition;Ii.DEFINITION_UPDATE_REQUEST=qt.DefinitionUpdateRequest;Ii.ERROR=qt.Error;Ii.INPUTS=qt.Inputs;Ii.MESSAGE=qt.Message;Ii.OUTPUTS=qt.Outputs;Ii.STATE=qt.State;Ii.URL_HASH_UPDATE=qt.UrlHashUpdate;const rB=(a,l)=>tB(void 0,void 0,void 0,function*(){try{const c=yield l.getDefinition();if(!c)throw`${l.url}`;if(l.isDisposed())return;if(l.hasPermissionsDefinition()){var h=a.addListenerReturnDisposer(qt.Definition,E=>{l.setInput(Yi,E.definition)});l._disposables.push(h);var s=a.getDefinition();if(s&&(l.setInput(Yi,s),c.outputs)){var h=l.onOutput(Yi,m=>{a.emit(qt.DefinitionUpdateRequest,m)});l._disposables.push(h)}}if(l.hasPermissionsState()&&c.outputs){var h=l.onOutput(oa,m=>{a.setState(m)});l._disposables.push(h)}}catch(c){console.error(c),a.emit(qt.Error,`Failed to get plugin definition from "${l.getDefinitionUrl()}", error=${c}`)}}),iB=a=>{const l=a._metapage.getDefinition();a.setInput(Yi,l)};var oB=globalThis&&globalThis.__awaiter||function(a,l,h,s){function c(E){return E instanceof h?E:new h(function(m){m(E)})}return new(h||(h=Promise))(function(E,m){function S(C){try{M(s.next(C))}catch(I){m(I)}}function d(C){try{M(s.throw(C))}catch(I){m(I)}}function M(C){C.done?E(C.value):c(C.value).then(S,d)}M((s=s.apply(a,l||[])).next())})},aa;(function(a){a.WaitingForPageLoad="WaitingForPageLoad",a.SentSetupIframeClientRequest="SentSetupIframeClientRequest",a.Ready="Ready"})(aa||(aa={}));var _r;(function(a){a.Connected="connected",a.Error="error",a.Input="input",a.Inputs="inputs",a.Message="message"})(_r||(_r={}));class gi extends dd.exports.EventEmitter{constructor(l){super();if(this._inputPipeValues={},this._outputPipeValues={},this._state=aa.WaitingForPageLoad,this._messageSendCount=0,this.debug=N_(),this.id=window.name,this.debug=N_(),this._isIframe=WF(),this.addListener=this.addListener.bind(this),this.dispose=this.dispose.bind(this),this.error=this.error.bind(this),this.getInput=this.getInput.bind(this),this.getInputs=this.getInputs.bind(this),this.getOutput=this.getOutput.bind(this),this.getOutputs=this.getOutputs.bind(this),this.log=this.log.bind(this),this.logInternal=this.logInternal.bind(this),this.onInput=this.onInput.bind(this),this.onInputs=this.onInputs.bind(this),this.onMessage=this.onMessage.bind(this),this.sendRpc=this.sendRpc.bind(this),this.setInput=this.setInput.bind(this),this.setInputs=this.setInputs.bind(this),this.setInternalInputsAndNotify=this.setInternalInputsAndNotify.bind(this),this.setOutput=this.setOutput.bind(this),this.setOutputs=this.setOutputs.bind(this),this.warn=this.warn.bind(this),this._resolveSetupIframeServerResponse=this._resolveSetupIframeServerResponse.bind(this),this.addListenerReturnDisposer=this.addListenerReturnDisposer.bind(this),this.connected=this.connected.bind(this),this.disableNotifyOnHashUrlChange=this.disableNotifyOnHashUrlChange.bind(this),this._onHashUrlChange=this._onHashUrlChange.bind(this),!this._isIframe){this.log("Not an iframe, metaframe code disabled");return}const h=this;U_().then(()=>{this.log("pageLoaded"),window.addEventListener("message",this.onMessage),h.sendRpc(Br.SetupIframeClientRequest,{version:gi.version}),h._state=aa.SentSetupIframeClientRequest}),(l==null?void 0:l.disableHashChangeEvent)||window.addEventListener("hashchange",this._onHashUrlChange)}_resolveSetupIframeServerResponse(l){if(this._state===aa.WaitingForPageLoad)throw"Got message but page has not finished loading, we should never get in this state";this._parentId?this.log("Got JsonRpcMethods.SetupIframeServerResponse but already resolved"):(this._parentVersion=l.version,this.color=Sx(this.id),this._parentId=l.parentId,this.log(`metapage[${this._parentId}](v${this._parentVersion?this._parentVersion:"unknown"}) registered`),this._inputPipeValues=l.state&&l.state.inputs?l.state.inputs:this._inputPipeValues,this._state=aa.Ready,this.sendRpc(Br.SetupIframeServerResponseAck,{version:gi.version}),this._inputPipeValues&&Object.keys(this._inputPipeValues).length>0&&(this.emit(_r.Inputs,this._inputPipeValues),Object.keys(this._inputPipeValues).forEach(h=>this.emit(_r.Input,h,this._inputPipeValues[h]))),this.emit(_r.Inputs,this._inputPipeValues),l.plugin&&(this.plugin=new aB(this)),this.emit(_r.Connected))}connected(){return oB(this,void 0,void 0,function*(){if(this._state!==aa.Ready)return new Promise((l,h)=>{let s;s=this.addListenerReturnDisposer(_r.Connected,()=>{l(),s()})})})}addListenerReturnDisposer(l,h){return super.addListener(l,h),()=>{super.removeListener(l,h)}}log(l,h,s){!this.debug||this.logInternal(l,h||this.color)}warn(l){!this.debug||this.logInternal(l,"000",this.color)}error(l){this.logInternal(l,this.color,"f00")}logInternal(l,h,s){let c;typeof l=="string"?c=l:typeof l=="number"?c=l+"":c=JSON.stringify(l),h=h&&h+"",c=(this.id?`Metaframe[${this.id}] `:"")+`${c}`,F_(c,h,s)}dispose(){super.removeAllListeners(),window.removeEventListener("message",this.onMessage),this.disableNotifyOnHashUrlChange(),this._inputPipeValues=void 0,this._outputPipeValues=void 0}addListener(l,h){return super.addListener(l,h),l===_r.Inputs&&window.setTimeout(()=>{this._inputPipeValues&&h(this._inputPipeValues)},0),this}onInput(l,h){return this.addListenerReturnDisposer(_r.Input,(s,c)=>{l===s&&h(c)})}onInputs(l){return this.addListenerReturnDisposer(_r.Inputs,l)}setInput(l,h){var s={};s[l]=h,this.setInputs(s)}setInputs(l){this.sendRpc(Br.InputsUpdate,l)}setInternalInputsAndNotify(l){!pd(this._inputPipeValues,l)||(Object.keys(l).forEach(h=>this.emit(_r.Input,h,l[h])),this.emit(_r.Inputs,l))}getInput(l){return console.assert(!!l),this._inputPipeValues[l]}getInputs(){return this._inputPipeValues}getOutput(l){return console.assert(!!l),this._outputPipeValues[l]}setOutput(l,h){console.assert(!!l);var s={};s[l]=h,this.setOutputs(s)}setOutputs(l){!pd(this._outputPipeValues,l)||this.sendRpc(Br.OutputsUpdate,l)}getOutputs(){return this._outputPipeValues}disableNotifyOnHashUrlChange(){window.removeEventListener("hashchange",this._onHashUrlChange)}_onHashUrlChange(l){const h={hash:window.location.hash,metaframe:this.id};this.sendRpc(Br.HashParamsUpdate,h)}sendRpc(l,h){if(this._isIframe){const s={jsonrpc:"2.0",id:++this._messageSendCount,method:l,params:h,iframeId:this.id,parentId:this._parentId};window.parent.postMessage(s,"*")}else this.log("Cannot send JSON-RPC window message: there is no window.parent which means we are not an iframe")}onMessage(l){if(typeof l.data=="object"){let s=l.data;if(s.jsonrpc==="2.0"){var h=s.method;if(!(h==vo.SetupIframeServerResponse||s.parentId==this._parentId&&s.iframeId==this.id)){this.error(`window.message: received message but jsonrpc.parentId=${s.parentId} _parentId=${this._parentId} jsonrpc.iframeId=${s.iframeId} id=${this.id}`);return}switch(h){case vo.SetupIframeServerResponse:this._resolveSetupIframeServerResponse(s.params);break;case vo.InputsUpdate:if(this._state!==aa.Ready)throw"Got InputsUpdate but metaframe is not MetaframeLoadingState.Ready";this.setInternalInputsAndNotify(s.params.inputs);break;case vo.MessageAck:this.debug&&this.log(`ACK: ${JSON.stringify(s)}`);break;default:this.debug&&this.log(`window.message: unknown JSON-RPC method: ${JSON.stringify(s)}`);break}this.emit(_r.Message,s)}}}}gi.version=HF;gi.ERROR=_r.Error;gi.CONNECTED=_r.Connected;gi.INPUT=_r.Input;gi.INPUTS=_r.Inputs;gi.MESSAGE=_r.Message;class aB{constructor(l){this._metaframe=l,this.requestState=this.requestState.bind(this),this.onState=this.onState.bind(this),this.getState=this.getState.bind(this),this.setState=this.setState.bind(this),this.onDefinition=this.onDefinition.bind(this),this.getDefinition=this.getDefinition.bind(this),this.setDefinition=this.setDefinition.bind(this)}requestState(){var l={method:L_.State};this._metaframe.sendRpc(Br.PluginRequest,l)}onState(l){const h=this._metaframe.onInput(oa,l);return this.getState()&&l(this.getState()),h}getState(){return this._metaframe.getInput(oa)}setState(l){this._metaframe.setOutput(oa,l)}onDefinition(l){var h=this._metaframe.onInput(Yi,l);return this.getDefinition()&&l(this.getDefinition()),h}setDefinition(l){this._metaframe.setOutput(Yi,l)}getDefinition(){return this._metaframe.getInput(Yi)}}var sB=function(a,l){l||(l={}),typeof l=="function"&&(l={cmp:l});var h=typeof l.cycles=="boolean"?l.cycles:!1,s=l.cmp&&function(E){return function(m){return function(S,d){var M={key:S,value:m[S]},C={key:d,value:m[d]};return E(M,C)}}}(l.cmp),c=[];return function E(m){if(m&&m.toJSON&&typeof m.toJSON=="function"&&(m=m.toJSON()),m!==void 0){if(typeof m=="number")return isFinite(m)?""+m:"null";if(typeof m!="object")return JSON.stringify(m);var S,d;if(Array.isArray(m)){for(d="[",S=0;S<m.length;S++)S&&(d+=","),d+=E(m[S])||"null";return d+"]"}if(m===null)return"null";if(c.indexOf(m)!==-1){if(h)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var M=c.push(m)-1,C=Object.keys(m).sort(s&&s(m));for(d="",S=0;S<C.length;S++){var I=C[S],b=E(m[I]);!b||(d&&(d+=","),d+=JSON.stringify(I)+":"+b)}return c.splice(M,1),"{"+d+"}"}}(a)};const cB=()=>{try{return window!==window.top}catch(a){return!1}},V_=a=>btoa(sB(a)),k_=a=>{if(a&&a.length>0)return JSON.parse(atob(a))},md=()=>j_(window.location.href),j_=a=>{let l=new URL(a).hash.substr(1);const h=l.indexOf("?");if(h===-1)return[l,{}];const s=l.substr(0,h);l=l.substr(h+1);const c=Object.fromEntries(l.split("&").filter(E=>E.length>0).map(E=>E.split("=")));return Object.keys(c).forEach(E=>c[E]=decodeURI(c[E])),[s,c]},Rx=(a,l)=>{const[h,s]=j_(a);return s[l]},lB=(a,l)=>{const h=Rx(a,l);if(h&&h!=="")return JSON.parse(atob(h))},Ox=(a,l,h)=>{const s=md()[1];let c=!1;if(s.hasOwnProperty(a)&&l===null||l===void 0?(delete s[a],c=!0):s[a]!==l&&(s[a]=l,c=!0),!c)return[];const E=Object.keys(s);E.sort();const m=E.map((I,b)=>`${I}=${encodeURI(s[I])}`).join("&");let S=window.location.hash.substr(1);const d=S.indexOf("?");let M="";d>-1&&(M=S.substr(0,d));const C=new URL(window.location.href);C.hash=`${M}?${m}`,(h==null?void 0:h.modifyHistory)?window.location.hash=`${M}?${m}`:(window.history.replaceState(null,document.title,`${C.pathname}${C.search}${C.hash}`),window.dispatchEvent(new HashChangeEvent("hashchange")))},$s=(a,l)=>{const[h,s]=un(md()[1][a]||l);Vt(()=>{const E=m=>{const S=md()[1];s(S[a])};return window.addEventListener("hashchange",E),()=>window.removeEventListener("hashchange",E)},[]);const c=Gt((E,m)=>{Ox(a,E,m)},[]);return[h,c]},uB=(a,l)=>{const[h,s]=$s(a,l?z_(l):void 0),[c,E]=un(l);Vt(()=>{E(Mx(h))},[a,h,E]);const m=Gt((S,d)=>{if(S==null)s(void 0,d);else{const M=z_(S);s(M,d)}},[s]);return[c,m]},z_=a=>btoa(a),Mx=a=>{if(a&&a.length>0)return atob(a)},hB=(a,l)=>{const[h,s]=$s(a,l?`${l}`:void 0),[c,E]=un(h==="true");Vt(()=>{E(h==="true")},[a,h,E]);const m=Gt((S,d)=>{S==null||S===!1?s(void 0,d):s("true",d)},[s]);return[c,m]},dB=(a,l)=>{const[h,s]=$s(a,l?l.toString():void 0),[c,E]=un(h?parseFloat(h):void 0);Vt(()=>{E(h?parseFloat(h):void 0)},[a,h,E]);const m=Gt((S,d)=>{s(S?S.toString():void 0,d)},[s]);return[c,m]},fB=(a,l)=>{const[h,s]=$s(a,l?l.toString():void 0),[c,E]=un(h?parseInt(h):void 0);Vt(()=>{E(h?parseInt(h):void 0)},[a,h,E]);const m=Gt((S,d)=>{s(S?S.toString():void 0,d)},[s]);return[c,m]},pB=(a,l)=>{const[h,s]=$s(a,l?V_(l):void 0),[c,E]=un(k_(h));Vt(()=>{E(k_(h))},[a,h,E]);const m=Gt((S,d)=>{if(S==null)s(void 0,d);else{const M=V_(S);s(M,d)}},[s]);return[c,m]},mB={inputs:{}},_B={},G_=Sr(_B),H_=Sr(mB),gB=()=>cn(G_),vB=()=>cn(H_),bB=a=>{const[l,h]=un({inputs:{}}),[s,c]=un(void 0),[E,m]=un(l.inputs);return Vt(()=>{const S=new gi,d=M=>{m(M)};return S.onInputs(d),c(S),()=>{S.removeListener(gi.INPUTS,d),S.dispose()}},[c,m]),Vt(()=>{E&&s&&h({metaframe:s,inputs:E,setOutputs:s.setOutputs})},[E,s]),ei.createElement(H_.Provider,{value:l},a.children)},yB=a=>{const[l,h]=un({}),[s,c]=un(void 0);return Vt(()=>{const E=new gi;return c(E),()=>{E.dispose()}},[c]),Vt(()=>{s&&h({metaframe:s})},[s]),ei.createElement(G_.Provider,{value:l},a.children)};var oq=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",MetaframeAndInputsContext:H_,MetaframeContext:G_,WithMetaframe:yB,WithMetaframeAndInputs:bB,blobFromBase64String:k_,blobToBase64String:V_,getHashParamObject:lB,getHashParamValue:Rx,getHashParams:md,getUrlHashParams:j_,isIframe:cB,setHashParam:Ox,stringFromBase64String:Mx,stringToBase64String:z_,useHashParam:$s,useHashParamBase64:uB,useHashParamBoolean:hB,useHashParamFloat:dB,useHashParamInt:fB,useHashParamJson:pB,useMetaframe:gB,useMetaframeAndInput:vB});function TB(a){if(a.sheet)return a.sheet;for(var l=0;l<document.styleSheets.length;l++)if(document.styleSheets[l].ownerNode===a)return document.styleSheets[l]}function EB(a){var l=document.createElement("style");return l.setAttribute("data-emotion",a.key),a.nonce!==void 0&&l.setAttribute("nonce",a.nonce),l.appendChild(document.createTextNode("")),l.setAttribute("data-s",""),l}var Ix=function(){function a(h){var s=this;this._insertTag=function(c){var E;s.tags.length===0?E=s.prepend?s.container.firstChild:s.before:E=s.tags[s.tags.length-1].nextSibling,s.container.insertBefore(c,E),s.tags.push(c)},this.isSpeedy=h.speedy===void 0?!0:h.speedy,this.tags=[],this.ctr=0,this.nonce=h.nonce,this.key=h.key,this.container=h.container,this.prepend=h.prepend,this.before=null}var l=a.prototype;return l.hydrate=function(s){s.forEach(this._insertTag)},l.insert=function(s){this.ctr%(this.isSpeedy?65e3:1)==0&&this._insertTag(EB(this));var c=this.tags[this.tags.length-1];if(this.isSpeedy){var E=TB(c);try{E.insertRule(s,E.cssRules.length)}catch(m){}}else c.appendChild(document.createTextNode(s));this.ctr++},l.flush=function(){this.tags.forEach(function(s){return s.parentNode.removeChild(s)}),this.tags=[],this.ctr=0},a}(),Rr="-ms-",_d="-moz-",mn="-webkit-",Dx="comm",W_="rule",X_="decl",SB="@import",xB="@keyframes",AB=Math.abs,gd=String.fromCharCode;function PB(a,l){return(((l<<2^Xr(a,0))<<2^Xr(a,1))<<2^Xr(a,2))<<2^Xr(a,3)}function wx(a){return a.trim()}function CB(a,l){return(a=l.exec(a))?a[0]:a}function An(a,l,h){return a.replace(l,h)}function Lx(a,l){return a.indexOf(l)}function Xr(a,l){return a.charCodeAt(l)|0}function Vl(a,l,h){return a.slice(l,h)}function Ki(a){return a.length}function Y_(a){return a.length}function vd(a,l){return l.push(a),a}function RB(a,l){return a.map(l).join("")}var bd=1,Js=1,Nx=0,ti=0,rr=0,ec="";function yd(a,l,h,s,c,E,m){return{value:a,root:l,parent:h,type:s,props:c,children:E,line:bd,column:Js,length:m,return:""}}function kl(a,l,h){return yd(a,l.root,l.parent,h,l.props,l.children,0)}function OB(){return rr}function MB(){return rr=ti>0?Xr(ec,--ti):0,Js--,rr===10&&(Js=1,bd--),rr}function vi(){return rr=ti<Nx?Xr(ec,ti++):0,Js++,rr===10&&(Js=1,bd++),rr}function bo(){return Xr(ec,ti)}function Td(){return ti}function Ed(a,l){return Vl(ec,a,l)}function Sd(a){switch(a){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function Fx(a){return bd=Js=1,Nx=Ki(ec=a),ti=0,[]}function Bx(a){return ec="",a}function K_(a){return wx(Ed(ti-1,Q_(a===91?a+2:a===40?a+1:a)))}function IB(a){for(;(rr=bo())&&rr<33;)vi();return Sd(a)>2||Sd(rr)>3?"":" "}function DB(a,l){for(;--l&&vi()&&!(rr<48||rr>102||rr>57&&rr<65||rr>70&&rr<97););return Ed(a,Td()+(l<6&&bo()==32&&vi()==32))}function Q_(a){for(;vi();)switch(rr){case a:return ti;case 34:case 39:return Q_(a===34||a===39?a:rr);case 40:a===41&&Q_(a);break;case 92:vi();break}return ti}function wB(a,l){for(;vi()&&a+rr!==47+10;)if(a+rr===42+42&&bo()===47)break;return"/*"+Ed(l,ti-1)+"*"+gd(a===47?a:vi())}function Ux(a){for(;!Sd(bo());)vi();return Ed(a,ti)}function LB(a){return Bx(xd("",null,null,null,[""],a=Fx(a),0,[0],a))}function xd(a,l,h,s,c,E,m,S,d){for(var M=0,C=0,I=m,b=0,p=0,x=0,P=1,A=1,T=1,_=0,g="",O=c,R=E,N=s,V=g;A;)switch(x=_,_=vi()){case 34:case 39:case 91:case 40:V+=K_(_);break;case 9:case 10:case 13:case 32:V+=IB(x);break;case 92:V+=DB(Td()-1,7);continue;case 47:switch(bo()){case 42:case 47:vd(NB(wB(vi(),Td()),l,h),d);break;default:V+="/"}break;case 123*P:S[M++]=Ki(V)*T;case 125*P:case 59:case 0:switch(_){case 0:case 125:A=0;case 59+C:p>0&&Ki(V)-I&&vd(p>32?kx(V+";",s,h,I-1):kx(An(V," ","")+";",s,h,I-2),d);break;case 59:V+=";";default:if(vd(N=Vx(V,l,h,M,C,c,S,g,O=[],R=[],I),E),_===123)if(C===0)xd(V,l,N,N,O,E,I,S,R);else switch(b){case 100:case 109:case 115:xd(a,N,N,s&&vd(Vx(a,N,N,0,0,c,S,g,c,O=[],I),R),c,R,I,S,s?O:R);break;default:xd(V,N,N,N,[""],R,I,S,R)}}M=C=p=0,P=T=1,g=V="",I=m;break;case 58:I=1+Ki(V),p=x;default:if(P<1){if(_==123)--P;else if(_==125&&P++==0&&MB()==125)continue}switch(V+=gd(_),_*P){case 38:T=C>0?1:(V+="\f",-1);break;case 44:S[M++]=(Ki(V)-1)*T,T=1;break;case 64:bo()===45&&(V+=K_(vi())),b=bo(),C=Ki(g=V+=Ux(Td())),_++;break;case 45:x===45&&Ki(V)==2&&(P=0)}}return E}function Vx(a,l,h,s,c,E,m,S,d,M,C){for(var I=c-1,b=c===0?E:[""],p=Y_(b),x=0,P=0,A=0;x<s;++x)for(var T=0,_=Vl(a,I+1,I=AB(P=m[x])),g=a;T<p;++T)(g=wx(P>0?b[T]+" "+_:An(_,/&\f/g,b[T])))&&(d[A++]=g);return yd(a,l,h,c===0?W_:S,d,M,C)}function NB(a,l,h){return yd(a,l,h,Dx,gd(OB()),Vl(a,2,-2),0)}function kx(a,l,h,s){return yd(a,l,h,X_,Vl(a,0,s),Vl(a,s+1,-1),s)}function jx(a,l){switch(PB(a,l)){case 5103:return mn+"print-"+a+a;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return mn+a+a;case 5349:case 4246:case 4810:case 6968:case 2756:return mn+a+_d+a+Rr+a+a;case 6828:case 4268:return mn+a+Rr+a+a;case 6165:return mn+a+Rr+"flex-"+a+a;case 5187:return mn+a+An(a,/(\w+).+(:[^]+)/,mn+"box-$1$2"+Rr+"flex-$1$2")+a;case 5443:return mn+a+Rr+"flex-item-"+An(a,/flex-|-self/,"")+a;case 4675:return mn+a+Rr+"flex-line-pack"+An(a,/align-content|flex-|-self/,"")+a;case 5548:return mn+a+Rr+An(a,"shrink","negative")+a;case 5292:return mn+a+Rr+An(a,"basis","preferred-size")+a;case 6060:return mn+"box-"+An(a,"-grow","")+mn+a+Rr+An(a,"grow","positive")+a;case 4554:return mn+An(a,/([^-])(transform)/g,"$1"+mn+"$2")+a;case 6187:return An(An(An(a,/(zoom-|grab)/,mn+"$1"),/(image-set)/,mn+"$1"),a,"")+a;case 5495:case 3959:return An(a,/(image-set\([^]*)/,mn+"$1$`$1");case 4968:return An(An(a,/(.+:)(flex-)?(.*)/,mn+"box-pack:$3"+Rr+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+mn+a+a;case 4095:case 3583:case 4068:case 2532:return An(a,/(.+)-inline(.+)/,mn+"$1$2")+a;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(Ki(a)-1-l>6)switch(Xr(a,l+1)){case 109:if(Xr(a,l+4)!==45)break;case 102:return An(a,/(.+:)(.+)-([^]+)/,"$1"+mn+"$2-$3$1"+_d+(Xr(a,l+3)==108?"$3":"$2-$3"))+a;case 115:return~Lx(a,"stretch")?jx(An(a,"stretch","fill-available"),l)+a:a}break;case 4949:if(Xr(a,l+1)!==115)break;case 6444:switch(Xr(a,Ki(a)-3-(~Lx(a,"!important")&&10))){case 107:return An(a,":",":"+mn)+a;case 101:return An(a,/(.+:)([^;!]+)(;|!.+)?/,"$1"+mn+(Xr(a,14)===45?"inline-":"")+"box$3$1"+mn+"$2$3$1"+Rr+"$2box$3")+a}break;case 5936:switch(Xr(a,l+11)){case 114:return mn+a+Rr+An(a,/[svh]\w+-[tblr]{2}/,"tb")+a;case 108:return mn+a+Rr+An(a,/[svh]\w+-[tblr]{2}/,"tb-rl")+a;case 45:return mn+a+Rr+An(a,/[svh]\w+-[tblr]{2}/,"lr")+a}return mn+a+Rr+a+a}return a}function jl(a,l){for(var h="",s=Y_(a),c=0;c<s;c++)h+=l(a[c],c,a,l)||"";return h}function FB(a,l,h,s){switch(a.type){case SB:case X_:return a.return=a.return||a.value;case Dx:return"";case W_:a.value=a.props.join(",")}return Ki(h=jl(a.children,s))?a.return=a.value+"{"+h+"}":""}function BB(a){var l=Y_(a);return function(h,s,c,E){for(var m="",S=0;S<l;S++)m+=a[S](h,s,c,E)||"";return m}}function UB(a){return function(l){l.root||(l=l.return)&&a(l)}}function VB(a,l,h,s){if(!a.return)switch(a.type){case X_:a.return=jx(a.value,a.length);break;case xB:return jl([kl(An(a.value,"@","@"+mn),a,"")],s);case W_:if(a.length)return RB(a.props,function(c){switch(CB(c,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return jl([kl(An(c,/:(read-\w+)/,":"+_d+"$1"),a,"")],s);case"::placeholder":return jl([kl(An(c,/:(plac\w+)/,":"+mn+"input-$1"),a,""),kl(An(c,/:(plac\w+)/,":"+_d+"$1"),a,""),kl(An(c,/:(plac\w+)/,Rr+"input-$1"),a,"")],s)}return""})}}var zx=function(l){var h=new WeakMap;return function(s){if(h.has(s))return h.get(s);var c=l(s);return h.set(s,c),c}};function Gx(a){var l=Object.create(null);return function(h){return l[h]===void 0&&(l[h]=a(h)),l[h]}}var kB=function(l,h){var s=-1,c=44;do switch(Sd(c)){case 0:c===38&&bo()===12&&(h[s]=1),l[s]+=Ux(ti-1);break;case 2:l[s]+=K_(c);break;case 4:if(c===44){l[++s]=bo()===58?"&\f":"",h[s]=l[s].length;break}default:l[s]+=gd(c)}while(c=vi());return l},jB=function(l,h){return Bx(kB(Fx(l),h))},Hx=new WeakMap,zB=function(l){if(!(l.type!=="rule"||!l.parent||!l.length)){for(var h=l.value,s=l.parent,c=l.column===s.column&&l.line===s.line;s.type!=="rule";)if(s=s.parent,!s)return;if(!(l.props.length===1&&h.charCodeAt(0)!==58&&!Hx.get(s))&&!c){Hx.set(l,!0);for(var E=[],m=jB(h,E),S=s.props,d=0,M=0;d<m.length;d++)for(var C=0;C<S.length;C++,M++)l.props[M]=E[d]?m[d].replace(/&\f/g,S[C]):S[C]+" "+m[d]}}},GB=function(l){if(l.type==="decl"){var h=l.value;h.charCodeAt(0)===108&&h.charCodeAt(2)===98&&(l.return="",l.value="")}},HB=[VB],WB=function(l){var h=l.key;if(h==="css"){var s=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(s,function(P){var A=P.getAttribute("data-emotion");A.indexOf(" ")!==-1&&(document.head.appendChild(P),P.setAttribute("data-s",""))})}var c=l.stylisPlugins||HB,E={},m,S=[];m=l.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+h+' "]'),function(P){for(var A=P.getAttribute("data-emotion").split(" "),T=1;T<A.length;T++)E[A[T]]=!0;S.push(P)});var d,M=[zB,GB];{var C,I=[FB,UB(function(P){C.insert(P)})],b=BB(M.concat(c,I)),p=function(A){return jl(LB(A),b)};d=function(A,T,_,g){C=_,p(A?A+"{"+T.styles+"}":T.styles),g&&(x.inserted[T.name]=!0)}}var x={key:h,sheet:new Ix({key:h,container:m,nonce:l.nonce,speedy:l.speedy,prepend:l.prepend}),nonce:l.nonce,inserted:E,registered:{},insert:d};return x.sheet.hydrate(S),x};function sa(){return sa=Object.assign||function(a){for(var l=1;l<arguments.length;l++){var h=arguments[l];for(var s in h)Object.prototype.hasOwnProperty.call(h,s)&&(a[s]=h[s])}return a},sa.apply(this,arguments)}var Wx={exports:{}},Pn={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var gr=typeof Symbol=="function"&&Symbol.for,q_=gr?Symbol.for("react.element"):60103,Z_=gr?Symbol.for("react.portal"):60106,Ad=gr?Symbol.for("react.fragment"):60107,Pd=gr?Symbol.for("react.strict_mode"):60108,Cd=gr?Symbol.for("react.profiler"):60114,Rd=gr?Symbol.for("react.provider"):60109,Od=gr?Symbol.for("react.context"):60110,$_=gr?Symbol.for("react.async_mode"):60111,Md=gr?Symbol.for("react.concurrent_mode"):60111,Id=gr?Symbol.for("react.forward_ref"):60112,Dd=gr?Symbol.for("react.suspense"):60113,XB=gr?Symbol.for("react.suspense_list"):60120,wd=gr?Symbol.for("react.memo"):60115,Ld=gr?Symbol.for("react.lazy"):60116,YB=gr?Symbol.for("react.block"):60121,KB=gr?Symbol.for("react.fundamental"):60117,QB=gr?Symbol.for("react.responder"):60118,qB=gr?Symbol.for("react.scope"):60119;function ni(a){if(typeof a=="object"&&a!==null){var l=a.$$typeof;switch(l){case q_:switch(a=a.type,a){case $_:case Md:case Ad:case Cd:case Pd:case Dd:return a;default:switch(a=a&&a.$$typeof,a){case Od:case Id:case Ld:case wd:case Rd:return a;default:return l}}case Z_:return l}}}function Xx(a){return ni(a)===Md}Pn.AsyncMode=$_;Pn.ConcurrentMode=Md;Pn.ContextConsumer=Od;Pn.ContextProvider=Rd;Pn.Element=q_;Pn.ForwardRef=Id;Pn.Fragment=Ad;Pn.Lazy=Ld;Pn.Memo=wd;Pn.Portal=Z_;Pn.Profiler=Cd;Pn.StrictMode=Pd;Pn.Suspense=Dd;Pn.isAsyncMode=function(a){return Xx(a)||ni(a)===$_};Pn.isConcurrentMode=Xx;Pn.isContextConsumer=function(a){return ni(a)===Od};Pn.isContextProvider=function(a){return ni(a)===Rd};Pn.isElement=function(a){return typeof a=="object"&&a!==null&&a.$$typeof===q_};Pn.isForwardRef=function(a){return ni(a)===Id};Pn.isFragment=function(a){return ni(a)===Ad};Pn.isLazy=function(a){return ni(a)===Ld};Pn.isMemo=function(a){return ni(a)===wd};Pn.isPortal=function(a){return ni(a)===Z_};Pn.isProfiler=function(a){return ni(a)===Cd};Pn.isStrictMode=function(a){return ni(a)===Pd};Pn.isSuspense=function(a){return ni(a)===Dd};Pn.isValidElementType=function(a){return typeof a=="string"||typeof a=="function"||a===Ad||a===Md||a===Cd||a===Pd||a===Dd||a===XB||typeof a=="object"&&a!==null&&(a.$$typeof===Ld||a.$$typeof===wd||a.$$typeof===Rd||a.$$typeof===Od||a.$$typeof===Id||a.$$typeof===KB||a.$$typeof===QB||a.$$typeof===qB||a.$$typeof===YB)};Pn.typeOf=ni;Wx.exports=Pn;var J_=Wx.exports,ZB={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},$B={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},JB={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},Yx={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},eg={};eg[J_.ForwardRef]=JB;eg[J_.Memo]=Yx;function Kx(a){return J_.isMemo(a)?Yx:eg[a.$$typeof]||ZB}var e2=Object.defineProperty,t2=Object.getOwnPropertyNames,Qx=Object.getOwnPropertySymbols,n2=Object.getOwnPropertyDescriptor,r2=Object.getPrototypeOf,qx=Object.prototype;function Zx(a,l,h){if(typeof l!="string"){if(qx){var s=r2(l);s&&s!==qx&&Zx(a,s,h)}var c=t2(l);Qx&&(c=c.concat(Qx(l)));for(var E=Kx(a),m=Kx(l),S=0;S<c.length;++S){var d=c[S];if(!$B[d]&&!(h&&h[d])&&!(m&&m[d])&&!(E&&E[d])){var M=n2(l,d);try{e2(a,d,M)}catch(C){}}}}return a}var i2=Zx,o2=function(a,l){return i2(a,l)},a2=o2,s2=!0;function tg(a,l,h){var s="";return h.split(" ").forEach(function(c){a[c]!==void 0?l.push(a[c]+";"):s+=c+" "}),s}var Nd=function(l,h,s){var c=l.key+"-"+h.name;if((s===!1||s2===!1)&&l.registered[c]===void 0&&(l.registered[c]=h.styles),l.inserted[h.name]===void 0){var E=h;do l.insert(h===E?"."+c:"",E,l.sheet,!0),E=E.next;while(E!==void 0)}};function c2(a){for(var l=0,h,s=0,c=a.length;c>=4;++s,c-=4)h=a.charCodeAt(s)&255|(a.charCodeAt(++s)&255)<<8|(a.charCodeAt(++s)&255)<<16|(a.charCodeAt(++s)&255)<<24,h=(h&65535)*1540483477+((h>>>16)*59797<<16),h^=h>>>24,l=(h&65535)*1540483477+((h>>>16)*59797<<16)^(l&65535)*1540483477+((l>>>16)*59797<<16);switch(c){case 3:l^=(a.charCodeAt(s+2)&255)<<16;case 2:l^=(a.charCodeAt(s+1)&255)<<8;case 1:l^=a.charCodeAt(s)&255,l=(l&65535)*1540483477+((l>>>16)*59797<<16)}return l^=l>>>13,l=(l&65535)*1540483477+((l>>>16)*59797<<16),((l^l>>>15)>>>0).toString(36)}var l2={animationIterationCount:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},u2=/[A-Z]|^ms/g,h2=/_EMO_([^_]+?)_([^]*?)_EMO_/g,$x=function(l){return l.charCodeAt(1)===45},Jx=function(l){return l!=null&&typeof l!="boolean"},ng=Gx(function(a){return $x(a)?a:a.replace(u2,"-$&").toLowerCase()}),eA=function(l,h){switch(l){case"animation":case"animationName":if(typeof h=="string")return h.replace(h2,function(s,c,E){return Qi={name:c,styles:E,next:Qi},c})}return l2[l]!==1&&!$x(l)&&typeof h=="number"&&h!==0?h+"px":h};function zl(a,l,h){if(h==null)return"";if(h.__emotion_styles!==void 0)return h;switch(typeof h){case"boolean":return"";case"object":{if(h.anim===1)return Qi={name:h.name,styles:h.styles,next:Qi},h.name;if(h.styles!==void 0){var s=h.next;if(s!==void 0)for(;s!==void 0;)Qi={name:s.name,styles:s.styles,next:Qi},s=s.next;var c=h.styles+";";return c}return d2(a,l,h)}case"function":{if(a!==void 0){var E=Qi,m=h(a);return Qi=E,zl(a,l,m)}break}}if(l==null)return h;var S=l[h];return S!==void 0?S:h}function d2(a,l,h){var s="";if(Array.isArray(h))for(var c=0;c<h.length;c++)s+=zl(a,l,h[c])+";";else for(var E in h){var m=h[E];if(typeof m!="object")l!=null&&l[m]!==void 0?s+=E+"{"+l[m]+"}":Jx(m)&&(s+=ng(E)+":"+eA(E,m)+";");else if(Array.isArray(m)&&typeof m[0]=="string"&&(l==null||l[m[0]]===void 0))for(var S=0;S<m.length;S++)Jx(m[S])&&(s+=ng(E)+":"+eA(E,m[S])+";");else{var d=zl(a,l,m);switch(E){case"animation":case"animationName":{s+=ng(E)+":"+d+";";break}default:s+=E+"{"+d+"}"}}}return s}var tA=/label:\s*([^\s;\n{]+)\s*(;|$)/g,Qi,Gl=function(l,h,s){if(l.length===1&&typeof l[0]=="object"&&l[0]!==null&&l[0].styles!==void 0)return l[0];var c=!0,E="";Qi=void 0;var m=l[0];m==null||m.raw===void 0?(c=!1,E+=zl(s,h,m)):E+=m[0];for(var S=1;S<l.length;S++)E+=zl(s,h,l[S]),c&&(E+=m[S]);tA.lastIndex=0;for(var d="",M;(M=tA.exec(E))!==null;)d+="-"+M[1];var C=c2(E)+d;return{name:C,styles:E,next:Qi}},rg=Object.prototype.hasOwnProperty,ig=Sr(typeof HTMLElement!="undefined"?WB({key:"css"}):null),f2=ig.Provider,p2=function(){return cn(ig)},Hl=function(l){return Oi(function(h,s){var c=cn(ig);return l(h,c,s)})},qi=Sr({}),m2=function(){return cn(qi)},_2=function(l,h){if(typeof h=="function"){var s=h(l);return s}return sa({},l,h)},g2=zx(function(a){return zx(function(l){return _2(a,l)})}),nA=function(l){var h=cn(qi);return l.theme!==h&&(h=g2(h)(l.theme)),$e(qi.Provider,{value:h},l.children)};function v2(a){var l=a.displayName||a.name||"Component",h=function(E,m){var S=cn(qi);return $e(a,sa({theme:S,ref:m},E))},s=Oi(h);return s.displayName="WithTheme("+l+")",a2(s,a)}var og="__EMOTION_TYPE_PLEASE_DO_NOT_USE__",b2=function(l,h){var s={};for(var c in h)rg.call(h,c)&&(s[c]=h[c]);return s[og]=l,s},y2=Hl(function(a,l,h){var s=a.css;typeof s=="string"&&l.registered[s]!==void 0&&(s=l.registered[s]);var c=a[og],E=[s],m="";typeof a.className=="string"?m=tg(l.registered,E,a.className):a.className!=null&&(m=a.className+" ");var S=Gl(E,void 0,cn(qi));Nd(l,S,typeof c=="string"),m+=l.key+"-"+S.name;var d={};for(var M in a)rg.call(a,M)&&M!=="css"&&M!==og&&(d[M]=a[M]);d.ref=h,d.className=m;var C=$e(c,d);return C}),rA=function(l,h){var s=arguments;if(h==null||!rg.call(h,"css"))return $e.apply(void 0,s);var c=s.length,E=new Array(c);E[0]=y2,E[1]=b2(l,h);for(var m=2;m<c;m++)E[m]=s[m];return $e.apply(null,E)},Fd=Hl(function(a,l){var h=a.styles,s=Gl([h],void 0,cn(qi)),c=zt();return na(function(){var E=l.key+"-global",m=new Ix({key:E,nonce:l.sheet.nonce,container:l.sheet.container,speedy:l.sheet.isSpeedy}),S=!1,d=document.querySelector('style[data-emotion="'+E+" "+s.name+'"]');return l.sheet.tags.length&&(m.before=l.sheet.tags[0]),d!==null&&(S=!0,d.setAttribute("data-emotion",E),m.hydrate([d])),c.current=[m,S],function(){m.flush()}},[l]),na(function(){var E=c.current,m=E[0],S=E[1];if(S){E[1]=!1;return}if(s.next!==void 0&&Nd(l,s.next,!0),m.tags.length){var d=m.tags[m.tags.length-1].nextElementSibling;m.before=d,m.flush()}l.insert("",s,m,!1)},[l,s.name]),null});function iA(){for(var a=arguments.length,l=new Array(a),h=0;h<a;h++)l[h]=arguments[h];return Gl(l)}var ag=function(){var l=iA.apply(void 0,arguments),h="animation-"+l.name;return{name:h,styles:"@keyframes "+h+"{"+l.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}},T2=function a(l){for(var h=l.length,s=0,c="";s<h;s++){var E=l[s];if(E!=null){var m=void 0;switch(typeof E){case"boolean":break;case"object":{if(Array.isArray(E))m=a(E);else{m="";for(var S in E)E[S]&&S&&(m&&(m+=" "),m+=S)}break}default:m=E}m&&(c&&(c+=" "),c+=m)}}return c};function E2(a,l,h){var s=[],c=tg(a,s,h);return s.length<2?h:c+l(s)}var S2=Hl(function(a,l){var h=!1,s=function(){for(var d=arguments.length,M=new Array(d),C=0;C<d;C++)M[C]=arguments[C];var I=Gl(M,l.registered);return Nd(l,I,!1),l.key+"-"+I.name},c=function(){for(var d=arguments.length,M=new Array(d),C=0;C<d;C++)M[C]=arguments[C];return E2(l.registered,s,T2(M))},E={css:s,cx:c,theme:cn(qi)},m=a.children(E);return h=!0,m}),x2=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",ClassNames:S2,Global:Fd,createElement:rA,css:iA,jsx:rA,keyframes:ag,CacheProvider:f2,ThemeContext:qi,ThemeProvider:nA,__unsafe_useEmotionCache:p2,useTheme:m2,withEmotionCache:Hl,withTheme:v2}),A2=()=>$e(Fd,{styles:`
      html {
        line-height: 1.5;
        -webkit-text-size-adjust: 100%;
        font-family: system-ui, sans-serif;
        -webkit-font-smoothing: antialiased;
        text-rendering: optimizeLegibility;      
        -moz-osx-font-smoothing: grayscale; 
        touch-action: manipulation; 
      }

      body {
        position: relative;
        min-height: 100%;
        font-feature-settings: 'kern';
      }

      *,
      *::before,
      *::after {
        border-width: 0;
        border-style: solid;
        box-sizing: border-box;
      }

      main {
        display: block;
      }

      hr {
        border-top-width: 1px;
        box-sizing: content-box;
        height: 0;
        overflow: visible;
      }

      pre,
      code,
      kbd,
      samp {
        font-family: SFMono-Regular,  Menlo, Monaco, Consolas, monospace;
        font-size: 1em;
      }

      a {
        background-color: transparent;
        color: inherit;
        text-decoration: inherit;
      }

      abbr[title] {
        border-bottom: none;
        text-decoration: underline;
        -webkit-text-decoration: underline dotted;
        text-decoration: underline dotted;
      }

      b,
      strong {
        font-weight: bold;
      }

      small {
        font-size: 80%;
      }

      sub,
      sup {
        font-size: 75%;
        line-height: 0;
        position: relative;
        vertical-align: baseline;
      }

      sub {
        bottom: -0.25em;
      }

      sup {
        top: -0.5em;
      }

      img {
        border-style: none;
      }

      button,
      input,
      optgroup,
      select,
      textarea {
        font-family: inherit;
        font-size: 100%;
        line-height: 1.15;
        margin: 0;
      }

      button,
      input {
        overflow: visible;
      }

      button,
      select {
        text-transform: none;
      }

      button::-moz-focus-inner,
      [type="button"]::-moz-focus-inner,
      [type="reset"]::-moz-focus-inner,
      [type="submit"]::-moz-focus-inner {
        border-style: none;
        padding: 0;
      }

      fieldset {
        padding: 0.35em 0.75em 0.625em;
      }

      legend {
        box-sizing: border-box;
        color: inherit;
        display: table;
        max-width: 100%;
        padding: 0;
        white-space: normal;
      }

      progress {
        vertical-align: baseline;
      }

      textarea {
        overflow: auto;
      }

      [type="checkbox"],
      [type="radio"] {
        box-sizing: border-box;
        padding: 0;
      }

      [type="number"]::-webkit-inner-spin-button,
      [type="number"]::-webkit-outer-spin-button {
        -webkit-appearance: none !important;
      }

      input[type="number"] {
        -moz-appearance: textfield;
      }

      [type="search"] {
        -webkit-appearance: textfield;
        outline-offset: -2px;
      }

      [type="search"]::-webkit-search-decoration {
        -webkit-appearance: none !important;
      }

      ::-webkit-file-upload-button {
        -webkit-appearance: button;
        font: inherit;
      }

      details {
        display: block;
      }

      summary {
        display: list-item;
      }

      template {
        display: none;
      }

      [hidden] {
        display: none !important;
      }

      body,
      blockquote,
      dl,
      dd,
      h1,
      h2,
      h3,
      h4,
      h5,
      h6,
      hr,
      figure,
      p,
      pre {
        margin: 0;
      }

      button {
        background: transparent;
        padding: 0;
      }

      fieldset {
        margin: 0;
        padding: 0;
      }

      ol,
      ul {
        margin: 0;
        padding: 0;
      }

      textarea {
        resize: vertical;
      }

      button,
      [role="button"] {
        cursor: pointer;
      }

      button::-moz-focus-inner {
        border: 0 !important;
      }

      table {
        border-collapse: collapse;
      }

      h1,
      h2,
      h3,
      h4,
      h5,
      h6 {
        font-size: inherit;
        font-weight: inherit;
      }

      button,
      input,
      optgroup,
      select,
      textarea {
        padding: 0;
        line-height: inherit;
        color: inherit;
      }

      img,
      svg,
      video,
      canvas,
      audio,
      iframe,
      embed,
      object {
        display: block;
        vertical-align: middle;
      }

      img,
      video {
        max-width: 100%;
        height: auto;
      }

      [data-js-focus-visible] :focus:not([data-focus-visible-added]) {
        outline: none;
        box-shadow: none;
      }

      select::-ms-expand {
        display: none;
      }
    `}),P2=A2;function C2(a){var l=a==null?0:a.length;return l?a[l-1]:void 0}function za(a){return typeof a=="number"}function sg(a){return Array.isArray(a)}function oA(a){return typeof a=="function"}function Di(a){var l=typeof a;return a!=null&&(l==="object"||l==="function")&&!sg(a)}function R2(a){return Di(a)&&Object.keys(a).length===0}function cg(a){return Object.prototype.toString.call(a)==="[object String]"}function aA(a){return/^var\(--.+\)$/.test(a)}var Zi=!1,lg={exports:{}};(function(a,l){var h=200,s="__lodash_hash_undefined__",c=800,E=16,m=9007199254740991,S="[object Arguments]",d="[object Array]",M="[object AsyncFunction]",C="[object Boolean]",I="[object Date]",b="[object Error]",p="[object Function]",x="[object GeneratorFunction]",P="[object Map]",A="[object Number]",T="[object Null]",_="[object Object]",g="[object Proxy]",O="[object RegExp]",R="[object Set]",N="[object String]",V="[object Undefined]",U="[object WeakMap]",L="[object ArrayBuffer]",j="[object DataView]",Y="[object Float32Array]",W="[object Float64Array]",re="[object Int8Array]",ne="[object Int16Array]",ge="[object Int32Array]",_e="[object Uint8Array]",ce="[object Uint8ClampedArray]",ie="[object Uint16Array]",Z="[object Uint32Array]",te=/[\\^$.*+?()[\]{}|]/g,B=/^\[object .+?Constructor\]$/,G=/^(?:0|[1-9]\d*)$/,$={};$[Y]=$[W]=$[re]=$[ne]=$[ge]=$[_e]=$[ce]=$[ie]=$[Z]=!0,$[S]=$[d]=$[L]=$[C]=$[j]=$[I]=$[b]=$[p]=$[P]=$[A]=$[_]=$[O]=$[R]=$[N]=$[U]=!1;var le=typeof Fe=="object"&&Fe&&Fe.Object===Object&&Fe,se=typeof self=="object"&&self&&self.Object===Object&&self,q=le||se||Function("return this")(),H=l&&!l.nodeType&&l,X=H&&!0&&a&&!a.nodeType&&a,J=X&&X.exports===H,Q=J&&le.process,ee=function(){try{var we=X&&X.require&&X.require("util").types;return we||Q&&Q.binding&&Q.binding("util")}catch(ze){}}(),pe=ee&&ee.isTypedArray;function Te(we,ze,Je){switch(Je.length){case 0:return we.call(ze);case 1:return we.call(ze,Je[0]);case 2:return we.call(ze,Je[0],Je[1]);case 3:return we.call(ze,Je[0],Je[1],Je[2])}return we.apply(ze,Je)}function ve(we,ze){for(var Je=-1,xt=Array(we);++Je<we;)xt[Je]=ze(Je);return xt}function he(we){return function(ze){return we(ze)}}function be(we,ze){return we==null?void 0:we[ze]}function xe(we,ze){return function(Je){return we(ze(Je))}}var Se=Array.prototype,Ue=Function.prototype,We=Object.prototype,Ze=q["__core-js_shared__"],Qe=Ue.toString,Xe=We.hasOwnProperty,nt=function(){var we=/[^.]+$/.exec(Ze&&Ze.keys&&Ze.keys.IE_PROTO||"");return we?"Symbol(src)_1."+we:""}(),Ke=We.toString,ct=Qe.call(Object),ot=RegExp("^"+Qe.call(Xe).replace(te,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),_t=J?q.Buffer:void 0,gt=q.Symbol,At=q.Uint8Array,wt=_t?_t.allocUnsafe:void 0,Qt=xe(Object.getPrototypeOf,Object),Wt=Object.create,Ft=We.propertyIsEnumerable,Ht=Se.splice,fn=gt?gt.toStringTag:void 0,ln=function(){try{var we=Pa(Object,"defineProperty");return we({},"",{}),we}catch(ze){}}(),Ln=_t?_t.isBuffer:void 0,Ne=Math.max,vr=Date.now,On=Pa(q,"Map"),$n=Pa(Object,"create"),Ge=function(){function we(){}return function(ze){if(!ro(ze))return{};if(Wt)return Wt(ze);we.prototype=ze;var Je=new we;return we.prototype=void 0,Je}}();function zn(we){var ze=-1,Je=we==null?0:we.length;for(this.clear();++ze<Je;){var xt=we[ze];this.set(xt[0],xt[1])}}function No(){this.__data__=$n?$n(null):{},this.size=0}function et(we){var ze=this.has(we)&&delete this.__data__[we];return this.size-=ze?1:0,ze}function dr(we){var ze=this.__data__;if($n){var Je=ze[we];return Je===s?void 0:Je}return Xe.call(ze,we)?ze[we]:void 0}function Qr(we){var ze=this.__data__;return $n?ze[we]!==void 0:Xe.call(ze,we)}function ss(we,ze){var Je=this.__data__;return this.size+=this.has(we)?0:1,Je[we]=$n&&ze===void 0?s:ze,this}zn.prototype.clear=No,zn.prototype.delete=et,zn.prototype.get=dr,zn.prototype.has=Qr,zn.prototype.set=ss;function dt(we){var ze=-1,Je=we==null?0:we.length;for(this.clear();++ze<Je;){var xt=we[ze];this.set(xt[0],xt[1])}}function qr(){this.__data__=[],this.size=0}function yp(we){var ze=this.__data__,Je=Sa(ze,we);if(Je<0)return!1;var xt=ze.length-1;return Je==xt?ze.pop():Ht.call(ze,Je,1),--this.size,!0}function Ot(we){var ze=this.__data__,Je=Sa(ze,we);return Je<0?void 0:ze[Je][1]}function Hu(we){return Sa(this.__data__,we)>-1}function Wu(we,ze){var Je=this.__data__,xt=Sa(Je,we);return xt<0?(++this.size,Je.push([we,ze])):Je[xt][1]=ze,this}dt.prototype.clear=qr,dt.prototype.delete=yp,dt.prototype.get=Ot,dt.prototype.has=Hu,dt.prototype.set=Wu;function to(we){var ze=-1,Je=we==null?0:we.length;for(this.clear();++ze<Je;){var xt=we[ze];this.set(xt[0],xt[1])}}function Fo(){this.size=0,this.__data__={hash:new zn,map:new(On||dt),string:new zn}}function Tp(we){var ze=Bo(this,we).delete(we);return this.size-=ze?1:0,ze}function Ep(we){return Bo(this,we).get(we)}function yi(we){return Bo(this,we).has(we)}function Sp(we,ze){var Je=Bo(this,we),xt=Je.size;return Je.set(we,ze),this.size+=Je.size==xt?0:1,this}to.prototype.clear=Fo,to.prototype.delete=Tp,to.prototype.get=Ep,to.prototype.has=yi,to.prototype.set=Sp;function jt(we){var ze=this.__data__=new dt(we);this.size=ze.size}function Pt(){this.__data__=new dt,this.size=0}function Mr(we){var ze=this.__data__,Je=ze.delete(we);return this.size=ze.size,Je}function Xu(we){return this.__data__.get(we)}function xp(we){return this.__data__.has(we)}function Ap(we,ze){var Je=this.__data__;if(Je instanceof dt){var xt=Je.__data__;if(!On||xt.length<h-1)return xt.push([we,ze]),this.size=++Je.size,this;Je=this.__data__=new to(xt)}return Je.set(we,ze),this.size=Je.size,this}jt.prototype.clear=Pt,jt.prototype.delete=Mr,jt.prototype.get=Xu,jt.prototype.has=xp,jt.prototype.set=Ap;function ke(we,ze){var Je=ci(we),xt=!Je&&Zt(we),tn=!Je&&!xt&&Vi(we),gn=!Je&&!xt&&!tn&&Zc(we),Mn=Je||xt||tn||gn,Xt=Mn?ve(we.length,String):[],Tn=Xt.length;for(var Hn in we)(ze||Xe.call(we,Hn))&&!(Mn&&(Hn=="length"||tn&&(Hn=="offset"||Hn=="parent")||gn&&(Hn=="buffer"||Hn=="byteLength"||Hn=="byteOffset")||us(Hn,Tn)))&&Xt.push(Hn);return Xt}function Nt(we,ze,Je){(Je!==void 0&&!Uo(we[ze],Je)||Je===void 0&&!(ze in we))&&cs(we,ze,Je)}function en(we,ze,Je){var xt=we[ze];(!(Xe.call(we,ze)&&Uo(xt,Je))||Je===void 0&&!(ze in we))&&cs(we,ze,Je)}function Sa(we,ze){for(var Je=we.length;Je--;)if(Uo(we[Je][0],ze))return Je;return-1}function cs(we,ze,Je){ze=="__proto__"&&ln?ln(we,ze,{configurable:!0,enumerable:!0,value:Je,writable:!0}):we[ze]=Je}var Yu=zc();function Pr(we){return we==null?we===void 0?V:T:fn&&fn in Object(we)?Gc(we):Ca(we)}function xa(we){return ko(we)&&Pr(we)==S}function Kn(we){if(!ro(we)||Cp(we))return!1;var ze=Vo(we)?ot:B;return ze.test(Kc(we))}function Aa(we){return ko(we)&&qc(we.length)&&!!$[Pr(we)]}function Pp(we){if(!ro(we))return Xc(we);var ze=hs(we),Je=[];for(var xt in we)xt=="constructor"&&(ze||!Xe.call(we,xt))||Je.push(xt);return Je}function Gn(we,ze,Je,xt,tn){we!==ze&&Yu(ze,function(gn,Mn){if(tn||(tn=new jt),ro(gn))Ku(we,ze,Mn,Je,Gn,xt,tn);else{var Xt=xt?xt(Ra(we,Mn),gn,Mn+"",we,ze,tn):void 0;Xt===void 0&&(Xt=gn),Nt(we,Mn,Xt)}},ds)}function Ku(we,ze,Je,xt,tn,gn,Mn){var Xt=Ra(we,Je),Tn=Ra(ze,Je),Hn=Mn.get(Tn);if(Hn){Nt(we,Je,Hn);return}var Ye=gn?gn(Xt,Tn,Je+"",we,ze,Mn):void 0,Oa=Ye===void 0;if(Oa){var fs=ci(Tn),St=!fs&&Vi(Tn),$u=!fs&&!St&&Zc(Tn);Ye=Tn,fs||St||$u?ci(Xt)?Ye=Xt:Qc(Xt)?Ye=kc(Xt):St?(Oa=!1,Ye=Uc(Tn,!0)):$u?(Oa=!1,Ye=Qu(Tn,!0)):Ye=[]:Zr(Tn)||Zt(Tn)?(Ye=Xt,Zt(Xt)?Ye=Zu(Xt):(!ro(Xt)||Vo(Xt))&&(Ye=Hc(Tn))):Oa=!1}Oa&&(Mn.set(Tn,Ye),tn(Ye,Tn,xt,gn,Mn),Mn.delete(Tn)),Nt(we,Je,Ye)}function Bc(we,ze){return Nn(Yc(we,ze,ki),we+"")}var no=ln?function(we,ze){return ln(we,"toString",{configurable:!0,enumerable:!1,value:br(ze),writable:!0})}:ki;function Uc(we,ze){if(ze)return we.slice();var Je=we.length,xt=wt?wt(Je):new we.constructor(Je);return we.copy(xt),xt}function Vc(we){var ze=new we.constructor(we.byteLength);return new At(ze).set(new At(we)),ze}function Qu(we,ze){var Je=ze?Vc(we.buffer):we.buffer;return new we.constructor(Je,we.byteOffset,we.length)}function kc(we,ze){var Je=-1,xt=we.length;for(ze||(ze=Array(xt));++Je<xt;)ze[Je]=we[Je];return ze}function ls(we,ze,Je,xt){var tn=!Je;Je||(Je={});for(var gn=-1,Mn=ze.length;++gn<Mn;){var Xt=ze[gn],Tn=xt?xt(Je[Xt],we[Xt],Xt,Je,we):void 0;Tn===void 0&&(Tn=we[Xt]),tn?cs(Je,Xt,Tn):en(Je,Xt,Tn)}return Je}function jc(we){return Bc(function(ze,Je){var xt=-1,tn=Je.length,gn=tn>1?Je[tn-1]:void 0,Mn=tn>2?Je[2]:void 0;for(gn=we.length>3&&typeof gn=="function"?(tn--,gn):void 0,Mn&&Wc(Je[0],Je[1],Mn)&&(gn=tn<3?void 0:gn,tn=1),ze=Object(ze);++xt<tn;){var Xt=Je[xt];Xt&&we(ze,Xt,xt,gn)}return ze})}function zc(we){return function(ze,Je,xt){for(var tn=-1,gn=Object(ze),Mn=xt(ze),Xt=Mn.length;Xt--;){var Tn=Mn[we?Xt:++tn];if(Je(gn[Tn],Tn,gn)===!1)break}return ze}}function Bo(we,ze){var Je=we.__data__;return rn(ze)?Je[typeof ze=="string"?"string":"hash"]:Je.map}function Pa(we,ze){var Je=be(we,ze);return Kn(Je)?Je:void 0}function Gc(we){var ze=Xe.call(we,fn),Je=we[fn];try{we[fn]=void 0;var xt=!0}catch(gn){}var tn=Ke.call(we);return xt&&(ze?we[fn]=Je:delete we[fn]),tn}function Hc(we){return typeof we.constructor=="function"&&!hs(we)?Ge(Qt(we)):{}}function us(we,ze){var Je=typeof we;return ze=ze??m,!!ze&&(Je=="number"||Je!="symbol"&&G.test(we))&&we>-1&&we%1==0&&we<ze}function Wc(we,ze,Je){if(!ro(Je))return!1;var xt=typeof ze;return(xt=="number"?Cr(Je)&&us(ze,Je.length):xt=="string"&&ze in Je)?Uo(Je[ze],we):!1}function rn(we){var ze=typeof we;return ze=="string"||ze=="number"||ze=="symbol"||ze=="boolean"?we!=="__proto__":we===null}function Cp(we){return!!nt&&nt in we}function hs(we){var ze=we&&we.constructor,Je=typeof ze=="function"&&ze.prototype||We;return we===Je}function Xc(we){var ze=[];if(we!=null)for(var Je in Object(we))ze.push(Je);return ze}function Ca(we){return Ke.call(we)}function Yc(we,ze,Je){return ze=Ne(ze===void 0?we.length-1:ze,0),function(){for(var xt=arguments,tn=-1,gn=Ne(xt.length-ze,0),Mn=Array(gn);++tn<gn;)Mn[tn]=xt[ze+tn];tn=-1;for(var Xt=Array(ze+1);++tn<ze;)Xt[tn]=xt[tn];return Xt[ze]=Je(Mn),Te(we,this,Xt)}}function Ra(we,ze){if(!(ze==="constructor"&&typeof we[ze]=="function")&&ze!="__proto__")return we[ze]}var Nn=qu(no);function qu(we){var ze=0,Je=0;return function(){var xt=vr(),tn=E-(xt-Je);if(Je=xt,tn>0){if(++ze>=c)return arguments[0]}else ze=0;return we.apply(void 0,arguments)}}function Kc(we){if(we!=null){try{return Qe.call(we)}catch(ze){}try{return we+""}catch(ze){}}return""}function Uo(we,ze){return we===ze||we!==we&&ze!==ze}var Zt=xa(function(){return arguments}())?xa:function(we){return ko(we)&&Xe.call(we,"callee")&&!Ft.call(we,"callee")},ci=Array.isArray;function Cr(we){return we!=null&&qc(we.length)&&!Vo(we)}function Qc(we){return ko(we)&&Cr(we)}var Vi=Ln||ji;function Vo(we){if(!ro(we))return!1;var ze=Pr(we);return ze==p||ze==x||ze==M||ze==g}function qc(we){return typeof we=="number"&&we>-1&&we%1==0&&we<=m}function ro(we){var ze=typeof we;return we!=null&&(ze=="object"||ze=="function")}function ko(we){return we!=null&&typeof we=="object"}function Zr(we){if(!ko(we)||Pr(we)!=_)return!1;var ze=Qt(we);if(ze===null)return!0;var Je=Xe.call(ze,"constructor")&&ze.constructor;return typeof Je=="function"&&Je instanceof Je&&Qe.call(Je)==ct}var Zc=pe?he(pe):Aa;function Zu(we){return ls(we,ds(we))}function ds(we){return Cr(we)?ke(we,!0):Pp(we)}var Qn=jc(function(we,ze,Je,xt){Gn(we,ze,Je,xt)});function br(we){return function(){return we}}function ki(we){return we}function ji(){return!1}a.exports=Qn})(lg,lg.exports);var yo=lg.exports;function sA(a,l){var h={};return Object.keys(a).forEach(s=>{l.includes(s)||(h[s]=a[s])}),h}function O2(a,l){var h={};return l.forEach(s=>{s in a&&(h[s]=a[s])}),h}function M2(a,l){var h={},s={};return Object.keys(a).forEach(c=>{l.includes(c)?h[c]=a[c]:s[c]=a[c]}),[h,s]}function I2(a,l,h,s){var c=typeof l=="string"?l.split("."):[l];for(s=0;s<c.length&&a;s+=1)a=a[c[s]];return a===void 0?h:a}var D2=a=>{var l=new WeakMap,h=(s,c,E,m)=>{if(typeof s=="undefined")return a(s,c,E);l.has(s)||l.set(s,new Map);var S=l.get(s);if(S.has(c))return S.get(c);var d=a(s,c,E,m);return S.set(c,d),d};return h},Bd=D2(I2);function cA(a,l){var h={};return Object.keys(a).forEach(s=>{var c=a[s],E=l(c,s,a);E&&(h[s]=c)}),h}var Ud=a=>cA(a,l=>l!=null),Vd=a=>Object.keys(a),w2=a=>a.reduce((l,h)=>{var[s,c]=h;return l[s]=c,l},{});function L2(a){var l=parseFloat(a.toString()),h=a.toString().replace(String(l),"");return{unitless:!h,value:l,unit:h}}function ug(a){if(a==null)return a;var{unitless:l}=L2(a);return l||za(a)?a+"px":a}var lA=(a,l)=>parseInt(a[1],10)>parseInt(l[1],10)?1:-1,hg=a=>w2(Object.entries(a).sort(lA));function uA(a){var l=hg(a);return Object.assign(Object.values(l),l)}function N2(a){var l=Object.keys(hg(a));return new Set(l)}function F2(a){var l;if(!a)return a;a=(l=ug(a))!=null?l:a;var h=a.endsWith("px")?-1:-.0635;return za(a)?""+(a+h):a.replace(/([0-9]+\.?[0-9]*)/,s=>""+(parseFloat(s)+h))}function kd(a,l){var h=[];return a&&h.push("@media screen and (min-width: "+ug(a)+")"),h.length>0&&l&&h.push("and"),l&&h.push("@media screen and (max-width: "+ug(l)+")"),h.join(" ")}function B2(a){var l;if(!a)return null;a.base=(l=a.base)!=null?l:"0px";var h=uA(a),s=Object.entries(a).sort(lA).map((m,S,d)=>{var M,[C,I]=m,[,b]=(M=d[S+1])!=null?M:[];return b=parseFloat(b)>0?F2(b):void 0,{breakpoint:C,minW:I,maxW:b,maxWQuery:kd(null,b),minWQuery:kd(I),minMaxQuery:kd(I,b)}}),c=N2(a),E=Array.from(c.values());return{keys:c,normalized:h,isResponsive(m){var S=Object.keys(m);return S.length>0&&S.every(d=>c.has(d))},asObject:hg(a),asArray:uA(a),details:s,media:[null,...h.map(m=>kd(m)).slice(1)],toArrayValue(m){if(!Di(m))throw new Error("toArrayValue: value must be an object");for(var S=E.map(d=>{var M;return(M=m[d])!=null?M:null});C2(S)===null;)S.pop();return S},toObjectValue(m){if(!Array.isArray(m))throw new Error("toObjectValue: value must be an array");return m.reduce((S,d,M)=>{var C=E[M];return C!=null&&d!=null&&(S[C]=d),S},{})}}}function hA(a){return a!=null&&typeof a=="object"&&"nodeType"in a&&a.nodeType===Node.ELEMENT_NODE}function dg(a){var l;if(!hA(a))return!1;var h=(l=a.ownerDocument.defaultView)!=null?l:window;return a instanceof h.HTMLElement}function dA(a){var l;return hA(a)&&(l=a.ownerDocument)!=null?l:document}function U2(){return!!(typeof window!="undefined"&&window.document&&window.document.createElement)}var tc=U2(),lr=a=>a?"":void 0,fg=a=>a?!0:void 0,ir=function(){for(var l=arguments.length,h=new Array(l),s=0;s<l;s++)h[s]=arguments[s];return h.filter(Boolean).join(" ")},V2=a=>a.hasAttribute("tabindex");function k2(a){return Boolean(a.getAttribute("disabled"))===!0||Boolean(a.getAttribute("aria-disabled"))===!0}function j2(a){return dg(a)&&a.tagName.toLowerCase()==="input"&&"select"in a}function z2(a){var l=dg(a)?dA(a):document;return l.activeElement===a}function fA(a){return a.parentElement&&fA(a.parentElement)?!0:a.hidden}function G2(a){var l=a.getAttribute("contenteditable");return l!=="false"&&l!=null}function H2(a){if(!dg(a)||fA(a)||k2(a))return!1;var{localName:l}=a,h=["input","select","textarea","button"];if(h.indexOf(l)>=0)return!0;var s={a:()=>a.hasAttribute("href"),audio:()=>a.hasAttribute("controls"),video:()=>a.hasAttribute("controls")};return l in s?s[l]():G2(a)?!0:V2(a)}var W2=["input:not([disabled])","select:not([disabled])","textarea:not([disabled])","embed","iframe","object","a[href]","area[href]","button:not([disabled])","[tabindex]","audio[controls]","video[controls]","*[tabindex]:not([aria-disabled])","*[contenteditable]"],X2=W2.join();function Y2(a){var l=Array.from(a.querySelectorAll(X2));return l.unshift(a),l.filter(H2).filter(h=>window.getComputedStyle(h).display!=="none")}function $i(a){for(var l=arguments.length,h=new Array(l>1?l-1:0),s=1;s<l;s++)h[s-1]=arguments[s];return oA(a)?a(...h):a}function ur(){for(var a=arguments.length,l=new Array(a),h=0;h<a;h++)l[h]=arguments[h];return function(c){l.some(E=>(E==null||E(c),c==null?void 0:c.defaultPrevented))}}function K2(a){var l;return function(){if(a){for(var s=arguments.length,c=new Array(s),E=0;E<s;E++)c[E]=arguments[E];l=a.apply(this,c),a=null}return l}}var Wl=()=>{},pg=K2(a=>()=>{var{condition:l,message:h}=a;l&&Zi&&console.warn(h)});function pA(a,l){l===void 0&&(l={});var{isActive:h=z2,nextTick:s,preventScroll:c=!0,selectTextIfInput:E=!0}=l;if(!a||h(a))return-1;function m(){if(!a){pg({condition:!0,message:"[chakra-ui]: can't call focus() on `null` or `undefined` element"});return}if(Q2())a.focus({preventScroll:c});else if(a.focus(),c){var S=q2(a);Z2(S)}j2(a)&&E&&a.select()}return s?requestAnimationFrame(m):(m(),-1)}var jd=null;function Q2(){if(jd==null){jd=!1;try{var a=document.createElement("div");a.focus({get preventScroll(){return jd=!0,!0}})}catch(l){}}return jd}function q2(a){for(var l,h=dA(a),s=(l=h.defaultView)!=null?l:window,c=a.parentNode,E=[],m=h.scrollingElement||h.documentElement;c instanceof s.HTMLElement&&c!==m;)(c.offsetHeight<c.scrollHeight||c.offsetWidth<c.scrollWidth)&&E.push({element:c,scrollTop:c.scrollTop,scrollLeft:c.scrollLeft}),c=c.parentNode;return m instanceof s.HTMLElement&&E.push({element:m,scrollTop:m.scrollTop,scrollLeft:m.scrollLeft}),E}function Z2(a){for(var{element:l,scrollTop:h,scrollLeft:s}of a)l.scrollTop=h,l.scrollLeft=s}var mA=1/60*1e3,$2=typeof performance!="undefined"?function(){return performance.now()}:function(){return Date.now()},_A=typeof window!="undefined"?function(a){return window.requestAnimationFrame(a)}:function(a){return setTimeout(function(){return a($2())},mA)};function J2(a){var l=[],h=[],s=0,c=!1,E=new WeakSet,m={schedule:function(S,d,M){d===void 0&&(d=!1),M===void 0&&(M=!1);var C=M&&c,I=C?l:h;return d&&E.add(S),I.indexOf(S)===-1&&(I.push(S),C&&c&&(s=l.length)),S},cancel:function(S){var d=h.indexOf(S);d!==-1&&h.splice(d,1),E.delete(S)},process:function(S){var d;if(c=!0,d=[h,l],l=d[0],h=d[1],h.length=0,s=l.length,s)for(var M=0;M<s;M++){var C=l[M];C(S),E.has(C)&&(m.schedule(C),a())}c=!1}};return m}var eU=40,mg=!0,Xl=!1,_g=!1,nc={delta:0,timestamp:0},Yl=["read","update","preRender","render","postRender"],zd=Yl.reduce(function(a,l){return a[l]=J2(function(){return Xl=!0}),a},{}),Ji=Yl.reduce(function(a,l){var h=zd[l];return a[l]=function(s,c,E){return c===void 0&&(c=!1),E===void 0&&(E=!1),Xl||nU(),h.schedule(s,c,E)},a},{}),Kl=Yl.reduce(function(a,l){return a[l]=zd[l].cancel,a},{}),rc=Yl.reduce(function(a,l){return a[l]=function(){return zd[l].process(nc)},a},{}),tU=function(a){return zd[a].process(nc)},gA=function(a){Xl=!1,nc.delta=mg?mA:Math.max(Math.min(a-nc.timestamp,eU),1),nc.timestamp=a,_g=!0,Yl.forEach(tU),_g=!1,Xl&&(mg=!1,_A(gA))},nU=function(){Xl=!0,mg=!0,_g||_A(gA)},Gd=function(){return nc};Object.freeze(["base","sm","md","lg","xl","2xl"]);function gg(a,l){return sg(a)?a.map(h=>h===null?null:l(h)):Di(a)?Vd(a).reduce((h,s)=>(h[s]=l(a[s]),h),{}):a!=null?l(a):null}function rU(a,l){function h(s,c){return c===void 0&&(c=[]),sg(s)?s.map((E,m)=>h(E,[...c,String(m)])):Di(s)?Object.fromEntries(Object.entries(s).map(E=>{var[m,S]=E;return[m,h(S,[...c,m])]})):l(s,c)}return h(a)}function iU(a,l){if(a!=null){if(oA(a)){a(l);return}try{a.current=l}catch(h){throw new Error("Cannot assign value '"+l+"' to ref '"+a+"'")}}}function Hd(){for(var a=arguments.length,l=new Array(a),h=0;h<a;h++)l[h]=arguments[h];return s=>{l.forEach(c=>iU(c,s))}}function ca(a){a===void 0&&(a={});var{strict:l=!0,errorMessage:h="useContext: `context` is undefined. Seems you forgot to wrap component within the Provider",name:s}=a,c=Sr(void 0);c.displayName=s;function E(){var m=cn(c);if(!m&&l){var S=new Error(h);throw S.name="ContextError",Error.captureStackTrace==null||Error.captureStackTrace(S,E),S}return m}return[c.Provider,E,c]}function oU(a){return Nl.toArray(a).filter(l=>ra(l))}var[aU,sU]=ca({strict:!1,name:"PortalManagerContext"});function vA(a){var{children:l,zIndex:h}=a;return $e(aU,{value:{zIndex:h}},l)}Zi&&(vA.displayName="PortalManager");function vg(a){a===void 0&&(a=!1);var[l,h]=un(a),s=Gt(()=>{h(!0)},[]),c=Gt(()=>{h(!1)},[]),E=Gt(()=>{h(m=>!m)},[]);return[l,{on:s,off:c,toggle:E}]}var ic=tc?na:Vt;function bg(a,l){l===void 0&&(l=[]);var h=zt(a);return ic(()=>{h.current=a}),Gt(function(){for(var s=arguments.length,c=new Array(s),E=0;E<s;E++)c[E]=arguments[E];return h.current==null?void 0:h.current(...c)},l)}function cU(a,l){var h=a!==void 0,s=h&&typeof a!="undefined"?a:l;return[h,s]}var bA={prefix:Math.round(Math.random()*1e10),current:0},yg=Sr(bA),lU=Ll(a=>{var{children:l}=a,h=cn(yg),s=h===bA,c=Vn(()=>({prefix:s?0:++h.prefix,current:0}),[s,h]);return $e(yg.Provider,{value:c},l)});function uU(a,l){var h=cn(yg);return Vn(()=>a||[l,h.prefix,++h.current].filter(Boolean).join("-"),[a,l])}function hU(a){for(var l=arguments.length,h=new Array(l>1?l-1:0),s=1;s<l;s++)h[s-1]=arguments[s];var c=uU(a);return Vn(()=>h.map(E=>E+"-"+c),[c,h])}function dU(a,l){return l===void 0&&(l=[]),Vt(()=>()=>a(),l)}function yA(){var a=zt(!1),[l,h]=un(0);return dU(()=>{a.current=!0}),Gt(()=>{a.current||h(l+1)},[l])}function fU(a,l){if(a!=null){if(typeof a=="function"){a(l);return}try{a.current=l}catch(h){throw new Error("Cannot assign value '"+l+"' to ref '"+a+"'")}}}function pU(){for(var a=arguments.length,l=new Array(a),h=0;h<a;h++)l[h]=arguments[h];return Vn(()=>l.every(s=>s==null)?null:s=>{l.forEach(c=>{c&&fU(c,s)})},l)}function Tg(){return Tg=Object.assign||function(a){for(var l=1;l<arguments.length;l++){var h=arguments[l];for(var s in h)Object.prototype.hasOwnProperty.call(h,s)&&(a[s]=h[s])}return a},Tg.apply(this,arguments)}function mU(a,l){if(a==null)return{};var h={},s=Object.keys(a),c,E;for(E=0;E<s.length;E++)c=s[E],!(l.indexOf(c)>=0)&&(h[c]=a[c]);return h}var[TA,_U]=ca({strict:!1,name:"PortalContext"}),Eg="chakra-portal",gU=".chakra-portal",vU=a=>$e("div",{className:"chakra-portal-zIndex",style:{position:"absolute",zIndex:a.zIndex,top:0,left:0,right:0}},a.children),bU=a=>{var{appendToParentPortal:l,children:h}=a,s=zt(null),c=zt(null),E=yA(),m=_U(),S=sU();ic(()=>{if(!!s.current){var M=s.current.ownerDocument,C=l?m??M.body:M.body;if(!!C){c.current=M.createElement("div"),c.current.className=Eg,C.appendChild(c.current),E();var I=c.current;return()=>{C.contains(I)&&C.removeChild(I)}}}},[]);var d=S!=null&&S.zIndex?$e(vU,{zIndex:S==null?void 0:S.zIndex},h):h;return c.current?cd($e(TA,{value:c.current},d),c.current):$e("span",{ref:s})},yU=a=>{var{children:l,containerRef:h,appendToParentPortal:s}=a,c=h.current,E=c??(tc?document.body:void 0),m=Vn(()=>{var d=c==null?void 0:c.ownerDocument.createElement("div");return d&&(d.className=Eg),d},[c]),S=yA();return ic(()=>{S()},[]),ic(()=>{if(!(!m||!E))return E.appendChild(m),()=>{E.removeChild(m)}},[m,E]),E&&m?cd($e(TA,{value:s?m:null},l),m):null};function Wd(a){var{containerRef:l}=a,h=mU(a,["containerRef"]);return l?$e(yU,Tg({containerRef:l},h)):$e(bU,h)}Wd.defaultProps={appendToParentPortal:!0};Wd.className=Eg;Wd.selector=gU;var Xd={light:"chakra-ui-light",dark:"chakra-ui-dark"},TU={classList:{add:Wl,remove:Wl}},EU=()=>tc?document.body:TU;function SU(a){var l=EU();l.classList.add(a?Xd.dark:Xd.light),l.classList.remove(a?Xd.light:Xd.dark)}function xU(a){var l=window.matchMedia==null?void 0:window.matchMedia(a);if(!!l)return!!l.media===l.matches}var EA={light:"(prefers-color-scheme: light)",dark:"(prefers-color-scheme: dark)"};function AU(a){var l,h=(l=xU(EA.dark))!=null?l:a==="dark";return h?"dark":"light"}function PU(a){if(!("matchMedia"in window))return Wl;var l=window.matchMedia(EA.dark),h=()=>{a(l.matches?"dark":"light")};return h(),l.addListener(h),()=>{l.removeListener(h)}}var SA={get:()=>document.documentElement.style.getPropertyValue("--chakra-ui-color-mode"),set:a=>{tc&&document.documentElement.style.setProperty("--chakra-ui-color-mode",a)}},xA=()=>typeof Storage!="undefined",AA="chakra-ui-color-mode",CU={get(a){if(!xA())return a;try{var l=localStorage.getItem(AA);return l??a}catch(h){return a}},set(a){if(!!xA())try{localStorage.setItem(AA,a)}catch(l){}},type:"localStorage"},Sg=Sr({});Zi&&(Sg.displayName="ColorModeContext");var PA=()=>{var a=cn(Sg);if(a===void 0)throw new Error("useColorMode must be used within a ColorModeProvider");return a};function CA(a){var{value:l,children:h,options:{useSystemColorMode:s,initialColorMode:c},colorModeManager:E=CU}=a,[m,S]=un(E.type==="cookie"?E.get(c):c);Vt(()=>{if(tc&&E.type==="localStorage"){var I=s?AU(c):SA.get()||E.get();I&&S(I)}},[E,s,c]),Vt(()=>{var I=m==="dark";SU(I),SA.set(I?"dark":"light")},[m]);var d=Gt(I=>{E.set(I),S(I)},[E]),M=Gt(()=>{d(m==="light"?"dark":"light")},[m,d]);Vt(()=>{var I;return s&&(I=PU(d)),()=>{I&&s&&I()}},[d,s]);var C=Vn(()=>({colorMode:l??m,toggleColorMode:l?Wl:M,setColorMode:l?Wl:d}),[m,d,M,l]);return $e(Sg.Provider,{value:C},h)}Zi&&(CA.displayName="ColorModeProvider");var RU=(a,l)=>h=>{var s=String(l),c=a?a+"."+s:s;return Di(h.__cssMap)&&c in h.__cssMap?h.__cssMap[c].varRef:l};function Ql(a){var{scale:l,transform:h,compose:s}=a,c=(E,m)=>{var S,d=RU(l,E)(m),M=(S=h==null?void 0:h(d,m))!=null?S:d;return s&&(M=s(M,m)),M};return c}function wi(a,l){return h=>{var s={property:h,scale:a};return s.transform=Ql({scale:a,transform:l}),s}}var OU=a=>{var{rtl:l,ltr:h}=a;return s=>s.direction==="rtl"?l:h};function MU(a){var{property:l,scale:h,transform:s}=a;return{scale:h,property:OU(l),transform:h?Ql({scale:h,compose:s}):s}}var RA=["rotate(var(--chakra-rotate, 0))","scaleX(var(--chakra-scale-x, 1))","scaleY(var(--chakra-scale-y, 1))","skewX(var(--chakra-skew-x, 0))","skewY(var(--chakra-skew-y, 0))"];function IU(){return["translateX(var(--chakra-translate-x, 0))","translateY(var(--chakra-translate-y, 0))",...RA].join(" ")}function DU(){return["translate3d(var(--chakra-translate-x, 0), var(--chakra-translate-y, 0), 0)",...RA].join(" ")}var wU={"--chakra-blur":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-brightness":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-contrast":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-grayscale":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-hue-rotate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-invert":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-saturate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-sepia":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-drop-shadow":"var(--chakra-empty,/*!*/ /*!*/)",filter:["var(--chakra-blur)","var(--chakra-brightness)","var(--chakra-contrast)","var(--chakra-grayscale)","var(--chakra-hue-rotate)","var(--chakra-invert)","var(--chakra-saturate)","var(--chakra-sepia)","var(--chakra-drop-shadow)"].join(" ")},LU={backdropFilter:["var(--chakra-backdrop-blur)","var(--chakra-backdrop-brightness)","var(--chakra-backdrop-contrast)","var(--chakra-backdrop-grayscale)","var(--chakra-backdrop-hue-rotate)","var(--chakra-backdrop-invert)","var(--chakra-backdrop-opacity)","var(--chakra-backdrop-saturate)","var(--chakra-backdrop-sepia)"].join(" "),"--chakra-backdrop-blur":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-brightness":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-contrast":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-grayscale":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-hue-rotate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-invert":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-opacity":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-saturate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-sepia":"var(--chakra-empty,/*!*/ /*!*/)"};function NU(a){return{"--chakra-ring-offset-shadow":"var(--chakra-ring-inset) 0 0 0 var(--chakra-ring-offset-width) var(--chakra-ring-offset-color)","--chakra-ring-shadow":"var(--chakra-ring-inset) 0 0 0 calc(var(--chakra-ring-width) + var(--chakra-ring-offset-width)) var(--chakra-ring-color)","--chakra-ring-width":a,boxShadow:["var(--chakra-ring-offset-shadow)","var(--chakra-ring-shadow)","var(--chakra-shadow, 0 0 #0000)"].join(", ")}}var FU={"row-reverse":{space:"--chakra-space-x-reverse",divide:"--chakra-divide-x-reverse"},"column-reverse":{space:"--chakra-space-y-reverse",divide:"--chakra-divide-y-reverse"}},OA="& > :not(style) ~ :not(style)",BU={[OA]:{marginInlineStart:"calc(var(--chakra-space-x) * calc(1 - var(--chakra-space-x-reverse)))",marginInlineEnd:"calc(var(--chakra-space-x) * var(--chakra-space-x-reverse))"}},UU={[OA]:{marginTop:"calc(var(--chakra-space-y) * calc(1 - var(--chakra-space-y-reverse)))",marginBottom:"calc(var(--chakra-space-y) * var(--chakra-space-y-reverse))"}};function xg(a,l){xg=function(d,M){return new E(d,void 0,M)};var h=Ag(RegExp),s=RegExp.prototype,c=new WeakMap;function E(S,d,M){var C=h.call(this,S,d);return c.set(C,M||c.get(S)),C}VU(E,h),E.prototype.exec=function(S){var d=s.exec.call(this,S);return d&&(d.groups=m(d,this)),d},E.prototype[Symbol.replace]=function(S,d){if(typeof d=="string"){var M=c.get(this);return s[Symbol.replace].call(this,S,d.replace(/\$<([^>]+)>/g,function(I,b){return"$"+M[b]}))}else if(typeof d=="function"){var C=this;return s[Symbol.replace].call(this,S,function(){var I=[];return I.push.apply(I,arguments),typeof I[I.length-1]!="object"&&I.push(m(I,C)),d.apply(this,I)})}else return s[Symbol.replace].call(this,S,d)};function m(S,d){var M=c.get(d);return Object.keys(M).reduce(function(C,I){return C[I]=S[M[I]],C},Object.create(null))}return xg.apply(this,arguments)}function VU(a,l){if(typeof l!="function"&&l!==null)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(l&&l.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),l&&ql(a,l)}function Ag(a){var l=typeof Map=="function"?new Map:void 0;return Ag=function(s){if(s===null||!jU(s))return s;if(typeof s!="function")throw new TypeError("Super expression must either be null or a function");if(typeof l!="undefined"){if(l.has(s))return l.get(s);l.set(s,c)}function c(){return Yd(s,arguments,Pg(this).constructor)}return c.prototype=Object.create(s.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}}),ql(c,s)},Ag(a)}function Yd(a,l,h){return kU()?Yd=Reflect.construct:Yd=function(c,E,m){var S=[null];S.push.apply(S,E);var d=Function.bind.apply(c,S),M=new d;return m&&ql(M,m.prototype),M},Yd.apply(null,arguments)}function kU(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(a){return!1}}function jU(a){return Function.toString.call(a).indexOf("[native code]")!==-1}function ql(a,l){return ql=Object.setPrototypeOf||function(s,c){return s.__proto__=c,s},ql(a,l)}function Pg(a){return Pg=Object.setPrototypeOf?Object.getPrototypeOf:function(h){return h.__proto__||Object.getPrototypeOf(h)},Pg(a)}var Cg={"to-t":"to top","to-tr":"to top right","to-r":"to right","to-br":"to bottom right","to-b":"to bottom","to-bl":"to bottom left","to-l":"to left","to-tl":"to top left"},zU=new Set(Object.values(Cg)),MA=new Set(["none","-moz-initial","inherit","initial","revert","unset"]),GU=a=>a.trim();function HU(a,l){var h,s;if(a==null||MA.has(a))return a;var c=xg(/(^[\x2DA-Za-z]+)\(((.*))\)/g,{type:1,values:2}),{type:E,values:m}=(h=(s=c.exec(a))==null?void 0:s.groups)!=null?h:{};if(!E||!m)return a;var S=E.includes("-gradient")?E:E+"-gradient",[d,...M]=m.split(",").map(GU).filter(Boolean);if((M==null?void 0:M.length)===0)return a;var C=d in Cg?Cg[d]:d;M.unshift(C);var I=M.map(b=>{if(zU.has(b))return b;var p=b.indexOf(" "),[x,P]=p!==-1?[b.substr(0,p),b.substr(p+1)]:[b],A=IA(P)?P:P&&P.split(" "),T="colors."+x,_=T in l.__cssMap?l.__cssMap[T].varRef:x;return A?[_,A].join(" "):_});return S+"("+I.join(", ")+")"}var IA=a=>cg(a)&&a.includes("(")&&a.includes(")"),WU=(a,l)=>HU(a,l??{}),XU=a=>{var l=parseFloat(a.toString()),h=a.toString().replace(String(l),"");return{unitless:!h,value:l,unit:h}},eo=a=>l=>a+"("+l+")",Cn={filter(a){return a!=="auto"?a:wU},backdropFilter(a){return a!=="auto"?a:LU},ring(a){return NU(Cn.px(a))},bgClip(a){return a==="text"?{color:"transparent",backgroundClip:"text"}:{backgroundClip:a}},transform(a){return a==="auto"?IU():a==="auto-gpu"?DU():a},px(a){if(a==null)return a;var{unitless:l}=XU(a);return l||za(a)?a+"px":a},fraction(a){return!za(a)||a>1?a:a*100+"%"},float(a,l){var h={left:"right",right:"left"};return l.direction==="rtl"?h[a]:a},degree(a){if(aA(a)||a==null)return a;var l=cg(a)&&!a.endsWith("deg");return za(a)||l?a+"deg":a},gradient:WU,blur:eo("blur"),opacity:eo("opacity"),brightness:eo("brightness"),contrast:eo("contrast"),dropShadow:eo("drop-shadow"),grayscale:eo("grayscale"),hueRotate:eo("hue-rotate"),invert:eo("invert"),saturate:eo("saturate"),sepia:eo("sepia"),bgImage(a){if(a==null)return a;var l=IA(a)||MA.has(a);return l?a:"url("+a+")"},outline(a){var l=String(a)==="0"||String(a)==="none";return a!==null&&l?{outline:"2px solid transparent",outlineOffset:"2px"}:{outline:a}},flexDirection(a){var l,{space:h,divide:s}=(l=FU[a])!=null?l:{},c={flexDirection:a};return h&&(c[h]=1),s&&(c[s]=1),c}};function Rg(){return Rg=Object.assign||function(a){for(var l=1;l<arguments.length;l++){var h=arguments[l];for(var s in h)Object.prototype.hasOwnProperty.call(h,s)&&(a[s]=h[s])}return a},Rg.apply(this,arguments)}var qe={borderWidths:wi("borderWidths"),borderStyles:wi("borderStyles"),colors:wi("colors"),borders:wi("borders"),radii:wi("radii",Cn.px),space:wi("space",Cn.px),spaceT:wi("space",Cn.px),degreeT(a){return{property:a,transform:Cn.degree}},prop(a,l,h){return Rg({property:a,scale:l},l&&{transform:Ql({scale:l,transform:h})})},propT(a,l){return{property:a,transform:l}},sizes:wi("sizes",Cn.px),sizesT:wi("sizes",Cn.fraction),shadows:wi("shadows"),logical:MU,blur:wi("blur",Cn.blur)},Kd={background:qe.colors("background"),backgroundColor:qe.colors("backgroundColor"),backgroundImage:qe.propT("backgroundImage",Cn.bgImage),backgroundSize:!0,backgroundPosition:!0,backgroundRepeat:!0,backgroundAttachment:!0,backgroundClip:{transform:Cn.bgClip},bgSize:qe.prop("backgroundSize"),bgPosition:qe.prop("backgroundPosition"),bg:qe.colors("background"),bgColor:qe.colors("backgroundColor"),bgPos:qe.prop("backgroundPosition"),bgRepeat:qe.prop("backgroundRepeat"),bgAttachment:qe.prop("backgroundAttachment"),bgGradient:qe.propT("backgroundImage",Cn.gradient),bgClip:{transform:Cn.bgClip}};Object.assign(Kd,{bgImage:Kd.backgroundImage,bgImg:Kd.backgroundImage});var _n={border:qe.borders("border"),borderWidth:qe.borderWidths("borderWidth"),borderStyle:qe.borderStyles("borderStyle"),borderColor:qe.colors("borderColor"),borderRadius:qe.radii("borderRadius"),borderTop:qe.borders("borderTop"),borderBlockStart:qe.borders("borderBlockStart"),borderTopLeftRadius:qe.radii("borderTopLeftRadius"),borderStartStartRadius:qe.logical({scale:"radii",property:{ltr:"borderTopLeftRadius",rtl:"borderTopRightRadius"}}),borderEndStartRadius:qe.logical({scale:"radii",property:{ltr:"borderBottomLeftRadius",rtl:"borderBottomRightRadius"}}),borderTopRightRadius:qe.radii("borderTopRightRadius"),borderStartEndRadius:qe.logical({scale:"radii",property:{ltr:"borderTopRightRadius",rtl:"borderTopLeftRadius"}}),borderEndEndRadius:qe.logical({scale:"radii",property:{ltr:"borderBottomRightRadius",rtl:"borderBottomLeftRadius"}}),borderRight:qe.borders("borderRight"),borderInlineEnd:qe.borders("borderInlineEnd"),borderBottom:qe.borders("borderBottom"),borderBlockEnd:qe.borders("borderBlockEnd"),borderBottomLeftRadius:qe.radii("borderBottomLeftRadius"),borderBottomRightRadius:qe.radii("borderBottomRightRadius"),borderLeft:qe.borders("borderLeft"),borderInlineStart:{property:"borderInlineStart",scale:"borders"},borderInlineStartRadius:qe.logical({scale:"radii",property:{ltr:["borderTopLeftRadius","borderBottomLeftRadius"],rtl:["borderTopRightRadius","borderBottomRightRadius"]}}),borderInlineEndRadius:qe.logical({scale:"radii",property:{ltr:["borderTopRightRadius","borderBottomRightRadius"],rtl:["borderTopLeftRadius","borderBottomLeftRadius"]}}),borderX:qe.borders(["borderLeft","borderRight"]),borderInline:qe.borders("borderInline"),borderY:qe.borders(["borderTop","borderBottom"]),borderBlock:qe.borders("borderBlock"),borderTopWidth:qe.borderWidths("borderTopWidth"),borderBlockStartWidth:qe.borderWidths("borderBlockStartWidth"),borderTopColor:qe.colors("borderTopColor"),borderBlockStartColor:qe.colors("borderBlockStartColor"),borderTopStyle:qe.borderStyles("borderTopStyle"),borderBlockStartStyle:qe.borderStyles("borderBlockStartStyle"),borderBottomWidth:qe.borderWidths("borderBottomWidth"),borderBlockEndWidth:qe.borderWidths("borderBlockEndWidth"),borderBottomColor:qe.colors("borderBottomColor"),borderBlockEndColor:qe.colors("borderBlockEndColor"),borderBottomStyle:qe.borderStyles("borderBottomStyle"),borderBlockEndStyle:qe.borderStyles("borderBlockEndStyle"),borderLeftWidth:qe.borderWidths("borderLeftWidth"),borderInlineStartWidth:qe.borderWidths("borderInlineStartWidth"),borderLeftColor:qe.colors("borderLeftColor"),borderInlineStartColor:qe.colors("borderInlineStartColor"),borderLeftStyle:qe.borderStyles("borderLeftStyle"),borderInlineStartStyle:qe.borderStyles("borderInlineStartStyle"),borderRightWidth:qe.borderWidths("borderRightWidth"),borderInlineEndWidth:qe.borderWidths("borderInlineEndWidth"),borderRightColor:qe.colors("borderRightColor"),borderInlineEndColor:qe.colors("borderInlineEndColor"),borderRightStyle:qe.borderStyles("borderRightStyle"),borderInlineEndStyle:qe.borderStyles("borderInlineEndStyle"),borderTopRadius:qe.radii(["borderTopLeftRadius","borderTopRightRadius"]),borderBottomRadius:qe.radii(["borderBottomLeftRadius","borderBottomRightRadius"]),borderLeftRadius:qe.radii(["borderTopLeftRadius","borderBottomLeftRadius"]),borderRightRadius:qe.radii(["borderTopRightRadius","borderBottomRightRadius"])};Object.assign(_n,{rounded:_n.borderRadius,roundedTop:_n.borderTopRadius,roundedTopLeft:_n.borderTopLeftRadius,roundedTopRight:_n.borderTopRightRadius,roundedTopStart:_n.borderStartStartRadius,roundedTopEnd:_n.borderStartEndRadius,roundedBottom:_n.borderBottomRadius,roundedBottomLeft:_n.borderBottomLeftRadius,roundedBottomRight:_n.borderBottomRightRadius,roundedBottomStart:_n.borderEndStartRadius,roundedBottomEnd:_n.borderEndEndRadius,roundedLeft:_n.borderLeftRadius,roundedRight:_n.borderRightRadius,roundedStart:_n.borderInlineStartRadius,roundedEnd:_n.borderInlineEndRadius,borderStart:_n.borderInlineStart,borderEnd:_n.borderInlineEnd,borderTopStartRadius:_n.borderStartStartRadius,borderTopEndRadius:_n.borderStartEndRadius,borderBottomStartRadius:_n.borderEndStartRadius,borderBottomEndRadius:_n.borderEndEndRadius,borderStartRadius:_n.borderInlineStartRadius,borderEndRadius:_n.borderInlineEndRadius,borderStartWidth:_n.borderInlineStartWidth,borderEndWidth:_n.borderInlineEndWidth,borderStartColor:_n.borderInlineStartColor,borderEndColor:_n.borderInlineEndColor,borderStartStyle:_n.borderInlineStartStyle,borderEndStyle:_n.borderInlineEndStyle});var YU={color:qe.colors("color"),textColor:qe.colors("color"),fill:qe.colors("fill"),stroke:qe.colors("stroke")},Og={boxShadow:qe.shadows("boxShadow"),mixBlendMode:!0,blendMode:qe.prop("mixBlendMode"),backgroundBlendMode:!0,bgBlendMode:qe.prop("backgroundBlendMode"),opacity:!0};Object.assign(Og,{shadow:Og.boxShadow});var KU={filter:{transform:Cn.filter},blur:qe.blur("--chakra-blur"),brightness:qe.propT("--chakra-brightness",Cn.brightness),contrast:qe.propT("--chakra-contrast",Cn.contrast),hueRotate:qe.degreeT("--chakra-hue-rotate"),invert:qe.propT("--chakra-invert",Cn.invert),saturate:qe.propT("--chakra-saturate",Cn.saturate),dropShadow:qe.propT("--chakra-drop-shadow",Cn.dropShadow),backdropFilter:{transform:Cn.backdropFilter},backdropBlur:qe.blur("--chakra-backdrop-blur"),backdropBrightness:qe.propT("--chakra-backdrop-brightness",Cn.brightness),backdropContrast:qe.propT("--chakra-backdrop-contrast",Cn.contrast),backdropHueRotate:qe.degreeT("--chakra-backdrop-hue-rotate"),backdropInvert:qe.propT("--chakra-backdrop-invert",Cn.invert),backdropSaturate:qe.propT("--chakra-backdrop-saturate",Cn.saturate)},Qd={alignItems:!0,alignContent:!0,justifyItems:!0,justifyContent:!0,flexWrap:!0,flexDirection:{transform:Cn.flexDirection},experimental_spaceX:{static:BU,transform:Ql({scale:"space",transform:a=>a!==null?{"--chakra-space-x":a}:null})},experimental_spaceY:{static:UU,transform:Ql({scale:"space",transform:a=>a!=null?{"--chakra-space-y":a}:null})},flex:!0,flexFlow:!0,flexGrow:!0,flexShrink:!0,flexBasis:qe.sizes("flexBasis"),justifySelf:!0,alignSelf:!0,order:!0,placeItems:!0,placeContent:!0,placeSelf:!0};Object.assign(Qd,{flexDir:Qd.flexDirection});var DA={gridGap:qe.space("gridGap"),gridColumnGap:qe.space("gridColumnGap"),gridRowGap:qe.space("gridRowGap"),gridColumn:!0,gridRow:!0,gridAutoFlow:!0,gridAutoColumns:!0,gridColumnStart:!0,gridColumnEnd:!0,gridRowStart:!0,gridRowEnd:!0,gridAutoRows:!0,gridTemplate:!0,gridTemplateColumns:!0,gridTemplateRows:!0,gridTemplateAreas:!0,gridArea:!0},QU={appearance:!0,cursor:!0,resize:!0,userSelect:!0,pointerEvents:!0,outline:{transform:Cn.outline},outlineOffset:!0,outlineColor:qe.colors("outlineColor")},bi={width:qe.sizesT("width"),inlineSize:qe.sizesT("inlineSize"),height:qe.sizes("height"),blockSize:qe.sizes("blockSize"),boxSize:qe.sizes(["width","height"]),minWidth:qe.sizes("minWidth"),minInlineSize:qe.sizes("minInlineSize"),minHeight:qe.sizes("minHeight"),minBlockSize:qe.sizes("minBlockSize"),maxWidth:qe.sizes("maxWidth"),maxInlineSize:qe.sizes("maxInlineSize"),maxHeight:qe.sizes("maxHeight"),maxBlockSize:qe.sizes("maxBlockSize"),d:qe.prop("display"),overflow:!0,overflowX:!0,overflowY:!0,overscrollBehavior:!0,overscrollBehaviorX:!0,overscrollBehaviorY:!0,display:!0,verticalAlign:!0,boxSizing:!0,boxDecorationBreak:!0,float:qe.propT("float",Cn.float),objectFit:!0,objectPosition:!0,visibility:!0,isolation:!0};Object.assign(bi,{w:bi.width,h:bi.height,minW:bi.minWidth,maxW:bi.maxWidth,minH:bi.minHeight,maxH:bi.maxHeight,overscroll:bi.overscrollBehavior,overscrollX:bi.overscrollBehaviorX,overscrollY:bi.overscrollBehaviorY});var qU={listStyleType:!0,listStylePosition:!0,listStylePos:qe.prop("listStylePosition"),listStyleImage:!0,listStyleImg:qe.prop("listStyleImage")},ZU={border:"0px",clip:"rect(0, 0, 0, 0)",width:"1px",height:"1px",margin:"-1px",padding:"0px",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"},$U={position:"static",width:"auto",height:"auto",clip:"auto",padding:"0",margin:"0",overflow:"visible",whiteSpace:"normal"},Mg=(a,l,h)=>{var s={},c=Bd(a,l,{});for(var E in c){var m=E in h&&h[E]!=null;m||(s[E]=c[E])}return s},JU={srOnly:{transform(a){return a===!0?ZU:a==="focusable"?$U:{}}},layerStyle:{processResult:!0,transform:(a,l,h)=>Mg(l,"layerStyles."+a,h)},textStyle:{processResult:!0,transform:(a,l,h)=>Mg(l,"textStyles."+a,h)},apply:{processResult:!0,transform:(a,l,h)=>Mg(l,a,h)}},Zl={position:!0,pos:qe.prop("position"),zIndex:qe.prop("zIndex","zIndices"),inset:qe.spaceT(["top","right","bottom","left"]),insetX:qe.spaceT(["left","right"]),insetInline:qe.spaceT("insetInline"),insetY:qe.spaceT(["top","bottom"]),insetBlock:qe.spaceT("insetBlock"),top:qe.spaceT("top"),insetBlockStart:qe.spaceT("insetBlockStart"),bottom:qe.spaceT("bottom"),insetBlockEnd:qe.spaceT("insetBlockEnd"),left:qe.spaceT("left"),insetInlineStart:qe.logical({scale:"space",property:{ltr:"left",rtl:"right"}}),right:qe.spaceT("right"),insetInlineEnd:qe.logical({scale:"space",property:{ltr:"right",rtl:"left"}})};Object.assign(Zl,{insetStart:Zl.insetInlineStart,insetEnd:Zl.insetInlineEnd});var eV={ring:{transform:Cn.ring},ringColor:qe.colors("--chakra-ring-color"),ringOffset:qe.prop("--chakra-ring-offset-width"),ringOffsetColor:qe.colors("--chakra-ring-offset-color"),ringInset:qe.prop("--chakra-ring-inset")},Bn={margin:qe.spaceT("margin"),marginTop:qe.spaceT("marginTop"),marginBlockStart:qe.spaceT("marginBlockStart"),marginRight:qe.spaceT("marginRight"),marginInlineEnd:qe.spaceT("marginInlineEnd"),marginBottom:qe.spaceT("marginBottom"),marginBlockEnd:qe.spaceT("marginBlockEnd"),marginLeft:qe.spaceT("marginLeft"),marginInlineStart:qe.spaceT("marginInlineStart"),marginX:qe.spaceT(["marginInlineStart","marginInlineEnd"]),marginInline:qe.spaceT("marginInline"),marginY:qe.spaceT(["marginTop","marginBottom"]),marginBlock:qe.spaceT("marginBlock"),padding:qe.space("padding"),paddingTop:qe.space("paddingTop"),paddingBlockStart:qe.space("paddingBlockStart"),paddingRight:qe.space("paddingRight"),paddingBottom:qe.space("paddingBottom"),paddingBlockEnd:qe.space("paddingBlockEnd"),paddingLeft:qe.space("paddingLeft"),paddingInlineStart:qe.space("paddingInlineStart"),paddingInlineEnd:qe.space("paddingInlineEnd"),paddingX:qe.space(["paddingInlineStart","paddingInlineEnd"]),paddingInline:qe.space("paddingInline"),paddingY:qe.space(["paddingTop","paddingBottom"]),paddingBlock:qe.space("paddingBlock")};Object.assign(Bn,{m:Bn.margin,mt:Bn.marginTop,mr:Bn.marginRight,me:Bn.marginInlineEnd,marginEnd:Bn.marginInlineEnd,mb:Bn.marginBottom,ml:Bn.marginLeft,ms:Bn.marginInlineStart,marginStart:Bn.marginInlineStart,mx:Bn.marginX,my:Bn.marginY,p:Bn.padding,pt:Bn.paddingTop,py:Bn.paddingY,px:Bn.paddingX,pb:Bn.paddingBottom,pl:Bn.paddingLeft,ps:Bn.paddingInlineStart,paddingStart:Bn.paddingInlineStart,pr:Bn.paddingRight,pe:Bn.paddingInlineEnd,paddingEnd:Bn.paddingInlineEnd});var tV={textDecorationColor:qe.colors("textDecorationColor"),textDecoration:!0,textDecor:{property:"textDecoration"},textDecorationLine:!0,textDecorationStyle:!0,textDecorationThickness:!0,textUnderlineOffset:!0,textShadow:qe.shadows("textShadow")},nV={clipPath:!0,transform:qe.propT("transform",Cn.transform),transformOrigin:!0,translateX:qe.spaceT("--chakra-translate-x"),translateY:qe.spaceT("--chakra-translate-y"),skewX:qe.degreeT("--chakra-skew-x"),skewY:qe.degreeT("--chakra-skew-y"),scaleX:qe.prop("--chakra-scale-x"),scaleY:qe.prop("--chakra-scale-y"),scale:qe.prop(["--chakra-scale-x","--chakra-scale-y"]),rotate:qe.degreeT("--chakra-rotate")},rV={transition:!0,transitionDelay:!0,animation:!0,willChange:!0,transitionDuration:qe.prop("transitionDuration","transition.duration"),transitionProperty:qe.prop("transitionProperty","transition.property"),transitionTimingFunction:qe.prop("transitionTimingFunction","transition.easing")},iV={fontFamily:qe.prop("fontFamily","fonts"),fontSize:qe.prop("fontSize","fontSizes",Cn.px),fontWeight:qe.prop("fontWeight","fontWeights"),lineHeight:qe.prop("lineHeight","lineHeights"),letterSpacing:qe.prop("letterSpacing","letterSpacings"),textAlign:!0,fontStyle:!0,wordBreak:!0,overflowWrap:!0,textOverflow:!0,textTransform:!0,whiteSpace:!0,noOfLines:{static:{overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:"var(--chakra-line-clamp)"},property:"--chakra-line-clamp"},isTruncated:{transform(a){if(a===!0)return{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}}},oc={hover:a=>a+":hover &, "+a+"[data-hover] &",focus:a=>a+":focus &, "+a+"[data-focus] &",active:a=>a+":active &, "+a+"[data-active] &",disabled:a=>a+":disabled &, "+a+"[data-disabled] &",invalid:a=>a+":invalid &, "+a+"[data-invalid] &",checked:a=>a+":checked &, "+a+"[data-checked] &",indeterminate:a=>a+":indeterminate &, "+a+"[aria-checked=mixed] &, "+a+"[data-indeterminate] &",readOnly:a=>a+":read-only &, "+a+"[readonly] &, "+a+"[data-read-only] &",expanded:a=>a+":read-only &, "+a+"[aria-expanded=true] &, "+a+"[data-expanded] &"},ac=a=>oV(a,"[role=group]","[data-group]",".group"),oV=function(l){for(var h=arguments.length,s=new Array(h>1?h-1:0),c=1;c<h;c++)s[c-1]=arguments[c];return s.map(l).join(", ")},Ig={_hover:"&:hover, &[data-hover]",_active:"&:active, &[data-active]",_focus:"&:focus, &[data-focus]",_highlighted:"&[data-highlighted]",_focusWithin:"&:focus-within",_focusVisible:"&:focus-visible",_disabled:"&[disabled], &[aria-disabled=true], &[data-disabled]",_readOnly:"&[aria-readonly=true], &[readonly], &[data-readonly]",_before:"&::before",_after:"&::after",_empty:"&:empty",_expanded:"&[aria-expanded=true], &[data-expanded]",_checked:"&[aria-checked=true], &[data-checked]",_grabbed:"&[aria-grabbed=true], &[data-grabbed]",_pressed:"&[aria-pressed=true], &[data-pressed]",_invalid:"&[aria-invalid=true], &[data-invalid]",_valid:"&[data-valid], &[data-state=valid]",_loading:"&[data-loading], &[aria-busy=true]",_selected:"&[aria-selected=true], &[data-selected]",_hidden:"&[hidden], &[data-hidden]",_autofill:"&:-webkit-autofill",_even:"&:nth-of-type(even)",_odd:"&:nth-of-type(odd)",_first:"&:first-of-type",_last:"&:last-of-type",_notFirst:"&:not(:first-of-type)",_notLast:"&:not(:last-of-type)",_visited:"&:visited",_activeLink:"&[aria-current=page]",_activeStep:"&[aria-current=step]",_indeterminate:"&:indeterminate, &[aria-checked=mixed], &[data-indeterminate]",_groupHover:ac(oc.hover),_groupFocus:ac(oc.focus),_groupActive:ac(oc.active),_groupDisabled:ac(oc.disabled),_groupInvalid:ac(oc.invalid),_groupChecked:ac(oc.checked),_placeholder:"&::placeholder",_fullScreen:"&:fullscreen",_selection:"&::selection",_rtl:"[dir=rtl] &",_mediaDark:"@media (prefers-color-scheme: dark)",_dark:".chakra-ui-dark &, [data-theme=dark] &, &[data-theme=dark]",_light:".chakra-ui-light &, [data-theme=light] &, &[data-theme=light]"},aV=Vd(Ig);function Dg(){return Dg=Object.assign||function(a){for(var l=1;l<arguments.length;l++){var h=arguments[l];for(var s in h)Object.prototype.hasOwnProperty.call(h,s)&&(a[s]=h[s])}return a},Dg.apply(this,arguments)}var wg=yo({},Kd,_n,YU,Qd,bi,KU,eV,QU,DA,JU,Zl,Og,Bn,iV,tV,nV,qU,rV),sV=Object.assign({},Bn,bi,Qd,DA,Zl),cV=Vd(sV),lV=[...Vd(wg),...aV],uV=Dg({},wg,Ig),hV=a=>a in uV,dV=a=>l=>{if(!l.__breakpoints)return a;var{isResponsive:h,toArrayValue:s,media:c}=l.__breakpoints,E={};for(var m in a){var S=$i(a[m],l);if(S!=null){if(S=Di(S)&&h(S)?s(S):S,!Array.isArray(S)){E[m]=S;continue}for(var d=S.slice(0,c.length).length,M=0;M<d;M+=1){var C=c==null?void 0:c[M];if(!C){E[m]=S[M];continue}E[C]=E[C]||{},S[M]!=null&&(E[C][m]=S[M])}}}return E},fV=(a,l)=>a.startsWith("--")&&cg(l)&&!aA(l),pV=(a,l)=>{var h,s;if(l==null)return l;var c=M=>{var C,I;return(C=a.__cssMap)==null||(I=C[M])==null?void 0:I.varRef},E=M=>{var C;return(C=c(M))!=null?C:M},m=l.split(",").map(M=>M.trim()),[S,d]=m;return l=(h=(s=c(S))!=null?s:E(d))!=null?h:E(l),l};function mV(a){var{configs:l={},pseudos:h={},theme:s}=a,c=function E(m,S){S===void 0&&(S=!1);var d=$i(m,s),M=dV(d)(s),C={};for(var I in M){var b,p,x,P,A,T=M[I],_=$i(T,s);I in h&&(I=h[I]),fV(I,_)&&(_=pV(s,_));var g=l[I];if(g===!0&&(g={property:I}),Di(_)){var O;C[I]=(O=C[I])!=null?O:{},C[I]=yo({},C[I],E(_,!0));continue}var R=(b=(p=g)==null||p.transform==null?void 0:p.transform(_,s,d))!=null?b:_;R=(x=g)!=null&&x.processResult?E(R,!0):R;var N=$i((P=g)==null?void 0:P.property,s);if(!S&&(A=g)!=null&&A.static){var V=$i(g.static,s);C=yo({},C,V)}if(N&&Array.isArray(N)){for(var U of N)C[U]=R;continue}if(N){N==="&"&&Di(R)?C=yo({},C,R):C[N]=R;continue}if(Di(R)){C=yo({},C,R);continue}C[I]=R}return C};return c}var wA=a=>l=>{var h=mV({theme:l,pseudos:Ig,configs:wg});return h(a)};function LA(a){return Di(a)&&a.reference?a.reference:String(a)}var qd=function(l){for(var h=arguments.length,s=new Array(h>1?h-1:0),c=1;c<h;c++)s[c-1]=arguments[c];return s.map(LA).join(" "+l+" ").replace(/calc/g,"")},NA=function(){for(var l=arguments.length,h=new Array(l),s=0;s<l;s++)h[s]=arguments[s];return"calc("+qd("+",...h)+")"},FA=function(){for(var l=arguments.length,h=new Array(l),s=0;s<l;s++)h[s]=arguments[s];return"calc("+qd("-",...h)+")"},Lg=function(){for(var l=arguments.length,h=new Array(l),s=0;s<l;s++)h[s]=arguments[s];return"calc("+qd("*",...h)+")"},BA=function(){for(var l=arguments.length,h=new Array(l),s=0;s<l;s++)h[s]=arguments[s];return"calc("+qd("/",...h)+")"},UA=a=>{var l=LA(a);return l!=null&&!Number.isNaN(parseFloat(l))?String(l).startsWith("-")?String(l).slice(1):"-"+l:Lg(l,-1)},Ga=Object.assign(a=>({add:function(){for(var h=arguments.length,s=new Array(h),c=0;c<h;c++)s[c]=arguments[c];return Ga(NA(a,...s))},subtract:function(){for(var h=arguments.length,s=new Array(h),c=0;c<h;c++)s[c]=arguments[c];return Ga(FA(a,...s))},multiply:function(){for(var h=arguments.length,s=new Array(h),c=0;c<h;c++)s[c]=arguments[c];return Ga(Lg(a,...s))},divide:function(){for(var h=arguments.length,s=new Array(h),c=0;c<h;c++)s[c]=arguments[c];return Ga(BA(a,...s))},negate:()=>Ga(UA(a)),toString:()=>a.toString()}),{add:NA,subtract:FA,multiply:Lg,divide:BA,negate:UA});function _V(a,l){return l===void 0&&(l="-"),a.replace(/\s+/g,l)}function VA(a){var l=_V(a.toString());if(l.includes("\\."))return a;var h=!Number.isInteger(parseFloat(a.toString()));return h?l.replace(".","\\."):a}function gV(a,l){return l===void 0&&(l=""),[l,VA(a)].filter(Boolean).join("-")}function vV(a,l){return"var("+VA(a)+(l?", "+l:"")+")"}function bV(a,l){return l===void 0&&(l=""),"--"+gV(a,l)}function kA(a,l,h){var s=bV(a,h);return{variable:s,reference:vV(s,l)}}function Ng(){return Ng=Object.assign||function(a){for(var l=1;l<arguments.length;l++){var h=arguments[l];for(var s in h)Object.prototype.hasOwnProperty.call(h,s)&&(a[s]=h[s])}return a},Ng.apply(this,arguments)}function yV(a,l){var h={cssMap:{},cssVars:{}};return rU(a,(s,c)=>{var E,[m]=c,S=(E=Fg[m])!=null?E:Fg.defaultHandler,{cssVars:d,cssMap:M}=S(c,s,l);Object.assign(h.cssVars,d),Object.assign(h.cssMap,M)}),h}var Fg={space:(a,l,h)=>{var s=Fg.defaultHandler(a,l,h),[c,...E]=a,m=c+".-"+E.join("."),S=a.join("-"),{variable:d,reference:M}=kA(S,void 0,h.cssVarPrefix),C=Ga.negate(l),I=Ga.negate(M);return{cssVars:s.cssVars,cssMap:Ng({},s.cssMap,{[m]:{value:""+C,var:""+d,varRef:I}})}},defaultHandler:(a,l,h)=>{var s=a.join("."),c=a.join("-"),{variable:E,reference:m}=kA(c,void 0,h.cssVarPrefix);return{cssVars:{[E]:l},cssMap:{[s]:{value:l,var:E,varRef:m}}}}};function TV(a,l){if(a==null)return{};var h={},s=Object.keys(a),c,E;for(E=0;E<s.length;E++)c=s[E],!(l.indexOf(c)>=0)&&(h[c]=a[c]);return h}var EV=["colors","borders","borderWidths","borderStyles","fonts","fontSizes","fontWeights","letterSpacings","lineHeights","radii","space","shadows","sizes","zIndices","transition","blur"];function SV(a){var l=EV;return O2(a,l)}function xV(a){var l=TV(a,["__cssMap","__cssVars","__breakpoints"]);return l}function Bg(){return Bg=Object.assign||function(a){for(var l=1;l<arguments.length;l++){var h=arguments[l];for(var s in h)Object.prototype.hasOwnProperty.call(h,s)&&(a[s]=h[s])}return a},Bg.apply(this,arguments)}function AV(a){var l,h=xV(a),s=SV(h),c=(l=h.config)==null?void 0:l.cssVarPrefix,{cssMap:E,cssVars:m}=yV(s,{cssVarPrefix:c}),S={"--chakra-ring-inset":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-ring-offset-width":"0px","--chakra-ring-offset-color":"#fff","--chakra-ring-color":"rgba(66, 153, 225, 0.6)","--chakra-ring-offset-shadow":"0 0 #0000","--chakra-ring-shadow":"0 0 #0000","--chakra-space-x-reverse":"0","--chakra-space-y-reverse":"0"};return Object.assign(h,{__cssVars:Bg({},S,m),__cssMap:E,__breakpoints:B2(h.breakpoints)}),h}var PV=typeof Element!="undefined",CV=typeof Map=="function",RV=typeof Set=="function",OV=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function Zd(a,l){if(a===l)return!0;if(a&&l&&typeof a=="object"&&typeof l=="object"){if(a.constructor!==l.constructor)return!1;var h,s,c;if(Array.isArray(a)){if(h=a.length,h!=l.length)return!1;for(s=h;s--!=0;)if(!Zd(a[s],l[s]))return!1;return!0}var E;if(CV&&a instanceof Map&&l instanceof Map){if(a.size!==l.size)return!1;for(E=a.entries();!(s=E.next()).done;)if(!l.has(s.value[0]))return!1;for(E=a.entries();!(s=E.next()).done;)if(!Zd(s.value[1],l.get(s.value[0])))return!1;return!0}if(RV&&a instanceof Set&&l instanceof Set){if(a.size!==l.size)return!1;for(E=a.entries();!(s=E.next()).done;)if(!l.has(s.value[0]))return!1;return!0}if(OV&&ArrayBuffer.isView(a)&&ArrayBuffer.isView(l)){if(h=a.length,h!=l.length)return!1;for(s=h;s--!=0;)if(a[s]!==l[s])return!1;return!0}if(a.constructor===RegExp)return a.source===l.source&&a.flags===l.flags;if(a.valueOf!==Object.prototype.valueOf)return a.valueOf()===l.valueOf();if(a.toString!==Object.prototype.toString)return a.toString()===l.toString();if(c=Object.keys(a),h=c.length,h!==Object.keys(l).length)return!1;for(s=h;s--!=0;)if(!Object.prototype.hasOwnProperty.call(l,c[s]))return!1;if(PV&&a instanceof Element)return!1;for(s=h;s--!=0;)if(!((c[s]==="_owner"||c[s]==="__v"||c[s]==="__o")&&a.$$typeof)&&!Zd(a[c[s]],l[c[s]]))return!1;return!0}return a!==a&&l!==l}var MV=function(l,h){try{return Zd(l,h)}catch(s){if((s.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw s}},IV=a=>{var{cssVarsRoot:l=":host, :root",theme:h,children:s}=a,c=Vn(()=>AV(h),[h]);return $e(nA,{theme:c},$e(Fd,{styles:E=>({[l]:E.__cssVars})}),s)};function jA(){var a=cn(qi);if(!a)throw Error("useTheme: `theme` is undefined. Seems you forgot to wrap your app in `<ChakraProvider />` or `<ThemeProvider />`");return a}var[zA,la]=ca({name:"StylesContext",errorMessage:"useStyles: `styles` is undefined. Seems you forgot to wrap the components in `<StylesProvider />` "}),DV=()=>{var{colorMode:a}=PA();return $e(Fd,{styles:l=>{var h=Bd(l,"styles.global"),s=$i(h,{theme:l,colorMode:a});if(!!s){var c=wA(s)(l);return c}}})},wV=["a","b","article","aside","blockquote","button","caption","cite","circle","code","dd","div","dl","dt","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hr","img","input","kbd","label","li","main","mark","nav","ol","p","path","pre","q","rect","s","svg","section","select","strong","small","span","sub","sup","table","tbody","td","textarea","tfoot","th","thead","tr","ul"];function ua(a){return sA(a,["styleConfig","size","variant","colorScheme"])}function Ug(){return Ug=Object.assign||function(a){for(var l=1;l<arguments.length;l++){var h=arguments[l];for(var s in h)Object.prototype.hasOwnProperty.call(h,s)&&(a[s]=h[s])}return a},Ug.apply(this,arguments)}function LV(){var a=PA(),l=jA();return Ug({},a,{theme:l})}var NV=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|download|draggable|encType|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,FV=Gx(function(a){return NV.test(a)||a.charCodeAt(0)===111&&a.charCodeAt(1)===110&&a.charCodeAt(2)<91}),BV=FV,UV=function(l){return l!=="theme"},GA=function(l){return typeof l=="string"&&l.charCodeAt(0)>96?BV:UV},HA=function(l,h,s){var c;if(h){var E=h.shouldForwardProp;c=l.__emotion_forwardProp&&E?function(m){return l.__emotion_forwardProp(m)&&E(m)}:E}return typeof c!="function"&&s&&(c=l.__emotion_forwardProp),c},VV=function a(l,h){var s=l.__emotion_real===l,c=s&&l.__emotion_base||l,E,m;h!==void 0&&(E=h.label,m=h.target);var S=HA(l,h,s),d=S||GA(c),M=!d("as");return function(){var C=arguments,I=s&&l.__emotion_styles!==void 0?l.__emotion_styles.slice(0):[];if(E!==void 0&&I.push("label:"+E+";"),C[0]==null||C[0].raw===void 0)I.push.apply(I,C);else{I.push(C[0][0]);for(var b=C.length,p=1;p<b;p++)I.push(C[p],C[0][p])}var x=Hl(function(P,A,T){var _=M&&P.as||c,g="",O=[],R=P;if(P.theme==null){R={};for(var N in P)R[N]=P[N];R.theme=cn(qi)}typeof P.className=="string"?g=tg(A.registered,O,P.className):P.className!=null&&(g=P.className+" ");var V=Gl(I.concat(O),A.registered,R);Nd(A,V,typeof _=="string"),g+=A.key+"-"+V.name,m!==void 0&&(g+=" "+m);var U=M&&S===void 0?GA(_):d,L={};for(var j in P)M&&j==="as"||U(j)&&(L[j]=P[j]);L.className=g,L.ref=T;var Y=$e(_,L);return Y});return x.displayName=E!==void 0?E:"Styled("+(typeof c=="string"?c:c.displayName||c.name||"Component")+")",x.defaultProps=l.defaultProps,x.__emotion_real=x,x.__emotion_base=c,x.__emotion_styles=I,x.__emotion_forwardProp=S,Object.defineProperty(x,"toString",{value:function(){return"."+m}}),x.withComponent=function(P,A){return a(P,sa({},h,A,{shouldForwardProp:HA(x,A,!0)})).apply(void 0,I)},x}},kV=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"],Vg=VV.bind();kV.forEach(function(a){Vg[a]=Vg(a)});var jV=new Set([...lV,"textStyle","layerStyle","apply","isTruncated","noOfLines","focusBorderColor","errorBorderColor","as","__css","css","sx"]),zV=new Set(["htmlWidth","htmlHeight","htmlSize"]),GV=a=>zV.has(a)||!jV.has(a);function WA(a,l){if(a==null)return{};var h={},s=Object.keys(a),c,E;for(E=0;E<s.length;E++)c=s[E],!(l.indexOf(c)>=0)&&(h[c]=a[c]);return h}var HV=a=>{var{baseStyle:l}=a;return h=>{var{css:s,__css:c,sx:E}=h,m=WA(h,["theme","css","__css","sx"]),S=cA(m,(I,b)=>hV(b)),d=$i(l,h),M=Object.assign({},c,d,Ud(S),E),C=wA(M)(h.theme);return s?[C,s]:C}};function WV(a,l){var h=l??{},{baseStyle:s}=h,c=WA(h,["baseStyle"]);c.shouldForwardProp||(c.shouldForwardProp=GV);var E=HV({baseStyle:s});return Vg(a,c)(E)}var nn=WV;wV.forEach(a=>{nn[a]=nn(a)});function Dn(a){return Oi(a)}function XV(a,l){if(a==null)return{};var h={},s=Object.keys(a),c,E;for(E=0;E<s.length;E++)c=s[E],!(l.indexOf(c)>=0)&&(h[c]=a[c]);return h}function $l(a,l,h){var s;l===void 0&&(l={}),h===void 0&&(h={});var{styleConfig:c}=l,E=XV(l,["styleConfig"]),{theme:m,colorMode:S}=LV(),d=Bd(m,"components."+a),M=c||d,C=yo({theme:m,colorMode:S},(s=M==null?void 0:M.defaultProps)!=null?s:{},Ud(sA(E,["children"]))),I=zt({});if(M){var b,p,x,P,A,T,_=$i((b=M.baseStyle)!=null?b:{},C),g=$i((p=(x=M.variants)==null?void 0:x[C.variant])!=null?p:{},C),O=$i((P=(A=M.sizes)==null?void 0:A[C.size])!=null?P:{},C),R=yo({},_,O,g);(T=h)!=null&&T.isMultiPart&&M.parts&&M.parts.forEach(V=>{var U;R[V]=(U=R[V])!=null?U:{}});var N=MV(I.current,R);N||(I.current=R)}return I.current}function Jl(a,l){return $l(a,l,{isMultiPart:!0})}var YV={body:{classList:{add(){},remove(){}}},addEventListener(){},removeEventListener(){},activeElement:{blur(){},nodeName:""},querySelector(){return null},querySelectorAll(){return[]},getElementById(){return null},createEvent(){return{initEvent(){}}},createElement(){return{children:[],childNodes:[],style:{},setAttribute(){},getElementsByTagName(){return[]}}}},XA=YV,sc=()=>{},KV={document:XA,navigator:{userAgent:""},CustomEvent:function(){return this},addEventListener:sc,removeEventListener:sc,getComputedStyle(){return{getPropertyValue(){return""}}},matchMedia(){return{matches:!1,addListener:sc,removeListener:sc}},requestAnimationFrame(a){return typeof setTimeout=="undefined"?(a(),null):setTimeout(a,0)},cancelAnimationFrame(a){typeof setTimeout!="undefined"&&clearTimeout(a)},setTimeout:()=>0,clearTimeout:sc,setInterval:()=>0,clearInterval:sc},QV=KV,qV={window:QV,document:XA},YA=tc?{window,document}:qV,ZV=Sr(YA);function $V(a){var{children:l,environment:h}=a,[s,c]=un(null),E=Vn(()=>{var S,d=s==null?void 0:s.ownerDocument,M=s==null?void 0:s.ownerDocument.defaultView,C=d?{document:d,window:M}:void 0,I=(S=h??C)!=null?S:YA;return I},[s,h]),m=!s&&!h;return ei.createElement(ZV.Provider,{value:E},l,m&&ei.createElement("span",{ref:S=>{S&&c(S)}}))}var JV=a=>{var{children:l,colorModeManager:h,portalZIndex:s,resetCSS:c=!0,theme:E={},environment:m,cssVarsRoot:S}=a,d=$e($V,{environment:m},l);return $e(lU,null,$e(IV,{theme:E,cssVarsRoot:S},$e(CA,{colorModeManager:h,options:E.config},c&&$e(P2,null),$e(DV,null),s?$e(vA,{zIndex:s},d):d)))};function Ar(a,l){ek(a)&&(a="100%");var h=tk(a);return a=l===360?a:Math.min(l,Math.max(0,parseFloat(a))),h&&(a=parseInt(String(a*l),10)/100),Math.abs(a-l)<1e-6?1:(l===360?a=(a<0?a%l+l:a%l)/parseFloat(String(l)):a=a%l/parseFloat(String(l)),a)}function $d(a){return Math.min(1,Math.max(0,a))}function ek(a){return typeof a=="string"&&a.indexOf(".")!==-1&&parseFloat(a)===1}function tk(a){return typeof a=="string"&&a.indexOf("%")!==-1}function KA(a){return a=parseFloat(a),(isNaN(a)||a<0||a>1)&&(a=1),a}function Jd(a){return a<=1?Number(a)*100+"%":a}function Ha(a){return a.length===1?"0"+a:String(a)}function nk(a,l,h){return{r:Ar(a,255)*255,g:Ar(l,255)*255,b:Ar(h,255)*255}}function QA(a,l,h){a=Ar(a,255),l=Ar(l,255),h=Ar(h,255);var s=Math.max(a,l,h),c=Math.min(a,l,h),E=0,m=0,S=(s+c)/2;if(s===c)m=0,E=0;else{var d=s-c;switch(m=S>.5?d/(2-s-c):d/(s+c),s){case a:E=(l-h)/d+(l<h?6:0);break;case l:E=(h-a)/d+2;break;case h:E=(a-l)/d+4;break}E/=6}return{h:E,s:m,l:S}}function kg(a,l,h){return h<0&&(h+=1),h>1&&(h-=1),h<1/6?a+(l-a)*(6*h):h<1/2?l:h<2/3?a+(l-a)*(2/3-h)*6:a}function rk(a,l,h){var s,c,E;if(a=Ar(a,360),l=Ar(l,100),h=Ar(h,100),l===0)c=h,E=h,s=h;else{var m=h<.5?h*(1+l):h+l-h*l,S=2*h-m;s=kg(S,m,a+1/3),c=kg(S,m,a),E=kg(S,m,a-1/3)}return{r:s*255,g:c*255,b:E*255}}function qA(a,l,h){a=Ar(a,255),l=Ar(l,255),h=Ar(h,255);var s=Math.max(a,l,h),c=Math.min(a,l,h),E=0,m=s,S=s-c,d=s===0?0:S/s;if(s===c)E=0;else{switch(s){case a:E=(l-h)/S+(l<h?6:0);break;case l:E=(h-a)/S+2;break;case h:E=(a-l)/S+4;break}E/=6}return{h:E,s:d,v:m}}function ik(a,l,h){a=Ar(a,360)*6,l=Ar(l,100),h=Ar(h,100);var s=Math.floor(a),c=a-s,E=h*(1-l),m=h*(1-c*l),S=h*(1-(1-c)*l),d=s%6,M=[h,m,E,E,S,h][d],C=[S,h,h,m,E,E][d],I=[E,E,S,h,h,m][d];return{r:M*255,g:C*255,b:I*255}}function ZA(a,l,h,s){var c=[Ha(Math.round(a).toString(16)),Ha(Math.round(l).toString(16)),Ha(Math.round(h).toString(16))];return s&&c[0].startsWith(c[0].charAt(1))&&c[1].startsWith(c[1].charAt(1))&&c[2].startsWith(c[2].charAt(1))?c[0].charAt(0)+c[1].charAt(0)+c[2].charAt(0):c.join("")}function ok(a,l,h,s,c){var E=[Ha(Math.round(a).toString(16)),Ha(Math.round(l).toString(16)),Ha(Math.round(h).toString(16)),Ha(ak(s))];return c&&E[0].startsWith(E[0].charAt(1))&&E[1].startsWith(E[1].charAt(1))&&E[2].startsWith(E[2].charAt(1))&&E[3].startsWith(E[3].charAt(1))?E[0].charAt(0)+E[1].charAt(0)+E[2].charAt(0)+E[3].charAt(0):E.join("")}function ak(a){return Math.round(parseFloat(a)*255).toString(16)}function $A(a){return ri(a)/255}function ri(a){return parseInt(a,16)}function sk(a){return{r:a>>16,g:(a&65280)>>8,b:a&255}}var jg={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",goldenrod:"#daa520",gold:"#ffd700",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavenderblush:"#fff0f5",lavender:"#e6e6fa",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};function ck(a){var l={r:0,g:0,b:0},h=1,s=null,c=null,E=null,m=!1,S=!1;return typeof a=="string"&&(a=hk(a)),typeof a=="object"&&(To(a.r)&&To(a.g)&&To(a.b)?(l=nk(a.r,a.g,a.b),m=!0,S=String(a.r).substr(-1)==="%"?"prgb":"rgb"):To(a.h)&&To(a.s)&&To(a.v)?(s=Jd(a.s),c=Jd(a.v),l=ik(a.h,s,c),m=!0,S="hsv"):To(a.h)&&To(a.s)&&To(a.l)&&(s=Jd(a.s),E=Jd(a.l),l=rk(a.h,s,E),m=!0,S="hsl"),Object.prototype.hasOwnProperty.call(a,"a")&&(h=a.a)),h=KA(h),{ok:m,format:a.format||S,r:Math.min(255,Math.max(l.r,0)),g:Math.min(255,Math.max(l.g,0)),b:Math.min(255,Math.max(l.b,0)),a:h}}var lk="[-\\+]?\\d+%?",uk="[-\\+]?\\d*\\.\\d+%?",ha="(?:"+uk+")|(?:"+lk+")",zg="[\\s|\\(]+("+ha+")[,|\\s]+("+ha+")[,|\\s]+("+ha+")\\s*\\)?",Gg="[\\s|\\(]+("+ha+")[,|\\s]+("+ha+")[,|\\s]+("+ha+")[,|\\s]+("+ha+")\\s*\\)?",Li={CSS_UNIT:new RegExp(ha),rgb:new RegExp("rgb"+zg),rgba:new RegExp("rgba"+Gg),hsl:new RegExp("hsl"+zg),hsla:new RegExp("hsla"+Gg),hsv:new RegExp("hsv"+zg),hsva:new RegExp("hsva"+Gg),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/};function hk(a){if(a=a.trim().toLowerCase(),a.length===0)return!1;var l=!1;if(jg[a])a=jg[a],l=!0;else if(a==="transparent")return{r:0,g:0,b:0,a:0,format:"name"};var h=Li.rgb.exec(a);return h?{r:h[1],g:h[2],b:h[3]}:(h=Li.rgba.exec(a),h?{r:h[1],g:h[2],b:h[3],a:h[4]}:(h=Li.hsl.exec(a),h?{h:h[1],s:h[2],l:h[3]}:(h=Li.hsla.exec(a),h?{h:h[1],s:h[2],l:h[3],a:h[4]}:(h=Li.hsv.exec(a),h?{h:h[1],s:h[2],v:h[3]}:(h=Li.hsva.exec(a),h?{h:h[1],s:h[2],v:h[3],a:h[4]}:(h=Li.hex8.exec(a),h?{r:ri(h[1]),g:ri(h[2]),b:ri(h[3]),a:$A(h[4]),format:l?"name":"hex8"}:(h=Li.hex6.exec(a),h?{r:ri(h[1]),g:ri(h[2]),b:ri(h[3]),format:l?"name":"hex"}:(h=Li.hex4.exec(a),h?{r:ri(h[1]+h[1]),g:ri(h[2]+h[2]),b:ri(h[3]+h[3]),a:$A(h[4]+h[4]),format:l?"name":"hex8"}:(h=Li.hex3.exec(a),h?{r:ri(h[1]+h[1]),g:ri(h[2]+h[2]),b:ri(h[3]+h[3]),format:l?"name":"hex"}:!1)))))))))}function To(a){return Boolean(Li.CSS_UNIT.exec(String(a)))}var eu=function(){function a(l,h){l===void 0&&(l=""),h===void 0&&(h={});var s;if(l instanceof a)return l;typeof l=="number"&&(l=sk(l)),this.originalInput=l;var c=ck(l);this.originalInput=l,this.r=c.r,this.g=c.g,this.b=c.b,this.a=c.a,this.roundA=Math.round(100*this.a)/100,this.format=(s=h.format)!==null&&s!==void 0?s:c.format,this.gradientType=h.gradientType,this.r<1&&(this.r=Math.round(this.r)),this.g<1&&(this.g=Math.round(this.g)),this.b<1&&(this.b=Math.round(this.b)),this.isValid=c.ok}return a.prototype.isDark=function(){return this.getBrightness()<128},a.prototype.isLight=function(){return!this.isDark()},a.prototype.getBrightness=function(){var l=this.toRgb();return(l.r*299+l.g*587+l.b*114)/1e3},a.prototype.getLuminance=function(){var l=this.toRgb(),h,s,c,E=l.r/255,m=l.g/255,S=l.b/255;return E<=.03928?h=E/12.92:h=Math.pow((E+.055)/1.055,2.4),m<=.03928?s=m/12.92:s=Math.pow((m+.055)/1.055,2.4),S<=.03928?c=S/12.92:c=Math.pow((S+.055)/1.055,2.4),.2126*h+.7152*s+.0722*c},a.prototype.getAlpha=function(){return this.a},a.prototype.setAlpha=function(l){return this.a=KA(l),this.roundA=Math.round(100*this.a)/100,this},a.prototype.toHsv=function(){var l=qA(this.r,this.g,this.b);return{h:l.h*360,s:l.s,v:l.v,a:this.a}},a.prototype.toHsvString=function(){var l=qA(this.r,this.g,this.b),h=Math.round(l.h*360),s=Math.round(l.s*100),c=Math.round(l.v*100);return this.a===1?"hsv("+h+", "+s+"%, "+c+"%)":"hsva("+h+", "+s+"%, "+c+"%, "+this.roundA+")"},a.prototype.toHsl=function(){var l=QA(this.r,this.g,this.b);return{h:l.h*360,s:l.s,l:l.l,a:this.a}},a.prototype.toHslString=function(){var l=QA(this.r,this.g,this.b),h=Math.round(l.h*360),s=Math.round(l.s*100),c=Math.round(l.l*100);return this.a===1?"hsl("+h+", "+s+"%, "+c+"%)":"hsla("+h+", "+s+"%, "+c+"%, "+this.roundA+")"},a.prototype.toHex=function(l){return l===void 0&&(l=!1),ZA(this.r,this.g,this.b,l)},a.prototype.toHexString=function(l){return l===void 0&&(l=!1),"#"+this.toHex(l)},a.prototype.toHex8=function(l){return l===void 0&&(l=!1),ok(this.r,this.g,this.b,this.a,l)},a.prototype.toHex8String=function(l){return l===void 0&&(l=!1),"#"+this.toHex8(l)},a.prototype.toRgb=function(){return{r:Math.round(this.r),g:Math.round(this.g),b:Math.round(this.b),a:this.a}},a.prototype.toRgbString=function(){var l=Math.round(this.r),h=Math.round(this.g),s=Math.round(this.b);return this.a===1?"rgb("+l+", "+h+", "+s+")":"rgba("+l+", "+h+", "+s+", "+this.roundA+")"},a.prototype.toPercentageRgb=function(){var l=function(h){return Math.round(Ar(h,255)*100)+"%"};return{r:l(this.r),g:l(this.g),b:l(this.b),a:this.a}},a.prototype.toPercentageRgbString=function(){var l=function(h){return Math.round(Ar(h,255)*100)};return this.a===1?"rgb("+l(this.r)+"%, "+l(this.g)+"%, "+l(this.b)+"%)":"rgba("+l(this.r)+"%, "+l(this.g)+"%, "+l(this.b)+"%, "+this.roundA+")"},a.prototype.toName=function(){if(this.a===0)return"transparent";if(this.a<1)return!1;for(var l="#"+ZA(this.r,this.g,this.b,!1),h=0,s=Object.entries(jg);h<s.length;h++){var c=s[h],E=c[0],m=c[1];if(l===m)return E}return!1},a.prototype.toString=function(l){var h=Boolean(l);l=l??this.format;var s=!1,c=this.a<1&&this.a>=0,E=!h&&c&&(l.startsWith("hex")||l==="name");return E?l==="name"&&this.a===0?this.toName():this.toRgbString():(l==="rgb"&&(s=this.toRgbString()),l==="prgb"&&(s=this.toPercentageRgbString()),(l==="hex"||l==="hex6")&&(s=this.toHexString()),l==="hex3"&&(s=this.toHexString(!0)),l==="hex4"&&(s=this.toHex8String(!0)),l==="hex8"&&(s=this.toHex8String()),l==="name"&&(s=this.toName()),l==="hsl"&&(s=this.toHslString()),l==="hsv"&&(s=this.toHsvString()),s||this.toHexString())},a.prototype.toNumber=function(){return(Math.round(this.r)<<16)+(Math.round(this.g)<<8)+Math.round(this.b)},a.prototype.clone=function(){return new a(this.toString())},a.prototype.lighten=function(l){l===void 0&&(l=10);var h=this.toHsl();return h.l+=l/100,h.l=$d(h.l),new a(h)},a.prototype.brighten=function(l){l===void 0&&(l=10);var h=this.toRgb();return h.r=Math.max(0,Math.min(255,h.r-Math.round(255*-(l/100)))),h.g=Math.max(0,Math.min(255,h.g-Math.round(255*-(l/100)))),h.b=Math.max(0,Math.min(255,h.b-Math.round(255*-(l/100)))),new a(h)},a.prototype.darken=function(l){l===void 0&&(l=10);var h=this.toHsl();return h.l-=l/100,h.l=$d(h.l),new a(h)},a.prototype.tint=function(l){return l===void 0&&(l=10),this.mix("white",l)},a.prototype.shade=function(l){return l===void 0&&(l=10),this.mix("black",l)},a.prototype.desaturate=function(l){l===void 0&&(l=10);var h=this.toHsl();return h.s-=l/100,h.s=$d(h.s),new a(h)},a.prototype.saturate=function(l){l===void 0&&(l=10);var h=this.toHsl();return h.s+=l/100,h.s=$d(h.s),new a(h)},a.prototype.greyscale=function(){return this.desaturate(100)},a.prototype.spin=function(l){var h=this.toHsl(),s=(h.h+l)%360;return h.h=s<0?360+s:s,new a(h)},a.prototype.mix=function(l,h){h===void 0&&(h=50);var s=this.toRgb(),c=new a(l).toRgb(),E=h/100,m={r:(c.r-s.r)*E+s.r,g:(c.g-s.g)*E+s.g,b:(c.b-s.b)*E+s.b,a:(c.a-s.a)*E+s.a};return new a(m)},a.prototype.analogous=function(l,h){l===void 0&&(l=6),h===void 0&&(h=30);var s=this.toHsl(),c=360/h,E=[this];for(s.h=(s.h-(c*l>>1)+720)%360;--l;)s.h=(s.h+c)%360,E.push(new a(s));return E},a.prototype.complement=function(){var l=this.toHsl();return l.h=(l.h+180)%360,new a(l)},a.prototype.monochromatic=function(l){l===void 0&&(l=6);for(var h=this.toHsv(),s=h.h,c=h.s,E=h.v,m=[],S=1/l;l--;)m.push(new a({h:s,s:c,v:E})),E=(E+S)%1;return m},a.prototype.splitcomplement=function(){var l=this.toHsl(),h=l.h;return[this,new a({h:(h+72)%360,s:l.s,l:l.l}),new a({h:(h+216)%360,s:l.s,l:l.l})]},a.prototype.onBackground=function(l){var h=this.toRgb(),s=new a(l).toRgb();return new a({r:s.r+(h.r-s.r)*h.a,g:s.g+(h.g-s.g)*h.a,b:s.b+(h.b-s.b)*h.a})},a.prototype.triad=function(){return this.polyad(3)},a.prototype.tetrad=function(){return this.polyad(4)},a.prototype.polyad=function(l){for(var h=this.toHsl(),s=h.h,c=[this],E=360/l,m=1;m<l;m++)c.push(new a({h:(s+m*E)%360,s:h.s,l:h.l}));return c},a.prototype.equals=function(l){return this.toRgbString()===new a(l).toRgbString()},a}();function JA(a){if(a===void 0&&(a={}),a.count!==void 0&&a.count!==null){var l=a.count,h=[];for(a.count=void 0;l>h.length;)a.count=null,a.seed&&(a.seed+=1),h.push(JA(a));return a.count=l,h}var s=dk(a.hue,a.seed),c=fk(s,a),E=pk(s,c,a),m={h:s,s:c,v:E};return a.alpha!==void 0&&(m.a=a.alpha),new eu(m)}function dk(a,l){var h=_k(a),s=ef(h,l);return s<0&&(s=360+s),s}function fk(a,l){if(l.hue==="monochrome")return 0;if(l.luminosity==="random")return ef([0,100],l.seed);var h=eP(a).saturationRange,s=h[0],c=h[1];switch(l.luminosity){case"bright":s=55;break;case"dark":s=c-10;break;case"light":c=55;break}return ef([s,c],l.seed)}function pk(a,l,h){var s=mk(a,l),c=100;switch(h.luminosity){case"dark":c=s+20;break;case"light":s=(c+s)/2;break;case"random":s=0,c=100;break}return ef([s,c],h.seed)}function mk(a,l){for(var h=eP(a).lowerBounds,s=0;s<h.length-1;s++){var c=h[s][0],E=h[s][1],m=h[s+1][0],S=h[s+1][1];if(l>=c&&l<=m){var d=(S-E)/(m-c),M=E-d*c;return d*l+M}}return 0}function _k(a){var l=parseInt(a,10);if(!Number.isNaN(l)&&l<360&&l>0)return[l,l];if(typeof a=="string"){var h=nP.find(function(m){return m.name===a});if(h){var s=tP(h);if(s.hueRange)return s.hueRange}var c=new eu(a);if(c.isValid){var E=c.toHsv().h;return[E,E]}}return[0,360]}function eP(a){a>=334&&a<=360&&(a-=360);for(var l=0,h=nP;l<h.length;l++){var s=h[l],c=tP(s);if(c.hueRange&&a>=c.hueRange[0]&&a<=c.hueRange[1])return c}throw Error("Color not found")}function ef(a,l){if(l===void 0)return Math.floor(a[0]+Math.random()*(a[1]+1-a[0]));var h=a[1]||1,s=a[0]||0;l=(l*9301+49297)%233280;var c=l/233280;return Math.floor(s+c*(h-s))}function tP(a){var l=a.lowerBounds[0][0],h=a.lowerBounds[a.lowerBounds.length-1][0],s=a.lowerBounds[a.lowerBounds.length-1][1],c=a.lowerBounds[0][1];return{name:a.name,hueRange:a.hueRange,lowerBounds:a.lowerBounds,saturationRange:[l,h],brightnessRange:[s,c]}}var nP=[{name:"monochrome",hueRange:null,lowerBounds:[[0,0],[100,0]]},{name:"red",hueRange:[-26,18],lowerBounds:[[20,100],[30,92],[40,89],[50,85],[60,78],[70,70],[80,60],[90,55],[100,50]]},{name:"orange",hueRange:[19,46],lowerBounds:[[20,100],[30,93],[40,88],[50,86],[60,85],[70,70],[100,70]]},{name:"yellow",hueRange:[47,62],lowerBounds:[[25,100],[40,94],[50,89],[60,86],[70,84],[80,82],[90,80],[100,75]]},{name:"green",hueRange:[63,178],lowerBounds:[[30,100],[40,90],[50,85],[60,81],[70,74],[80,64],[90,50],[100,40]]},{name:"blue",hueRange:[179,257],lowerBounds:[[20,100],[30,86],[40,80],[50,74],[60,60],[70,52],[80,44],[90,39],[100,35]]},{name:"purple",hueRange:[258,282],lowerBounds:[[20,100],[30,87],[40,79],[50,70],[60,65],[70,59],[80,52],[90,45],[100,42]]},{name:"pink",hueRange:[283,334],lowerBounds:[[20,100],[30,90],[40,86],[60,84],[80,80],[90,75],[100,73]]}],hr=(a,l,h)=>{var s=Bd(a,"colors."+l,l),{isValid:c}=new eu(s);return c?s:h},gk=a=>l=>{var h=hr(l,a),s=new eu(h).isDark();return s?"dark":"light"},vk=a=>l=>gk(a)(l)==="dark",cc=(a,l)=>h=>{var s=hr(h,a);return new eu(s).setAlpha(l).toRgbString()};function rP(a,l){return a===void 0&&(a="1rem"),l===void 0&&(l="rgba(255, 255, 255, 0.15)"),{backgroundImage:`linear-gradient(
    45deg,
    `+l+` 25%,
    transparent 25%,
    transparent 50%,
    `+l+` 50%,
    `+l+` 75%,
    transparent 75%,
    transparent
  )`,backgroundSize:a+" "+a}}function bk(a){var l=JA().toHexString();return!a||R2(a)?l:a.string&&a.colors?Tk(a.string,a.colors):a.string&&!a.colors?yk(a.string):a.colors&&!a.string?Ek(a.colors):l}function yk(a){var l=0;if(a.length===0)return l.toString();for(var h=0;h<a.length;h+=1)l=a.charCodeAt(h)+((l<<5)-l),l=l&l;for(var s="#",c=0;c<3;c+=1){var E=l>>c*8&255;s+=("00"+E.toString(16)).substr(-2)}return s}function Tk(a,l){var h=0;if(a.length===0)return l[0];for(var s=0;s<a.length;s+=1)h=a.charCodeAt(s)+((h<<5)-h),h=h&h;return h=(h%l.length+l.length)%l.length,l[h]}function Ek(a){return a[Math.floor(Math.random()*a.length)]}function st(a,l){return h=>h.colorMode==="dark"?l:a}function tu(a){var{orientation:l,vertical:h,horizontal:s}=a;return l?l==="vertical"?h:s:{}}function Hg(){return Hg=Object.assign||function(a){for(var l=1;l<arguments.length;l++){var h=arguments[l];for(var s in h)Object.prototype.hasOwnProperty.call(h,s)&&(a[s]=h[s])}return a},Hg.apply(this,arguments)}var Sk=a=>(pg({condition:!0,message:["[chakra-ui]: createBreakpoints(...) will be deprecated pretty soon","simply pass the breakpoints as an object. Remove the createBreakpoint(..) call"].join("")}),Hg({base:"0em"},a));function Wa(a,l,h){return l in a?Object.defineProperty(a,l,{value:h,enumerable:!0,configurable:!0,writable:!0}):a[l]=h,a}class xk{constructor(l){var h=this;this.name=l,Wa(this,"map",{}),Wa(this,"called",!1),Wa(this,"assert",()=>{if(!this.called){this.called=!0;return}throw new Error("[anatomy] .part(...) should only be called once. Did you mean to use .extend(...) ?")}),Wa(this,"parts",function(){h.assert();for(var s=arguments.length,c=new Array(s),E=0;E<s;E++)c[E]=arguments[E];for(var m of c)h.map[m]=h.toPart(m);return h}),Wa(this,"extend",function(){for(var s=arguments.length,c=new Array(s),E=0;E<s;E++)c[E]=arguments[E];for(var m of c)m in h.map||(h.map[m]=h.toPart(m));return h}),Wa(this,"toPart",s=>{var c=["container","root"].includes(s??"")?[this.name]:[this.name,s],E=c.filter(Boolean).join("__"),m="chakra-"+E,S={className:m,selector:"."+m,toString:()=>s};return S}),Wa(this,"__type",{})}get selectors(){var l=Object.fromEntries(Object.entries(this.map).map(h=>{var[s,c]=h;return[s,c.selector]}));return l}get classNames(){var l=Object.fromEntries(Object.entries(this.map).map(h=>{var[s,c]=h;return[s,c.className]}));return l}get keys(){return Object.keys(this.map)}}function wn(a){return new xk(a)}function iP(a){return Di(a)&&a.reference?a.reference:String(a)}var tf=function(l){for(var h=arguments.length,s=new Array(h>1?h-1:0),c=1;c<h;c++)s[c-1]=arguments[c];return s.map(iP).join(" "+l+" ").replace(/calc/g,"")},oP=function(){for(var l=arguments.length,h=new Array(l),s=0;s<l;s++)h[s]=arguments[s];return"calc("+tf("+",...h)+")"},aP=function(){for(var l=arguments.length,h=new Array(l),s=0;s<l;s++)h[s]=arguments[s];return"calc("+tf("-",...h)+")"},Wg=function(){for(var l=arguments.length,h=new Array(l),s=0;s<l;s++)h[s]=arguments[s];return"calc("+tf("*",...h)+")"},sP=function(){for(var l=arguments.length,h=new Array(l),s=0;s<l;s++)h[s]=arguments[s];return"calc("+tf("/",...h)+")"},cP=a=>{var l=iP(a);return l!=null&&!Number.isNaN(parseFloat(l))?String(l).startsWith("-")?String(l).slice(1):"-"+l:Wg(l,-1)},Eo=Object.assign(a=>({add:function(){for(var h=arguments.length,s=new Array(h),c=0;c<h;c++)s[c]=arguments[c];return Eo(oP(a,...s))},subtract:function(){for(var h=arguments.length,s=new Array(h),c=0;c<h;c++)s[c]=arguments[c];return Eo(aP(a,...s))},multiply:function(){for(var h=arguments.length,s=new Array(h),c=0;c<h;c++)s[c]=arguments[c];return Eo(Wg(a,...s))},divide:function(){for(var h=arguments.length,s=new Array(h),c=0;c<h;c++)s[c]=arguments[c];return Eo(sP(a,...s))},negate:()=>Eo(cP(a)),toString:()=>a.toString()}),{add:oP,subtract:aP,multiply:Wg,divide:sP,negate:cP});function Ak(a){return!Number.isInteger(parseFloat(a.toString()))}function Pk(a,l){return l===void 0&&(l="-"),a.replace(/\s+/g,l)}function lP(a){var l=Pk(a.toString());return l.includes("\\.")?a:Ak(a)?l.replace(".","\\."):a}function Ck(a,l){return l===void 0&&(l=""),[l,lP(a)].filter(Boolean).join("-")}function Rk(a,l){return"var("+lP(a)+(l?", "+l:"")+")"}function Ok(a,l){return l===void 0&&(l=""),"--"+Ck(a,l)}function ii(a,l){var h=Ok(a,l==null?void 0:l.prefix);return{variable:h,reference:Rk(h,Mk(l==null?void 0:l.fallback))}}function Mk(a){return typeof a=="string"?a:a==null?void 0:a.reference}var Ik=wn("accordion").parts("container","item","button","panel").extend("icon"),Dk=wn("alert").parts("title","description","container").extend("icon"),wk=wn("avatar").parts("label","badge","container").extend("excessLabel","group"),Lk=wn("breadcrumb").parts("link","item","container").extend("separator");wn("button").parts();var Nk=wn("checkbox").parts("control","icon","container").extend("label");wn("progress").parts("track","filledTrack").extend("label");var Fk=wn("drawer").parts("overlay","dialogContainer","dialog").extend("header","closeButton","body","footer"),Bk=wn("editable").parts("preview","input"),Uk=wn("form").parts("container","requiredIndicator","helperText"),Vk=wn("formError").parts("text","icon"),kk=wn("input").parts("addon","field","element"),jk=wn("list").parts("container","item","icon"),zk=wn("menu").parts("button","list","item").extend("groupTitle","command","divider"),Gk=wn("modal").parts("overlay","dialogContainer","dialog").extend("header","closeButton","body","footer"),Hk=wn("numberinput").parts("root","field","stepperGroup","stepper");wn("pininput").parts("field");var Wk=wn("popover").parts("content","header","body","footer").extend("popper","arrow"),Xk=wn("progress").parts("label","filledTrack","track"),Yk=wn("radio").parts("container","control","label"),Kk=wn("select").parts("field","icon"),Qk=wn("slider").parts("container","track","thumb","filledTrack"),qk=wn("stat").parts("container","label","helpText","number","icon"),Zk=wn("switch").parts("container","track","thumb"),$k=wn("table").parts("table","thead","tbody","tr","th","td","tfoot","caption"),Jk=wn("tabs").parts("root","tab","tablist","tabpanel","tabpanels","indicator"),e3=wn("tag").parts("container","label","closeButton"),t3={borderTopWidth:"1px",borderColor:"inherit",_last:{borderBottomWidth:"1px"}},n3={transitionProperty:"common",transitionDuration:"normal",fontSize:"1rem",_focus:{boxShadow:"outline"},_hover:{bg:"blackAlpha.50"},_disabled:{opacity:.4,cursor:"not-allowed"},px:4,py:2},r3={pt:2,px:4,pb:5},i3={fontSize:"1.25em"},o3={container:t3,button:n3,panel:r3,icon:i3},a3={parts:Ik.keys,baseStyle:o3},s3={container:{px:4,py:3},title:{fontWeight:"bold",lineHeight:6,marginEnd:2},description:{lineHeight:6},icon:{flexShrink:0,marginEnd:3,w:5,h:6}};function Xg(a){var{theme:l,colorScheme:h}=a,s=hr(l,h+".100",h),c=cc(h+".200",.16)(l);return st(s,c)(a)}var c3=a=>{var{colorScheme:l}=a;return{container:{bg:Xg(a)},icon:{color:st(l+".500",l+".200")(a)}}},l3=a=>{var{colorScheme:l}=a;return{container:{paddingStart:3,borderStartWidth:"4px",borderStartColor:st(l+".500",l+".200")(a),bg:Xg(a)},icon:{color:st(l+".500",l+".200")(a)}}},u3=a=>{var{colorScheme:l}=a;return{container:{pt:2,borderTopWidth:"4px",borderTopColor:st(l+".500",l+".200")(a),bg:Xg(a)},icon:{color:st(l+".500",l+".200")(a)}}},h3=a=>{var{colorScheme:l}=a;return{container:{bg:st(l+".500",l+".200")(a),color:st("white","gray.900")(a)}}},d3={subtle:c3,"left-accent":l3,"top-accent":u3,solid:h3},f3={variant:"subtle",colorScheme:"blue"},p3={parts:Dk.keys,baseStyle:s3,variants:d3,defaultProps:f3},uP={px:"1px",.5:"0.125rem",1:"0.25rem",1.5:"0.375rem",2:"0.5rem",2.5:"0.625rem",3:"0.75rem",3.5:"0.875rem",4:"1rem",5:"1.25rem",6:"1.5rem",7:"1.75rem",8:"2rem",9:"2.25rem",10:"2.5rem",12:"3rem",14:"3.5rem",16:"4rem",20:"5rem",24:"6rem",28:"7rem",32:"8rem",36:"9rem",40:"10rem",44:"11rem",48:"12rem",52:"13rem",56:"14rem",60:"15rem",64:"16rem",72:"18rem",80:"20rem",96:"24rem"};function Yg(){return Yg=Object.assign||function(a){for(var l=1;l<arguments.length;l++){var h=arguments[l];for(var s in h)Object.prototype.hasOwnProperty.call(h,s)&&(a[s]=h[s])}return a},Yg.apply(this,arguments)}var m3={max:"max-content",min:"min-content",full:"100%","3xs":"14rem","2xs":"16rem",xs:"20rem",sm:"24rem",md:"28rem",lg:"32rem",xl:"36rem","2xl":"42rem","3xl":"48rem","4xl":"56rem","5xl":"64rem","6xl":"72rem","7xl":"80rem","8xl":"90rem"},_3={sm:"640px",md:"768px",lg:"1024px",xl:"1280px"},g3=Yg({},uP,m3,{container:_3}),hP=g3,v3=a=>({transform:"translate(25%, 25%)",borderRadius:"full",border:"0.2em solid",borderColor:st("white","gray.800")(a)}),b3=a=>({bg:st("gray.200","whiteAlpha.400")(a)}),y3=a=>{var{name:l,theme:h}=a,s=l?bk({string:l}):"gray.400",c=vk(s)(h),E="white";c||(E="gray.800");var m=st("white","gray.800")(a);return{bg:s,color:E,borderColor:m,verticalAlign:"top"}},T3=a=>({badge:v3(a),excessLabel:b3(a),container:y3(a)});function da(a){var l=hP[a];return{container:{width:a,height:a,fontSize:"calc("+(l??a)+" / 2.5)"},excessLabel:{width:a,height:a},label:{fontSize:"calc("+(l??a)+" / 2.5)",lineHeight:a!=="100%"?l??a:void 0}}}var E3={"2xs":da("4"),xs:da("6"),sm:da("8"),md:da("12"),lg:da("16"),xl:da("24"),"2xl":da("32"),full:da("100%")},S3={size:"md"},x3={parts:wk.keys,baseStyle:T3,sizes:E3,defaultProps:S3},A3={px:1,textTransform:"uppercase",fontSize:"xs",borderRadius:"sm",fontWeight:"bold"},P3=a=>{var{colorScheme:l,theme:h}=a,s=cc(l+".500",.6)(h);return{bg:st(l+".500",s)(a),color:st("white","whiteAlpha.800")(a)}},C3=a=>{var{colorScheme:l,theme:h}=a,s=cc(l+".200",.16)(h);return{bg:st(l+".100",s)(a),color:st(l+".800",l+".200")(a)}},R3=a=>{var{colorScheme:l,theme:h}=a,s=cc(l+".200",.8)(h),c=hr(h,l+".500"),E=st(c,s)(a);return{color:E,boxShadow:"inset 0 0 0px 1px "+E}},O3={solid:P3,subtle:C3,outline:R3},M3={variant:"subtle",colorScheme:"gray"},nu={baseStyle:A3,variants:O3,defaultProps:M3},I3={transitionProperty:"common",transitionDuration:"fast",transitionTimingFunction:"ease-out",cursor:"pointer",textDecoration:"none",outline:"none",color:"inherit",_hover:{textDecoration:"underline"},_focus:{boxShadow:"outline"}},D3={link:I3},w3={parts:Lk.keys,baseStyle:D3};function Kg(){return Kg=Object.assign||function(a){for(var l=1;l<arguments.length;l++){var h=arguments[l];for(var s in h)Object.prototype.hasOwnProperty.call(h,s)&&(a[s]=h[s])}return a},Kg.apply(this,arguments)}var L3={lineHeight:"1.2",borderRadius:"md",fontWeight:"semibold",transitionProperty:"common",transitionDuration:"normal",_focus:{boxShadow:"outline"},_disabled:{opacity:.4,cursor:"not-allowed",boxShadow:"none"},_hover:{_disabled:{bg:"initial"}}},dP=a=>{var{colorScheme:l,theme:h}=a;if(l==="gray")return{color:st("inherit","whiteAlpha.900")(a),_hover:{bg:st("gray.100","whiteAlpha.200")(a)},_active:{bg:st("gray.200","whiteAlpha.300")(a)}};var s=cc(l+".200",.12)(h),c=cc(l+".200",.24)(h);return{color:st(l+".600",l+".200")(a),bg:"transparent",_hover:{bg:st(l+".50",s)(a)},_active:{bg:st(l+".100",c)(a)}}},N3=a=>{var{colorScheme:l}=a,h=st("gray.200","whiteAlpha.300")(a);return Kg({border:"1px solid",borderColor:l==="gray"?h:"currentColor"},dP(a))},F3={yellow:{bg:"yellow.400",color:"black",hoverBg:"yellow.500",activeBg:"yellow.600"},cyan:{bg:"cyan.400",color:"black",hoverBg:"cyan.500",activeBg:"cyan.600"}},B3=a=>{var l,{colorScheme:h}=a;if(h==="gray"){var s=st("gray.100","whiteAlpha.200")(a);return{bg:s,_hover:{bg:st("gray.200","whiteAlpha.300")(a),_disabled:{bg:s}},_active:{bg:st("gray.300","whiteAlpha.400")(a)}}}var{bg:c=h+".500",color:E="white",hoverBg:m=h+".600",activeBg:S=h+".700"}=(l=F3[h])!=null?l:{},d=st(c,h+".200")(a);return{bg:d,color:st(E,"gray.800")(a),_hover:{bg:st(m,h+".300")(a),_disabled:{bg:d}},_active:{bg:st(S,h+".400")(a)}}},U3=a=>{var{colorScheme:l}=a;return{padding:0,height:"auto",lineHeight:"normal",verticalAlign:"baseline",color:st(l+".500",l+".200")(a),_hover:{textDecoration:"underline",_disabled:{textDecoration:"none"}},_active:{color:st(l+".700",l+".500")(a)}}},V3={bg:"none",color:"inherit",display:"inline",lineHeight:"inherit",m:0,p:0},k3={ghost:dP,outline:N3,solid:B3,link:U3,unstyled:V3},j3={lg:{h:12,minW:12,fontSize:"lg",px:6},md:{h:10,minW:10,fontSize:"md",px:4},sm:{h:8,minW:8,fontSize:"sm",px:3},xs:{h:6,minW:6,fontSize:"xs",px:2}},z3={variant:"solid",size:"md",colorScheme:"gray"},G3={baseStyle:L3,variants:k3,sizes:j3,defaultProps:z3},H3=a=>{var{colorScheme:l}=a;return{w:"100%",transitionProperty:"box-shadow",transitionDuration:"normal",border:"2px solid",borderRadius:"sm",borderColor:"inherit",color:"white",_checked:{bg:st(l+".500",l+".200")(a),borderColor:st(l+".500",l+".200")(a),color:st("white","gray.900")(a),_hover:{bg:st(l+".600",l+".300")(a),borderColor:st(l+".600",l+".300")(a)},_disabled:{borderColor:st("gray.200","transparent")(a),bg:st("gray.200","whiteAlpha.300")(a),color:st("gray.500","whiteAlpha.500")(a)}},_indeterminate:{bg:st(l+".500",l+".200")(a),borderColor:st(l+".500",l+".200")(a),color:st("white","gray.900")(a)},_disabled:{bg:st("gray.100","whiteAlpha.100")(a),borderColor:st("gray.100","transparent")(a)},_focus:{boxShadow:"outline"},_invalid:{borderColor:st("red.500","red.300")(a)}}},W3={userSelect:"none",_disabled:{opacity:.4}},X3={transitionProperty:"transform",transitionDuration:"normal"},Y3=a=>({icon:X3,control:H3(a),label:W3}),K3={sm:{control:{h:3,w:3},label:{fontSize:"sm"},icon:{fontSize:"0.45rem"}},md:{control:{w:4,h:4},label:{fontSize:"md"},icon:{fontSize:"0.625rem"}},lg:{control:{w:5,h:5},label:{fontSize:"lg"},icon:{fontSize:"0.625rem"}}},Q3={size:"md",colorScheme:"blue"},Qg={parts:Nk.keys,baseStyle:Y3,sizes:K3,defaultProps:Q3},ru=ii("close-button-size"),q3=a=>{var l=st("blackAlpha.100","whiteAlpha.100")(a),h=st("blackAlpha.200","whiteAlpha.200")(a);return{w:[ru.reference],h:[ru.reference],borderRadius:"md",transitionProperty:"common",transitionDuration:"normal",_disabled:{opacity:.4,cursor:"not-allowed",boxShadow:"none"},_hover:{bg:l},_active:{bg:h},_focus:{boxShadow:"outline"}}},Z3={lg:{[ru.variable]:"40px",fontSize:"16px"},md:{[ru.variable]:"32px",fontSize:"12px"},sm:{[ru.variable]:"24px",fontSize:"10px"}},$3={size:"md"},J3={baseStyle:q3,sizes:Z3,defaultProps:$3},{variants:ej,defaultProps:tj}=nu,nj={fontFamily:"mono",fontSize:"sm",px:"0.2em",borderRadius:"sm"},rj={baseStyle:nj,variants:ej,defaultProps:tj},ij={w:"100%",mx:"auto",maxW:"60ch",px:"1rem"},oj={baseStyle:ij},aj={opacity:.6,borderColor:"inherit"},sj={borderStyle:"solid"},cj={borderStyle:"dashed"},lj={solid:sj,dashed:cj},uj={variant:"solid"},hj={baseStyle:aj,variants:lj,defaultProps:uj};function qg(){return qg=Object.assign||function(a){for(var l=1;l<arguments.length;l++){var h=arguments[l];for(var s in h)Object.prototype.hasOwnProperty.call(h,s)&&(a[s]=h[s])}return a},qg.apply(this,arguments)}function lc(a){return a==="full"?{dialog:{maxW:"100vw",h:"100vh"}}:{dialog:{maxW:a}}}var dj={bg:"blackAlpha.600",zIndex:"overlay"},fj={display:"flex",zIndex:"modal",justifyContent:"center"},pj=a=>{var{isFullHeight:l}=a;return qg({},l&&{height:"100vh"},{zIndex:"modal",maxH:"100vh",bg:st("white","gray.700")(a),color:"inherit",boxShadow:st("lg","dark-lg")(a)})},mj={px:6,py:4,fontSize:"xl",fontWeight:"semibold"},_j={position:"absolute",top:2,insetEnd:3},gj={px:6,py:2,flex:1,overflow:"auto"},vj={px:6,py:4},bj=a=>({overlay:dj,dialogContainer:fj,dialog:pj(a),header:mj,closeButton:_j,body:gj,footer:vj}),yj={xs:lc("xs"),sm:lc("md"),md:lc("lg"),lg:lc("2xl"),xl:lc("4xl"),full:lc("full")},Tj={size:"xs"},Ej={parts:Fk.keys,baseStyle:bj,sizes:yj,defaultProps:Tj},Sj={borderRadius:"md",py:"3px",transitionProperty:"common",transitionDuration:"normal"},xj={borderRadius:"md",py:"3px",transitionProperty:"common",transitionDuration:"normal",width:"full",_focus:{boxShadow:"outline"},_placeholder:{opacity:.6}},Aj={preview:Sj,input:xj},Pj={parts:Bk.keys,baseStyle:Aj},Cj=a=>({marginStart:1,color:st("red.500","red.300")(a)}),Rj=a=>({mt:2,color:st("gray.500","whiteAlpha.600")(a),lineHeight:"normal",fontSize:"sm"}),Oj=a=>({container:{width:"100%",position:"relative"},requiredIndicator:Cj(a),helperText:Rj(a)}),Mj={parts:Uk.keys,baseStyle:Oj},Ij={fontSize:"md",marginEnd:3,mb:2,fontWeight:"medium",transitionProperty:"common",transitionDuration:"normal",opacity:1,_disabled:{opacity:.4}},Dj={baseStyle:Ij},wj={fontFamily:"heading",fontWeight:"bold"},Lj={"4xl":{fontSize:["6xl",null,"7xl"],lineHeight:1},"3xl":{fontSize:["5xl",null,"6xl"],lineHeight:1},"2xl":{fontSize:["4xl",null,"5xl"],lineHeight:[1.2,null,1]},xl:{fontSize:["3xl",null,"4xl"],lineHeight:[1.33,null,1.2]},lg:{fontSize:["2xl",null,"3xl"],lineHeight:[1.33,null,1.2]},md:{fontSize:"xl",lineHeight:1.2},sm:{fontSize:"md",lineHeight:1.2},xs:{fontSize:"sm",lineHeight:1.2}},Nj={size:"xl"},Fj={baseStyle:wj,sizes:Lj,defaultProps:Nj},Bj={field:{width:"100%",minWidth:0,outline:0,position:"relative",appearance:"none",transitionProperty:"common",transitionDuration:"normal"}},fa={lg:{fontSize:"lg",px:4,h:12,borderRadius:"md"},md:{fontSize:"md",px:4,h:10,borderRadius:"md"},sm:{fontSize:"sm",px:3,h:8,borderRadius:"sm"},xs:{fontSize:"xs",px:2,h:6,borderRadius:"sm"}},Uj={lg:{field:fa.lg,addon:fa.lg},md:{field:fa.md,addon:fa.md},sm:{field:fa.sm,addon:fa.sm},xs:{field:fa.xs,addon:fa.xs}};function Zg(a){var{focusBorderColor:l,errorBorderColor:h}=a;return{focusBorderColor:l||st("blue.500","blue.300")(a),errorBorderColor:h||st("red.500","red.300")(a)}}var Vj=a=>{var{theme:l}=a,{focusBorderColor:h,errorBorderColor:s}=Zg(a);return{field:{border:"1px solid",borderColor:"inherit",bg:"inherit",_hover:{borderColor:st("gray.300","whiteAlpha.400")(a)},_readOnly:{boxShadow:"none !important",userSelect:"all"},_disabled:{opacity:.4,cursor:"not-allowed"},_invalid:{borderColor:hr(l,s),boxShadow:"0 0 0 1px "+hr(l,s)},_focus:{zIndex:1,borderColor:hr(l,h),boxShadow:"0 0 0 1px "+hr(l,h)}},addon:{border:"1px solid",borderColor:st("inherit","whiteAlpha.50")(a),bg:st("gray.100","whiteAlpha.300")(a)}}},kj=a=>{var{theme:l}=a,{focusBorderColor:h,errorBorderColor:s}=Zg(a);return{field:{border:"2px solid",borderColor:"transparent",bg:st("gray.100","whiteAlpha.50")(a),_hover:{bg:st("gray.200","whiteAlpha.100")(a)},_readOnly:{boxShadow:"none !important",userSelect:"all"},_disabled:{opacity:.4,cursor:"not-allowed"},_invalid:{borderColor:hr(l,s)},_focus:{bg:"transparent",borderColor:hr(l,h)}},addon:{border:"2px solid",borderColor:"transparent",bg:st("gray.100","whiteAlpha.50")(a)}}},jj=a=>{var{theme:l}=a,{focusBorderColor:h,errorBorderColor:s}=Zg(a);return{field:{borderBottom:"1px solid",borderColor:"inherit",borderRadius:0,px:0,bg:"transparent",_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:hr(l,s),boxShadow:"0px 1px 0px 0px "+hr(l,s)},_focus:{borderColor:hr(l,h),boxShadow:"0px 1px 0px 0px "+hr(l,h)}},addon:{borderBottom:"2px solid",borderColor:"inherit",borderRadius:0,px:0,bg:"transparent"}}},zj={field:{bg:"transparent",px:0,height:"auto"},addon:{bg:"transparent",px:0,height:"auto"}},Gj={outline:Vj,filled:kj,flushed:jj,unstyled:zj},Hj={size:"md",variant:"outline"},kn={parts:kk.keys,baseStyle:Bj,sizes:Uj,variants:Gj,defaultProps:Hj},Wj=a=>({bg:st("gray.100","whiteAlpha")(a),borderRadius:"md",borderWidth:"1px",borderBottomWidth:"3px",fontSize:"0.8em",fontWeight:"bold",lineHeight:"normal",px:"0.4em",whiteSpace:"nowrap"}),Xj={baseStyle:Wj},Yj={transitionProperty:"common",transitionDuration:"fast",transitionTimingFunction:"ease-out",cursor:"pointer",textDecoration:"none",outline:"none",color:"inherit",_hover:{textDecoration:"underline"},_focus:{boxShadow:"outline"}},Kj={baseStyle:Yj},Qj={marginEnd:"0.5rem",display:"inline",verticalAlign:"text-bottom"},qj={container:{},item:{},icon:Qj},Zj={parts:jk.keys,baseStyle:qj},$j=a=>({bg:st("#fff","gray.700")(a),boxShadow:st("sm","dark-lg")(a),color:"inherit",minW:"3xs",py:"2",zIndex:1,borderRadius:"md",borderWidth:"1px"}),Jj=a=>({py:"0.4rem",px:"0.8rem",transitionProperty:"background",transitionDuration:"ultra-fast",transitionTimingFunction:"ease-in",_focus:{bg:st("gray.100","whiteAlpha.100")(a)},_active:{bg:st("gray.200","whiteAlpha.200")(a)},_expanded:{bg:st("gray.100","whiteAlpha.100")(a)},_disabled:{opacity:.4,cursor:"not-allowed"}}),ez={mx:4,my:2,fontWeight:"semibold",fontSize:"sm"},tz={opacity:.6},nz={border:0,borderBottom:"1px solid",borderColor:"inherit",my:"0.5rem",opacity:.6},rz={transitionProperty:"common",transitionDuration:"normal"},iz=a=>({button:rz,list:$j(a),item:Jj(a),groupTitle:ez,command:tz,divider:nz}),oz={parts:zk.keys,baseStyle:iz},az={bg:"blackAlpha.600",zIndex:"modal"},sz=a=>{var{isCentered:l,scrollBehavior:h}=a;return{display:"flex",zIndex:"modal",justifyContent:"center",alignItems:l?"center":"flex-start",overflow:h==="inside"?"hidden":"auto"}},cz=a=>{var{scrollBehavior:l}=a;return{borderRadius:"md",bg:st("white","gray.700")(a),color:"inherit",my:"3.75rem",zIndex:"modal",maxH:l==="inside"?"calc(100% - 7.5rem)":void 0,boxShadow:st("lg","dark-lg")(a)}},lz={px:6,py:4,fontSize:"xl",fontWeight:"semibold"},uz={position:"absolute",top:2,insetEnd:3},hz=a=>{var{scrollBehavior:l}=a;return{px:6,py:2,flex:1,overflow:l==="inside"?"auto":void 0}},dz={px:6,py:4},fz=a=>({overlay:az,dialogContainer:sz(a),dialog:cz(a),header:lz,closeButton:uz,body:hz(a),footer:dz});function Ni(a){return a==="full"?{dialog:{maxW:"100vw",minH:"100vh",my:0}}:{dialog:{maxW:a}}}var pz={xs:Ni("xs"),sm:Ni("sm"),md:Ni("md"),lg:Ni("lg"),xl:Ni("xl"),"2xl":Ni("2xl"),"3xl":Ni("3xl"),"4xl":Ni("4xl"),"5xl":Ni("5xl"),"6xl":Ni("6xl"),full:Ni("full")},mz={size:"md"},_z={parts:Gk.keys,baseStyle:fz,sizes:pz,defaultProps:mz},gz={letterSpacings:{tighter:"-0.05em",tight:"-0.025em",normal:"0",wide:"0.025em",wider:"0.05em",widest:"0.1em"},lineHeights:{normal:"normal",none:1,shorter:1.25,short:1.375,base:1.5,tall:1.625,taller:"2","3":".75rem","4":"1rem","5":"1.25rem","6":"1.5rem","7":"1.75rem","8":"2rem","9":"2.25rem","10":"2.5rem"},fontWeights:{hairline:100,thin:200,light:300,normal:400,medium:500,semibold:600,bold:700,extrabold:800,black:900},fonts:{heading:'-apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',body:'-apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',mono:'SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace'},fontSizes:{xs:"0.75rem",sm:"0.875rem",md:"1rem",lg:"1.125rem",xl:"1.25rem","2xl":"1.5rem","3xl":"1.875rem","4xl":"2.25rem","5xl":"3rem","6xl":"3.75rem","7xl":"4.5rem","8xl":"6rem","9xl":"8rem"}},fP=gz,pP,mP;function $g(){return $g=Object.assign||function(a){for(var l=1;l<arguments.length;l++){var h=arguments[l];for(var s in h)Object.prototype.hasOwnProperty.call(h,s)&&(a[s]=h[s])}return a},$g.apply(this,arguments)}var{variants:vz,defaultProps:bz}=kn,Jg=ii("number-input-stepper-width"),_P=ii("number-input-input-padding"),yz=Eo(Jg).add("0.5rem").toString(),Tz={[Jg.variable]:"24px",[_P.variable]:yz},Ez=(pP=(mP=kn.baseStyle)==null?void 0:mP.field)!=null?pP:{},Sz={width:[Jg.reference]},xz=a=>({borderStart:"1px solid",borderStartColor:st("inherit","whiteAlpha.300")(a),color:st("inherit","whiteAlpha.800")(a),_active:{bg:st("gray.200","whiteAlpha.300")(a)},_disabled:{opacity:.4,cursor:"not-allowed"}}),Az=a=>({root:Tz,field:Ez,stepperGroup:Sz,stepper:xz(a)});function nf(a){var l,h,s=kn.sizes[a],c={lg:"md",md:"md",sm:"sm",xs:"sm"},E=(l=(h=s.field)==null?void 0:h.fontSize)!=null?l:"md",m=fP.fontSizes[E.toString()];return{field:$g({},s.field,{paddingInlineEnd:_P.reference,verticalAlign:"top"}),stepper:{fontSize:Eo(m).multiply(.75).toString(),_first:{borderTopEndRadius:c[a]},_last:{borderBottomEndRadius:c[a],mt:"-1px",borderTopWidth:1}}}}var Pz={xs:nf("xs"),sm:nf("sm"),md:nf("md"),lg:nf("lg")},Cz={parts:Hk.keys,baseStyle:Az,sizes:Pz,variants:vz,defaultProps:bz},gP;function ev(){return ev=Object.assign||function(a){for(var l=1;l<arguments.length;l++){var h=arguments[l];for(var s in h)Object.prototype.hasOwnProperty.call(h,s)&&(a[s]=h[s])}return a},ev.apply(this,arguments)}var Rz=ev({},kn.baseStyle.field,{textAlign:"center"}),Oz={lg:{fontSize:"lg",w:12,h:12,borderRadius:"md"},md:{fontSize:"md",w:10,h:10,borderRadius:"md"},sm:{fontSize:"sm",w:8,h:8,borderRadius:"sm"},xs:{fontSize:"xs",w:6,h:6,borderRadius:"sm"}},Mz={outline:a=>{var l;return(l=kn.variants.outline(a).field)!=null?l:{}},flushed:a=>{var l;return(l=kn.variants.flushed(a).field)!=null?l:{}},filled:a=>{var l;return(l=kn.variants.filled(a).field)!=null?l:{}},unstyled:(gP=kn.variants.unstyled.field)!=null?gP:{}},Iz=kn.defaultProps,Dz={baseStyle:Rz,sizes:Oz,variants:Mz,defaultProps:Iz},tv=ii("popper-bg"),wz=ii("popper-arrow-bg"),Lz=ii("popper-arrow-shadow-color"),Nz={zIndex:10},Fz=a=>{var l=st("white","gray.700")(a),h=st("gray.200","whiteAlpha.300")(a);return{[tv.variable]:"colors."+l,bg:tv.reference,[wz.variable]:tv.reference,[Lz.variable]:"colors."+h,width:"xs",border:"1px solid",borderColor:"inherit",borderRadius:"md",boxShadow:"sm",zIndex:"inherit",_focus:{outline:0,boxShadow:"outline"}}},Bz={px:3,py:2,borderBottomWidth:"1px"},Uz={px:3,py:2},Vz={px:3,py:2,borderTopWidth:"1px"},kz=a=>({popper:Nz,content:Fz(a),header:Bz,body:Uz,footer:Vz,arrow:{}}),jz={parts:Wk.keys,baseStyle:kz};function rf(){return rf=Object.assign||function(a){for(var l=1;l<arguments.length;l++){var h=arguments[l];for(var s in h)Object.prototype.hasOwnProperty.call(h,s)&&(a[s]=h[s])}return a},rf.apply(this,arguments)}function zz(a){var{colorScheme:l,theme:h,isIndeterminate:s,hasStripe:c}=a,E=st(rP(),rP("1rem","rgba(0,0,0,0.1)"))(a),m=st(l+".500",l+".200")(a),S=`linear-gradient(
    to right,
    transparent 0%,
    `+hr(h,m)+` 50%,
    transparent 100%
  )`,d=!s&&c;return rf({},d&&E,s?{bgImage:S}:{bgColor:m})}var Gz={lineHeight:"1",fontSize:"0.25em",fontWeight:"bold",color:"white"},Hz=a=>({bg:st("gray.100","whiteAlpha.300")(a)}),Wz=a=>rf({transitionProperty:"common",transitionDuration:"slow"},zz(a)),Xz=a=>({label:Gz,filledTrack:Wz(a),track:Hz(a)}),Yz={xs:{track:{h:"0.25rem"}},sm:{track:{h:"0.5rem"}},md:{track:{h:"0.75rem"}},lg:{track:{h:"1rem"}}},Kz={size:"md",colorScheme:"blue"},Qz={parts:Xk.keys,sizes:Yz,baseStyle:Xz,defaultProps:Kz};function of(){return of=Object.assign||function(a){for(var l=1;l<arguments.length;l++){var h=arguments[l];for(var s in h)Object.prototype.hasOwnProperty.call(h,s)&&(a[s]=h[s])}return a},of.apply(this,arguments)}var qz=a=>{var{control:l={}}=Qg.baseStyle(a);return of({},l,{borderRadius:"full",_checked:of({},l._checked,{_before:{content:'""',display:"inline-block",pos:"relative",w:"50%",h:"50%",borderRadius:"50%",bg:"currentColor"}})})},Zz=a=>({label:Qg.baseStyle(a).label,control:qz(a)}),$z={md:{control:{w:4,h:4},label:{fontSize:"md"}},lg:{control:{w:5,h:5},label:{fontSize:"lg"}},sm:{control:{width:3,height:3},label:{fontSize:"sm"}}},Jz={size:"md",colorScheme:"blue"},eG={parts:Yk.keys,baseStyle:Zz,sizes:$z,defaultProps:Jz};function iu(){return iu=Object.assign||function(a){for(var l=1;l<arguments.length;l++){var h=arguments[l];for(var s in h)Object.prototype.hasOwnProperty.call(h,s)&&(a[s]=h[s])}return a},iu.apply(this,arguments)}var tG=a=>iu({},kn.baseStyle.field,{bg:st("white","gray.700")(a),appearance:"none",paddingBottom:"1px",lineHeight:"normal","> option, > optgroup":{bg:st("white","gray.700")(a)}}),nG={width:"1.5rem",height:"100%",insetEnd:"0.5rem",position:"relative",color:"currentColor",fontSize:"1.25rem",_disabled:{opacity:.5}},rG=a=>({field:tG(a),icon:nG}),iG=iu({},kn.sizes,{xs:iu({},kn.sizes.xs,{icon:{insetEnd:"0.25rem"}})}),oG={parts:Kk.keys,baseStyle:rG,sizes:iG,variants:kn.variants,defaultProps:kn.defaultProps},aG=(a,l)=>ag({from:{borderColor:a,background:a},to:{borderColor:l,background:l}}),sG=a=>{var l=st("gray.100","gray.800")(a),h=st("gray.400","gray.600")(a),{startColor:s=l,endColor:c=h,speed:E,theme:m}=a,S=hr(m,s),d=hr(m,c);return{opacity:.7,borderRadius:"2px",borderColor:S,background:d,animation:E+"s linear infinite alternate "+aG(S,d)}},cG={baseStyle:sG},lG=a=>({borderRadius:"md",fontWeight:"semibold",_focus:{boxShadow:"outline",padding:"1rem",position:"fixed",top:"1.5rem",insetStart:"1.5rem",bg:st("white","gray.700")(a)}}),uG={baseStyle:lG};function af(){return af=Object.assign||function(a){for(var l=1;l<arguments.length;l++){var h=arguments[l];for(var s in h)Object.prototype.hasOwnProperty.call(h,s)&&(a[s]=h[s])}return a},af.apply(this,arguments)}function hG(a){return tu({orientation:a.orientation,vertical:{left:"50%",transform:"translateX(-50%)",_active:{transform:"translateX(-50%) scale(1.15)"}},horizontal:{top:"50%",transform:"translateY(-50%)",_active:{transform:"translateY(-50%) scale(1.15)"}}})}var dG=a=>{var{orientation:l}=a;return af({_disabled:{opacity:.6,cursor:"default",pointerEvents:"none"}},tu({orientation:l,vertical:{h:"100%"},horizontal:{w:"100%"}}))},fG=a=>({borderRadius:"sm",bg:st("gray.200","whiteAlpha.200")(a),_disabled:{bg:st("gray.300","whiteAlpha.300")(a)}}),pG=a=>af({zIndex:1,borderRadius:"full",bg:"white",boxShadow:"base",border:"1px solid",borderColor:"transparent",transitionProperty:"transform",transitionDuration:"normal",_focus:{boxShadow:"outline"},_disabled:{bg:"gray.300"}},hG(a)),mG=a=>{var{colorScheme:l}=a;return{bg:st(l+".500",l+".200")(a)}},_G=a=>({container:dG(a),track:fG(a),thumb:pG(a),filledTrack:mG(a)}),gG=a=>({thumb:{w:"16px",h:"16px"},track:tu({orientation:a.orientation,horizontal:{h:"4px"},vertical:{w:"4px"}})}),vG=a=>({thumb:{w:"14px",h:"14px"},track:tu({orientation:a.orientation,horizontal:{h:"4px"},vertical:{w:"4px"}})}),bG=a=>({thumb:{w:"10px",h:"10px"},track:tu({orientation:a.orientation,horizontal:{h:"2px"},vertical:{w:"2px"}})}),yG={lg:gG,md:vG,sm:bG},TG={size:"md",colorScheme:"blue"},EG={parts:Qk.keys,sizes:yG,baseStyle:_G,defaultProps:TG},Xa=ii("spinner-size"),SG={width:[Xa.reference],height:[Xa.reference]},xG={xs:{[Xa.variable]:"0.75rem"},sm:{[Xa.variable]:"1rem"},md:{[Xa.variable]:"1.5rem"},lg:{[Xa.variable]:"2rem"},xl:{[Xa.variable]:"3rem"}},AG={size:"md"},PG={baseStyle:SG,sizes:xG,defaultProps:AG},CG={fontWeight:"medium"},RG={opacity:.8,marginBottom:2},OG={verticalAlign:"baseline",fontWeight:"semibold"},MG={marginEnd:1,w:"14px",h:"14px",verticalAlign:"middle"},IG={container:{},label:CG,helpText:RG,number:OG,icon:MG},DG={md:{label:{fontSize:"sm"},helpText:{fontSize:"sm"},number:{fontSize:"2xl"}}},wG={size:"md"},LG={parts:qk.keys,baseStyle:IG,sizes:DG,defaultProps:wG},ou=ii("switch-track-width"),Ya=ii("switch-track-height"),nv=ii("switch-track-diff"),NG=Eo.subtract(ou,Ya),rv=ii("switch-thumb-x"),FG=a=>{var{colorScheme:l}=a;return{borderRadius:"full",p:"2px",width:[ou.reference],height:[Ya.reference],transitionProperty:"common",transitionDuration:"fast",bg:st("gray.300","whiteAlpha.400")(a),_focus:{boxShadow:"outline"},_disabled:{opacity:.4,cursor:"not-allowed"},_checked:{bg:st(l+".500",l+".200")(a)}}},BG={bg:"white",transitionProperty:"transform",transitionDuration:"normal",borderRadius:"inherit",width:[Ya.reference],height:[Ya.reference],_checked:{transform:"translateX("+rv.reference+")"}},UG=a=>({container:{[nv.variable]:NG,[rv.variable]:nv.reference,_rtl:{[rv.variable]:Eo(nv).negate().toString()}},track:FG(a),thumb:BG}),VG={sm:{container:{[ou.variable]:"1.375rem",[Ya.variable]:"0.75rem"}},md:{container:{[ou.variable]:"1.875rem",[Ya.variable]:"1rem"}},lg:{container:{[ou.variable]:"2.875rem",[Ya.variable]:"1.5rem"}}},kG={size:"md",colorScheme:"blue"},jG={parts:Zk.keys,baseStyle:UG,sizes:VG,defaultProps:kG};function uc(){return uc=Object.assign||function(a){for(var l=1;l<arguments.length;l++){var h=arguments[l];for(var s in h)Object.prototype.hasOwnProperty.call(h,s)&&(a[s]=h[s])}return a},uc.apply(this,arguments)}var zG={table:{fontVariantNumeric:"lining-nums tabular-nums",borderCollapse:"collapse",width:"full"},th:{fontFamily:"heading",fontWeight:"bold",textTransform:"uppercase",letterSpacing:"wider",textAlign:"start"},td:{textAlign:"start"},caption:{mt:4,fontFamily:"heading",textAlign:"center",fontWeight:"medium"}},sf={"&[data-is-numeric=true]":{textAlign:"end"}},GG=a=>{var{colorScheme:l}=a;return{th:uc({color:st("gray.600","gray.400")(a),borderBottom:"1px",borderColor:st(l+".100",l+".700")(a)},sf),td:uc({borderBottom:"1px",borderColor:st(l+".100",l+".700")(a)},sf),caption:{color:st("gray.600","gray.100")(a)},tfoot:{tr:{"&:last-of-type":{th:{borderBottomWidth:0}}}}}},HG=a=>{var{colorScheme:l}=a;return{th:uc({color:st("gray.600","gray.400")(a),borderBottom:"1px",borderColor:st(l+".100",l+".700")(a)},sf),td:uc({borderBottom:"1px",borderColor:st(l+".100",l+".700")(a)},sf),caption:{color:st("gray.600","gray.100")(a)},tbody:{tr:{"&:nth-of-type(odd)":{"th, td":{borderBottomWidth:"1px",borderColor:st(l+".100",l+".700")(a)},td:{background:st(l+".100",l+".700")(a)}}}},tfoot:{tr:{"&:last-of-type":{th:{borderBottomWidth:0}}}}}},WG={simple:GG,striped:HG,unstyled:{}},XG={sm:{th:{px:"4",py:"1",lineHeight:"4",fontSize:"xs"},td:{px:"4",py:"2",fontSize:"sm",lineHeight:"4"},caption:{px:"4",py:"2",fontSize:"xs"}},md:{th:{px:"6",py:"3",lineHeight:"4",fontSize:"xs"},td:{px:"6",py:"4",lineHeight:"5"},caption:{px:"6",py:"2",fontSize:"sm"}},lg:{th:{px:"8",py:"4",lineHeight:"5",fontSize:"sm"},td:{px:"8",py:"5",lineHeight:"6"},caption:{px:"6",py:"2",fontSize:"md"}}},YG={variant:"simple",size:"md",colorScheme:"gray"},KG={parts:$k.keys,baseStyle:zG,variants:WG,sizes:XG,defaultProps:YG},QG=a=>{var{orientation:l}=a;return{display:l==="vertical"?"flex":"block"}},qG=a=>{var{isFitted:l}=a;return{flex:l?1:void 0,transitionProperty:"common",transitionDuration:"normal",_focus:{zIndex:1,boxShadow:"outline"}}},ZG=a=>{var{align:l="start",orientation:h}=a,s={end:"flex-end",center:"center",start:"flex-start"};return{justifyContent:s[l],flexDirection:h==="vertical"?"column":"row"}},$G={p:4},JG=a=>({root:QG(a),tab:qG(a),tablist:ZG(a),tabpanel:$G}),e4={sm:{tab:{py:1,px:4,fontSize:"sm"}},md:{tab:{fontSize:"md",py:2,px:4}},lg:{tab:{fontSize:"lg",py:3,px:4}}},t4=a=>{var{colorScheme:l,orientation:h}=a,s=h==="vertical",c=h==="vertical"?"borderStart":"borderBottom",E=s?"marginStart":"marginBottom";return{tablist:{[c]:"2px solid",borderColor:"inherit"},tab:{[c]:"2px solid",borderColor:"transparent",[E]:"-2px",_selected:{color:st(l+".600",l+".300")(a),borderColor:"currentColor"},_active:{bg:st("gray.200","whiteAlpha.300")(a)},_disabled:{opacity:.4,cursor:"not-allowed"}}}},n4=a=>{var{colorScheme:l}=a;return{tab:{borderTopRadius:"md",border:"1px solid",borderColor:"transparent",mb:"-1px",_selected:{color:st(l+".600",l+".300")(a),borderColor:"inherit",borderBottomColor:st("white","gray.800")(a)}},tablist:{mb:"-1px",borderBottom:"1px solid",borderColor:"inherit"}}},r4=a=>{var{colorScheme:l}=a;return{tab:{border:"1px solid",borderColor:"inherit",bg:st("gray.50","whiteAlpha.50")(a),mb:"-1px",_notLast:{marginEnd:"-1px"},_selected:{bg:st("#fff","gray.800")(a),color:st(l+".600",l+".300")(a),borderColor:"inherit",borderTopColor:"currentColor",borderBottomColor:"transparent"}},tablist:{mb:"-1px",borderBottom:"1px solid",borderColor:"inherit"}}},i4=a=>{var{colorScheme:l,theme:h}=a;return{tab:{borderRadius:"full",fontWeight:"semibold",color:"gray.600",_selected:{color:hr(h,l+".700"),bg:hr(h,l+".100")}}}},o4=a=>{var{colorScheme:l}=a;return{tab:{borderRadius:"full",fontWeight:"semibold",color:st("gray.600","inherit")(a),_selected:{color:st("#fff","gray.800")(a),bg:st(l+".600",l+".300")(a)}}}},a4={},s4={line:t4,enclosed:n4,"enclosed-colored":r4,"soft-rounded":i4,"solid-rounded":o4,unstyled:a4},c4={size:"md",variant:"line",colorScheme:"blue"},l4={parts:Jk.keys,baseStyle:JG,sizes:e4,variants:s4,defaultProps:c4},u4={fontWeight:"medium",lineHeight:1.2,outline:0,_focus:{boxShadow:"outline"}},h4={lineHeight:1.2,overflow:"visible"},d4={fontSize:"18px",w:"1.25rem",h:"1.25rem",transitionProperty:"common",transitionDuration:"normal",borderRadius:"full",marginStart:"0.375rem",marginEnd:"-1",opacity:.5,_disabled:{opacity:.4},_focus:{boxShadow:"outline",bg:"rgba(0, 0, 0, 0.14)"},_hover:{opacity:.8},_active:{opacity:1}},f4={container:u4,label:h4,closeButton:d4},p4={sm:{container:{minH:"1.25rem",minW:"1.25rem",fontSize:"xs",px:2,borderRadius:"md"},closeButton:{marginEnd:"-2px",marginStart:"0.35rem"}},md:{container:{minH:"1.5rem",minW:"1.5rem",fontSize:"sm",borderRadius:"md",px:2}},lg:{container:{minH:8,minW:8,fontSize:"md",borderRadius:"md",px:3}}},m4={subtle:a=>({container:nu.variants.subtle(a)}),solid:a=>({container:nu.variants.solid(a)}),outline:a=>({container:nu.variants.outline(a)})},_4={size:"md",variant:"subtle",colorScheme:"gray"},g4={parts:e3.keys,variants:m4,baseStyle:f4,sizes:p4,defaultProps:_4},vP,bP,yP,TP,EP;function iv(){return iv=Object.assign||function(a){for(var l=1;l<arguments.length;l++){var h=arguments[l];for(var s in h)Object.prototype.hasOwnProperty.call(h,s)&&(a[s]=h[s])}return a},iv.apply(this,arguments)}var v4=iv({},kn.baseStyle.field,{paddingY:"8px",minHeight:"80px",lineHeight:"short",verticalAlign:"top"}),b4={outline:a=>{var l;return(l=kn.variants.outline(a).field)!=null?l:{}},flushed:a=>{var l;return(l=kn.variants.flushed(a).field)!=null?l:{}},filled:a=>{var l;return(l=kn.variants.filled(a).field)!=null?l:{}},unstyled:(vP=kn.variants.unstyled.field)!=null?vP:{}},y4={xs:(bP=kn.sizes.xs.field)!=null?bP:{},sm:(yP=kn.sizes.sm.field)!=null?yP:{},md:(TP=kn.sizes.md.field)!=null?TP:{},lg:(EP=kn.sizes.lg.field)!=null?EP:{}},T4={size:"md",variant:"outline"},E4={baseStyle:v4,sizes:y4,variants:b4,defaultProps:T4},ov=ii("tooltip-bg"),S4=ii("popper-arrow-bg"),x4=a=>{var l=st("gray.700","gray.300")(a);return{[ov.variable]:"colors."+l,px:"8px",py:"2px",bg:[ov.reference],[S4.variable]:[ov.reference],color:st("whiteAlpha.900","gray.900")(a),borderRadius:"sm",fontWeight:"medium",fontSize:"sm",boxShadow:"md",maxW:"320px",zIndex:"tooltip"}},A4={baseStyle:x4},P4=a=>({color:st("red.500","red.300")(a),mt:2,fontSize:"sm"}),C4=a=>({marginEnd:"0.5em",color:st("red.500","red.300")(a)}),R4=a=>({text:P4(a),icon:C4(a)}),O4={parts:Vk.keys,baseStyle:R4},M4={Accordion:a3,Alert:p3,Avatar:x3,Badge:nu,Breadcrumb:w3,Button:G3,Checkbox:Qg,CloseButton:J3,Code:rj,Container:oj,Divider:hj,Drawer:Ej,Editable:Pj,Form:Mj,FormLabel:Dj,Heading:Fj,Input:kn,Kbd:Xj,Link:Kj,List:Zj,Menu:oz,Modal:_z,NumberInput:Cz,PinInput:Dz,Popover:jz,Progress:Qz,Radio:eG,Select:oG,Skeleton:cG,SkipLink:uG,Slider:EG,Spinner:PG,Stat:LG,Switch:jG,Table:KG,Tabs:l4,Tag:g4,Textarea:E4,Tooltip:A4,FormError:O4},I4={none:0,"1px":"1px solid","2px":"2px solid","4px":"4px solid","8px":"8px solid"},D4=I4,w4=Sk({sm:"30em",md:"48em",lg:"62em",xl:"80em","2xl":"96em"}),L4=w4,N4={transparent:"transparent",current:"currentColor",black:"#000000",white:"#FFFFFF",whiteAlpha:{50:"rgba(255, 255, 255, 0.04)",100:"rgba(255, 255, 255, 0.06)",200:"rgba(255, 255, 255, 0.08)",300:"rgba(255, 255, 255, 0.16)",400:"rgba(255, 255, 255, 0.24)",500:"rgba(255, 255, 255, 0.36)",600:"rgba(255, 255, 255, 0.48)",700:"rgba(255, 255, 255, 0.64)",800:"rgba(255, 255, 255, 0.80)",900:"rgba(255, 255, 255, 0.92)"},blackAlpha:{50:"rgba(0, 0, 0, 0.04)",100:"rgba(0, 0, 0, 0.06)",200:"rgba(0, 0, 0, 0.08)",300:"rgba(0, 0, 0, 0.16)",400:"rgba(0, 0, 0, 0.24)",500:"rgba(0, 0, 0, 0.36)",600:"rgba(0, 0, 0, 0.48)",700:"rgba(0, 0, 0, 0.64)",800:"rgba(0, 0, 0, 0.80)",900:"rgba(0, 0, 0, 0.92)"},gray:{50:"#F7FAFC",100:"#EDF2F7",200:"#E2E8F0",300:"#CBD5E0",400:"#A0AEC0",500:"#718096",600:"#4A5568",700:"#2D3748",800:"#1A202C",900:"#171923"},red:{50:"#FFF5F5",100:"#FED7D7",200:"#FEB2B2",300:"#FC8181",400:"#F56565",500:"#E53E3E",600:"#C53030",700:"#9B2C2C",800:"#822727",900:"#63171B"},orange:{50:"#FFFAF0",100:"#FEEBC8",200:"#FBD38D",300:"#F6AD55",400:"#ED8936",500:"#DD6B20",600:"#C05621",700:"#9C4221",800:"#7B341E",900:"#652B19"},yellow:{50:"#FFFFF0",100:"#FEFCBF",200:"#FAF089",300:"#F6E05E",400:"#ECC94B",500:"#D69E2E",600:"#B7791F",700:"#975A16",800:"#744210",900:"#5F370E"},green:{50:"#F0FFF4",100:"#C6F6D5",200:"#9AE6B4",300:"#68D391",400:"#48BB78",500:"#38A169",600:"#2F855A",700:"#276749",800:"#22543D",900:"#1C4532"},teal:{50:"#E6FFFA",100:"#B2F5EA",200:"#81E6D9",300:"#4FD1C5",400:"#38B2AC",500:"#319795",600:"#2C7A7B",700:"#285E61",800:"#234E52",900:"#1D4044"},blue:{50:"#ebf8ff",100:"#bee3f8",200:"#90cdf4",300:"#63b3ed",400:"#4299e1",500:"#3182ce",600:"#2b6cb0",700:"#2c5282",800:"#2a4365",900:"#1A365D"},cyan:{50:"#EDFDFD",100:"#C4F1F9",200:"#9DECF9",300:"#76E4F7",400:"#0BC5EA",500:"#00B5D8",600:"#00A3C4",700:"#0987A0",800:"#086F83",900:"#065666"},purple:{50:"#FAF5FF",100:"#E9D8FD",200:"#D6BCFA",300:"#B794F4",400:"#9F7AEA",500:"#805AD5",600:"#6B46C1",700:"#553C9A",800:"#44337A",900:"#322659"},pink:{50:"#FFF5F7",100:"#FED7E2",200:"#FBB6CE",300:"#F687B3",400:"#ED64A6",500:"#D53F8C",600:"#B83280",700:"#97266D",800:"#702459",900:"#521B41"},linkedin:{50:"#E8F4F9",100:"#CFEDFB",200:"#9BDAF3",300:"#68C7EC",400:"#34B3E4",500:"#00A0DC",600:"#008CC9",700:"#0077B5",800:"#005E93",900:"#004471"},facebook:{50:"#E8F4F9",100:"#D9DEE9",200:"#B7C2DA",300:"#6482C0",400:"#4267B2",500:"#385898",600:"#314E89",700:"#29487D",800:"#223B67",900:"#1E355B"},messenger:{50:"#D0E6FF",100:"#B9DAFF",200:"#A2CDFF",300:"#7AB8FF",400:"#2E90FF",500:"#0078FF",600:"#0063D1",700:"#0052AC",800:"#003C7E",900:"#002C5C"},whatsapp:{50:"#dffeec",100:"#b9f5d0",200:"#90edb3",300:"#65e495",400:"#3cdd78",500:"#22c35e",600:"#179848",700:"#0c6c33",800:"#01421c",900:"#001803"},twitter:{50:"#E5F4FD",100:"#C8E9FB",200:"#A8DCFA",300:"#83CDF7",400:"#57BBF5",500:"#1DA1F2",600:"#1A94DA",700:"#1681BF",800:"#136B9E",900:"#0D4D71"},telegram:{50:"#E3F2F9",100:"#C5E4F3",200:"#A2D4EC",300:"#7AC1E4",400:"#47A9DA",500:"#0088CC",600:"#007AB8",700:"#006BA1",800:"#005885",900:"#003F5E"}},F4=N4,B4={none:"0",sm:"0.125rem",base:"0.25rem",md:"0.375rem",lg:"0.5rem",xl:"0.75rem","2xl":"1rem","3xl":"1.5rem",full:"9999px"},U4=B4,V4={xs:"0 0 0 1px rgba(0, 0, 0, 0.05)",sm:"0 1px 2px 0 rgba(0, 0, 0, 0.05)",base:"0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06)",md:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",lg:"0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)",xl:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)","2xl":"0 25px 50px -12px rgba(0, 0, 0, 0.25)",outline:"0 0 0 3px rgba(66, 153, 225, 0.6)",inner:"inset 0 2px 4px 0 rgba(0,0,0,0.06)",none:"none","dark-lg":"rgba(0, 0, 0, 0.1) 0px 0px 0px 1px, rgba(0, 0, 0, 0.2) 0px 5px 10px, rgba(0, 0, 0, 0.4) 0px 15px 40px"},k4=V4,j4={common:"background-color, border-color, color, fill, stroke, opacity, box-shadow, transform",colors:"background-color, border-color, color, fill, stroke",dimensions:"width, height",position:"left, right, top, bottom",background:"background-color, background-image, background-position"},z4={"ease-in":"cubic-bezier(0.4, 0, 1, 1)","ease-out":"cubic-bezier(0, 0, 0.2, 1)","ease-in-out":"cubic-bezier(0.4, 0, 0.2, 1)"},G4={"ultra-fast":"50ms",faster:"100ms",fast:"150ms",normal:"200ms",slow:"300ms",slower:"400ms","ultra-slow":"500ms"},H4={property:j4,easing:z4,duration:G4},W4=H4,X4={hide:-1,auto:"auto",base:0,docked:10,dropdown:1e3,sticky:1100,banner:1200,overlay:1300,modal:1400,popover:1500,skipLink:1600,toast:1700,tooltip:1800},Y4=X4,K4={none:0,sm:"4px",base:"8px",md:"12px",lg:"16px",xl:"24px","2xl":"40px","3xl":"64px"},Q4=K4;function av(){return av=Object.assign||function(a){for(var l=1;l<arguments.length;l++){var h=arguments[l];for(var s in h)Object.prototype.hasOwnProperty.call(h,s)&&(a[s]=h[s])}return a},av.apply(this,arguments)}var q4=av({breakpoints:L4,zIndices:Y4,radii:U4,blur:Q4,colors:F4},fP,{sizes:hP,shadows:k4,space:uP,borders:D4,transition:W4}),Z4=q4,$4={global:a=>({body:{fontFamily:"body",color:st("gray.800","whiteAlpha.900")(a),bg:st("white","gray.800")(a),transitionProperty:"background-color",transitionDuration:"normal",lineHeight:"base"},"*::placeholder":{color:st("gray.400","whiteAlpha.400")(a)},"*, *::before, &::after":{borderColor:st("gray.200","whiteAlpha.300")(a),wordWrap:"break-word"}})},J4=$4;function sv(){return sv=Object.assign||function(a){for(var l=1;l<arguments.length;l++){var h=arguments[l];for(var s in h)Object.prototype.hasOwnProperty.call(h,s)&&(a[s]=h[s])}return a},sv.apply(this,arguments)}var eH="ltr",tH={useSystemColorMode:!1,initialColorMode:"light",cssVarPrefix:"chakra"},nH=sv({direction:eH},Z4,{components:M4,styles:J4,config:tH}),rH=nH,iH=JV;iH.defaultProps={theme:rH};function au(){return au=Object.assign||function(a){for(var l=1;l<arguments.length;l++){var h=arguments[l];for(var s in h)Object.prototype.hasOwnProperty.call(h,s)&&(a[s]=h[s])}return a},au.apply(this,arguments)}function oH(a,l){if(a==null)return{};var h={},s=Object.keys(a),c,E;for(E=0;E<s.length;E++)c=s[E],!(l.indexOf(c)>=0)&&(h[c]=a[c]);return h}var SP={path:$e("g",{stroke:"currentColor",strokeWidth:"1.5"},$e("path",{strokeLinecap:"round",fill:"none",d:"M9,9a3,3,0,1,1,4,2.829,1.5,1.5,0,0,0-1,1.415V14.25"}),$e("path",{fill:"currentColor",strokeLinecap:"round",d:"M12,17.25a.375.375,0,1,0,.375.375A.375.375,0,0,0,12,17.25h0"}),$e("circle",{fill:"none",strokeMiterlimit:"10",cx:"12",cy:"12",r:"11.25"})),viewBox:"0 0 24 24"},su=Dn((a,l)=>{var{as:h,viewBox:s,color:c="currentColor",focusable:E=!1,children:m,className:S,__css:d}=a,M=oH(a,["as","viewBox","color","focusable","children","className","__css"]),C=ir("chakra-icon",S),I=au({w:"1em",h:"1em",display:"inline-block",lineHeight:"1em",flexShrink:0,color:c},d),b={ref:l,focusable:E,className:C,__css:I},p=s??SP.viewBox;if(h&&typeof h!="string")return $e(nn.svg,au({as:h},b,M));var x=m??SP.path;return $e(nn.svg,au({verticalAlign:"middle",viewBox:p},b,M),x)});function cv(){return cv=Object.assign||function(a){for(var l=1;l<arguments.length;l++){var h=arguments[l];for(var s in h)Object.prototype.hasOwnProperty.call(h,s)&&(a[s]=h[s])}return a},cv.apply(this,arguments)}function cu(a){var{viewBox:l="0 0 24 24",d:h,path:s,displayName:c,defaultProps:E={}}=a,m=Dn((S,d)=>$e(su,cv({ref:d,viewBox:l},E,S),s??$e("path",{fill:"currentColor",d:h})));return m}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var lv=function(a,l){return lv=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,s){h.__proto__=s}||function(h,s){for(var c in s)Object.prototype.hasOwnProperty.call(s,c)&&(h[c]=s[c])},lv(a,l)};function xP(a,l){if(typeof l!="function"&&l!==null)throw new TypeError("Class extends value "+String(l)+" is not a constructor or null");lv(a,l);function h(){this.constructor=a}a.prototype=l===null?Object.create(l):(h.prototype=l.prototype,new h)}var ht=function(){return ht=Object.assign||function(l){for(var h,s=1,c=arguments.length;s<c;s++){h=arguments[s];for(var E in h)Object.prototype.hasOwnProperty.call(h,E)&&(l[E]=h[E])}return l},ht.apply(this,arguments)};function oi(a,l){var h={};for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&l.indexOf(s)<0&&(h[s]=a[s]);if(a!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,s=Object.getOwnPropertySymbols(a);c<s.length;c++)l.indexOf(s[c])<0&&Object.prototype.propertyIsEnumerable.call(a,s[c])&&(h[s[c]]=a[s[c]]);return h}function Wn(a,l){var h=typeof Symbol=="function"&&a[Symbol.iterator];if(!h)return a;var s=h.call(a),c,E=[],m;try{for(;(l===void 0||l-- >0)&&!(c=s.next()).done;)E.push(c.value)}catch(S){m={error:S}}finally{try{c&&!c.done&&(h=s.return)&&h.call(s)}finally{if(m)throw m.error}}return E}function Ur(a,l,h){if(h||arguments.length===2)for(var s=0,c=l.length,E;s<c;s++)(E||!(s in l))&&(E||(E=Array.prototype.slice.call(l,0,s)),E[s]=l[s]);return a.concat(E||Array.prototype.slice.call(l))}var So=function(a){return{isEnabled:function(l){return a.some(function(h){return!!l[h]})}}},uv={measureLayout:So(["layout","layoutId","drag","_layoutResetTransform"]),animation:So(["animate","exit","variants","whileHover","whileTap","whileFocus","whileDrag"]),exit:So(["exit"]),drag:So(["drag","dragControls"]),focus:So(["whileFocus"]),hover:So(["whileHover","onHoverStart","onHoverEnd"]),tap:So(["whileTap","onTap","onTapStart","onTapCancel"]),pan:So(["onPan","onPanStart","onPanSessionStart","onPanEnd"]),layoutAnimation:So(["layout","layoutId"])};function aH(a){for(var l in a){var h=a[l];h!==null&&(uv[l].Component=h)}}var lu=function(){},AP=Sr({strict:!1}),PP=Object.keys(uv),sH=PP.length;function cH(a,l,h){var s=[];if(cn(AP),!l)return null;for(var c=0;c<sH;c++){var E=PP[c],m=uv[E],S=m.isEnabled,d=m.Component;S(a)&&d&&s.push($e(d,ht({key:E},a,{visualElement:l})))}return s}var cf=Sr({transformPagePoint:function(a){return a},isStatic:!1}),lf=Sr({});function lH(){return cn(lf).visualElement}var uu=Sr(null);function hu(a){var l=zt(null);return l.current===null&&(l.current=a()),l.current}function hv(){var a=cn(uu);if(a===null)return[!0,null];var l=a.isPresent,h=a.onExitComplete,s=a.register,c=fH();Vt(function(){return s(c)},[]);var E=function(){return h==null?void 0:h(c)};return!l&&h?[!1,E]:[!0]}function uH(a){return a===null?!0:a.isPresent}var hH=0,dH=function(){return hH++},fH=function(){return hu(dH)},pH=Sr(null),du=typeof window!="undefined",CP=du?na:Vt;function mH(a){var l=a.layoutId,h=cn(pH);return h&&l!==void 0?h+"-"+l:l}function _H(a,l,h,s){var c=cn(cf),E=cn(AP),m=lH(),S=cn(uu),d=mH(h),M=zt(void 0);s||(s=E.renderer),!M.current&&s&&(M.current=s(a,{visualState:l,parent:m,props:ht(ht({},h),{layoutId:d}),presenceId:S==null?void 0:S.id,blockInitialAnimation:(S==null?void 0:S.initial)===!1}));var C=M.current;return CP(function(){!C||(C.setProps(ht(ht(ht({},c),h),{layoutId:d})),C.isPresent=uH(S),C.isPresenceRoot=!m||m.presenceId!==(S==null?void 0:S.id),C.syncRender())}),Vt(function(){var I;!C||(I=C.animationState)===null||I===void 0||I.animateChanges()}),CP(function(){return function(){return C==null?void 0:C.notifyUnmount()}},[]),C}function dv(a){return typeof a=="object"&&Object.prototype.hasOwnProperty.call(a,"current")}function gH(a,l,h){return Gt(function(s){var c;s&&((c=a.mount)===null||c===void 0||c.call(a,s)),l&&(s?l.mount(s):l.unmount()),h&&(typeof h=="function"?h(s):dv(h)&&(h.current=s))},[l])}function RP(a){return Array.isArray(a)}function Fi(a){return typeof a=="string"||RP(a)}function vH(a){var l={};return a.forEachValue(function(h,s){return l[s]=h.get()}),l}function bH(a){var l={};return a.forEachValue(function(h,s){return l[s]=h.getVelocity()}),l}function OP(a,l,h,s,c){var E;return s===void 0&&(s={}),c===void 0&&(c={}),typeof l=="string"&&(l=(E=a.variants)===null||E===void 0?void 0:E[l]),typeof l=="function"?l(h??a.custom,s,c):l}function uf(a,l,h){var s=a.getProps();return OP(s,l,h??s.custom,vH(a),bH(a))}function hf(a){var l;return typeof((l=a.animate)===null||l===void 0?void 0:l.start)=="function"||Fi(a.initial)||Fi(a.animate)||Fi(a.whileHover)||Fi(a.whileDrag)||Fi(a.whileTap)||Fi(a.whileFocus)||Fi(a.exit)}function MP(a){return Boolean(hf(a)||a.variants)}function yH(a,l){if(hf(a)){var h=a.initial,s=a.animate;return{initial:h===!1||Fi(h)?h:void 0,animate:Fi(s)?s:void 0}}return a.inherit!==!1?l:{}}function TH(a,l){var h=yH(a,cn(lf)),s=h.initial,c=h.animate;return Vn(function(){return{initial:s,animate:c}},l?[IP(s),IP(c)]:[])}function IP(a){return Array.isArray(a)?a.join(" "):a}function EH(a){var l=a.preloadedFeatures,h=a.createVisualElement,s=a.useRender,c=a.useVisualState,E=a.Component;l&&aH(l);function m(S,d){var M=cn(cf).isStatic,C=null,I=TH(S,M),b=c(S,M);return!M&&du&&(I.visualElement=_H(E,b,S,h),C=cH(S,I.visualElement)),$e(pr,null,$e(lf.Provider,{value:I},s(E,S,gH(b,I.visualElement,d),b,M)),C)}return Oi(m)}function SH(a){function l(s,c){return c===void 0&&(c={}),EH(a(s,c))}var h=new Map;return new Proxy(l,{get:function(s,c){return h.has(c)||h.set(c,l(c)),h.get(c)}})}var xH=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","svg","switch","symbol","text","tspan","use","view"];function fv(a){return typeof a!="string"||a.includes("-")?!1:!!(xH.indexOf(a)>-1||/[A-Z]/.test(a))}var fu={};function AH(a){for(var l in a)fu[l]=a[l]}var PH=["","X","Y","Z"],CH=["translate","scale","rotate","skew"],pu=["transformPerspective","x","y","z"];CH.forEach(function(a){return PH.forEach(function(l){return pu.push(a+l)})});function RH(a,l){return pu.indexOf(a)-pu.indexOf(l)}var OH=new Set(pu);function df(a){return OH.has(a)}var MH=new Set(["originX","originY","originZ"]);function DP(a){return MH.has(a)}function wP(a,l){var h=l.layout,s=l.layoutId;return df(a)||DP(a)||(h||s!==void 0)&&(!!fu[a]||a==="opacity")}var pa=function(a){return a!==null&&typeof a=="object"&&a.getVelocity},IH={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"};function DH(a,l,h,s){var c=a.transform,E=a.transformKeys,m=l.enableHardwareAcceleration,S=m===void 0?!0:m,d=l.allowTransformNone,M=d===void 0?!0:d,C="";E.sort(RH);for(var I=!1,b=E.length,p=0;p<b;p++){var x=E[p];C+=(IH[x]||x)+"("+c[x]+") ",x==="z"&&(I=!0)}return!I&&S?C+="translateZ(0)":C=C.trim(),s?C=s(c,h?"":C):M&&h&&(C="none"),C}function wH(a){var l=a.originX,h=l===void 0?"50%":l,s=a.originY,c=s===void 0?"50%":s,E=a.originZ,m=E===void 0?0:E;return h+" "+c+" "+m}function LP(a){return a.startsWith("--")}var LH=function(a,l){return l&&typeof a=="number"?l.transform(a):a},NP=function(a,l){return function(h){return Math.max(Math.min(h,l),a)}},mu=function(a){return a%1?Number(a.toFixed(5)):a},_u=/(-)?([\d]*\.?[\d])+/g,pv=/(#[0-9a-f]{6}|#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2,3}\s*\/*\s*[\d\.]+%?\))/gi,NH=/^(#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2,3}\s*\/*\s*[\d\.]+%?\))$/i;function gu(a){return typeof a=="string"}var Ka={test:function(a){return typeof a=="number"},parse:parseFloat,transform:function(a){return a}},vu=ht(ht({},Ka),{transform:NP(0,1)}),ff=ht(ht({},Ka),{default:1}),bu=function(a){return{test:function(l){return gu(l)&&l.endsWith(a)&&l.split(" ").length===1},parse:parseFloat,transform:function(l){return""+l+a}}},ma=bu("deg"),hc=bu("%"),kt=bu("px"),FH=bu("vh"),BH=bu("vw"),FP=ht(ht({},hc),{parse:function(a){return hc.parse(a)/100},transform:function(a){return hc.transform(a*100)}}),mv=function(a,l){return function(h){return Boolean(gu(h)&&NH.test(h)&&h.startsWith(a)||l&&Object.prototype.hasOwnProperty.call(h,l))}},BP=function(a,l,h){return function(s){var c;if(!gu(s))return s;var E=s.match(_u),m=E[0],S=E[1],d=E[2],M=E[3];return c={},c[a]=parseFloat(m),c[l]=parseFloat(S),c[h]=parseFloat(d),c.alpha=M!==void 0?parseFloat(M):1,c}},dc={test:mv("hsl","hue"),parse:BP("hue","saturation","lightness"),transform:function(a){var l=a.hue,h=a.saturation,s=a.lightness,c=a.alpha,E=c===void 0?1:c;return"hsla("+Math.round(l)+", "+hc.transform(mu(h))+", "+hc.transform(mu(s))+", "+mu(vu.transform(E))+")"}},UH=NP(0,255),_v=ht(ht({},Ka),{transform:function(a){return Math.round(UH(a))}}),fc={test:mv("rgb","red"),parse:BP("red","green","blue"),transform:function(a){var l=a.red,h=a.green,s=a.blue,c=a.alpha,E=c===void 0?1:c;return"rgba("+_v.transform(l)+", "+_v.transform(h)+", "+_v.transform(s)+", "+mu(vu.transform(E))+")"}};function VH(a){var l="",h="",s="",c="";return a.length>5?(l=a.substr(1,2),h=a.substr(3,2),s=a.substr(5,2),c=a.substr(7,2)):(l=a.substr(1,1),h=a.substr(2,1),s=a.substr(3,1),c=a.substr(4,1),l+=l,h+=h,s+=s,c+=c),{red:parseInt(l,16),green:parseInt(h,16),blue:parseInt(s,16),alpha:c?parseInt(c,16)/255:1}}var gv={test:mv("#"),parse:VH,transform:fc.transform},Vr={test:function(a){return fc.test(a)||gv.test(a)||dc.test(a)},parse:function(a){return fc.test(a)?fc.parse(a):dc.test(a)?dc.parse(a):gv.parse(a)},transform:function(a){return gu(a)?a:a.hasOwnProperty("red")?fc.transform(a):dc.transform(a)}},UP="${c}",VP="${n}";function kH(a){var l,h,s,c;return isNaN(a)&&gu(a)&&((h=(l=a.match(_u))===null||l===void 0?void 0:l.length)!==null&&h!==void 0?h:0)+((c=(s=a.match(pv))===null||s===void 0?void 0:s.length)!==null&&c!==void 0?c:0)>0}function kP(a){var l=[],h=0,s=a.match(pv);s&&(h=s.length,a=a.replace(pv,UP),l.push.apply(l,s.map(Vr.parse)));var c=a.match(_u);return c&&(a=a.replace(_u,VP),l.push.apply(l,c.map(Ka.parse))),{values:l,numColors:h,tokenised:a}}function jP(a){return kP(a).values}function zP(a){var l=kP(a),h=l.values,s=l.numColors,c=l.tokenised,E=h.length;return function(m){for(var S=c,d=0;d<E;d++)S=S.replace(d<s?UP:VP,d<s?Vr.transform(m[d]):mu(m[d]));return S}}var jH=function(a){return typeof a=="number"?0:a};function zH(a){var l=jP(a),h=zP(a);return h(l.map(jH))}var xo={test:kH,parse:jP,createTransformer:zP,getAnimatableNone:zH},GH=new Set(["brightness","contrast","saturate","opacity"]);function HH(a){var l=a.slice(0,-1).split("("),h=l[0],s=l[1];if(h==="drop-shadow")return a;var c=(s.match(_u)||[])[0];if(!c)return a;var E=s.replace(c,""),m=GH.has(h)?1:0;return c!==s&&(m*=100),h+"("+m+E+")"}var WH=/([a-z-]*)\(.*?\)/g,vv=ht(ht({},xo),{getAnimatableNone:function(a){var l=a.match(WH);return l?l.map(HH).join(" "):a}}),GP=ht(ht({},Ka),{transform:Math.round}),HP={borderWidth:kt,borderTopWidth:kt,borderRightWidth:kt,borderBottomWidth:kt,borderLeftWidth:kt,borderRadius:kt,radius:kt,borderTopLeftRadius:kt,borderTopRightRadius:kt,borderBottomRightRadius:kt,borderBottomLeftRadius:kt,width:kt,maxWidth:kt,height:kt,maxHeight:kt,size:kt,top:kt,right:kt,bottom:kt,left:kt,padding:kt,paddingTop:kt,paddingRight:kt,paddingBottom:kt,paddingLeft:kt,margin:kt,marginTop:kt,marginRight:kt,marginBottom:kt,marginLeft:kt,rotate:ma,rotateX:ma,rotateY:ma,rotateZ:ma,scale:ff,scaleX:ff,scaleY:ff,scaleZ:ff,skew:ma,skewX:ma,skewY:ma,distance:kt,translateX:kt,translateY:kt,translateZ:kt,x:kt,y:kt,z:kt,perspective:kt,transformPerspective:kt,opacity:vu,originX:FP,originY:FP,originZ:kt,zIndex:GP,fillOpacity:vu,strokeOpacity:vu,numOctaves:GP};function bv(a,l,h,s,c,E,m,S){var d,M=a.style,C=a.vars,I=a.transform,b=a.transformKeys,p=a.transformOrigin;b.length=0;var x=!1,P=!1,A=!0;for(var T in l){var _=l[T];if(LP(T)){C[T]=_;continue}var g=HP[T],O=LH(_,g);if(df(T)){if(x=!0,I[T]=O,b.push(T),!A)continue;_!==((d=g.default)!==null&&d!==void 0?d:0)&&(A=!1)}else if(DP(T))p[T]=O,P=!0;else if((h==null?void 0:h.isHydrated)&&(s==null?void 0:s.isHydrated)&&fu[T]){var R=fu[T].process(_,s,h),N=fu[T].applyTo;if(N)for(var V=N.length,U=0;U<V;U++)M[N[U]]=R;else M[T]=R}else M[T]=O}s&&h&&m&&S?(M.transform=m(s.deltaFinal,s.treeScale,x?I:void 0),E&&(M.transform=E(I,M.transform)),M.transformOrigin=S(s)):(x&&(M.transform=DH(a,c,A,E)),P&&(M.transformOrigin=wH(p)))}var yv=function(){return{style:{},transform:{},transformKeys:[],transformOrigin:{},vars:{}}};function WP(a,l,h){for(var s in l)!pa(l[s])&&!wP(s,h)&&(a[s]=l[s])}function XH(a,l,h){var s=a.transformTemplate;return Vn(function(){var c=yv();bv(c,l,void 0,void 0,{enableHardwareAcceleration:!h},s);var E=c.vars,m=c.style;return ht(ht({},E),m)},[l])}function YH(a,l,h){var s=a.style||{},c={};return WP(c,s,a),Object.assign(c,XH(a,l,h)),a.transformValues&&(c=a.transformValues(c)),c}function KH(a,l,h){var s={},c=YH(a,l,h);return Boolean(a.drag)&&(s.draggable=!1,c.userSelect=c.WebkitUserSelect=c.WebkitTouchCallout="none",c.touchAction=a.drag===!0?"none":"pan-"+(a.drag==="x"?"y":"x")),s.style=c,s}var QH=new Set(["initial","animate","exit","style","variants","transition","transformTemplate","transformValues","custom","inherit","layout","layoutId","_layoutResetTransform","onLayoutAnimationComplete","onViewportBoxUpdate","onLayoutMeasure","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","drag","dragControls","dragListener","dragConstraints","dragDirectionLock","_dragX","_dragY","dragElastic","dragMomentum","dragPropagation","dragTransition","whileDrag","onPan","onPanStart","onPanEnd","onPanSessionStart","onTap","onTapStart","onTapCancel","onHoverStart","onHoverEnd","whileFocus","whileTap","whileHover"]);function pf(a){return QH.has(a)}var XP=function(a){return!pf(a)};try{var qH=require("@emotion/is-prop-valid").default;XP=function(a){return a.startsWith("on")?!pf(a):qH(a)}}catch(a){}function ZH(a,l,h){var s={};for(var c in a)(XP(c)||h===!0&&pf(c)||!l&&!pf(c))&&(s[c]=a[c]);return s}function YP(a,l,h){return typeof a=="string"?a:kt.transform(l+h*a)}function $H(a,l,h){var s=YP(l,a.x,a.width),c=YP(h,a.y,a.height);return s+" "+c}var Tv=function(a,l){return kt.transform(a*l)},JH={offset:"stroke-dashoffset",array:"stroke-dasharray"},eW={offset:"strokeDashoffset",array:"strokeDasharray"};function tW(a,l,h,s,c,E){s===void 0&&(s=1),c===void 0&&(c=0),E===void 0&&(E=!0);var m=E?JH:eW;a[m.offset]=Tv(-c,l);var S=Tv(h,l),d=Tv(s,l);a[m.array]=S+" "+d}function Ev(a,l,h,s,c,E,m,S){var d=l.attrX,M=l.attrY,C=l.originX,I=l.originY,b=l.pathLength,p=l.pathSpacing,x=p===void 0?1:p,P=l.pathOffset,A=P===void 0?0:P,T=oi(l,["attrX","attrY","originX","originY","pathLength","pathSpacing","pathOffset"]);bv(a,T,h,s,c,E,m,S),a.attrs=a.style,a.style={};var _=a.attrs,g=a.style,O=a.dimensions,R=a.totalPathLength;_.transform&&(O&&(g.transform=_.transform),delete _.transform),O&&(C!==void 0||I!==void 0||g.transform)&&(g.transformOrigin=$H(O,C!==void 0?C:.5,I!==void 0?I:.5)),d!==void 0&&(_.x=d),M!==void 0&&(_.y=M),R!==void 0&&b!==void 0&&tW(_,R,b,x,A,!1)}var KP=function(){return ht(ht({},yv()),{attrs:{}})};function nW(a,l){var h=Vn(function(){var c=KP();return Ev(c,l,void 0,void 0,{enableHardwareAcceleration:!1},a.transformTemplate),ht(ht({},c.attrs),{style:ht({},c.style)})},[l]);if(a.style){var s={};WP(s,a.style,a),h.style=ht(ht({},s),h.style)}return h}function rW(a){a===void 0&&(a=!1);var l=function(h,s,c,E,m){var S=E.latestValues,d=fv(h)?nW:KH,M=d(s,S,m),C=ZH(s,typeof h=="string",a),I=ht(ht(ht({},C),M),{ref:c});return $e(h,I)};return l}var iW=/([a-z])([A-Z])/g,oW="$1-$2",QP=function(a){return a.replace(iW,oW).toLowerCase()};function qP(a,l){var h=l.style,s=l.vars;Object.assign(a.style,h);for(var c in s)a.style.setProperty(c,s[c])}var ZP=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform"]);function $P(a,l){qP(a,l);for(var h in l.attrs)a.setAttribute(ZP.has(h)?h:QP(h),l.attrs[h])}function Sv(a){var l=a.style,h={};for(var s in l)(pa(l[s])||wP(s,a))&&(h[s]=l[s]);return h}function JP(a){var l=Sv(a);for(var h in a)if(pa(a[h])){var s=h==="x"||h==="y"?"attr"+h.toUpperCase():h;l[s]=a[h]}return l}function xv(a){return typeof a=="object"&&typeof a.start=="function"}var yu=function(a){return Array.isArray(a)},aW=function(a){return Boolean(a&&typeof a=="object"&&a.mix&&a.toValue)},sW=function(a){return yu(a)?a[a.length-1]||0:a};function cW(a){var l=pa(a)?a.get():a;return aW(l)?l.toValue():l}function eC(a,l,h,s){var c=a.scrapeMotionValuesFromProps,E=a.createRenderState,m=a.onMount,S={latestValues:lW(l,h,s,c),renderState:E()};return m&&(S.mount=function(d){return m(l,d,S)}),S}var tC=function(a){return function(l,h){var s=cn(lf),c=cn(uu);return h?eC(a,l,s,c):hu(function(){return eC(a,l,s,c)})}};function lW(a,l,h,s){var c={},E=(h==null?void 0:h.initial)===!1,m=s(a);for(var S in m)c[S]=cW(m[S]);var d=a.initial,M=a.animate,C=hf(a),I=MP(a);l&&I&&!C&&a.inherit!==!1&&(d??(d=l.initial),M??(M=l.animate));var b=E||d===!1?M:d;if(b&&typeof b!="boolean"&&!xv(b)){var p=Array.isArray(b)?b:[b];p.forEach(function(x){var P=OP(a,x);if(!!P){var A=P.transitionEnd;P.transition;var T=oi(P,["transitionEnd","transition"]);for(var _ in T)c[_]=T[_];for(var _ in A)c[_]=A[_]}})}return c}var uW={useVisualState:tC({scrapeMotionValuesFromProps:JP,createRenderState:KP,onMount:function(a,l,h){var s=h.renderState,c=h.latestValues;try{s.dimensions=typeof l.getBBox=="function"?l.getBBox():l.getBoundingClientRect()}catch(E){s.dimensions={x:0,y:0,width:0,height:0}}hW(l)&&(s.totalPathLength=l.getTotalLength()),Ev(s,c,void 0,void 0,{enableHardwareAcceleration:!1},a.transformTemplate),$P(l,s)}})};function hW(a){return a.tagName==="path"}var dW={useVisualState:tC({scrapeMotionValuesFromProps:Sv,createRenderState:yv})};function fW(a,l,h,s){var c=l.forwardMotionProps,E=c===void 0?!1:c,m=fv(a)?uW:dW;return ht(ht({},m),{preloadedFeatures:h,useRender:rW(E),createVisualElement:s,Component:a})}var Zn;(function(a){a.Animate="animate",a.Hover="whileHover",a.Tap="whileTap",a.Drag="whileDrag",a.Focus="whileFocus",a.Exit="exit"})(Zn||(Zn={}));function Av(a,l,h,s){return a.addEventListener(l,h,s),function(){return a.removeEventListener(l,h,s)}}function Pv(a,l,h,s){Vt(function(){var c=a.current;if(h&&c)return Av(c,l,h,s)},[a,l,h,s])}function pW(a){var l=a.whileFocus,h=a.visualElement,s=function(){var E;(E=h.animationState)===null||E===void 0||E.setActive(Zn.Focus,!0)},c=function(){var E;(E=h.animationState)===null||E===void 0||E.setActive(Zn.Focus,!1)};Pv(h,"focus",l?s:void 0),Pv(h,"blur",l?c:void 0)}function nC(a){return typeof PointerEvent!="undefined"&&a instanceof PointerEvent?a.pointerType==="mouse":a instanceof MouseEvent}function rC(a){var l=!!a.touches;return l}function mW(a){return function(l){var h=l instanceof MouseEvent,s=!h||h&&l.button===0;s&&a(l)}}var _W={pageX:0,pageY:0};function gW(a,l){l===void 0&&(l="page");var h=a.touches[0]||a.changedTouches[0],s=h||_W;return{x:s[l+"X"],y:s[l+"Y"]}}function vW(a,l){return l===void 0&&(l="page"),{x:a[l+"X"],y:a[l+"Y"]}}function Cv(a,l){return l===void 0&&(l="page"),{point:rC(a)?gW(a,l):vW(a,l)}}function bW(a){return Cv(a,"client")}var iC=function(a,l){l===void 0&&(l=!1);var h=function(s){return a(s,Cv(s))};return l?mW(h):h},yW=function(){return du&&window.onpointerdown===null},TW=function(){return du&&window.ontouchstart===null},EW=function(){return du&&window.onmousedown===null},SW={pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointercancel:"mousecancel",pointerover:"mouseover",pointerout:"mouseout",pointerenter:"mouseenter",pointerleave:"mouseleave"},xW={pointerdown:"touchstart",pointermove:"touchmove",pointerup:"touchend",pointercancel:"touchcancel"};function oC(a){return yW()?a:TW()?xW[a]:EW()?SW[a]:a}function pc(a,l,h,s){return Av(a,oC(l),iC(h,l==="pointerdown"),s)}function mf(a,l,h,s){return Pv(a,oC(l),h&&iC(h,l==="pointerdown"),s)}function aC(a){var l=null;return function(){var h=function(){l=null};return l===null?(l=a,h):!1}}var sC=aC("dragHorizontal"),cC=aC("dragVertical");function lC(a){var l=!1;if(a==="y")l=cC();else if(a==="x")l=sC();else{var h=sC(),s=cC();h&&s?l=function(){h(),s()}:(h&&h(),s&&s())}return l}function uC(){var a=lC(!0);return a?(a(),!1):!0}function hC(a,l,h){return function(s,c){var E;!nC(s)||uC()||(h==null||h(s,c),(E=a.animationState)===null||E===void 0||E.setActive(Zn.Hover,l))}}function AW(a){var l=a.onHoverStart,h=a.onHoverEnd,s=a.whileHover,c=a.visualElement;mf(c,"pointerenter",l||s?hC(c,!0,l):void 0),mf(c,"pointerleave",h||s?hC(c,!1,h):void 0)}var dC=function(a,l){return l?a===l?!0:dC(a,l.parentElement):!1};function Rv(a){return Vt(function(){return function(){return a()}},[])}var _f=function(a,l,h){return Math.min(Math.max(h,a),l)},Ov=.001,PW=.01,CW=10,RW=.05,OW=1;function MW(a){var l=a.duration,h=l===void 0?800:l,s=a.bounce,c=s===void 0?.25:s,E=a.velocity,m=E===void 0?0:E,S=a.mass,d=S===void 0?1:S,M,C,I=1-c;I=_f(RW,OW,I),h=_f(PW,CW,h/1e3),I<1?(M=function(P){var A=P*I,T=A*h,_=A-m,g=Mv(P,I),O=Math.exp(-T);return Ov-_/g*O},C=function(P){var A=P*I,T=A*h,_=T*m+m,g=Math.pow(I,2)*Math.pow(P,2)*h,O=Math.exp(-T),R=Mv(Math.pow(P,2),I),N=-M(P)+Ov>0?-1:1;return N*((_-g)*O)/R}):(M=function(P){var A=Math.exp(-P*h),T=(P-m)*h+1;return-Ov+A*T},C=function(P){var A=Math.exp(-P*h),T=(m-P)*(h*h);return A*T});var b=5/h,p=DW(M,C,b);if(h=h*1e3,isNaN(p))return{stiffness:100,damping:10,duration:h};var x=Math.pow(p,2)*d;return{stiffness:x,damping:I*2*Math.sqrt(d*x),duration:h}}var IW=12;function DW(a,l,h){for(var s=h,c=1;c<IW;c++)s=s-a(s)/l(s);return s}function Mv(a,l){return a*Math.sqrt(1-l*l)}var wW=["duration","bounce"],LW=["stiffness","damping","mass"];function fC(a,l){return l.some(function(h){return a[h]!==void 0})}function NW(a){var l=ht({velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1},a);if(!fC(a,LW)&&fC(a,wW)){var h=MW(a);l=ht(ht(ht({},l),h),{velocity:0,mass:1}),l.isResolvedFromDuration=!0}return l}function Iv(a){var l=a.from,h=l===void 0?0:l,s=a.to,c=s===void 0?1:s,E=a.restSpeed,m=E===void 0?2:E,S=a.restDelta,d=oi(a,["from","to","restSpeed","restDelta"]),M={done:!1,value:h},C=NW(d),I=C.stiffness,b=C.damping,p=C.mass,x=C.velocity,P=C.duration,A=C.isResolvedFromDuration,T=pC,_=pC;function g(){var O=x?-(x/1e3):0,R=c-h,N=b/(2*Math.sqrt(I*p)),V=Math.sqrt(I/p)/1e3;if(S??(S=Math.abs(c-h)<=1?.01:.4),N<1){var U=Mv(V,N);T=function(j){var Y=Math.exp(-N*V*j);return c-Y*((O+N*V*R)/U*Math.sin(U*j)+R*Math.cos(U*j))},_=function(j){var Y=Math.exp(-N*V*j);return N*V*Y*(Math.sin(U*j)*(O+N*V*R)/U+R*Math.cos(U*j))-Y*(Math.cos(U*j)*(O+N*V*R)-U*R*Math.sin(U*j))}}else if(N===1)T=function(j){return c-Math.exp(-V*j)*(R+(O+V*R)*j)};else{var L=V*Math.sqrt(N*N-1);T=function(j){var Y=Math.exp(-N*V*j),W=Math.min(L*j,300);return c-Y*((O+N*V*R)*Math.sinh(W)+L*R*Math.cosh(W))/L}}}return g(),{next:function(O){var R=T(O);if(A)M.done=O>=P;else{var N=_(O)*1e3,V=Math.abs(N)<=m,U=Math.abs(c-R)<=S;M.done=V&&U}return M.value=M.done?c:R,M},flipTarget:function(){var O;x=-x,O=[c,h],h=O[0],c=O[1],g()}}}Iv.needsInterpolation=function(a,l){return typeof a=="string"||typeof l=="string"};var pC=function(a){return 0},Tu=function(a,l,h){var s=l-a;return s===0?1:(h-a)/s},Yr=function(a,l,h){return-h*a+h*l+a},FW=function(a,l,h){var s=a*a,c=l*l;return Math.sqrt(Math.max(0,h*(c-s)+s))},BW=[gv,fc,dc],mC=function(a){return BW.find(function(l){return l.test(a)})},_C=function(a,l){var h=mC(a),s=mC(l);lu(h.transform===s.transform);var c=h.parse(a),E=s.parse(l),m=ht({},c),S=h===dc?Yr:FW;return function(d){for(var M in m)M!=="alpha"&&(m[M]=S(c[M],E[M],d));return m.alpha=Yr(c.alpha,E.alpha,d),h.transform(m)}},Dv=function(a){return typeof a=="number"},UW=function(a,l){return function(h){return l(a(h))}},Eu=function(){for(var a=[],l=0;l<arguments.length;l++)a[l]=arguments[l];return a.reduce(UW)};function gC(a,l){return Dv(a)?function(h){return Yr(a,l,h)}:Vr.test(a)?_C(a,l):yC(a,l)}var vC=function(a,l){var h=Ur([],a),s=h.length,c=a.map(function(E,m){return gC(E,l[m])});return function(E){for(var m=0;m<s;m++)h[m]=c[m](E);return h}},VW=function(a,l){var h=ht(ht({},a),l),s={};for(var c in h)a[c]!==void 0&&l[c]!==void 0&&(s[c]=gC(a[c],l[c]));return function(E){for(var m in s)h[m]=s[m](E);return h}};function bC(a){for(var l=xo.parse(a),h=l.length,s=0,c=0,E=0,m=0;m<h;m++)s||typeof l[m]=="number"?s++:l[m].hue!==void 0?E++:c++;return{parsed:l,numNumbers:s,numRGB:c,numHSL:E}}var yC=function(a,l){var h=xo.createTransformer(l),s=bC(a),c=bC(l);return Eu(vC(s.parsed,c.parsed),h)},kW=function(a,l){return function(h){return Yr(a,l,h)}};function jW(a){if(typeof a=="number")return kW;if(typeof a=="string")return Vr.test(a)?_C:yC;if(Array.isArray(a))return vC;if(typeof a=="object")return VW}function zW(a,l,h){for(var s=[],c=h||jW(a[0]),E=a.length-1,m=0;m<E;m++){var S=c(a[m],a[m+1]);if(l){var d=Array.isArray(l)?l[m]:l;S=Eu(d,S)}s.push(S)}return s}function GW(a,l){var h=a[0],s=a[1],c=l[0];return function(E){return c(Tu(h,s,E))}}function HW(a,l){var h=a.length,s=h-1;return function(c){var E=0,m=!1;if(c<=a[0]?m=!0:c>=a[s]&&(E=s-1,m=!0),!m){for(var S=1;S<h&&!(a[S]>c||S===s);S++);E=S-1}var d=Tu(a[E],a[E+1],c);return l[E](d)}}function TC(a,l,h){var s=h===void 0?{}:h,c=s.clamp,E=c===void 0?!0:c,m=s.ease,S=s.mixer,d=a.length;lu(d===l.length),lu(!m||!Array.isArray(m)||m.length===d-1),a[0]>a[d-1]&&(a=[].concat(a),l=[].concat(l),a.reverse(),l.reverse());var M=zW(l,m,S),C=d===2?GW(a,M):HW(a,M);return E?function(I){return C(_f(a[0],a[d-1],I))}:C}var gf=function(a){return function(l){return 1-a(1-l)}},wv=function(a){return function(l){return l<=.5?a(2*l)/2:(2-a(2*(1-l)))/2}},WW=function(a){return function(l){return Math.pow(l,a)}},EC=function(a){return function(l){return l*l*((a+1)*l-a)}},XW=function(a){var l=EC(a);return function(h){return(h*=2)<1?.5*l(h):.5*(2-Math.pow(2,-10*(h-1)))}},SC=1.525,YW=4/11,KW=8/11,QW=9/10,xC=function(a){return a},Lv=WW(2),qW=gf(Lv),AC=wv(Lv),PC=function(a){return 1-Math.sin(Math.acos(a))},CC=gf(PC),ZW=wv(CC),Nv=EC(SC),$W=gf(Nv),JW=wv(Nv),e5=XW(SC),t5=4356/361,n5=35442/1805,r5=16061/1805,vf=function(a){if(a===1||a===0)return a;var l=a*a;return a<YW?7.5625*l:a<KW?9.075*l-9.9*a+3.4:a<QW?t5*l-n5*a+r5:10.8*a*a-20.52*a+10.72},i5=gf(vf),o5=function(a){return a<.5?.5*(1-vf(1-a*2)):.5*vf(a*2-1)+.5};function a5(a,l){return a.map(function(){return l||AC}).splice(0,a.length-1)}function s5(a){var l=a.length;return a.map(function(h,s){return s!==0?s/(l-1):0})}function c5(a,l){return a.map(function(h){return h*l})}function bf(a){var l=a.from,h=l===void 0?0:l,s=a.to,c=s===void 0?1:s,E=a.ease,m=a.offset,S=a.duration,d=S===void 0?300:S,M={done:!1,value:h},C=Array.isArray(c)?c:[h,c],I=c5(m&&m.length===C.length?m:s5(C),d);function b(){return TC(I,C,{ease:Array.isArray(E)?E:a5(C,E)})}var p=b();return{next:function(x){return M.value=p(x),M.done=x>=d,M},flipTarget:function(){C.reverse(),p=b()}}}function l5(a){var l=a.velocity,h=l===void 0?0:l,s=a.from,c=s===void 0?0:s,E=a.power,m=E===void 0?.8:E,S=a.timeConstant,d=S===void 0?350:S,M=a.restDelta,C=M===void 0?.5:M,I=a.modifyTarget,b={done:!1,value:c},p=m*h,x=c+p,P=I===void 0?x:I(x);return P!==x&&(p=P-c),{next:function(A){var T=-p*Math.exp(-A/d);return b.done=!(T>C||T<-C),b.value=b.done?P:P+T,b},flipTarget:function(){}}}var RC={keyframes:bf,spring:Iv,decay:l5};function u5(a){if(Array.isArray(a.to))return bf;if(RC[a.type])return RC[a.type];var l=new Set(Object.keys(a));return l.has("ease")||l.has("duration")&&!l.has("dampingRatio")?bf:l.has("dampingRatio")||l.has("stiffness")||l.has("mass")||l.has("damping")||l.has("restSpeed")||l.has("restDelta")?Iv:bf}function OC(a,l,h){return h===void 0&&(h=0),a-l-h}function h5(a,l,h,s){return h===void 0&&(h=0),s===void 0&&(s=!0),s?OC(l+-a,l,h):l-(a-l)+h}function d5(a,l,h,s){return s?a>=l+h:a<=-h}var f5=function(a){var l=function(h){var s=h.delta;return a(s)};return{start:function(){return Ji.update(l,!0)},stop:function(){return Kl.update(l)}}};function MC(a){var l,h,s=a.from,c=a.autoplay,E=c===void 0?!0:c,m=a.driver,S=m===void 0?f5:m,d=a.elapsed,M=d===void 0?0:d,C=a.repeat,I=C===void 0?0:C,b=a.repeatType,p=b===void 0?"loop":b,x=a.repeatDelay,P=x===void 0?0:x,A=a.onPlay,T=a.onStop,_=a.onComplete,g=a.onRepeat,O=a.onUpdate,R=oi(a,["from","autoplay","driver","elapsed","repeat","repeatType","repeatDelay","onPlay","onStop","onComplete","onRepeat","onUpdate"]),N=R.to,V,U=0,L=R.duration,j,Y=!1,W=!0,re,ne=u5(R);((h=(l=ne).needsInterpolation)===null||h===void 0?void 0:h.call(l,s,N))&&(re=TC([0,100],[s,N],{clamp:!1}),s=0,N=100);var ge=ne(ht(ht({},R),{from:s,to:N}));function _e(){U++,p==="reverse"?(W=U%2==0,M=h5(M,L,P,W)):(M=OC(M,L,P),p==="mirror"&&ge.flipTarget()),Y=!1,g&&g()}function ce(){V.stop(),_&&_()}function ie(te){if(W||(te=-te),M+=te,!Y){var B=ge.next(Math.max(0,M));j=B.value,re&&(j=re(j)),Y=W?B.done:M<=0}O==null||O(j),Y&&(U===0&&(L??(L=M)),U<I?d5(M,L,P,W)&&_e():ce())}function Z(){A==null||A(),V=S(ie),V.start()}return E&&Z(),{stop:function(){T==null||T(),V.stop()}}}function IC(a,l){return l?a*(1e3/l):0}function p5(a){var l=a.from,h=l===void 0?0:l,s=a.velocity,c=s===void 0?0:s,E=a.min,m=a.max,S=a.power,d=S===void 0?.8:S,M=a.timeConstant,C=M===void 0?750:M,I=a.bounceStiffness,b=I===void 0?500:I,p=a.bounceDamping,x=p===void 0?10:p,P=a.restDelta,A=P===void 0?1:P,T=a.modifyTarget,_=a.driver,g=a.onUpdate,O=a.onComplete,R;function N(_e){return E!==void 0&&_e<E||m!==void 0&&_e>m}function V(_e){return E===void 0?m:m===void 0||Math.abs(E-_e)<Math.abs(m-_e)?E:m}function U(_e){R==null||R.stop(),R=MC(ht(ht({},_e),{driver:_,onUpdate:function(ce){var ie;g==null||g(ce),(ie=_e.onUpdate)===null||ie===void 0||ie.call(_e,ce)},onComplete:O}))}function L(_e){U(ht({type:"spring",stiffness:b,damping:x,restDelta:A},_e))}if(N(h))L({from:h,velocity:c,to:V(h)});else{var j=d*c+h;typeof T!="undefined"&&(j=T(j));var Y=V(j),W=Y===E?-1:1,re,ne,ge=function(_e){re=ne,ne=_e,c=IC(_e-re,Gd().delta),(W===1&&_e>Y||W===-1&&_e<Y)&&L({from:_e,to:Y,velocity:c})};U({type:"decay",from:h,velocity:c,timeConstant:C,power:d,restDelta:A,modifyTarget:T,onUpdate:N(j)?ge:void 0})}return{stop:function(){return R==null?void 0:R.stop()}}}var Fv=function(a){return a.hasOwnProperty("x")&&a.hasOwnProperty("y")},DC=function(a){return Fv(a)&&a.hasOwnProperty("z")},yf=function(a,l){return Math.abs(a-l)};function wC(a,l){if(Dv(a)&&Dv(l))return yf(a,l);if(Fv(a)&&Fv(l)){var h=yf(a.x,l.x),s=yf(a.y,l.y),c=DC(a)&&DC(l)?yf(a.z,l.z):0;return Math.sqrt(Math.pow(h,2)+Math.pow(s,2)+Math.pow(c,2))}}var LC=function(a,l){return 1-3*l+3*a},NC=function(a,l){return 3*l-6*a},FC=function(a){return 3*a},Tf=function(a,l,h){return((LC(l,h)*a+NC(l,h))*a+FC(l))*a},BC=function(a,l,h){return 3*LC(l,h)*a*a+2*NC(l,h)*a+FC(l)},m5=1e-7,_5=10;function g5(a,l,h,s,c){var E,m,S=0;do m=l+(h-l)/2,E=Tf(m,s,c)-a,E>0?h=m:l=m;while(Math.abs(E)>m5&&++S<_5);return m}var v5=8,b5=.001;function y5(a,l,h,s){for(var c=0;c<v5;++c){var E=BC(l,h,s);if(E===0)return l;var m=Tf(l,h,s)-a;l-=m/E}return l}var Ef=11,Sf=1/(Ef-1);function T5(a,l,h,s){if(a===l&&h===s)return xC;for(var c=new Float32Array(Ef),E=0;E<Ef;++E)c[E]=Tf(E*Sf,a,h);function m(S){for(var d=0,M=1,C=Ef-1;M!==C&&c[M]<=S;++M)d+=Sf;--M;var I=(S-c[M])/(c[M+1]-c[M]),b=d+I*Sf,p=BC(b,a,h);return p>=b5?y5(S,b,a,h):p===0?b:g5(S,d,d+Sf,a,h)}return function(S){return S===0||S===1?S:Tf(m(S),l,s)}}function E5(a){var l=a.onTap,h=a.onTapStart,s=a.onTapCancel,c=a.whileTap,E=a.visualElement,m=l||h||s||c,S=zt(!1),d=zt(null);function M(){var x;(x=d.current)===null||x===void 0||x.call(d),d.current=null}function C(){var x;return M(),S.current=!1,(x=E.animationState)===null||x===void 0||x.setActive(Zn.Tap,!1),!uC()}function I(x,P){!C()||(dC(E.getInstance(),x.target)?l==null||l(x,P):s==null||s(x,P))}function b(x,P){!C()||s==null||s(x,P)}function p(x,P){var A;M(),!S.current&&(S.current=!0,d.current=Eu(pc(window,"pointerup",I),pc(window,"pointercancel",b)),h==null||h(x,P),(A=E.animationState)===null||A===void 0||A.setActive(Zn.Tap,!0))}mf(E,"pointerdown",m?p:void 0),Rv(M)}var Qa=function(a){return function(l){return a(l),null}},S5={tap:Qa(E5),focus:Qa(pW),hover:Qa(AW)};function UC(a,l){if(!Array.isArray(l))return!1;var h=l.length;if(h!==a.length)return!1;for(var s=0;s<h;s++)if(l[s]!==a[s])return!1;return!0}var xf=function(a){return a*1e3},x5={linear:xC,easeIn:Lv,easeInOut:AC,easeOut:qW,circIn:PC,circInOut:ZW,circOut:CC,backIn:Nv,backInOut:JW,backOut:$W,anticipate:e5,bounceIn:i5,bounceInOut:o5,bounceOut:vf},VC=function(a){if(Array.isArray(a)){lu(a.length===4);var l=Wn(a,4),h=l[0],s=l[1],c=l[2],E=l[3];return T5(h,s,c,E)}else if(typeof a=="string")return x5[a];return a},A5=function(a){return Array.isArray(a)&&typeof a[0]!="number"},kC=function(a,l){return a==="zIndex"?!1:!!(typeof l=="number"||Array.isArray(l)||typeof l=="string"&&xo.test(l)&&!l.startsWith("url("))},qa=function(){return{type:"spring",stiffness:500,damping:25,restDelta:.5,restSpeed:10}},Af=function(a){return{type:"spring",stiffness:550,damping:a===0?2*Math.sqrt(550):30,restDelta:.01,restSpeed:10}},Bv=function(){return{type:"keyframes",ease:"linear",duration:.3}},P5=function(a){return{type:"keyframes",duration:.8,values:a}},jC={x:qa,y:qa,z:qa,rotate:qa,rotateX:qa,rotateY:qa,rotateZ:qa,scaleX:Af,scaleY:Af,scale:Af,opacity:Bv,backgroundColor:Bv,color:Bv,default:Af},C5=function(a,l){var h;return yu(l)?h=P5:h=jC[a]||jC.default,ht({to:l},h(l))},R5=ht(ht({},HP),{color:Vr,backgroundColor:Vr,outlineColor:Vr,fill:Vr,stroke:Vr,borderColor:Vr,borderTopColor:Vr,borderRightColor:Vr,borderBottomColor:Vr,borderLeftColor:Vr,filter:vv,WebkitFilter:vv}),Uv=function(a){return R5[a]};function Vv(a,l){var h,s=Uv(a);return s!==vv&&(s=xo),(h=s.getAnimatableNone)===null||h===void 0?void 0:h.call(s,l)}function O5(a){a.when,a.delay,a.delayChildren,a.staggerChildren,a.staggerDirection,a.repeat,a.repeatType,a.repeatDelay,a.from;var l=oi(a,["when","delay","delayChildren","staggerChildren","staggerDirection","repeat","repeatType","repeatDelay","from"]);return!!Object.keys(l).length}function M5(a){var l=a.ease,h=a.times,s=a.yoyo,c=a.flip,E=a.loop,m=oi(a,["ease","times","yoyo","flip","loop"]),S=ht({},m);return h&&(S.offset=h),m.duration&&(S.duration=xf(m.duration)),m.repeatDelay&&(S.repeatDelay=xf(m.repeatDelay)),l&&(S.ease=A5(l)?l.map(VC):VC(l)),m.type==="tween"&&(S.type="keyframes"),(s||E||c)&&(s?S.repeatType="reverse":E?S.repeatType="loop":c&&(S.repeatType="mirror"),S.repeat=E||s||c||m.repeat),m.type!=="spring"&&(S.type="keyframes"),S}function I5(a,l){var h,s=kv(a,l)||{};return(h=s.delay)!==null&&h!==void 0?h:0}function D5(a){return Array.isArray(a.to)&&a.to[0]===null&&(a.to=Ur([],Wn(a.to)),a.to[0]=a.from),a}function w5(a,l,h){var s;return Array.isArray(l.to)&&((s=a.duration)!==null&&s!==void 0||(a.duration=.8)),D5(l),O5(a)||(a=ht(ht({},a),C5(h,l.to))),ht(ht({},l),M5(a))}function L5(a,l,h,s,c){var E,m=kv(s,a),S=(E=m.from)!==null&&E!==void 0?E:l.get(),d=kC(a,h);S==="none"&&d&&typeof h=="string"?S=Vv(a,h):zC(S)&&typeof h=="string"?S=GC(h):!Array.isArray(h)&&zC(h)&&typeof S=="string"&&(h=GC(S));var M=kC(a,S);function C(){var b={from:S,to:h,velocity:l.getVelocity(),onComplete:c,onUpdate:function(p){return l.set(p)}};return m.type==="inertia"||m.type==="decay"?p5(ht(ht({},b),m)):MC(ht(ht({},w5(m,b,a)),{onUpdate:function(p){var x;b.onUpdate(p),(x=m.onUpdate)===null||x===void 0||x.call(m,p)},onComplete:function(){var p;b.onComplete(),(p=m.onComplete)===null||p===void 0||p.call(m)}}))}function I(){var b;return l.set(h),c(),(b=m==null?void 0:m.onComplete)===null||b===void 0||b.call(m),{stop:function(){}}}return!M||!d||m.type===!1?I:C}function zC(a){return a===0||typeof a=="string"&&parseFloat(a)===0&&a.indexOf(" ")===-1}function GC(a){return typeof a=="number"?0:Vv("",a)}function kv(a,l){return a[l]||a.default||a}function Pf(a,l,h,s){return s===void 0&&(s={}),l.start(function(c){var E,m,S=L5(a,l,h,s,c),d=I5(s,a),M=function(){return m=S()};return d?E=setTimeout(M,xf(d)):M(),function(){clearTimeout(E),m==null||m.stop()}})}var N5=function(a){return/^\-?\d*\.?\d+$/.test(a)};function HC(a,l){a.indexOf(l)===-1&&a.push(l)}function WC(a,l){var h=a.indexOf(l);h>-1&&a.splice(h,1)}var Cf=function(){function a(){this.subscriptions=[]}return a.prototype.add=function(l){var h=this;return HC(this.subscriptions,l),function(){return WC(h.subscriptions,l)}},a.prototype.notify=function(l,h,s){var c=this.subscriptions.length;if(!!c)if(c===1)this.subscriptions[0](l,h,s);else for(var E=0;E<c;E++){var m=this.subscriptions[E];m&&m(l,h,s)}},a.prototype.getSize=function(){return this.subscriptions.length},a.prototype.clear=function(){this.subscriptions.length=0},a}(),F5=function(a){return!isNaN(parseFloat(a))},B5=function(){function a(l){var h=this;this.timeDelta=0,this.lastUpdated=0,this.updateSubscribers=new Cf,this.velocityUpdateSubscribers=new Cf,this.renderSubscribers=new Cf,this.canTrackVelocity=!1,this.updateAndNotify=function(s,c){c===void 0&&(c=!0),h.prev=h.current,h.current=s;var E=Gd(),m=E.delta,S=E.timestamp;h.lastUpdated!==S&&(h.timeDelta=m,h.lastUpdated=S,Ji.postRender(h.scheduleVelocityCheck)),h.prev!==h.current&&h.updateSubscribers.notify(h.current),h.velocityUpdateSubscribers.getSize()&&h.velocityUpdateSubscribers.notify(h.getVelocity()),c&&h.renderSubscribers.notify(h.current)},this.scheduleVelocityCheck=function(){return Ji.postRender(h.velocityCheck)},this.velocityCheck=function(s){var c=s.timestamp;c!==h.lastUpdated&&(h.prev=h.current,h.velocityUpdateSubscribers.notify(h.getVelocity()))},this.hasAnimated=!1,this.prev=this.current=l,this.canTrackVelocity=F5(this.current)}return a.prototype.onChange=function(l){return this.updateSubscribers.add(l)},a.prototype.clearListeners=function(){this.updateSubscribers.clear()},a.prototype.onRenderRequest=function(l){return l(this.get()),this.renderSubscribers.add(l)},a.prototype.attach=function(l){this.passiveEffect=l},a.prototype.set=function(l,h){h===void 0&&(h=!0),!h||!this.passiveEffect?this.updateAndNotify(l,h):this.passiveEffect(l,this.updateAndNotify)},a.prototype.get=function(){return this.current},a.prototype.getPrevious=function(){return this.prev},a.prototype.getVelocity=function(){return this.canTrackVelocity?IC(parseFloat(this.current)-parseFloat(this.prev),this.timeDelta):0},a.prototype.start=function(l){var h=this;return this.stop(),new Promise(function(s){h.hasAnimated=!0,h.stopAnimation=l(s)}).then(function(){return h.clearAnimation()})},a.prototype.stop=function(){this.stopAnimation&&this.stopAnimation(),this.clearAnimation()},a.prototype.isAnimating=function(){return!!this.stopAnimation},a.prototype.clearAnimation=function(){this.stopAnimation=null},a.prototype.destroy=function(){this.updateSubscribers.clear(),this.renderSubscribers.clear(),this.stop()},a}();function Za(a){return new B5(a)}var XC=function(a){return function(l){return l.test(a)}},U5={test:function(a){return a==="auto"},parse:function(a){return a}},YC=[Ka,kt,hc,ma,BH,FH,U5],Rf=function(a){return YC.find(XC(a))},V5=Ur(Ur([],Wn(YC)),[Vr,xo]),k5=function(a){return V5.find(XC(a))};function j5(a,l,h){a.hasValue(l)?a.getValue(l).set(h):a.addValue(l,Za(h))}function z5(a,l){var h=uf(a,l),s=h?a.makeTargetAnimatable(h,!1):{},c=s.transitionEnd,E=c===void 0?{}:c;s.transition;var m=oi(s,["transitionEnd","transition"]);m=ht(ht({},m),E);for(var S in m){var d=sW(m[S]);j5(a,S,d)}}function G5(a,l,h){var s,c,E,m,S=Object.keys(l).filter(function(p){return!a.hasValue(p)}),d=S.length;if(!!d)for(var M=0;M<d;M++){var C=S[M],I=l[C],b=null;Array.isArray(I)&&(b=I[0]),b===null&&(b=(c=(s=h[C])!==null&&s!==void 0?s:a.readValue(C))!==null&&c!==void 0?c:l[C]),b!=null&&(typeof b=="string"&&N5(b)?b=parseFloat(b):!k5(b)&&xo.test(I)&&(b=Vv(C,I)),a.addValue(C,Za(b)),(E=(m=h)[C])!==null&&E!==void 0||(m[C]=b),a.setBaseTarget(C,b))}}function H5(a,l){if(!!l){var h=l[a]||l.default||l;return h.from}}function W5(a,l,h){var s,c,E={};for(var m in a)E[m]=(s=H5(m,l))!==null&&s!==void 0?s:(c=h.getValue(m))===null||c===void 0?void 0:c.get();return E}function X5(a,l,h){h===void 0&&(h={}),a.notifyAnimationStart();var s;if(Array.isArray(l)){var c=l.map(function(m){return jv(a,m,h)});s=Promise.all(c)}else if(typeof l=="string")s=jv(a,l,h);else{var E=typeof l=="function"?uf(a,l,h.custom):l;s=KC(a,E,h)}return s.then(function(){return a.notifyAnimationComplete(l)})}function jv(a,l,h){var s;h===void 0&&(h={});var c=uf(a,l,h.custom),E=(c||{}).transition,m=E===void 0?a.getDefaultTransition()||{}:E;h.transitionOverride&&(m=h.transitionOverride);var S=c?function(){return KC(a,c,h)}:function(){return Promise.resolve()},d=((s=a.variantChildren)===null||s===void 0?void 0:s.size)?function(p){p===void 0&&(p=0);var x=m.delayChildren,P=x===void 0?0:x,A=m.staggerChildren,T=m.staggerDirection;return Y5(a,l,P+p,A,T,h)}:function(){return Promise.resolve()},M=m.when;if(M){var C=Wn(M==="beforeChildren"?[S,d]:[d,S],2),I=C[0],b=C[1];return I().then(b)}else return Promise.all([S(),d(h.delay)])}function KC(a,l,h){var s,c=h===void 0?{}:h,E=c.delay,m=E===void 0?0:E,S=c.transitionOverride,d=c.type,M=a.makeTargetAnimatable(l),C=M.transition,I=C===void 0?a.getDefaultTransition():C,b=M.transitionEnd,p=oi(M,["transition","transitionEnd"]);S&&(I=S);var x=[],P=d&&((s=a.animationState)===null||s===void 0?void 0:s.getState()[d]);for(var A in p){var T=a.getValue(A),_=p[A];if(!(!T||_===void 0||P&&Q5(P,A))){var g=Pf(A,T,_,ht({delay:m},I));x.push(g)}}return Promise.all(x).then(function(){b&&z5(a,b)})}function Y5(a,l,h,s,c,E){h===void 0&&(h=0),s===void 0&&(s=0),c===void 0&&(c=1);var m=[],S=(a.variantChildren.size-1)*s,d=c===1?function(M){return M===void 0&&(M=0),M*s}:function(M){return M===void 0&&(M=0),S-M*s};return Array.from(a.variantChildren).sort(K5).forEach(function(M,C){m.push(jv(M,l,ht(ht({},E),{delay:h+d(C)})).then(function(){return M.notifyAnimationComplete(l)}))}),Promise.all(m)}function K5(a,l){return a.sortNodePosition(l)}function Q5(a,l){var h=a.protectedKeys,s=a.needsAnimating,c=h.hasOwnProperty(l)&&s[l]!==!0;return s[l]=!1,c}var zv=[Zn.Animate,Zn.Hover,Zn.Tap,Zn.Drag,Zn.Focus,Zn.Exit],q5=Ur([],Wn(zv)).reverse(),Z5=zv.length;function $5(a){return function(l){return Promise.all(l.map(function(h){var s=h.animation,c=h.options;return X5(a,s,c)}))}}function J5(a){var l=$5(a),h=tX(),s={},c=!0,E=function(C,I){var b=uf(a,I);if(b){b.transition;var p=b.transitionEnd,x=oi(b,["transition","transitionEnd"]);C=ht(ht(ht({},C),x),p)}return C};function m(C){return s[C]!==void 0}function S(C){l=C(a)}function d(C,I){for(var b,p=a.getProps(),x=a.getVariantContext(!0)||{},P=[],A=new Set,T={},_=1/0,g=function(V){var U=q5[V],L=h[U],j=(b=p[U])!==null&&b!==void 0?b:x[U],Y=Fi(j),W=U===I?L.isActive:null;W===!1&&(_=V);var re=j===x[U]&&j!==p[U]&&Y;if(re&&c&&a.manuallyAnimateOnMount&&(re=!1),L.protectedKeys=ht({},T),!L.isActive&&W===null||!j&&!L.prevProp||xv(j)||typeof j=="boolean")return"continue";var ne=eX(L.prevProp,j)||U===I&&L.isActive&&!re&&Y||V>_&&Y,ge=Array.isArray(j)?j:[j],_e=ge.reduce(E,{});W===!1&&(_e={});var ce=L.prevResolvedValues,ie=ce===void 0?{}:ce,Z=ht(ht({},ie),_e),te=function(le){ne=!0,A.delete(le),L.needsAnimating[le]=!0};for(var B in Z){var G=_e[B],$=ie[B];T.hasOwnProperty(B)||(G!==$?yu(G)&&yu($)?UC(G,$)?L.protectedKeys[B]=!0:te(B):G!==void 0?te(B):A.add(B):G!==void 0&&A.has(B)?te(B):L.protectedKeys[B]=!0)}L.prevProp=j,L.prevResolvedValues=_e,L.isActive&&(T=ht(ht({},T),_e)),c&&a.blockInitialAnimation&&(ne=!1),ne&&!re&&P.push.apply(P,Ur([],Wn(ge.map(function(le){return{animation:le,options:ht({type:U},C)}}))))},O=0;O<Z5;O++)g(O);if(s=ht({},T),A.size){var R={};A.forEach(function(V){var U=a.getBaseTarget(V);U!==void 0&&(R[V]=U)}),P.push({animation:R})}var N=Boolean(P.length);return c&&p.initial===!1&&!a.manuallyAnimateOnMount&&(N=!1),c=!1,N?l(P):Promise.resolve()}function M(C,I,b){var p;return h[C].isActive===I?Promise.resolve():((p=a.variantChildren)===null||p===void 0||p.forEach(function(x){var P;return(P=x.animationState)===null||P===void 0?void 0:P.setActive(C,I)}),h[C].isActive=I,d(b,C))}return{isAnimated:m,animateChanges:d,setActive:M,setAnimateFunction:S,getState:function(){return h}}}function eX(a,l){return typeof l=="string"?l!==a:RP(l)?!UC(l,a):!1}function mc(a){return a===void 0&&(a=!1),{isActive:a,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function tX(){var a;return a={},a[Zn.Animate]=mc(!0),a[Zn.Hover]=mc(),a[Zn.Tap]=mc(),a[Zn.Drag]=mc(),a[Zn.Focus]=mc(),a[Zn.Exit]=mc(),a}var nX={animation:Qa(function(a){var l=a.visualElement,h=a.animate;l.animationState||(l.animationState=J5(l)),xv(h)&&Vt(function(){return h.subscribe(l)},[h])}),exit:Qa(function(a){var l=a.custom,h=a.visualElement,s=Wn(hv(),2),c=s[0],E=s[1],m=cn(uu);Vt(function(){var S,d,M=(S=h.animationState)===null||S===void 0?void 0:S.setActive(Zn.Exit,!c,{custom:(d=m==null?void 0:m.custom)!==null&&d!==void 0?d:l});!c&&(M==null||M.then(E))},[c])})},QC=function(){function a(l,h,s){var c=this,E=s===void 0?{}:s,m=E.transformPagePoint;if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.updatePoint=function(){if(!!(c.lastMoveEvent&&c.lastMoveEventInfo)){var b=Hv(c.lastMoveEventInfo,c.history),p=c.startEvent!==null,x=wC(b.offset,{x:0,y:0})>=3;if(!(!p&&!x)){var P=b.point,A=Gd().timestamp;c.history.push(ht(ht({},P),{timestamp:A}));var T=c.handlers,_=T.onStart,g=T.onMove;p||(_&&_(c.lastMoveEvent,b),c.startEvent=c.lastMoveEvent),g&&g(c.lastMoveEvent,b)}}},this.handlePointerMove=function(b,p){if(c.lastMoveEvent=b,c.lastMoveEventInfo=Gv(p,c.transformPagePoint),nC(b)&&b.buttons===0){c.handlePointerUp(b,p);return}Ji.update(c.updatePoint,!0)},this.handlePointerUp=function(b,p){c.end();var x=c.handlers,P=x.onEnd,A=x.onSessionEnd,T=Hv(Gv(p,c.transformPagePoint),c.history);c.startEvent&&P&&P(b,T),A&&A(b,T)},!(rC(l)&&l.touches.length>1)){this.handlers=h,this.transformPagePoint=m;var S=Cv(l),d=Gv(S,this.transformPagePoint),M=d.point,C=Gd().timestamp;this.history=[ht(ht({},M),{timestamp:C})];var I=h.onSessionStart;I&&I(l,Hv(d,this.history)),this.removeListeners=Eu(pc(window,"pointermove",this.handlePointerMove),pc(window,"pointerup",this.handlePointerUp),pc(window,"pointercancel",this.handlePointerUp))}}return a.prototype.updateHandlers=function(l){this.handlers=l},a.prototype.end=function(){this.removeListeners&&this.removeListeners(),Kl.update(this.updatePoint)},a}();function Gv(a,l){return l?{point:l(a.point)}:a}function qC(a,l){return{x:a.x-l.x,y:a.y-l.y}}function Hv(a,l){var h=a.point;return{point:h,delta:qC(h,ZC(l)),offset:qC(h,rX(l)),velocity:iX(l,.1)}}function rX(a){return a[0]}function ZC(a){return a[a.length-1]}function iX(a,l){if(a.length<2)return{x:0,y:0};for(var h=a.length-1,s=null,c=ZC(a);h>=0&&(s=a[h],!(c.timestamp-s.timestamp>xf(l)));)h--;if(!s)return{x:0,y:0};var E=(c.timestamp-s.timestamp)/1e3;if(E===0)return{x:0,y:0};var m={x:(c.x-s.x)/E,y:(c.y-s.y)/E};return m.x===1/0&&(m.x=0),m.y===1/0&&(m.y=0),m}function oX(a){return a}function $C(a){var l=a.top,h=a.left,s=a.right,c=a.bottom;return{x:{min:h,max:s},y:{min:l,max:c}}}function aX(a){var l=a.x,h=a.y;return{top:h.min,bottom:h.max,left:l.min,right:l.max}}function sX(a,l){var h=a.top,s=a.left,c=a.bottom,E=a.right;l===void 0&&(l=oX);var m=l({x:s,y:h}),S=l({x:E,y:c});return{top:m.y,left:m.x,bottom:S.y,right:S.x}}function _a(){return{x:{min:0,max:1},y:{min:0,max:1}}}function cX(a){return{x:ht({},a.x),y:ht({},a.y)}}var JC={translate:0,scale:1,origin:0,originPoint:0};function eR(){return{x:ht({},JC),y:ht({},JC)}}function Kr(a){return[a("x"),a("y")]}function tR(a,l,h){var s=l.min,c=l.max;return s!==void 0&&a<s?a=h?Yr(s,a,h.min):Math.max(a,s):c!==void 0&&a>c&&(a=h?Yr(c,a,h.max):Math.min(a,c)),a}function lX(a,l,h,s,c){var E=a-l*h;return s?tR(E,s,c):E}function nR(a,l,h){return{min:l!==void 0?a.min+l:void 0,max:h!==void 0?a.max+h-(a.max-a.min):void 0}}function uX(a,l){var h=l.top,s=l.left,c=l.bottom,E=l.right;return{x:nR(a.x,s,E),y:nR(a.y,h,c)}}function rR(a,l){var h,s=l.min-a.min,c=l.max-a.max;return l.max-l.min<a.max-a.min&&(h=Wn([c,s],2),s=h[0],c=h[1]),{min:a.min+s,max:a.min+c}}function hX(a,l){return{x:rR(a.x,l.x),y:rR(a.y,l.y)}}function dX(a,l,h){var s=a.max-a.min,c=Yr(l.min,l.max-s,h);return{min:c,max:c+s}}function fX(a,l){var h={};return l.min!==void 0&&(h.min=l.min-a.min),l.max!==void 0&&(h.max=l.max-a.min),h}var iR=.35;function pX(a){return a===!1?a=0:a===!0&&(a=iR),{x:oR(a,"left","right"),y:oR(a,"top","bottom")}}function oR(a,l,h){return{min:aR(a,l),max:aR(a,h)}}function aR(a,l){var h;return typeof a=="number"?a:(h=a[l])!==null&&h!==void 0?h:0}function sR(a,l){var h=a.getBoundingClientRect();return $C(sX(h,l))}var mX=function(a){return _f(0,1,a)};function cR(a,l,h){return l===void 0&&(l=0),h===void 0&&(h=.01),wC(a,l)<h}function Su(a){return a.max-a.min}function _X(a,l){var h=.5,s=Su(a),c=Su(l);return c>s?h=Tu(l.min,l.max-s,a.min):s>c&&(h=Tu(a.min,a.max-c,l.min)),mX(h)}function lR(a,l,h,s){s===void 0&&(s=.5),a.origin=s,a.originPoint=Yr(l.min,l.max,a.origin),a.scale=Su(h)/Su(l),cR(a.scale,1,1e-4)&&(a.scale=1),a.translate=Yr(h.min,h.max,a.origin)-a.originPoint,cR(a.translate)&&(a.translate=0)}function uR(a,l,h,s){lR(a.x,l.x,h.x,hR(s.originX)),lR(a.y,l.y,h.y,hR(s.originY))}function hR(a){return typeof a=="number"?a:.5}function dR(a,l,h){a.min=h.min+l.min,a.max=a.min+Su(l)}function gX(a,l){dR(a.target.x,a.relativeTarget.x,l.target.x),dR(a.target.y,a.relativeTarget.y,l.target.y)}var Wv=function(a,l){return a.depth-l.depth};function fR(a){var l=a.projection.isEnabled;return l||a.shouldResetTransform()}function Of(a,l){l===void 0&&(l=[]);var h=a.parent;return h&&Of(h,l),fR(a)&&l.push(a),l}function vX(a){var l=[],h=function(s){fR(s)&&l.push(s),s.children.forEach(h)};return a.children.forEach(h),l.sort(Wv)}function Mf(a){if(!a.shouldResetTransform()){var l=a.getLayoutState();a.notifyBeforeLayoutMeasure(l.layout),l.isHydrated=!0,l.layout=a.measureViewportBox(),l.layoutCorrected=cX(l.layout),a.notifyLayoutMeasure(l.layout,a.prevViewportBox||l.layout),Ji.update(function(){return a.rebaseProjectionTarget()})}}function bX(a){a.shouldResetTransform()||(a.prevViewportBox=a.measureViewportBox(!1),a.rebaseProjectionTarget(!1,a.prevViewportBox))}function yX(a,l,h,s){a.min=Yr(l.min,h.min,s),a.max=Yr(l.max,h.max,s)}function pR(a,l){return{min:l.min-a.min,max:l.max-a.min}}function _c(a,l){return{x:pR(a.x,l.x),y:pR(a.y,l.y)}}function TX(a,l){var h=a.getLayoutId(),s=l.getLayoutId();return h!==s||s===void 0&&a!==l}function mR(a){var l=a.getProps(),h=l.drag,s=l._dragX;return h&&!s}function _R(a,l){a.min=l.min,a.max=l.max}function EX(a,l){_R(a.x,l.x),_R(a.y,l.y)}function If(a,l,h){var s=a-h,c=l*s;return h+c}function gR(a,l,h,s,c){return c!==void 0&&(a=If(a,c,s)),If(a,h,s)+l}function Xv(a,l,h,s,c){l===void 0&&(l=0),h===void 0&&(h=1),a.min=gR(a.min,l,h,s,c),a.max=gR(a.max,l,h,s,c)}function SX(a,l){var h=l.x,s=l.y;Xv(a.x,h.translate,h.scale,h.originPoint),Xv(a.y,s.translate,s.scale,s.originPoint)}function vR(a,l,h,s){var c=Wn(s,3),E=c[0],m=c[1],S=c[2];a.min=l.min,a.max=l.max;var d=h[S]!==void 0?h[S]:.5,M=Yr(l.min,l.max,d);Xv(a,h[E],h[m],M,h.scale)}var bR=["x","scaleX","originX"],yR=["y","scaleY","originY"];function Yv(a,l,h){vR(a.x,l.x,h,bR),vR(a.y,l.y,h,yR)}function TR(a,l,h,s,c){return a-=l,a=If(a,1/h,s),c!==void 0&&(a=If(a,1/c,s)),a}function xX(a,l,h,s,c){l===void 0&&(l=0),h===void 0&&(h=1),s===void 0&&(s=.5);var E=Yr(a.min,a.max,s)-l;a.min=TR(a.min,l,h,E,c),a.max=TR(a.max,l,h,E,c)}function ER(a,l,h){var s=Wn(h,3),c=s[0],E=s[1],m=s[2];xX(a,l[c],l[E],l[m],l.scale)}function SR(a,l){ER(a.x,l,bR),ER(a.y,l,yR)}function AX(a,l,h){var s=h.length;if(!!s){l.x=l.y=1;for(var c,E,m=0;m<s;m++)c=h[m],E=c.getLayoutState().delta,l.x*=E.x.scale,l.y*=E.y.scale,SX(a,E),mR(c)&&Yv(a,a,c.getLatestValues())}}function PX(a,l){l===void 0&&(l=!0);var h=a.getProjectionParent();if(!h)return!1;var s;return l?(s=_c(h.projection.target,a.projection.target),SR(s,h.getLatestValues())):s=_c(h.getLayoutState().layout,a.getLayoutState().layout),Kr(function(c){return a.setProjectionTargetAxis(c,s[c].min,s[c].max,!0)}),!0}var xu=new Set;function xR(a,l,h){a[h]||(a[h]=[]),a[h].push(l)}function Kv(a){return xu.add(a),function(){return xu.delete(a)}}function Qv(){if(!!xu.size){var a=0,l=[[]],h=[],s=function(S){return xR(l,S,a)},c=function(S){xR(h,S,a),a++};xu.forEach(function(S){S(s,c),a=0}),xu.clear();for(var E=h.length,m=0;m<=E;m++)l[m]&&l[m].forEach(AR),h[m]&&h[m].forEach(AR)}}var AR=function(a){return a()},CX=new WeakMap,PR,RX=function(){function a(l){var h=l.visualElement;this.isDragging=!1,this.currentDirection=null,this.constraints=!1,this.elastic=_a(),this.props={},this.hasMutatedConstraints=!1,this.cursorProgress={x:.5,y:.5},this.originPoint={},this.openGlobalLock=null,this.panSession=null,this.visualElement=h,this.visualElement.enableLayoutProjection(),CX.set(h,this)}return a.prototype.start=function(l,h){var s=this,c=h===void 0?{}:h,E=c.snapToCursor,m=E===void 0?!1:E,S=c.cursorProgress,d=function(p){var x;s.stopMotion();var P=bW(p).point;(x=s.cancelLayout)===null||x===void 0||x.call(s),s.cancelLayout=Kv(function(A,T){var _=Of(s.visualElement),g=vX(s.visualElement),O=Ur(Ur([],Wn(_)),Wn(g)),R=!1;s.isLayoutDrag()&&s.visualElement.lockProjectionTarget(),T(function(){O.forEach(function(N){return N.resetTransform()})}),A(function(){Mf(s.visualElement),g.forEach(Mf)}),T(function(){O.forEach(function(N){return N.restoreTransform()}),m&&(R=s.snapToCursor(P))}),A(function(){var N=Boolean(s.getAxisMotionValue("x")&&!s.isExternalDrag());N||s.visualElement.rebaseProjectionTarget(!0,s.visualElement.measureViewportBox(!1)),s.visualElement.scheduleUpdateLayoutProjection();var V=s.visualElement.projection;Kr(function(U){if(!R){var L=V.target[U],j=L.min,Y=L.max;s.cursorProgress[U]=S?S[U]:Tu(j,Y,P[U])}var W=s.getAxisMotionValue(U);W&&(s.originPoint[U]=W.get())})}),T(function(){rc.update(),rc.preRender(),rc.render(),rc.postRender()}),A(function(){return s.resolveDragConstraints()})})},M=function(p,x){var P,A,T,_=s.props,g=_.drag,O=_.dragPropagation;g&&!O&&(s.openGlobalLock&&s.openGlobalLock(),s.openGlobalLock=lC(g),!s.openGlobalLock)||(Qv(),s.isDragging=!0,s.currentDirection=null,(A=(P=s.props).onDragStart)===null||A===void 0||A.call(P,p,x),(T=s.visualElement.animationState)===null||T===void 0||T.setActive(Zn.Drag,!0))},C=function(p,x){var P,A,T,_,g=s.props,O=g.dragPropagation,R=g.dragDirectionLock;if(!(!O&&!s.openGlobalLock)){var N=x.offset;if(R&&s.currentDirection===null){s.currentDirection=OX(N),s.currentDirection!==null&&((A=(P=s.props).onDirectionLock)===null||A===void 0||A.call(P,s.currentDirection));return}s.updateAxis("x",x.point,N),s.updateAxis("y",x.point,N),(_=(T=s.props).onDrag)===null||_===void 0||_.call(T,p,x),PR=p}},I=function(p,x){return s.stop(p,x)},b=this.props.transformPagePoint;this.panSession=new QC(l,{onSessionStart:d,onStart:M,onMove:C,onSessionEnd:I},{transformPagePoint:b})},a.prototype.resolveDragConstraints=function(){var l=this,h=this.props,s=h.dragConstraints,c=h.dragElastic,E=this.visualElement.getLayoutState().layoutCorrected;s?this.constraints=dv(s)?this.resolveRefConstraints(E,s):uX(E,s):this.constraints=!1,this.elastic=pX(c),this.constraints&&!this.hasMutatedConstraints&&Kr(function(m){l.getAxisMotionValue(m)&&(l.constraints[m]=fX(E[m],l.constraints[m]))})},a.prototype.resolveRefConstraints=function(l,h){var s=this.props,c=s.onMeasureDragConstraints,E=s.transformPagePoint,m=h.current;this.constraintsBox=sR(m,E);var S=hX(l,this.constraintsBox);if(c){var d=c(aX(S));this.hasMutatedConstraints=!!d,d&&(S=$C(d))}return S},a.prototype.cancelDrag=function(){var l,h;this.visualElement.unlockProjectionTarget(),(l=this.cancelLayout)===null||l===void 0||l.call(this),this.isDragging=!1,this.panSession&&this.panSession.end(),this.panSession=null,!this.props.dragPropagation&&this.openGlobalLock&&(this.openGlobalLock(),this.openGlobalLock=null),(h=this.visualElement.animationState)===null||h===void 0||h.setActive(Zn.Drag,!1)},a.prototype.stop=function(l,h){var s,c,E;(s=this.panSession)===null||s===void 0||s.end(),this.panSession=null;var m=this.isDragging;if(this.cancelDrag(),!!m){var S=h.velocity;this.animateDragEnd(S),(E=(c=this.props).onDragEnd)===null||E===void 0||E.call(c,l,h)}},a.prototype.snapToCursor=function(l){var h=this;return Kr(function(s){var c=h.props.drag;if(!!Df(s,c,h.currentDirection)){var E=h.getAxisMotionValue(s);if(E){var m=h.visualElement.getLayoutState().layout,S=m[s].max-m[s].min,d=m[s].min+S/2,M=l[s]-d;h.originPoint[s]=l[s],E.set(M)}else return h.cursorProgress[s]=.5,!0}}).includes(!0)},a.prototype.updateAxis=function(l,h,s){var c=this.props.drag;if(!!Df(l,c,this.currentDirection))return this.getAxisMotionValue(l)?this.updateAxisMotionValue(l,s):this.updateVisualElementAxis(l,h)},a.prototype.updateAxisMotionValue=function(l,h){var s=this.getAxisMotionValue(l);if(!(!h||!s)){var c=this.originPoint[l]+h[l],E=this.constraints?tR(c,this.constraints[l],this.elastic[l]):c;s.set(E)}},a.prototype.updateVisualElementAxis=function(l,h){var s,c=this.visualElement.getLayoutState().layout[l],E=c.max-c.min,m=this.cursorProgress[l],S=lX(h[l],E,m,(s=this.constraints)===null||s===void 0?void 0:s[l],this.elastic[l]);this.visualElement.setProjectionTargetAxis(l,S,S+E)},a.prototype.setProps=function(l){var h=l.drag,s=h===void 0?!1:h,c=l.dragDirectionLock,E=c===void 0?!1:c,m=l.dragPropagation,S=m===void 0?!1:m,d=l.dragConstraints,M=d===void 0?!1:d,C=l.dragElastic,I=C===void 0?iR:C,b=l.dragMomentum,p=b===void 0?!0:b,x=oi(l,["drag","dragDirectionLock","dragPropagation","dragConstraints","dragElastic","dragMomentum"]);this.props=ht({drag:s,dragDirectionLock:E,dragPropagation:S,dragConstraints:M,dragElastic:I,dragMomentum:p},x)},a.prototype.getAxisMotionValue=function(l){var h=this.props,s=h.layout,c=h.layoutId,E="_drag"+l.toUpperCase();if(this.props[E])return this.props[E];if(!s&&c===void 0)return this.visualElement.getValue(l,0)},a.prototype.isLayoutDrag=function(){return!this.getAxisMotionValue("x")},a.prototype.isExternalDrag=function(){var l=this.props,h=l._dragX,s=l._dragY;return h||s},a.prototype.animateDragEnd=function(l){var h=this,s=this.props,c=s.drag,E=s.dragMomentum,m=s.dragElastic,S=s.dragTransition,d=PX(this.visualElement,this.isLayoutDrag()&&!this.isExternalDrag()),M=this.constraints||{};if(d&&Object.keys(M).length&&this.isLayoutDrag()){var C=this.visualElement.getProjectionParent();if(C){var I=_c(C.projection.targetFinal,M);Kr(function(p){var x=I[p],P=x.min,A=x.max;M[p]={min:isNaN(P)?void 0:P,max:isNaN(A)?void 0:A}})}}var b=Kr(function(p){var x;if(!!Df(p,c,h.currentDirection)){var P=(x=M==null?void 0:M[p])!==null&&x!==void 0?x:{},A=m?200:1e6,T=m?40:1e7,_=ht(ht({type:"inertia",velocity:E?l[p]:0,bounceStiffness:A,bounceDamping:T,timeConstant:750,restDelta:1,restSpeed:10},S),P);return h.getAxisMotionValue(p)?h.startAxisValueAnimation(p,_):h.visualElement.startLayoutAnimation(p,_,d)}});return Promise.all(b).then(function(){var p,x;(x=(p=h.props).onDragTransitionEnd)===null||x===void 0||x.call(p)})},a.prototype.stopMotion=function(){var l=this;Kr(function(h){var s=l.getAxisMotionValue(h);s?s.stop():l.visualElement.stopLayoutAnimation()})},a.prototype.startAxisValueAnimation=function(l,h){var s=this.getAxisMotionValue(l);if(!!s){var c=s.get();return s.set(c),s.set(c),Pf(l,s,0,h)}},a.prototype.scalePoint=function(){var l=this,h=this.props,s=h.drag,c=h.dragConstraints;if(!(!dv(c)||!this.constraintsBox)){this.stopMotion();var E={x:0,y:0};Kr(function(m){E[m]=_X(l.visualElement.projection.target[m],l.constraintsBox[m])}),this.updateConstraints(function(){Kr(function(m){if(!!Df(m,s,null)){var S=dX(l.visualElement.projection.target[m],l.constraintsBox[m],E[m]),d=S.min,M=S.max;l.visualElement.setProjectionTargetAxis(m,d,M)}})}),setTimeout(Qv,1)}},a.prototype.updateConstraints=function(l){var h=this;this.cancelLayout=Kv(function(s,c){var E=Of(h.visualElement);c(function(){return E.forEach(function(m){return m.resetTransform()})}),s(function(){return Mf(h.visualElement)}),c(function(){return E.forEach(function(m){return m.restoreTransform()})}),s(function(){h.resolveDragConstraints()}),l&&c(l)})},a.prototype.mount=function(l){var h=this,s=l.getInstance(),c=pc(s,"pointerdown",function(d){var M=h.props,C=M.drag,I=M.dragListener,b=I===void 0?!0:I;C&&b&&h.start(d)}),E=Av(window,"resize",function(){h.scalePoint()}),m=l.onLayoutUpdate(function(){h.isDragging&&h.resolveDragConstraints()}),S=l.prevDragCursor;return S&&this.start(PR,{cursorProgress:S}),function(){c==null||c(),E==null||E(),m==null||m(),h.cancelDrag()}},a}();function Df(a,l,h){return(l===!0||l===a)&&(h===null||h===a)}function OX(a,l){l===void 0&&(l=10);var h=null;return Math.abs(a.y)>l?h="y":Math.abs(a.x)>l&&(h="x"),h}function MX(a){var l=a.dragControls,h=a.visualElement,s=cn(cf).transformPagePoint,c=hu(function(){return new RX({visualElement:h})});c.setProps(ht(ht({},a),{transformPagePoint:s})),Vt(function(){return l&&l.subscribe(c)},[c]),Vt(function(){return c.mount(h)},[])}function IX(a){var l=a.onPan,h=a.onPanStart,s=a.onPanEnd,c=a.onPanSessionStart,E=a.visualElement,m=l||h||s||c,S=zt(null),d=cn(cf).transformPagePoint,M={onSessionStart:c,onStart:h,onMove:l,onEnd:function(I,b){S.current=null,s&&s(I,b)}};Vt(function(){S.current!==null&&S.current.updateHandlers(M)});function C(I){S.current=new QC(I,M,{transformPagePoint:d})}mf(E,"pointerdown",m&&C),Rv(function(){return S.current&&S.current.end()})}var DX={pan:Qa(IX),drag:Qa(MX)},Au;(function(a){a[a.Entering=0]="Entering",a[a.Present=1]="Present",a[a.Exiting=2]="Exiting"})(Au||(Au={}));var qv;(function(a){a[a.Hide=0]="Hide",a[a.Show=1]="Show"})(qv||(qv={}));function Zv(a){return typeof a=="string"&&a.startsWith("var(--")}var CR=/var\((--[a-zA-Z0-9-_]+),? ?([a-zA-Z0-9 ()%#.,-]+)?\)/;function wX(a){var l=CR.exec(a);if(!l)return[,];var h=Wn(l,3),s=h[1],c=h[2];return[s,c]}function $v(a,l,h){var s=Wn(wX(a),2),c=s[0],E=s[1];if(!!c){var m=window.getComputedStyle(l).getPropertyValue(c);return m?m.trim():Zv(E)?$v(E,l):E}}function LX(a,l,h){var s,c=oi(l,[]),E=a.getInstance();if(!(E instanceof HTMLElement))return{target:c,transitionEnd:h};h&&(h=ht({},h)),a.forEachValue(function(M){var C=M.get();if(!!Zv(C)){var I=$v(C,E);I&&M.set(I)}});for(var m in c){var S=c[m];if(!!Zv(S)){var d=$v(S,E);!d||(c[m]=d,h&&((s=h[m])!==null&&s!==void 0||(h[m]=S)))}}return{target:c,transitionEnd:h}}function RR(a,l){return a/(l.max-l.min)*100}function NX(a,l,h){var s=h.target;if(typeof a=="string")if(kt.test(a))a=parseFloat(a);else return a;var c=RR(a,s.x),E=RR(a,s.y);return c+"% "+E+"%"}var OR="_$css";function FX(a,l){var h=l.delta,s=l.treeScale,c=a,E=a.includes("var("),m=[];E&&(a=a.replace(CR,function(P){return m.push(P),OR}));var S=xo.parse(a);if(S.length>5)return c;var d=xo.createTransformer(a),M=typeof S[0]!="number"?1:0,C=h.x.scale*s.x,I=h.y.scale*s.y;S[0+M]/=C,S[1+M]/=I;var b=Yr(C,I,.5);typeof S[2+M]=="number"&&(S[2+M]/=b),typeof S[3+M]=="number"&&(S[3+M]/=b);var p=d(S);if(E){var x=0;p=p.replace(OR,function(){var P=m[x];return x++,P})}return p}var Pu={process:NX},BX={borderRadius:ht(ht({},Pu),{applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]}),borderTopLeftRadius:Pu,borderTopRightRadius:Pu,borderBottomLeftRadius:Pu,borderBottomRightRadius:Pu,boxShadow:{process:FX}},MR=1e3,UX=function(a){xP(l,a);function l(){var h=a!==null&&a.apply(this,arguments)||this;return h.frameTarget=_a(),h.currentAnimationTarget=_a(),h.isAnimating={x:!1,y:!1},h.stopAxisAnimation={x:void 0,y:void 0},h.isAnimatingTree=!1,h.animate=function(s,c,E){E===void 0&&(E={});var m=E.originBox,S=E.targetBox,d=E.visibilityAction,M=E.shouldStackAnimate,C=E.onComplete,I=E.prevParent,b=oi(E,["originBox","targetBox","visibilityAction","shouldStackAnimate","onComplete","prevParent"]),p=h.props,x=p.visualElement,P=p.layout;if(M===!1)return h.isAnimatingTree=!1,h.safeToRemove();if(!(h.isAnimatingTree&&M!==!0)){M&&(h.isAnimatingTree=!0),c=m||c,s=S||s;var A=!1,T=x.getProjectionParent();if(T){var _=T.prevViewportBox,g=T.getLayoutState().layout;I&&(S&&(g=I.getLayoutState().layout),m&&!TX(I,T)&&I.prevViewportBox&&(_=I.prevViewportBox)),_&&zX(I,m,S)&&(A=!0,c=_c(_,c),s=_c(g,s))}var O=kX(c,s),R=Kr(function(N){var V,U;if(P==="position"){var L=s[N].max-s[N].min;c[N].max=c[N].min+L}if(!x.projection.isTargetLocked)if(d!==void 0)x.setVisibility(d===qv.Show);else return O?h.animateAxis(N,s[N],c[N],ht(ht({},b),{isRelative:A})):((U=(V=h.stopAxisAnimation)[N])===null||U===void 0||U.call(V),x.setProjectionTargetAxis(N,s[N].min,s[N].max,A))});return x.syncRender(),Promise.all(R).then(function(){h.isAnimatingTree=!1,C&&C(),x.notifyLayoutAnimationComplete()})}},h}return l.prototype.componentDidMount=function(){var h=this,s=this.props.visualElement;s.animateMotionValue=Pf,s.enableLayoutProjection(),this.unsubLayoutReady=s.onLayoutUpdate(this.animate),s.layoutSafeToRemove=function(){return h.safeToRemove()},AH(BX)},l.prototype.componentWillUnmount=function(){var h=this;this.unsubLayoutReady(),Kr(function(s){var c,E;return(E=(c=h.stopAxisAnimation)[s])===null||E===void 0?void 0:E.call(c)})},l.prototype.animateAxis=function(h,s,c,E){var m=this,S,d,M=E===void 0?{}:E,C=M.transition,I=M.isRelative;if(!(this.isAnimating[h]&&Cu(s,this.currentAnimationTarget[h]))){(d=(S=this.stopAxisAnimation)[h])===null||d===void 0||d.call(S),this.isAnimating[h]=!0;var b=this.props.visualElement,p=this.frameTarget[h],x=b.getProjectionAnimationProgress()[h];x.clearListeners(),x.set(0),x.set(0);var P=function(){var g=x.get()/MR;yX(p,c,s,g),b.setProjectionTargetAxis(h,p.min,p.max,I)};P();var A=x.onChange(P);this.stopAxisAnimation[h]=function(){m.isAnimating[h]=!1,x.stop(),A()},this.currentAnimationTarget[h]=s;var T=C||b.getDefaultTransition()||jX,_=Pf(h==="x"?"layoutX":"layoutY",x,MR,T&&kv(T,"layout")).then(this.stopAxisAnimation[h]);return _}},l.prototype.safeToRemove=function(){var h,s;(s=(h=this.props).safeToRemove)===null||s===void 0||s.call(h)},l.prototype.render=function(){return null},l}(mi);function VX(a){var l=Wn(hv(),2),h=l[1];return $e(UX,ht({},a,{safeToRemove:h}))}function kX(a,l){return!DR(a)&&!DR(l)&&(!Cu(a.x,l.x)||!Cu(a.y,l.y))}var IR={min:0,max:0};function DR(a){return Cu(a.x,IR)&&Cu(a.y,IR)}function Cu(a,l){return a.min===l.min&&a.max===l.max}var jX={duration:.45,ease:[.4,0,.1,1]};function zX(a,l,h){return a||!a&&!(l||h)}var GX={layoutReady:function(a){return a.notifyLayoutReady()}};function wR(){var a=new Set;return{add:function(l){return a.add(l)},flush:function(l){var h=l===void 0?GX:l,s=h.layoutReady,c=h.parent;Kv(function(E,m){var S=Array.from(a).sort(Wv),d=c?Of(c):[];m(function(){var M=Ur(Ur([],Wn(d)),Wn(S));M.forEach(function(C){return C.resetTransform()})}),E(function(){S.forEach(Mf)}),m(function(){d.forEach(function(M){return M.restoreTransform()}),S.forEach(s)}),E(function(){S.forEach(function(M){M.isPresent&&(M.presence=Au.Present)})}),m(function(){rc.preRender(),rc.render()}),E(function(){Ji.postRender(function(){return S.forEach(HX)}),a.clear()})}),Qv()}}}function HX(a){a.prevViewportBox=a.projection.target}var LR=Sr(wR()),WX=Sr(wR());function $a(a){return!!a.forceUpdate}var XX=function(a){xP(l,a);function l(){return a!==null&&a.apply(this,arguments)||this}return l.prototype.componentDidMount=function(){var h=this.props,s=h.syncLayout,c=h.framerSyncLayout,E=h.visualElement;$a(s)&&s.register(E),$a(c)&&c.register(E),E.onUnmount(function(){$a(s)&&s.remove(E),$a(c)&&c.remove(E)})},l.prototype.getSnapshotBeforeUpdate=function(){var h=this.props,s=h.syncLayout,c=h.visualElement;return $a(s)?s.syncUpdate():(bX(c),s.add(c)),null},l.prototype.componentDidUpdate=function(){var h=this.props.syncLayout;$a(h)||h.flush()},l.prototype.render=function(){return null},l}(ei.Component);function YX(a){var l=cn(LR),h=cn(WX);return ei.createElement(XX,ht({},a,{syncLayout:l,framerSyncLayout:h}))}var KX={measureLayout:YX,layoutAnimation:VX},QX=function(){return{isEnabled:!1,isHydrated:!1,isTargetLocked:!1,target:_a(),targetFinal:_a()}};function NR(){return{isHydrated:!1,layout:_a(),layoutCorrected:_a(),treeScale:{x:1,y:1},delta:eR(),deltaFinal:eR(),deltaTransform:""}}var FR=NR();function wf(a,l,h){var s=a.x,c=a.y,E=s.translate/l.x,m=c.translate/l.y,S="translate3d("+E+"px, "+m+"px, 0) ";if(h){var d=h.rotate,M=h.rotateX,C=h.rotateY;d&&(S+="rotate("+d+") "),M&&(S+="rotateX("+M+") "),C&&(S+="rotateY("+C+") ")}return S+="scale("+s.scale+", "+c.scale+")",!h&&S===qX?"":S}function BR(a){var l=a.deltaFinal;return l.x.origin*100+"% "+l.y.origin*100+"% 0"}var qX=wf(FR.delta,FR.treeScale,{x:1,y:1}),Lf=["LayoutMeasure","BeforeLayoutMeasure","LayoutUpdate","ViewportBoxUpdate","Update","Render","AnimationComplete","LayoutAnimationComplete","AnimationStart","SetAxisTarget","Unmount"];function ZX(){var a=Lf.map(function(){return new Cf}),l={},h={clearAllListeners:function(){return a.forEach(function(s){return s.clear()})},updatePropListeners:function(s){return Lf.forEach(function(c){var E;(E=l[c])===null||E===void 0||E.call(l);var m="on"+c,S=s[m];S&&(l[c]=h[m](S))})}};return a.forEach(function(s,c){h["on"+Lf[c]]=function(E){return s.add(E)},h["notify"+Lf[c]]=function(){for(var E=[],m=0;m<arguments.length;m++)E[m]=arguments[m];return s.notify.apply(s,Ur([],Wn(E)))}}),h}function $X(a,l,h){var s;for(var c in l){var E=l[c],m=h[c];if(pa(E))a.addValue(c,E);else if(pa(m))a.addValue(c,Za(E));else if(m!==E)if(a.hasValue(c)){var S=a.getValue(c);!S.hasAnimated&&S.set(E)}else a.addValue(c,Za((s=a.getStaticValue(c))!==null&&s!==void 0?s:E))}for(var c in h)l[c]===void 0&&a.removeValue(c);return l}function JX(a,l,h,s){var c=a.delta,E=a.layout,m=a.layoutCorrected,S=a.treeScale,d=l.target;EX(m,E),AX(m,S,h),uR(c,m,d,s)}var e6=function(){function a(){this.children=[],this.isDirty=!1}return a.prototype.add=function(l){HC(this.children,l),this.isDirty=!0},a.prototype.remove=function(l){WC(this.children,l),this.isDirty=!0},a.prototype.forEach=function(l){this.isDirty&&this.children.sort(Wv),this.isDirty=!1,this.children.forEach(l)},a}();function t6(a){var l=a.getProjectionParent();if(!l){a.rebaseProjectionTarget();return}var h=_c(l.getLayoutState().layout,a.getLayoutState().layout);Kr(function(s){a.setProjectionTargetAxis(s,h[s].min,h[s].max,!0)})}var UR=function(a){var l=a.treeType,h=l===void 0?"":l,s=a.build,c=a.getBaseTarget,E=a.makeTargetAnimatable,m=a.measureViewportBox,S=a.render,d=a.readValueFromInstance,M=a.resetTransform,C=a.restoreTransform,I=a.removeValueFromRenderState,b=a.sortNodePosition,p=a.scrapeMotionValuesFromProps;return function(x,P){var A=x.parent,T=x.props,_=x.presenceId,g=x.blockInitialAnimation,O=x.visualState;P===void 0&&(P={});var R=O.latestValues,N=O.renderState,V,U=ZX(),L=QX(),j,Y=L,W=R,re,ne=NR(),ge,_e=!1,ce=new Map,ie=new Map,Z={},te,B=ht({},R),G;function $(){!V||(ve.isProjectionReady()&&(Yv(Y.targetFinal,Y.target,W),uR(ne.deltaFinal,ne.layoutCorrected,Y.targetFinal,R)),le(),S(V,N))}function le(){var he=R;if(ge&&ge.isActive()){var be=ge.getCrossfadeState(ve);be&&(he=be)}s(ve,N,he,Y,ne,P,T)}function se(){U.notifyUpdate(R)}function q(){if(!!ve.isProjectionReady()){var he=ne.delta,be=ne.treeScale,xe=be.x,Se=be.y,Ue=ne.deltaTransform;JX(ne,Y,ve.path,R),_e&&ve.notifyViewportBoxUpdate(Y.target,he),_e=!1;var We=wf(he,be);(We!==Ue||xe!==be.x||Se!==be.y)&&ve.scheduleRender(),ne.deltaTransform=We}}function H(){ve.layoutTree.forEach(r6)}function X(he,be){var xe=be.onChange(function(Ue){R[he]=Ue,T.onUpdate&&Ji.update(se,!1,!0)}),Se=be.onRenderRequest(ve.scheduleRender);ie.set(he,function(){xe(),Se()})}var J=p(T);for(var Q in J){var ee=J[Q];R[Q]!==void 0&&pa(ee)&&ee.set(R[Q],!1)}var pe=hf(T),Te=MP(T),ve=ht(ht({treeType:h,current:null,depth:A?A.depth+1:0,parent:A,children:new Set,path:A?Ur(Ur([],Wn(A.path)),[A]):[],layoutTree:A?A.layoutTree:new e6,presenceId:_,projection:L,variantChildren:Te?new Set:void 0,isVisible:void 0,manuallyAnimateOnMount:Boolean(A==null?void 0:A.isMounted()),blockInitialAnimation:g,isMounted:function(){return Boolean(V)},mount:function(he){V=ve.current=he,ve.pointTo(ve),Te&&A&&!pe&&(G=A==null?void 0:A.addVariantChild(ve)),A==null||A.children.add(ve)},unmount:function(){Kl.update(se),Kl.render($),Kl.preRender(ve.updateLayoutProjection),ie.forEach(function(he){return he()}),ve.stopLayoutAnimation(),ve.layoutTree.remove(ve),G==null||G(),A==null||A.children.delete(ve),re==null||re(),U.clearAllListeners()},addVariantChild:function(he){var be,xe=ve.getClosestVariantNode();if(xe)return(be=xe.variantChildren)===null||be===void 0||be.add(he),function(){return xe.variantChildren.delete(he)}},sortNodePosition:function(he){return!b||h!==he.treeType?0:b(ve.getInstance(),he.getInstance())},getClosestVariantNode:function(){return Te?ve:A==null?void 0:A.getClosestVariantNode()},scheduleUpdateLayoutProjection:A?A.scheduleUpdateLayoutProjection:function(){return Ji.preRender(ve.updateTreeLayoutProjection,!1,!0)},getLayoutId:function(){return T.layoutId},getInstance:function(){return V},getStaticValue:function(he){return R[he]},setStaticValue:function(he,be){return R[he]=be},getLatestValues:function(){return R},setVisibility:function(he){ve.isVisible!==he&&(ve.isVisible=he,ve.scheduleRender())},makeTargetAnimatable:function(he,be){return be===void 0&&(be=!0),E(ve,he,T,be)},addValue:function(he,be){ve.hasValue(he)&&ve.removeValue(he),ce.set(he,be),R[he]=be.get(),X(he,be)},removeValue:function(he){var be;ce.delete(he),(be=ie.get(he))===null||be===void 0||be(),ie.delete(he),delete R[he],I(he,N)},hasValue:function(he){return ce.has(he)},getValue:function(he,be){var xe=ce.get(he);return xe===void 0&&be!==void 0&&(xe=Za(be),ve.addValue(he,xe)),xe},forEachValue:function(he){return ce.forEach(he)},readValue:function(he){var be;return(be=R[he])!==null&&be!==void 0?be:d(V,he,P)},setBaseTarget:function(he,be){B[he]=be},getBaseTarget:function(he){if(c){var be=c(T,he);if(be!==void 0&&!pa(be))return be}return B[he]}},U),{build:function(){return le(),N},scheduleRender:function(){Ji.render($,!1,!0)},syncRender:$,setProps:function(he){T=he,U.updatePropListeners(he),Z=$X(ve,p(T),Z)},getProps:function(){return T},getVariant:function(he){var be;return(be=T.variants)===null||be===void 0?void 0:be[he]},getDefaultTransition:function(){return T.transition},getVariantContext:function(he){if(he===void 0&&(he=!1),he)return A==null?void 0:A.getVariantContext();if(!pe){var be=(A==null?void 0:A.getVariantContext())||{};return T.initial!==void 0&&(be.initial=T.initial),be}for(var xe={},Se=0;Se<i6;Se++){var Ue=VR[Se],We=T[Ue];(Fi(We)||We===!1)&&(xe[Ue]=We)}return xe},enableLayoutProjection:function(){L.isEnabled=!0,ve.layoutTree.add(ve)},lockProjectionTarget:function(){L.isTargetLocked=!0},unlockProjectionTarget:function(){ve.stopLayoutAnimation(),L.isTargetLocked=!1},getLayoutState:function(){return ne},setCrossfader:function(he){ge=he},isProjectionReady:function(){return L.isEnabled&&L.isHydrated&&ne.isHydrated},startLayoutAnimation:function(he,be,xe){xe===void 0&&(xe=!1);var Se=ve.getProjectionAnimationProgress()[he],Ue=xe?L.relativeTarget[he]:L.target[he],We=Ue.min,Ze=Ue.max,Qe=Ze-We;return Se.clearListeners(),Se.set(We),Se.set(We),Se.onChange(function(Xe){ve.setProjectionTargetAxis(he,Xe,Xe+Qe,xe)}),ve.animateMotionValue(he,Se,0,be)},stopLayoutAnimation:function(){Kr(function(he){return ve.getProjectionAnimationProgress()[he].stop()})},measureViewportBox:function(he){he===void 0&&(he=!0);var be=m(V,P);return he||SR(be,R),be},getProjectionAnimationProgress:function(){return te||(te={x:Za(0),y:Za(0)}),te},setProjectionTargetAxis:function(he,be,xe,Se){Se===void 0&&(Se=!1);var Ue;Se?(L.relativeTarget||(L.relativeTarget=_a()),Ue=L.relativeTarget[he]):(L.relativeTarget=void 0,Ue=L.target[he]),L.isHydrated=!0,Ue.min=be,Ue.max=xe,_e=!0,U.notifySetAxisTarget()},rebaseProjectionTarget:function(he,be){be===void 0&&(be=ne.layout);var xe=ve.getProjectionAnimationProgress(),Se=xe.x,Ue=xe.y,We=!L.relativeTarget&&!L.isTargetLocked&&!Se.isAnimating()&&!Ue.isAnimating();(he||We)&&Kr(function(Ze){var Qe=be[Ze],Xe=Qe.min,nt=Qe.max;ve.setProjectionTargetAxis(Ze,Xe,nt)})},notifyLayoutReady:function(he){t6(ve),ve.notifyLayoutUpdate(ne.layout,ve.prevViewportBox||ne.layout,he)},resetTransform:function(){return M(ve,V,T)},restoreTransform:function(){return C(V,N)},updateLayoutProjection:q,updateTreeLayoutProjection:function(){ve.layoutTree.forEach(n6),Ji.preRender(H,!1,!0)},getProjectionParent:function(){if(j===void 0){for(var he=!1,be=ve.path.length-1;be>=0;be--){var xe=ve.path[be];if(xe.projection.isEnabled){he=xe;break}}j=he}return j},resolveRelativeTargetBox:function(){var he=ve.getProjectionParent();if(!(!L.relativeTarget||!he)&&(gX(L,he.projection),mR(he))){var be=L.target;Yv(be,be,he.getLatestValues())}},shouldResetTransform:function(){return Boolean(T._layoutResetTransform)},pointTo:function(he){Y=he.projection,W=he.getLatestValues(),re==null||re(),re=Eu(he.onSetAxisTarget(ve.scheduleUpdateLayoutProjection),he.onLayoutAnimationComplete(function(){var be;ve.isPresent?ve.presence=Au.Present:(be=ve.layoutSafeToRemove)===null||be===void 0||be.call(ve)}))},isPresent:!0,presence:Au.Entering});return ve}};function n6(a){a.resolveRelativeTargetBox()}function r6(a){a.updateLayoutProjection()}var VR=Ur(["initial"],Wn(zv)),i6=VR.length,o6=new Set(["width","height","top","left","right","bottom","x","y"]),kR=function(a){return o6.has(a)},a6=function(a){return Object.keys(a).some(kR)},jR=function(a,l){a.set(l,!1),a.set(l)},zR=function(a){return a===Ka||a===kt},GR;(function(a){a.width="width",a.height="height",a.left="left",a.right="right",a.top="top",a.bottom="bottom"})(GR||(GR={}));var HR=function(a,l){return parseFloat(a.split(", ")[l])},WR=function(a,l){return function(h,s){var c=s.transform;if(c==="none"||!c)return 0;var E=c.match(/^matrix3d\((.+)\)$/);if(E)return HR(E[1],l);var m=c.match(/^matrix\((.+)\)$/);return m?HR(m[1],a):0}},s6=new Set(["x","y","z"]),c6=pu.filter(function(a){return!s6.has(a)});function l6(a){var l=[];return c6.forEach(function(h){var s=a.getValue(h);s!==void 0&&(l.push([h,s.get()]),s.set(h.startsWith("scale")?1:0))}),l.length&&a.syncRender(),l}var XR={width:function(a){var l=a.x;return l.max-l.min},height:function(a){var l=a.y;return l.max-l.min},top:function(a,l){var h=l.top;return parseFloat(h)},left:function(a,l){var h=l.left;return parseFloat(h)},bottom:function(a,l){var h=a.y,s=l.top;return parseFloat(s)+(h.max-h.min)},right:function(a,l){var h=a.x,s=l.left;return parseFloat(s)+(h.max-h.min)},x:WR(4,13),y:WR(5,14)},u6=function(a,l,h){var s=l.measureViewportBox(),c=l.getInstance(),E=getComputedStyle(c),m=E.display,S=E.top,d=E.left,M=E.bottom,C=E.right,I=E.transform,b={top:S,left:d,bottom:M,right:C,transform:I};m==="none"&&l.setStaticValue("display",a.display||"block"),l.syncRender();var p=l.measureViewportBox();return h.forEach(function(x){var P=l.getValue(x);jR(P,XR[x](s,b)),a[x]=XR[x](p,E)}),a},h6=function(a,l,h,s){h===void 0&&(h={}),s===void 0&&(s={}),l=ht({},l),s=ht({},s);var c=Object.keys(l).filter(kR),E=[],m=!1,S=[];if(c.forEach(function(M){var C=a.getValue(M);if(!!a.hasValue(M)){var I=h[M],b=l[M],p=Rf(I),x;if(yu(b))for(var P=b.length,A=b[0]===null?1:0;A<P;A++)x?lu(Rf(b[A])===x):x=Rf(b[A]);else x=Rf(b);if(p!==x)if(zR(p)&&zR(x)){var T=C.get();typeof T=="string"&&C.set(parseFloat(T)),typeof b=="string"?l[M]=parseFloat(b):Array.isArray(b)&&x===kt&&(l[M]=b.map(parseFloat))}else(p==null?void 0:p.transform)&&(x==null?void 0:x.transform)&&(I===0||b===0)?I===0?C.set(x.transform(I)):l[M]=p.transform(b):(m||(E=l6(a),m=!0),S.push(M),s[M]=s[M]!==void 0?s[M]:l[M],jR(C,b))}}),S.length){var d=u6(l,a,S);return E.length&&E.forEach(function(M){var C=Wn(M,2),I=C[0],b=C[1];a.getValue(I).set(b)}),a.syncRender(),{target:d,transitionEnd:s}}else return{target:l,transitionEnd:s}};function d6(a,l,h,s){return a6(l)?h6(a,l,h,s):{target:l,transitionEnd:s}}var f6=function(a,l,h,s){var c=LX(a,l,s);return l=c.target,s=c.transitionEnd,d6(a,l,h,s)};function p6(a){return window.getComputedStyle(a)}var YR={treeType:"dom",readValueFromInstance:function(a,l){if(df(l)){var h=Uv(l);return h&&h.default||0}else{var s=p6(a);return(LP(l)?s.getPropertyValue(l):s[l])||0}},sortNodePosition:function(a,l){return a.compareDocumentPosition(l)&2?1:-1},getBaseTarget:function(a,l){var h;return(h=a.style)===null||h===void 0?void 0:h[l]},measureViewportBox:function(a,l){var h=l.transformPagePoint;return sR(a,h)},resetTransform:function(a,l,h){var s=h.transformTemplate;l.style.transform=s?s({},""):"none",a.scheduleRender()},restoreTransform:function(a,l){a.style.transform=l.style.transform},removeValueFromRenderState:function(a,l){var h=l.vars,s=l.style;delete h[a],delete s[a]},makeTargetAnimatable:function(a,l,h,s){var c=h.transformValues;s===void 0&&(s=!0);var E=l.transition,m=l.transitionEnd,S=oi(l,["transition","transitionEnd"]),d=W5(S,E||{},a);if(c&&(m&&(m=c(m)),S&&(S=c(S)),d&&(d=c(d))),s){G5(a,S,d);var M=f6(a,S,d,m);m=M.transitionEnd,S=M.target}return ht({transition:E,transitionEnd:m},S)},scrapeMotionValuesFromProps:Sv,build:function(a,l,h,s,c,E,m){a.isVisible!==void 0&&(l.style.visibility=a.isVisible?"visible":"hidden");var S=s.isEnabled&&c.isHydrated;bv(l,h,s,c,E,m.transformTemplate,S?wf:void 0,S?BR:void 0)},render:qP},m6=UR(YR),_6=UR(ht(ht({},YR),{getBaseTarget:function(a,l){return a[l]},readValueFromInstance:function(a,l){var h;return df(l)?((h=Uv(l))===null||h===void 0?void 0:h.default)||0:(l=ZP.has(l)?l:QP(l),a.getAttribute(l))},scrapeMotionValuesFromProps:JP,build:function(a,l,h,s,c,E,m){var S=s.isEnabled&&c.isHydrated;Ev(l,h,s,c,E,m.transformTemplate,S?wf:void 0,S?BR:void 0)},render:$P})),g6=function(a,l){return fv(a)?_6(l,{enableHardwareAcceleration:!1}):m6(l,{enableHardwareAcceleration:!0})},v6=ht(ht(ht(ht({},nX),S5),DX),KX),KR=SH(function(a,l){return fW(a,l,v6,g6)});function b6(){var a=zt(!1),l=Wn(un(0),2),h=l[0],s=l[1];return Rv(function(){return a.current=!0}),Gt(function(){!a.current&&s(h+1)},[h])}var QR=0;function y6(){var a=QR;return QR++,a}var Jv=function(a){var l=a.children,h=a.initial,s=a.isPresent,c=a.onExitComplete,E=a.custom,m=a.presenceAffectsLayout,S=hu(T6),d=hu(y6),M=Vn(function(){return{id:d,initial:h,isPresent:s,custom:E,onExitComplete:function(C){S.set(C,!0);var I=!0;S.forEach(function(b){b||(I=!1)}),I&&(c==null||c())},register:function(C){return S.set(C,!1),function(){return S.delete(C)}}}},m?void 0:[s]);return Vn(function(){S.forEach(function(C,I){return S.set(I,!1)})},[s]),Vt(function(){!s&&!S.size&&(c==null||c())},[s]),$e(uu.Provider,{value:M},l)};function T6(){return new Map}function gc(a){return a.key||""}function E6(a,l){a.forEach(function(h){var s=gc(h);l.set(s,h)})}function S6(a){var l=[];return Nl.forEach(a,function(h){ra(h)&&l.push(h)}),l}var qR=function(a){var l=a.children,h=a.custom,s=a.initial,c=s===void 0?!0:s,E=a.onExitComplete,m=a.exitBeforeEnter,S=a.presenceAffectsLayout,d=S===void 0?!0:S,M=b6(),C=cn(LR);$a(C)&&(M=C.forceUpdate);var I=zt(!0),b=S6(l),p=zt(b),x=zt(new Map).current,P=zt(new Set).current;if(E6(b,x),I.current)return I.current=!1,$e(pr,null,b.map(function(N){return $e(Jv,{key:gc(N),isPresent:!0,initial:c?void 0:!1,presenceAffectsLayout:d},N)}));for(var A=Ur([],Wn(b)),T=p.current.map(gc),_=b.map(gc),g=T.length,O=0;O<g;O++){var R=T[O];_.indexOf(R)===-1?P.add(R):P.delete(R)}return m&&P.size&&(A=[]),P.forEach(function(N){if(_.indexOf(N)===-1){var V=x.get(N);if(!!V){var U=T.indexOf(N),L=function(){x.delete(N),P.delete(N);var j=p.current.findIndex(function(Y){return Y.key===N});p.current.splice(j,1),P.size||(p.current=b,M(),E&&E())};A.splice(U,0,$e(Jv,{key:gc(V),isPresent:!1,onExitComplete:L,custom:h,presenceAffectsLayout:d},V))}}}),A=A.map(function(N){var V=N.key;return P.has(V)?N:$e(Jv,{key:gc(N),isPresent:!0,presenceAffectsLayout:d},N)}),p.current=A,$e(pr,null,P.size?A:A.map(function(N){return ia(N)}))};function Nf(){return Nf=Object.assign||function(a){for(var l=1;l<arguments.length;l++){var h=arguments[l];for(var s in h)Object.prototype.hasOwnProperty.call(h,s)&&(a[s]=h[s])}return a},Nf.apply(this,arguments)}var eb={ease:[.25,.1,.25,1],easeIn:[.4,0,1,1],easeOut:[0,0,.2,1],easeInOut:[.4,0,.2,1]},Ru={scale:{enter:{scale:1},exit:{scale:.95}},fade:{enter:{opacity:1},exit:{opacity:0}},pushLeft:{enter:{x:"100%"},exit:{x:"-30%"}},pushRight:{enter:{x:"-100%"},exit:{x:"30%"}},pushUp:{enter:{y:"100%"},exit:{y:"-30%"}},pushDown:{enter:{y:"-100%"},exit:{y:"30%"}},slideLeft:{position:{left:0,top:0,bottom:0,width:"100%"},enter:{x:0},exit:{x:"-100%"}},slideRight:{position:{right:0,top:0,bottom:0,width:"100%"},enter:{x:0},exit:{x:"100%"}},slideUp:{position:{top:0,left:0,right:0,maxWidth:"100vw"},enter:{y:0},exit:{y:"-100%"}},slideDown:{position:{bottom:0,left:0,right:0,maxWidth:"100vw"},enter:{y:0},exit:{y:"100%"}}};function tb(a){var l,h=(l=a==null?void 0:a.direction)!=null?l:"right";switch(h){case"right":return Ru.slideRight;case"left":return Ru.slideLeft;case"bottom":return Ru.slideDown;case"top":return Ru.slideUp;default:return Ru.slideRight}}var ZR={enter:{duration:.2,ease:eb.easeOut},exit:{duration:.1,ease:eb.easeIn}},Ff={enter:(a,l)=>Nf({},a,{delay:za(l)?l:l==null?void 0:l.enter}),exit:(a,l)=>Nf({},a,{delay:za(l)?l:l==null?void 0:l.exit})},x6={enter:function(l){var h,{transition:s,transitionEnd:c,delay:E}=l===void 0?{}:l;return{opacity:1,transition:(h=s==null?void 0:s.enter)!=null?h:Ff.enter(ZR.enter,E),transitionEnd:c==null?void 0:c.enter}},exit:function(l){var h,{transition:s,transitionEnd:c,delay:E}=l===void 0?{}:l;return{opacity:0,transition:(h=s==null?void 0:s.exit)!=null?h:Ff.exit(ZR.exit,E),transitionEnd:c==null?void 0:c.exit}}},A6={initial:"exit",animate:"enter",exit:"exit",variants:x6};function P6(a,l){if(a==null)return{};var h={},s=Object.keys(a),c,E;for(E=0;E<s.length;E++)c=s[E],!(l.indexOf(c)>=0)&&(h[c]=a[c]);return h}function Ou(){return Ou=Object.assign||function(a){for(var l=1;l<arguments.length;l++){var h=arguments[l];for(var s in h)Object.prototype.hasOwnProperty.call(h,s)&&(a[s]=h[s])}return a},Ou.apply(this,arguments)}var $R={exit:{duration:.15,ease:eb.easeInOut},enter:{type:"spring",damping:25,stiffness:180}},C6={exit:a=>{var l,{direction:h,transition:s,transitionEnd:c,delay:E}=a,{exit:m}=tb({direction:h});return Ou({},m,{transition:(l=s==null?void 0:s.exit)!=null?l:Ff.exit($R.exit,E),transitionEnd:c==null?void 0:c.exit})},enter:a=>{var l,{direction:h,transitionEnd:s,transition:c,delay:E}=a,{enter:m}=tb({direction:h});return Ou({},m,{transition:(l=c==null?void 0:c.enter)!=null?l:Ff.enter($R.enter,E),transitionEnd:s==null?void 0:s.enter})}},R6=Oi((a,l)=>{var{direction:h="right",style:s,unmountOnExit:c,in:E,className:m,transition:S,transitionEnd:d,delay:M}=a,C=P6(a,["direction","style","unmountOnExit","in","className","transition","transitionEnd","delay"]),I=tb({direction:h}),b=Object.assign({position:"fixed"},I.position,s),p=c?E&&c:!0,x=E||c?"enter":"exit",P={transitionEnd:d,transition:S,direction:h,delay:M};return $e(qR,{custom:P},p&&$e(KR.div,Ou({ref:l,initial:"exit",className:ir("chakra-slide",m),animate:x,exit:"exit",custom:P,variants:C6,style:b},C)))});function Mu(){return Mu=Object.assign||function(a){for(var l=1;l<arguments.length;l++){var h=arguments[l];for(var s in h)Object.prototype.hasOwnProperty.call(h,s)&&(a[s]=h[s])}return a},Mu.apply(this,arguments)}var O6=a=>$e(su,Mu({viewBox:"0 0 24 24"},a),$e("path",{fill:"currentColor",d:"M12,0A12,12,0,1,0,24,12,12.014,12.014,0,0,0,12,0Zm6.927,8.2-6.845,9.289a1.011,1.011,0,0,1-1.43.188L5.764,13.769a1,1,0,1,1,1.25-1.562l4.076,3.261,6.227-8.451A1,1,0,1,1,18.927,8.2Z"})),M6=a=>$e(su,Mu({viewBox:"0 0 24 24"},a),$e("path",{fill:"currentColor",d:"M12,0A12,12,0,1,0,24,12,12.013,12.013,0,0,0,12,0Zm.25,5a1.5,1.5,0,1,1-1.5,1.5A1.5,1.5,0,0,1,12.25,5ZM14.5,18.5h-4a1,1,0,0,1,0-2h.75a.25.25,0,0,0,.25-.25v-4.5a.25.25,0,0,0-.25-.25H10.5a1,1,0,0,1,0-2h1a2,2,0,0,1,2,2v4.75a.25.25,0,0,0,.25.25h.75a1,1,0,1,1,0,2Z"})),JR=a=>$e(su,Mu({viewBox:"0 0 24 24"},a),$e("path",{fill:"currentColor",d:"M11.983,0a12.206,12.206,0,0,0-8.51,3.653A11.8,11.8,0,0,0,0,12.207,11.779,11.779,0,0,0,11.8,24h.214A12.111,12.111,0,0,0,24,11.791h0A11.766,11.766,0,0,0,11.983,0ZM10.5,16.542a1.476,1.476,0,0,1,1.449-1.53h.027a1.527,1.527,0,0,1,1.523,1.47,1.475,1.475,0,0,1-1.449,1.53h-.027A1.529,1.529,0,0,1,10.5,16.542ZM11,12.5v-6a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Z"}));function Ao(){return Ao=Object.assign||function(a){for(var l=1;l<arguments.length;l++){var h=arguments[l];for(var s in h)Object.prototype.hasOwnProperty.call(h,s)&&(a[s]=h[s])}return a},Ao.apply(this,arguments)}function I6(a,l){if(a==null)return{};var h={},s=Object.keys(a),c,E;for(E=0;E<s.length;E++)c=s[E],!(l.indexOf(c)>=0)&&(h[c]=a[c]);return h}var eO={info:{icon:M6,colorScheme:"blue"},warning:{icon:JR,colorScheme:"orange"},success:{icon:O6,colorScheme:"green"},error:{icon:JR,colorScheme:"red"}},[D6,w6]=ca({name:"AlertContext",errorMessage:"useAlertContext: `context` is undefined. Seems you forgot to wrap alert components in `<Alert />`"}),aq=Dn((a,l)=>{var h,s=ua(a),{status:c="info"}=s,E=I6(s,["status"]),m=(h=a.colorScheme)!=null?h:eO[c].colorScheme,S=Jl("Alert",Ao({},a,{colorScheme:m})),d=Ao({width:"100%",display:"flex",alignItems:"center",position:"relative",overflow:"hidden"},S.container);return $e(D6,{value:{status:c}},$e(zA,{value:S},$e(nn.div,Ao({role:"alert",ref:l},E,{className:ir("chakra-alert",a.className),__css:d}))))}),sq=Dn((a,l)=>{var h=la();return $e(nn.div,Ao({ref:l},a,{className:ir("chakra-alert__title",a.className),__css:h.title}))}),cq=Dn((a,l)=>{var h=la(),s=Ao({display:"inline"},h.description);return $e(nn.div,Ao({ref:l},a,{className:ir("chakra-alert__desc",a.className),__css:s}))}),lq=a=>{var{status:l}=w6(),{icon:h}=eO[l],s=la();return $e(nn.span,Ao({display:"inherit"},a,{className:ir("chakra-alert__icon",a.className),__css:s.icon}),$e(h,{w:"100%",h:"100%"}))},[uq,L6]=ca({strict:!1,name:"ButtonGroupContext"}),nb={border:"0px",clip:"rect(0px, 0px, 0px, 0px)",height:"1px",width:"1px",margin:"-1px",padding:"0px",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"},N6=nn("span",{baseStyle:nb});nn("input",{baseStyle:nb});function Bf(){return Bf=Object.assign||function(a){for(var l=1;l<arguments.length;l++){var h=arguments[l];for(var s in h)Object.prototype.hasOwnProperty.call(h,s)&&(a[s]=h[s])}return a},Bf.apply(this,arguments)}function F6(a,l){if(a==null)return{};var h={},s=Object.keys(a),c,E;for(E=0;E<s.length;E++)c=s[E],!(l.indexOf(c)>=0)&&(h[c]=a[c]);return h}var B6=ag({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}}),U6=Dn((a,l)=>{var h=$l("Spinner",a),s=ua(a),{label:c="Loading...",thickness:E="2px",speed:m="0.45s",emptyColor:S="transparent",className:d}=s,M=F6(s,["label","thickness","speed","emptyColor","className"]),C=ir("chakra-spinner",d),I=Bf({display:"inline-block",borderColor:"currentColor",borderStyle:"solid",borderRadius:"99999px",borderWidth:E,borderBottomColor:S,borderLeftColor:S,animation:B6+" "+m+" linear infinite"},h);return $e(nn.div,Bf({ref:l,__css:I,className:C},M),c&&$e(N6,null,c))});function Uf(){return Uf=Object.assign||function(a){for(var l=1;l<arguments.length;l++){var h=arguments[l];for(var s in h)Object.prototype.hasOwnProperty.call(h,s)&&(a[s]=h[s])}return a},Uf.apply(this,arguments)}function V6(a,l){if(a==null)return{};var h={},s=Object.keys(a),c,E;for(E=0;E<s.length;E++)c=s[E],!(l.indexOf(c)>=0)&&(h[c]=a[c]);return h}var tO=a=>{var{label:l,placement:h,children:s=$e(U6,{color:"currentColor",width:"1em",height:"1em"}),className:c,__css:E}=a,m=V6(a,["label","placement","spacing","children","className","__css"]),S=ir("chakra-button__spinner",c),d=h==="start"?"marginEnd":"marginStart",M=Vn(()=>Uf({display:"flex",alignItems:"center",position:l?"relative":"absolute",[d]:l?"0.5rem":0,fontSize:"1em",lineHeight:"normal"},E),[E,l,d]);return $e(nn.div,Uf({className:S},m,{__css:M}),s)};function rb(){return rb=Object.assign||function(a){for(var l=1;l<arguments.length;l++){var h=arguments[l];for(var s in h)Object.prototype.hasOwnProperty.call(h,s)&&(a[s]=h[s])}return a},rb.apply(this,arguments)}function k6(a,l){if(a==null)return{};var h={},s=Object.keys(a),c,E;for(E=0;E<s.length;E++)c=s[E],!(l.indexOf(c)>=0)&&(h[c]=a[c]);return h}var nO=a=>{var{children:l,className:h}=a,s=k6(a,["children","className"]),c=ra(l)?ia(l,{"aria-hidden":!0,focusable:!1}):l,E=ir("chakra-button__icon",h);return $e(nn.span,rb({display:"inline-flex",alignSelf:"center",flexShrink:0},s,{className:E}),c)};function j6(a){var[l,h]=un(!a),s=Gt(E=>{!E||h(E.tagName==="BUTTON")},[]),c=l?"button":void 0;return{ref:s,type:c}}function z6(a,l){if(a==null)return{};var h={},s=Object.keys(a),c,E;for(E=0;E<s.length;E++)c=s[E],!(l.indexOf(c)>=0)&&(h[c]=a[c]);return h}function Iu(){return Iu=Object.assign||function(a){for(var l=1;l<arguments.length;l++){var h=arguments[l];for(var s in h)Object.prototype.hasOwnProperty.call(h,s)&&(a[s]=h[s])}return a},Iu.apply(this,arguments)}var G6=Dn((a,l)=>{var h=L6(),s=$l("Button",Iu({},h,a)),c=ua(a),{isDisabled:E=h==null?void 0:h.isDisabled,isLoading:m,isActive:S,isFullWidth:d,children:M,leftIcon:C,rightIcon:I,loadingText:b,iconSpacing:p="0.5rem",type:x,spinner:P,spinnerPlacement:A="start",className:T,as:_}=c,g=z6(c,["isDisabled","isLoading","isActive","isFullWidth","children","leftIcon","rightIcon","loadingText","iconSpacing","type","spinner","spinnerPlacement","className","as"]),O=Vn(()=>{var U,L=yo({},(U=s==null?void 0:s._focus)!=null?U:{},{zIndex:1});return Iu({display:"inline-flex",appearance:"none",alignItems:"center",justifyContent:"center",userSelect:"none",position:"relative",whiteSpace:"nowrap",verticalAlign:"middle",outline:"none",width:d?"100%":"auto"},s,!!h&&{_focus:L})},[s,h,d]),{ref:R,type:N}=j6(_),V={rightIcon:I,leftIcon:C,iconSpacing:p,children:M};return $e(nn.button,Iu({disabled:E||m,ref:pU(l,R),as:_,type:x??N,"data-active":lr(S),"data-loading":lr(m),__css:O,className:ir("chakra-button",T)},g),m&&A==="start"&&$e(tO,{className:"chakra-button__spinner--start",label:b,placement:"start"},P),m?b||$e(nn.span,{opacity:0},$e(rO,V)):$e(rO,V),m&&A==="end"&&$e(tO,{className:"chakra-button__spinner--end",label:b,placement:"end"},P))});function rO(a){var{leftIcon:l,rightIcon:h,children:s,iconSpacing:c}=a;return $e(pr,null,l&&$e(nO,{marginEnd:c},l),s,h&&$e(nO,{marginStart:c},h))}function ib(){return ib=Object.assign||function(a){for(var l=1;l<arguments.length;l++){var h=arguments[l];for(var s in h)Object.prototype.hasOwnProperty.call(h,s)&&(a[s]=h[s])}return a},ib.apply(this,arguments)}function H6(a,l){if(a==null)return{};var h={},s=Object.keys(a),c,E;for(E=0;E<s.length;E++)c=s[E],!(l.indexOf(c)>=0)&&(h[c]=a[c]);return h}var hq=Dn((a,l)=>{var{icon:h,children:s,isRound:c,"aria-label":E}=a,m=H6(a,["icon","children","isRound","aria-label"]),S=h||s,d=ra(S)?ia(S,{"aria-hidden":!0,focusable:!1}):null;return $e(G6,ib({padding:"0",borderRadius:c?"full":void 0,ref:l,"aria-label":E},m),d)});function vc(){return vc=Object.assign||function(a){for(var l=1;l<arguments.length;l++){var h=arguments[l];for(var s in h)Object.prototype.hasOwnProperty.call(h,s)&&(a[s]=h[s])}return a},vc.apply(this,arguments)}function W6(a,l){if(a==null)return{};var h={},s=Object.keys(a),c,E;for(E=0;E<s.length;E++)c=s[E],!(l.indexOf(c)>=0)&&(h[c]=a[c]);return h}function X6(a){a===void 0&&(a={});var{defaultIsChecked:l,defaultChecked:h=l,isChecked:s,isFocusable:c,isDisabled:E,isReadOnly:m,isRequired:S,onChange:d,isIndeterminate:M,isInvalid:C,name:I,value:b,id:p,onBlur:x,onFocus:P,"aria-label":A,"aria-labelledby":T,"aria-invalid":_,"aria-describedby":g}=a,O=W6(a,["defaultIsChecked","defaultChecked","isChecked","isFocusable","isDisabled","isReadOnly","isRequired","onChange","isIndeterminate","isInvalid","name","value","id","onBlur","onFocus","aria-label","aria-labelledby","aria-invalid","aria-describedby"]),R=bg(d),N=bg(x),V=bg(P),[U,L]=vg(),[j,Y]=vg(),[W,re]=vg(),ne=zt(null),[ge,_e]=un(!0),[ce,ie]=un(!!h),[Z,te]=cU(s,ce);pg({condition:!!l,message:'The "defaultIsChecked" prop has been deprecated and will be removed in a future version. Please use the "defaultChecked" prop instead, which mirrors default React checkbox behavior.'});var B=Gt(J=>{if(m||E){J.preventDefault();return}Z||ie(te?J.target.checked:M?!0:J.target.checked),R==null||R(J)},[m,E,te,Z,M,R]);ic(()=>{ne.current&&(ne.current.indeterminate=Boolean(M))},[M]);var G=E&&!c,$=Gt(J=>{J.key===" "&&re.on()},[re]),le=Gt(J=>{J.key===" "&&re.off()},[re]);ic(()=>{if(!!ne.current){var J=ne.current.checked!==te;J&&ie(ne.current.checked)}},[ne.current]);var se=Gt(function(J,Q){J===void 0&&(J={}),Q===void 0&&(Q=null);var ee=pe=>{pe.preventDefault(),re.on()};return vc({},J,{ref:Q,"data-active":lr(W),"data-hover":lr(j),"data-checked":lr(te),"data-focus":lr(U),"data-indeterminate":lr(M),"data-disabled":lr(E),"data-invalid":lr(C),"data-readonly":lr(m),"aria-hidden":!0,onMouseDown:ur(J.onMouseDown,ee),onMouseUp:ur(J.onMouseUp,re.off),onMouseEnter:ur(J.onMouseEnter,Y.on),onMouseLeave:ur(J.onMouseLeave,Y.off)})},[W,te,E,U,j,M,C,m,re,Y.off,Y.on]),q=Gt(function(J,Q){return J===void 0&&(J={}),Q===void 0&&(Q=null),vc({},O,J,{ref:Hd(Q,ee=>{!ee||_e(ee.tagName==="LABEL")}),onClick:ur(J.onClick,()=>{if(!ge){var ee;(ee=ne.current)==null||ee.click(),pA(ne.current,{nextTick:!0})}}),"data-disabled":lr(E),"data-checked":lr(te),"data-invalid":lr(C)})},[O,E,te,C,ge]),H=Gt(function(J,Q){return J===void 0&&(J={}),Q===void 0&&(Q=null),vc({},J,{ref:Hd(ne,Q),type:"checkbox",name:I,value:b,id:p,onChange:ur(J.onChange,B),onBlur:ur(J.onBlur,N,L.off),onFocus:ur(J.onFocus,V,L.on),onKeyDown:ur(J.onKeyDown,$),onKeyUp:ur(J.onKeyUp,le),required:S,checked:te,disabled:G,readOnly:m,"aria-label":A,"aria-labelledby":T,"aria-invalid":_?Boolean(_):C,"aria-describedby":g,"aria-disabled":E,style:nb})},[I,b,p,B,L.off,L.on,N,V,$,le,S,te,G,m,A,T,_,C,g,E]),X=Gt(function(J,Q){return J===void 0&&(J={}),Q===void 0&&(Q=null),vc({},J,{ref:Q,onMouseDown:ur(J.onMouseDown,iO),onTouchStart:ur(J.onTouchStart,iO),"data-disabled":lr(E),"data-checked":lr(te),"data-invalid":lr(C)})},[te,E,C]);return{state:{isInvalid:C,isFocused:U,isChecked:te,isActive:W,isHovered:j,isIndeterminate:M,isDisabled:E,isReadOnly:m,isRequired:S},getRootProps:q,getCheckboxProps:se,getInputProps:H,getLabelProps:X,htmlProps:O}}function iO(a){a.preventDefault(),a.stopPropagation()}function Y6(a,l){if(a==null)return{};var h={},s=Object.keys(a),c,E;for(E=0;E<s.length;E++)c=s[E],!(l.indexOf(c)>=0)&&(h[c]=a[c]);return h}function Du(){return Du=Object.assign||function(a){for(var l=1;l<arguments.length;l++){var h=arguments[l];for(var s in h)Object.prototype.hasOwnProperty.call(h,s)&&(a[s]=h[s])}return a},Du.apply(this,arguments)}var K6=a=>$e(su,Du({focusable:"false","aria-hidden":!0},a),$e("path",{fill:"currentColor",d:"M.439,21.44a1.5,1.5,0,0,0,2.122,2.121L11.823,14.3a.25.25,0,0,1,.354,0l9.262,9.263a1.5,1.5,0,1,0,2.122-2.121L14.3,12.177a.25.25,0,0,1,0-.354l9.263-9.262A1.5,1.5,0,0,0,21.439.44L12.177,9.7a.25.25,0,0,1-.354,0L2.561.44A1.5,1.5,0,0,0,.439,2.561L9.7,11.823a.25.25,0,0,1,0,.354Z"})),Q6=Dn((a,l)=>{var h=$l("CloseButton",a),s=ua(a),{children:c,isDisabled:E,__css:m}=s,S=Y6(s,["children","isDisabled","__css"]),d={outline:0,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0};return $e(nn.button,Du({type:"button","aria-label":"Close",ref:l,disabled:E,__css:Du({},d,h,m)},S),c||$e(K6,{width:"1em",height:"1em"}))}),[dq,q6]=ca({strict:!1,name:"FormControlContext"});function Vf(){return Vf=Object.assign||function(a){for(var l=1;l<arguments.length;l++){var h=arguments[l];for(var s in h)Object.prototype.hasOwnProperty.call(h,s)&&(a[s]=h[s])}return a},Vf.apply(this,arguments)}function oO(a,l){if(a==null)return{};var h={},s=Object.keys(a),c,E;for(E=0;E<s.length;E++)c=s[E],!(l.indexOf(c)>=0)&&(h[c]=a[c]);return h}function aO(a){var l=Z6(a),{isDisabled:h,isInvalid:s,isReadOnly:c,isRequired:E}=l,m=oO(l,["isDisabled","isInvalid","isReadOnly","isRequired"]);return Vf({},m,{disabled:h,readOnly:c,required:E,"aria-invalid":fg(s),"aria-required":fg(E),"aria-readonly":fg(c)})}function Z6(a){var l,h,s,c=q6(),{id:E,disabled:m,readOnly:S,required:d,isRequired:M,isInvalid:C,isReadOnly:I,isDisabled:b,onFocus:p,onBlur:x}=a,P=oO(a,["id","disabled","readOnly","required","isRequired","isInvalid","isReadOnly","isDisabled","onFocus","onBlur"]),A=a["aria-describedby"]?[a["aria-describedby"]]:[];return c!=null&&c.hasFeedbackText&&c!=null&&c.isInvalid&&A.push(c.feedbackId),c!=null&&c.hasHelpText&&A.push(c.helpTextId),Vf({},P,{"aria-describedby":A.join(" ")||void 0,id:E??(c==null?void 0:c.id),isDisabled:(l=m??b)!=null?l:c==null?void 0:c.isDisabled,isReadOnly:(h=S??I)!=null?h:c==null?void 0:c.isReadOnly,isRequired:(s=d??M)!=null?s:c==null?void 0:c.isRequired,isInvalid:C??(c==null?void 0:c.isInvalid),onFocus:ur(c==null?void 0:c.onFocus,p),onBlur:ur(c==null?void 0:c.onBlur,x)})}function ob(){return ob=Object.assign||function(a){for(var l=1;l<arguments.length;l++){var h=arguments[l];for(var s in h)Object.prototype.hasOwnProperty.call(h,s)&&(a[s]=h[s])}return a},ob.apply(this,arguments)}var $6=Dn((a,l)=>{var h=Jl("Input",a),s=ua(a),c=aO(s),E=ir("chakra-input",a.className);return $e(nn.input,ob({},c,{__css:h.field,ref:l,className:E}))});$6.id="Input";function wu(){return wu=Object.assign||function(a){for(var l=1;l<arguments.length;l++){var h=arguments[l];for(var s in h)Object.prototype.hasOwnProperty.call(h,s)&&(a[s]=h[s])}return a},wu.apply(this,arguments)}function sO(a,l){if(a==null)return{};var h={},s=Object.keys(a),c,E;for(E=0;E<s.length;E++)c=s[E],!(l.indexOf(c)>=0)&&(h[c]=a[c]);return h}var cO=nn("div");Zi&&(cO.displayName="Box");var lO=Dn((a,l)=>{var{size:h,centerContent:s=!0}=a,c=sO(a,["size","centerContent"]),E=s?{display:"flex",alignItems:"center",justifyContent:"center"}:{};return $e(cO,wu({ref:l,boxSize:h,__css:wu({},E,{flexShrink:0,flexGrow:0})},c))});Zi&&(lO.displayName="Square");var J6=Dn((a,l)=>{var{size:h}=a,s=sO(a,["size"]);return $e(lO,wu({size:h,ref:l,borderRadius:"9999px"},s))});Zi&&(J6.displayName="Circle");function ab(){return ab=Object.assign||function(a){for(var l=1;l<arguments.length;l++){var h=arguments[l];for(var s in h)Object.prototype.hasOwnProperty.call(h,s)&&(a[s]=h[s])}return a},ab.apply(this,arguments)}function eY(a,l){if(a==null)return{};var h={},s=Object.keys(a),c,E;for(E=0;E<s.length;E++)c=s[E],!(l.indexOf(c)>=0)&&(h[c]=a[c]);return h}var fq=Dn((a,l)=>{var{direction:h,align:s,justify:c,wrap:E,basis:m,grow:S,shrink:d}=a,M=eY(a,["direction","align","justify","wrap","basis","grow","shrink"]),C={display:"flex",flexDirection:h,alignItems:s,justifyContent:c,flexWrap:E,flexBasis:m,flexGrow:S,flexShrink:d};return $e(nn.div,ab({ref:l,__css:C},M))});function kf(){return kf=Object.assign||function(a){for(var l=1;l<arguments.length;l++){var h=arguments[l];for(var s in h)Object.prototype.hasOwnProperty.call(h,s)&&(a[s]=h[s])}return a},kf.apply(this,arguments)}function uO(a,l){if(a==null)return{};var h={},s=Object.keys(a),c,E;for(E=0;E<s.length;E++)c=s[E],!(l.indexOf(c)>=0)&&(h[c]=a[c]);return h}var pq=Dn((a,l)=>{var{area:h,templateAreas:s,gap:c,rowGap:E,columnGap:m,column:S,row:d,autoFlow:M,autoRows:C,templateRows:I,autoColumns:b,templateColumns:p}=a,x=uO(a,["area","templateAreas","gap","rowGap","columnGap","column","row","autoFlow","autoRows","templateRows","autoColumns","templateColumns"]),P={display:"grid",gridArea:h,gridTemplateAreas:s,gridGap:c,gridRowGap:E,gridColumnGap:m,gridAutoColumns:b,gridColumn:S,gridRow:d,gridAutoFlow:M,gridAutoRows:C,gridTemplateRows:I,gridTemplateColumns:p};return $e(nn.div,kf({ref:l,__css:P},x))});function hO(a){return gg(a,l=>l==="auto"?"auto":"span "+l+"/span "+l)}var mq=Dn((a,l)=>{var{colSpan:h,colStart:s,colEnd:c,rowEnd:E,rowSpan:m,rowStart:S}=a,d=uO(a,["colSpan","colStart","colEnd","rowEnd","rowSpan","rowStart"]),M=Ud({gridColumn:hO(h),gridRow:hO(m),gridColumnStart:s,gridColumnEnd:c,gridRowStart:S,gridRowEnd:E});return $e(nn.div,kf({ref:l,__css:M},d))}),_q=nn("div",{baseStyle:{flex:1,justifySelf:"stretch",alignSelf:"stretch"}}),sb="& > *:not(style) ~ *:not(style)";function tY(a){var{spacing:l,direction:h}=a,s={column:{marginTop:l,marginEnd:0,marginBottom:0,marginStart:0},row:{marginTop:0,marginEnd:0,marginBottom:0,marginStart:l},"column-reverse":{marginTop:0,marginEnd:0,marginBottom:l,marginStart:0},"row-reverse":{marginTop:0,marginEnd:l,marginBottom:0,marginStart:0}};return{flexDirection:h,[sb]:gg(h,c=>s[c])}}function nY(a){var{spacing:l,direction:h}=a,s={column:{my:l,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},"column-reverse":{my:l,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},row:{mx:l,my:0,borderLeftWidth:"1px",borderBottomWidth:0},"row-reverse":{mx:l,my:0,borderLeftWidth:"1px",borderBottomWidth:0}};return{"&":gg(h,c=>s[c])}}function rY(a,l){if(a==null)return{};var h={},s=Object.keys(a),c,E;for(E=0;E<s.length;E++)c=s[E],!(l.indexOf(c)>=0)&&(h[c]=a[c]);return h}function Ja(){return Ja=Object.assign||function(a){for(var l=1;l<arguments.length;l++){var h=arguments[l];for(var s in h)Object.prototype.hasOwnProperty.call(h,s)&&(a[s]=h[s])}return a},Ja.apply(this,arguments)}var iY=a=>$e(nn.div,Ja({className:"chakra-stack__item"},a,{__css:Ja({display:"inline-block",flex:"0 0 auto",minWidth:0},a.__css)})),cb=Dn((a,l)=>{var{isInline:h,direction:s,align:c,justify:E,spacing:m="0.5rem",wrap:S,children:d,divider:M,className:C,shouldWrapChildren:I}=a,b=rY(a,["isInline","direction","align","justify","spacing","wrap","children","divider","className","shouldWrapChildren"]),p=h?"row":s??"column",x=Vn(()=>tY({direction:p,spacing:m}),[p,m]),P=Vn(()=>nY({spacing:m,direction:p}),[m,p]),A=!!M,T=!I&&!A,_=oU(d),g=T?_:_.map((R,N)=>{var V=typeof R.key!="undefined"?R.key:N,U=N+1===_.length,L=$e(iY,{key:V},R),j=I?L:R;if(!A)return j;var Y=ia(M,{__css:P}),W=U?null:Y;return $e(pr,{key:V},j,W)}),O=ir("chakra-stack",C);return $e(nn.div,Ja({ref:l,display:"flex",alignItems:c,justifyContent:E,flexDirection:x.flexDirection,flexWrap:S,className:O,__css:A?{}:{[sb]:x[sb]}},b),g)});Zi&&(cb.displayName="Stack");var oY=Dn((a,l)=>$e(cb,Ja({align:"center"},a,{direction:"row",ref:l})));Zi&&(oY.displayName="HStack");var aY=Dn((a,l)=>$e(cb,Ja({align:"center"},a,{direction:"column",ref:l})));Zi&&(aY.displayName="VStack");function lb(){return lb=Object.assign||function(a){for(var l=1;l<arguments.length;l++){var h=arguments[l];for(var s in h)Object.prototype.hasOwnProperty.call(h,s)&&(a[s]=h[s])}return a},lb.apply(this,arguments)}function sY(a,l){if(a==null)return{};var h={},s=Object.keys(a),c,E;for(E=0;E<s.length;E++)c=s[E],!(l.indexOf(c)>=0)&&(h[c]=a[c]);return h}var gq=Dn((a,l)=>{var h=$l("Text",a),s=ua(a),c=sY(s,["className","align","decoration","casing"]),E=Ud({textAlign:a.align,textDecoration:a.decoration,textTransform:a.casing});return $e(nn.p,lb({ref:l,className:ir("chakra-text",a.className)},E,c,{__css:h}))});function cY(a,l){if(a==null)return{};var h={},s=Object.keys(a),c,E;for(E=0;E<s.length;E++)c=s[E],!(l.indexOf(c)>=0)&&(h[c]=a[c]);return h}var dO={exports:{}},lY="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",uY=lY,hY=uY;function fO(){}function pO(){}pO.resetWarningCache=fO;var dY=function(){function a(s,c,E,m,S,d){if(d!==hY){var M=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw M.name="Invariant Violation",M}}a.isRequired=a;function l(){return a}var h={array:a,bool:a,func:a,number:a,object:a,string:a,symbol:a,any:a,arrayOf:l,element:a,elementType:a,instanceOf:l,node:a,objectOf:l,oneOf:l,oneOfType:l,shape:l,exact:l,checkPropTypes:pO,resetWarningCache:fO};return h.PropTypes=h,h};dO.exports=dY();var Ct=dO.exports,ub="data-focus-lock",mO="data-focus-lock-disabled",fY="data-no-focus-lock",pY="data-autofocus-inside";function mY(a,l){return typeof a=="function"?a(l):a&&(a.current=l),a}function _Y(a,l){var h=un(function(){return{value:a,callback:l,facade:{get current(){return h.value},set current(s){var c=h.value;c!==s&&(h.value=s,h.callback(s,c))}}}})[0];return h.callback=l,h.facade}function _O(a,l){return _Y(l,function(h){return a.forEach(function(s){return mY(s,h)})})}var hb={width:"1px",height:"0px",padding:0,overflow:"hidden",position:"fixed",top:"1px",left:"1px"};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var jf=function(){return jf=Object.assign||function(l){for(var h,s=1,c=arguments.length;s<c;s++){h=arguments[s];for(var E in h)Object.prototype.hasOwnProperty.call(h,E)&&(l[E]=h[E])}return l},jf.apply(this,arguments)};function gY(a,l){var h={};for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&l.indexOf(s)<0&&(h[s]=a[s]);if(a!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,s=Object.getOwnPropertySymbols(a);c<s.length;c++)l.indexOf(s[c])<0&&Object.prototype.propertyIsEnumerable.call(a,s[c])&&(h[s[c]]=a[s[c]]);return h}function gO(a){return a}function vO(a,l){l===void 0&&(l=gO);var h=[],s=!1,c={read:function(){if(s)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return h.length?h[h.length-1]:a},useMedium:function(E){var m=l(E,s);return h.push(m),function(){h=h.filter(function(S){return S!==m})}},assignSyncMedium:function(E){for(s=!0;h.length;){var m=h;h=[],m.forEach(E)}h={push:function(S){return E(S)},filter:function(){return h}}},assignMedium:function(E){s=!0;var m=[];if(h.length){var S=h;h=[],S.forEach(E),m=h}var d=function(){var C=m;m=[],C.forEach(E)},M=function(){return Promise.resolve().then(d)};M(),h={push:function(C){m.push(C),M()},filter:function(C){return m=m.filter(C),h}}}};return c}function db(a,l){return l===void 0&&(l=gO),vO(a,l)}function bO(a){a===void 0&&(a={});var l=vO(null);return l.options=jf({async:!0,ssr:!1},a),l}var yO=function(a){var l=a.sideCar,h=gY(a,["sideCar"]);if(!l)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var s=l.read();if(!s)throw new Error("Sidecar medium not found");return $e(s,jf({},h))};yO.isSideCarExport=!0;function vY(a,l){return a.useMedium(l),yO}var TO=db({},function(a){var l=a.target,h=a.currentTarget;return{target:l,currentTarget:h}}),EO=db(),bY=db(),yY=bO({async:!0}),TY=[],fb=Oi(function(l,h){var s,c=un(),E=c[0],m=c[1],S=zt(),d=zt(!1),M=zt(null),C=l.children,I=l.disabled,b=l.noFocusGuards,p=l.persistentFocus,x=l.crossFrame,P=l.autoFocus;l.allowTextSelection;var A=l.group,T=l.className,_=l.whiteList,g=l.shards,O=g===void 0?TY:g,R=l.as,N=R===void 0?"div":R,V=l.lockProps,U=V===void 0?{}:V,L=l.sideCar,j=l.returnFocus,Y=l.onActivation,W=l.onDeactivation,re=un({}),ne=re[0],ge=Gt(function(){M.current=M.current||document&&document.activeElement,S.current&&Y&&Y(S.current),d.current=!0},[Y]),_e=Gt(function(){d.current=!1,W&&W(S.current)},[W]),ce=Gt(function(se){var q=M.current;if(Boolean(j)&&q&&q.focus){var H=typeof j=="object"?j:void 0;M.current=null,se?Promise.resolve().then(function(){return q.focus(H)}):q.focus(H)}},[j]),ie=Gt(function(se){d.current&&TO.useMedium(se)},[]),Z=EO.useMedium,te=Gt(function(se){S.current!==se&&(S.current=se,m(se))},[]),B=sa((s={},s[mO]=I&&"disabled",s[ub]=A,s),U),G=b!==!0,$=G&&b!=="tail",le=_O([h,te]);return $e(pr,null,G&&[$e("div",{key:"guard-first","data-focus-guard":!0,tabIndex:I?-1:0,style:hb}),$e("div",{key:"guard-nearest","data-focus-guard":!0,tabIndex:I?-1:1,style:hb})],!I&&$e(L,{id:ne,sideCar:yY,observed:E,disabled:I,persistentFocus:p,crossFrame:x,autoFocus:P,whiteList:_,shards:O,onActivation:ge,onDeactivation:_e,returnFocus:ce}),$e(N,sa({ref:le},B,{className:T,onBlur:Z,onFocus:ie}),C),$&&$e("div",{"data-focus-guard":!0,tabIndex:I?-1:0,style:hb}))});fb.propTypes={};fb.defaultProps={children:void 0,disabled:!1,returnFocus:!1,noFocusGuards:!1,autoFocus:!0,persistentFocus:!1,crossFrame:!0,allowTextSelection:void 0,group:void 0,className:void 0,whiteList:void 0,shards:void 0,as:"div",lockProps:{},onActivation:void 0,onDeactivation:void 0};var SO=fb;function pb(a,l){return pb=Object.setPrototypeOf||function(s,c){return s.__proto__=c,s},pb(a,l)}function EY(a,l){a.prototype=Object.create(l.prototype),a.prototype.constructor=a,pb(a,l)}function SY(a,l,h){return l in a?Object.defineProperty(a,l,{value:h,enumerable:!0,configurable:!0,writable:!0}):a[l]=h,a}function xY(a,l){function h(s){return s.displayName||s.name||"Component"}return function(c){var E=[],m;function S(){m=a(E.map(function(M){return M.props})),l(m)}var d=function(M){EY(C,M);function C(){return M.apply(this,arguments)||this}C.peek=function(){return m};var I=C.prototype;return I.componentDidMount=function(){E.push(this),S()},I.componentDidUpdate=function(){S()},I.componentWillUnmount=function(){var p=E.indexOf(this);E.splice(p,1),S()},I.render=function(){return ei.createElement(c,this.props)},C}(wl);return SY(d,"displayName","SideEffect("+h(c)+")"),d}}var ga=function(a){for(var l=Array(a.length),h=0;h<a.length;++h)l[h]=a[h];return l},mb=function(a){return Array.isArray(a)?a:[a]},AY=function(a){for(var l=new Set,h=a.length,s=0;s<h;s+=1)for(var c=s+1;c<h;c+=1){var E=a[s].compareDocumentPosition(a[c]);(E&Node.DOCUMENT_POSITION_CONTAINED_BY)>0&&l.add(c),(E&Node.DOCUMENT_POSITION_CONTAINS)>0&&l.add(s)}return a.filter(function(m,S){return!l.has(S)})},xO=function(a){return a.parentNode?xO(a.parentNode):a},_b=function(a){var l=mb(a);return l.filter(Boolean).reduce(function(h,s){var c=s.getAttribute(ub);return h.push.apply(h,c?AY(ga(xO(s).querySelectorAll("["+ub+'="'+c+'"]:not(['+mO+'="disabled"])'))):[s]),h},[])},PY=function(a){return!a||!a.getPropertyValue?!1:a.getPropertyValue("display")==="none"||a.getPropertyValue("visibility")==="hidden"},AO=function(a){return!a||a===document||a&&a.nodeType===Node.DOCUMENT_NODE||!PY(window.getComputedStyle(a,null))&&AO(a.parentNode&&a.parentNode.nodeType===Node.DOCUMENT_FRAGMENT_NODE?a.parentNode.host:a.parentNode)},CY=function(a){return!((a.tagName==="INPUT"||a.tagName==="BUTTON")&&(a.type==="hidden"||a.disabled))},gb=function(a){return Boolean(a&&a.dataset&&a.dataset.focusGuard)},zf=function(a){return!gb(a)},RY=function(a){return Boolean(a)},OY=function(a,l){var h=a.tabIndex-l.tabIndex,s=a.index-l.index;if(h){if(!a.tabIndex)return 1;if(!l.tabIndex)return-1}return h||s},PO=function(a,l,h){return ga(a).map(function(s,c){return{node:s,index:c,tabIndex:h&&s.tabIndex===-1?(s.dataset||{}).focusGuard?0:-1:s.tabIndex}}).filter(function(s){return!l||s.tabIndex>=0}).sort(OY)},MY=["button:enabled","select:enabled","textarea:enabled","input:enabled","a[href]","area[href]","summary","iframe","object","embed","audio[controls]","video[controls]","[tabindex]","[contenteditable]","[autofocus]"],vb=MY.join(","),IY=vb+", [data-focus-guard]",bb=function(a,l){return a.reduce(function(h,s){return h.concat(ga(s.querySelectorAll(l?IY:vb)),s.parentNode?ga(s.parentNode.querySelectorAll(vb)).filter(function(c){return c===s}):[])},[])},DY=function(a){var l=a.querySelectorAll("["+pY+"]");return ga(l).map(function(h){return bb([h])}).reduce(function(h,s){return h.concat(s)},[])},yb=function(a){return ga(a).filter(function(l){return AO(l)}).filter(function(l){return CY(l)})},Tb=function(a,l){return PO(yb(bb(a,l)),!0,l)},CO=function(a){return PO(yb(bb(a)),!1)},wY=function(a){return yb(DY(a))},Eb=function(a,l){return l===void 0&&(l=[]),l.push(a),a.parentNode&&Eb(a.parentNode,l),l},Sb=function(a,l){for(var h=Eb(a),s=Eb(l),c=0;c<h.length;c+=1){var E=h[c];if(s.indexOf(E)>=0)return E}return!1},RO=function(a,l,h){var s=mb(a),c=mb(l),E=s[0],m=!1;return c.filter(Boolean).forEach(function(S){m=Sb(m||S,S)||m,h.filter(Boolean).forEach(function(d){var M=Sb(E,d);M&&(!m||M.contains(m)?m=M:m=Sb(M,m))})}),m},LY=function(a){return a.reduce(function(l,h){return l.concat(wY(h))},[])},NY=function(a){var l=_b(a).filter(zf),h=RO(a,a,l),s=Tb([h],!0),c=Tb(l).filter(function(E){var m=E.node;return zf(m)}).map(function(E){var m=E.node;return m});return s.map(function(E){var m=E.node,S=E.index;return{node:m,index:S,lockItem:c.indexOf(m)>=0,guard:gb(m)}})},FY=function(a){return a===document.activeElement},BY=function(a){return Boolean(ga(a.querySelectorAll("iframe")).some(function(l){return FY(l)}))},OO=function(a){var l=document&&document.activeElement;return!l||l.dataset&&l.dataset.focusGuard?!1:_b(a).reduce(function(h,s){return h||s.contains(l)||BY(s)},!1)},UY=function(){return document&&ga(document.querySelectorAll("["+fY+"]")).some(function(a){return a.contains(document.activeElement)})},MO=function(a){return a.tagName==="INPUT"&&a.type==="radio"},VY=function(a,l){return l.filter(MO).filter(function(h){return h.name===a.name}).filter(function(h){return h.checked})[0]||a},xb=function(a,l){return MO(a)&&a.name?VY(a,l):a},kY=function(a){var l=new Set;return a.forEach(function(h){return l.add(xb(h,a))}),a.filter(function(h){return l.has(h)})},IO=function(a){return a[0]&&a.length>1?xb(a[0],a):a[0]},DO=function(a,l){return a.length>1?a.indexOf(xb(a[l],a)):l},wO="NEW_FOCUS",jY=function(a,l,h,s){var c=a.length,E=a[0],m=a[c-1],S=gb(h);if(!(a.indexOf(h)>=0)){var d=l.indexOf(h),M=s?l.indexOf(s):d,C=s?a.indexOf(s):-1,I=d-M,b=l.indexOf(E),p=l.indexOf(m),x=kY(l),P=x.indexOf(h)-(s?x.indexOf(s):d),A=DO(a,0),T=DO(a,c-1);if(d===-1||C===-1)return wO;if(!I&&C>=0)return C;if(d<=b&&S&&Math.abs(I)>1)return T;if(d>=p&&S&&Math.abs(I)>1)return A;if(I&&Math.abs(P)>1)return C;if(d<=b)return T;if(d>p)return A;if(I)return Math.abs(I)>1?C:(c+C+I)%c}},zY=function(a){return function(l){return l.autofocus||l.dataset&&!!l.dataset.autofocus||a.indexOf(l)>=0}},GY=function(a,l){var h=new Map;return l.forEach(function(s){return h.set(s.node,s)}),a.map(function(s){return h.get(s)}).filter(RY)},HY=function(a,l){var h=document&&document.activeElement,s=_b(a).filter(zf),c=RO(h||a,a,s),E=CO(s),m=Tb(s).filter(function(b){var p=b.node;return zf(p)});if(!(!m[0]&&(m=E,!m[0]))){var S=CO([c]).map(function(b){var p=b.node;return p}),d=GY(S,m),M=d.map(function(b){var p=b.node;return p}),C=jY(M,S,h,l);if(C===wO){var I=E.map(function(b){var p=b.node;return p}).filter(zY(LY(s)));return{node:I&&I.length?IO(I):IO(M)}}return C===void 0?C:d[C]}},WY=function(a){a.focus(),"contentWindow"in a&&a.contentWindow&&a.contentWindow.focus()},Ab=0,Pb=!1,XY=function(a,l){var h=HY(a,l);if(!Pb&&h){if(Ab>2){console.error("FocusLock: focus-fighting detected. Only one focus management system could be active. See https://github.com/theKashey/focus-lock/#focus-fighting"),Pb=!0,setTimeout(function(){Pb=!1},1);return}Ab++,WY(h.node),Ab--}},LO=XY;function NO(a){var l=window,h=l.setImmediate;typeof h!="undefined"?h(a):setTimeout(a,1)}var YY=function(){return document&&document.activeElement===document.body},KY=function(){return YY()||UY()},bc=null,yc=null,Tc=null,Lu=!1,QY=function(){return!0},qY=function(l){return(bc.whiteList||QY)(l)},ZY=function(l,h){Tc={observerNode:l,portaledElement:h}},$Y=function(l){return Tc&&Tc.portaledElement===l};function FO(a,l,h,s){var c=null,E=a;do{var m=s[E];if(m.guard)m.node.dataset.focusAutoGuard&&(c=m);else if(m.lockItem){if(E!==a)return;c=null}else break}while((E+=h)!==l);c&&(c.node.tabIndex=0)}var JY=function(l){return l&&"current"in l?l.current:l},e8=function(l){return l?Boolean(Lu):Lu==="meanwhile"},Gf=function(){var l=!1;if(bc){var h=bc,s=h.observed,c=h.persistentFocus,E=h.autoFocus,m=h.shards,S=h.crossFrame,d=s||Tc&&Tc.portaledElement,M=document&&document.activeElement;if(d){var C=[d].concat(m.map(JY).filter(Boolean));if((!M||qY(M))&&(c||e8(S)||!KY()||!yc&&E)&&(d&&!(OO(C)||$Y(M))&&(document&&!yc&&M&&!E?(M.blur&&M.blur(),document.body.focus()):(l=LO(C,yc),Tc={})),Lu=!1,yc=document&&document.activeElement),document){var I=document&&document.activeElement,b=NY(C),p=b.map(function(x){var P=x.node;return P}).indexOf(I);p>-1&&(b.filter(function(x){var P=x.guard,A=x.node;return P&&A.dataset.focusAutoGuard}).forEach(function(x){var P=x.node;return P.removeAttribute("tabIndex")}),FO(p,b.length,1,b),FO(p,-1,-1,b))}}}return l},BO=function(l){Gf()&&l&&(l.stopPropagation(),l.preventDefault())},Cb=function(){return NO(Gf)},t8=function(l){var h=l.target,s=l.currentTarget;s.contains(h)||ZY(s,h)},n8=function(){return null},UO=function(){Lu="just",setTimeout(function(){Lu="meanwhile"},0)},r8=function(){document.addEventListener("focusin",BO,!0),document.addEventListener("focusout",Cb),window.addEventListener("blur",UO)},i8=function(){document.removeEventListener("focusin",BO,!0),document.removeEventListener("focusout",Cb),window.removeEventListener("blur",UO)};function o8(a){return a.filter(function(l){var h=l.disabled;return!h})}function a8(a){var l=a.slice(-1)[0];l&&!bc&&r8();var h=bc,s=h&&l&&l.id===h.id;bc=l,h&&!s&&(h.onDeactivation(),a.filter(function(c){var E=c.id;return E===h.id}).length||h.returnFocus(!l)),l?(yc=null,(!s||h.observed!==l.observed)&&l.onActivation(),Gf(),NO(Gf)):(i8(),yc=null)}TO.assignSyncMedium(t8);EO.assignMedium(Cb);bY.assignMedium(function(a){return a({moveFocusInside:LO,focusInside:OO})});var s8=xY(o8,a8)(n8),VO=Oi(function(l,h){return $e(SO,sa({sideCar:s8,ref:h},l))}),kO=SO.propTypes||{};kO.sideCar;cY(kO,["sideCar"]);VO.propTypes={};var c8=VO,l8=a=>{var{initialFocusRef:l,finalFocusRef:h,contentRef:s,restoreFocus:c,children:E,isDisabled:m,autoFocus:S,persistentFocus:d,lockFocusAcrossFrames:M}=a,C=Gt(()=>{if(l!=null&&l.current)l.current.focus();else if(s!=null&&s.current){var p=Y2(s.current);p.length===0&&pA(s.current,{nextTick:!0})}},[l,s]),I=Gt(()=>{var p;h==null||(p=h.current)==null||p.focus()},[h]),b=c&&!h;return $e(c8,{crossFrame:M,persistentFocus:d,autoFocus:S,disabled:m,onActivation:C,onDeactivation:I,returnFocus:b},E)};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Ec=function(){return Ec=Object.assign||function(l){for(var h,s=1,c=arguments.length;s<c;s++){h=arguments[s];for(var E in h)Object.prototype.hasOwnProperty.call(h,E)&&(l[E]=h[E])}return l},Ec.apply(this,arguments)};function u8(a,l){var h={};for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&l.indexOf(s)<0&&(h[s]=a[s]);if(a!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,s=Object.getOwnPropertySymbols(a);c<s.length;c++)l.indexOf(s[c])<0&&Object.prototype.propertyIsEnumerable.call(a,s[c])&&(h[s[c]]=a[s[c]]);return h}var Hf="right-scroll-bar-position",Wf="width-before-scroll-bar",h8="with-scroll-bars-hidden",d8="--removed-body-scroll-bar-size",jO=bO(),Rb=function(){},Xf=Oi(function(a,l){var h=zt(null),s=un({onScrollCapture:Rb,onWheelCapture:Rb,onTouchMoveCapture:Rb}),c=s[0],E=s[1],m=a.forwardProps,S=a.children,d=a.className,M=a.removeScrollBar,C=a.enabled,I=a.shards,b=a.sideCar,p=a.noIsolation,x=a.inert,P=a.allowPinchZoom,A=a.as,T=A===void 0?"div":A,_=u8(a,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as"]),g=b,O=_O([h,l]),R=Ec({},_,c);return $e(pr,null,C&&$e(g,{sideCar:jO,removeScrollBar:M,shards:I,noIsolation:p,inert:x,setCallbacks:E,allowPinchZoom:!!P,lockRef:h}),m?ia(Nl.only(S),Ec({},R,{ref:O})):$e(T,Ec({},R,{className:d,ref:O}),S))});Xf.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};Xf.classNames={fullWidth:Wf,zeroRight:Hf};var f8=function(){if(typeof __webpack_nonce__!="undefined")return __webpack_nonce__};function p8(){if(!document)return null;var a=document.createElement("style");a.type="text/css";var l=f8();return l&&a.setAttribute("nonce",l),a}function m8(a,l){a.styleSheet?a.styleSheet.cssText=l:a.appendChild(document.createTextNode(l))}function _8(a){var l=document.head||document.getElementsByTagName("head")[0];l.appendChild(a)}var g8=function(){var a=0,l=null;return{add:function(h){a==0&&(l=p8())&&(m8(l,h),_8(l)),a++},remove:function(){a--,!a&&l&&(l.parentNode&&l.parentNode.removeChild(l),l=null)}}},v8=function(){var a=g8();return function(l){Vt(function(){return a.add(l),function(){a.remove()}},[])}},zO=function(){var a=v8(),l=function(h){var s=h.styles;return a(s),null};return l},b8={left:0,top:0,right:0,gap:0},Ob=function(a){return parseInt(a||"",10)||0},y8=function(a){var l=window.getComputedStyle(document.body),h=l[a==="padding"?"paddingLeft":"marginLeft"],s=l[a==="padding"?"paddingTop":"marginTop"],c=l[a==="padding"?"paddingRight":"marginRight"];return[Ob(h),Ob(s),Ob(c)]},GO=function(a){if(a===void 0&&(a="margin"),typeof window=="undefined")return b8;var l=y8(a),h=document.documentElement.clientWidth,s=window.innerWidth;return{left:l[0],top:l[1],right:l[2],gap:Math.max(0,s-h+l[2]-l[0])}},T8=zO(),E8=function(a,l,h,s){var c=a.left,E=a.top,m=a.right,S=a.gap;return h===void 0&&(h="margin"),`
  .`+h8+` {
   overflow: hidden `+s+`;
   padding-right: `+S+"px "+s+`;
  }
  body {
    overflow: hidden `+s+`;
    `+[l&&"position: relative "+s+";",h==="margin"&&`
    padding-left: `+c+`px;
    padding-top: `+E+`px;
    padding-right: `+m+`px;
    margin-left:0;
    margin-top:0;
    margin-right: `+S+"px "+s+`;
    `,h==="padding"&&"padding-right: "+S+"px "+s+";"].filter(Boolean).join("")+`
  }
  
  .`+Hf+` {
    right: `+S+"px "+s+`;
  }
  
  .`+Wf+` {
    margin-right: `+S+"px "+s+`;
  }
  
  .`+Hf+" ."+Hf+` {
    right: 0 `+s+`;
  }
  
  .`+Wf+" ."+Wf+` {
    margin-right: 0 `+s+`;
  }
  
  body {
    `+d8+": "+S+`px;
  }
`},S8=function(a){var l=un(GO(a.gapMode)),h=l[0],s=l[1];Vt(function(){s(GO(a.gapMode))},[a.gapMode]);var c=a.noRelative,E=a.noImportant,m=a.gapMode,S=m===void 0?"margin":m;return $e(T8,{styles:E8(h,!c,S,E?"":"!important")})},x8=function(a){var l=window.getComputedStyle(a);return l.overflowY!=="hidden"&&!(l.overflowY===l.overflowX&&l.overflowY==="visible")},A8=function(a){var l=window.getComputedStyle(a);return l.overflowX!=="hidden"&&!(l.overflowY===l.overflowX&&l.overflowX==="visible")},HO=function(a,l){var h=l;do{var s=WO(a,h);if(s){var c=XO(a,h),E=c[1],m=c[2];if(E>m)return!0}h=h.parentNode}while(h&&h!==document.body);return!1},P8=function(a){var l=a.scrollTop,h=a.scrollHeight,s=a.clientHeight;return[l,h,s]},C8=function(a){var l=a.scrollLeft,h=a.scrollWidth,s=a.clientWidth;return[l,h,s]},WO=function(a,l){return a==="v"?x8(l):A8(l)},XO=function(a,l){return a==="v"?P8(l):C8(l)},R8=function(a,l,h,s,c){var E=s,m=h.target,S=l.contains(m),d=!1,M=E>0,C=0,I=0;do{var b=XO(a,m),p=b[0],x=b[1],P=b[2],A=x-P-p;(p||A)&&WO(a,m)&&(C+=A,I+=p),m=m.parentNode}while(!S&&m!==document.body||S&&(l.contains(m)||l===m));return(M&&(c&&C===0||!c&&E>C)||!M&&(c&&I===0||!c&&-E>I))&&(d=!0),d},Mb=!1;if(typeof window!="undefined")try{var Yf=Object.defineProperty({},"passive",{get:function(){return Mb=!0,!0}});window.addEventListener("test",Yf,Yf),window.removeEventListener("test",Yf,Yf)}catch(a){Mb=!1}var Sc=Mb?{passive:!1}:!1,Kf=function(a){return"changedTouches"in a?[a.changedTouches[0].clientX,a.changedTouches[0].clientY]:[0,0]},YO=function(a){return[a.deltaX,a.deltaY]},KO=function(a){return a&&"current"in a?a.current:a},O8=function(a,l){return a[0]===l[0]&&a[1]===l[1]},M8=function(a){return`
  .block-interactivity-`+a+` {pointer-events: none;}
  .allow-interactivity-`+a+` {pointer-events: all;}
`},I8=0,xc=[];function D8(a){var l=zt([]),h=zt([0,0]),s=zt(),c=un(I8++)[0],E=un(function(){return zO()})[0],m=zt(a);Vt(function(){m.current=a},[a]),Vt(function(){if(a.inert){document.body.classList.add("block-interactivity-"+c);var P=[a.lockRef.current].concat((a.shards||[]).map(KO)).filter(Boolean);return P.forEach(function(A){return A.classList.add("allow-interactivity-"+c)}),function(){document.body.classList.remove("block-interactivity-"+c),P.forEach(function(A){return A.classList.remove("allow-interactivity-"+c)})}}},[a.inert,a.lockRef.current,a.shards]);var S=Gt(function(P,A){if("touches"in P&&P.touches.length===2)return!m.current.allowPinchZoom;var T=Kf(P),_=h.current,g="deltaX"in P?P.deltaX:_[0]-T[0],O="deltaY"in P?P.deltaY:_[1]-T[1],R,N=P.target,V=Math.abs(g)>Math.abs(O)?"h":"v",U=HO(V,N);if(!U)return!0;if(U?R=V:(R=V==="v"?"h":"v",U=HO(V,N)),!U)return!1;if(!s.current&&"changedTouches"in P&&(g||O)&&(s.current=R),!R)return!0;var L=s.current||R;return R8(L,A,P,L==="h"?g:O,!0)},[]),d=Gt(function(P){var A=P;if(!(!xc.length||xc[xc.length-1]!==E)){var T="deltaY"in A?YO(A):Kf(A),_=l.current.filter(function(R){return R.name===A.type&&R.target===A.target&&O8(R.delta,T)})[0];if(_&&_.should){A.preventDefault();return}if(!_){var g=(m.current.shards||[]).map(KO).filter(Boolean).filter(function(R){return R.contains(A.target)}),O=g.length>0?S(A,g[0]):!m.current.noIsolation;O&&A.preventDefault()}}},[]),M=Gt(function(P,A,T,_){var g={name:P,delta:A,target:T,should:_};l.current.push(g),setTimeout(function(){l.current=l.current.filter(function(O){return O!==g})},1)},[]),C=Gt(function(P){h.current=Kf(P),s.current=void 0},[]),I=Gt(function(P){M(P.type,YO(P),P.target,S(P,a.lockRef.current))},[]),b=Gt(function(P){M(P.type,Kf(P),P.target,S(P,a.lockRef.current))},[]);Vt(function(){return xc.push(E),a.setCallbacks({onScrollCapture:I,onWheelCapture:I,onTouchMoveCapture:b}),document.addEventListener("wheel",d,Sc),document.addEventListener("touchmove",d,Sc),document.addEventListener("touchstart",C,Sc),function(){xc=xc.filter(function(P){return P!==E}),document.removeEventListener("wheel",d,Sc),document.removeEventListener("touchmove",d,Sc),document.removeEventListener("touchstart",C,Sc)}},[]);var p=a.removeScrollBar,x=a.inert;return $e(pr,null,x?$e(E,{styles:M8(c)}):null,p?$e(S8,{gapMode:"margin"}):null)}var w8=vY(jO,D8),QO=Oi(function(a,l){return $e(Xf,Ec({},a,{ref:l,sideCar:w8}))});QO.classNames=Xf.classNames;var L8=QO,N8=function(a){if(typeof document=="undefined")return null;var l=Array.isArray(a)?a[0]:a;return l.ownerDocument.body},Ac=new WeakMap,Qf=new WeakMap,qf={},Ib=0,F8=function(a,l,h){l===void 0&&(l=N8(a)),h===void 0&&(h="data-aria-hidden");var s=Array.isArray(a)?a:[a];qf[h]||(qf[h]=new WeakMap);var c=qf[h],E=[],m=new Set,S=function(M){!M||m.has(M)||(m.add(M),S(M.parentNode))};s.forEach(S);var d=function(M){!M||s.indexOf(M)>=0||Array.prototype.forEach.call(M.children,function(C){if(m.has(C))d(C);else{var I=C.getAttribute("aria-hidden"),b=I!==null&&I!=="false",p=(Ac.get(C)||0)+1,x=(c.get(C)||0)+1;Ac.set(C,p),c.set(C,x),E.push(C),p===1&&b&&Qf.set(C,!0),x===1&&C.setAttribute(h,"true"),b||C.setAttribute("aria-hidden","true")}})};return d(l),m.clear(),Ib++,function(){E.forEach(function(M){var C=Ac.get(M)-1,I=c.get(M)-1;Ac.set(M,C),c.set(M,I),C||(Qf.has(M)||M.removeAttribute("aria-hidden"),Qf.delete(M)),I||M.removeAttribute(h)}),Ib--,Ib||(Ac=new WeakMap,Ac=new WeakMap,Qf=new WeakMap,qf={})}};function B8(a,l,h){return l in a?Object.defineProperty(a,l,{value:h,enumerable:!0,configurable:!0,writable:!0}):a[l]=h,a}class U8{constructor(){B8(this,"modals",void 0),this.modals=[]}add(l){this.modals.push(l)}remove(l){this.modals=this.modals.filter(h=>h!==l)}isTopModal(l){var h=this.modals[this.modals.length-1];return h===l}}var Db=new U8;function V8(a,l){Vt(()=>(l&&Db.add(a),()=>{Db.remove(a)}),[l,a])}function Zf(){return Zf=Object.assign||function(a){for(var l=1;l<arguments.length;l++){var h=arguments[l];for(var s in h)Object.prototype.hasOwnProperty.call(h,s)&&(a[s]=h[s])}return a},Zf.apply(this,arguments)}function k8(a){var{isOpen:l,onClose:h,id:s,closeOnOverlayClick:c=!0,closeOnEsc:E=!0,useInert:m=!0,onOverlayClick:S,onEsc:d}=a,M=zt(null),C=zt(null),[I,b,p]=hU(s,"chakra-modal","chakra-modal--header","chakra-modal--body");j8(M,l&&m),V8(M,l);var x=zt(null),P=Gt(U=>{x.current=U.target},[]),A=Gt(U=>{U.key==="Escape"&&(U.stopPropagation(),E&&(h==null||h()),d==null||d())},[E,h,d]),[T,_]=un(!1),[g,O]=un(!1),R=Gt(function(U,L){return U===void 0&&(U={}),L===void 0&&(L=null),Zf({role:"dialog"},U,{ref:Hd(L,M),id:I,tabIndex:-1,"aria-modal":!0,"aria-labelledby":T?b:void 0,"aria-describedby":g?p:void 0,onClick:ur(U.onClick,j=>j.stopPropagation())})},[p,g,I,b,T]),N=Gt(U=>{U.stopPropagation(),x.current===U.target&&(!Db.isTopModal(M)||(c&&(h==null||h()),S==null||S()))},[h,c,S]),V=Gt(function(U,L){return U===void 0&&(U={}),L===void 0&&(L=null),Zf({},U,{ref:Hd(L,C),onClick:ur(U.onClick,N),onKeyDown:ur(U.onKeyDown,A),onMouseDown:ur(U.onMouseDown,P)})},[A,P,N]);return{isOpen:l,onClose:h,headerId:b,bodyId:p,setBodyMounted:O,setHeaderMounted:_,dialogRef:M,overlayRef:C,getDialogProps:R,getDialogContainerProps:V}}function j8(a,l){Vt(()=>{if(!!a.current){var h=null;return l&&a.current&&(h=F8(a.current)),()=>{l&&(h==null||h())}}},[l,a])}function $f(a,l){if(a==null)return{};var h={},s=Object.keys(a),c,E;for(E=0;E<s.length;E++)c=s[E],!(l.indexOf(c)>=0)&&(h[c]=a[c]);return h}function Po(){return Po=Object.assign||function(a){for(var l=1;l<arguments.length;l++){var h=arguments[l];for(var s in h)Object.prototype.hasOwnProperty.call(h,s)&&(a[s]=h[s])}return a},Po.apply(this,arguments)}var[z8,Pc]=ca({strict:!0,name:"ModalContext",errorMessage:"useModalContext: `context` is undefined. Seems you forgot to wrap modal components in `<Modal />`"}),qO=a=>{var{portalProps:l,children:h,autoFocus:s,trapFocus:c,initialFocusRef:E,finalFocusRef:m,returnFocusOnClose:S,blockScrollOnMount:d,allowPinchZoom:M,preserveScrollBarGap:C,motionPreset:I,lockFocusAcrossFrames:b}=a,p=Jl("Modal",a),x=k8(a),P=Po({},x,{autoFocus:s,trapFocus:c,initialFocusRef:E,finalFocusRef:m,returnFocusOnClose:S,blockScrollOnMount:d,allowPinchZoom:M,preserveScrollBarGap:C,motionPreset:I,lockFocusAcrossFrames:b});return $e(z8,{value:P},$e(zA,{value:p},$e(qR,null,P.isOpen&&$e(Wd,l,h))))};qO.defaultProps={lockFocusAcrossFrames:!0,returnFocusOnClose:!0,scrollBehavior:"outside",trapFocus:!0,autoFocus:!0,blockScrollOnMount:!0,allowPinchZoom:!1,motionPreset:"scale"};var G8=nn(KR.div);function H8(a){var{autoFocus:l,trapFocus:h,dialogRef:s,initialFocusRef:c,blockScrollOnMount:E,allowPinchZoom:m,finalFocusRef:S,returnFocusOnClose:d,preserveScrollBarGap:M,lockFocusAcrossFrames:C}=Pc(),[I,b]=hv();return Vt(()=>{!I&&b&&setTimeout(b)},[I,b]),$e(l8,{autoFocus:l,isDisabled:!h,initialFocusRef:c,finalFocusRef:S,restoreFocus:d,contentRef:s,lockFocusAcrossFrames:C},$e(L8,{removeScrollBar:!M,allowPinchZoom:m,enabled:E,forwardProps:!0},a.children))}var vq=Dn((a,l)=>{var{className:h}=a,s=$f(a,["className","transition"]),c=ir("chakra-modal__overlay",h),E=la(),m=Po({pos:"fixed",left:"0",top:"0",w:"100vw",h:"100vh"},E.overlay),{motionPreset:S}=Pc(),d=S==="none"?{}:A6;return $e(G8,Po({},d,{__css:m,ref:l,className:c},s))}),bq=Dn((a,l)=>{var{className:h}=a,s=$f(a,["className"]),{headerId:c,setHeaderMounted:E}=Pc();Vt(()=>(E(!0),()=>E(!1)),[E]);var m=ir("chakra-modal__header",h),S=la(),d=Po({flex:0},S.header);return $e(nn.header,Po({ref:l,className:m,id:c},s,{__css:d}))}),yq=Dn((a,l)=>{var{className:h}=a,s=$f(a,["className"]),{bodyId:c,setBodyMounted:E}=Pc();Vt(()=>(E(!0),()=>E(!1)),[E]);var m=ir("chakra-modal__body",h),S=la();return $e(nn.div,Po({ref:l,className:m,id:c},s,{__css:S.body}))}),Tq=Dn((a,l)=>{var{onClick:h,className:s}=a,c=$f(a,["onClick","className"]),{onClose:E}=Pc(),m=ir("chakra-modal__close-btn",s),S=la();return $e(Q6,Po({ref:l,__css:S.closeButton,className:m,onClick:ur(h,d=>{d.stopPropagation(),E()})},c))});function es(){return es=Object.assign||function(a){for(var l=1;l<arguments.length;l++){var h=arguments[l];for(var s in h)Object.prototype.hasOwnProperty.call(h,s)&&(a[s]=h[s])}return a},es.apply(this,arguments)}function ZO(a,l){if(a==null)return{};var h={},s=Object.keys(a),c,E;for(E=0;E<s.length;E++)c=s[E],!(l.indexOf(c)>=0)&&(h[c]=a[c]);return h}var[W8,X8]=ca(),Y8={start:{ltr:"left",rtl:"right"},end:{ltr:"right",rtl:"left"}};function K8(a,l){var h,s;if(!!a)return(h=(s=Y8[a])==null?void 0:s[l])!=null?h:a}function Eq(a){var l,{isOpen:h,onClose:s,placement:c="right",children:E}=a,m=ZO(a,["isOpen","onClose","placement","children"]),S=jA(),d=(l=S.components)==null?void 0:l.Drawer,M=K8(c,S.direction);return $e(W8,{value:{placement:M}},$e(qO,es({isOpen:h,onClose:s,styleConfig:d},m),E))}var Q8=nn(R6),Sq=Dn((a,l)=>{var{className:h,children:s}=a,c=ZO(a,["className","children"]),{getDialogProps:E,getDialogContainerProps:m,isOpen:S}=Pc(),d=E(c,l),M=m(),C=ir("chakra-modal__content",h),I=la(),b=es({display:"flex",flexDirection:"column",position:"relative",width:"100%",outline:0},I.dialog),p=es({display:"flex",width:"100vw",height:"100vh",position:"fixed",left:0,top:0},I.dialogContainer),{placement:x}=X8();return $e(nn.div,es({},M,{className:"chakra-modal__content-container",__css:p}),$e(H8,null,$e(Q8,es({direction:x,in:S,className:C},d,{__css:b}),s)))});function va(){return va=Object.assign||function(a){for(var l=1;l<arguments.length;l++){var h=arguments[l];for(var s in h)Object.prototype.hasOwnProperty.call(h,s)&&(a[s]=h[s])}return a},va.apply(this,arguments)}function wb(a,l){if(a==null)return{};var h={},s=Object.keys(a),c,E;for(E=0;E<s.length;E++)c=s[E],!(l.indexOf(c)>=0)&&(h[c]=a[c]);return h}var q8=Dn((a,l)=>{var{children:h,placeholder:s,className:c}=a,E=wb(a,["children","placeholder","className"]);return $e(nn.select,va({},E,{ref:l,className:ir("chakra-select",c)}),s&&$e("option",{value:""},s),h)}),xq=Dn((a,l)=>{var h=Jl("Select",a),s=ua(a),{rootProps:c,placeholder:E,icon:m,color:S,height:d,h:M,minH:C,minHeight:I,iconColor:b,iconSize:p}=s,x=wb(s,["rootProps","placeholder","icon","color","height","h","minH","minHeight","iconColor","iconSize","isFullWidth"]),[P,A]=M2(x,cV),T=aO(A),_={width:"100%",height:"fit-content",position:"relative",color:S},g=yo({},h.field,{paddingEnd:"2rem",_focus:{zIndex:"unset"}});return $e(nn.div,va({className:"chakra-select__wrapper",__css:_},P,c),$e(q8,va({ref:l,height:M??d,minH:C??I,placeholder:E},T,{__css:g}),a.children),$e(J8,va({"data-disabled":lr(T.disabled)},(b||S)&&{color:b||S},{__css:h.icon},p&&{fontSize:p}),m))}),Z8=a=>$e("svg",va({viewBox:"0 0 24 24"},a),$e("path",{fill:"currentColor",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"})),$8=nn("div",{baseStyle:{position:"absolute",display:"inline-flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",top:"50%",transform:"translateY(-50%)"}}),J8=a=>{var{children:l=$e(Z8,null)}=a,h=wb(a,["children"]),s=ia(l,{role:"presentation",className:"chakra-select__icon",focusable:!1,"aria-hidden":!0,style:{width:"1em",height:"1em",color:"currentColor"}});return $e($8,va({},h,{className:"chakra-select__icon-wrapper"}),ra(l)?s:null)};function Co(){return Co=Object.assign||function(a){for(var l=1;l<arguments.length;l++){var h=arguments[l];for(var s in h)Object.prototype.hasOwnProperty.call(h,s)&&(a[s]=h[s])}return a},Co.apply(this,arguments)}function eK(a,l){if(a==null)return{};var h={},s=Object.keys(a),c,E;for(E=0;E<s.length;E++)c=s[E],!(l.indexOf(c)>=0)&&(h[c]=a[c]);return h}var Aq=Dn((a,l)=>{var h=Jl("Switch",a),s=ua(a),{spacing:c="0.5rem",children:E}=s,m=eK(s,["spacing","children"]),{state:S,getInputProps:d,getCheckboxProps:M,getRootProps:C,getLabelProps:I}=X6(m),b=Vn(()=>Co({display:"inline-block",verticalAlign:"middle",lineHeight:"normal"},h.container),[h.container]),p=Vn(()=>Co({display:"inline-flex",flexShrink:0,justifyContent:"flex-start",boxSizing:"content-box",cursor:"pointer"},h.track),[h.track]),x=Vn(()=>Co({userSelect:"none",marginStart:c},h.label),[c,h.label]);return $e(nn.label,Co({},C(),{className:ir("chakra-switch",a.className),__css:b}),$e("input",Co({className:"chakra-switch__input"},d({},l))),$e(nn.span,Co({},M(),{className:"chakra-switch__track",__css:p}),$e(nn.span,{__css:h.thumb,className:"chakra-switch__thumb","data-checked":lr(S.isChecked),"data-hover":lr(S.isHovered)})),E&&$e(nn.span,Co({className:"chakra-switch__label"},I(),{__css:x}),E))});function tK(a,l,h){return l in a?Object.defineProperty(a,l,{value:h,enumerable:!0,configurable:!0,writable:!0}):a[l]=h,a}function $O(a,l){var h=Object.keys(a);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(a);l&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(a,c).enumerable})),h.push.apply(h,s)}return h}function JO(a){for(var l=1;l<arguments.length;l++){var h=arguments[l]!=null?arguments[l]:{};l%2?$O(Object(h),!0).forEach(function(s){tK(a,s,h[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(h)):$O(Object(h)).forEach(function(s){Object.defineProperty(a,s,Object.getOwnPropertyDescriptor(h,s))})}return a}function nK(a,l){return rK(a)||iK(a,l)||oK(a,l)||aK()}function rK(a){if(Array.isArray(a))return a}function iK(a,l){if(!(typeof Symbol=="undefined"||!(Symbol.iterator in Object(a)))){var h=[],s=!0,c=!1,E=void 0;try{for(var m=a[Symbol.iterator](),S;!(s=(S=m.next()).done)&&(h.push(S.value),!(l&&h.length===l));s=!0);}catch(d){c=!0,E=d}finally{try{!s&&m.return!=null&&m.return()}finally{if(c)throw E}}return h}}function oK(a,l){if(!!a){if(typeof a=="string")return eM(a,l);var h=Object.prototype.toString.call(a).slice(8,-1);if(h==="Object"&&a.constructor&&(h=a.constructor.name),h==="Map"||h==="Set")return Array.from(a);if(h==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(h))return eM(a,l)}}function eM(a,l){(l==null||l>a.length)&&(l=a.length);for(var h=0,s=new Array(l);h<l;h++)s[h]=a[h];return s}function aK(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function sK(a,l,h){return l in a?Object.defineProperty(a,l,{value:h,enumerable:!0,configurable:!0,writable:!0}):a[l]=h,a}function tM(a,l){var h=Object.keys(a);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(a);l&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(a,c).enumerable})),h.push.apply(h,s)}return h}function nM(a){for(var l=1;l<arguments.length;l++){var h=arguments[l]!=null?arguments[l]:{};l%2?tM(Object(h),!0).forEach(function(s){sK(a,s,h[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(h)):tM(Object(h)).forEach(function(s){Object.defineProperty(a,s,Object.getOwnPropertyDescriptor(h,s))})}return a}function cK(){for(var a=arguments.length,l=new Array(a),h=0;h<a;h++)l[h]=arguments[h];return function(s){return l.reduceRight(function(c,E){return E(c)},s)}}function Nu(a){return function l(){for(var h=this,s=arguments.length,c=new Array(s),E=0;E<s;E++)c[E]=arguments[E];return c.length>=a.length?a.apply(this,c):function(){for(var m=arguments.length,S=new Array(m),d=0;d<m;d++)S[d]=arguments[d];return l.apply(h,[].concat(c,S))}}}function Jf(a){return{}.toString.call(a).includes("Object")}function lK(a){return!Object.keys(a).length}function Fu(a){return typeof a=="function"}function uK(a,l){return Object.prototype.hasOwnProperty.call(a,l)}function hK(a,l){return Jf(l)||ba("changeType"),Object.keys(l).some(function(h){return!uK(a,h)})&&ba("changeField"),l}function dK(a){Fu(a)||ba("selectorType")}function fK(a){Fu(a)||Jf(a)||ba("handlerType"),Jf(a)&&Object.values(a).some(function(l){return!Fu(l)})&&ba("handlersType")}function pK(a){a||ba("initialIsRequired"),Jf(a)||ba("initialType"),lK(a)&&ba("initialContent")}function mK(a,l){throw new Error(a[l]||a.default)}var _K={initialIsRequired:"initial state is required",initialType:"initial state should be an object",initialContent:"initial state shouldn't be an empty object",handlerType:"handler should be an object or a function",handlersType:"all handlers should be a functions",selectorType:"selector should be a function",changeType:"provided value of changes should be an object",changeField:'it seams you want to change a field in the state which is not specified in the "initial" state',default:"an unknown error accured in `state-local` package"},ba=Nu(mK)(_K),ep={changes:hK,selector:dK,handler:fK,initial:pK};function gK(a){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};ep.initial(a),ep.handler(l);var h={current:a},s=Nu(yK)(h,l),c=Nu(bK)(h),E=Nu(ep.changes)(a),m=Nu(vK)(h);function S(){var M=arguments.length>0&&arguments[0]!==void 0?arguments[0]:function(C){return C};return ep.selector(M),M(h.current)}function d(M){cK(s,c,E,m)(M)}return[S,d]}function vK(a,l){return Fu(l)?l(a.current):l}function bK(a,l){return a.current=nM(nM({},a.current),l),l}function yK(a,l,h){return Fu(l)?l(a.current):Object.keys(h).forEach(function(s){var c;return(c=l[s])===null||c===void 0?void 0:c.call(l,a.current[s])}),h}var TK={create:gK},EK={paths:{vs:"https://cdn.jsdelivr.net/npm/monaco-editor@0.28.1/min/vs"}};function SK(a){return function l(){for(var h=this,s=arguments.length,c=new Array(s),E=0;E<s;E++)c[E]=arguments[E];return c.length>=a.length?a.apply(this,c):function(){for(var m=arguments.length,S=new Array(m),d=0;d<m;d++)S[d]=arguments[d];return l.apply(h,[].concat(c,S))}}}function xK(a){return{}.toString.call(a).includes("Object")}function AK(a){return a||iM("configIsRequired"),xK(a)||iM("configType"),a.urls?(PK(),{paths:{vs:a.urls.monacoBase}}):a}function PK(){console.warn(rM.deprecation)}function CK(a,l){throw new Error(a[l]||a.default)}var rM={configIsRequired:"the configuration object is required",configType:"the configuration object should be an object",default:"an unknown error accured in `@monaco-editor/loader` package",deprecation:`Deprecation warning!
    You are using deprecated way of configuration.

    Instead of using
      monaco.config({ urls: { monacoBase: '...' } })
    use
      monaco.config({ paths: { vs: '...' } })

    For more please check the link https://github.com/suren-atoyan/monaco-loader#config
  `},iM=SK(CK)(rM),RK={config:AK},OK=function(){for(var l=arguments.length,h=new Array(l),s=0;s<l;s++)h[s]=arguments[s];return function(c){return h.reduceRight(function(E,m){return m(E)},c)}};function oM(a,l){return Object.keys(l).forEach(function(h){l[h]instanceof Object&&a[h]&&Object.assign(l[h],oM(a[h],l[h]))}),JO(JO({},a),l)}var MK={type:"cancelation",msg:"operation is manually canceled"};function aM(a){var l=!1,h=new Promise(function(s,c){a.then(function(E){return l?c(MK):s(E)}),a.catch(c)});return h.cancel=function(){return l=!0},h}var IK=TK.create({config:EK,isInitialized:!1,resolve:null,reject:null,monaco:null}),sM=nK(IK,2),Bu=sM[0],tp=sM[1];function DK(a){tp(function(l){return{config:oM(l.config,RK.config(a))}})}function wK(){var a=Bu(function(l){var h=l.isInitialized;return{isInitialized:h}});if(!a.isInitialized){if(window.monaco&&window.monaco.editor)return cM(window.monaco),aM(Promise.resolve(window.monaco));OK(LK,FK)(BK),tp({isInitialized:!0})}return aM(VK)}function LK(a){return document.body.appendChild(a)}function NK(a){var l=document.createElement("script");return a&&(l.src=a),l}function FK(a){var l=Bu(function(s){var c=s.config,E=s.reject;return{config:c,reject:E}}),h=NK("".concat(l.config.paths.vs,"/loader.js"));return h.onload=function(){return a()},h.onerror=l.reject,h}function BK(){var a=Bu(function(h){var s=h.config,c=h.resolve,E=h.reject;return{config:s,resolve:c,reject:E}}),l=window.require;l.config(a.config),l(["vs/editor/editor.main"],function(h){cM(h),a.resolve(h)},function(h){a.reject(h)})}function cM(a){Bu().monaco||tp({monaco:a})}function UK(){return Bu(function(a){var l=a.monaco;return l})}var VK=new Promise(function(a,l){return tp({resolve:a,reject:l})}),kK={config:DK,init:wK,__getMonacoInstance:UK};function Lb(){return Lb=Object.assign||function(a){for(var l=1;l<arguments.length;l++){var h=arguments[l];for(var s in h)Object.prototype.hasOwnProperty.call(h,s)&&(a[s]=h[s])}return a},Lb.apply(this,arguments)}const jK={display:"flex",height:"100%",width:"100%",justifyContent:"center",alignItems:"center"};function zK({content:a}){return ei.createElement("div",{style:jK},a)}const Nb={wrapper:{display:"flex",position:"relative",textAlign:"initial"},fullWidth:{width:"100%"},hide:{display:"none"}};function lM({width:a,height:l,isEditorReady:h,loading:s,_ref:c,className:E,wrapperProps:m}){return ei.createElement("section",Lb({style:{...Nb.wrapper,width:a,height:l}},m),!h&&ei.createElement(zK,{content:s}),ei.createElement("div",{ref:c,style:{...Nb.fullWidth,...!h&&Nb.hide},className:E}))}lM.propTypes={width:Ct.oneOfType([Ct.number,Ct.string]).isRequired,height:Ct.oneOfType([Ct.number,Ct.string]).isRequired,loading:Ct.oneOfType([Ct.element,Ct.string]).isRequired,isEditorReady:Ct.bool.isRequired,className:Ct.string,wrapperProps:Ct.object};var GK=Ll(lM);function HK(a){Vt(a,[])}function Cc(a,l,h=!0){const s=zt(!0);Vt(s.current||!h?()=>{s.current=!1}:a,l)}function Fb(){}function uM(a,l,h,s){return WK(a,s)||XK(a,l,h,s)}function WK(a,l){return a.editor.getModel(hM(a,l))}function XK(a,l,h,s){return a.editor.createModel(l,h,s&&hM(a,s))}function hM(a,l){return a.Uri.parse(l)}function YK(a){return a===void 0}Ct.string,Ct.string,Ct.string,Ct.string,Ct.string,Ct.string,Ct.string,Ct.bool,Ct.bool,Ct.string,Ct.oneOfType([Ct.element,Ct.string]),Ct.object,Ct.oneOfType([Ct.number,Ct.string]),Ct.oneOfType([Ct.number,Ct.string]),Ct.string,Ct.object,Ct.func,Ct.func;function KK(a){const l=zt();return Vt(()=>{l.current=a},[a]),l.current}const np=new Map;function Bb({defaultValue:a,defaultLanguage:l,defaultPath:h,value:s,language:c,path:E,theme:m,line:S,loading:d,options:M,overrideServices:C,saveViewState:I,keepCurrentModel:b,width:p,height:x,className:P,wrapperProps:A,beforeMount:T,onMount:_,onChange:g,onValidate:O}){const[R,N]=un(!1),[V,U]=un(!0),L=zt(null),j=zt(null),Y=zt(null),W=zt(_),re=zt(T),ne=zt(null),ge=zt(s),_e=KK(E);HK(()=>{const Z=kK.init();return Z.then(te=>(L.current=te)&&U(!1)).catch(te=>(te==null?void 0:te.type)!=="cancelation"&&console.error("Monaco initialization: error:",te)),()=>j.current?ie():Z.cancel()}),Cc(()=>{const Z=uM(L.current,a||s,l||c,E);Z!==j.current.getModel()&&(I&&np.set(_e,j.current.saveViewState()),j.current.setModel(Z),I&&j.current.restoreViewState(np.get(E)))},[E],R),Cc(()=>{j.current.updateOptions(M)},[M],R),Cc(()=>{j.current.getOption(L.current.editor.EditorOption.readOnly)?j.current.setValue(s):s!==j.current.getValue()&&(j.current.executeEdits("",[{range:j.current.getModel().getFullModelRange(),text:s,forceMoveMarkers:!0}]),j.current.pushUndoStop())},[s],R),Cc(()=>{L.current.editor.setModelLanguage(j.current.getModel(),c)},[c],R),Cc(()=>{YK(S)||j.current.revealLine(S)},[S],R),Cc(()=>{L.current.editor.setTheme(m)},[m],R);const ce=Gt(()=>{re.current(L.current);const Z=E||h,te=uM(L.current,s||a,l||c,Z);j.current=L.current.editor.create(Y.current,{model:te,automaticLayout:!0,...M},C),I&&j.current.restoreViewState(np.get(Z)),L.current.editor.setTheme(m),N(!0)},[a,l,h,s,c,E,M,C,I,m]);Vt(()=>{R&&W.current(j.current,L.current)},[R]),Vt(()=>{!V&&!R&&ce()},[V,R,ce]),ge.current=s,Vt(()=>{if(R&&g){var Z,te;(Z=ne.current)===null||Z===void 0||Z.dispose(),ne.current=(te=j.current)===null||te===void 0?void 0:te.onDidChangeModelContent(B=>{const G=j.current.getValue();ge.current!==G&&g(G,B)})}},[R,g]),Vt(()=>{if(R){const Z=L.current.editor.onDidChangeMarkers(te=>{var B;const G=(B=j.current.getModel())===null||B===void 0?void 0:B.uri;if(G&&te.find(le=>le.path===G.path)){const le=L.current.editor.getModelMarkers({resource:G});O==null||O(le)}});return()=>{Z==null||Z.dispose()}}},[R,O]);function ie(){var Z;if((Z=ne.current)===null||Z===void 0||Z.dispose(),b)I&&np.set(E,j.current.saveViewState());else{var te;(te=j.current.getModel())===null||te===void 0||te.dispose()}j.current.dispose()}return ei.createElement(GK,{width:p,height:x,isEditorReady:R,loading:d,_ref:Y,className:P,wrapperProps:A})}Bb.propTypes={defaultValue:Ct.string,defaultPath:Ct.string,defaultLanguage:Ct.string,value:Ct.string,language:Ct.string,path:Ct.string,theme:Ct.string,line:Ct.number,loading:Ct.oneOfType([Ct.element,Ct.string]),options:Ct.object,overrideServices:Ct.object,saveViewState:Ct.bool,keepCurrentModel:Ct.bool,width:Ct.oneOfType([Ct.number,Ct.string]),height:Ct.oneOfType([Ct.number,Ct.string]),className:Ct.string,wrapperProps:Ct.object,beforeMount:Ct.func,onMount:Ct.func,onChange:Ct.func,onValidate:Ct.func};Bb.defaultProps={theme:"light",loading:"Loading...",options:{},overrideServices:{},saveViewState:!0,keepCurrentModel:!1,width:"100%",height:"100%",wrapperProps:{},beforeMount:Fb,onMount:Fb,onValidate:Fb};var Pq=Ll(Bb),Cq=cu({viewBox:"0 0 14 14",d:"M14,7.77 L14,6.17 L12.06,5.53 L11.61,4.44 L12.49,2.6 L11.36,1.47 L9.55,2.38 L8.46,1.93 L7.77,0.01 L6.17,0.01 L5.54,1.95 L4.43,2.4 L2.59,1.52 L1.46,2.65 L2.37,4.46 L1.92,5.55 L0,6.23 L0,7.82 L1.94,8.46 L2.39,9.55 L1.51,11.39 L2.64,12.52 L4.45,11.61 L5.54,12.06 L6.23,13.98 L7.82,13.98 L8.45,12.04 L9.56,11.59 L11.4,12.47 L12.53,11.34 L11.61,9.53 L12.08,8.44 L14,7.75 L14,7.77 Z M7,10 C5.34,10 4,8.66 4,7 C4,5.34 5.34,4 7,4 C8.66,4 10,5.34 10,7 C10,8.66 8.66,10 7,10 Z",displayName:"SettingsIcon"}),Rq=cu({displayName:"EditIcon",path:$e("g",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeWidth:"2"},$e("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),$e("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"}))}),Oq=cu({displayName:"CloseIcon",d:"M.439,21.44a1.5,1.5,0,0,0,2.122,2.121L11.823,14.3a.25.25,0,0,1,.354,0l9.262,9.263a1.5,1.5,0,1,0,2.122-2.121L14.3,12.177a.25.25,0,0,1,0-.354l9.263-9.262A1.5,1.5,0,0,0,21.439.44L12.177,9.7a.25.25,0,0,1-.354,0L2.561.44A1.5,1.5,0,0,0,.439,2.561L9.7,11.823a.25.25,0,0,1,0,.354Z"}),Mq=cu({d:"M12,0A12,12,0,1,0,24,12,12.013,12.013,0,0,0,12,0Zm0,19a1.5,1.5,0,1,1,1.5-1.5A1.5,1.5,0,0,1,12,19Zm1.6-6.08a1,1,0,0,0-.6.917,1,1,0,1,1-2,0,3,3,0,0,1,1.8-2.75A2,2,0,1,0,10,9.255a1,1,0,1,1-2,0,4,4,0,1,1,5.6,3.666Z",displayName:"QuestionIcon"}),Iq=cu({viewBox:"0 0 14 14",path:$e("g",{fill:"currentColor"},$e("polygon",{points:"5.5 11.9993304 14 3.49933039 12.5 2 5.5 8.99933039 1.5 4.9968652 0 6.49933039"}))});function QK(a){let l;const h=new Set,s=(M,C)=>{const I=typeof M=="function"?M(l):M;if(I!==l){const b=l;l=C?I:Object.assign({},l,I),h.forEach(p=>p(l,b))}},c=()=>l,E=(M,C=c,I=Object.is)=>{let b=C(l);function p(){const x=C(l);if(!I(b,x)){const P=b;M(b=x,P)}}return h.add(p),()=>h.delete(p)},d={setState:s,getState:c,subscribe:(M,C,I)=>C||I?E(M,C,I):(h.add(M),()=>h.delete(M)),destroy:()=>h.clear()};return l=a(s,c,d),d}const qK=typeof window=="undefined"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),dM=qK?Vt:na;function Dq(a){const l=typeof a=="function"?QK(a):a,h=(s=l.getState,c=Object.is)=>{const[,E]=ad(P=>P+1,0),m=l.getState(),S=zt(m),d=zt(s),M=zt(c),C=zt(!1),I=zt();I.current===void 0&&(I.current=s(m));let b,p=!1;(S.current!==m||d.current!==s||M.current!==c||C.current)&&(b=s(m),p=!c(I.current,b)),dM(()=>{p&&(I.current=b),S.current=m,d.current=s,M.current=c,C.current=!1});const x=zt(m);return dM(()=>{const P=()=>{try{const T=l.getState(),_=d.current(T);M.current(I.current,_)||(S.current=T,I.current=_,E())}catch(T){C.current=!0,E()}},A=l.subscribe(P);return l.getState()!==x.current&&P(),A},[]),p?b:I.current};return Object.assign(h,l),h[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const s=[h,l];return{next(){const c=s.length<=0;return{value:s.shift(),done:c}}}},h}var ZK={},Ub={},Xn=rx(gF),Yn=rx(x2),jn={},Bi={};Object.defineProperty(Bi,"__esModule",{value:!0});Bi.heightWidthRadiusDefaults=Bi.heightWidthDefaults=Bi.sizeMarginDefaults=Bi.sizeDefaults=void 0;var fM={loading:!0,color:"#000000",css:"",speedMultiplier:1};function pM(a){return Object.assign({},fM,{size:a})}Bi.sizeDefaults=pM;function $K(a){return Object.assign({},pM(a),{margin:2})}Bi.sizeMarginDefaults=$K;function mM(a,l){return Object.assign({},fM,{height:a,width:l})}Bi.heightWidthDefaults=mM;function JK(a,l,h){return h===void 0&&(h=2),Object.assign({},mM(a,l),{radius:h,margin:2})}Bi.heightWidthRadiusDefaults=JK;var rp={};Object.defineProperty(rp,"__esModule",{value:!0});rp.calculateRgba=void 0;var ip;(function(a){a.maroon="#800000",a.red="#FF0000",a.orange="#FFA500",a.yellow="#FFFF00",a.olive="#808000",a.green="#008000",a.purple="#800080",a.fuchsia="#FF00FF",a.lime="#00FF00",a.teal="#008080",a.aqua="#00FFFF",a.blue="#0000FF",a.navy="#000080",a.black="#000000",a.gray="#808080",a.silver="#C0C0C0",a.white="#FFFFFF"})(ip||(ip={}));var e7=function(a,l){if(Object.keys(ip).includes(a)&&(a=ip[a]),a[0]==="#"&&(a=a.slice(1)),a.length===3){var h="";a.split("").forEach(function(c){h+=c,h+=c}),a=h}var s=(a.match(/.{2}/g)||[]).map(function(c){return parseInt(c,16)}).join(", ");return"rgba("+s+", "+l+")"};rp.calculateRgba=e7;var Rc={};Object.defineProperty(Rc,"__esModule",{value:!0});Rc.cssValue=Rc.parseLengthAndUnit=void 0;var t7={cm:!0,mm:!0,in:!0,px:!0,pt:!0,pc:!0,em:!0,ex:!0,ch:!0,rem:!0,vw:!0,vh:!0,vmin:!0,vmax:!0,"%":!0};function _M(a){if(typeof a=="number")return{value:a,unit:"px"};var l,h=(a.match(/^[0-9.]*/)||"").toString();h.includes(".")?l=parseFloat(h):l=parseInt(h,10);var s=(a.match(/[^0-9]*$/)||"").toString();return t7[s]?{value:l,unit:s}:(console.warn("React Spinners: "+a+" is not a valid css value. Defaulting to "+l+"px."),{value:l,unit:"px"})}Rc.parseLengthAndUnit=_M;function n7(a){var l=_M(a);return""+l.value+l.unit}Rc.cssValue=n7;(function(a){var l=Fe&&Fe.__createBinding||(Object.create?function(s,c,E,m){m===void 0&&(m=E),Object.defineProperty(s,m,{enumerable:!0,get:function(){return c[E]}})}:function(s,c,E,m){m===void 0&&(m=E),s[m]=c[E]}),h=Fe&&Fe.__exportStar||function(s,c){for(var E in s)E!=="default"&&!Object.prototype.hasOwnProperty.call(c,E)&&l(c,s,E)};Object.defineProperty(a,"__esModule",{value:!0}),h(Bi,a),h(rp,a),h(Rc,a)})(jn);var op=Fe&&Fe.__makeTemplateObject||function(a,l){return Object.defineProperty?Object.defineProperty(a,"raw",{value:l}):a.raw=l,a},r7=Fe&&Fe.__extends||function(){var a=function(l,h){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var E in c)Object.prototype.hasOwnProperty.call(c,E)&&(s[E]=c[E])},a(l,h)};return function(l,h){a(l,h);function s(){this.constructor=l}l.prototype=h===null?Object.create(h):(s.prototype=h.prototype,new s)}}(),i7=Fe&&Fe.__createBinding||(Object.create?function(a,l,h,s){s===void 0&&(s=h),Object.defineProperty(a,s,{enumerable:!0,get:function(){return l[h]}})}:function(a,l,h,s){s===void 0&&(s=h),a[s]=l[h]}),o7=Fe&&Fe.__setModuleDefault||(Object.create?function(a,l){Object.defineProperty(a,"default",{enumerable:!0,value:l})}:function(a,l){a.default=l}),a7=Fe&&Fe.__importStar||function(a){if(a&&a.__esModule)return a;var l={};if(a!=null)for(var h in a)h!=="default"&&Object.prototype.hasOwnProperty.call(a,h)&&i7(l,a,h);return o7(l,a),l};Object.defineProperty(Ub,"__esModule",{value:!0});var s7=a7(Xn),ts=Yn,Uu=jn,c7=ts.keyframes(gM||(gM=op([`
  0% {left: -35%;right: 100%}
  60% {left: 100%;right: -90%}
  100% {left: 100%;right: -90%}
`],[`
  0% {left: -35%;right: 100%}
  60% {left: 100%;right: -90%}
  100% {left: 100%;right: -90%}
`]))),l7=ts.keyframes(vM||(vM=op([`
  0% {left: -200%;right: 100%}
  60% {left: 107%;right: -8%}
  100% {left: 107%;right: -8%}
`],[`
  0% {left: -200%;right: 100%}
  60% {left: 107%;right: -8%}
  100% {left: 107%;right: -8%}
`]))),u7=function(a){r7(l,a);function l(){var h=a!==null&&a.apply(this,arguments)||this;return h.style=function(s){var c=h.props,E=c.height,m=c.color,S=c.speedMultiplier;return ts.css(bM||(bM=op([`
      position: absolute;
      height: `,`;
      overflow: hidden;
      background-color: `,`;
      background-clip: padding-box;
      display: block;
      border-radius: 2px;
      will-change: left, right;
      animation-fill-mode: forwards;
      animation: `," ",`s
        `,`
        `,`
        infinite;
    `],[`
      position: absolute;
      height: `,`;
      overflow: hidden;
      background-color: `,`;
      background-clip: padding-box;
      display: block;
      border-radius: 2px;
      will-change: left, right;
      animation-fill-mode: forwards;
      animation: `," ",`s
        `,`
        `,`
        infinite;
    `])),Uu.cssValue(E),m,s===1?c7:l7,2.1/S,s===2?1.15/S+"s":"",s===1?"cubic-bezier(0.65, 0.815, 0.735, 0.395)":"cubic-bezier(0.165, 0.84, 0.44, 1)")},h.wrapper=function(){var s=h.props,c=s.width,E=s.height,m=s.color;return ts.css(yM||(yM=op([`
      position: relative;
      width: `,`;
      height: `,`;
      overflow: hidden;
      background-color: `,`;
      background-clip: padding-box;
    `],[`
      position: relative;
      width: `,`;
      height: `,`;
      overflow: hidden;
      background-color: `,`;
      background-clip: padding-box;
    `])),Uu.cssValue(c),Uu.cssValue(E),Uu.calculateRgba(m,.2))},h}return l.prototype.render=function(){var h=this.props,s=h.loading,c=h.css;return s?ts.jsx("span",{css:[this.wrapper(),c]},ts.jsx("span",{css:this.style(1)}),ts.jsx("span",{css:this.style(2)})):null},l.defaultProps=Uu.heightWidthDefaults(4,100),l}(s7.PureComponent);Ub.default=u7;var gM,vM,bM,yM,Vb={},TM=Fe&&Fe.__makeTemplateObject||function(a,l){return Object.defineProperty?Object.defineProperty(a,"raw",{value:l}):a.raw=l,a},h7=Fe&&Fe.__extends||function(){var a=function(l,h){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var E in c)Object.prototype.hasOwnProperty.call(c,E)&&(s[E]=c[E])},a(l,h)};return function(l,h){a(l,h);function s(){this.constructor=l}l.prototype=h===null?Object.create(h):(s.prototype=h.prototype,new s)}}(),d7=Fe&&Fe.__createBinding||(Object.create?function(a,l,h,s){s===void 0&&(s=h),Object.defineProperty(a,s,{enumerable:!0,get:function(){return l[h]}})}:function(a,l,h,s){s===void 0&&(s=h),a[s]=l[h]}),f7=Fe&&Fe.__setModuleDefault||(Object.create?function(a,l){Object.defineProperty(a,"default",{enumerable:!0,value:l})}:function(a,l){a.default=l}),p7=Fe&&Fe.__importStar||function(a){if(a&&a.__esModule)return a;var l={};if(a!=null)for(var h in a)h!=="default"&&Object.prototype.hasOwnProperty.call(a,h)&&d7(l,a,h);return f7(l,a),l};Object.defineProperty(Vb,"__esModule",{value:!0});var m7=p7(Xn),Oc=Yn,ap=jn,_7=Oc.keyframes(EM||(EM=TM([`
  50% {transform: scale(0.75);opacity: 0.2}
  100% {transform: scale(1);opacity: 1}
`],[`
  50% {transform: scale(0.75);opacity: 0.2}
  100% {transform: scale(1);opacity: 1}
`]))),g7=function(a){h7(l,a);function l(){var h=a!==null&&a.apply(this,arguments)||this;return h.style=function(s){var c=h.props,E=c.color,m=c.size,S=c.margin,d=c.speedMultiplier;return Oc.css(SM||(SM=TM([`
      display: inline-block;
      background-color: `,`;
      width: `,`;
      height: `,`;
      margin: `,`;
      border-radius: 100%;
      animation: `," ","s ",`
        infinite linear;
      animation-fill-mode: both;
    `],[`
      display: inline-block;
      background-color: `,`;
      width: `,`;
      height: `,`;
      margin: `,`;
      border-radius: 100%;
      animation: `," ","s ",`
        infinite linear;
      animation-fill-mode: both;
    `])),E,ap.cssValue(m),ap.cssValue(m),ap.cssValue(S),_7,.7/d,s%2?"0s":.35/d+"s")},h}return l.prototype.render=function(){var h=this.props,s=h.loading,c=h.css;return s?Oc.jsx("span",{css:[c]},Oc.jsx("span",{css:this.style(1)}),Oc.jsx("span",{css:this.style(2)}),Oc.jsx("span",{css:this.style(3)})):null},l.defaultProps=ap.sizeMarginDefaults(15),l}(m7.PureComponent);Vb.default=g7;var EM,SM,kb={},jb=Fe&&Fe.__makeTemplateObject||function(a,l){return Object.defineProperty?Object.defineProperty(a,"raw",{value:l}):a.raw=l,a},v7=Fe&&Fe.__extends||function(){var a=function(l,h){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var E in c)Object.prototype.hasOwnProperty.call(c,E)&&(s[E]=c[E])},a(l,h)};return function(l,h){a(l,h);function s(){this.constructor=l}l.prototype=h===null?Object.create(h):(s.prototype=h.prototype,new s)}}(),b7=Fe&&Fe.__createBinding||(Object.create?function(a,l,h,s){s===void 0&&(s=h),Object.defineProperty(a,s,{enumerable:!0,get:function(){return l[h]}})}:function(a,l,h,s){s===void 0&&(s=h),a[s]=l[h]}),y7=Fe&&Fe.__setModuleDefault||(Object.create?function(a,l){Object.defineProperty(a,"default",{enumerable:!0,value:l})}:function(a,l){a.default=l}),T7=Fe&&Fe.__importStar||function(a){if(a&&a.__esModule)return a;var l={};if(a!=null)for(var h in a)h!=="default"&&Object.prototype.hasOwnProperty.call(a,h)&&b7(l,a,h);return y7(l,a),l};Object.defineProperty(kb,"__esModule",{value:!0});var E7=T7(Xn),Mc=Yn,Vu=jn,S7=Mc.keyframes(xM||(xM=jb([`
  0%, 100% {transform: scale(0)}
  50% {transform: scale(1.0)}
`],[`
  0%, 100% {transform: scale(0)}
  50% {transform: scale(1.0)}
`]))),x7=function(a){v7(l,a);function l(){var h=a!==null&&a.apply(this,arguments)||this;return h.style=function(s){var c=h.props,E=c.color,m=c.size,S=c.speedMultiplier;return Mc.css(AM||(AM=jb([`
      position: absolute;
      height: `,`;
      width: `,`;
      background-color: `,`;
      border-radius: 100%;
      opacity: 0.6;
      top: 0;
      left: 0;
      animation-fill-mode: both;
      animation: `," ","s ",`
        infinite ease-in-out;
    `],[`
      position: absolute;
      height: `,`;
      width: `,`;
      background-color: `,`;
      border-radius: 100%;
      opacity: 0.6;
      top: 0;
      left: 0;
      animation-fill-mode: both;
      animation: `," ","s ",`
        infinite ease-in-out;
    `])),Vu.cssValue(m),Vu.cssValue(m),E,S7,2.1/S,s===1?1/S+"s":"0s")},h.wrapper=function(){var s=h.props.size;return Mc.css(PM||(PM=jb([`
      position: relative;
      width: `,`;
      height: `,`;
    `],[`
      position: relative;
      width: `,`;
      height: `,`;
    `])),Vu.cssValue(s),Vu.cssValue(s))},h}return l.prototype.render=function(){var h=this.props,s=h.loading,c=h.css;return s?Mc.jsx("span",{css:[this.wrapper(),c]},Mc.jsx("span",{css:this.style(1)}),Mc.jsx("span",{css:this.style(2)})):null},l.defaultProps=Vu.sizeDefaults(60),l}(E7.PureComponent);kb.default=x7;var xM,AM,PM,zb={},Gb=Fe&&Fe.__makeTemplateObject||function(a,l){return Object.defineProperty?Object.defineProperty(a,"raw",{value:l}):a.raw=l,a},A7=Fe&&Fe.__extends||function(){var a=function(l,h){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var E in c)Object.prototype.hasOwnProperty.call(c,E)&&(s[E]=c[E])},a(l,h)};return function(l,h){a(l,h);function s(){this.constructor=l}l.prototype=h===null?Object.create(h):(s.prototype=h.prototype,new s)}}(),P7=Fe&&Fe.__createBinding||(Object.create?function(a,l,h,s){s===void 0&&(s=h),Object.defineProperty(a,s,{enumerable:!0,get:function(){return l[h]}})}:function(a,l,h,s){s===void 0&&(s=h),a[s]=l[h]}),C7=Fe&&Fe.__setModuleDefault||(Object.create?function(a,l){Object.defineProperty(a,"default",{enumerable:!0,value:l})}:function(a,l){a.default=l}),R7=Fe&&Fe.__importStar||function(a){if(a&&a.__esModule)return a;var l={};if(a!=null)for(var h in a)h!=="default"&&Object.prototype.hasOwnProperty.call(a,h)&&P7(l,a,h);return C7(l,a),l};Object.defineProperty(zb,"__esModule",{value:!0});var O7=R7(Xn),Ro=Yn,sp=jn,M7=Ro.keyframes(CM||(CM=Gb([`
  0% {transform: rotate(0deg)}
  50% {transform: rotate(180deg)}
  100% {transform: rotate(360deg)}
`],[`
  0% {transform: rotate(0deg)}
  50% {transform: rotate(180deg)}
  100% {transform: rotate(360deg)}
`]))),I7=function(a){A7(l,a);function l(){var h=a!==null&&a.apply(this,arguments)||this;return h.style=function(s){var c=h.props,E=c.size,m=c.color,S=c.speedMultiplier,d=sp.parseLengthAndUnit(E),M=d.value,C=d.unit;return Ro.css(RM||(RM=Gb([`
      position: absolute;
      height: `,`;
      width: `,`;
      border: 1px solid `,`;
      border-radius: 100%;
      transition: 2s;
      border-bottom: none;
      border-right: none;
      top: `,`%;
      left: `,`%;
      animation-fill-mode: "";
      animation: `," ","s ",`s infinite linear;
    `],[`
      position: absolute;
      height: `,`;
      width: `,`;
      border: 1px solid `,`;
      border-radius: 100%;
      transition: 2s;
      border-bottom: none;
      border-right: none;
      top: `,`%;
      left: `,`%;
      animation-fill-mode: "";
      animation: `," ","s ",`s infinite linear;
    `])),""+M*(1-s/10)+C,""+M*(1-s/10)+C,m,s*.7*2.5,s*.35*2.5,M7,1/S,s*.2/S)},h.wrapper=function(){var s=h.props.size;return Ro.css(OM||(OM=Gb([`
      position: relative;
      width: `,`;
      height: `,`;
    `],[`
      position: relative;
      width: `,`;
      height: `,`;
    `])),sp.cssValue(s),sp.cssValue(s))},h}return l.prototype.render=function(){var h=this.props,s=h.loading,c=h.css;return s?Ro.jsx("span",{css:[this.wrapper(),c]},Ro.jsx("span",{css:this.style(0)}),Ro.jsx("span",{css:this.style(1)}),Ro.jsx("span",{css:this.style(2)}),Ro.jsx("span",{css:this.style(3)}),Ro.jsx("span",{css:this.style(4)})):null},l.defaultProps=sp.sizeDefaults(50),l}(O7.PureComponent);zb.default=I7;var CM,RM,OM,Hb={},ku=Fe&&Fe.__makeTemplateObject||function(a,l){return Object.defineProperty?Object.defineProperty(a,"raw",{value:l}):a.raw=l,a},D7=Fe&&Fe.__extends||function(){var a=function(l,h){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var E in c)Object.prototype.hasOwnProperty.call(c,E)&&(s[E]=c[E])},a(l,h)};return function(l,h){a(l,h);function s(){this.constructor=l}l.prototype=h===null?Object.create(h):(s.prototype=h.prototype,new s)}}(),w7=Fe&&Fe.__createBinding||(Object.create?function(a,l,h,s){s===void 0&&(s=h),Object.defineProperty(a,s,{enumerable:!0,get:function(){return l[h]}})}:function(a,l,h,s){s===void 0&&(s=h),a[s]=l[h]}),L7=Fe&&Fe.__setModuleDefault||(Object.create?function(a,l){Object.defineProperty(a,"default",{enumerable:!0,value:l})}:function(a,l){a.default=l}),N7=Fe&&Fe.__importStar||function(a){if(a&&a.__esModule)return a;var l={};if(a!=null)for(var h in a)h!=="default"&&Object.prototype.hasOwnProperty.call(a,h)&&w7(l,a,h);return L7(l,a),l};Object.defineProperty(Hb,"__esModule",{value:!0});var F7=N7(Xn),Oo=Yn,MM=jn,B7=Oo.keyframes(IM||(IM=ku([`
  0% {transform:translate(0, -1em) rotate(-45deg)}
  5% {transform:translate(0, -1em) rotate(-50deg)}
  20% {transform:translate(1em, -2em) rotate(47deg)}
  25% {transform:translate(1em, -2em) rotate(45deg)}
  30% {transform:translate(1em, -2em) rotate(40deg)}
  45% {transform:translate(2em, -3em) rotate(137deg)}
  50% {transform:translate(2em, -3em) rotate(135deg)}
  55% {transform:translate(2em, -3em) rotate(130deg)}
  70% {transform:translate(3em, -4em) rotate(217deg)}
  75% {transform:translate(3em, -4em) rotate(220deg)}
  100% {transform:translate(0, -1em) rotate(-225deg)}
`],[`
  0% {transform:translate(0, -1em) rotate(-45deg)}
  5% {transform:translate(0, -1em) rotate(-50deg)}
  20% {transform:translate(1em, -2em) rotate(47deg)}
  25% {transform:translate(1em, -2em) rotate(45deg)}
  30% {transform:translate(1em, -2em) rotate(40deg)}
  45% {transform:translate(2em, -3em) rotate(137deg)}
  50% {transform:translate(2em, -3em) rotate(135deg)}
  55% {transform:translate(2em, -3em) rotate(130deg)}
  70% {transform:translate(3em, -4em) rotate(217deg)}
  75% {transform:translate(3em, -4em) rotate(220deg)}
  100% {transform:translate(0, -1em) rotate(-225deg)}
`]))),U7=function(a){D7(l,a);function l(){var h=a!==null&&a.apply(this,arguments)||this;return h.style=function(){var s=h.props,c=s.color,E=s.speedMultiplier;return Oo.css(DM||(DM=ku([`
      position: absolute;
      left: 0;
      bottom: -0.1em;
      height: 1em;
      width: 1em;
      background-color: transparent;
      border-radius: 15%;
      border: 0.25em solid `,`;
      transform: translate(0, -1em) rotate(-45deg);
      animation-fill-mode: both;
      animation: `," ",`s infinite cubic-bezier(0.79, 0, 0.47, 0.97);
    `],[`
      position: absolute;
      left: 0;
      bottom: -0.1em;
      height: 1em;
      width: 1em;
      background-color: transparent;
      border-radius: 15%;
      border: 0.25em solid `,`;
      transform: translate(0, -1em) rotate(-45deg);
      animation-fill-mode: both;
      animation: `," ",`s infinite cubic-bezier(0.79, 0, 0.47, 0.97);
    `])),c,B7,2.5/E)},h.wrapper=function(){var s=h.props.size;return Oo.css(wM||(wM=ku([`
      position: absolute;
      top: 50%;
      left: 50%;
      margin-top: -2.7em;
      margin-left: -2.7em;
      width: 5.4em;
      height: 5.4em;
      font-size: `,`;
    `],[`
      position: absolute;
      top: 50%;
      left: 50%;
      margin-top: -2.7em;
      margin-left: -2.7em;
      width: 5.4em;
      height: 5.4em;
      font-size: `,`;
    `])),MM.cssValue(s))},h.hill=function(){var s=h.props.color;return Oo.css(LM||(LM=ku([`
      position: absolute;
      width: 7.1em;
      height: 7.1em;
      top: 1.7em;
      left: 1.7em;
      border-left: 0.25em solid `,`;
      transform: rotate(45deg);
    `],[`
      position: absolute;
      width: 7.1em;
      height: 7.1em;
      top: 1.7em;
      left: 1.7em;
      border-left: 0.25em solid `,`;
      transform: rotate(45deg);
    `])),s)},h.container=function(){return Oo.css(NM||(NM=ku([`
      position: relative;
      width: 7.1em;
      height: 7.1em;
    `],[`
      position: relative;
      width: 7.1em;
      height: 7.1em;
    `])))},h}return l.prototype.render=function(){var h=this.props,s=h.loading,c=h.css;return s?Oo.jsx("span",{css:[this.container(),c]},Oo.jsx("span",{css:this.wrapper()},Oo.jsx("span",{css:this.style()}),Oo.jsx("span",{css:this.hill()}))):null},l.defaultProps=MM.sizeDefaults(15),l}(F7.PureComponent);Hb.default=U7;var IM,DM,wM,LM,NM,Wb={},FM=Fe&&Fe.__makeTemplateObject||function(a,l){return Object.defineProperty?Object.defineProperty(a,"raw",{value:l}):a.raw=l,a},V7=Fe&&Fe.__extends||function(){var a=function(l,h){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var E in c)Object.prototype.hasOwnProperty.call(c,E)&&(s[E]=c[E])},a(l,h)};return function(l,h){a(l,h);function s(){this.constructor=l}l.prototype=h===null?Object.create(h):(s.prototype=h.prototype,new s)}}(),k7=Fe&&Fe.__createBinding||(Object.create?function(a,l,h,s){s===void 0&&(s=h),Object.defineProperty(a,s,{enumerable:!0,get:function(){return l[h]}})}:function(a,l,h,s){s===void 0&&(s=h),a[s]=l[h]}),j7=Fe&&Fe.__setModuleDefault||(Object.create?function(a,l){Object.defineProperty(a,"default",{enumerable:!0,value:l})}:function(a,l){a.default=l}),z7=Fe&&Fe.__importStar||function(a){if(a&&a.__esModule)return a;var l={};if(a!=null)for(var h in a)h!=="default"&&Object.prototype.hasOwnProperty.call(a,h)&&k7(l,a,h);return j7(l,a),l};Object.defineProperty(Wb,"__esModule",{value:!0});var G7=z7(Xn),Xb=Yn,Yb=jn,H7=Xb.keyframes(BM||(BM=FM([`
  0% {transform: rotate(0deg) scale(1)}
  50% {transform: rotate(180deg) scale(0.8)}
  100% {transform: rotate(360deg) scale(1)}
`],[`
  0% {transform: rotate(0deg) scale(1)}
  50% {transform: rotate(180deg) scale(0.8)}
  100% {transform: rotate(360deg) scale(1)}
`]))),W7=function(a){V7(l,a);function l(){var h=a!==null&&a.apply(this,arguments)||this;return h.style=function(){var s=h.props,c=s.size,E=s.color,m=s.speedMultiplier;return Xb.css(UM||(UM=FM([`
      background: transparent !important;
      width: `,`;
      height: `,`;
      border-radius: 100%;
      border: 2px solid;
      border-color: `,`;
      border-bottom-color: transparent;
      display: inline-block;
      animation: `," ",`s 0s infinite linear;
      animation-fill-mode: both;
    `],[`
      background: transparent !important;
      width: `,`;
      height: `,`;
      border-radius: 100%;
      border: 2px solid;
      border-color: `,`;
      border-bottom-color: transparent;
      display: inline-block;
      animation: `," ",`s 0s infinite linear;
      animation-fill-mode: both;
    `])),Yb.cssValue(c),Yb.cssValue(c),E,H7,.75/m)},h}return l.prototype.render=function(){var h=this.props,s=h.loading,c=h.css;return s?Xb.jsx("span",{css:[this.style(),c]}):null},l.defaultProps=Yb.sizeDefaults(35),l}(G7.PureComponent);Wb.default=W7;var BM,UM,Kb={},VM=Fe&&Fe.__makeTemplateObject||function(a,l){return Object.defineProperty?Object.defineProperty(a,"raw",{value:l}):a.raw=l,a},X7=Fe&&Fe.__extends||function(){var a=function(l,h){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var E in c)Object.prototype.hasOwnProperty.call(c,E)&&(s[E]=c[E])},a(l,h)};return function(l,h){a(l,h);function s(){this.constructor=l}l.prototype=h===null?Object.create(h):(s.prototype=h.prototype,new s)}}(),Y7=Fe&&Fe.__createBinding||(Object.create?function(a,l,h,s){s===void 0&&(s=h),Object.defineProperty(a,s,{enumerable:!0,get:function(){return l[h]}})}:function(a,l,h,s){s===void 0&&(s=h),a[s]=l[h]}),K7=Fe&&Fe.__setModuleDefault||(Object.create?function(a,l){Object.defineProperty(a,"default",{enumerable:!0,value:l})}:function(a,l){a.default=l}),Q7=Fe&&Fe.__importStar||function(a){if(a&&a.__esModule)return a;var l={};if(a!=null)for(var h in a)h!=="default"&&Object.prototype.hasOwnProperty.call(a,h)&&Y7(l,a,h);return K7(l,a),l};Object.defineProperty(Kb,"__esModule",{value:!0});var q7=Q7(Xn),Qb=Yn,kM=jn,jM=Qb.keyframes(zM||(zM=VM([`
  100% { transform: rotate(360deg) }
`],[`
  100% { transform: rotate(360deg) }
`]))),Z7=function(a){X7(l,a);function l(){var h=a!==null&&a.apply(this,arguments)||this;return h.wrapper=function(){var s=h.props,c=s.size,E=s.color,m=s.speedMultiplier,S=kM.parseLengthAndUnit(c),d=S.value,M=S.unit;return Qb.css(GM||(GM=VM([`
      position: relative;
      width: `,`;
      height: `,`;
      background-color: transparent;
      box-shadow: inset 0px 0px 0px 2px `,`;
      border-radius: 50%;

      &:after,
      &:before {
        position: absolute;
        content: "";
        background-color: `,`;
      }

      &:after {
        width: `,`px;
        height: 2px;
        top: `,`px;
        left: `,`px;
        transform-origin: 1px 1px;
        animation: `," ",`s linear infinite;
      }

      &:before {
        width: `,`px;
        height: 2px;
        top: `,`px;
        left: `,`px;
        transform-origin: 1px 1px;
        animation: `," ",`s linear infinite;
      }
    `],[`
      position: relative;
      width: `,`;
      height: `,`;
      background-color: transparent;
      box-shadow: inset 0px 0px 0px 2px `,`;
      border-radius: 50%;

      &:after,
      &:before {
        position: absolute;
        content: "";
        background-color: `,`;
      }

      &:after {
        width: `,`px;
        height: 2px;
        top: `,`px;
        left: `,`px;
        transform-origin: 1px 1px;
        animation: `," ",`s linear infinite;
      }

      &:before {
        width: `,`px;
        height: 2px;
        top: `,`px;
        left: `,`px;
        transform-origin: 1px 1px;
        animation: `," ",`s linear infinite;
      }
    `])),""+d+M,""+d+M,E,E,d/2.4,d/2-1,d/2-1,jM,2/m,d/3,d/2-1,d/2-1,jM,8/m)},h}return l.prototype.render=function(){var h=this.props,s=h.loading,c=h.css;return s?Qb.jsx("span",{css:[this.wrapper(),c]}):null},l.defaultProps=kM.sizeDefaults(50),l}(q7.PureComponent);Kb.default=Z7;var zM,GM,qb={},cp=Fe&&Fe.__makeTemplateObject||function(a,l){return Object.defineProperty?Object.defineProperty(a,"raw",{value:l}):a.raw=l,a},$7=Fe&&Fe.__extends||function(){var a=function(l,h){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var E in c)Object.prototype.hasOwnProperty.call(c,E)&&(s[E]=c[E])},a(l,h)};return function(l,h){a(l,h);function s(){this.constructor=l}l.prototype=h===null?Object.create(h):(s.prototype=h.prototype,new s)}}(),J7=Fe&&Fe.__createBinding||(Object.create?function(a,l,h,s){s===void 0&&(s=h),Object.defineProperty(a,s,{enumerable:!0,get:function(){return l[h]}})}:function(a,l,h,s){s===void 0&&(s=h),a[s]=l[h]}),e9=Fe&&Fe.__setModuleDefault||(Object.create?function(a,l){Object.defineProperty(a,"default",{enumerable:!0,value:l})}:function(a,l){a.default=l}),t9=Fe&&Fe.__importStar||function(a){if(a&&a.__esModule)return a;var l={};if(a!=null)for(var h in a)h!=="default"&&Object.prototype.hasOwnProperty.call(a,h)&&J7(l,a,h);return e9(l,a),l};Object.defineProperty(qb,"__esModule",{value:!0});var n9=t9(Xn),ns=Yn,lp=jn,r9=ns.keyframes(HM||(HM=cp([`
  100% {transform: rotate(360deg)}
`],[`
  100% {transform: rotate(360deg)}
`]))),i9=ns.keyframes(WM||(WM=cp([`
  0%, 100% {transform: scale(0)}
  50% {transform: scale(1.0)}
`],[`
  0%, 100% {transform: scale(0)}
  50% {transform: scale(1.0)}
`]))),o9=function(a){$7(l,a);function l(){var h=a!==null&&a.apply(this,arguments)||this;return h.style=function(s){var c=h.props,E=c.size,m=c.color,S=c.speedMultiplier,d=lp.parseLengthAndUnit(E),M=d.value,C=d.unit;return ns.css(XM||(XM=cp([`
      position: absolute;
      top: `,`;
      bottom: `,`;
      height: `,`;
      width: `,`;
      background-color: `,`;
      border-radius: 100%;
      animation-fill-mode: forwards;
      animation: `," ","s ",` infinite linear;
    `],[`
      position: absolute;
      top: `,`;
      bottom: `,`;
      height: `,`;
      width: `,`;
      background-color: `,`;
      border-radius: 100%;
      animation-fill-mode: forwards;
      animation: `," ","s ",` infinite linear;
    `])),s%2?"0":"auto",s%2?"auto":"0",""+M/2+C,""+M/2+C,m,i9,2/S,s===2?"-1s":"0s")},h.wrapper=function(){var s=h.props,c=s.size,E=s.speedMultiplier;return ns.css(YM||(YM=cp([`
      position: relative;
      width: `,`;
      height: `,`;
      animation-fill-mode: forwards;
      animation: `," ",`s 0s infinite linear;
    `],[`
      position: relative;
      width: `,`;
      height: `,`;
      animation-fill-mode: forwards;
      animation: `," ",`s 0s infinite linear;
    `])),lp.cssValue(c),lp.cssValue(c),r9,2/E)},h}return l.prototype.render=function(){var h=this.props,s=h.loading,c=h.css;return s?ns.jsx("span",{css:[this.wrapper(),c]},ns.jsx("span",{css:this.style(1)}),ns.jsx("span",{css:this.style(2)})):null},l.defaultProps=lp.sizeDefaults(60),l}(n9.PureComponent);qb.default=o9;var HM,WM,XM,YM,Zb={},Ui=Fe&&Fe.__makeTemplateObject||function(a,l){return Object.defineProperty?Object.defineProperty(a,"raw",{value:l}):a.raw=l,a},a9=Fe&&Fe.__extends||function(){var a=function(l,h){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var E in c)Object.prototype.hasOwnProperty.call(c,E)&&(s[E]=c[E])},a(l,h)};return function(l,h){a(l,h);function s(){this.constructor=l}l.prototype=h===null?Object.create(h):(s.prototype=h.prototype,new s)}}(),s9=Fe&&Fe.__createBinding||(Object.create?function(a,l,h,s){s===void 0&&(s=h),Object.defineProperty(a,s,{enumerable:!0,get:function(){return l[h]}})}:function(a,l,h,s){s===void 0&&(s=h),a[s]=l[h]}),c9=Fe&&Fe.__setModuleDefault||(Object.create?function(a,l){Object.defineProperty(a,"default",{enumerable:!0,value:l})}:function(a,l){a.default=l}),l9=Fe&&Fe.__importStar||function(a){if(a&&a.__esModule)return a;var l={};if(a!=null)for(var h in a)h!=="default"&&Object.prototype.hasOwnProperty.call(a,h)&&s9(l,a,h);return c9(l,a),l};Object.defineProperty(Zb,"__esModule",{value:!0});var u9=l9(Xn),or=Yn,Ic=jn,h9=or.keyframes(KM||(KM=Ui([`
  50% {opacity: 0.3}
  100% {opacity: 1}
`],[`
  50% {opacity: 0.3}
  100% {opacity: 1}
`]))),d9=function(a){a9(l,a);function l(){var h=a!==null&&a.apply(this,arguments)||this;return h.radius=function(){var s=h.props.margin,c=Ic.parseLengthAndUnit(s).value;return c+18},h.quarter=function(){return h.radius()/2+h.radius()/5.5},h.style=function(s){var c=h.props,E=c.height,m=c.width,S=c.margin,d=c.color,M=c.radius,C=c.speedMultiplier;return or.css(QM||(QM=Ui([`
      position: absolute;
      width: `,`;
      height: `,`;
      margin: `,`;
      background-color: `,`;
      border-radius: `,`;
      transition: 2s;
      animation-fill-mode: "both";
      animation: `," ","s ",`s infinite ease-in-out;
    `],[`
      position: absolute;
      width: `,`;
      height: `,`;
      margin: `,`;
      background-color: `,`;
      border-radius: `,`;
      transition: 2s;
      animation-fill-mode: "both";
      animation: `," ","s ",`s infinite ease-in-out;
    `])),Ic.cssValue(m),Ic.cssValue(E),Ic.cssValue(S),d,Ic.cssValue(M),h9,1.2/C,s*.12)},h.wrapper=function(){return or.css(qM||(qM=Ui([`
      position: relative;
      font-size: 0;
      top: `,`px;
      left: `,`px;
      width: `,`px;
      height: `,`px;
    `],[`
      position: relative;
      font-size: 0;
      top: `,`px;
      left: `,`px;
      width: `,`px;
      height: `,`px;
    `])),h.radius(),h.radius(),h.radius()*3,h.radius()*3)},h.a=function(){return or.css(ZM||(ZM=Ui([`
    `,`;
    top: `,`px;
    left: 0;
  `],[`
    `,`;
    top: `,`px;
    left: 0;
  `])),h.style(1),h.radius())},h.b=function(){return or.css($M||($M=Ui([`
    `,`;
    top: `,`px;
    left: `,`px;
    transform: rotate(-45deg);
  `],[`
    `,`;
    top: `,`px;
    left: `,`px;
    transform: rotate(-45deg);
  `])),h.style(2),h.quarter(),h.quarter())},h.c=function(){return or.css(JM||(JM=Ui([`
    `,`;
    top: 0;
    left: `,`px;
    transform: rotate(90deg);
  `],[`
    `,`;
    top: 0;
    left: `,`px;
    transform: rotate(90deg);
  `])),h.style(3),h.radius())},h.d=function(){return or.css(e1||(e1=Ui([`
    `,`;
    top: `,`px;
    left: `,`px;
    transform: rotate(45deg);
  `],[`
    `,`;
    top: `,`px;
    left: `,`px;
    transform: rotate(45deg);
  `])),h.style(4),-h.quarter(),h.quarter())},h.e=function(){return or.css(t1||(t1=Ui([`
    `,`;
    top: `,`px;
    left: 0;
  `],[`
    `,`;
    top: `,`px;
    left: 0;
  `])),h.style(5),-h.radius())},h.f=function(){return or.css(n1||(n1=Ui([`
    `,`;
    top: `,`px;
    left: `,`px;
    transform: rotate(-45deg);
  `],[`
    `,`;
    top: `,`px;
    left: `,`px;
    transform: rotate(-45deg);
  `])),h.style(6),-h.quarter(),-h.quarter())},h.g=function(){return or.css(r1||(r1=Ui([`
    `,`;
    top: 0;
    left: `,`px;
    transform: rotate(90deg);
  `],[`
    `,`;
    top: 0;
    left: `,`px;
    transform: rotate(90deg);
  `])),h.style(7),-h.radius())},h.h=function(){return or.css(i1||(i1=Ui([`
    `,`;
    top: `,`px;
    left: `,`px;
    transform: rotate(45deg);
  `],[`
    `,`;
    top: `,`px;
    left: `,`px;
    transform: rotate(45deg);
  `])),h.style(8),h.quarter(),-h.quarter())},h}return l.prototype.render=function(){var h=this.props,s=h.loading,c=h.css;return s?or.jsx("span",{css:[this.wrapper(),c]},or.jsx("span",{css:this.a()}),or.jsx("span",{css:this.b()}),or.jsx("span",{css:this.c()}),or.jsx("span",{css:this.d()}),or.jsx("span",{css:this.e()}),or.jsx("span",{css:this.f()}),or.jsx("span",{css:this.g()}),or.jsx("span",{css:this.h()})):null},l.defaultProps=Ic.heightWidthRadiusDefaults(15,5,2),l}(u9.PureComponent);Zb.default=d9;var KM,QM,qM,ZM,$M,JM,e1,t1,n1,r1,i1,$b={},Jb=Fe&&Fe.__makeTemplateObject||function(a,l){return Object.defineProperty?Object.defineProperty(a,"raw",{value:l}):a.raw=l,a},f9=Fe&&Fe.__extends||function(){var a=function(l,h){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var E in c)Object.prototype.hasOwnProperty.call(c,E)&&(s[E]=c[E])},a(l,h)};return function(l,h){a(l,h);function s(){this.constructor=l}l.prototype=h===null?Object.create(h):(s.prototype=h.prototype,new s)}}(),p9=Fe&&Fe.__createBinding||(Object.create?function(a,l,h,s){s===void 0&&(s=h),Object.defineProperty(a,s,{enumerable:!0,get:function(){return l[h]}})}:function(a,l,h,s){s===void 0&&(s=h),a[s]=l[h]}),m9=Fe&&Fe.__setModuleDefault||(Object.create?function(a,l){Object.defineProperty(a,"default",{enumerable:!0,value:l})}:function(a,l){a.default=l}),_9=Fe&&Fe.__importStar||function(a){if(a&&a.__esModule)return a;var l={};if(a!=null)for(var h in a)h!=="default"&&Object.prototype.hasOwnProperty.call(a,h)&&p9(l,a,h);return m9(l,a),l};Object.defineProperty($b,"__esModule",{value:!0});var g9=_9(Xn),ai=Yn,Dc=jn,v9=ai.keyframes(o1||(o1=Jb([`
  0% {transform: scale(1)}
  50% {transform: scale(0.5); opacity: 0.7}
  100% {transform: scale(1);opacity: 1}
`],[`
  0% {transform: scale(1)}
  50% {transform: scale(0.5); opacity: 0.7}
  100% {transform: scale(1);opacity: 1}
`]))),Mo=function(a){return Math.random()*a},b9=function(a){f9(l,a);function l(){var h=a!==null&&a.apply(this,arguments)||this;return h.style=function(s){var c=h.props,E=c.color,m=c.size,S=c.margin,d=c.speedMultiplier;return ai.css(a1||(a1=Jb([`
      display: inline-block;
      background-color: `,`;
      width: `,`;
      height: `,`;
      margin: `,`;
      border-radius: 100%;
      animation-fill-mode: "both";
      animation: `," ","s ",`s infinite ease;
    `],[`
      display: inline-block;
      background-color: `,`;
      width: `,`;
      height: `,`;
      margin: `,`;
      border-radius: 100%;
      animation-fill-mode: "both";
      animation: `," ","s ",`s infinite ease;
    `])),E,Dc.cssValue(m),Dc.cssValue(m),Dc.cssValue(S),v9,(s/100+.6)/d,s/100-.2)},h.wrapper=function(){var s=h.props,c=s.size,E=s.margin,m=Dc.parseLengthAndUnit(c),S=Dc.parseLengthAndUnit(E),d=""+(parseFloat(m.value.toString())*3+parseFloat(S.value.toString())*6)+m.unit;return ai.css(s1||(s1=Jb([`
      width: `,`;
      font-size: 0;
    `],[`
      width: `,`;
      font-size: 0;
    `])),d)},h}return l.prototype.render=function(){var h=this.props,s=h.loading,c=h.css;return s?ai.jsx("span",{css:[this.wrapper(),c]},ai.jsx("span",{css:this.style(Mo(100))}),ai.jsx("span",{css:this.style(Mo(100))}),ai.jsx("span",{css:this.style(Mo(100))}),ai.jsx("span",{css:this.style(Mo(100))}),ai.jsx("span",{css:this.style(Mo(100))}),ai.jsx("span",{css:this.style(Mo(100))}),ai.jsx("span",{css:this.style(Mo(100))}),ai.jsx("span",{css:this.style(Mo(100))}),ai.jsx("span",{css:this.style(Mo(100))})):null},l.defaultProps=Dc.sizeMarginDefaults(15),l}(g9.PureComponent);$b.default=b9;var o1,a1,s1,ey={},y9=Fe&&Fe.__extends||function(){var a=function(l,h){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var E in c)Object.prototype.hasOwnProperty.call(c,E)&&(s[E]=c[E])},a(l,h)};return function(l,h){a(l,h);function s(){this.constructor=l}l.prototype=h===null?Object.create(h):(s.prototype=h.prototype,new s)}}(),up=Fe&&Fe.__makeTemplateObject||function(a,l){return Object.defineProperty?Object.defineProperty(a,"raw",{value:l}):a.raw=l,a},T9=Fe&&Fe.__createBinding||(Object.create?function(a,l,h,s){s===void 0&&(s=h),Object.defineProperty(a,s,{enumerable:!0,get:function(){return l[h]}})}:function(a,l,h,s){s===void 0&&(s=h),a[s]=l[h]}),E9=Fe&&Fe.__setModuleDefault||(Object.create?function(a,l){Object.defineProperty(a,"default",{enumerable:!0,value:l})}:function(a,l){a.default=l}),S9=Fe&&Fe.__importStar||function(a){if(a&&a.__esModule)return a;var l={};if(a!=null)for(var h in a)h!=="default"&&Object.prototype.hasOwnProperty.call(a,h)&&T9(l,a,h);return E9(l,a),l};Object.defineProperty(ey,"__esModule",{value:!0});var x9=S9(Xn),rs=Yn,Io=jn,A9=function(a){y9(l,a);function l(){var h=a!==null&&a.apply(this,arguments)||this;return h.thickness=function(){var s=h.props.size,c=Io.parseLengthAndUnit(s).value;return c/5},h.lat=function(){var s=h.props.size,c=Io.parseLengthAndUnit(s).value;return(c-h.thickness())/2},h.offset=function(){return h.lat()-h.thickness()},h.color=function(){var s=h.props.color;return Io.calculateRgba(s,.75)},h.before=function(){var s=h.props.size,c=h.color(),E=h.lat(),m=h.thickness(),S=h.offset();return rs.keyframes(c1||(c1=up([`
      0% {width: `,"px;box-shadow: ","px ","px ",", ","px ","px ",`}
      35% {width: `,";box-shadow: 0 ","px ",", 0 ","px ",`}
      70% {width: `,"px;box-shadow: ","px ","px ",", ","px ","px ",`}
      100% {box-shadow: `,"px ","px ",", ","px ","px ",`}
    `],[`
      0% {width: `,"px;box-shadow: ","px ","px ",", ","px ","px ",`}
      35% {width: `,";box-shadow: 0 ","px ",", 0 ","px ",`}
      70% {width: `,"px;box-shadow: ","px ","px ",", ","px ","px ",`}
      100% {box-shadow: `,"px ","px ",", ","px ","px ",`}
    `])),m,E,-S,c,-E,S,c,Io.cssValue(s),-S,c,S,c,m,-E,-S,c,E,S,c,E,-S,c,-E,S,c)},h.after=function(){var s=h.props.size,c=h.color(),E=h.lat(),m=h.thickness(),S=h.offset();return rs.keyframes(l1||(l1=up([`
      0% {height: `,"px;box-shadow: ","px ","px ",", ","px ","px ",`}
      35% {height: `,";box-shadow: ","px 0 ",", ","px 0 ",`}
      70% {height: `,"px;box-shadow: ","px ","px ",", ","px ","px ",`}
      100% {box-shadow: `,"px ","px ",", ","px ","px ",`}
    `],[`
      0% {height: `,"px;box-shadow: ","px ","px ",", ","px ","px ",`}
      35% {height: `,";box-shadow: ","px 0 ",", ","px 0 ",`}
      70% {height: `,"px;box-shadow: ","px ","px ",", ","px ","px ",`}
      100% {box-shadow: `,"px ","px ",", ","px ","px ",`}
    `])),m,S,E,c,-S,-E,c,Io.cssValue(s),S,c,-S,c,m,S,-E,c,-S,E,c,S,E,c,-S,-E,c)},h.style=function(s){var c=h.props,E=c.size,m=c.speedMultiplier,S=Io.parseLengthAndUnit(E),d=S.value,M=S.unit;return rs.css(u1||(u1=up([`
      position: absolute;
      content: "";
      top: 50%;
      left: 50%;
      display: block;
      width: `,`;
      height: `,`;
      border-radius: `,`;
      transform: translate(-50%, -50%);
      animation-fill-mode: none;
      animation: `," ",`s infinite;
    `],[`
      position: absolute;
      content: "";
      top: 50%;
      left: 50%;
      display: block;
      width: `,`;
      height: `,`;
      border-radius: `,`;
      transform: translate(-50%, -50%);
      animation-fill-mode: none;
      animation: `," ",`s infinite;
    `])),""+d/5+M,""+d/5+M,""+d/10+M,s===1?h.before():h.after(),2/m)},h.wrapper=function(){var s=h.props.size;return rs.css(h1||(h1=up([`
      position: relative;
      width: `,`;
      height: `,`;
      transform: rotate(165deg);
    `],[`
      position: relative;
      width: `,`;
      height: `,`;
      transform: rotate(165deg);
    `])),Io.cssValue(s),Io.cssValue(s))},h}return l.prototype.render=function(){var h=this.props,s=h.loading,c=h.css;return s?rs.jsx("span",{css:[this.wrapper(),c]},rs.jsx("span",{css:this.style(1)}),rs.jsx("span",{css:this.style(2)})):null},l.defaultProps=Io.sizeDefaults(50),l}(x9.PureComponent);ey.default=A9;var c1,l1,u1,h1,ty={},ju=Fe&&Fe.__makeTemplateObject||function(a,l){return Object.defineProperty?Object.defineProperty(a,"raw",{value:l}):a.raw=l,a},P9=Fe&&Fe.__extends||function(){var a=function(l,h){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var E in c)Object.prototype.hasOwnProperty.call(c,E)&&(s[E]=c[E])},a(l,h)};return function(l,h){a(l,h);function s(){this.constructor=l}l.prototype=h===null?Object.create(h):(s.prototype=h.prototype,new s)}}(),C9=Fe&&Fe.__createBinding||(Object.create?function(a,l,h,s){s===void 0&&(s=h),Object.defineProperty(a,s,{enumerable:!0,get:function(){return l[h]}})}:function(a,l,h,s){s===void 0&&(s=h),a[s]=l[h]}),R9=Fe&&Fe.__setModuleDefault||(Object.create?function(a,l){Object.defineProperty(a,"default",{enumerable:!0,value:l})}:function(a,l){a.default=l}),O9=Fe&&Fe.__importStar||function(a){if(a&&a.__esModule)return a;var l={};if(a!=null)for(var h in a)h!=="default"&&Object.prototype.hasOwnProperty.call(a,h)&&C9(l,a,h);return R9(l,a),l};Object.defineProperty(ty,"__esModule",{value:!0});var M9=O9(Xn),ya=Yn,is=jn,d1=ya.keyframes(f1||(f1=ju([`
  100% {transform: rotate(360deg)}
`],[`
  100% {transform: rotate(360deg)}
`]))),I9=function(a){P9(l,a);function l(){var h=a!==null&&a.apply(this,arguments)||this;return h.moonSize=function(){var s=h.props.size,c=is.parseLengthAndUnit(s).value;return c/7},h.ballStyle=function(s){return ya.css(p1||(p1=ju([`
      width: `,`;
      height: `,`;
      border-radius: 100%;
    `],[`
      width: `,`;
      height: `,`;
      border-radius: 100%;
    `])),is.cssValue(s),is.cssValue(s))},h.wrapper=function(){var s=h.props,c=s.size,E=s.speedMultiplier,m=is.parseLengthAndUnit(c),S=m.value,d=m.unit;return ya.css(m1||(m1=ju([`
      position: relative;
      width: `,`;
      height: `,`;
      animation: `," ",`s 0s infinite linear;
      animation-fill-mode: forwards;
    `],[`
      position: relative;
      width: `,`;
      height: `,`;
      animation: `," ",`s 0s infinite linear;
      animation-fill-mode: forwards;
    `])),""+(S+h.moonSize()*2)+d,""+(S+h.moonSize()*2)+d,d1,.6/E)},h.ball=function(){var s=h.props,c=s.color,E=s.size,m=s.speedMultiplier,S=is.parseLengthAndUnit(E),d=S.value,M=S.unit;return ya.css(_1||(_1=ju([`
      `,`;
      background-color: `,`;
      opacity: 0.8;
      position: absolute;
      top: `,`;
      animation: `," ",`s 0s infinite linear;
      animation-fill-mode: forwards;
    `],[`
      `,`;
      background-color: `,`;
      opacity: 0.8;
      position: absolute;
      top: `,`;
      animation: `," ",`s 0s infinite linear;
      animation-fill-mode: forwards;
    `])),h.ballStyle(h.moonSize()),c,""+(d/2-h.moonSize()/2)+M,d1,.6/m)},h.circle=function(){var s=h.props,c=s.size,E=s.color,m=is.parseLengthAndUnit(c).value;return ya.css(g1||(g1=ju([`
      `,`;
      border: `,"px solid ",`;
      opacity: 0.1;
      box-sizing: content-box;
      position: absolute;
    `],[`
      `,`;
      border: `,"px solid ",`;
      opacity: 0.1;
      box-sizing: content-box;
      position: absolute;
    `])),h.ballStyle(m),h.moonSize(),E)},h}return l.prototype.render=function(){var h=this.props,s=h.loading,c=h.css;return s?ya.jsx("span",{css:[this.wrapper(),c]},ya.jsx("span",{css:this.ball()}),ya.jsx("span",{css:this.circle()})):null},l.defaultProps=is.sizeDefaults(60),l}(M9.PureComponent);ty.default=I9;var f1,p1,m1,_1,g1,ny={},wc=Fe&&Fe.__makeTemplateObject||function(a,l){return Object.defineProperty?Object.defineProperty(a,"raw",{value:l}):a.raw=l,a},D9=Fe&&Fe.__extends||function(){var a=function(l,h){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var E in c)Object.prototype.hasOwnProperty.call(c,E)&&(s[E]=c[E])},a(l,h)};return function(l,h){a(l,h);function s(){this.constructor=l}l.prototype=h===null?Object.create(h):(s.prototype=h.prototype,new s)}}(),w9=Fe&&Fe.__createBinding||(Object.create?function(a,l,h,s){s===void 0&&(s=h),Object.defineProperty(a,s,{enumerable:!0,get:function(){return l[h]}})}:function(a,l,h,s){s===void 0&&(s=h),a[s]=l[h]}),L9=Fe&&Fe.__setModuleDefault||(Object.create?function(a,l){Object.defineProperty(a,"default",{enumerable:!0,value:l})}:function(a,l){a.default=l}),N9=Fe&&Fe.__importStar||function(a){if(a&&a.__esModule)return a;var l={};if(a!=null)for(var h in a)h!=="default"&&Object.prototype.hasOwnProperty.call(a,h)&&w9(l,a,h);return L9(l,a),l};Object.defineProperty(ny,"__esModule",{value:!0});var F9=N9(Xn),si=Yn,Do=jn,B9=[si.keyframes(v1||(v1=wc([`
    0% {transform: rotate(0deg)}
    50% {transform: rotate(-44deg)}
  `],[`
    0% {transform: rotate(0deg)}
    50% {transform: rotate(-44deg)}
  `]))),si.keyframes(b1||(b1=wc([`
    0% {transform: rotate(0deg)}
    50% {transform: rotate(44deg)}
  `],[`
    0% {transform: rotate(0deg)}
    50% {transform: rotate(44deg)}
  `])))],U9=function(a){D9(l,a);function l(){var h=a!==null&&a.apply(this,arguments)||this;return h.ball=function(){var s=h.props.size,c=Do.parseLengthAndUnit(s),E=c.value,m=c.unit;return si.keyframes(y1||(y1=wc([`
      75% {opacity: 0.7}
      100% {transform: translate(`,", ",`)}
    `],[`
      75% {opacity: 0.7}
      100% {transform: translate(`,", ",`)}
    `])),""+-4*E+m,""+-E/4+m)},h.ballStyle=function(s){var c=h.props,E=c.color,m=c.margin,S=c.size,d=c.speedMultiplier,M=Do.parseLengthAndUnit(S),C=M.value,I=M.unit;return si.css(T1||(T1=wc([`
      width: `,`;
      height: `,`;
      background-color: `,`;
      margin: `,`;
      border-radius: 100%;
      transform: translate(0, `,`);
      position: absolute;
      top: `,`;
      left: `,`;
      animation: `," ","s ",`s infinite linear;
      animation-fill-mode: both;
    `],[`
      width: `,`;
      height: `,`;
      background-color: `,`;
      margin: `,`;
      border-radius: 100%;
      transform: translate(0, `,`);
      position: absolute;
      top: `,`;
      left: `,`;
      animation: `," ","s ",`s infinite linear;
      animation-fill-mode: both;
    `])),""+C/3+I,""+C/3+I,E,Do.cssValue(m),""+-C/4+I,""+C+I,""+C*4+I,h.ball(),1/d,s*.25)},h.s1=function(){return Do.cssValue(h.props.size)+" solid transparent"},h.s2=function(){var s=h.props.color;return Do.cssValue(h.props.size)+" solid "+s},h.pacmanStyle=function(s){var c=h.props,E=c.size,m=c.speedMultiplier,S=h.s1(),d=h.s2();return si.css(E1||(E1=wc([`
      width: 0;
      height: 0;
      border-right: `,`;
      border-top: `,`;
      border-left: `,`;
      border-bottom: `,`;
      border-radius: `,`;
      position: absolute;
      animation: `," ",`s infinite ease-in-out;
      animation-fill-mode: both;
    `],[`
      width: 0;
      height: 0;
      border-right: `,`;
      border-top: `,`;
      border-left: `,`;
      border-bottom: `,`;
      border-radius: `,`;
      position: absolute;
      animation: `," ",`s infinite ease-in-out;
      animation-fill-mode: both;
    `])),S,s===0?S:d,d,s===0?d:S,Do.cssValue(E),B9[s],.8/m)},h.wrapper=function(){return si.css(S1||(S1=wc([`
      position: relative;
      font-size: 0;
      height: `,`;
      width: `,`;
    `],[`
      position: relative;
      font-size: 0;
      height: `,`;
      width: `,`;
    `])),Do.cssValue(h.props.size),Do.cssValue(h.props.size))},h.pac=function(){return h.pacmanStyle(0)},h.man=function(){return h.pacmanStyle(1)},h}return l.prototype.render=function(){var h=this.props,s=h.loading,c=h.css;return s?si.jsx("span",{css:[this.wrapper(),c]},si.jsx("span",{css:this.pac()}),si.jsx("span",{css:this.man()}),si.jsx("span",{css:this.ballStyle(2)}),si.jsx("span",{css:this.ballStyle(3)}),si.jsx("span",{css:this.ballStyle(4)}),si.jsx("span",{css:this.ballStyle(5)})):null},l.defaultProps=Do.sizeMarginDefaults(25),l}(F9.PureComponent);ny.default=U9;var v1,b1,y1,T1,E1,S1,ry={},Ta=Fe&&Fe.__makeTemplateObject||function(a,l){return Object.defineProperty?Object.defineProperty(a,"raw",{value:l}):a.raw=l,a},V9=Fe&&Fe.__extends||function(){var a=function(l,h){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var E in c)Object.prototype.hasOwnProperty.call(c,E)&&(s[E]=c[E])},a(l,h)};return function(l,h){a(l,h);function s(){this.constructor=l}l.prototype=h===null?Object.create(h):(s.prototype=h.prototype,new s)}}(),k9=Fe&&Fe.__createBinding||(Object.create?function(a,l,h,s){s===void 0&&(s=h),Object.defineProperty(a,s,{enumerable:!0,get:function(){return l[h]}})}:function(a,l,h,s){s===void 0&&(s=h),a[s]=l[h]}),j9=Fe&&Fe.__setModuleDefault||(Object.create?function(a,l){Object.defineProperty(a,"default",{enumerable:!0,value:l})}:function(a,l){a.default=l}),z9=Fe&&Fe.__importStar||function(a){if(a&&a.__esModule)return a;var l={};if(a!=null)for(var h in a)h!=="default"&&Object.prototype.hasOwnProperty.call(a,h)&&k9(l,a,h);return j9(l,a),l};Object.defineProperty(ry,"__esModule",{value:!0});var G9=z9(Xn),kr=Yn,x1=jn,Or=[1,3,5],H9=[kr.keyframes(A1||(A1=Ta([`
      25% {transform: translateX(-`,`rem) scale(0.75)}
      50% {transform: translateX(-`,`rem) scale(0.6)}
      75% {transform: translateX(-`,`rem) scale(0.5)}
      95% {transform: translateX(0rem) scale(1)}
    `],[`
      25% {transform: translateX(-`,`rem) scale(0.75)}
      50% {transform: translateX(-`,`rem) scale(0.6)}
      75% {transform: translateX(-`,`rem) scale(0.5)}
      95% {transform: translateX(0rem) scale(1)}
    `])),Or[0],Or[1],Or[2]),kr.keyframes(P1||(P1=Ta([`
      25% {transform: translateX(-`,`rem) scale(0.75)}
      50% {transform: translateX(-`,`rem) scale(0.6)}
      75% {transform: translateX(-`,`rem) scale(0.6)}
      95% {transform: translateX(0rem) scale(1)}
    `],[`
      25% {transform: translateX(-`,`rem) scale(0.75)}
      50% {transform: translateX(-`,`rem) scale(0.6)}
      75% {transform: translateX(-`,`rem) scale(0.6)}
      95% {transform: translateX(0rem) scale(1)}
    `])),Or[0],Or[1],Or[1]),kr.keyframes(C1||(C1=Ta([`
      25% {transform: translateX(-`,`rem) scale(0.75)}
      75% {transform: translateX(-`,`rem) scale(0.75)}
      95% {transform: translateX(0rem) scale(1)}
    `],[`
      25% {transform: translateX(-`,`rem) scale(0.75)}
      75% {transform: translateX(-`,`rem) scale(0.75)}
      95% {transform: translateX(0rem) scale(1)}
    `])),Or[0],Or[0]),kr.keyframes(R1||(R1=Ta([`
      25% {transform: translateX(`,`rem) scale(0.75)}
      75% {transform: translateX(`,`rem) scale(0.75)}
      95% {transform: translateX(0rem) scale(1)}
    `],[`
      25% {transform: translateX(`,`rem) scale(0.75)}
      75% {transform: translateX(`,`rem) scale(0.75)}
      95% {transform: translateX(0rem) scale(1)}
    `])),Or[0],Or[0]),kr.keyframes(O1||(O1=Ta([`
      25% {transform: translateX(`,`rem) scale(0.75)}
      50% {transform: translateX(`,`rem) scale(0.6)}
      75% {transform: translateX(`,`rem) scale(0.6)}
      95% {transform: translateX(0rem) scale(1)}
    `],[`
      25% {transform: translateX(`,`rem) scale(0.75)}
      50% {transform: translateX(`,`rem) scale(0.6)}
      75% {transform: translateX(`,`rem) scale(0.6)}
      95% {transform: translateX(0rem) scale(1)}
    `])),Or[0],Or[1],Or[1]),kr.keyframes(M1||(M1=Ta([`
      25% {transform: translateX(`,`rem) scale(0.75)}
      50% {transform: translateX(`,`rem) scale(0.6)}
      75% {transform: translateX(`,`rem) scale(0.5)}
      95% {transform: translateX(0rem) scale(1)}
    `],[`
      25% {transform: translateX(`,`rem) scale(0.75)}
      50% {transform: translateX(`,`rem) scale(0.6)}
      75% {transform: translateX(`,`rem) scale(0.5)}
      95% {transform: translateX(0rem) scale(1)}
    `])),Or[0],Or[1],Or[2])],W9=function(a){V9(l,a);function l(){var h=a!==null&&a.apply(this,arguments)||this;return h.style=function(s){var c=h.props,E=c.size,m=c.color,S=c.speedMultiplier,d=x1.parseLengthAndUnit(E),M=d.value,C=d.unit;return kr.css(I1||(I1=Ta([`
      position: absolute;
      font-size: `,`;
      width: `,`;
      height: `,`;
      background: `,`;
      border-radius: 50%;
      animation: `," ",`s infinite;
      animation-fill-mode: forwards;
    `],[`
      position: absolute;
      font-size: `,`;
      width: `,`;
      height: `,`;
      background: `,`;
      border-radius: 50%;
      animation: `," ",`s infinite;
      animation-fill-mode: forwards;
    `])),""+M/3+C,""+M+C,""+M+C,m,H9[s],1.5/S)},h.wrapper=function(){return kr.css(D1||(D1=Ta([`
      position: relative;
    `],[`
      position: relative;
    `])))},h}return l.prototype.render=function(){var h=this.props,s=h.loading,c=h.css;return s?kr.jsx("span",{css:[this.wrapper(),c]},kr.jsx("span",{css:this.style(0)}),kr.jsx("span",{css:this.style(1)}),kr.jsx("span",{css:this.style(2)}),kr.jsx("span",{css:this.style(3)}),kr.jsx("span",{css:this.style(4)}),kr.jsx("span",{css:this.style(5)})):null},l.defaultProps=x1.sizeDefaults(15),l}(G9.PureComponent);ry.default=W9;var A1,P1,C1,R1,O1,M1,I1,D1,iy={},w1=Fe&&Fe.__makeTemplateObject||function(a,l){return Object.defineProperty?Object.defineProperty(a,"raw",{value:l}):a.raw=l,a},X9=Fe&&Fe.__extends||function(){var a=function(l,h){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var E in c)Object.prototype.hasOwnProperty.call(c,E)&&(s[E]=c[E])},a(l,h)};return function(l,h){a(l,h);function s(){this.constructor=l}l.prototype=h===null?Object.create(h):(s.prototype=h.prototype,new s)}}(),Y9=Fe&&Fe.__createBinding||(Object.create?function(a,l,h,s){s===void 0&&(s=h),Object.defineProperty(a,s,{enumerable:!0,get:function(){return l[h]}})}:function(a,l,h,s){s===void 0&&(s=h),a[s]=l[h]}),K9=Fe&&Fe.__setModuleDefault||(Object.create?function(a,l){Object.defineProperty(a,"default",{enumerable:!0,value:l})}:function(a,l){a.default=l}),Q9=Fe&&Fe.__importStar||function(a){if(a&&a.__esModule)return a;var l={};if(a!=null)for(var h in a)h!=="default"&&Object.prototype.hasOwnProperty.call(a,h)&&Y9(l,a,h);return K9(l,a),l};Object.defineProperty(iy,"__esModule",{value:!0});var q9=Q9(Xn),Lc=Yn,hp=jn,Z9=Lc.keyframes(L1||(L1=w1([`
  0% {transform: scale(1);opacity: 1}
  45% {transform: scale(0.1);opacity: 0.7}
  80% {transform: scale(1);opacity: 1}
`],[`
  0% {transform: scale(1);opacity: 1}
  45% {transform: scale(0.1);opacity: 0.7}
  80% {transform: scale(1);opacity: 1}
`]))),$9=function(a){X9(l,a);function l(){var h=a!==null&&a.apply(this,arguments)||this;return h.style=function(s){var c=h.props,E=c.color,m=c.size,S=c.margin,d=c.speedMultiplier;return Lc.css(N1||(N1=w1([`
      background-color: `,`;
      width: `,`;
      height: `,`;
      margin: `,`;
      border-radius: 100%;
      display: inline-block;
      animation: `," ","s ",`s infinite
        cubic-bezier(0.2, 0.68, 0.18, 1.08);
      animation-fill-mode: both;
    `],[`
      background-color: `,`;
      width: `,`;
      height: `,`;
      margin: `,`;
      border-radius: 100%;
      display: inline-block;
      animation: `," ","s ",`s infinite
        cubic-bezier(0.2, 0.68, 0.18, 1.08);
      animation-fill-mode: both;
    `])),E,hp.cssValue(m),hp.cssValue(m),hp.cssValue(S),Z9,.75/d,s*.12/d)},h}return l.prototype.render=function(){var h=this.props,s=h.loading,c=h.css;return s?Lc.jsx("span",{css:[c]},Lc.jsx("span",{css:this.style(1)}),Lc.jsx("span",{css:this.style(2)}),Lc.jsx("span",{css:this.style(3)})):null},l.defaultProps=hp.sizeMarginDefaults(15),l}(q9.PureComponent);iy.default=$9;var L1,N1,oy={},dp=Fe&&Fe.__makeTemplateObject||function(a,l){return Object.defineProperty?Object.defineProperty(a,"raw",{value:l}):a.raw=l,a},J9=Fe&&Fe.__extends||function(){var a=function(l,h){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var E in c)Object.prototype.hasOwnProperty.call(c,E)&&(s[E]=c[E])},a(l,h)};return function(l,h){a(l,h);function s(){this.constructor=l}l.prototype=h===null?Object.create(h):(s.prototype=h.prototype,new s)}}(),eQ=Fe&&Fe.__createBinding||(Object.create?function(a,l,h,s){s===void 0&&(s=h),Object.defineProperty(a,s,{enumerable:!0,get:function(){return l[h]}})}:function(a,l,h,s){s===void 0&&(s=h),a[s]=l[h]}),tQ=Fe&&Fe.__setModuleDefault||(Object.create?function(a,l){Object.defineProperty(a,"default",{enumerable:!0,value:l})}:function(a,l){a.default=l}),nQ=Fe&&Fe.__importStar||function(a){if(a&&a.__esModule)return a;var l={};if(a!=null)for(var h in a)h!=="default"&&Object.prototype.hasOwnProperty.call(a,h)&&eQ(l,a,h);return tQ(l,a),l};Object.defineProperty(oy,"__esModule",{value:!0});var rQ=nQ(Xn),os=Yn,zu=jn,F1=[os.keyframes(B1||(B1=dp([`
  0%  {transform: scale(0)}
  100% {transform: scale(1.0)}
`],[`
  0%  {transform: scale(0)}
  100% {transform: scale(1.0)}
`]))),os.keyframes(U1||(U1=dp([`
  0%  {opacity: 1}
  100% {opacity: 0}
`],[`
  0%  {opacity: 1}
  100% {opacity: 0}
`])))],iQ=function(a){J9(l,a);function l(){var h=a!==null&&a.apply(this,arguments)||this;return h.getSize=function(){return h.props.size},h.style=function(s){var c=h.props,E=c.color,m=c.speedMultiplier;return os.css(V1||(V1=dp([`
      position: absolute;
      height: `,`;
      width: `,`;
      border: thick solid `,`;
      border-radius: 50%;
      opacity: 1;
      top: 0;
      left: 0;
      animation-fill-mode: both;
      animation: `,", ",`;
      animation-duration: `,`s;
      animation-iteration-count: infinite;
      animation-timing-function: cubic-bezier(0.165, 0.84, 0.44, 1), cubic-bezier(0.3, 0.61, 0.355, 1);
      animation-delay: `,`;
    `],[`
      position: absolute;
      height: `,`;
      width: `,`;
      border: thick solid `,`;
      border-radius: 50%;
      opacity: 1;
      top: 0;
      left: 0;
      animation-fill-mode: both;
      animation: `,", ",`;
      animation-duration: `,`s;
      animation-iteration-count: infinite;
      animation-timing-function: cubic-bezier(0.165, 0.84, 0.44, 1), cubic-bezier(0.3, 0.61, 0.355, 1);
      animation-delay: `,`;
    `])),zu.cssValue(h.getSize()),zu.cssValue(h.getSize()),E,F1[0],F1[1],2/m,s===1?"-1s":"0s")},h.wrapper=function(){return os.css(k1||(k1=dp([`
      position: relative;
      width: `,`;
      height: `,`;
    `],[`
      position: relative;
      width: `,`;
      height: `,`;
    `])),zu.cssValue(h.getSize()),zu.cssValue(h.getSize()))},h}return l.prototype.render=function(){var h=this.props,s=h.loading,c=h.css;return s?os.jsx("span",{css:[this.wrapper(),c]},os.jsx("span",{css:this.style(1)}),os.jsx("span",{css:this.style(2)})):null},l.defaultProps=zu.sizeDefaults(60),l}(rQ.PureComponent);oy.default=iQ;var B1,U1,V1,k1,ay={},fp=Fe&&Fe.__makeTemplateObject||function(a,l){return Object.defineProperty?Object.defineProperty(a,"raw",{value:l}):a.raw=l,a},oQ=Fe&&Fe.__extends||function(){var a=function(l,h){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var E in c)Object.prototype.hasOwnProperty.call(c,E)&&(s[E]=c[E])},a(l,h)};return function(l,h){a(l,h);function s(){this.constructor=l}l.prototype=h===null?Object.create(h):(s.prototype=h.prototype,new s)}}(),aQ=Fe&&Fe.__createBinding||(Object.create?function(a,l,h,s){s===void 0&&(s=h),Object.defineProperty(a,s,{enumerable:!0,get:function(){return l[h]}})}:function(a,l,h,s){s===void 0&&(s=h),a[s]=l[h]}),sQ=Fe&&Fe.__setModuleDefault||(Object.create?function(a,l){Object.defineProperty(a,"default",{enumerable:!0,value:l})}:function(a,l){a.default=l}),cQ=Fe&&Fe.__importStar||function(a){if(a&&a.__esModule)return a;var l={};if(a!=null)for(var h in a)h!=="default"&&Object.prototype.hasOwnProperty.call(a,h)&&aQ(l,a,h);return sQ(l,a),l};Object.defineProperty(ay,"__esModule",{value:!0});var lQ=cQ(Xn),as=Yn,pp=jn,uQ=as.keyframes(j1||(j1=fp([`
  0% {transform: rotateX(0deg) rotateY(0deg) rotateZ(0deg)}
  100% {transform: rotateX(180deg) rotateY(360deg) rotateZ(360deg)}
`],[`
  0% {transform: rotateX(0deg) rotateY(0deg) rotateZ(0deg)}
  100% {transform: rotateX(180deg) rotateY(360deg) rotateZ(360deg)}
`]))),hQ=as.keyframes(z1||(z1=fp([`
  0% {transform: rotateX(0deg) rotateY(0deg) rotateZ(0deg)}
  100% {transform: rotateX(360deg) rotateY(180deg) rotateZ(360deg)}
`],[`
  0% {transform: rotateX(0deg) rotateY(0deg) rotateZ(0deg)}
  100% {transform: rotateX(360deg) rotateY(180deg) rotateZ(360deg)}
`]))),dQ=function(a){oQ(l,a);function l(){var h=a!==null&&a.apply(this,arguments)||this;return h.getSize=function(){return h.props.size},h.style=function(s){var c=h.props,E=c.color,m=c.speedMultiplier,S=pp.parseLengthAndUnit(h.getSize()),d=S.value,M=S.unit;return as.css(G1||(G1=fp([`
      position: absolute;
      top: 0;
      left: 0;
      width: `,`;
      height: `,`;
      border: `," solid ",`;
      opacity: 0.4;
      border-radius: 100%;
      animation-fill-mode: forwards;
      perspective: 800px;
      animation: `," ",`s 0s infinite linear;
    `],[`
      position: absolute;
      top: 0;
      left: 0;
      width: `,`;
      height: `,`;
      border: `," solid ",`;
      opacity: 0.4;
      border-radius: 100%;
      animation-fill-mode: forwards;
      perspective: 800px;
      animation: `," ",`s 0s infinite linear;
    `])),""+d+M,""+d+M,""+d/10+M,E,s===1?uQ:hQ,2/m)},h.wrapper=function(){return as.css(H1||(H1=fp([`
      width: `,`;
      height: `,`;
      position: relative;
    `],[`
      width: `,`;
      height: `,`;
      position: relative;
    `])),pp.cssValue(h.getSize()),pp.cssValue(h.getSize()))},h}return l.prototype.render=function(){var h=this.props,s=h.loading,c=h.css;return s?as.jsx("span",{css:[this.wrapper(),c]},as.jsx("span",{css:this.style(1)}),as.jsx("span",{css:this.style(2)})):null},l.defaultProps=pp.sizeDefaults(60),l}(lQ.PureComponent);ay.default=dQ;var j1,z1,G1,H1,sy={},cy=Fe&&Fe.__makeTemplateObject||function(a,l){return Object.defineProperty?Object.defineProperty(a,"raw",{value:l}):a.raw=l,a},fQ=Fe&&Fe.__extends||function(){var a=function(l,h){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var E in c)Object.prototype.hasOwnProperty.call(c,E)&&(s[E]=c[E])},a(l,h)};return function(l,h){a(l,h);function s(){this.constructor=l}l.prototype=h===null?Object.create(h):(s.prototype=h.prototype,new s)}}(),pQ=Fe&&Fe.__createBinding||(Object.create?function(a,l,h,s){s===void 0&&(s=h),Object.defineProperty(a,s,{enumerable:!0,get:function(){return l[h]}})}:function(a,l,h,s){s===void 0&&(s=h),a[s]=l[h]}),mQ=Fe&&Fe.__setModuleDefault||(Object.create?function(a,l){Object.defineProperty(a,"default",{enumerable:!0,value:l})}:function(a,l){a.default=l}),_Q=Fe&&Fe.__importStar||function(a){if(a&&a.__esModule)return a;var l={};if(a!=null)for(var h in a)h!=="default"&&Object.prototype.hasOwnProperty.call(a,h)&&pQ(l,a,h);return mQ(l,a),l};Object.defineProperty(sy,"__esModule",{value:!0});var gQ=_Q(Xn),wo=Yn,mp=jn,_p=30,vQ=wo.keyframes(W1||(W1=cy([`
  0% {transform: scale(1.1)}
  25% {transform: translateY(-`,`px)}
  50% {transform: scale(0.4)}
  75% {transform: translateY(`,`px)}
  100% {transform: translateY(0) scale(1.0)}
`],[`
  0% {transform: scale(1.1)}
  25% {transform: translateY(-`,`px)}
  50% {transform: scale(0.4)}
  75% {transform: translateY(`,`px)}
  100% {transform: translateY(0) scale(1.0)}
`])),_p,_p),bQ=wo.keyframes(X1||(X1=cy([`
  0% {transform: scale(0.4)}
  25% {transform: translateY(`,`px)}
  50% {transform: scale(1.1)}
  75% {transform: translateY(`,`px)}
  100% {transform: translateY(0) scale(0.75)}
`],[`
  0% {transform: scale(0.4)}
  25% {transform: translateY(`,`px)}
  50% {transform: scale(1.1)}
  75% {transform: translateY(`,`px)}
  100% {transform: translateY(0) scale(0.75)}
`])),_p,-_p),yQ=function(a){fQ(l,a);function l(){var h=a!==null&&a.apply(this,arguments)||this;return h.style=function(s){var c=h.props,E=c.color,m=c.size,S=c.margin,d=c.speedMultiplier;return wo.css(Y1||(Y1=cy([`
      background-color: `,`;
      width: `,`;
      height: `,`;
      margin: `,`;
      border-radius: 100%;
      display: inline-block;
      animation: `," ",`s 0s infinite cubic-bezier(0.15, 0.46, 0.9, 0.6);
      animation-fill-mode: both;
    `],[`
      background-color: `,`;
      width: `,`;
      height: `,`;
      margin: `,`;
      border-radius: 100%;
      display: inline-block;
      animation: `," ",`s 0s infinite cubic-bezier(0.15, 0.46, 0.9, 0.6);
      animation-fill-mode: both;
    `])),E,mp.cssValue(m),mp.cssValue(m),mp.cssValue(S),s%2==0?vQ:bQ,1/d)},h}return l.prototype.render=function(){var h=this.props,s=h.loading,c=h.css;return s?wo.jsx("span",{css:[c]},wo.jsx("span",{css:this.style(1)}),wo.jsx("span",{css:this.style(2)}),wo.jsx("span",{css:this.style(3)}),wo.jsx("span",{css:this.style(4)}),wo.jsx("span",{css:this.style(5)})):null},l.defaultProps=mp.sizeMarginDefaults(15),l}(gQ.PureComponent);sy.default=yQ;var W1,X1,Y1,ly={},Nc=Fe&&Fe.__makeTemplateObject||function(a,l){return Object.defineProperty?Object.defineProperty(a,"raw",{value:l}):a.raw=l,a},TQ=Fe&&Fe.__extends||function(){var a=function(l,h){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var E in c)Object.prototype.hasOwnProperty.call(c,E)&&(s[E]=c[E])},a(l,h)};return function(l,h){a(l,h);function s(){this.constructor=l}l.prototype=h===null?Object.create(h):(s.prototype=h.prototype,new s)}}(),EQ=Fe&&Fe.__createBinding||(Object.create?function(a,l,h,s){s===void 0&&(s=h),Object.defineProperty(a,s,{enumerable:!0,get:function(){return l[h]}})}:function(a,l,h,s){s===void 0&&(s=h),a[s]=l[h]}),SQ=Fe&&Fe.__setModuleDefault||(Object.create?function(a,l){Object.defineProperty(a,"default",{enumerable:!0,value:l})}:function(a,l){a.default=l}),xQ=Fe&&Fe.__importStar||function(a){if(a&&a.__esModule)return a;var l={};if(a!=null)for(var h in a)h!=="default"&&Object.prototype.hasOwnProperty.call(a,h)&&EQ(l,a,h);return SQ(l,a),l};Object.defineProperty(ly,"__esModule",{value:!0});var AQ=xQ(Xn),Lo=Yn,gp=jn,PQ=Lo.keyframes(K1||(K1=Nc([`
  0% {transform: rotate(0deg)}
  50% {transform: rotate(180deg)}
  100% {transform: rotate(360deg)}
`],[`
  0% {transform: rotate(0deg)}
  50% {transform: rotate(180deg)}
  100% {transform: rotate(360deg)}
`]))),CQ=function(a){TQ(l,a);function l(){var h=a!==null&&a.apply(this,arguments)||this;return h.style=function(s){var c=h.props.margin,E=gp.parseLengthAndUnit(c),m=E.value,S=E.unit,d=(s%2?-1:1)*(26+m);return Lo.css(Q1||(Q1=Nc([`
      opacity: 0.8;
      position: absolute;
      top: 0;
      left: `,"",`;
    `],[`
      opacity: 0.8;
      position: absolute;
      top: 0;
      left: `,"",`;
    `])),d,S)},h.ball=function(){var s=h.props,c=s.color,E=s.size;return Lo.css(q1||(q1=Nc([`
      background-color: `,`;
      width: `,`;
      height: `,`;
      border-radius: 100%;
    `],[`
      background-color: `,`;
      width: `,`;
      height: `,`;
      border-radius: 100%;
    `])),c,gp.cssValue(E),gp.cssValue(E))},h.wrapper=function(){var s=h.props.speedMultiplier;return Lo.css(Z1||(Z1=Nc([`
      `,`;
      display: inline-block;
      position: relative;
      animation-fill-mode: both;
      animation: `," ",`s 0s infinite cubic-bezier(0.7, -0.13, 0.22, 0.86);
    `],[`
      `,`;
      display: inline-block;
      position: relative;
      animation-fill-mode: both;
      animation: `," ",`s 0s infinite cubic-bezier(0.7, -0.13, 0.22, 0.86);
    `])),h.ball(),PQ,1/s)},h.long=function(){return Lo.css($1||($1=Nc([`
    `,`;
    `,`;
  `],[`
    `,`;
    `,`;
  `])),h.ball(),h.style(1))},h.short=function(){return Lo.css(J1||(J1=Nc([`
    `,`;
    `,`;
  `],[`
    `,`;
    `,`;
  `])),h.ball(),h.style(2))},h}return l.prototype.render=function(){var h=this.props,s=h.loading,c=h.css;return s?Lo.jsx("span",{css:[this.wrapper(),c]},Lo.jsx("span",{css:this.long()}),Lo.jsx("span",{css:this.short()})):null},l.defaultProps=gp.sizeMarginDefaults(15),l}(AQ.PureComponent);ly.default=CQ;var K1,Q1,q1,Z1,$1,J1,uy={},eI=Fe&&Fe.__makeTemplateObject||function(a,l){return Object.defineProperty?Object.defineProperty(a,"raw",{value:l}):a.raw=l,a},RQ=Fe&&Fe.__extends||function(){var a=function(l,h){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var E in c)Object.prototype.hasOwnProperty.call(c,E)&&(s[E]=c[E])},a(l,h)};return function(l,h){a(l,h);function s(){this.constructor=l}l.prototype=h===null?Object.create(h):(s.prototype=h.prototype,new s)}}(),OQ=Fe&&Fe.__createBinding||(Object.create?function(a,l,h,s){s===void 0&&(s=h),Object.defineProperty(a,s,{enumerable:!0,get:function(){return l[h]}})}:function(a,l,h,s){s===void 0&&(s=h),a[s]=l[h]}),MQ=Fe&&Fe.__setModuleDefault||(Object.create?function(a,l){Object.defineProperty(a,"default",{enumerable:!0,value:l})}:function(a,l){a.default=l}),IQ=Fe&&Fe.__importStar||function(a){if(a&&a.__esModule)return a;var l={};if(a!=null)for(var h in a)h!=="default"&&Object.prototype.hasOwnProperty.call(a,h)&&OQ(l,a,h);return MQ(l,a),l};Object.defineProperty(uy,"__esModule",{value:!0});var DQ=IQ(Xn),Ea=Yn,Gu=jn,wQ=Ea.keyframes(tI||(tI=eI([`
  0% {transform: scaley(1.0)}
  50% {transform: scaley(0.4)}
  100% {transform: scaley(1.0)}
`],[`
  0% {transform: scaley(1.0)}
  50% {transform: scaley(0.4)}
  100% {transform: scaley(1.0)}
`]))),LQ=function(a){RQ(l,a);function l(){var h=a!==null&&a.apply(this,arguments)||this;return h.style=function(s){var c=h.props,E=c.color,m=c.width,S=c.height,d=c.margin,M=c.radius,C=c.speedMultiplier;return Ea.css(nI||(nI=eI([`
      background-color: `,`;
      width: `,`;
      height: `,`;
      margin: `,`;
      border-radius: `,`;
      display: inline-block;
      animation: `," ","s ",`s infinite cubic-bezier(0.2, 0.68, 0.18, 1.08);
      animation-fill-mode: both;
    `],[`
      background-color: `,`;
      width: `,`;
      height: `,`;
      margin: `,`;
      border-radius: `,`;
      display: inline-block;
      animation: `," ","s ",`s infinite cubic-bezier(0.2, 0.68, 0.18, 1.08);
      animation-fill-mode: both;
    `])),E,Gu.cssValue(m),Gu.cssValue(S),Gu.cssValue(d),Gu.cssValue(M),wQ,1/C,s*.1)},h}return l.prototype.render=function(){var h=this.props,s=h.loading,c=h.css;return s?Ea.jsx("span",{css:[c]},Ea.jsx("span",{css:this.style(1)}),Ea.jsx("span",{css:this.style(2)}),Ea.jsx("span",{css:this.style(3)}),Ea.jsx("span",{css:this.style(4)}),Ea.jsx("span",{css:this.style(5)})):null},l.defaultProps=Gu.heightWidthRadiusDefaults(35,4,2),l}(DQ.PureComponent);uy.default=LQ;var tI,nI,hy={},rI=Fe&&Fe.__makeTemplateObject||function(a,l){return Object.defineProperty?Object.defineProperty(a,"raw",{value:l}):a.raw=l,a},NQ=Fe&&Fe.__extends||function(){var a=function(l,h){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var E in c)Object.prototype.hasOwnProperty.call(c,E)&&(s[E]=c[E])},a(l,h)};return function(l,h){a(l,h);function s(){this.constructor=l}l.prototype=h===null?Object.create(h):(s.prototype=h.prototype,new s)}}(),FQ=Fe&&Fe.__createBinding||(Object.create?function(a,l,h,s){s===void 0&&(s=h),Object.defineProperty(a,s,{enumerable:!0,get:function(){return l[h]}})}:function(a,l,h,s){s===void 0&&(s=h),a[s]=l[h]}),BQ=Fe&&Fe.__setModuleDefault||(Object.create?function(a,l){Object.defineProperty(a,"default",{enumerable:!0,value:l})}:function(a,l){a.default=l}),UQ=Fe&&Fe.__importStar||function(a){if(a&&a.__esModule)return a;var l={};if(a!=null)for(var h in a)h!=="default"&&Object.prototype.hasOwnProperty.call(a,h)&&FQ(l,a,h);return BQ(l,a),l};Object.defineProperty(hy,"__esModule",{value:!0});var VQ=UQ(Xn),dy=Yn,vp=jn,kQ=dy.keyframes(iI||(iI=rI([`
  25% {transform: perspective(100px) rotateX(180deg) rotateY(0)}
  50% {transform: perspective(100px) rotateX(180deg) rotateY(180deg)}
  75% {transform: perspective(100px) rotateX(0) rotateY(180deg)}
  100% {transform: perspective(100px) rotateX(0) rotateY(0)}
`],[`
  25% {transform: perspective(100px) rotateX(180deg) rotateY(0)}
  50% {transform: perspective(100px) rotateX(180deg) rotateY(180deg)}
  75% {transform: perspective(100px) rotateX(0) rotateY(180deg)}
  100% {transform: perspective(100px) rotateX(0) rotateY(0)}
`]))),jQ=function(a){NQ(l,a);function l(){var h=a!==null&&a.apply(this,arguments)||this;return h.style=function(){var s=h.props,c=s.color,E=s.speedMultiplier,m=s.size;return dy.css(oI||(oI=rI([`
      width: 0;
      height: 0;
      border-left: `,` solid transparent;
      border-right: `,` solid transparent;
      border-bottom: `," solid ",`;
      display: inline-block;
      animation: `," ",`s 0s infinite cubic-bezier(0.09, 0.57, 0.49, 0.9);
      animation-fill-mode: both;
    `],[`
      width: 0;
      height: 0;
      border-left: `,` solid transparent;
      border-right: `,` solid transparent;
      border-bottom: `," solid ",`;
      display: inline-block;
      animation: `," ",`s 0s infinite cubic-bezier(0.09, 0.57, 0.49, 0.9);
      animation-fill-mode: both;
    `])),vp.cssValue(m),vp.cssValue(m),vp.cssValue(m),c,kQ,3/E)},h}return l.prototype.render=function(){var h=this.props,s=h.loading,c=h.css;return s?dy.jsx("span",{css:[this.style(),c]}):null},l.defaultProps=vp.sizeDefaults(20),l}(VQ.PureComponent);hy.default=jQ;var iI,oI,fy={},aI=Fe&&Fe.__makeTemplateObject||function(a,l){return Object.defineProperty?Object.defineProperty(a,"raw",{value:l}):a.raw=l,a},zQ=Fe&&Fe.__extends||function(){var a=function(l,h){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var E in c)Object.prototype.hasOwnProperty.call(c,E)&&(s[E]=c[E])},a(l,h)};return function(l,h){a(l,h);function s(){this.constructor=l}l.prototype=h===null?Object.create(h):(s.prototype=h.prototype,new s)}}(),GQ=Fe&&Fe.__createBinding||(Object.create?function(a,l,h,s){s===void 0&&(s=h),Object.defineProperty(a,s,{enumerable:!0,get:function(){return l[h]}})}:function(a,l,h,s){s===void 0&&(s=h),a[s]=l[h]}),HQ=Fe&&Fe.__setModuleDefault||(Object.create?function(a,l){Object.defineProperty(a,"default",{enumerable:!0,value:l})}:function(a,l){a.default=l}),WQ=Fe&&Fe.__importStar||function(a){if(a&&a.__esModule)return a;var l={};if(a!=null)for(var h in a)h!=="default"&&Object.prototype.hasOwnProperty.call(a,h)&&GQ(l,a,h);return HQ(l,a),l};Object.defineProperty(fy,"__esModule",{value:!0});var XQ=WQ(Xn),py=Yn,my=jn,YQ=py.keyframes(sI||(sI=aI([`
  25% {transform: rotateX(180deg) rotateY(0)}
  50% {transform: rotateX(180deg) rotateY(180deg)}
  75% {transform: rotateX(0) rotateY(180deg)}
  100% {transform: rotateX(0) rotateY(0)}
`],[`
  25% {transform: rotateX(180deg) rotateY(0)}
  50% {transform: rotateX(180deg) rotateY(180deg)}
  75% {transform: rotateX(0) rotateY(180deg)}
  100% {transform: rotateX(0) rotateY(0)}
`]))),KQ=function(a){zQ(l,a);function l(){var h=a!==null&&a.apply(this,arguments)||this;return h.style=function(){var s=h.props,c=s.color,E=s.size,m=s.speedMultiplier;return py.css(cI||(cI=aI([`
      background-color: `,`;
      width: `,`;
      height: `,`;
      display: inline-block;
      animation: `," ",`s 0s infinite cubic-bezier(0.09, 0.57, 0.49, 0.9);
      animation-fill-mode: both;
    `],[`
      background-color: `,`;
      width: `,`;
      height: `,`;
      display: inline-block;
      animation: `," ",`s 0s infinite cubic-bezier(0.09, 0.57, 0.49, 0.9);
      animation-fill-mode: both;
    `])),c,my.cssValue(E),my.cssValue(E),YQ,3/m)},h}return l.prototype.render=function(){var h=this.props,s=h.loading,c=h.css;return s?py.jsx("span",{css:[this.style(),c]}):null},l.defaultProps=my.sizeDefaults(50),l}(XQ.PureComponent);fy.default=KQ;var sI,cI,_y={},lI=Fe&&Fe.__makeTemplateObject||function(a,l){return Object.defineProperty?Object.defineProperty(a,"raw",{value:l}):a.raw=l,a},QQ=Fe&&Fe.__extends||function(){var a=function(l,h){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var E in c)Object.prototype.hasOwnProperty.call(c,E)&&(s[E]=c[E])},a(l,h)};return function(l,h){a(l,h);function s(){this.constructor=l}l.prototype=h===null?Object.create(h):(s.prototype=h.prototype,new s)}}(),qQ=Fe&&Fe.__createBinding||(Object.create?function(a,l,h,s){s===void 0&&(s=h),Object.defineProperty(a,s,{enumerable:!0,get:function(){return l[h]}})}:function(a,l,h,s){s===void 0&&(s=h),a[s]=l[h]}),ZQ=Fe&&Fe.__setModuleDefault||(Object.create?function(a,l){Object.defineProperty(a,"default",{enumerable:!0,value:l})}:function(a,l){a.default=l}),$Q=Fe&&Fe.__importStar||function(a){if(a&&a.__esModule)return a;var l={};if(a!=null)for(var h in a)h!=="default"&&Object.prototype.hasOwnProperty.call(a,h)&&qQ(l,a,h);return ZQ(l,a),l};Object.defineProperty(_y,"__esModule",{value:!0});var JQ=$Q(Xn),Fc=Yn,eq=Bi,gy=jn,tq=Fc.keyframes(uI||(uI=lI([`
  33% {transform: translateY(10px)}
  66% {transform: translateY(-10px)}
  100% {transform: translateY(0)}
`],[`
  33% {transform: translateY(10px)}
  66% {transform: translateY(-10px)}
  100% {transform: translateY(0)}
`]))),nq=function(a){QQ(l,a);function l(){var h=a!==null&&a.apply(this,arguments)||this;return h.style=function(s){var c=h.props,E=c.color,m=c.size,S=c.margin,d=c.speedMultiplier;return Fc.css(hI||(hI=lI([`
      background-color: `,`;
      width: `,`;
      height: `,`;
      margin: `,`;
      border-radius: 100%;
      display: inline-block;
      animation: `," ","s ",`s infinite ease-in-out;
      animation-fill-mode: both;
    `],[`
      background-color: `,`;
      width: `,`;
      height: `,`;
      margin: `,`;
      border-radius: 100%;
      display: inline-block;
      animation: `," ","s ",`s infinite ease-in-out;
      animation-fill-mode: both;
    `])),E,gy.cssValue(m),gy.cssValue(m),gy.cssValue(S),tq,.6/d,s*.07)},h}return l.prototype.render=function(){var h=this.props,s=h.loading,c=h.css;return s?Fc.jsx("span",{css:[c]},Fc.jsx("span",{css:this.style(1)}),Fc.jsx("span",{css:this.style(2)}),Fc.jsx("span",{css:this.style(3)})):null},l.defaultProps=eq.sizeMarginDefaults(15),l}(JQ.PureComponent);_y.default=nq;var uI,hI;(function(a){var l=Fe&&Fe.__importDefault||function(L){return L&&L.__esModule?L:{default:L}};Object.defineProperty(a,"__esModule",{value:!0}),a.SyncLoader=a.SquareLoader=a.SkewLoader=a.ScaleLoader=a.RotateLoader=a.RiseLoader=a.RingLoader=a.PuffLoader=a.PulseLoader=a.PropagateLoader=a.PacmanLoader=a.MoonLoader=a.HashLoader=a.GridLoader=a.FadeLoader=a.DotLoader=a.ClockLoader=a.ClipLoader=a.ClimbingBoxLoader=a.CircleLoader=a.BounceLoader=a.BeatLoader=a.BarLoader=void 0;var h=Ub;Object.defineProperty(a,"BarLoader",{enumerable:!0,get:function(){return l(h).default}});var s=Vb;Object.defineProperty(a,"BeatLoader",{enumerable:!0,get:function(){return l(s).default}});var c=kb;Object.defineProperty(a,"BounceLoader",{enumerable:!0,get:function(){return l(c).default}});var E=zb;Object.defineProperty(a,"CircleLoader",{enumerable:!0,get:function(){return l(E).default}});var m=Hb;Object.defineProperty(a,"ClimbingBoxLoader",{enumerable:!0,get:function(){return l(m).default}});var S=Wb;Object.defineProperty(a,"ClipLoader",{enumerable:!0,get:function(){return l(S).default}});var d=Kb;Object.defineProperty(a,"ClockLoader",{enumerable:!0,get:function(){return l(d).default}});var M=qb;Object.defineProperty(a,"DotLoader",{enumerable:!0,get:function(){return l(M).default}});var C=Zb;Object.defineProperty(a,"FadeLoader",{enumerable:!0,get:function(){return l(C).default}});var I=$b;Object.defineProperty(a,"GridLoader",{enumerable:!0,get:function(){return l(I).default}});var b=ey;Object.defineProperty(a,"HashLoader",{enumerable:!0,get:function(){return l(b).default}});var p=ty;Object.defineProperty(a,"MoonLoader",{enumerable:!0,get:function(){return l(p).default}});var x=ny;Object.defineProperty(a,"PacmanLoader",{enumerable:!0,get:function(){return l(x).default}});var P=ry;Object.defineProperty(a,"PropagateLoader",{enumerable:!0,get:function(){return l(P).default}});var A=iy;Object.defineProperty(a,"PulseLoader",{enumerable:!0,get:function(){return l(A).default}});var T=oy;Object.defineProperty(a,"PuffLoader",{enumerable:!0,get:function(){return l(T).default}});var _=ay;Object.defineProperty(a,"RingLoader",{enumerable:!0,get:function(){return l(_).default}});var g=sy;Object.defineProperty(a,"RiseLoader",{enumerable:!0,get:function(){return l(g).default}});var O=ly;Object.defineProperty(a,"RotateLoader",{enumerable:!0,get:function(){return l(O).default}});var R=uy;Object.defineProperty(a,"ScaleLoader",{enumerable:!0,get:function(){return l(R).default}});var N=hy;Object.defineProperty(a,"SkewLoader",{enumerable:!0,get:function(){return l(N).default}});var V=fy;Object.defineProperty(a,"SquareLoader",{enumerable:!0,get:function(){return l(V).default}});var U=_y;Object.defineProperty(a,"SyncLoader",{enumerable:!0,get:function(){return l(U).default}})})(ZK);var bp={exports:{}};(function(a,l){(function(h,s){a.exports=s()})(typeof self!="undefined"?self:Fe,function(){return function(h){var s={};function c(E){if(s[E])return s[E].exports;var m=s[E]={i:E,l:!1,exports:{}};return h[E].call(m.exports,m,m.exports,c),m.l=!0,m.exports}return c.m=h,c.c=s,c.d=function(E,m,S){c.o(E,m)||Object.defineProperty(E,m,{enumerable:!0,get:S})},c.r=function(E){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(E,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(E,"__esModule",{value:!0})},c.t=function(E,m){if(1&m&&(E=c(E)),8&m||4&m&&typeof E=="object"&&E&&E.__esModule)return E;var S=Object.create(null);if(c.r(S),Object.defineProperty(S,"default",{enumerable:!0,value:E}),2&m&&typeof E!="string")for(var d in E)c.d(S,d,function(M){return E[M]}.bind(null,d));return S},c.n=function(E){var m=E&&E.__esModule?function(){return E.default}:function(){return E};return c.d(m,"a",m),m},c.o=function(E,m){return Object.prototype.hasOwnProperty.call(E,m)},c.p="",c(c.s=169)}([function(h,s,c){c.d(s,"d",function(){return C}),c.d(s,"e",function(){return I}),c.d(s,"f",function(){return b}),c.d(s,"b",function(){return p}),c.d(s,"a",function(){return x}),c.d(s,"c",function(){return A});var E=c(14),m=c(28),S=c(44),d=c(11),M=c(74),C=function(){function T(_,g){_===void 0&&(_=0),g===void 0&&(g=0),this.x=_,this.y=g}return T.prototype.toString=function(){return"{X: "+this.x+" Y: "+this.y+"}"},T.prototype.getClassName=function(){return"Vector2"},T.prototype.getHashCode=function(){var _=0|this.x;return _=397*_^(0|this.y)},T.prototype.toArray=function(_,g){return g===void 0&&(g=0),_[g]=this.x,_[g+1]=this.y,this},T.prototype.fromArray=function(_,g){return g===void 0&&(g=0),T.FromArrayToRef(_,g,this),this},T.prototype.asArray=function(){var _=new Array;return this.toArray(_,0),_},T.prototype.copyFrom=function(_){return this.x=_.x,this.y=_.y,this},T.prototype.copyFromFloats=function(_,g){return this.x=_,this.y=g,this},T.prototype.set=function(_,g){return this.copyFromFloats(_,g)},T.prototype.add=function(_){return new T(this.x+_.x,this.y+_.y)},T.prototype.addToRef=function(_,g){return g.x=this.x+_.x,g.y=this.y+_.y,this},T.prototype.addInPlace=function(_){return this.x+=_.x,this.y+=_.y,this},T.prototype.addVector3=function(_){return new T(this.x+_.x,this.y+_.y)},T.prototype.subtract=function(_){return new T(this.x-_.x,this.y-_.y)},T.prototype.subtractToRef=function(_,g){return g.x=this.x-_.x,g.y=this.y-_.y,this},T.prototype.subtractInPlace=function(_){return this.x-=_.x,this.y-=_.y,this},T.prototype.multiplyInPlace=function(_){return this.x*=_.x,this.y*=_.y,this},T.prototype.multiply=function(_){return new T(this.x*_.x,this.y*_.y)},T.prototype.multiplyToRef=function(_,g){return g.x=this.x*_.x,g.y=this.y*_.y,this},T.prototype.multiplyByFloats=function(_,g){return new T(this.x*_,this.y*g)},T.prototype.divide=function(_){return new T(this.x/_.x,this.y/_.y)},T.prototype.divideToRef=function(_,g){return g.x=this.x/_.x,g.y=this.y/_.y,this},T.prototype.divideInPlace=function(_){return this.divideToRef(_,this)},T.prototype.negate=function(){return new T(-this.x,-this.y)},T.prototype.negateInPlace=function(){return this.x*=-1,this.y*=-1,this},T.prototype.negateToRef=function(_){return _.copyFromFloats(-1*this.x,-1*this.y)},T.prototype.scaleInPlace=function(_){return this.x*=_,this.y*=_,this},T.prototype.scale=function(_){var g=new T(0,0);return this.scaleToRef(_,g),g},T.prototype.scaleToRef=function(_,g){return g.x=this.x*_,g.y=this.y*_,this},T.prototype.scaleAndAddToRef=function(_,g){return g.x+=this.x*_,g.y+=this.y*_,this},T.prototype.equals=function(_){return _&&this.x===_.x&&this.y===_.y},T.prototype.equalsWithEpsilon=function(_,g){return g===void 0&&(g=m.a),_&&E.a.WithinEpsilon(this.x,_.x,g)&&E.a.WithinEpsilon(this.y,_.y,g)},T.prototype.floor=function(){return new T(Math.floor(this.x),Math.floor(this.y))},T.prototype.fract=function(){return new T(this.x-Math.floor(this.x),this.y-Math.floor(this.y))},T.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},T.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y},T.prototype.normalize=function(){var _=this.length();return _===0||(this.x/=_,this.y/=_),this},T.prototype.clone=function(){return new T(this.x,this.y)},T.Zero=function(){return new T(0,0)},T.One=function(){return new T(1,1)},T.FromArray=function(_,g){return g===void 0&&(g=0),new T(_[g],_[g+1])},T.FromArrayToRef=function(_,g,O){O.x=_[g],O.y=_[g+1]},T.CatmullRom=function(_,g,O,R,N){var V=N*N,U=N*V;return new T(.5*(2*g.x+(-_.x+O.x)*N+(2*_.x-5*g.x+4*O.x-R.x)*V+(-_.x+3*g.x-3*O.x+R.x)*U),.5*(2*g.y+(-_.y+O.y)*N+(2*_.y-5*g.y+4*O.y-R.y)*V+(-_.y+3*g.y-3*O.y+R.y)*U))},T.Clamp=function(_,g,O){var R=_.x;R=(R=R>O.x?O.x:R)<g.x?g.x:R;var N=_.y;return new T(R,N=(N=N>O.y?O.y:N)<g.y?g.y:N)},T.Hermite=function(_,g,O,R,N){var V=N*N,U=N*V,L=2*U-3*V+1,j=-2*U+3*V,Y=U-2*V+N,W=U-V;return new T(_.x*L+O.x*j+g.x*Y+R.x*W,_.y*L+O.y*j+g.y*Y+R.y*W)},T.Lerp=function(_,g,O){return new T(_.x+(g.x-_.x)*O,_.y+(g.y-_.y)*O)},T.Dot=function(_,g){return _.x*g.x+_.y*g.y},T.Normalize=function(_){var g=_.clone();return g.normalize(),g},T.Minimize=function(_,g){return new T(_.x<g.x?_.x:g.x,_.y<g.y?_.y:g.y)},T.Maximize=function(_,g){return new T(_.x>g.x?_.x:g.x,_.y>g.y?_.y:g.y)},T.Transform=function(_,g){var O=T.Zero();return T.TransformToRef(_,g,O),O},T.TransformToRef=function(_,g,O){var R=g.m,N=_.x*R[0]+_.y*R[4]+R[12],V=_.x*R[1]+_.y*R[5]+R[13];O.x=N,O.y=V},T.PointInTriangle=function(_,g,O,R){var N=.5*(-O.y*R.x+g.y*(-O.x+R.x)+g.x*(O.y-R.y)+O.x*R.y),V=N<0?-1:1,U=(g.y*R.x-g.x*R.y+(R.y-g.y)*_.x+(g.x-R.x)*_.y)*V,L=(g.x*O.y-g.y*O.x+(g.y-O.y)*_.x+(O.x-g.x)*_.y)*V;return U>0&&L>0&&U+L<2*N*V},T.Distance=function(_,g){return Math.sqrt(T.DistanceSquared(_,g))},T.DistanceSquared=function(_,g){var O=_.x-g.x,R=_.y-g.y;return O*O+R*R},T.Center=function(_,g){var O=_.add(g);return O.scaleInPlace(.5),O},T.DistanceOfPointFromSegment=function(_,g,O){var R=T.DistanceSquared(g,O);if(R===0)return T.Distance(_,g);var N=O.subtract(g),V=Math.max(0,Math.min(1,T.Dot(_.subtract(g),N)/R)),U=g.add(N.multiplyByFloats(V,V));return T.Distance(_,U)},T}(),I=function(){function T(_,g,O){_===void 0&&(_=0),g===void 0&&(g=0),O===void 0&&(O=0),this._isDirty=!0,this._x=_,this._y=g,this._z=O}return Object.defineProperty(T.prototype,"x",{get:function(){return this._x},set:function(_){this._x=_,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"y",{get:function(){return this._y},set:function(_){this._y=_,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"z",{get:function(){return this._z},set:function(_){this._z=_,this._isDirty=!0},enumerable:!1,configurable:!0}),T.prototype.toString=function(){return"{X: "+this._x+" Y:"+this._y+" Z:"+this._z+"}"},T.prototype.getClassName=function(){return"Vector3"},T.prototype.getHashCode=function(){var _=0|this._x;return _=397*(_=397*_^(0|this._y))^(0|this._z)},T.prototype.asArray=function(){var _=[];return this.toArray(_,0),_},T.prototype.toArray=function(_,g){return g===void 0&&(g=0),_[g]=this._x,_[g+1]=this._y,_[g+2]=this._z,this},T.prototype.fromArray=function(_,g){return g===void 0&&(g=0),T.FromArrayToRef(_,g,this),this},T.prototype.toQuaternion=function(){return p.RotationYawPitchRoll(this._y,this._x,this._z)},T.prototype.addInPlace=function(_){return this.addInPlaceFromFloats(_._x,_._y,_._z)},T.prototype.addInPlaceFromFloats=function(_,g,O){return this.x+=_,this.y+=g,this.z+=O,this},T.prototype.add=function(_){return new T(this._x+_._x,this._y+_._y,this._z+_._z)},T.prototype.addToRef=function(_,g){return g.copyFromFloats(this._x+_._x,this._y+_._y,this._z+_._z)},T.prototype.subtractInPlace=function(_){return this.x-=_._x,this.y-=_._y,this.z-=_._z,this},T.prototype.subtract=function(_){return new T(this._x-_._x,this._y-_._y,this._z-_._z)},T.prototype.subtractToRef=function(_,g){return this.subtractFromFloatsToRef(_._x,_._y,_._z,g)},T.prototype.subtractFromFloats=function(_,g,O){return new T(this._x-_,this._y-g,this._z-O)},T.prototype.subtractFromFloatsToRef=function(_,g,O,R){return R.copyFromFloats(this._x-_,this._y-g,this._z-O)},T.prototype.negate=function(){return new T(-this._x,-this._y,-this._z)},T.prototype.negateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},T.prototype.negateToRef=function(_){return _.copyFromFloats(-1*this._x,-1*this._y,-1*this._z)},T.prototype.scaleInPlace=function(_){return this.x*=_,this.y*=_,this.z*=_,this},T.prototype.scale=function(_){return new T(this._x*_,this._y*_,this._z*_)},T.prototype.scaleToRef=function(_,g){return g.copyFromFloats(this._x*_,this._y*_,this._z*_)},T.prototype.scaleAndAddToRef=function(_,g){return g.addInPlaceFromFloats(this._x*_,this._y*_,this._z*_)},T.prototype.projectOnPlane=function(_,g){var O=T.Zero();return this.projectOnPlaneToRef(_,g,O),O},T.prototype.projectOnPlaneToRef=function(_,g,O){var R=_.normal,N=_.d,V=P.Vector3[0];this.subtractToRef(g,V),V.normalize();var U=T.Dot(V,R),L=-(T.Dot(g,R)+N)/U,j=V.scaleInPlace(L);g.addToRef(j,O)},T.prototype.equals=function(_){return _&&this._x===_._x&&this._y===_._y&&this._z===_._z},T.prototype.equalsWithEpsilon=function(_,g){return g===void 0&&(g=m.a),_&&E.a.WithinEpsilon(this._x,_._x,g)&&E.a.WithinEpsilon(this._y,_._y,g)&&E.a.WithinEpsilon(this._z,_._z,g)},T.prototype.equalsToFloats=function(_,g,O){return this._x===_&&this._y===g&&this._z===O},T.prototype.multiplyInPlace=function(_){return this.x*=_._x,this.y*=_._y,this.z*=_._z,this},T.prototype.multiply=function(_){return this.multiplyByFloats(_._x,_._y,_._z)},T.prototype.multiplyToRef=function(_,g){return g.copyFromFloats(this._x*_._x,this._y*_._y,this._z*_._z)},T.prototype.multiplyByFloats=function(_,g,O){return new T(this._x*_,this._y*g,this._z*O)},T.prototype.divide=function(_){return new T(this._x/_._x,this._y/_._y,this._z/_._z)},T.prototype.divideToRef=function(_,g){return g.copyFromFloats(this._x/_._x,this._y/_._y,this._z/_._z)},T.prototype.divideInPlace=function(_){return this.divideToRef(_,this)},T.prototype.minimizeInPlace=function(_){return this.minimizeInPlaceFromFloats(_._x,_._y,_._z)},T.prototype.maximizeInPlace=function(_){return this.maximizeInPlaceFromFloats(_._x,_._y,_._z)},T.prototype.minimizeInPlaceFromFloats=function(_,g,O){return _<this._x&&(this.x=_),g<this._y&&(this.y=g),O<this._z&&(this.z=O),this},T.prototype.maximizeInPlaceFromFloats=function(_,g,O){return _>this._x&&(this.x=_),g>this._y&&(this.y=g),O>this._z&&(this.z=O),this},T.prototype.isNonUniformWithinEpsilon=function(_){var g=Math.abs(this._x),O=Math.abs(this._y);if(!E.a.WithinEpsilon(g,O,_))return!0;var R=Math.abs(this._z);return!E.a.WithinEpsilon(g,R,_)||!E.a.WithinEpsilon(O,R,_)},Object.defineProperty(T.prototype,"isNonUniform",{get:function(){var _=Math.abs(this._x);return _!==Math.abs(this._y)||_!==Math.abs(this._z)},enumerable:!1,configurable:!0}),T.prototype.floor=function(){return new T(Math.floor(this._x),Math.floor(this._y),Math.floor(this._z))},T.prototype.fract=function(){return new T(this._x-Math.floor(this._x),this._y-Math.floor(this._y),this._z-Math.floor(this._z))},T.prototype.length=function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z)},T.prototype.lengthSquared=function(){return this._x*this._x+this._y*this._y+this._z*this._z},T.prototype.normalize=function(){return this.normalizeFromLength(this.length())},T.prototype.reorderInPlace=function(_){var g=this;return(_=_.toLowerCase())==="xyz"||(P.Vector3[0].copyFrom(this),["x","y","z"].forEach(function(O,R){g[O]=P.Vector3[0][_[R]]})),this},T.prototype.rotateByQuaternionToRef=function(_,g){return _.toRotationMatrix(P.Matrix[0]),T.TransformCoordinatesToRef(this,P.Matrix[0],g),g},T.prototype.rotateByQuaternionAroundPointToRef=function(_,g,O){return this.subtractToRef(g,P.Vector3[0]),P.Vector3[0].rotateByQuaternionToRef(_,P.Vector3[0]),g.addToRef(P.Vector3[0],O),O},T.prototype.cross=function(_){return T.Cross(this,_)},T.prototype.normalizeFromLength=function(_){return _===0||_===1?this:this.scaleInPlace(1/_)},T.prototype.normalizeToNew=function(){var _=new T(0,0,0);return this.normalizeToRef(_),_},T.prototype.normalizeToRef=function(_){var g=this.length();return g===0||g===1?_.copyFromFloats(this._x,this._y,this._z):this.scaleToRef(1/g,_)},T.prototype.clone=function(){return new T(this._x,this._y,this._z)},T.prototype.copyFrom=function(_){return this.copyFromFloats(_._x,_._y,_._z)},T.prototype.copyFromFloats=function(_,g,O){return this.x=_,this.y=g,this.z=O,this},T.prototype.set=function(_,g,O){return this.copyFromFloats(_,g,O)},T.prototype.setAll=function(_){return this.x=this.y=this.z=_,this},T.GetClipFactor=function(_,g,O,R){var N=T.Dot(_,O)-R;return N/(N-(T.Dot(g,O)-R))},T.GetAngleBetweenVectors=function(_,g,O){var R=_.normalizeToRef(P.Vector3[1]),N=g.normalizeToRef(P.Vector3[2]),V=T.Dot(R,N),U=P.Vector3[3];return T.CrossToRef(R,N,U),T.Dot(U,O)>0?Math.acos(V):-Math.acos(V)},T.FromArray=function(_,g){return g===void 0&&(g=0),new T(_[g],_[g+1],_[g+2])},T.FromFloatArray=function(_,g){return T.FromArray(_,g)},T.FromArrayToRef=function(_,g,O){O.x=_[g],O.y=_[g+1],O.z=_[g+2]},T.FromFloatArrayToRef=function(_,g,O){return T.FromArrayToRef(_,g,O)},T.FromFloatsToRef=function(_,g,O,R){R.copyFromFloats(_,g,O)},T.Zero=function(){return new T(0,0,0)},T.One=function(){return new T(1,1,1)},T.Up=function(){return new T(0,1,0)},Object.defineProperty(T,"UpReadOnly",{get:function(){return T._UpReadOnly},enumerable:!1,configurable:!0}),Object.defineProperty(T,"ZeroReadOnly",{get:function(){return T._ZeroReadOnly},enumerable:!1,configurable:!0}),T.Down=function(){return new T(0,-1,0)},T.Forward=function(_){return _===void 0&&(_=!1),new T(0,0,_?-1:1)},T.Backward=function(_){return _===void 0&&(_=!1),new T(0,0,_?1:-1)},T.Right=function(){return new T(1,0,0)},T.Left=function(){return new T(-1,0,0)},T.TransformCoordinates=function(_,g){var O=T.Zero();return T.TransformCoordinatesToRef(_,g,O),O},T.TransformCoordinatesToRef=function(_,g,O){T.TransformCoordinatesFromFloatsToRef(_._x,_._y,_._z,g,O)},T.TransformCoordinatesFromFloatsToRef=function(_,g,O,R,N){var V=R.m,U=_*V[0]+g*V[4]+O*V[8]+V[12],L=_*V[1]+g*V[5]+O*V[9]+V[13],j=_*V[2]+g*V[6]+O*V[10]+V[14],Y=1/(_*V[3]+g*V[7]+O*V[11]+V[15]);N.x=U*Y,N.y=L*Y,N.z=j*Y},T.TransformNormal=function(_,g){var O=T.Zero();return T.TransformNormalToRef(_,g,O),O},T.TransformNormalToRef=function(_,g,O){this.TransformNormalFromFloatsToRef(_._x,_._y,_._z,g,O)},T.TransformNormalFromFloatsToRef=function(_,g,O,R,N){var V=R.m;N.x=_*V[0]+g*V[4]+O*V[8],N.y=_*V[1]+g*V[5]+O*V[9],N.z=_*V[2]+g*V[6]+O*V[10]},T.CatmullRom=function(_,g,O,R,N){var V=N*N,U=N*V;return new T(.5*(2*g._x+(-_._x+O._x)*N+(2*_._x-5*g._x+4*O._x-R._x)*V+(-_._x+3*g._x-3*O._x+R._x)*U),.5*(2*g._y+(-_._y+O._y)*N+(2*_._y-5*g._y+4*O._y-R._y)*V+(-_._y+3*g._y-3*O._y+R._y)*U),.5*(2*g._z+(-_._z+O._z)*N+(2*_._z-5*g._z+4*O._z-R._z)*V+(-_._z+3*g._z-3*O._z+R._z)*U))},T.Clamp=function(_,g,O){var R=new T;return T.ClampToRef(_,g,O,R),R},T.ClampToRef=function(_,g,O,R){var N=_._x;N=(N=N>O._x?O._x:N)<g._x?g._x:N;var V=_._y;V=(V=V>O._y?O._y:V)<g._y?g._y:V;var U=_._z;U=(U=U>O._z?O._z:U)<g._z?g._z:U,R.copyFromFloats(N,V,U)},T.CheckExtends=function(_,g,O){g.minimizeInPlace(_),O.maximizeInPlace(_)},T.Hermite=function(_,g,O,R,N){var V=N*N,U=N*V,L=2*U-3*V+1,j=-2*U+3*V,Y=U-2*V+N,W=U-V;return new T(_._x*L+O._x*j+g._x*Y+R._x*W,_._y*L+O._y*j+g._y*Y+R._y*W,_._z*L+O._z*j+g._z*Y+R._z*W)},T.Lerp=function(_,g,O){var R=new T(0,0,0);return T.LerpToRef(_,g,O,R),R},T.LerpToRef=function(_,g,O,R){R.x=_._x+(g._x-_._x)*O,R.y=_._y+(g._y-_._y)*O,R.z=_._z+(g._z-_._z)*O},T.Dot=function(_,g){return _._x*g._x+_._y*g._y+_._z*g._z},T.Cross=function(_,g){var O=T.Zero();return T.CrossToRef(_,g,O),O},T.CrossToRef=function(_,g,O){var R=_._y*g._z-_._z*g._y,N=_._z*g._x-_._x*g._z,V=_._x*g._y-_._y*g._x;O.copyFromFloats(R,N,V)},T.Normalize=function(_){var g=T.Zero();return T.NormalizeToRef(_,g),g},T.NormalizeToRef=function(_,g){_.normalizeToRef(g)},T.Project=function(_,g,O,R){var N=new T;return T.ProjectToRef(_,g,O,R,N),N},T.ProjectToRef=function(_,g,O,R,N){var V=R.width,U=R.height,L=R.x,j=R.y,Y=P.Matrix[1];x.FromValuesToRef(V/2,0,0,0,0,-U/2,0,0,0,0,.5,0,L+V/2,U/2+j,.5,1,Y);var W=P.Matrix[0];return g.multiplyToRef(O,W),W.multiplyToRef(Y,W),T.TransformCoordinatesToRef(_,W,N),N},T._UnprojectFromInvertedMatrixToRef=function(_,g,O){T.TransformCoordinatesToRef(_,g,O);var R=g.m,N=_._x*R[3]+_._y*R[7]+_._z*R[11]+R[15];E.a.WithinEpsilon(N,1)&&O.scaleInPlace(1/N)},T.UnprojectFromTransform=function(_,g,O,R,N){var V=P.Matrix[0];R.multiplyToRef(N,V),V.invert(),_.x=_._x/g*2-1,_.y=-(_._y/O*2-1);var U=new T;return T._UnprojectFromInvertedMatrixToRef(_,V,U),U},T.Unproject=function(_,g,O,R,N,V){var U=T.Zero();return T.UnprojectToRef(_,g,O,R,N,V,U),U},T.UnprojectToRef=function(_,g,O,R,N,V,U){T.UnprojectFloatsToRef(_._x,_._y,_._z,g,O,R,N,V,U)},T.UnprojectFloatsToRef=function(_,g,O,R,N,V,U,L,j){var Y=P.Matrix[0];V.multiplyToRef(U,Y),Y.multiplyToRef(L,Y),Y.invert();var W=P.Vector3[0];W.x=_/R*2-1,W.y=-(g/N*2-1),W.z=2*O-1,T._UnprojectFromInvertedMatrixToRef(W,Y,j)},T.Minimize=function(_,g){var O=_.clone();return O.minimizeInPlace(g),O},T.Maximize=function(_,g){var O=_.clone();return O.maximizeInPlace(g),O},T.Distance=function(_,g){return Math.sqrt(T.DistanceSquared(_,g))},T.DistanceSquared=function(_,g){var O=_._x-g._x,R=_._y-g._y,N=_._z-g._z;return O*O+R*R+N*N},T.Center=function(_,g){var O=_.add(g);return O.scaleInPlace(.5),O},T.RotationFromAxis=function(_,g,O){var R=T.Zero();return T.RotationFromAxisToRef(_,g,O,R),R},T.RotationFromAxisToRef=function(_,g,O,R){var N=P.Quaternion[0];p.RotationQuaternionFromAxisToRef(_,g,O,N),N.toEulerAnglesToRef(R)},T._UpReadOnly=T.Up(),T._ZeroReadOnly=T.Zero(),T}(),b=function(){function T(_,g,O,R){this.x=_,this.y=g,this.z=O,this.w=R}return T.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+" W:"+this.w+"}"},T.prototype.getClassName=function(){return"Vector4"},T.prototype.getHashCode=function(){var _=0|this.x;return _=397*(_=397*(_=397*_^(0|this.y))^(0|this.z))^(0|this.w)},T.prototype.asArray=function(){var _=new Array;return this.toArray(_,0),_},T.prototype.toArray=function(_,g){return g===void 0&&(g=0),_[g]=this.x,_[g+1]=this.y,_[g+2]=this.z,_[g+3]=this.w,this},T.prototype.fromArray=function(_,g){return g===void 0&&(g=0),T.FromArrayToRef(_,g,this),this},T.prototype.addInPlace=function(_){return this.x+=_.x,this.y+=_.y,this.z+=_.z,this.w+=_.w,this},T.prototype.add=function(_){return new T(this.x+_.x,this.y+_.y,this.z+_.z,this.w+_.w)},T.prototype.addToRef=function(_,g){return g.x=this.x+_.x,g.y=this.y+_.y,g.z=this.z+_.z,g.w=this.w+_.w,this},T.prototype.subtractInPlace=function(_){return this.x-=_.x,this.y-=_.y,this.z-=_.z,this.w-=_.w,this},T.prototype.subtract=function(_){return new T(this.x-_.x,this.y-_.y,this.z-_.z,this.w-_.w)},T.prototype.subtractToRef=function(_,g){return g.x=this.x-_.x,g.y=this.y-_.y,g.z=this.z-_.z,g.w=this.w-_.w,this},T.prototype.subtractFromFloats=function(_,g,O,R){return new T(this.x-_,this.y-g,this.z-O,this.w-R)},T.prototype.subtractFromFloatsToRef=function(_,g,O,R,N){return N.x=this.x-_,N.y=this.y-g,N.z=this.z-O,N.w=this.w-R,this},T.prototype.negate=function(){return new T(-this.x,-this.y,-this.z,-this.w)},T.prototype.negateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1,this},T.prototype.negateToRef=function(_){return _.copyFromFloats(-1*this.x,-1*this.y,-1*this.z,-1*this.w)},T.prototype.scaleInPlace=function(_){return this.x*=_,this.y*=_,this.z*=_,this.w*=_,this},T.prototype.scale=function(_){return new T(this.x*_,this.y*_,this.z*_,this.w*_)},T.prototype.scaleToRef=function(_,g){return g.x=this.x*_,g.y=this.y*_,g.z=this.z*_,g.w=this.w*_,this},T.prototype.scaleAndAddToRef=function(_,g){return g.x+=this.x*_,g.y+=this.y*_,g.z+=this.z*_,g.w+=this.w*_,this},T.prototype.equals=function(_){return _&&this.x===_.x&&this.y===_.y&&this.z===_.z&&this.w===_.w},T.prototype.equalsWithEpsilon=function(_,g){return g===void 0&&(g=m.a),_&&E.a.WithinEpsilon(this.x,_.x,g)&&E.a.WithinEpsilon(this.y,_.y,g)&&E.a.WithinEpsilon(this.z,_.z,g)&&E.a.WithinEpsilon(this.w,_.w,g)},T.prototype.equalsToFloats=function(_,g,O,R){return this.x===_&&this.y===g&&this.z===O&&this.w===R},T.prototype.multiplyInPlace=function(_){return this.x*=_.x,this.y*=_.y,this.z*=_.z,this.w*=_.w,this},T.prototype.multiply=function(_){return new T(this.x*_.x,this.y*_.y,this.z*_.z,this.w*_.w)},T.prototype.multiplyToRef=function(_,g){return g.x=this.x*_.x,g.y=this.y*_.y,g.z=this.z*_.z,g.w=this.w*_.w,this},T.prototype.multiplyByFloats=function(_,g,O,R){return new T(this.x*_,this.y*g,this.z*O,this.w*R)},T.prototype.divide=function(_){return new T(this.x/_.x,this.y/_.y,this.z/_.z,this.w/_.w)},T.prototype.divideToRef=function(_,g){return g.x=this.x/_.x,g.y=this.y/_.y,g.z=this.z/_.z,g.w=this.w/_.w,this},T.prototype.divideInPlace=function(_){return this.divideToRef(_,this)},T.prototype.minimizeInPlace=function(_){return _.x<this.x&&(this.x=_.x),_.y<this.y&&(this.y=_.y),_.z<this.z&&(this.z=_.z),_.w<this.w&&(this.w=_.w),this},T.prototype.maximizeInPlace=function(_){return _.x>this.x&&(this.x=_.x),_.y>this.y&&(this.y=_.y),_.z>this.z&&(this.z=_.z),_.w>this.w&&(this.w=_.w),this},T.prototype.floor=function(){return new T(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z),Math.floor(this.w))},T.prototype.fract=function(){return new T(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z),this.w-Math.floor(this.w))},T.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},T.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},T.prototype.normalize=function(){var _=this.length();return _===0?this:this.scaleInPlace(1/_)},T.prototype.toVector3=function(){return new I(this.x,this.y,this.z)},T.prototype.clone=function(){return new T(this.x,this.y,this.z,this.w)},T.prototype.copyFrom=function(_){return this.x=_.x,this.y=_.y,this.z=_.z,this.w=_.w,this},T.prototype.copyFromFloats=function(_,g,O,R){return this.x=_,this.y=g,this.z=O,this.w=R,this},T.prototype.set=function(_,g,O,R){return this.copyFromFloats(_,g,O,R)},T.prototype.setAll=function(_){return this.x=this.y=this.z=this.w=_,this},T.FromArray=function(_,g){return g||(g=0),new T(_[g],_[g+1],_[g+2],_[g+3])},T.FromArrayToRef=function(_,g,O){O.x=_[g],O.y=_[g+1],O.z=_[g+2],O.w=_[g+3]},T.FromFloatArrayToRef=function(_,g,O){T.FromArrayToRef(_,g,O)},T.FromFloatsToRef=function(_,g,O,R,N){N.x=_,N.y=g,N.z=O,N.w=R},T.Zero=function(){return new T(0,0,0,0)},T.One=function(){return new T(1,1,1,1)},T.Normalize=function(_){var g=T.Zero();return T.NormalizeToRef(_,g),g},T.NormalizeToRef=function(_,g){g.copyFrom(_),g.normalize()},T.Minimize=function(_,g){var O=_.clone();return O.minimizeInPlace(g),O},T.Maximize=function(_,g){var O=_.clone();return O.maximizeInPlace(g),O},T.Distance=function(_,g){return Math.sqrt(T.DistanceSquared(_,g))},T.DistanceSquared=function(_,g){var O=_.x-g.x,R=_.y-g.y,N=_.z-g.z,V=_.w-g.w;return O*O+R*R+N*N+V*V},T.Center=function(_,g){var O=_.add(g);return O.scaleInPlace(.5),O},T.TransformNormal=function(_,g){var O=T.Zero();return T.TransformNormalToRef(_,g,O),O},T.TransformNormalToRef=function(_,g,O){var R=g.m,N=_.x*R[0]+_.y*R[4]+_.z*R[8],V=_.x*R[1]+_.y*R[5]+_.z*R[9],U=_.x*R[2]+_.y*R[6]+_.z*R[10];O.x=N,O.y=V,O.z=U,O.w=_.w},T.TransformNormalFromFloatsToRef=function(_,g,O,R,N,V){var U=N.m;V.x=_*U[0]+g*U[4]+O*U[8],V.y=_*U[1]+g*U[5]+O*U[9],V.z=_*U[2]+g*U[6]+O*U[10],V.w=R},T.FromVector3=function(_,g){return g===void 0&&(g=0),new T(_._x,_._y,_._z,g)},T}(),p=function(){function T(_,g,O,R){_===void 0&&(_=0),g===void 0&&(g=0),O===void 0&&(O=0),R===void 0&&(R=1),this._isDirty=!0,this._x=_,this._y=g,this._z=O,this._w=R}return Object.defineProperty(T.prototype,"x",{get:function(){return this._x},set:function(_){this._x=_,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"y",{get:function(){return this._y},set:function(_){this._y=_,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"z",{get:function(){return this._z},set:function(_){this._z=_,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"w",{get:function(){return this._w},set:function(_){this._w=_,this._isDirty=!0},enumerable:!1,configurable:!0}),T.prototype.toString=function(){return"{X: "+this._x+" Y:"+this._y+" Z:"+this._z+" W:"+this._w+"}"},T.prototype.getClassName=function(){return"Quaternion"},T.prototype.getHashCode=function(){var _=0|this._x;return _=397*(_=397*(_=397*_^(0|this._y))^(0|this._z))^(0|this._w)},T.prototype.asArray=function(){return[this._x,this._y,this._z,this._w]},T.prototype.equals=function(_){return _&&this._x===_._x&&this._y===_._y&&this._z===_._z&&this._w===_._w},T.prototype.equalsWithEpsilon=function(_,g){return g===void 0&&(g=m.a),_&&E.a.WithinEpsilon(this._x,_._x,g)&&E.a.WithinEpsilon(this._y,_._y,g)&&E.a.WithinEpsilon(this._z,_._z,g)&&E.a.WithinEpsilon(this._w,_._w,g)},T.prototype.clone=function(){return new T(this._x,this._y,this._z,this._w)},T.prototype.copyFrom=function(_){return this.x=_._x,this.y=_._y,this.z=_._z,this.w=_._w,this},T.prototype.copyFromFloats=function(_,g,O,R){return this.x=_,this.y=g,this.z=O,this.w=R,this},T.prototype.set=function(_,g,O,R){return this.copyFromFloats(_,g,O,R)},T.prototype.add=function(_){return new T(this._x+_._x,this._y+_._y,this._z+_._z,this._w+_._w)},T.prototype.addInPlace=function(_){return this._x+=_._x,this._y+=_._y,this._z+=_._z,this._w+=_._w,this},T.prototype.subtract=function(_){return new T(this._x-_._x,this._y-_._y,this._z-_._z,this._w-_._w)},T.prototype.scale=function(_){return new T(this._x*_,this._y*_,this._z*_,this._w*_)},T.prototype.scaleToRef=function(_,g){return g.x=this._x*_,g.y=this._y*_,g.z=this._z*_,g.w=this._w*_,this},T.prototype.scaleInPlace=function(_){return this.x*=_,this.y*=_,this.z*=_,this.w*=_,this},T.prototype.scaleAndAddToRef=function(_,g){return g.x+=this._x*_,g.y+=this._y*_,g.z+=this._z*_,g.w+=this._w*_,this},T.prototype.multiply=function(_){var g=new T(0,0,0,1);return this.multiplyToRef(_,g),g},T.prototype.multiplyToRef=function(_,g){var O=this._x*_._w+this._y*_._z-this._z*_._y+this._w*_._x,R=-this._x*_._z+this._y*_._w+this._z*_._x+this._w*_._y,N=this._x*_._y-this._y*_._x+this._z*_._w+this._w*_._z,V=-this._x*_._x-this._y*_._y-this._z*_._z+this._w*_._w;return g.copyFromFloats(O,R,N,V),this},T.prototype.multiplyInPlace=function(_){return this.multiplyToRef(_,this),this},T.prototype.conjugateToRef=function(_){return _.copyFromFloats(-this._x,-this._y,-this._z,this._w),this},T.prototype.conjugateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},T.prototype.conjugate=function(){return new T(-this._x,-this._y,-this._z,this._w)},T.prototype.length=function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},T.prototype.normalize=function(){var _=this.length();if(_===0)return this;var g=1/_;return this.x*=g,this.y*=g,this.z*=g,this.w*=g,this},T.prototype.toEulerAngles=function(_){var g=I.Zero();return this.toEulerAnglesToRef(g),g},T.prototype.toEulerAnglesToRef=function(_){var g=this._z,O=this._x,R=this._y,N=this._w,V=N*N,U=g*g,L=O*O,j=R*R,Y=R*g-O*N;return Y<-.4999999?(_.y=2*Math.atan2(R,N),_.x=Math.PI/2,_.z=0):Y>.4999999?(_.y=2*Math.atan2(R,N),_.x=-Math.PI/2,_.z=0):(_.z=Math.atan2(2*(O*R+g*N),-U-L+j+V),_.x=Math.asin(-2*(g*R-O*N)),_.y=Math.atan2(2*(g*O+R*N),U-L-j+V)),this},T.prototype.toRotationMatrix=function(_){return x.FromQuaternionToRef(this,_),this},T.prototype.fromRotationMatrix=function(_){return T.FromRotationMatrixToRef(_,this),this},T.FromRotationMatrix=function(_){var g=new T;return T.FromRotationMatrixToRef(_,g),g},T.FromRotationMatrixToRef=function(_,g){var O,R=_.m,N=R[0],V=R[4],U=R[8],L=R[1],j=R[5],Y=R[9],W=R[2],re=R[6],ne=R[10],ge=N+j+ne;ge>0?(O=.5/Math.sqrt(ge+1),g.w=.25/O,g.x=(re-Y)*O,g.y=(U-W)*O,g.z=(L-V)*O):N>j&&N>ne?(O=2*Math.sqrt(1+N-j-ne),g.w=(re-Y)/O,g.x=.25*O,g.y=(V+L)/O,g.z=(U+W)/O):j>ne?(O=2*Math.sqrt(1+j-N-ne),g.w=(U-W)/O,g.x=(V+L)/O,g.y=.25*O,g.z=(Y+re)/O):(O=2*Math.sqrt(1+ne-N-j),g.w=(L-V)/O,g.x=(U+W)/O,g.y=(Y+re)/O,g.z=.25*O)},T.Dot=function(_,g){return _._x*g._x+_._y*g._y+_._z*g._z+_._w*g._w},T.AreClose=function(_,g){return T.Dot(_,g)>=0},T.Zero=function(){return new T(0,0,0,0)},T.Inverse=function(_){return new T(-_._x,-_._y,-_._z,_._w)},T.InverseToRef=function(_,g){return g.set(-_._x,-_._y,-_._z,_._w),g},T.Identity=function(){return new T(0,0,0,1)},T.IsIdentity=function(_){return _&&_._x===0&&_._y===0&&_._z===0&&_._w===1},T.RotationAxis=function(_,g){return T.RotationAxisToRef(_,g,new T)},T.RotationAxisToRef=function(_,g,O){var R=Math.sin(g/2);return _.normalize(),O.w=Math.cos(g/2),O.x=_._x*R,O.y=_._y*R,O.z=_._z*R,O},T.FromArray=function(_,g){return g||(g=0),new T(_[g],_[g+1],_[g+2],_[g+3])},T.FromArrayToRef=function(_,g,O){O.x=_[g],O.y=_[g+1],O.z=_[g+2],O.w=_[g+3]},T.FromEulerAngles=function(_,g,O){var R=new T;return T.RotationYawPitchRollToRef(g,_,O,R),R},T.FromEulerAnglesToRef=function(_,g,O,R){return T.RotationYawPitchRollToRef(g,_,O,R),R},T.FromEulerVector=function(_){var g=new T;return T.RotationYawPitchRollToRef(_._y,_._x,_._z,g),g},T.FromEulerVectorToRef=function(_,g){return T.RotationYawPitchRollToRef(_._y,_._x,_._z,g),g},T.RotationYawPitchRoll=function(_,g,O){var R=new T;return T.RotationYawPitchRollToRef(_,g,O,R),R},T.RotationYawPitchRollToRef=function(_,g,O,R){var N=.5*O,V=.5*g,U=.5*_,L=Math.sin(N),j=Math.cos(N),Y=Math.sin(V),W=Math.cos(V),re=Math.sin(U),ne=Math.cos(U);R.x=ne*Y*j+re*W*L,R.y=re*W*j-ne*Y*L,R.z=ne*W*L-re*Y*j,R.w=ne*W*j+re*Y*L},T.RotationAlphaBetaGamma=function(_,g,O){var R=new T;return T.RotationAlphaBetaGammaToRef(_,g,O,R),R},T.RotationAlphaBetaGammaToRef=function(_,g,O,R){var N=.5*(O+_),V=.5*(O-_),U=.5*g;R.x=Math.cos(V)*Math.sin(U),R.y=Math.sin(V)*Math.sin(U),R.z=Math.sin(N)*Math.cos(U),R.w=Math.cos(N)*Math.cos(U)},T.RotationQuaternionFromAxis=function(_,g,O){var R=new T(0,0,0,0);return T.RotationQuaternionFromAxisToRef(_,g,O,R),R},T.RotationQuaternionFromAxisToRef=function(_,g,O,R){var N=P.Matrix[0];x.FromXYZAxesToRef(_.normalize(),g.normalize(),O.normalize(),N),T.FromRotationMatrixToRef(N,R)},T.Slerp=function(_,g,O){var R=T.Identity();return T.SlerpToRef(_,g,O,R),R},T.SlerpToRef=function(_,g,O,R){var N,V,U=_._x*g._x+_._y*g._y+_._z*g._z+_._w*g._w,L=!1;if(U<0&&(L=!0,U=-U),U>.999999)V=1-O,N=L?-O:O;else{var j=Math.acos(U),Y=1/Math.sin(j);V=Math.sin((1-O)*j)*Y,N=L?-Math.sin(O*j)*Y:Math.sin(O*j)*Y}R.x=V*_._x+N*g._x,R.y=V*_._y+N*g._y,R.z=V*_._z+N*g._z,R.w=V*_._w+N*g._w},T.Hermite=function(_,g,O,R,N){var V=N*N,U=N*V,L=2*U-3*V+1,j=-2*U+3*V,Y=U-2*V+N,W=U-V;return new T(_._x*L+O._x*j+g._x*Y+R._x*W,_._y*L+O._y*j+g._y*Y+R._y*W,_._z*L+O._z*j+g._z*Y+R._z*W,_._w*L+O._w*j+g._w*Y+R._w*W)},T}(),x=function(){function T(){this._isIdentity=!1,this._isIdentityDirty=!0,this._isIdentity3x2=!0,this._isIdentity3x2Dirty=!0,this.updateFlag=-1,M.a.MatrixTrackPrecisionChange&&M.a.MatrixTrackedMatrices.push(this),this._m=new M.a.MatrixCurrentType(16),this._updateIdentityStatus(!1)}return Object.defineProperty(T,"Use64Bits",{get:function(){return M.a.MatrixUse64Bits},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"m",{get:function(){return this._m},enumerable:!1,configurable:!0}),T.prototype._markAsUpdated=function(){this.updateFlag=T._updateFlagSeed++,this._isIdentity=!1,this._isIdentity3x2=!1,this._isIdentityDirty=!0,this._isIdentity3x2Dirty=!0},T.prototype._updateIdentityStatus=function(_,g,O,R){g===void 0&&(g=!1),O===void 0&&(O=!1),R===void 0&&(R=!0),this.updateFlag=T._updateFlagSeed++,this._isIdentity=_,this._isIdentity3x2=_||O,this._isIdentityDirty=!this._isIdentity&&g,this._isIdentity3x2Dirty=!this._isIdentity3x2&&R},T.prototype.isIdentity=function(){if(this._isIdentityDirty){this._isIdentityDirty=!1;var _=this._m;this._isIdentity=_[0]===1&&_[1]===0&&_[2]===0&&_[3]===0&&_[4]===0&&_[5]===1&&_[6]===0&&_[7]===0&&_[8]===0&&_[9]===0&&_[10]===1&&_[11]===0&&_[12]===0&&_[13]===0&&_[14]===0&&_[15]===1}return this._isIdentity},T.prototype.isIdentityAs3x2=function(){return this._isIdentity3x2Dirty&&(this._isIdentity3x2Dirty=!1,this._m[0]!==1||this._m[5]!==1||this._m[15]!==1||this._m[1]!==0||this._m[2]!==0||this._m[3]!==0||this._m[4]!==0||this._m[6]!==0||this._m[7]!==0||this._m[8]!==0||this._m[9]!==0||this._m[10]!==0||this._m[11]!==0||this._m[12]!==0||this._m[13]!==0||this._m[14]!==0?this._isIdentity3x2=!1:this._isIdentity3x2=!0),this._isIdentity3x2},T.prototype.determinant=function(){if(this._isIdentity===!0)return 1;var _=this._m,g=_[0],O=_[1],R=_[2],N=_[3],V=_[4],U=_[5],L=_[6],j=_[7],Y=_[8],W=_[9],re=_[10],ne=_[11],ge=_[12],_e=_[13],ce=_[14],ie=_[15],Z=re*ie-ce*ne,te=W*ie-_e*ne,B=W*ce-_e*re,G=Y*ie-ge*ne,$=Y*ce-re*ge,le=Y*_e-ge*W;return g*+(U*Z-L*te+j*B)+O*-(V*Z-L*G+j*$)+R*+(V*te-U*G+j*le)+N*-(V*B-U*$+L*le)},T.prototype.toArray=function(){return this._m},T.prototype.asArray=function(){return this._m},T.prototype.invert=function(){return this.invertToRef(this),this},T.prototype.reset=function(){return T.FromValuesToRef(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,this),this._updateIdentityStatus(!1),this},T.prototype.add=function(_){var g=new T;return this.addToRef(_,g),g},T.prototype.addToRef=function(_,g){for(var O=this._m,R=g._m,N=_.m,V=0;V<16;V++)R[V]=O[V]+N[V];return g._markAsUpdated(),this},T.prototype.addToSelf=function(_){for(var g=this._m,O=_.m,R=0;R<16;R++)g[R]+=O[R];return this._markAsUpdated(),this},T.prototype.invertToRef=function(_){if(this._isIdentity===!0)return T.IdentityToRef(_),this;var g=this._m,O=g[0],R=g[1],N=g[2],V=g[3],U=g[4],L=g[5],j=g[6],Y=g[7],W=g[8],re=g[9],ne=g[10],ge=g[11],_e=g[12],ce=g[13],ie=g[14],Z=g[15],te=ne*Z-ie*ge,B=re*Z-ce*ge,G=re*ie-ce*ne,$=W*Z-_e*ge,le=W*ie-ne*_e,se=W*ce-_e*re,q=+(L*te-j*B+Y*G),H=-(U*te-j*$+Y*le),X=+(U*B-L*$+Y*se),J=-(U*G-L*le+j*se),Q=O*q+R*H+N*X+V*J;if(Q===0)return _.copyFrom(this),this;var ee=1/Q,pe=j*Z-ie*Y,Te=L*Z-ce*Y,ve=L*ie-ce*j,he=U*Z-_e*Y,be=U*ie-_e*j,xe=U*ce-_e*L,Se=j*ge-ne*Y,Ue=L*ge-re*Y,We=L*ne-re*j,Ze=U*ge-W*Y,Qe=U*ne-W*j,Xe=U*re-W*L,nt=-(R*te-N*B+V*G),Ke=+(O*te-N*$+V*le),ct=-(O*B-R*$+V*se),ot=+(O*G-R*le+N*se),_t=+(R*pe-N*Te+V*ve),gt=-(O*pe-N*he+V*be),At=+(O*Te-R*he+V*xe),wt=-(O*ve-R*be+N*xe),Qt=-(R*Se-N*Ue+V*We),Wt=+(O*Se-N*Ze+V*Qe),Ft=-(O*Ue-R*Ze+V*Xe),Ht=+(O*We-R*Qe+N*Xe);return T.FromValuesToRef(q*ee,nt*ee,_t*ee,Qt*ee,H*ee,Ke*ee,gt*ee,Wt*ee,X*ee,ct*ee,At*ee,Ft*ee,J*ee,ot*ee,wt*ee,Ht*ee,_),this},T.prototype.addAtIndex=function(_,g){return this._m[_]+=g,this._markAsUpdated(),this},T.prototype.multiplyAtIndex=function(_,g){return this._m[_]*=g,this._markAsUpdated(),this},T.prototype.setTranslationFromFloats=function(_,g,O){return this._m[12]=_,this._m[13]=g,this._m[14]=O,this._markAsUpdated(),this},T.prototype.addTranslationFromFloats=function(_,g,O){return this._m[12]+=_,this._m[13]+=g,this._m[14]+=O,this._markAsUpdated(),this},T.prototype.setTranslation=function(_){return this.setTranslationFromFloats(_._x,_._y,_._z)},T.prototype.getTranslation=function(){return new I(this._m[12],this._m[13],this._m[14])},T.prototype.getTranslationToRef=function(_){return _.x=this._m[12],_.y=this._m[13],_.z=this._m[14],this},T.prototype.removeRotationAndScaling=function(){var _=this.m;return T.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,_[12],_[13],_[14],_[15],this),this._updateIdentityStatus(_[12]===0&&_[13]===0&&_[14]===0&&_[15]===1),this},T.prototype.multiply=function(_){var g=new T;return this.multiplyToRef(_,g),g},T.prototype.copyFrom=function(_){_.copyToArray(this._m);var g=_;return this._updateIdentityStatus(g._isIdentity,g._isIdentityDirty,g._isIdentity3x2,g._isIdentity3x2Dirty),this},T.prototype.copyToArray=function(_,g){g===void 0&&(g=0);var O=this._m;return _[g]=O[0],_[g+1]=O[1],_[g+2]=O[2],_[g+3]=O[3],_[g+4]=O[4],_[g+5]=O[5],_[g+6]=O[6],_[g+7]=O[7],_[g+8]=O[8],_[g+9]=O[9],_[g+10]=O[10],_[g+11]=O[11],_[g+12]=O[12],_[g+13]=O[13],_[g+14]=O[14],_[g+15]=O[15],this},T.prototype.multiplyToRef=function(_,g){return this._isIdentity?(g.copyFrom(_),this):_._isIdentity?(g.copyFrom(this),this):(this.multiplyToArray(_,g._m,0),g._markAsUpdated(),this)},T.prototype.multiplyToArray=function(_,g,O){var R=this._m,N=_.m,V=R[0],U=R[1],L=R[2],j=R[3],Y=R[4],W=R[5],re=R[6],ne=R[7],ge=R[8],_e=R[9],ce=R[10],ie=R[11],Z=R[12],te=R[13],B=R[14],G=R[15],$=N[0],le=N[1],se=N[2],q=N[3],H=N[4],X=N[5],J=N[6],Q=N[7],ee=N[8],pe=N[9],Te=N[10],ve=N[11],he=N[12],be=N[13],xe=N[14],Se=N[15];return g[O]=V*$+U*H+L*ee+j*he,g[O+1]=V*le+U*X+L*pe+j*be,g[O+2]=V*se+U*J+L*Te+j*xe,g[O+3]=V*q+U*Q+L*ve+j*Se,g[O+4]=Y*$+W*H+re*ee+ne*he,g[O+5]=Y*le+W*X+re*pe+ne*be,g[O+6]=Y*se+W*J+re*Te+ne*xe,g[O+7]=Y*q+W*Q+re*ve+ne*Se,g[O+8]=ge*$+_e*H+ce*ee+ie*he,g[O+9]=ge*le+_e*X+ce*pe+ie*be,g[O+10]=ge*se+_e*J+ce*Te+ie*xe,g[O+11]=ge*q+_e*Q+ce*ve+ie*Se,g[O+12]=Z*$+te*H+B*ee+G*he,g[O+13]=Z*le+te*X+B*pe+G*be,g[O+14]=Z*se+te*J+B*Te+G*xe,g[O+15]=Z*q+te*Q+B*ve+G*Se,this},T.prototype.equals=function(_){var g=_;if(!g)return!1;if((this._isIdentity||g._isIdentity)&&!this._isIdentityDirty&&!g._isIdentityDirty)return this._isIdentity&&g._isIdentity;var O=this.m,R=g.m;return O[0]===R[0]&&O[1]===R[1]&&O[2]===R[2]&&O[3]===R[3]&&O[4]===R[4]&&O[5]===R[5]&&O[6]===R[6]&&O[7]===R[7]&&O[8]===R[8]&&O[9]===R[9]&&O[10]===R[10]&&O[11]===R[11]&&O[12]===R[12]&&O[13]===R[13]&&O[14]===R[14]&&O[15]===R[15]},T.prototype.clone=function(){var _=new T;return _.copyFrom(this),_},T.prototype.getClassName=function(){return"Matrix"},T.prototype.getHashCode=function(){for(var _=0|this._m[0],g=1;g<16;g++)_=397*_^(0|this._m[g]);return _},T.prototype.decompose=function(_,g,O){if(this._isIdentity)return O&&O.setAll(0),_&&_.setAll(1),g&&g.copyFromFloats(0,0,0,1),!0;var R=this._m;if(O&&O.copyFromFloats(R[12],R[13],R[14]),(_=_||P.Vector3[0]).x=Math.sqrt(R[0]*R[0]+R[1]*R[1]+R[2]*R[2]),_.y=Math.sqrt(R[4]*R[4]+R[5]*R[5]+R[6]*R[6]),_.z=Math.sqrt(R[8]*R[8]+R[9]*R[9]+R[10]*R[10]),this.determinant()<=0&&(_.y*=-1),_._x===0||_._y===0||_._z===0)return g&&g.copyFromFloats(0,0,0,1),!1;if(g){var N=1/_._x,V=1/_._y,U=1/_._z;T.FromValuesToRef(R[0]*N,R[1]*N,R[2]*N,0,R[4]*V,R[5]*V,R[6]*V,0,R[8]*U,R[9]*U,R[10]*U,0,0,0,0,1,P.Matrix[0]),p.FromRotationMatrixToRef(P.Matrix[0],g)}return!0},T.prototype.getRow=function(_){if(_<0||_>3)return null;var g=4*_;return new b(this._m[g+0],this._m[g+1],this._m[g+2],this._m[g+3])},T.prototype.setRow=function(_,g){return this.setRowFromFloats(_,g.x,g.y,g.z,g.w)},T.prototype.transpose=function(){return T.Transpose(this)},T.prototype.transposeToRef=function(_){return T.TransposeToRef(this,_),this},T.prototype.setRowFromFloats=function(_,g,O,R,N){if(_<0||_>3)return this;var V=4*_;return this._m[V+0]=g,this._m[V+1]=O,this._m[V+2]=R,this._m[V+3]=N,this._markAsUpdated(),this},T.prototype.scale=function(_){var g=new T;return this.scaleToRef(_,g),g},T.prototype.scaleToRef=function(_,g){for(var O=0;O<16;O++)g._m[O]=this._m[O]*_;return g._markAsUpdated(),this},T.prototype.scaleAndAddToRef=function(_,g){for(var O=0;O<16;O++)g._m[O]+=this._m[O]*_;return g._markAsUpdated(),this},T.prototype.toNormalMatrix=function(_){var g=P.Matrix[0];this.invertToRef(g),g.transposeToRef(_);var O=_._m;T.FromValuesToRef(O[0],O[1],O[2],0,O[4],O[5],O[6],0,O[8],O[9],O[10],0,0,0,0,1,_)},T.prototype.getRotationMatrix=function(){var _=new T;return this.getRotationMatrixToRef(_),_},T.prototype.getRotationMatrixToRef=function(_){var g=P.Vector3[0];if(!this.decompose(g))return T.IdentityToRef(_),this;var O=this._m,R=1/g._x,N=1/g._y,V=1/g._z;return T.FromValuesToRef(O[0]*R,O[1]*R,O[2]*R,0,O[4]*N,O[5]*N,O[6]*N,0,O[8]*V,O[9]*V,O[10]*V,0,0,0,0,1,_),this},T.prototype.toggleModelMatrixHandInPlace=function(){var _=this._m;_[2]*=-1,_[6]*=-1,_[8]*=-1,_[9]*=-1,_[14]*=-1,this._markAsUpdated()},T.prototype.toggleProjectionMatrixHandInPlace=function(){var _=this._m;_[8]*=-1,_[9]*=-1,_[10]*=-1,_[11]*=-1,this._markAsUpdated()},T.FromArray=function(_,g){g===void 0&&(g=0);var O=new T;return T.FromArrayToRef(_,g,O),O},T.FromArrayToRef=function(_,g,O){for(var R=0;R<16;R++)O._m[R]=_[R+g];O._markAsUpdated()},T.FromFloat32ArrayToRefScaled=function(_,g,O,R){for(var N=0;N<16;N++)R._m[N]=_[N+g]*O;R._markAsUpdated()},Object.defineProperty(T,"IdentityReadOnly",{get:function(){return T._identityReadOnly},enumerable:!1,configurable:!0}),T.FromValuesToRef=function(_,g,O,R,N,V,U,L,j,Y,W,re,ne,ge,_e,ce,ie){var Z=ie._m;Z[0]=_,Z[1]=g,Z[2]=O,Z[3]=R,Z[4]=N,Z[5]=V,Z[6]=U,Z[7]=L,Z[8]=j,Z[9]=Y,Z[10]=W,Z[11]=re,Z[12]=ne,Z[13]=ge,Z[14]=_e,Z[15]=ce,ie._markAsUpdated()},T.FromValues=function(_,g,O,R,N,V,U,L,j,Y,W,re,ne,ge,_e,ce){var ie=new T,Z=ie._m;return Z[0]=_,Z[1]=g,Z[2]=O,Z[3]=R,Z[4]=N,Z[5]=V,Z[6]=U,Z[7]=L,Z[8]=j,Z[9]=Y,Z[10]=W,Z[11]=re,Z[12]=ne,Z[13]=ge,Z[14]=_e,Z[15]=ce,ie._markAsUpdated(),ie},T.Compose=function(_,g,O){var R=new T;return T.ComposeToRef(_,g,O,R),R},T.ComposeToRef=function(_,g,O,R){var N=R._m,V=g._x,U=g._y,L=g._z,j=g._w,Y=V+V,W=U+U,re=L+L,ne=V*Y,ge=V*W,_e=V*re,ce=U*W,ie=U*re,Z=L*re,te=j*Y,B=j*W,G=j*re,$=_._x,le=_._y,se=_._z;N[0]=(1-(ce+Z))*$,N[1]=(ge+G)*$,N[2]=(_e-B)*$,N[3]=0,N[4]=(ge-G)*le,N[5]=(1-(ne+Z))*le,N[6]=(ie+te)*le,N[7]=0,N[8]=(_e+B)*se,N[9]=(ie-te)*se,N[10]=(1-(ne+ce))*se,N[11]=0,N[12]=O._x,N[13]=O._y,N[14]=O._z,N[15]=1,R._markAsUpdated()},T.Identity=function(){var _=T.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return _._updateIdentityStatus(!0),_},T.IdentityToRef=function(_){T.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,_),_._updateIdentityStatus(!0)},T.Zero=function(){var _=T.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return _._updateIdentityStatus(!1),_},T.RotationX=function(_){var g=new T;return T.RotationXToRef(_,g),g},T.Invert=function(_){var g=new T;return _.invertToRef(g),g},T.RotationXToRef=function(_,g){var O=Math.sin(_),R=Math.cos(_);T.FromValuesToRef(1,0,0,0,0,R,O,0,0,-O,R,0,0,0,0,1,g),g._updateIdentityStatus(R===1&&O===0)},T.RotationY=function(_){var g=new T;return T.RotationYToRef(_,g),g},T.RotationYToRef=function(_,g){var O=Math.sin(_),R=Math.cos(_);T.FromValuesToRef(R,0,-O,0,0,1,0,0,O,0,R,0,0,0,0,1,g),g._updateIdentityStatus(R===1&&O===0)},T.RotationZ=function(_){var g=new T;return T.RotationZToRef(_,g),g},T.RotationZToRef=function(_,g){var O=Math.sin(_),R=Math.cos(_);T.FromValuesToRef(R,O,0,0,-O,R,0,0,0,0,1,0,0,0,0,1,g),g._updateIdentityStatus(R===1&&O===0)},T.RotationAxis=function(_,g){var O=new T;return T.RotationAxisToRef(_,g,O),O},T.RotationAxisToRef=function(_,g,O){var R=Math.sin(-g),N=Math.cos(-g),V=1-N;_.normalize();var U=O._m;U[0]=_._x*_._x*V+N,U[1]=_._x*_._y*V-_._z*R,U[2]=_._x*_._z*V+_._y*R,U[3]=0,U[4]=_._y*_._x*V+_._z*R,U[5]=_._y*_._y*V+N,U[6]=_._y*_._z*V-_._x*R,U[7]=0,U[8]=_._z*_._x*V-_._y*R,U[9]=_._z*_._y*V+_._x*R,U[10]=_._z*_._z*V+N,U[11]=0,U[12]=0,U[13]=0,U[14]=0,U[15]=1,O._markAsUpdated()},T.RotationAlignToRef=function(_,g,O){var R=I.Cross(g,_),N=I.Dot(g,_),V=1/(1+N),U=O._m;U[0]=R._x*R._x*V+N,U[1]=R._y*R._x*V-R._z,U[2]=R._z*R._x*V+R._y,U[3]=0,U[4]=R._x*R._y*V+R._z,U[5]=R._y*R._y*V+N,U[6]=R._z*R._y*V-R._x,U[7]=0,U[8]=R._x*R._z*V-R._y,U[9]=R._y*R._z*V+R._x,U[10]=R._z*R._z*V+N,U[11]=0,U[12]=0,U[13]=0,U[14]=0,U[15]=1,O._markAsUpdated()},T.RotationYawPitchRoll=function(_,g,O){var R=new T;return T.RotationYawPitchRollToRef(_,g,O,R),R},T.RotationYawPitchRollToRef=function(_,g,O,R){p.RotationYawPitchRollToRef(_,g,O,P.Quaternion[0]),P.Quaternion[0].toRotationMatrix(R)},T.Scaling=function(_,g,O){var R=new T;return T.ScalingToRef(_,g,O,R),R},T.ScalingToRef=function(_,g,O,R){T.FromValuesToRef(_,0,0,0,0,g,0,0,0,0,O,0,0,0,0,1,R),R._updateIdentityStatus(_===1&&g===1&&O===1)},T.Translation=function(_,g,O){var R=new T;return T.TranslationToRef(_,g,O,R),R},T.TranslationToRef=function(_,g,O,R){T.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,_,g,O,1,R),R._updateIdentityStatus(_===0&&g===0&&O===0)},T.Lerp=function(_,g,O){var R=new T;return T.LerpToRef(_,g,O,R),R},T.LerpToRef=function(_,g,O,R){for(var N=R._m,V=_.m,U=g.m,L=0;L<16;L++)N[L]=V[L]*(1-O)+U[L]*O;R._markAsUpdated()},T.DecomposeLerp=function(_,g,O){var R=new T;return T.DecomposeLerpToRef(_,g,O,R),R},T.DecomposeLerpToRef=function(_,g,O,R){var N=P.Vector3[0],V=P.Quaternion[0],U=P.Vector3[1];_.decompose(N,V,U);var L=P.Vector3[2],j=P.Quaternion[1],Y=P.Vector3[3];g.decompose(L,j,Y);var W=P.Vector3[4];I.LerpToRef(N,L,O,W);var re=P.Quaternion[2];p.SlerpToRef(V,j,O,re);var ne=P.Vector3[5];I.LerpToRef(U,Y,O,ne),T.ComposeToRef(W,re,ne,R)},T.LookAtLH=function(_,g,O){var R=new T;return T.LookAtLHToRef(_,g,O,R),R},T.LookAtLHToRef=function(_,g,O,R){var N=P.Vector3[0],V=P.Vector3[1],U=P.Vector3[2];g.subtractToRef(_,U),U.normalize(),I.CrossToRef(O,U,N);var L=N.lengthSquared();L===0?N.x=1:N.normalizeFromLength(Math.sqrt(L)),I.CrossToRef(U,N,V),V.normalize();var j=-I.Dot(N,_),Y=-I.Dot(V,_),W=-I.Dot(U,_);T.FromValuesToRef(N._x,V._x,U._x,0,N._y,V._y,U._y,0,N._z,V._z,U._z,0,j,Y,W,1,R)},T.LookAtRH=function(_,g,O){var R=new T;return T.LookAtRHToRef(_,g,O,R),R},T.LookAtRHToRef=function(_,g,O,R){var N=P.Vector3[0],V=P.Vector3[1],U=P.Vector3[2];_.subtractToRef(g,U),U.normalize(),I.CrossToRef(O,U,N);var L=N.lengthSquared();L===0?N.x=1:N.normalizeFromLength(Math.sqrt(L)),I.CrossToRef(U,N,V),V.normalize();var j=-I.Dot(N,_),Y=-I.Dot(V,_),W=-I.Dot(U,_);T.FromValuesToRef(N._x,V._x,U._x,0,N._y,V._y,U._y,0,N._z,V._z,U._z,0,j,Y,W,1,R)},T.OrthoLH=function(_,g,O,R){var N=new T;return T.OrthoLHToRef(_,g,O,R,N),N},T.OrthoLHToRef=function(_,g,O,R,N){var V=2/_,U=2/g,L=2/(R-O),j=-(R+O)/(R-O);T.FromValuesToRef(V,0,0,0,0,U,0,0,0,0,L,0,0,0,j,1,N),N._updateIdentityStatus(V===1&&U===1&&L===1&&j===0)},T.OrthoOffCenterLH=function(_,g,O,R,N,V){var U=new T;return T.OrthoOffCenterLHToRef(_,g,O,R,N,V,U),U},T.OrthoOffCenterLHToRef=function(_,g,O,R,N,V,U){var L=2/(g-_),j=2/(R-O),Y=2/(V-N),W=-(V+N)/(V-N),re=(_+g)/(_-g),ne=(R+O)/(O-R);T.FromValuesToRef(L,0,0,0,0,j,0,0,0,0,Y,0,re,ne,W,1,U),U._markAsUpdated()},T.OrthoOffCenterRH=function(_,g,O,R,N,V){var U=new T;return T.OrthoOffCenterRHToRef(_,g,O,R,N,V,U),U},T.OrthoOffCenterRHToRef=function(_,g,O,R,N,V,U){T.OrthoOffCenterLHToRef(_,g,O,R,N,V,U),U._m[10]*=-1},T.PerspectiveLH=function(_,g,O,R){var N=new T,V=2*O/_,U=2*O/g,L=(R+O)/(R-O),j=-2*R*O/(R-O);return T.FromValuesToRef(V,0,0,0,0,U,0,0,0,0,L,1,0,0,j,0,N),N._updateIdentityStatus(!1),N},T.PerspectiveFovLH=function(_,g,O,R){var N=new T;return T.PerspectiveFovLHToRef(_,g,O,R,N),N},T.PerspectiveFovLHToRef=function(_,g,O,R,N,V){V===void 0&&(V=!0);var U=O,L=R,j=1/Math.tan(.5*_),Y=V?j/g:j,W=V?j:j*g,re=(L+U)/(L-U),ne=-2*L*U/(L-U);T.FromValuesToRef(Y,0,0,0,0,W,0,0,0,0,re,1,0,0,ne,0,N),N._updateIdentityStatus(!1)},T.PerspectiveFovReverseLHToRef=function(_,g,O,R,N,V){V===void 0&&(V=!0);var U=1/Math.tan(.5*_),L=V?U/g:U,j=V?U:U*g;T.FromValuesToRef(L,0,0,0,0,j,0,0,0,0,-O,1,0,0,1,0,N),N._updateIdentityStatus(!1)},T.PerspectiveFovRH=function(_,g,O,R){var N=new T;return T.PerspectiveFovRHToRef(_,g,O,R,N),N},T.PerspectiveFovRHToRef=function(_,g,O,R,N,V){V===void 0&&(V=!0);var U=O,L=R,j=1/Math.tan(.5*_),Y=V?j/g:j,W=V?j:j*g,re=-(L+U)/(L-U),ne=-2*L*U/(L-U);T.FromValuesToRef(Y,0,0,0,0,W,0,0,0,0,re,-1,0,0,ne,0,N),N._updateIdentityStatus(!1)},T.PerspectiveFovReverseRHToRef=function(_,g,O,R,N,V){V===void 0&&(V=!0);var U=1/Math.tan(.5*_),L=V?U/g:U,j=V?U:U*g;T.FromValuesToRef(L,0,0,0,0,j,0,0,0,0,-O,-1,0,0,-1,0,N),N._updateIdentityStatus(!1)},T.PerspectiveFovWebVRToRef=function(_,g,O,R,N){N===void 0&&(N=!1);var V=N?-1:1,U=Math.tan(_.upDegrees*Math.PI/180),L=Math.tan(_.downDegrees*Math.PI/180),j=Math.tan(_.leftDegrees*Math.PI/180),Y=Math.tan(_.rightDegrees*Math.PI/180),W=2/(j+Y),re=2/(U+L),ne=R._m;ne[0]=W,ne[1]=ne[2]=ne[3]=ne[4]=0,ne[5]=re,ne[6]=ne[7]=0,ne[8]=(j-Y)*W*.5,ne[9]=-(U-L)*re*.5,ne[10]=-O/(g-O),ne[11]=1*V,ne[12]=ne[13]=ne[15]=0,ne[14]=-2*O*g/(O-g),R._markAsUpdated()},T.GetFinalMatrix=function(_,g,O,R,N,V){var U=_.width,L=_.height,j=_.x,Y=_.y,W=T.FromValues(U/2,0,0,0,0,-L/2,0,0,0,0,V-N,0,j+U/2,L/2+Y,N,1),re=P.Matrix[0];return g.multiplyToRef(O,re),re.multiplyToRef(R,re),re.multiply(W)},T.GetAsMatrix2x2=function(_){var g=_.m,O=[g[0],g[1],g[4],g[5]];return M.a.MatrixUse64Bits?O:new Float32Array(O)},T.GetAsMatrix3x3=function(_){var g=_.m,O=[g[0],g[1],g[2],g[4],g[5],g[6],g[8],g[9],g[10]];return M.a.MatrixUse64Bits?O:new Float32Array(O)},T.Transpose=function(_){var g=new T;return T.TransposeToRef(_,g),g},T.TransposeToRef=function(_,g){var O=g._m,R=_.m;O[0]=R[0],O[1]=R[4],O[2]=R[8],O[3]=R[12],O[4]=R[1],O[5]=R[5],O[6]=R[9],O[7]=R[13],O[8]=R[2],O[9]=R[6],O[10]=R[10],O[11]=R[14],O[12]=R[3],O[13]=R[7],O[14]=R[11],O[15]=R[15],g._updateIdentityStatus(_._isIdentity,_._isIdentityDirty)},T.Reflection=function(_){var g=new T;return T.ReflectionToRef(_,g),g},T.ReflectionToRef=function(_,g){_.normalize();var O=_.normal.x,R=_.normal.y,N=_.normal.z,V=-2*O,U=-2*R,L=-2*N;T.FromValuesToRef(V*O+1,U*O,L*O,0,V*R,U*R+1,L*R,0,V*N,U*N,L*N+1,0,V*_.d,U*_.d,L*_.d,1,g)},T.FromXYZAxesToRef=function(_,g,O,R){T.FromValuesToRef(_._x,_._y,_._z,0,g._x,g._y,g._z,0,O._x,O._y,O._z,0,0,0,0,1,R)},T.FromQuaternionToRef=function(_,g){var O=_._x*_._x,R=_._y*_._y,N=_._z*_._z,V=_._x*_._y,U=_._z*_._w,L=_._z*_._x,j=_._y*_._w,Y=_._y*_._z,W=_._x*_._w;g._m[0]=1-2*(R+N),g._m[1]=2*(V+U),g._m[2]=2*(L-j),g._m[3]=0,g._m[4]=2*(V-U),g._m[5]=1-2*(N+O),g._m[6]=2*(Y+W),g._m[7]=0,g._m[8]=2*(L+j),g._m[9]=2*(Y-W),g._m[10]=1-2*(R+O),g._m[11]=0,g._m[12]=0,g._m[13]=0,g._m[14]=0,g._m[15]=1,g._markAsUpdated()},T._updateFlagSeed=0,T._identityReadOnly=T.Identity(),T}(),P=function(){function T(){}return T.Vector3=S.a.BuildArray(6,I.Zero),T.Matrix=S.a.BuildArray(2,x.Identity),T.Quaternion=S.a.BuildArray(3,p.Zero),T}(),A=function(){function T(){}return T.Vector2=S.a.BuildArray(3,C.Zero),T.Vector3=S.a.BuildArray(13,I.Zero),T.Vector4=S.a.BuildArray(3,b.Zero),T.Quaternion=S.a.BuildArray(2,p.Zero),T.Matrix=S.a.BuildArray(8,x.Identity),T}();d.a.RegisteredTypes["BABYLON.Vector2"]=C,d.a.RegisteredTypes["BABYLON.Vector3"]=I,d.a.RegisteredTypes["BABYLON.Vector4"]=b,d.a.RegisteredTypes["BABYLON.Matrix"]=x},function(h,s,c){c.d(s,"d",function(){return m}),c.d(s,"a",function(){return S}),c.d(s,"c",function(){return d}),c.d(s,"b",function(){return M}),c.d(s,"e",function(){return C}),c.d(s,"f",function(){return I});/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var E=function(b,p){return(E=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(x,P){x.__proto__=P}||function(x,P){for(var A in P)Object.prototype.hasOwnProperty.call(P,A)&&(x[A]=P[A])})(b,p)};function m(b,p){function x(){this.constructor=b}E(b,p),b.prototype=p===null?Object.create(p):(x.prototype=p.prototype,new x)}var S=function(){return(S=Object.assign||function(b){for(var p,x=1,P=arguments.length;x<P;x++)for(var A in p=arguments[x])Object.prototype.hasOwnProperty.call(p,A)&&(b[A]=p[A]);return b}).apply(this,arguments)};function d(b,p,x,P){var A,T=arguments.length,_=T<3?p:P===null?P=Object.getOwnPropertyDescriptor(p,x):P;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(b,p,x,P);else for(var g=b.length-1;g>=0;g--)(A=b[g])&&(_=(T<3?A(_):T>3?A(p,x,_):A(p,x))||_);return T>3&&_&&Object.defineProperty(p,x,_),_}function M(b,p,x,P){return new(x||(x=Promise))(function(A,T){function _(R){try{O(P.next(R))}catch(N){T(N)}}function g(R){try{O(P.throw(R))}catch(N){T(N)}}function O(R){var N;R.done?A(R.value):(N=R.value,N instanceof x?N:new x(function(V){V(N)})).then(_,g)}O((P=P.apply(b,p||[])).next())})}function C(b,p){var x,P,A,T,_={label:0,sent:function(){if(1&A[0])throw A[1];return A[1]},trys:[],ops:[]};return T={next:g(0),throw:g(1),return:g(2)},typeof Symbol=="function"&&(T[Symbol.iterator]=function(){return this}),T;function g(O){return function(R){return function(N){if(x)throw new TypeError("Generator is already executing.");for(;_;)try{if(x=1,P&&(A=2&N[0]?P.return:N[0]?P.throw||((A=P.return)&&A.call(P),0):P.next)&&!(A=A.call(P,N[1])).done)return A;switch(P=0,A&&(N=[2&N[0],A.value]),N[0]){case 0:case 1:A=N;break;case 4:return _.label++,{value:N[1],done:!1};case 5:_.label++,P=N[1],N=[0];continue;case 7:N=_.ops.pop(),_.trys.pop();continue;default:if(A=_.trys,!((A=A.length>0&&A[A.length-1])||N[0]!==6&&N[0]!==2)){_=0;continue}if(N[0]===3&&(!A||N[1]>A[0]&&N[1]<A[3])){_.label=N[1];break}if(N[0]===6&&_.label<A[1]){_.label=A[1],A=N;break}if(A&&_.label<A[2]){_.label=A[2],_.ops.push(N);break}A[2]&&_.ops.pop(),_.trys.pop();continue}N=p.call(b,_)}catch(V){N=[6,V],P=0}finally{x=A=0}if(5&N[0])throw N[1];return{value:N[0]?N[1]:void 0,done:!0}}([O,R])}}}function I(){for(var b=0,p=0,x=arguments.length;p<x;p++)b+=arguments[p].length;var P=Array(b),A=0;for(p=0;p<x;p++)for(var T=arguments[p],_=0,g=T.length;_<g;_++,A++)P[A]=T[_];return P}},function(h,s,c){c.d(s,"a",function(){return E});var E=function(){function m(){}return m.ALPHA_DISABLE=0,m.ALPHA_ADD=1,m.ALPHA_COMBINE=2,m.ALPHA_SUBTRACT=3,m.ALPHA_MULTIPLY=4,m.ALPHA_MAXIMIZED=5,m.ALPHA_ONEONE=6,m.ALPHA_PREMULTIPLIED=7,m.ALPHA_PREMULTIPLIED_PORTERDUFF=8,m.ALPHA_INTERPOLATE=9,m.ALPHA_SCREENMODE=10,m.ALPHA_ONEONE_ONEONE=11,m.ALPHA_ALPHATOCOLOR=12,m.ALPHA_REVERSEONEMINUS=13,m.ALPHA_SRC_DSTONEMINUSSRCALPHA=14,m.ALPHA_ONEONE_ONEZERO=15,m.ALPHA_EXCLUSION=16,m.ALPHA_EQUATION_ADD=0,m.ALPHA_EQUATION_SUBSTRACT=1,m.ALPHA_EQUATION_REVERSE_SUBTRACT=2,m.ALPHA_EQUATION_MAX=3,m.ALPHA_EQUATION_MIN=4,m.ALPHA_EQUATION_DARKEN=5,m.DELAYLOADSTATE_NONE=0,m.DELAYLOADSTATE_LOADED=1,m.DELAYLOADSTATE_LOADING=2,m.DELAYLOADSTATE_NOTLOADED=4,m.NEVER=512,m.ALWAYS=519,m.LESS=513,m.EQUAL=514,m.LEQUAL=515,m.GREATER=516,m.GEQUAL=518,m.NOTEQUAL=517,m.KEEP=7680,m.REPLACE=7681,m.INCR=7682,m.DECR=7683,m.INVERT=5386,m.INCR_WRAP=34055,m.DECR_WRAP=34056,m.TEXTURE_CLAMP_ADDRESSMODE=0,m.TEXTURE_WRAP_ADDRESSMODE=1,m.TEXTURE_MIRROR_ADDRESSMODE=2,m.TEXTUREFORMAT_ALPHA=0,m.TEXTUREFORMAT_LUMINANCE=1,m.TEXTUREFORMAT_LUMINANCE_ALPHA=2,m.TEXTUREFORMAT_RGB=4,m.TEXTUREFORMAT_RGBA=5,m.TEXTUREFORMAT_RED=6,m.TEXTUREFORMAT_R=6,m.TEXTUREFORMAT_RG=7,m.TEXTUREFORMAT_RED_INTEGER=8,m.TEXTUREFORMAT_R_INTEGER=8,m.TEXTUREFORMAT_RG_INTEGER=9,m.TEXTUREFORMAT_RGB_INTEGER=10,m.TEXTUREFORMAT_RGBA_INTEGER=11,m.TEXTURETYPE_UNSIGNED_BYTE=0,m.TEXTURETYPE_UNSIGNED_INT=0,m.TEXTURETYPE_FLOAT=1,m.TEXTURETYPE_HALF_FLOAT=2,m.TEXTURETYPE_BYTE=3,m.TEXTURETYPE_SHORT=4,m.TEXTURETYPE_UNSIGNED_SHORT=5,m.TEXTURETYPE_INT=6,m.TEXTURETYPE_UNSIGNED_INTEGER=7,m.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,m.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,m.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,m.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,m.TEXTURETYPE_UNSIGNED_INT_24_8=12,m.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,m.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,m.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,m.TEXTURE_NEAREST_SAMPLINGMODE=1,m.TEXTURE_NEAREST_NEAREST=1,m.TEXTURE_BILINEAR_SAMPLINGMODE=2,m.TEXTURE_LINEAR_LINEAR=2,m.TEXTURE_TRILINEAR_SAMPLINGMODE=3,m.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,m.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,m.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,m.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,m.TEXTURE_NEAREST_LINEAR=7,m.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,m.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,m.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,m.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,m.TEXTURE_LINEAR_NEAREST=12,m.TEXTURE_EXPLICIT_MODE=0,m.TEXTURE_SPHERICAL_MODE=1,m.TEXTURE_PLANAR_MODE=2,m.TEXTURE_CUBIC_MODE=3,m.TEXTURE_PROJECTION_MODE=4,m.TEXTURE_SKYBOX_MODE=5,m.TEXTURE_INVCUBIC_MODE=6,m.TEXTURE_EQUIRECTANGULAR_MODE=7,m.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,m.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,m.TEXTURE_FILTERING_QUALITY_OFFLINE=4096,m.TEXTURE_FILTERING_QUALITY_HIGH=64,m.TEXTURE_FILTERING_QUALITY_MEDIUM=16,m.TEXTURE_FILTERING_QUALITY_LOW=8,m.SCALEMODE_FLOOR=1,m.SCALEMODE_NEAREST=2,m.SCALEMODE_CEILING=3,m.MATERIAL_TextureDirtyFlag=1,m.MATERIAL_LightDirtyFlag=2,m.MATERIAL_FresnelDirtyFlag=4,m.MATERIAL_AttributesDirtyFlag=8,m.MATERIAL_MiscDirtyFlag=16,m.MATERIAL_PrePassDirtyFlag=32,m.MATERIAL_AllDirtyFlag=63,m.MATERIAL_TriangleFillMode=0,m.MATERIAL_WireFrameFillMode=1,m.MATERIAL_PointFillMode=2,m.MATERIAL_PointListDrawMode=3,m.MATERIAL_LineListDrawMode=4,m.MATERIAL_LineLoopDrawMode=5,m.MATERIAL_LineStripDrawMode=6,m.MATERIAL_TriangleStripDrawMode=7,m.MATERIAL_TriangleFanDrawMode=8,m.MATERIAL_ClockWiseSideOrientation=0,m.MATERIAL_CounterClockWiseSideOrientation=1,m.ACTION_NothingTrigger=0,m.ACTION_OnPickTrigger=1,m.ACTION_OnLeftPickTrigger=2,m.ACTION_OnRightPickTrigger=3,m.ACTION_OnCenterPickTrigger=4,m.ACTION_OnPickDownTrigger=5,m.ACTION_OnDoublePickTrigger=6,m.ACTION_OnPickUpTrigger=7,m.ACTION_OnPickOutTrigger=16,m.ACTION_OnLongPressTrigger=8,m.ACTION_OnPointerOverTrigger=9,m.ACTION_OnPointerOutTrigger=10,m.ACTION_OnEveryFrameTrigger=11,m.ACTION_OnIntersectionEnterTrigger=12,m.ACTION_OnIntersectionExitTrigger=13,m.ACTION_OnKeyDownTrigger=14,m.ACTION_OnKeyUpTrigger=15,m.PARTICLES_BILLBOARDMODE_Y=2,m.PARTICLES_BILLBOARDMODE_ALL=7,m.PARTICLES_BILLBOARDMODE_STRETCHED=8,m.MESHES_CULLINGSTRATEGY_STANDARD=0,m.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,m.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,m.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,m.SCENELOADER_NO_LOGGING=0,m.SCENELOADER_MINIMAL_LOGGING=1,m.SCENELOADER_SUMMARY_LOGGING=2,m.SCENELOADER_DETAILED_LOGGING=3,m.PREPASS_IRRADIANCE_TEXTURE_TYPE=0,m.PREPASS_POSITION_TEXTURE_TYPE=1,m.PREPASS_VELOCITY_TEXTURE_TYPE=2,m.PREPASS_REFLECTIVITY_TEXTURE_TYPE=3,m.PREPASS_COLOR_TEXTURE_TYPE=4,m.PREPASS_DEPTHNORMAL_TEXTURE_TYPE=5,m.PREPASS_ALBEDO_TEXTURE_TYPE=6,m}()},function(h,s,c){c.d(s,"b",function(){return x}),c.d(s,"c",function(){return P}),c.d(s,"m",function(){return A}),c.d(s,"e",function(){return T}),c.d(s,"h",function(){return _}),c.d(s,"n",function(){return g}),c.d(s,"o",function(){return O}),c.d(s,"k",function(){return R}),c.d(s,"g",function(){return N}),c.d(s,"f",function(){return V}),c.d(s,"i",function(){return U}),c.d(s,"l",function(){return L}),c.d(s,"j",function(){return j}),c.d(s,"d",function(){return Y}),c.d(s,"a",function(){return W});var E=c(37),m=c(0),S=c(21),d=c(9),M={},C={},I=function(re,ne,ge){var _e=re();E.a&&E.a.AddTagsTo(_e,ne.tags);var ce=b(_e);for(var ie in ce){var Z=ce[ie],te=ne[ie],B=Z.type;if(te!=null&&ie!=="uniqueId")switch(B){case 0:case 6:case 11:_e[ie]=te;break;case 1:_e[ie]=ge||te.isRenderTarget?te:te.clone();break;case 2:case 3:case 4:case 5:case 7:case 10:case 12:_e[ie]=ge?te:te.clone()}}return _e};function b(re){var ne=re.getClassName();if(C[ne])return C[ne];C[ne]={};for(var ge=C[ne],_e=re,ce=ne;ce;){var ie=M[ce];for(var Z in ie)ge[Z]=ie[Z];var te=void 0,B=!1;do{if(!(te=Object.getPrototypeOf(_e)).getClassName){B=!0;break}if(te.getClassName()!==ce)break;_e=te}while(te);if(B)break;ce=te.getClassName(),_e=te}return ge}function p(re,ne){return function(ge,_e){var ce=function(ie){var Z=ie.getClassName();return M[Z]||(M[Z]={}),M[Z]}(ge);ce[_e]||(ce[_e]={type:re,sourceName:ne})}}function x(re,ne){return ne===void 0&&(ne=null),function(ge,_e){return _e===void 0&&(_e=null),function(ce,ie){var Z=_e||"_"+ie;Object.defineProperty(ce,ie,{get:function(){return this[Z]},set:function(te){this[Z]!==te&&(this[Z]=te,ce[ge].apply(this))},enumerable:!0,configurable:!0})}}(re,ne)}function P(re){return p(0,re)}function A(re){return p(1,re)}function T(re){return p(2,re)}function _(re){return p(3,re)}function g(re){return p(4,re)}function O(re){return p(5,re)}function R(re){return p(6,re)}function N(re){return p(7,re)}function V(re){return p(8,re)}function U(re){return p(9,re)}function L(re){return p(10,re)}function j(re){return p(12,re)}function Y(re){return p(11,re)}var W=function(){function re(){}return re.AppendSerializedAnimations=function(ne,ge){if(ne.animations){ge.animations=[];for(var _e=0;_e<ne.animations.length;_e++){var ce=ne.animations[_e];ge.animations.push(ce.serialize())}}},re.Serialize=function(ne,ge){ge||(ge={}),E.a&&(ge.tags=E.a.GetTags(ne));var _e=b(ne);for(var ce in _e){var ie=_e[ce],Z=ie.sourceName||ce,te=ie.type,B=ne[ce];if(B!=null&&ce!=="uniqueId")switch(te){case 0:ge[Z]=B;break;case 1:ge[Z]=B.serialize();break;case 2:ge[Z]=B.asArray();break;case 3:ge[Z]=B.serialize();break;case 4:case 5:ge[Z]=B.asArray();break;case 6:ge[Z]=B.id;break;case 7:ge[Z]=B.serialize();break;case 8:ge[Z]=B.asArray();break;case 9:ge[Z]=B.serialize();break;case 10:ge[Z]=B.asArray();break;case 11:ge[Z]=B.id;case 12:ge[Z]=B.asArray()}}return ge},re.Parse=function(ne,ge,_e,ce){ce===void 0&&(ce=null);var ie=ne();ce||(ce=""),E.a&&E.a.AddTagsTo(ie,ge.tags);var Z=b(ie);for(var te in Z){var B=Z[te],G=ge[B.sourceName||te],$=B.type;if(G!=null&&te!=="uniqueId"){var le=ie;switch($){case 0:le[te]=G;break;case 1:_e&&(le[te]=re._TextureParser(G,_e,ce));break;case 2:le[te]=d.a.FromArray(G);break;case 3:le[te]=re._FresnelParametersParser(G);break;case 4:le[te]=m.d.FromArray(G);break;case 5:le[te]=m.e.FromArray(G);break;case 6:_e&&(le[te]=_e.getLastMeshByID(G));break;case 7:le[te]=re._ColorCurvesParser(G);break;case 8:le[te]=d.b.FromArray(G);break;case 9:le[te]=re._ImageProcessingConfigurationParser(G);break;case 10:le[te]=m.b.FromArray(G);break;case 11:_e&&(le[te]=_e.getCameraByID(G));case 12:le[te]=m.a.FromArray(G)}}}return ie},re.Clone=function(ne,ge){return I(ne,ge,!1)},re.Instanciate=function(ne,ge){return I(ne,ge,!0)},re._ImageProcessingConfigurationParser=function(ne){throw S.a.WarnImport("ImageProcessingConfiguration")},re._FresnelParametersParser=function(ne){throw S.a.WarnImport("FresnelParameters")},re._ColorCurvesParser=function(ne){throw S.a.WarnImport("ColorCurves")},re._TextureParser=function(ne,ge,_e){throw S.a.WarnImport("Texture")},re}()},function(h,s,c){c.d(s,"a",function(){return E}),c.d(s,"b",function(){return m});var E=function(){function S(d,M,C,I,b,p,x,P){I===void 0&&(I=0),b===void 0&&(b=!1),p===void 0&&(p=!1),x===void 0&&(x=!1),this._isAlreadyOwned=!1,d.getScene?this._engine=d.getScene().getEngine():this._engine=d,this._updatable=C,this._instanced=p,this._divisor=P||1,this._data=M,this.byteStride=x?I:I*Float32Array.BYTES_PER_ELEMENT,b||this.create()}return S.prototype.createVertexBuffer=function(d,M,C,I,b,p,x){p===void 0&&(p=!1);var P=p?M:M*Float32Array.BYTES_PER_ELEMENT,A=I?p?I:I*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new m(this._engine,this,d,this._updatable,!0,A,b===void 0?this._instanced:b,P,C,void 0,void 0,!0,this._divisor||x)},S.prototype.isUpdatable=function(){return this._updatable},S.prototype.getData=function(){return this._data},S.prototype.getBuffer=function(){return this._buffer},S.prototype.getStrideSize=function(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT},S.prototype.create=function(d){d===void 0&&(d=null),!d&&this._buffer||(d=d||this._data)&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,d),this._data=d):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(d),this._data=d):this._buffer=this._engine.createVertexBuffer(d))},S.prototype._rebuild=function(){this._buffer=null,this.create(this._data)},S.prototype.update=function(d){this.create(d)},S.prototype.updateDirectly=function(d,M,C,I){I===void 0&&(I=!1),this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,d,I?M:M*Float32Array.BYTES_PER_ELEMENT,C?C*this.byteStride:void 0),this._data=null)},S.prototype._increaseReferences=function(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)},S.prototype.dispose=function(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)},S}(),m=function(){function S(d,M,C,I,b,p,x,P,A,T,_,g,O,R){if(_===void 0&&(_=!1),g===void 0&&(g=!1),O===void 0&&(O=1),R===void 0&&(R=!1),M instanceof E?(this._buffer=M,this._ownsBuffer=R,R&&this._buffer._increaseReferences()):(this._buffer=new E(d,M,I,p,b,x,g),this._ownsBuffer=!0),this._kind=C,T==null){var N=this.getData();this.type=S.FLOAT,N instanceof Int8Array?this.type=S.BYTE:N instanceof Uint8Array?this.type=S.UNSIGNED_BYTE:N instanceof Int16Array?this.type=S.SHORT:N instanceof Uint16Array?this.type=S.UNSIGNED_SHORT:N instanceof Int32Array?this.type=S.INT:N instanceof Uint32Array&&(this.type=S.UNSIGNED_INT)}else this.type=T;var V=S.GetTypeByteLength(this.type);g?(this._size=A||(p?p/V:S.DeduceStride(C)),this.byteStride=p||this._buffer.byteStride||this._size*V,this.byteOffset=P||0):(this._size=A||p||S.DeduceStride(C),this.byteStride=p?p*V:this._buffer.byteStride||this._size*V,this.byteOffset=(P||0)*V),this.normalized=_,this._instanced=x!==void 0&&x,this._instanceDivisor=x?O:0}return Object.defineProperty(S.prototype,"instanceDivisor",{get:function(){return this._instanceDivisor},set:function(d){this._instanceDivisor=d,this._instanced=d!=0},enumerable:!1,configurable:!0}),S.prototype._rebuild=function(){this._buffer&&this._buffer._rebuild()},S.prototype.getKind=function(){return this._kind},S.prototype.isUpdatable=function(){return this._buffer.isUpdatable()},S.prototype.getData=function(){return this._buffer.getData()},S.prototype.getBuffer=function(){return this._buffer.getBuffer()},S.prototype.getStrideSize=function(){return this.byteStride/S.GetTypeByteLength(this.type)},S.prototype.getOffset=function(){return this.byteOffset/S.GetTypeByteLength(this.type)},S.prototype.getSize=function(){return this._size},S.prototype.getIsInstanced=function(){return this._instanced},S.prototype.getInstanceDivisor=function(){return this._instanceDivisor},S.prototype.create=function(d){this._buffer.create(d)},S.prototype.update=function(d){this._buffer.update(d)},S.prototype.updateDirectly=function(d,M,C){C===void 0&&(C=!1),this._buffer.updateDirectly(d,M,void 0,C)},S.prototype.dispose=function(){this._ownsBuffer&&this._buffer.dispose()},S.prototype.forEach=function(d,M){S.ForEach(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,d,this.normalized,M)},S.DeduceStride=function(d){switch(d){case S.UVKind:case S.UV2Kind:case S.UV3Kind:case S.UV4Kind:case S.UV5Kind:case S.UV6Kind:return 2;case S.NormalKind:case S.PositionKind:return 3;case S.ColorKind:case S.MatricesIndicesKind:case S.MatricesIndicesExtraKind:case S.MatricesWeightsKind:case S.MatricesWeightsExtraKind:case S.TangentKind:return 4;default:throw new Error("Invalid kind '"+d+"'")}},S.GetTypeByteLength=function(d){switch(d){case S.BYTE:case S.UNSIGNED_BYTE:return 1;case S.SHORT:case S.UNSIGNED_SHORT:return 2;case S.INT:case S.UNSIGNED_INT:case S.FLOAT:return 4;default:throw new Error("Invalid type '"+d+"'")}},S.ForEach=function(d,M,C,I,b,p,x,P){if(d instanceof Array)for(var A=M/4,T=C/4,_=0;_<p;_+=I){for(var g=0;g<I;g++)P(d[A+g],_+g);A+=T}else{var O=d instanceof ArrayBuffer?new DataView(d):new DataView(d.buffer,d.byteOffset,d.byteLength),R=S.GetTypeByteLength(b);for(_=0;_<p;_+=I){var N=M;for(g=0;g<I;g++)P(S._GetFloatValue(O,b,N,x),_+g),N+=R;M+=C}}},S._GetFloatValue=function(d,M,C,I){switch(M){case S.BYTE:var b=d.getInt8(C);return I&&(b=Math.max(b/127,-1)),b;case S.UNSIGNED_BYTE:return b=d.getUint8(C),I&&(b/=255),b;case S.SHORT:return b=d.getInt16(C,!0),I&&(b=Math.max(b/32767,-1)),b;case S.UNSIGNED_SHORT:return b=d.getUint16(C,!0),I&&(b/=65535),b;case S.INT:return d.getInt32(C,!0);case S.UNSIGNED_INT:return d.getUint32(C,!0);case S.FLOAT:return d.getFloat32(C,!0);default:throw new Error("Invalid component type "+M)}},S.BYTE=5120,S.UNSIGNED_BYTE=5121,S.SHORT=5122,S.UNSIGNED_SHORT=5123,S.INT=5124,S.UNSIGNED_INT=5125,S.FLOAT=5126,S.PositionKind="position",S.NormalKind="normal",S.TangentKind="tangent",S.UVKind="uv",S.UV2Kind="uv2",S.UV3Kind="uv3",S.UV4Kind="uv4",S.UV5Kind="uv5",S.UV6Kind="uv6",S.ColorKind="color",S.MatricesIndicesKind="matricesIndices",S.MatricesWeightsKind="matricesWeights",S.MatricesIndicesExtraKind="matricesIndicesExtra",S.MatricesWeightsExtraKind="matricesWeightsExtra",S}()},function(h,s,c){c.d(s,"a",function(){return C});var E=c(6),m=c(2),S=c(38),d=c(8),M=c(128),C=function(){function I(b,p,x,P,A,T,_,g,O,R){var N,V=this;P===void 0&&(P=null),T===void 0&&(T=null),_===void 0&&(_=null),g===void 0&&(g=null),O===void 0&&(O=null),this.name=null,this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new E.c,this.onErrorObservable=new E.c,this._onBindObservable=null,this._wasPreviouslyReady=!1,this._bonesComputationForcedToCPU=!1,this._multiTarget=!1,this._uniformBuffersNames={},this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._pipelineContext=null,this._valueCache={},this.name=b;var U,L,j=null;if(p.attributes){var Y=p;if(this._engine=x,this._attributesNames=Y.attributes,this._uniformsNames=Y.uniformsNames.concat(Y.samplers),this._samplerList=Y.samplers.slice(),this.defines=Y.defines,this.onError=Y.onError,this.onCompiled=Y.onCompiled,this._fallbacks=Y.fallbacks,this._indexParameters=Y.indexParameters,this._transformFeedbackVaryings=Y.transformFeedbackVaryings||null,this._multiTarget=!!Y.multiTarget,Y.uniformBuffersNames){this._uniformBuffersNamesList=Y.uniformBuffersNames.slice();for(var W=0;W<Y.uniformBuffersNames.length;W++)this._uniformBuffersNames[Y.uniformBuffersNames[W]]=W}j=(N=Y.processFinalCode)!==null&&N!==void 0?N:null}else this._engine=A,this.defines=T??"",this._uniformsNames=x.concat(P),this._samplerList=P?P.slice():[],this._attributesNames=p,this._uniformBuffersNamesList=[],this.onError=O,this.onCompiled=g,this._indexParameters=R,this._fallbacks=_;this._attributeLocationByName={},this.uniqueId=I._uniqueIdSeed++;var re=S.a.IsWindowObjectExist()?this._engine.getHostDocument():null;b.vertexSource?U="source:"+b.vertexSource:b.vertexElement?(U=re?re.getElementById(b.vertexElement):null)||(U=b.vertexElement):U=b.vertex||b,b.fragmentSource?L="source:"+b.fragmentSource:b.fragmentElement?(L=re?re.getElementById(b.fragmentElement):null)||(L=b.fragmentElement):L=b.fragment||b;var ne={defines:this.defines.split(`
`),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:this._engine._shaderProcessor,supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:I.ShadersRepository,includesShadersStore:I.IncludesShadersStore,version:(100*this._engine.webGLVersion).toString(),platformName:this._engine.webGLVersion>=2?"WEBGL2":"WEBGL1"};this._loadShader(U,"Vertex","",function(ge){V._rawVertexSourceCode=ge,V._loadShader(L,"Fragment","Pixel",function(_e){V._rawFragmentSourceCode=_e,M.a.Process(ge,ne,function(ce){j&&(ce=j("vertex",ce)),ne.isFragment=!0,M.a.Process(_e,ne,function(ie){j&&(ie=j("fragment",ie)),V._useFinalCode(ce,ie,b)},V._engine)},V._engine)})})}return Object.defineProperty(I.prototype,"onBindObservable",{get:function(){return this._onBindObservable||(this._onBindObservable=new E.c),this._onBindObservable},enumerable:!1,configurable:!0}),I.prototype._useFinalCode=function(b,p,x){if(x){var P=x.vertexElement||x.vertex||x.spectorName||x,A=x.fragmentElement||x.fragment||x.spectorName||x;this._vertexSourceCode="#define SHADER_NAME vertex:"+P+`
`+b,this._fragmentSourceCode="#define SHADER_NAME fragment:"+A+`
`+p}else this._vertexSourceCode=b,this._fragmentSourceCode=p;this._prepareEffect()},Object.defineProperty(I.prototype,"key",{get:function(){return this._key},enumerable:!1,configurable:!0}),I.prototype.isReady=function(){try{return this._isReadyInternal()}catch(b){return!1}},I.prototype._isReadyInternal=function(){return!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady},I.prototype.getEngine=function(){return this._engine},I.prototype.getPipelineContext=function(){return this._pipelineContext},I.prototype.getAttributesNames=function(){return this._attributesNames},I.prototype.getAttributeLocation=function(b){return this._attributes[b]},I.prototype.getAttributeLocationByName=function(b){return this._attributeLocationByName[b]},I.prototype.getAttributesCount=function(){return this._attributes.length},I.prototype.getUniformIndex=function(b){return this._uniformsNames.indexOf(b)},I.prototype.getUniform=function(b){return this._uniforms[b]},I.prototype.getSamplers=function(){return this._samplerList},I.prototype.getUniformNames=function(){return this._uniformsNames},I.prototype.getUniformBuffersNames=function(){return this._uniformBuffersNamesList},I.prototype.getIndexParameters=function(){return this._indexParameters},I.prototype.getCompilationError=function(){return this._compilationError},I.prototype.allFallbacksProcessed=function(){return this._allFallbacksProcessed},I.prototype.executeWhenCompiled=function(b){var p=this;this.isReady()?b(this):(this.onCompileObservable.add(function(x){b(x)}),this._pipelineContext&&!this._pipelineContext.isAsync||setTimeout(function(){p._checkIsReady(null)},16))},I.prototype._checkIsReady=function(b){var p=this;try{if(this._isReadyInternal())return}catch(x){return void this._processCompilationErrors(x,b)}setTimeout(function(){p._checkIsReady(b)},16)},I.prototype._loadShader=function(b,p,x,P){var A;if(typeof HTMLElement!="undefined"&&b instanceof HTMLElement)return void P(S.a.GetDOMTextContent(b));b.substr(0,7)!=="source:"?b.substr(0,7)!=="base64:"?I.ShadersStore[b+p+"Shader"]?P(I.ShadersStore[b+p+"Shader"]):x&&I.ShadersStore[b+x+"Shader"]?P(I.ShadersStore[b+x+"Shader"]):(A=b[0]==="."||b[0]==="/"||b.indexOf("http")>-1?b:I.ShadersRepository+b,this._engine._loadFile(A+"."+p.toLowerCase()+".fx",P)):P(window.atob(b.substr(7))):P(b.substr(7))},Object.defineProperty(I.prototype,"vertexSourceCode",{get:function(){return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:this._vertexSourceCode},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"fragmentSourceCode",{get:function(){return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:this._fragmentSourceCode},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"rawVertexSourceCode",{get:function(){return this._rawVertexSourceCode},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"rawFragmentSourceCode",{get:function(){return this._rawFragmentSourceCode},enumerable:!1,configurable:!0}),I.prototype._rebuildProgram=function(b,p,x,P){var A=this;this._isReady=!1,this._vertexSourceCodeOverride=b,this._fragmentSourceCodeOverride=p,this.onError=function(T,_){P&&P(_)},this.onCompiled=function(){var T=A.getEngine().scenes;if(T)for(var _=0;_<T.length;_++)T[_].markAllMaterialsAsDirty(m.a.MATERIAL_AllDirtyFlag);A._pipelineContext._handlesSpectorRebuildCallback(x)},this._fallbacks=null,this._prepareEffect()},I.prototype._prepareEffect=function(){var b=this,p=this._attributesNames,x=this.defines;this._valueCache={};var P=this._pipelineContext;try{var A=this._engine;this._pipelineContext=A.createPipelineContext();var T=this._rebuildProgram.bind(this);this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?A._preparePipelineContext(this._pipelineContext,this._vertexSourceCodeOverride,this._fragmentSourceCodeOverride,!0,T,null,this._transformFeedbackVaryings):A._preparePipelineContext(this._pipelineContext,this._vertexSourceCode,this._fragmentSourceCode,!1,T,x,this._transformFeedbackVaryings),A._executeWhenRenderingStateIsCompiled(this._pipelineContext,function(){if(A.supportsUniformBuffers)for(var _ in b._uniformBuffersNames)b.bindUniformBlock(_,b._uniformBuffersNames[_]);var g;if(A.getUniforms(b._pipelineContext,b._uniformsNames).forEach(function(N,V){b._uniforms[b._uniformsNames[V]]=N}),b._attributes=A.getAttributes(b._pipelineContext,p),p)for(var O=0;O<p.length;O++){var R=p[O];b._attributeLocationByName[R]=b._attributes[O]}for(g=0;g<b._samplerList.length;g++)b.getUniform(b._samplerList[g])==null&&(b._samplerList.splice(g,1),g--);b._samplerList.forEach(function(N,V){b._samplers[N]=V}),A.bindSamplers(b),b._compilationError="",b._isReady=!0,b.onCompiled&&b.onCompiled(b),b.onCompileObservable.notifyObservers(b),b.onCompileObservable.clear(),b._fallbacks&&b._fallbacks.unBindMesh(),P&&b.getEngine()._deletePipelineContext(P)}),this._pipelineContext.isAsync&&this._checkIsReady(P)}catch(_){this._processCompilationErrors(_,P)}},I.prototype._getShaderCodeAndErrorLine=function(b,p,x){var P=x?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/,A=null;if(p&&b){var T=p.match(P);if(T&&T.length===2){var _=parseInt(T[1]),g=b.split(`
`,-1);g.length>=_&&(A="Offending line ["+_+"] in "+(x?"fragment":"vertex")+" code: "+g[_-1])}}return[b,A]},I.prototype._processCompilationErrors=function(b,p){var x,P,A,T,_;p===void 0&&(p=null),this._compilationError=b.message;var g=this._attributesNames,O=this._fallbacks;if(d.a.Error("Unable to compile effect:"),d.a.Error("Uniforms: "+this._uniformsNames.map(function(U){return" "+U})),d.a.Error("Attributes: "+g.map(function(U){return" "+U})),d.a.Error(`Defines:\r
`+this.defines),I.LogShaderCodeOnCompilationError){var R=null,N=null,V=null;((A=this._pipelineContext)===null||A===void 0?void 0:A._getVertexShaderCode())&&(V=(x=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1))[0],R=x[1],V&&(d.a.Error("Vertex code:"),d.a.Error(V))),((T=this._pipelineContext)===null||T===void 0?void 0:T._getFragmentShaderCode())&&(V=(P=this._getShaderCodeAndErrorLine((_=this._pipelineContext)===null||_===void 0?void 0:_._getFragmentShaderCode(),this._compilationError,!0))[0],N=P[1],V&&(d.a.Error("Fragment code:"),d.a.Error(V))),R&&d.a.Error(R),N&&d.a.Error(N)}d.a.Error("Error: "+this._compilationError),p&&(this._pipelineContext=p,this._isReady=!0,this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this)),O?(this._pipelineContext=null,O.hasMoreFallbacks?(this._allFallbacksProcessed=!1,d.a.Error("Trying next fallback."),this.defines=O.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):this._allFallbacksProcessed=!0},Object.defineProperty(I.prototype,"isSupported",{get:function(){return this._compilationError===""},enumerable:!1,configurable:!0}),I.prototype._bindTexture=function(b,p){this._engine._bindTexture(this._samplers[b],p)},I.prototype.setTexture=function(b,p){this._engine.setTexture(this._samplers[b],this._uniforms[b],p)},I.prototype.setDepthStencilTexture=function(b,p){this._engine.setDepthStencilTexture(this._samplers[b],this._uniforms[b],p)},I.prototype.setTextureArray=function(b,p){var x=b+"Ex";if(this._samplerList.indexOf(x+"0")===-1){for(var P=this._samplerList.indexOf(b),A=1;A<p.length;A++){var T=x+(A-1).toString();this._samplerList.splice(P+A,0,T)}for(var _=0,g=0,O=this._samplerList;g<O.length;g++){var R=O[g];this._samplers[R]=_,_+=1}}this._engine.setTextureArray(this._samplers[b],this._uniforms[b],p)},I.prototype.setTextureFromPostProcess=function(b,p){this._engine.setTextureFromPostProcess(this._samplers[b],p)},I.prototype.setTextureFromPostProcessOutput=function(b,p){this._engine.setTextureFromPostProcessOutput(this._samplers[b],p)},I.prototype._cacheMatrix=function(b,p){var x=this._valueCache[b],P=p.updateFlag;return(x===void 0||x!==P)&&(this._valueCache[b]=P,!0)},I.prototype._cacheFloat2=function(b,p,x){var P=this._valueCache[b];if(!P||P.length!==2)return P=[p,x],this._valueCache[b]=P,!0;var A=!1;return P[0]!==p&&(P[0]=p,A=!0),P[1]!==x&&(P[1]=x,A=!0),A},I.prototype._cacheFloat3=function(b,p,x,P){var A=this._valueCache[b];if(!A||A.length!==3)return A=[p,x,P],this._valueCache[b]=A,!0;var T=!1;return A[0]!==p&&(A[0]=p,T=!0),A[1]!==x&&(A[1]=x,T=!0),A[2]!==P&&(A[2]=P,T=!0),T},I.prototype._cacheFloat4=function(b,p,x,P,A){var T=this._valueCache[b];if(!T||T.length!==4)return T=[p,x,P,A],this._valueCache[b]=T,!0;var _=!1;return T[0]!==p&&(T[0]=p,_=!0),T[1]!==x&&(T[1]=x,_=!0),T[2]!==P&&(T[2]=P,_=!0),T[3]!==A&&(T[3]=A,_=!0),_},I.prototype.bindUniformBuffer=function(b,p){var x=this._uniformBuffersNames[p];x!==void 0&&I._baseCache[x]!==b&&(I._baseCache[x]=b,this._engine.bindUniformBufferBase(b,x))},I.prototype.bindUniformBlock=function(b,p){this._engine.bindUniformBlock(this._pipelineContext,b,p)},I.prototype.setInt=function(b,p){var x=this._valueCache[b];return x!==void 0&&x===p||this._engine.setInt(this._uniforms[b],p)&&(this._valueCache[b]=p),this},I.prototype.setIntArray=function(b,p){return this._valueCache[b]=null,this._engine.setIntArray(this._uniforms[b],p),this},I.prototype.setIntArray2=function(b,p){return this._valueCache[b]=null,this._engine.setIntArray2(this._uniforms[b],p),this},I.prototype.setIntArray3=function(b,p){return this._valueCache[b]=null,this._engine.setIntArray3(this._uniforms[b],p),this},I.prototype.setIntArray4=function(b,p){return this._valueCache[b]=null,this._engine.setIntArray4(this._uniforms[b],p),this},I.prototype.setFloatArray=function(b,p){return this._valueCache[b]=null,this._engine.setArray(this._uniforms[b],p),this},I.prototype.setFloatArray2=function(b,p){return this._valueCache[b]=null,this._engine.setArray2(this._uniforms[b],p),this},I.prototype.setFloatArray3=function(b,p){return this._valueCache[b]=null,this._engine.setArray3(this._uniforms[b],p),this},I.prototype.setFloatArray4=function(b,p){return this._valueCache[b]=null,this._engine.setArray4(this._uniforms[b],p),this},I.prototype.setArray=function(b,p){return this._valueCache[b]=null,this._engine.setArray(this._uniforms[b],p),this},I.prototype.setArray2=function(b,p){return this._valueCache[b]=null,this._engine.setArray2(this._uniforms[b],p),this},I.prototype.setArray3=function(b,p){return this._valueCache[b]=null,this._engine.setArray3(this._uniforms[b],p),this},I.prototype.setArray4=function(b,p){return this._valueCache[b]=null,this._engine.setArray4(this._uniforms[b],p),this},I.prototype.setMatrices=function(b,p){return p?(this._valueCache[b]=null,this._engine.setMatrices(this._uniforms[b],p),this):this},I.prototype.setMatrix=function(b,p){return this._cacheMatrix(b,p)&&(this._engine.setMatrices(this._uniforms[b],p.toArray())||(this._valueCache[b]=null)),this},I.prototype.setMatrix3x3=function(b,p){return this._valueCache[b]=null,this._engine.setMatrix3x3(this._uniforms[b],p),this},I.prototype.setMatrix2x2=function(b,p){return this._valueCache[b]=null,this._engine.setMatrix2x2(this._uniforms[b],p),this},I.prototype.setFloat=function(b,p){var x=this._valueCache[b];return x!==void 0&&x===p||this._engine.setFloat(this._uniforms[b],p)&&(this._valueCache[b]=p),this},I.prototype.setBool=function(b,p){var x=this._valueCache[b];return x!==void 0&&x===p||this._engine.setInt(this._uniforms[b],p?1:0)&&(this._valueCache[b]=p),this},I.prototype.setVector2=function(b,p){return this._cacheFloat2(b,p.x,p.y)&&(this._engine.setFloat2(this._uniforms[b],p.x,p.y)||(this._valueCache[b]=null)),this},I.prototype.setFloat2=function(b,p,x){return this._cacheFloat2(b,p,x)&&(this._engine.setFloat2(this._uniforms[b],p,x)||(this._valueCache[b]=null)),this},I.prototype.setVector3=function(b,p){return this._cacheFloat3(b,p.x,p.y,p.z)&&(this._engine.setFloat3(this._uniforms[b],p.x,p.y,p.z)||(this._valueCache[b]=null)),this},I.prototype.setFloat3=function(b,p,x,P){return this._cacheFloat3(b,p,x,P)&&(this._engine.setFloat3(this._uniforms[b],p,x,P)||(this._valueCache[b]=null)),this},I.prototype.setVector4=function(b,p){return this._cacheFloat4(b,p.x,p.y,p.z,p.w)&&(this._engine.setFloat4(this._uniforms[b],p.x,p.y,p.z,p.w)||(this._valueCache[b]=null)),this},I.prototype.setFloat4=function(b,p,x,P,A){return this._cacheFloat4(b,p,x,P,A)&&(this._engine.setFloat4(this._uniforms[b],p,x,P,A)||(this._valueCache[b]=null)),this},I.prototype.setColor3=function(b,p){return this._cacheFloat3(b,p.r,p.g,p.b)&&(this._engine.setFloat3(this._uniforms[b],p.r,p.g,p.b)||(this._valueCache[b]=null)),this},I.prototype.setColor4=function(b,p,x){return this._cacheFloat4(b,p.r,p.g,p.b,x)&&(this._engine.setFloat4(this._uniforms[b],p.r,p.g,p.b,x)||(this._valueCache[b]=null)),this},I.prototype.setDirectColor4=function(b,p){return this._cacheFloat4(b,p.r,p.g,p.b,p.a)&&(this._engine.setFloat4(this._uniforms[b],p.r,p.g,p.b,p.a)||(this._valueCache[b]=null)),this},I.prototype.dispose=function(){this._engine._releaseEffect(this)},I.RegisterShader=function(b,p,x){p&&(I.ShadersStore[b+"PixelShader"]=p),x&&(I.ShadersStore[b+"VertexShader"]=x)},I.ResetCache=function(){I._baseCache={}},I.ShadersRepository="src/Shaders/",I.LogShaderCodeOnCompilationError=!0,I._uniqueIdSeed=0,I._baseCache={},I.ShadersStore={},I.IncludesShadersStore={},I}()},function(h,s,c){c.d(s,"a",function(){return E}),c.d(s,"d",function(){return m}),c.d(s,"b",function(){return S}),c.d(s,"c",function(){return d});var E=function(){function M(C,I,b,p){I===void 0&&(I=!1),this.initalize(C,I,b,p)}return M.prototype.initalize=function(C,I,b,p){return I===void 0&&(I=!1),this.mask=C,this.skipNextObservers=I,this.target=b,this.currentTarget=p,this},M}(),m=function(M,C,I){I===void 0&&(I=null),this.callback=M,this.mask=C,this.scope=I,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1},S=function(){function M(){}return M.prototype.dispose=function(){if(this._observers&&this._observables)for(var C=0;C<this._observers.length;C++)this._observables[C].remove(this._observers[C]);this._observers=null,this._observables=null},M.Watch=function(C,I,b,p){b===void 0&&(b=-1),p===void 0&&(p=null);var x=new M;x._observers=new Array,x._observables=C;for(var P=0,A=C;P<A.length;P++){var T=A[P].add(I,b,!1,p);T&&x._observers.push(T)}return x},M}(),d=function(){function M(C){this._observers=new Array,this._eventState=new E(0),C&&(this._onObserverAdded=C)}return Object.defineProperty(M.prototype,"observers",{get:function(){return this._observers},enumerable:!1,configurable:!0}),M.prototype.add=function(C,I,b,p,x){if(I===void 0&&(I=-1),b===void 0&&(b=!1),p===void 0&&(p=null),x===void 0&&(x=!1),!C)return null;var P=new m(C,I,p);return P.unregisterOnNextCall=x,b?this._observers.unshift(P):this._observers.push(P),this._onObserverAdded&&this._onObserverAdded(P),P},M.prototype.addOnce=function(C){return this.add(C,void 0,void 0,void 0,!0)},M.prototype.remove=function(C){return!!C&&this._observers.indexOf(C)!==-1&&(this._deferUnregister(C),!0)},M.prototype.removeCallback=function(C,I){for(var b=0;b<this._observers.length;b++){var p=this._observers[b];if(!p._willBeUnregistered&&p.callback===C&&(!I||I===p.scope))return this._deferUnregister(p),!0}return!1},M.prototype._deferUnregister=function(C){var I=this;C.unregisterOnNextCall=!1,C._willBeUnregistered=!0,setTimeout(function(){I._remove(C)},0)},M.prototype._remove=function(C){if(!C)return!1;var I=this._observers.indexOf(C);return I!==-1&&(this._observers.splice(I,1),!0)},M.prototype.makeObserverTopPriority=function(C){this._remove(C),this._observers.unshift(C)},M.prototype.makeObserverBottomPriority=function(C){this._remove(C),this._observers.push(C)},M.prototype.notifyObservers=function(C,I,b,p,x){if(I===void 0&&(I=-1),!this._observers.length)return!0;var P=this._eventState;P.mask=I,P.target=b,P.currentTarget=p,P.skipNextObservers=!1,P.lastReturnValue=C,P.userInfo=x;for(var A=0,T=this._observers;A<T.length;A++){var _=T[A];if(!_._willBeUnregistered&&(_.mask&I&&(_.scope?P.lastReturnValue=_.callback.apply(_.scope,[C,P]):P.lastReturnValue=_.callback(C,P),_.unregisterOnNextCall&&this._deferUnregister(_)),P.skipNextObservers))return!1}return!0},M.prototype.notifyObserversWithPromise=function(C,I,b,p,x){var P=this;I===void 0&&(I=-1);var A=Promise.resolve(C);if(!this._observers.length)return A;var T=this._eventState;return T.mask=I,T.target=b,T.currentTarget=p,T.skipNextObservers=!1,T.userInfo=x,this._observers.forEach(function(_){T.skipNextObservers||_._willBeUnregistered||_.mask&I&&(A=_.scope?A.then(function(g){return T.lastReturnValue=g,_.callback.apply(_.scope,[C,T])}):A.then(function(g){return T.lastReturnValue=g,_.callback(C,T)}),_.unregisterOnNextCall&&P._deferUnregister(_))}),A.then(function(){return C})},M.prototype.notifyObserver=function(C,I,b){b===void 0&&(b=-1);var p=this._eventState;p.mask=b,p.skipNextObservers=!1,C.callback(I,p)},M.prototype.hasObservers=function(){return this._observers.length>0},M.prototype.clear=function(){this._observers=new Array,this._onObserverAdded=null},M.prototype.clone=function(){var C=new M;return C._observers=this._observers.slice(0),C},M.prototype.hasSpecificMask=function(C){C===void 0&&(C=-1);for(var I=0,b=this._observers;I<b.length;I++){var p=b[I];if(p.mask&C||p.mask===C)return!0}return!1},M}()},function(h,s,c){c.d(s,"b",function(){return ne}),c.d(s,"c",function(){return _e}),c.d(s,"a",function(){return Z});var E=c(1),m=c(6),S=c(12),d=c(41),M=c(37),C=c(0),I=c(9),b=c(29),p=c(4),x=c(16),P=c(71),A=c(31),T=c(61),_=c(43),g=c(25),O=c(68),R=c(69),N=c(2),V=c(3),U=c(8),L=c(11),j=c(21),Y=c(17),W=c(149),re=c(70),ne=function(){},ge=function(){this.visibleInstances={},this.batchCache=new _e,this.instancesBufferSize=2048},_e=function(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=new Array,this.hardwareInstancedRendering=new Array},ce=function(){this.instancesCount=0,this.matrixBuffer=null,this.matrixBufferSize=512,this.boundingVectors=[],this.worldMatrices=null},ie=function(){this._areNormalsFrozen=!1,this._source=null,this.meshMap=null,this._preActivateId=-1,this._LODLevels=new Array,this._morphTargetManager=null},Z=function(te){function B(G,$,le,se,q,H){$===void 0&&($=null),le===void 0&&(le=null),se===void 0&&(se=null),H===void 0&&(H=!0);var X=te.call(this,G,$)||this;if(X._internalMeshDataInfo=new ie,X.delayLoadState=N.a.DELAYLOADSTATE_NONE,X.instances=new Array,X._creationDataStorage=null,X._geometry=null,X._instanceDataStorage=new ge,X._thinInstanceDataStorage=new ce,X._effectiveMaterial=null,X._shouldGenerateFlatShading=!1,X._originalBuilderSideOrientation=B.DEFAULTSIDE,X.overrideMaterialSideOrientation=null,$=X.getScene(),se){if(se._geometry&&se._geometry.applyToMesh(X),d.a.DeepCopy(se,X,["name","material","skeleton","instances","parent","uniqueId","source","metadata","morphTargetManager","hasInstances","source","worldMatrixInstancedBuffer","hasLODLevels","geometry","isBlocked","areNormalsFrozen","facetNb","isFacetDataEnabled","lightSources","useBones","isAnInstance","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","isWorldMatrixFrozen","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","cloneMeshMap"],["_poseMatrix"]),X._internalMeshDataInfo._source=se,$.useClonedMeshMap&&(se._internalMeshDataInfo.meshMap||(se._internalMeshDataInfo.meshMap={}),se._internalMeshDataInfo.meshMap[X.uniqueId]=X),X._originalBuilderSideOrientation=se._originalBuilderSideOrientation,X._creationDataStorage=se._creationDataStorage,se._ranges){var J=se._ranges;for(var G in J)J.hasOwnProperty(G)&&J[G]&&X.createAnimationRange(G,J[G].from,J[G].to)}var Q;if(se.metadata&&se.metadata.clone?X.metadata=se.metadata.clone():X.metadata=se.metadata,M.a&&M.a.HasTags(se)&&M.a.AddTagsTo(X,M.a.GetTags(se,!0)),X.setEnabled(se.isEnabled()),X.parent=se.parent,X.setPivotMatrix(se.getPivotMatrix()),X.id=G+"."+se.id,X.material=se.material,!q)for(var ee=se.getDescendants(!0),pe=0;pe<ee.length;pe++){var Te=ee[pe];Te.clone&&Te.clone(G+"."+Te.name,X)}if(se.morphTargetManager&&(X.morphTargetManager=se.morphTargetManager),$.getPhysicsEngine){var ve=$.getPhysicsEngine();if(H&&ve){var he=ve.getImpostorForPhysicsObject(se);he&&(X.physicsImpostor=he.clone(X))}}for(Q=0;Q<$.particleSystems.length;Q++){var be=$.particleSystems[Q];be.emitter===se&&be.clone(be.name,X)}X.refreshBoundingInfo(),X.computeWorldMatrix(!0)}return le!==null&&(X.parent=le),X._instanceDataStorage.hardwareInstancedRendering=X.getEngine().getCaps().instancedArrays,X}return Object(E.d)(B,te),B._GetDefaultSideOrientation=function(G){return G||B.FRONTSIDE},Object.defineProperty(B.prototype,"computeBonesUsingShaders",{get:function(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders},set:function(G){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==G&&(G&&this._internalMeshDataInfo._sourcePositions&&(this.setVerticesData(p.b.PositionKind,this._internalMeshDataInfo._sourcePositions.slice(),!0),this._internalMeshDataInfo._sourceNormals&&this.setVerticesData(p.b.NormalKind,this._internalMeshDataInfo._sourceNormals.slice(),!0)),this._internalAbstractMeshDataInfo._computeBonesUsingShaders=G,this._markSubMeshesAsAttributesDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"onBeforeRenderObservable",{get:function(){return this._internalMeshDataInfo._onBeforeRenderObservable||(this._internalMeshDataInfo._onBeforeRenderObservable=new m.c),this._internalMeshDataInfo._onBeforeRenderObservable},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"onBeforeBindObservable",{get:function(){return this._internalMeshDataInfo._onBeforeBindObservable||(this._internalMeshDataInfo._onBeforeBindObservable=new m.c),this._internalMeshDataInfo._onBeforeBindObservable},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"onAfterRenderObservable",{get:function(){return this._internalMeshDataInfo._onAfterRenderObservable||(this._internalMeshDataInfo._onAfterRenderObservable=new m.c),this._internalMeshDataInfo._onAfterRenderObservable},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"onBeforeDrawObservable",{get:function(){return this._internalMeshDataInfo._onBeforeDrawObservable||(this._internalMeshDataInfo._onBeforeDrawObservable=new m.c),this._internalMeshDataInfo._onBeforeDrawObservable},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"onBeforeDraw",{set:function(G){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(G)},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"hasInstances",{get:function(){return this.instances.length>0},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"hasThinInstances",{get:function(){var G;return((G=this._thinInstanceDataStorage.instancesCount)!==null&&G!==void 0?G:0)>0},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"morphTargetManager",{get:function(){return this._internalMeshDataInfo._morphTargetManager},set:function(G){this._internalMeshDataInfo._morphTargetManager!==G&&(this._internalMeshDataInfo._morphTargetManager=G,this._syncGeometryWithMorphTargetManager())},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"source",{get:function(){return this._internalMeshDataInfo._source},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"cloneMeshMap",{get:function(){return this._internalMeshDataInfo.meshMap},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"isUnIndexed",{get:function(){return this._unIndexed},set:function(G){this._unIndexed!==G&&(this._unIndexed=G,this._markSubMeshesAsAttributesDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"worldMatrixInstancedBuffer",{get:function(){return this._instanceDataStorage.instancesData},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"manualUpdateOfWorldMatrixInstancedBuffer",{get:function(){return this._instanceDataStorage.manualUpdate},set:function(G){this._instanceDataStorage.manualUpdate=G},enumerable:!1,configurable:!0}),B.prototype.instantiateHierarchy=function(G,$,le){G===void 0&&(G=null);var se=!(this.getTotalVertices()>0)||$&&$.doNotInstantiate?this.clone("Clone of "+(this.name||this.id),G||this.parent,!0):this.createInstance("instance of "+(this.name||this.id));se&&(se.parent=G||this.parent,se.position=this.position.clone(),se.scaling=this.scaling.clone(),this.rotationQuaternion?se.rotationQuaternion=this.rotationQuaternion.clone():se.rotation=this.rotation.clone(),le&&le(this,se));for(var q=0,H=this.getChildTransformNodes(!0);q<H.length;q++)H[q].instantiateHierarchy(se,$,le);return se},B.prototype.getClassName=function(){return"Mesh"},Object.defineProperty(B.prototype,"_isMesh",{get:function(){return!0},enumerable:!1,configurable:!0}),B.prototype.toString=function(G){var $=te.prototype.toString.call(this,G);if($+=", n vertices: "+this.getTotalVertices(),$+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(var le=0;le<this.animations.length;le++)$+=", animation[0]: "+this.animations[le].toString(G);if(G)if(this._geometry){var se=this.getIndices(),q=this.getVerticesData(p.b.PositionKind);q&&se&&($+=", flat shading: "+(q.length/3===se.length?"YES":"NO"))}else $+=", flat shading: UNKNOWN";return $},B.prototype._unBindEffect=function(){te.prototype._unBindEffect.call(this);for(var G=0,$=this.instances;G<$.length;G++)$[G]._unBindEffect()},Object.defineProperty(B.prototype,"hasLODLevels",{get:function(){return this._internalMeshDataInfo._LODLevels.length>0},enumerable:!1,configurable:!0}),B.prototype.getLODLevels=function(){return this._internalMeshDataInfo._LODLevels},B.prototype._sortLODLevels=function(){this._internalMeshDataInfo._LODLevels.sort(function(G,$){return G.distance<$.distance?1:G.distance>$.distance?-1:0})},B.prototype.addLODLevel=function(G,$){if($&&$._masterMesh)return U.a.Warn("You cannot use a mesh as LOD level twice"),this;var le=new W.a(G,$);return this._internalMeshDataInfo._LODLevels.push(le),$&&($._masterMesh=this),this._sortLODLevels(),this},B.prototype.getLODLevelAtDistance=function(G){for(var $=this._internalMeshDataInfo,le=0;le<$._LODLevels.length;le++){var se=$._LODLevels[le];if(se.distance===G)return se.mesh}return null},B.prototype.removeLODLevel=function(G){for(var $=this._internalMeshDataInfo,le=0;le<$._LODLevels.length;le++)$._LODLevels[le].mesh===G&&($._LODLevels.splice(le,1),G&&(G._masterMesh=null));return this._sortLODLevels(),this},B.prototype.getLOD=function(G,$){var le,se=this._internalMeshDataInfo;if(!se._LODLevels||se._LODLevels.length===0)return this;$?le=$:le=this.getBoundingInfo().boundingSphere;var q=le.centerWorld.subtract(G.globalPosition).length();if(se._LODLevels[se._LODLevels.length-1].distance>q)return this.onLODLevelSelection&&this.onLODLevelSelection(q,this,this),this;for(var H=0;H<se._LODLevels.length;H++){var X=se._LODLevels[H];if(X.distance<q){if(X.mesh){if(X.mesh.delayLoadState===N.a.DELAYLOADSTATE_NOTLOADED)return X.mesh._checkDelayState(),this;if(X.mesh.delayLoadState===N.a.DELAYLOADSTATE_LOADING)return this;X.mesh._preActivate(),X.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)}return this.onLODLevelSelection&&this.onLODLevelSelection(q,this,X.mesh),X.mesh}}return this.onLODLevelSelection&&this.onLODLevelSelection(q,this,this),this},Object.defineProperty(B.prototype,"geometry",{get:function(){return this._geometry},enumerable:!1,configurable:!0}),B.prototype.getTotalVertices=function(){return this._geometry===null||this._geometry===void 0?0:this._geometry.getTotalVertices()},B.prototype.getVerticesData=function(G,$,le){return this._geometry?this._geometry.getVerticesData(G,$,le):null},B.prototype.getVertexBuffer=function(G){return this._geometry?this._geometry.getVertexBuffer(G):null},B.prototype.isVerticesDataPresent=function(G){return this._geometry?this._geometry.isVerticesDataPresent(G):!!this._delayInfo&&this._delayInfo.indexOf(G)!==-1},B.prototype.isVertexBufferUpdatable=function(G){return this._geometry?this._geometry.isVertexBufferUpdatable(G):!!this._delayInfo&&this._delayInfo.indexOf(G)!==-1},B.prototype.getVerticesDataKinds=function(){if(!this._geometry){var G=new Array;return this._delayInfo&&this._delayInfo.forEach(function($){G.push($)}),G}return this._geometry.getVerticesDataKinds()},B.prototype.getTotalIndices=function(){return this._geometry?this._geometry.getTotalIndices():0},B.prototype.getIndices=function(G,$){return this._geometry?this._geometry.getIndices(G,$):[]},Object.defineProperty(B.prototype,"isBlocked",{get:function(){return this._masterMesh!==null&&this._masterMesh!==void 0},enumerable:!1,configurable:!0}),B.prototype.isReady=function(G,$){var le,se,q,H,X,J;if(G===void 0&&(G=!1),$===void 0&&($=!1),this.delayLoadState===N.a.DELAYLOADSTATE_LOADING||!te.prototype.isReady.call(this,G))return!1;if(!this.subMeshes||this.subMeshes.length===0||!G)return!0;var Q=this.getEngine(),ee=this.getScene(),pe=$||Q.getCaps().instancedArrays&&(this.instances.length>0||this.hasThinInstances);this.computeWorldMatrix();var Te=this.material||ee.defaultMaterial;if(Te){if(Te._storeEffectOnSubMeshes)for(var ve=0,he=this.subMeshes;ve<he.length;ve++){var be=(Qe=he[ve]).getMaterial();if(be){if(be._storeEffectOnSubMeshes){if(!be.isReadyForSubMesh(this,Qe,pe))return!1}else if(!be.isReady(this,pe))return!1}}else if(!Te.isReady(this,pe))return!1}for(var xe=0,Se=this.lightSources;xe<Se.length;xe++){var Ue=Se[xe].getShadowGenerator();if(Ue&&(!((le=Ue.getShadowMap())===null||le===void 0?void 0:le.renderList)||((se=Ue.getShadowMap())===null||se===void 0?void 0:se.renderList)&&((H=(q=Ue.getShadowMap())===null||q===void 0?void 0:q.renderList)===null||H===void 0?void 0:H.indexOf(this))!==-1))for(var We=0,Ze=this.subMeshes;We<Ze.length;We++){var Qe=Ze[We];if(!Ue.isReady(Qe,pe,(J=(X=Qe.getMaterial())===null||X===void 0?void 0:X.needAlphaBlendingForMesh(this))!==null&&J!==void 0&&J))return!1}}for(var Xe=0,nt=this._internalMeshDataInfo._LODLevels;Xe<nt.length;Xe++){var Ke=nt[Xe];if(Ke.mesh&&!Ke.mesh.isReady(pe))return!1}return!0},Object.defineProperty(B.prototype,"areNormalsFrozen",{get:function(){return this._internalMeshDataInfo._areNormalsFrozen},enumerable:!1,configurable:!0}),B.prototype.freezeNormals=function(){return this._internalMeshDataInfo._areNormalsFrozen=!0,this},B.prototype.unfreezeNormals=function(){return this._internalMeshDataInfo._areNormalsFrozen=!1,this},Object.defineProperty(B.prototype,"overridenInstanceCount",{set:function(G){this._instanceDataStorage.overridenInstanceCount=G},enumerable:!1,configurable:!0}),B.prototype._preActivate=function(){var G=this._internalMeshDataInfo,$=this.getScene().getRenderId();return G._preActivateId===$||(G._preActivateId=$,this._instanceDataStorage.visibleInstances=null),this},B.prototype._preActivateForIntermediateRendering=function(G){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=G),this},B.prototype._registerInstanceForRenderId=function(G,$){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={defaultRenderId:$,selfDefaultRenderId:this._renderId}),this._instanceDataStorage.visibleInstances[$]||(this._instanceDataStorage.previousRenderId!==void 0&&this._instanceDataStorage.isFrozen&&(this._instanceDataStorage.visibleInstances[this._instanceDataStorage.previousRenderId]=null),this._instanceDataStorage.previousRenderId=$,this._instanceDataStorage.visibleInstances[$]=new Array),this._instanceDataStorage.visibleInstances[$].push(G),this},B.prototype._afterComputeWorldMatrix=function(){te.prototype._afterComputeWorldMatrix.call(this),this.hasThinInstances&&(this.doNotSyncBoundingInfo||this.thinInstanceRefreshBoundingInfo(!1))},B.prototype._postActivate=function(){this.edgesShareWithInstances&&this.edgesRenderer&&this.edgesRenderer.isEnabled&&this._renderingGroup&&(this._renderingGroup._edgesRenderers.pushNoDuplicate(this.edgesRenderer),this.edgesRenderer.customInstances.push(this.getWorldMatrix()))},B.prototype.refreshBoundingInfo=function(G){if(G===void 0&&(G=!1),this._boundingInfo&&this._boundingInfo.isLocked)return this;var $=this.geometry?this.geometry.boundingBias:null;return this._refreshBoundingInfo(this._getPositionData(G),$),this},B.prototype._createGlobalSubMesh=function(G){var $=this.getTotalVertices();if(!$||!this.getIndices())return null;if(this.subMeshes&&this.subMeshes.length>0){var le=this.getIndices();if(!le)return null;var se=le.length,q=!1;if(G)q=!0;else for(var H=0,X=this.subMeshes;H<X.length;H++){var J=X[H];if(J.indexStart+J.indexCount>se){q=!0;break}if(J.verticesStart+J.verticesCount>$){q=!0;break}}if(!q)return this.subMeshes[0]}return this.releaseSubMeshes(),new T.a(0,0,$,0,this.getTotalIndices(),this)},B.prototype.subdivide=function(G){if(!(G<1)){for(var $=this.getTotalIndices(),le=$/G|0,se=0;le%3!=0;)le++;this.releaseSubMeshes();for(var q=0;q<G&&!(se>=$);q++)T.a.CreateFromIndices(0,se,q===G-1?$-se:le,this),se+=le;this.synchronizeInstances()}},B.prototype.setVerticesData=function(G,$,le,se){if(le===void 0&&(le=!1),this._geometry)this._geometry.setVerticesData(G,$,le,se);else{var q=new x.a;q.set($,G);var H=this.getScene();new P.a(P.a.RandomId(),H,q,le,this)}return this},B.prototype.removeVerticesData=function(G){this._geometry&&this._geometry.removeVerticesData(G)},B.prototype.markVerticesDataAsUpdatable=function(G,$){$===void 0&&($=!0);var le=this.getVertexBuffer(G);le&&le.isUpdatable()!==$&&this.setVerticesData(G,this.getVerticesData(G),$)},B.prototype.setVerticesBuffer=function(G){return this._geometry||(this._geometry=P.a.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(G),this},B.prototype.updateVerticesData=function(G,$,le,se){return this._geometry?(se?(this.makeGeometryUnique(),this.updateVerticesData(G,$,le,!1)):this._geometry.updateVerticesData(G,$,le),this):this},B.prototype.updateMeshPositions=function(G,$){$===void 0&&($=!0);var le=this.getVerticesData(p.b.PositionKind);if(!le)return this;if(G(le),this.updateVerticesData(p.b.PositionKind,le,!1,!1),$){var se=this.getIndices(),q=this.getVerticesData(p.b.NormalKind);if(!q)return this;x.a.ComputeNormals(le,se,q),this.updateVerticesData(p.b.NormalKind,q,!1,!1)}return this},B.prototype.makeGeometryUnique=function(){if(!this._geometry)return this;if(this._geometry.meshes.length===1)return this;var G=this._geometry,$=this._geometry.copy(P.a.RandomId());return G.releaseForMesh(this,!0),$.applyToMesh(this),this},B.prototype.setIndices=function(G,$,le){if($===void 0&&($=null),le===void 0&&(le=!1),this._geometry)this._geometry.setIndices(G,$,le);else{var se=new x.a;se.indices=G;var q=this.getScene();new P.a(P.a.RandomId(),q,se,le,this)}return this},B.prototype.updateIndices=function(G,$,le){return le===void 0&&(le=!1),this._geometry?(this._geometry.updateIndices(G,$,le),this):this},B.prototype.toLeftHanded=function(){return this._geometry?(this._geometry.toLeftHanded(),this):this},B.prototype._bind=function(G,$,le){if(!this._geometry)return this;var se,q=this.getScene().getEngine();if(this._unIndexed)se=null;else switch(le){case g.a.PointFillMode:se=null;break;case g.a.WireFrameFillMode:se=G._getLinesIndexBuffer(this.getIndices(),q);break;default:case g.a.TriangleFillMode:se=this._geometry.getIndexBuffer()}return this._geometry._bind($,se),this},B.prototype._draw=function(G,$,le){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeDrawObservable&&this._internalMeshDataInfo._onBeforeDrawObservable.notifyObservers(this);var se=this.getScene().getEngine();return this._unIndexed||$==g.a.PointFillMode?se.drawArraysType($,G.verticesStart,G.verticesCount,le):$==g.a.WireFrameFillMode?se.drawElementsType($,0,G._linesIndexCount,le):se.drawElementsType($,G.indexStart,G.indexCount,le),this},B.prototype.registerBeforeRender=function(G){return this.onBeforeRenderObservable.add(G),this},B.prototype.unregisterBeforeRender=function(G){return this.onBeforeRenderObservable.removeCallback(G),this},B.prototype.registerAfterRender=function(G){return this.onAfterRenderObservable.add(G),this},B.prototype.unregisterAfterRender=function(G){return this.onAfterRenderObservable.removeCallback(G),this},B.prototype._getInstancesRenderList=function(G,$){if($===void 0&&($=!1),this._instanceDataStorage.isFrozen&&this._instanceDataStorage.previousBatch)return this._instanceDataStorage.previousBatch;var le=this.getScene(),se=le._isInIntermediateRendering(),q=se?this._internalAbstractMeshDataInfo._onlyForInstancesIntermediate:this._internalAbstractMeshDataInfo._onlyForInstances,H=this._instanceDataStorage.batchCache;if(H.mustReturn=!1,H.renderSelf[G]=$||!q&&this.isEnabled()&&this.isVisible,H.visibleInstances[G]=null,this._instanceDataStorage.visibleInstances&&!$){var X=this._instanceDataStorage.visibleInstances,J=le.getRenderId(),Q=se?X.intermediateDefaultRenderId:X.defaultRenderId;H.visibleInstances[G]=X[J],!H.visibleInstances[G]&&Q&&(H.visibleInstances[G]=X[Q])}return H.hardwareInstancedRendering[G]=!$&&this._instanceDataStorage.hardwareInstancedRendering&&H.visibleInstances[G]!==null&&H.visibleInstances[G]!==void 0,this._instanceDataStorage.previousBatch=H,H},B.prototype._renderWithInstances=function(G,$,le,se,q){var H=le.visibleInstances[G._id];if(!H)return this;for(var X=this._instanceDataStorage,J=X.instancesBufferSize,Q=X.instancesBuffer,ee=16*(H.length+1)*4;X.instancesBufferSize<ee;)X.instancesBufferSize*=2;X.instancesData&&J==X.instancesBufferSize||(X.instancesData=new Float32Array(X.instancesBufferSize/4));var pe=0,Te=0,ve=le.renderSelf[G._id],he=!Q||J!==X.instancesBufferSize;if(this._instanceDataStorage.manualUpdate||X.isFrozen&&!he)Te=(ve?1:0)+H.length;else{var be=this._effectiveMesh.getWorldMatrix();if(ve&&(be.copyToArray(X.instancesData,pe),pe+=16,Te++),H)for(var xe=0;xe<H.length;xe++)H[xe].getWorldMatrix().copyToArray(X.instancesData,pe),pe+=16,Te++}return he?(Q&&Q.dispose(),Q=new p.a(q,X.instancesData,!0,16,!1,!0),X.instancesBuffer=Q,this.setVerticesBuffer(Q.createVertexBuffer("world0",0,4)),this.setVerticesBuffer(Q.createVertexBuffer("world1",4,4)),this.setVerticesBuffer(Q.createVertexBuffer("world2",8,4)),this.setVerticesBuffer(Q.createVertexBuffer("world3",12,4))):this._instanceDataStorage.isFrozen||Q.updateDirectly(X.instancesData,0,Te),this._processInstancedBuffers(H,ve),this.getScene()._activeIndices.addCount(G.indexCount*Te,!1),this._bind(G,se,$),this._draw(G,$,Te),q.unbindInstanceAttributes(),this},B.prototype._renderWithThinInstances=function(G,$,le,se){var q,H,X=(H=(q=this._thinInstanceDataStorage)===null||q===void 0?void 0:q.instancesCount)!==null&&H!==void 0?H:0;this.getScene()._activeIndices.addCount(G.indexCount*X,!1),this._bind(G,le,$),this._draw(G,$,X),se.unbindInstanceAttributes()},B.prototype._processInstancedBuffers=function(G,$){},B.prototype._processRendering=function(G,$,le,se,q,H,X,J){var Q=this.getScene(),ee=Q.getEngine();if(H&&$.getRenderingMesh().hasThinInstances)return this._renderWithThinInstances($,se,le,ee),this;if(H)this._renderWithInstances($,se,q,le,ee);else{var pe=0;q.renderSelf[$._id]&&(X&&X(!1,G._effectiveMesh.getWorldMatrix(),J),pe++,this._draw($,se,this._instanceDataStorage.overridenInstanceCount));var Te=q.visibleInstances[$._id];if(Te){var ve=Te.length;pe+=ve;for(var he=0;he<ve;he++){var be=Te[he].getWorldMatrix();X&&X(!0,be,J),this._draw($,se)}}Q._activeIndices.addCount($.indexCount*pe,!1)}return this},B.prototype._rebuild=function(){this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null),te.prototype._rebuild.call(this)},B.prototype._freeze=function(){if(this.subMeshes){for(var G=0;G<this.subMeshes.length;G++)this._getInstancesRenderList(G);this._effectiveMaterial=null,this._instanceDataStorage.isFrozen=!0}},B.prototype._unFreeze=function(){this._instanceDataStorage.isFrozen=!1,this._instanceDataStorage.previousBatch=null},B.prototype.render=function(G,$,le){var se=this.getScene();if(this._internalAbstractMeshDataInfo._isActiveIntermediate?this._internalAbstractMeshDataInfo._isActiveIntermediate=!1:this._internalAbstractMeshDataInfo._isActive=!1,this._checkOcclusionQuery())return this;var q=this._getInstancesRenderList(G._id,!!le);if(q.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeRenderObservable&&this._internalMeshDataInfo._onBeforeRenderObservable.notifyObservers(this);var H,X=se.getEngine(),J=q.hardwareInstancedRendering[G._id]||G.getRenderingMesh().hasThinInstances,Q=this._instanceDataStorage,ee=G.getMaterial();if(!ee)return this;if(!Q.isFrozen||!this._effectiveMaterial||this._effectiveMaterial!==ee){if(ee._storeEffectOnSubMeshes){if(!ee.isReadyForSubMesh(this,G,J))return this}else if(!ee.isReady(this,J))return this;this._effectiveMaterial=ee}$&&X.setAlphaMode(this._effectiveMaterial.alphaMode),H=this._effectiveMaterial._storeEffectOnSubMeshes?G.effect:this._effectiveMaterial.getEffect();for(var pe=0,Te=se._beforeRenderingMeshStage;pe<Te.length;pe++)Te[pe].action(this,G,q,H);if(!H)return this;var ve,he=le||this._effectiveMesh;if(Q.isFrozen||!this._effectiveMaterial.backFaceCulling&&this.overrideMaterialSideOrientation===null)ve=Q.sideOrientation;else{var be=he._getWorldMatrixDeterminant();(ve=this.overrideMaterialSideOrientation)==null&&(ve=this._effectiveMaterial.sideOrientation),be<0&&(ve=ve===g.a.ClockWiseSideOrientation?g.a.CounterClockWiseSideOrientation:g.a.ClockWiseSideOrientation),Q.sideOrientation=ve}var xe=this._effectiveMaterial._preBind(H,ve);this._effectiveMaterial.forceDepthWrite&&X.setDepthWrite(!0);var Se=se.forcePointsCloud?g.a.PointFillMode:se.forceWireframe?g.a.WireFrameFillMode:this._effectiveMaterial.fillMode;this._internalMeshDataInfo._onBeforeBindObservable&&this._internalMeshDataInfo._onBeforeBindObservable.notifyObservers(this),J||this._bind(G,H,Se);var Ue=he.getWorldMatrix();this._effectiveMaterial._storeEffectOnSubMeshes?this._effectiveMaterial.bindForSubMesh(Ue,this,G):this._effectiveMaterial.bind(Ue,this),!this._effectiveMaterial.backFaceCulling&&this._effectiveMaterial.separateCullingPass&&(X.setState(!0,this._effectiveMaterial.zOffset,!1,!xe),this._processRendering(this,G,H,Se,q,J,this._onBeforeDraw,this._effectiveMaterial),X.setState(!0,this._effectiveMaterial.zOffset,!1,xe)),this._processRendering(this,G,H,Se,q,J,this._onBeforeDraw,this._effectiveMaterial),this._effectiveMaterial.unbind();for(var We=0,Ze=se._afterRenderingMeshStage;We<Ze.length;We++)Ze[We].action(this,G,q,H);return this._internalMeshDataInfo._onAfterRenderObservable&&this._internalMeshDataInfo._onAfterRenderObservable.notifyObservers(this),this},B.prototype._onBeforeDraw=function(G,$,le){G&&le&&le.bindOnlyWorldMatrix($)},B.prototype.cleanMatrixWeights=function(){this.isVerticesDataPresent(p.b.MatricesWeightsKind)&&(this.isVerticesDataPresent(p.b.MatricesWeightsExtraKind)?this.normalizeSkinWeightsAndExtra():this.normalizeSkinFourWeights())},B.prototype.normalizeSkinFourWeights=function(){for(var G=this.getVerticesData(p.b.MatricesWeightsKind),$=G.length,le=0;le<$;le+=4){var se=G[le]+G[le+1]+G[le+2]+G[le+3];if(se===0)G[le]=1;else{var q=1/se;G[le]*=q,G[le+1]*=q,G[le+2]*=q,G[le+3]*=q}}this.setVerticesData(p.b.MatricesWeightsKind,G)},B.prototype.normalizeSkinWeightsAndExtra=function(){for(var G=this.getVerticesData(p.b.MatricesWeightsExtraKind),$=this.getVerticesData(p.b.MatricesWeightsKind),le=$.length,se=0;se<le;se+=4){var q=$[se]+$[se+1]+$[se+2]+$[se+3];if((q+=G[se]+G[se+1]+G[se+2]+G[se+3])===0)$[se]=1;else{var H=1/q;$[se]*=H,$[se+1]*=H,$[se+2]*=H,$[se+3]*=H,G[se]*=H,G[se+1]*=H,G[se+2]*=H,G[se+3]*=H}}this.setVerticesData(p.b.MatricesWeightsKind,$),this.setVerticesData(p.b.MatricesWeightsKind,G)},B.prototype.validateSkinning=function(){var G=this.getVerticesData(p.b.MatricesWeightsExtraKind),$=this.getVerticesData(p.b.MatricesWeightsKind);if($===null||this.skeleton==null)return{skinned:!1,valid:!0,report:"not skinned"};for(var le=$.length,se=0,q=0,H=0,X=0,J=G===null?4:8,Q=new Array,ee=0;ee<=J;ee++)Q[ee]=0;for(ee=0;ee<le;ee+=4){for(var pe=$[ee],Te=pe,ve=Te===0?0:1,he=1;he<J;he++){var be=he<4?$[ee+he]:G[ee+he-4];be>pe&&se++,be!==0&&ve++,Te+=be,pe=be}if(Q[ve]++,ve>H&&(H=ve),Te===0)q++;else{var xe=1/Te,Se=0;for(he=0;he<J;he++)Se+=he<4?Math.abs($[ee+he]-$[ee+he]*xe):Math.abs(G[ee+he-4]-G[ee+he-4]*xe);Se>.001&&X++}}var Ue=this.skeleton.bones.length,We=this.getVerticesData(p.b.MatricesIndicesKind),Ze=this.getVerticesData(p.b.MatricesIndicesExtraKind),Qe=0;for(ee=0;ee<le;ee+=4)for(he=0;he<J;he++){var Xe=he<4?We[ee+he]:Ze[ee+he-4];(Xe>=Ue||Xe<0)&&Qe++}return{skinned:!0,valid:q===0&&X===0&&Qe===0,report:"Number of Weights = "+le/4+`
Maximum influences = `+H+`
Missing Weights = `+q+`
Not Sorted = `+se+`
Not Normalized = `+X+`
WeightCounts = [`+Q+`]
Number of bones = `+Ue+`
Bad Bone Indices = `+Qe}},B.prototype._checkDelayState=function(){var G=this.getScene();return this._geometry?this._geometry.load(G):this.delayLoadState===N.a.DELAYLOADSTATE_NOTLOADED&&(this.delayLoadState=N.a.DELAYLOADSTATE_LOADING,this._queueLoad(G)),this},B.prototype._queueLoad=function(G){var $=this;G._addPendingData(this);var le=this.delayLoadingFile.indexOf(".babylonbinarymeshdata")!==-1;return S.b.LoadFile(this.delayLoadingFile,function(se){se instanceof ArrayBuffer?$._delayLoadingFunction(se,$):$._delayLoadingFunction(JSON.parse(se),$),$.instances.forEach(function(q){q.refreshBoundingInfo(),q._syncSubMeshes()}),$.delayLoadState=N.a.DELAYLOADSTATE_LOADED,G._removePendingData($)},function(){},G.offlineProvider,le),this},B.prototype.isInFrustum=function(G){return this.delayLoadState!==N.a.DELAYLOADSTATE_LOADING&&!!te.prototype.isInFrustum.call(this,G)&&(this._checkDelayState(),!0)},B.prototype.setMaterialByID=function(G){var $,le=this.getScene().materials;for($=le.length-1;$>-1;$--)if(le[$].id===G)return this.material=le[$],this;var se=this.getScene().multiMaterials;for($=se.length-1;$>-1;$--)if(se[$].id===G)return this.material=se[$],this;return this},B.prototype.getAnimatables=function(){var G=new Array;return this.material&&G.push(this.material),this.skeleton&&G.push(this.skeleton),G},B.prototype.bakeTransformIntoVertices=function(G){if(!this.isVerticesDataPresent(p.b.PositionKind))return this;var $=this.subMeshes.splice(0);this._resetPointsArrayCache();var le,se=this.getVerticesData(p.b.PositionKind),q=new Array;for(le=0;le<se.length;le+=3)C.e.TransformCoordinates(C.e.FromArray(se,le),G).toArray(q,le);if(this.setVerticesData(p.b.PositionKind,q,this.getVertexBuffer(p.b.PositionKind).isUpdatable()),this.isVerticesDataPresent(p.b.NormalKind)){for(se=this.getVerticesData(p.b.NormalKind),q=[],le=0;le<se.length;le+=3)C.e.TransformNormal(C.e.FromArray(se,le),G).normalize().toArray(q,le);this.setVerticesData(p.b.NormalKind,q,this.getVertexBuffer(p.b.NormalKind).isUpdatable())}return G.m[0]*G.m[5]*G.m[10]<0&&this.flipFaces(),this.releaseSubMeshes(),this.subMeshes=$,this},B.prototype.bakeCurrentTransformIntoVertices=function(G){return G===void 0&&(G=!0),this.bakeTransformIntoVertices(this.computeWorldMatrix(!0)),this.resetLocalMatrix(G),this},Object.defineProperty(B.prototype,"_positions",{get:function(){return this._geometry?this._geometry._positions:null},enumerable:!1,configurable:!0}),B.prototype._resetPointsArrayCache=function(){return this._geometry&&this._geometry._resetPointsArrayCache(),this},B.prototype._generatePointsArray=function(){return!!this._geometry&&this._geometry._generatePointsArray()},B.prototype.clone=function(G,$,le,se){return G===void 0&&(G=""),$===void 0&&($=null),se===void 0&&(se=!0),new B(G,this.getScene(),$,this,le,se)},B.prototype.dispose=function(G,$){$===void 0&&($=!1),this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0);var le=this._internalMeshDataInfo;if(le._onBeforeDrawObservable&&le._onBeforeDrawObservable.clear(),le._onBeforeBindObservable&&le._onBeforeBindObservable.clear(),le._onBeforeRenderObservable&&le._onBeforeRenderObservable.clear(),le._onAfterRenderObservable&&le._onAfterRenderObservable.clear(),this._scene.useClonedMeshMap){if(le.meshMap)for(var se in le.meshMap)(X=le.meshMap[se])&&(X._internalMeshDataInfo._source=null,le.meshMap[se]=void 0);le._source&&le._source._internalMeshDataInfo.meshMap&&(le._source._internalMeshDataInfo.meshMap[this.uniqueId]=void 0)}else for(var q=0,H=this.getScene().meshes;q<H.length;q++){var X;(X=H[q])._internalMeshDataInfo&&X._internalMeshDataInfo._source&&X._internalMeshDataInfo._source===this&&(X._internalMeshDataInfo._source=null)}le._source=null,this._disposeInstanceSpecificData(),this._disposeThinInstanceSpecificData(),te.prototype.dispose.call(this,G,$)},B.prototype._disposeInstanceSpecificData=function(){},B.prototype._disposeThinInstanceSpecificData=function(){},B.prototype.applyDisplacementMap=function(G,$,le,se,q,H,X){var J=this;X===void 0&&(X=!1);var Q=this.getScene();return S.b.LoadImage(G,function(ee){var pe=ee.width,Te=ee.height,ve=re.a.CreateCanvas(pe,Te).getContext("2d");ve.drawImage(ee,0,0);var he=ve.getImageData(0,0,pe,Te).data;J.applyDisplacementMapFromBuffer(he,pe,Te,$,le,q,H,X),se&&se(J)},function(){},Q.offlineProvider),this},B.prototype.applyDisplacementMapFromBuffer=function(G,$,le,se,q,H,X,J){if(J===void 0&&(J=!1),!this.isVerticesDataPresent(p.b.PositionKind)||!this.isVerticesDataPresent(p.b.NormalKind)||!this.isVerticesDataPresent(p.b.UVKind))return U.a.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;var Q=this.getVerticesData(p.b.PositionKind,!0,!0),ee=this.getVerticesData(p.b.NormalKind),pe=this.getVerticesData(p.b.UVKind),Te=C.e.Zero(),ve=C.e.Zero(),he=C.d.Zero();H=H||C.d.Zero(),X=X||new C.d(1,1);for(var be=0;be<Q.length;be+=3){C.e.FromArrayToRef(Q,be,Te),C.e.FromArrayToRef(ee,be,ve),C.d.FromArrayToRef(pe,be/3*2,he);var xe=4*((Math.abs(he.x*X.x+H.x%1)*($-1)%$|0)+(Math.abs(he.y*X.y+H.y%1)*(le-1)%le|0)*$),Se=.3*(G[xe]/255)+.59*(G[xe+1]/255)+.11*(G[xe+2]/255);ve.normalize(),ve.scaleInPlace(se+(q-se)*Se),(Te=Te.add(ve)).toArray(Q,be)}return x.a.ComputeNormals(Q,this.getIndices(),ee),J?(this.setVerticesData(p.b.PositionKind,Q),this.setVerticesData(p.b.NormalKind,ee)):(this.updateVerticesData(p.b.PositionKind,Q),this.updateVerticesData(p.b.NormalKind,ee)),this},B.prototype.convertToFlatShadedMesh=function(){var G,$,le=this.getVerticesDataKinds(),se={},q={},H={},X=!1;for(G=0;G<le.length;G++){$=le[G];var J=this.getVertexBuffer($);$!==p.b.NormalKind?(se[$]=J,q[$]=se[$].getData(),H[$]=[]):(X=J.isUpdatable(),le.splice(G,1),G--)}var Q,ee=this.subMeshes.slice(0),pe=this.getIndices(),Te=this.getTotalIndices();for(Q=0;Q<Te;Q++){var ve=pe[Q];for(G=0;G<le.length;G++)for(var he=se[$=le[G]].getStrideSize(),be=0;be<he;be++)H[$].push(q[$][ve*he+be])}var xe=[],Se=H[p.b.PositionKind];for(Q=0;Q<Te;Q+=3){pe[Q]=Q,pe[Q+1]=Q+1,pe[Q+2]=Q+2;for(var Ue=C.e.FromArray(Se,3*Q),We=C.e.FromArray(Se,3*(Q+1)),Ze=C.e.FromArray(Se,3*(Q+2)),Qe=Ue.subtract(We),Xe=Ze.subtract(We),nt=C.e.Normalize(C.e.Cross(Qe,Xe)),Ke=0;Ke<3;Ke++)xe.push(nt.x),xe.push(nt.y),xe.push(nt.z)}for(this.setIndices(pe),this.setVerticesData(p.b.NormalKind,xe,X),G=0;G<le.length;G++)$=le[G],this.setVerticesData($,H[$],se[$].isUpdatable());this.releaseSubMeshes();for(var ct=0;ct<ee.length;ct++){var ot=ee[ct];T.a.AddToMesh(ot.materialIndex,ot.indexStart,ot.indexCount,ot.indexStart,ot.indexCount,this)}return this.synchronizeInstances(),this},B.prototype.convertToUnIndexedMesh=function(){var G,$,le=this.getVerticesDataKinds(),se={},q={},H={};for(G=0;G<le.length;G++){$=le[G];var X=this.getVertexBuffer($);se[$]=X,q[$]=se[$].getData(),H[$]=[]}var J,Q=this.subMeshes.slice(0),ee=this.getIndices(),pe=this.getTotalIndices();for(J=0;J<pe;J++){var Te=ee[J];for(G=0;G<le.length;G++)for(var ve=se[$=le[G]].getStrideSize(),he=0;he<ve;he++)H[$].push(q[$][Te*ve+he])}for(J=0;J<pe;J+=3)ee[J]=J,ee[J+1]=J+1,ee[J+2]=J+2;for(this.setIndices(ee),G=0;G<le.length;G++)$=le[G],this.setVerticesData($,H[$],se[$].isUpdatable());this.releaseSubMeshes();for(var be=0;be<Q.length;be++){var xe=Q[be];T.a.AddToMesh(xe.materialIndex,xe.indexStart,xe.indexCount,xe.indexStart,xe.indexCount,this)}return this._unIndexed=!0,this.synchronizeInstances(),this},B.prototype.flipFaces=function(G){G===void 0&&(G=!1);var $,le,se=x.a.ExtractFromMesh(this);if(G&&this.isVerticesDataPresent(p.b.NormalKind)&&se.normals)for($=0;$<se.normals.length;$++)se.normals[$]*=-1;if(se.indices)for($=0;$<se.indices.length;$+=3)le=se.indices[$+1],se.indices[$+1]=se.indices[$+2],se.indices[$+2]=le;return se.applyToMesh(this,this.isVertexBufferUpdatable(p.b.PositionKind)),this},B.prototype.increaseVertices=function(G){var $=x.a.ExtractFromMesh(this),le=$.uvs,se=$.indices,q=$.positions,H=$.normals;if(se&&q&&H&&le){for(var X,J,Q=G+1,ee=new Array,pe=0;pe<Q+1;pe++)ee[pe]=new Array;var Te,ve=new C.e(0,0,0),he=new C.e(0,0,0),be=new C.d(0,0),xe=new Array,Se=new Array,Ue=new Array,We=q.length,Ze=le.length;for(pe=0;pe<se.length;pe+=3){Se[0]=se[pe],Se[1]=se[pe+1],Se[2]=se[pe+2];for(var Qe=0;Qe<3;Qe++)if(X=Se[Qe],J=Se[(Qe+1)%3],Ue[X]===void 0&&Ue[J]===void 0?(Ue[X]=new Array,Ue[J]=new Array):(Ue[X]===void 0&&(Ue[X]=new Array),Ue[J]===void 0&&(Ue[J]=new Array)),Ue[X][J]===void 0&&Ue[J][X]===void 0){Ue[X][J]=[],ve.x=(q[3*J]-q[3*X])/Q,ve.y=(q[3*J+1]-q[3*X+1])/Q,ve.z=(q[3*J+2]-q[3*X+2])/Q,he.x=(H[3*J]-H[3*X])/Q,he.y=(H[3*J+1]-H[3*X+1])/Q,he.z=(H[3*J+2]-H[3*X+2])/Q,be.x=(le[2*J]-le[2*X])/Q,be.y=(le[2*J+1]-le[2*X+1])/Q,Ue[X][J].push(X);for(var Xe=1;Xe<Q;Xe++)Ue[X][J].push(q.length/3),q[We]=q[3*X]+Xe*ve.x,H[We++]=H[3*X]+Xe*he.x,q[We]=q[3*X+1]+Xe*ve.y,H[We++]=H[3*X+1]+Xe*he.y,q[We]=q[3*X+2]+Xe*ve.z,H[We++]=H[3*X+2]+Xe*he.z,le[Ze++]=le[2*X]+Xe*be.x,le[Ze++]=le[2*X+1]+Xe*be.y;Ue[X][J].push(J),Ue[J][X]=new Array,Te=Ue[X][J].length;for(var nt=0;nt<Te;nt++)Ue[J][X][nt]=Ue[X][J][Te-1-nt]}for(ee[0][0]=se[pe],ee[1][0]=Ue[se[pe]][se[pe+1]][1],ee[1][1]=Ue[se[pe]][se[pe+2]][1],Xe=2;Xe<Q;Xe++)for(ee[Xe][0]=Ue[se[pe]][se[pe+1]][Xe],ee[Xe][Xe]=Ue[se[pe]][se[pe+2]][Xe],ve.x=(q[3*ee[Xe][Xe]]-q[3*ee[Xe][0]])/Xe,ve.y=(q[3*ee[Xe][Xe]+1]-q[3*ee[Xe][0]+1])/Xe,ve.z=(q[3*ee[Xe][Xe]+2]-q[3*ee[Xe][0]+2])/Xe,he.x=(H[3*ee[Xe][Xe]]-H[3*ee[Xe][0]])/Xe,he.y=(H[3*ee[Xe][Xe]+1]-H[3*ee[Xe][0]+1])/Xe,he.z=(H[3*ee[Xe][Xe]+2]-H[3*ee[Xe][0]+2])/Xe,be.x=(le[2*ee[Xe][Xe]]-le[2*ee[Xe][0]])/Xe,be.y=(le[2*ee[Xe][Xe]+1]-le[2*ee[Xe][0]+1])/Xe,Qe=1;Qe<Xe;Qe++)ee[Xe][Qe]=q.length/3,q[We]=q[3*ee[Xe][0]]+Qe*ve.x,H[We++]=H[3*ee[Xe][0]]+Qe*he.x,q[We]=q[3*ee[Xe][0]+1]+Qe*ve.y,H[We++]=H[3*ee[Xe][0]+1]+Qe*he.y,q[We]=q[3*ee[Xe][0]+2]+Qe*ve.z,H[We++]=H[3*ee[Xe][0]+2]+Qe*he.z,le[Ze++]=le[2*ee[Xe][0]]+Qe*be.x,le[Ze++]=le[2*ee[Xe][0]+1]+Qe*be.y;for(ee[Q]=Ue[se[pe+1]][se[pe+2]],xe.push(ee[0][0],ee[1][0],ee[1][1]),Xe=1;Xe<Q;Xe++){for(Qe=0;Qe<Xe;Qe++)xe.push(ee[Xe][Qe],ee[Xe+1][Qe],ee[Xe+1][Qe+1]),xe.push(ee[Xe][Qe],ee[Xe+1][Qe+1],ee[Xe][Qe+1]);xe.push(ee[Xe][Qe],ee[Xe+1][Qe],ee[Xe+1][Qe+1])}}$.indices=xe,$.applyToMesh(this,this.isVertexBufferUpdatable(p.b.PositionKind))}else U.a.Warn("VertexData contains null entries")},B.prototype.forceSharedVertices=function(){var G=x.a.ExtractFromMesh(this),$=G.uvs,le=G.indices,se=G.positions,q=G.colors;if(le===void 0||se===void 0||le===null||se===null)U.a.Warn("VertexData contains empty entries");else{for(var H,X,J=new Array,Q=new Array,ee=new Array,pe=new Array,Te=new Array,ve=0,he={},be=0;be<le.length;be+=3){X=[le[be],le[be+1],le[be+2]],Te=new Array;for(var xe=0;xe<3;xe++){Te[xe]="";for(var Se=0;Se<3;Se++)Math.abs(se[3*X[xe]+Se])<1e-8&&(se[3*X[xe]+Se]=0),Te[xe]+=se[3*X[xe]+Se]+"|"}if(Te[0]!=Te[1]&&Te[0]!=Te[2]&&Te[1]!=Te[2])for(xe=0;xe<3;xe++){if((H=he[Te[xe]])===void 0){for(he[Te[xe]]=ve,H=ve++,Se=0;Se<3;Se++)J.push(se[3*X[xe]+Se]);if(q!=null)for(Se=0;Se<4;Se++)pe.push(q[4*X[xe]+Se]);if($!=null)for(Se=0;Se<2;Se++)ee.push($[2*X[xe]+Se])}Q.push(H)}}var Ue=new Array;x.a.ComputeNormals(J,Q,Ue),G.positions=J,G.indices=Q,G.normals=Ue,$!=null&&(G.uvs=ee),q!=null&&(G.colors=pe),G.applyToMesh(this,this.isVertexBufferUpdatable(p.b.PositionKind))}},B._instancedMeshFactory=function(G,$){throw j.a.WarnImport("InstancedMesh")},B._PhysicsImpostorParser=function(G,$,le){throw j.a.WarnImport("PhysicsImpostor")},B.prototype.createInstance=function(G){var $=this.geometry;if($&&$.meshes.length>1)for(var le=0,se=$.meshes.slice(0);le<se.length;le++){var q=se[le];q!==this&&q.makeGeometryUnique()}return B._instancedMeshFactory(G,this)},B.prototype.synchronizeInstances=function(){this._geometry&&this._geometry.meshes.length!==1&&this.instances.length&&this.makeGeometryUnique();for(var G=0;G<this.instances.length;G++)this.instances[G]._syncSubMeshes();return this},B.prototype.optimizeIndices=function(G){var $=this,le=this.getIndices(),se=this.getVerticesData(p.b.PositionKind);if(!se||!le)return this;for(var q=new Array,H=0;H<se.length;H+=3)q.push(C.e.FromArray(se,H));var X=new Array;return S.a.SyncAsyncForLoop(q.length,40,function(J){for(var Q=q.length-1-J,ee=q[Q],pe=0;pe<Q;++pe){var Te=q[pe];if(ee.equals(Te)){X[Q]=pe;break}}},function(){for(var J=0;J<le.length;++J)le[J]=X[le[J]]||le[J];var Q=$.subMeshes.slice(0);$.setIndices(le),$.subMeshes=Q,G&&G($)}),this},B.prototype.serialize=function(G){G.name=this.name,G.id=this.id,G.uniqueId=this.uniqueId,G.type=this.getClassName(),M.a&&M.a.HasTags(this)&&(G.tags=M.a.GetTags(this)),G.position=this.position.asArray(),this.rotationQuaternion?G.rotationQuaternion=this.rotationQuaternion.asArray():this.rotation&&(G.rotation=this.rotation.asArray()),G.scaling=this.scaling.asArray(),this._postMultiplyPivotMatrix?G.pivotMatrix=this.getPivotMatrix().asArray():G.localMatrix=this.getPivotMatrix().asArray(),G.isEnabled=this.isEnabled(!1),G.isVisible=this.isVisible,G.infiniteDistance=this.infiniteDistance,G.pickable=this.isPickable,G.receiveShadows=this.receiveShadows,G.billboardMode=this.billboardMode,G.visibility=this.visibility,G.checkCollisions=this.checkCollisions,G.isBlocker=this.isBlocker,G.overrideMaterialSideOrientation=this.overrideMaterialSideOrientation,this.parent&&(G.parentId=this.parent.id),G.isUnIndexed=this.isUnIndexed;var $=this._geometry;if($){var le=$.id;G.geometryId=le,G.subMeshes=[];for(var se=0;se<this.subMeshes.length;se++){var q=this.subMeshes[se];G.subMeshes.push({materialIndex:q.materialIndex,verticesStart:q.verticesStart,verticesCount:q.verticesCount,indexStart:q.indexStart,indexCount:q.indexCount})}}this.material?this.material.doNotSerialize||(G.materialId=this.material.id):this.material=null,this.morphTargetManager&&(G.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(G.skeletonId=this.skeleton.id,G.numBoneInfluencers=this.numBoneInfluencers),this.getScene()._getComponent(Y.a.NAME_PHYSICSENGINE)&&(J=this.getPhysicsImpostor())&&(G.physicsMass=J.getParam("mass"),G.physicsFriction=J.getParam("friction"),G.physicsRestitution=J.getParam("mass"),G.physicsImpostor=J.type),this.metadata&&(G.metadata=this.metadata),G.instances=[];for(var H=0;H<this.instances.length;H++){var X=this.instances[H];if(!X.doNotSerialize){var J,Q={name:X.name,id:X.id,isEnabled:X.isEnabled(!1),isVisible:X.isVisible,isPickable:X.isPickable,checkCollisions:X.checkCollisions,position:X.position.asArray(),scaling:X.scaling.asArray()};X.parent&&(Q.parentId=X.parent.id),X.rotationQuaternion?Q.rotationQuaternion=X.rotationQuaternion.asArray():X.rotation&&(Q.rotation=X.rotation.asArray()),this.getScene()._getComponent(Y.a.NAME_PHYSICSENGINE)&&(J=X.getPhysicsImpostor())&&(Q.physicsMass=J.getParam("mass"),Q.physicsFriction=J.getParam("friction"),Q.physicsRestitution=J.getParam("mass"),Q.physicsImpostor=J.type),X.metadata&&(Q.metadata=X.metadata),G.instances.push(Q),V.a.AppendSerializedAnimations(X,Q),Q.ranges=X.serializeAnimationRanges()}}if(this._thinInstanceDataStorage.instancesCount&&this._thinInstanceDataStorage.matrixData&&(G.thinInstances={instancesCount:this._thinInstanceDataStorage.instancesCount,matrixData:S.b.SliceToArray(this._thinInstanceDataStorage.matrixData),matrixBufferSize:this._thinInstanceDataStorage.matrixBufferSize},this._userThinInstanceBuffersStorage)){var ee={data:{},sizes:{},strides:{}};for(var pe in this._userThinInstanceBuffersStorage.data)ee.data[pe]=S.b.SliceToArray(this._userThinInstanceBuffersStorage.data[pe]),ee.sizes[pe]=this._userThinInstanceBuffersStorage.sizes[pe],ee.strides[pe]=this._userThinInstanceBuffersStorage.strides[pe];G.thinInstances.userThinInstance=ee}V.a.AppendSerializedAnimations(this,G),G.ranges=this.serializeAnimationRanges(),G.layerMask=this.layerMask,G.alphaIndex=this.alphaIndex,G.hasVertexAlpha=this.hasVertexAlpha,G.overlayAlpha=this.overlayAlpha,G.overlayColor=this.overlayColor.asArray(),G.renderOverlay=this.renderOverlay,G.applyFog=this.applyFog,this.actionManager&&(G.actions=this.actionManager.serialize(this.name))},B.prototype._syncGeometryWithMorphTargetManager=function(){if(this.geometry){this._markSubMeshesAsAttributesDirty();var G=this._internalMeshDataInfo._morphTargetManager;if(G&&G.vertexCount){if(G.vertexCount!==this.getTotalVertices())return U.a.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),void(this.morphTargetManager=null);for(var $=0;$<G.numInfluencers;$++){var le=G.getActiveTarget($),se=le.getPositions();if(!se)return void U.a.Error("Invalid morph target. Target must have positions.");this.geometry.setVerticesData(p.b.PositionKind+$,se,!1,3);var q=le.getNormals();q&&this.geometry.setVerticesData(p.b.NormalKind+$,q,!1,3);var H=le.getTangents();H&&this.geometry.setVerticesData(p.b.TangentKind+$,H,!1,3);var X=le.getUVs();X&&this.geometry.setVerticesData(p.b.UVKind+"_"+$,X,!1,2)}}else for($=0;this.geometry.isVerticesDataPresent(p.b.PositionKind+$);)this.geometry.removeVerticesData(p.b.PositionKind+$),this.geometry.isVerticesDataPresent(p.b.NormalKind+$)&&this.geometry.removeVerticesData(p.b.NormalKind+$),this.geometry.isVerticesDataPresent(p.b.TangentKind+$)&&this.geometry.removeVerticesData(p.b.TangentKind+$),this.geometry.isVerticesDataPresent(p.b.UVKind+$)&&this.geometry.removeVerticesData(p.b.UVKind+"_"+$),$++}},B.Parse=function(G,$,le){var se;if((se=G.type&&G.type==="GroundMesh"?B._GroundMeshParser(G,$):new B(G.name,$)).id=G.id,M.a&&M.a.AddTagsTo(se,G.tags),se.position=C.e.FromArray(G.position),G.metadata!==void 0&&(se.metadata=G.metadata),G.rotationQuaternion?se.rotationQuaternion=C.b.FromArray(G.rotationQuaternion):G.rotation&&(se.rotation=C.e.FromArray(G.rotation)),se.scaling=C.e.FromArray(G.scaling),G.localMatrix?se.setPreTransformMatrix(C.a.FromArray(G.localMatrix)):G.pivotMatrix&&se.setPivotMatrix(C.a.FromArray(G.pivotMatrix)),se.setEnabled(G.isEnabled),se.isVisible=G.isVisible,se.infiniteDistance=G.infiniteDistance,se.showBoundingBox=G.showBoundingBox,se.showSubMeshesBoundingBox=G.showSubMeshesBoundingBox,G.applyFog!==void 0&&(se.applyFog=G.applyFog),G.pickable!==void 0&&(se.isPickable=G.pickable),G.alphaIndex!==void 0&&(se.alphaIndex=G.alphaIndex),se.receiveShadows=G.receiveShadows,se.billboardMode=G.billboardMode,G.visibility!==void 0&&(se.visibility=G.visibility),se.checkCollisions=G.checkCollisions,se.overrideMaterialSideOrientation=G.overrideMaterialSideOrientation,G.isBlocker!==void 0&&(se.isBlocker=G.isBlocker),se._shouldGenerateFlatShading=G.useFlatShading,G.freezeWorldMatrix&&(se._waitingData.freezeWorldMatrix=G.freezeWorldMatrix),G.parentId&&(se._waitingParentId=G.parentId),G.actions!==void 0&&(se._waitingData.actions=G.actions),G.overlayAlpha!==void 0&&(se.overlayAlpha=G.overlayAlpha),G.overlayColor!==void 0&&(se.overlayColor=I.a.FromArray(G.overlayColor)),G.renderOverlay!==void 0&&(se.renderOverlay=G.renderOverlay),se.isUnIndexed=!!G.isUnIndexed,se.hasVertexAlpha=G.hasVertexAlpha,G.delayLoadingFile?(se.delayLoadState=N.a.DELAYLOADSTATE_NOTLOADED,se.delayLoadingFile=le+G.delayLoadingFile,se._boundingInfo=new _.a(C.e.FromArray(G.boundingBoxMinimum),C.e.FromArray(G.boundingBoxMaximum)),G._binaryInfo&&(se._binaryInfo=G._binaryInfo),se._delayInfo=[],G.hasUVs&&se._delayInfo.push(p.b.UVKind),G.hasUVs2&&se._delayInfo.push(p.b.UV2Kind),G.hasUVs3&&se._delayInfo.push(p.b.UV3Kind),G.hasUVs4&&se._delayInfo.push(p.b.UV4Kind),G.hasUVs5&&se._delayInfo.push(p.b.UV5Kind),G.hasUVs6&&se._delayInfo.push(p.b.UV6Kind),G.hasColors&&se._delayInfo.push(p.b.ColorKind),G.hasMatricesIndices&&se._delayInfo.push(p.b.MatricesIndicesKind),G.hasMatricesWeights&&se._delayInfo.push(p.b.MatricesWeightsKind),se._delayLoadingFunction=P.a._ImportGeometry,R.a.ForceFullSceneLoadingForIncremental&&se._checkDelayState()):P.a._ImportGeometry(G,se),G.materialId?se.setMaterialByID(G.materialId):se.material=null,G.morphTargetManagerId>-1&&(se.morphTargetManager=$.getMorphTargetManagerById(G.morphTargetManagerId)),G.skeletonId!==void 0&&G.skeletonId!==null&&(se.skeleton=$.getLastSkeletonByID(G.skeletonId),G.numBoneInfluencers&&(se.numBoneInfluencers=G.numBoneInfluencers)),G.animations){for(var q=0;q<G.animations.length;q++){var H=G.animations[q];(ee=L.a.GetClass("BABYLON.Animation"))&&se.animations.push(ee.Parse(H))}b.a.ParseAnimationRanges(se,G,$)}if(G.autoAnimate&&$.beginAnimation(se,G.autoAnimateFrom,G.autoAnimateTo,G.autoAnimateLoop,G.autoAnimateSpeed||1),G.layerMask&&!isNaN(G.layerMask)?se.layerMask=Math.abs(parseInt(G.layerMask)):se.layerMask=268435455,G.physicsImpostor&&B._PhysicsImpostorParser($,se,G),G.lodMeshIds&&(se._waitingData.lods={ids:G.lodMeshIds,distances:G.lodDistances?G.lodDistances:null,coverages:G.lodCoverages?G.lodCoverages:null}),G.instances)for(var X=0;X<G.instances.length;X++){var J=G.instances[X],Q=se.createInstance(J.name);if(J.id&&(Q.id=J.id),M.a&&(J.tags?M.a.AddTagsTo(Q,J.tags):M.a.AddTagsTo(Q,G.tags)),Q.position=C.e.FromArray(J.position),J.metadata!==void 0&&(Q.metadata=J.metadata),J.parentId&&(Q._waitingParentId=J.parentId),J.isEnabled!==void 0&&J.isEnabled!==null&&Q.setEnabled(J.isEnabled),J.isVisible!==void 0&&J.isVisible!==null&&(Q.isVisible=J.isVisible),J.isPickable!==void 0&&J.isPickable!==null&&(Q.isPickable=J.isPickable),J.rotationQuaternion?Q.rotationQuaternion=C.b.FromArray(J.rotationQuaternion):J.rotation&&(Q.rotation=C.e.FromArray(J.rotation)),Q.scaling=C.e.FromArray(J.scaling),J.checkCollisions!=null&&J.checkCollisions!=null&&(Q.checkCollisions=J.checkCollisions),J.pickable!=null&&J.pickable!=null&&(Q.isPickable=J.pickable),J.showBoundingBox!=null&&J.showBoundingBox!=null&&(Q.showBoundingBox=J.showBoundingBox),J.showSubMeshesBoundingBox!=null&&J.showSubMeshesBoundingBox!=null&&(Q.showSubMeshesBoundingBox=J.showSubMeshesBoundingBox),J.alphaIndex!=null&&J.showSubMeshesBoundingBox!=null&&(Q.alphaIndex=J.alphaIndex),J.physicsImpostor&&B._PhysicsImpostorParser($,Q,J),J.animations){for(q=0;q<J.animations.length;q++){var ee;H=J.animations[q],(ee=L.a.GetClass("BABYLON.Animation"))&&Q.animations.push(ee.Parse(H))}b.a.ParseAnimationRanges(Q,J,$),J.autoAnimate&&$.beginAnimation(Q,J.autoAnimateFrom,J.autoAnimateTo,J.autoAnimateLoop,J.autoAnimateSpeed||1)}}if(G.thinInstances){var pe=G.thinInstances;if(pe.matrixData?(se.thinInstanceSetBuffer("matrix",new Float32Array(pe.matrixData),16,!1),se._thinInstanceDataStorage.matrixBufferSize=pe.matrixBufferSize,se._thinInstanceDataStorage.instancesCount=pe.instancesCount):se._thinInstanceDataStorage.matrixBufferSize=pe.matrixBufferSize,G.thinInstances.userThinInstance){var Te=G.thinInstances.userThinInstance;for(var ve in Te.data)se.thinInstanceSetBuffer(ve,new Float32Array(Te.data[ve]),Te.strides[ve],!1),se._userThinInstanceBuffersStorage.sizes[ve]=Te.sizes[ve]}}return se},B.CreateRibbon=function(G,$,le,se,q,H,X,J,Q){throw j.a.WarnImport("MeshBuilder")},B.CreateDisc=function(G,$,le,se,q,H){throw j.a.WarnImport("MeshBuilder")},B.CreateBox=function(G,$,le,se,q){throw j.a.WarnImport("MeshBuilder")},B.CreateSphere=function(G,$,le,se,q,H){throw j.a.WarnImport("MeshBuilder")},B.CreateHemisphere=function(G,$,le,se){throw j.a.WarnImport("MeshBuilder")},B.CreateCylinder=function(G,$,le,se,q,H,X,J,Q){throw j.a.WarnImport("MeshBuilder")},B.CreateTorus=function(G,$,le,se,q,H,X){throw j.a.WarnImport("MeshBuilder")},B.CreateTorusKnot=function(G,$,le,se,q,H,X,J,Q,ee){throw j.a.WarnImport("MeshBuilder")},B.CreateLines=function(G,$,le,se,q){throw j.a.WarnImport("MeshBuilder")},B.CreateDashedLines=function(G,$,le,se,q,H,X,J){throw j.a.WarnImport("MeshBuilder")},B.CreatePolygon=function(G,$,le,se,q,H,X){throw X===void 0&&(X=earcut),j.a.WarnImport("MeshBuilder")},B.ExtrudePolygon=function(G,$,le,se,q,H,X,J){throw J===void 0&&(J=earcut),j.a.WarnImport("MeshBuilder")},B.ExtrudeShape=function(G,$,le,se,q,H,X,J,Q,ee){throw j.a.WarnImport("MeshBuilder")},B.ExtrudeShapeCustom=function(G,$,le,se,q,H,X,J,Q,ee,pe,Te){throw j.a.WarnImport("MeshBuilder")},B.CreateLathe=function(G,$,le,se,q,H,X){throw j.a.WarnImport("MeshBuilder")},B.CreatePlane=function(G,$,le,se,q){throw j.a.WarnImport("MeshBuilder")},B.CreateGround=function(G,$,le,se,q,H){throw j.a.WarnImport("MeshBuilder")},B.CreateTiledGround=function(G,$,le,se,q,H,X,J,Q){throw j.a.WarnImport("MeshBuilder")},B.CreateGroundFromHeightMap=function(G,$,le,se,q,H,X,J,Q,ee,pe){throw j.a.WarnImport("MeshBuilder")},B.CreateTube=function(G,$,le,se,q,H,X,J,Q,ee){throw j.a.WarnImport("MeshBuilder")},B.CreatePolyhedron=function(G,$,le){throw j.a.WarnImport("MeshBuilder")},B.CreateIcoSphere=function(G,$,le){throw j.a.WarnImport("MeshBuilder")},B.CreateDecal=function(G,$,le,se,q,H){throw j.a.WarnImport("MeshBuilder")},B.CreateCapsule=function(G,$,le){throw j.a.WarnImport("MeshBuilder")},B.prototype.setPositionsForCPUSkinning=function(){var G=this._internalMeshDataInfo;if(!G._sourcePositions){var $=this.getVerticesData(p.b.PositionKind);if(!$)return G._sourcePositions;G._sourcePositions=new Float32Array($),this.isVertexBufferUpdatable(p.b.PositionKind)||this.setVerticesData(p.b.PositionKind,$,!0)}return G._sourcePositions},B.prototype.setNormalsForCPUSkinning=function(){var G=this._internalMeshDataInfo;if(!G._sourceNormals){var $=this.getVerticesData(p.b.NormalKind);if(!$)return G._sourceNormals;G._sourceNormals=new Float32Array($),this.isVertexBufferUpdatable(p.b.NormalKind)||this.setVerticesData(p.b.NormalKind,$,!0)}return G._sourceNormals},B.prototype.applySkeleton=function(G){if(!this.geometry)return this;if(this.geometry._softwareSkinningFrameId==this.getScene().getFrameId())return this;if(this.geometry._softwareSkinningFrameId=this.getScene().getFrameId(),!this.isVerticesDataPresent(p.b.PositionKind))return this;if(!this.isVerticesDataPresent(p.b.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(p.b.MatricesWeightsKind))return this;var $=this.isVerticesDataPresent(p.b.NormalKind),le=this._internalMeshDataInfo;if(!le._sourcePositions){var se=this.subMeshes.slice();this.setPositionsForCPUSkinning(),this.subMeshes=se}$&&!le._sourceNormals&&this.setNormalsForCPUSkinning();var q=this.getVerticesData(p.b.PositionKind);if(!q)return this;q instanceof Float32Array||(q=new Float32Array(q));var H=this.getVerticesData(p.b.NormalKind);if($){if(!H)return this;H instanceof Float32Array||(H=new Float32Array(H))}var X=this.getVerticesData(p.b.MatricesIndicesKind),J=this.getVerticesData(p.b.MatricesWeightsKind);if(!J||!X)return this;for(var Q,ee=this.numBoneInfluencers>4,pe=ee?this.getVerticesData(p.b.MatricesIndicesExtraKind):null,Te=ee?this.getVerticesData(p.b.MatricesWeightsExtraKind):null,ve=G.getTransformMatrices(this),he=C.e.Zero(),be=new C.a,xe=new C.a,Se=0,Ue=0;Ue<q.length;Ue+=3,Se+=4){var We;for(Q=0;Q<4;Q++)(We=J[Se+Q])>0&&(C.a.FromFloat32ArrayToRefScaled(ve,Math.floor(16*X[Se+Q]),We,xe),be.addToSelf(xe));if(ee)for(Q=0;Q<4;Q++)(We=Te[Se+Q])>0&&(C.a.FromFloat32ArrayToRefScaled(ve,Math.floor(16*pe[Se+Q]),We,xe),be.addToSelf(xe));C.e.TransformCoordinatesFromFloatsToRef(le._sourcePositions[Ue],le._sourcePositions[Ue+1],le._sourcePositions[Ue+2],be,he),he.toArray(q,Ue),$&&(C.e.TransformNormalFromFloatsToRef(le._sourceNormals[Ue],le._sourceNormals[Ue+1],le._sourceNormals[Ue+2],be,he),he.toArray(H,Ue)),be.reset()}return this.updateVerticesData(p.b.PositionKind,q),$&&this.updateVerticesData(p.b.NormalKind,H),this},B.MinMax=function(G){var $=null,le=null;return G.forEach(function(se){var q=se.getBoundingInfo().boundingBox;$&&le?($.minimizeInPlace(q.minimumWorld),le.maximizeInPlace(q.maximumWorld)):($=q.minimumWorld,le=q.maximumWorld)}),$&&le?{min:$,max:le}:{min:C.e.Zero(),max:C.e.Zero()}},B.Center=function(G){var $=G instanceof Array?B.MinMax(G):G;return C.e.Center($.min,$.max)},B.MergeMeshes=function(G,$,le,se,q,H){var X;if($===void 0&&($=!0),!le){var J=0;for(X=0;X<G.length;X++)if(G[X]&&(J+=G[X].getTotalVertices())>=65536)return U.a.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}if(H){var Q,ee,pe=null;q=!1}var Te,ve=new Array,he=new Array,be=null,xe=new Array,Se=null;for(X=0;X<G.length;X++)if(G[X]){var Ue=G[X];if(Ue.isAnInstance)return U.a.Warn("Cannot merge instance meshes."),null;var We=Ue.computeWorldMatrix(!0);if((Te=x.a.ExtractFromMesh(Ue,!0,!0)).transform(We),be?be.merge(Te,le):(be=Te,Se=Ue),q&&xe.push(Ue.getTotalIndices()),H)if(Ue.material){var Ze=Ue.material;if(Ze instanceof O.a){for(ee=0;ee<Ze.subMaterials.length;ee++)ve.indexOf(Ze.subMaterials[ee])<0&&ve.push(Ze.subMaterials[ee]);for(Q=0;Q<Ue.subMeshes.length;Q++)he.push(ve.indexOf(Ze.subMaterials[Ue.subMeshes[Q].materialIndex])),xe.push(Ue.subMeshes[Q].indexCount)}else for(ve.indexOf(Ze)<0&&ve.push(Ze),Q=0;Q<Ue.subMeshes.length;Q++)he.push(ve.indexOf(Ze)),xe.push(Ue.subMeshes[Q].indexCount)}else for(Q=0;Q<Ue.subMeshes.length;Q++)he.push(0),xe.push(Ue.subMeshes[Q].indexCount)}if(Se=Se,se||(se=new B(Se.name+"_merged",Se.getScene())),be.applyToMesh(se),se.checkCollisions=Se.checkCollisions,se.overrideMaterialSideOrientation=Se.overrideMaterialSideOrientation,$)for(X=0;X<G.length;X++)G[X]&&G[X].dispose();if(q||H){se.releaseSubMeshes(),X=0;for(var Qe=0;X<xe.length;)T.a.CreateFromIndices(0,Qe,xe[X],se),Qe+=xe[X],X++}if(H){for((pe=new O.a(Se.name+"_merged",Se.getScene())).subMaterials=ve,Q=0;Q<se.subMeshes.length;Q++)se.subMeshes[Q].materialIndex=he[Q];se.material=pe}else se.material=Se.material;return se},B.prototype.addInstance=function(G){G._indexInSourceMeshInstanceArray=this.instances.length,this.instances.push(G)},B.prototype.removeInstance=function(G){var $=G._indexInSourceMeshInstanceArray;if($!=-1){if($!==this.instances.length-1){var le=this.instances[this.instances.length-1];this.instances[$]=le,le._indexInSourceMeshInstanceArray=$}G._indexInSourceMeshInstanceArray=-1,this.instances.pop()}},B.FRONTSIDE=x.a.FRONTSIDE,B.BACKSIDE=x.a.BACKSIDE,B.DOUBLESIDE=x.a.DOUBLESIDE,B.DEFAULTSIDE=x.a.DEFAULTSIDE,B.NO_CAP=0,B.CAP_START=1,B.CAP_END=2,B.CAP_ALL=3,B.NO_FLIP=0,B.FLIP_TILE=1,B.ROTATE_TILE=2,B.FLIP_ROW=3,B.ROTATE_ROW=4,B.FLIP_N_ROTATE_TILE=5,B.FLIP_N_ROTATE_ROW=6,B.CENTER=0,B.LEFT=1,B.RIGHT=2,B.TOP=3,B.BOTTOM=4,B._GroundMeshParser=function(G,$){throw j.a.WarnImport("GroundMesh")},B}(A.a);L.a.RegisteredTypes["BABYLON.Mesh"]=Z},function(h,s,c){c.d(s,"a",function(){return E});var E=function(){function m(){}return m._AddLogEntry=function(S){m._LogCache=S+m._LogCache,m.OnNewCacheEntry&&m.OnNewCacheEntry(S)},m._FormatMessage=function(S){var d=function(C){return C<10?"0"+C:""+C},M=new Date;return"["+d(M.getHours())+":"+d(M.getMinutes())+":"+d(M.getSeconds())+"]: "+S},m._LogDisabled=function(S){},m._LogEnabled=function(S){var d=m._FormatMessage(S);console.log("BJS - "+d);var M="<div style='color:white'>"+d+"</div><br>";m._AddLogEntry(M)},m._WarnDisabled=function(S){},m._WarnEnabled=function(S){var d=m._FormatMessage(S);console.warn("BJS - "+d);var M="<div style='color:orange'>"+d+"</div><br>";m._AddLogEntry(M)},m._ErrorDisabled=function(S){},m._ErrorEnabled=function(S){m.errorsCount++;var d=m._FormatMessage(S);console.error("BJS - "+d);var M="<div style='color:red'>"+d+"</div><br>";m._AddLogEntry(M)},Object.defineProperty(m,"LogCache",{get:function(){return m._LogCache},enumerable:!1,configurable:!0}),m.ClearLogCache=function(){m._LogCache="",m.errorsCount=0},Object.defineProperty(m,"LogLevels",{set:function(S){(S&m.MessageLogLevel)===m.MessageLogLevel?m.Log=m._LogEnabled:m.Log=m._LogDisabled,(S&m.WarningLogLevel)===m.WarningLogLevel?m.Warn=m._WarnEnabled:m.Warn=m._WarnDisabled,(S&m.ErrorLogLevel)===m.ErrorLogLevel?m.Error=m._ErrorEnabled:m.Error=m._ErrorDisabled},enumerable:!1,configurable:!0}),m.NoneLogLevel=0,m.MessageLogLevel=1,m.WarningLogLevel=2,m.ErrorLogLevel=4,m.AllLogLevel=7,m._LogCache="",m.errorsCount=0,m.Log=m._LogEnabled,m.Warn=m._WarnEnabled,m.Error=m._ErrorEnabled,m}()},function(h,s,c){c.d(s,"a",function(){return M}),c.d(s,"b",function(){return C}),c.d(s,"c",function(){return I});var E=c(14),m=c(28),S=c(44),d=c(11),M=function(){function b(p,x,P){p===void 0&&(p=0),x===void 0&&(x=0),P===void 0&&(P=0),this.r=p,this.g=x,this.b=P}return b.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"},b.prototype.getClassName=function(){return"Color3"},b.prototype.getHashCode=function(){var p=255*this.r|0;return p=397*(p=397*p^(255*this.g|0))^(255*this.b|0)},b.prototype.toArray=function(p,x){return x===void 0&&(x=0),p[x]=this.r,p[x+1]=this.g,p[x+2]=this.b,this},b.prototype.fromArray=function(p,x){return x===void 0&&(x=0),b.FromArrayToRef(p,x,this),this},b.prototype.toColor4=function(p){return p===void 0&&(p=1),new C(this.r,this.g,this.b,p)},b.prototype.asArray=function(){var p=new Array;return this.toArray(p,0),p},b.prototype.toLuminance=function(){return .3*this.r+.59*this.g+.11*this.b},b.prototype.multiply=function(p){return new b(this.r*p.r,this.g*p.g,this.b*p.b)},b.prototype.multiplyToRef=function(p,x){return x.r=this.r*p.r,x.g=this.g*p.g,x.b=this.b*p.b,this},b.prototype.equals=function(p){return p&&this.r===p.r&&this.g===p.g&&this.b===p.b},b.prototype.equalsFloats=function(p,x,P){return this.r===p&&this.g===x&&this.b===P},b.prototype.scale=function(p){return new b(this.r*p,this.g*p,this.b*p)},b.prototype.scaleToRef=function(p,x){return x.r=this.r*p,x.g=this.g*p,x.b=this.b*p,this},b.prototype.scaleAndAddToRef=function(p,x){return x.r+=this.r*p,x.g+=this.g*p,x.b+=this.b*p,this},b.prototype.clampToRef=function(p,x,P){return p===void 0&&(p=0),x===void 0&&(x=1),P.r=E.a.Clamp(this.r,p,x),P.g=E.a.Clamp(this.g,p,x),P.b=E.a.Clamp(this.b,p,x),this},b.prototype.add=function(p){return new b(this.r+p.r,this.g+p.g,this.b+p.b)},b.prototype.addToRef=function(p,x){return x.r=this.r+p.r,x.g=this.g+p.g,x.b=this.b+p.b,this},b.prototype.subtract=function(p){return new b(this.r-p.r,this.g-p.g,this.b-p.b)},b.prototype.subtractToRef=function(p,x){return x.r=this.r-p.r,x.g=this.g-p.g,x.b=this.b-p.b,this},b.prototype.clone=function(){return new b(this.r,this.g,this.b)},b.prototype.copyFrom=function(p){return this.r=p.r,this.g=p.g,this.b=p.b,this},b.prototype.copyFromFloats=function(p,x,P){return this.r=p,this.g=x,this.b=P,this},b.prototype.set=function(p,x,P){return this.copyFromFloats(p,x,P)},b.prototype.toHexString=function(){var p=255*this.r|0,x=255*this.g|0,P=255*this.b|0;return"#"+E.a.ToHex(p)+E.a.ToHex(x)+E.a.ToHex(P)},b.prototype.toLinearSpace=function(){var p=new b;return this.toLinearSpaceToRef(p),p},b.prototype.toHSV=function(){var p=new b;return this.toHSVToRef(p),p},b.prototype.toHSVToRef=function(p){var x=this.r,P=this.g,A=this.b,T=Math.max(x,P,A),_=Math.min(x,P,A),g=0,O=0,R=T,N=T-_;T!==0&&(O=N/T),T!=_&&(T==x?(g=(P-A)/N,P<A&&(g+=6)):T==P?g=(A-x)/N+2:T==A&&(g=(x-P)/N+4),g*=60),p.r=g,p.g=O,p.b=R},b.prototype.toLinearSpaceToRef=function(p){return p.r=Math.pow(this.r,m.c),p.g=Math.pow(this.g,m.c),p.b=Math.pow(this.b,m.c),this},b.prototype.toGammaSpace=function(){var p=new b;return this.toGammaSpaceToRef(p),p},b.prototype.toGammaSpaceToRef=function(p){return p.r=Math.pow(this.r,m.b),p.g=Math.pow(this.g,m.b),p.b=Math.pow(this.b,m.b),this},b.HSVtoRGBToRef=function(p,x,P,A){var T=P*x,_=p/60,g=T*(1-Math.abs(_%2-1)),O=0,R=0,N=0;_>=0&&_<=1?(O=T,R=g):_>=1&&_<=2?(O=g,R=T):_>=2&&_<=3?(R=T,N=g):_>=3&&_<=4?(R=g,N=T):_>=4&&_<=5?(O=g,N=T):_>=5&&_<=6&&(O=T,N=g);var V=P-T;A.set(O+V,R+V,N+V)},b.FromHexString=function(p){if(p.substring(0,1)!=="#"||p.length!==7)return new b(0,0,0);var x=parseInt(p.substring(1,3),16),P=parseInt(p.substring(3,5),16),A=parseInt(p.substring(5,7),16);return b.FromInts(x,P,A)},b.FromArray=function(p,x){return x===void 0&&(x=0),new b(p[x],p[x+1],p[x+2])},b.FromArrayToRef=function(p,x,P){x===void 0&&(x=0),P.r=p[x],P.g=p[x+1],P.b=p[x+2]},b.FromInts=function(p,x,P){return new b(p/255,x/255,P/255)},b.Lerp=function(p,x,P){var A=new b(0,0,0);return b.LerpToRef(p,x,P,A),A},b.LerpToRef=function(p,x,P,A){A.r=p.r+(x.r-p.r)*P,A.g=p.g+(x.g-p.g)*P,A.b=p.b+(x.b-p.b)*P},b.Red=function(){return new b(1,0,0)},b.Green=function(){return new b(0,1,0)},b.Blue=function(){return new b(0,0,1)},b.Black=function(){return new b(0,0,0)},Object.defineProperty(b,"BlackReadOnly",{get:function(){return b._BlackReadOnly},enumerable:!1,configurable:!0}),b.White=function(){return new b(1,1,1)},b.Purple=function(){return new b(.5,0,.5)},b.Magenta=function(){return new b(1,0,1)},b.Yellow=function(){return new b(1,1,0)},b.Gray=function(){return new b(.5,.5,.5)},b.Teal=function(){return new b(0,1,1)},b.Random=function(){return new b(Math.random(),Math.random(),Math.random())},b._BlackReadOnly=b.Black(),b}(),C=function(){function b(p,x,P,A){p===void 0&&(p=0),x===void 0&&(x=0),P===void 0&&(P=0),A===void 0&&(A=1),this.r=p,this.g=x,this.b=P,this.a=A}return b.prototype.addInPlace=function(p){return this.r+=p.r,this.g+=p.g,this.b+=p.b,this.a+=p.a,this},b.prototype.asArray=function(){var p=new Array;return this.toArray(p,0),p},b.prototype.toArray=function(p,x){return x===void 0&&(x=0),p[x]=this.r,p[x+1]=this.g,p[x+2]=this.b,p[x+3]=this.a,this},b.prototype.fromArray=function(p,x){return x===void 0&&(x=0),b.FromArrayToRef(p,x,this),this},b.prototype.equals=function(p){return p&&this.r===p.r&&this.g===p.g&&this.b===p.b&&this.a===p.a},b.prototype.add=function(p){return new b(this.r+p.r,this.g+p.g,this.b+p.b,this.a+p.a)},b.prototype.subtract=function(p){return new b(this.r-p.r,this.g-p.g,this.b-p.b,this.a-p.a)},b.prototype.subtractToRef=function(p,x){return x.r=this.r-p.r,x.g=this.g-p.g,x.b=this.b-p.b,x.a=this.a-p.a,this},b.prototype.scale=function(p){return new b(this.r*p,this.g*p,this.b*p,this.a*p)},b.prototype.scaleToRef=function(p,x){return x.r=this.r*p,x.g=this.g*p,x.b=this.b*p,x.a=this.a*p,this},b.prototype.scaleAndAddToRef=function(p,x){return x.r+=this.r*p,x.g+=this.g*p,x.b+=this.b*p,x.a+=this.a*p,this},b.prototype.clampToRef=function(p,x,P){return p===void 0&&(p=0),x===void 0&&(x=1),P.r=E.a.Clamp(this.r,p,x),P.g=E.a.Clamp(this.g,p,x),P.b=E.a.Clamp(this.b,p,x),P.a=E.a.Clamp(this.a,p,x),this},b.prototype.multiply=function(p){return new b(this.r*p.r,this.g*p.g,this.b*p.b,this.a*p.a)},b.prototype.multiplyToRef=function(p,x){return x.r=this.r*p.r,x.g=this.g*p.g,x.b=this.b*p.b,x.a=this.a*p.a,x},b.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"},b.prototype.getClassName=function(){return"Color4"},b.prototype.getHashCode=function(){var p=255*this.r|0;return p=397*(p=397*(p=397*p^(255*this.g|0))^(255*this.b|0))^(255*this.a|0)},b.prototype.clone=function(){return new b(this.r,this.g,this.b,this.a)},b.prototype.copyFrom=function(p){return this.r=p.r,this.g=p.g,this.b=p.b,this.a=p.a,this},b.prototype.copyFromFloats=function(p,x,P,A){return this.r=p,this.g=x,this.b=P,this.a=A,this},b.prototype.set=function(p,x,P,A){return this.copyFromFloats(p,x,P,A)},b.prototype.toHexString=function(p){p===void 0&&(p=!1);var x=255*this.r|0,P=255*this.g|0,A=255*this.b|0;if(p)return"#"+E.a.ToHex(x)+E.a.ToHex(P)+E.a.ToHex(A);var T=255*this.a|0;return"#"+E.a.ToHex(x)+E.a.ToHex(P)+E.a.ToHex(A)+E.a.ToHex(T)},b.prototype.toLinearSpace=function(){var p=new b;return this.toLinearSpaceToRef(p),p},b.prototype.toLinearSpaceToRef=function(p){return p.r=Math.pow(this.r,m.c),p.g=Math.pow(this.g,m.c),p.b=Math.pow(this.b,m.c),p.a=this.a,this},b.prototype.toGammaSpace=function(){var p=new b;return this.toGammaSpaceToRef(p),p},b.prototype.toGammaSpaceToRef=function(p){return p.r=Math.pow(this.r,m.b),p.g=Math.pow(this.g,m.b),p.b=Math.pow(this.b,m.b),p.a=this.a,this},b.FromHexString=function(p){if(p.substring(0,1)!=="#"||p.length!==9)return new b(0,0,0,0);var x=parseInt(p.substring(1,3),16),P=parseInt(p.substring(3,5),16),A=parseInt(p.substring(5,7),16),T=parseInt(p.substring(7,9),16);return b.FromInts(x,P,A,T)},b.Lerp=function(p,x,P){var A=new b(0,0,0,0);return b.LerpToRef(p,x,P,A),A},b.LerpToRef=function(p,x,P,A){A.r=p.r+(x.r-p.r)*P,A.g=p.g+(x.g-p.g)*P,A.b=p.b+(x.b-p.b)*P,A.a=p.a+(x.a-p.a)*P},b.FromColor3=function(p,x){return x===void 0&&(x=1),new b(p.r,p.g,p.b,x)},b.FromArray=function(p,x){return x===void 0&&(x=0),new b(p[x],p[x+1],p[x+2],p[x+3])},b.FromArrayToRef=function(p,x,P){x===void 0&&(x=0),P.r=p[x],P.g=p[x+1],P.b=p[x+2],P.a=p[x+3]},b.FromInts=function(p,x,P,A){return new b(p/255,x/255,P/255,A/255)},b.CheckColors4=function(p,x){if(p.length===3*x){for(var P=[],A=0;A<p.length;A+=3){var T=A/3*4;P[T]=p[A],P[T+1]=p[A+1],P[T+2]=p[A+2],P[T+3]=1}return P}return p},b}(),I=function(){function b(){}return b.Color3=S.a.BuildArray(3,M.Black),b.Color4=S.a.BuildArray(3,function(){return new C(0,0,0,0)}),b}();d.a.RegisteredTypes["BABYLON.Color3"]=M,d.a.RegisteredTypes["BABYLON.Color4"]=C},function(h,s,c){c.d(s,"a",function(){return _});var E=c(1),m=c(3),S=c(6),d=c(0),M=c(52),C=c(2),I=c(11),b=c(21),p=c(104),x=c(122),P=c(64),A=c(34),T=c(150),_=function(g){function O(R,N,V,U,L,j,Y,W,re,ne,ge,_e){V===void 0&&(V=!1),U===void 0&&(U=!0),L===void 0&&(L=O.TRILINEAR_SAMPLINGMODE),j===void 0&&(j=null),Y===void 0&&(Y=null),W===void 0&&(W=null),re===void 0&&(re=!1);var ce=g.call(this,N)||this;ce.url=null,ce.uOffset=0,ce.vOffset=0,ce.uScale=1,ce.vScale=1,ce.uAng=0,ce.vAng=0,ce.wAng=0,ce.uRotationCenter=.5,ce.vRotationCenter=.5,ce.wRotationCenter=.5,ce.homogeneousRotationInUVTransform=!1,ce.inspectableCustomProperties=null,ce._noMipmap=!1,ce._invertY=!1,ce._rowGenerationMatrix=null,ce._cachedTextureMatrix=null,ce._projectionModeMatrix=null,ce._t0=null,ce._t1=null,ce._t2=null,ce._cachedUOffset=-1,ce._cachedVOffset=-1,ce._cachedUScale=0,ce._cachedVScale=0,ce._cachedUAng=-1,ce._cachedVAng=-1,ce._cachedWAng=-1,ce._cachedProjectionMatrixId=-1,ce._cachedURotationCenter=-1,ce._cachedVRotationCenter=-1,ce._cachedWRotationCenter=-1,ce._cachedHomogeneousRotationInUVTransform=!1,ce._cachedCoordinatesMode=-1,ce._initialSamplingMode=O.BILINEAR_SAMPLINGMODE,ce._buffer=null,ce._deleteBuffer=!1,ce._format=null,ce._delayedOnLoad=null,ce._delayedOnError=null,ce.onLoadObservable=new S.c,ce._isBlocking=!0,ce.name=R||"",ce.url=R,ce._noMipmap=V,ce._invertY=U,ce._initialSamplingMode=L,ce._buffer=W,ce._deleteBuffer=re,ce._mimeType=ge,ce._loaderOptions=_e,ne&&(ce._format=ne);var ie=ce.getScene(),Z=ce._getEngine();if(!Z)return ce;Z.onBeforeTextureInitObservable.notifyObservers(ce);var te=function(){ce._texture&&(ce._texture._invertVScale&&(ce.vScale*=-1,ce.vOffset+=1),ce._texture._cachedWrapU!==null&&(ce.wrapU=ce._texture._cachedWrapU,ce._texture._cachedWrapU=null),ce._texture._cachedWrapV!==null&&(ce.wrapV=ce._texture._cachedWrapV,ce._texture._cachedWrapV=null),ce._texture._cachedWrapR!==null&&(ce.wrapR=ce._texture._cachedWrapR,ce._texture._cachedWrapR=null)),ce.onLoadObservable.hasObservers()&&ce.onLoadObservable.notifyObservers(ce),j&&j(),!ce.isBlocking&&ie&&ie.resetCachedMaterial()};return ce.url?(ce._texture=ce._getFromCache(ce.url,V,L,U),ce._texture?ce._texture.isReady?p.a.SetImmediate(function(){return te()}):ce._texture.onLoadedObservable.add(te):ie&&ie.useDelayedTextureLoading?(ce.delayLoadState=C.a.DELAYLOADSTATE_NOTLOADED,ce._delayedOnLoad=te,ce._delayedOnError=Y):(ce._texture=Z.createTexture(ce.url,V,U,ie,L,te,Y,ce._buffer,void 0,ce._format,null,ge,_e),re&&(ce._buffer=null)),ce):(ce._delayedOnLoad=te,ce._delayedOnError=Y,ce)}return Object(E.d)(O,g),Object.defineProperty(O.prototype,"noMipmap",{get:function(){return this._noMipmap},enumerable:!1,configurable:!0}),Object.defineProperty(O.prototype,"mimeType",{get:function(){return this._mimeType},enumerable:!1,configurable:!0}),Object.defineProperty(O.prototype,"isBlocking",{get:function(){return this._isBlocking},set:function(R){this._isBlocking=R},enumerable:!1,configurable:!0}),Object.defineProperty(O.prototype,"samplingMode",{get:function(){return this._texture?this._texture.samplingMode:this._initialSamplingMode},enumerable:!1,configurable:!0}),Object.defineProperty(O.prototype,"invertY",{get:function(){return this._invertY},enumerable:!1,configurable:!0}),O.prototype.updateURL=function(R,N,V){N===void 0&&(N=null),this.url&&(this.releaseInternalTexture(),this.getScene().markAllMaterialsAsDirty(C.a.MATERIAL_TextureDirtyFlag)),this.name&&!A.a.StartsWith(this.name,"data:")||(this.name=R),this.url=R,this._buffer=N,this.delayLoadState=C.a.DELAYLOADSTATE_NOTLOADED,V&&(this._delayedOnLoad=V),this.delayLoad()},O.prototype.delayLoad=function(){if(this.delayLoadState===C.a.DELAYLOADSTATE_NOTLOADED){var R=this.getScene();R&&(this.delayLoadState=C.a.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,this._noMipmap,this.samplingMode,this._invertY),this._texture?this._delayedOnLoad&&(this._texture.isReady?p.a.SetImmediate(this._delayedOnLoad):this._texture.onLoadedObservable.add(this._delayedOnLoad)):(this._texture=R.getEngine().createTexture(this.url,this._noMipmap,this._invertY,R,this.samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer,null,this._format,null,this._mimeType,this._loaderOptions),this._deleteBuffer&&(this._buffer=null)),this._delayedOnLoad=null,this._delayedOnError=null)}},O.prototype._prepareRowForTextureGeneration=function(R,N,V,U){R*=this._cachedUScale,N*=this._cachedVScale,R-=this.uRotationCenter*this._cachedUScale,N-=this.vRotationCenter*this._cachedVScale,V-=this.wRotationCenter,d.e.TransformCoordinatesFromFloatsToRef(R,N,V,this._rowGenerationMatrix,U),U.x+=this.uRotationCenter*this._cachedUScale+this._cachedUOffset,U.y+=this.vRotationCenter*this._cachedVScale+this._cachedVOffset,U.z+=this.wRotationCenter},O.prototype.checkTransformsAreIdentical=function(R){return R!==null&&this.uOffset===R.uOffset&&this.vOffset===R.vOffset&&this.uScale===R.uScale&&this.vScale===R.vScale&&this.uAng===R.uAng&&this.vAng===R.vAng&&this.wAng===R.wAng},O.prototype.getTextureMatrix=function(R){var N=this;if(R===void 0&&(R=1),this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale*R===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng&&this.uRotationCenter===this._cachedURotationCenter&&this.vRotationCenter===this._cachedVRotationCenter&&this.wRotationCenter===this._cachedWRotationCenter&&this.homogeneousRotationInUVTransform===this._cachedHomogeneousRotationInUVTransform)return this._cachedTextureMatrix;this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale*R,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedURotationCenter=this.uRotationCenter,this._cachedVRotationCenter=this.vRotationCenter,this._cachedWRotationCenter=this.wRotationCenter,this._cachedHomogeneousRotationInUVTransform=this.homogeneousRotationInUVTransform,this._cachedTextureMatrix&&this._rowGenerationMatrix||(this._cachedTextureMatrix=d.a.Zero(),this._rowGenerationMatrix=new d.a,this._t0=d.e.Zero(),this._t1=d.e.Zero(),this._t2=d.e.Zero()),d.a.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this.homogeneousRotationInUVTransform?(d.a.TranslationToRef(-this._cachedURotationCenter,-this._cachedVRotationCenter,-this._cachedWRotationCenter,d.c.Matrix[0]),d.a.TranslationToRef(this._cachedURotationCenter,this._cachedVRotationCenter,this._cachedWRotationCenter,d.c.Matrix[1]),d.a.ScalingToRef(this._cachedUScale,this._cachedVScale,0,d.c.Matrix[2]),d.a.TranslationToRef(this._cachedUOffset,this._cachedVOffset,0,d.c.Matrix[3]),d.c.Matrix[0].multiplyToRef(this._rowGenerationMatrix,this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(d.c.Matrix[1],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(d.c.Matrix[2],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(d.c.Matrix[3],this._cachedTextureMatrix),this._cachedTextureMatrix.setRowFromFloats(2,this._cachedTextureMatrix.m[12],this._cachedTextureMatrix.m[13],this._cachedTextureMatrix.m[14],1)):(this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.subtractInPlace(this._t0),this._t2.subtractInPlace(this._t0),d.a.FromValuesToRef(this._t1.x,this._t1.y,this._t1.z,0,this._t2.x,this._t2.y,this._t2.z,0,this._t0.x,this._t0.y,this._t0.z,0,0,0,0,1,this._cachedTextureMatrix));var V=this.getScene();return V?(V.markAllMaterialsAsDirty(C.a.MATERIAL_TextureDirtyFlag,function(U){return U.hasTexture(N)}),this._cachedTextureMatrix):this._cachedTextureMatrix},O.prototype.getReflectionTextureMatrix=function(){var R=this,N=this.getScene();if(!N)return this._cachedTextureMatrix;if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale===this._cachedUScale&&this.vScale===this._cachedVScale&&this.coordinatesMode===this._cachedCoordinatesMode){if(this.coordinatesMode!==O.PROJECTION_MODE)return this._cachedTextureMatrix;if(this._cachedProjectionMatrixId===N.getProjectionMatrix().updateFlag)return this._cachedTextureMatrix}switch(this._cachedTextureMatrix||(this._cachedTextureMatrix=d.a.Zero()),this._projectionModeMatrix||(this._projectionModeMatrix=d.a.Zero()),this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale,this._cachedVScale=this.vScale,this._cachedCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case O.PLANAR_MODE:d.a.IdentityToRef(this._cachedTextureMatrix),this._cachedTextureMatrix[0]=this.uScale,this._cachedTextureMatrix[5]=this.vScale,this._cachedTextureMatrix[12]=this.uOffset,this._cachedTextureMatrix[13]=this.vOffset;break;case O.PROJECTION_MODE:d.a.FromValuesToRef(.5,0,0,0,0,-.5,0,0,0,0,0,0,.5,.5,1,1,this._projectionModeMatrix);var V=N.getProjectionMatrix();this._cachedProjectionMatrixId=V.updateFlag,V.multiplyToRef(this._projectionModeMatrix,this._cachedTextureMatrix);break;default:d.a.IdentityToRef(this._cachedTextureMatrix)}return N.markAllMaterialsAsDirty(C.a.MATERIAL_TextureDirtyFlag,function(U){return U.getActiveTextures().indexOf(R)!==-1}),this._cachedTextureMatrix},O.prototype.clone=function(){var R=this;return m.a.Clone(function(){return new O(R._texture?R._texture.url:null,R.getScene(),R._noMipmap,R._invertY,R.samplingMode,void 0,void 0,R._texture?R._texture._buffer:void 0)},this)},O.prototype.serialize=function(){var R=this.name;O.SerializeBuffers||A.a.StartsWith(this.name,"data:")&&(this.name=""),A.a.StartsWith(this.name,"data:")&&this.url===this.name&&(this.url="");var N=g.prototype.serialize.call(this);return N?((O.SerializeBuffers||O.ForceSerializeBuffers)&&(typeof this._buffer=="string"&&this._buffer.substr(0,5)==="data:"?(N.base64String=this._buffer,N.name=N.name.replace("data:","")):this.url&&A.a.StartsWith(this.url,"data:")&&this._buffer instanceof Uint8Array?N.base64String="data:image/png;base64,"+A.a.EncodeArrayBufferToBase64(this._buffer):O.ForceSerializeBuffers&&(N.base64String=T.a.GenerateBase64StringFromTexture(this))),N.invertY=this._invertY,N.samplingMode=this.samplingMode,this.name=R,N):null},O.prototype.getClassName=function(){return"Texture"},O.prototype.dispose=function(){g.prototype.dispose.call(this),this.onLoadObservable.clear(),this._delayedOnLoad=null,this._delayedOnError=null},O.Parse=function(R,N,V){if(R.customType){var U=x.a.Instantiate(R.customType).Parse(R,N,V);return R.samplingMode&&U.updateSamplingMode&&U._samplingMode&&U._samplingMode!==R.samplingMode&&U.updateSamplingMode(R.samplingMode),U}if(R.isCube&&!R.isRenderTarget)return O._CubeTextureParser(R,N,V);if(!R.name&&!R.isRenderTarget)return null;var L=function(){if(j&&j._texture&&(j._texture._cachedWrapU=null,j._texture._cachedWrapV=null,j._texture._cachedWrapR=null),R.samplingMode){var Y=R.samplingMode;j&&j.samplingMode!==Y&&j.updateSamplingMode(Y)}if(j&&R.animations)for(var W=0;W<R.animations.length;W++){var re=R.animations[W],ne=I.a.GetClass("BABYLON.Animation");ne&&j.animations.push(ne.Parse(re))}},j=m.a.Parse(function(){var Y,W=!0;if(R.noMipmap&&(W=!1),R.mirrorPlane){var re=O._CreateMirror(R.name,R.renderTargetSize,N,W);return re._waitingRenderList=R.renderList,re.mirrorPlane=P.a.FromArray(R.mirrorPlane),L(),re}if(R.isRenderTarget){var ne=null;if(R.isCube){if(N.reflectionProbes)for(var ge=0;ge<N.reflectionProbes.length;ge++){var _e=N.reflectionProbes[ge];if(_e.name===R.name)return _e.cubeTexture}}else(ne=O._CreateRenderTargetTexture(R.name,R.renderTargetSize,N,W))._waitingRenderList=R.renderList;return L(),ne}if(R.base64String)Y=O.CreateFromBase64String(R.base64String,R.name,N,!W,R.invertY,void 0,L);else{var ce=void 0;ce=R.name&&R.name.indexOf("://")>0?R.name:V+R.name,(A.a.StartsWith(R.url,"data:")||O.UseSerializedUrlIfAny&&R.url)&&(ce=R.url),Y=new O(ce,N,!W,R.invertY,void 0,L)}return Y},R,N);return j},O.CreateFromBase64String=function(R,N,V,U,L,j,Y,W,re){return j===void 0&&(j=O.TRILINEAR_SAMPLINGMODE),Y===void 0&&(Y=null),W===void 0&&(W=null),re===void 0&&(re=C.a.TEXTUREFORMAT_RGBA),new O("data:"+N,V,U,L,j,Y,W,R,!1,re)},O.LoadFromDataString=function(R,N,V,U,L,j,Y,W,re,ne){return U===void 0&&(U=!1),L===void 0&&(L=!1),j===void 0&&(j=!0),Y===void 0&&(Y=O.TRILINEAR_SAMPLINGMODE),W===void 0&&(W=null),re===void 0&&(re=null),ne===void 0&&(ne=C.a.TEXTUREFORMAT_RGBA),R.substr(0,5)!=="data:"&&(R="data:"+R),new O(R,V,L,j,Y,W,re,N,U,ne)},O.SerializeBuffers=!0,O.ForceSerializeBuffers=!1,O._CubeTextureParser=function(R,N,V){throw b.a.WarnImport("CubeTexture")},O._CreateMirror=function(R,N,V,U){throw b.a.WarnImport("MirrorTexture")},O._CreateRenderTargetTexture=function(R,N,V,U){throw b.a.WarnImport("RenderTargetTexture")},O.NEAREST_SAMPLINGMODE=C.a.TEXTURE_NEAREST_SAMPLINGMODE,O.NEAREST_NEAREST_MIPLINEAR=C.a.TEXTURE_NEAREST_NEAREST_MIPLINEAR,O.BILINEAR_SAMPLINGMODE=C.a.TEXTURE_BILINEAR_SAMPLINGMODE,O.LINEAR_LINEAR_MIPNEAREST=C.a.TEXTURE_LINEAR_LINEAR_MIPNEAREST,O.TRILINEAR_SAMPLINGMODE=C.a.TEXTURE_TRILINEAR_SAMPLINGMODE,O.LINEAR_LINEAR_MIPLINEAR=C.a.TEXTURE_LINEAR_LINEAR_MIPLINEAR,O.NEAREST_NEAREST_MIPNEAREST=C.a.TEXTURE_NEAREST_NEAREST_MIPNEAREST,O.NEAREST_LINEAR_MIPNEAREST=C.a.TEXTURE_NEAREST_LINEAR_MIPNEAREST,O.NEAREST_LINEAR_MIPLINEAR=C.a.TEXTURE_NEAREST_LINEAR_MIPLINEAR,O.NEAREST_LINEAR=C.a.TEXTURE_NEAREST_LINEAR,O.NEAREST_NEAREST=C.a.TEXTURE_NEAREST_NEAREST,O.LINEAR_NEAREST_MIPNEAREST=C.a.TEXTURE_LINEAR_NEAREST_MIPNEAREST,O.LINEAR_NEAREST_MIPLINEAR=C.a.TEXTURE_LINEAR_NEAREST_MIPLINEAR,O.LINEAR_LINEAR=C.a.TEXTURE_LINEAR_LINEAR,O.LINEAR_NEAREST=C.a.TEXTURE_LINEAR_NEAREST,O.EXPLICIT_MODE=C.a.TEXTURE_EXPLICIT_MODE,O.SPHERICAL_MODE=C.a.TEXTURE_SPHERICAL_MODE,O.PLANAR_MODE=C.a.TEXTURE_PLANAR_MODE,O.CUBIC_MODE=C.a.TEXTURE_CUBIC_MODE,O.PROJECTION_MODE=C.a.TEXTURE_PROJECTION_MODE,O.SKYBOX_MODE=C.a.TEXTURE_SKYBOX_MODE,O.INVCUBIC_MODE=C.a.TEXTURE_INVCUBIC_MODE,O.EQUIRECTANGULAR_MODE=C.a.TEXTURE_EQUIRECTANGULAR_MODE,O.FIXED_EQUIRECTANGULAR_MODE=C.a.TEXTURE_FIXED_EQUIRECTANGULAR_MODE,O.FIXED_EQUIRECTANGULAR_MIRRORED_MODE=C.a.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE,O.CLAMP_ADDRESSMODE=C.a.TEXTURE_CLAMP_ADDRESSMODE,O.WRAP_ADDRESSMODE=C.a.TEXTURE_WRAP_ADDRESSMODE,O.MIRROR_ADDRESSMODE=C.a.TEXTURE_MIRROR_ADDRESSMODE,O.UseSerializedUrlIfAny=!1,Object(E.c)([Object(m.c)()],O.prototype,"url",void 0),Object(E.c)([Object(m.c)()],O.prototype,"uOffset",void 0),Object(E.c)([Object(m.c)()],O.prototype,"vOffset",void 0),Object(E.c)([Object(m.c)()],O.prototype,"uScale",void 0),Object(E.c)([Object(m.c)()],O.prototype,"vScale",void 0),Object(E.c)([Object(m.c)()],O.prototype,"uAng",void 0),Object(E.c)([Object(m.c)()],O.prototype,"vAng",void 0),Object(E.c)([Object(m.c)()],O.prototype,"wAng",void 0),Object(E.c)([Object(m.c)()],O.prototype,"uRotationCenter",void 0),Object(E.c)([Object(m.c)()],O.prototype,"vRotationCenter",void 0),Object(E.c)([Object(m.c)()],O.prototype,"wRotationCenter",void 0),Object(E.c)([Object(m.c)()],O.prototype,"homogeneousRotationInUVTransform",void 0),Object(E.c)([Object(m.c)()],O.prototype,"isBlocking",null),O}(M.a);I.a.RegisteredTypes["BABYLON.Texture"]=_,m.a._TextureParser=_.Parse},function(h,s,c){c.d(s,"a",function(){return E});var E=function(){function m(){}return m.GetClass=function(S){return this.RegisteredTypes&&this.RegisteredTypes[S]?this.RegisteredTypes[S]:null},m.RegisteredTypes={},m}()},function(h,s,c){c.d(s,"b",function(){return _}),c.d(s,"c",function(){return g}),c.d(s,"a",function(){return O});var E=c(6),m=c(38),S=c(8),d=c(41),M=c(57),C=c(21),I=c(49),b=c(22),p=c(56),x=c(145),P=c(104),A=c(122),T=c(120),_=function(){function R(){}return Object.defineProperty(R,"BaseUrl",{get:function(){return p.a.BaseUrl},set:function(N){p.a.BaseUrl=N},enumerable:!1,configurable:!0}),Object.defineProperty(R,"DefaultRetryStrategy",{get:function(){return p.a.DefaultRetryStrategy},set:function(N){p.a.DefaultRetryStrategy=N},enumerable:!1,configurable:!0}),Object.defineProperty(R,"CorsBehavior",{get:function(){return p.a.CorsBehavior},set:function(N){p.a.CorsBehavior=N},enumerable:!1,configurable:!0}),Object.defineProperty(R,"UseFallbackTexture",{get:function(){return b.a.UseFallbackTexture},set:function(N){b.a.UseFallbackTexture=N},enumerable:!1,configurable:!0}),Object.defineProperty(R,"RegisteredExternalClasses",{get:function(){return A.a.RegisteredExternalClasses},set:function(N){A.a.RegisteredExternalClasses=N},enumerable:!1,configurable:!0}),Object.defineProperty(R,"fallbackTexture",{get:function(){return b.a.FallbackTexture},set:function(N){b.a.FallbackTexture=N},enumerable:!1,configurable:!0}),R.FetchToRef=function(N,V,U,L,j,Y){var W=4*((Math.abs(N)*U%U|0)+(Math.abs(V)*L%L|0)*U);Y.r=j[W]/255,Y.g=j[W+1]/255,Y.b=j[W+2]/255,Y.a=j[W+3]/255},R.Mix=function(N,V,U){return N*(1-U)+V*U},R.Instantiate=function(N){return A.a.Instantiate(N)},R.Slice=function(N,V,U){return N.slice?N.slice(V,U):Array.prototype.slice.call(N,V,U)},R.SliceToArray=function(N,V,U){return Array.isArray(N)?N.slice(V,U):Array.prototype.slice.call(N,V,U)},R.SetImmediate=function(N){P.a.SetImmediate(N)},R.IsExponentOfTwo=function(N){var V=1;do V*=2;while(V<N);return V===N},R.FloatRound=function(N){return Math.fround?Math.fround(N):R._tmpFloatArray[0]=N},R.GetFilename=function(N){var V=N.lastIndexOf("/");return V<0?N:N.substring(V+1)},R.GetFolderPath=function(N,V){V===void 0&&(V=!1);var U=N.lastIndexOf("/");return U<0?V?N:"":N.substring(0,U+1)},R.ToDegrees=function(N){return 180*N/Math.PI},R.ToRadians=function(N){return N*Math.PI/180},R.MakeArray=function(N,V){return V===!0||N!==void 0&&N!=null?Array.isArray(N)?N:[N]:null},R.GetPointerPrefix=function(N){var V="pointer";return m.a.IsWindowObjectExist()&&!window.PointerEvent&&m.a.IsNavigatorAvailable()&&!navigator.pointerEnabled&&(V="mouse"),!N._badDesktopOS||N._badOS||document&&"ontouchend"in document||(V="mouse"),V},R.SetCorsBehavior=function(N,V){p.a.SetCorsBehavior(N,V)},R.CleanUrl=function(N){return N=N.replace(/#/gm,"%23")},Object.defineProperty(R,"PreprocessUrl",{get:function(){return p.a.PreprocessUrl},set:function(N){p.a.PreprocessUrl=N},enumerable:!1,configurable:!0}),R.LoadImage=function(N,V,U,L,j){return p.a.LoadImage(N,V,U,L,j)},R.LoadFile=function(N,V,U,L,j,Y){return p.a.LoadFile(N,V,U,L,j,Y)},R.LoadFileAsync=function(N,V){return V===void 0&&(V=!0),new Promise(function(U,L){p.a.LoadFile(N,function(j){U(j)},void 0,void 0,V,function(j,Y){L(Y)})})},R.LoadScript=function(N,V,U,L){if(m.a.IsWindowObjectExist()){var j=document.getElementsByTagName("head")[0],Y=document.createElement("script");Y.setAttribute("type","text/javascript"),Y.setAttribute("src",N),L&&(Y.id=L),Y.onload=function(){V&&V()},Y.onerror=function(W){U&&U("Unable to load script '"+N+"'",W)},j.appendChild(Y)}},R.LoadScriptAsync=function(N,V){var U=this;return new Promise(function(L,j){U.LoadScript(N,function(){L()},function(Y,W){j(W)})})},R.ReadFileAsDataURL=function(N,V,U){var L=new FileReader,j={onCompleteObservable:new E.c,abort:function(){return L.abort()}};return L.onloadend=function(Y){j.onCompleteObservable.notifyObservers(j)},L.onload=function(Y){V(Y.target.result)},L.onprogress=U,L.readAsDataURL(N),j},R.ReadFile=function(N,V,U,L,j){return p.a.ReadFile(N,V,U,L,j)},R.FileAsURL=function(N){var V=new Blob([N]);return(window.URL||window.webkitURL).createObjectURL(V)},R.Format=function(N,V){return V===void 0&&(V=2),N.toFixed(V)},R.DeepCopy=function(N,V,U,L){d.a.DeepCopy(N,V,U,L)},R.IsEmpty=function(N){for(var V in N)if(N.hasOwnProperty(V))return!1;return!0},R.RegisterTopRootEvents=function(N,V){for(var U=0;U<V.length;U++){var L=V[U];N.addEventListener(L.name,L.handler,!1);try{window.parent&&window.parent.addEventListener(L.name,L.handler,!1)}catch(j){}}},R.UnregisterTopRootEvents=function(N,V){for(var U=0;U<V.length;U++){var L=V[U];N.removeEventListener(L.name,L.handler);try{N.parent&&N.parent.removeEventListener(L.name,L.handler)}catch(j){}}},R.DumpFramebuffer=function(N,V,U,L,j,Y){j===void 0&&(j="image/png");for(var W=4*N,re=V/2,ne=U.readPixels(0,0,N,V),ge=0;ge<re;ge++)for(var _e=0;_e<W;_e++){var ce=_e+ge*W,ie=_e+(V-ge-1)*W,Z=ne[ce];ne[ce]=ne[ie],ne[ie]=Z}R._ScreenshotCanvas||(R._ScreenshotCanvas=document.createElement("canvas")),R._ScreenshotCanvas.width=N,R._ScreenshotCanvas.height=V;var te=R._ScreenshotCanvas.getContext("2d");if(te){var B=te.createImageData(N,V);B.data.set(ne),te.putImageData(B,0,0),R.EncodeScreenshotCanvasData(L,j,Y)}},R.ToBlob=function(N,V,U){U===void 0&&(U="image/png"),N.toBlob||(N.toBlob=function(L,j,Y){var W=this;setTimeout(function(){for(var re=atob(W.toDataURL(j,Y).split(",")[1]),ne=re.length,ge=new Uint8Array(ne),_e=0;_e<ne;_e++)ge[_e]=re.charCodeAt(_e);L(new Blob([ge]))})}),N.toBlob(function(L){V(L)},U)},R.EncodeScreenshotCanvasData=function(N,V,U){V===void 0&&(V="image/png"),N?N(R._ScreenshotCanvas.toDataURL(V)):this.ToBlob(R._ScreenshotCanvas,function(L){if("download"in document.createElement("a")){if(!U){var j=new Date,Y=(j.getFullYear()+"-"+(j.getMonth()+1)).slice(2)+"-"+j.getDate()+"_"+j.getHours()+"-"+("0"+j.getMinutes()).slice(-2);U="screenshot_"+Y+".png"}R.Download(L,U)}else{var W=URL.createObjectURL(L),re=window.open("");if(!re)return;var ne=re.document.createElement("img");ne.onload=function(){URL.revokeObjectURL(W)},ne.src=W,re.document.body.appendChild(ne)}},V)},R.Download=function(N,V){if(navigator&&navigator.msSaveBlob)navigator.msSaveBlob(N,V);else{var U=window.URL.createObjectURL(N),L=document.createElement("a");document.body.appendChild(L),L.style.display="none",L.href=U,L.download=V,L.addEventListener("click",function(){L.parentElement&&L.parentElement.removeChild(L)}),L.click(),window.URL.revokeObjectURL(U)}},R.BackCompatCameraNoPreventDefault=function(N){return typeof N[0]=="boolean"?N[0]:typeof N[1]=="boolean"&&N[1]},R.CreateScreenshot=function(N,V,U,L,j){throw C.a.WarnImport("ScreenshotTools")},R.CreateScreenshotAsync=function(N,V,U,L){throw C.a.WarnImport("ScreenshotTools")},R.CreateScreenshotUsingRenderTarget=function(N,V,U,L,j,Y,W,re){throw C.a.WarnImport("ScreenshotTools")},R.CreateScreenshotUsingRenderTargetAsync=function(N,V,U,L,j,Y,W){throw C.a.WarnImport("ScreenshotTools")},R.RandomId=function(){return T.a.RandomId()},R.IsBase64=function(N){return!(N.length<5)&&N.substr(0,5)==="data:"},R.DecodeBase64=function(N){for(var V=atob(N.split(",")[1]),U=V.length,L=new Uint8Array(new ArrayBuffer(U)),j=0;j<U;j++)L[j]=V.charCodeAt(j);return L.buffer},R.GetAbsoluteUrl=function(N){var V=document.createElement("a");return V.href=N,V.href},Object.defineProperty(R,"errorsCount",{get:function(){return S.a.errorsCount},enumerable:!1,configurable:!0}),R.Log=function(N){S.a.Log(N)},R.Warn=function(N){S.a.Warn(N)},R.Error=function(N){S.a.Error(N)},Object.defineProperty(R,"LogCache",{get:function(){return S.a.LogCache},enumerable:!1,configurable:!0}),R.ClearLogCache=function(){S.a.ClearLogCache()},Object.defineProperty(R,"LogLevels",{set:function(N){S.a.LogLevels=N},enumerable:!1,configurable:!0}),Object.defineProperty(R,"PerformanceLogLevel",{set:function(N){return(N&R.PerformanceUserMarkLogLevel)===R.PerformanceUserMarkLogLevel?(R.StartPerformanceCounter=R._StartUserMark,void(R.EndPerformanceCounter=R._EndUserMark)):(N&R.PerformanceConsoleLogLevel)===R.PerformanceConsoleLogLevel?(R.StartPerformanceCounter=R._StartPerformanceConsole,void(R.EndPerformanceCounter=R._EndPerformanceConsole)):(R.StartPerformanceCounter=R._StartPerformanceCounterDisabled,void(R.EndPerformanceCounter=R._EndPerformanceCounterDisabled))},enumerable:!1,configurable:!0}),R._StartPerformanceCounterDisabled=function(N,V){},R._EndPerformanceCounterDisabled=function(N,V){},R._StartUserMark=function(N,V){if(V===void 0&&(V=!0),!R._performance){if(!m.a.IsWindowObjectExist())return;R._performance=window.performance}V&&R._performance.mark&&R._performance.mark(N+"-Begin")},R._EndUserMark=function(N,V){V===void 0&&(V=!0),V&&R._performance.mark&&(R._performance.mark(N+"-End"),R._performance.measure(N,N+"-Begin",N+"-End"))},R._StartPerformanceConsole=function(N,V){V===void 0&&(V=!0),V&&(R._StartUserMark(N,V),console.time&&console.time(N))},R._EndPerformanceConsole=function(N,V){V===void 0&&(V=!0),V&&(R._EndUserMark(N,V),console.timeEnd(N))},Object.defineProperty(R,"Now",{get:function(){return M.a.Now},enumerable:!1,configurable:!0}),R.GetClassName=function(N,V){V===void 0&&(V=!1);var U=null;return!V&&N.getClassName?U=N.getClassName():(N instanceof Object&&(U=(V?N:Object.getPrototypeOf(N)).constructor.__bjsclassName__),U||(U=typeof N)),U},R.First=function(N,V){for(var U=0,L=N;U<L.length;U++){var j=L[U];if(V(j))return j}return null},R.getFullClassName=function(N,V){V===void 0&&(V=!1);var U=null,L=null;if(!V&&N.getClassName)U=N.getClassName();else{if(N instanceof Object){var j=V?N:Object.getPrototypeOf(N);U=j.constructor.__bjsclassName__,L=j.constructor.__bjsmoduleName__}U||(U=typeof N)}return U?(L!=null?L+".":"")+U:null},R.DelayAsync=function(N){return new Promise(function(V){setTimeout(function(){V()},N)})},R.IsSafari=function(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)},R.UseCustomRequestHeaders=!1,R.CustomRequestHeaders=I.a.CustomRequestHeaders,R._tmpFloatArray=new Float32Array(1),R.GetDOMTextContent=m.a.GetDOMTextContent,R.NoneLogLevel=S.a.NoneLogLevel,R.MessageLogLevel=S.a.MessageLogLevel,R.WarningLogLevel=S.a.WarningLogLevel,R.ErrorLogLevel=S.a.ErrorLogLevel,R.AllLogLevel=S.a.AllLogLevel,R.IsWindowObjectExist=m.a.IsWindowObjectExist,R.PerformanceNoneLogLevel=0,R.PerformanceUserMarkLogLevel=1,R.PerformanceConsoleLogLevel=2,R.StartPerformanceCounter=R._StartPerformanceCounterDisabled,R.EndPerformanceCounter=R._EndPerformanceCounterDisabled,R}();function g(R,N){return function(V){V.__bjsclassName__=R,V.__bjsmoduleName__=N??null}}var O=function(){function R(N,V,U,L){L===void 0&&(L=0),this.iterations=N,this.index=L-1,this._done=!1,this._fn=V,this._successCallback=U}return R.prototype.executeNext=function(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())},R.prototype.breakLoop=function(){this._done=!0,this._successCallback()},R.Run=function(N,V,U,L){L===void 0&&(L=0);var j=new R(N,V,U,L);return j.executeNext(),j},R.SyncAsyncForLoop=function(N,V,U,L,j,Y){return Y===void 0&&(Y=0),R.Run(Math.ceil(N/V),function(W){j&&j()?W.breakLoop():setTimeout(function(){for(var re=0;re<V;++re){var ne=W.index*V+re;if(ne>=N)break;if(U(ne),j&&j()){W.breakLoop();break}}W.executeNext()},Y)},L)},R}();b.a.FallbackTexture="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z",x.a.Apply()},function(h,s,c){c.d(s,"a",function(){return A});var E=c(1),m=c(6),S=c(38),d=c(22),M=c(21),C=c(26),I=c(2),b=c(146),p=c(55),x=c(88),P=c(8),A=(c(123),c(129),c(124),function(T){function _(g,O,R,N){N===void 0&&(N=!1);var V=T.call(this,g,O,R,N)||this;if(V.enableOfflineSupport=!1,V.disableManifestCheck=!1,V.scenes=new Array,V.onNewSceneAddedObservable=new m.c,V.postProcesses=new Array,V.isPointerLock=!1,V.onResizeObservable=new m.c,V.onCanvasBlurObservable=new m.c,V.onCanvasFocusObservable=new m.c,V.onCanvasPointerOutObservable=new m.c,V.onBeginFrameObservable=new m.c,V.customAnimationFrameRequester=null,V.onEndFrameObservable=new m.c,V.onBeforeShaderCompilationObservable=new m.c,V.onAfterShaderCompilationObservable=new m.c,V._deterministicLockstep=!1,V._lockstepMaxSteps=4,V._timeStep=1/60,V._fps=60,V._deltaTime=0,V._drawCalls=new p.a,V.canvasTabIndex=1,V.disablePerformanceMonitorInBackground=!1,V._performanceMonitor=new b.a,_.Instances.push(V),!g)return V;if(R=V._creationOptions,g.getContext){var U=g;if(V._onCanvasFocus=function(){V.onCanvasFocusObservable.notifyObservers(V)},V._onCanvasBlur=function(){V.onCanvasBlurObservable.notifyObservers(V)},U.addEventListener("focus",V._onCanvasFocus),U.addEventListener("blur",V._onCanvasBlur),V._onBlur=function(){V.disablePerformanceMonitorInBackground&&V._performanceMonitor.disable(),V._windowIsBackground=!0},V._onFocus=function(){V.disablePerformanceMonitorInBackground&&V._performanceMonitor.enable(),V._windowIsBackground=!1},V._onCanvasPointerOut=function(Y){V.onCanvasPointerOutObservable.notifyObservers(Y)},U.addEventListener("pointerout",V._onCanvasPointerOut),S.a.IsWindowObjectExist()){var L=V.getHostWindow();L.addEventListener("blur",V._onBlur),L.addEventListener("focus",V._onFocus);var j=document;V._onFullscreenChange=function(){j.fullscreen!==void 0?V.isFullscreen=j.fullscreen:j.mozFullScreen!==void 0?V.isFullscreen=j.mozFullScreen:j.webkitIsFullScreen!==void 0?V.isFullscreen=j.webkitIsFullScreen:j.msIsFullScreen!==void 0&&(V.isFullscreen=j.msIsFullScreen),V.isFullscreen&&V._pointerLockRequested&&U&&_._RequestPointerlock(U)},document.addEventListener("fullscreenchange",V._onFullscreenChange,!1),document.addEventListener("mozfullscreenchange",V._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",V._onFullscreenChange,!1),document.addEventListener("msfullscreenchange",V._onFullscreenChange,!1),V._onPointerLockChange=function(){V.isPointerLock=j.mozPointerLockElement===U||j.webkitPointerLockElement===U||j.msPointerLockElement===U||j.pointerLockElement===U},document.addEventListener("pointerlockchange",V._onPointerLockChange,!1),document.addEventListener("mspointerlockchange",V._onPointerLockChange,!1),document.addEventListener("mozpointerlockchange",V._onPointerLockChange,!1),document.addEventListener("webkitpointerlockchange",V._onPointerLockChange,!1),!_.audioEngine&&R.audioEngine&&_.AudioEngineFactory&&(_.audioEngine=_.AudioEngineFactory(V.getRenderingCanvas()))}V._connectVREvents(),V.enableOfflineSupport=_.OfflineProviderFactory!==void 0,R.doNotHandleTouchAction||V._disableTouchAction(),V._deterministicLockstep=!!R.deterministicLockstep,V._lockstepMaxSteps=R.lockstepMaxSteps||0,V._timeStep=R.timeStep||1/60}return V._prepareVRComponent(),R.autoEnableWebVR&&V.initWebVR(),V}return Object(E.d)(_,T),Object.defineProperty(_,"NpmPackage",{get:function(){return C.a.NpmPackage},enumerable:!1,configurable:!0}),Object.defineProperty(_,"Version",{get:function(){return C.a.Version},enumerable:!1,configurable:!0}),Object.defineProperty(_,"Instances",{get:function(){return d.a.Instances},enumerable:!1,configurable:!0}),Object.defineProperty(_,"LastCreatedEngine",{get:function(){return d.a.LastCreatedEngine},enumerable:!1,configurable:!0}),Object.defineProperty(_,"LastCreatedScene",{get:function(){return d.a.LastCreatedScene},enumerable:!1,configurable:!0}),_.MarkAllMaterialsAsDirty=function(g,O){for(var R=0;R<_.Instances.length;R++)for(var N=_.Instances[R],V=0;V<N.scenes.length;V++)N.scenes[V].markAllMaterialsAsDirty(g,O)},_.DefaultLoadingScreenFactory=function(g){throw M.a.WarnImport("LoadingScreen")},Object.defineProperty(_.prototype,"_supportsHardwareTextureRescaling",{get:function(){return!!_._RescalePostProcessFactory},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"performanceMonitor",{get:function(){return this._performanceMonitor},enumerable:!1,configurable:!0}),_.prototype.getInputElement=function(){return this._renderingCanvas},_.prototype.getAspectRatio=function(g,O){O===void 0&&(O=!1);var R=g.viewport;return this.getRenderWidth(O)*R.width/(this.getRenderHeight(O)*R.height)},_.prototype.getScreenAspectRatio=function(){return this.getRenderWidth(!0)/this.getRenderHeight(!0)},_.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas?this._renderingCanvas.getBoundingClientRect():null},_.prototype.getInputElementClientRect=function(){return this._renderingCanvas?this.getInputElement().getBoundingClientRect():null},_.prototype.isDeterministicLockStep=function(){return this._deterministicLockstep},_.prototype.getLockstepMaxSteps=function(){return this._lockstepMaxSteps},_.prototype.getTimeStep=function(){return 1e3*this._timeStep},_.prototype.generateMipMapsForCubemap=function(g,O){if(O===void 0&&(O=!0),g.generateMipMaps){var R=this._gl;this._bindTextureDirectly(R.TEXTURE_CUBE_MAP,g,!0),R.generateMipmap(R.TEXTURE_CUBE_MAP),O&&this._bindTextureDirectly(R.TEXTURE_CUBE_MAP,null)}},_.prototype.setState=function(g,O,R,N){O===void 0&&(O=0),N===void 0&&(N=!1),(this._depthCullingState.cull!==g||R)&&(this._depthCullingState.cull=g);var V=this.cullBackFaces?this._gl.BACK:this._gl.FRONT;(this._depthCullingState.cullFace!==V||R)&&(this._depthCullingState.cullFace=V),this.setZOffset(O);var U=N?this._gl.CW:this._gl.CCW;(this._depthCullingState.frontFace!==U||R)&&(this._depthCullingState.frontFace=U)},_.prototype.setZOffset=function(g){this._depthCullingState.zOffset=g},_.prototype.getZOffset=function(){return this._depthCullingState.zOffset},_.prototype.setDepthBuffer=function(g){this._depthCullingState.depthTest=g},_.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},_.prototype.setDepthWrite=function(g){this._depthCullingState.depthMask=g},_.prototype.getStencilBuffer=function(){return this._stencilState.stencilTest},_.prototype.setStencilBuffer=function(g){this._stencilState.stencilTest=g},_.prototype.getStencilMask=function(){return this._stencilState.stencilMask},_.prototype.setStencilMask=function(g){this._stencilState.stencilMask=g},_.prototype.getStencilFunction=function(){return this._stencilState.stencilFunc},_.prototype.getStencilFunctionReference=function(){return this._stencilState.stencilFuncRef},_.prototype.getStencilFunctionMask=function(){return this._stencilState.stencilFuncMask},_.prototype.setStencilFunction=function(g){this._stencilState.stencilFunc=g},_.prototype.setStencilFunctionReference=function(g){this._stencilState.stencilFuncRef=g},_.prototype.setStencilFunctionMask=function(g){this._stencilState.stencilFuncMask=g},_.prototype.getStencilOperationFail=function(){return this._stencilState.stencilOpStencilFail},_.prototype.getStencilOperationDepthFail=function(){return this._stencilState.stencilOpDepthFail},_.prototype.getStencilOperationPass=function(){return this._stencilState.stencilOpStencilDepthPass},_.prototype.setStencilOperationFail=function(g){this._stencilState.stencilOpStencilFail=g},_.prototype.setStencilOperationDepthFail=function(g){this._stencilState.stencilOpDepthFail=g},_.prototype.setStencilOperationPass=function(g){this._stencilState.stencilOpStencilDepthPass=g},_.prototype.setDitheringState=function(g){g?this._gl.enable(this._gl.DITHER):this._gl.disable(this._gl.DITHER)},_.prototype.setRasterizerState=function(g){g?this._gl.disable(this._gl.RASTERIZER_DISCARD):this._gl.enable(this._gl.RASTERIZER_DISCARD)},_.prototype.getDepthFunction=function(){return this._depthCullingState.depthFunc},_.prototype.setDepthFunction=function(g){this._depthCullingState.depthFunc=g},_.prototype.setDepthFunctionToGreater=function(){this._depthCullingState.depthFunc=this._gl.GREATER},_.prototype.setDepthFunctionToGreaterOrEqual=function(){this._depthCullingState.depthFunc=this._gl.GEQUAL},_.prototype.setDepthFunctionToLess=function(){this._depthCullingState.depthFunc=this._gl.LESS},_.prototype.setDepthFunctionToLessOrEqual=function(){this._depthCullingState.depthFunc=this._gl.LEQUAL},_.prototype.cacheStencilState=function(){this._cachedStencilBuffer=this.getStencilBuffer(),this._cachedStencilFunction=this.getStencilFunction(),this._cachedStencilMask=this.getStencilMask(),this._cachedStencilOperationPass=this.getStencilOperationPass(),this._cachedStencilOperationFail=this.getStencilOperationFail(),this._cachedStencilOperationDepthFail=this.getStencilOperationDepthFail(),this._cachedStencilReference=this.getStencilFunctionReference()},_.prototype.restoreStencilState=function(){this.setStencilFunction(this._cachedStencilFunction),this.setStencilMask(this._cachedStencilMask),this.setStencilBuffer(this._cachedStencilBuffer),this.setStencilOperationPass(this._cachedStencilOperationPass),this.setStencilOperationFail(this._cachedStencilOperationFail),this.setStencilOperationDepthFail(this._cachedStencilOperationDepthFail),this.setStencilFunctionReference(this._cachedStencilReference)},_.prototype.setDirectViewport=function(g,O,R,N){var V=this._cachedViewport;return this._cachedViewport=null,this._viewport(g,O,R,N),V},_.prototype.scissorClear=function(g,O,R,N,V){this.enableScissor(g,O,R,N),this.clear(V,!0,!0,!0),this.disableScissor()},_.prototype.enableScissor=function(g,O,R,N){var V=this._gl;V.enable(V.SCISSOR_TEST),V.scissor(g,O,R,N)},_.prototype.disableScissor=function(){var g=this._gl;g.disable(g.SCISSOR_TEST)},_.prototype._reportDrawCall=function(){this._drawCalls.addCount(1,!1)},_.prototype.initWebVR=function(){throw M.a.WarnImport("WebVRCamera")},_.prototype._prepareVRComponent=function(){},_.prototype._connectVREvents=function(g,O){},_.prototype._submitVRFrame=function(){},_.prototype.disableVR=function(){},_.prototype.isVRPresenting=function(){return!1},_.prototype._requestVRFrame=function(){},_.prototype._loadFileAsync=function(g,O,R){var N=this;return new Promise(function(V,U){N._loadFile(g,function(L){V(L)},void 0,O,R,function(L,j){U(j)})})},_.prototype.getVertexShaderSource=function(g){var O=this._gl.getAttachedShaders(g);return O?this._gl.getShaderSource(O[0]):null},_.prototype.getFragmentShaderSource=function(g){var O=this._gl.getAttachedShaders(g);return O?this._gl.getShaderSource(O[1]):null},_.prototype.setDepthStencilTexture=function(g,O,R){g!==void 0&&(O&&(this._boundUniforms[g]=O),R&&R.depthStencilTexture?this._setTexture(g,R,!1,!0):this._setTexture(g,null))},_.prototype.setTextureFromPostProcess=function(g,O){this._bindTexture(g,O?O._textures.data[O._currentRenderTextureInd]:null)},_.prototype.setTextureFromPostProcessOutput=function(g,O){this._bindTexture(g,O?O._outputTexture:null)},_.prototype._rebuildBuffers=function(){for(var g=0,O=this.scenes;g<O.length;g++){var R=O[g];R.resetCachedMaterial(),R._rebuildGeometries(),R._rebuildTextures()}T.prototype._rebuildBuffers.call(this)},_.prototype._renderFrame=function(){for(var g=0;g<this._activeRenderLoops.length;g++)(0,this._activeRenderLoops[g])()},_.prototype._renderLoop=function(){if(!this._contextWasLost){var g=!0;!this.renderEvenInBackground&&this._windowIsBackground&&(g=!1),g&&(this.beginFrame(),this._renderViews()||this._renderFrame(),this.endFrame())}this._activeRenderLoops.length>0?this.customAnimationFrameRequester?(this.customAnimationFrameRequester.requestID=this._queueNewFrame(this.customAnimationFrameRequester.renderFunction||this._boundRenderFunction,this.customAnimationFrameRequester),this._frameHandler=this.customAnimationFrameRequester.requestID):this.isVRPresenting()?this._requestVRFrame():this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()):this._renderingQueueLaunched=!1},_.prototype._renderViews=function(){return!1},_.prototype.switchFullscreen=function(g){this.isFullscreen?this.exitFullscreen():this.enterFullscreen(g)},_.prototype.enterFullscreen=function(g){this.isFullscreen||(this._pointerLockRequested=g,this._renderingCanvas&&_._RequestFullscreen(this._renderingCanvas))},_.prototype.exitFullscreen=function(){this.isFullscreen&&_._ExitFullscreen()},_.prototype.enterPointerlock=function(){this._renderingCanvas&&_._RequestPointerlock(this._renderingCanvas)},_.prototype.exitPointerlock=function(){_._ExitPointerlock()},_.prototype.beginFrame=function(){this._measureFps(),this.onBeginFrameObservable.notifyObservers(this),T.prototype.beginFrame.call(this)},_.prototype.endFrame=function(){T.prototype.endFrame.call(this),this._submitVRFrame(),this.onEndFrameObservable.notifyObservers(this)},_.prototype.resize=function(){this.isVRPresenting()||T.prototype.resize.call(this)},_.prototype.setSize=function(g,O){if(!this._renderingCanvas||!T.prototype.setSize.call(this,g,O))return!1;if(this.scenes){for(var R=0;R<this.scenes.length;R++)for(var N=this.scenes[R],V=0;V<N.cameras.length;V++)N.cameras[V]._currentRenderId=0;this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this)}return!0},_.prototype._deletePipelineContext=function(g){var O=g;O&&O.program&&O.transformFeedback&&(this.deleteTransformFeedback(O.transformFeedback),O.transformFeedback=null),T.prototype._deletePipelineContext.call(this,g)},_.prototype.createShaderProgram=function(g,O,R,N,V,U){U===void 0&&(U=null),V=V||this._gl,this.onBeforeShaderCompilationObservable.notifyObservers(this);var L=T.prototype.createShaderProgram.call(this,g,O,R,N,V,U);return this.onAfterShaderCompilationObservable.notifyObservers(this),L},_.prototype._createShaderProgram=function(g,O,R,N,V){V===void 0&&(V=null);var U=N.createProgram();if(g.program=U,!U)throw new Error("Unable to create program");if(N.attachShader(U,O),N.attachShader(U,R),this.webGLVersion>1&&V){var L=this.createTransformFeedback();this.bindTransformFeedback(L),this.setTranformFeedbackVaryings(U,V),g.transformFeedback=L}return N.linkProgram(U),this.webGLVersion>1&&V&&this.bindTransformFeedback(null),g.context=N,g.vertexShader=O,g.fragmentShader=R,g.isParallelCompiled||this._finalizePipelineContext(g),U},_.prototype._releaseTexture=function(g){T.prototype._releaseTexture.call(this,g),this.scenes.forEach(function(O){O.postProcesses.forEach(function(R){R._outputTexture==g&&(R._outputTexture=null)}),O.cameras.forEach(function(R){R._postProcesses.forEach(function(N){N&&N._outputTexture==g&&(N._outputTexture=null)})})})},_.prototype._rescaleTexture=function(g,O,R,N,V){var U=this;this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);var L=this.createRenderTargetTexture({width:O.width,height:O.height},{generateMipMaps:!1,type:I.a.TEXTURETYPE_UNSIGNED_INT,samplingMode:I.a.TEXTURE_BILINEAR_SAMPLINGMODE,generateDepthBuffer:!1,generateStencilBuffer:!1});!this._rescalePostProcess&&_._RescalePostProcessFactory&&(this._rescalePostProcess=_._RescalePostProcessFactory(this)),this._rescalePostProcess.getEffect().executeWhenCompiled(function(){U._rescalePostProcess.onApply=function(Y){Y._bindTexture("textureSampler",g)};var j=R;j||(j=U.scenes[U.scenes.length-1]),j.postProcessManager.directRender([U._rescalePostProcess],L,!0),U._bindTextureDirectly(U._gl.TEXTURE_2D,O,!0),U._gl.copyTexImage2D(U._gl.TEXTURE_2D,0,N,0,0,O.width,O.height,0),U.unBindFramebuffer(L),U._releaseTexture(L),V&&V()})},_.prototype.getFps=function(){return this._fps},_.prototype.getDeltaTime=function(){return this._deltaTime},_.prototype._measureFps=function(){this._performanceMonitor.sampleFrame(),this._fps=this._performanceMonitor.averageFPS,this._deltaTime=this._performanceMonitor.instantaneousFrameTime||0},_.prototype._uploadImageToTexture=function(g,O,R,N){R===void 0&&(R=0),N===void 0&&(N=0);var V=this._gl,U=this._getWebGLTextureType(g.type),L=this._getInternalFormat(g.format),j=this._getRGBABufferInternalSizedFormat(g.type,L),Y=g.isCube?V.TEXTURE_CUBE_MAP:V.TEXTURE_2D;this._bindTextureDirectly(Y,g,!0),this._unpackFlipY(g.invertY);var W=V.TEXTURE_2D;g.isCube&&(W=V.TEXTURE_CUBE_MAP_POSITIVE_X+R),V.texImage2D(W,N,j,L,U,O),this._bindTextureDirectly(Y,null,!0)},_.prototype.updateRenderTargetTextureSampleCount=function(g,O){if(this.webGLVersion<2||!g)return 1;if(g.samples===O)return O;var R=this._gl;if(O=Math.min(O,this.getCaps().maxMSAASamples),g._depthStencilBuffer&&(R.deleteRenderbuffer(g._depthStencilBuffer),g._depthStencilBuffer=null),g._MSAAFramebuffer&&(R.deleteFramebuffer(g._MSAAFramebuffer),g._MSAAFramebuffer=null),g._MSAARenderBuffer&&(R.deleteRenderbuffer(g._MSAARenderBuffer),g._MSAARenderBuffer=null),O>1&&R.renderbufferStorageMultisample){var N=R.createFramebuffer();if(!N)throw new Error("Unable to create multi sampled framebuffer");g._MSAAFramebuffer=N,this._bindUnboundFramebuffer(g._MSAAFramebuffer);var V=R.createRenderbuffer();if(!V)throw new Error("Unable to create multi sampled framebuffer");R.bindRenderbuffer(R.RENDERBUFFER,V),R.renderbufferStorageMultisample(R.RENDERBUFFER,O,this._getRGBAMultiSampleBufferFormat(g.type),g.width,g.height),R.framebufferRenderbuffer(R.FRAMEBUFFER,R.COLOR_ATTACHMENT0,R.RENDERBUFFER,V),g._MSAARenderBuffer=V}else this._bindUnboundFramebuffer(g._framebuffer);return g.samples=O,g._depthStencilBuffer=this._setupFramebufferDepthAttachments(g._generateStencilBuffer,g._generateDepthBuffer,g.width,g.height,O),this._bindUnboundFramebuffer(null),O},_.prototype.updateTextureComparisonFunction=function(g,O){if(this.webGLVersion!==1){var R=this._gl;g.isCube?(this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,g,!0),O===0?(R.texParameteri(R.TEXTURE_CUBE_MAP,R.TEXTURE_COMPARE_FUNC,I.a.LEQUAL),R.texParameteri(R.TEXTURE_CUBE_MAP,R.TEXTURE_COMPARE_MODE,R.NONE)):(R.texParameteri(R.TEXTURE_CUBE_MAP,R.TEXTURE_COMPARE_FUNC,O),R.texParameteri(R.TEXTURE_CUBE_MAP,R.TEXTURE_COMPARE_MODE,R.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):(this._bindTextureDirectly(this._gl.TEXTURE_2D,g,!0),O===0?(R.texParameteri(R.TEXTURE_2D,R.TEXTURE_COMPARE_FUNC,I.a.LEQUAL),R.texParameteri(R.TEXTURE_2D,R.TEXTURE_COMPARE_MODE,R.NONE)):(R.texParameteri(R.TEXTURE_2D,R.TEXTURE_COMPARE_FUNC,O),R.texParameteri(R.TEXTURE_2D,R.TEXTURE_COMPARE_MODE,R.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),g._comparisonFunction=O}else P.a.Error("WebGL 1 does not support texture comparison.")},_.prototype.createInstancesBuffer=function(g){var O=this._gl.createBuffer();if(!O)throw new Error("Unable to create instance buffer");var R=new x.a(O);return R.capacity=g,this.bindArrayBuffer(R),this._gl.bufferData(this._gl.ARRAY_BUFFER,g,this._gl.DYNAMIC_DRAW),R},_.prototype.deleteInstancesBuffer=function(g){this._gl.deleteBuffer(g)},_.prototype._clientWaitAsync=function(g,O,R){O===void 0&&(O=0),R===void 0&&(R=10);var N=this._gl;return new Promise(function(V,U){var L=function(){var j=N.clientWaitSync(g,O,0);j!=N.WAIT_FAILED?j!=N.TIMEOUT_EXPIRED?V():setTimeout(L,R):U()};L()})},_.prototype._readPixelsAsync=function(g,O,R,N,V,U,L){if(this._webGLVersion<2)throw new Error("_readPixelsAsync only work on WebGL2+");var j=this._gl,Y=j.createBuffer();j.bindBuffer(j.PIXEL_PACK_BUFFER,Y),j.bufferData(j.PIXEL_PACK_BUFFER,L.byteLength,j.STREAM_READ),j.readPixels(g,O,R,N,V,U,0),j.bindBuffer(j.PIXEL_PACK_BUFFER,null);var W=j.fenceSync(j.SYNC_GPU_COMMANDS_COMPLETE,0);return W?(j.flush(),this._clientWaitAsync(W,0,10).then(function(){return j.deleteSync(W),j.bindBuffer(j.PIXEL_PACK_BUFFER,Y),j.getBufferSubData(j.PIXEL_PACK_BUFFER,0,L),j.bindBuffer(j.PIXEL_PACK_BUFFER,null),j.deleteBuffer(Y),L})):null},_.prototype.dispose=function(){for(this.hideLoadingUI(),this.onNewSceneAddedObservable.clear();this.postProcesses.length;)this.postProcesses[0].dispose();for(this._rescalePostProcess&&this._rescalePostProcess.dispose();this.scenes.length;)this.scenes[0].dispose();_.Instances.length===1&&_.audioEngine&&_.audioEngine.dispose(),this.disableVR(),S.a.IsWindowObjectExist()&&(window.removeEventListener("blur",this._onBlur),window.removeEventListener("focus",this._onFocus),this._renderingCanvas&&(this._renderingCanvas.removeEventListener("focus",this._onCanvasFocus),this._renderingCanvas.removeEventListener("blur",this._onCanvasBlur),this._renderingCanvas.removeEventListener("pointerout",this._onCanvasPointerOut)),S.a.IsDocumentAvailable()&&(document.removeEventListener("fullscreenchange",this._onFullscreenChange),document.removeEventListener("mozfullscreenchange",this._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",this._onFullscreenChange),document.removeEventListener("msfullscreenchange",this._onFullscreenChange),document.removeEventListener("pointerlockchange",this._onPointerLockChange),document.removeEventListener("mspointerlockchange",this._onPointerLockChange),document.removeEventListener("mozpointerlockchange",this._onPointerLockChange),document.removeEventListener("webkitpointerlockchange",this._onPointerLockChange))),T.prototype.dispose.call(this);var g=_.Instances.indexOf(this);g>=0&&_.Instances.splice(g,1),this.onResizeObservable.clear(),this.onCanvasBlurObservable.clear(),this.onCanvasFocusObservable.clear(),this.onCanvasPointerOutObservable.clear(),this.onBeginFrameObservable.clear(),this.onEndFrameObservable.clear()},_.prototype._disableTouchAction=function(){this._renderingCanvas&&this._renderingCanvas.setAttribute&&(this._renderingCanvas.setAttribute("touch-action","none"),this._renderingCanvas.style.touchAction="none",this._renderingCanvas.style.msTouchAction="none")},_.prototype.displayLoadingUI=function(){if(S.a.IsWindowObjectExist()){var g=this.loadingScreen;g&&g.displayLoadingUI()}},_.prototype.hideLoadingUI=function(){if(S.a.IsWindowObjectExist()){var g=this._loadingScreen;g&&g.hideLoadingUI()}},Object.defineProperty(_.prototype,"loadingScreen",{get:function(){return!this._loadingScreen&&this._renderingCanvas&&(this._loadingScreen=_.DefaultLoadingScreenFactory(this._renderingCanvas)),this._loadingScreen},set:function(g){this._loadingScreen=g},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"loadingUIText",{set:function(g){this.loadingScreen.loadingUIText=g},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"loadingUIBackgroundColor",{set:function(g){this.loadingScreen.loadingUIBackgroundColor=g},enumerable:!1,configurable:!0}),_._RequestPointerlock=function(g){g.requestPointerLock=g.requestPointerLock||g.msRequestPointerLock||g.mozRequestPointerLock||g.webkitRequestPointerLock,g.requestPointerLock&&g.requestPointerLock()},_._ExitPointerlock=function(){var g=document;document.exitPointerLock=document.exitPointerLock||g.msExitPointerLock||g.mozExitPointerLock||g.webkitExitPointerLock,document.exitPointerLock&&document.exitPointerLock()},_._RequestFullscreen=function(g){var O=g.requestFullscreen||g.msRequestFullscreen||g.webkitRequestFullscreen||g.mozRequestFullScreen;O&&O.call(g)},_._ExitFullscreen=function(){var g=document;document.exitFullscreen?document.exitFullscreen():g.mozCancelFullScreen?g.mozCancelFullScreen():g.webkitCancelFullScreen?g.webkitCancelFullScreen():g.msCancelFullScreen&&g.msCancelFullScreen()},_.ALPHA_DISABLE=I.a.ALPHA_DISABLE,_.ALPHA_ADD=I.a.ALPHA_ADD,_.ALPHA_COMBINE=I.a.ALPHA_COMBINE,_.ALPHA_SUBTRACT=I.a.ALPHA_SUBTRACT,_.ALPHA_MULTIPLY=I.a.ALPHA_MULTIPLY,_.ALPHA_MAXIMIZED=I.a.ALPHA_MAXIMIZED,_.ALPHA_ONEONE=I.a.ALPHA_ONEONE,_.ALPHA_PREMULTIPLIED=I.a.ALPHA_PREMULTIPLIED,_.ALPHA_PREMULTIPLIED_PORTERDUFF=I.a.ALPHA_PREMULTIPLIED_PORTERDUFF,_.ALPHA_INTERPOLATE=I.a.ALPHA_INTERPOLATE,_.ALPHA_SCREENMODE=I.a.ALPHA_SCREENMODE,_.DELAYLOADSTATE_NONE=I.a.DELAYLOADSTATE_NONE,_.DELAYLOADSTATE_LOADED=I.a.DELAYLOADSTATE_LOADED,_.DELAYLOADSTATE_LOADING=I.a.DELAYLOADSTATE_LOADING,_.DELAYLOADSTATE_NOTLOADED=I.a.DELAYLOADSTATE_NOTLOADED,_.NEVER=I.a.NEVER,_.ALWAYS=I.a.ALWAYS,_.LESS=I.a.LESS,_.EQUAL=I.a.EQUAL,_.LEQUAL=I.a.LEQUAL,_.GREATER=I.a.GREATER,_.GEQUAL=I.a.GEQUAL,_.NOTEQUAL=I.a.NOTEQUAL,_.KEEP=I.a.KEEP,_.REPLACE=I.a.REPLACE,_.INCR=I.a.INCR,_.DECR=I.a.DECR,_.INVERT=I.a.INVERT,_.INCR_WRAP=I.a.INCR_WRAP,_.DECR_WRAP=I.a.DECR_WRAP,_.TEXTURE_CLAMP_ADDRESSMODE=I.a.TEXTURE_CLAMP_ADDRESSMODE,_.TEXTURE_WRAP_ADDRESSMODE=I.a.TEXTURE_WRAP_ADDRESSMODE,_.TEXTURE_MIRROR_ADDRESSMODE=I.a.TEXTURE_MIRROR_ADDRESSMODE,_.TEXTUREFORMAT_ALPHA=I.a.TEXTUREFORMAT_ALPHA,_.TEXTUREFORMAT_LUMINANCE=I.a.TEXTUREFORMAT_LUMINANCE,_.TEXTUREFORMAT_LUMINANCE_ALPHA=I.a.TEXTUREFORMAT_LUMINANCE_ALPHA,_.TEXTUREFORMAT_RGB=I.a.TEXTUREFORMAT_RGB,_.TEXTUREFORMAT_RGBA=I.a.TEXTUREFORMAT_RGBA,_.TEXTUREFORMAT_RED=I.a.TEXTUREFORMAT_RED,_.TEXTUREFORMAT_R=I.a.TEXTUREFORMAT_R,_.TEXTUREFORMAT_RG=I.a.TEXTUREFORMAT_RG,_.TEXTUREFORMAT_RED_INTEGER=I.a.TEXTUREFORMAT_RED_INTEGER,_.TEXTUREFORMAT_R_INTEGER=I.a.TEXTUREFORMAT_R_INTEGER,_.TEXTUREFORMAT_RG_INTEGER=I.a.TEXTUREFORMAT_RG_INTEGER,_.TEXTUREFORMAT_RGB_INTEGER=I.a.TEXTUREFORMAT_RGB_INTEGER,_.TEXTUREFORMAT_RGBA_INTEGER=I.a.TEXTUREFORMAT_RGBA_INTEGER,_.TEXTURETYPE_UNSIGNED_BYTE=I.a.TEXTURETYPE_UNSIGNED_BYTE,_.TEXTURETYPE_UNSIGNED_INT=I.a.TEXTURETYPE_UNSIGNED_INT,_.TEXTURETYPE_FLOAT=I.a.TEXTURETYPE_FLOAT,_.TEXTURETYPE_HALF_FLOAT=I.a.TEXTURETYPE_HALF_FLOAT,_.TEXTURETYPE_BYTE=I.a.TEXTURETYPE_BYTE,_.TEXTURETYPE_SHORT=I.a.TEXTURETYPE_SHORT,_.TEXTURETYPE_UNSIGNED_SHORT=I.a.TEXTURETYPE_UNSIGNED_SHORT,_.TEXTURETYPE_INT=I.a.TEXTURETYPE_INT,_.TEXTURETYPE_UNSIGNED_INTEGER=I.a.TEXTURETYPE_UNSIGNED_INTEGER,_.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=I.a.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4,_.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=I.a.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1,_.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=I.a.TEXTURETYPE_UNSIGNED_SHORT_5_6_5,_.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=I.a.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV,_.TEXTURETYPE_UNSIGNED_INT_24_8=I.a.TEXTURETYPE_UNSIGNED_INT_24_8,_.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=I.a.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV,_.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=I.a.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV,_.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=I.a.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV,_.TEXTURE_NEAREST_SAMPLINGMODE=I.a.TEXTURE_NEAREST_SAMPLINGMODE,_.TEXTURE_BILINEAR_SAMPLINGMODE=I.a.TEXTURE_BILINEAR_SAMPLINGMODE,_.TEXTURE_TRILINEAR_SAMPLINGMODE=I.a.TEXTURE_TRILINEAR_SAMPLINGMODE,_.TEXTURE_NEAREST_NEAREST_MIPLINEAR=I.a.TEXTURE_NEAREST_NEAREST_MIPLINEAR,_.TEXTURE_LINEAR_LINEAR_MIPNEAREST=I.a.TEXTURE_LINEAR_LINEAR_MIPNEAREST,_.TEXTURE_LINEAR_LINEAR_MIPLINEAR=I.a.TEXTURE_LINEAR_LINEAR_MIPLINEAR,_.TEXTURE_NEAREST_NEAREST_MIPNEAREST=I.a.TEXTURE_NEAREST_NEAREST_MIPNEAREST,_.TEXTURE_NEAREST_LINEAR_MIPNEAREST=I.a.TEXTURE_NEAREST_LINEAR_MIPNEAREST,_.TEXTURE_NEAREST_LINEAR_MIPLINEAR=I.a.TEXTURE_NEAREST_LINEAR_MIPLINEAR,_.TEXTURE_NEAREST_LINEAR=I.a.TEXTURE_NEAREST_LINEAR,_.TEXTURE_NEAREST_NEAREST=I.a.TEXTURE_NEAREST_NEAREST,_.TEXTURE_LINEAR_NEAREST_MIPNEAREST=I.a.TEXTURE_LINEAR_NEAREST_MIPNEAREST,_.TEXTURE_LINEAR_NEAREST_MIPLINEAR=I.a.TEXTURE_LINEAR_NEAREST_MIPLINEAR,_.TEXTURE_LINEAR_LINEAR=I.a.TEXTURE_LINEAR_LINEAR,_.TEXTURE_LINEAR_NEAREST=I.a.TEXTURE_LINEAR_NEAREST,_.TEXTURE_EXPLICIT_MODE=I.a.TEXTURE_EXPLICIT_MODE,_.TEXTURE_SPHERICAL_MODE=I.a.TEXTURE_SPHERICAL_MODE,_.TEXTURE_PLANAR_MODE=I.a.TEXTURE_PLANAR_MODE,_.TEXTURE_CUBIC_MODE=I.a.TEXTURE_CUBIC_MODE,_.TEXTURE_PROJECTION_MODE=I.a.TEXTURE_PROJECTION_MODE,_.TEXTURE_SKYBOX_MODE=I.a.TEXTURE_SKYBOX_MODE,_.TEXTURE_INVCUBIC_MODE=I.a.TEXTURE_INVCUBIC_MODE,_.TEXTURE_EQUIRECTANGULAR_MODE=I.a.TEXTURE_EQUIRECTANGULAR_MODE,_.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=I.a.TEXTURE_FIXED_EQUIRECTANGULAR_MODE,_.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=I.a.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE,_.SCALEMODE_FLOOR=I.a.SCALEMODE_FLOOR,_.SCALEMODE_NEAREST=I.a.SCALEMODE_NEAREST,_.SCALEMODE_CEILING=I.a.SCALEMODE_CEILING,_._RescalePostProcessFactory=null,_}(C.a))},function(h,s,c){c.d(s,"a",function(){return E});var E=function(){function m(){}return m.WithinEpsilon=function(S,d,M){M===void 0&&(M=1401298e-51);var C=S-d;return-M<=C&&C<=M},m.ToHex=function(S){var d=S.toString(16);return S<=15?("0"+d).toUpperCase():d.toUpperCase()},m.Sign=function(S){return(S=+S)==0||isNaN(S)?S:S>0?1:-1},m.Clamp=function(S,d,M){return d===void 0&&(d=0),M===void 0&&(M=1),Math.min(M,Math.max(d,S))},m.Log2=function(S){return Math.log(S)*Math.LOG2E},m.Repeat=function(S,d){return S-Math.floor(S/d)*d},m.Normalize=function(S,d,M){return(S-d)/(M-d)},m.Denormalize=function(S,d,M){return S*(M-d)+d},m.DeltaAngle=function(S,d){var M=m.Repeat(d-S,360);return M>180&&(M-=360),M},m.PingPong=function(S,d){var M=m.Repeat(S,2*d);return d-Math.abs(M-d)},m.SmoothStep=function(S,d,M){var C=m.Clamp(M);return d*(C=-2*C*C*C+3*C*C)+S*(1-C)},m.MoveTowards=function(S,d,M){return Math.abs(d-S)<=M?d:S+m.Sign(d-S)*M},m.MoveTowardsAngle=function(S,d,M){var C=m.DeltaAngle(S,d),I=0;return-M<C&&C<M?I=d:(d=S+C,I=m.MoveTowards(S,d,M)),I},m.Lerp=function(S,d,M){return S+(d-S)*M},m.LerpAngle=function(S,d,M){var C=m.Repeat(d-S,360);return C>180&&(C-=360),S+C*m.Clamp(M)},m.InverseLerp=function(S,d,M){return S!=d?m.Clamp((M-S)/(d-S)):0},m.Hermite=function(S,d,M,C,I){var b=I*I,p=I*b;return S*(2*p-3*b+1)+M*(-2*p+3*b)+d*(p-2*b+I)+C*(p-b)},m.RandomRange=function(S,d){return S===d?S:Math.random()*(d-S)+S},m.RangeToPercent=function(S,d,M){return(S-d)/(M-d)},m.PercentToRange=function(S,d,M){return(M-d)*S+d},m.NormalizeRadians=function(S){return S-=m.TwoPi*Math.floor((S+Math.PI)/m.TwoPi)},m.TwoPi=2*Math.PI,m}()},function(h,s,c){c.d(s,"a",function(){return p});var E=c(8),m=c(20),S=c(22),d=c(4),M=c(48),C=c(2),I=c(9),b=c(119),p=function(){function x(){}return x.BindEyePosition=function(P,A,T){if(T===void 0&&(T="vEyePosition"),A._forcedViewPosition)P.setVector3(T,A._forcedViewPosition);else{var _=A.activeCamera.globalPosition;_||(_=A.activeCamera.devicePosition),P.setVector3(T,A._mirroredCameraPosition?A._mirroredCameraPosition:_)}},x.PrepareDefinesForMergedUV=function(P,A,T){A._needUVs=!0,A[T]=!0,P.getTextureMatrix().isIdentityAs3x2()?(A[T+"DIRECTUV"]=P.coordinatesIndex+1,P.coordinatesIndex===0?A.MAINUV1=!0:A.MAINUV2=!0):A[T+"DIRECTUV"]=0},x.BindTextureMatrix=function(P,A,T){var _=P.getTextureMatrix();A.updateMatrix(T+"Matrix",_)},x.GetFogState=function(P,A){return A.fogEnabled&&P.applyFog&&A.fogMode!==m.a.FOGMODE_NONE},x.PrepareDefinesForMisc=function(P,A,T,_,g,O,R){R._areMiscDirty&&(R.LOGARITHMICDEPTH=T,R.POINTSIZE=_,R.FOG=g&&this.GetFogState(P,A),R.NONUNIFORMSCALING=P.nonUniformScaling,R.ALPHATEST=O)},x.PrepareDefinesForFrameBoundValues=function(P,A,T,_,g,O){g===void 0&&(g=null),O===void 0&&(O=!1);var R,N,V,U,L,j,Y=!1;R=g??(P.clipPlane!==void 0&&P.clipPlane!==null),N=g??(P.clipPlane2!==void 0&&P.clipPlane2!==null),V=g??(P.clipPlane3!==void 0&&P.clipPlane3!==null),U=g??(P.clipPlane4!==void 0&&P.clipPlane4!==null),L=g??(P.clipPlane5!==void 0&&P.clipPlane5!==null),j=g??(P.clipPlane6!==void 0&&P.clipPlane6!==null),T.CLIPPLANE!==R&&(T.CLIPPLANE=R,Y=!0),T.CLIPPLANE2!==N&&(T.CLIPPLANE2=N,Y=!0),T.CLIPPLANE3!==V&&(T.CLIPPLANE3=V,Y=!0),T.CLIPPLANE4!==U&&(T.CLIPPLANE4=U,Y=!0),T.CLIPPLANE5!==L&&(T.CLIPPLANE5=L,Y=!0),T.CLIPPLANE6!==j&&(T.CLIPPLANE6=j,Y=!0),T.DEPTHPREPASS!==!A.getColorWrite()&&(T.DEPTHPREPASS=!T.DEPTHPREPASS,Y=!0),T.INSTANCES!==_&&(T.INSTANCES=_,Y=!0),T.THIN_INSTANCES!==O&&(T.THIN_INSTANCES=O,Y=!0),Y&&T.markAsUnprocessed()},x.PrepareDefinesForBones=function(P,A){if(P.useBones&&P.computeBonesUsingShaders&&P.skeleton){A.NUM_BONE_INFLUENCERS=P.numBoneInfluencers;var T=A.BONETEXTURE!==void 0;if(P.skeleton.isUsingTextureForMatrices&&T)A.BONETEXTURE=!0;else{A.BonesPerMesh=P.skeleton.bones.length+1,A.BONETEXTURE=!T&&void 0;var _=P.getScene().prePassRenderer;if(_&&_.enabled){var g=_.excludedSkinnedMesh.indexOf(P)===-1;A.BONES_VELOCITY_ENABLED=g}}}else A.NUM_BONE_INFLUENCERS=0,A.BonesPerMesh=0},x.PrepareDefinesForMorphTargets=function(P,A){var T=P.morphTargetManager;T?(A.MORPHTARGETS_UV=T.supportsUVs&&A.UV1,A.MORPHTARGETS_TANGENT=T.supportsTangents&&A.TANGENT,A.MORPHTARGETS_NORMAL=T.supportsNormals&&A.NORMAL,A.MORPHTARGETS=T.numInfluencers>0,A.NUM_MORPH_INFLUENCERS=T.numInfluencers):(A.MORPHTARGETS_UV=!1,A.MORPHTARGETS_TANGENT=!1,A.MORPHTARGETS_NORMAL=!1,A.MORPHTARGETS=!1,A.NUM_MORPH_INFLUENCERS=0)},x.PrepareDefinesForAttributes=function(P,A,T,_,g,O){if(g===void 0&&(g=!1),O===void 0&&(O=!0),!A._areAttributesDirty&&A._needNormals===A._normals&&A._needUVs===A._uvs)return!1;if(A._normals=A._needNormals,A._uvs=A._needUVs,A.NORMAL=A._needNormals&&P.isVerticesDataPresent(d.b.NormalKind),A._needNormals&&P.isVerticesDataPresent(d.b.TangentKind)&&(A.TANGENT=!0),A._needUVs?(A.UV1=P.isVerticesDataPresent(d.b.UVKind),A.UV2=P.isVerticesDataPresent(d.b.UV2Kind)):(A.UV1=!1,A.UV2=!1),T){var R=P.useVertexColors&&P.isVerticesDataPresent(d.b.ColorKind);A.VERTEXCOLOR=R,A.VERTEXALPHA=P.hasVertexAlpha&&R&&O}return _&&this.PrepareDefinesForBones(P,A),g&&this.PrepareDefinesForMorphTargets(P,A),!0},x.PrepareDefinesForMultiview=function(P,A){if(P.activeCamera){var T=A.MULTIVIEW;A.MULTIVIEW=P.activeCamera.outputRenderTarget!==null&&P.activeCamera.outputRenderTarget.getViewCount()>1,A.MULTIVIEW!=T&&A.markAsUnprocessed()}},x.PrepareDefinesForPrePass=function(P,A,T){var _=A.PREPASS;if(A._arePrePassDirty){var g=[{type:C.a.PREPASS_POSITION_TEXTURE_TYPE,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:C.a.PREPASS_VELOCITY_TEXTURE_TYPE,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:C.a.PREPASS_REFLECTIVITY_TEXTURE_TYPE,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:C.a.PREPASS_IRRADIANCE_TEXTURE_TYPE,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:C.a.PREPASS_ALBEDO_TEXTURE_TYPE,define:"PREPASS_ALBEDO",index:"PREPASS_ALBEDO_INDEX"},{type:C.a.PREPASS_DEPTHNORMAL_TEXTURE_TYPE,define:"PREPASS_DEPTHNORMAL",index:"PREPASS_DEPTHNORMAL_INDEX"}];if(P.prePassRenderer&&P.prePassRenderer.enabled&&T){A.PREPASS=!0,A.SCENE_MRT_COUNT=P.prePassRenderer.mrtCount;for(var O=0;O<g.length;O++){var R=P.prePassRenderer.getIndex(g[O].type);R!==-1?(A[g[O].define]=!0,A[g[O].index]=R):A[g[O].define]=!1}}else for(A.PREPASS=!1,O=0;O<g.length;O++)A[g[O].define]=!1;A.PREPASS!=_&&(A.markAsUnprocessed(),A.markAsImageProcessingDirty())}},x.PrepareDefinesForLight=function(P,A,T,_,g,O,R){switch(R.needNormals=!0,g["LIGHT"+_]===void 0&&(R.needRebuild=!0),g["LIGHT"+_]=!0,g["SPOTLIGHT"+_]=!1,g["HEMILIGHT"+_]=!1,g["POINTLIGHT"+_]=!1,g["DIRLIGHT"+_]=!1,T.prepareLightSpecificDefines(g,_),g["LIGHT_FALLOFF_PHYSICAL"+_]=!1,g["LIGHT_FALLOFF_GLTF"+_]=!1,g["LIGHT_FALLOFF_STANDARD"+_]=!1,T.falloffType){case M.a.FALLOFF_GLTF:g["LIGHT_FALLOFF_GLTF"+_]=!0;break;case M.a.FALLOFF_PHYSICAL:g["LIGHT_FALLOFF_PHYSICAL"+_]=!0;break;case M.a.FALLOFF_STANDARD:g["LIGHT_FALLOFF_STANDARD"+_]=!0}if(O&&!T.specular.equalsFloats(0,0,0)&&(R.specularEnabled=!0),g["SHADOW"+_]=!1,g["SHADOWCSM"+_]=!1,g["SHADOWCSMDEBUG"+_]=!1,g["SHADOWCSMNUM_CASCADES"+_]=!1,g["SHADOWCSMUSESHADOWMAXZ"+_]=!1,g["SHADOWCSMNOBLEND"+_]=!1,g["SHADOWCSM_RIGHTHANDED"+_]=!1,g["SHADOWPCF"+_]=!1,g["SHADOWPCSS"+_]=!1,g["SHADOWPOISSON"+_]=!1,g["SHADOWESM"+_]=!1,g["SHADOWCLOSEESM"+_]=!1,g["SHADOWCUBE"+_]=!1,g["SHADOWLOWQUALITY"+_]=!1,g["SHADOWMEDIUMQUALITY"+_]=!1,A&&A.receiveShadows&&P.shadowsEnabled&&T.shadowEnabled){var N=T.getShadowGenerator();if(N){var V=N.getShadowMap();V&&V.renderList&&V.renderList.length>0&&(R.shadowEnabled=!0,N.prepareDefines(g,_))}}T.lightmapMode!=M.a.LIGHTMAP_DEFAULT?(R.lightmapMode=!0,g["LIGHTMAPEXCLUDED"+_]=!0,g["LIGHTMAPNOSPECULAR"+_]=T.lightmapMode==M.a.LIGHTMAP_SHADOWSONLY):(g["LIGHTMAPEXCLUDED"+_]=!1,g["LIGHTMAPNOSPECULAR"+_]=!1)},x.PrepareDefinesForLights=function(P,A,T,_,g,O){if(g===void 0&&(g=4),O===void 0&&(O=!1),!T._areLightsDirty)return T._needNormals;var R=0,N={needNormals:!1,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(P.lightsEnabled&&!O)for(var V=0,U=A.lightSources;V<U.length;V++){var L=U[V];if(this.PrepareDefinesForLight(P,A,L,R,T,_,N),++R===g)break}T.SPECULARTERM=N.specularEnabled,T.SHADOWS=N.shadowEnabled;for(var j=R;j<g;j++)T["LIGHT"+j]!==void 0&&(T["LIGHT"+j]=!1,T["HEMILIGHT"+j]=!1,T["POINTLIGHT"+j]=!1,T["DIRLIGHT"+j]=!1,T["SPOTLIGHT"+j]=!1,T["SHADOW"+j]=!1,T["SHADOWCSM"+j]=!1,T["SHADOWCSMDEBUG"+j]=!1,T["SHADOWCSMNUM_CASCADES"+j]=!1,T["SHADOWCSMUSESHADOWMAXZ"+j]=!1,T["SHADOWCSMNOBLEND"+j]=!1,T["SHADOWCSM_RIGHTHANDED"+j]=!1,T["SHADOWPCF"+j]=!1,T["SHADOWPCSS"+j]=!1,T["SHADOWPOISSON"+j]=!1,T["SHADOWESM"+j]=!1,T["SHADOWCLOSEESM"+j]=!1,T["SHADOWCUBE"+j]=!1,T["SHADOWLOWQUALITY"+j]=!1,T["SHADOWMEDIUMQUALITY"+j]=!1);var Y=P.getEngine().getCaps();return T.SHADOWFLOAT===void 0&&(N.needRebuild=!0),T.SHADOWFLOAT=N.shadowEnabled&&(Y.textureFloatRender&&Y.textureFloatLinearFiltering||Y.textureHalfFloatRender&&Y.textureHalfFloatLinearFiltering),T.LIGHTMAPEXCLUDED=N.lightmapMode,N.needRebuild&&T.rebuild(),N.needNormals},x.PrepareUniformsAndSamplersForLight=function(P,A,T,_,g,O){g===void 0&&(g=null),O===void 0&&(O=!1),g&&g.push("Light"+P),O||(A.push("vLightData"+P,"vLightDiffuse"+P,"vLightSpecular"+P,"vLightDirection"+P,"vLightFalloff"+P,"vLightGround"+P,"lightMatrix"+P,"shadowsInfo"+P,"depthValues"+P),T.push("shadowSampler"+P),T.push("depthSampler"+P),A.push("viewFrustumZ"+P,"cascadeBlendFactor"+P,"lightSizeUVCorrection"+P,"depthCorrection"+P,"penumbraDarkness"+P,"frustumLengths"+P),_&&(T.push("projectionLightSampler"+P),A.push("textureProjectionMatrix"+P)))},x.PrepareUniformsAndSamplersList=function(P,A,T,_){var g;_===void 0&&(_=4);var O=null;if(P.uniformsNames){var R=P;g=R.uniformsNames,O=R.uniformBuffersNames,A=R.samplers,T=R.defines,_=R.maxSimultaneousLights||0}else g=P,A||(A=[]);for(var N=0;N<_&&T["LIGHT"+N];N++)this.PrepareUniformsAndSamplersForLight(N,g,A,T["PROJECTEDLIGHTTEXTURE"+N],O);T.NUM_MORPH_INFLUENCERS&&g.push("morphTargetInfluences")},x.HandleFallbacksForShadows=function(P,A,T,_){T===void 0&&(T=4),_===void 0&&(_=0);for(var g=0,O=0;O<T&&P["LIGHT"+O];O++)O>0&&(g=_+O,A.addFallback(g,"LIGHT"+O)),P.SHADOWS||(P["SHADOW"+O]&&A.addFallback(_,"SHADOW"+O),P["SHADOWPCF"+O]&&A.addFallback(_,"SHADOWPCF"+O),P["SHADOWPCSS"+O]&&A.addFallback(_,"SHADOWPCSS"+O),P["SHADOWPOISSON"+O]&&A.addFallback(_,"SHADOWPOISSON"+O),P["SHADOWESM"+O]&&A.addFallback(_,"SHADOWESM"+O),P["SHADOWCLOSEESM"+O]&&A.addFallback(_,"SHADOWCLOSEESM"+O));return g++},x.PrepareAttributesForMorphTargetsInfluencers=function(P,A,T){this._TmpMorphInfluencers.NUM_MORPH_INFLUENCERS=T,this.PrepareAttributesForMorphTargets(P,A,this._TmpMorphInfluencers)},x.PrepareAttributesForMorphTargets=function(P,A,T){var _=T.NUM_MORPH_INFLUENCERS;if(_>0&&S.a.LastCreatedEngine)for(var g=S.a.LastCreatedEngine.getCaps().maxVertexAttribs,O=A.morphTargetManager,R=O&&O.supportsNormals&&T.NORMAL,N=O&&O.supportsTangents&&T.TANGENT,V=O&&O.supportsUVs&&T.UV1,U=0;U<_;U++)P.push(d.b.PositionKind+U),R&&P.push(d.b.NormalKind+U),N&&P.push(d.b.TangentKind+U),V&&P.push(d.b.UVKind+"_"+U),P.length>g&&E.a.Error("Cannot add more vertex attributes for mesh "+A.name)},x.PrepareAttributesForBones=function(P,A,T,_){T.NUM_BONE_INFLUENCERS>0&&(_.addCPUSkinningFallback(0,A),P.push(d.b.MatricesIndicesKind),P.push(d.b.MatricesWeightsKind),T.NUM_BONE_INFLUENCERS>4&&(P.push(d.b.MatricesIndicesExtraKind),P.push(d.b.MatricesWeightsExtraKind)))},x.PrepareAttributesForInstances=function(P,A){(A.INSTANCES||A.THIN_INSTANCES)&&this.PushAttributesForInstances(P)},x.PushAttributesForInstances=function(P){P.push("world0"),P.push("world1"),P.push("world2"),P.push("world3")},x.BindLightProperties=function(P,A,T){P.transferToEffect(A,T+"")},x.BindLight=function(P,A,T,_,g,O){O===void 0&&(O=!1),P._bindLight(A,T,_,g,O)},x.BindLights=function(P,A,T,_,g,O){g===void 0&&(g=4),O===void 0&&(O=!1);for(var R=Math.min(A.lightSources.length,g),N=0;N<R;N++){var V=A.lightSources[N];this.BindLight(V,N,P,T,typeof _=="boolean"?_:_.SPECULARTERM,O)}},x.BindFogParameters=function(P,A,T,_){_===void 0&&(_=!1),P.fogEnabled&&A.applyFog&&P.fogMode!==m.a.FOGMODE_NONE&&(T.setFloat4("vFogInfos",P.fogMode,P.fogStart,P.fogEnd,P.fogDensity),_?(P.fogColor.toLinearSpaceToRef(this._tempFogColor),T.setColor3("vFogColor",this._tempFogColor)):T.setColor3("vFogColor",P.fogColor))},x.BindBonesParameters=function(P,A,T){if(A&&P&&(P.computeBonesUsingShaders&&A._bonesComputationForcedToCPU&&(P.computeBonesUsingShaders=!1),P.useBones&&P.computeBonesUsingShaders&&P.skeleton)){var _=P.skeleton;if(_.isUsingTextureForMatrices&&A.getUniformIndex("boneTextureWidth")>-1){var g=_.getTransformMatrixTexture(P);A.setTexture("boneSampler",g),A.setFloat("boneTextureWidth",4*(_.bones.length+1))}else{var O=_.getTransformMatrices(P);O&&(A.setMatrices("mBones",O),T&&P.getScene().prePassRenderer&&P.getScene().prePassRenderer.getIndex(C.a.PREPASS_VELOCITY_TEXTURE_TYPE)&&(T.previousBones[P.uniqueId]&&A.setMatrices("mPreviousBones",T.previousBones[P.uniqueId]),x._CopyBonesTransformationMatrices(O,T.previousBones[P.uniqueId])))}}},x._CopyBonesTransformationMatrices=function(P,A){return A.set(P),A},x.BindMorphTargetParameters=function(P,A){var T=P.morphTargetManager;P&&T&&A.setFloatArray("morphTargetInfluences",T.influences)},x.BindLogDepth=function(P,A,T){P.LOGARITHMICDEPTH&&A.setFloat("logarithmicDepthConstant",2/(Math.log(T.activeCamera.maxZ+1)/Math.LN2))},x.BindClipPlane=function(P,A){b.a.BindClipPlane(P,A)},x._TmpMorphInfluencers={NUM_MORPH_INFLUENCERS:0},x._tempFogColor=I.a.Black(),x}()},function(h,s,c){c.d(s,"a",function(){return C});var E=c(0),m=c(4),S=c(21),d=c(9),M=c(8),C=function(){function I(){}return I.prototype.set=function(b,p){switch(b.length||M.a.Warn("Setting vertex data kind '"+p+"' with an empty array"),p){case m.b.PositionKind:this.positions=b;break;case m.b.NormalKind:this.normals=b;break;case m.b.TangentKind:this.tangents=b;break;case m.b.UVKind:this.uvs=b;break;case m.b.UV2Kind:this.uvs2=b;break;case m.b.UV3Kind:this.uvs3=b;break;case m.b.UV4Kind:this.uvs4=b;break;case m.b.UV5Kind:this.uvs5=b;break;case m.b.UV6Kind:this.uvs6=b;break;case m.b.ColorKind:this.colors=b;break;case m.b.MatricesIndicesKind:this.matricesIndices=b;break;case m.b.MatricesWeightsKind:this.matricesWeights=b;break;case m.b.MatricesIndicesExtraKind:this.matricesIndicesExtra=b;break;case m.b.MatricesWeightsExtraKind:this.matricesWeightsExtra=b}},I.prototype.applyToMesh=function(b,p){return this._applyTo(b,p),this},I.prototype.applyToGeometry=function(b,p){return this._applyTo(b,p),this},I.prototype.updateMesh=function(b){return this._update(b),this},I.prototype.updateGeometry=function(b){return this._update(b),this},I.prototype._applyTo=function(b,p){return p===void 0&&(p=!1),this.positions&&b.setVerticesData(m.b.PositionKind,this.positions,p),this.normals&&b.setVerticesData(m.b.NormalKind,this.normals,p),this.tangents&&b.setVerticesData(m.b.TangentKind,this.tangents,p),this.uvs&&b.setVerticesData(m.b.UVKind,this.uvs,p),this.uvs2&&b.setVerticesData(m.b.UV2Kind,this.uvs2,p),this.uvs3&&b.setVerticesData(m.b.UV3Kind,this.uvs3,p),this.uvs4&&b.setVerticesData(m.b.UV4Kind,this.uvs4,p),this.uvs5&&b.setVerticesData(m.b.UV5Kind,this.uvs5,p),this.uvs6&&b.setVerticesData(m.b.UV6Kind,this.uvs6,p),this.colors&&b.setVerticesData(m.b.ColorKind,this.colors,p),this.matricesIndices&&b.setVerticesData(m.b.MatricesIndicesKind,this.matricesIndices,p),this.matricesWeights&&b.setVerticesData(m.b.MatricesWeightsKind,this.matricesWeights,p),this.matricesIndicesExtra&&b.setVerticesData(m.b.MatricesIndicesExtraKind,this.matricesIndicesExtra,p),this.matricesWeightsExtra&&b.setVerticesData(m.b.MatricesWeightsExtraKind,this.matricesWeightsExtra,p),this.indices?b.setIndices(this.indices,null,p):b.setIndices([],null),this},I.prototype._update=function(b,p,x){return this.positions&&b.updateVerticesData(m.b.PositionKind,this.positions,p,x),this.normals&&b.updateVerticesData(m.b.NormalKind,this.normals,p,x),this.tangents&&b.updateVerticesData(m.b.TangentKind,this.tangents,p,x),this.uvs&&b.updateVerticesData(m.b.UVKind,this.uvs,p,x),this.uvs2&&b.updateVerticesData(m.b.UV2Kind,this.uvs2,p,x),this.uvs3&&b.updateVerticesData(m.b.UV3Kind,this.uvs3,p,x),this.uvs4&&b.updateVerticesData(m.b.UV4Kind,this.uvs4,p,x),this.uvs5&&b.updateVerticesData(m.b.UV5Kind,this.uvs5,p,x),this.uvs6&&b.updateVerticesData(m.b.UV6Kind,this.uvs6,p,x),this.colors&&b.updateVerticesData(m.b.ColorKind,this.colors,p,x),this.matricesIndices&&b.updateVerticesData(m.b.MatricesIndicesKind,this.matricesIndices,p,x),this.matricesWeights&&b.updateVerticesData(m.b.MatricesWeightsKind,this.matricesWeights,p,x),this.matricesIndicesExtra&&b.updateVerticesData(m.b.MatricesIndicesExtraKind,this.matricesIndicesExtra,p,x),this.matricesWeightsExtra&&b.updateVerticesData(m.b.MatricesWeightsExtraKind,this.matricesWeightsExtra,p,x),this.indices&&b.setIndices(this.indices,null),this},I.prototype.transform=function(b){var p,x=b.determinant()<0,P=E.e.Zero();if(this.positions){var A=E.e.Zero();for(p=0;p<this.positions.length;p+=3)E.e.FromArrayToRef(this.positions,p,A),E.e.TransformCoordinatesToRef(A,b,P),this.positions[p]=P.x,this.positions[p+1]=P.y,this.positions[p+2]=P.z}if(this.normals){var T=E.e.Zero();for(p=0;p<this.normals.length;p+=3)E.e.FromArrayToRef(this.normals,p,T),E.e.TransformNormalToRef(T,b,P),this.normals[p]=P.x,this.normals[p+1]=P.y,this.normals[p+2]=P.z}if(this.tangents){var _=E.f.Zero(),g=E.f.Zero();for(p=0;p<this.tangents.length;p+=4)E.f.FromArrayToRef(this.tangents,p,_),E.f.TransformNormalToRef(_,b,g),this.tangents[p]=g.x,this.tangents[p+1]=g.y,this.tangents[p+2]=g.z,this.tangents[p+3]=g.w}if(x&&this.indices)for(p=0;p<this.indices.length;p+=3){var O=this.indices[p+1];this.indices[p+1]=this.indices[p+2],this.indices[p+2]=O}return this},I.prototype.merge=function(b,p){if(p===void 0&&(p=!1),this._validate(),b._validate(),!this.normals!=!b.normals||!this.tangents!=!b.tangents||!this.uvs!=!b.uvs||!this.uvs2!=!b.uvs2||!this.uvs3!=!b.uvs3||!this.uvs4!=!b.uvs4||!this.uvs5!=!b.uvs5||!this.uvs6!=!b.uvs6||!this.colors!=!b.colors||!this.matricesIndices!=!b.matricesIndices||!this.matricesWeights!=!b.matricesWeights||!this.matricesIndicesExtra!=!b.matricesIndicesExtra||!this.matricesWeightsExtra!=!b.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");if(b.indices){this.indices||(this.indices=[]);var x=this.positions?this.positions.length/3:0;if(this.indices.BYTES_PER_ELEMENT!==void 0){var P=this.indices.length+b.indices.length,A=p||this.indices instanceof Uint32Array?new Uint32Array(P):new Uint16Array(P);A.set(this.indices);for(var T=this.indices.length,_=0;_<b.indices.length;_++)A[T+_]=b.indices[_]+x;this.indices=A}else for(_=0;_<b.indices.length;_++)this.indices.push(b.indices[_]+x)}return this.positions=this._mergeElement(this.positions,b.positions),this.normals=this._mergeElement(this.normals,b.normals),this.tangents=this._mergeElement(this.tangents,b.tangents),this.uvs=this._mergeElement(this.uvs,b.uvs),this.uvs2=this._mergeElement(this.uvs2,b.uvs2),this.uvs3=this._mergeElement(this.uvs3,b.uvs3),this.uvs4=this._mergeElement(this.uvs4,b.uvs4),this.uvs5=this._mergeElement(this.uvs5,b.uvs5),this.uvs6=this._mergeElement(this.uvs6,b.uvs6),this.colors=this._mergeElement(this.colors,b.colors),this.matricesIndices=this._mergeElement(this.matricesIndices,b.matricesIndices),this.matricesWeights=this._mergeElement(this.matricesWeights,b.matricesWeights),this.matricesIndicesExtra=this._mergeElement(this.matricesIndicesExtra,b.matricesIndicesExtra),this.matricesWeightsExtra=this._mergeElement(this.matricesWeightsExtra,b.matricesWeightsExtra),this},I.prototype._mergeElement=function(b,p){if(!b)return p;if(!p)return b;var x=p.length+b.length,P=b instanceof Float32Array,A=p instanceof Float32Array;if(P){var T=new Float32Array(x);return T.set(b),T.set(p,b.length),T}if(A){var _=b.slice(0),g=0;for(x=p.length;g<x;g++)_.push(p[g]);return _}return b.concat(p)},I.prototype._validate=function(){if(!this.positions)throw new Error("Positions are required");var b=function(P,A){var T=m.b.DeduceStride(P);if(A.length%T!=0)throw new Error("The "+P+"s array count must be a multiple of "+T);return A.length/T},p=b(m.b.PositionKind,this.positions),x=function(P,A){var T=b(P,A);if(T!==p)throw new Error("The "+P+"s element count ("+T+") does not match the positions count ("+p+")")};this.normals&&x(m.b.NormalKind,this.normals),this.tangents&&x(m.b.TangentKind,this.tangents),this.uvs&&x(m.b.UVKind,this.uvs),this.uvs2&&x(m.b.UV2Kind,this.uvs2),this.uvs3&&x(m.b.UV3Kind,this.uvs3),this.uvs4&&x(m.b.UV4Kind,this.uvs4),this.uvs5&&x(m.b.UV5Kind,this.uvs5),this.uvs6&&x(m.b.UV6Kind,this.uvs6),this.colors&&x(m.b.ColorKind,this.colors),this.matricesIndices&&x(m.b.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&x(m.b.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&x(m.b.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&x(m.b.MatricesWeightsExtraKind,this.matricesWeightsExtra)},I.prototype.serialize=function(){var b=this.serialize();return this.positions&&(b.positions=this.positions),this.normals&&(b.normals=this.normals),this.tangents&&(b.tangents=this.tangents),this.uvs&&(b.uvs=this.uvs),this.uvs2&&(b.uvs2=this.uvs2),this.uvs3&&(b.uvs3=this.uvs3),this.uvs4&&(b.uvs4=this.uvs4),this.uvs5&&(b.uvs5=this.uvs5),this.uvs6&&(b.uvs6=this.uvs6),this.colors&&(b.colors=this.colors),this.matricesIndices&&(b.matricesIndices=this.matricesIndices,b.matricesIndices._isExpanded=!0),this.matricesWeights&&(b.matricesWeights=this.matricesWeights),this.matricesIndicesExtra&&(b.matricesIndicesExtra=this.matricesIndicesExtra,b.matricesIndicesExtra._isExpanded=!0),this.matricesWeightsExtra&&(b.matricesWeightsExtra=this.matricesWeightsExtra),b.indices=this.indices,b},I.ExtractFromMesh=function(b,p,x){return I._ExtractFrom(b,p,x)},I.ExtractFromGeometry=function(b,p,x){return I._ExtractFrom(b,p,x)},I._ExtractFrom=function(b,p,x){var P=new I;return b.isVerticesDataPresent(m.b.PositionKind)&&(P.positions=b.getVerticesData(m.b.PositionKind,p,x)),b.isVerticesDataPresent(m.b.NormalKind)&&(P.normals=b.getVerticesData(m.b.NormalKind,p,x)),b.isVerticesDataPresent(m.b.TangentKind)&&(P.tangents=b.getVerticesData(m.b.TangentKind,p,x)),b.isVerticesDataPresent(m.b.UVKind)&&(P.uvs=b.getVerticesData(m.b.UVKind,p,x)),b.isVerticesDataPresent(m.b.UV2Kind)&&(P.uvs2=b.getVerticesData(m.b.UV2Kind,p,x)),b.isVerticesDataPresent(m.b.UV3Kind)&&(P.uvs3=b.getVerticesData(m.b.UV3Kind,p,x)),b.isVerticesDataPresent(m.b.UV4Kind)&&(P.uvs4=b.getVerticesData(m.b.UV4Kind,p,x)),b.isVerticesDataPresent(m.b.UV5Kind)&&(P.uvs5=b.getVerticesData(m.b.UV5Kind,p,x)),b.isVerticesDataPresent(m.b.UV6Kind)&&(P.uvs6=b.getVerticesData(m.b.UV6Kind,p,x)),b.isVerticesDataPresent(m.b.ColorKind)&&(P.colors=b.getVerticesData(m.b.ColorKind,p,x)),b.isVerticesDataPresent(m.b.MatricesIndicesKind)&&(P.matricesIndices=b.getVerticesData(m.b.MatricesIndicesKind,p,x)),b.isVerticesDataPresent(m.b.MatricesWeightsKind)&&(P.matricesWeights=b.getVerticesData(m.b.MatricesWeightsKind,p,x)),b.isVerticesDataPresent(m.b.MatricesIndicesExtraKind)&&(P.matricesIndicesExtra=b.getVerticesData(m.b.MatricesIndicesExtraKind,p,x)),b.isVerticesDataPresent(m.b.MatricesWeightsExtraKind)&&(P.matricesWeightsExtra=b.getVerticesData(m.b.MatricesWeightsExtraKind,p,x)),P.indices=b.getIndices(p,x),P},I.CreateRibbon=function(b){throw S.a.WarnImport("ribbonBuilder")},I.CreateBox=function(b){throw S.a.WarnImport("boxBuilder")},I.CreateTiledBox=function(b){throw S.a.WarnImport("tiledBoxBuilder")},I.CreateTiledPlane=function(b){throw S.a.WarnImport("tiledPlaneBuilder")},I.CreateSphere=function(b){throw S.a.WarnImport("sphereBuilder")},I.CreateCylinder=function(b){throw S.a.WarnImport("cylinderBuilder")},I.CreateTorus=function(b){throw S.a.WarnImport("torusBuilder")},I.CreateLineSystem=function(b){throw S.a.WarnImport("linesBuilder")},I.CreateDashedLines=function(b){throw S.a.WarnImport("linesBuilder")},I.CreateGround=function(b){throw S.a.WarnImport("groundBuilder")},I.CreateTiledGround=function(b){throw S.a.WarnImport("groundBuilder")},I.CreateGroundFromHeightMap=function(b){throw S.a.WarnImport("groundBuilder")},I.CreatePlane=function(b){throw S.a.WarnImport("planeBuilder")},I.CreateDisc=function(b){throw S.a.WarnImport("discBuilder")},I.CreatePolygon=function(b,p,x,P,A,T,_){throw S.a.WarnImport("polygonBuilder")},I.CreateIcoSphere=function(b){throw S.a.WarnImport("icoSphereBuilder")},I.CreatePolyhedron=function(b){throw S.a.WarnImport("polyhedronBuilder")},I.CreateCapsule=function(b){throw b===void 0&&(b={orientation:E.e.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6}),S.a.WarnImport("capsuleBuilder")},I.CreateTorusKnot=function(b){throw S.a.WarnImport("torusKnotBuilder")},I.ComputeNormals=function(b,p,x,P){var A=0,T=0,_=0,g=0,O=0,R=0,N=0,V=0,U=0,L=0,j=0,Y=0,W=0,re=0,ne=0,ge=0,_e=0,ce=0,ie=0,Z=0,te=!1,B=!1,G=!1,$=!1,le=1,se=0,q=null;if(P&&(te=!!P.facetNormals,B=!!P.facetPositions,G=!!P.facetPartitioning,le=P.useRightHandedSystem===!0?-1:1,se=P.ratio||0,$=!!P.depthSort,q=P.distanceTo,$)){q===void 0&&(q=E.e.Zero());var H=P.depthSortedFacets}var X=0,J=0,Q=0,ee=0;if(G&&P&&P.bbSize){var pe=0,Te=0,ve=0,he=0,be=0,xe=0,Se=0,Ue=0,We=0,Ze=0,Qe=0,Xe=0,nt=0,Ke=0,ct=0,ot=0,_t=P.bbSize.x>P.bbSize.y?P.bbSize.x:P.bbSize.y;_t=_t>P.bbSize.z?_t:P.bbSize.z,X=P.subDiv.X*se/P.bbSize.x,J=P.subDiv.Y*se/P.bbSize.y,Q=P.subDiv.Z*se/P.bbSize.z,ee=P.subDiv.max*P.subDiv.max,P.facetPartitioning.length=0}for(A=0;A<b.length;A++)x[A]=0;var gt=p.length/3|0;for(A=0;A<gt;A++){if(W=(Y=3*p[3*A])+1,re=Y+2,ge=(ne=3*p[3*A+1])+1,_e=ne+2,ie=(ce=3*p[3*A+2])+1,Z=ce+2,T=b[Y]-b[ne],_=b[W]-b[ge],g=b[re]-b[_e],O=b[ce]-b[ne],R=b[ie]-b[ge],V=le*(_*(N=b[Z]-b[_e])-g*R),U=le*(g*O-T*N),L=le*(T*R-_*O),V/=j=(j=Math.sqrt(V*V+U*U+L*L))===0?1:j,U/=j,L/=j,te&&P&&(P.facetNormals[A].x=V,P.facetNormals[A].y=U,P.facetNormals[A].z=L),B&&P&&(P.facetPositions[A].x=(b[Y]+b[ne]+b[ce])/3,P.facetPositions[A].y=(b[W]+b[ge]+b[ie])/3,P.facetPositions[A].z=(b[re]+b[_e]+b[Z])/3),G&&P&&(pe=Math.floor((P.facetPositions[A].x-P.bInfo.minimum.x*se)*X),Te=Math.floor((P.facetPositions[A].y-P.bInfo.minimum.y*se)*J),ve=Math.floor((P.facetPositions[A].z-P.bInfo.minimum.z*se)*Q),he=Math.floor((b[Y]-P.bInfo.minimum.x*se)*X),be=Math.floor((b[W]-P.bInfo.minimum.y*se)*J),xe=Math.floor((b[re]-P.bInfo.minimum.z*se)*Q),Se=Math.floor((b[ne]-P.bInfo.minimum.x*se)*X),Ue=Math.floor((b[ge]-P.bInfo.minimum.y*se)*J),We=Math.floor((b[_e]-P.bInfo.minimum.z*se)*Q),Ze=Math.floor((b[ce]-P.bInfo.minimum.x*se)*X),Qe=Math.floor((b[ie]-P.bInfo.minimum.y*se)*J),Xe=Math.floor((b[Z]-P.bInfo.minimum.z*se)*Q),Ke=he+P.subDiv.max*be+ee*xe,ct=Se+P.subDiv.max*Ue+ee*We,ot=Ze+P.subDiv.max*Qe+ee*Xe,nt=pe+P.subDiv.max*Te+ee*ve,P.facetPartitioning[nt]=P.facetPartitioning[nt]?P.facetPartitioning[nt]:new Array,P.facetPartitioning[Ke]=P.facetPartitioning[Ke]?P.facetPartitioning[Ke]:new Array,P.facetPartitioning[ct]=P.facetPartitioning[ct]?P.facetPartitioning[ct]:new Array,P.facetPartitioning[ot]=P.facetPartitioning[ot]?P.facetPartitioning[ot]:new Array,P.facetPartitioning[Ke].push(A),ct!=Ke&&P.facetPartitioning[ct].push(A),ot!=ct&&ot!=Ke&&P.facetPartitioning[ot].push(A),nt!=Ke&&nt!=ct&&nt!=ot&&P.facetPartitioning[nt].push(A)),$&&P&&P.facetPositions){var At=H[A];At.ind=3*A,At.sqDistance=E.e.DistanceSquared(P.facetPositions[A],q)}x[Y]+=V,x[W]+=U,x[re]+=L,x[ne]+=V,x[ge]+=U,x[_e]+=L,x[ce]+=V,x[ie]+=U,x[Z]+=L}for(A=0;A<x.length/3;A++)V=x[3*A],U=x[3*A+1],L=x[3*A+2],V/=j=(j=Math.sqrt(V*V+U*U+L*L))===0?1:j,U/=j,L/=j,x[3*A]=V,x[3*A+1]=U,x[3*A+2]=L},I._ComputeSides=function(b,p,x,P,A,T,_){var g,O,R=x.length,N=P.length;switch(b=b||I.DEFAULTSIDE){case I.FRONTSIDE:break;case I.BACKSIDE:var V;for(g=0;g<R;g+=3)V=x[g],x[g]=x[g+2],x[g+2]=V;for(O=0;O<N;O++)P[O]=-P[O];break;case I.DOUBLESIDE:for(var U=p.length,L=U/3,j=0;j<U;j++)p[U+j]=p[j];for(g=0;g<R;g+=3)x[g+R]=x[g+2]+L,x[g+1+R]=x[g+1]+L,x[g+2+R]=x[g]+L;for(O=0;O<N;O++)P[N+O]=-P[O];var Y=A.length,W=0;for(W=0;W<Y;W++)A[W+Y]=A[W];for(T=T||new E.f(0,0,1,1),_=_||new E.f(0,0,1,1),W=0,g=0;g<Y/2;g++)A[W]=T.x+(T.z-T.x)*A[W],A[W+1]=T.y+(T.w-T.y)*A[W+1],A[W+Y]=_.x+(_.z-_.x)*A[W+Y],A[W+Y+1]=_.y+(_.w-_.y)*A[W+Y+1],W+=2}},I.ImportVertexData=function(b,p){var x=new I,P=b.positions;P&&x.set(P,m.b.PositionKind);var A=b.normals;A&&x.set(A,m.b.NormalKind);var T=b.tangents;T&&x.set(T,m.b.TangentKind);var _=b.uvs;_&&x.set(_,m.b.UVKind);var g=b.uv2s;g&&x.set(g,m.b.UV2Kind);var O=b.uv3s;O&&x.set(O,m.b.UV3Kind);var R=b.uv4s;R&&x.set(R,m.b.UV4Kind);var N=b.uv5s;N&&x.set(N,m.b.UV5Kind);var V=b.uv6s;V&&x.set(V,m.b.UV6Kind);var U=b.colors;U&&x.set(d.b.CheckColors4(U,P.length/3),m.b.ColorKind);var L=b.matricesIndices;L&&x.set(L,m.b.MatricesIndicesKind);var j=b.matricesWeights;j&&x.set(j,m.b.MatricesWeightsKind);var Y=b.indices;Y&&(x.indices=Y),p.setAllVerticesData(x,b.updatable)},I.FRONTSIDE=0,I.BACKSIDE=1,I.DOUBLESIDE=2,I.DEFAULTSIDE=0,I}()},function(h,s,c){c.d(s,"a",function(){return m}),c.d(s,"b",function(){return S});var E=c(1),m=function(){function d(){}return d.NAME_EFFECTLAYER="EffectLayer",d.NAME_LAYER="Layer",d.NAME_LENSFLARESYSTEM="LensFlareSystem",d.NAME_BOUNDINGBOXRENDERER="BoundingBoxRenderer",d.NAME_PARTICLESYSTEM="ParticleSystem",d.NAME_GAMEPAD="Gamepad",d.NAME_SIMPLIFICATIONQUEUE="SimplificationQueue",d.NAME_GEOMETRYBUFFERRENDERER="GeometryBufferRenderer",d.NAME_PREPASSRENDERER="PrePassRenderer",d.NAME_DEPTHRENDERER="DepthRenderer",d.NAME_POSTPROCESSRENDERPIPELINEMANAGER="PostProcessRenderPipelineManager",d.NAME_SPRITE="Sprite",d.NAME_SUBSURFACE="SubSurface",d.NAME_OUTLINERENDERER="Outline",d.NAME_PROCEDURALTEXTURE="ProceduralTexture",d.NAME_SHADOWGENERATOR="ShadowGenerator",d.NAME_OCTREE="Octree",d.NAME_PHYSICSENGINE="PhysicsEngine",d.NAME_AUDIO="Audio",d.STEP_ISREADYFORMESH_EFFECTLAYER=0,d.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER=0,d.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER=0,d.STEP_PREACTIVEMESH_BOUNDINGBOXRENDERER=0,d.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER=1,d.STEP_BEFORECAMERADRAW_EFFECTLAYER=0,d.STEP_BEFORECAMERADRAW_LAYER=1,d.STEP_BEFORECAMERADRAW_PREPASS=2,d.STEP_BEFORERENDERTARGETDRAW_LAYER=0,d.STEP_BEFORERENDERINGMESH_PREPASS=0,d.STEP_BEFORERENDERINGMESH_OUTLINE=1,d.STEP_AFTERRENDERINGMESH_PREPASS=0,d.STEP_AFTERRENDERINGMESH_OUTLINE=1,d.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW=0,d.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER=1,d.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE=0,d.STEP_BEFORECAMERAUPDATE_GAMEPAD=1,d.STEP_BEFORECLEAR_PROCEDURALTEXTURE=0,d.STEP_AFTERRENDERTARGETDRAW_LAYER=0,d.STEP_AFTERCAMERADRAW_EFFECTLAYER=0,d.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM=1,d.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW=2,d.STEP_AFTERCAMERADRAW_LAYER=3,d.STEP_AFTERCAMERADRAW_PREPASS=4,d.STEP_AFTERRENDER_AUDIO=0,d.STEP_GATHERRENDERTARGETS_DEPTHRENDERER=0,d.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER=1,d.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR=2,d.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER=3,d.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER=0,d.STEP_BEFORECLEARSTAGE_PREPASS=0,d.STEP_POINTERMOVE_SPRITE=0,d.STEP_POINTERDOWN_SPRITE=0,d.STEP_POINTERUP_SPRITE=0,d}(),S=function(d){function M(C){return d.apply(this,C)||this}return Object(E.d)(M,d),M.Create=function(){return Object.create(M.prototype)},M.prototype.registerStep=function(C,I,b){var p=0;for(Number.MAX_VALUE;p<this.length&&!(C<this[p].index);p++);this.splice(p,0,{index:C,component:I,action:b.bind(I)})},M.prototype.clear=function(){this.length=0},M}(Array)},function(h,s,c){c.d(s,"a",function(){return S}),c.d(s,"c",function(){return d}),c.d(s,"d",function(){return M}),c.d(s,"b",function(){return C});var E=c(1),m=c(0),S=function(){function I(){}return I.POINTERDOWN=1,I.POINTERUP=2,I.POINTERMOVE=4,I.POINTERWHEEL=8,I.POINTERPICK=16,I.POINTERTAP=32,I.POINTERDOUBLETAP=64,I}(),d=function(I,b){this.type=I,this.event=b},M=function(I){function b(p,x,P,A){var T=I.call(this,p,x)||this;return T.ray=null,T.skipOnPointerObservable=!1,T.localPosition=new m.d(P,A),T}return Object(E.d)(b,I),b}(d),C=function(I){function b(p,x,P){var A=I.call(this,p,x)||this;return A.pickInfo=P,A}return Object(E.d)(b,I),b}(d)},function(h,s,c){c.d(s,"a",function(){return S});var E=c(13),m=c(2),S=function(){function d(){}return Object.defineProperty(d,"DiffuseTextureEnabled",{get:function(){return this._DiffuseTextureEnabled},set:function(M){this._DiffuseTextureEnabled!==M&&(this._DiffuseTextureEnabled=M,E.a.MarkAllMaterialsAsDirty(m.a.MATERIAL_TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(d,"DetailTextureEnabled",{get:function(){return this._DetailTextureEnabled},set:function(M){this._DetailTextureEnabled!==M&&(this._DetailTextureEnabled=M,E.a.MarkAllMaterialsAsDirty(m.a.MATERIAL_TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(d,"AmbientTextureEnabled",{get:function(){return this._AmbientTextureEnabled},set:function(M){this._AmbientTextureEnabled!==M&&(this._AmbientTextureEnabled=M,E.a.MarkAllMaterialsAsDirty(m.a.MATERIAL_TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(d,"OpacityTextureEnabled",{get:function(){return this._OpacityTextureEnabled},set:function(M){this._OpacityTextureEnabled!==M&&(this._OpacityTextureEnabled=M,E.a.MarkAllMaterialsAsDirty(m.a.MATERIAL_TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(d,"ReflectionTextureEnabled",{get:function(){return this._ReflectionTextureEnabled},set:function(M){this._ReflectionTextureEnabled!==M&&(this._ReflectionTextureEnabled=M,E.a.MarkAllMaterialsAsDirty(m.a.MATERIAL_TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(d,"EmissiveTextureEnabled",{get:function(){return this._EmissiveTextureEnabled},set:function(M){this._EmissiveTextureEnabled!==M&&(this._EmissiveTextureEnabled=M,E.a.MarkAllMaterialsAsDirty(m.a.MATERIAL_TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(d,"SpecularTextureEnabled",{get:function(){return this._SpecularTextureEnabled},set:function(M){this._SpecularTextureEnabled!==M&&(this._SpecularTextureEnabled=M,E.a.MarkAllMaterialsAsDirty(m.a.MATERIAL_TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(d,"BumpTextureEnabled",{get:function(){return this._BumpTextureEnabled},set:function(M){this._BumpTextureEnabled!==M&&(this._BumpTextureEnabled=M,E.a.MarkAllMaterialsAsDirty(m.a.MATERIAL_TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(d,"LightmapTextureEnabled",{get:function(){return this._LightmapTextureEnabled},set:function(M){this._LightmapTextureEnabled!==M&&(this._LightmapTextureEnabled=M,E.a.MarkAllMaterialsAsDirty(m.a.MATERIAL_TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(d,"RefractionTextureEnabled",{get:function(){return this._RefractionTextureEnabled},set:function(M){this._RefractionTextureEnabled!==M&&(this._RefractionTextureEnabled=M,E.a.MarkAllMaterialsAsDirty(m.a.MATERIAL_TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(d,"ColorGradingTextureEnabled",{get:function(){return this._ColorGradingTextureEnabled},set:function(M){this._ColorGradingTextureEnabled!==M&&(this._ColorGradingTextureEnabled=M,E.a.MarkAllMaterialsAsDirty(m.a.MATERIAL_TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(d,"FresnelEnabled",{get:function(){return this._FresnelEnabled},set:function(M){this._FresnelEnabled!==M&&(this._FresnelEnabled=M,E.a.MarkAllMaterialsAsDirty(m.a.MATERIAL_FresnelDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(d,"ClearCoatTextureEnabled",{get:function(){return this._ClearCoatTextureEnabled},set:function(M){this._ClearCoatTextureEnabled!==M&&(this._ClearCoatTextureEnabled=M,E.a.MarkAllMaterialsAsDirty(m.a.MATERIAL_TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(d,"ClearCoatBumpTextureEnabled",{get:function(){return this._ClearCoatBumpTextureEnabled},set:function(M){this._ClearCoatBumpTextureEnabled!==M&&(this._ClearCoatBumpTextureEnabled=M,E.a.MarkAllMaterialsAsDirty(m.a.MATERIAL_TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(d,"ClearCoatTintTextureEnabled",{get:function(){return this._ClearCoatTintTextureEnabled},set:function(M){this._ClearCoatTintTextureEnabled!==M&&(this._ClearCoatTintTextureEnabled=M,E.a.MarkAllMaterialsAsDirty(m.a.MATERIAL_TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(d,"SheenTextureEnabled",{get:function(){return this._SheenTextureEnabled},set:function(M){this._SheenTextureEnabled!==M&&(this._SheenTextureEnabled=M,E.a.MarkAllMaterialsAsDirty(m.a.MATERIAL_TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(d,"AnisotropicTextureEnabled",{get:function(){return this._AnisotropicTextureEnabled},set:function(M){this._AnisotropicTextureEnabled!==M&&(this._AnisotropicTextureEnabled=M,E.a.MarkAllMaterialsAsDirty(m.a.MATERIAL_TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(d,"ThicknessTextureEnabled",{get:function(){return this._ThicknessTextureEnabled},set:function(M){this._ThicknessTextureEnabled!==M&&(this._ThicknessTextureEnabled=M,E.a.MarkAllMaterialsAsDirty(m.a.MATERIAL_TextureDirtyFlag))},enumerable:!1,configurable:!0}),d._DiffuseTextureEnabled=!0,d._DetailTextureEnabled=!0,d._AmbientTextureEnabled=!0,d._OpacityTextureEnabled=!0,d._ReflectionTextureEnabled=!0,d._EmissiveTextureEnabled=!0,d._SpecularTextureEnabled=!0,d._BumpTextureEnabled=!0,d._LightmapTextureEnabled=!0,d._RefractionTextureEnabled=!0,d._ColorGradingTextureEnabled=!0,d._FresnelEnabled=!0,d._ClearCoatTextureEnabled=!0,d._ClearCoatBumpTextureEnabled=!0,d._ClearCoatTintTextureEnabled=!0,d._SheenTextureEnabled=!0,d._AnisotropicTextureEnabled=!0,d._ThicknessTextureEnabled=!0,d}()},function(h,s,c){c.d(s,"a",function(){return le});var E=c(1),m=c(12),S=c(57),d=c(6),M=c(33),C=c(112),I=c(37),b=c(0),p=c(46),x=c(31),P=c(24),A=c(35),T=c(42),_=c(85),g=c(48),O=c(54),R=c(47),N=c(95),V=c(96),U=c(17),L=c(2),j=c(38),Y=c(8),W=c(22),re=c(21),ne=c(18),ge=c(91),_e=c(66),ce=function(){function se(){this._singleClick=!1,this._doubleClick=!1,this._hasSwiped=!1,this._ignore=!1}return Object.defineProperty(se.prototype,"singleClick",{get:function(){return this._singleClick},set:function(q){this._singleClick=q},enumerable:!1,configurable:!0}),Object.defineProperty(se.prototype,"doubleClick",{get:function(){return this._doubleClick},set:function(q){this._doubleClick=q},enumerable:!1,configurable:!0}),Object.defineProperty(se.prototype,"hasSwiped",{get:function(){return this._hasSwiped},set:function(q){this._hasSwiped=q},enumerable:!1,configurable:!0}),Object.defineProperty(se.prototype,"ignore",{get:function(){return this._ignore},set:function(q){this._ignore=q},enumerable:!1,configurable:!0}),se}(),ie=function(){function se(q){this._alreadyAttached=!1,this._wheelEventName="",this._meshPickProceed=!1,this._currentPickResult=null,this._previousPickResult=null,this._totalPointersPressed=0,this._doubleClickOccured=!1,this._pointerX=0,this._pointerY=0,this._startingPointerPosition=new b.d(0,0),this._previousStartingPointerPosition=new b.d(0,0),this._startingPointerTime=0,this._previousStartingPointerTime=0,this._pointerCaptures={},this._meshUnderPointerId=[],this._keyboardIsAttached=!1,this._scene=q}return Object.defineProperty(se.prototype,"meshUnderPointer",{get:function(){return this._pointerOverMesh},enumerable:!1,configurable:!0}),se.prototype.getMeshUnderPointerByPointerId=function(q){return this._meshUnderPointerId[q]},Object.defineProperty(se.prototype,"unTranslatedPointer",{get:function(){return new b.d(this._unTranslatedPointerX,this._unTranslatedPointerY)},enumerable:!1,configurable:!0}),Object.defineProperty(se.prototype,"pointerX",{get:function(){return this._pointerX},set:function(q){this._pointerX=q},enumerable:!1,configurable:!0}),Object.defineProperty(se.prototype,"pointerY",{get:function(){return this._pointerY},set:function(q){this._pointerY=q},enumerable:!1,configurable:!0}),se.prototype._updatePointerPosition=function(q){var H=this._scene.getEngine().getInputElementClientRect();H&&(this._pointerX=q.clientX-H.left,this._pointerY=q.clientY-H.top,this._unTranslatedPointerX=this._pointerX,this._unTranslatedPointerY=this._pointerY)},se.prototype._processPointerMove=function(q,H){var X=this._scene,J=X.getEngine(),Q=J.getInputElement();if(Q){Q.tabIndex=J.canvasTabIndex,X.doNotHandleCursors||(Q.style.cursor=X.defaultCursor);var ee=!!(q&&q.hit&&q.pickedMesh);ee?(X.setPointerOverMesh(q.pickedMesh,H.pointerId),this._pointerOverMesh&&this._pointerOverMesh.actionManager&&this._pointerOverMesh.actionManager.hasPointerTriggers&&(X.doNotHandleCursors||(this._pointerOverMesh.actionManager.hoverCursor?Q.style.cursor=this._pointerOverMesh.actionManager.hoverCursor:Q.style.cursor=X.hoverCursor))):X.setPointerOverMesh(null,H.pointerId);for(var pe=0,Te=X._pointerMoveStage;pe<Te.length;pe++)q=Te[pe].action(this._unTranslatedPointerX,this._unTranslatedPointerY,q,ee,Q);if(q){var ve=H.type===this._wheelEventName?ne.a.POINTERWHEEL:ne.a.POINTERMOVE;if(X.onPointerMove&&X.onPointerMove(H,q,ve),X.onPointerObservable.hasObservers()){var he=new ne.b(ve,H,q);this._setRayOnPointerInfo(he),X.onPointerObservable.notifyObservers(he,ve)}}}},se.prototype._setRayOnPointerInfo=function(q){var H=this._scene;q.pickInfo&&!q.pickInfo._pickingUnavailable&&(q.pickInfo.ray||(q.pickInfo.ray=H.createPickingRay(q.event.offsetX,q.event.offsetY,b.a.Identity(),H.activeCamera)))},se.prototype._checkPrePointerObservable=function(q,H,X){var J=this._scene,Q=new ne.d(X,H,this._unTranslatedPointerX,this._unTranslatedPointerY);return q&&(Q.ray=q.ray),J.onPrePointerObservable.notifyObservers(Q,X),!!Q.skipOnPointerObservable},se.prototype.simulatePointerMove=function(q,H){var X=new PointerEvent("pointermove",H);this._checkPrePointerObservable(q,X,ne.a.POINTERMOVE)||this._processPointerMove(q,X)},se.prototype.simulatePointerDown=function(q,H){var X=new PointerEvent("pointerdown",H);this._checkPrePointerObservable(q,X,ne.a.POINTERDOWN)||this._processPointerDown(q,X)},se.prototype._processPointerDown=function(q,H){var X=this,J=this._scene;if(q&&q.hit&&q.pickedMesh){this._pickedDownMesh=q.pickedMesh;var Q=q.pickedMesh._getActionManagerForTrigger();if(Q){if(Q.hasPickTriggers)switch(Q.processTrigger(L.a.ACTION_OnPickDownTrigger,R.a.CreateNew(q.pickedMesh,H)),H.button){case 0:Q.processTrigger(L.a.ACTION_OnLeftPickTrigger,R.a.CreateNew(q.pickedMesh,H));break;case 1:Q.processTrigger(L.a.ACTION_OnCenterPickTrigger,R.a.CreateNew(q.pickedMesh,H));break;case 2:Q.processTrigger(L.a.ACTION_OnRightPickTrigger,R.a.CreateNew(q.pickedMesh,H))}Q.hasSpecificTrigger(L.a.ACTION_OnLongPressTrigger)&&window.setTimeout(function(){var he=J.pick(X._unTranslatedPointerX,X._unTranslatedPointerY,function(be){return be.isPickable&&be.isVisible&&be.isReady()&&be.actionManager&&be.actionManager.hasSpecificTrigger(L.a.ACTION_OnLongPressTrigger)&&be==X._pickedDownMesh},!1,J.cameraToUseForPointers);he&&he.hit&&he.pickedMesh&&Q&&X._totalPointersPressed!==0&&Date.now()-X._startingPointerTime>se.LongPressDelay&&!X._isPointerSwiping()&&(X._startingPointerTime=0,Q.processTrigger(L.a.ACTION_OnLongPressTrigger,R.a.CreateNew(he.pickedMesh,H)))},se.LongPressDelay)}}else for(var ee=0,pe=J._pointerDownStage;ee<pe.length;ee++)q=pe[ee].action(this._unTranslatedPointerX,this._unTranslatedPointerY,q,H);if(q){var Te=ne.a.POINTERDOWN;if(J.onPointerDown&&J.onPointerDown(H,q,Te),J.onPointerObservable.hasObservers()){var ve=new ne.b(Te,H,q);this._setRayOnPointerInfo(ve),J.onPointerObservable.notifyObservers(ve,Te)}}},se.prototype._isPointerSwiping=function(){return Math.abs(this._startingPointerPosition.x-this._pointerX)>se.DragMovementThreshold||Math.abs(this._startingPointerPosition.y-this._pointerY)>se.DragMovementThreshold},se.prototype.simulatePointerUp=function(q,H,X){var J=new PointerEvent("pointerup",H),Q=new ce;X?Q.doubleClick=!0:Q.singleClick=!0,this._checkPrePointerObservable(q,J,ne.a.POINTERUP)||this._processPointerUp(q,J,Q)},se.prototype._processPointerUp=function(q,H,X){var J=this._scene;if(q&&q&&q.pickedMesh){if(this._pickedUpMesh=q.pickedMesh,this._pickedDownMesh===this._pickedUpMesh&&(J.onPointerPick&&J.onPointerPick(H,q),X.singleClick&&!X.ignore&&J.onPointerObservable.hasObservers())){var Q=ne.a.POINTERPICK,ee=new ne.b(Q,H,q);this._setRayOnPointerInfo(ee),J.onPointerObservable.notifyObservers(ee,Q)}var pe=q.pickedMesh._getActionManagerForTrigger();if(pe&&!X.ignore){pe.processTrigger(L.a.ACTION_OnPickUpTrigger,R.a.CreateNew(q.pickedMesh,H)),!X.hasSwiped&&X.singleClick&&pe.processTrigger(L.a.ACTION_OnPickTrigger,R.a.CreateNew(q.pickedMesh,H));var Te=q.pickedMesh._getActionManagerForTrigger(L.a.ACTION_OnDoublePickTrigger);X.doubleClick&&Te&&Te.processTrigger(L.a.ACTION_OnDoublePickTrigger,R.a.CreateNew(q.pickedMesh,H))}}else if(!X.ignore)for(var ve=0,he=J._pointerUpStage;ve<he.length;ve++)q=he[ve].action(this._unTranslatedPointerX,this._unTranslatedPointerY,q,H);if(this._pickedDownMesh&&this._pickedDownMesh!==this._pickedUpMesh){var be=this._pickedDownMesh._getActionManagerForTrigger(L.a.ACTION_OnPickOutTrigger);be&&be.processTrigger(L.a.ACTION_OnPickOutTrigger,R.a.CreateNew(this._pickedDownMesh,H))}var xe=0;J.onPointerObservable.hasObservers()&&(!X.ignore&&!X.hasSwiped&&(X.singleClick&&J.onPointerObservable.hasSpecificMask(ne.a.POINTERTAP)?xe=ne.a.POINTERTAP:X.doubleClick&&J.onPointerObservable.hasSpecificMask(ne.a.POINTERDOUBLETAP)&&(xe=ne.a.POINTERDOUBLETAP),xe)&&(ee=new ne.b(xe,H,q),this._setRayOnPointerInfo(ee),J.onPointerObservable.notifyObservers(ee,xe)),X.ignore||(xe=ne.a.POINTERUP,ee=new ne.b(xe,H,q),this._setRayOnPointerInfo(ee),J.onPointerObservable.notifyObservers(ee,xe))),J.onPointerUp&&!X.ignore&&J.onPointerUp(H,q,xe)},se.prototype.isPointerCaptured=function(q){return q===void 0&&(q=0),this._pointerCaptures[q]},se.prototype.attachControl=function(q,H,X,J){var Q=this;q===void 0&&(q=!0),H===void 0&&(H=!0),X===void 0&&(X=!0),J===void 0&&(J=null);var ee=this._scene;if(J||(J=ee.getEngine().getInputElement()),J){this._alreadyAttached&&this.detachControl(),this._alreadyAttachedTo=J;var pe=ee.getEngine();this._initActionManager=function(be,xe){if(!Q._meshPickProceed){var Se=ee.pick(Q._unTranslatedPointerX,Q._unTranslatedPointerY,ee.pointerDownPredicate,!1,ee.cameraToUseForPointers);Q._currentPickResult=Se,Se&&(be=Se.hit&&Se.pickedMesh?Se.pickedMesh._getActionManagerForTrigger():null),Q._meshPickProceed=!0}return be},this._delayedSimpleClick=function(be,xe,Se){(Date.now()-Q._previousStartingPointerTime>se.DoubleClickDelay&&!Q._doubleClickOccured||be!==Q._previousButtonPressed)&&(Q._doubleClickOccured=!1,xe.singleClick=!0,xe.ignore=!1,Se(xe,Q._currentPickResult))},this._initClickEvent=function(be,xe,Se,Ue){var We=new ce;Q._currentPickResult=null;var Ze=null,Qe=be.hasSpecificMask(ne.a.POINTERPICK)||xe.hasSpecificMask(ne.a.POINTERPICK)||be.hasSpecificMask(ne.a.POINTERTAP)||xe.hasSpecificMask(ne.a.POINTERTAP)||be.hasSpecificMask(ne.a.POINTERDOUBLETAP)||xe.hasSpecificMask(ne.a.POINTERDOUBLETAP);!Qe&&ge.a&&(Ze=Q._initActionManager(Ze,We))&&(Qe=Ze.hasPickTriggers);var Xe=!1;if(Qe){var nt=Se.button;if(We.hasSwiped=Q._isPointerSwiping(),!We.hasSwiped){var Ke=!se.ExclusiveDoubleClickMode;Ke||(Ke=!be.hasSpecificMask(ne.a.POINTERDOUBLETAP)&&!xe.hasSpecificMask(ne.a.POINTERDOUBLETAP))&&!ge.a.HasSpecificTrigger(L.a.ACTION_OnDoublePickTrigger)&&(Ze=Q._initActionManager(Ze,We))&&(Ke=!Ze.hasSpecificTrigger(L.a.ACTION_OnDoublePickTrigger)),Ke?(Date.now()-Q._previousStartingPointerTime>se.DoubleClickDelay||nt!==Q._previousButtonPressed)&&(We.singleClick=!0,Ue(We,Q._currentPickResult),Xe=!0):(Q._previousDelayedSimpleClickTimeout=Q._delayedSimpleClickTimeout,Q._delayedSimpleClickTimeout=window.setTimeout(Q._delayedSimpleClick.bind(Q,nt,We,Ue),se.DoubleClickDelay));var ct=be.hasSpecificMask(ne.a.POINTERDOUBLETAP)||xe.hasSpecificMask(ne.a.POINTERDOUBLETAP);!ct&&ge.a.HasSpecificTrigger(L.a.ACTION_OnDoublePickTrigger)&&(Ze=Q._initActionManager(Ze,We))&&(ct=Ze.hasSpecificTrigger(L.a.ACTION_OnDoublePickTrigger)),ct&&(nt===Q._previousButtonPressed&&Date.now()-Q._previousStartingPointerTime<se.DoubleClickDelay&&!Q._doubleClickOccured?(We.hasSwiped||Q._isPointerSwiping()?(Q._doubleClickOccured=!1,Q._previousStartingPointerTime=Q._startingPointerTime,Q._previousStartingPointerPosition.x=Q._startingPointerPosition.x,Q._previousStartingPointerPosition.y=Q._startingPointerPosition.y,Q._previousButtonPressed=nt,se.ExclusiveDoubleClickMode?(Q._previousDelayedSimpleClickTimeout&&clearTimeout(Q._previousDelayedSimpleClickTimeout),Q._previousDelayedSimpleClickTimeout=Q._delayedSimpleClickTimeout,Ue(We,Q._previousPickResult)):Ue(We,Q._currentPickResult)):(Q._previousStartingPointerTime=0,Q._doubleClickOccured=!0,We.doubleClick=!0,We.ignore=!1,se.ExclusiveDoubleClickMode&&Q._previousDelayedSimpleClickTimeout&&clearTimeout(Q._previousDelayedSimpleClickTimeout),Q._previousDelayedSimpleClickTimeout=Q._delayedSimpleClickTimeout,Ue(We,Q._currentPickResult)),Xe=!0):(Q._doubleClickOccured=!1,Q._previousStartingPointerTime=Q._startingPointerTime,Q._previousStartingPointerPosition.x=Q._startingPointerPosition.x,Q._previousStartingPointerPosition.y=Q._startingPointerPosition.y,Q._previousButtonPressed=nt))}}Xe||Ue(We,Q._currentPickResult)},this._onPointerMove=function(be){if(be.pointerId===void 0&&(be.pointerId=0),Q._updatePointerPosition(be),!Q._checkPrePointerObservable(null,be,be.type===Q._wheelEventName?ne.a.POINTERWHEEL:ne.a.POINTERMOVE)&&(ee.cameraToUseForPointers||ee.activeCamera)){ee.pointerMovePredicate||(ee.pointerMovePredicate=function(Se){return Se.isPickable&&Se.isVisible&&Se.isReady()&&Se.isEnabled()&&(Se.enablePointerMoveEvents||ee.constantlyUpdateMeshUnderPointer||Se._getActionManagerForTrigger()!=null)&&(!ee.cameraToUseForPointers||(ee.cameraToUseForPointers.layerMask&Se.layerMask)!=0)});var xe=ee.pick(Q._unTranslatedPointerX,Q._unTranslatedPointerY,ee.pointerMovePredicate,!1,ee.cameraToUseForPointers);Q._processPointerMove(xe,be)}},this._onPointerDown=function(be){if(Q._totalPointersPressed++,Q._pickedDownMesh=null,Q._meshPickProceed=!1,be.pointerId===void 0&&(be.pointerId=0),Q._updatePointerPosition(be),ee.preventDefaultOnPointerDown&&J&&(be.preventDefault(),J.focus()),Q._startingPointerPosition.x=Q._pointerX,Q._startingPointerPosition.y=Q._pointerY,Q._startingPointerTime=Date.now(),!Q._checkPrePointerObservable(null,be,ne.a.POINTERDOWN)&&(ee.cameraToUseForPointers||ee.activeCamera)){Q._pointerCaptures[be.pointerId]=!0,ee.pointerDownPredicate||(ee.pointerDownPredicate=function(Se){return Se.isPickable&&Se.isVisible&&Se.isReady()&&Se.isEnabled()&&(!ee.cameraToUseForPointers||(ee.cameraToUseForPointers.layerMask&Se.layerMask)!=0)}),Q._pickedDownMesh=null;var xe=ee.pick(Q._unTranslatedPointerX,Q._unTranslatedPointerY,ee.pointerDownPredicate,!1,ee.cameraToUseForPointers);Q._processPointerDown(xe,be)}},this._onPointerUp=function(be){Q._totalPointersPressed!==0&&(Q._totalPointersPressed--,Q._pickedUpMesh=null,Q._meshPickProceed=!1,be.pointerId===void 0&&(be.pointerId=0),Q._updatePointerPosition(be),ee.preventDefaultOnPointerUp&&J&&(be.preventDefault(),J.focus()),Q._initClickEvent(ee.onPrePointerObservable,ee.onPointerObservable,be,function(xe,Se){ee.onPrePointerObservable.hasObservers()&&!xe.ignore&&(!xe.hasSwiped&&(xe.singleClick&&ee.onPrePointerObservable.hasSpecificMask(ne.a.POINTERTAP)&&Q._checkPrePointerObservable(null,be,ne.a.POINTERTAP)||xe.doubleClick&&ee.onPrePointerObservable.hasSpecificMask(ne.a.POINTERDOUBLETAP)&&Q._checkPrePointerObservable(null,be,ne.a.POINTERDOUBLETAP))||Q._checkPrePointerObservable(null,be,ne.a.POINTERUP))||Q._pointerCaptures[be.pointerId]&&(Q._pointerCaptures[be.pointerId]=!1,(ee.cameraToUseForPointers||ee.activeCamera)&&(ee.pointerUpPredicate||(ee.pointerUpPredicate=function(Ue){return Ue.isPickable&&Ue.isVisible&&Ue.isReady()&&Ue.isEnabled()&&(!ee.cameraToUseForPointers||(ee.cameraToUseForPointers.layerMask&Ue.layerMask)!=0)}),!Q._meshPickProceed&&(ge.a&&ge.a.HasTriggers||ee.onPointerObservable.hasObservers())&&Q._initActionManager(null,xe),Se||(Se=Q._currentPickResult),Q._processPointerUp(Se,be,xe),Q._previousPickResult=Q._currentPickResult))}))},this._onKeyDown=function(be){var xe=_e.a.KEYDOWN;if(ee.onPreKeyboardObservable.hasObservers()){var Se=new _e.c(xe,be);if(ee.onPreKeyboardObservable.notifyObservers(Se,xe),Se.skipOnPointerObservable)return}ee.onKeyboardObservable.hasObservers()&&(Se=new _e.b(xe,be),ee.onKeyboardObservable.notifyObservers(Se,xe)),ee.actionManager&&ee.actionManager.processTrigger(L.a.ACTION_OnKeyDownTrigger,R.a.CreateNewFromScene(ee,be))},this._onKeyUp=function(be){var xe=_e.a.KEYUP;if(ee.onPreKeyboardObservable.hasObservers()){var Se=new _e.c(xe,be);if(ee.onPreKeyboardObservable.notifyObservers(Se,xe),Se.skipOnPointerObservable)return}ee.onKeyboardObservable.hasObservers()&&(Se=new _e.b(xe,be),ee.onKeyboardObservable.notifyObservers(Se,xe)),ee.actionManager&&ee.actionManager.processTrigger(L.a.ACTION_OnKeyUpTrigger,R.a.CreateNewFromScene(ee,be))};var Te=function(){J&&!Q._keyboardIsAttached&&(J.addEventListener("keydown",Q._onKeyDown,!1),J.addEventListener("keyup",Q._onKeyUp,!1),Q._keyboardIsAttached=!0)};this._onCanvasFocusObserver=pe.onCanvasFocusObservable.add((document.activeElement===J&&Te(),Te)),this._onCanvasBlurObserver=pe.onCanvasBlurObservable.add(function(){J&&(J.removeEventListener("keydown",Q._onKeyDown),J.removeEventListener("keyup",Q._onKeyUp),Q._keyboardIsAttached=!1)}),Te();var ve=m.b.GetPointerPrefix(pe);if(X&&(J.addEventListener(ve+"move",this._onPointerMove,!1),this._wheelEventName="onwheel"in document.createElement("div")?"wheel":document.onmousewheel!==void 0?"mousewheel":"DOMMouseScroll",J.addEventListener(this._wheelEventName,this._onPointerMove,!1)),H&&J.addEventListener(ve+"down",this._onPointerDown,!1),q){var he=ee.getEngine().getHostWindow();he&&he.addEventListener(ve+"up",this._onPointerUp,!1)}this._alreadyAttached=!0}},se.prototype.detachControl=function(){var q=this._scene.getEngine(),H=m.b.GetPointerPrefix(q);this._alreadyAttachedTo&&this._alreadyAttached&&(this._alreadyAttachedTo.removeEventListener(H+"move",this._onPointerMove),this._alreadyAttachedTo.removeEventListener(this._wheelEventName,this._onPointerMove),this._alreadyAttachedTo.removeEventListener(H+"down",this._onPointerDown),window.removeEventListener(H+"up",this._onPointerUp),this._onCanvasBlurObserver&&q.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onCanvasFocusObserver&&q.onCanvasFocusObservable.remove(this._onCanvasFocusObserver),this._alreadyAttachedTo.removeEventListener("keydown",this._onKeyDown),this._alreadyAttachedTo.removeEventListener("keyup",this._onKeyUp),this._scene.doNotHandleCursors||(this._alreadyAttachedTo.style.cursor=this._scene.defaultCursor),this._alreadyAttached=!1)},se.prototype.setPointerOverMesh=function(q,H){if(H===void 0&&(H=0),H<0&&(H=0),this._meshUnderPointerId[H]!==q){var X,J=this._meshUnderPointerId[H];J&&(X=J._getActionManagerForTrigger(L.a.ACTION_OnPointerOutTrigger))&&X.processTrigger(L.a.ACTION_OnPointerOutTrigger,R.a.CreateNew(J,void 0,{pointerId:H})),this._meshUnderPointerId[H]=q,this._pointerOverMesh=q,(J=this._meshUnderPointerId[H])&&(X=J._getActionManagerForTrigger(L.a.ACTION_OnPointerOverTrigger))&&X.processTrigger(L.a.ACTION_OnPointerOverTrigger,R.a.CreateNew(J,void 0,{pointerId:H}))}},se.prototype.getPointerOverMesh=function(){return this._pointerOverMesh},se.DragMovementThreshold=10,se.LongPressDelay=500,se.DoubleClickDelay=300,se.ExclusiveDoubleClickMode=!1,se}(),Z=c(55),te=c(9),B=c(90),G=c(152),$=c(56),le=function(se){function q(H,X){var J=se.call(this)||this;J._inputManager=new ie(J),J.cameraToUseForPointers=null,J._isScene=!0,J._blockEntityCollection=!1,J.autoClear=!0,J.autoClearDepthAndStencil=!0,J.clearColor=new te.b(.2,.2,.3,1),J.ambientColor=new te.a(0,0,0),J._environmentIntensity=1,J._forceWireframe=!1,J._skipFrustumClipping=!1,J._forcePointsCloud=!1,J.animationsEnabled=!0,J._animationPropertiesOverride=null,J.useConstantAnimationDeltaTime=!1,J.constantlyUpdateMeshUnderPointer=!1,J.hoverCursor="pointer",J.defaultCursor="",J.doNotHandleCursors=!1,J.preventDefaultOnPointerDown=!0,J.preventDefaultOnPointerUp=!0,J.metadata=null,J.reservedDataStore=null,J.disableOfflineSupportExceptionRules=new Array,J.onDisposeObservable=new d.c,J._onDisposeObserver=null,J.onBeforeRenderObservable=new d.c,J._onBeforeRenderObserver=null,J.onAfterRenderObservable=new d.c,J.onAfterRenderCameraObservable=new d.c,J._onAfterRenderObserver=null,J.onBeforeAnimationsObservable=new d.c,J.onAfterAnimationsObservable=new d.c,J.onBeforeDrawPhaseObservable=new d.c,J.onAfterDrawPhaseObservable=new d.c,J.onReadyObservable=new d.c,J.onBeforeCameraRenderObservable=new d.c,J._onBeforeCameraRenderObserver=null,J.onAfterCameraRenderObservable=new d.c,J._onAfterCameraRenderObserver=null,J.onBeforeActiveMeshesEvaluationObservable=new d.c,J.onAfterActiveMeshesEvaluationObservable=new d.c,J.onBeforeParticlesRenderingObservable=new d.c,J.onAfterParticlesRenderingObservable=new d.c,J.onDataLoadedObservable=new d.c,J.onNewCameraAddedObservable=new d.c,J.onCameraRemovedObservable=new d.c,J.onNewLightAddedObservable=new d.c,J.onLightRemovedObservable=new d.c,J.onNewGeometryAddedObservable=new d.c,J.onGeometryRemovedObservable=new d.c,J.onNewTransformNodeAddedObservable=new d.c,J.onTransformNodeRemovedObservable=new d.c,J.onNewMeshAddedObservable=new d.c,J.onMeshRemovedObservable=new d.c,J.onNewSkeletonAddedObservable=new d.c,J.onSkeletonRemovedObservable=new d.c,J.onNewMaterialAddedObservable=new d.c,J.onNewMultiMaterialAddedObservable=new d.c,J.onMaterialRemovedObservable=new d.c,J.onMultiMaterialRemovedObservable=new d.c,J.onNewTextureAddedObservable=new d.c,J.onTextureRemovedObservable=new d.c,J.onBeforeRenderTargetsRenderObservable=new d.c,J.onAfterRenderTargetsRenderObservable=new d.c,J.onBeforeStepObservable=new d.c,J.onAfterStepObservable=new d.c,J.onActiveCameraChanged=new d.c,J.onBeforeRenderingGroupObservable=new d.c,J.onAfterRenderingGroupObservable=new d.c,J.onMeshImportedObservable=new d.c,J.onAnimationFileImportedObservable=new d.c,J._registeredForLateAnimationBindings=new M.b(256),J.onPrePointerObservable=new d.c,J.onPointerObservable=new d.c,J.onPreKeyboardObservable=new d.c,J.onKeyboardObservable=new d.c,J._useRightHandedSystem=!1,J._timeAccumulator=0,J._currentStepId=0,J._currentInternalStep=0,J._fogEnabled=!0,J._fogMode=q.FOGMODE_NONE,J.fogColor=new te.a(.2,.2,.3),J.fogDensity=.1,J.fogStart=0,J.fogEnd=1e3,J.prePass=!1,J._shadowsEnabled=!0,J._lightsEnabled=!0,J.activeCameras=new Array,J._texturesEnabled=!0,J.physicsEnabled=!0,J.particlesEnabled=!0,J.spritesEnabled=!0,J._skeletonsEnabled=!0,J.lensFlaresEnabled=!0,J.collisionsEnabled=!0,J.gravity=new b.e(0,-9.807,0),J.postProcessesEnabled=!0,J.renderTargetsEnabled=!0,J.dumpNextRenderTargets=!1,J.customRenderTargets=new Array,J.importedMeshesFiles=new Array,J.probesEnabled=!0,J._meshesForIntersections=new M.b(256),J.proceduralTexturesEnabled=!0,J._totalVertices=new Z.a,J._activeIndices=new Z.a,J._activeParticles=new Z.a,J._activeBones=new Z.a,J._animationTime=0,J.animationTimeScale=1,J._renderId=0,J._frameId=0,J._executeWhenReadyTimeoutId=-1,J._intermediateRendering=!1,J._viewUpdateFlag=-1,J._projectionUpdateFlag=-1,J._toBeDisposed=new Array(256),J._activeRequests=new Array,J._pendingData=new Array,J._isDisposed=!1,J.dispatchAllSubMeshesOfActiveMeshes=!1,J._activeMeshes=new M.a(256),J._processedMaterials=new M.a(256),J._renderTargets=new M.b(256),J._activeParticleSystems=new M.a(256),J._activeSkeletons=new M.b(32),J._softwareSkinnedMeshes=new M.b(32),J._activeAnimatables=new Array,J._transformMatrix=b.a.Zero(),J.requireLightSorting=!1,J._components=[],J._serializableComponents=[],J._transientComponents=[],J._beforeCameraUpdateStage=U.b.Create(),J._beforeClearStage=U.b.Create(),J._gatherRenderTargetsStage=U.b.Create(),J._gatherActiveCameraRenderTargetsStage=U.b.Create(),J._isReadyForMeshStage=U.b.Create(),J._beforeEvaluateActiveMeshStage=U.b.Create(),J._evaluateSubMeshStage=U.b.Create(),J._preActiveMeshStage=U.b.Create(),J._cameraDrawRenderTargetStage=U.b.Create(),J._beforeCameraDrawStage=U.b.Create(),J._beforeRenderTargetDrawStage=U.b.Create(),J._beforeRenderingGroupDrawStage=U.b.Create(),J._beforeRenderingMeshStage=U.b.Create(),J._afterRenderingMeshStage=U.b.Create(),J._afterRenderingGroupDrawStage=U.b.Create(),J._afterCameraDrawStage=U.b.Create(),J._afterRenderTargetDrawStage=U.b.Create(),J._afterRenderStage=U.b.Create(),J._pointerMoveStage=U.b.Create(),J._pointerDownStage=U.b.Create(),J._pointerUpStage=U.b.Create(),J.geometriesByUniqueId=null,J._defaultMeshCandidates={data:[],length:0},J._defaultSubMeshCandidates={data:[],length:0},J._preventFreeActiveMeshesAndRenderingGroups=!1,J._activeMeshesFrozen=!1,J._skipEvaluateActiveMeshesCompletely=!1,J._allowPostProcessClearColor=!0,J.getDeterministicFrameTime=function(){return J._engine.getTimeStep()},J._blockMaterialDirtyMechanism=!1;var Q=Object(E.a)({useGeometryUniqueIdsMap:!0,useMaterialMeshMap:!0,useClonedMeshMap:!0,virtual:!1},X);return J._engine=H||W.a.LastCreatedEngine,Q.virtual||(W.a._LastCreatedScene=J,J._engine.scenes.push(J)),J._uid=null,J._renderingManager=new V.b(J),N.a&&(J.postProcessManager=new N.a(J)),j.a.IsWindowObjectExist()&&J.attachControl(),J._createUbo(),T.a&&(J._imageProcessingConfiguration=new T.a),J.setDefaultCandidateProviders(),Q.useGeometryUniqueIdsMap&&(J.geometriesByUniqueId={}),J.useMaterialMeshMap=Q.useMaterialMeshMap,J.useClonedMeshMap=Q.useClonedMeshMap,X&&X.virtual||J._engine.onNewSceneAddedObservable.notifyObservers(J),J}return Object(E.d)(q,se),q.DefaultMaterialFactory=function(H){throw re.a.WarnImport("StandardMaterial")},q.CollisionCoordinatorFactory=function(){throw re.a.WarnImport("DefaultCollisionCoordinator")},Object.defineProperty(q.prototype,"environmentTexture",{get:function(){return this._environmentTexture},set:function(H){this._environmentTexture!==H&&(this._environmentTexture=H,this.markAllMaterialsAsDirty(L.a.MATERIAL_TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(q.prototype,"environmentIntensity",{get:function(){return this._environmentIntensity},set:function(H){this._environmentIntensity!==H&&(this._environmentIntensity=H,this.markAllMaterialsAsDirty(L.a.MATERIAL_TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(q.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},enumerable:!1,configurable:!0}),Object.defineProperty(q.prototype,"forceWireframe",{get:function(){return this._forceWireframe},set:function(H){this._forceWireframe!==H&&(this._forceWireframe=H,this.markAllMaterialsAsDirty(L.a.MATERIAL_MiscDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(q.prototype,"skipFrustumClipping",{get:function(){return this._skipFrustumClipping},set:function(H){this._skipFrustumClipping!==H&&(this._skipFrustumClipping=H)},enumerable:!1,configurable:!0}),Object.defineProperty(q.prototype,"forcePointsCloud",{get:function(){return this._forcePointsCloud},set:function(H){this._forcePointsCloud!==H&&(this._forcePointsCloud=H,this.markAllMaterialsAsDirty(L.a.MATERIAL_MiscDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(q.prototype,"animationPropertiesOverride",{get:function(){return this._animationPropertiesOverride},set:function(H){this._animationPropertiesOverride=H},enumerable:!1,configurable:!0}),Object.defineProperty(q.prototype,"onDispose",{set:function(H){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(H)},enumerable:!1,configurable:!0}),Object.defineProperty(q.prototype,"beforeRender",{set:function(H){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),H&&(this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(H))},enumerable:!1,configurable:!0}),Object.defineProperty(q.prototype,"afterRender",{set:function(H){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),H&&(this._onAfterRenderObserver=this.onAfterRenderObservable.add(H))},enumerable:!1,configurable:!0}),Object.defineProperty(q.prototype,"beforeCameraRender",{set:function(H){this._onBeforeCameraRenderObserver&&this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=this.onBeforeCameraRenderObservable.add(H)},enumerable:!1,configurable:!0}),Object.defineProperty(q.prototype,"afterCameraRender",{set:function(H){this._onAfterCameraRenderObserver&&this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=this.onAfterCameraRenderObservable.add(H)},enumerable:!1,configurable:!0}),Object.defineProperty(q.prototype,"unTranslatedPointer",{get:function(){return this._inputManager.unTranslatedPointer},enumerable:!1,configurable:!0}),Object.defineProperty(q,"DragMovementThreshold",{get:function(){return ie.DragMovementThreshold},set:function(H){ie.DragMovementThreshold=H},enumerable:!1,configurable:!0}),Object.defineProperty(q,"LongPressDelay",{get:function(){return ie.LongPressDelay},set:function(H){ie.LongPressDelay=H},enumerable:!1,configurable:!0}),Object.defineProperty(q,"DoubleClickDelay",{get:function(){return ie.DoubleClickDelay},set:function(H){ie.DoubleClickDelay=H},enumerable:!1,configurable:!0}),Object.defineProperty(q,"ExclusiveDoubleClickMode",{get:function(){return ie.ExclusiveDoubleClickMode},set:function(H){ie.ExclusiveDoubleClickMode=H},enumerable:!1,configurable:!0}),Object.defineProperty(q.prototype,"useRightHandedSystem",{get:function(){return this._useRightHandedSystem},set:function(H){this._useRightHandedSystem!==H&&(this._useRightHandedSystem=H,this.markAllMaterialsAsDirty(L.a.MATERIAL_MiscDirtyFlag))},enumerable:!1,configurable:!0}),q.prototype.setStepId=function(H){this._currentStepId=H},q.prototype.getStepId=function(){return this._currentStepId},q.prototype.getInternalStep=function(){return this._currentInternalStep},Object.defineProperty(q.prototype,"fogEnabled",{get:function(){return this._fogEnabled},set:function(H){this._fogEnabled!==H&&(this._fogEnabled=H,this.markAllMaterialsAsDirty(L.a.MATERIAL_MiscDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(q.prototype,"fogMode",{get:function(){return this._fogMode},set:function(H){this._fogMode!==H&&(this._fogMode=H,this.markAllMaterialsAsDirty(L.a.MATERIAL_MiscDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(q.prototype,"shadowsEnabled",{get:function(){return this._shadowsEnabled},set:function(H){this._shadowsEnabled!==H&&(this._shadowsEnabled=H,this.markAllMaterialsAsDirty(L.a.MATERIAL_LightDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(q.prototype,"lightsEnabled",{get:function(){return this._lightsEnabled},set:function(H){this._lightsEnabled!==H&&(this._lightsEnabled=H,this.markAllMaterialsAsDirty(L.a.MATERIAL_LightDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(q.prototype,"activeCamera",{get:function(){return this._activeCamera},set:function(H){H!==this._activeCamera&&(this._activeCamera=H,this.onActiveCameraChanged.notifyObservers(this))},enumerable:!1,configurable:!0}),Object.defineProperty(q.prototype,"defaultMaterial",{get:function(){return this._defaultMaterial||(this._defaultMaterial=q.DefaultMaterialFactory(this)),this._defaultMaterial},set:function(H){this._defaultMaterial=H},enumerable:!1,configurable:!0}),Object.defineProperty(q.prototype,"texturesEnabled",{get:function(){return this._texturesEnabled},set:function(H){this._texturesEnabled!==H&&(this._texturesEnabled=H,this.markAllMaterialsAsDirty(L.a.MATERIAL_TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(q.prototype,"skeletonsEnabled",{get:function(){return this._skeletonsEnabled},set:function(H){this._skeletonsEnabled!==H&&(this._skeletonsEnabled=H,this.markAllMaterialsAsDirty(L.a.MATERIAL_AttributesDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(q.prototype,"collisionCoordinator",{get:function(){return this._collisionCoordinator||(this._collisionCoordinator=q.CollisionCoordinatorFactory(),this._collisionCoordinator.init(this)),this._collisionCoordinator},enumerable:!1,configurable:!0}),Object.defineProperty(q.prototype,"frustumPlanes",{get:function(){return this._frustumPlanes},enumerable:!1,configurable:!0}),q.prototype._registerTransientComponents=function(){if(this._transientComponents.length>0){for(var H=0,X=this._transientComponents;H<X.length;H++)X[H].register();this._transientComponents=[]}},q.prototype._addComponent=function(H){this._components.push(H),this._transientComponents.push(H);var X=H;X.addFromContainer&&X.serialize&&this._serializableComponents.push(X)},q.prototype._getComponent=function(H){for(var X=0,J=this._components;X<J.length;X++){var Q=J[X];if(Q.name===H)return Q}return null},q.prototype.getClassName=function(){return"Scene"},q.prototype._getDefaultMeshCandidates=function(){return this._defaultMeshCandidates.data=this.meshes,this._defaultMeshCandidates.length=this.meshes.length,this._defaultMeshCandidates},q.prototype._getDefaultSubMeshCandidates=function(H){return this._defaultSubMeshCandidates.data=H.subMeshes,this._defaultSubMeshCandidates.length=H.subMeshes.length,this._defaultSubMeshCandidates},q.prototype.setDefaultCandidateProviders=function(){this.getActiveMeshCandidates=this._getDefaultMeshCandidates.bind(this),this.getActiveSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this),this.getIntersectingSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this),this.getCollidingSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this)},Object.defineProperty(q.prototype,"meshUnderPointer",{get:function(){return this._inputManager.meshUnderPointer},enumerable:!1,configurable:!0}),Object.defineProperty(q.prototype,"pointerX",{get:function(){return this._inputManager.pointerX},set:function(H){this._inputManager.pointerX=H},enumerable:!1,configurable:!0}),Object.defineProperty(q.prototype,"pointerY",{get:function(){return this._inputManager.pointerY},set:function(H){this._inputManager.pointerY=H},enumerable:!1,configurable:!0}),q.prototype.getCachedMaterial=function(){return this._cachedMaterial},q.prototype.getCachedEffect=function(){return this._cachedEffect},q.prototype.getCachedVisibility=function(){return this._cachedVisibility},q.prototype.isCachedMaterialInvalid=function(H,X,J){return J===void 0&&(J=1),this._cachedEffect!==X||this._cachedMaterial!==H||this._cachedVisibility!==J},q.prototype.getEngine=function(){return this._engine},q.prototype.getTotalVertices=function(){return this._totalVertices.current},Object.defineProperty(q.prototype,"totalVerticesPerfCounter",{get:function(){return this._totalVertices},enumerable:!1,configurable:!0}),q.prototype.getActiveIndices=function(){return this._activeIndices.current},Object.defineProperty(q.prototype,"totalActiveIndicesPerfCounter",{get:function(){return this._activeIndices},enumerable:!1,configurable:!0}),q.prototype.getActiveParticles=function(){return this._activeParticles.current},Object.defineProperty(q.prototype,"activeParticlesPerfCounter",{get:function(){return this._activeParticles},enumerable:!1,configurable:!0}),q.prototype.getActiveBones=function(){return this._activeBones.current},Object.defineProperty(q.prototype,"activeBonesPerfCounter",{get:function(){return this._activeBones},enumerable:!1,configurable:!0}),q.prototype.getActiveMeshes=function(){return this._activeMeshes},q.prototype.getAnimationRatio=function(){return this._animationRatio!==void 0?this._animationRatio:1},q.prototype.getRenderId=function(){return this._renderId},q.prototype.getFrameId=function(){return this._frameId},q.prototype.incrementRenderId=function(){this._renderId++},q.prototype._createUbo=function(){this._sceneUbo=new _.a(this._engine,void 0,!0),this._sceneUbo.addUniform("viewProjection",16),this._sceneUbo.addUniform("view",16)},q.prototype.simulatePointerMove=function(H,X){return this._inputManager.simulatePointerMove(H,X),this},q.prototype.simulatePointerDown=function(H,X){return this._inputManager.simulatePointerDown(H,X),this},q.prototype.simulatePointerUp=function(H,X,J){return this._inputManager.simulatePointerUp(H,X,J),this},q.prototype.isPointerCaptured=function(H){return H===void 0&&(H=0),this._inputManager.isPointerCaptured(H)},q.prototype.attachControl=function(H,X,J){H===void 0&&(H=!0),X===void 0&&(X=!0),J===void 0&&(J=!0),this._inputManager.attachControl(H,X,J)},q.prototype.detachControl=function(){this._inputManager.detachControl()},q.prototype.isReady=function(){if(this._isDisposed)return!1;var H,X=this.getEngine();if(!X.areAllEffectsReady()||this._pendingData.length>0)return!1;for(H=0;H<this.meshes.length;H++){var J=this.meshes[H];if(J.isEnabled()&&J.subMeshes&&J.subMeshes.length!==0){if(!J.isReady(!0))return!1;for(var Q=J.hasThinInstances||J.getClassName()==="InstancedMesh"||J.getClassName()==="InstancedLinesMesh"||X.getCaps().instancedArrays&&J.instances.length>0,ee=0,pe=this._isReadyForMeshStage;ee<pe.length;ee++)if(!pe[ee].action(J,Q))return!1}}for(H=0;H<this.geometries.length;H++)if(this.geometries[H].delayLoadState===L.a.DELAYLOADSTATE_LOADING)return!1;if(this.activeCameras&&this.activeCameras.length>0){for(var Te=0,ve=this.activeCameras;Te<ve.length;Te++)if(!ve[Te].isReady(!0))return!1}else if(this.activeCamera&&!this.activeCamera.isReady(!0))return!1;for(var he=0,be=this.particleSystems;he<be.length;he++)if(!be[he].isReady())return!1;return!0},q.prototype.resetCachedMaterial=function(){this._cachedMaterial=null,this._cachedEffect=null,this._cachedVisibility=null},q.prototype.registerBeforeRender=function(H){this.onBeforeRenderObservable.add(H)},q.prototype.unregisterBeforeRender=function(H){this.onBeforeRenderObservable.removeCallback(H)},q.prototype.registerAfterRender=function(H){this.onAfterRenderObservable.add(H)},q.prototype.unregisterAfterRender=function(H){this.onAfterRenderObservable.removeCallback(H)},q.prototype._executeOnceBeforeRender=function(H){var X=this,J=function(){H(),setTimeout(function(){X.unregisterBeforeRender(J)})};this.registerBeforeRender(J)},q.prototype.executeOnceBeforeRender=function(H,X){var J=this;X!==void 0?setTimeout(function(){J._executeOnceBeforeRender(H)},X):this._executeOnceBeforeRender(H)},q.prototype._addPendingData=function(H){this._pendingData.push(H)},q.prototype._removePendingData=function(H){var X=this.isLoading,J=this._pendingData.indexOf(H);J!==-1&&this._pendingData.splice(J,1),X&&!this.isLoading&&this.onDataLoadedObservable.notifyObservers(this)},q.prototype.getWaitingItemsCount=function(){return this._pendingData.length},Object.defineProperty(q.prototype,"isLoading",{get:function(){return this._pendingData.length>0},enumerable:!1,configurable:!0}),q.prototype.executeWhenReady=function(H){var X=this;this.onReadyObservable.add(H),this._executeWhenReadyTimeoutId===-1&&(this._executeWhenReadyTimeoutId=setTimeout(function(){X._checkIsReady()},150))},q.prototype.whenReadyAsync=function(){var H=this;return new Promise(function(X){H.executeWhenReady(function(){X()})})},q.prototype._checkIsReady=function(){var H=this;return this._registerTransientComponents(),this.isReady()?(this.onReadyObservable.notifyObservers(this),this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=-1)):this._isDisposed?(this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=-1)):void(this._executeWhenReadyTimeoutId=setTimeout(function(){H._checkIsReady()},150))},Object.defineProperty(q.prototype,"animatables",{get:function(){return this._activeAnimatables},enumerable:!1,configurable:!0}),q.prototype.resetLastAnimationTimeFrame=function(){this._animationTimeLast=S.a.Now},q.prototype.getViewMatrix=function(){return this._viewMatrix},q.prototype.getProjectionMatrix=function(){return this._projectionMatrix},q.prototype.getTransformMatrix=function(){return this._transformMatrix},q.prototype.setTransformMatrix=function(H,X,J,Q){this._viewUpdateFlag===H.updateFlag&&this._projectionUpdateFlag===X.updateFlag||(this._viewUpdateFlag=H.updateFlag,this._projectionUpdateFlag=X.updateFlag,this._viewMatrix=H,this._projectionMatrix=X,this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._frustumPlanes?B.a.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=B.a.GetPlanes(this._transformMatrix),this._multiviewSceneUbo&&this._multiviewSceneUbo.useUbo?this._updateMultiviewUbo(J,Q):this._sceneUbo.useUbo&&(this._sceneUbo.updateMatrix("viewProjection",this._transformMatrix),this._sceneUbo.updateMatrix("view",this._viewMatrix),this._sceneUbo.update()))},q.prototype.getSceneUniformBuffer=function(){return this._multiviewSceneUbo?this._multiviewSceneUbo:this._sceneUbo},q.prototype.getUniqueId=function(){return G.a.UniqueId},q.prototype.addMesh=function(H,X){var J=this;X===void 0&&(X=!1),this._blockEntityCollection||(this.meshes.push(H),H._resyncLightSources(),H.parent||H._addToSceneRootNodes(),this.onNewMeshAddedObservable.notifyObservers(H),X&&H.getChildMeshes().forEach(function(Q){J.addMesh(Q)}))},q.prototype.removeMesh=function(H,X){var J=this;X===void 0&&(X=!1);var Q=this.meshes.indexOf(H);return Q!==-1&&(this.meshes[Q]=this.meshes[this.meshes.length-1],this.meshes.pop(),H.parent||H._removeFromSceneRootNodes()),this.onMeshRemovedObservable.notifyObservers(H),X&&H.getChildMeshes().forEach(function(ee){J.removeMesh(ee)}),Q},q.prototype.addTransformNode=function(H){this._blockEntityCollection||(H._indexInSceneTransformNodesArray=this.transformNodes.length,this.transformNodes.push(H),H.parent||H._addToSceneRootNodes(),this.onNewTransformNodeAddedObservable.notifyObservers(H))},q.prototype.removeTransformNode=function(H){var X=H._indexInSceneTransformNodesArray;if(X!==-1){if(X!==this.transformNodes.length-1){var J=this.transformNodes[this.transformNodes.length-1];this.transformNodes[X]=J,J._indexInSceneTransformNodesArray=X}H._indexInSceneTransformNodesArray=-1,this.transformNodes.pop(),H.parent||H._removeFromSceneRootNodes()}return this.onTransformNodeRemovedObservable.notifyObservers(H),X},q.prototype.removeSkeleton=function(H){var X=this.skeletons.indexOf(H);return X!==-1&&(this.skeletons.splice(X,1),this.onSkeletonRemovedObservable.notifyObservers(H)),X},q.prototype.removeMorphTargetManager=function(H){var X=this.morphTargetManagers.indexOf(H);return X!==-1&&this.morphTargetManagers.splice(X,1),X},q.prototype.removeLight=function(H){var X=this.lights.indexOf(H);if(X!==-1){for(var J=0,Q=this.meshes;J<Q.length;J++)Q[J]._removeLightSource(H,!1);this.lights.splice(X,1),this.sortLightsByPriority(),H.parent||H._removeFromSceneRootNodes()}return this.onLightRemovedObservable.notifyObservers(H),X},q.prototype.removeCamera=function(H){var X=this.cameras.indexOf(H);if(X!==-1&&(this.cameras.splice(X,1),H.parent||H._removeFromSceneRootNodes()),this.activeCameras){var J=this.activeCameras.indexOf(H);J!==-1&&this.activeCameras.splice(J,1)}return this.activeCamera===H&&(this.cameras.length>0?this.activeCamera=this.cameras[0]:this.activeCamera=null),this.onCameraRemovedObservable.notifyObservers(H),X},q.prototype.removeParticleSystem=function(H){var X=this.particleSystems.indexOf(H);return X!==-1&&this.particleSystems.splice(X,1),X},q.prototype.removeAnimation=function(H){var X=this.animations.indexOf(H);return X!==-1&&this.animations.splice(X,1),X},q.prototype.stopAnimation=function(H,X,J){},q.prototype.removeAnimationGroup=function(H){var X=this.animationGroups.indexOf(H);return X!==-1&&this.animationGroups.splice(X,1),X},q.prototype.removeMultiMaterial=function(H){var X=this.multiMaterials.indexOf(H);return X!==-1&&this.multiMaterials.splice(X,1),this.onMultiMaterialRemovedObservable.notifyObservers(H),X},q.prototype.removeMaterial=function(H){var X=H._indexInSceneMaterialArray;if(X!==-1&&X<this.materials.length){if(X!==this.materials.length-1){var J=this.materials[this.materials.length-1];this.materials[X]=J,J._indexInSceneMaterialArray=X}H._indexInSceneMaterialArray=-1,this.materials.pop()}return this.onMaterialRemovedObservable.notifyObservers(H),X},q.prototype.removeActionManager=function(H){var X=this.actionManagers.indexOf(H);return X!==-1&&this.actionManagers.splice(X,1),X},q.prototype.removeTexture=function(H){var X=this.textures.indexOf(H);return X!==-1&&this.textures.splice(X,1),this.onTextureRemovedObservable.notifyObservers(H),X},q.prototype.addLight=function(H){if(!this._blockEntityCollection){this.lights.push(H),this.sortLightsByPriority(),H.parent||H._addToSceneRootNodes();for(var X=0,J=this.meshes;X<J.length;X++){var Q=J[X];Q.lightSources.indexOf(H)===-1&&(Q.lightSources.push(H),Q._resyncLightSources())}this.onNewLightAddedObservable.notifyObservers(H)}},q.prototype.sortLightsByPriority=function(){this.requireLightSorting&&this.lights.sort(g.a.CompareLightsPriority)},q.prototype.addCamera=function(H){this._blockEntityCollection||(this.cameras.push(H),this.onNewCameraAddedObservable.notifyObservers(H),H.parent||H._addToSceneRootNodes())},q.prototype.addSkeleton=function(H){this._blockEntityCollection||(this.skeletons.push(H),this.onNewSkeletonAddedObservable.notifyObservers(H))},q.prototype.addParticleSystem=function(H){this._blockEntityCollection||this.particleSystems.push(H)},q.prototype.addAnimation=function(H){this._blockEntityCollection||this.animations.push(H)},q.prototype.addAnimationGroup=function(H){this._blockEntityCollection||this.animationGroups.push(H)},q.prototype.addMultiMaterial=function(H){this._blockEntityCollection||(this.multiMaterials.push(H),this.onNewMultiMaterialAddedObservable.notifyObservers(H))},q.prototype.addMaterial=function(H){this._blockEntityCollection||(H._indexInSceneMaterialArray=this.materials.length,this.materials.push(H),this.onNewMaterialAddedObservable.notifyObservers(H))},q.prototype.addMorphTargetManager=function(H){this._blockEntityCollection||this.morphTargetManagers.push(H)},q.prototype.addGeometry=function(H){this._blockEntityCollection||(this.geometriesByUniqueId&&(this.geometriesByUniqueId[H.uniqueId]=this.geometries.length),this.geometries.push(H))},q.prototype.addActionManager=function(H){this.actionManagers.push(H)},q.prototype.addTexture=function(H){this._blockEntityCollection||(this.textures.push(H),this.onNewTextureAddedObservable.notifyObservers(H))},q.prototype.switchActiveCamera=function(H,X){X===void 0&&(X=!0),this._engine.getInputElement()&&(this.activeCamera&&this.activeCamera.detachControl(),this.activeCamera=H,X&&H.attachControl())},q.prototype.setActiveCameraByID=function(H){var X=this.getCameraByID(H);return X?(this.activeCamera=X,X):null},q.prototype.setActiveCameraByName=function(H){var X=this.getCameraByName(H);return X?(this.activeCamera=X,X):null},q.prototype.getAnimationGroupByName=function(H){for(var X=0;X<this.animationGroups.length;X++)if(this.animationGroups[X].name===H)return this.animationGroups[X];return null},q.prototype.getMaterialByUniqueID=function(H){for(var X=0;X<this.materials.length;X++)if(this.materials[X].uniqueId===H)return this.materials[X];return null},q.prototype.getMaterialByID=function(H){for(var X=0;X<this.materials.length;X++)if(this.materials[X].id===H)return this.materials[X];return null},q.prototype.getLastMaterialByID=function(H){for(var X=this.materials.length-1;X>=0;X--)if(this.materials[X].id===H)return this.materials[X];return null},q.prototype.getMaterialByName=function(H){for(var X=0;X<this.materials.length;X++)if(this.materials[X].name===H)return this.materials[X];return null},q.prototype.getTextureByUniqueID=function(H){for(var X=0;X<this.textures.length;X++)if(this.textures[X].uniqueId===H)return this.textures[X];return null},q.prototype.getCameraByID=function(H){for(var X=0;X<this.cameras.length;X++)if(this.cameras[X].id===H)return this.cameras[X];return null},q.prototype.getCameraByUniqueID=function(H){for(var X=0;X<this.cameras.length;X++)if(this.cameras[X].uniqueId===H)return this.cameras[X];return null},q.prototype.getCameraByName=function(H){for(var X=0;X<this.cameras.length;X++)if(this.cameras[X].name===H)return this.cameras[X];return null},q.prototype.getBoneByID=function(H){for(var X=0;X<this.skeletons.length;X++)for(var J=this.skeletons[X],Q=0;Q<J.bones.length;Q++)if(J.bones[Q].id===H)return J.bones[Q];return null},q.prototype.getBoneByName=function(H){for(var X=0;X<this.skeletons.length;X++)for(var J=this.skeletons[X],Q=0;Q<J.bones.length;Q++)if(J.bones[Q].name===H)return J.bones[Q];return null},q.prototype.getLightByName=function(H){for(var X=0;X<this.lights.length;X++)if(this.lights[X].name===H)return this.lights[X];return null},q.prototype.getLightByID=function(H){for(var X=0;X<this.lights.length;X++)if(this.lights[X].id===H)return this.lights[X];return null},q.prototype.getLightByUniqueID=function(H){for(var X=0;X<this.lights.length;X++)if(this.lights[X].uniqueId===H)return this.lights[X];return null},q.prototype.getParticleSystemByID=function(H){for(var X=0;X<this.particleSystems.length;X++)if(this.particleSystems[X].id===H)return this.particleSystems[X];return null},q.prototype.getGeometryByID=function(H){for(var X=0;X<this.geometries.length;X++)if(this.geometries[X].id===H)return this.geometries[X];return null},q.prototype._getGeometryByUniqueID=function(H){if(this.geometriesByUniqueId){var X=this.geometriesByUniqueId[H];if(X!==void 0)return this.geometries[X]}else for(var J=0;J<this.geometries.length;J++)if(this.geometries[J].uniqueId===H)return this.geometries[J];return null},q.prototype.pushGeometry=function(H,X){return!(!X&&this._getGeometryByUniqueID(H.uniqueId))&&(this.addGeometry(H),this.onNewGeometryAddedObservable.notifyObservers(H),!0)},q.prototype.removeGeometry=function(H){var X;if(this.geometriesByUniqueId){if((X=this.geometriesByUniqueId[H.uniqueId])===void 0)return!1}else if((X=this.geometries.indexOf(H))<0)return!1;if(X!==this.geometries.length-1){var J=this.geometries[this.geometries.length-1];J&&(this.geometries[X]=J,this.geometriesByUniqueId&&(this.geometriesByUniqueId[J.uniqueId]=X,this.geometriesByUniqueId[H.uniqueId]=void 0))}return this.geometries.pop(),this.onGeometryRemovedObservable.notifyObservers(H),!0},q.prototype.getGeometries=function(){return this.geometries},q.prototype.getMeshByID=function(H){for(var X=0;X<this.meshes.length;X++)if(this.meshes[X].id===H)return this.meshes[X];return null},q.prototype.getMeshesByID=function(H){return this.meshes.filter(function(X){return X.id===H})},q.prototype.getTransformNodeByID=function(H){for(var X=0;X<this.transformNodes.length;X++)if(this.transformNodes[X].id===H)return this.transformNodes[X];return null},q.prototype.getTransformNodeByUniqueID=function(H){for(var X=0;X<this.transformNodes.length;X++)if(this.transformNodes[X].uniqueId===H)return this.transformNodes[X];return null},q.prototype.getTransformNodesByID=function(H){return this.transformNodes.filter(function(X){return X.id===H})},q.prototype.getMeshByUniqueID=function(H){for(var X=0;X<this.meshes.length;X++)if(this.meshes[X].uniqueId===H)return this.meshes[X];return null},q.prototype.getLastMeshByID=function(H){for(var X=this.meshes.length-1;X>=0;X--)if(this.meshes[X].id===H)return this.meshes[X];return null},q.prototype.getLastEntryByID=function(H){var X;for(X=this.meshes.length-1;X>=0;X--)if(this.meshes[X].id===H)return this.meshes[X];for(X=this.transformNodes.length-1;X>=0;X--)if(this.transformNodes[X].id===H)return this.transformNodes[X];for(X=this.cameras.length-1;X>=0;X--)if(this.cameras[X].id===H)return this.cameras[X];for(X=this.lights.length-1;X>=0;X--)if(this.lights[X].id===H)return this.lights[X];return null},q.prototype.getNodeByID=function(H){var X=this.getMeshByID(H);if(X)return X;var J=this.getTransformNodeByID(H);if(J)return J;var Q=this.getLightByID(H);if(Q)return Q;var ee=this.getCameraByID(H);if(ee)return ee;var pe=this.getBoneByID(H);return pe||null},q.prototype.getNodeByName=function(H){var X=this.getMeshByName(H);if(X)return X;var J=this.getTransformNodeByName(H);if(J)return J;var Q=this.getLightByName(H);if(Q)return Q;var ee=this.getCameraByName(H);if(ee)return ee;var pe=this.getBoneByName(H);return pe||null},q.prototype.getMeshByName=function(H){for(var X=0;X<this.meshes.length;X++)if(this.meshes[X].name===H)return this.meshes[X];return null},q.prototype.getTransformNodeByName=function(H){for(var X=0;X<this.transformNodes.length;X++)if(this.transformNodes[X].name===H)return this.transformNodes[X];return null},q.prototype.getLastSkeletonByID=function(H){for(var X=this.skeletons.length-1;X>=0;X--)if(this.skeletons[X].id===H)return this.skeletons[X];return null},q.prototype.getSkeletonByUniqueId=function(H){for(var X=0;X<this.skeletons.length;X++)if(this.skeletons[X].uniqueId===H)return this.skeletons[X];return null},q.prototype.getSkeletonById=function(H){for(var X=0;X<this.skeletons.length;X++)if(this.skeletons[X].id===H)return this.skeletons[X];return null},q.prototype.getSkeletonByName=function(H){for(var X=0;X<this.skeletons.length;X++)if(this.skeletons[X].name===H)return this.skeletons[X];return null},q.prototype.getMorphTargetManagerById=function(H){for(var X=0;X<this.morphTargetManagers.length;X++)if(this.morphTargetManagers[X].uniqueId===H)return this.morphTargetManagers[X];return null},q.prototype.getMorphTargetById=function(H){for(var X=0;X<this.morphTargetManagers.length;++X)for(var J=this.morphTargetManagers[X],Q=0;Q<J.numTargets;++Q){var ee=J.getTarget(Q);if(ee.id===H)return ee}return null},q.prototype.getMorphTargetByName=function(H){for(var X=0;X<this.morphTargetManagers.length;++X)for(var J=this.morphTargetManagers[X],Q=0;Q<J.numTargets;++Q){var ee=J.getTarget(Q);if(ee.name===H)return ee}return null},q.prototype.getPostProcessByName=function(H){for(var X=0;X<this.postProcesses.length;++X){var J=this.postProcesses[X];if(J.name===H)return J}return null},q.prototype.isActiveMesh=function(H){return this._activeMeshes.indexOf(H)!==-1},Object.defineProperty(q.prototype,"uid",{get:function(){return this._uid||(this._uid=m.b.RandomId()),this._uid},enumerable:!1,configurable:!0}),q.prototype.addExternalData=function(H,X){return this._externalData||(this._externalData=new C.a),this._externalData.add(H,X)},q.prototype.getExternalData=function(H){return this._externalData?this._externalData.get(H):null},q.prototype.getOrAddExternalDataWithFactory=function(H,X){return this._externalData||(this._externalData=new C.a),this._externalData.getOrAddWithFactory(H,X)},q.prototype.removeExternalData=function(H){return this._externalData.remove(H)},q.prototype._evaluateSubMesh=function(H,X,J){if(J.hasInstances||J.isAnInstance||this.dispatchAllSubMeshesOfActiveMeshes||this._skipFrustumClipping||X.alwaysSelectAsActiveMesh||X.subMeshes.length===1||H.isInFrustum(this._frustumPlanes)){for(var Q=0,ee=this._evaluateSubMeshStage;Q<ee.length;Q++)ee[Q].action(X,H);var pe=H.getMaterial();pe!=null&&(pe.hasRenderTargetTextures&&pe.getRenderTargetTextures!=null&&this._processedMaterials.indexOf(pe)===-1&&(this._processedMaterials.push(pe),this._renderTargets.concatWithNoDuplicate(pe.getRenderTargetTextures())),this._renderingManager.dispatch(H,X,pe))}},q.prototype.freeProcessedMaterials=function(){this._processedMaterials.dispose()},Object.defineProperty(q.prototype,"blockfreeActiveMeshesAndRenderingGroups",{get:function(){return this._preventFreeActiveMeshesAndRenderingGroups},set:function(H){this._preventFreeActiveMeshesAndRenderingGroups!==H&&(H&&(this.freeActiveMeshes(),this.freeRenderingGroups()),this._preventFreeActiveMeshesAndRenderingGroups=H)},enumerable:!1,configurable:!0}),q.prototype.freeActiveMeshes=function(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._activeMeshes.dispose(),this.activeCamera&&this.activeCamera._activeMeshes&&this.activeCamera._activeMeshes.dispose(),this.activeCameras))for(var H=0;H<this.activeCameras.length;H++){var X=this.activeCameras[H];X&&X._activeMeshes&&X._activeMeshes.dispose()}},q.prototype.freeRenderingGroups=function(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._renderingManager&&this._renderingManager.freeRenderingGroups(),this.textures))for(var H=0;H<this.textures.length;H++){var X=this.textures[H];X&&X.renderList&&X.freeRenderingGroups()}},q.prototype._isInIntermediateRendering=function(){return this._intermediateRendering},q.prototype.freezeActiveMeshes=function(H,X,J){var Q=this;return H===void 0&&(H=!1),this.executeWhenReady(function(){if(Q.activeCamera){Q._frustumPlanes||Q.setTransformMatrix(Q.activeCamera.getViewMatrix(),Q.activeCamera.getProjectionMatrix()),Q._evaluateActiveMeshes(),Q._activeMeshesFrozen=!0,Q._skipEvaluateActiveMeshesCompletely=H;for(var ee=0;ee<Q._activeMeshes.length;ee++)Q._activeMeshes.data[ee]._freeze();X&&X()}else J&&J("No active camera found")}),this},q.prototype.unfreezeActiveMeshes=function(){for(var H=0;H<this.meshes.length;H++){var X=this.meshes[H];X._internalAbstractMeshDataInfo&&(X._internalAbstractMeshDataInfo._isActive=!1)}for(H=0;H<this._activeMeshes.length;H++)this._activeMeshes.data[H]._unFreeze();return this._activeMeshesFrozen=!1,this},q.prototype._evaluateActiveMeshes=function(){if(this._activeMeshesFrozen&&this._activeMeshes.length){if(!this._skipEvaluateActiveMeshesCompletely)for(var H=this._activeMeshes.length,X=0;X<H;X++)(ve=this._activeMeshes.data[X]).computeWorldMatrix();if(this._activeParticleSystems){var J=this._activeParticleSystems.length;for(X=0;X<J;X++)this._activeParticleSystems.data[X].animate()}}else if(this.activeCamera){this.onBeforeActiveMeshesEvaluationObservable.notifyObservers(this),this.activeCamera._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset();for(var Q=0,ee=this._beforeEvaluateActiveMeshStage;Q<ee.length;Q++)ee[Q].action();var pe=this.getActiveMeshCandidates(),Te=pe.length;for(X=0;X<Te;X++){var ve;if((ve=pe.data[X])._internalAbstractMeshDataInfo._currentLODIsUpToDate=!1,!ve.isBlocked&&(this._totalVertices.addCount(ve.getTotalVertices(),!1),ve.isReady()&&ve.isEnabled()&&ve.scaling.lengthSquared()!==0)){ve.computeWorldMatrix(),ve.actionManager&&ve.actionManager.hasSpecificTriggers2(L.a.ACTION_OnIntersectionEnterTrigger,L.a.ACTION_OnIntersectionExitTrigger)&&this._meshesForIntersections.pushNoDuplicate(ve);var he=this.customLODSelector?this.customLODSelector(ve,this.activeCamera):ve.getLOD(this.activeCamera);if(ve._internalAbstractMeshDataInfo._currentLOD=he,ve._internalAbstractMeshDataInfo._currentLODIsUpToDate=!0,he!=null&&(he!==ve&&he.billboardMode!==p.a.BILLBOARDMODE_NONE&&he.computeWorldMatrix(),ve._preActivate(),ve.isVisible&&ve.visibility>0&&(ve.layerMask&this.activeCamera.layerMask)!=0&&(this._skipFrustumClipping||ve.alwaysSelectAsActiveMesh||ve.isInFrustum(this._frustumPlanes)))){this._activeMeshes.push(ve),this.activeCamera._activeMeshes.push(ve),he!==ve&&he._activate(this._renderId,!1);for(var be=0,xe=this._preActiveMeshStage;be<xe.length;be++)xe[be].action(ve);ve._activate(this._renderId,!1)&&(ve.isAnInstance?ve._internalAbstractMeshDataInfo._actAsRegularMesh&&(he=ve):he._internalAbstractMeshDataInfo._onlyForInstances=!1,he._internalAbstractMeshDataInfo._isActive=!0,this._activeMesh(ve,he)),ve._postActivate()}}}if(this.onAfterActiveMeshesEvaluationObservable.notifyObservers(this),this.particlesEnabled){this.onBeforeParticlesRenderingObservable.notifyObservers(this);for(var Se=0;Se<this.particleSystems.length;Se++){var Ue=this.particleSystems[Se];if(Ue.isStarted()&&Ue.emitter){var We=Ue.emitter;We.position&&!We.isEnabled()||(this._activeParticleSystems.push(Ue),Ue.animate(),this._renderingManager.dispatchParticles(Ue))}}this.onAfterParticlesRenderingObservable.notifyObservers(this)}}},q.prototype._activeMesh=function(H,X){if(this._skeletonsEnabled&&X.skeleton!==null&&X.skeleton!==void 0&&(this._activeSkeletons.pushNoDuplicate(X.skeleton)&&X.skeleton.prepare(),X.computeBonesUsingShaders||this._softwareSkinnedMeshes.pushNoDuplicate(X)),X!=null&&X.subMeshes!==void 0&&X.subMeshes!==null&&X.subMeshes.length>0)for(var J=this.getActiveSubMeshCandidates(X),Q=J.length,ee=0;ee<Q;ee++){var pe=J.data[ee];this._evaluateSubMesh(pe,X,H)}},q.prototype.updateTransformMatrix=function(H){this.activeCamera&&this.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix(H))},q.prototype._bindFrameBuffer=function(){if(this.activeCamera&&this.activeCamera._multiviewTexture)this.activeCamera._multiviewTexture._bindFrameBuffer();else if(this.activeCamera&&this.activeCamera.outputRenderTarget)if(this.getEngine().getCaps().multiview&&this.activeCamera.outputRenderTarget&&this.activeCamera.outputRenderTarget.getViewCount()>1)this.activeCamera.outputRenderTarget._bindFrameBuffer();else{var H=this.activeCamera.outputRenderTarget.getInternalTexture();H?this.getEngine().bindFramebuffer(H):Y.a.Error("Camera contains invalid customDefaultRenderTarget")}else this.getEngine().restoreDefaultFramebuffer()},q.prototype._renderForCamera=function(H,X){if(!H||!H._skipRendering){var J=this._engine;if(this._activeCamera=H,!this.activeCamera)throw new Error("Active camera not set");J.setViewport(this.activeCamera.viewport),this.resetCachedMaterial(),this._renderId++,this.getEngine().getCaps().multiview&&H.outputRenderTarget&&H.outputRenderTarget.getViewCount()>1?this.setTransformMatrix(H._rigCameras[0].getViewMatrix(),H._rigCameras[0].getProjectionMatrix(),H._rigCameras[1].getViewMatrix(),H._rigCameras[1].getProjectionMatrix()):this.updateTransformMatrix(),this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera),this._evaluateActiveMeshes();for(var Q=0;Q<this._softwareSkinnedMeshes.length;Q++){var ee=this._softwareSkinnedMeshes.data[Q];ee.applySkeleton(ee.skeleton)}this.onBeforeRenderTargetsRenderObservable.notifyObservers(this),H.customRenderTargets&&H.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(H.customRenderTargets),X&&X.customRenderTargets&&X.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(X.customRenderTargets);for(var pe=0,Te=this._gatherActiveCameraRenderTargetsStage;pe<Te.length;pe++)Te[pe].action(this._renderTargets);var ve=!1;if(this.renderTargetsEnabled){if(this._intermediateRendering=!0,this._renderTargets.length>0){m.b.StartPerformanceCounter("Render targets",this._renderTargets.length>0);for(var he=0;he<this._renderTargets.length;he++){var be=this._renderTargets.data[he];if(be._shouldRender()){this._renderId++;var xe=be.activeCamera&&be.activeCamera!==this.activeCamera;be.render(xe,this.dumpNextRenderTargets),ve=!0}}m.b.EndPerformanceCounter("Render targets",this._renderTargets.length>0),this._renderId++}for(var Se=0,Ue=this._cameraDrawRenderTargetStage;Se<Ue.length;Se++)ve=Ue[Se].action(this.activeCamera)||ve;this._intermediateRendering=!1,this.activeCamera&&this.activeCamera.outputRenderTarget&&(ve=!0)}ve&&!this.prePass&&this._bindFrameBuffer(),this.onAfterRenderTargetsRenderObservable.notifyObservers(this),!this.postProcessManager||H._multiviewTexture||this.prePass||this.postProcessManager._prepareFrame();for(var We=0,Ze=this._beforeCameraDrawStage;We<Ze.length;We++)Ze[We].action(this.activeCamera);this.onBeforeDrawPhaseObservable.notifyObservers(this),this._renderingManager.render(null,null,!0,!0),this.onAfterDrawPhaseObservable.notifyObservers(this);for(var Qe=0,Xe=this._afterCameraDrawStage;Qe<Xe.length;Qe++)Xe[Qe].action(this.activeCamera);if(this.postProcessManager&&!H._multiviewTexture){var nt=H.outputRenderTarget?H.outputRenderTarget.getInternalTexture():void 0;this.postProcessManager._finalizeFrame(H.isIntermediate,nt)}this._renderTargets.reset(),this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera)}},q.prototype._processSubCameras=function(H){if(H.cameraRigMode===P.a.RIG_MODE_NONE||H.outputRenderTarget&&H.outputRenderTarget.getViewCount()>1&&this.getEngine().getCaps().multiview)return this._renderForCamera(H),void this.onAfterRenderCameraObservable.notifyObservers(H);if(H._useMultiviewToSingleView)this._renderMultiviewToSingleView(H);else for(var X=0;X<H._rigCameras.length;X++)this._renderForCamera(H._rigCameras[X],H);this._activeCamera=H,this.setTransformMatrix(this._activeCamera.getViewMatrix(),this._activeCamera.getProjectionMatrix()),this.onAfterRenderCameraObservable.notifyObservers(H)},q.prototype._checkIntersections=function(){for(var H=0;H<this._meshesForIntersections.length;H++){var X=this._meshesForIntersections.data[H];if(X.actionManager)for(var J=0;X.actionManager&&J<X.actionManager.actions.length;J++){var Q=X.actionManager.actions[J];if(Q.trigger===L.a.ACTION_OnIntersectionEnterTrigger||Q.trigger===L.a.ACTION_OnIntersectionExitTrigger){var ee=Q.getTriggerParameter(),pe=ee instanceof x.a?ee:ee.mesh,Te=pe.intersectsMesh(X,ee.usePreciseIntersection),ve=X._intersectionsInProgress.indexOf(pe);Te&&ve===-1?Q.trigger===L.a.ACTION_OnIntersectionEnterTrigger?(Q._executeCurrent(R.a.CreateNew(X,void 0,pe)),X._intersectionsInProgress.push(pe)):Q.trigger===L.a.ACTION_OnIntersectionExitTrigger&&X._intersectionsInProgress.push(pe):!Te&&ve>-1&&(Q.trigger===L.a.ACTION_OnIntersectionExitTrigger&&Q._executeCurrent(R.a.CreateNew(X,void 0,pe)),X.actionManager.hasSpecificTrigger(L.a.ACTION_OnIntersectionExitTrigger,function(he){var be=he instanceof x.a?he:he.mesh;return pe===be})&&Q.trigger!==L.a.ACTION_OnIntersectionExitTrigger||X._intersectionsInProgress.splice(ve,1))}}}},q.prototype._advancePhysicsEngineStep=function(H){},q.prototype._animate=function(){},q.prototype.animate=function(){if(this._engine.isDeterministicLockStep()){var H=Math.max(q.MinDeltaTime,Math.min(this._engine.getDeltaTime(),q.MaxDeltaTime))+this._timeAccumulator,X=this._engine.getTimeStep(),J=1e3/X/1e3,Q=0,ee=this._engine.getLockstepMaxSteps(),pe=Math.floor(H/X);for(pe=Math.min(pe,ee);H>0&&Q<pe;)this.onBeforeStepObservable.notifyObservers(this),this._animationRatio=X*J,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(X),this.onAfterStepObservable.notifyObservers(this),this._currentStepId++,Q++,H-=X;this._timeAccumulator=H<0?0:H}else H=this.useConstantAnimationDeltaTime?16:Math.max(q.MinDeltaTime,Math.min(this._engine.getDeltaTime(),q.MaxDeltaTime)),this._animationRatio=.06*H,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(H)},q.prototype.render=function(H,X){if(H===void 0&&(H=!0),X===void 0&&(X=!1),!this.isDisposed){this.onReadyObservable.hasObservers()&&this._executeWhenReadyTimeoutId===-1&&this._checkIsReady(),this._frameId++,this._registerTransientComponents(),this._activeParticles.fetchNewFrame(),this._totalVertices.fetchNewFrame(),this._activeIndices.fetchNewFrame(),this._activeBones.fetchNewFrame(),this._meshesForIntersections.reset(),this.resetCachedMaterial(),this.onBeforeAnimationsObservable.notifyObservers(this),this.actionManager&&this.actionManager.processTrigger(L.a.ACTION_OnEveryFrameTrigger),X||this.animate();for(var J=0,Q=this._beforeCameraUpdateStage;J<Q.length;J++)Q[J].action();if(H){if(this.activeCameras&&this.activeCameras.length>0)for(var ee=0;ee<this.activeCameras.length;ee++){var pe=this.activeCameras[ee];if(pe.update(),pe.cameraRigMode!==P.a.RIG_MODE_NONE)for(var Te=0;Te<pe._rigCameras.length;Te++)pe._rigCameras[Te].update()}else if(this.activeCamera&&(this.activeCamera.update(),this.activeCamera.cameraRigMode!==P.a.RIG_MODE_NONE))for(Te=0;Te<this.activeCamera._rigCameras.length;Te++)this.activeCamera._rigCameras[Te].update()}this.onBeforeRenderObservable.notifyObservers(this),this.onBeforeRenderTargetsRenderObservable.notifyObservers(this);var ve=this.getEngine(),he=this.activeCamera;if(this.renderTargetsEnabled){m.b.StartPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!0;for(var be=0;be<this.customRenderTargets.length;be++){var xe=this.customRenderTargets[be];if(xe._shouldRender()){if(this._renderId++,this.activeCamera=xe.activeCamera||this.activeCamera,!this.activeCamera)throw new Error("Active camera not set");ve.setViewport(this.activeCamera.viewport),this.updateTransformMatrix(),xe.render(he!==this.activeCamera,this.dumpNextRenderTargets)}}m.b.EndPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!1,this._renderId++}this.activeCamera=he,this._activeCamera&&this._activeCamera.cameraRigMode!==P.a.RIG_MODE_CUSTOM&&!this.prePass&&this._bindFrameBuffer(),this.onAfterRenderTargetsRenderObservable.notifyObservers(this);for(var Se=0,Ue=this._beforeClearStage;Se<Ue.length;Se++)Ue[Se].action();!this.autoClearDepthAndStencil&&!this.autoClear||this.prePass||this._engine.clear(this.clearColor,this.autoClear||this.forceWireframe||this.forcePointsCloud,this.autoClearDepthAndStencil,this.autoClearDepthAndStencil);for(var We=0,Ze=this._gatherRenderTargetsStage;We<Ze.length;We++)Ze[We].action(this._renderTargets);if(this.activeCameras&&this.activeCameras.length>0)for(ee=0;ee<this.activeCameras.length;ee++)ee>0&&this._engine.clear(null,!1,!0,!0),this._processSubCameras(this.activeCameras[ee]);else{if(!this.activeCamera)throw new Error("No camera defined");this._processSubCameras(this.activeCamera)}this._checkIntersections();for(var Qe=0,Xe=this._afterRenderStage;Qe<Xe.length;Qe++)Xe[Qe].action();if(this.afterRender&&this.afterRender(),this.onAfterRenderObservable.notifyObservers(this),this._toBeDisposed.length){for(Te=0;Te<this._toBeDisposed.length;Te++){var nt=this._toBeDisposed[Te];nt&&nt.dispose()}this._toBeDisposed=[]}this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=!1),this._activeBones.addCount(0,!0),this._activeIndices.addCount(0,!0),this._activeParticles.addCount(0,!0)}},q.prototype.freezeMaterials=function(){for(var H=0;H<this.materials.length;H++)this.materials[H].freeze()},q.prototype.unfreezeMaterials=function(){for(var H=0;H<this.materials.length;H++)this.materials[H].unfreeze()},q.prototype.dispose=function(){this.beforeRender=null,this.afterRender=null,W.a._LastCreatedScene===this&&(W.a._LastCreatedScene=null),this.skeletons=[],this.morphTargetManagers=[],this._transientComponents=[],this._isReadyForMeshStage.clear(),this._beforeEvaluateActiveMeshStage.clear(),this._evaluateSubMeshStage.clear(),this._preActiveMeshStage.clear(),this._cameraDrawRenderTargetStage.clear(),this._beforeCameraDrawStage.clear(),this._beforeRenderTargetDrawStage.clear(),this._beforeRenderingGroupDrawStage.clear(),this._beforeRenderingMeshStage.clear(),this._afterRenderingMeshStage.clear(),this._afterRenderingGroupDrawStage.clear(),this._afterCameraDrawStage.clear(),this._afterRenderTargetDrawStage.clear(),this._afterRenderStage.clear(),this._beforeCameraUpdateStage.clear(),this._beforeClearStage.clear(),this._gatherRenderTargetsStage.clear(),this._gatherActiveCameraRenderTargetsStage.clear(),this._pointerMoveStage.clear(),this._pointerDownStage.clear(),this._pointerUpStage.clear();for(var H=0,X=this._components;H<X.length;H++)X[H].dispose();this.importedMeshesFiles=new Array,this.stopAllAnimations&&this.stopAllAnimations(),this.resetCachedMaterial(),this.activeCamera&&(this.activeCamera._activeMeshes.dispose(),this.activeCamera=null),this._activeMeshes.dispose(),this._renderingManager.dispose(),this._processedMaterials.dispose(),this._activeParticleSystems.dispose(),this._activeSkeletons.dispose(),this._softwareSkinnedMeshes.dispose(),this._renderTargets.dispose(),this._registeredForLateAnimationBindings.dispose(),this._meshesForIntersections.dispose(),this._toBeDisposed=[];for(var J=0,Q=this._activeRequests;J<Q.length;J++)Q[J].abort();var ee;if(this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderTargetsRenderObservable.clear(),this.onAfterRenderTargetsRenderObservable.clear(),this.onAfterStepObservable.clear(),this.onBeforeStepObservable.clear(),this.onBeforeActiveMeshesEvaluationObservable.clear(),this.onAfterActiveMeshesEvaluationObservable.clear(),this.onBeforeParticlesRenderingObservable.clear(),this.onAfterParticlesRenderingObservable.clear(),this.onBeforeDrawPhaseObservable.clear(),this.onAfterDrawPhaseObservable.clear(),this.onBeforeAnimationsObservable.clear(),this.onAfterAnimationsObservable.clear(),this.onDataLoadedObservable.clear(),this.onBeforeRenderingGroupObservable.clear(),this.onAfterRenderingGroupObservable.clear(),this.onMeshImportedObservable.clear(),this.onBeforeCameraRenderObservable.clear(),this.onAfterCameraRenderObservable.clear(),this.onReadyObservable.clear(),this.onNewCameraAddedObservable.clear(),this.onCameraRemovedObservable.clear(),this.onNewLightAddedObservable.clear(),this.onLightRemovedObservable.clear(),this.onNewGeometryAddedObservable.clear(),this.onGeometryRemovedObservable.clear(),this.onNewTransformNodeAddedObservable.clear(),this.onTransformNodeRemovedObservable.clear(),this.onNewMeshAddedObservable.clear(),this.onMeshRemovedObservable.clear(),this.onNewSkeletonAddedObservable.clear(),this.onSkeletonRemovedObservable.clear(),this.onNewMaterialAddedObservable.clear(),this.onNewMultiMaterialAddedObservable.clear(),this.onMaterialRemovedObservable.clear(),this.onMultiMaterialRemovedObservable.clear(),this.onNewTextureAddedObservable.clear(),this.onTextureRemovedObservable.clear(),this.onPrePointerObservable.clear(),this.onPointerObservable.clear(),this.onPreKeyboardObservable.clear(),this.onKeyboardObservable.clear(),this.onActiveCameraChanged.clear(),this.detachControl(),this._engine.getInputElement())for(ee=0;ee<this.cameras.length;ee++)this.cameras[ee].detachControl();for(;this.animationGroups.length;)this.animationGroups[0].dispose();for(;this.lights.length;)this.lights[0].dispose();for(;this.meshes.length;)this.meshes[0].dispose(!0);for(;this.transformNodes.length;)this.transformNodes[0].dispose(!0);for(;this.cameras.length;)this.cameras[0].dispose();for(this._defaultMaterial&&this._defaultMaterial.dispose();this.multiMaterials.length;)this.multiMaterials[0].dispose();for(;this.materials.length;)this.materials[0].dispose();for(;this.particleSystems.length;)this.particleSystems[0].dispose();for(;this.postProcesses.length;)this.postProcesses[0].dispose();for(;this.textures.length;)this.textures[0].dispose();this._sceneUbo.dispose(),this._multiviewSceneUbo&&this._multiviewSceneUbo.dispose(),this.postProcessManager.dispose(),(ee=this._engine.scenes.indexOf(this))>-1&&this._engine.scenes.splice(ee,1),this._engine.wipeCaches(!0),this._isDisposed=!0},Object.defineProperty(q.prototype,"isDisposed",{get:function(){return this._isDisposed},enumerable:!1,configurable:!0}),q.prototype.clearCachedVertexData=function(){for(var H=0;H<this.meshes.length;H++){var X=this.meshes[H].geometry;if(X)for(var J in X._indices=[],X._vertexBuffers)X._vertexBuffers.hasOwnProperty(J)&&(X._vertexBuffers[J]._buffer._data=null)}},q.prototype.cleanCachedTextureBuffer=function(){for(var H=0,X=this.textures;H<X.length;H++){var J=X[H];J._buffer&&(J._buffer=null)}},q.prototype.getWorldExtends=function(H){var X=new b.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),J=new b.e(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return H=H||function(){return!0},this.meshes.filter(H).forEach(function(Q){if(Q.computeWorldMatrix(!0),Q.subMeshes&&Q.subMeshes.length!==0&&!Q.infiniteDistance){var ee=Q.getBoundingInfo(),pe=ee.boundingBox.minimumWorld,Te=ee.boundingBox.maximumWorld;b.e.CheckExtends(pe,X,J),b.e.CheckExtends(Te,X,J)}}),{min:X,max:J}},q.prototype.createPickingRay=function(H,X,J,Q,ee){throw re.a.WarnImport("Ray")},q.prototype.createPickingRayToRef=function(H,X,J,Q,ee,pe){throw re.a.WarnImport("Ray")},q.prototype.createPickingRayInCameraSpace=function(H,X,J){throw re.a.WarnImport("Ray")},q.prototype.createPickingRayInCameraSpaceToRef=function(H,X,J,Q){throw re.a.WarnImport("Ray")},q.prototype.pick=function(H,X,J,Q,ee,pe){var Te=new O.a;return Te._pickingUnavailable=!0,Te},q.prototype.pickWithBoundingInfo=function(H,X,J,Q,ee){var pe=new O.a;return pe._pickingUnavailable=!0,pe},q.prototype.pickWithRay=function(H,X,J,Q){throw re.a.WarnImport("Ray")},q.prototype.multiPick=function(H,X,J,Q,ee){throw re.a.WarnImport("Ray")},q.prototype.multiPickWithRay=function(H,X,J){throw re.a.WarnImport("Ray")},q.prototype.setPointerOverMesh=function(H,X){this._inputManager.setPointerOverMesh(H,X)},q.prototype.getPointerOverMesh=function(){return this._inputManager.getPointerOverMesh()},q.prototype._rebuildGeometries=function(){for(var H=0,X=this.geometries;H<X.length;H++)X[H]._rebuild();for(var J=0,Q=this.meshes;J<Q.length;J++)Q[J]._rebuild();this.postProcessManager&&this.postProcessManager._rebuild();for(var ee=0,pe=this._components;ee<pe.length;ee++)pe[ee].rebuild();for(var Te=0,ve=this.particleSystems;Te<ve.length;Te++)ve[Te].rebuild()},q.prototype._rebuildTextures=function(){for(var H=0,X=this.textures;H<X.length;H++)X[H]._rebuild();this.markAllMaterialsAsDirty(L.a.MATERIAL_TextureDirtyFlag)},q.prototype._getByTags=function(H,X,J){if(X===void 0)return H;var Q=[];for(var ee in J=J||function(Te){},H){var pe=H[ee];I.a&&I.a.MatchesQuery(pe,X)&&(Q.push(pe),J(pe))}return Q},q.prototype.getMeshesByTags=function(H,X){return this._getByTags(this.meshes,H,X)},q.prototype.getCamerasByTags=function(H,X){return this._getByTags(this.cameras,H,X)},q.prototype.getLightsByTags=function(H,X){return this._getByTags(this.lights,H,X)},q.prototype.getMaterialByTags=function(H,X){return this._getByTags(this.materials,H,X).concat(this._getByTags(this.multiMaterials,H,X))},q.prototype.getTransformNodesByTags=function(H,X){return this._getByTags(this.transformNodes,H,X)},q.prototype.setRenderingOrder=function(H,X,J,Q){X===void 0&&(X=null),J===void 0&&(J=null),Q===void 0&&(Q=null),this._renderingManager.setRenderingOrder(H,X,J,Q)},q.prototype.setRenderingAutoClearDepthStencil=function(H,X,J,Q){J===void 0&&(J=!0),Q===void 0&&(Q=!0),this._renderingManager.setRenderingAutoClearDepthStencil(H,X,J,Q)},q.prototype.getAutoClearDepthStencilSetup=function(H){return this._renderingManager.getAutoClearDepthStencilSetup(H)},Object.defineProperty(q.prototype,"blockMaterialDirtyMechanism",{get:function(){return this._blockMaterialDirtyMechanism},set:function(H){this._blockMaterialDirtyMechanism!==H&&(this._blockMaterialDirtyMechanism=H,H||this.markAllMaterialsAsDirty(L.a.MATERIAL_AllDirtyFlag))},enumerable:!1,configurable:!0}),q.prototype.markAllMaterialsAsDirty=function(H,X){if(!this._blockMaterialDirtyMechanism)for(var J=0,Q=this.materials;J<Q.length;J++){var ee=Q[J];X&&!X(ee)||ee.markAsDirty(H)}},q.prototype._loadFile=function(H,X,J,Q,ee,pe){var Te=this,ve=$.a.LoadFile(H,X,J,Q?this.offlineProvider:void 0,ee,pe);return this._activeRequests.push(ve),ve.onCompleteObservable.add(function(he){Te._activeRequests.splice(Te._activeRequests.indexOf(he),1)}),ve},q.prototype._loadFileAsync=function(H,X,J,Q){var ee=this;return new Promise(function(pe,Te){ee._loadFile(H,function(ve){pe(ve)},X,J,Q,function(ve,he){Te(he)})})},q.prototype._requestFile=function(H,X,J,Q,ee,pe,Te){var ve=this,he=$.a.RequestFile(H,X,J,Q?this.offlineProvider:void 0,ee,pe,Te);return this._activeRequests.push(he),he.onCompleteObservable.add(function(be){ve._activeRequests.splice(ve._activeRequests.indexOf(be),1)}),he},q.prototype._requestFileAsync=function(H,X,J,Q,ee){var pe=this;return new Promise(function(Te,ve){pe._requestFile(H,function(he){Te(he)},X,J,Q,function(he){ve(he)},ee)})},q.prototype._readFile=function(H,X,J,Q,ee){var pe=this,Te=$.a.ReadFile(H,X,J,Q,ee);return this._activeRequests.push(Te),Te.onCompleteObservable.add(function(ve){pe._activeRequests.splice(pe._activeRequests.indexOf(ve),1)}),Te},q.prototype._readFileAsync=function(H,X,J){var Q=this;return new Promise(function(ee,pe){Q._readFile(H,function(Te){ee(Te)},X,J,function(Te){pe(Te)})})},q.FOGMODE_NONE=0,q.FOGMODE_EXP=1,q.FOGMODE_EXP2=2,q.FOGMODE_LINEAR=3,q.MinDeltaTime=1,q.MaxDeltaTime=1e3,q}(A.a)},function(h,s,c){c.d(s,"a",function(){return E});var E=function(){function m(){}return m.WarnImport=function(S){return S+" needs to be imported before as it contains a side-effect required by your code."},m}()},function(h,s,c){c.d(s,"a",function(){return E});var E=function(){function m(){}return Object.defineProperty(m,"LastCreatedEngine",{get:function(){return this.Instances.length===0?null:this.Instances[this.Instances.length-1]},enumerable:!1,configurable:!0}),Object.defineProperty(m,"LastCreatedScene",{get:function(){return this._LastCreatedScene},enumerable:!1,configurable:!0}),m.Instances=new Array,m._LastCreatedScene=null,m.UseFallbackTexture=!0,m.FallbackTexture="",m}()},function(h,s,c){c.d(s,"c",function(){return E}),c.d(s,"a",function(){return d}),c.d(s,"b",function(){return S});var E,m=c(0);(function(M){M[M.LOCAL=0]="LOCAL",M[M.WORLD=1]="WORLD",M[M.BONE=2]="BONE"})(E||(E={}));var S,d=function(){function M(){}return M.X=new m.e(1,0,0),M.Y=new m.e(0,1,0),M.Z=new m.e(0,0,1),M}();(function(M){M[M.X=0]="X",M[M.Y=1]="Y",M[M.Z=2]="Z"})(S||(S={}))},function(h,s,c){c.d(s,"a",function(){return T});var E=c(1),m=c(3),S=c(33),d=c(12),M=c(6),C=c(0),I=c(29),b=c(8),p=c(11),x=c(21),P=c(58),A=c(90),T=function(_){function g(O,R,N,V){V===void 0&&(V=!0);var U=_.call(this,O,N)||this;return U._position=C.e.Zero(),U._upVector=C.e.Up(),U.orthoLeft=null,U.orthoRight=null,U.orthoBottom=null,U.orthoTop=null,U.fov=.8,U.minZ=1,U.maxZ=1e4,U.inertia=.9,U.mode=g.PERSPECTIVE_CAMERA,U.isIntermediate=!1,U.viewport=new P.a(0,0,1,1),U.layerMask=268435455,U.fovMode=g.FOVMODE_VERTICAL_FIXED,U.cameraRigMode=g.RIG_MODE_NONE,U.customRenderTargets=new Array,U.outputRenderTarget=null,U.onViewMatrixChangedObservable=new M.c,U.onProjectionMatrixChangedObservable=new M.c,U.onAfterCheckInputsObservable=new M.c,U.onRestoreStateObservable=new M.c,U.isRigCamera=!1,U._rigCameras=new Array,U._webvrViewMatrix=C.a.Identity(),U._skipRendering=!1,U._projectionMatrix=new C.a,U._postProcesses=new Array,U._activeMeshes=new S.a(256),U._globalPosition=C.e.Zero(),U._computedViewMatrix=C.a.Identity(),U._doNotComputeProjectionMatrix=!1,U._transformMatrix=C.a.Zero(),U._refreshFrustumPlanes=!0,U._isCamera=!0,U._isLeftCamera=!1,U._isRightCamera=!1,U.getScene().addCamera(U),V&&!U.getScene().activeCamera&&(U.getScene().activeCamera=U),U.position=R,U}return Object(E.d)(g,_),Object.defineProperty(g.prototype,"position",{get:function(){return this._position},set:function(O){this._position=O},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"upVector",{get:function(){return this._upVector},set:function(O){this._upVector=O},enumerable:!1,configurable:!0}),g.prototype.storeState=function(){return this._stateStored=!0,this._storedFov=this.fov,this},g.prototype._restoreStateValues=function(){return!!this._stateStored&&(this.fov=this._storedFov,!0)},g.prototype.restoreState=function(){return!!this._restoreStateValues()&&(this.onRestoreStateObservable.notifyObservers(this),!0)},g.prototype.getClassName=function(){return"Camera"},g.prototype.toString=function(O){var R="Name: "+this.name;if(R+=", type: "+this.getClassName(),this.animations)for(var N=0;N<this.animations.length;N++)R+=", animation[0]: "+this.animations[N].toString(O);return R},Object.defineProperty(g.prototype,"globalPosition",{get:function(){return this._globalPosition},enumerable:!1,configurable:!0}),g.prototype.getActiveMeshes=function(){return this._activeMeshes},g.prototype.isActiveMesh=function(O){return this._activeMeshes.indexOf(O)!==-1},g.prototype.isReady=function(O){if(O===void 0&&(O=!1),O)for(var R=0,N=this._postProcesses;R<N.length;R++){var V=N[R];if(V&&!V.isReady())return!1}return _.prototype.isReady.call(this,O)},g.prototype._initCache=function(){_.prototype._initCache.call(this),this._cache.position=new C.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new C.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.minZ=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0},g.prototype._updateCache=function(O){O||_.prototype._updateCache.call(this),this._cache.position.copyFrom(this.position),this._cache.upVector.copyFrom(this.upVector)},g.prototype._isSynchronized=function(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()},g.prototype._isSynchronizedViewMatrix=function(){return!!_.prototype._isSynchronized.call(this)&&this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent()},g.prototype._isSynchronizedProjectionMatrix=function(){var O=this._cache.mode===this.mode&&this._cache.minZ===this.minZ&&this._cache.maxZ===this.maxZ;if(!O)return!1;var R=this.getEngine();return O=this.mode===g.PERSPECTIVE_CAMERA?this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===R.getAspectRatio(this):this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===R.getRenderWidth()&&this._cache.renderHeight===R.getRenderHeight()},g.prototype.attachControl=function(O,R){},g.prototype.detachControl=function(O){},g.prototype.update=function(){this._checkInputs(),this.cameraRigMode!==g.RIG_MODE_NONE&&this._updateRigCameras()},g.prototype._checkInputs=function(){this.onAfterCheckInputsObservable.notifyObservers(this)},Object.defineProperty(g.prototype,"rigCameras",{get:function(){return this._rigCameras},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"rigPostProcess",{get:function(){return this._rigPostProcess},enumerable:!1,configurable:!0}),g.prototype._getFirstPostProcess=function(){for(var O=0;O<this._postProcesses.length;O++)if(this._postProcesses[O]!==null)return this._postProcesses[O];return null},g.prototype._cascadePostProcessesToRigCams=function(){var O=this._getFirstPostProcess();O&&O.markTextureDirty();for(var R=0,N=this._rigCameras.length;R<N;R++){var V=this._rigCameras[R],U=V._rigPostProcess;U?(U.getEffectName()==="pass"&&(V.isIntermediate=this._postProcesses.length===0),V._postProcesses=this._postProcesses.slice(0).concat(U),U.markTextureDirty()):V._postProcesses=this._postProcesses.slice(0)}},g.prototype.attachPostProcess=function(O,R){return R===void 0&&(R=null),!O.isReusable()&&this._postProcesses.indexOf(O)>-1?(b.a.Error("You're trying to reuse a post process not defined as reusable."),0):(R==null||R<0?this._postProcesses.push(O):this._postProcesses[R]===null?this._postProcesses[R]=O:this._postProcesses.splice(R,0,O),this._cascadePostProcessesToRigCams(),this._scene.prePassRenderer&&this._scene.prePassRenderer.markAsDirty(),this._postProcesses.indexOf(O))},g.prototype.detachPostProcess=function(O){var R=this._postProcesses.indexOf(O);R!==-1&&(this._postProcesses[R]=null),this._scene.prePassRenderer&&this._scene.prePassRenderer.markAsDirty(),this._cascadePostProcessesToRigCams()},g.prototype.getWorldMatrix=function(){return this._isSynchronizedViewMatrix()||this.getViewMatrix(),this._worldMatrix},g.prototype._getViewMatrix=function(){return C.a.Identity()},g.prototype.getViewMatrix=function(O){return!O&&this._isSynchronizedViewMatrix()||(this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.getScene().getRenderId(),this._childUpdateId++,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.parent&&this.parent.onViewMatrixChangedObservable&&this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix)),this._computedViewMatrix},g.prototype.freezeProjectionMatrix=function(O){this._doNotComputeProjectionMatrix=!0,O!==void 0&&(this._projectionMatrix=O)},g.prototype.unfreezeProjectionMatrix=function(){this._doNotComputeProjectionMatrix=!1},g.prototype.getProjectionMatrix=function(O){var R,N,V,U,L,j,Y,W;if(this._doNotComputeProjectionMatrix||!O&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.minZ=this.minZ,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;var re=this.getEngine(),ne=this.getScene();if(this.mode===g.PERSPECTIVE_CAMERA){this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=re.getAspectRatio(this),this.minZ<=0&&(this.minZ=.1);var ge=re.useReverseDepthBuffer;(ne.useRightHandedSystem?ge?C.a.PerspectiveFovReverseRHToRef:C.a.PerspectiveFovRHToRef:ge?C.a.PerspectiveFovReverseLHToRef:C.a.PerspectiveFovLHToRef)(this.fov,re.getAspectRatio(this),this.minZ,this.maxZ,this._projectionMatrix,this.fovMode===g.FOVMODE_VERTICAL_FIXED)}else{var _e=re.getRenderWidth()/2,ce=re.getRenderHeight()/2;ne.useRightHandedSystem?C.a.OrthoOffCenterRHToRef((R=this.orthoLeft)!==null&&R!==void 0?R:-_e,(N=this.orthoRight)!==null&&N!==void 0?N:_e,(V=this.orthoBottom)!==null&&V!==void 0?V:-ce,(U=this.orthoTop)!==null&&U!==void 0?U:ce,this.minZ,this.maxZ,this._projectionMatrix):C.a.OrthoOffCenterLHToRef((L=this.orthoLeft)!==null&&L!==void 0?L:-_e,(j=this.orthoRight)!==null&&j!==void 0?j:_e,(Y=this.orthoBottom)!==null&&Y!==void 0?Y:-ce,(W=this.orthoTop)!==null&&W!==void 0?W:ce,this.minZ,this.maxZ,this._projectionMatrix),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.renderWidth=re.getRenderWidth(),this._cache.renderHeight=re.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix},g.prototype.getTransformationMatrix=function(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix},g.prototype._updateFrustumPlanes=function(){this._refreshFrustumPlanes&&(this.getTransformationMatrix(),this._frustumPlanes?A.a.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=A.a.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)},g.prototype.isInFrustum=function(O,R){if(R===void 0&&(R=!1),this._updateFrustumPlanes(),R&&this.rigCameras.length>0){var N=!1;return this.rigCameras.forEach(function(V){V._updateFrustumPlanes(),N=N||O.isInFrustum(V._frustumPlanes)}),N}return O.isInFrustum(this._frustumPlanes)},g.prototype.isCompletelyInFrustum=function(O){return this._updateFrustumPlanes(),O.isCompletelyInFrustum(this._frustumPlanes)},g.prototype.getForwardRay=function(O,R,N){throw x.a.WarnImport("Ray")},g.prototype.getForwardRayToRef=function(O,R,N,V){throw x.a.WarnImport("Ray")},g.prototype.dispose=function(O,R){for(R===void 0&&(R=!1),this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.getScene().stopAnimation(this),this.getScene().removeCamera(this);this._rigCameras.length>0;){var N=this._rigCameras.pop();N&&N.dispose()}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses=[];else if(this.cameraRigMode!==g.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses=[];else for(var V=this._postProcesses.length;--V>=0;){var U=this._postProcesses[V];U&&U.dispose(this)}for(V=this.customRenderTargets.length;--V>=0;)this.customRenderTargets[V].dispose();this.customRenderTargets=[],this._activeMeshes.dispose(),_.prototype.dispose.call(this,O,R)},Object.defineProperty(g.prototype,"isLeftCamera",{get:function(){return this._isLeftCamera},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"isRightCamera",{get:function(){return this._isRightCamera},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"leftCamera",{get:function(){return this._rigCameras.length<1?null:this._rigCameras[0]},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"rightCamera",{get:function(){return this._rigCameras.length<2?null:this._rigCameras[1]},enumerable:!1,configurable:!0}),g.prototype.getLeftTarget=function(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()},g.prototype.getRightTarget=function(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()},g.prototype.setCameraRigMode=function(O,R){if(this.cameraRigMode!==O){for(;this._rigCameras.length>0;){var N=this._rigCameras.pop();N&&N.dispose()}if(this.cameraRigMode=O,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=R.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=d.b.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==g.RIG_MODE_NONE){var V=this.createRigCamera(this.name+"_L",0);V&&(V._isLeftCamera=!0);var U=this.createRigCamera(this.name+"_R",1);U&&(U._isRightCamera=!0),V&&U&&(this._rigCameras.push(V),this._rigCameras.push(U))}switch(this.cameraRigMode){case g.RIG_MODE_STEREOSCOPIC_ANAGLYPH:g._setStereoscopicAnaglyphRigMode(this);break;case g.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case g.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case g.RIG_MODE_STEREOSCOPIC_OVERUNDER:case g.RIG_MODE_STEREOSCOPIC_INTERLACED:g._setStereoscopicRigMode(this);break;case g.RIG_MODE_VR:g._setVRRigMode(this,R);break;case g.RIG_MODE_WEBVR:g._setWebVRRigMode(this,R)}this._cascadePostProcessesToRigCams(),this.update()}},g._setStereoscopicRigMode=function(O){throw"Import Cameras/RigModes/stereoscopicRigMode before using stereoscopic rig mode"},g._setStereoscopicAnaglyphRigMode=function(O){throw"Import Cameras/RigModes/stereoscopicAnaglyphRigMode before using stereoscopic anaglyph rig mode"},g._setVRRigMode=function(O,R){throw"Import Cameras/RigModes/vrRigMode before using VR rig mode"},g._setWebVRRigMode=function(O,R){throw"Import Cameras/RigModes/WebVRRigMode before using Web VR rig mode"},g.prototype._getVRProjectionMatrix=function(){return C.a.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.minZ,this.maxZ,this._cameraRigParams.vrWorkMatrix),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix},g.prototype._updateCameraRotationMatrix=function(){},g.prototype._updateWebVRCameraRotationMatrix=function(){},g.prototype._getWebVRProjectionMatrix=function(){return C.a.Identity()},g.prototype._getWebVRViewMatrix=function(){return C.a.Identity()},g.prototype.setCameraRigParameter=function(O,R){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[O]=R,O==="interaxialDistance"&&(this._cameraRigParams.stereoHalfAngle=d.b.ToRadians(R/.0637))},g.prototype.createRigCamera=function(O,R){return null},g.prototype._updateRigCameras=function(){for(var O=0;O<this._rigCameras.length;O++)this._rigCameras[O].minZ=this.minZ,this._rigCameras[O].maxZ=this.maxZ,this._rigCameras[O].fov=this.fov,this._rigCameras[O].upVector.copyFrom(this.upVector);this.cameraRigMode===g.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)},g.prototype._setupInputs=function(){},g.prototype.serialize=function(){var O=m.a.Serialize(this);return O.type=this.getClassName(),this.parent&&(O.parentId=this.parent.id),this.inputs&&this.inputs.serialize(O),m.a.AppendSerializedAnimations(this,O),O.ranges=this.serializeAnimationRanges(),O},g.prototype.clone=function(O){return m.a.Clone(g.GetConstructorFromName(this.getClassName(),O,this.getScene(),this.interaxialDistance,this.isStereoscopicSideBySide),this)},g.prototype.getDirection=function(O){var R=C.e.Zero();return this.getDirectionToRef(O,R),R},Object.defineProperty(g.prototype,"absoluteRotation",{get:function(){var O=C.b.Zero();return this.getWorldMatrix().decompose(void 0,O),O},enumerable:!1,configurable:!0}),g.prototype.getDirectionToRef=function(O,R){C.e.TransformNormalToRef(O,this.getWorldMatrix(),R)},g.GetConstructorFromName=function(O,R,N,V,U){V===void 0&&(V=0),U===void 0&&(U=!0);var L=I.a.Construct(O,R,N,{interaxial_distance:V,isStereoscopicSideBySide:U});return L||function(){return g._createDefaultParsedCamera(R,N)}},g.prototype.computeWorldMatrix=function(){return this.getWorldMatrix()},g.Parse=function(O,R){var N=O.type,V=g.GetConstructorFromName(N,O.name,R,O.interaxial_distance,O.isStereoscopicSideBySide),U=m.a.Parse(V,O,R);if(O.parentId&&(U._waitingParentId=O.parentId),U.inputs&&(U.inputs.parse(O),U._setupInputs()),O.upVector&&(U.upVector=C.e.FromArray(O.upVector)),U.setPosition&&(U.position.copyFromFloats(0,0,0),U.setPosition(C.e.FromArray(O.position))),O.target&&U.setTarget&&U.setTarget(C.e.FromArray(O.target)),O.cameraRigMode){var L=O.interaxial_distance?{interaxialDistance:O.interaxial_distance}:{};U.setCameraRigMode(O.cameraRigMode,L)}if(O.animations){for(var j=0;j<O.animations.length;j++){var Y=O.animations[j],W=p.a.GetClass("BABYLON.Animation");W&&U.animations.push(W.Parse(Y))}I.a.ParseAnimationRanges(U,O,R)}return O.autoAnimate&&R.beginAnimation(U,O.autoAnimateFrom,O.autoAnimateTo,O.autoAnimateLoop,O.autoAnimateSpeed||1),U},g._createDefaultParsedCamera=function(O,R){throw x.a.WarnImport("UniversalCamera")},g.PERSPECTIVE_CAMERA=0,g.ORTHOGRAPHIC_CAMERA=1,g.FOVMODE_VERTICAL_FIXED=0,g.FOVMODE_HORIZONTAL_FIXED=1,g.RIG_MODE_NONE=0,g.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,g.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,g.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,g.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,g.RIG_MODE_STEREOSCOPIC_INTERLACED=14,g.RIG_MODE_VR=20,g.RIG_MODE_WEBVR=21,g.RIG_MODE_CUSTOM=22,g.ForceAttachControlToAlwaysPreventDefault=!1,Object(E.c)([Object(m.o)("position")],g.prototype,"_position",void 0),Object(E.c)([Object(m.o)("upVector")],g.prototype,"_upVector",void 0),Object(E.c)([Object(m.c)()],g.prototype,"orthoLeft",void 0),Object(E.c)([Object(m.c)()],g.prototype,"orthoRight",void 0),Object(E.c)([Object(m.c)()],g.prototype,"orthoBottom",void 0),Object(E.c)([Object(m.c)()],g.prototype,"orthoTop",void 0),Object(E.c)([Object(m.c)()],g.prototype,"fov",void 0),Object(E.c)([Object(m.c)()],g.prototype,"minZ",void 0),Object(E.c)([Object(m.c)()],g.prototype,"maxZ",void 0),Object(E.c)([Object(m.c)()],g.prototype,"inertia",void 0),Object(E.c)([Object(m.c)()],g.prototype,"mode",void 0),Object(E.c)([Object(m.c)()],g.prototype,"layerMask",void 0),Object(E.c)([Object(m.c)()],g.prototype,"fovMode",void 0),Object(E.c)([Object(m.c)()],g.prototype,"cameraRigMode",void 0),Object(E.c)([Object(m.c)()],g.prototype,"interaxialDistance",void 0),Object(E.c)([Object(m.c)()],g.prototype,"isStereoscopicSideBySide",void 0),g}(I.a)},function(h,s,c){c.d(s,"a",function(){return P});var E=c(1),m=c(3),S=c(12),d=c(6),M=c(22),C=c(61),I=c(85),b=c(2),p=c(8),x=c(64),P=function(){function A(T,_,g){this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.onDisposeObservable=new d.c,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=b.a.ALPHA_COMBINE,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this._effect=null,this._useUBO=!1,this._fillMode=A.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._forceAlphaTest=!1,this._transparencyMode=null,this.name=T;var O=1;for(this._scene=_||M.a.LastCreatedScene,this.id=T||S.b.RandomId();this._scene.getMaterialByID(this.id);)this.id=T+" "+O++;this.uniqueId=this._scene.getUniqueId(),this._scene.useRightHandedSystem?this.sideOrientation=A.ClockWiseSideOrientation:this.sideOrientation=A.CounterClockWiseSideOrientation,this._uniformBuffer=new I.a(this._scene.getEngine()),this._useUBO=this.getScene().getEngine().supportsUniformBuffers,g||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={})}return Object.defineProperty(A.prototype,"canRenderToMRT",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"alpha",{get:function(){return this._alpha},set:function(T){this._alpha!==T&&(this._alpha=T,this.markAsDirty(A.MiscDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"backFaceCulling",{get:function(){return this._backFaceCulling},set:function(T){this._backFaceCulling!==T&&(this._backFaceCulling=T,this.markAsDirty(A.TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"hasRenderTargetTextures",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"onDispose",{set:function(T){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(T)},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"onBindObservable",{get:function(){return this._onBindObservable||(this._onBindObservable=new d.c),this._onBindObservable},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"onBind",{set:function(T){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(T)},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"onUnBindObservable",{get:function(){return this._onUnBindObservable||(this._onUnBindObservable=new d.c),this._onUnBindObservable},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"onEffectCreatedObservable",{get:function(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new d.c),this._onEffectCreatedObservable},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"alphaMode",{get:function(){return this._alphaMode},set:function(T){this._alphaMode!==T&&(this._alphaMode=T,this.markAsDirty(A.TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"needDepthPrePass",{get:function(){return this._needDepthPrePass},set:function(T){this._needDepthPrePass!==T&&(this._needDepthPrePass=T,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"fogEnabled",{get:function(){return this._fogEnabled},set:function(T){this._fogEnabled!==T&&(this._fogEnabled=T,this.markAsDirty(A.MiscDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"wireframe",{get:function(){switch(this._fillMode){case A.WireFrameFillMode:case A.LineListDrawMode:case A.LineLoopDrawMode:case A.LineStripDrawMode:return!0}return this._scene.forceWireframe},set:function(T){this.fillMode=T?A.WireFrameFillMode:A.TriangleFillMode},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"pointsCloud",{get:function(){switch(this._fillMode){case A.PointFillMode:case A.PointListDrawMode:return!0}return this._scene.forcePointsCloud},set:function(T){this.fillMode=T?A.PointFillMode:A.TriangleFillMode},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"fillMode",{get:function(){return this._fillMode},set:function(T){this._fillMode!==T&&(this._fillMode=T,this.markAsDirty(A.MiscDirtyFlag))},enumerable:!1,configurable:!0}),A.prototype.toString=function(T){return"Name: "+this.name},A.prototype.getClassName=function(){return"Material"},Object.defineProperty(A.prototype,"isFrozen",{get:function(){return this.checkReadyOnlyOnce},enumerable:!1,configurable:!0}),A.prototype.freeze=function(){this.markDirty(),this.checkReadyOnlyOnce=!0},A.prototype.unfreeze=function(){this.markDirty(),this.checkReadyOnlyOnce=!1},A.prototype.isReady=function(T,_){return!0},A.prototype.isReadyForSubMesh=function(T,_,g){return!1},A.prototype.getEffect=function(){return this._effect},A.prototype.getScene=function(){return this._scene},Object.defineProperty(A.prototype,"transparencyMode",{get:function(){return this._transparencyMode},set:function(T){this._transparencyMode!==T&&(this._transparencyMode=T,this._forceAlphaTest=T===A.MATERIAL_ALPHATESTANDBLEND,this._markAllSubMeshesAsTexturesAndMiscDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"_disableAlphaBlending",{get:function(){return this._transparencyMode===A.MATERIAL_OPAQUE||this._transparencyMode===A.MATERIAL_ALPHATEST},enumerable:!1,configurable:!0}),A.prototype.needAlphaBlending=function(){return!this._disableAlphaBlending&&this.alpha<1},A.prototype.needAlphaBlendingForMesh=function(T){return!(this._disableAlphaBlending&&T.visibility>=1)&&(this.needAlphaBlending()||T.visibility<1||T.hasVertexAlpha)},A.prototype.needAlphaTesting=function(){return!!this._forceAlphaTest},A.prototype._shouldTurnAlphaTestOn=function(T){return!this.needAlphaBlendingForMesh(T)&&this.needAlphaTesting()},A.prototype.getAlphaTestTexture=function(){return null},A.prototype.markDirty=function(){for(var T=0,_=this.getScene().meshes;T<_.length;T++){var g=_[T];if(g.subMeshes)for(var O=0,R=g.subMeshes;O<R.length;O++){var N=R[O];N.getMaterial()===this&&N.effect&&(N.effect._wasPreviouslyReady=!1)}}},A.prototype._preBind=function(T,_){_===void 0&&(_=null);var g=this._scene.getEngine(),O=(_??this.sideOrientation)===A.ClockWiseSideOrientation;return g.enableEffect(T||this._effect),g.setState(this.backFaceCulling,this.zOffset,!1,O),O},A.prototype.bind=function(T,_){},A.prototype.bindForSubMesh=function(T,_,g){},A.prototype.bindOnlyWorldMatrix=function(T){},A.prototype.bindSceneUniformBuffer=function(T,_){_.bindToEffect(T,"Scene")},A.prototype.bindView=function(T){this._useUBO?this.bindSceneUniformBuffer(T,this.getScene().getSceneUniformBuffer()):T.setMatrix("view",this.getScene().getViewMatrix())},A.prototype.bindViewProjection=function(T){this._useUBO?this.bindSceneUniformBuffer(T,this.getScene().getSceneUniformBuffer()):T.setMatrix("viewProjection",this.getScene().getTransformMatrix())},A.prototype._afterBind=function(T){if(this._scene._cachedMaterial=this,this._scene._cachedVisibility=T?T.visibility:1,this._onBindObservable&&T&&this._onBindObservable.notifyObservers(T),this.disableDepthWrite){var _=this._scene.getEngine();this._cachedDepthWriteState=_.getDepthWrite(),_.setDepthWrite(!1)}this.disableColorWrite&&(_=this._scene.getEngine(),this._cachedColorWriteState=_.getColorWrite(),_.setColorWrite(!1)),this.depthFunction!==0&&(_=this._scene.getEngine(),this._cachedDepthFunctionState=_.getDepthFunction()||0,_.setDepthFunction(this.depthFunction))},A.prototype.unbind=function(){this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),this.depthFunction!==0&&this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState),this.disableDepthWrite&&this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState),this.disableColorWrite&&this._scene.getEngine().setColorWrite(this._cachedColorWriteState)},A.prototype.getActiveTextures=function(){return[]},A.prototype.hasTexture=function(T){return!1},A.prototype.clone=function(T){return null},A.prototype.getBindedMeshes=function(){var T=this;if(this.meshMap){var _=new Array;for(var g in this.meshMap){var O=this.meshMap[g];O&&_.push(O)}return _}return this._scene.meshes.filter(function(R){return R.material===T})},A.prototype.forceCompilation=function(T,_,g,O){var R=this,N=Object(E.a)({clipPlane:!1,useInstances:!1},g),V=this.getScene(),U=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;var L=function(){if(R._scene&&R._scene.getEngine()){var j=V.clipPlane;if(N.clipPlane&&(V.clipPlane=new x.a(0,0,0,1)),R._storeEffectOnSubMeshes){var Y=!0,W=null;if(T.subMeshes){var re=new C.a(0,0,0,0,0,T,void 0,!1,!1);re._materialDefines&&(re._materialDefines._renderId=-1),R.isReadyForSubMesh(T,re,N.useInstances)||(re.effect&&re.effect.getCompilationError()&&re.effect.allFallbacksProcessed()?W=re.effect.getCompilationError():(Y=!1,setTimeout(L,16)))}Y&&(R.allowShaderHotSwapping=U,W&&O&&O(W),_&&_(R))}else R.isReady()?(R.allowShaderHotSwapping=U,_&&_(R)):setTimeout(L,16);N.clipPlane&&(V.clipPlane=j)}};L()},A.prototype.forceCompilationAsync=function(T,_){var g=this;return new Promise(function(O,R){g.forceCompilation(T,function(){O()},_,function(N){R(N)})})},A.prototype.markAsDirty=function(T){this.getScene().blockMaterialDirtyMechanism||(A._DirtyCallbackArray.length=0,T&A.TextureDirtyFlag&&A._DirtyCallbackArray.push(A._TextureDirtyCallBack),T&A.LightDirtyFlag&&A._DirtyCallbackArray.push(A._LightsDirtyCallBack),T&A.FresnelDirtyFlag&&A._DirtyCallbackArray.push(A._FresnelDirtyCallBack),T&A.AttributesDirtyFlag&&A._DirtyCallbackArray.push(A._AttributeDirtyCallBack),T&A.MiscDirtyFlag&&A._DirtyCallbackArray.push(A._MiscDirtyCallBack),T&A.PrePassDirtyFlag&&A._DirtyCallbackArray.push(A._PrePassDirtyCallBack),A._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(A._RunDirtyCallBacks),this.getScene().resetCachedMaterial())},A.prototype._markAllSubMeshesAsDirty=function(T){if(!this.getScene().blockMaterialDirtyMechanism)for(var _=0,g=this.getScene().meshes;_<g.length;_++){var O=g[_];if(O.subMeshes)for(var R=0,N=O.subMeshes;R<N.length;R++){var V=N[R];V.getMaterial()===this&&V._materialDefines&&T(V._materialDefines)}}},A.prototype._markScenePrePassDirty=function(){if(!this.getScene().blockMaterialDirtyMechanism){var T=this.getScene().enablePrePassRenderer();T&&T.markAsDirty()}},A.prototype._markAllSubMeshesAsAllDirty=function(){this._markAllSubMeshesAsDirty(A._AllDirtyCallBack)},A.prototype._markAllSubMeshesAsImageProcessingDirty=function(){this._markAllSubMeshesAsDirty(A._ImageProcessingDirtyCallBack)},A.prototype._markAllSubMeshesAsTexturesDirty=function(){this._markAllSubMeshesAsDirty(A._TextureDirtyCallBack)},A.prototype._markAllSubMeshesAsFresnelDirty=function(){this._markAllSubMeshesAsDirty(A._FresnelDirtyCallBack)},A.prototype._markAllSubMeshesAsFresnelAndMiscDirty=function(){this._markAllSubMeshesAsDirty(A._FresnelAndMiscDirtyCallBack)},A.prototype._markAllSubMeshesAsLightsDirty=function(){this._markAllSubMeshesAsDirty(A._LightsDirtyCallBack)},A.prototype._markAllSubMeshesAsAttributesDirty=function(){this._markAllSubMeshesAsDirty(A._AttributeDirtyCallBack)},A.prototype._markAllSubMeshesAsMiscDirty=function(){this._markAllSubMeshesAsDirty(A._MiscDirtyCallBack)},A.prototype._markAllSubMeshesAsPrePassDirty=function(){this._markAllSubMeshesAsDirty(A._MiscDirtyCallBack)},A.prototype._markAllSubMeshesAsTexturesAndMiscDirty=function(){this._markAllSubMeshesAsDirty(A._TextureAndMiscDirtyCallBack)},A.prototype.setPrePassRenderer=function(T){return!1},A.prototype.dispose=function(T,_,g){var O=this.getScene();if(O.stopAnimation(this),O.freeProcessedMaterials(),O.removeMaterial(this),g!==!0)if(this.meshMap)for(var R in this.meshMap)(U=this.meshMap[R])&&(U.material=null,this.releaseVertexArrayObject(U,T));else for(var N=0,V=O.meshes;N<V.length;N++){var U;(U=V[N]).material!==this||U.sourceMesh||(U.material=null,this.releaseVertexArrayObject(U,T))}this._uniformBuffer.dispose(),T&&this._effect&&(this._storeEffectOnSubMeshes||this._effect.dispose(),this._effect=null),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear()},A.prototype.releaseVertexArrayObject=function(T,_){if(T.geometry){var g=T.geometry;if(this._storeEffectOnSubMeshes)for(var O=0,R=T.subMeshes;O<R.length;O++){var N=R[O];g._releaseVertexArrayObject(N._materialEffect),_&&N._materialEffect&&N._materialEffect.dispose()}else g._releaseVertexArrayObject(this._effect)}},A.prototype.serialize=function(){return m.a.Serialize(this)},A.Parse=function(T,_,g){if(T.customType){if(T.customType==="BABYLON.PBRMaterial"&&T.overloadedAlbedo&&(T.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return p.a.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else T.customType="BABYLON.StandardMaterial";return S.b.Instantiate(T.customType).Parse(T,_,g)},A.TriangleFillMode=b.a.MATERIAL_TriangleFillMode,A.WireFrameFillMode=b.a.MATERIAL_WireFrameFillMode,A.PointFillMode=b.a.MATERIAL_PointFillMode,A.PointListDrawMode=b.a.MATERIAL_PointListDrawMode,A.LineListDrawMode=b.a.MATERIAL_LineListDrawMode,A.LineLoopDrawMode=b.a.MATERIAL_LineLoopDrawMode,A.LineStripDrawMode=b.a.MATERIAL_LineStripDrawMode,A.TriangleStripDrawMode=b.a.MATERIAL_TriangleStripDrawMode,A.TriangleFanDrawMode=b.a.MATERIAL_TriangleFanDrawMode,A.ClockWiseSideOrientation=b.a.MATERIAL_ClockWiseSideOrientation,A.CounterClockWiseSideOrientation=b.a.MATERIAL_CounterClockWiseSideOrientation,A.TextureDirtyFlag=b.a.MATERIAL_TextureDirtyFlag,A.LightDirtyFlag=b.a.MATERIAL_LightDirtyFlag,A.FresnelDirtyFlag=b.a.MATERIAL_FresnelDirtyFlag,A.AttributesDirtyFlag=b.a.MATERIAL_AttributesDirtyFlag,A.MiscDirtyFlag=b.a.MATERIAL_MiscDirtyFlag,A.PrePassDirtyFlag=b.a.MATERIAL_PrePassDirtyFlag,A.AllDirtyFlag=b.a.MATERIAL_AllDirtyFlag,A.MATERIAL_OPAQUE=0,A.MATERIAL_ALPHATEST=1,A.MATERIAL_ALPHABLEND=2,A.MATERIAL_ALPHATESTANDBLEND=3,A.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,A.MATERIAL_NORMALBLENDMETHOD_RNM=1,A._AllDirtyCallBack=function(T){return T.markAllAsDirty()},A._ImageProcessingDirtyCallBack=function(T){return T.markAsImageProcessingDirty()},A._TextureDirtyCallBack=function(T){return T.markAsTexturesDirty()},A._FresnelDirtyCallBack=function(T){return T.markAsFresnelDirty()},A._MiscDirtyCallBack=function(T){return T.markAsMiscDirty()},A._PrePassDirtyCallBack=function(T){return T.markAsPrePassDirty()},A._LightsDirtyCallBack=function(T){return T.markAsLightDirty()},A._AttributeDirtyCallBack=function(T){return T.markAsAttributesDirty()},A._FresnelAndMiscDirtyCallBack=function(T){A._FresnelDirtyCallBack(T),A._MiscDirtyCallBack(T)},A._TextureAndMiscDirtyCallBack=function(T){A._TextureDirtyCallBack(T),A._MiscDirtyCallBack(T)},A._DirtyCallbackArray=[],A._RunDirtyCallBacks=function(T){for(var _=0,g=A._DirtyCallbackArray;_<g.length;_++)(0,g[_])(T)},Object(E.c)([Object(m.c)()],A.prototype,"id",void 0),Object(E.c)([Object(m.c)()],A.prototype,"uniqueId",void 0),Object(E.c)([Object(m.c)()],A.prototype,"name",void 0),Object(E.c)([Object(m.c)()],A.prototype,"checkReadyOnEveryCall",void 0),Object(E.c)([Object(m.c)()],A.prototype,"checkReadyOnlyOnce",void 0),Object(E.c)([Object(m.c)()],A.prototype,"state",void 0),Object(E.c)([Object(m.c)("alpha")],A.prototype,"_alpha",void 0),Object(E.c)([Object(m.c)("backFaceCulling")],A.prototype,"_backFaceCulling",void 0),Object(E.c)([Object(m.c)()],A.prototype,"sideOrientation",void 0),Object(E.c)([Object(m.c)("alphaMode")],A.prototype,"_alphaMode",void 0),Object(E.c)([Object(m.c)()],A.prototype,"_needDepthPrePass",void 0),Object(E.c)([Object(m.c)()],A.prototype,"disableDepthWrite",void 0),Object(E.c)([Object(m.c)()],A.prototype,"disableColorWrite",void 0),Object(E.c)([Object(m.c)()],A.prototype,"forceDepthWrite",void 0),Object(E.c)([Object(m.c)()],A.prototype,"depthFunction",void 0),Object(E.c)([Object(m.c)()],A.prototype,"separateCullingPass",void 0),Object(E.c)([Object(m.c)("fogEnabled")],A.prototype,"_fogEnabled",void 0),Object(E.c)([Object(m.c)()],A.prototype,"pointSize",void 0),Object(E.c)([Object(m.c)()],A.prototype,"zOffset",void 0),Object(E.c)([Object(m.c)()],A.prototype,"pointsCloud",null),Object(E.c)([Object(m.c)()],A.prototype,"fillMode",null),Object(E.c)([Object(m.c)()],A.prototype,"transparencyMode",null),A}()},function(h,s,c){c.d(s,"a",function(){return V});var E=c(22),m=c(5),S=c(21),d=c(6),M=c(141),C=c(142),I=c(143),b=c(2),p=c(27),x=c(8),P=c(38),A=function(){function U(){}return U.prototype.postProcessor=function(L,j,Y,W){return W.getCaps().drawBuffersExtension||(L=L.replace(/#extension.+GL_EXT_draw_buffers.+(enable|require)/g,"")),L},U}(),T=c(118),_=c(88),g=c(144),O=c(70),R=c(74),N=function(){},V=function(){function U(L,j,Y,W){var re=this;W===void 0&&(W=!1),this.forcePOTTextures=!1,this.isFullscreen=!1,this.cullBackFaces=!0,this.renderEvenInBackground=!0,this.preventCacheWipeBetweenFrames=!1,this.validateShaderPrograms=!1,this.useReverseDepthBuffer=!1,this.disableUniformBuffers=!1,this._uniformBuffers=new Array,this._webGLVersion=1,this._windowIsBackground=!1,this._highPrecisionShadersAllowed=!0,this._badOS=!1,this._badDesktopOS=!1,this._renderingQueueLaunched=!1,this._activeRenderLoops=new Array,this.onContextLostObservable=new d.c,this.onContextRestoredObservable=new d.c,this._contextWasLost=!1,this._doNotHandleContextLost=!1,this.disableVertexArrayObjects=!1,this._colorWrite=!0,this._colorWriteChanged=!0,this._depthCullingState=new M.a,this._stencilState=new C.a,this._alphaState=new I.a,this._alphaMode=b.a.ALPHA_ADD,this._alphaEquation=b.a.ALPHA_DISABLE,this._internalTexturesCache=new Array,this._activeChannel=0,this._currentTextureChannel=-1,this._boundTexturesCache={},this._compiledEffects={},this._vertexAttribArraysEnabled=[],this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array,this._currentFramebuffer=null,this._dummyFramebuffer=null,this._currentBufferPointers=new Array,this._currentInstanceLocations=new Array,this._currentInstanceBuffers=new Array,this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._nextFreeTextureSlots=new Array,this._maxSimultaneousTextures=0,this._activeRequests=new Array,this._transformTextureUrl=null,this.hostInformation={isMobile:!1},this.premultipliedAlpha=!0,this.onBeforeTextureInitObservable=new d.c,this._viewportCached={x:0,y:0,z:0,w:0},this._unpackFlipYCached=null,this.enableUnpackFlipYCached=!0,this._getDepthStencilBuffer=function(Q,ee,pe,Te,ve,he){var be=re._gl,xe=be.createRenderbuffer();return be.bindRenderbuffer(be.RENDERBUFFER,xe),pe>1&&be.renderbufferStorageMultisample?be.renderbufferStorageMultisample(be.RENDERBUFFER,pe,ve,Q,ee):be.renderbufferStorage(be.RENDERBUFFER,Te,Q,ee),be.framebufferRenderbuffer(be.FRAMEBUFFER,he,be.RENDERBUFFER,xe),be.bindRenderbuffer(be.RENDERBUFFER,null),xe},this._boundUniforms={};var ne=null;if(L){if(Y=Y||{},R.a.SetMatrixPrecision(!!Y.useHighPrecisionMatrix),L.getContext){if(ne=L,this._renderingCanvas=ne,j!=null&&(Y.antialias=j),Y.deterministicLockstep===void 0&&(Y.deterministicLockstep=!1),Y.lockstepMaxSteps===void 0&&(Y.lockstepMaxSteps=4),Y.timeStep===void 0&&(Y.timeStep=1/60),Y.preserveDrawingBuffer===void 0&&(Y.preserveDrawingBuffer=!1),Y.audioEngine===void 0&&(Y.audioEngine=!0),Y.stencil===void 0&&(Y.stencil=!0),Y.premultipliedAlpha===!1&&(this.premultipliedAlpha=!1),Y.xrCompatible===void 0&&(Y.xrCompatible=!0),this._doNotHandleContextLost=!!Y.doNotHandleContextLost,navigator&&navigator.userAgent){var ge=navigator.userAgent;this.hostInformation.isMobile=ge.indexOf("Mobile")!==-1;for(var _e=0,ce=U.ExceptionList;_e<ce.length;_e++){var ie=ce[_e],Z=ie.key,te=ie.targets;if(new RegExp(Z).test(ge)){if(ie.capture&&ie.captureConstraint){var B=ie.capture,G=ie.captureConstraint,$=new RegExp(B).exec(ge);if($&&$.length>0&&parseInt($[$.length-1])>=G)continue}for(var le=0,se=te;le<se.length;le++)switch(se[le]){case"uniformBuffer":this.disableUniformBuffers=!0;break;case"vao":this.disableVertexArrayObjects=!0}}}}if(this._doNotHandleContextLost||(this._onContextLost=function(Q){Q.preventDefault(),re._contextWasLost=!0,x.a.Warn("WebGL context lost."),re.onContextLostObservable.notifyObservers(re)},this._onContextRestored=function(){setTimeout(function(){re._initGLContext(),re._rebuildEffects(),re._rebuildInternalTextures(),re._rebuildBuffers(),re.wipeCaches(!0),x.a.Warn("WebGL context successfully restored."),re.onContextRestoredObservable.notifyObservers(re),re._contextWasLost=!1},0)},ne.addEventListener("webglcontextlost",this._onContextLost,!1),ne.addEventListener("webglcontextrestored",this._onContextRestored,!1),Y.powerPreference="high-performance"),!Y.disableWebGL2Support)try{this._gl=ne.getContext("webgl2",Y)||ne.getContext("experimental-webgl2",Y),this._gl&&(this._webGLVersion=2,this._gl.deleteQuery||(this._webGLVersion=1))}catch(Q){}if(!this._gl){if(!ne)throw new Error("The provided canvas is null or undefined.");try{this._gl=ne.getContext("webgl",Y)||ne.getContext("experimental-webgl",Y)}catch(Q){throw new Error("WebGL not supported")}}if(!this._gl)throw new Error("WebGL not supported")}else{this._gl=L,this._renderingCanvas=this._gl.canvas,this._gl.renderbufferStorageMultisample&&(this._webGLVersion=2);var q=this._gl.getContextAttributes();q&&(Y.stencil=q.stencil)}this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),Y.useHighPrecisionFloats!==void 0&&(this._highPrecisionShadersAllowed=Y.useHighPrecisionFloats);var H=P.a.IsWindowObjectExist()&&window.devicePixelRatio||1,X=Y.limitDeviceRatio||H;this._hardwareScalingLevel=W?1/Math.min(X,H):1,this.resize(),this._isStencilEnable=!!Y.stencil,this._initGLContext();for(var J=0;J<this._caps.maxVertexAttribs;J++)this._currentBufferPointers[J]=new N;this.webGLVersion>1?this._shaderProcessor=new T.a:this._shaderProcessor=new A,this._badOS=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent),this._badDesktopOS=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),this._creationOptions=Y,console.log("Babylon.js v"+U.Version+" - "+this.description)}}return Object.defineProperty(U,"NpmPackage",{get:function(){return"babylonjs@4.2.0"},enumerable:!1,configurable:!0}),Object.defineProperty(U,"Version",{get:function(){return"4.2.0"},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"description",{get:function(){var L="WebGL"+this.webGLVersion;return this._caps.parallelShaderCompile&&(L+=" - Parallel shader compilation"),L},enumerable:!1,configurable:!0}),Object.defineProperty(U,"ShadersRepository",{get:function(){return m.a.ShadersRepository},set:function(L){m.a.ShadersRepository=L},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"supportsUniformBuffers",{get:function(){return this.webGLVersion>1&&!this.disableUniformBuffers},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"_shouldUseHighPrecisionShader",{get:function(){return!(!this._caps.highPrecisionShaderSupported||!this._highPrecisionShadersAllowed)},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"needPOTTextures",{get:function(){return this._webGLVersion<2||this.forcePOTTextures},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"doNotHandleContextLost",{get:function(){return this._doNotHandleContextLost},set:function(L){this._doNotHandleContextLost=L},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"_supportsHardwareTextureRescaling",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"framebufferDimensionsObject",{set:function(L){this._framebufferDimensionsObject=L},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"currentViewport",{get:function(){return this._cachedViewport},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"emptyTexture",{get:function(){return this._emptyTexture||(this._emptyTexture=this.createRawTexture(new Uint8Array(4),1,1,b.a.TEXTUREFORMAT_RGBA,!1,!1,b.a.TEXTURE_NEAREST_SAMPLINGMODE)),this._emptyTexture},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"emptyTexture3D",{get:function(){return this._emptyTexture3D||(this._emptyTexture3D=this.createRawTexture3D(new Uint8Array(4),1,1,1,b.a.TEXTUREFORMAT_RGBA,!1,!1,b.a.TEXTURE_NEAREST_SAMPLINGMODE)),this._emptyTexture3D},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"emptyTexture2DArray",{get:function(){return this._emptyTexture2DArray||(this._emptyTexture2DArray=this.createRawTexture2DArray(new Uint8Array(4),1,1,1,b.a.TEXTUREFORMAT_RGBA,!1,!1,b.a.TEXTURE_NEAREST_SAMPLINGMODE)),this._emptyTexture2DArray},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"emptyCubeTexture",{get:function(){if(!this._emptyCubeTexture){var L=new Uint8Array(4),j=[L,L,L,L,L,L];this._emptyCubeTexture=this.createRawCubeTexture(j,1,b.a.TEXTUREFORMAT_RGBA,b.a.TEXTURETYPE_UNSIGNED_INT,!1,!1,b.a.TEXTURE_NEAREST_SAMPLINGMODE)}return this._emptyCubeTexture},enumerable:!1,configurable:!0}),U.prototype._rebuildInternalTextures=function(){for(var L=0,j=this._internalTexturesCache.slice();L<j.length;L++)j[L]._rebuild()},U.prototype._rebuildEffects=function(){for(var L in this._compiledEffects)this._compiledEffects[L]._prepareEffect();m.a.ResetCache()},U.prototype.areAllEffectsReady=function(){for(var L in this._compiledEffects)if(!this._compiledEffects[L].isReady())return!1;return!0},U.prototype._rebuildBuffers=function(){for(var L=0,j=this._uniformBuffers;L<j.length;L++)j[L]._rebuild()},U.prototype._initGLContext=function(){this._caps={maxTexturesImageUnits:this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),maxCombinedTexturesImageUnits:this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize:this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),maxSamples:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_SAMPLES):1,maxCubemapTextureSize:this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderTextureSize:this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),maxVertexAttribs:this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),maxVaryingVectors:this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),maxFragmentUniformVectors:this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),maxVertexUniformVectors:this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),parallelShaderCompile:this._gl.getExtension("KHR_parallel_shader_compile"),standardDerivatives:this._webGLVersion>1||this._gl.getExtension("OES_standard_derivatives")!==null,maxAnisotropy:1,astc:this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),bptc:this._gl.getExtension("EXT_texture_compression_bptc")||this._gl.getExtension("WEBKIT_EXT_texture_compression_bptc"),s3tc:this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),pvrtc:this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),etc2:this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),textureAnisotropicFilterExtension:this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),uintIndices:this._webGLVersion>1||this._gl.getExtension("OES_element_index_uint")!==null,fragmentDepthSupported:this._webGLVersion>1||this._gl.getExtension("EXT_frag_depth")!==null,highPrecisionShaderSupported:!1,timerQuery:this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),canUseTimestampForTimerQuery:!1,drawBuffersExtension:!1,maxMSAASamples:1,colorBufferFloat:this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_float"),textureFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_float")),textureHalfFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_half_float")),textureHalfFloatRender:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloatLinearFiltering:!1,vertexArrayObject:!1,instancedArrays:!1,textureLOD:!!(this._webGLVersion>1||this._gl.getExtension("EXT_shader_texture_lod")),blendMinMax:!1,multiview:this._gl.getExtension("OVR_multiview2"),oculusMultiview:this._gl.getExtension("OCULUS_multiview"),depthTextureExtension:!1},this._glVersion=this._gl.getParameter(this._gl.VERSION);var L=this._gl.getExtension("WEBGL_debug_renderer_info");if(L!=null&&(this._glRenderer=this._gl.getParameter(L.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(L.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor="Unknown vendor"),this._glRenderer||(this._glRenderer="Unknown renderer"),this._gl.HALF_FLOAT_OES!==36193&&(this._gl.HALF_FLOAT_OES=36193),this._gl.RGBA16F!==34842&&(this._gl.RGBA16F=34842),this._gl.RGBA32F!==34836&&(this._gl.RGBA32F=34836),this._gl.DEPTH24_STENCIL8!==35056&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.timerQuery&&(this._webGLVersion===1&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT)>0),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.textureFloatLinearFiltering=!(!this._caps.textureFloat||!this._gl.getExtension("OES_texture_float_linear")),this._caps.textureFloatRender=!(!this._caps.textureFloat||!this._canRenderToFloatFramebuffer()),this._caps.textureHalfFloatLinearFiltering=!!(this._webGLVersion>1||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")),this._webGLVersion>1&&this._gl.HALF_FLOAT_OES!==5131&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),this._webGLVersion>1)this._caps.drawBuffersExtension=!0,this._caps.maxMSAASamples=this._gl.getParameter(this._gl.MAX_SAMPLES);else{var j=this._gl.getExtension("WEBGL_draw_buffers");if(j!==null){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=j.drawBuffersWEBGL.bind(j),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(var Y=0;Y<16;Y++)this._gl["COLOR_ATTACHMENT"+Y+"_WEBGL"]=j["COLOR_ATTACHMENT"+Y+"_WEBGL"]}}if(this._webGLVersion>1)this._caps.depthTextureExtension=!0;else{var W=this._gl.getExtension("WEBGL_depth_texture");W!=null&&(this._caps.depthTextureExtension=!0,this._gl.UNSIGNED_INT_24_8=W.UNSIGNED_INT_24_8_WEBGL)}if(this.disableVertexArrayObjects)this._caps.vertexArrayObject=!1;else if(this._webGLVersion>1)this._caps.vertexArrayObject=!0;else{var re=this._gl.getExtension("OES_vertex_array_object");re!=null&&(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=re.createVertexArrayOES.bind(re),this._gl.bindVertexArray=re.bindVertexArrayOES.bind(re),this._gl.deleteVertexArray=re.deleteVertexArrayOES.bind(re))}if(this._webGLVersion>1)this._caps.instancedArrays=!0;else{var ne=this._gl.getExtension("ANGLE_instanced_arrays");ne!=null?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=ne.drawArraysInstancedANGLE.bind(ne),this._gl.drawElementsInstanced=ne.drawElementsInstancedANGLE.bind(ne),this._gl.vertexAttribDivisor=ne.vertexAttribDivisorANGLE.bind(ne)):this._caps.instancedArrays=!1}if(this._gl.getShaderPrecisionFormat){var ge=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT),_e=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);ge&&_e&&(this._caps.highPrecisionShaderSupported=ge.precision!==0&&_e.precision!==0)}if(this._webGLVersion>1)this._caps.blendMinMax=!0;else{var ce=this._gl.getExtension("EXT_blend_minmax");ce!=null&&(this._caps.blendMinMax=!0,this._gl.MAX=ce.MAX_EXT,this._gl.MIN=ce.MIN_EXT)}this._depthCullingState.depthTest=!0,this._depthCullingState.depthFunc=this._gl.LEQUAL,this._depthCullingState.depthMask=!0,this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(var ie=0;ie<this._maxSimultaneousTextures;ie++)this._nextFreeTextureSlots.push(ie)},Object.defineProperty(U.prototype,"webGLVersion",{get:function(){return this._webGLVersion},enumerable:!1,configurable:!0}),U.prototype.getClassName=function(){return"ThinEngine"},Object.defineProperty(U.prototype,"isStencilEnable",{get:function(){return this._isStencilEnable},enumerable:!1,configurable:!0}),U.prototype._prepareWorkingCanvas=function(){if(!this._workingCanvas){this._workingCanvas=O.a.CreateCanvas(1,1);var L=this._workingCanvas.getContext("2d");L&&(this._workingContext=L)}},U.prototype.resetTextureCache=function(){for(var L in this._boundTexturesCache)this._boundTexturesCache.hasOwnProperty(L)&&(this._boundTexturesCache[L]=null);this._currentTextureChannel=-1},U.prototype.getGlInfo=function(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}},U.prototype.setHardwareScalingLevel=function(L){this._hardwareScalingLevel=L,this.resize()},U.prototype.getHardwareScalingLevel=function(){return this._hardwareScalingLevel},U.prototype.getLoadedTexturesCache=function(){return this._internalTexturesCache},U.prototype.getCaps=function(){return this._caps},U.prototype.stopRenderLoop=function(L){if(L){var j=this._activeRenderLoops.indexOf(L);j>=0&&this._activeRenderLoops.splice(j,1)}else this._activeRenderLoops=[]},U.prototype._renderLoop=function(){if(!this._contextWasLost){var L=!0;if(!this.renderEvenInBackground&&this._windowIsBackground&&(L=!1),L){this.beginFrame();for(var j=0;j<this._activeRenderLoops.length;j++)(0,this._activeRenderLoops[j])();this.endFrame()}}this._activeRenderLoops.length>0?this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()):this._renderingQueueLaunched=!1},U.prototype.getRenderingCanvas=function(){return this._renderingCanvas},U.prototype.getHostWindow=function(){return P.a.IsWindowObjectExist()?this._renderingCanvas&&this._renderingCanvas.ownerDocument&&this._renderingCanvas.ownerDocument.defaultView?this._renderingCanvas.ownerDocument.defaultView:window:null},U.prototype.getRenderWidth=function(L){return L===void 0&&(L=!1),!L&&this._currentRenderTarget?this._currentRenderTarget.width:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferWidth:this._gl.drawingBufferWidth},U.prototype.getRenderHeight=function(L){return L===void 0&&(L=!1),!L&&this._currentRenderTarget?this._currentRenderTarget.height:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferHeight:this._gl.drawingBufferHeight},U.prototype._queueNewFrame=function(L,j){return U.QueueNewFrame(L,j)},U.prototype.runRenderLoop=function(L){this._activeRenderLoops.indexOf(L)===-1&&(this._activeRenderLoops.push(L),this._renderingQueueLaunched||(this._renderingQueueLaunched=!0,this._boundRenderFunction=this._renderLoop.bind(this),this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow())))},U.prototype.clear=function(L,j,Y,W){W===void 0&&(W=!1),this.applyStates();var re=0;j&&L&&(this._gl.clearColor(L.r,L.g,L.b,L.a!==void 0?L.a:1),re|=this._gl.COLOR_BUFFER_BIT),Y&&(this.useReverseDepthBuffer?(this._depthCullingState.depthFunc=this._gl.GREATER,this._gl.clearDepth(0)):this._gl.clearDepth(1),re|=this._gl.DEPTH_BUFFER_BIT),W&&(this._gl.clearStencil(0),re|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(re)},U.prototype._viewport=function(L,j,Y,W){L===this._viewportCached.x&&j===this._viewportCached.y&&Y===this._viewportCached.z&&W===this._viewportCached.w||(this._viewportCached.x=L,this._viewportCached.y=j,this._viewportCached.z=Y,this._viewportCached.w=W,this._gl.viewport(L,j,Y,W))},U.prototype.setViewport=function(L,j,Y){var W=j||this.getRenderWidth(),re=Y||this.getRenderHeight(),ne=L.x||0,ge=L.y||0;this._cachedViewport=L,this._viewport(ne*W,ge*re,W*L.width,re*L.height)},U.prototype.beginFrame=function(){},U.prototype.endFrame=function(){this._badOS&&this.flushFramebuffer()},U.prototype.resize=function(){var L,j;P.a.IsWindowObjectExist()?(L=this._renderingCanvas?this._renderingCanvas.clientWidth||this._renderingCanvas.width:window.innerWidth,j=this._renderingCanvas?this._renderingCanvas.clientHeight||this._renderingCanvas.height:window.innerHeight):(L=this._renderingCanvas?this._renderingCanvas.width:100,j=this._renderingCanvas?this._renderingCanvas.height:100),this.setSize(L/this._hardwareScalingLevel,j/this._hardwareScalingLevel)},U.prototype.setSize=function(L,j){return!!this._renderingCanvas&&(L|=0,j|=0,(this._renderingCanvas.width!==L||this._renderingCanvas.height!==j)&&(this._renderingCanvas.width=L,this._renderingCanvas.height=j,!0))},U.prototype.bindFramebuffer=function(L,j,Y,W,re,ne,ge){j===void 0&&(j=0),ne===void 0&&(ne=0),ge===void 0&&(ge=0),this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=L,this._bindUnboundFramebuffer(L._MSAAFramebuffer?L._MSAAFramebuffer:L._framebuffer);var _e=this._gl;L.is2DArray?_e.framebufferTextureLayer(_e.FRAMEBUFFER,_e.COLOR_ATTACHMENT0,L._webGLTexture,ne,ge):L.isCube&&_e.framebufferTexture2D(_e.FRAMEBUFFER,_e.COLOR_ATTACHMENT0,_e.TEXTURE_CUBE_MAP_POSITIVE_X+j,L._webGLTexture,ne);var ce=L._depthStencilTexture;if(ce){var ie=ce._generateStencilBuffer?_e.DEPTH_STENCIL_ATTACHMENT:_e.DEPTH_ATTACHMENT;L.is2DArray?_e.framebufferTextureLayer(_e.FRAMEBUFFER,ie,ce._webGLTexture,ne,ge):L.isCube?_e.framebufferTexture2D(_e.FRAMEBUFFER,ie,_e.TEXTURE_CUBE_MAP_POSITIVE_X+j,ce._webGLTexture,ne):_e.framebufferTexture2D(_e.FRAMEBUFFER,ie,_e.TEXTURE_2D,ce._webGLTexture,ne)}this._cachedViewport&&!re?this.setViewport(this._cachedViewport,Y,W):(Y||(Y=L.width,ne&&(Y/=Math.pow(2,ne))),W||(W=L.height,ne&&(W/=Math.pow(2,ne))),this._viewport(0,0,Y,W)),this.wipeCaches()},U.prototype._bindUnboundFramebuffer=function(L){this._currentFramebuffer!==L&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,L),this._currentFramebuffer=L)},U.prototype.unBindFramebuffer=function(L,j,Y){j===void 0&&(j=!1),this._currentRenderTarget=null;var W=this._gl;if(L._MSAAFramebuffer){if(L._textureArray)return void this.unBindMultiColorAttachmentFramebuffer(L._textureArray,j,Y);W.bindFramebuffer(W.READ_FRAMEBUFFER,L._MSAAFramebuffer),W.bindFramebuffer(W.DRAW_FRAMEBUFFER,L._framebuffer),W.blitFramebuffer(0,0,L.width,L.height,0,0,L.width,L.height,W.COLOR_BUFFER_BIT,W.NEAREST)}!L.generateMipMaps||j||L.isCube||(this._bindTextureDirectly(W.TEXTURE_2D,L,!0),W.generateMipmap(W.TEXTURE_2D),this._bindTextureDirectly(W.TEXTURE_2D,null)),Y&&(L._MSAAFramebuffer&&this._bindUnboundFramebuffer(L._framebuffer),Y()),this._bindUnboundFramebuffer(null)},U.prototype.flushFramebuffer=function(){this._gl.flush()},U.prototype.restoreDefaultFramebuffer=function(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()},U.prototype._resetVertexBufferBinding=function(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null},U.prototype.createVertexBuffer=function(L){return this._createVertexBuffer(L,this._gl.STATIC_DRAW)},U.prototype._createVertexBuffer=function(L,j){var Y=this._gl.createBuffer();if(!Y)throw new Error("Unable to create vertex buffer");var W=new _.a(Y);return this.bindArrayBuffer(W),L instanceof Array?this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(L),this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.ARRAY_BUFFER,L,this._gl.STATIC_DRAW),this._resetVertexBufferBinding(),W.references=1,W},U.prototype.createDynamicVertexBuffer=function(L){return this._createVertexBuffer(L,this._gl.DYNAMIC_DRAW)},U.prototype._resetIndexBufferBinding=function(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null},U.prototype.createIndexBuffer=function(L,j){var Y=this._gl.createBuffer(),W=new _.a(Y);if(!Y)throw new Error("Unable to create index buffer");this.bindIndexBuffer(W);var re=this._normalizeIndexData(L);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,re,j?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),W.references=1,W.is32Bits=re.BYTES_PER_ELEMENT===4,W},U.prototype._normalizeIndexData=function(L){if(L instanceof Uint16Array)return L;if(this._caps.uintIndices){if(L instanceof Uint32Array)return L;for(var j=0;j<L.length;j++)if(L[j]>=65535)return new Uint32Array(L);return new Uint16Array(L)}return new Uint16Array(L)},U.prototype.bindArrayBuffer=function(L){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.bindBuffer(L,this._gl.ARRAY_BUFFER)},U.prototype.bindUniformBlock=function(L,j,Y){var W=L.program,re=this._gl.getUniformBlockIndex(W,j);this._gl.uniformBlockBinding(W,re,Y)},U.prototype.bindIndexBuffer=function(L){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.bindBuffer(L,this._gl.ELEMENT_ARRAY_BUFFER)},U.prototype.bindBuffer=function(L,j){(this._vaoRecordInProgress||this._currentBoundBuffer[j]!==L)&&(this._gl.bindBuffer(j,L?L.underlyingResource:null),this._currentBoundBuffer[j]=L)},U.prototype.updateArrayBuffer=function(L){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,L)},U.prototype._vertexAttribPointer=function(L,j,Y,W,re,ne,ge){var _e=this._currentBufferPointers[j];if(_e){var ce=!1;_e.active?(_e.buffer!==L&&(_e.buffer=L,ce=!0),_e.size!==Y&&(_e.size=Y,ce=!0),_e.type!==W&&(_e.type=W,ce=!0),_e.normalized!==re&&(_e.normalized=re,ce=!0),_e.stride!==ne&&(_e.stride=ne,ce=!0),_e.offset!==ge&&(_e.offset=ge,ce=!0)):(ce=!0,_e.active=!0,_e.index=j,_e.size=Y,_e.type=W,_e.normalized=re,_e.stride=ne,_e.offset=ge,_e.buffer=L),(ce||this._vaoRecordInProgress)&&(this.bindArrayBuffer(L),this._gl.vertexAttribPointer(j,Y,W,re,ne,ge))}},U.prototype._bindIndexBufferWithCache=function(L){L!=null&&this._cachedIndexBuffer!==L&&(this._cachedIndexBuffer=L,this.bindIndexBuffer(L),this._uintIndicesCurrentlySet=L.is32Bits)},U.prototype._bindVertexBuffersAttributes=function(L,j){var Y=j.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(var W=0;W<Y.length;W++){var re=j.getAttributeLocation(W);if(re>=0){var ne=L[Y[W]];if(!ne)continue;this._gl.enableVertexAttribArray(re),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[re]=!0);var ge=ne.getBuffer();ge&&(this._vertexAttribPointer(ge,re,ne.getSize(),ne.type,ne.normalized,ne.byteStride,ne.byteOffset),ne.getIsInstanced()&&(this._gl.vertexAttribDivisor(re,ne.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(re),this._currentInstanceBuffers.push(ge))))}}},U.prototype.recordVertexArrayObject=function(L,j,Y){var W=this._gl.createVertexArray();return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(W),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(L,Y),this.bindIndexBuffer(j),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),W},U.prototype.bindVertexArrayObject=function(L,j){this._cachedVertexArrayObject!==L&&(this._cachedVertexArrayObject=L,this._gl.bindVertexArray(L),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=j!=null&&j.is32Bits,this._mustWipeVertexAttributes=!0)},U.prototype.bindBuffersDirectly=function(L,j,Y,W,re){if(this._cachedVertexBuffers!==L||this._cachedEffectForVertexBuffers!==re){this._cachedVertexBuffers=L,this._cachedEffectForVertexBuffers=re;var ne=re.getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();for(var ge=0,_e=0;_e<ne;_e++)if(_e<Y.length){var ce=re.getAttributeLocation(_e);ce>=0&&(this._gl.enableVertexAttribArray(ce),this._vertexAttribArraysEnabled[ce]=!0,this._vertexAttribPointer(L,ce,Y[_e],this._gl.FLOAT,!1,W,ge)),ge+=4*Y[_e]}}this._bindIndexBufferWithCache(j)},U.prototype._unbindVertexArrayObject=function(){this._cachedVertexArrayObject&&(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))},U.prototype.bindBuffers=function(L,j,Y){this._cachedVertexBuffers===L&&this._cachedEffectForVertexBuffers===Y||(this._cachedVertexBuffers=L,this._cachedEffectForVertexBuffers=Y,this._bindVertexBuffersAttributes(L,Y)),this._bindIndexBufferWithCache(j)},U.prototype.unbindInstanceAttributes=function(){for(var L,j=0,Y=this._currentInstanceLocations.length;j<Y;j++){var W=this._currentInstanceBuffers[j];L!=W&&W.references&&(L=W,this.bindArrayBuffer(W));var re=this._currentInstanceLocations[j];this._gl.vertexAttribDivisor(re,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0},U.prototype.releaseVertexArrayObject=function(L){this._gl.deleteVertexArray(L)},U.prototype._releaseBuffer=function(L){return L.references--,L.references===0&&(this._deleteBuffer(L),!0)},U.prototype._deleteBuffer=function(L){this._gl.deleteBuffer(L.underlyingResource)},U.prototype.updateAndBindInstancesBuffer=function(L,j,Y){if(this.bindArrayBuffer(L),j&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,j),Y[0].index!==void 0)this.bindInstancesBuffer(L,Y,!0);else for(var W=0;W<4;W++){var re=Y[W];this._vertexAttribArraysEnabled[re]||(this._gl.enableVertexAttribArray(re),this._vertexAttribArraysEnabled[re]=!0),this._vertexAttribPointer(L,re,4,this._gl.FLOAT,!1,64,16*W),this._gl.vertexAttribDivisor(re,1),this._currentInstanceLocations.push(re),this._currentInstanceBuffers.push(L)}},U.prototype.bindInstancesBuffer=function(L,j,Y){Y===void 0&&(Y=!0),this.bindArrayBuffer(L);var W=0;if(Y)for(var re=0;re<j.length;re++)W+=4*(ne=j[re]).attributeSize;for(re=0;re<j.length;re++){var ne;(ne=j[re]).index===void 0&&(ne.index=this._currentEffect.getAttributeLocationByName(ne.attributeName)),ne.index<0||(this._vertexAttribArraysEnabled[ne.index]||(this._gl.enableVertexAttribArray(ne.index),this._vertexAttribArraysEnabled[ne.index]=!0),this._vertexAttribPointer(L,ne.index,ne.attributeSize,ne.attributeType||this._gl.FLOAT,ne.normalized||!1,W,ne.offset),this._gl.vertexAttribDivisor(ne.index,ne.divisor===void 0?1:ne.divisor),this._currentInstanceLocations.push(ne.index),this._currentInstanceBuffers.push(L))}},U.prototype.disableInstanceAttributeByName=function(L){if(this._currentEffect){var j=this._currentEffect.getAttributeLocationByName(L);this.disableInstanceAttribute(j)}},U.prototype.disableInstanceAttribute=function(L){for(var j,Y=!1;(j=this._currentInstanceLocations.indexOf(L))!==-1;)this._currentInstanceLocations.splice(j,1),this._currentInstanceBuffers.splice(j,1),Y=!0,j=this._currentInstanceLocations.indexOf(L);Y&&(this._gl.vertexAttribDivisor(L,0),this.disableAttributeByIndex(L))},U.prototype.disableAttributeByIndex=function(L){this._gl.disableVertexAttribArray(L),this._vertexAttribArraysEnabled[L]=!1,this._currentBufferPointers[L].active=!1},U.prototype.draw=function(L,j,Y,W){this.drawElementsType(L?b.a.MATERIAL_TriangleFillMode:b.a.MATERIAL_WireFrameFillMode,j,Y,W)},U.prototype.drawPointClouds=function(L,j,Y){this.drawArraysType(b.a.MATERIAL_PointFillMode,L,j,Y)},U.prototype.drawUnIndexed=function(L,j,Y,W){this.drawArraysType(L?b.a.MATERIAL_TriangleFillMode:b.a.MATERIAL_WireFrameFillMode,j,Y,W)},U.prototype.drawElementsType=function(L,j,Y,W){this.applyStates(),this._reportDrawCall();var re=this._drawMode(L),ne=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,ge=this._uintIndicesCurrentlySet?4:2;W?this._gl.drawElementsInstanced(re,Y,ne,j*ge,W):this._gl.drawElements(re,Y,ne,j*ge)},U.prototype.drawArraysType=function(L,j,Y,W){this.applyStates(),this._reportDrawCall();var re=this._drawMode(L);W?this._gl.drawArraysInstanced(re,j,Y,W):this._gl.drawArrays(re,j,Y)},U.prototype._drawMode=function(L){switch(L){case b.a.MATERIAL_TriangleFillMode:return this._gl.TRIANGLES;case b.a.MATERIAL_PointFillMode:return this._gl.POINTS;case b.a.MATERIAL_WireFrameFillMode:return this._gl.LINES;case b.a.MATERIAL_PointListDrawMode:return this._gl.POINTS;case b.a.MATERIAL_LineListDrawMode:return this._gl.LINES;case b.a.MATERIAL_LineLoopDrawMode:return this._gl.LINE_LOOP;case b.a.MATERIAL_LineStripDrawMode:return this._gl.LINE_STRIP;case b.a.MATERIAL_TriangleStripDrawMode:return this._gl.TRIANGLE_STRIP;case b.a.MATERIAL_TriangleFanDrawMode:return this._gl.TRIANGLE_FAN;default:return this._gl.TRIANGLES}},U.prototype._reportDrawCall=function(){},U.prototype._releaseEffect=function(L){this._compiledEffects[L._key]&&(delete this._compiledEffects[L._key],this._deletePipelineContext(L.getPipelineContext()))},U.prototype._deletePipelineContext=function(L){var j=L;j&&j.program&&(j.program.__SPECTOR_rebuildProgram=null,this._gl.deleteProgram(j.program))},U.prototype.createEffect=function(L,j,Y,W,re,ne,ge,_e,ce){var ie=(L.vertexElement||L.vertex||L.vertexToken||L.vertexSource||L)+"+"+(L.fragmentElement||L.fragment||L.fragmentToken||L.fragmentSource||L)+"@"+(re||j.defines);if(this._compiledEffects[ie]){var Z=this._compiledEffects[ie];return ge&&Z.isReady()&&ge(Z),Z}var te=new m.a(L,j,Y,W,this,re,ne,ge,_e,ce);return te._key=ie,this._compiledEffects[ie]=te,te},U._ConcatenateShader=function(L,j,Y){return Y===void 0&&(Y=""),Y+(j?j+`
`:"")+L},U.prototype._compileShader=function(L,j,Y,W){return this._compileRawShader(U._ConcatenateShader(L,Y,W),j)},U.prototype._compileRawShader=function(L,j){var Y=this._gl,W=Y.createShader(j==="vertex"?Y.VERTEX_SHADER:Y.FRAGMENT_SHADER);if(!W)throw new Error("Something went wrong while compile the shader.");return Y.shaderSource(W,L),Y.compileShader(W),W},U.prototype._getShaderSource=function(L){return this._gl.getShaderSource(L)},U.prototype.createRawShaderProgram=function(L,j,Y,W,re){re===void 0&&(re=null),W=W||this._gl;var ne=this._compileRawShader(j,"vertex"),ge=this._compileRawShader(Y,"fragment");return this._createShaderProgram(L,ne,ge,W,re)},U.prototype.createShaderProgram=function(L,j,Y,W,re,ne){ne===void 0&&(ne=null),re=re||this._gl;var ge=this._webGLVersion>1?`#version 300 es
#define WEBGL2 
`:"",_e=this._compileShader(j,"vertex",W,ge),ce=this._compileShader(Y,"fragment",W,ge);return this._createShaderProgram(L,_e,ce,re,ne)},U.prototype.createPipelineContext=function(){var L=new g.a;return L.engine=this,this._caps.parallelShaderCompile&&(L.isParallelCompiled=!0),L},U.prototype._createShaderProgram=function(L,j,Y,W,re){var ne=W.createProgram();if(L.program=ne,!ne)throw new Error("Unable to create program");return W.attachShader(ne,j),W.attachShader(ne,Y),W.linkProgram(ne),L.context=W,L.vertexShader=j,L.fragmentShader=Y,L.isParallelCompiled||this._finalizePipelineContext(L),ne},U.prototype._finalizePipelineContext=function(L){var j=L.context,Y=L.vertexShader,W=L.fragmentShader,re=L.program;if(!j.getProgramParameter(re,j.LINK_STATUS)){var ne,ge;if(!this._gl.getShaderParameter(Y,this._gl.COMPILE_STATUS)&&(ne=this._gl.getShaderInfoLog(Y)))throw L.vertexCompilationError=ne,new Error("VERTEX SHADER "+ne);if(!this._gl.getShaderParameter(W,this._gl.COMPILE_STATUS)&&(ne=this._gl.getShaderInfoLog(W)))throw L.fragmentCompilationError=ne,new Error("FRAGMENT SHADER "+ne);if(ge=j.getProgramInfoLog(re))throw L.programLinkError=ge,new Error(ge)}if(this.validateShaderPrograms&&(j.validateProgram(re),!j.getProgramParameter(re,j.VALIDATE_STATUS)&&(ge=j.getProgramInfoLog(re))))throw L.programValidationError=ge,new Error(ge);j.deleteShader(Y),j.deleteShader(W),L.vertexShader=void 0,L.fragmentShader=void 0,L.onCompiled&&(L.onCompiled(),L.onCompiled=void 0)},U.prototype._preparePipelineContext=function(L,j,Y,W,re,ne,ge){var _e=L;_e.program=W?this.createRawShaderProgram(_e,j,Y,void 0,ge):this.createShaderProgram(_e,j,Y,ne,void 0,ge),_e.program.__SPECTOR_rebuildProgram=re},U.prototype._isRenderingStateCompiled=function(L){var j=L;return!!this._gl.getProgramParameter(j.program,this._caps.parallelShaderCompile.COMPLETION_STATUS_KHR)&&(this._finalizePipelineContext(j),!0)},U.prototype._executeWhenRenderingStateIsCompiled=function(L,j){var Y=L;if(Y.isParallelCompiled){var W=Y.onCompiled;Y.onCompiled=W?function(){W(),j()}:j}else j()},U.prototype.getUniforms=function(L,j){for(var Y=new Array,W=L,re=0;re<j.length;re++)Y.push(this._gl.getUniformLocation(W.program,j[re]));return Y},U.prototype.getAttributes=function(L,j){for(var Y=[],W=L,re=0;re<j.length;re++)try{Y.push(this._gl.getAttribLocation(W.program,j[re]))}catch(ne){Y.push(-1)}return Y},U.prototype.enableEffect=function(L){L&&L!==this._currentEffect&&(this.bindSamplers(L),this._currentEffect=L,L.onBind&&L.onBind(L),L._onBindObservable&&L._onBindObservable.notifyObservers(L))},U.prototype.setInt=function(L,j){return!!L&&(this._gl.uniform1i(L,j),!0)},U.prototype.setIntArray=function(L,j){return!!L&&(this._gl.uniform1iv(L,j),!0)},U.prototype.setIntArray2=function(L,j){return!(!L||j.length%2!=0)&&(this._gl.uniform2iv(L,j),!0)},U.prototype.setIntArray3=function(L,j){return!(!L||j.length%3!=0)&&(this._gl.uniform3iv(L,j),!0)},U.prototype.setIntArray4=function(L,j){return!(!L||j.length%4!=0)&&(this._gl.uniform4iv(L,j),!0)},U.prototype.setArray=function(L,j){return!!L&&(this._gl.uniform1fv(L,j),!0)},U.prototype.setArray2=function(L,j){return!(!L||j.length%2!=0)&&(this._gl.uniform2fv(L,j),!0)},U.prototype.setArray3=function(L,j){return!(!L||j.length%3!=0)&&(this._gl.uniform3fv(L,j),!0)},U.prototype.setArray4=function(L,j){return!(!L||j.length%4!=0)&&(this._gl.uniform4fv(L,j),!0)},U.prototype.setMatrices=function(L,j){return!!L&&(this._gl.uniformMatrix4fv(L,!1,j),!0)},U.prototype.setMatrix3x3=function(L,j){return!!L&&(this._gl.uniformMatrix3fv(L,!1,j),!0)},U.prototype.setMatrix2x2=function(L,j){return!!L&&(this._gl.uniformMatrix2fv(L,!1,j),!0)},U.prototype.setFloat=function(L,j){return!!L&&(this._gl.uniform1f(L,j),!0)},U.prototype.setFloat2=function(L,j,Y){return!!L&&(this._gl.uniform2f(L,j,Y),!0)},U.prototype.setFloat3=function(L,j,Y,W){return!!L&&(this._gl.uniform3f(L,j,Y,W),!0)},U.prototype.setFloat4=function(L,j,Y,W,re){return!!L&&(this._gl.uniform4f(L,j,Y,W,re),!0)},U.prototype.applyStates=function(){if(this._depthCullingState.apply(this._gl),this._stencilState.apply(this._gl),this._alphaState.apply(this._gl),this._colorWriteChanged){this._colorWriteChanged=!1;var L=this._colorWrite;this._gl.colorMask(L,L,L,L)}},U.prototype.setColorWrite=function(L){L!==this._colorWrite&&(this._colorWriteChanged=!0,this._colorWrite=L)},U.prototype.getColorWrite=function(){return this._colorWrite},Object.defineProperty(U.prototype,"depthCullingState",{get:function(){return this._depthCullingState},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"alphaState",{get:function(){return this._alphaState},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"stencilState",{get:function(){return this._stencilState},enumerable:!1,configurable:!0}),U.prototype.clearInternalTexturesCache=function(){this._internalTexturesCache=[]},U.prototype.wipeCaches=function(L){this.preventCacheWipeBetweenFrames&&!L||(this._currentEffect=null,this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0,this._unbindVertexArrayObject(),L&&(this._currentProgram=null,this.resetTextureCache(),this._stencilState.reset(),this._depthCullingState.reset(),this._depthCullingState.depthFunc=this._gl.LEQUAL,this._alphaState.reset(),this._alphaMode=b.a.ALPHA_ADD,this._alphaEquation=b.a.ALPHA_DISABLE,this._colorWrite=!0,this._colorWriteChanged=!0,this._unpackFlipYCached=null,this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),this._mustWipeVertexAttributes=!0,this.unbindAllAttributes()),this._resetVertexBufferBinding(),this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this.bindIndexBuffer(null))},U.prototype._getSamplingParameters=function(L,j){var Y=this._gl,W=Y.NEAREST,re=Y.NEAREST;switch(L){case b.a.TEXTURE_LINEAR_LINEAR_MIPNEAREST:W=Y.LINEAR,re=j?Y.LINEAR_MIPMAP_NEAREST:Y.LINEAR;break;case b.a.TEXTURE_LINEAR_LINEAR_MIPLINEAR:W=Y.LINEAR,re=j?Y.LINEAR_MIPMAP_LINEAR:Y.LINEAR;break;case b.a.TEXTURE_NEAREST_NEAREST_MIPLINEAR:W=Y.NEAREST,re=j?Y.NEAREST_MIPMAP_LINEAR:Y.NEAREST;break;case b.a.TEXTURE_NEAREST_NEAREST_MIPNEAREST:W=Y.NEAREST,re=j?Y.NEAREST_MIPMAP_NEAREST:Y.NEAREST;break;case b.a.TEXTURE_NEAREST_LINEAR_MIPNEAREST:W=Y.NEAREST,re=j?Y.LINEAR_MIPMAP_NEAREST:Y.LINEAR;break;case b.a.TEXTURE_NEAREST_LINEAR_MIPLINEAR:W=Y.NEAREST,re=j?Y.LINEAR_MIPMAP_LINEAR:Y.LINEAR;break;case b.a.TEXTURE_NEAREST_LINEAR:W=Y.NEAREST,re=Y.LINEAR;break;case b.a.TEXTURE_NEAREST_NEAREST:W=Y.NEAREST,re=Y.NEAREST;break;case b.a.TEXTURE_LINEAR_NEAREST_MIPNEAREST:W=Y.LINEAR,re=j?Y.NEAREST_MIPMAP_NEAREST:Y.NEAREST;break;case b.a.TEXTURE_LINEAR_NEAREST_MIPLINEAR:W=Y.LINEAR,re=j?Y.NEAREST_MIPMAP_LINEAR:Y.NEAREST;break;case b.a.TEXTURE_LINEAR_LINEAR:W=Y.LINEAR,re=Y.LINEAR;break;case b.a.TEXTURE_LINEAR_NEAREST:W=Y.LINEAR,re=Y.NEAREST}return{min:re,mag:W}},U.prototype._createTexture=function(){var L=this._gl.createTexture();if(!L)throw new Error("Unable to create texture");return L},U.prototype.createTexture=function(L,j,Y,W,re,ne,ge,_e,ce,ie,Z,te,B){var G=this;re===void 0&&(re=b.a.TEXTURE_TRILINEAR_SAMPLINGMODE),ne===void 0&&(ne=null),ge===void 0&&(ge=null),_e===void 0&&(_e=null),ce===void 0&&(ce=null),ie===void 0&&(ie=null),Z===void 0&&(Z=null);var $=(L=L||"").substr(0,5)==="data:",le=L.substr(0,5)==="blob:",se=$&&L.indexOf(";base64,")!==-1,q=ce||new p.a(this,p.b.Url),H=L;!this._transformTextureUrl||se||ce||_e||(L=this._transformTextureUrl(L)),H!==L&&(q._originalUrl=H);var X=L.lastIndexOf("."),J=Z||(X>-1?L.substring(X).toLowerCase():""),Q=null;J.indexOf("?")>-1&&(J=J.split("?")[0]);for(var ee=0,pe=U._TextureLoaders;ee<pe.length;ee++){var Te=pe[ee];if(Te.canLoad(J,te)){Q=Te;break}}W&&W._addPendingData(q),q.url=L,q.generateMipMaps=!j,q.samplingMode=re,q.invertY=Y,this._doNotHandleContextLost||(q._buffer=_e);var ve=null;ne&&!ce&&(ve=q.onLoadedObservable.add(ne)),ce||this._internalTexturesCache.push(q);var he=function(Se,Ue){W&&W._removePendingData(q),L===H?(ve&&q.onLoadedObservable.remove(ve),E.a.UseFallbackTexture&&G.createTexture(E.a.FallbackTexture,j,q.invertY,W,re,null,ge,_e,q),ge&&ge((Se||"Unknown error")+(E.a.UseFallbackTexture?" - Fallback texture was used":""),Ue)):(x.a.Warn("Failed to load "+L+", falling back to "+H),G.createTexture(H,j,q.invertY,W,re,ne,ge,_e,q,ie,Z,te,B))};if(Q){var be=function(Se){Q.loadData(Se,q,function(Ue,We,Ze,Qe,Xe,nt){nt?he("TextureLoader failed to load data"):G._prepareWebGLTexture(q,W,Ue,We,q.invertY,!Ze,Qe,function(){return Xe(),!1},re)},B)};_e?_e instanceof ArrayBuffer?be(new Uint8Array(_e)):ArrayBuffer.isView(_e)?be(_e):ge&&ge("Unable to load: only ArrayBuffer or ArrayBufferView is supported",null):this._loadFile(L,function(Se){return be(new Uint8Array(Se))},void 0,W?W.offlineProvider:void 0,!0,function(Se,Ue){he("Unable to load "+(Se&&Se.responseURL,Ue))})}else{var xe=function(Se){le&&!G._doNotHandleContextLost&&(q._buffer=Se),G._prepareWebGLTexture(q,W,Se.width,Se.height,q.invertY,j,!1,function(Ue,We,Ze){var Qe=G._gl,Xe=Se.width===Ue&&Se.height===We,nt=ie?G._getInternalFormat(ie):J===".jpg"?Qe.RGB:Qe.RGBA;if(Xe)return Qe.texImage2D(Qe.TEXTURE_2D,0,nt,nt,Qe.UNSIGNED_BYTE,Se),!1;var Ke=G._caps.maxTextureSize;if(Se.width>Ke||Se.height>Ke||!G._supportsHardwareTextureRescaling)return G._prepareWorkingCanvas(),!(!G._workingCanvas||!G._workingContext)&&(G._workingCanvas.width=Ue,G._workingCanvas.height=We,G._workingContext.drawImage(Se,0,0,Se.width,Se.height,0,0,Ue,We),Qe.texImage2D(Qe.TEXTURE_2D,0,nt,nt,Qe.UNSIGNED_BYTE,G._workingCanvas),q.width=Ue,q.height=We,!1);var ct=new p.a(G,p.b.Temp);return G._bindTextureDirectly(Qe.TEXTURE_2D,ct,!0),Qe.texImage2D(Qe.TEXTURE_2D,0,nt,nt,Qe.UNSIGNED_BYTE,Se),G._rescaleTexture(ct,q,W,nt,function(){G._releaseTexture(ct),G._bindTextureDirectly(Qe.TEXTURE_2D,q,!0),Ze()}),!0},re)};!$||se?_e&&(_e.decoding||_e.close)?xe(_e):U._FileToolsLoadImage(L,xe,he,W?W.offlineProvider:null,te):typeof _e=="string"||_e instanceof ArrayBuffer||ArrayBuffer.isView(_e)||_e instanceof Blob?U._FileToolsLoadImage(_e,xe,he,W?W.offlineProvider:null,te):_e&&xe(_e)}return q},U._FileToolsLoadImage=function(L,j,Y,W,re){throw S.a.WarnImport("FileTools")},U.prototype._rescaleTexture=function(L,j,Y,W,re){},U.prototype.createRawTexture=function(L,j,Y,W,re,ne,ge,_e,ce){throw ce===void 0&&(ce=b.a.TEXTURETYPE_UNSIGNED_INT),S.a.WarnImport("Engine.RawTexture")},U.prototype.createRawCubeTexture=function(L,j,Y,W,re,ne,ge,_e){throw S.a.WarnImport("Engine.RawTexture")},U.prototype.createRawTexture3D=function(L,j,Y,W,re,ne,ge,_e,ce,ie){throw ie===void 0&&(ie=b.a.TEXTURETYPE_UNSIGNED_INT),S.a.WarnImport("Engine.RawTexture")},U.prototype.createRawTexture2DArray=function(L,j,Y,W,re,ne,ge,_e,ce,ie){throw ie===void 0&&(ie=b.a.TEXTURETYPE_UNSIGNED_INT),S.a.WarnImport("Engine.RawTexture")},U.prototype._unpackFlipY=function(L){this._unpackFlipYCached!==L&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,L?1:0),this.enableUnpackFlipYCached&&(this._unpackFlipYCached=L))},U.prototype._getUnpackAlignement=function(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)},U.prototype._getTextureTarget=function(L){return L.isCube?this._gl.TEXTURE_CUBE_MAP:L.is3D?this._gl.TEXTURE_3D:L.is2DArray||L.isMultiview?this._gl.TEXTURE_2D_ARRAY:this._gl.TEXTURE_2D},U.prototype.updateTextureSamplingMode=function(L,j,Y){Y===void 0&&(Y=!1);var W=this._getTextureTarget(j),re=this._getSamplingParameters(L,j.generateMipMaps||Y);this._setTextureParameterInteger(W,this._gl.TEXTURE_MAG_FILTER,re.mag,j),this._setTextureParameterInteger(W,this._gl.TEXTURE_MIN_FILTER,re.min),Y&&(j.generateMipMaps=!0,this._gl.generateMipmap(W)),this._bindTextureDirectly(W,null),j.samplingMode=L},U.prototype.updateTextureWrappingMode=function(L,j,Y,W){Y===void 0&&(Y=null),W===void 0&&(W=null);var re=this._getTextureTarget(L);j!==null&&(this._setTextureParameterInteger(re,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(j),L),L._cachedWrapU=j),Y!==null&&(this._setTextureParameterInteger(re,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(Y),L),L._cachedWrapV=Y),(L.is2DArray||L.is3D)&&W!==null&&(this._setTextureParameterInteger(re,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(W),L),L._cachedWrapR=W),this._bindTextureDirectly(re,null)},U.prototype._setupDepthStencilTexture=function(L,j,Y,W,re){var ne=j.width||j,ge=j.height||j,_e=j.layers||0;L.baseWidth=ne,L.baseHeight=ge,L.width=ne,L.height=ge,L.is2DArray=_e>0,L.depth=_e,L.isReady=!0,L.samples=1,L.generateMipMaps=!1,L._generateDepthBuffer=!0,L._generateStencilBuffer=Y,L.samplingMode=W?b.a.TEXTURE_BILINEAR_SAMPLINGMODE:b.a.TEXTURE_NEAREST_SAMPLINGMODE,L.type=b.a.TEXTURETYPE_UNSIGNED_INT,L._comparisonFunction=re;var ce=this._gl,ie=this._getTextureTarget(L),Z=this._getSamplingParameters(L.samplingMode,!1);ce.texParameteri(ie,ce.TEXTURE_MAG_FILTER,Z.mag),ce.texParameteri(ie,ce.TEXTURE_MIN_FILTER,Z.min),ce.texParameteri(ie,ce.TEXTURE_WRAP_S,ce.CLAMP_TO_EDGE),ce.texParameteri(ie,ce.TEXTURE_WRAP_T,ce.CLAMP_TO_EDGE),re===0?(ce.texParameteri(ie,ce.TEXTURE_COMPARE_FUNC,b.a.LEQUAL),ce.texParameteri(ie,ce.TEXTURE_COMPARE_MODE,ce.NONE)):(ce.texParameteri(ie,ce.TEXTURE_COMPARE_FUNC,re),ce.texParameteri(ie,ce.TEXTURE_COMPARE_MODE,ce.COMPARE_REF_TO_TEXTURE))},U.prototype._uploadCompressedDataToTextureDirectly=function(L,j,Y,W,re,ne,ge){ne===void 0&&(ne=0),ge===void 0&&(ge=0);var _e=this._gl,ce=_e.TEXTURE_2D;L.isCube&&(ce=_e.TEXTURE_CUBE_MAP_POSITIVE_X+ne),this._gl.compressedTexImage2D(ce,ge,j,Y,W,0,re)},U.prototype._uploadDataToTextureDirectly=function(L,j,Y,W,re,ne){Y===void 0&&(Y=0),W===void 0&&(W=0),ne===void 0&&(ne=!1);var ge=this._gl,_e=this._getWebGLTextureType(L.type),ce=this._getInternalFormat(L.format),ie=re===void 0?this._getRGBABufferInternalSizedFormat(L.type,L.format):this._getInternalFormat(re);this._unpackFlipY(L.invertY);var Z=ge.TEXTURE_2D;L.isCube&&(Z=ge.TEXTURE_CUBE_MAP_POSITIVE_X+Y);var te=Math.round(Math.log(L.width)*Math.LOG2E),B=Math.round(Math.log(L.height)*Math.LOG2E),G=ne?L.width:Math.pow(2,Math.max(te-W,0)),$=ne?L.height:Math.pow(2,Math.max(B-W,0));ge.texImage2D(Z,W,ie,G,$,0,ce,_e,j)},U.prototype.updateTextureData=function(L,j,Y,W,re,ne,ge,_e){ge===void 0&&(ge=0),_e===void 0&&(_e=0);var ce=this._gl,ie=this._getWebGLTextureType(L.type),Z=this._getInternalFormat(L.format);this._unpackFlipY(L.invertY);var te=ce.TEXTURE_2D;L.isCube&&(te=ce.TEXTURE_CUBE_MAP_POSITIVE_X+ge),ce.texSubImage2D(te,_e,Y,W,re,ne,Z,ie,j)},U.prototype._uploadArrayBufferViewToTexture=function(L,j,Y,W){Y===void 0&&(Y=0),W===void 0&&(W=0);var re=this._gl,ne=L.isCube?re.TEXTURE_CUBE_MAP:re.TEXTURE_2D;this._bindTextureDirectly(ne,L,!0),this._uploadDataToTextureDirectly(L,j,Y,W),this._bindTextureDirectly(ne,null,!0)},U.prototype._prepareWebGLTextureContinuation=function(L,j,Y,W,re){var ne=this._gl;if(ne){var ge=this._getSamplingParameters(re,!Y);ne.texParameteri(ne.TEXTURE_2D,ne.TEXTURE_MAG_FILTER,ge.mag),ne.texParameteri(ne.TEXTURE_2D,ne.TEXTURE_MIN_FILTER,ge.min),Y||W||ne.generateMipmap(ne.TEXTURE_2D),this._bindTextureDirectly(ne.TEXTURE_2D,null),j&&j._removePendingData(L),L.onLoadedObservable.notifyObservers(L),L.onLoadedObservable.clear()}},U.prototype._prepareWebGLTexture=function(L,j,Y,W,re,ne,ge,_e,ce){var ie=this;ce===void 0&&(ce=b.a.TEXTURE_TRILINEAR_SAMPLINGMODE);var Z=this.getCaps().maxTextureSize,te=Math.min(Z,this.needPOTTextures?U.GetExponentOfTwo(Y,Z):Y),B=Math.min(Z,this.needPOTTextures?U.GetExponentOfTwo(W,Z):W),G=this._gl;G&&(L._webGLTexture?(this._bindTextureDirectly(G.TEXTURE_2D,L,!0),this._unpackFlipY(re===void 0||!!re),L.baseWidth=Y,L.baseHeight=W,L.width=te,L.height=B,L.isReady=!0,_e(te,B,function(){ie._prepareWebGLTextureContinuation(L,j,ne,ge,ce)})||this._prepareWebGLTextureContinuation(L,j,ne,ge,ce)):j&&j._removePendingData(L))},U.prototype._setupFramebufferDepthAttachments=function(L,j,Y,W,re){re===void 0&&(re=1);var ne=this._gl;if(L&&j)return this._getDepthStencilBuffer(Y,W,re,ne.DEPTH_STENCIL,ne.DEPTH24_STENCIL8,ne.DEPTH_STENCIL_ATTACHMENT);if(j){var ge=ne.DEPTH_COMPONENT16;return this._webGLVersion>1&&(ge=ne.DEPTH_COMPONENT32F),this._getDepthStencilBuffer(Y,W,re,ge,ge,ne.DEPTH_ATTACHMENT)}return L?this._getDepthStencilBuffer(Y,W,re,ne.STENCIL_INDEX8,ne.STENCIL_INDEX8,ne.STENCIL_ATTACHMENT):null},U.prototype._releaseFramebufferObjects=function(L){var j=this._gl;L._framebuffer&&(j.deleteFramebuffer(L._framebuffer),L._framebuffer=null),L._depthStencilBuffer&&(j.deleteRenderbuffer(L._depthStencilBuffer),L._depthStencilBuffer=null),L._MSAAFramebuffer&&(j.deleteFramebuffer(L._MSAAFramebuffer),L._MSAAFramebuffer=null),L._MSAARenderBuffer&&(j.deleteRenderbuffer(L._MSAARenderBuffer),L._MSAARenderBuffer=null)},U.prototype._releaseTexture=function(L){this._releaseFramebufferObjects(L),this._deleteTexture(L._webGLTexture),this.unbindAllTextures();var j=this._internalTexturesCache.indexOf(L);j!==-1&&this._internalTexturesCache.splice(j,1),L._lodTextureHigh&&L._lodTextureHigh.dispose(),L._lodTextureMid&&L._lodTextureMid.dispose(),L._lodTextureLow&&L._lodTextureLow.dispose(),L._irradianceTexture&&L._irradianceTexture.dispose()},U.prototype._deleteTexture=function(L){this._gl.deleteTexture(L)},U.prototype._setProgram=function(L){this._currentProgram!==L&&(this._gl.useProgram(L),this._currentProgram=L)},U.prototype.bindSamplers=function(L){var j=L.getPipelineContext();this._setProgram(j.program);for(var Y=L.getSamplers(),W=0;W<Y.length;W++){var re=L.getUniform(Y[W]);re&&(this._boundUniforms[W]=re)}this._currentEffect=null},U.prototype._activateCurrentTexture=function(){this._currentTextureChannel!==this._activeChannel&&(this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel),this._currentTextureChannel=this._activeChannel)},U.prototype._bindTextureDirectly=function(L,j,Y,W){Y===void 0&&(Y=!1),W===void 0&&(W=!1);var re=!1,ne=j&&j._associatedChannel>-1;return Y&&ne&&(this._activeChannel=j._associatedChannel),this._boundTexturesCache[this._activeChannel]!==j||W?(this._activateCurrentTexture(),j&&j.isMultiview?this._gl.bindTexture(L,j?j._colorTextureArray:null):this._gl.bindTexture(L,j?j._webGLTexture:null),this._boundTexturesCache[this._activeChannel]=j,j&&(j._associatedChannel=this._activeChannel)):Y&&(re=!0,this._activateCurrentTexture()),ne&&!Y&&this._bindSamplerUniformToChannel(j._associatedChannel,this._activeChannel),re},U.prototype._bindTexture=function(L,j){if(L!==void 0){j&&(j._associatedChannel=L),this._activeChannel=L;var Y=j?this._getTextureTarget(j):this._gl.TEXTURE_2D;this._bindTextureDirectly(Y,j)}},U.prototype.unbindAllTextures=function(){for(var L=0;L<this._maxSimultaneousTextures;L++)this._activeChannel=L,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))},U.prototype.setTexture=function(L,j,Y){L!==void 0&&(j&&(this._boundUniforms[L]=j),this._setTexture(L,Y))},U.prototype._bindSamplerUniformToChannel=function(L,j){var Y=this._boundUniforms[L];Y&&Y._currentState!==j&&(this._gl.uniform1i(Y,j),Y._currentState=j)},U.prototype._getTextureWrapMode=function(L){switch(L){case b.a.TEXTURE_WRAP_ADDRESSMODE:return this._gl.REPEAT;case b.a.TEXTURE_CLAMP_ADDRESSMODE:return this._gl.CLAMP_TO_EDGE;case b.a.TEXTURE_MIRROR_ADDRESSMODE:return this._gl.MIRRORED_REPEAT}return this._gl.REPEAT},U.prototype._setTexture=function(L,j,Y,W){if(Y===void 0&&(Y=!1),W===void 0&&(W=!1),!j)return this._boundTexturesCache[L]!=null&&(this._activeChannel=L,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))),!1;if(j.video)this._activeChannel=L,j.update();else if(j.delayLoadState===b.a.DELAYLOADSTATE_NOTLOADED)return j.delayLoad(),!1;var re;re=W?j.depthStencilTexture:j.isReady()?j.getInternalTexture():j.isCube?this.emptyCubeTexture:j.is3D?this.emptyTexture3D:j.is2DArray?this.emptyTexture2DArray:this.emptyTexture,!Y&&re&&(re._associatedChannel=L);var ne=!0;this._boundTexturesCache[L]===re&&(Y||this._bindSamplerUniformToChannel(re._associatedChannel,L),ne=!1),this._activeChannel=L;var ge=this._getTextureTarget(re);if(ne&&this._bindTextureDirectly(ge,re,Y),re&&!re.isMultiview){if(re.isCube&&re._cachedCoordinatesMode!==j.coordinatesMode){re._cachedCoordinatesMode=j.coordinatesMode;var _e=j.coordinatesMode!==b.a.TEXTURE_CUBIC_MODE&&j.coordinatesMode!==b.a.TEXTURE_SKYBOX_MODE?b.a.TEXTURE_WRAP_ADDRESSMODE:b.a.TEXTURE_CLAMP_ADDRESSMODE;j.wrapU=_e,j.wrapV=_e}re._cachedWrapU!==j.wrapU&&(re._cachedWrapU=j.wrapU,this._setTextureParameterInteger(ge,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(j.wrapU),re)),re._cachedWrapV!==j.wrapV&&(re._cachedWrapV=j.wrapV,this._setTextureParameterInteger(ge,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(j.wrapV),re)),re.is3D&&re._cachedWrapR!==j.wrapR&&(re._cachedWrapR=j.wrapR,this._setTextureParameterInteger(ge,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(j.wrapR),re)),this._setAnisotropicLevel(ge,re,j.anisotropicFilteringLevel)}return!0},U.prototype.setTextureArray=function(L,j,Y){if(L!==void 0&&j){this._textureUnits&&this._textureUnits.length===Y.length||(this._textureUnits=new Int32Array(Y.length));for(var W=0;W<Y.length;W++){var re=Y[W].getInternalTexture();re?(this._textureUnits[W]=L+W,re._associatedChannel=L+W):this._textureUnits[W]=-1}this._gl.uniform1iv(j,this._textureUnits);for(var ne=0;ne<Y.length;ne++)this._setTexture(this._textureUnits[ne],Y[ne],!0)}},U.prototype._setAnisotropicLevel=function(L,j,Y){var W=this._caps.textureAnisotropicFilterExtension;j.samplingMode!==b.a.TEXTURE_LINEAR_LINEAR_MIPNEAREST&&j.samplingMode!==b.a.TEXTURE_LINEAR_LINEAR_MIPLINEAR&&j.samplingMode!==b.a.TEXTURE_LINEAR_LINEAR&&(Y=1),W&&j._cachedAnisotropicFilteringLevel!==Y&&(this._setTextureParameterFloat(L,W.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(Y,this._caps.maxAnisotropy),j),j._cachedAnisotropicFilteringLevel=Y)},U.prototype._setTextureParameterFloat=function(L,j,Y,W){this._bindTextureDirectly(L,W,!0,!0),this._gl.texParameterf(L,j,Y)},U.prototype._setTextureParameterInteger=function(L,j,Y,W){W&&this._bindTextureDirectly(L,W,!0,!0),this._gl.texParameteri(L,j,Y)},U.prototype.unbindAllAttributes=function(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(var L=0;L<this._caps.maxVertexAttribs;L++)this.disableAttributeByIndex(L)}else{L=0;for(var j=this._vertexAttribArraysEnabled.length;L<j;L++)L>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[L]||this.disableAttributeByIndex(L)}},U.prototype.releaseEffects=function(){for(var L in this._compiledEffects){var j=this._compiledEffects[L].getPipelineContext();this._deletePipelineContext(j)}this._compiledEffects={}},U.prototype.dispose=function(){this.stopRenderLoop(),this.onBeforeTextureInitObservable&&this.onBeforeTextureInitObservable.clear(),this._emptyTexture&&(this._releaseTexture(this._emptyTexture),this._emptyTexture=null),this._emptyCubeTexture&&(this._releaseTexture(this._emptyCubeTexture),this._emptyCubeTexture=null),this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.releaseEffects(),this.unbindAllAttributes(),this._boundUniforms=[],P.a.IsWindowObjectExist()&&this._renderingCanvas&&(this._doNotHandleContextLost||(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored))),this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers=[],this._renderingCanvas=null,this._currentProgram=null,this._boundRenderFunction=null,m.a.ResetCache();for(var L=0,j=this._activeRequests;L<j.length;L++)j[L].abort()},U.prototype.attachContextLostEvent=function(L){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",L,!1)},U.prototype.attachContextRestoredEvent=function(L){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",L,!1)},U.prototype.getError=function(){return this._gl.getError()},U.prototype._canRenderToFloatFramebuffer=function(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(b.a.TEXTURETYPE_FLOAT)},U.prototype._canRenderToHalfFloatFramebuffer=function(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(b.a.TEXTURETYPE_HALF_FLOAT)},U.prototype._canRenderToFramebuffer=function(L){for(var j=this._gl;j.getError()!==j.NO_ERROR;);var Y=!0,W=j.createTexture();j.bindTexture(j.TEXTURE_2D,W),j.texImage2D(j.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(L),1,1,0,j.RGBA,this._getWebGLTextureType(L),null),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_MIN_FILTER,j.NEAREST),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_MAG_FILTER,j.NEAREST);var re=j.createFramebuffer();j.bindFramebuffer(j.FRAMEBUFFER,re),j.framebufferTexture2D(j.FRAMEBUFFER,j.COLOR_ATTACHMENT0,j.TEXTURE_2D,W,0);var ne=j.checkFramebufferStatus(j.FRAMEBUFFER);if((Y=(Y=Y&&ne===j.FRAMEBUFFER_COMPLETE)&&j.getError()===j.NO_ERROR)&&(j.clear(j.COLOR_BUFFER_BIT),Y=Y&&j.getError()===j.NO_ERROR),Y){j.bindFramebuffer(j.FRAMEBUFFER,null);var ge=j.RGBA,_e=j.UNSIGNED_BYTE,ce=new Uint8Array(4);j.readPixels(0,0,1,1,ge,_e,ce),Y=Y&&j.getError()===j.NO_ERROR}for(j.deleteTexture(W),j.deleteFramebuffer(re),j.bindFramebuffer(j.FRAMEBUFFER,null);!Y&&j.getError()!==j.NO_ERROR;);return Y},U.prototype._getWebGLTextureType=function(L){if(this._webGLVersion===1){switch(L){case b.a.TEXTURETYPE_FLOAT:return this._gl.FLOAT;case b.a.TEXTURETYPE_HALF_FLOAT:return this._gl.HALF_FLOAT_OES;case b.a.TEXTURETYPE_UNSIGNED_BYTE:return this._gl.UNSIGNED_BYTE;case b.a.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4:return this._gl.UNSIGNED_SHORT_4_4_4_4;case b.a.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1:return this._gl.UNSIGNED_SHORT_5_5_5_1;case b.a.TEXTURETYPE_UNSIGNED_SHORT_5_6_5:return this._gl.UNSIGNED_SHORT_5_6_5}return this._gl.UNSIGNED_BYTE}switch(L){case b.a.TEXTURETYPE_BYTE:return this._gl.BYTE;case b.a.TEXTURETYPE_UNSIGNED_BYTE:return this._gl.UNSIGNED_BYTE;case b.a.TEXTURETYPE_SHORT:return this._gl.SHORT;case b.a.TEXTURETYPE_UNSIGNED_SHORT:return this._gl.UNSIGNED_SHORT;case b.a.TEXTURETYPE_INT:return this._gl.INT;case b.a.TEXTURETYPE_UNSIGNED_INTEGER:return this._gl.UNSIGNED_INT;case b.a.TEXTURETYPE_FLOAT:return this._gl.FLOAT;case b.a.TEXTURETYPE_HALF_FLOAT:return this._gl.HALF_FLOAT;case b.a.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4:return this._gl.UNSIGNED_SHORT_4_4_4_4;case b.a.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1:return this._gl.UNSIGNED_SHORT_5_5_5_1;case b.a.TEXTURETYPE_UNSIGNED_SHORT_5_6_5:return this._gl.UNSIGNED_SHORT_5_6_5;case b.a.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case b.a.TEXTURETYPE_UNSIGNED_INT_24_8:return this._gl.UNSIGNED_INT_24_8;case b.a.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case b.a.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case b.a.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV}return this._gl.UNSIGNED_BYTE},U.prototype._getInternalFormat=function(L){var j=this._gl.RGBA;switch(L){case b.a.TEXTUREFORMAT_ALPHA:j=this._gl.ALPHA;break;case b.a.TEXTUREFORMAT_LUMINANCE:j=this._gl.LUMINANCE;break;case b.a.TEXTUREFORMAT_LUMINANCE_ALPHA:j=this._gl.LUMINANCE_ALPHA;break;case b.a.TEXTUREFORMAT_RED:j=this._gl.RED;break;case b.a.TEXTUREFORMAT_RG:j=this._gl.RG;break;case b.a.TEXTUREFORMAT_RGB:j=this._gl.RGB;break;case b.a.TEXTUREFORMAT_RGBA:j=this._gl.RGBA}if(this._webGLVersion>1)switch(L){case b.a.TEXTUREFORMAT_RED_INTEGER:j=this._gl.RED_INTEGER;break;case b.a.TEXTUREFORMAT_RG_INTEGER:j=this._gl.RG_INTEGER;break;case b.a.TEXTUREFORMAT_RGB_INTEGER:j=this._gl.RGB_INTEGER;break;case b.a.TEXTUREFORMAT_RGBA_INTEGER:j=this._gl.RGBA_INTEGER}return j},U.prototype._getRGBABufferInternalSizedFormat=function(L,j){if(this._webGLVersion===1){if(j!==void 0)switch(j){case b.a.TEXTUREFORMAT_ALPHA:return this._gl.ALPHA;case b.a.TEXTUREFORMAT_LUMINANCE:return this._gl.LUMINANCE;case b.a.TEXTUREFORMAT_LUMINANCE_ALPHA:return this._gl.LUMINANCE_ALPHA;case b.a.TEXTUREFORMAT_RGB:return this._gl.RGB}return this._gl.RGBA}switch(L){case b.a.TEXTURETYPE_BYTE:switch(j){case b.a.TEXTUREFORMAT_RED:return this._gl.R8_SNORM;case b.a.TEXTUREFORMAT_RG:return this._gl.RG8_SNORM;case b.a.TEXTUREFORMAT_RGB:return this._gl.RGB8_SNORM;case b.a.TEXTUREFORMAT_RED_INTEGER:return this._gl.R8I;case b.a.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG8I;case b.a.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB8I;case b.a.TEXTUREFORMAT_RGBA_INTEGER:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM}case b.a.TEXTURETYPE_UNSIGNED_BYTE:switch(j){case b.a.TEXTUREFORMAT_RED:return this._gl.R8;case b.a.TEXTUREFORMAT_RG:return this._gl.RG8;case b.a.TEXTUREFORMAT_RGB:return this._gl.RGB8;case b.a.TEXTUREFORMAT_RGBA:return this._gl.RGBA8;case b.a.TEXTUREFORMAT_RED_INTEGER:return this._gl.R8UI;case b.a.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG8UI;case b.a.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB8UI;case b.a.TEXTUREFORMAT_RGBA_INTEGER:return this._gl.RGBA8UI;case b.a.TEXTUREFORMAT_ALPHA:return this._gl.ALPHA;case b.a.TEXTUREFORMAT_LUMINANCE:return this._gl.LUMINANCE;case b.a.TEXTUREFORMAT_LUMINANCE_ALPHA:return this._gl.LUMINANCE_ALPHA;default:return this._gl.RGBA8}case b.a.TEXTURETYPE_SHORT:switch(j){case b.a.TEXTUREFORMAT_RED_INTEGER:return this._gl.R16I;case b.a.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG16I;case b.a.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB16I;case b.a.TEXTUREFORMAT_RGBA_INTEGER:default:return this._gl.RGBA16I}case b.a.TEXTURETYPE_UNSIGNED_SHORT:switch(j){case b.a.TEXTUREFORMAT_RED_INTEGER:return this._gl.R16UI;case b.a.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG16UI;case b.a.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB16UI;case b.a.TEXTUREFORMAT_RGBA_INTEGER:default:return this._gl.RGBA16UI}case b.a.TEXTURETYPE_INT:switch(j){case b.a.TEXTUREFORMAT_RED_INTEGER:return this._gl.R32I;case b.a.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG32I;case b.a.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB32I;case b.a.TEXTUREFORMAT_RGBA_INTEGER:default:return this._gl.RGBA32I}case b.a.TEXTURETYPE_UNSIGNED_INTEGER:switch(j){case b.a.TEXTUREFORMAT_RED_INTEGER:return this._gl.R32UI;case b.a.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG32UI;case b.a.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB32UI;case b.a.TEXTUREFORMAT_RGBA_INTEGER:default:return this._gl.RGBA32UI}case b.a.TEXTURETYPE_FLOAT:switch(j){case b.a.TEXTUREFORMAT_RED:return this._gl.R32F;case b.a.TEXTUREFORMAT_RG:return this._gl.RG32F;case b.a.TEXTUREFORMAT_RGB:return this._gl.RGB32F;case b.a.TEXTUREFORMAT_RGBA:default:return this._gl.RGBA32F}case b.a.TEXTURETYPE_HALF_FLOAT:switch(j){case b.a.TEXTUREFORMAT_RED:return this._gl.R16F;case b.a.TEXTUREFORMAT_RG:return this._gl.RG16F;case b.a.TEXTUREFORMAT_RGB:return this._gl.RGB16F;case b.a.TEXTUREFORMAT_RGBA:default:return this._gl.RGBA16F}case b.a.TEXTURETYPE_UNSIGNED_SHORT_5_6_5:return this._gl.RGB565;case b.a.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV:return this._gl.R11F_G11F_B10F;case b.a.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV:return this._gl.RGB9_E5;case b.a.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4:return this._gl.RGBA4;case b.a.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1:return this._gl.RGB5_A1;case b.a.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV:switch(j){case b.a.TEXTUREFORMAT_RGBA:return this._gl.RGB10_A2;case b.a.TEXTUREFORMAT_RGBA_INTEGER:return this._gl.RGB10_A2UI;default:return this._gl.RGB10_A2}}return this._gl.RGBA8},U.prototype._getRGBAMultiSampleBufferFormat=function(L){return L===b.a.TEXTURETYPE_FLOAT?this._gl.RGBA32F:L===b.a.TEXTURETYPE_HALF_FLOAT?this._gl.RGBA16F:this._gl.RGBA8},U.prototype._loadFile=function(L,j,Y,W,re,ne){var ge=this,_e=U._FileToolsLoadFile(L,j,Y,W,re,ne);return this._activeRequests.push(_e),_e.onCompleteObservable.add(function(ce){ge._activeRequests.splice(ge._activeRequests.indexOf(ce),1)}),_e},U._FileToolsLoadFile=function(L,j,Y,W,re,ne){throw S.a.WarnImport("FileTools")},U.prototype.readPixels=function(L,j,Y,W,re){re===void 0&&(re=!0);var ne=re?4:3,ge=re?this._gl.RGBA:this._gl.RGB,_e=new Uint8Array(W*Y*ne);return this._gl.readPixels(L,j,Y,W,ge,this._gl.UNSIGNED_BYTE,_e),_e},Object.defineProperty(U,"IsSupported",{get:function(){return this.isSupported()},enumerable:!1,configurable:!0}),U.isSupported=function(){if(this._HasMajorPerformanceCaveat!==null)return!this._HasMajorPerformanceCaveat;if(this._IsSupported===null)try{var L=O.a.CreateCanvas(1,1),j=L.getContext("webgl")||L.getContext("experimental-webgl");this._IsSupported=j!=null&&!!window.WebGLRenderingContext}catch(Y){this._IsSupported=!1}return this._IsSupported},Object.defineProperty(U,"HasMajorPerformanceCaveat",{get:function(){if(this._HasMajorPerformanceCaveat===null)try{var L=O.a.CreateCanvas(1,1),j=L.getContext("webgl",{failIfMajorPerformanceCaveat:!0})||L.getContext("experimental-webgl",{failIfMajorPerformanceCaveat:!0});this._HasMajorPerformanceCaveat=!j}catch(Y){this._HasMajorPerformanceCaveat=!1}return this._HasMajorPerformanceCaveat},enumerable:!1,configurable:!0}),U.CeilingPOT=function(L){return L--,L|=L>>1,L|=L>>2,L|=L>>4,L|=L>>8,L|=L>>16,++L},U.FloorPOT=function(L){return L|=L>>1,L|=L>>2,L|=L>>4,L|=L>>8,(L|=L>>16)-(L>>1)},U.NearestPOT=function(L){var j=U.CeilingPOT(L),Y=U.FloorPOT(L);return j-L>L-Y?Y:j},U.GetExponentOfTwo=function(L,j,Y){var W;switch(Y===void 0&&(Y=b.a.SCALEMODE_NEAREST),Y){case b.a.SCALEMODE_FLOOR:W=U.FloorPOT(L);break;case b.a.SCALEMODE_NEAREST:W=U.NearestPOT(L);break;case b.a.SCALEMODE_CEILING:default:W=U.CeilingPOT(L)}return Math.min(W,j)},U.QueueNewFrame=function(L,j){return P.a.IsWindowObjectExist()?(j||(j=window),j.requestPostAnimationFrame?j.requestPostAnimationFrame(L):j.requestAnimationFrame?j.requestAnimationFrame(L):j.msRequestAnimationFrame?j.msRequestAnimationFrame(L):j.webkitRequestAnimationFrame?j.webkitRequestAnimationFrame(L):j.mozRequestAnimationFrame?j.mozRequestAnimationFrame(L):j.oRequestAnimationFrame?j.oRequestAnimationFrame(L):window.setTimeout(L,16)):typeof requestAnimationFrame!="undefined"?requestAnimationFrame(L):setTimeout(L,16)},U.prototype.getHostDocument=function(){return this._renderingCanvas&&this._renderingCanvas.ownerDocument?this._renderingCanvas.ownerDocument:document},U.ExceptionList=[{key:"Chrome/63.0",capture:"63\\.0\\.3239\\.(\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/72.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/73.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/74.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/71",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/72",capture:null,captureConstraint:null,targets:["vao"]}],U._TextureLoaders=[],U.CollisionsEpsilon=.001,U._IsSupported=null,U._HasMajorPerformanceCaveat=null,U}()},function(h,s,c){c.d(s,"b",function(){return E}),c.d(s,"a",function(){return C});var E,m=c(6),S=c(102),d=c(2),M=c(21);(function(I){I[I.Unknown=0]="Unknown",I[I.Url=1]="Url",I[I.Temp=2]="Temp",I[I.Raw=3]="Raw",I[I.Dynamic=4]="Dynamic",I[I.RenderTarget=5]="RenderTarget",I[I.MultiRenderTarget=6]="MultiRenderTarget",I[I.Cube=7]="Cube",I[I.CubeRaw=8]="CubeRaw",I[I.CubePrefiltered=9]="CubePrefiltered",I[I.Raw3D=10]="Raw3D",I[I.Raw2DArray=11]="Raw2DArray",I[I.Depth=12]="Depth",I[I.CubeRawRGBD=13]="CubeRawRGBD"})(E||(E={}));var C=function(){function I(b,p,x){x===void 0&&(x=!1),this.isReady=!1,this.isCube=!1,this.is3D=!1,this.is2DArray=!1,this.isMultiview=!1,this.url="",this.samplingMode=-1,this.generateMipMaps=!1,this.samples=0,this.type=-1,this.format=-1,this.onLoadedObservable=new m.c,this.width=0,this.height=0,this.depth=0,this.baseWidth=0,this.baseHeight=0,this.baseDepth=0,this.invertY=!1,this._invertVScale=!1,this._associatedChannel=-1,this._source=E.Unknown,this._buffer=null,this._bufferView=null,this._bufferViewArray=null,this._bufferViewArrayArray=null,this._size=0,this._extension="",this._files=null,this._workingCanvas=null,this._workingContext=null,this._framebuffer=null,this._depthStencilBuffer=null,this._MSAAFramebuffer=null,this._MSAARenderBuffer=null,this._attachments=null,this._textureArray=null,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this._isDisabled=!1,this._compression=null,this._generateStencilBuffer=!1,this._generateDepthBuffer=!1,this._comparisonFunction=0,this._sphericalPolynomial=null,this._lodGenerationScale=0,this._lodGenerationOffset=0,this._colorTextureArray=null,this._depthStencilTextureArray=null,this._lodTextureHigh=null,this._lodTextureMid=null,this._lodTextureLow=null,this._isRGBD=!1,this._linearSpecularLOD=!1,this._irradianceTexture=null,this._webGLTexture=null,this._references=1,this._gammaSpace=null,this._engine=b,this._source=p,x||(this._webGLTexture=b._createTexture())}return I.prototype.getEngine=function(){return this._engine},Object.defineProperty(I.prototype,"source",{get:function(){return this._source},enumerable:!1,configurable:!0}),I.prototype.incrementReferences=function(){this._references++},I.prototype.updateSize=function(b,p,x){x===void 0&&(x=1),this.width=b,this.height=p,this.depth=x,this.baseWidth=b,this.baseHeight=p,this.baseDepth=x,this._size=b*p*x},I.prototype._rebuild=function(){var b,p,x=this;switch(this.isReady=!1,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedAnisotropicFilteringLevel=null,this.source){case E.Temp:return;case E.Url:return void(p=this._engine.createTexture((b=this._originalUrl)!==null&&b!==void 0?b:this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,function(){p._swapAndDie(x),x.isReady=!0},null,this._buffer,void 0,this.format));case E.Raw:return(p=this._engine.createRawTexture(this._bufferView,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this),void(this.isReady=!0);case E.Raw3D:return(p=this._engine.createRawTexture3D(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this),void(this.isReady=!0);case E.Raw2DArray:return(p=this._engine.createRawTexture2DArray(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this),void(this.isReady=!0);case E.Dynamic:return(p=this._engine.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode))._swapAndDie(this),void this._engine.updateDynamicTexture(this,this._engine.getRenderingCanvas(),this.invertY,void 0,void 0,!0);case E.RenderTarget:var P=new S.a;if(P.generateDepthBuffer=this._generateDepthBuffer,P.generateMipMaps=this.generateMipMaps,P.generateStencilBuffer=this._generateStencilBuffer,P.samplingMode=this.samplingMode,P.type=this.type,this.isCube)p=this._engine.createRenderTargetCubeTexture(this.width,P);else{var A={width:this.width,height:this.height,layers:this.is2DArray?this.depth:void 0};p=this._engine.createRenderTargetTexture(A,P)}return p._swapAndDie(this),void(this.isReady=!0);case E.Depth:var T={bilinearFiltering:this.samplingMode!==d.a.TEXTURE_BILINEAR_SAMPLINGMODE,comparisonFunction:this._comparisonFunction,generateStencil:this._generateStencilBuffer,isCube:this.isCube},_={width:this.width,height:this.height,layers:this.is2DArray?this.depth:void 0};return(p=this._engine.createDepthStencilTexture(_,T))._swapAndDie(this),void(this.isReady=!0);case E.Cube:return void(p=this._engine.createCubeTexture(this.url,null,this._files,!this.generateMipMaps,function(){p._swapAndDie(x),x.isReady=!0},null,this.format,this._extension));case E.CubeRaw:return(p=this._engine.createRawCubeTexture(this._bufferViewArray,this.width,this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this),void(this.isReady=!0);case E.CubeRawRGBD:return p=this._engine.createRawCubeTexture(null,this.width,this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression),void I._UpdateRGBDAsync(p,this._bufferViewArrayArray,this._sphericalPolynomial,this._lodGenerationScale,this._lodGenerationOffset).then(function(){p._swapAndDie(x),x.isReady=!0});case E.CubePrefiltered:return void((p=this._engine.createPrefilteredCubeTexture(this.url,null,this._lodGenerationScale,this._lodGenerationOffset,function(g){g&&g._swapAndDie(x),x.isReady=!0},null,this.format,this._extension))._sphericalPolynomial=this._sphericalPolynomial)}},I.prototype._swapAndDie=function(b){b._webGLTexture=this._webGLTexture,b._isRGBD=this._isRGBD,this._framebuffer&&(b._framebuffer=this._framebuffer),this._depthStencilBuffer&&(b._depthStencilBuffer=this._depthStencilBuffer),b._depthStencilTexture=this._depthStencilTexture,this._lodTextureHigh&&(b._lodTextureHigh&&b._lodTextureHigh.dispose(),b._lodTextureHigh=this._lodTextureHigh),this._lodTextureMid&&(b._lodTextureMid&&b._lodTextureMid.dispose(),b._lodTextureMid=this._lodTextureMid),this._lodTextureLow&&(b._lodTextureLow&&b._lodTextureLow.dispose(),b._lodTextureLow=this._lodTextureLow),this._irradianceTexture&&(b._irradianceTexture&&b._irradianceTexture.dispose(),b._irradianceTexture=this._irradianceTexture);var p,x=this._engine.getLoadedTexturesCache();(p=x.indexOf(this))!==-1&&x.splice(p,1),(p=x.indexOf(b))===-1&&x.push(b)},I.prototype.dispose=function(){this._webGLTexture&&(this._references--,this._references===0&&(this._engine._releaseTexture(this),this._webGLTexture=null))},I._UpdateRGBDAsync=function(b,p,x,P,A){throw M.a.WarnImport("environmentTextureTools")},I}()},function(h,s,c){c.d(s,"b",function(){return E}),c.d(s,"c",function(){return m}),c.d(s,"a",function(){return S});var E=1/2.2,m=2.2,S=.001},function(h,s,c){c.d(s,"a",function(){return I});var E=c(1),m=c(0),S=c(3),d=c(6),M=c(22),C=c(21),I=function(){function b(p,x){x===void 0&&(x=null),this.state="",this.metadata=null,this.reservedDataStore=null,this._doNotSerialize=!1,this._isDisposed=!1,this.animations=new Array,this._ranges={},this.onReady=null,this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._currentRenderId=-1,this._parentUpdateId=-1,this._childUpdateId=-1,this._waitingParentId=null,this._cache={},this._parentNode=null,this._children=null,this._worldMatrix=m.a.Identity(),this._worldMatrixDeterminant=0,this._worldMatrixDeterminantIsDirty=!0,this._sceneRootNodesIndex=-1,this._animationPropertiesOverride=null,this._isNode=!0,this.onDisposeObservable=new d.c,this._onDisposeObserver=null,this._behaviors=new Array,this.name=p,this.id=p,this._scene=x||M.a.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache()}return b.AddNodeConstructor=function(p,x){this._NodeConstructors[p]=x},b.Construct=function(p,x,P,A){var T=this._NodeConstructors[p];return T?T(x,P,A):null},Object.defineProperty(b.prototype,"doNotSerialize",{get:function(){return!!this._doNotSerialize||!!this._parentNode&&this._parentNode.doNotSerialize},set:function(p){this._doNotSerialize=p},enumerable:!1,configurable:!0}),b.prototype.isDisposed=function(){return this._isDisposed},Object.defineProperty(b.prototype,"parent",{get:function(){return this._parentNode},set:function(p){if(this._parentNode!==p){var x=this._parentNode;if(this._parentNode&&this._parentNode._children!==void 0&&this._parentNode._children!==null){var P=this._parentNode._children.indexOf(this);P!==-1&&this._parentNode._children.splice(P,1),p||this._isDisposed||this._addToSceneRootNodes()}this._parentNode=p,this._parentNode&&(this._parentNode._children!==void 0&&this._parentNode._children!==null||(this._parentNode._children=new Array),this._parentNode._children.push(this),x||this._removeFromSceneRootNodes()),this._syncParentEnabledState()}},enumerable:!1,configurable:!0}),b.prototype._addToSceneRootNodes=function(){this._sceneRootNodesIndex===-1&&(this._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))},b.prototype._removeFromSceneRootNodes=function(){if(this._sceneRootNodesIndex!==-1){var p=this._scene.rootNodes,x=p.length-1;p[this._sceneRootNodesIndex]=p[x],p[this._sceneRootNodesIndex]._sceneRootNodesIndex=this._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._sceneRootNodesIndex=-1}},Object.defineProperty(b.prototype,"animationPropertiesOverride",{get:function(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride},set:function(p){this._animationPropertiesOverride=p},enumerable:!1,configurable:!0}),b.prototype.getClassName=function(){return"Node"},Object.defineProperty(b.prototype,"onDispose",{set:function(p){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(p)},enumerable:!1,configurable:!0}),b.prototype.getScene=function(){return this._scene},b.prototype.getEngine=function(){return this._scene.getEngine()},b.prototype.addBehavior=function(p,x){var P=this;return x===void 0&&(x=!1),this._behaviors.indexOf(p)!==-1||(p.init(),this._scene.isLoading&&!x?this._scene.onDataLoadedObservable.addOnce(function(){p.attach(P)}):p.attach(this),this._behaviors.push(p)),this},b.prototype.removeBehavior=function(p){var x=this._behaviors.indexOf(p);return x===-1||(this._behaviors[x].detach(),this._behaviors.splice(x,1)),this},Object.defineProperty(b.prototype,"behaviors",{get:function(){return this._behaviors},enumerable:!1,configurable:!0}),b.prototype.getBehaviorByName=function(p){for(var x=0,P=this._behaviors;x<P.length;x++){var A=P[x];if(A.name===p)return A}return null},b.prototype.getWorldMatrix=function(){return this._currentRenderId!==this._scene.getRenderId()&&this.computeWorldMatrix(),this._worldMatrix},b.prototype._getWorldMatrixDeterminant=function(){return this._worldMatrixDeterminantIsDirty&&(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant()),this._worldMatrixDeterminant},Object.defineProperty(b.prototype,"worldMatrixFromCache",{get:function(){return this._worldMatrix},enumerable:!1,configurable:!0}),b.prototype._initCache=function(){this._cache={},this._cache.parent=void 0},b.prototype.updateCache=function(p){!p&&this.isSynchronized()||(this._cache.parent=this.parent,this._updateCache())},b.prototype._getActionManagerForTrigger=function(p,x){return this.parent?this.parent._getActionManagerForTrigger(p,!1):null},b.prototype._updateCache=function(p){},b.prototype._isSynchronized=function(){return!0},b.prototype._markSyncedWithParent=function(){this._parentNode&&(this._parentUpdateId=this._parentNode._childUpdateId)},b.prototype.isSynchronizedWithParent=function(){return!this._parentNode||this._parentUpdateId===this._parentNode._childUpdateId&&this._parentNode.isSynchronized()},b.prototype.isSynchronized=function(){return this._cache.parent!=this._parentNode?(this._cache.parent=this._parentNode,!1):!(this._parentNode&&!this.isSynchronizedWithParent())&&this._isSynchronized()},b.prototype.isReady=function(p){return this._isReady},b.prototype.isEnabled=function(p){return p===void 0&&(p=!0),p===!1?this._isEnabled:!!this._isEnabled&&this._isParentEnabled},b.prototype._syncParentEnabledState=function(){this._isParentEnabled=!this._parentNode||this._parentNode.isEnabled(),this._children&&this._children.forEach(function(p){p._syncParentEnabledState()})},b.prototype.setEnabled=function(p){this._isEnabled=p,this._syncParentEnabledState()},b.prototype.isDescendantOf=function(p){return!!this.parent&&(this.parent===p||this.parent.isDescendantOf(p))},b.prototype._getDescendants=function(p,x,P){if(x===void 0&&(x=!1),this._children)for(var A=0;A<this._children.length;A++){var T=this._children[A];P&&!P(T)||p.push(T),x||T._getDescendants(p,!1,P)}},b.prototype.getDescendants=function(p,x){var P=new Array;return this._getDescendants(P,p,x),P},b.prototype.getChildMeshes=function(p,x){var P=[];return this._getDescendants(P,p,function(A){return(!x||x(A))&&A.cullingStrategy!==void 0}),P},b.prototype.getChildren=function(p,x){return x===void 0&&(x=!0),this.getDescendants(x,p)},b.prototype._setReady=function(p){p!==this._isReady&&(p?(this.onReady&&this.onReady(this),this._isReady=!0):this._isReady=!1)},b.prototype.getAnimationByName=function(p){for(var x=0;x<this.animations.length;x++){var P=this.animations[x];if(P.name===p)return P}return null},b.prototype.createAnimationRange=function(p,x,P){if(!this._ranges[p]){this._ranges[p]=b._AnimationRangeFactory(p,x,P);for(var A=0,T=this.animations.length;A<T;A++)this.animations[A]&&this.animations[A].createRange(p,x,P)}},b.prototype.deleteAnimationRange=function(p,x){x===void 0&&(x=!0);for(var P=0,A=this.animations.length;P<A;P++)this.animations[P]&&this.animations[P].deleteRange(p,x);this._ranges[p]=null},b.prototype.getAnimationRange=function(p){return this._ranges[p]||null},b.prototype.getAnimationRanges=function(){var p,x=[];for(p in this._ranges)x.push(this._ranges[p]);return x},b.prototype.beginAnimation=function(p,x,P,A){var T=this.getAnimationRange(p);return T?this._scene.beginAnimation(this,T.from,T.to,x,P,A):null},b.prototype.serializeAnimationRanges=function(){var p=[];for(var x in this._ranges){var P=this._ranges[x];if(P){var A={};A.name=x,A.from=P.from,A.to=P.to,p.push(A)}}return p},b.prototype.computeWorldMatrix=function(p){return this._worldMatrix||(this._worldMatrix=m.a.Identity()),this._worldMatrix},b.prototype.dispose=function(p,x){if(x===void 0&&(x=!1),this._isDisposed=!0,!p)for(var P=0,A=this.getDescendants(!0);P<A.length;P++)A[P].dispose(p,x);this.parent?this.parent=null:this._removeFromSceneRootNodes(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear();for(var T=0,_=this._behaviors;T<_.length;T++)_[T].detach();this._behaviors=[]},b.ParseAnimationRanges=function(p,x,P){if(x.ranges)for(var A=0;A<x.ranges.length;A++){var T=x.ranges[A];p.createAnimationRange(T.name,T.from,T.to)}},b.prototype.getHierarchyBoundingVectors=function(p,x){var P,A;if(p===void 0&&(p=!0),x===void 0&&(x=null),this.getScene().incrementRenderId(),this.computeWorldMatrix(!0),this.getBoundingInfo&&this.subMeshes){var T=this.getBoundingInfo();P=T.boundingBox.minimumWorld.clone(),A=T.boundingBox.maximumWorld.clone()}else P=new m.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),A=new m.e(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(p)for(var _=0,g=this.getDescendants(!1);_<g.length;_++){var O=g[_];if(O.computeWorldMatrix(!0),(!x||x(O))&&O.getBoundingInfo&&O.getTotalVertices()!==0){var R=O.getBoundingInfo().boundingBox,N=R.minimumWorld,V=R.maximumWorld;m.e.CheckExtends(N,P,A),m.e.CheckExtends(V,P,A)}}return{min:P,max:A}},b._AnimationRangeFactory=function(p,x,P){throw C.a.WarnImport("AnimationRange")},b._NodeConstructors={},Object(E.c)([Object(S.c)()],b.prototype,"name",void 0),Object(E.c)([Object(S.c)()],b.prototype,"id",void 0),Object(E.c)([Object(S.c)()],b.prototype,"uniqueId",void 0),Object(E.c)([Object(S.c)()],b.prototype,"state",void 0),Object(E.c)([Object(S.c)()],b.prototype,"metadata",void 0),b}()},function(h,s,c){c.d(s,"b",function(){return ge}),c.d(s,"a",function(){return _e});var E=c(1),m=c(3),S=c(33),d=c(20),M=c(0),C=c(9),I=c(4),b=c(105),p=c(42),x=c(25),P=c(76),A=c(87),T=c(15),_=c(10),g=c(11),O=c(19),R=c(5),N=`uniform vec4 vDiffuseColor;
#ifdef SPECULARTERM
uniform vec4 vSpecularColor;
#endif
uniform vec3 vEmissiveColor;
uniform float visibility;

#ifdef DIFFUSE
uniform vec2 vDiffuseInfos;
#endif
#ifdef AMBIENT
uniform vec2 vAmbientInfos;
#endif
#ifdef OPACITY
uniform vec2 vOpacityInfos;
#endif
#ifdef EMISSIVE
uniform vec2 vEmissiveInfos;
#endif
#ifdef LIGHTMAP
uniform vec2 vLightmapInfos;
#endif
#ifdef BUMP
uniform vec3 vBumpInfos;
uniform vec2 vTangentSpaceParams;
#endif
#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(REFRACTION)
uniform mat4 view;
#endif
#ifdef REFRACTION
uniform vec4 vRefractionInfos;
#ifndef REFRACTIONMAP_3D
uniform mat4 refractionMatrix;
#endif
#ifdef REFRACTIONFRESNEL
uniform vec4 refractionLeftColor;
uniform vec4 refractionRightColor;
#endif
#endif
#if defined(SPECULAR) && defined(SPECULARTERM)
uniform vec2 vSpecularInfos;
#endif
#ifdef DIFFUSEFRESNEL
uniform vec4 diffuseLeftColor;
uniform vec4 diffuseRightColor;
#endif
#ifdef OPACITYFRESNEL
uniform vec4 opacityParts;
#endif
#ifdef EMISSIVEFRESNEL
uniform vec4 emissiveLeftColor;
uniform vec4 emissiveRightColor;
#endif

#ifdef REFLECTION
uniform vec2 vReflectionInfos;
#if defined(REFLECTIONMAP_PLANAR) || defined(REFLECTIONMAP_CUBIC) || defined(REFLECTIONMAP_PROJECTION) || defined(REFLECTIONMAP_EQUIRECTANGULAR) || defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_SKYBOX)
uniform mat4 reflectionMatrix;
#endif
#ifndef REFLECTIONMAP_SKYBOX
#if defined(USE_LOCAL_REFLECTIONMAP_CUBIC) && defined(REFLECTIONMAP_CUBIC)
uniform vec3 vReflectionPosition;
uniform vec3 vReflectionSize;
#endif
#endif
#ifdef REFLECTIONFRESNEL
uniform vec4 reflectionLeftColor;
uniform vec4 reflectionRightColor;
#endif
#endif`;R.a.IncludesShadersStore.defaultFragmentDeclaration=N;var V=`layout(std140,column_major) uniform;
uniform Material
{
vec4 diffuseLeftColor;
vec4 diffuseRightColor;
vec4 opacityParts;
vec4 reflectionLeftColor;
vec4 reflectionRightColor;
vec4 refractionLeftColor;
vec4 refractionRightColor;
vec4 emissiveLeftColor;
vec4 emissiveRightColor;
vec2 vDiffuseInfos;
vec2 vAmbientInfos;
vec2 vOpacityInfos;
vec2 vReflectionInfos;
vec3 vReflectionPosition;
vec3 vReflectionSize;
vec2 vEmissiveInfos;
vec2 vLightmapInfos;
vec2 vSpecularInfos;
vec3 vBumpInfos;
mat4 diffuseMatrix;
mat4 ambientMatrix;
mat4 opacityMatrix;
mat4 reflectionMatrix;
mat4 emissiveMatrix;
mat4 lightmapMatrix;
mat4 specularMatrix;
mat4 bumpMatrix;
vec2 vTangentSpaceParams;
float pointSize;
mat4 refractionMatrix;
vec4 vRefractionInfos;
vec4 vSpecularColor;
vec3 vEmissiveColor;
float visibility;
vec4 vDiffuseColor;
vec4 vDetailInfos;
mat4 detailMatrix;
};
uniform Scene {
mat4 viewProjection;
#ifdef MULTIVIEW
mat4 viewProjectionR;
#endif
mat4 view;
};
`;R.a.IncludesShadersStore.defaultUboDeclaration=V,c(160),c(59),c(106),c(107),c(154),c(130),c(161),c(131),c(108),c(109),c(132),c(133),c(115),c(116),c(125),c(110),c(134),c(162),c(135),c(155),c(136);var U=`#include<__decl__defaultFragment>
#if defined(BUMP) || !defined(NORMAL)
#extension GL_OES_standard_derivatives : enable
#endif
#include<prePassDeclaration>[SCENE_MRT_COUNT]
#define CUSTOM_FRAGMENT_BEGIN
#ifdef LOGARITHMICDEPTH
#extension GL_EXT_frag_depth : enable
#endif

#define RECIPROCAL_PI2 0.15915494
uniform vec3 vEyePosition;
uniform vec3 vAmbientColor;

varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif
#ifdef MAINUV1
varying vec2 vMainUV1;
#endif
#ifdef MAINUV2
varying vec2 vMainUV2;
#endif

#include<helperFunctions>

#include<__decl__lightFragment>[0..maxSimultaneousLights]
#include<lightsFragmentFunctions>
#include<shadowsFragmentFunctions>

#ifdef DIFFUSE
#if DIFFUSEDIRECTUV == 1
#define vDiffuseUV vMainUV1
#elif DIFFUSEDIRECTUV == 2
#define vDiffuseUV vMainUV2
#else
varying vec2 vDiffuseUV;
#endif
uniform sampler2D diffuseSampler;
#endif
#ifdef AMBIENT
#if AMBIENTDIRECTUV == 1
#define vAmbientUV vMainUV1
#elif AMBIENTDIRECTUV == 2
#define vAmbientUV vMainUV2
#else
varying vec2 vAmbientUV;
#endif
uniform sampler2D ambientSampler;
#endif
#ifdef OPACITY
#if OPACITYDIRECTUV == 1
#define vOpacityUV vMainUV1
#elif OPACITYDIRECTUV == 2
#define vOpacityUV vMainUV2
#else
varying vec2 vOpacityUV;
#endif
uniform sampler2D opacitySampler;
#endif
#ifdef EMISSIVE
#if EMISSIVEDIRECTUV == 1
#define vEmissiveUV vMainUV1
#elif EMISSIVEDIRECTUV == 2
#define vEmissiveUV vMainUV2
#else
varying vec2 vEmissiveUV;
#endif
uniform sampler2D emissiveSampler;
#endif
#ifdef LIGHTMAP
#if LIGHTMAPDIRECTUV == 1
#define vLightmapUV vMainUV1
#elif LIGHTMAPDIRECTUV == 2
#define vLightmapUV vMainUV2
#else
varying vec2 vLightmapUV;
#endif
uniform sampler2D lightmapSampler;
#endif
#ifdef REFRACTION
#ifdef REFRACTIONMAP_3D
uniform samplerCube refractionCubeSampler;
#else
uniform sampler2D refraction2DSampler;
#endif
#endif
#if defined(SPECULAR) && defined(SPECULARTERM)
#if SPECULARDIRECTUV == 1
#define vSpecularUV vMainUV1
#elif SPECULARDIRECTUV == 2
#define vSpecularUV vMainUV2
#else
varying vec2 vSpecularUV;
#endif
uniform sampler2D specularSampler;
#endif
#ifdef ALPHATEST
uniform float alphaCutOff;
#endif

#include<fresnelFunction>

#ifdef REFLECTION
#ifdef REFLECTIONMAP_3D
uniform samplerCube reflectionCubeSampler;
#else
uniform sampler2D reflection2DSampler;
#endif
#ifdef REFLECTIONMAP_SKYBOX
varying vec3 vPositionUVW;
#else
#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)
varying vec3 vDirectionW;
#endif
#endif
#include<reflectionFunction>
#endif
#include<imageProcessingDeclaration>
#include<imageProcessingFunctions>
#include<bumpFragmentMainFunctions>
#include<bumpFragmentFunctions>
#include<clipPlaneFragmentDeclaration>
#include<logDepthDeclaration>
#include<fogFragmentDeclaration>
#define CUSTOM_FRAGMENT_DEFINITIONS
void main(void) {
#define CUSTOM_FRAGMENT_MAIN_BEGIN
#include<clipPlaneFragment>
vec3 viewDirectionW=normalize(vEyePosition-vPositionW);

vec4 baseColor=vec4(1.,1.,1.,1.);
vec3 diffuseColor=vDiffuseColor.rgb;

float alpha=vDiffuseColor.a;

#ifdef NORMAL
vec3 normalW=normalize(vNormalW);
#else
vec3 normalW=normalize(-cross(dFdx(vPositionW),dFdy(vPositionW)));
#endif
#include<bumpFragment>
#ifdef TWOSIDEDLIGHTING
normalW=gl_FrontFacing ? normalW : -normalW;
#endif
#ifdef DIFFUSE
baseColor=texture2D(diffuseSampler,vDiffuseUV+uvOffset);
#if defined(ALPHATEST) && !defined(ALPHATEST_AFTERALLALPHACOMPUTATIONS)
if (baseColor.a<alphaCutOff)
discard;
#endif
#ifdef ALPHAFROMDIFFUSE
alpha*=baseColor.a;
#endif
#define CUSTOM_FRAGMENT_UPDATE_ALPHA
baseColor.rgb*=vDiffuseInfos.y;
#endif
#include<depthPrePass>
#ifdef VERTEXCOLOR
baseColor.rgb*=vColor.rgb;
#endif
#ifdef DETAIL
baseColor.rgb=baseColor.rgb*2.0*mix(0.5,detailColor.r,vDetailInfos.y);
#endif
#define CUSTOM_FRAGMENT_UPDATE_DIFFUSE

vec3 baseAmbientColor=vec3(1.,1.,1.);
#ifdef AMBIENT
baseAmbientColor=texture2D(ambientSampler,vAmbientUV+uvOffset).rgb*vAmbientInfos.y;
#endif
#define CUSTOM_FRAGMENT_BEFORE_LIGHTS

#ifdef SPECULARTERM
float glossiness=vSpecularColor.a;
vec3 specularColor=vSpecularColor.rgb;
#ifdef SPECULAR
vec4 specularMapColor=texture2D(specularSampler,vSpecularUV+uvOffset);
specularColor=specularMapColor.rgb;
#ifdef GLOSSINESS
glossiness=glossiness*specularMapColor.a;
#endif
#endif
#else
float glossiness=0.;
#endif

vec3 diffuseBase=vec3(0.,0.,0.);
lightingInfo info;
#ifdef SPECULARTERM
vec3 specularBase=vec3(0.,0.,0.);
#endif
float shadow=1.;
#ifdef LIGHTMAP
vec4 lightmapColor=texture2D(lightmapSampler,vLightmapUV+uvOffset);
#ifdef RGBDLIGHTMAP
lightmapColor.rgb=fromRGBD(lightmapColor);
#endif
lightmapColor.rgb*=vLightmapInfos.y;
#endif
#include<lightFragment>[0..maxSimultaneousLights]

vec4 refractionColor=vec4(0.,0.,0.,1.);
#ifdef REFRACTION
vec3 refractionVector=normalize(refract(-viewDirectionW,normalW,vRefractionInfos.y));
#ifdef REFRACTIONMAP_3D
refractionVector.y=refractionVector.y*vRefractionInfos.w;
if (dot(refractionVector,viewDirectionW)<1.0) {
refractionColor=textureCube(refractionCubeSampler,refractionVector);
}
#else
vec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*vRefractionInfos.z,1.0)));
vec2 refractionCoords=vRefractionUVW.xy/vRefractionUVW.z;
refractionCoords.y=1.0-refractionCoords.y;
refractionColor=texture2D(refraction2DSampler,refractionCoords);
#endif
#ifdef RGBDREFRACTION
refractionColor.rgb=fromRGBD(refractionColor);
#endif
#ifdef IS_REFRACTION_LINEAR
refractionColor.rgb=toGammaSpace(refractionColor.rgb);
#endif
refractionColor.rgb*=vRefractionInfos.x;
#endif

vec4 reflectionColor=vec4(0.,0.,0.,1.);
#ifdef REFLECTION
vec3 vReflectionUVW=computeReflectionCoords(vec4(vPositionW,1.0),normalW);
#ifdef REFLECTIONMAP_3D
#ifdef ROUGHNESS
float bias=vReflectionInfos.y;
#ifdef SPECULARTERM
#ifdef SPECULAR
#ifdef GLOSSINESS
bias*=(1.0-specularMapColor.a);
#endif
#endif
#endif
reflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW,bias);
#else
reflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW);
#endif
#else
vec2 coords=vReflectionUVW.xy;
#ifdef REFLECTIONMAP_PROJECTION
coords/=vReflectionUVW.z;
#endif
coords.y=1.0-coords.y;
reflectionColor=texture2D(reflection2DSampler,coords);
#endif
#ifdef RGBDREFLECTION
reflectionColor.rgb=fromRGBD(reflectionColor);
#endif
#ifdef IS_REFLECTION_LINEAR
reflectionColor.rgb=toGammaSpace(reflectionColor.rgb);
#endif
reflectionColor.rgb*=vReflectionInfos.x;
#ifdef REFLECTIONFRESNEL
float reflectionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,reflectionRightColor.a,reflectionLeftColor.a);
#ifdef REFLECTIONFRESNELFROMSPECULAR
#ifdef SPECULARTERM
reflectionColor.rgb*=specularColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;
#else
reflectionColor.rgb*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;
#endif
#else
reflectionColor.rgb*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;
#endif
#endif
#endif
#ifdef REFRACTIONFRESNEL
float refractionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,refractionRightColor.a,refractionLeftColor.a);
refractionColor.rgb*=refractionLeftColor.rgb*(1.0-refractionFresnelTerm)+refractionFresnelTerm*refractionRightColor.rgb;
#endif
#ifdef OPACITY
vec4 opacityMap=texture2D(opacitySampler,vOpacityUV+uvOffset);
#ifdef OPACITYRGB
opacityMap.rgb=opacityMap.rgb*vec3(0.3,0.59,0.11);
alpha*=(opacityMap.x+opacityMap.y+opacityMap.z)* vOpacityInfos.y;
#else
alpha*=opacityMap.a*vOpacityInfos.y;
#endif
#endif
#ifdef VERTEXALPHA
alpha*=vColor.a;
#endif
#ifdef OPACITYFRESNEL
float opacityFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,opacityParts.z,opacityParts.w);
alpha+=opacityParts.x*(1.0-opacityFresnelTerm)+opacityFresnelTerm*opacityParts.y;
#endif
#ifdef ALPHATEST
#ifdef ALPHATEST_AFTERALLALPHACOMPUTATIONS
if (alpha<alphaCutOff)
discard;
#endif
#ifndef ALPHABLEND

alpha=1.0;
#endif
#endif

vec3 emissiveColor=vEmissiveColor;
#ifdef EMISSIVE
emissiveColor+=texture2D(emissiveSampler,vEmissiveUV+uvOffset).rgb*vEmissiveInfos.y;
#endif
#ifdef EMISSIVEFRESNEL
float emissiveFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,emissiveRightColor.a,emissiveLeftColor.a);
emissiveColor*=emissiveLeftColor.rgb*(1.0-emissiveFresnelTerm)+emissiveFresnelTerm*emissiveRightColor.rgb;
#endif

#ifdef DIFFUSEFRESNEL
float diffuseFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,diffuseRightColor.a,diffuseLeftColor.a);
diffuseBase*=diffuseLeftColor.rgb*(1.0-diffuseFresnelTerm)+diffuseFresnelTerm*diffuseRightColor.rgb;
#endif

#ifdef EMISSIVEASILLUMINATION
vec3 finalDiffuse=clamp(diffuseBase*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;
#else
#ifdef LINKEMISSIVEWITHDIFFUSE
vec3 finalDiffuse=clamp((diffuseBase+emissiveColor)*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;
#else
vec3 finalDiffuse=clamp(diffuseBase*diffuseColor+emissiveColor+vAmbientColor,0.0,1.0)*baseColor.rgb;
#endif
#endif
#ifdef SPECULARTERM
vec3 finalSpecular=specularBase*specularColor;
#ifdef SPECULAROVERALPHA
alpha=clamp(alpha+dot(finalSpecular,vec3(0.3,0.59,0.11)),0.,1.);
#endif
#else
vec3 finalSpecular=vec3(0.0);
#endif
#ifdef REFLECTIONOVERALPHA
alpha=clamp(alpha+dot(reflectionColor.rgb,vec3(0.3,0.59,0.11)),0.,1.);
#endif

#ifdef EMISSIVEASILLUMINATION
vec4 color=vec4(clamp(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor.rgb+emissiveColor+refractionColor.rgb,0.0,1.0),alpha);
#else
vec4 color=vec4(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor.rgb+refractionColor.rgb,alpha);
#endif

#ifdef LIGHTMAP
#ifndef LIGHTMAPEXCLUDED
#ifdef USELIGHTMAPASSHADOWMAP
color.rgb*=lightmapColor.rgb;
#else
color.rgb+=lightmapColor.rgb;
#endif
#endif
#endif
#define CUSTOM_FRAGMENT_BEFORE_FOG
color.rgb=max(color.rgb,0.);
#include<logDepthFragment>
#include<fogFragment>


#ifdef IMAGEPROCESSINGPOSTPROCESS
color.rgb=toLinearSpace(color.rgb);
#else
#ifdef IMAGEPROCESSING
color.rgb=toLinearSpace(color.rgb);
color=applyImageProcessing(color);
#endif
#endif
color.a*=visibility;
#ifdef PREMULTIPLYALPHA

color.rgb*=color.a;
#endif
#define CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR
#ifdef PREPASS
gl_FragData[0]=color;
#ifdef PREPASS_POSITION
gl_FragData[PREPASS_POSITION_INDEX]=vec4(vPositionW,1.0);
#endif
#ifdef PREPASS_VELOCITY
vec2 a=(vCurrentPosition.xy/vCurrentPosition.w)*0.5+0.5;
vec2 b=(vPreviousPosition.xy/vPreviousPosition.w)*0.5+0.5;
vec2 velocity=abs(a-b);
velocity=vec2(pow(velocity.x,1.0/3.0),pow(velocity.y,1.0/3.0))*sign(a-b)*0.5+0.5;
gl_FragData[PREPASS_VELOCITY_INDEX]=vec4(velocity,0.0,1.0);
#endif
#ifdef PREPASS_IRRADIANCE
gl_FragData[PREPASS_IRRADIANCE_INDEX]=vec4(0.0,0.0,0.0,1.0);
#endif
#ifdef PREPASS_DEPTHNORMAL
gl_FragData[PREPASS_DEPTHNORMAL_INDEX]=vec4(vViewPos.z,(view*vec4(normalW,0.0)).rgb);
#endif
#ifdef PREPASS_ALBEDO
gl_FragData[PREPASS_ALBEDO_INDEX]=vec4(0.0,0.0,0.0,1.0);
#endif
#ifdef PREPASS_REFLECTIVITY
#if defined(SPECULAR)
gl_FragData[PREPASS_REFLECTIVITY_INDEX]=specularMapColor;
#else
gl_FragData[PREPASS_REFLECTIVITY_INDEX]=vec4(0.0,0.0,0.0,1.0);
#endif
#endif
#endif
#if !defined(PREPASS) || defined(WEBGL2)
gl_FragColor=color;
#endif
}
`;R.a.ShadersStore.defaultPixelShader=U;var L=`
uniform mat4 viewProjection;
uniform mat4 view;
#ifdef DIFFUSE
uniform mat4 diffuseMatrix;
uniform vec2 vDiffuseInfos;
#endif
#ifdef AMBIENT
uniform mat4 ambientMatrix;
uniform vec2 vAmbientInfos;
#endif
#ifdef OPACITY
uniform mat4 opacityMatrix;
uniform vec2 vOpacityInfos;
#endif
#ifdef EMISSIVE
uniform vec2 vEmissiveInfos;
uniform mat4 emissiveMatrix;
#endif
#ifdef LIGHTMAP
uniform vec2 vLightmapInfos;
uniform mat4 lightmapMatrix;
#endif
#if defined(SPECULAR) && defined(SPECULARTERM)
uniform vec2 vSpecularInfos;
uniform mat4 specularMatrix;
#endif
#ifdef BUMP
uniform vec3 vBumpInfos;
uniform mat4 bumpMatrix;
#endif
#ifdef REFLECTION
uniform mat4 reflectionMatrix;
#endif
#ifdef POINTSIZE
uniform float pointSize;
#endif
`;R.a.IncludesShadersStore.defaultVertexDeclaration=L,c(78),c(79),c(163),c(164),c(117),c(137),c(93),c(94),c(100),c(80),c(81),c(165),c(156),c(111),c(157),c(138),R.a.IncludesShadersStore.pointCloudVertex=`#ifdef POINTSIZE
gl_PointSize=pointSize;
#endif`,c(158);var j=`#include<__decl__defaultVertex>

#define CUSTOM_VERTEX_BEGIN
attribute vec3 position;
#ifdef NORMAL
attribute vec3 normal;
#endif
#ifdef TANGENT
attribute vec4 tangent;
#endif
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#ifdef VERTEXCOLOR
attribute vec4 color;
#endif
#include<helperFunctions>
#include<bonesDeclaration>

#include<instancesDeclaration>
#include<prePassVertexDeclaration>
#ifdef MAINUV1
varying vec2 vMainUV1;
#endif
#ifdef MAINUV2
varying vec2 vMainUV2;
#endif
#if defined(DIFFUSE) && DIFFUSEDIRECTUV == 0
varying vec2 vDiffuseUV;
#endif
#if defined(DETAIL) && DETAILDIRECTUV == 0
varying vec2 vDetailUV;
#endif
#if defined(AMBIENT) && AMBIENTDIRECTUV == 0
varying vec2 vAmbientUV;
#endif
#if defined(OPACITY) && OPACITYDIRECTUV == 0
varying vec2 vOpacityUV;
#endif
#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0
varying vec2 vEmissiveUV;
#endif
#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0
varying vec2 vLightmapUV;
#endif
#if defined(SPECULAR) && defined(SPECULARTERM) && SPECULARDIRECTUV == 0
varying vec2 vSpecularUV;
#endif
#if defined(BUMP) && BUMPDIRECTUV == 0
varying vec2 vBumpUV;
#endif

varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif
#include<bumpVertexDeclaration>
#include<clipPlaneVertexDeclaration>
#include<fogVertexDeclaration>
#include<__decl__lightFragment>[0..maxSimultaneousLights]
#include<morphTargetsVertexGlobalDeclaration>
#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]
#ifdef REFLECTIONMAP_SKYBOX
varying vec3 vPositionUVW;
#endif
#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)
varying vec3 vDirectionW;
#endif
#include<logDepthDeclaration>
#define CUSTOM_VERTEX_DEFINITIONS
void main(void) {
#define CUSTOM_VERTEX_MAIN_BEGIN
vec3 positionUpdated=position;
#ifdef NORMAL
vec3 normalUpdated=normal;
#endif
#ifdef TANGENT
vec4 tangentUpdated=tangent;
#endif
#ifdef UV1
vec2 uvUpdated=uv;
#endif
#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]
#ifdef REFLECTIONMAP_SKYBOX
vPositionUVW=positionUpdated;
#endif
#define CUSTOM_VERTEX_UPDATE_POSITION
#define CUSTOM_VERTEX_UPDATE_NORMAL
#include<instancesVertex>
#if defined(PREPASS) && defined(PREPASS_VELOCITY) && !defined(BONES_VELOCITY_ENABLED)

vCurrentPosition=viewProjection*finalWorld*vec4(positionUpdated,1.0);
vPreviousPosition=previousViewProjection*previousWorld*vec4(positionUpdated,1.0);
#endif
#include<bonesVertex>
vec4 worldPos=finalWorld*vec4(positionUpdated,1.0);
#ifdef NORMAL
mat3 normalWorld=mat3(finalWorld);
#if defined(INSTANCES) && defined(THIN_INSTANCES)
vNormalW=normalUpdated/vec3(dot(normalWorld[0],normalWorld[0]),dot(normalWorld[1],normalWorld[1]),dot(normalWorld[2],normalWorld[2]));
vNormalW=normalize(normalWorld*vNormalW);
#else
#ifdef NONUNIFORMSCALING
normalWorld=transposeMat3(inverseMat3(normalWorld));
#endif
vNormalW=normalize(normalWorld*normalUpdated);
#endif
#endif
#define CUSTOM_VERTEX_UPDATE_WORLDPOS
#ifdef MULTIVIEW
if (gl_ViewID_OVR == 0u) {
gl_Position=viewProjection*worldPos;
} else {
gl_Position=viewProjectionR*worldPos;
}
#else
gl_Position=viewProjection*worldPos;
#endif
vPositionW=vec3(worldPos);
#include<prePassVertex>
#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)
vDirectionW=normalize(vec3(finalWorld*vec4(positionUpdated,0.0)));
#endif

#ifndef UV1
vec2 uvUpdated=vec2(0.,0.);
#endif
#ifndef UV2
vec2 uv2=vec2(0.,0.);
#endif
#ifdef MAINUV1
vMainUV1=uvUpdated;
#endif
#ifdef MAINUV2
vMainUV2=uv2;
#endif
#if defined(DIFFUSE) && DIFFUSEDIRECTUV == 0
if (vDiffuseInfos.x == 0.)
{
vDiffuseUV=vec2(diffuseMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(DETAIL) && DETAILDIRECTUV == 0
if (vDetailInfos.x == 0.)
{
vDetailUV=vec2(detailMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vDetailUV=vec2(detailMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(AMBIENT) && AMBIENTDIRECTUV == 0
if (vAmbientInfos.x == 0.)
{
vAmbientUV=vec2(ambientMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vAmbientUV=vec2(ambientMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(OPACITY) && OPACITYDIRECTUV == 0
if (vOpacityInfos.x == 0.)
{
vOpacityUV=vec2(opacityMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0
if (vEmissiveInfos.x == 0.)
{
vEmissiveUV=vec2(emissiveMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vEmissiveUV=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0
if (vLightmapInfos.x == 0.)
{
vLightmapUV=vec2(lightmapMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vLightmapUV=vec2(lightmapMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(SPECULAR) && defined(SPECULARTERM) && SPECULARDIRECTUV == 0
if (vSpecularInfos.x == 0.)
{
vSpecularUV=vec2(specularMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vSpecularUV=vec2(specularMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(BUMP) && BUMPDIRECTUV == 0
if (vBumpInfos.x == 0.)
{
vBumpUV=vec2(bumpMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vBumpUV=vec2(bumpMatrix*vec4(uv2,1.0,0.0));
}
#endif
#include<bumpVertex>
#include<clipPlaneVertex>
#include<fogVertex>
#include<shadowsVertex>[0..maxSimultaneousLights]
#ifdef VERTEXCOLOR

vColor=color;
#endif
#include<pointCloudVertex>
#include<logDepthVertex>
#define CUSTOM_VERTEX_MAIN_END
}
`;R.a.ShadersStore.defaultVertexShader=j;var Y=c(2),W=c(67),re=c(92),ne={effect:null,subMesh:null},ge=function(ce){function ie(){var Z=ce.call(this)||this;return Z.MAINUV1=!1,Z.MAINUV2=!1,Z.DIFFUSE=!1,Z.DIFFUSEDIRECTUV=0,Z.DETAIL=!1,Z.DETAILDIRECTUV=0,Z.DETAIL_NORMALBLENDMETHOD=0,Z.AMBIENT=!1,Z.AMBIENTDIRECTUV=0,Z.OPACITY=!1,Z.OPACITYDIRECTUV=0,Z.OPACITYRGB=!1,Z.REFLECTION=!1,Z.EMISSIVE=!1,Z.EMISSIVEDIRECTUV=0,Z.SPECULAR=!1,Z.SPECULARDIRECTUV=0,Z.BUMP=!1,Z.BUMPDIRECTUV=0,Z.PARALLAX=!1,Z.PARALLAXOCCLUSION=!1,Z.SPECULAROVERALPHA=!1,Z.CLIPPLANE=!1,Z.CLIPPLANE2=!1,Z.CLIPPLANE3=!1,Z.CLIPPLANE4=!1,Z.CLIPPLANE5=!1,Z.CLIPPLANE6=!1,Z.ALPHATEST=!1,Z.DEPTHPREPASS=!1,Z.ALPHAFROMDIFFUSE=!1,Z.POINTSIZE=!1,Z.FOG=!1,Z.SPECULARTERM=!1,Z.DIFFUSEFRESNEL=!1,Z.OPACITYFRESNEL=!1,Z.REFLECTIONFRESNEL=!1,Z.REFRACTIONFRESNEL=!1,Z.EMISSIVEFRESNEL=!1,Z.FRESNEL=!1,Z.NORMAL=!1,Z.UV1=!1,Z.UV2=!1,Z.VERTEXCOLOR=!1,Z.VERTEXALPHA=!1,Z.NUM_BONE_INFLUENCERS=0,Z.BonesPerMesh=0,Z.BONETEXTURE=!1,Z.BONES_VELOCITY_ENABLED=!1,Z.INSTANCES=!1,Z.THIN_INSTANCES=!1,Z.GLOSSINESS=!1,Z.ROUGHNESS=!1,Z.EMISSIVEASILLUMINATION=!1,Z.LINKEMISSIVEWITHDIFFUSE=!1,Z.REFLECTIONFRESNELFROMSPECULAR=!1,Z.LIGHTMAP=!1,Z.LIGHTMAPDIRECTUV=0,Z.OBJECTSPACE_NORMALMAP=!1,Z.USELIGHTMAPASSHADOWMAP=!1,Z.REFLECTIONMAP_3D=!1,Z.REFLECTIONMAP_SPHERICAL=!1,Z.REFLECTIONMAP_PLANAR=!1,Z.REFLECTIONMAP_CUBIC=!1,Z.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,Z.REFLECTIONMAP_PROJECTION=!1,Z.REFLECTIONMAP_SKYBOX=!1,Z.REFLECTIONMAP_EXPLICIT=!1,Z.REFLECTIONMAP_EQUIRECTANGULAR=!1,Z.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,Z.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,Z.INVERTCUBICMAP=!1,Z.LOGARITHMICDEPTH=!1,Z.REFRACTION=!1,Z.REFRACTIONMAP_3D=!1,Z.REFLECTIONOVERALPHA=!1,Z.TWOSIDEDLIGHTING=!1,Z.SHADOWFLOAT=!1,Z.MORPHTARGETS=!1,Z.MORPHTARGETS_NORMAL=!1,Z.MORPHTARGETS_TANGENT=!1,Z.MORPHTARGETS_UV=!1,Z.NUM_MORPH_INFLUENCERS=0,Z.NONUNIFORMSCALING=!1,Z.PREMULTIPLYALPHA=!1,Z.ALPHATEST_AFTERALLALPHACOMPUTATIONS=!1,Z.ALPHABLEND=!0,Z.PREPASS=!1,Z.PREPASS_IRRADIANCE=!1,Z.PREPASS_IRRADIANCE_INDEX=-1,Z.PREPASS_ALBEDO=!1,Z.PREPASS_ALBEDO_INDEX=-1,Z.PREPASS_DEPTHNORMAL=!1,Z.PREPASS_DEPTHNORMAL_INDEX=-1,Z.PREPASS_POSITION=!1,Z.PREPASS_POSITION_INDEX=-1,Z.PREPASS_VELOCITY=!1,Z.PREPASS_VELOCITY_INDEX=-1,Z.PREPASS_REFLECTIVITY=!1,Z.PREPASS_REFLECTIVITY_INDEX=-1,Z.SCENE_MRT_COUNT=0,Z.RGBDLIGHTMAP=!1,Z.RGBDREFLECTION=!1,Z.RGBDREFRACTION=!1,Z.IMAGEPROCESSING=!1,Z.VIGNETTE=!1,Z.VIGNETTEBLENDMODEMULTIPLY=!1,Z.VIGNETTEBLENDMODEOPAQUE=!1,Z.TONEMAPPING=!1,Z.TONEMAPPING_ACES=!1,Z.CONTRAST=!1,Z.COLORCURVES=!1,Z.COLORGRADING=!1,Z.COLORGRADING3D=!1,Z.SAMPLER3DGREENDEPTH=!1,Z.SAMPLER3DBGRMAP=!1,Z.IMAGEPROCESSINGPOSTPROCESS=!1,Z.MULTIVIEW=!1,Z.IS_REFLECTION_LINEAR=!1,Z.IS_REFRACTION_LINEAR=!1,Z.EXPOSURE=!1,Z.rebuild(),Z}return Object(E.d)(ie,ce),ie.prototype.setReflectionMode=function(Z){for(var te=0,B=["REFLECTIONMAP_CUBIC","REFLECTIONMAP_EXPLICIT","REFLECTIONMAP_PLANAR","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_SKYBOX","REFLECTIONMAP_SPHERICAL","REFLECTIONMAP_EQUIRECTANGULAR","REFLECTIONMAP_EQUIRECTANGULAR_FIXED","REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"];te<B.length;te++){var G=B[te];this[G]=G===Z}},ie}(P.a),_e=function(ce){function ie(Z,te){var B=ce.call(this,Z,te)||this;return B._diffuseTexture=null,B._ambientTexture=null,B._opacityTexture=null,B._reflectionTexture=null,B._emissiveTexture=null,B._specularTexture=null,B._bumpTexture=null,B._lightmapTexture=null,B._refractionTexture=null,B.ambientColor=new C.a(0,0,0),B.diffuseColor=new C.a(1,1,1),B.specularColor=new C.a(1,1,1),B.emissiveColor=new C.a(0,0,0),B.specularPower=64,B._useAlphaFromDiffuseTexture=!1,B._useEmissiveAsIllumination=!1,B._linkEmissiveWithDiffuse=!1,B._useSpecularOverAlpha=!1,B._useReflectionOverAlpha=!1,B._disableLighting=!1,B._useObjectSpaceNormalMap=!1,B._useParallax=!1,B._useParallaxOcclusion=!1,B.parallaxScaleBias=.05,B._roughness=0,B.indexOfRefraction=.98,B.invertRefractionY=!0,B.alphaCutOff=.4,B._useLightmapAsShadowmap=!1,B._useReflectionFresnelFromSpecular=!1,B._useGlossinessFromSpecularMapAlpha=!1,B._maxSimultaneousLights=4,B._invertNormalMapX=!1,B._invertNormalMapY=!1,B._twoSidedLighting=!1,B.detailMap=new re.a(B._markAllSubMeshesAsTexturesDirty.bind(B)),B._renderTargets=new S.a(16),B._worldViewProjectionMatrix=M.a.Zero(),B._globalAmbientColor=new C.a(0,0,0),B._rebuildInParallel=!1,B._attachImageProcessingConfiguration(null),B.prePassConfiguration=new b.a,B.getRenderTargetTextures=function(){return B._renderTargets.reset(),ie.ReflectionTextureEnabled&&B._reflectionTexture&&B._reflectionTexture.isRenderTarget&&B._renderTargets.push(B._reflectionTexture),ie.RefractionTextureEnabled&&B._refractionTexture&&B._refractionTexture.isRenderTarget&&B._renderTargets.push(B._refractionTexture),B._renderTargets},B}return Object(E.d)(ie,ce),Object.defineProperty(ie.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(Z){this._attachImageProcessingConfiguration(Z),this._markAllSubMeshesAsTexturesDirty()},enumerable:!1,configurable:!0}),ie.prototype._attachImageProcessingConfiguration=function(Z){var te=this;Z!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=Z||this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add(function(){te._markAllSubMeshesAsImageProcessingDirty()})))},Object.defineProperty(ie.prototype,"cameraColorCurvesEnabled",{get:function(){return this.imageProcessingConfiguration.colorCurvesEnabled},set:function(Z){this.imageProcessingConfiguration.colorCurvesEnabled=Z},enumerable:!1,configurable:!0}),Object.defineProperty(ie.prototype,"cameraColorGradingEnabled",{get:function(){return this.imageProcessingConfiguration.colorGradingEnabled},set:function(Z){this.imageProcessingConfiguration.colorGradingEnabled=Z},enumerable:!1,configurable:!0}),Object.defineProperty(ie.prototype,"cameraToneMappingEnabled",{get:function(){return this._imageProcessingConfiguration.toneMappingEnabled},set:function(Z){this._imageProcessingConfiguration.toneMappingEnabled=Z},enumerable:!1,configurable:!0}),Object.defineProperty(ie.prototype,"cameraExposure",{get:function(){return this._imageProcessingConfiguration.exposure},set:function(Z){this._imageProcessingConfiguration.exposure=Z},enumerable:!1,configurable:!0}),Object.defineProperty(ie.prototype,"cameraContrast",{get:function(){return this._imageProcessingConfiguration.contrast},set:function(Z){this._imageProcessingConfiguration.contrast=Z},enumerable:!1,configurable:!0}),Object.defineProperty(ie.prototype,"cameraColorGradingTexture",{get:function(){return this._imageProcessingConfiguration.colorGradingTexture},set:function(Z){this._imageProcessingConfiguration.colorGradingTexture=Z},enumerable:!1,configurable:!0}),Object.defineProperty(ie.prototype,"cameraColorCurves",{get:function(){return this._imageProcessingConfiguration.colorCurves},set:function(Z){this._imageProcessingConfiguration.colorCurves=Z},enumerable:!1,configurable:!0}),Object.defineProperty(ie.prototype,"canRenderToMRT",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(ie.prototype,"hasRenderTargetTextures",{get:function(){return!!(ie.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||!!(ie.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)},enumerable:!1,configurable:!0}),ie.prototype.getClassName=function(){return"StandardMaterial"},Object.defineProperty(ie.prototype,"useLogarithmicDepth",{get:function(){return this._useLogarithmicDepth},set:function(Z){this._useLogarithmicDepth=Z&&this.getScene().getEngine().getCaps().fragmentDepthSupported,this._markAllSubMeshesAsMiscDirty()},enumerable:!1,configurable:!0}),ie.prototype.needAlphaBlending=function(){return!this._disableAlphaBlending&&(this.alpha<1||this._opacityTexture!=null||this._shouldUseAlphaFromDiffuseTexture()||this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled)},ie.prototype.needAlphaTesting=function(){return!!this._forceAlphaTest||this._hasAlphaChannel()&&(this._transparencyMode==null||this._transparencyMode===x.a.MATERIAL_ALPHATEST)},ie.prototype._shouldUseAlphaFromDiffuseTexture=function(){return this._diffuseTexture!=null&&this._diffuseTexture.hasAlpha&&this._useAlphaFromDiffuseTexture&&this._transparencyMode!==x.a.MATERIAL_OPAQUE},ie.prototype._hasAlphaChannel=function(){return this._diffuseTexture!=null&&this._diffuseTexture.hasAlpha||this._opacityTexture!=null},ie.prototype.getAlphaTestTexture=function(){return this._diffuseTexture},ie.prototype.isReadyForSubMesh=function(Z,te,B){if(B===void 0&&(B=!1),te.effect&&this.isFrozen&&te.effect._wasPreviouslyReady)return!0;te._materialDefines||(te._materialDefines=new ge);var G=this.getScene(),$=te._materialDefines;if(this._isReadyForSubMesh(te))return!0;var le=G.getEngine();if($._needNormals=T.a.PrepareDefinesForLights(G,Z,$,!0,this._maxSimultaneousLights,this._disableLighting),T.a.PrepareDefinesForMultiview(G,$),T.a.PrepareDefinesForPrePass(G,$,this.canRenderToMRT),$._areTexturesDirty){if($._needUVs=!1,$.MAINUV1=!1,$.MAINUV2=!1,G.texturesEnabled){if(this._diffuseTexture&&ie.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;T.a.PrepareDefinesForMergedUV(this._diffuseTexture,$,"DIFFUSE")}else $.DIFFUSE=!1;if(this._ambientTexture&&ie.AmbientTextureEnabled){if(!this._ambientTexture.isReadyOrNotBlocking())return!1;T.a.PrepareDefinesForMergedUV(this._ambientTexture,$,"AMBIENT")}else $.AMBIENT=!1;if(this._opacityTexture&&ie.OpacityTextureEnabled){if(!this._opacityTexture.isReadyOrNotBlocking())return!1;T.a.PrepareDefinesForMergedUV(this._opacityTexture,$,"OPACITY"),$.OPACITYRGB=this._opacityTexture.getAlphaFromRGB}else $.OPACITY=!1;if(this._reflectionTexture&&ie.ReflectionTextureEnabled){if(!this._reflectionTexture.isReadyOrNotBlocking())return!1;switch($._needNormals=!0,$.REFLECTION=!0,$.ROUGHNESS=this._roughness>0,$.REFLECTIONOVERALPHA=this._useReflectionOverAlpha,$.INVERTCUBICMAP=this._reflectionTexture.coordinatesMode===_.a.INVCUBIC_MODE,$.REFLECTIONMAP_3D=this._reflectionTexture.isCube,$.RGBDREFLECTION=this._reflectionTexture.isRGBD,this._reflectionTexture.coordinatesMode){case _.a.EXPLICIT_MODE:$.setReflectionMode("REFLECTIONMAP_EXPLICIT");break;case _.a.PLANAR_MODE:$.setReflectionMode("REFLECTIONMAP_PLANAR");break;case _.a.PROJECTION_MODE:$.setReflectionMode("REFLECTIONMAP_PROJECTION");break;case _.a.SKYBOX_MODE:$.setReflectionMode("REFLECTIONMAP_SKYBOX");break;case _.a.SPHERICAL_MODE:$.setReflectionMode("REFLECTIONMAP_SPHERICAL");break;case _.a.EQUIRECTANGULAR_MODE:$.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR");break;case _.a.FIXED_EQUIRECTANGULAR_MODE:$.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR_FIXED");break;case _.a.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:$.setReflectionMode("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED");break;case _.a.CUBIC_MODE:case _.a.INVCUBIC_MODE:default:$.setReflectionMode("REFLECTIONMAP_CUBIC")}$.USE_LOCAL_REFLECTIONMAP_CUBIC=!!this._reflectionTexture.boundingBoxSize}else $.REFLECTION=!1;if(this._emissiveTexture&&ie.EmissiveTextureEnabled){if(!this._emissiveTexture.isReadyOrNotBlocking())return!1;T.a.PrepareDefinesForMergedUV(this._emissiveTexture,$,"EMISSIVE")}else $.EMISSIVE=!1;if(this._lightmapTexture&&ie.LightmapTextureEnabled){if(!this._lightmapTexture.isReadyOrNotBlocking())return!1;T.a.PrepareDefinesForMergedUV(this._lightmapTexture,$,"LIGHTMAP"),$.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,$.RGBDLIGHTMAP=this._lightmapTexture.isRGBD}else $.LIGHTMAP=!1;if(this._specularTexture&&ie.SpecularTextureEnabled){if(!this._specularTexture.isReadyOrNotBlocking())return!1;T.a.PrepareDefinesForMergedUV(this._specularTexture,$,"SPECULAR"),$.GLOSSINESS=this._useGlossinessFromSpecularMapAlpha}else $.SPECULAR=!1;if(G.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&ie.BumpTextureEnabled){if(!this._bumpTexture.isReady())return!1;T.a.PrepareDefinesForMergedUV(this._bumpTexture,$,"BUMP"),$.PARALLAX=this._useParallax,$.PARALLAXOCCLUSION=this._useParallaxOcclusion,$.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap}else $.BUMP=!1;if(this._refractionTexture&&ie.RefractionTextureEnabled){if(!this._refractionTexture.isReadyOrNotBlocking())return!1;$._needUVs=!0,$.REFRACTION=!0,$.REFRACTIONMAP_3D=this._refractionTexture.isCube,$.RGBDREFRACTION=this._refractionTexture.isRGBD}else $.REFRACTION=!1;$.TWOSIDEDLIGHTING=!this._backFaceCulling&&this._twoSidedLighting}else $.DIFFUSE=!1,$.AMBIENT=!1,$.OPACITY=!1,$.REFLECTION=!1,$.EMISSIVE=!1,$.LIGHTMAP=!1,$.BUMP=!1,$.REFRACTION=!1;$.ALPHAFROMDIFFUSE=this._shouldUseAlphaFromDiffuseTexture(),$.EMISSIVEASILLUMINATION=this._useEmissiveAsIllumination,$.LINKEMISSIVEWITHDIFFUSE=this._linkEmissiveWithDiffuse,$.SPECULAROVERALPHA=this._useSpecularOverAlpha,$.PREMULTIPLYALPHA=this.alphaMode===Y.a.ALPHA_PREMULTIPLIED||this.alphaMode===Y.a.ALPHA_PREMULTIPLIED_PORTERDUFF,$.ALPHATEST_AFTERALLALPHACOMPUTATIONS=this.transparencyMode!==null,$.ALPHABLEND=this.transparencyMode===null||this.needAlphaBlendingForMesh(Z)}if(!this.detailMap.isReadyForSubMesh($,G))return!1;if($._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines($),$.IS_REFLECTION_LINEAR=this.reflectionTexture!=null&&!this.reflectionTexture.gammaSpace,$.IS_REFRACTION_LINEAR=this.refractionTexture!=null&&!this.refractionTexture.gammaSpace}if($._areFresnelDirty&&(ie.FresnelEnabled?(this._diffuseFresnelParameters||this._opacityFresnelParameters||this._emissiveFresnelParameters||this._refractionFresnelParameters||this._reflectionFresnelParameters)&&($.DIFFUSEFRESNEL=this._diffuseFresnelParameters&&this._diffuseFresnelParameters.isEnabled,$.OPACITYFRESNEL=this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled,$.REFLECTIONFRESNEL=this._reflectionFresnelParameters&&this._reflectionFresnelParameters.isEnabled,$.REFLECTIONFRESNELFROMSPECULAR=this._useReflectionFresnelFromSpecular,$.REFRACTIONFRESNEL=this._refractionFresnelParameters&&this._refractionFresnelParameters.isEnabled,$.EMISSIVEFRESNEL=this._emissiveFresnelParameters&&this._emissiveFresnelParameters.isEnabled,$._needNormals=!0,$.FRESNEL=!0):$.FRESNEL=!1),T.a.PrepareDefinesForMisc(Z,G,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(Z)||this._forceAlphaTest,$),T.a.PrepareDefinesForAttributes(Z,$,!0,!0,!0),T.a.PrepareDefinesForFrameBoundValues(G,le,$,B,null,te.getRenderingMesh().hasThinInstances),this.detailMap.prepareDefines($,G),$.isDirty){var se=$._areLightsDisposed;$.markAsProcessed();var q=new W.a;$.REFLECTION&&q.addFallback(0,"REFLECTION"),$.SPECULAR&&q.addFallback(0,"SPECULAR"),$.BUMP&&q.addFallback(0,"BUMP"),$.PARALLAX&&q.addFallback(1,"PARALLAX"),$.PARALLAXOCCLUSION&&q.addFallback(0,"PARALLAXOCCLUSION"),$.SPECULAROVERALPHA&&q.addFallback(0,"SPECULAROVERALPHA"),$.FOG&&q.addFallback(1,"FOG"),$.POINTSIZE&&q.addFallback(0,"POINTSIZE"),$.LOGARITHMICDEPTH&&q.addFallback(0,"LOGARITHMICDEPTH"),T.a.HandleFallbacksForShadows($,q,this._maxSimultaneousLights),$.SPECULARTERM&&q.addFallback(0,"SPECULARTERM"),$.DIFFUSEFRESNEL&&q.addFallback(1,"DIFFUSEFRESNEL"),$.OPACITYFRESNEL&&q.addFallback(2,"OPACITYFRESNEL"),$.REFLECTIONFRESNEL&&q.addFallback(3,"REFLECTIONFRESNEL"),$.EMISSIVEFRESNEL&&q.addFallback(4,"EMISSIVEFRESNEL"),$.FRESNEL&&q.addFallback(4,"FRESNEL"),$.MULTIVIEW&&q.addFallback(0,"MULTIVIEW");var H=[I.b.PositionKind];$.NORMAL&&H.push(I.b.NormalKind),$.UV1&&H.push(I.b.UVKind),$.UV2&&H.push(I.b.UV2Kind),$.VERTEXCOLOR&&H.push(I.b.ColorKind),T.a.PrepareAttributesForBones(H,Z,$,q),T.a.PrepareAttributesForInstances(H,$),T.a.PrepareAttributesForMorphTargets(H,Z,$);var X="default",J=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","visibility","vFogInfos","vFogColor","pointSize","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","normalMatrix","lightmapMatrix","refractionMatrix","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor","refractionLeftColor","refractionRightColor","vReflectionPosition","vReflectionSize","logarithmicDepthConstant","vTangentSpaceParams","alphaCutOff","boneTextureWidth"],Q=["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","lightmapSampler","refractionCubeSampler","refraction2DSampler","boneSampler"],ee=["Material","Scene"];re.a.AddUniforms(J),re.a.AddSamplers(Q),b.a.AddUniforms(J),b.a.AddSamplers(J),p.a&&(p.a.PrepareUniforms(J,$),p.a.PrepareSamplers(Q,$)),T.a.PrepareUniformsAndSamplersList({uniformsNames:J,uniformBuffersNames:ee,samplers:Q,defines:$,maxSimultaneousLights:this._maxSimultaneousLights});var pe={};this.customShaderNameResolve&&(X=this.customShaderNameResolve(X,J,ee,Q,$,H,pe));var Te=$.toString(),ve=te.effect,he=G.getEngine().createEffect(X,{attributes:H,uniformsNames:J,uniformBuffersNames:ee,samplers:Q,defines:Te,fallbacks:q,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:$.NUM_MORPH_INFLUENCERS},processFinalCode:pe.processFinalCode,multiTarget:$.PREPASS},le);if(he)if(this._onEffectCreatedObservable&&(ne.effect=he,ne.subMesh=te,this._onEffectCreatedObservable.notifyObservers(ne)),this.allowShaderHotSwapping&&ve&&!he.isReady()){if(he=ve,this._rebuildInParallel=!0,$.markAsUnprocessed(),se)return $._areLightsDisposed=!0,!1}else this._rebuildInParallel=!1,G.resetCachedMaterial(),te.setEffect(he,$),this.buildUniformLayout()}return!(!te.effect||!te.effect.isReady())&&($._renderId=G.getRenderId(),te.effect._wasPreviouslyReady=!0,!0)},ie.prototype.buildUniformLayout=function(){var Z=this._uniformBuffer;Z.addUniform("diffuseLeftColor",4),Z.addUniform("diffuseRightColor",4),Z.addUniform("opacityParts",4),Z.addUniform("reflectionLeftColor",4),Z.addUniform("reflectionRightColor",4),Z.addUniform("refractionLeftColor",4),Z.addUniform("refractionRightColor",4),Z.addUniform("emissiveLeftColor",4),Z.addUniform("emissiveRightColor",4),Z.addUniform("vDiffuseInfos",2),Z.addUniform("vAmbientInfos",2),Z.addUniform("vOpacityInfos",2),Z.addUniform("vReflectionInfos",2),Z.addUniform("vReflectionPosition",3),Z.addUniform("vReflectionSize",3),Z.addUniform("vEmissiveInfos",2),Z.addUniform("vLightmapInfos",2),Z.addUniform("vSpecularInfos",2),Z.addUniform("vBumpInfos",3),Z.addUniform("diffuseMatrix",16),Z.addUniform("ambientMatrix",16),Z.addUniform("opacityMatrix",16),Z.addUniform("reflectionMatrix",16),Z.addUniform("emissiveMatrix",16),Z.addUniform("lightmapMatrix",16),Z.addUniform("specularMatrix",16),Z.addUniform("bumpMatrix",16),Z.addUniform("vTangentSpaceParams",2),Z.addUniform("pointSize",1),Z.addUniform("refractionMatrix",16),Z.addUniform("vRefractionInfos",4),Z.addUniform("vSpecularColor",4),Z.addUniform("vEmissiveColor",3),Z.addUniform("visibility",1),Z.addUniform("vDiffuseColor",4),re.a.PrepareUniformBuffer(Z),Z.create()},ie.prototype.unbind=function(){if(this._activeEffect){var Z=!1;this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&(this._activeEffect.setTexture("reflection2DSampler",null),Z=!0),this._refractionTexture&&this._refractionTexture.isRenderTarget&&(this._activeEffect.setTexture("refraction2DSampler",null),Z=!0),Z&&this._markAllSubMeshesAsTexturesDirty()}ce.prototype.unbind.call(this)},ie.prototype.bindForSubMesh=function(Z,te,B){var G=this.getScene(),$=B._materialDefines;if($){var le=B.effect;if(le){this._activeEffect=le,$.INSTANCES&&!$.THIN_INSTANCES||this.bindOnlyWorldMatrix(Z),this.prePassConfiguration.bindForSubMesh(this._activeEffect,G,te,Z,this.isFrozen),$.OBJECTSPACE_NORMALMAP&&(Z.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));var se=this._mustRebind(G,le,te.visibility);T.a.BindBonesParameters(te,le);var q=this._uniformBuffer;if(se){if(q.bindToEffect(le,"Material"),this.bindViewProjection(le),!q.useUbo||!this.isFrozen||!q.isSync){if(ie.FresnelEnabled&&$.FRESNEL&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(q.updateColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),q.updateColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&q.updateColor4("opacityParts",new C.a(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(q.updateColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),q.updateColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(q.updateColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power),q.updateColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias)),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(q.updateColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),q.updateColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),G.texturesEnabled){if(this._diffuseTexture&&ie.DiffuseTextureEnabled&&(q.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),T.a.BindTextureMatrix(this._diffuseTexture,q,"diffuse")),this._ambientTexture&&ie.AmbientTextureEnabled&&(q.updateFloat2("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level),T.a.BindTextureMatrix(this._ambientTexture,q,"ambient")),this._opacityTexture&&ie.OpacityTextureEnabled&&(q.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),T.a.BindTextureMatrix(this._opacityTexture,q,"opacity")),this._hasAlphaChannel()&&le.setFloat("alphaCutOff",this.alphaCutOff),this._reflectionTexture&&ie.ReflectionTextureEnabled&&(q.updateFloat2("vReflectionInfos",this._reflectionTexture.level,this.roughness),q.updateMatrix("reflectionMatrix",this._reflectionTexture.getReflectionTextureMatrix()),this._reflectionTexture.boundingBoxSize)){var H=this._reflectionTexture;q.updateVector3("vReflectionPosition",H.boundingBoxPosition),q.updateVector3("vReflectionSize",H.boundingBoxSize)}if(this._emissiveTexture&&ie.EmissiveTextureEnabled&&(q.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),T.a.BindTextureMatrix(this._emissiveTexture,q,"emissive")),this._lightmapTexture&&ie.LightmapTextureEnabled&&(q.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),T.a.BindTextureMatrix(this._lightmapTexture,q,"lightmap")),this._specularTexture&&ie.SpecularTextureEnabled&&(q.updateFloat2("vSpecularInfos",this._specularTexture.coordinatesIndex,this._specularTexture.level),T.a.BindTextureMatrix(this._specularTexture,q,"specular")),this._bumpTexture&&G.getEngine().getCaps().standardDerivatives&&ie.BumpTextureEnabled&&(q.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,1/this._bumpTexture.level,this.parallaxScaleBias),T.a.BindTextureMatrix(this._bumpTexture,q,"bump"),G._mirroredCameraPosition?q.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):q.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),this._refractionTexture&&ie.RefractionTextureEnabled){var X=1;this._refractionTexture.isCube||(q.updateMatrix("refractionMatrix",this._refractionTexture.getReflectionTextureMatrix()),this._refractionTexture.depth&&(X=this._refractionTexture.depth)),q.updateFloat4("vRefractionInfos",this._refractionTexture.level,this.indexOfRefraction,X,this.invertRefractionY?-1:1)}}this.pointsCloud&&q.updateFloat("pointSize",this.pointSize),$.SPECULARTERM&&q.updateColor4("vSpecularColor",this.specularColor,this.specularPower),q.updateColor3("vEmissiveColor",ie.EmissiveTextureEnabled?this.emissiveColor:C.a.BlackReadOnly),q.updateColor4("vDiffuseColor",this.diffuseColor,this.alpha)}q.updateFloat("visibility",te.visibility),G.texturesEnabled&&(this._diffuseTexture&&ie.DiffuseTextureEnabled&&le.setTexture("diffuseSampler",this._diffuseTexture),this._ambientTexture&&ie.AmbientTextureEnabled&&le.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&ie.OpacityTextureEnabled&&le.setTexture("opacitySampler",this._opacityTexture),this._reflectionTexture&&ie.ReflectionTextureEnabled&&(this._reflectionTexture.isCube?le.setTexture("reflectionCubeSampler",this._reflectionTexture):le.setTexture("reflection2DSampler",this._reflectionTexture)),this._emissiveTexture&&ie.EmissiveTextureEnabled&&le.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&ie.LightmapTextureEnabled&&le.setTexture("lightmapSampler",this._lightmapTexture),this._specularTexture&&ie.SpecularTextureEnabled&&le.setTexture("specularSampler",this._specularTexture),this._bumpTexture&&G.getEngine().getCaps().standardDerivatives&&ie.BumpTextureEnabled&&le.setTexture("bumpSampler",this._bumpTexture),this._refractionTexture&&ie.RefractionTextureEnabled)&&(X=1,this._refractionTexture.isCube?le.setTexture("refractionCubeSampler",this._refractionTexture):le.setTexture("refraction2DSampler",this._refractionTexture)),this.detailMap.bindForSubMesh(q,G,this.isFrozen),T.a.BindClipPlane(le,G),G.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),T.a.BindEyePosition(le,G),le.setColor3("vAmbientColor",this._globalAmbientColor)}!se&&this.isFrozen||(G.lightsEnabled&&!this._disableLighting&&T.a.BindLights(G,te,le,$,this._maxSimultaneousLights,this._rebuildInParallel),(G.fogEnabled&&te.applyFog&&G.fogMode!==d.a.FOGMODE_NONE||this._reflectionTexture||this._refractionTexture)&&this.bindView(le),T.a.BindFogParameters(G,te,le),$.NUM_MORPH_INFLUENCERS&&T.a.BindMorphTargetParameters(te,le),this.useLogarithmicDepth&&T.a.BindLogDepth($,le,G),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._activeEffect)),q.update(),this._afterBind(te,this._activeEffect)}}},ie.prototype.getAnimatables=function(){var Z=[];return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&Z.push(this._diffuseTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&Z.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&Z.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&Z.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&Z.push(this._emissiveTexture),this._specularTexture&&this._specularTexture.animations&&this._specularTexture.animations.length>0&&Z.push(this._specularTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&Z.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&Z.push(this._lightmapTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&Z.push(this._refractionTexture),this.detailMap.getAnimatables(Z),Z},ie.prototype.getActiveTextures=function(){var Z=ce.prototype.getActiveTextures.call(this);return this._diffuseTexture&&Z.push(this._diffuseTexture),this._ambientTexture&&Z.push(this._ambientTexture),this._opacityTexture&&Z.push(this._opacityTexture),this._reflectionTexture&&Z.push(this._reflectionTexture),this._emissiveTexture&&Z.push(this._emissiveTexture),this._specularTexture&&Z.push(this._specularTexture),this._bumpTexture&&Z.push(this._bumpTexture),this._lightmapTexture&&Z.push(this._lightmapTexture),this._refractionTexture&&Z.push(this._refractionTexture),this.detailMap.getActiveTextures(Z),Z},ie.prototype.hasTexture=function(Z){return!!ce.prototype.hasTexture.call(this,Z)||this._diffuseTexture===Z||this._ambientTexture===Z||this._opacityTexture===Z||this._reflectionTexture===Z||this._emissiveTexture===Z||this._specularTexture===Z||this._bumpTexture===Z||this._lightmapTexture===Z||this._refractionTexture===Z||this.detailMap.hasTexture(Z)},ie.prototype.dispose=function(Z,te){var B,G,$,le,se,q,H,X,J;te&&((B=this._diffuseTexture)===null||B===void 0||B.dispose(),(G=this._ambientTexture)===null||G===void 0||G.dispose(),($=this._opacityTexture)===null||$===void 0||$.dispose(),(le=this._reflectionTexture)===null||le===void 0||le.dispose(),(se=this._emissiveTexture)===null||se===void 0||se.dispose(),(q=this._specularTexture)===null||q===void 0||q.dispose(),(H=this._bumpTexture)===null||H===void 0||H.dispose(),(X=this._lightmapTexture)===null||X===void 0||X.dispose(),(J=this._refractionTexture)===null||J===void 0||J.dispose()),this.detailMap.dispose(te),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),ce.prototype.dispose.call(this,Z,te)},ie.prototype.clone=function(Z){var te=this,B=m.a.Clone(function(){return new ie(Z,te.getScene())},this);return B.name=Z,B.id=Z,B},ie.prototype.serialize=function(){return m.a.Serialize(this)},ie.Parse=function(Z,te,B){return m.a.Parse(function(){return new ie(Z.name,te)},Z,te,B)},Object.defineProperty(ie,"DiffuseTextureEnabled",{get:function(){return O.a.DiffuseTextureEnabled},set:function(Z){O.a.DiffuseTextureEnabled=Z},enumerable:!1,configurable:!0}),Object.defineProperty(ie,"DetailTextureEnabled",{get:function(){return O.a.DetailTextureEnabled},set:function(Z){O.a.DetailTextureEnabled=Z},enumerable:!1,configurable:!0}),Object.defineProperty(ie,"AmbientTextureEnabled",{get:function(){return O.a.AmbientTextureEnabled},set:function(Z){O.a.AmbientTextureEnabled=Z},enumerable:!1,configurable:!0}),Object.defineProperty(ie,"OpacityTextureEnabled",{get:function(){return O.a.OpacityTextureEnabled},set:function(Z){O.a.OpacityTextureEnabled=Z},enumerable:!1,configurable:!0}),Object.defineProperty(ie,"ReflectionTextureEnabled",{get:function(){return O.a.ReflectionTextureEnabled},set:function(Z){O.a.ReflectionTextureEnabled=Z},enumerable:!1,configurable:!0}),Object.defineProperty(ie,"EmissiveTextureEnabled",{get:function(){return O.a.EmissiveTextureEnabled},set:function(Z){O.a.EmissiveTextureEnabled=Z},enumerable:!1,configurable:!0}),Object.defineProperty(ie,"SpecularTextureEnabled",{get:function(){return O.a.SpecularTextureEnabled},set:function(Z){O.a.SpecularTextureEnabled=Z},enumerable:!1,configurable:!0}),Object.defineProperty(ie,"BumpTextureEnabled",{get:function(){return O.a.BumpTextureEnabled},set:function(Z){O.a.BumpTextureEnabled=Z},enumerable:!1,configurable:!0}),Object.defineProperty(ie,"LightmapTextureEnabled",{get:function(){return O.a.LightmapTextureEnabled},set:function(Z){O.a.LightmapTextureEnabled=Z},enumerable:!1,configurable:!0}),Object.defineProperty(ie,"RefractionTextureEnabled",{get:function(){return O.a.RefractionTextureEnabled},set:function(Z){O.a.RefractionTextureEnabled=Z},enumerable:!1,configurable:!0}),Object.defineProperty(ie,"ColorGradingTextureEnabled",{get:function(){return O.a.ColorGradingTextureEnabled},set:function(Z){O.a.ColorGradingTextureEnabled=Z},enumerable:!1,configurable:!0}),Object.defineProperty(ie,"FresnelEnabled",{get:function(){return O.a.FresnelEnabled},set:function(Z){O.a.FresnelEnabled=Z},enumerable:!1,configurable:!0}),Object(E.c)([Object(m.m)("diffuseTexture")],ie.prototype,"_diffuseTexture",void 0),Object(E.c)([Object(m.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],ie.prototype,"diffuseTexture",void 0),Object(E.c)([Object(m.m)("ambientTexture")],ie.prototype,"_ambientTexture",void 0),Object(E.c)([Object(m.b)("_markAllSubMeshesAsTexturesDirty")],ie.prototype,"ambientTexture",void 0),Object(E.c)([Object(m.m)("opacityTexture")],ie.prototype,"_opacityTexture",void 0),Object(E.c)([Object(m.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],ie.prototype,"opacityTexture",void 0),Object(E.c)([Object(m.m)("reflectionTexture")],ie.prototype,"_reflectionTexture",void 0),Object(E.c)([Object(m.b)("_markAllSubMeshesAsTexturesDirty")],ie.prototype,"reflectionTexture",void 0),Object(E.c)([Object(m.m)("emissiveTexture")],ie.prototype,"_emissiveTexture",void 0),Object(E.c)([Object(m.b)("_markAllSubMeshesAsTexturesDirty")],ie.prototype,"emissiveTexture",void 0),Object(E.c)([Object(m.m)("specularTexture")],ie.prototype,"_specularTexture",void 0),Object(E.c)([Object(m.b)("_markAllSubMeshesAsTexturesDirty")],ie.prototype,"specularTexture",void 0),Object(E.c)([Object(m.m)("bumpTexture")],ie.prototype,"_bumpTexture",void 0),Object(E.c)([Object(m.b)("_markAllSubMeshesAsTexturesDirty")],ie.prototype,"bumpTexture",void 0),Object(E.c)([Object(m.m)("lightmapTexture")],ie.prototype,"_lightmapTexture",void 0),Object(E.c)([Object(m.b)("_markAllSubMeshesAsTexturesDirty")],ie.prototype,"lightmapTexture",void 0),Object(E.c)([Object(m.m)("refractionTexture")],ie.prototype,"_refractionTexture",void 0),Object(E.c)([Object(m.b)("_markAllSubMeshesAsTexturesDirty")],ie.prototype,"refractionTexture",void 0),Object(E.c)([Object(m.e)("ambient")],ie.prototype,"ambientColor",void 0),Object(E.c)([Object(m.e)("diffuse")],ie.prototype,"diffuseColor",void 0),Object(E.c)([Object(m.e)("specular")],ie.prototype,"specularColor",void 0),Object(E.c)([Object(m.e)("emissive")],ie.prototype,"emissiveColor",void 0),Object(E.c)([Object(m.c)()],ie.prototype,"specularPower",void 0),Object(E.c)([Object(m.c)("useAlphaFromDiffuseTexture")],ie.prototype,"_useAlphaFromDiffuseTexture",void 0),Object(E.c)([Object(m.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],ie.prototype,"useAlphaFromDiffuseTexture",void 0),Object(E.c)([Object(m.c)("useEmissiveAsIllumination")],ie.prototype,"_useEmissiveAsIllumination",void 0),Object(E.c)([Object(m.b)("_markAllSubMeshesAsTexturesDirty")],ie.prototype,"useEmissiveAsIllumination",void 0),Object(E.c)([Object(m.c)("linkEmissiveWithDiffuse")],ie.prototype,"_linkEmissiveWithDiffuse",void 0),Object(E.c)([Object(m.b)("_markAllSubMeshesAsTexturesDirty")],ie.prototype,"linkEmissiveWithDiffuse",void 0),Object(E.c)([Object(m.c)("useSpecularOverAlpha")],ie.prototype,"_useSpecularOverAlpha",void 0),Object(E.c)([Object(m.b)("_markAllSubMeshesAsTexturesDirty")],ie.prototype,"useSpecularOverAlpha",void 0),Object(E.c)([Object(m.c)("useReflectionOverAlpha")],ie.prototype,"_useReflectionOverAlpha",void 0),Object(E.c)([Object(m.b)("_markAllSubMeshesAsTexturesDirty")],ie.prototype,"useReflectionOverAlpha",void 0),Object(E.c)([Object(m.c)("disableLighting")],ie.prototype,"_disableLighting",void 0),Object(E.c)([Object(m.b)("_markAllSubMeshesAsLightsDirty")],ie.prototype,"disableLighting",void 0),Object(E.c)([Object(m.c)("useObjectSpaceNormalMap")],ie.prototype,"_useObjectSpaceNormalMap",void 0),Object(E.c)([Object(m.b)("_markAllSubMeshesAsTexturesDirty")],ie.prototype,"useObjectSpaceNormalMap",void 0),Object(E.c)([Object(m.c)("useParallax")],ie.prototype,"_useParallax",void 0),Object(E.c)([Object(m.b)("_markAllSubMeshesAsTexturesDirty")],ie.prototype,"useParallax",void 0),Object(E.c)([Object(m.c)("useParallaxOcclusion")],ie.prototype,"_useParallaxOcclusion",void 0),Object(E.c)([Object(m.b)("_markAllSubMeshesAsTexturesDirty")],ie.prototype,"useParallaxOcclusion",void 0),Object(E.c)([Object(m.c)()],ie.prototype,"parallaxScaleBias",void 0),Object(E.c)([Object(m.c)("roughness")],ie.prototype,"_roughness",void 0),Object(E.c)([Object(m.b)("_markAllSubMeshesAsTexturesDirty")],ie.prototype,"roughness",void 0),Object(E.c)([Object(m.c)()],ie.prototype,"indexOfRefraction",void 0),Object(E.c)([Object(m.c)()],ie.prototype,"invertRefractionY",void 0),Object(E.c)([Object(m.c)()],ie.prototype,"alphaCutOff",void 0),Object(E.c)([Object(m.c)("useLightmapAsShadowmap")],ie.prototype,"_useLightmapAsShadowmap",void 0),Object(E.c)([Object(m.b)("_markAllSubMeshesAsTexturesDirty")],ie.prototype,"useLightmapAsShadowmap",void 0),Object(E.c)([Object(m.h)("diffuseFresnelParameters")],ie.prototype,"_diffuseFresnelParameters",void 0),Object(E.c)([Object(m.b)("_markAllSubMeshesAsFresnelDirty")],ie.prototype,"diffuseFresnelParameters",void 0),Object(E.c)([Object(m.h)("opacityFresnelParameters")],ie.prototype,"_opacityFresnelParameters",void 0),Object(E.c)([Object(m.b)("_markAllSubMeshesAsFresnelAndMiscDirty")],ie.prototype,"opacityFresnelParameters",void 0),Object(E.c)([Object(m.h)("reflectionFresnelParameters")],ie.prototype,"_reflectionFresnelParameters",void 0),Object(E.c)([Object(m.b)("_markAllSubMeshesAsFresnelDirty")],ie.prototype,"reflectionFresnelParameters",void 0),Object(E.c)([Object(m.h)("refractionFresnelParameters")],ie.prototype,"_refractionFresnelParameters",void 0),Object(E.c)([Object(m.b)("_markAllSubMeshesAsFresnelDirty")],ie.prototype,"refractionFresnelParameters",void 0),Object(E.c)([Object(m.h)("emissiveFresnelParameters")],ie.prototype,"_emissiveFresnelParameters",void 0),Object(E.c)([Object(m.b)("_markAllSubMeshesAsFresnelDirty")],ie.prototype,"emissiveFresnelParameters",void 0),Object(E.c)([Object(m.c)("useReflectionFresnelFromSpecular")],ie.prototype,"_useReflectionFresnelFromSpecular",void 0),Object(E.c)([Object(m.b)("_markAllSubMeshesAsFresnelDirty")],ie.prototype,"useReflectionFresnelFromSpecular",void 0),Object(E.c)([Object(m.c)("useGlossinessFromSpecularMapAlpha")],ie.prototype,"_useGlossinessFromSpecularMapAlpha",void 0),Object(E.c)([Object(m.b)("_markAllSubMeshesAsTexturesDirty")],ie.prototype,"useGlossinessFromSpecularMapAlpha",void 0),Object(E.c)([Object(m.c)("maxSimultaneousLights")],ie.prototype,"_maxSimultaneousLights",void 0),Object(E.c)([Object(m.b)("_markAllSubMeshesAsLightsDirty")],ie.prototype,"maxSimultaneousLights",void 0),Object(E.c)([Object(m.c)("invertNormalMapX")],ie.prototype,"_invertNormalMapX",void 0),Object(E.c)([Object(m.b)("_markAllSubMeshesAsTexturesDirty")],ie.prototype,"invertNormalMapX",void 0),Object(E.c)([Object(m.c)("invertNormalMapY")],ie.prototype,"_invertNormalMapY",void 0),Object(E.c)([Object(m.b)("_markAllSubMeshesAsTexturesDirty")],ie.prototype,"invertNormalMapY",void 0),Object(E.c)([Object(m.c)("twoSidedLighting")],ie.prototype,"_twoSidedLighting",void 0),Object(E.c)([Object(m.b)("_markAllSubMeshesAsTexturesDirty")],ie.prototype,"twoSidedLighting",void 0),Object(E.c)([Object(m.c)()],ie.prototype,"useLogarithmicDepth",null),ie}(A.a);g.a.RegisteredTypes["BABYLON.StandardMaterial"]=_e,d.a.DefaultMaterialFactory=function(ce){return new _e("default material",ce)}},function(h,s,c){c.d(s,"a",function(){return L});var E=c(1),m=c(12),S=c(6),d=c(0),M=c(13),C=c(4),I=c(16),b=c(46),p=c(54),x=c(43),P=c(2),A=c(147),T=c(21),_=c(101),g=c(9),O=c(28),R=c(23),N=c(11),V=function(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=d.e.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1},U=function(){this._hasVertexAlpha=!1,this._useVertexColors=!0,this._numBoneInfluencers=4,this._applyFog=!0,this._receiveShadows=!1,this._facetData=new V,this._visibility=1,this._skeleton=null,this._layerMask=268435455,this._computeBonesUsingShaders=!0,this._isActive=!1,this._onlyForInstances=!1,this._isActiveIntermediate=!1,this._onlyForInstancesIntermediate=!1,this._actAsRegularMesh=!1,this._currentLOD=null,this._currentLODIsUpToDate=!1},L=function(j){function Y(W,re){re===void 0&&(re=null);var ne=j.call(this,W,re,!1)||this;return ne._internalAbstractMeshDataInfo=new U,ne.cullingStrategy=Y.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY,ne.onCollideObservable=new S.c,ne.onCollisionPositionChangeObservable=new S.c,ne.onMaterialChangedObservable=new S.c,ne.definedFacingForward=!0,ne._occlusionQuery=null,ne._renderingGroup=null,ne.alphaIndex=Number.MAX_VALUE,ne.isVisible=!0,ne.isPickable=!0,ne.showSubMeshesBoundingBox=!1,ne.isBlocker=!1,ne.enablePointerMoveEvents=!1,ne._renderingGroupId=0,ne._material=null,ne.outlineColor=g.a.Red(),ne.outlineWidth=.02,ne.overlayColor=g.a.Red(),ne.overlayAlpha=.5,ne.useOctreeForRenderingSelection=!0,ne.useOctreeForPicking=!0,ne.useOctreeForCollisions=!0,ne.alwaysSelectAsActiveMesh=!1,ne.doNotSyncBoundingInfo=!1,ne.actionManager=null,ne._meshCollisionData=new A.a,ne.ellipsoid=new d.e(.5,1,.5),ne.ellipsoidOffset=new d.e(0,0,0),ne.edgesWidth=1,ne.edgesColor=new g.b(1,0,0,1),ne._edgesRenderer=null,ne._masterMesh=null,ne._boundingInfo=null,ne._renderId=0,ne._intersectionsInProgress=new Array,ne._unIndexed=!1,ne._lightSources=new Array,ne._waitingData={lods:null,actions:null,freezeWorldMatrix:null},ne._bonesTransformMatrices=null,ne._transformMatrixTexture=null,ne.onRebuildObservable=new S.c,ne._onCollisionPositionChange=function(ge,_e,ce){ce===void 0&&(ce=null),_e.subtractToRef(ne._meshCollisionData._oldPositionForCollisions,ne._meshCollisionData._diffPositionForCollisions),ne._meshCollisionData._diffPositionForCollisions.length()>M.a.CollisionsEpsilon&&ne.position.addInPlace(ne._meshCollisionData._diffPositionForCollisions),ce&&ne.onCollideObservable.notifyObservers(ce),ne.onCollisionPositionChangeObservable.notifyObservers(ne.position)},ne.getScene().addMesh(ne),ne._resyncLightSources(),ne}return Object(E.d)(Y,j),Object.defineProperty(Y,"BILLBOARDMODE_NONE",{get:function(){return b.a.BILLBOARDMODE_NONE},enumerable:!1,configurable:!0}),Object.defineProperty(Y,"BILLBOARDMODE_X",{get:function(){return b.a.BILLBOARDMODE_X},enumerable:!1,configurable:!0}),Object.defineProperty(Y,"BILLBOARDMODE_Y",{get:function(){return b.a.BILLBOARDMODE_Y},enumerable:!1,configurable:!0}),Object.defineProperty(Y,"BILLBOARDMODE_Z",{get:function(){return b.a.BILLBOARDMODE_Z},enumerable:!1,configurable:!0}),Object.defineProperty(Y,"BILLBOARDMODE_ALL",{get:function(){return b.a.BILLBOARDMODE_ALL},enumerable:!1,configurable:!0}),Object.defineProperty(Y,"BILLBOARDMODE_USE_POSITION",{get:function(){return b.a.BILLBOARDMODE_USE_POSITION},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"facetNb",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetNb},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"partitioningSubdivisions",{get:function(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions},set:function(W){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=W},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"partitioningBBoxRatio",{get:function(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio},set:function(W){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=W},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"mustDepthSortFacets",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort},set:function(W){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=W},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"facetDepthSortFrom",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom},set:function(W){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=W},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"isFacetDataEnabled",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled},enumerable:!1,configurable:!0}),Y.prototype._updateNonUniformScalingState=function(W){return!!j.prototype._updateNonUniformScalingState.call(this,W)&&(this._markSubMeshesAsMiscDirty(),!0)},Object.defineProperty(Y.prototype,"onCollide",{set:function(W){this._meshCollisionData._onCollideObserver&&this.onCollideObservable.remove(this._meshCollisionData._onCollideObserver),this._meshCollisionData._onCollideObserver=this.onCollideObservable.add(W)},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"onCollisionPositionChange",{set:function(W){this._meshCollisionData._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._meshCollisionData._onCollisionPositionChangeObserver),this._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(W)},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"visibility",{get:function(){return this._internalAbstractMeshDataInfo._visibility},set:function(W){this._internalAbstractMeshDataInfo._visibility!==W&&(this._internalAbstractMeshDataInfo._visibility=W,this._markSubMeshesAsMiscDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"renderingGroupId",{get:function(){return this._renderingGroupId},set:function(W){this._renderingGroupId=W},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"material",{get:function(){return this._material},set:function(W){this._material!==W&&(this._material&&this._material.meshMap&&(this._material.meshMap[this.uniqueId]=void 0),this._material=W,W&&W.meshMap&&(W.meshMap[this.uniqueId]=this),this.onMaterialChangedObservable.hasObservers()&&this.onMaterialChangedObservable.notifyObservers(this),this.subMeshes&&this._unBindEffect())},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"receiveShadows",{get:function(){return this._internalAbstractMeshDataInfo._receiveShadows},set:function(W){this._internalAbstractMeshDataInfo._receiveShadows!==W&&(this._internalAbstractMeshDataInfo._receiveShadows=W,this._markSubMeshesAsLightDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"hasVertexAlpha",{get:function(){return this._internalAbstractMeshDataInfo._hasVertexAlpha},set:function(W){this._internalAbstractMeshDataInfo._hasVertexAlpha!==W&&(this._internalAbstractMeshDataInfo._hasVertexAlpha=W,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"useVertexColors",{get:function(){return this._internalAbstractMeshDataInfo._useVertexColors},set:function(W){this._internalAbstractMeshDataInfo._useVertexColors!==W&&(this._internalAbstractMeshDataInfo._useVertexColors=W,this._markSubMeshesAsAttributesDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"computeBonesUsingShaders",{get:function(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders},set:function(W){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==W&&(this._internalAbstractMeshDataInfo._computeBonesUsingShaders=W,this._markSubMeshesAsAttributesDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"numBoneInfluencers",{get:function(){return this._internalAbstractMeshDataInfo._numBoneInfluencers},set:function(W){this._internalAbstractMeshDataInfo._numBoneInfluencers!==W&&(this._internalAbstractMeshDataInfo._numBoneInfluencers=W,this._markSubMeshesAsAttributesDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"applyFog",{get:function(){return this._internalAbstractMeshDataInfo._applyFog},set:function(W){this._internalAbstractMeshDataInfo._applyFog!==W&&(this._internalAbstractMeshDataInfo._applyFog=W,this._markSubMeshesAsMiscDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"layerMask",{get:function(){return this._internalAbstractMeshDataInfo._layerMask},set:function(W){W!==this._internalAbstractMeshDataInfo._layerMask&&(this._internalAbstractMeshDataInfo._layerMask=W,this._resyncLightSources())},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"collisionMask",{get:function(){return this._meshCollisionData._collisionMask},set:function(W){this._meshCollisionData._collisionMask=isNaN(W)?-1:W},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"collisionResponse",{get:function(){return this._meshCollisionData._collisionResponse},set:function(W){this._meshCollisionData._collisionResponse=W},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"collisionGroup",{get:function(){return this._meshCollisionData._collisionGroup},set:function(W){this._meshCollisionData._collisionGroup=isNaN(W)?-1:W},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"surroundingMeshes",{get:function(){return this._meshCollisionData._surroundingMeshes},set:function(W){this._meshCollisionData._surroundingMeshes=W},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"lightSources",{get:function(){return this._lightSources},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"_positions",{get:function(){return null},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"skeleton",{get:function(){return this._internalAbstractMeshDataInfo._skeleton},set:function(W){var re=this._internalAbstractMeshDataInfo._skeleton;re&&re.needInitialSkinMatrix&&re._unregisterMeshWithPoseMatrix(this),W&&W.needInitialSkinMatrix&&W._registerMeshWithPoseMatrix(this),this._internalAbstractMeshDataInfo._skeleton=W,this._internalAbstractMeshDataInfo._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()},enumerable:!1,configurable:!0}),Y.prototype.getClassName=function(){return"AbstractMesh"},Y.prototype.toString=function(W){var re="Name: "+this.name+", isInstance: "+(this.getClassName()!=="InstancedMesh"?"YES":"NO");re+=", # of submeshes: "+(this.subMeshes?this.subMeshes.length:0);var ne=this._internalAbstractMeshDataInfo._skeleton;return ne&&(re+=", skeleton: "+ne.name),W&&(re+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],re+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData.freezeWorldMatrix?"YES":"NO")),re},Y.prototype._getEffectiveParent=function(){return this._masterMesh&&this.billboardMode!==b.a.BILLBOARDMODE_NONE?this._masterMesh:j.prototype._getEffectiveParent.call(this)},Y.prototype._getActionManagerForTrigger=function(W,re){if(re===void 0&&(re=!0),this.actionManager&&(re||this.actionManager.isRecursive)){if(!W)return this.actionManager;if(this.actionManager.hasSpecificTrigger(W))return this.actionManager}return this.parent?this.parent._getActionManagerForTrigger(W,!1):null},Y.prototype._rebuild=function(){if(this.onRebuildObservable.notifyObservers(this),this._occlusionQuery&&(this._occlusionQuery=null),this.subMeshes)for(var W=0,re=this.subMeshes;W<re.length;W++)re[W]._rebuild()},Y.prototype._resyncLightSources=function(){this._lightSources.length=0;for(var W=0,re=this.getScene().lights;W<re.length;W++){var ne=re[W];ne.isEnabled()&&ne.canAffectMesh(this)&&this._lightSources.push(ne)}this._markSubMeshesAsLightDirty()},Y.prototype._resyncLightSource=function(W){var re=W.isEnabled()&&W.canAffectMesh(this),ne=this._lightSources.indexOf(W),ge=!1;if(ne===-1){if(!re)return;this._lightSources.push(W)}else{if(re)return;ge=!0,this._lightSources.splice(ne,1)}this._markSubMeshesAsLightDirty(ge)},Y.prototype._unBindEffect=function(){for(var W=0,re=this.subMeshes;W<re.length;W++)re[W].setEffect(null)},Y.prototype._removeLightSource=function(W,re){var ne=this._lightSources.indexOf(W);ne!==-1&&(this._lightSources.splice(ne,1),this._markSubMeshesAsLightDirty(re))},Y.prototype._markSubMeshesAsDirty=function(W){if(this.subMeshes)for(var re=0,ne=this.subMeshes;re<ne.length;re++){var ge=ne[re];ge._materialDefines&&W(ge._materialDefines)}},Y.prototype._markSubMeshesAsLightDirty=function(W){W===void 0&&(W=!1),this._markSubMeshesAsDirty(function(re){return re.markAsLightDirty(W)})},Y.prototype._markSubMeshesAsAttributesDirty=function(){this._markSubMeshesAsDirty(function(W){return W.markAsAttributesDirty()})},Y.prototype._markSubMeshesAsMiscDirty=function(){this._markSubMeshesAsDirty(function(W){return W.markAsMiscDirty()})},Object.defineProperty(Y.prototype,"scaling",{get:function(){return this._scaling},set:function(W){this._scaling=W},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"isBlocked",{get:function(){return!1},enumerable:!1,configurable:!0}),Y.prototype.getLOD=function(W){return this},Y.prototype.getTotalVertices=function(){return 0},Y.prototype.getTotalIndices=function(){return 0},Y.prototype.getIndices=function(){return null},Y.prototype.getVerticesData=function(W){return null},Y.prototype.setVerticesData=function(W,re,ne,ge){return this},Y.prototype.updateVerticesData=function(W,re,ne,ge){return this},Y.prototype.setIndices=function(W,re){return this},Y.prototype.isVerticesDataPresent=function(W){return!1},Y.prototype.getBoundingInfo=function(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfo||this._updateBoundingInfo(),this._boundingInfo)},Y.prototype.normalizeToUnitCube=function(W,re,ne){return W===void 0&&(W=!0),re===void 0&&(re=!1),j.prototype.normalizeToUnitCube.call(this,W,re,ne)},Y.prototype.setBoundingInfo=function(W){return this._boundingInfo=W,this},Object.defineProperty(Y.prototype,"useBones",{get:function(){return this.skeleton&&this.getScene().skeletonsEnabled&&this.isVerticesDataPresent(C.b.MatricesIndicesKind)&&this.isVerticesDataPresent(C.b.MatricesWeightsKind)},enumerable:!1,configurable:!0}),Y.prototype._preActivate=function(){},Y.prototype._preActivateForIntermediateRendering=function(W){},Y.prototype._activate=function(W,re){return this._renderId=W,!0},Y.prototype._postActivate=function(){},Y.prototype._freeze=function(){},Y.prototype._unFreeze=function(){},Y.prototype.getWorldMatrix=function(){return this._masterMesh&&this.billboardMode===b.a.BILLBOARDMODE_NONE?this._masterMesh.getWorldMatrix():j.prototype.getWorldMatrix.call(this)},Y.prototype._getWorldMatrixDeterminant=function(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():j.prototype._getWorldMatrixDeterminant.call(this)},Object.defineProperty(Y.prototype,"isAnInstance",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"hasInstances",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"hasThinInstances",{get:function(){return!1},enumerable:!1,configurable:!0}),Y.prototype.movePOV=function(W,re,ne){return this.position.addInPlace(this.calcMovePOV(W,re,ne)),this},Y.prototype.calcMovePOV=function(W,re,ne){var ge=new d.a;(this.rotationQuaternion?this.rotationQuaternion:d.b.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(ge);var _e=d.e.Zero(),ce=this.definedFacingForward?-1:1;return d.e.TransformCoordinatesFromFloatsToRef(W*ce,re,ne*ce,ge,_e),_e},Y.prototype.rotatePOV=function(W,re,ne){return this.rotation.addInPlace(this.calcRotatePOV(W,re,ne)),this},Y.prototype.calcRotatePOV=function(W,re,ne){var ge=this.definedFacingForward?1:-1;return new d.e(W*ge,re,ne*ge)},Y.prototype.refreshBoundingInfo=function(W){return W===void 0&&(W=!1),this._boundingInfo&&this._boundingInfo.isLocked||this._refreshBoundingInfo(this._getPositionData(W),null),this},Y.prototype._refreshBoundingInfo=function(W,re){if(W){var ne=Object(_.a)(W,0,this.getTotalVertices(),re);this._boundingInfo?this._boundingInfo.reConstruct(ne.minimum,ne.maximum):this._boundingInfo=new x.a(ne.minimum,ne.maximum)}if(this.subMeshes)for(var ge=0;ge<this.subMeshes.length;ge++)this.subMeshes[ge].refreshBoundingInfo(W);this._updateBoundingInfo()},Y.prototype._getPositionData=function(W){var re=this.getVerticesData(C.b.PositionKind);if(re&&W&&this.skeleton){re=m.b.Slice(re),this._generatePointsArray();var ne=this.getVerticesData(C.b.MatricesIndicesKind),ge=this.getVerticesData(C.b.MatricesWeightsKind);if(ge&&ne){var _e=this.numBoneInfluencers>4,ce=_e?this.getVerticesData(C.b.MatricesIndicesExtraKind):null,ie=_e?this.getVerticesData(C.b.MatricesWeightsExtraKind):null;this.skeleton.prepare();for(var Z=this.skeleton.getTransformMatrices(this),te=d.c.Vector3[0],B=d.c.Matrix[0],G=d.c.Matrix[1],$=0,le=0;le<re.length;le+=3,$+=4){var se,q;for(B.reset(),se=0;se<4;se++)(q=ge[$+se])>0&&(d.a.FromFloat32ArrayToRefScaled(Z,Math.floor(16*ne[$+se]),q,G),B.addToSelf(G));if(_e)for(se=0;se<4;se++)(q=ie[$+se])>0&&(d.a.FromFloat32ArrayToRefScaled(Z,Math.floor(16*ce[$+se]),q,G),B.addToSelf(G));d.e.TransformCoordinatesFromFloatsToRef(re[le],re[le+1],re[le+2],B,te),te.toArray(re,le),this._positions&&this._positions[le/3].copyFrom(te)}}}return re},Y.prototype._updateBoundingInfo=function(){var W=this._effectiveMesh;return this._boundingInfo?this._boundingInfo.update(W.worldMatrixFromCache):this._boundingInfo=new x.a(this.absolutePosition,this.absolutePosition,W.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(W.worldMatrixFromCache),this},Y.prototype._updateSubMeshesBoundingInfo=function(W){if(!this.subMeshes)return this;for(var re=this.subMeshes.length,ne=0;ne<re;ne++){var ge=this.subMeshes[ne];(re>1||!ge.IsGlobal)&&ge.updateBoundingInfo(W)}return this},Y.prototype._afterComputeWorldMatrix=function(){this.doNotSyncBoundingInfo||this._updateBoundingInfo()},Object.defineProperty(Y.prototype,"_effectiveMesh",{get:function(){return this.skeleton&&this.skeleton.overrideMesh||this},enumerable:!1,configurable:!0}),Y.prototype.isInFrustum=function(W){return this._boundingInfo!==null&&this._boundingInfo.isInFrustum(W,this.cullingStrategy)},Y.prototype.isCompletelyInFrustum=function(W){return this._boundingInfo!==null&&this._boundingInfo.isCompletelyInFrustum(W)},Y.prototype.intersectsMesh=function(W,re,ne){if(re===void 0&&(re=!1),!this._boundingInfo||!W._boundingInfo)return!1;if(this._boundingInfo.intersects(W._boundingInfo,re))return!0;if(ne){for(var ge=0,_e=this.getChildMeshes();ge<_e.length;ge++)if(_e[ge].intersectsMesh(W,re,!0))return!0}return!1},Y.prototype.intersectsPoint=function(W){return!!this._boundingInfo&&this._boundingInfo.intersectsPoint(W)},Object.defineProperty(Y.prototype,"checkCollisions",{get:function(){return this._meshCollisionData._checkCollisions},set:function(W){this._meshCollisionData._checkCollisions=W},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"collider",{get:function(){return this._meshCollisionData._collider},enumerable:!1,configurable:!0}),Y.prototype.moveWithCollisions=function(W){this.getAbsolutePosition().addToRef(this.ellipsoidOffset,this._meshCollisionData._oldPositionForCollisions);var re=this.getScene().collisionCoordinator;return this._meshCollisionData._collider||(this._meshCollisionData._collider=re.createCollider()),this._meshCollisionData._collider._radius=this.ellipsoid,re.getNewPosition(this._meshCollisionData._oldPositionForCollisions,W,this._meshCollisionData._collider,3,this,this._onCollisionPositionChange,this.uniqueId),this},Y.prototype._collideForSubMesh=function(W,re,ne){if(this._generatePointsArray(),!this._positions)return this;if(!W._lastColliderWorldVertices||!W._lastColliderTransformMatrix.equals(re)){W._lastColliderTransformMatrix=re.clone(),W._lastColliderWorldVertices=[],W._trianglePlanes=[];for(var ge=W.verticesStart,_e=W.verticesStart+W.verticesCount,ce=ge;ce<_e;ce++)W._lastColliderWorldVertices.push(d.e.TransformCoordinates(this._positions[ce],re))}return ne._collide(W._trianglePlanes,W._lastColliderWorldVertices,this.getIndices(),W.indexStart,W.indexStart+W.indexCount,W.verticesStart,!!W.getMaterial(),this),this},Y.prototype._processCollisionsForSubMeshes=function(W,re){for(var ne=this._scene.getCollidingSubMeshCandidates(this,W),ge=ne.length,_e=0;_e<ge;_e++){var ce=ne.data[_e];ge>1&&!ce._checkCollision(W)||this._collideForSubMesh(ce,re,W)}return this},Y.prototype._checkCollision=function(W){if(!this._boundingInfo||!this._boundingInfo._checkCollision(W))return this;var re=d.c.Matrix[0],ne=d.c.Matrix[1];return d.a.ScalingToRef(1/W._radius.x,1/W._radius.y,1/W._radius.z,re),this.worldMatrixFromCache.multiplyToRef(re,ne),this._processCollisionsForSubMeshes(W,ne),this},Y.prototype._generatePointsArray=function(){return!1},Y.prototype.intersects=function(W,re,ne,ge,_e,ce){var ie;ge===void 0&&(ge=!1),ce===void 0&&(ce=!1);var Z=new p.a,te=this.getClassName()==="InstancedLinesMesh"||this.getClassName()==="LinesMesh"?this.intersectionThreshold:0,B=this._boundingInfo;if(!this.subMeshes||!B||!(ce||W.intersectsSphere(B.boundingSphere,te)&&W.intersectsBox(B.boundingBox,te)))return Z;if(ge)return Z.hit=!ce,Z.pickedMesh=ce?null:this,Z.distance=ce?0:d.e.Distance(W.origin,B.boundingSphere.center),Z.subMeshId=0,Z;if(!this._generatePointsArray())return Z;for(var G=null,$=this._scene.getIntersectingSubMeshCandidates(this,W),le=$.length,se=!1,q=0;q<le;q++){var H=(X=$.data[q]).getMaterial();if(H&&((ie=this.getIndices())===null||ie===void 0?void 0:ie.length)&&(H.fillMode==P.a.MATERIAL_TriangleStripDrawMode||H.fillMode==P.a.MATERIAL_TriangleFillMode||H.fillMode==P.a.MATERIAL_WireFrameFillMode||H.fillMode==P.a.MATERIAL_PointFillMode)){se=!0;break}}if(!se)return Z.hit=!0,Z.pickedMesh=this,Z.distance=d.e.Distance(W.origin,B.boundingSphere.center),Z.subMeshId=-1,Z;for(q=0;q<le;q++){var X=$.data[q];if(!(le>1)||X.canIntersects(W)){var J=X.intersects(W,this._positions,this.getIndices(),re,ne);if(J&&(re||!G||J.distance<G.distance)&&((G=J).subMeshId=q,re))break}}if(G){var Q=_e??(this.skeleton&&this.skeleton.overrideMesh?this.skeleton.overrideMesh.getWorldMatrix():this.getWorldMatrix()),ee=d.c.Vector3[0],pe=d.c.Vector3[1];d.e.TransformCoordinatesToRef(W.origin,Q,ee),W.direction.scaleToRef(G.distance,pe);var Te=d.e.TransformNormal(pe,Q).addInPlace(ee);return Z.hit=!0,Z.distance=d.e.Distance(ee,Te),Z.pickedPoint=Te,Z.pickedMesh=this,Z.bu=G.bu||0,Z.bv=G.bv||0,Z.subMeshFaceId=G.faceId,Z.faceId=G.faceId+$.data[G.subMeshId].indexStart/(this.getClassName().indexOf("LinesMesh")!==-1?2:3),Z.subMeshId=G.subMeshId,Z}return Z},Y.prototype.clone=function(W,re,ne){return null},Y.prototype.releaseSubMeshes=function(){if(this.subMeshes)for(;this.subMeshes.length;)this.subMeshes[0].dispose();else this.subMeshes=new Array;return this},Y.prototype.dispose=function(W,re){var ne,ge=this;for(re===void 0&&(re=!1),this._scene.useMaterialMeshMap&&this._material&&this._material.meshMap&&(this._material.meshMap[this.uniqueId]=void 0),this.getScene().freeActiveMeshes(),this.getScene().freeRenderingGroups(),this.actionManager!==void 0&&this.actionManager!==null&&(this.actionManager.dispose(),this.actionManager=null),this._internalAbstractMeshDataInfo._skeleton=null,this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null),ne=0;ne<this._intersectionsInProgress.length;ne++){var _e=this._intersectionsInProgress[ne],ce=_e._intersectionsInProgress.indexOf(this);_e._intersectionsInProgress.splice(ce,1)}this._intersectionsInProgress=[],this.getScene().lights.forEach(function(Z){var te=Z.includedOnlyMeshes.indexOf(ge);te!==-1&&Z.includedOnlyMeshes.splice(te,1),(te=Z.excludedMeshes.indexOf(ge))!==-1&&Z.excludedMeshes.splice(te,1);var B=Z.getShadowGenerator();if(B){var G=B.getShadowMap();G&&G.renderList&&(te=G.renderList.indexOf(ge))!==-1&&G.renderList.splice(te,1)}}),this.getClassName()==="InstancedMesh"&&this.getClassName()==="InstancedLinesMesh"||this.releaseSubMeshes();var ie=this.getScene().getEngine();if(this._occlusionQuery&&(this.isOcclusionQueryInProgress=!1,ie.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),ie.wipeCaches(),this.getScene().removeMesh(this),re&&this.material&&(this.material.getClassName()==="MultiMaterial"?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!W)for(ne=0;ne<this.getScene().particleSystems.length;ne++)this.getScene().particleSystems[ne].emitter===this&&(this.getScene().particleSystems[ne].dispose(),ne--);this._internalAbstractMeshDataInfo._facetData.facetDataEnabled&&this.disableFacetData(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),j.prototype.dispose.call(this,W,re)},Y.prototype.addChild=function(W){return W.setParent(this),this},Y.prototype.removeChild=function(W){return W.setParent(null),this},Y.prototype._initFacetData=function(){var W=this._internalAbstractMeshDataInfo._facetData;W.facetNormals||(W.facetNormals=new Array),W.facetPositions||(W.facetPositions=new Array),W.facetPartitioning||(W.facetPartitioning=new Array),W.facetNb=this.getIndices().length/3|0,W.partitioningSubdivisions=W.partitioningSubdivisions?W.partitioningSubdivisions:10,W.partitioningBBoxRatio=W.partitioningBBoxRatio?W.partitioningBBoxRatio:1.01;for(var re=0;re<W.facetNb;re++)W.facetNormals[re]=d.e.Zero(),W.facetPositions[re]=d.e.Zero();return W.facetDataEnabled=!0,this},Y.prototype.updateFacetData=function(){var W=this._internalAbstractMeshDataInfo._facetData;W.facetDataEnabled||this._initFacetData();var re=this.getVerticesData(C.b.PositionKind),ne=this.getIndices(),ge=this.getVerticesData(C.b.NormalKind),_e=this.getBoundingInfo();if(W.facetDepthSort&&!W.facetDepthSortEnabled){if(W.facetDepthSortEnabled=!0,ne instanceof Uint16Array)W.depthSortedIndices=new Uint16Array(ne);else if(ne instanceof Uint32Array)W.depthSortedIndices=new Uint32Array(ne);else{for(var ce=!1,ie=0;ie<ne.length;ie++)if(ne[ie]>65535){ce=!0;break}W.depthSortedIndices=ce?new Uint32Array(ne):new Uint16Array(ne)}if(W.facetDepthSortFunction=function(se,q){return q.sqDistance-se.sqDistance},!W.facetDepthSortFrom){var Z=this.getScene().activeCamera;W.facetDepthSortFrom=Z?Z.position:d.e.Zero()}W.depthSortedFacets=[];for(var te=0;te<W.facetNb;te++){var B={ind:3*te,sqDistance:0};W.depthSortedFacets.push(B)}W.invertedMatrix=d.a.Identity(),W.facetDepthSortOrigin=d.e.Zero()}W.bbSize.x=_e.maximum.x-_e.minimum.x>O.a?_e.maximum.x-_e.minimum.x:O.a,W.bbSize.y=_e.maximum.y-_e.minimum.y>O.a?_e.maximum.y-_e.minimum.y:O.a,W.bbSize.z=_e.maximum.z-_e.minimum.z>O.a?_e.maximum.z-_e.minimum.z:O.a;var G=W.bbSize.x>W.bbSize.y?W.bbSize.x:W.bbSize.y;if(G=G>W.bbSize.z?G:W.bbSize.z,W.subDiv.max=W.partitioningSubdivisions,W.subDiv.X=Math.floor(W.subDiv.max*W.bbSize.x/G),W.subDiv.Y=Math.floor(W.subDiv.max*W.bbSize.y/G),W.subDiv.Z=Math.floor(W.subDiv.max*W.bbSize.z/G),W.subDiv.X=W.subDiv.X<1?1:W.subDiv.X,W.subDiv.Y=W.subDiv.Y<1?1:W.subDiv.Y,W.subDiv.Z=W.subDiv.Z<1?1:W.subDiv.Z,W.facetParameters.facetNormals=this.getFacetLocalNormals(),W.facetParameters.facetPositions=this.getFacetLocalPositions(),W.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),W.facetParameters.bInfo=_e,W.facetParameters.bbSize=W.bbSize,W.facetParameters.subDiv=W.subDiv,W.facetParameters.ratio=this.partitioningBBoxRatio,W.facetParameters.depthSort=W.facetDepthSort,W.facetDepthSort&&W.facetDepthSortEnabled&&(this.computeWorldMatrix(!0),this._worldMatrix.invertToRef(W.invertedMatrix),d.e.TransformCoordinatesToRef(W.facetDepthSortFrom,W.invertedMatrix,W.facetDepthSortOrigin),W.facetParameters.distanceTo=W.facetDepthSortOrigin),W.facetParameters.depthSortedFacets=W.depthSortedFacets,I.a.ComputeNormals(re,ne,ge,W.facetParameters),W.facetDepthSort&&W.facetDepthSortEnabled){W.depthSortedFacets.sort(W.facetDepthSortFunction);var $=W.depthSortedIndices.length/3|0;for(te=0;te<$;te++){var le=W.depthSortedFacets[te].ind;W.depthSortedIndices[3*te]=ne[le],W.depthSortedIndices[3*te+1]=ne[le+1],W.depthSortedIndices[3*te+2]=ne[le+2]}this.updateIndices(W.depthSortedIndices,void 0,!0)}return this},Y.prototype.getFacetLocalNormals=function(){var W=this._internalAbstractMeshDataInfo._facetData;return W.facetNormals||this.updateFacetData(),W.facetNormals},Y.prototype.getFacetLocalPositions=function(){var W=this._internalAbstractMeshDataInfo._facetData;return W.facetPositions||this.updateFacetData(),W.facetPositions},Y.prototype.getFacetLocalPartitioning=function(){var W=this._internalAbstractMeshDataInfo._facetData;return W.facetPartitioning||this.updateFacetData(),W.facetPartitioning},Y.prototype.getFacetPosition=function(W){var re=d.e.Zero();return this.getFacetPositionToRef(W,re),re},Y.prototype.getFacetPositionToRef=function(W,re){var ne=this.getFacetLocalPositions()[W],ge=this.getWorldMatrix();return d.e.TransformCoordinatesToRef(ne,ge,re),this},Y.prototype.getFacetNormal=function(W){var re=d.e.Zero();return this.getFacetNormalToRef(W,re),re},Y.prototype.getFacetNormalToRef=function(W,re){var ne=this.getFacetLocalNormals()[W];return d.e.TransformNormalToRef(ne,this.getWorldMatrix(),re),this},Y.prototype.getFacetsAtLocalCoordinates=function(W,re,ne){var ge=this.getBoundingInfo(),_e=this._internalAbstractMeshDataInfo._facetData,ce=Math.floor((W-ge.minimum.x*_e.partitioningBBoxRatio)*_e.subDiv.X*_e.partitioningBBoxRatio/_e.bbSize.x),ie=Math.floor((re-ge.minimum.y*_e.partitioningBBoxRatio)*_e.subDiv.Y*_e.partitioningBBoxRatio/_e.bbSize.y),Z=Math.floor((ne-ge.minimum.z*_e.partitioningBBoxRatio)*_e.subDiv.Z*_e.partitioningBBoxRatio/_e.bbSize.z);return ce<0||ce>_e.subDiv.max||ie<0||ie>_e.subDiv.max||Z<0||Z>_e.subDiv.max?null:_e.facetPartitioning[ce+_e.subDiv.max*ie+_e.subDiv.max*_e.subDiv.max*Z]},Y.prototype.getClosestFacetAtCoordinates=function(W,re,ne,ge,_e,ce){_e===void 0&&(_e=!1),ce===void 0&&(ce=!0);var ie=this.getWorldMatrix(),Z=d.c.Matrix[5];ie.invertToRef(Z);var te=d.c.Vector3[8];d.e.TransformCoordinatesFromFloatsToRef(W,re,ne,Z,te);var B=this.getClosestFacetAtLocalCoordinates(te.x,te.y,te.z,ge,_e,ce);return ge&&d.e.TransformCoordinatesFromFloatsToRef(ge.x,ge.y,ge.z,ie,ge),B},Y.prototype.getClosestFacetAtLocalCoordinates=function(W,re,ne,ge,_e,ce){_e===void 0&&(_e=!1),ce===void 0&&(ce=!0);var ie=null,Z=0,te=0,B=0,G=0,$=0,le=0,se=0,q=0,H=this.getFacetLocalPositions(),X=this.getFacetLocalNormals(),J=this.getFacetsAtLocalCoordinates(W,re,ne);if(!J)return null;for(var Q,ee,pe,Te=Number.MAX_VALUE,ve=Te,he=0;he<J.length;he++)ee=X[Q=J[he]],G=(W-(pe=H[Q]).x)*ee.x+(re-pe.y)*ee.y+(ne-pe.z)*ee.z,(!_e||_e&&ce&&G>=0||_e&&!ce&&G<=0)&&(G=ee.x*pe.x+ee.y*pe.y+ee.z*pe.z,$=-(ee.x*W+ee.y*re+ee.z*ne-G)/(ee.x*ee.x+ee.y*ee.y+ee.z*ee.z),(ve=(Z=(le=W+ee.x*$)-W)*Z+(te=(se=re+ee.y*$)-re)*te+(B=(q=ne+ee.z*$)-ne)*B)<Te&&(Te=ve,ie=Q,ge&&(ge.x=le,ge.y=se,ge.z=q)));return ie},Y.prototype.getFacetDataParameters=function(){return this._internalAbstractMeshDataInfo._facetData.facetParameters},Y.prototype.disableFacetData=function(){var W=this._internalAbstractMeshDataInfo._facetData;return W.facetDataEnabled&&(W.facetDataEnabled=!1,W.facetPositions=new Array,W.facetNormals=new Array,W.facetPartitioning=new Array,W.facetParameters=null,W.depthSortedIndices=new Uint32Array(0)),this},Y.prototype.updateIndices=function(W,re,ne){return this},Y.prototype.createNormals=function(W){var re,ne=this.getVerticesData(C.b.PositionKind),ge=this.getIndices();return re=this.isVerticesDataPresent(C.b.NormalKind)?this.getVerticesData(C.b.NormalKind):[],I.a.ComputeNormals(ne,ge,re,{useRightHandedSystem:this.getScene().useRightHandedSystem}),this.setVerticesData(C.b.NormalKind,re,W),this},Y.prototype.alignWithNormal=function(W,re){re||(re=R.a.Y);var ne=d.c.Vector3[0],ge=d.c.Vector3[1];return d.e.CrossToRef(re,W,ge),d.e.CrossToRef(W,ge,ne),this.rotationQuaternion?d.b.RotationQuaternionFromAxisToRef(ne,W,ge,this.rotationQuaternion):d.e.RotationFromAxisToRef(ne,W,ge,this.rotation),this},Y.prototype._checkOcclusionQuery=function(){return!1},Y.prototype.disableEdgesRendering=function(){throw T.a.WarnImport("EdgesRenderer")},Y.prototype.enableEdgesRendering=function(W,re,ne){throw T.a.WarnImport("EdgesRenderer")},Y.prototype.getConnectedParticleSystems=function(){var W=this;return this._scene.particleSystems.filter(function(re){return re.emitter===W})},Y.OCCLUSION_TYPE_NONE=0,Y.OCCLUSION_TYPE_OPTIMISTIC=1,Y.OCCLUSION_TYPE_STRICT=2,Y.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,Y.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,Y.CULLINGSTRATEGY_STANDARD=P.a.MESHES_CULLINGSTRATEGY_STANDARD,Y.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=P.a.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY,Y.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=P.a.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION,Y.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=P.a.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY,Y}(b.a);N.a.RegisteredTypes["BABYLON.AbstractMesh"]=L},function(h,s,c){c.d(s,"a",function(){return b});var E=c(8),m=c(44),S=c(0),d=c(31),M=c(7),C=c(50),I=c(23);M.a._PhysicsImpostorParser=function(p,x,P){return new b(x,P.physicsImpostor,{mass:P.physicsMass,friction:P.physicsFriction,restitution:P.physicsRestitution},p)};var b=function(){function p(x,P,A,T){var _=this;A===void 0&&(A={mass:0}),this.object=x,this.type=P,this._options=A,this._scene=T,this._pluginData={},this._bodyUpdateRequired=!1,this._onBeforePhysicsStepCallbacks=new Array,this._onAfterPhysicsStepCallbacks=new Array,this._onPhysicsCollideCallbacks=[],this._deltaPosition=S.e.Zero(),this._isDisposed=!1,this.soft=!1,this.segments=0,this._tmpQuat=new S.b,this._tmpQuat2=new S.b,this.beforeStep=function(){_._physicsEngine&&(_.object.translate(_._deltaPosition,-1),_._deltaRotationConjugated&&_.object.rotationQuaternion&&_.object.rotationQuaternion.multiplyToRef(_._deltaRotationConjugated,_.object.rotationQuaternion),_.object.computeWorldMatrix(!1),_.object.parent&&_.object.rotationQuaternion?(_.getParentsRotation(),_._tmpQuat.multiplyToRef(_.object.rotationQuaternion,_._tmpQuat)):_._tmpQuat.copyFrom(_.object.rotationQuaternion||new S.b),_._options.disableBidirectionalTransformation||_.object.rotationQuaternion&&_._physicsEngine.getPhysicsPlugin().setPhysicsBodyTransformation(_,_.object.getAbsolutePosition(),_._tmpQuat),_._onBeforePhysicsStepCallbacks.forEach(function(g){g(_)}))},this.afterStep=function(){_._physicsEngine&&(_._onAfterPhysicsStepCallbacks.forEach(function(g){g(_)}),_._physicsEngine.getPhysicsPlugin().setTransformationFromPhysicsBody(_),_.object.parent&&_.object.rotationQuaternion&&(_.getParentsRotation(),_._tmpQuat.conjugateInPlace(),_._tmpQuat.multiplyToRef(_.object.rotationQuaternion,_.object.rotationQuaternion)),_.object.setAbsolutePosition(_.object.position),_._deltaRotation&&_.object.rotationQuaternion&&_.object.rotationQuaternion.multiplyToRef(_._deltaRotation,_.object.rotationQuaternion),_.object.translate(_._deltaPosition,1))},this.onCollideEvent=null,this.onCollide=function(g){if((_._onPhysicsCollideCallbacks.length||_.onCollideEvent)&&_._physicsEngine){var O=_._physicsEngine.getImpostorWithPhysicsBody(g.body);O&&(_.onCollideEvent&&_.onCollideEvent(_,O),_._onPhysicsCollideCallbacks.filter(function(R){return R.otherImpostors.indexOf(O)!==-1}).forEach(function(R){R.callback(_,O,g.point)}))}},this.object?(this.object.parent&&A.mass!==0&&E.a.Warn("A physics impostor has been created for an object which has a parent. Babylon physics currently works in local space so unexpected issues may occur."),!this._scene&&x.getScene&&(this._scene=x.getScene()),this._scene&&(this.type>100&&(this.soft=!0),this._physicsEngine=this._scene.getPhysicsEngine(),this._physicsEngine?(this.object.rotationQuaternion||(this.object.rotation?this.object.rotationQuaternion=S.b.RotationYawPitchRoll(this.object.rotation.y,this.object.rotation.x,this.object.rotation.z):this.object.rotationQuaternion=new S.b),this._options.mass=A.mass===void 0?0:A.mass,this._options.friction=A.friction===void 0?.2:A.friction,this._options.restitution=A.restitution===void 0?.2:A.restitution,this.soft&&(this._options.mass=this._options.mass>0?this._options.mass:1,this._options.pressure=A.pressure===void 0?200:A.pressure,this._options.stiffness=A.stiffness===void 0?1:A.stiffness,this._options.velocityIterations=A.velocityIterations===void 0?20:A.velocityIterations,this._options.positionIterations=A.positionIterations===void 0?20:A.positionIterations,this._options.fixedPoints=A.fixedPoints===void 0?0:A.fixedPoints,this._options.margin=A.margin===void 0?0:A.margin,this._options.damping=A.damping===void 0?0:A.damping,this._options.path=A.path===void 0?null:A.path,this._options.shape=A.shape===void 0?null:A.shape),this._joints=[],!this.object.parent||this._options.ignoreParent?this._init():this.object.parent.physicsImpostor&&E.a.Warn("You must affect impostors to children before affecting impostor to parent.")):E.a.Error("Physics not enabled. Please use scene.enablePhysics(...) before creating impostors."))):E.a.Error("No object was provided. A physics object is obligatory")}return Object.defineProperty(p.prototype,"isDisposed",{get:function(){return this._isDisposed},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"mass",{get:function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getBodyMass(this):0},set:function(x){this.setMass(x)},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"friction",{get:function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getBodyFriction(this):0},set:function(x){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setBodyFriction(this,x)},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"restitution",{get:function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getBodyRestitution(this):0},set:function(x){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setBodyRestitution(this,x)},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"pressure",{get:function(){if(!this._physicsEngine)return 0;var x=this._physicsEngine.getPhysicsPlugin();return x.setBodyPressure?x.getBodyPressure(this):0},set:function(x){if(this._physicsEngine){var P=this._physicsEngine.getPhysicsPlugin();P.setBodyPressure&&P.setBodyPressure(this,x)}},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"stiffness",{get:function(){if(!this._physicsEngine)return 0;var x=this._physicsEngine.getPhysicsPlugin();return x.getBodyStiffness?x.getBodyStiffness(this):0},set:function(x){if(this._physicsEngine){var P=this._physicsEngine.getPhysicsPlugin();P.setBodyStiffness&&P.setBodyStiffness(this,x)}},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"velocityIterations",{get:function(){if(!this._physicsEngine)return 0;var x=this._physicsEngine.getPhysicsPlugin();return x.getBodyVelocityIterations?x.getBodyVelocityIterations(this):0},set:function(x){if(this._physicsEngine){var P=this._physicsEngine.getPhysicsPlugin();P.setBodyVelocityIterations&&P.setBodyVelocityIterations(this,x)}},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"positionIterations",{get:function(){if(!this._physicsEngine)return 0;var x=this._physicsEngine.getPhysicsPlugin();return x.getBodyPositionIterations?x.getBodyPositionIterations(this):0},set:function(x){if(this._physicsEngine){var P=this._physicsEngine.getPhysicsPlugin();P.setBodyPositionIterations&&P.setBodyPositionIterations(this,x)}},enumerable:!1,configurable:!0}),p.prototype._init=function(){this._physicsEngine&&(this._physicsEngine.removeImpostor(this),this.physicsBody=null,this._parent=this._parent||this._getPhysicsParent(),this._isDisposed||this.parent&&!this._options.ignoreParent||this._physicsEngine.addImpostor(this))},p.prototype._getPhysicsParent=function(){return this.object.parent instanceof d.a?this.object.parent.physicsImpostor:null},p.prototype.isBodyInitRequired=function(){return this._bodyUpdateRequired||!this._physicsBody&&!this._parent},p.prototype.setScalingUpdated=function(){this.forceUpdate()},p.prototype.forceUpdate=function(){this._init(),this.parent&&!this._options.ignoreParent&&this.parent.forceUpdate()},Object.defineProperty(p.prototype,"physicsBody",{get:function(){return this._parent&&!this._options.ignoreParent?this._parent.physicsBody:this._physicsBody},set:function(x){this._physicsBody&&this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().removePhysicsBody(this),this._physicsBody=x,this.resetUpdateFlags()},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"parent",{get:function(){return!this._options.ignoreParent&&this._parent?this._parent:null},set:function(x){this._parent=x},enumerable:!1,configurable:!0}),p.prototype.resetUpdateFlags=function(){this._bodyUpdateRequired=!1},p.prototype.getObjectExtendSize=function(){if(this.object.getBoundingInfo){var x=this.object.rotationQuaternion,P=this.object.scaling.clone();this.object.rotationQuaternion=p.IDENTITY_QUATERNION;var A=this.object.computeWorldMatrix&&this.object.computeWorldMatrix(!0);A&&A.decompose(P,void 0,void 0);var T=this.object.getBoundingInfo().boundingBox.extendSize.scale(2).multiplyInPlace(P);return this.object.rotationQuaternion=x,this.object.computeWorldMatrix&&this.object.computeWorldMatrix(!0),T}return p.DEFAULT_OBJECT_SIZE},p.prototype.getObjectCenter=function(){return this.object.getBoundingInfo?this.object.getBoundingInfo().boundingBox.centerWorld:this.object.position},p.prototype.getParam=function(x){return this._options[x]},p.prototype.setParam=function(x,P){this._options[x]=P,this._bodyUpdateRequired=!0},p.prototype.setMass=function(x){this.getParam("mass")!==x&&this.setParam("mass",x),this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setBodyMass(this,x)},p.prototype.getLinearVelocity=function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getLinearVelocity(this):S.e.Zero()},p.prototype.setLinearVelocity=function(x){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setLinearVelocity(this,x)},p.prototype.getAngularVelocity=function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getAngularVelocity(this):S.e.Zero()},p.prototype.setAngularVelocity=function(x){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setAngularVelocity(this,x)},p.prototype.executeNativeFunction=function(x){this._physicsEngine&&x(this._physicsEngine.getPhysicsPlugin().world,this.physicsBody)},p.prototype.registerBeforePhysicsStep=function(x){this._onBeforePhysicsStepCallbacks.push(x)},p.prototype.unregisterBeforePhysicsStep=function(x){var P=this._onBeforePhysicsStepCallbacks.indexOf(x);P>-1?this._onBeforePhysicsStepCallbacks.splice(P,1):E.a.Warn("Function to remove was not found")},p.prototype.registerAfterPhysicsStep=function(x){this._onAfterPhysicsStepCallbacks.push(x)},p.prototype.unregisterAfterPhysicsStep=function(x){var P=this._onAfterPhysicsStepCallbacks.indexOf(x);P>-1?this._onAfterPhysicsStepCallbacks.splice(P,1):E.a.Warn("Function to remove was not found")},p.prototype.registerOnPhysicsCollide=function(x,P){var A=x instanceof Array?x:[x];this._onPhysicsCollideCallbacks.push({callback:P,otherImpostors:A})},p.prototype.unregisterOnPhysicsCollide=function(x,P){var A=x instanceof Array?x:[x],T=-1;this._onPhysicsCollideCallbacks.some(function(_,g){if(_.callback===P&&_.otherImpostors.length===A.length){var O=_.otherImpostors.every(function(R){return A.indexOf(R)>-1});return O&&(T=g),O}return!1})?this._onPhysicsCollideCallbacks.splice(T,1):E.a.Warn("Function to remove was not found")},p.prototype.getParentsRotation=function(){var x=this.object.parent;for(this._tmpQuat.copyFromFloats(0,0,0,1);x;)x.rotationQuaternion?this._tmpQuat2.copyFrom(x.rotationQuaternion):S.b.RotationYawPitchRollToRef(x.rotation.y,x.rotation.x,x.rotation.z,this._tmpQuat2),this._tmpQuat.multiplyToRef(this._tmpQuat2,this._tmpQuat),x=x.parent;return this._tmpQuat},p.prototype.applyForce=function(x,P){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().applyForce(this,x,P),this},p.prototype.applyImpulse=function(x,P){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().applyImpulse(this,x,P),this},p.prototype.createJoint=function(x,P,A){var T=new C.e(P,A);return this.addJoint(x,T),this},p.prototype.addJoint=function(x,P){return this._joints.push({otherImpostor:x,joint:P}),this._physicsEngine&&this._physicsEngine.addJoint(this,x,P),this},p.prototype.addAnchor=function(x,P,A,T,_){if(!this._physicsEngine)return this;var g=this._physicsEngine.getPhysicsPlugin();return g.appendAnchor?(this._physicsEngine&&g.appendAnchor(this,x,P,A,T,_),this):this},p.prototype.addHook=function(x,P,A,T){if(!this._physicsEngine)return this;var _=this._physicsEngine.getPhysicsPlugin();return _.appendAnchor?(this._physicsEngine&&_.appendHook(this,x,P,A,T),this):this},p.prototype.sleep=function(){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().sleepBody(this),this},p.prototype.wakeUp=function(){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().wakeUpBody(this),this},p.prototype.clone=function(x){return x?new p(x,this.type,this._options,this._scene):null},p.prototype.dispose=function(){var x=this;this._physicsEngine&&(this._joints.forEach(function(P){x._physicsEngine&&x._physicsEngine.removeJoint(x,P.otherImpostor,P.joint)}),this._physicsEngine.removeImpostor(this),this.parent&&this.parent.forceUpdate(),this._isDisposed=!0)},p.prototype.setDeltaPosition=function(x){this._deltaPosition.copyFrom(x)},p.prototype.setDeltaRotation=function(x){this._deltaRotation||(this._deltaRotation=new S.b),this._deltaRotation.copyFrom(x),this._deltaRotationConjugated=this._deltaRotation.conjugate()},p.prototype.getBoxSizeToRef=function(x){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().getBoxSizeToRef(this,x),this},p.prototype.getRadius=function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getRadius(this):0},p.prototype.syncBoneWithImpostor=function(x,P,A,T,_){var g=p._tmpVecs[0],O=this.object;if(O.rotationQuaternion)if(_){var R=p._tmpQuat;O.rotationQuaternion.multiplyToRef(_,R),x.setRotationQuaternion(R,I.c.WORLD,P)}else x.setRotationQuaternion(O.rotationQuaternion,I.c.WORLD,P);g.x=0,g.y=0,g.z=0,A&&(g.x=A.x,g.y=A.y,g.z=A.z,x.getDirectionToRef(g,P,g),T==null&&(T=A.length()),g.x*=T,g.y*=T,g.z*=T),x.getParent()?(g.addInPlace(O.getAbsolutePosition()),x.setAbsolutePosition(g,P)):(P.setAbsolutePosition(O.getAbsolutePosition()),P.position.x-=g.x,P.position.y-=g.y,P.position.z-=g.z)},p.prototype.syncImpostorWithBone=function(x,P,A,T,_,g){var O=this.object;if(O.rotationQuaternion)if(_){var R=p._tmpQuat;x.getRotationQuaternionToRef(I.c.WORLD,P,R),R.multiplyToRef(_,O.rotationQuaternion)}else x.getRotationQuaternionToRef(I.c.WORLD,P,O.rotationQuaternion);var N=p._tmpVecs[0],V=p._tmpVecs[1];g||((g=p._tmpVecs[2]).x=0,g.y=1,g.z=0),x.getDirectionToRef(g,P,V),x.getAbsolutePositionToRef(P,N),T==null&&A&&(T=A.length()),T!=null&&(N.x+=V.x*T,N.y+=V.y*T,N.z+=V.z*T),O.setAbsolutePosition(N)},p.DEFAULT_OBJECT_SIZE=new S.e(1,1,1),p.IDENTITY_QUATERNION=S.b.Identity(),p._tmpVecs=m.a.BuildArray(3,S.e.Zero),p._tmpQuat=S.b.Identity(),p.NoImpostor=0,p.SphereImpostor=1,p.BoxImpostor=2,p.PlaneImpostor=3,p.MeshImpostor=4,p.CapsuleImpostor=6,p.CylinderImpostor=7,p.ParticleImpostor=8,p.HeightmapImpostor=9,p.ConvexHullImpostor=10,p.CustomImpostor=100,p.RopeImpostor=101,p.ClothImpostor=102,p.SoftbodyImpostor=103,p}()},function(h,s,c){c.d(s,"a",function(){return m}),c.d(s,"b",function(){return S});var E=c(1),m=function(){function d(M){this.length=0,this.data=new Array(M),this._id=d._GlobalId++}return d.prototype.push=function(M){this.data[this.length++]=M,this.length>this.data.length&&(this.data.length*=2)},d.prototype.forEach=function(M){for(var C=0;C<this.length;C++)M(this.data[C])},d.prototype.sort=function(M){this.data.sort(M)},d.prototype.reset=function(){this.length=0},d.prototype.dispose=function(){this.reset(),this.data&&(this.data.length=0,this.data=[])},d.prototype.concat=function(M){if(M.length!==0){this.length+M.length>this.data.length&&(this.data.length=2*(this.length+M.length));for(var C=0;C<M.length;C++)this.data[this.length++]=(M.data||M)[C]}},d.prototype.indexOf=function(M){var C=this.data.indexOf(M);return C>=this.length?-1:C},d.prototype.contains=function(M){return this.indexOf(M)!==-1},d._GlobalId=0,d}(),S=function(d){function M(){var C=d!==null&&d.apply(this,arguments)||this;return C._duplicateId=0,C}return Object(E.d)(M,d),M.prototype.push=function(C){d.prototype.push.call(this,C),C.__smartArrayFlags||(C.__smartArrayFlags={}),C.__smartArrayFlags[this._id]=this._duplicateId},M.prototype.pushNoDuplicate=function(C){return(!C.__smartArrayFlags||C.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(C),!0)},M.prototype.reset=function(){d.prototype.reset.call(this),this._duplicateId++},M.prototype.concatWithNoDuplicate=function(C){if(C.length!==0){this.length+C.length>this.data.length&&(this.data.length=2*(this.length+C.length));for(var I=0;I<C.length;I++){var b=(C.data||C)[I];this.pushNoDuplicate(b)}}},M}(m)},function(h,s,c){c.d(s,"a",function(){return E});var E=function(){function m(){}return m.EndsWith=function(S,d){return S.indexOf(d,S.length-d.length)!==-1},m.StartsWith=function(S,d){return!!S&&S.indexOf(d)===0},m.Decode=function(S){if(typeof TextDecoder!="undefined")return new TextDecoder().decode(S);for(var d="",M=0;M<S.byteLength;M++)d+=String.fromCharCode(S[M]);return d},m.EncodeArrayBufferToBase64=function(S){for(var d,M,C,I,b,p,x,P="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",A="",T=0,_=ArrayBuffer.isView(S)?new Uint8Array(S.buffer,S.byteOffset,S.byteLength):new Uint8Array(S);T<_.length;)I=(d=_[T++])>>2,b=(3&d)<<4|(M=T<_.length?_[T++]:Number.NaN)>>4,p=(15&M)<<2|(C=T<_.length?_[T++]:Number.NaN)>>6,x=63&C,isNaN(M)?p=x=64:isNaN(C)&&(x=64),A+=P.charAt(I)+P.charAt(b)+P.charAt(p)+P.charAt(x);return A},m.PadNumber=function(S,d){for(var M=String(S);M.length<d;)M="0"+M;return M},m}()},function(h,s,c){c.d(s,"a",function(){return E});var E=function(){function m(){this.rootNodes=new Array,this.cameras=new Array,this.lights=new Array,this.meshes=new Array,this.skeletons=new Array,this.particleSystems=new Array,this.animations=[],this.animationGroups=new Array,this.multiMaterials=new Array,this.materials=new Array,this.morphTargetManagers=new Array,this.geometries=new Array,this.transformNodes=new Array,this.actionManagers=new Array,this.textures=new Array,this._environmentTexture=null,this.postProcesses=new Array}return m.AddParser=function(S,d){this._BabylonFileParsers[S]=d},m.GetParser=function(S){return this._BabylonFileParsers[S]?this._BabylonFileParsers[S]:null},m.AddIndividualParser=function(S,d){this._IndividualBabylonFileParsers[S]=d},m.GetIndividualParser=function(S){return this._IndividualBabylonFileParsers[S]?this._IndividualBabylonFileParsers[S]:null},m.Parse=function(S,d,M,C){for(var I in this._BabylonFileParsers)this._BabylonFileParsers.hasOwnProperty(I)&&this._BabylonFileParsers[I](S,d,M,C)},Object.defineProperty(m.prototype,"environmentTexture",{get:function(){return this._environmentTexture},set:function(S){this._environmentTexture=S},enumerable:!1,configurable:!0}),m.prototype.getNodes=function(){var S=new Array;return S=(S=(S=(S=S.concat(this.meshes)).concat(this.lights)).concat(this.cameras)).concat(this.transformNodes),this.skeletons.forEach(function(d){return S=S.concat(d.bones)}),S},m._BabylonFileParsers={},m._IndividualBabylonFileParsers={},m}()},function(h,s,c){c.d(s,"a",function(){return b});var E=c(20),m=c(6),S=c(18),d=c(22),M=c(86),C=c(0),I=c(9),b=function(){function p(x,P){var A=this;P===void 0&&(P=!0),this.originalScene=x,this._pointerCaptures={},this._lastPointerEvents={},this._sharedGizmoLight=null,this._renderCamera=null,this.pickUtilitySceneFirst=!0,this.shouldRender=!0,this.onlyCheckPointerDownEvents=!0,this.processAllEvents=!1,this.onPointerOutObservable=new m.c,this.utilityLayerScene=new E.a(x.getEngine(),{virtual:!0}),this.utilityLayerScene.useRightHandedSystem=x.useRightHandedSystem,this.utilityLayerScene._allowPostProcessClearColor=!1,this.utilityLayerScene.detachControl(),P&&(this._originalPointerObserver=x.onPrePointerObservable.add(function(T,_){if(A.utilityLayerScene.activeCamera&&(A.processAllEvents||T.type===S.a.POINTERMOVE||T.type===S.a.POINTERUP||T.type===S.a.POINTERDOWN||T.type===S.a.POINTERDOUBLETAP)){A.utilityLayerScene.pointerX=x.pointerX,A.utilityLayerScene.pointerY=x.pointerY;var g=T.event;if(x.isPointerCaptured(g.pointerId))A._pointerCaptures[g.pointerId]=!1;else{var O=T.ray?A.utilityLayerScene.pickWithRay(T.ray):A.utilityLayerScene.pick(x.pointerX,x.pointerY);if(!T.ray&&O&&(T.ray=O.ray),A.utilityLayerScene.onPrePointerObservable.notifyObservers(T),A.onlyCheckPointerDownEvents&&T.type!=S.a.POINTERDOWN)return T.skipOnPointerObservable||A.utilityLayerScene.onPointerObservable.notifyObservers(new S.b(T.type,T.event,O),T.type),void(T.type===S.a.POINTERUP&&A._pointerCaptures[g.pointerId]&&(A._pointerCaptures[g.pointerId]=!1));if(A.utilityLayerScene.autoClearDepthAndStencil||A.pickUtilitySceneFirst)O&&O.hit&&(T.skipOnPointerObservable||A.utilityLayerScene.onPointerObservable.notifyObservers(new S.b(T.type,T.event,O),T.type),T.skipOnPointerObservable=!0);else{var R=T.ray?x.pickWithRay(T.ray):x.pick(x.pointerX,x.pointerY),N=T.event;R&&O&&(O.distance===0&&R.pickedMesh?A.mainSceneTrackerPredicate&&A.mainSceneTrackerPredicate(R.pickedMesh)?(A._notifyObservers(T,R,N),T.skipOnPointerObservable=!0):T.type===S.a.POINTERDOWN?A._pointerCaptures[N.pointerId]=!0:A._lastPointerEvents[N.pointerId]&&(A.onPointerOutObservable.notifyObservers(N.pointerId),delete A._lastPointerEvents[N.pointerId]):!A._pointerCaptures[N.pointerId]&&(O.distance<R.distance||R.distance===0)?(A._notifyObservers(T,O,N),T.skipOnPointerObservable||(T.skipOnPointerObservable=O.distance>0)):!A._pointerCaptures[N.pointerId]&&O.distance>R.distance&&(A.mainSceneTrackerPredicate&&A.mainSceneTrackerPredicate(R.pickedMesh)?(A._notifyObservers(T,R,N),T.skipOnPointerObservable=!0):A._lastPointerEvents[N.pointerId]&&(A.onPointerOutObservable.notifyObservers(N.pointerId),delete A._lastPointerEvents[N.pointerId])),T.type===S.a.POINTERUP&&A._pointerCaptures[N.pointerId]&&(A._pointerCaptures[N.pointerId]=!1))}}}}),this._originalPointerObserver&&x.onPrePointerObservable.makeObserverTopPriority(this._originalPointerObserver)),this.utilityLayerScene.autoClear=!1,this._afterRenderObserver=this.originalScene.onAfterCameraRenderObservable.add(function(T){A.shouldRender&&T==A.getRenderCamera()&&A.render()}),this._sceneDisposeObserver=this.originalScene.onDisposeObservable.add(function(){A.dispose()}),this._updateCamera()}return p.prototype.getRenderCamera=function(x){if(this._renderCamera)return this._renderCamera;var P=void 0;return P=this.originalScene.activeCameras&&this.originalScene.activeCameras.length>1?this.originalScene.activeCameras[this.originalScene.activeCameras.length-1]:this.originalScene.activeCamera,x&&P&&P.isRigCamera?P.rigParent:P},p.prototype.setRenderCamera=function(x){this._renderCamera=x},p.prototype._getSharedGizmoLight=function(){return this._sharedGizmoLight||(this._sharedGizmoLight=new M.a("shared gizmo light",new C.e(0,1,0),this.utilityLayerScene),this._sharedGizmoLight.intensity=2,this._sharedGizmoLight.groundColor=I.a.Gray()),this._sharedGizmoLight},Object.defineProperty(p,"DefaultUtilityLayer",{get:function(){return p._DefaultUtilityLayer==null&&(p._DefaultUtilityLayer=new p(d.a.LastCreatedScene),p._DefaultUtilityLayer.originalScene.onDisposeObservable.addOnce(function(){p._DefaultUtilityLayer=null})),p._DefaultUtilityLayer},enumerable:!1,configurable:!0}),Object.defineProperty(p,"DefaultKeepDepthUtilityLayer",{get:function(){return p._DefaultKeepDepthUtilityLayer==null&&(p._DefaultKeepDepthUtilityLayer=new p(d.a.LastCreatedScene),p._DefaultKeepDepthUtilityLayer.utilityLayerScene.autoClearDepthAndStencil=!1,p._DefaultKeepDepthUtilityLayer.originalScene.onDisposeObservable.addOnce(function(){p._DefaultKeepDepthUtilityLayer=null})),p._DefaultKeepDepthUtilityLayer},enumerable:!1,configurable:!0}),p.prototype._notifyObservers=function(x,P,A){x.skipOnPointerObservable||(this.utilityLayerScene.onPointerObservable.notifyObservers(new S.b(x.type,x.event,P),x.type),this._lastPointerEvents[A.pointerId]=!0)},p.prototype.render=function(){if(this._updateCamera(),this.utilityLayerScene.activeCamera){var x=this.utilityLayerScene.activeCamera.getScene(),P=this.utilityLayerScene.activeCamera;P._scene=this.utilityLayerScene,P.leftCamera&&(P.leftCamera._scene=this.utilityLayerScene),P.rightCamera&&(P.rightCamera._scene=this.utilityLayerScene),this.utilityLayerScene.render(!1),P._scene=x,P.leftCamera&&(P.leftCamera._scene=x),P.rightCamera&&(P.rightCamera._scene=x)}},p.prototype.dispose=function(){this.onPointerOutObservable.clear(),this._afterRenderObserver&&this.originalScene.onAfterCameraRenderObservable.remove(this._afterRenderObserver),this._sceneDisposeObserver&&this.originalScene.onDisposeObservable.remove(this._sceneDisposeObserver),this._originalPointerObserver&&this.originalScene.onPrePointerObservable.remove(this._originalPointerObserver),this.utilityLayerScene.dispose()},p.prototype._updateCamera=function(){this.utilityLayerScene.cameraToUseForPointers=this.getRenderCamera(),this.utilityLayerScene.activeCamera=this.getRenderCamera()},p._DefaultUtilityLayer=null,p._DefaultKeepDepthUtilityLayer=null,p}()},function(h,s,c){c.d(s,"a",function(){return m});var E=c(139),m=function(){function S(){}return S.EnableFor=function(d){d._tags=d._tags||{},d.hasTags=function(){return S.HasTags(d)},d.addTags=function(M){return S.AddTagsTo(d,M)},d.removeTags=function(M){return S.RemoveTagsFrom(d,M)},d.matchesTagsQuery=function(M){return S.MatchesQuery(d,M)}},S.DisableFor=function(d){delete d._tags,delete d.hasTags,delete d.addTags,delete d.removeTags,delete d.matchesTagsQuery},S.HasTags=function(d){if(!d._tags)return!1;var M=d._tags;for(var C in M)if(M.hasOwnProperty(C))return!0;return!1},S.GetTags=function(d,M){if(M===void 0&&(M=!0),!d._tags)return null;if(M){var C=[];for(var I in d._tags)d._tags.hasOwnProperty(I)&&d._tags[I]===!0&&C.push(I);return C.join(" ")}return d._tags},S.AddTagsTo=function(d,M){M&&typeof M=="string"&&M.split(" ").forEach(function(C,I,b){S._AddTagTo(d,C)})},S._AddTagTo=function(d,M){(M=M.trim())!==""&&M!=="true"&&M!=="false"&&(M.match(/[\s]/)||M.match(/^([!]|([|]|[&]){2})/)||(S.EnableFor(d),d._tags[M]=!0))},S.RemoveTagsFrom=function(d,M){if(S.HasTags(d)){var C=M.split(" ");for(var I in C)S._RemoveTagFrom(d,C[I])}},S._RemoveTagFrom=function(d,M){delete d._tags[M]},S.MatchesQuery=function(d,M){return M===void 0||(M===""?S.HasTags(d):E.a.Eval(M,function(C){return S.HasTags(d)&&d._tags[C]}))},S}()},function(h,s,c){c.d(s,"a",function(){return E});var E=function(){function m(){}return m.IsWindowObjectExist=function(){return typeof window!="undefined"},m.IsNavigatorAvailable=function(){return typeof navigator!="undefined"},m.IsDocumentAvailable=function(){return typeof document!="undefined"},m.GetDOMTextContent=function(S){for(var d="",M=S.firstChild;M;)M.nodeType===3&&(d+=M.textContent),M=M.nextSibling;return d},m}()},function(h,s,c){c.d(s,"a",function(){return I});var E=c(44),m=c(0),S=c(54),d=c(114),M=c(20),C=c(24),I=function(){function b(p,x,P){P===void 0&&(P=Number.MAX_VALUE),this.origin=p,this.direction=x,this.length=P}return b.prototype.intersectsBoxMinMax=function(p,x,P){P===void 0&&(P=0);var A,T,_,g,O=b._TmpVector3[0].copyFromFloats(p.x-P,p.y-P,p.z-P),R=b._TmpVector3[1].copyFromFloats(x.x+P,x.y+P,x.z+P),N=0,V=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<O.x||this.origin.x>R.x)return!1}else if(A=1/this.direction.x,T=(O.x-this.origin.x)*A,(_=(R.x-this.origin.x)*A)==-1/0&&(_=1/0),T>_&&(g=T,T=_,_=g),(N=Math.max(T,N))>(V=Math.min(_,V)))return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<O.y||this.origin.y>R.y)return!1}else if(A=1/this.direction.y,T=(O.y-this.origin.y)*A,(_=(R.y-this.origin.y)*A)==-1/0&&(_=1/0),T>_&&(g=T,T=_,_=g),(N=Math.max(T,N))>(V=Math.min(_,V)))return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<O.z||this.origin.z>R.z)return!1}else if(A=1/this.direction.z,T=(O.z-this.origin.z)*A,(_=(R.z-this.origin.z)*A)==-1/0&&(_=1/0),T>_&&(g=T,T=_,_=g),(N=Math.max(T,N))>(V=Math.min(_,V)))return!1;return!0},b.prototype.intersectsBox=function(p,x){return x===void 0&&(x=0),this.intersectsBoxMinMax(p.minimum,p.maximum,x)},b.prototype.intersectsSphere=function(p,x){x===void 0&&(x=0);var P=p.center.x-this.origin.x,A=p.center.y-this.origin.y,T=p.center.z-this.origin.z,_=P*P+A*A+T*T,g=p.radius+x,O=g*g;if(_<=O)return!0;var R=P*this.direction.x+A*this.direction.y+T*this.direction.z;return!(R<0)&&_-R*R<=O},b.prototype.intersectsTriangle=function(p,x,P){var A=b._TmpVector3[0],T=b._TmpVector3[1],_=b._TmpVector3[2],g=b._TmpVector3[3],O=b._TmpVector3[4];x.subtractToRef(p,A),P.subtractToRef(p,T),m.e.CrossToRef(this.direction,T,_);var R=m.e.Dot(A,_);if(R===0)return null;var N=1/R;this.origin.subtractToRef(p,g);var V=m.e.Dot(g,_)*N;if(V<0||V>1)return null;m.e.CrossToRef(g,A,O);var U=m.e.Dot(this.direction,O)*N;if(U<0||V+U>1)return null;var L=m.e.Dot(T,O)*N;return L>this.length?null:new d.a(1-V-U,V,L)},b.prototype.intersectsPlane=function(p){var x,P=m.e.Dot(p.normal,this.direction);if(Math.abs(P)<999999997475243e-21)return null;var A=m.e.Dot(p.normal,this.origin);return(x=(-p.d-A)/P)<0?x<-999999997475243e-21?null:0:x},b.prototype.intersectsAxis=function(p,x){switch(x===void 0&&(x=0),p){case"y":return(P=(this.origin.y-x)/this.direction.y)>0?null:new m.e(this.origin.x+this.direction.x*-P,x,this.origin.z+this.direction.z*-P);case"x":return(P=(this.origin.x-x)/this.direction.x)>0?null:new m.e(x,this.origin.y+this.direction.y*-P,this.origin.z+this.direction.z*-P);case"z":var P;return(P=(this.origin.z-x)/this.direction.z)>0?null:new m.e(this.origin.x+this.direction.x*-P,this.origin.y+this.direction.y*-P,x);default:return null}},b.prototype.intersectsMesh=function(p,x){var P=m.c.Matrix[0];return p.getWorldMatrix().invertToRef(P),this._tmpRay?b.TransformToRef(this,P,this._tmpRay):this._tmpRay=b.Transform(this,P),p.intersects(this._tmpRay,x)},b.prototype.intersectsMeshes=function(p,x,P){P?P.length=0:P=[];for(var A=0;A<p.length;A++){var T=this.intersectsMesh(p[A],x);T.hit&&P.push(T)}return P.sort(this._comparePickingInfo),P},b.prototype._comparePickingInfo=function(p,x){return p.distance<x.distance?-1:p.distance>x.distance?1:0},b.prototype.intersectionSegment=function(p,x,P){var A=this.origin,T=m.c.Vector3[0],_=m.c.Vector3[1],g=m.c.Vector3[2],O=m.c.Vector3[3];x.subtractToRef(p,T),this.direction.scaleToRef(b.rayl,g),A.addToRef(g,_),p.subtractToRef(A,O);var R,N,V,U,L=m.e.Dot(T,T),j=m.e.Dot(T,g),Y=m.e.Dot(g,g),W=m.e.Dot(T,O),re=m.e.Dot(g,O),ne=L*Y-j*j,ge=ne,_e=ne;ne<b.smallnum?(N=0,ge=1,U=re,_e=Y):(U=L*re-j*W,(N=j*re-Y*W)<0?(N=0,U=re,_e=Y):N>ge&&(N=ge,U=re+j,_e=Y)),U<0?(U=0,-W<0?N=0:-W>L?N=ge:(N=-W,ge=L)):U>_e&&(U=_e,-W+j<0?N=0:-W+j>L?N=ge:(N=-W+j,ge=L)),R=Math.abs(N)<b.smallnum?0:N/ge,V=Math.abs(U)<b.smallnum?0:U/_e;var ce=m.c.Vector3[4];g.scaleToRef(V,ce);var ie=m.c.Vector3[5];T.scaleToRef(R,ie),ie.addInPlace(O);var Z=m.c.Vector3[6];return ie.subtractToRef(ce,Z),V>0&&V<=this.length&&Z.lengthSquared()<P*P?ie.length():-1},b.prototype.update=function(p,x,P,A,T,_,g){return this.unprojectRayToRef(p,x,P,A,T,_,g),this},b.Zero=function(){return new b(m.e.Zero(),m.e.Zero())},b.CreateNew=function(p,x,P,A,T,_,g){return b.Zero().update(p,x,P,A,T,_,g)},b.CreateNewFromTo=function(p,x,P){P===void 0&&(P=m.a.IdentityReadOnly);var A=x.subtract(p),T=Math.sqrt(A.x*A.x+A.y*A.y+A.z*A.z);return A.normalize(),b.Transform(new b(p,A,T),P)},b.Transform=function(p,x){var P=new b(new m.e(0,0,0),new m.e(0,0,0));return b.TransformToRef(p,x,P),P},b.TransformToRef=function(p,x,P){m.e.TransformCoordinatesToRef(p.origin,x,P.origin),m.e.TransformNormalToRef(p.direction,x,P.direction),P.length=p.length;var A=P.direction,T=A.length();if(T!==0&&T!==1){var _=1/T;A.x*=_,A.y*=_,A.z*=_,P.length*=T}},b.prototype.unprojectRayToRef=function(p,x,P,A,T,_,g){var O=m.c.Matrix[0];T.multiplyToRef(_,O),O.multiplyToRef(g,O),O.invert();var R=m.c.Vector3[0];R.x=p/P*2-1,R.y=-(x/A*2-1),R.z=-1;var N=m.c.Vector3[1].copyFromFloats(R.x,R.y,1),V=m.c.Vector3[2],U=m.c.Vector3[3];m.e._UnprojectFromInvertedMatrixToRef(R,O,V),m.e._UnprojectFromInvertedMatrixToRef(N,O,U),this.origin.copyFrom(V),U.subtractToRef(V,this.direction),this.direction.normalize()},b._TmpVector3=E.a.BuildArray(6,m.e.Zero),b.smallnum=1e-8,b.rayl=1e9,b}();M.a.prototype.createPickingRay=function(b,p,x,P,A){A===void 0&&(A=!1);var T=I.Zero();return this.createPickingRayToRef(b,p,x,T,P,A),T},M.a.prototype.createPickingRayToRef=function(b,p,x,P,A,T){T===void 0&&(T=!1);var _=this.getEngine();if(!A){if(!this.activeCamera)return this;A=this.activeCamera}var g=A.viewport.toGlobal(_.getRenderWidth(),_.getRenderHeight());return b=b/_.getHardwareScalingLevel()-g.x,p=p/_.getHardwareScalingLevel()-(_.getRenderHeight()-g.y-g.height),P.update(b,p,g.width,g.height,x||m.a.IdentityReadOnly,T?m.a.IdentityReadOnly:A.getViewMatrix(),A.getProjectionMatrix()),this},M.a.prototype.createPickingRayInCameraSpace=function(b,p,x){var P=I.Zero();return this.createPickingRayInCameraSpaceToRef(b,p,P,x),P},M.a.prototype.createPickingRayInCameraSpaceToRef=function(b,p,x,P){if(!S.a)return this;var A=this.getEngine();if(!P){if(!this.activeCamera)throw new Error("Active camera not set");P=this.activeCamera}var T=P.viewport.toGlobal(A.getRenderWidth(),A.getRenderHeight()),_=m.a.Identity();return b=b/A.getHardwareScalingLevel()-T.x,p=p/A.getHardwareScalingLevel()-(A.getRenderHeight()-T.y-T.height),x.update(b,p,T.width,T.height,_,_,P.getProjectionMatrix()),this},M.a.prototype._internalPickForMesh=function(b,p,x,P,A,T,_,g){var O=p(P),R=x.intersects(O,A,_,T,P,g);return R&&R.hit?!A&&b!=null&&R.distance>=b.distance?null:R:null},M.a.prototype._internalPick=function(b,p,x,P,A){if(!S.a)return null;for(var T=null,_=0;_<this.meshes.length;_++){var g=this.meshes[_];if(p){if(!p(g))continue}else if(!g.isEnabled()||!g.isVisible||!g.isPickable)continue;var O,R=g.skeleton&&g.skeleton.overrideMesh?g.skeleton.overrideMesh.getWorldMatrix():g.getWorldMatrix();if(g.hasThinInstances&&g.thinInstanceEnablePicking){if(O=this._internalPickForMesh(T,b,g,R,!0,!0,A)){if(P)return T;for(var N=m.c.Matrix[1],V=g.thinInstanceGetWorldMatrices(),U=0;U<V.length;U++){V[U].multiplyToRef(R,N);var L=this._internalPickForMesh(T,b,g,N,x,P,A,!0);if(L&&((T=L).thinInstanceIndex=U,x))return T}}}else if((O=this._internalPickForMesh(T,b,g,R,x,P,A))&&(T=O,x))return T}return T||new S.a},M.a.prototype._internalMultiPick=function(b,p,x){if(!S.a)return null;for(var P=new Array,A=0;A<this.meshes.length;A++){var T=this.meshes[A];if(p){if(!p(T))continue}else if(!T.isEnabled()||!T.isVisible||!T.isPickable)continue;var _,g=T.skeleton&&T.skeleton.overrideMesh?T.skeleton.overrideMesh.getWorldMatrix():T.getWorldMatrix();if(T.hasThinInstances&&T.thinInstanceEnablePicking){if(_=this._internalPickForMesh(null,b,T,g,!0,!0,x))for(var O=m.c.Matrix[1],R=T.thinInstanceGetWorldMatrices(),N=0;N<R.length;N++){R[N].multiplyToRef(g,O);var V=this._internalPickForMesh(null,b,T,O,!1,!1,x,!0);V&&(V.thinInstanceIndex=N,P.push(V))}}else(_=this._internalPickForMesh(null,b,T,g,!1,!1,x))&&P.push(_)}return P},M.a.prototype.pickWithBoundingInfo=function(b,p,x,P,A){var T=this;if(!S.a)return null;var _=this._internalPick(function(g){return T._tempPickingRay||(T._tempPickingRay=I.Zero()),T.createPickingRayToRef(b,p,g,T._tempPickingRay,A||null),T._tempPickingRay},x,P,!0);return _&&(_.ray=this.createPickingRay(b,p,m.a.Identity(),A||null)),_},M.a.prototype.pick=function(b,p,x,P,A,T){var _=this;if(!S.a)return null;var g=this._internalPick(function(O){return _._tempPickingRay||(_._tempPickingRay=I.Zero()),_.createPickingRayToRef(b,p,O,_._tempPickingRay,A||null),_._tempPickingRay},x,P,!1,T);return g&&(g.ray=this.createPickingRay(b,p,m.a.Identity(),A||null)),g},M.a.prototype.pickWithRay=function(b,p,x,P){var A=this,T=this._internalPick(function(_){return A._pickWithRayInverseMatrix||(A._pickWithRayInverseMatrix=m.a.Identity()),_.invertToRef(A._pickWithRayInverseMatrix),A._cachedRayForTransform||(A._cachedRayForTransform=I.Zero()),I.TransformToRef(b,A._pickWithRayInverseMatrix,A._cachedRayForTransform),A._cachedRayForTransform},p,x,!1,P);return T&&(T.ray=b),T},M.a.prototype.multiPick=function(b,p,x,P,A){var T=this;return this._internalMultiPick(function(_){return T.createPickingRay(b,p,_,P||null)},x,A)},M.a.prototype.multiPickWithRay=function(b,p,x){var P=this;return this._internalMultiPick(function(A){return P._pickWithRayInverseMatrix||(P._pickWithRayInverseMatrix=m.a.Identity()),A.invertToRef(P._pickWithRayInverseMatrix),P._cachedRayForTransform||(P._cachedRayForTransform=I.Zero()),I.TransformToRef(b,P._pickWithRayInverseMatrix,P._cachedRayForTransform),P._cachedRayForTransform},p,x)},C.a.prototype.getForwardRay=function(b,p,x){return b===void 0&&(b=100),this.getForwardRayToRef(new I(m.e.Zero(),m.e.Zero(),b),b,p,x)},C.a.prototype.getForwardRayToRef=function(b,p,x,P){return p===void 0&&(p=100),x||(x=this.getWorldMatrix()),b.length=p,P?b.origin.copyFrom(P):b.origin.copyFrom(this.position),m.c.Vector3[2].set(0,0,this._scene.useRightHandedSystem?-1:1),m.e.TransformNormalToRef(m.c.Vector3[2],x,m.c.Vector3[3]),m.e.NormalizeToRef(m.c.Vector3[3],b.direction),b}},function(h,s,c){c.d(s,"a",function(){return C});var E=c(0),m=c(7),S=c(16),d=c(98),M=c(4);S.a.CreateLineSystem=function(I){for(var b=[],p=[],x=I.lines,P=I.colors,A=[],T=0,_=0;_<x.length;_++)for(var g=x[_],O=0;O<g.length;O++){if(p.push(g[O].x,g[O].y,g[O].z),P){var R=P[_];A.push(R[O].r,R[O].g,R[O].b,R[O].a)}O>0&&(b.push(T-1),b.push(T)),T++}var N=new S.a;return N.indices=b,N.positions=p,P&&(N.colors=A),N},S.a.CreateDashedLines=function(I){var b,p,x=I.dashSize||3,P=I.gapSize||1,A=I.dashNb||200,T=I.points,_=new Array,g=new Array,O=E.e.Zero(),R=0,N=0,V=0,U=0,L=0;for(L=0;L<T.length-1;L++)T[L+1].subtractToRef(T[L],O),R+=O.length();for(p=x*(b=R/A)/(x+P),L=0;L<T.length-1;L++){T[L+1].subtractToRef(T[L],O),N=Math.floor(O.length()/b),O.normalize();for(var j=0;j<N;j++)V=b*j,_.push(T[L].x+V*O.x,T[L].y+V*O.y,T[L].z+V*O.z),_.push(T[L].x+(V+p)*O.x,T[L].y+(V+p)*O.y,T[L].z+(V+p)*O.z),g.push(U,U+1),U+=2}var Y=new S.a;return Y.positions=_,Y.indices=g,Y},m.a.CreateLines=function(I,b,p,x,P){p===void 0&&(p=null),x===void 0&&(x=!1),P===void 0&&(P=null);var A={points:b,updatable:x,instance:P};return C.CreateLines(I,A,p)},m.a.CreateDashedLines=function(I,b,p,x,P,A,T,_){A===void 0&&(A=null);var g={points:b,dashSize:p,gapSize:x,dashNb:P,updatable:T,instance:_};return C.CreateDashedLines(I,g,A)};var C=function(){function I(){}return I.CreateLineSystem=function(b,p,x){var P=p.instance,A=p.lines,T=p.colors;if(P){var _,g,O=P.getVerticesData(M.b.PositionKind);T&&(_=P.getVerticesData(M.b.ColorKind));for(var R=0,N=0,V=0;V<A.length;V++)for(var U=A[V],L=0;L<U.length;L++)O[R]=U[L].x,O[R+1]=U[L].y,O[R+2]=U[L].z,T&&_&&(g=T[V],_[N]=g[L].r,_[N+1]=g[L].g,_[N+2]=g[L].b,_[N+3]=g[L].a,N+=4),R+=3;return P.updateVerticesData(M.b.PositionKind,O,!1,!1),T&&_&&P.updateVerticesData(M.b.ColorKind,_,!1,!1),P}var j=!!T,Y=new d.b(b,x,null,void 0,void 0,j,p.useVertexAlpha);return S.a.CreateLineSystem(p).applyToMesh(Y,p.updatable),Y},I.CreateLines=function(b,p,x){x===void 0&&(x=null);var P=p.colors?[p.colors]:null;return I.CreateLineSystem(b,{lines:[p.points],updatable:p.updatable,instance:p.instance,colors:P,useVertexAlpha:p.useVertexAlpha},x)},I.CreateDashedLines=function(b,p,x){x===void 0&&(x=null);var P=p.points,A=p.instance,T=p.gapSize||1,_=p.dashSize||3;if(A)return A.updateMeshPositions(function(O){var R,N,V=E.e.Zero(),U=O.length/6,L=0,j=0,Y=0,W=0,re=0,ne=0;for(re=0;re<P.length-1;re++)P[re+1].subtractToRef(P[re],V),L+=V.length();R=L/U;var ge=A._creationDataStorage.dashSize;for(N=ge*R/(ge+A._creationDataStorage.gapSize),re=0;re<P.length-1;re++)for(P[re+1].subtractToRef(P[re],V),j=Math.floor(V.length()/R),V.normalize(),ne=0;ne<j&&W<O.length;)Y=R*ne,O[W]=P[re].x+Y*V.x,O[W+1]=P[re].y+Y*V.y,O[W+2]=P[re].z+Y*V.z,O[W+3]=P[re].x+(Y+N)*V.x,O[W+4]=P[re].y+(Y+N)*V.y,O[W+5]=P[re].z+(Y+N)*V.z,W+=6,ne++;for(;W<O.length;)O[W]=P[re].x,O[W+1]=P[re].y,O[W+2]=P[re].z,W+=3},!1),A;var g=new d.b(b,x,null,void 0,void 0,void 0,p.useVertexAlpha);return S.a.CreateDashedLines(p).applyToMesh(g,p.updatable),g._creationDataStorage=new m.b,g._creationDataStorage.dashSize=_,g._creationDataStorage.gapSize=T,g},I}()},function(h,s,c){c.d(s,"a",function(){return d});var E=c(34),m=c(8),S=function(M,C){return M?M.getClassName&&M.getClassName()==="Mesh"?null:M.getClassName&&M.getClassName()==="SubMesh"?M.clone(C):M.clone?M.clone():null:null},d=function(){function M(){}return M.DeepCopy=function(C,I,b,p){for(var x=0,P=function(R){var N=[];do Object.getOwnPropertyNames(R).forEach(function(V){N.indexOf(V)===-1&&N.push(V)});while(R=Object.getPrototypeOf(R));return N}(C);x<P.length;x++){var A=P[x];if((A[0]!=="_"||p&&p.indexOf(A)!==-1)&&!(E.a.EndsWith(A,"Observable")||b&&b.indexOf(A)!==-1)){var T=C[A],_=typeof T;if(_!=="function")try{if(_==="object")if(T instanceof Array){if(I[A]=[],T.length>0)if(typeof T[0]=="object")for(var g=0;g<T.length;g++){var O=S(T[g],I);I[A].indexOf(O)===-1&&I[A].push(O)}else I[A]=T.slice(0)}else I[A]=S(T,I);else I[A]=T}catch(R){m.a.Warn(R.message)}}}},M}()},function(h,s,c){c.d(s,"b",function(){return b}),c.d(s,"a",function(){return p});var E=c(1),m=c(3),S=c(6),d=c(12),M=c(9),C=c(76),I=c(121),b=function(x){function P(){var A=x.call(this)||this;return A.IMAGEPROCESSING=!1,A.VIGNETTE=!1,A.VIGNETTEBLENDMODEMULTIPLY=!1,A.VIGNETTEBLENDMODEOPAQUE=!1,A.TONEMAPPING=!1,A.TONEMAPPING_ACES=!1,A.CONTRAST=!1,A.COLORCURVES=!1,A.COLORGRADING=!1,A.COLORGRADING3D=!1,A.SAMPLER3DGREENDEPTH=!1,A.SAMPLER3DBGRMAP=!1,A.IMAGEPROCESSINGPOSTPROCESS=!1,A.EXPOSURE=!1,A.rebuild(),A}return Object(E.d)(P,x),P}(C.a),p=function(){function x(){this.colorCurves=new I.a,this._colorCurvesEnabled=!1,this._colorGradingEnabled=!1,this._colorGradingWithGreenDepth=!0,this._colorGradingBGR=!0,this._exposure=1,this._toneMappingEnabled=!1,this._toneMappingType=x.TONEMAPPING_STANDARD,this._contrast=1,this.vignetteStretch=0,this.vignetteCentreX=0,this.vignetteCentreY=0,this.vignetteWeight=1.5,this.vignetteColor=new M.b(0,0,0,0),this.vignetteCameraFov=.5,this._vignetteBlendMode=x.VIGNETTEMODE_MULTIPLY,this._vignetteEnabled=!1,this._applyByPostProcess=!1,this._isEnabled=!0,this.onUpdateParameters=new S.c}return Object.defineProperty(x.prototype,"colorCurvesEnabled",{get:function(){return this._colorCurvesEnabled},set:function(P){this._colorCurvesEnabled!==P&&(this._colorCurvesEnabled=P,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"colorGradingTexture",{get:function(){return this._colorGradingTexture},set:function(P){this._colorGradingTexture!==P&&(this._colorGradingTexture=P,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"colorGradingEnabled",{get:function(){return this._colorGradingEnabled},set:function(P){this._colorGradingEnabled!==P&&(this._colorGradingEnabled=P,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"colorGradingWithGreenDepth",{get:function(){return this._colorGradingWithGreenDepth},set:function(P){this._colorGradingWithGreenDepth!==P&&(this._colorGradingWithGreenDepth=P,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"colorGradingBGR",{get:function(){return this._colorGradingBGR},set:function(P){this._colorGradingBGR!==P&&(this._colorGradingBGR=P,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"exposure",{get:function(){return this._exposure},set:function(P){this._exposure!==P&&(this._exposure=P,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"toneMappingEnabled",{get:function(){return this._toneMappingEnabled},set:function(P){this._toneMappingEnabled!==P&&(this._toneMappingEnabled=P,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"toneMappingType",{get:function(){return this._toneMappingType},set:function(P){this._toneMappingType!==P&&(this._toneMappingType=P,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"contrast",{get:function(){return this._contrast},set:function(P){this._contrast!==P&&(this._contrast=P,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"vignetteBlendMode",{get:function(){return this._vignetteBlendMode},set:function(P){this._vignetteBlendMode!==P&&(this._vignetteBlendMode=P,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"vignetteEnabled",{get:function(){return this._vignetteEnabled},set:function(P){this._vignetteEnabled!==P&&(this._vignetteEnabled=P,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"applyByPostProcess",{get:function(){return this._applyByPostProcess},set:function(P){this._applyByPostProcess!==P&&(this._applyByPostProcess=P,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(P){this._isEnabled!==P&&(this._isEnabled=P,this._updateParameters())},enumerable:!1,configurable:!0}),x.prototype._updateParameters=function(){this.onUpdateParameters.notifyObservers(this)},x.prototype.getClassName=function(){return"ImageProcessingConfiguration"},x.PrepareUniforms=function(P,A){A.EXPOSURE&&P.push("exposureLinear"),A.CONTRAST&&P.push("contrast"),A.COLORGRADING&&P.push("colorTransformSettings"),A.VIGNETTE&&(P.push("vInverseScreenSize"),P.push("vignetteSettings1"),P.push("vignetteSettings2")),A.COLORCURVES&&I.a.PrepareUniforms(P)},x.PrepareSamplers=function(P,A){A.COLORGRADING&&P.push("txColorTransform")},x.prototype.prepareDefines=function(P,A){if(A===void 0&&(A=!1),A!==this.applyByPostProcess||!this._isEnabled)return P.VIGNETTE=!1,P.TONEMAPPING=!1,P.TONEMAPPING_ACES=!1,P.CONTRAST=!1,P.EXPOSURE=!1,P.COLORCURVES=!1,P.COLORGRADING=!1,P.COLORGRADING3D=!1,P.IMAGEPROCESSING=!1,void(P.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess&&this._isEnabled);switch(P.VIGNETTE=this.vignetteEnabled,P.VIGNETTEBLENDMODEMULTIPLY=this.vignetteBlendMode===x._VIGNETTEMODE_MULTIPLY,P.VIGNETTEBLENDMODEOPAQUE=!P.VIGNETTEBLENDMODEMULTIPLY,P.TONEMAPPING=this.toneMappingEnabled,this._toneMappingType){case x.TONEMAPPING_ACES:P.TONEMAPPING_ACES=!0;break;default:P.TONEMAPPING_ACES=!1}P.CONTRAST=this.contrast!==1,P.EXPOSURE=this.exposure!==1,P.COLORCURVES=this.colorCurvesEnabled&&!!this.colorCurves,P.COLORGRADING=this.colorGradingEnabled&&!!this.colorGradingTexture,P.COLORGRADING?P.COLORGRADING3D=this.colorGradingTexture.is3D:P.COLORGRADING3D=!1,P.SAMPLER3DGREENDEPTH=this.colorGradingWithGreenDepth,P.SAMPLER3DBGRMAP=this.colorGradingBGR,P.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess,P.IMAGEPROCESSING=P.VIGNETTE||P.TONEMAPPING||P.CONTRAST||P.EXPOSURE||P.COLORCURVES||P.COLORGRADING},x.prototype.isReady=function(){return!this.colorGradingEnabled||!this.colorGradingTexture||this.colorGradingTexture.isReady()},x.prototype.bind=function(P,A){if(this._colorCurvesEnabled&&this.colorCurves&&I.a.Bind(this.colorCurves,P),this._vignetteEnabled){var T=1/P.getEngine().getRenderWidth(),_=1/P.getEngine().getRenderHeight();P.setFloat2("vInverseScreenSize",T,_);var g=A??_/T,O=Math.tan(.5*this.vignetteCameraFov),R=O*g,N=Math.sqrt(R*O);R=d.b.Mix(R,N,this.vignetteStretch),O=d.b.Mix(O,N,this.vignetteStretch),P.setFloat4("vignetteSettings1",R,O,-R*this.vignetteCentreX,-O*this.vignetteCentreY);var V=-2*this.vignetteWeight;P.setFloat4("vignetteSettings2",this.vignetteColor.r,this.vignetteColor.g,this.vignetteColor.b,V)}if(P.setFloat("exposureLinear",this.exposure),P.setFloat("contrast",this.contrast),this.colorGradingTexture){P.setTexture("txColorTransform",this.colorGradingTexture);var U=this.colorGradingTexture.getSize().height;P.setFloat4("colorTransformSettings",(U-1)/U,.5/U,U,this.colorGradingTexture.level)}},x.prototype.clone=function(){return m.a.Clone(function(){return new x},this)},x.prototype.serialize=function(){return m.a.Serialize(this)},x.Parse=function(P){return m.a.Parse(function(){return new x},P,null,null)},Object.defineProperty(x,"VIGNETTEMODE_MULTIPLY",{get:function(){return this._VIGNETTEMODE_MULTIPLY},enumerable:!1,configurable:!0}),Object.defineProperty(x,"VIGNETTEMODE_OPAQUE",{get:function(){return this._VIGNETTEMODE_OPAQUE},enumerable:!1,configurable:!0}),x.TONEMAPPING_STANDARD=0,x.TONEMAPPING_ACES=1,x._VIGNETTEMODE_MULTIPLY=0,x._VIGNETTEMODE_OPAQUE=1,Object(E.c)([Object(m.g)()],x.prototype,"colorCurves",void 0),Object(E.c)([Object(m.c)()],x.prototype,"_colorCurvesEnabled",void 0),Object(E.c)([Object(m.m)("colorGradingTexture")],x.prototype,"_colorGradingTexture",void 0),Object(E.c)([Object(m.c)()],x.prototype,"_colorGradingEnabled",void 0),Object(E.c)([Object(m.c)()],x.prototype,"_colorGradingWithGreenDepth",void 0),Object(E.c)([Object(m.c)()],x.prototype,"_colorGradingBGR",void 0),Object(E.c)([Object(m.c)()],x.prototype,"_exposure",void 0),Object(E.c)([Object(m.c)()],x.prototype,"_toneMappingEnabled",void 0),Object(E.c)([Object(m.c)()],x.prototype,"_toneMappingType",void 0),Object(E.c)([Object(m.c)()],x.prototype,"_contrast",void 0),Object(E.c)([Object(m.c)()],x.prototype,"vignetteStretch",void 0),Object(E.c)([Object(m.c)()],x.prototype,"vignetteCentreX",void 0),Object(E.c)([Object(m.c)()],x.prototype,"vignetteCentreY",void 0),Object(E.c)([Object(m.c)()],x.prototype,"vignetteWeight",void 0),Object(E.c)([Object(m.f)()],x.prototype,"vignetteColor",void 0),Object(E.c)([Object(m.c)()],x.prototype,"vignetteCameraFov",void 0),Object(E.c)([Object(m.c)()],x.prototype,"_vignetteBlendMode",void 0),Object(E.c)([Object(m.c)()],x.prototype,"_vignetteEnabled",void 0),Object(E.c)([Object(m.c)()],x.prototype,"_applyByPostProcess",void 0),Object(E.c)([Object(m.c)()],x.prototype,"_isEnabled",void 0),x}();m.a._ImageProcessingConfigurationParser=p.Parse},function(h,s,c){c.d(s,"a",function(){return x});var E=c(44),m=c(0),S=c(2),d=c(103),M=c(113),C={min:0,max:0},I={min:0,max:0},b=function(P,A,T){var _=m.e.Dot(A.centerWorld,P),g=Math.abs(m.e.Dot(A.directions[0],P))*A.extendSize.x+Math.abs(m.e.Dot(A.directions[1],P))*A.extendSize.y+Math.abs(m.e.Dot(A.directions[2],P))*A.extendSize.z;T.min=_-g,T.max=_+g},p=function(P,A,T){return b(P,A,C),b(P,T,I),!(C.min>I.max||I.min>C.max)},x=function(){function P(A,T,_){this._isLocked=!1,this.boundingBox=new d.a(A,T,_),this.boundingSphere=new M.a(A,T,_)}return P.prototype.reConstruct=function(A,T,_){this.boundingBox.reConstruct(A,T,_),this.boundingSphere.reConstruct(A,T,_)},Object.defineProperty(P.prototype,"minimum",{get:function(){return this.boundingBox.minimum},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"maximum",{get:function(){return this.boundingBox.maximum},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"isLocked",{get:function(){return this._isLocked},set:function(A){this._isLocked=A},enumerable:!1,configurable:!0}),P.prototype.update=function(A){this._isLocked||(this.boundingBox._update(A),this.boundingSphere._update(A))},P.prototype.centerOn=function(A,T){var _=P.TmpVector3[0].copyFrom(A).subtractInPlace(T),g=P.TmpVector3[1].copyFrom(A).addInPlace(T);return this.boundingBox.reConstruct(_,g,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(_,g,this.boundingBox.getWorldMatrix()),this},P.prototype.scale=function(A){return this.boundingBox.scale(A),this.boundingSphere.scale(A),this},P.prototype.isInFrustum=function(A,T){return T===void 0&&(T=S.a.MESHES_CULLINGSTRATEGY_STANDARD),!(T!==S.a.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION&&T!==S.a.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY||!this.boundingSphere.isCenterInFrustum(A))||!!this.boundingSphere.isInFrustum(A)&&(!(T!==S.a.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY&&T!==S.a.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY)||this.boundingBox.isInFrustum(A))},Object.defineProperty(P.prototype,"diagonalLength",{get:function(){var A=this.boundingBox;return A.maximumWorld.subtractToRef(A.minimumWorld,P.TmpVector3[0]).length()},enumerable:!1,configurable:!0}),P.prototype.isCompletelyInFrustum=function(A){return this.boundingBox.isCompletelyInFrustum(A)},P.prototype._checkCollision=function(A){return A._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)},P.prototype.intersectsPoint=function(A){return!!this.boundingSphere.centerWorld&&!!this.boundingSphere.intersectsPoint(A)&&!!this.boundingBox.intersectsPoint(A)},P.prototype.intersects=function(A,T){if(!M.a.Intersects(this.boundingSphere,A.boundingSphere)||!d.a.Intersects(this.boundingBox,A.boundingBox))return!1;if(!T)return!0;var _=this.boundingBox,g=A.boundingBox;return!!p(_.directions[0],_,g)&&!!p(_.directions[1],_,g)&&!!p(_.directions[2],_,g)&&!!p(g.directions[0],_,g)&&!!p(g.directions[1],_,g)&&!!p(g.directions[2],_,g)&&!!p(m.e.Cross(_.directions[0],g.directions[0]),_,g)&&!!p(m.e.Cross(_.directions[0],g.directions[1]),_,g)&&!!p(m.e.Cross(_.directions[0],g.directions[2]),_,g)&&!!p(m.e.Cross(_.directions[1],g.directions[0]),_,g)&&!!p(m.e.Cross(_.directions[1],g.directions[1]),_,g)&&!!p(m.e.Cross(_.directions[1],g.directions[2]),_,g)&&!!p(m.e.Cross(_.directions[2],g.directions[0]),_,g)&&!!p(m.e.Cross(_.directions[2],g.directions[1]),_,g)&&!!p(m.e.Cross(_.directions[2],g.directions[2]),_,g)},P.TmpVector3=E.a.BuildArray(2,m.e.Zero),P}()},function(h,s,c){c.d(s,"a",function(){return E});var E=function(){function m(){}return m.BuildArray=function(S,d){for(var M=[],C=0;C<S;++C)M.push(d());return M},m}()},function(h,s,c){c.d(s,"a",function(){return d});var E=c(0),m=c(7),S=c(16);S.a.CreateSphere=function(M){for(var C=M.segments||32,I=M.diameterX||M.diameter||1,b=M.diameterY||M.diameter||1,p=M.diameterZ||M.diameter||1,x=M.arc&&(M.arc<=0||M.arc>1)?1:M.arc||1,P=M.slice&&M.slice<=0?1:M.slice||1,A=M.sideOrientation===0?0:M.sideOrientation||S.a.DEFAULTSIDE,T=!!M.dedupTopBottomIndices,_=new E.e(I/2,b/2,p/2),g=2+C,O=2*g,R=[],N=[],V=[],U=[],L=0;L<=g;L++){for(var j=L/g,Y=j*Math.PI*P,W=0;W<=O;W++){var re=W/O,ne=re*Math.PI*2*x,ge=E.a.RotationZ(-Y),_e=E.a.RotationY(ne),ce=E.e.TransformCoordinates(E.e.Up(),ge),ie=E.e.TransformCoordinates(ce,_e),Z=ie.multiply(_),te=ie.divide(_).normalize();N.push(Z.x,Z.y,Z.z),V.push(te.x,te.y,te.z),U.push(re,j)}if(L>0)for(var B=N.length/3,G=B-2*(O+1);G+O+2<B;G++)T?(L>1&&(R.push(G),R.push(G+1),R.push(G+O+1)),(L<g||P<1)&&(R.push(G+O+1),R.push(G+1),R.push(G+O+2))):(R.push(G),R.push(G+1),R.push(G+O+1),R.push(G+O+1),R.push(G+1),R.push(G+O+2))}S.a._ComputeSides(A,N,R,V,U,M.frontUVs,M.backUVs);var $=new S.a;return $.indices=R,$.positions=N,$.normals=V,$.uvs=U,$},m.a.CreateSphere=function(M,C,I,b,p,x){var P={segments:C,diameterX:I,diameterY:I,diameterZ:I,sideOrientation:x,updatable:p};return d.CreateSphere(M,P,b)};var d=function(){function M(){}return M.CreateSphere=function(C,I,b){b===void 0&&(b=null);var p=new m.a(C,b);return I.sideOrientation=m.a._GetDefaultSideOrientation(I.sideOrientation),p._originalBuilderSideOrientation=I.sideOrientation,S.a.CreateSphere(I).applyToMesh(p,I.updatable),p},M}()},function(h,s,c){c.d(s,"a",function(){return I});var E=c(1),m=c(3),S=c(6),d=c(0),M=c(29),C=c(23),I=function(b){function p(x,P,A){P===void 0&&(P=null),A===void 0&&(A=!0);var T=b.call(this,x,P)||this;return T._forward=new d.e(0,0,1),T._forwardInverted=new d.e(0,0,-1),T._up=new d.e(0,1,0),T._right=new d.e(1,0,0),T._rightInverted=new d.e(-1,0,0),T._position=d.e.Zero(),T._rotation=d.e.Zero(),T._rotationQuaternion=null,T._scaling=d.e.One(),T._isDirty=!1,T._transformToBoneReferal=null,T._isAbsoluteSynced=!1,T._billboardMode=p.BILLBOARDMODE_NONE,T._preserveParentRotationForBillboard=!1,T.scalingDeterminant=1,T._infiniteDistance=!1,T.ignoreNonUniformScaling=!1,T.reIntegrateRotationIntoRotationQuaternion=!1,T._poseMatrix=null,T._localMatrix=d.a.Zero(),T._usePivotMatrix=!1,T._absolutePosition=d.e.Zero(),T._absoluteScaling=d.e.Zero(),T._absoluteRotationQuaternion=d.b.Identity(),T._pivotMatrix=d.a.Identity(),T._postMultiplyPivotMatrix=!1,T._isWorldMatrixFrozen=!1,T._indexInSceneTransformNodesArray=-1,T.onAfterWorldMatrixUpdateObservable=new S.c,T._nonUniformScaling=!1,A&&T.getScene().addTransformNode(T),T}return Object(E.d)(p,b),Object.defineProperty(p.prototype,"billboardMode",{get:function(){return this._billboardMode},set:function(x){this._billboardMode!==x&&(this._billboardMode=x)},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"preserveParentRotationForBillboard",{get:function(){return this._preserveParentRotationForBillboard},set:function(x){x!==this._preserveParentRotationForBillboard&&(this._preserveParentRotationForBillboard=x)},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"infiniteDistance",{get:function(){return this._infiniteDistance},set:function(x){this._infiniteDistance!==x&&(this._infiniteDistance=x)},enumerable:!1,configurable:!0}),p.prototype.getClassName=function(){return"TransformNode"},Object.defineProperty(p.prototype,"position",{get:function(){return this._position},set:function(x){this._position=x,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"rotation",{get:function(){return this._rotation},set:function(x){this._rotation=x,this._rotationQuaternion=null,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"scaling",{get:function(){return this._scaling},set:function(x){this._scaling=x,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"rotationQuaternion",{get:function(){return this._rotationQuaternion},set:function(x){this._rotationQuaternion=x,x&&this._rotation.setAll(0),this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"forward",{get:function(){return d.e.Normalize(d.e.TransformNormal(this.getScene().useRightHandedSystem?this._forwardInverted:this._forward,this.getWorldMatrix()))},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"up",{get:function(){return d.e.Normalize(d.e.TransformNormal(this._up,this.getWorldMatrix()))},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"right",{get:function(){return d.e.Normalize(d.e.TransformNormal(this.getScene().useRightHandedSystem?this._rightInverted:this._right,this.getWorldMatrix()))},enumerable:!1,configurable:!0}),p.prototype.updatePoseMatrix=function(x){return this._poseMatrix?(this._poseMatrix.copyFrom(x),this):(this._poseMatrix=x.clone(),this)},p.prototype.getPoseMatrix=function(){return this._poseMatrix||(this._poseMatrix=d.a.Identity()),this._poseMatrix},p.prototype._isSynchronized=function(){var x=this._cache;return this.billboardMode===x.billboardMode&&this.billboardMode===p.BILLBOARDMODE_NONE&&!x.pivotMatrixUpdated&&!this.infiniteDistance&&!this.position._isDirty&&!this.scaling._isDirty&&!(this._rotationQuaternion&&this._rotationQuaternion._isDirty||this.rotation._isDirty)},p.prototype._initCache=function(){b.prototype._initCache.call(this);var x=this._cache;x.localMatrixUpdated=!1,x.billboardMode=-1,x.infiniteDistance=!1},p.prototype.markAsDirty=function(x){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this},Object.defineProperty(p.prototype,"absolutePosition",{get:function(){return this._absolutePosition},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"absoluteScaling",{get:function(){return this._syncAbsoluteScalingAndRotation(),this._absoluteScaling},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"absoluteRotationQuaternion",{get:function(){return this._syncAbsoluteScalingAndRotation(),this._absoluteRotationQuaternion},enumerable:!1,configurable:!0}),p.prototype.setPreTransformMatrix=function(x){return this.setPivotMatrix(x,!1)},p.prototype.setPivotMatrix=function(x,P){return P===void 0&&(P=!0),this._pivotMatrix.copyFrom(x),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=P,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=d.a.Invert(this._pivotMatrix)),this},p.prototype.getPivotMatrix=function(){return this._pivotMatrix},p.prototype.instantiateHierarchy=function(x,P,A){x===void 0&&(x=null);var T=this.clone("Clone of "+(this.name||this.id),x||this.parent,!0);T&&A&&A(this,T);for(var _=0,g=this.getChildTransformNodes(!0);_<g.length;_++)g[_].instantiateHierarchy(T,P,A);return T},p.prototype.freezeWorldMatrix=function(x){return x===void 0&&(x=null),x?this._worldMatrix=x:(this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0)),this._isDirty=!1,this._isWorldMatrixFrozen=!0,this},p.prototype.unfreezeWorldMatrix=function(){return this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0),this},Object.defineProperty(p.prototype,"isWorldMatrixFrozen",{get:function(){return this._isWorldMatrixFrozen},enumerable:!1,configurable:!0}),p.prototype.getAbsolutePosition=function(){return this.computeWorldMatrix(),this._absolutePosition},p.prototype.setAbsolutePosition=function(x){if(!x)return this;var P,A,T;if(x.x===void 0){if(arguments.length<3)return this;P=arguments[0],A=arguments[1],T=arguments[2]}else P=x.x,A=x.y,T=x.z;if(this.parent){var _=d.c.Matrix[0];this.parent.getWorldMatrix().invertToRef(_),d.e.TransformCoordinatesFromFloatsToRef(P,A,T,_,this.position)}else this.position.x=P,this.position.y=A,this.position.z=T;return this._absolutePosition.copyFrom(x),this},p.prototype.setPositionWithLocalVector=function(x){return this.computeWorldMatrix(),this.position=d.e.TransformNormal(x,this._localMatrix),this},p.prototype.getPositionExpressedInLocalSpace=function(){this.computeWorldMatrix();var x=d.c.Matrix[0];return this._localMatrix.invertToRef(x),d.e.TransformNormal(this.position,x)},p.prototype.locallyTranslate=function(x){return this.computeWorldMatrix(!0),this.position=d.e.TransformCoordinates(x,this._localMatrix),this},p.prototype.lookAt=function(x,P,A,T,_){P===void 0&&(P=0),A===void 0&&(A=0),T===void 0&&(T=0),_===void 0&&(_=C.c.LOCAL);var g=p._lookAtVectorCache,O=_===C.c.LOCAL?this.position:this.getAbsolutePosition();if(x.subtractToRef(O,g),this.setDirection(g,P,A,T),_===C.c.WORLD&&this.parent)if(this.rotationQuaternion){var R=d.c.Matrix[0];this.rotationQuaternion.toRotationMatrix(R);var N=d.c.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(N),N.invert(),R.multiplyToRef(N,R),this.rotationQuaternion.fromRotationMatrix(R)}else{var V=d.c.Quaternion[0];d.b.FromEulerVectorToRef(this.rotation,V),R=d.c.Matrix[0],V.toRotationMatrix(R),N=d.c.Matrix[1],this.parent.getWorldMatrix().getRotationMatrixToRef(N),N.invert(),R.multiplyToRef(N,R),V.fromRotationMatrix(R),V.toEulerAnglesToRef(this.rotation)}return this},p.prototype.getDirection=function(x){var P=d.e.Zero();return this.getDirectionToRef(x,P),P},p.prototype.getDirectionToRef=function(x,P){return d.e.TransformNormalToRef(x,this.getWorldMatrix(),P),this},p.prototype.setDirection=function(x,P,A,T){P===void 0&&(P=0),A===void 0&&(A=0),T===void 0&&(T=0);var _=-Math.atan2(x.z,x.x)+Math.PI/2,g=Math.sqrt(x.x*x.x+x.z*x.z),O=-Math.atan2(x.y,g);return this.rotationQuaternion?d.b.RotationYawPitchRollToRef(_+P,O+A,T,this.rotationQuaternion):(this.rotation.x=O+A,this.rotation.y=_+P,this.rotation.z=T),this},p.prototype.setPivotPoint=function(x,P){P===void 0&&(P=C.c.LOCAL),this.getScene().getRenderId()==0&&this.computeWorldMatrix(!0);var A=this.getWorldMatrix();if(P==C.c.WORLD){var T=d.c.Matrix[0];A.invertToRef(T),x=d.e.TransformCoordinates(x,T)}return this.setPivotMatrix(d.a.Translation(-x.x,-x.y,-x.z),!0)},p.prototype.getPivotPoint=function(){var x=d.e.Zero();return this.getPivotPointToRef(x),x},p.prototype.getPivotPointToRef=function(x){return x.x=-this._pivotMatrix.m[12],x.y=-this._pivotMatrix.m[13],x.z=-this._pivotMatrix.m[14],this},p.prototype.getAbsolutePivotPoint=function(){var x=d.e.Zero();return this.getAbsolutePivotPointToRef(x),x},p.prototype.getAbsolutePivotPointToRef=function(x){return this.getPivotPointToRef(x),d.e.TransformCoordinatesToRef(x,this.getWorldMatrix(),x),this},p.prototype.setParent=function(x){if(!x&&!this.parent)return this;var P=d.c.Quaternion[0],A=d.c.Vector3[0],T=d.c.Vector3[1];if(x){var _=d.c.Matrix[0],g=d.c.Matrix[1];this.computeWorldMatrix(!0),x.computeWorldMatrix(!0),x.getWorldMatrix().invertToRef(g),this.getWorldMatrix().multiplyToRef(g,_),_.decompose(T,P,A)}else this.computeWorldMatrix(!0),this.getWorldMatrix().decompose(T,P,A);return this.rotationQuaternion?this.rotationQuaternion.copyFrom(P):P.toEulerAnglesToRef(this.rotation),this.scaling.copyFrom(T),this.position.copyFrom(A),this.parent=x,this},Object.defineProperty(p.prototype,"nonUniformScaling",{get:function(){return this._nonUniformScaling},enumerable:!1,configurable:!0}),p.prototype._updateNonUniformScalingState=function(x){return this._nonUniformScaling!==x&&(this._nonUniformScaling=x,!0)},p.prototype.attachToBone=function(x,P){return this._transformToBoneReferal=P,this.parent=x,x.getSkeleton().prepare(),x.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this},p.prototype.detachFromBone=function(){return this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=null,this):this},p.prototype.rotate=function(x,P,A){var T;if(x.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.setAll(0)),A&&A!==C.c.LOCAL){if(this.parent){var _=d.c.Matrix[0];this.parent.getWorldMatrix().invertToRef(_),x=d.e.TransformNormal(x,_)}(T=d.b.RotationAxisToRef(x,P,p._rotationAxisCache)).multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}else T=d.b.RotationAxisToRef(x,P,p._rotationAxisCache),this.rotationQuaternion.multiplyToRef(T,this.rotationQuaternion);return this},p.prototype.rotateAround=function(x,P,A){P.normalize(),this.rotationQuaternion||(this.rotationQuaternion=d.b.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.setAll(0));var T=d.c.Vector3[0],_=d.c.Vector3[1],g=d.c.Vector3[2],O=d.c.Quaternion[0],R=d.c.Matrix[0],N=d.c.Matrix[1],V=d.c.Matrix[2],U=d.c.Matrix[3];return x.subtractToRef(this.position,T),d.a.TranslationToRef(T.x,T.y,T.z,R),d.a.TranslationToRef(-T.x,-T.y,-T.z,N),d.a.RotationAxisToRef(P,A,V),N.multiplyToRef(V,U),U.multiplyToRef(R,U),U.decompose(_,O,g),this.position.addInPlace(g),O.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this},p.prototype.translate=function(x,P,A){var T=x.scale(P);if(A&&A!==C.c.LOCAL)this.setAbsolutePosition(this.getAbsolutePosition().add(T));else{var _=this.getPositionExpressedInLocalSpace().add(T);this.setPositionWithLocalVector(_)}return this},p.prototype.addRotation=function(x,P,A){var T;this.rotationQuaternion?T=this.rotationQuaternion:(T=d.c.Quaternion[1],d.b.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,T));var _=d.c.Quaternion[0];return d.b.RotationYawPitchRollToRef(P,x,A,_),T.multiplyInPlace(_),this.rotationQuaternion||T.toEulerAnglesToRef(this.rotation),this},p.prototype._getEffectiveParent=function(){return this.parent},p.prototype.computeWorldMatrix=function(x){if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;var P=this.getScene().getRenderId();if(!this._isDirty&&!x&&this.isSynchronized())return this._currentRenderId=P,this._worldMatrix;var A=this.getScene().activeCamera,T=(this._billboardMode&p.BILLBOARDMODE_USE_POSITION)!=0,_=this._billboardMode!==p.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard;_&&A&&T&&(this.lookAt(A.position),(this.billboardMode&p.BILLBOARDMODE_X)!==p.BILLBOARDMODE_X&&(this.rotation.x=0),(this.billboardMode&p.BILLBOARDMODE_Y)!==p.BILLBOARDMODE_Y&&(this.rotation.y=0),(this.billboardMode&p.BILLBOARDMODE_Z)!==p.BILLBOARDMODE_Z&&(this.rotation.z=0)),this._updateCache();var g=this._cache;g.pivotMatrixUpdated=!1,g.billboardMode=this.billboardMode,g.infiniteDistance=this.infiniteDistance,this._currentRenderId=P,this._childUpdateId++,this._isDirty=!1,this._position._isDirty=!1,this._rotation._isDirty=!1,this._scaling._isDirty=!1;var O,R=this._getEffectiveParent(),N=p._TmpScaling,V=this._position;if(this._infiniteDistance&&!this.parent&&A){var U=A.getWorldMatrix(),L=new d.e(U.m[12],U.m[13],U.m[14]);(V=p._TmpTranslation).copyFromFloats(this._position.x+L.x,this._position.y+L.y,this._position.z+L.z)}if(N.copyFromFloats(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant),this._rotationQuaternion?(this._rotationQuaternion._isDirty=!1,O=this._rotationQuaternion,this.reIntegrateRotationIntoRotationQuaternion&&this.rotation.lengthSquared()&&(this._rotationQuaternion.multiplyInPlace(d.b.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.copyFromFloats(0,0,0))):(O=p._TmpRotation,d.b.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,O)),this._usePivotMatrix){var j=d.c.Matrix[1];d.a.ScalingToRef(N.x,N.y,N.z,j);var Y=d.c.Matrix[0];O.toRotationMatrix(Y),this._pivotMatrix.multiplyToRef(j,d.c.Matrix[4]),d.c.Matrix[4].multiplyToRef(Y,this._localMatrix),this._postMultiplyPivotMatrix&&this._localMatrix.multiplyToRef(this._pivotMatrixInverse,this._localMatrix),this._localMatrix.addTranslationFromFloats(V.x,V.y,V.z)}else d.a.ComposeToRef(N,O,V,this._localMatrix);if(R&&R.getWorldMatrix){if(x&&R.computeWorldMatrix(),_){this._transformToBoneReferal?R.getWorldMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),d.c.Matrix[7]):d.c.Matrix[7].copyFrom(R.getWorldMatrix());var W=d.c.Vector3[5],re=d.c.Vector3[6];d.c.Matrix[7].decompose(re,void 0,W),d.a.ScalingToRef(re.x,re.y,re.z,d.c.Matrix[7]),d.c.Matrix[7].setTranslation(W),this._localMatrix.multiplyToRef(d.c.Matrix[7],this._worldMatrix)}else this._transformToBoneReferal?(this._localMatrix.multiplyToRef(R.getWorldMatrix(),d.c.Matrix[6]),d.c.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)):this._localMatrix.multiplyToRef(R.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.copyFrom(this._localMatrix);if(_&&A&&this.billboardMode&&!T){var ne=d.c.Vector3[0];if(this._worldMatrix.getTranslationToRef(ne),d.c.Matrix[1].copyFrom(A.getViewMatrix()),d.c.Matrix[1].setTranslationFromFloats(0,0,0),d.c.Matrix[1].invertToRef(d.c.Matrix[0]),(this.billboardMode&p.BILLBOARDMODE_ALL)!==p.BILLBOARDMODE_ALL){d.c.Matrix[0].decompose(void 0,d.c.Quaternion[0],void 0);var ge=d.c.Vector3[1];d.c.Quaternion[0].toEulerAnglesToRef(ge),(this.billboardMode&p.BILLBOARDMODE_X)!==p.BILLBOARDMODE_X&&(ge.x=0),(this.billboardMode&p.BILLBOARDMODE_Y)!==p.BILLBOARDMODE_Y&&(ge.y=0),(this.billboardMode&p.BILLBOARDMODE_Z)!==p.BILLBOARDMODE_Z&&(ge.z=0),d.a.RotationYawPitchRollToRef(ge.y,ge.x,ge.z,d.c.Matrix[0])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(d.c.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(d.c.Vector3[0])}return this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniformWithinEpsilon(1e-6)?this._updateNonUniformScalingState(!0):R&&R._nonUniformScaling?this._updateNonUniformScalingState(R._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._isAbsoluteSynced=!1,this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=d.a.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix},p.prototype.resetLocalMatrix=function(x){if(x===void 0&&(x=!0),this.computeWorldMatrix(),x)for(var P=this.getChildren(),A=0;A<P.length;++A){var T=P[A];if(T){T.computeWorldMatrix();var _=d.c.Matrix[0];T._localMatrix.multiplyToRef(this._localMatrix,_);var g=d.c.Quaternion[0];_.decompose(T.scaling,g,T.position),T.rotationQuaternion?T.rotationQuaternion=g:g.toEulerAnglesToRef(T.rotation)}}this.scaling.copyFromFloats(1,1,1),this.position.copyFromFloats(0,0,0),this.rotation.copyFromFloats(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=d.b.Identity()),this._worldMatrix=d.a.Identity()},p.prototype._afterComputeWorldMatrix=function(){},p.prototype.registerAfterWorldMatrixUpdate=function(x){return this.onAfterWorldMatrixUpdateObservable.add(x),this},p.prototype.unregisterAfterWorldMatrixUpdate=function(x){return this.onAfterWorldMatrixUpdateObservable.removeCallback(x),this},p.prototype.getPositionInCameraSpace=function(x){return x===void 0&&(x=null),x||(x=this.getScene().activeCamera),d.e.TransformCoordinates(this.getAbsolutePosition(),x.getViewMatrix())},p.prototype.getDistanceToCamera=function(x){return x===void 0&&(x=null),x||(x=this.getScene().activeCamera),this.getAbsolutePosition().subtract(x.globalPosition).length()},p.prototype.clone=function(x,P,A){var T=this,_=m.a.Clone(function(){return new p(x,T.getScene())},this);if(_.name=x,_.id=x,P&&(_.parent=P),!A)for(var g=this.getDescendants(!0),O=0;O<g.length;O++){var R=g[O];R.clone&&R.clone(x+"."+R.name,_)}return _},p.prototype.serialize=function(x){var P=m.a.Serialize(this,x);return P.type=this.getClassName(),this.parent&&(P.parentId=this.parent.id),P.localMatrix=this.getPivotMatrix().asArray(),P.isEnabled=this.isEnabled(),this.parent&&(P.parentId=this.parent.id),P},p.Parse=function(x,P,A){var T=m.a.Parse(function(){return new p(x.name,P)},x,P,A);return x.localMatrix?T.setPreTransformMatrix(d.a.FromArray(x.localMatrix)):x.pivotMatrix&&T.setPivotMatrix(d.a.FromArray(x.pivotMatrix)),T.setEnabled(x.isEnabled),x.parentId&&(T._waitingParentId=x.parentId),T},p.prototype.getChildTransformNodes=function(x,P){var A=[];return this._getDescendants(A,x,function(T){return(!P||P(T))&&T instanceof p}),A},p.prototype.dispose=function(x,P){if(P===void 0&&(P=!1),this.getScene().stopAnimation(this),this.getScene().removeTransformNode(this),this.onAfterWorldMatrixUpdateObservable.clear(),x)for(var A=0,T=this.getChildTransformNodes(!0);A<T.length;A++){var _=T[A];_.parent=null,_.computeWorldMatrix(!0)}b.prototype.dispose.call(this,x,P)},p.prototype.normalizeToUnitCube=function(x,P,A){x===void 0&&(x=!0),P===void 0&&(P=!1);var T=null,_=null;P&&(this.rotationQuaternion?(_=this.rotationQuaternion.clone(),this.rotationQuaternion.copyFromFloats(0,0,0,1)):this.rotation&&(T=this.rotation.clone(),this.rotation.copyFromFloats(0,0,0)));var g=this.getHierarchyBoundingVectors(x,A),O=g.max.subtract(g.min),R=Math.max(O.x,O.y,O.z);if(R===0)return this;var N=1/R;return this.scaling.scaleInPlace(N),P&&(this.rotationQuaternion&&_?this.rotationQuaternion.copyFrom(_):this.rotation&&T&&this.rotation.copyFrom(T)),this},p.prototype._syncAbsoluteScalingAndRotation=function(){this._isAbsoluteSynced||(this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion),this._isAbsoluteSynced=!0)},p.BILLBOARDMODE_NONE=0,p.BILLBOARDMODE_X=1,p.BILLBOARDMODE_Y=2,p.BILLBOARDMODE_Z=4,p.BILLBOARDMODE_ALL=7,p.BILLBOARDMODE_USE_POSITION=128,p._TmpRotation=d.b.Zero(),p._TmpScaling=d.e.Zero(),p._TmpTranslation=d.e.Zero(),p._lookAtVectorCache=new d.e(0,0,0),p._rotationAxisCache=new d.b,Object(E.c)([Object(m.o)("position")],p.prototype,"_position",void 0),Object(E.c)([Object(m.o)("rotation")],p.prototype,"_rotation",void 0),Object(E.c)([Object(m.l)("rotationQuaternion")],p.prototype,"_rotationQuaternion",void 0),Object(E.c)([Object(m.o)("scaling")],p.prototype,"_scaling",void 0),Object(E.c)([Object(m.c)("billboardMode")],p.prototype,"_billboardMode",void 0),Object(E.c)([Object(m.c)()],p.prototype,"scalingDeterminant",void 0),Object(E.c)([Object(m.c)("infiniteDistance")],p.prototype,"_infiniteDistance",void 0),Object(E.c)([Object(m.c)()],p.prototype,"ignoreNonUniformScaling",void 0),Object(E.c)([Object(m.c)()],p.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0),p}(M.a)},function(h,s,c){c.d(s,"a",function(){return E});var E=function(){function m(S,d,M,C,I,b){this.source=S,this.pointerX=d,this.pointerY=M,this.meshUnderPointer=C,this.sourceEvent=I,this.additionalData=b}return m.CreateNew=function(S,d,M){var C=S.getScene();return new m(S,C.pointerX,C.pointerY,C.meshUnderPointer||S,d,M)},m.CreateNewFromSprite=function(S,d,M,C){return new m(S,d.pointerX,d.pointerY,d.meshUnderPointer,M,C)},m.CreateNewFromScene=function(S,d){return new m(null,S.pointerX,S.pointerY,S.meshUnderPointer,d)},m.CreateNewFromPrimitive=function(S,d,M,C){return new m(S,d.x,d.y,null,M,C)},m}()},function(h,s,c){c.d(s,"a",function(){return b});var E=c(1),m=c(3),S=c(0),d=c(9),M=c(29),C=c(85),I=c(11),b=function(p){function x(P,A){var T=p.call(this,P,A)||this;return T.diffuse=new d.a(1,1,1),T.specular=new d.a(1,1,1),T.falloffType=x.FALLOFF_DEFAULT,T.intensity=1,T._range=Number.MAX_VALUE,T._inverseSquaredRange=0,T._photometricScale=1,T._intensityMode=x.INTENSITYMODE_AUTOMATIC,T._radius=1e-5,T.renderPriority=0,T._shadowEnabled=!0,T._excludeWithLayerMask=0,T._includeOnlyWithLayerMask=0,T._lightmapMode=0,T._excludedMeshesIds=new Array,T._includedOnlyMeshesIds=new Array,T._isLight=!0,T.getScene().addLight(T),T._uniformBuffer=new C.a(T.getScene().getEngine()),T._buildUniformLayout(),T.includedOnlyMeshes=new Array,T.excludedMeshes=new Array,T._resyncMeshes(),T}return Object(E.d)(x,p),Object.defineProperty(x.prototype,"range",{get:function(){return this._range},set:function(P){this._range=P,this._inverseSquaredRange=1/(this.range*this.range)},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"intensityMode",{get:function(){return this._intensityMode},set:function(P){this._intensityMode=P,this._computePhotometricScale()},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"radius",{get:function(){return this._radius},set:function(P){this._radius=P,this._computePhotometricScale()},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"shadowEnabled",{get:function(){return this._shadowEnabled},set:function(P){this._shadowEnabled!==P&&(this._shadowEnabled=P,this._markMeshesAsLightDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"includedOnlyMeshes",{get:function(){return this._includedOnlyMeshes},set:function(P){this._includedOnlyMeshes=P,this._hookArrayForIncludedOnly(P)},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"excludedMeshes",{get:function(){return this._excludedMeshes},set:function(P){this._excludedMeshes=P,this._hookArrayForExcluded(P)},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"excludeWithLayerMask",{get:function(){return this._excludeWithLayerMask},set:function(P){this._excludeWithLayerMask=P,this._resyncMeshes()},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"includeOnlyWithLayerMask",{get:function(){return this._includeOnlyWithLayerMask},set:function(P){this._includeOnlyWithLayerMask=P,this._resyncMeshes()},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"lightmapMode",{get:function(){return this._lightmapMode},set:function(P){this._lightmapMode!==P&&(this._lightmapMode=P,this._markMeshesAsLightDirty())},enumerable:!1,configurable:!0}),x.prototype.transferTexturesToEffect=function(P,A){return this},x.prototype._bindLight=function(P,A,T,_,g){g===void 0&&(g=!1);var O=P.toString(),R=!1;if(!g||!this._uniformBuffer._alreadyBound){if(this._uniformBuffer.bindToEffect(T,"Light"+O),this._renderId!==A.getRenderId()||!this._uniformBuffer.useUbo){this._renderId=A.getRenderId();var N=this.getScaledIntensity();this.transferToEffect(T,O),this.diffuse.scaleToRef(N,d.c.Color3[0]),this._uniformBuffer.updateColor4("vLightDiffuse",d.c.Color3[0],this.range,O),_&&(this.specular.scaleToRef(N,d.c.Color3[1]),this._uniformBuffer.updateColor4("vLightSpecular",d.c.Color3[1],this.radius,O)),R=!0}if(this.transferTexturesToEffect(T,O),A.shadowsEnabled&&this.shadowEnabled){var V=this.getShadowGenerator();V&&(V.bindShadowLight(O,T),R=!0)}R&&this._uniformBuffer.update()}},x.prototype.getClassName=function(){return"Light"},x.prototype.toString=function(P){var A="Name: "+this.name;if(A+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(var T=0;T<this.animations.length;T++)A+=", animation[0]: "+this.animations[T].toString(P);return A},x.prototype._syncParentEnabledState=function(){p.prototype._syncParentEnabledState.call(this),this.isDisposed()||this._resyncMeshes()},x.prototype.setEnabled=function(P){p.prototype.setEnabled.call(this,P),this._resyncMeshes()},x.prototype.getShadowGenerator=function(){return this._shadowGenerator},x.prototype.getAbsolutePosition=function(){return S.e.Zero()},x.prototype.canAffectMesh=function(P){return!P||!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&this.includedOnlyMeshes.indexOf(P)===-1)&&!(this.excludedMeshes&&this.excludedMeshes.length>0&&this.excludedMeshes.indexOf(P)!==-1)&&(this.includeOnlyWithLayerMask===0||(this.includeOnlyWithLayerMask&P.layerMask)!=0)&&!(this.excludeWithLayerMask!==0&&this.excludeWithLayerMask&P.layerMask)},x.CompareLightsPriority=function(P,A){return P.shadowEnabled!==A.shadowEnabled?(A.shadowEnabled?1:0)-(P.shadowEnabled?1:0):A.renderPriority-P.renderPriority},x.prototype.dispose=function(P,A){A===void 0&&(A=!1),this._shadowGenerator&&(this._shadowGenerator.dispose(),this._shadowGenerator=null),this.getScene().stopAnimation(this);for(var T=0,_=this.getScene().meshes;T<_.length;T++)_[T]._removeLightSource(this,!0);this._uniformBuffer.dispose(),this.getScene().removeLight(this),p.prototype.dispose.call(this,P,A)},x.prototype.getTypeID=function(){return 0},x.prototype.getScaledIntensity=function(){return this._photometricScale*this.intensity},x.prototype.clone=function(P,A){A===void 0&&(A=null);var T=x.GetConstructorFromName(this.getTypeID(),P,this.getScene());if(!T)return null;var _=m.a.Clone(T,this);return A&&(_.parent=A),_.setEnabled(this.isEnabled()),_},x.prototype.serialize=function(){var P=m.a.Serialize(this);return P.type=this.getTypeID(),this.parent&&(P.parentId=this.parent.id),this.excludedMeshes.length>0&&(P.excludedMeshesIds=[],this.excludedMeshes.forEach(function(A){P.excludedMeshesIds.push(A.id)})),this.includedOnlyMeshes.length>0&&(P.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach(function(A){P.includedOnlyMeshesIds.push(A.id)})),m.a.AppendSerializedAnimations(this,P),P.ranges=this.serializeAnimationRanges(),P},x.GetConstructorFromName=function(P,A,T){var _=M.a.Construct("Light_Type_"+P,A,T);return _||null},x.Parse=function(P,A){var T=x.GetConstructorFromName(P.type,P.name,A);if(!T)return null;var _=m.a.Parse(T,P,A);if(P.excludedMeshesIds&&(_._excludedMeshesIds=P.excludedMeshesIds),P.includedOnlyMeshesIds&&(_._includedOnlyMeshesIds=P.includedOnlyMeshesIds),P.parentId&&(_._waitingParentId=P.parentId),P.falloffType!==void 0&&(_.falloffType=P.falloffType),P.lightmapMode!==void 0&&(_.lightmapMode=P.lightmapMode),P.animations){for(var g=0;g<P.animations.length;g++){var O=P.animations[g],R=I.a.GetClass("BABYLON.Animation");R&&_.animations.push(R.Parse(O))}M.a.ParseAnimationRanges(_,P,A)}return P.autoAnimate&&A.beginAnimation(_,P.autoAnimateFrom,P.autoAnimateTo,P.autoAnimateLoop,P.autoAnimateSpeed||1),_},x.prototype._hookArrayForExcluded=function(P){var A=this,T=P.push;P.push=function(){for(var R=[],N=0;N<arguments.length;N++)R[N]=arguments[N];for(var V=T.apply(P,R),U=0,L=R;U<L.length;U++){var j=L[U];j._resyncLightSource(A)}return V};var _=P.splice;P.splice=function(R,N){for(var V=_.apply(P,[R,N]),U=0,L=V;U<L.length;U++)L[U]._resyncLightSource(A);return V};for(var g=0,O=P;g<O.length;g++)O[g]._resyncLightSource(this)},x.prototype._hookArrayForIncludedOnly=function(P){var A=this,T=P.push;P.push=function(){for(var g=[],O=0;O<arguments.length;O++)g[O]=arguments[O];var R=T.apply(P,g);return A._resyncMeshes(),R};var _=P.splice;P.splice=function(g,O){var R=_.apply(P,[g,O]);return A._resyncMeshes(),R},this._resyncMeshes()},x.prototype._resyncMeshes=function(){for(var P=0,A=this.getScene().meshes;P<A.length;P++)A[P]._resyncLightSource(this)},x.prototype._markMeshesAsLightDirty=function(){for(var P=0,A=this.getScene().meshes;P<A.length;P++){var T=A[P];T.lightSources.indexOf(this)!==-1&&T._markSubMeshesAsLightDirty()}},x.prototype._computePhotometricScale=function(){this._photometricScale=this._getPhotometricScale(),this.getScene().resetCachedMaterial()},x.prototype._getPhotometricScale=function(){var P=0,A=this.getTypeID(),T=this.intensityMode;switch(T===x.INTENSITYMODE_AUTOMATIC&&(T=A===x.LIGHTTYPEID_DIRECTIONALLIGHT?x.INTENSITYMODE_ILLUMINANCE:x.INTENSITYMODE_LUMINOUSINTENSITY),A){case x.LIGHTTYPEID_POINTLIGHT:case x.LIGHTTYPEID_SPOTLIGHT:switch(T){case x.INTENSITYMODE_LUMINOUSPOWER:P=1/(4*Math.PI);break;case x.INTENSITYMODE_LUMINOUSINTENSITY:P=1;break;case x.INTENSITYMODE_LUMINANCE:P=this.radius*this.radius}break;case x.LIGHTTYPEID_DIRECTIONALLIGHT:switch(T){case x.INTENSITYMODE_ILLUMINANCE:P=1;break;case x.INTENSITYMODE_LUMINANCE:var _=this.radius;_=Math.max(_,.001),P=2*Math.PI*(1-Math.cos(_))}break;case x.LIGHTTYPEID_HEMISPHERICLIGHT:P=1}return P},x.prototype._reorderLightsInScene=function(){var P=this.getScene();this._renderPriority!=0&&(P.requireLightSorting=!0),this.getScene().sortLightsByPriority()},x.FALLOFF_DEFAULT=0,x.FALLOFF_PHYSICAL=1,x.FALLOFF_GLTF=2,x.FALLOFF_STANDARD=3,x.LIGHTMAP_DEFAULT=0,x.LIGHTMAP_SPECULAR=1,x.LIGHTMAP_SHADOWSONLY=2,x.INTENSITYMODE_AUTOMATIC=0,x.INTENSITYMODE_LUMINOUSPOWER=1,x.INTENSITYMODE_LUMINOUSINTENSITY=2,x.INTENSITYMODE_ILLUMINANCE=3,x.INTENSITYMODE_LUMINANCE=4,x.LIGHTTYPEID_POINTLIGHT=0,x.LIGHTTYPEID_DIRECTIONALLIGHT=1,x.LIGHTTYPEID_SPOTLIGHT=2,x.LIGHTTYPEID_HEMISPHERICLIGHT=3,Object(E.c)([Object(m.e)()],x.prototype,"diffuse",void 0),Object(E.c)([Object(m.e)()],x.prototype,"specular",void 0),Object(E.c)([Object(m.c)()],x.prototype,"falloffType",void 0),Object(E.c)([Object(m.c)()],x.prototype,"intensity",void 0),Object(E.c)([Object(m.c)()],x.prototype,"range",null),Object(E.c)([Object(m.c)()],x.prototype,"intensityMode",null),Object(E.c)([Object(m.c)()],x.prototype,"radius",null),Object(E.c)([Object(m.c)()],x.prototype,"_renderPriority",void 0),Object(E.c)([Object(m.b)("_reorderLightsInScene")],x.prototype,"renderPriority",void 0),Object(E.c)([Object(m.c)("shadowEnabled")],x.prototype,"_shadowEnabled",void 0),Object(E.c)([Object(m.c)("excludeWithLayerMask")],x.prototype,"_excludeWithLayerMask",void 0),Object(E.c)([Object(m.c)("includeOnlyWithLayerMask")],x.prototype,"_includeOnlyWithLayerMask",void 0),Object(E.c)([Object(m.c)("lightmapMode")],x.prototype,"_lightmapMode",void 0),x}(M.a)},function(h,s,c){c.d(s,"a",function(){return E});var E=function(){function m(){this._xhr=typeof _native!="undefined"&&_native.XMLHttpRequest?new _native.XMLHttpRequest:new XMLHttpRequest}return m.prototype._injectCustomRequestHeaders=function(){for(var S in m.CustomRequestHeaders){var d=m.CustomRequestHeaders[S];d&&this._xhr.setRequestHeader(S,d)}},Object.defineProperty(m.prototype,"onprogress",{get:function(){return this._xhr.onprogress},set:function(S){this._xhr.onprogress=S},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"readyState",{get:function(){return this._xhr.readyState},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"status",{get:function(){return this._xhr.status},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"statusText",{get:function(){return this._xhr.statusText},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"response",{get:function(){return this._xhr.response},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"responseURL",{get:function(){return this._xhr.responseURL},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"responseText",{get:function(){return this._xhr.responseText},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"responseType",{get:function(){return this._xhr.responseType},set:function(S){this._xhr.responseType=S},enumerable:!1,configurable:!0}),m.prototype.addEventListener=function(S,d,M){this._xhr.addEventListener(S,d,M)},m.prototype.removeEventListener=function(S,d,M){this._xhr.removeEventListener(S,d,M)},m.prototype.abort=function(){this._xhr.abort()},m.prototype.send=function(S){m.CustomRequestHeaders&&this._injectCustomRequestHeaders(),this._xhr.send(S)},m.prototype.open=function(S,d){for(var M=0,C=m.CustomRequestModifiers;M<C.length;M++)(0,C[M])(this._xhr,d);return d=(d=d.replace("file:http:","http:")).replace("file:https:","https:"),this._xhr.open(S,d,!0)},m.prototype.setRequestHeader=function(S,d){this._xhr.setRequestHeader(S,d)},m.prototype.getResponseHeader=function(S){return this._xhr.getResponseHeader(S)},m.CustomRequestHeaders={},m.CustomRequestModifiers=new Array,m}()},function(h,s,c){c.d(s,"e",function(){return m}),c.d(s,"a",function(){return S}),c.d(s,"d",function(){return d}),c.d(s,"c",function(){return M}),c.d(s,"b",function(){return C});var E=c(1),m=function(){function I(b,p){this.type=b,this.jointData=p,p.nativeParams=p.nativeParams||{}}return Object.defineProperty(I.prototype,"physicsJoint",{get:function(){return this._physicsJoint},set:function(b){this._physicsJoint,this._physicsJoint=b},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"physicsPlugin",{set:function(b){this._physicsPlugin=b},enumerable:!1,configurable:!0}),I.prototype.executeNativeFunction=function(b){b(this._physicsPlugin.world,this._physicsJoint)},I.DistanceJoint=0,I.HingeJoint=1,I.BallAndSocketJoint=2,I.WheelJoint=3,I.SliderJoint=4,I.PrismaticJoint=5,I.UniversalJoint=6,I.Hinge2Joint=I.WheelJoint,I.PointToPointJoint=8,I.SpringJoint=9,I.LockJoint=10,I}(),S=function(I){function b(p){return I.call(this,m.DistanceJoint,p)||this}return Object(E.d)(b,I),b.prototype.updateDistance=function(p,x){this._physicsPlugin.updateDistanceJoint(this,p,x)},b}(m),d=function(I){function b(p,x){return I.call(this,p,x)||this}return Object(E.d)(b,I),b.prototype.setMotor=function(p,x){this._physicsPlugin.setMotor(this,p||0,x)},b.prototype.setLimit=function(p,x){this._physicsPlugin.setLimit(this,p,x)},b}(m),M=function(I){function b(p){return I.call(this,m.HingeJoint,p)||this}return Object(E.d)(b,I),b.prototype.setMotor=function(p,x){this._physicsPlugin.setMotor(this,p||0,x)},b.prototype.setLimit=function(p,x){this._physicsPlugin.setLimit(this,p,x)},b}(d),C=function(I){function b(p){return I.call(this,m.Hinge2Joint,p)||this}return Object(E.d)(b,I),b.prototype.setMotor=function(p,x,P){P===void 0&&(P=0),this._physicsPlugin.setMotor(this,p||0,x,P)},b.prototype.setLimit=function(p,x,P){P===void 0&&(P=0),this._physicsPlugin.setLimit(this,p,x,P)},b}(d)},function(h,s,c){c.d(s,"a",function(){return M});var E=c(0),m=c(7),S=c(36),d=c(18),M=function(){function C(I){var b=this;I===void 0&&(I=S.a.DefaultUtilityLayer),this.gizmoLayer=I,this._attachedMesh=null,this._attachedNode=null,this._scaleRatio=1,this._isHovered=!1,this._customMeshSet=!1,this._updateGizmoRotationToMatchAttachedMesh=!0,this.updateGizmoPositionToMatchAttachedMesh=!0,this.updateScale=!0,this._interactionsEnabled=!0,this._tempQuaternion=new E.b(0,0,0,1),this._tempVector=new E.e,this._tempVector2=new E.e,this._tempMatrix1=new E.a,this._tempMatrix2=new E.a,this._rightHandtoLeftHandMatrix=E.a.RotationY(Math.PI),this._rootMesh=new m.a("gizmoRootNode",I.utilityLayerScene),this._rootMesh.rotationQuaternion=E.b.Identity(),this._beforeRenderObserver=this.gizmoLayer.utilityLayerScene.onBeforeRenderObservable.add(function(){b._update()})}return Object.defineProperty(C.prototype,"scaleRatio",{get:function(){return this._scaleRatio},set:function(I){this._scaleRatio=I},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"isHovered",{get:function(){return this._isHovered},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"attachedMesh",{get:function(){return this._attachedMesh},set:function(I){this._attachedMesh=I,I&&(this._attachedNode=I),this._rootMesh.setEnabled(!!I),this._attachedNodeChanged(I)},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"attachedNode",{get:function(){return this._attachedNode},set:function(I){this._attachedNode=I,this._attachedMesh=null,this._rootMesh.setEnabled(!!I),this._attachedNodeChanged(I)},enumerable:!1,configurable:!0}),C.prototype.setCustomMesh=function(I){if(I.getScene()!=this.gizmoLayer.utilityLayerScene)throw"When setting a custom mesh on a gizmo, the custom meshes scene must be the same as the gizmos (eg. gizmo.gizmoLayer.utilityLayerScene)";this._rootMesh.getChildMeshes().forEach(function(b){b.dispose()}),I.parent=this._rootMesh,this._customMeshSet=!0},Object.defineProperty(C.prototype,"updateGizmoRotationToMatchAttachedMesh",{get:function(){return this._updateGizmoRotationToMatchAttachedMesh},set:function(I){this._updateGizmoRotationToMatchAttachedMesh=I},enumerable:!1,configurable:!0}),C.prototype._attachedNodeChanged=function(I){},C.prototype._update=function(){if(this.attachedNode){var I=this.attachedNode;if(this.attachedMesh&&(I=this.attachedMesh._effectiveMesh||this.attachedNode),this.updateGizmoPositionToMatchAttachedMesh){var b=I.getWorldMatrix().getRow(3),p=b?b.toVector3():new E.e(0,0,0);this._rootMesh.position.copyFrom(p)}if(this.updateGizmoRotationToMatchAttachedMesh?I.getWorldMatrix().decompose(void 0,this._rootMesh.rotationQuaternion):this._rootMesh.rotationQuaternion.set(0,0,0,1),this.updateScale){var x=this.gizmoLayer.utilityLayerScene.activeCamera,P=x.globalPosition;x.devicePosition&&(P=x.devicePosition),this._rootMesh.position.subtractToRef(P,this._tempVector);var A=this._tempVector.length()*this.scaleRatio;this._rootMesh.scaling.set(A,A,A),I._getWorldMatrixDeterminant()<0&&(this._rootMesh.scaling.y*=-1)}else this._rootMesh.scaling.setAll(this.scaleRatio)}},C.prototype._matrixChanged=function(){if(this._attachedNode){if(this._attachedNode._isCamera){var I,b,p=this._attachedNode;if(p.parent){var x=this._tempMatrix2;p.parent._worldMatrix.invertToRef(x),this._attachedNode._worldMatrix.multiplyToRef(x,this._tempMatrix1),I=this._tempMatrix1}else I=this._attachedNode._worldMatrix;if(p.getScene().useRightHandedSystem?(this._rightHandtoLeftHandMatrix.multiplyToRef(I,this._tempMatrix2),b=this._tempMatrix2):b=I,b.decompose(this._tempVector2,this._tempQuaternion,this._tempVector),this._attachedNode.getClassName()==="FreeCamera"||this._attachedNode.getClassName()==="FlyCamera"||this._attachedNode.getClassName()==="ArcFollowCamera"||this._attachedNode.getClassName()==="TargetCamera"||this._attachedNode.getClassName()==="TouchCamera"||this._attachedNode.getClassName()==="UniversalCamera"){var P=this._attachedNode;P.rotation=this._tempQuaternion.toEulerAngles(),P.rotationQuaternion&&P.rotationQuaternion.copyFrom(this._tempQuaternion)}p.position.copyFrom(this._tempVector)}else if(this._attachedNode._isMesh||this._attachedNode.getClassName()==="AbstractMesh"||this._attachedNode.getClassName()==="TransformNode"||this._attachedNode.getClassName()==="InstancedMesh"){var A=this._attachedNode;if(A.parent){x=this._tempMatrix1;var T=this._tempMatrix2;A.parent.getWorldMatrix().invertToRef(x),this._attachedNode.getWorldMatrix().multiplyToRef(x,T),T.decompose(A.scaling,this._tempQuaternion,A.position)}else this._attachedNode._worldMatrix.decompose(A.scaling,this._tempQuaternion,A.position);A.billboardMode||(A.rotationQuaternion?A.rotationQuaternion.copyFrom(this._tempQuaternion):A.rotation=this._tempQuaternion.toEulerAngles())}else if(this._attachedNode.getClassName()==="Bone"){var _=this._attachedNode,g=_.getParent();if(g){var O=this._tempMatrix1,R=this._tempMatrix2;g.getWorldMatrix().invertToRef(O),_.getWorldMatrix().multiplyToRef(O,R),_.getLocalMatrix().copyFrom(R)}else _.getLocalMatrix().copyFrom(_.getWorldMatrix());_.markAsDirty()}}},C.GizmoAxisPointerObserver=function(I,b){var p=!1;return I.utilityLayerScene.onPointerObservable.add(function(x){var P,A;if(x.pickInfo){if(x.type===d.a.POINTERMOVE){if(p)return;b.forEach(function(T){var _,g;if(T.colliderMeshes&&T.gizmoMeshes){var O=((_=T.colliderMeshes)===null||_===void 0?void 0:_.indexOf((g=x==null?void 0:x.pickInfo)===null||g===void 0?void 0:g.pickedMesh))!=-1||T.active?T.hoverMaterial:T.material;T.gizmoMeshes.forEach(function(R){R.material=O,R.color&&(R.color=O.diffuseColor)})}})}x.type===d.a.POINTERDOWN&&b.has((P=x.pickInfo.pickedMesh)===null||P===void 0?void 0:P.parent)&&(p=!0,b.get((A=x.pickInfo.pickedMesh)===null||A===void 0?void 0:A.parent).active=!0,b.forEach(function(T){var _,g,O=((_=T.colliderMeshes)===null||_===void 0?void 0:_.indexOf((g=x==null?void 0:x.pickInfo)===null||g===void 0?void 0:g.pickedMesh))!=-1||T.active?T.hoverMaterial:T.disableMaterial;T.gizmoMeshes.forEach(function(R){R.material=O,R.color&&(R.color=O.diffuseColor)})})),x.type===d.a.POINTERUP&&b.forEach(function(T){T.active=!1,p=!1,T.gizmoMeshes.forEach(function(_){_.material=T.material,_.color&&(_.color=T.material.diffuseColor)})})}})},C.prototype.dispose=function(){this._rootMesh.dispose(),this._beforeRenderObserver&&this.gizmoLayer.utilityLayerScene.onBeforeRenderObservable.remove(this._beforeRenderObserver)},C}()},function(h,s,c){c.d(s,"a",function(){return p});var E=c(1),m=c(3),S=c(6),d=c(0),M=c(22),C=c(2),I=c(120),b=(c(56),c(77)),p=function(x){function P(A){var T=x.call(this,null)||this;return T.metadata=null,T.reservedDataStore=null,T._hasAlpha=!1,T.getAlphaFromRGB=!1,T.level=1,T.coordinatesIndex=0,T._coordinatesMode=C.a.TEXTURE_EXPLICIT_MODE,T.wrapR=C.a.TEXTURE_WRAP_ADDRESSMODE,T.anisotropicFilteringLevel=P.DEFAULT_ANISOTROPIC_FILTERING_LEVEL,T._isCube=!1,T._gammaSpace=!0,T.invertZ=!1,T.lodLevelInAlpha=!1,T.isRenderTarget=!1,T._prefiltered=!1,T.animations=new Array,T.onDisposeObservable=new S.c,T._onDisposeObserver=null,T._scene=null,T._texture=null,T._uid=null,A?P._isScene(A)?T._scene=A:T._engine=A:T._scene=M.a.LastCreatedScene,T._scene&&(T.uniqueId=T._scene.getUniqueId(),T._scene.addTexture(T),T._engine=T._scene.getEngine()),T._uid=null,T}return Object(E.d)(P,x),Object.defineProperty(P.prototype,"hasAlpha",{get:function(){return this._hasAlpha},set:function(A){this._hasAlpha!==A&&(this._hasAlpha=A,this._scene&&this._scene.markAllMaterialsAsDirty(C.a.MATERIAL_TextureDirtyFlag|C.a.MATERIAL_MiscDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"coordinatesMode",{get:function(){return this._coordinatesMode},set:function(A){this._coordinatesMode!==A&&(this._coordinatesMode=A,this._scene&&this._scene.markAllMaterialsAsDirty(C.a.MATERIAL_TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"wrapU",{get:function(){return this._wrapU},set:function(A){this._wrapU=A},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"wrapV",{get:function(){return this._wrapV},set:function(A){this._wrapV=A},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"isCube",{get:function(){return this._texture?this._texture.isCube:this._isCube},set:function(A){this._texture?this._texture.isCube=A:this._isCube=A},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"is3D",{get:function(){return!!this._texture&&this._texture.is3D},set:function(A){this._texture&&(this._texture.is3D=A)},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"is2DArray",{get:function(){return!!this._texture&&this._texture.is2DArray},set:function(A){this._texture&&(this._texture.is2DArray=A)},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"gammaSpace",{get:function(){return this._texture?(this._texture._gammaSpace===null&&(this._texture._gammaSpace=this._gammaSpace),this._texture._gammaSpace):this._gammaSpace},set:function(A){if(this._texture){if(this._texture._gammaSpace===A)return;this._texture._gammaSpace=A}else{if(this._gammaSpace===A)return;this._gammaSpace=A}this._markAllSubMeshesAsTexturesDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"isRGBD",{get:function(){return this._texture!=null&&this._texture._isRGBD},set:function(A){this._texture&&(this._texture._isRGBD=A)},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"noMipmap",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"lodGenerationOffset",{get:function(){return this._texture?this._texture._lodGenerationOffset:0},set:function(A){this._texture&&(this._texture._lodGenerationOffset=A)},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"lodGenerationScale",{get:function(){return this._texture?this._texture._lodGenerationScale:0},set:function(A){this._texture&&(this._texture._lodGenerationScale=A)},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"linearSpecularLOD",{get:function(){return!!this._texture&&this._texture._linearSpecularLOD},set:function(A){this._texture&&(this._texture._linearSpecularLOD=A)},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"irradianceTexture",{get:function(){return this._texture?this._texture._irradianceTexture:null},set:function(A){this._texture&&(this._texture._irradianceTexture=A)},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"uid",{get:function(){return this._uid||(this._uid=I.a.RandomId()),this._uid},enumerable:!1,configurable:!0}),P.prototype.toString=function(){return this.name},P.prototype.getClassName=function(){return"BaseTexture"},Object.defineProperty(P.prototype,"onDispose",{set:function(A){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(A)},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"isBlocking",{get:function(){return!0},enumerable:!1,configurable:!0}),P.prototype.getScene=function(){return this._scene},P.prototype._getEngine=function(){return this._engine},P.prototype.checkTransformsAreIdentical=function(A){return A!==null},P.prototype.getTextureMatrix=function(){return d.a.IdentityReadOnly},P.prototype.getReflectionTextureMatrix=function(){return d.a.IdentityReadOnly},P.prototype.isReadyOrNotBlocking=function(){return!this.isBlocking||this.isReady()},P.prototype.scale=function(A){},Object.defineProperty(P.prototype,"canRescale",{get:function(){return!1},enumerable:!1,configurable:!0}),P.prototype._getFromCache=function(A,T,_,g){var O=this._getEngine();if(!O)return null;for(var R=O.getLoadedTexturesCache(),N=0;N<R.length;N++){var V=R[N];if(!(g!==void 0&&g!==V.invertY||V.url!==A||V.generateMipMaps!==!T||_&&_!==V.samplingMode))return V.incrementReferences(),V}return null},P.prototype._rebuild=function(){},P.prototype.clone=function(){return null},Object.defineProperty(P.prototype,"textureType",{get:function(){return this._texture&&this._texture.type!==void 0?this._texture.type:C.a.TEXTURETYPE_UNSIGNED_INT},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"textureFormat",{get:function(){return this._texture&&this._texture.format!==void 0?this._texture.format:C.a.TEXTUREFORMAT_RGBA},enumerable:!1,configurable:!0}),P.prototype._markAllSubMeshesAsTexturesDirty=function(){var A=this.getScene();A&&A.markAllMaterialsAsDirty(C.a.MATERIAL_TextureDirtyFlag)},P.prototype.readPixels=function(A,T,_){if(A===void 0&&(A=0),T===void 0&&(T=0),_===void 0&&(_=null),!this._texture)return null;var g=this.getSize(),O=g.width,R=g.height,N=this._getEngine();if(!N)return null;T!=0&&(O/=Math.pow(2,T),R/=Math.pow(2,T),O=Math.round(O),R=Math.round(R));try{return this._texture.isCube?N._readTexturePixels(this._texture,O,R,A,T,_):N._readTexturePixels(this._texture,O,R,-1,T,_)}catch(V){return null}},Object.defineProperty(P.prototype,"_lodTextureHigh",{get:function(){return this._texture?this._texture._lodTextureHigh:null},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"_lodTextureMid",{get:function(){return this._texture?this._texture._lodTextureMid:null},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"_lodTextureLow",{get:function(){return this._texture?this._texture._lodTextureLow:null},enumerable:!1,configurable:!0}),P.prototype.dispose=function(){if(this._scene){this._scene.stopAnimation&&this._scene.stopAnimation(this),this._scene._removePendingData(this);var A=this._scene.textures.indexOf(this);A>=0&&this._scene.textures.splice(A,1),this._scene.onTextureRemovedObservable.notifyObservers(this),this._scene=null}this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),x.prototype.dispose.call(this)},P.prototype.serialize=function(){if(!this.name)return null;var A=m.a.Serialize(this);return m.a.AppendSerializedAnimations(this,A),A},P.WhenAllReady=function(A,T){var _=A.length;if(_!==0)for(var g=0;g<A.length;g++){var O=A[g];if(O.isReady())--_==0&&T();else{var R=O.onLoadObservable;R&&R.addOnce(function(){--_==0&&T()})}}else T()},P._isScene=function(A){return A.getClassName()==="Scene"},P.DEFAULT_ANISOTROPIC_FILTERING_LEVEL=4,Object(E.c)([Object(m.c)()],P.prototype,"uniqueId",void 0),Object(E.c)([Object(m.c)()],P.prototype,"name",void 0),Object(E.c)([Object(m.c)()],P.prototype,"metadata",void 0),Object(E.c)([Object(m.c)("hasAlpha")],P.prototype,"_hasAlpha",void 0),Object(E.c)([Object(m.c)()],P.prototype,"getAlphaFromRGB",void 0),Object(E.c)([Object(m.c)()],P.prototype,"level",void 0),Object(E.c)([Object(m.c)()],P.prototype,"coordinatesIndex",void 0),Object(E.c)([Object(m.c)("coordinatesMode")],P.prototype,"_coordinatesMode",void 0),Object(E.c)([Object(m.c)()],P.prototype,"wrapU",null),Object(E.c)([Object(m.c)()],P.prototype,"wrapV",null),Object(E.c)([Object(m.c)()],P.prototype,"wrapR",void 0),Object(E.c)([Object(m.c)()],P.prototype,"anisotropicFilteringLevel",void 0),Object(E.c)([Object(m.c)()],P.prototype,"isCube",null),Object(E.c)([Object(m.c)()],P.prototype,"is3D",null),Object(E.c)([Object(m.c)()],P.prototype,"is2DArray",null),Object(E.c)([Object(m.c)()],P.prototype,"gammaSpace",null),Object(E.c)([Object(m.c)()],P.prototype,"invertZ",void 0),Object(E.c)([Object(m.c)()],P.prototype,"lodLevelInAlpha",void 0),Object(E.c)([Object(m.c)()],P.prototype,"lodGenerationOffset",null),Object(E.c)([Object(m.c)()],P.prototype,"lodGenerationScale",null),Object(E.c)([Object(m.c)()],P.prototype,"linearSpecularLOD",null),Object(E.c)([Object(m.m)()],P.prototype,"irradianceTexture",null),Object(E.c)([Object(m.c)()],P.prototype,"isRenderTarget",void 0),P}(function(){function x(P){this._wrapU=C.a.TEXTURE_WRAP_ADDRESSMODE,this._wrapV=C.a.TEXTURE_WRAP_ADDRESSMODE,this.wrapR=C.a.TEXTURE_WRAP_ADDRESSMODE,this.anisotropicFilteringLevel=4,this.delayLoadState=C.a.DELAYLOADSTATE_NONE,this._texture=null,this._engine=null,this._cachedSize=b.a.Zero(),this._cachedBaseSize=b.a.Zero(),this._texture=P,this._texture&&(this._engine=this._texture.getEngine())}return Object.defineProperty(x.prototype,"wrapU",{get:function(){return this._wrapU},set:function(P){this._wrapU=P},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"wrapV",{get:function(){return this._wrapV},set:function(P){this._wrapV=P},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"coordinatesMode",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"isCube",{get:function(){return!!this._texture&&this._texture.isCube},set:function(P){this._texture&&(this._texture.isCube=P)},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"is3D",{get:function(){return!!this._texture&&this._texture.is3D},set:function(P){this._texture&&(this._texture.is3D=P)},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"is2DArray",{get:function(){return!!this._texture&&this._texture.is2DArray},set:function(P){this._texture&&(this._texture.is2DArray=P)},enumerable:!1,configurable:!0}),x.prototype.getClassName=function(){return"ThinTexture"},x.prototype.isReady=function(){return this.delayLoadState===C.a.DELAYLOADSTATE_NOTLOADED?(this.delayLoad(),!1):!!this._texture&&this._texture.isReady},x.prototype.delayLoad=function(){},x.prototype.getInternalTexture=function(){return this._texture},x.prototype.getSize=function(){if(this._texture){if(this._texture.width)return this._cachedSize.width=this._texture.width,this._cachedSize.height=this._texture.height,this._cachedSize;if(this._texture._size)return this._cachedSize.width=this._texture._size,this._cachedSize.height=this._texture._size,this._cachedSize}return this._cachedSize},x.prototype.getBaseSize=function(){return this.isReady()&&this._texture?this._texture._size?(this._cachedBaseSize.width=this._texture._size,this._cachedBaseSize.height=this._texture._size,this._cachedBaseSize):(this._cachedBaseSize.width=this._texture.baseWidth,this._cachedBaseSize.height=this._texture.baseHeight,this._cachedBaseSize):(this._cachedBaseSize.width=0,this._cachedBaseSize.height=0,this._cachedBaseSize)},x.prototype.updateSamplingMode=function(P){this._texture&&this._engine&&this._engine.updateTextureSamplingMode(P,this._texture)},x.prototype.releaseInternalTexture=function(){this._texture&&(this._texture.dispose(),this._texture=null)},x.prototype.dispose=function(){this._texture&&(this.releaseInternalTexture(),this._engine=null)},x}())},function(h,s,c){c.d(s,"a",function(){return I});var E=c(0),m=c(9),S=c(7),d=c(16),M=c(20),C=c(23);d.a.CreateCylinder=function(b){var p=b.height||2,x=b.diameterTop===0?0:b.diameterTop||b.diameter||1,P=b.diameterBottom===0?0:b.diameterBottom||b.diameter||1;x=x||1e-5,P=P||1e-5;var A,T=b.tessellation||24,_=b.subdivisions||1,g=!!b.hasRings,O=!!b.enclose,R=b.cap===0?0:b.cap||S.a.CAP_ALL,N=b.arc&&(b.arc<=0||b.arc>1)?1:b.arc||1,V=b.sideOrientation===0?0:b.sideOrientation||d.a.DEFAULTSIDE,U=b.faceUV||new Array(3),L=b.faceColors,j=2+(1+(N!==1&&O?2:0))*(g?_:1);for(A=0;A<j;A++)L&&L[A]===void 0&&(L[A]=new m.b(1,1,1,1));for(A=0;A<j;A++)U&&U[A]===void 0&&(U[A]=new E.f(0,0,1,1));var Y,W,re,ne,ge,_e,ce=new Array,ie=new Array,Z=new Array,te=new Array,B=new Array,G=2*Math.PI*N/T,$=(P-x)/2/p,le=E.e.Zero(),se=E.e.Zero(),q=E.e.Zero(),H=E.e.Zero(),X=E.e.Zero(),J=C.a.Y,Q=1,ee=1,pe=0,Te=0;for(ne=0;ne<=_;ne++)for(re=((W=ne/_)*(x-P)+P)/2,Q=g&&ne!==0&&ne!==_?2:1,_e=0;_e<Q;_e++){for(g&&(ee+=_e),O&&(ee+=2*_e),ge=0;ge<=T;ge++)Y=ge*G,le.x=Math.cos(-Y)*re,le.y=-p/2+W*p,le.z=Math.sin(-Y)*re,x===0&&ne===_?(se.x=Z[Z.length-3*(T+1)],se.y=Z[Z.length-3*(T+1)+1],se.z=Z[Z.length-3*(T+1)+2]):(se.x=le.x,se.z=le.z,se.y=Math.sqrt(se.x*se.x+se.z*se.z)*$,se.normalize()),ge===0&&(q.copyFrom(le),H.copyFrom(se)),ie.push(le.x,le.y,le.z),Z.push(se.x,se.y,se.z),Te=g?pe!==ee?U[ee].y:U[ee].w:U[ee].y+(U[ee].w-U[ee].y)*W,te.push(U[ee].x+(U[ee].z-U[ee].x)*ge/T,Te),L&&B.push(L[ee].r,L[ee].g,L[ee].b,L[ee].a);N!==1&&O&&(ie.push(le.x,le.y,le.z),ie.push(0,le.y,0),ie.push(0,le.y,0),ie.push(q.x,q.y,q.z),E.e.CrossToRef(J,se,X),X.normalize(),Z.push(X.x,X.y,X.z,X.x,X.y,X.z),E.e.CrossToRef(H,J,X),X.normalize(),Z.push(X.x,X.y,X.z,X.x,X.y,X.z),Te=g?pe!==ee?U[ee+1].y:U[ee+1].w:U[ee+1].y+(U[ee+1].w-U[ee+1].y)*W,te.push(U[ee+1].x,Te),te.push(U[ee+1].z,Te),Te=g?pe!==ee?U[ee+2].y:U[ee+2].w:U[ee+2].y+(U[ee+2].w-U[ee+2].y)*W,te.push(U[ee+2].x,Te),te.push(U[ee+2].z,Te),L&&(B.push(L[ee+1].r,L[ee+1].g,L[ee+1].b,L[ee+1].a),B.push(L[ee+1].r,L[ee+1].g,L[ee+1].b,L[ee+1].a),B.push(L[ee+2].r,L[ee+2].g,L[ee+2].b,L[ee+2].a),B.push(L[ee+2].r,L[ee+2].g,L[ee+2].b,L[ee+2].a))),pe!==ee&&(pe=ee)}var ve=N!==1&&O?T+4:T;for(ne=0,ee=0;ee<_;ee++){var he=0,be=0,xe=0,Se=0;for(ge=0;ge<T;ge++)he=ne*(ve+1)+ge,be=(ne+1)*(ve+1)+ge,xe=ne*(ve+1)+(ge+1),Se=(ne+1)*(ve+1)+(ge+1),ce.push(he,be,xe),ce.push(Se,xe,be);N!==1&&O&&(ce.push(he+2,be+2,xe+2),ce.push(Se+2,xe+2,be+2),ce.push(he+4,be+4,xe+4),ce.push(Se+4,xe+4,be+4)),ne=g?ne+2:ne+1}var Ue=function(Ze){var Qe=Ze?x/2:P/2;if(Qe!==0){var Xe,nt,Ke,ct=Ze?U[j-1]:U[0],ot=null;L&&(ot=Ze?L[j-1]:L[0]);var _t=ie.length/3,gt=Ze?p/2:-p/2,At=new E.e(0,gt,0);ie.push(At.x,At.y,At.z),Z.push(0,Ze?1:-1,0),te.push(ct.x+.5*(ct.z-ct.x),ct.y+.5*(ct.w-ct.y)),ot&&B.push(ot.r,ot.g,ot.b,ot.a);var wt=new E.d(.5,.5);for(Ke=0;Ke<=T;Ke++){Xe=2*Math.PI*Ke*N/T;var Qt=Math.cos(-Xe),Wt=Math.sin(-Xe);nt=new E.e(Qt*Qe,gt,Wt*Qe);var Ft=new E.d(Qt*wt.x+.5,Wt*wt.y+.5);ie.push(nt.x,nt.y,nt.z),Z.push(0,Ze?1:-1,0),te.push(ct.x+(ct.z-ct.x)*Ft.x,ct.y+(ct.w-ct.y)*Ft.y),ot&&B.push(ot.r,ot.g,ot.b,ot.a)}for(Ke=0;Ke<T;Ke++)Ze?(ce.push(_t),ce.push(_t+(Ke+2)),ce.push(_t+(Ke+1))):(ce.push(_t),ce.push(_t+(Ke+1)),ce.push(_t+(Ke+2)))}};R!==S.a.CAP_START&&R!==S.a.CAP_ALL||Ue(!1),R!==S.a.CAP_END&&R!==S.a.CAP_ALL||Ue(!0),d.a._ComputeSides(V,ie,ce,Z,te,b.frontUVs,b.backUVs);var We=new d.a;return We.indices=ce,We.positions=ie,We.normals=Z,We.uvs=te,L&&(We.colors=B),We},S.a.CreateCylinder=function(b,p,x,P,A,T,_,g,O){_!==void 0&&_ instanceof M.a||(_!==void 0&&(O=g||S.a.DEFAULTSIDE,g=_),_=T,T=1);var R={height:p,diameterTop:x,diameterBottom:P,tessellation:A,subdivisions:T,sideOrientation:O,updatable:g};return I.CreateCylinder(b,R,_)};var I=function(){function b(){}return b.CreateCylinder=function(p,x,P){var A=new S.a(p,P);return x.sideOrientation=S.a._GetDefaultSideOrientation(x.sideOrientation),A._originalBuilderSideOrientation=x.sideOrientation,d.a.CreateCylinder(x).applyToMesh(A,x.updatable),A},b}()},function(h,s,c){c.d(s,"a",function(){return S});var E=c(0),m=c(4),S=function(){function d(){this._pickingUnavailable=!1,this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshFaceId=-1,this.subMeshId=0,this.pickedSprite=null,this.thinInstanceIndex=-1,this.originMesh=null,this.ray=null}return d.prototype.getNormal=function(M,C){if(M===void 0&&(M=!1),C===void 0&&(C=!0),!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(m.b.NormalKind))return null;var I,b=this.pickedMesh.getIndices();if(!b)return null;if(C){var p=this.pickedMesh.getVerticesData(m.b.NormalKind),x=E.e.FromArray(p,3*b[3*this.faceId]),P=E.e.FromArray(p,3*b[3*this.faceId+1]),A=E.e.FromArray(p,3*b[3*this.faceId+2]);x=x.scale(this.bu),P=P.scale(this.bv),A=A.scale(1-this.bu-this.bv),I=new E.e(x.x+P.x+A.x,x.y+P.y+A.y,x.z+P.z+A.z)}else{var T=this.pickedMesh.getVerticesData(m.b.PositionKind),_=E.e.FromArray(T,3*b[3*this.faceId]),g=E.e.FromArray(T,3*b[3*this.faceId+1]),O=E.e.FromArray(T,3*b[3*this.faceId+2]),R=_.subtract(g),N=O.subtract(g);I=E.e.Cross(R,N)}if(M){var V=this.pickedMesh.getWorldMatrix();this.pickedMesh.nonUniformScaling&&(E.c.Matrix[0].copyFrom(V),(V=E.c.Matrix[0]).setTranslationFromFloats(0,0,0),V.invert(),V.transposeToRef(E.c.Matrix[1]),V=E.c.Matrix[1]),I=E.e.TransformNormal(I,V)}return I.normalize(),I},d.prototype.getTextureCoordinates=function(){if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(m.b.UVKind))return null;var M=this.pickedMesh.getIndices();if(!M)return null;var C=this.pickedMesh.getVerticesData(m.b.UVKind);if(!C)return null;var I=E.d.FromArray(C,2*M[3*this.faceId]),b=E.d.FromArray(C,2*M[3*this.faceId+1]),p=E.d.FromArray(C,2*M[3*this.faceId+2]);return I=I.scale(this.bu),b=b.scale(this.bv),p=p.scale(1-this.bu-this.bv),new E.d(I.x+b.x+p.x,I.y+b.y+p.y)},d}()},function(h,s,c){c.d(s,"a",function(){return m});var E=c(57),m=function(){function S(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}return Object.defineProperty(S.prototype,"min",{get:function(){return this._min},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"max",{get:function(){return this._max},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"average",{get:function(){return this._average},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"lastSecAverage",{get:function(){return this._lastSecAverage},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"current",{get:function(){return this._current},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"total",{get:function(){return this._totalAccumulated},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"count",{get:function(){return this._totalValueCount},enumerable:!1,configurable:!0}),S.prototype.fetchNewFrame=function(){this._totalValueCount++,this._current=0,this._lastSecValueCount++},S.prototype.addCount=function(d,M){S.Enabled&&(this._current+=d,M&&this._fetchResult())},S.prototype.beginMonitoring=function(){S.Enabled&&(this._startMonitoringTime=E.a.Now)},S.prototype.endMonitoring=function(d){if(d===void 0&&(d=!0),S.Enabled){d&&this.fetchNewFrame();var M=E.a.Now;this._current=M-this._startMonitoringTime,d&&this._fetchResult()}},S.prototype._fetchResult=function(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;var d=E.a.Now;d-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=d,this._lastSecAccumulated=0,this._lastSecValueCount=0)},S.Enabled=!0,S}()},function(h,s,c){c.d(s,"b",function(){return P}),c.d(s,"d",function(){return A}),c.d(s,"c",function(){return T}),c.d(s,"a",function(){return _});var E=c(1),m=c(49),S=c(38),d=c(6),M=c(83),C=c(140),I=function(g){function O(){return g!==null&&g.apply(this,arguments)||this}return Object(E.d)(O,g),O._setPrototypeOf=Object.setPrototypeOf||function(R,N){return R.__proto__=N,R},O}(Error),b=c(34),p=c(26),x=c(128),P=function(g){function O(R,N){var V=g.call(this,R)||this;return V.name="LoadFileError",I._setPrototypeOf(V,O.prototype),N instanceof m.a?V.request=N:V.file=N,V}return Object(E.d)(O,g),O}(I),A=function(g){function O(R,N){var V=g.call(this,R)||this;return V.request=N,V.name="RequestFileError",I._setPrototypeOf(V,O.prototype),V}return Object(E.d)(O,g),O}(I),T=function(g){function O(R,N){var V=g.call(this,R)||this;return V.file=N,V.name="ReadFileError",I._setPrototypeOf(V,O.prototype),V}return Object(E.d)(O,g),O}(I),_=function(){function g(){}return g._CleanUrl=function(O){return O=O.replace(/#/gm,"%23")},g.SetCorsBehavior=function(O,R){if((!O||O.indexOf("data:")!==0)&&g.CorsBehavior)if(typeof g.CorsBehavior=="string"||this.CorsBehavior instanceof String)R.crossOrigin=g.CorsBehavior;else{var N=g.CorsBehavior(O);N&&(R.crossOrigin=N)}},g.LoadImage=function(O,R,N,V,U){var L;U===void 0&&(U="");var j=!1;if(O instanceof ArrayBuffer||ArrayBuffer.isView(O)?typeof Blob!="undefined"?(L=URL.createObjectURL(new Blob([O],{type:U})),j=!0):L="data:"+U+";base64,"+b.a.EncodeArrayBufferToBase64(O):O instanceof Blob?(L=URL.createObjectURL(O),j=!0):(L=g._CleanUrl(O),L=g.PreprocessUrl(O)),typeof Image=="undefined")return g.LoadFile(L,function(ce){createImageBitmap(new Blob([ce],{type:U})).then(function(ie){R(ie),j&&URL.revokeObjectURL(L)}).catch(function(ie){N&&N("Error while trying to load image: "+O,ie)})},void 0,V||void 0,!0,function(ce,ie){N&&N("Error while trying to load image: "+O,ie)}),null;var Y=new Image;g.SetCorsBehavior(L,Y);var W=function(){Y.removeEventListener("load",W),Y.removeEventListener("error",re),R(Y),j&&Y.src&&URL.revokeObjectURL(Y.src)},re=function(ce){if(Y.removeEventListener("load",W),Y.removeEventListener("error",re),N){var ie=O.toString();N("Error while trying to load image: "+(ie.length<32?ie:ie.slice(0,32)+"..."),ce)}j&&Y.src&&URL.revokeObjectURL(Y.src)};Y.addEventListener("load",W),Y.addEventListener("error",re);var ne=function(){Y.src=L};if(L.substr(0,5)!=="data:"&&V&&V.enableTexturesOffline)V.open(function(){V&&V.loadImage(L,Y)},ne);else{if(L.indexOf("file:")!==-1){var ge=decodeURIComponent(L.substring(5).toLowerCase());if(M.a.FilesToLoad[ge]){try{var _e;try{_e=URL.createObjectURL(M.a.FilesToLoad[ge])}catch(ce){_e=URL.createObjectURL(M.a.FilesToLoad[ge])}Y.src=_e,j=!0}catch(ce){Y.src=""}return Y}}ne()}return Y},g.ReadFile=function(O,R,N,V,U){var L=new FileReader,j={onCompleteObservable:new d.c,abort:function(){return L.abort()}};return L.onloadend=function(Y){return j.onCompleteObservable.notifyObservers(j)},U&&(L.onerror=function(Y){U(new T("Unable to read "+O.name,O))}),L.onload=function(Y){R(Y.target.result)},N&&(L.onprogress=N),V?L.readAsArrayBuffer(O):L.readAsText(O),j},g.LoadFile=function(O,R,N,V,U,L){if(O.indexOf("file:")!==-1){var j=decodeURIComponent(O.substring(5).toLowerCase());j.indexOf("./")===0&&(j=j.substring(2));var Y=M.a.FilesToLoad[j];if(Y)return g.ReadFile(Y,R,N,U,L?function(W){return L(void 0,new P(W.message,W.file))}:void 0)}return g.RequestFile(O,function(W,re){R(W,re?re.responseURL:void 0)},N,V,U,L?function(W){L(W.request,new P(W.message,W.request))}:void 0)},g.RequestFile=function(O,R,N,V,U,L,j){O=g._CleanUrl(O),O=g.PreprocessUrl(O);var Y=g.BaseUrl+O,W=!1,re={onCompleteObservable:new d.c,abort:function(){return W=!0}},ne=function(){var _e=new m.a,ce=null;re.abort=function(){W=!0,_e.readyState!==(XMLHttpRequest.DONE||4)&&_e.abort(),ce!==null&&(clearTimeout(ce),ce=null)};var ie=function(Z){_e.open("GET",Y),j&&j(_e),U&&(_e.responseType="arraybuffer"),N&&_e.addEventListener("progress",N);var te=function(){_e.removeEventListener("loadend",te),re.onCompleteObservable.notifyObservers(re),re.onCompleteObservable.clear()};_e.addEventListener("loadend",te);var B=function(){if(!W&&_e.readyState===(XMLHttpRequest.DONE||4)){if(_e.removeEventListener("readystatechange",B),_e.status>=200&&_e.status<300||_e.status===0&&(!S.a.IsWindowObjectExist()||g.IsFileURL()))return void R(U?_e.response:_e.responseText,_e);var G=g.DefaultRetryStrategy;if(G){var $=G(Y,_e,Z);if($!==-1)return _e.removeEventListener("loadend",te),_e=new m.a,void(ce=setTimeout(function(){return ie(Z+1)},$))}var le=new A("Error status: "+_e.status+" "+_e.statusText+" - Unable to load "+Y,_e);L&&L(le)}};_e.addEventListener("readystatechange",B),_e.send()};ie(0)};if(V&&V.enableSceneOffline){var ge=function(_e){_e&&_e.status>400?L&&L(_e):ne()};V.open(function(){V&&V.loadFile(g.BaseUrl+O,function(_e){W||R(_e),re.onCompleteObservable.notifyObservers(re)},N?function(_e){W||N(_e)}:void 0,ge,U)},ge)}else ne();return re},g.IsFileURL=function(){return typeof location!="undefined"&&location.protocol==="file:"},g.DefaultRetryStrategy=C.a.ExponentialBackoff(),g.BaseUrl="",g.CorsBehavior="anonymous",g.PreprocessUrl=function(O){return O},g}();p.a._FileToolsLoadImage=_.LoadImage.bind(_),p.a._FileToolsLoadFile=_.LoadFile.bind(_),x.a._FileToolsLoadFile=_.LoadFile.bind(_)},function(h,s,c){c.d(s,"a",function(){return m});var E=c(38),m=function(){function S(){}return Object.defineProperty(S,"Now",{get:function(){return E.a.IsWindowObjectExist()&&window.performance&&window.performance.now?window.performance.now():Date.now()},enumerable:!1,configurable:!0}),S}()},function(h,s,c){c.d(s,"a",function(){return E});var E=function(){function m(S,d,M,C){this.x=S,this.y=d,this.width=M,this.height=C}return m.prototype.toGlobal=function(S,d){return new m(this.x*S,this.y*d,this.width*S,this.height*d)},m.prototype.toGlobalToRef=function(S,d,M){return M.x=this.x*S,M.y=this.y*d,M.width=this.width*S,M.height=this.height*d,this},m.prototype.clone=function(){return new m(this.x,this.y,this.width,this.height)},m}()},function(h,s,c){var E="helperFunctions",m=`const float PI=3.1415926535897932384626433832795;
const float HALF_MIN=5.96046448e-08;
const float LinearEncodePowerApprox=2.2;
const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;
const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);
const float Epsilon=0.0000001;
#define saturate(x) clamp(x,0.0,1.0)
#define absEps(x) abs(x)+Epsilon
#define maxEps(x) max(x,Epsilon)
#define saturateEps(x) clamp(x,Epsilon,1.0)
mat3 transposeMat3(mat3 inMatrix) {
vec3 i0=inMatrix[0];
vec3 i1=inMatrix[1];
vec3 i2=inMatrix[2];
mat3 outMatrix=mat3(
vec3(i0.x,i1.x,i2.x),
vec3(i0.y,i1.y,i2.y),
vec3(i0.z,i1.z,i2.z)
);
return outMatrix;
}

mat3 inverseMat3(mat3 inMatrix) {
float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];
float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];
float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];
float b01=a22*a11-a12*a21;
float b11=-a22*a10+a12*a20;
float b21=a21*a10-a11*a20;
float det=a00*b01+a01*b11+a02*b21;
return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),
b11,(a22*a00-a02*a20),(-a12*a00+a02*a10),
b21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;
}
float toLinearSpace(float color)
{
return pow(color,LinearEncodePowerApprox);
}
vec3 toLinearSpace(vec3 color)
{
return pow(color,vec3(LinearEncodePowerApprox));
}
vec4 toLinearSpace(vec4 color)
{
return vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);
}
vec3 toGammaSpace(vec3 color)
{
return pow(color,vec3(GammaEncodePowerApprox));
}
vec4 toGammaSpace(vec4 color)
{
return vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);
}
float toGammaSpace(float color)
{
return pow(color,GammaEncodePowerApprox);
}
float square(float value)
{
return value*value;
}
float pow5(float value) {
float sq=value*value;
return sq*sq*value;
}
float getLuminance(vec3 color)
{
return clamp(dot(color,LuminanceEncodeApprox),0.,1.);
}

float getRand(vec2 seed) {
return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);
}
float dither(vec2 seed,float varianceAmount) {
float rand=getRand(seed);
float dither=mix(-varianceAmount/255.0,varianceAmount/255.0,rand);
return dither;
}

const float rgbdMaxRange=255.0;
vec4 toRGBD(vec3 color) {
float maxRGB=maxEps(max(color.r,max(color.g,color.b)));
float D=max(rgbdMaxRange/maxRGB,1.);
D=clamp(floor(D)/255.0,0.,1.);

vec3 rgb=color.rgb*D;

rgb=toGammaSpace(rgb);
return vec4(rgb,D);
}
vec3 fromRGBD(vec4 rgbd) {

rgbd.rgb=toLinearSpace(rgbd.rgb);

return rgbd.rgb/rgbd.a;
}
`;c(5).a.IncludesShadersStore[E]=m},function(h,s,c){c.d(s,"a",function(){return m});var E=c(0),m=function(){function S(){}return S._RemoveAndStorePivotPoint=function(d){d&&S._PivotCached===0&&(d.getPivotPointToRef(S._OldPivotPoint),S._PivotPostMultiplyPivotMatrix=d._postMultiplyPivotMatrix,S._OldPivotPoint.equalsToFloats(0,0,0)||(d.setPivotMatrix(E.a.IdentityReadOnly),S._OldPivotPoint.subtractToRef(d.getPivotPoint(),S._PivotTranslation),S._PivotTmpVector.copyFromFloats(1,1,1),S._PivotTmpVector.subtractInPlace(d.scaling),S._PivotTmpVector.multiplyInPlace(S._PivotTranslation),d.position.addInPlace(S._PivotTmpVector))),S._PivotCached++},S._RestorePivotPoint=function(d){d&&!S._OldPivotPoint.equalsToFloats(0,0,0)&&S._PivotCached===1&&(d.setPivotPoint(S._OldPivotPoint),d._postMultiplyPivotMatrix=S._PivotPostMultiplyPivotMatrix,S._PivotTmpVector.copyFromFloats(1,1,1),S._PivotTmpVector.subtractInPlace(d.scaling),S._PivotTmpVector.multiplyInPlace(S._PivotTranslation),d.position.subtractInPlace(S._PivotTmpVector)),this._PivotCached--},S._PivotCached=0,S._OldPivotPoint=new E.e,S._PivotTranslation=new E.e,S._PivotTmpVector=new E.e,S._PivotPostMultiplyPivotMatrix=!1,S}()},function(h,s,c){c.d(s,"a",function(){return C});var E=c(4),m=c(114),S=c(43),d=c(2),M=c(101),C=function(){function I(b,p,x,P,A,T,_,g,O){g===void 0&&(g=!0),O===void 0&&(O=!0),this.materialIndex=b,this.verticesStart=p,this.verticesCount=x,this.indexStart=P,this.indexCount=A,this._materialDefines=null,this._materialEffect=null,this._effectOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=T,this._renderingMesh=_||T,O&&T.subMeshes.push(this),this._trianglePlanes=[],this._id=T.subMeshes.length-1,g&&(this.refreshBoundingInfo(),T.computeWorldMatrix(!0))}return Object.defineProperty(I.prototype,"materialDefines",{get:function(){return this._materialDefines},set:function(b){this._materialDefines=b},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"effect",{get:function(){var b;return(b=this._effectOverride)!==null&&b!==void 0?b:this._materialEffect},enumerable:!1,configurable:!0}),I.prototype.setEffect=function(b,p){p===void 0&&(p=null),this._materialEffect!==b?(this._materialDefines=p,this._materialEffect=b):b||(this._materialDefines=null)},I.AddToMesh=function(b,p,x,P,A,T,_,g){return g===void 0&&(g=!0),new I(b,p,x,P,A,T,_,g)},Object.defineProperty(I.prototype,"IsGlobal",{get:function(){return this.verticesStart===0&&this.verticesCount===this._mesh.getTotalVertices()},enumerable:!1,configurable:!0}),I.prototype.getBoundingInfo=function(){return this.IsGlobal?this._mesh.getBoundingInfo():this._boundingInfo},I.prototype.setBoundingInfo=function(b){return this._boundingInfo=b,this},I.prototype.getMesh=function(){return this._mesh},I.prototype.getRenderingMesh=function(){return this._renderingMesh},I.prototype.getReplacementMesh=function(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null},I.prototype.getEffectiveMesh=function(){var b=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return b||this._renderingMesh},I.prototype.getMaterial=function(){var b=this._renderingMesh.material;if(b==null)return this._mesh.getScene().defaultMaterial;if(this._IsMultiMaterial(b)){var p=b.getSubMaterial(this.materialIndex);return this._currentMaterial!==p&&(this._currentMaterial=p,this._materialDefines=null),p}return b},I.prototype._IsMultiMaterial=function(b){return b.getSubMaterial!==void 0},I.prototype.refreshBoundingInfo=function(b){if(b===void 0&&(b=null),this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.geometry)return this;if(b||(b=this._renderingMesh.getVerticesData(E.b.PositionKind)),!b)return this._boundingInfo=this._mesh.getBoundingInfo(),this;var p,x=this._renderingMesh.getIndices();if(this.indexStart===0&&this.indexCount===x.length){var P=this._renderingMesh.getBoundingInfo();p={minimum:P.minimum.clone(),maximum:P.maximum.clone()}}else p=Object(M.b)(b,x,this.indexStart,this.indexCount,this._renderingMesh.geometry.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(p.minimum,p.maximum):this._boundingInfo=new S.a(p.minimum,p.maximum),this},I.prototype._checkCollision=function(b){return this.getBoundingInfo()._checkCollision(b)},I.prototype.updateBoundingInfo=function(b){var p=this.getBoundingInfo();return p||(this.refreshBoundingInfo(),p=this.getBoundingInfo()),p&&p.update(b),this},I.prototype.isInFrustum=function(b){var p=this.getBoundingInfo();return!!p&&p.isInFrustum(b,this._mesh.cullingStrategy)},I.prototype.isCompletelyInFrustum=function(b){var p=this.getBoundingInfo();return!!p&&p.isCompletelyInFrustum(b)},I.prototype.render=function(b){return this._renderingMesh.render(this,b,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this},I.prototype._getLinesIndexBuffer=function(b,p){if(!this._linesIndexBuffer){for(var x=[],P=this.indexStart;P<this.indexStart+this.indexCount;P+=3)x.push(b[P],b[P+1],b[P+1],b[P+2],b[P+2],b[P]);this._linesIndexBuffer=p.createIndexBuffer(x),this._linesIndexCount=x.length}return this._linesIndexBuffer},I.prototype.canIntersects=function(b){var p=this.getBoundingInfo();return!!p&&b.intersectsBox(p.boundingBox)},I.prototype.intersects=function(b,p,x,P,A){var T=this.getMaterial();if(!T)return null;var _=3,g=!1;switch(T.fillMode){case d.a.MATERIAL_PointListDrawMode:case d.a.MATERIAL_LineListDrawMode:case d.a.MATERIAL_LineLoopDrawMode:case d.a.MATERIAL_LineStripDrawMode:case d.a.MATERIAL_TriangleFanDrawMode:return null;case d.a.MATERIAL_TriangleStripDrawMode:_=1,g=!0}return this._mesh.getClassName()==="InstancedLinesMesh"||this._mesh.getClassName()==="LinesMesh"?x.length?this._intersectLines(b,p,x,this._mesh.intersectionThreshold,P):this._intersectUnIndexedLines(b,p,x,this._mesh.intersectionThreshold,P):!x.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(b,p,x,P,A):this._intersectTriangles(b,p,x,_,g,P,A)},I.prototype._intersectLines=function(b,p,x,P,A){for(var T=null,_=this.indexStart;_<this.indexStart+this.indexCount;_+=2){var g=p[x[_]],O=p[x[_+1]],R=b.intersectionSegment(g,O,P);if(!(R<0)&&(A||!T||R<T.distance)&&((T=new m.a(null,null,R)).faceId=_/2,A))break}return T},I.prototype._intersectUnIndexedLines=function(b,p,x,P,A){for(var T=null,_=this.verticesStart;_<this.verticesStart+this.verticesCount;_+=2){var g=p[_],O=p[_+1],R=b.intersectionSegment(g,O,P);if(!(R<0)&&(A||!T||R<T.distance)&&((T=new m.a(null,null,R)).faceId=_/2,A))break}return T},I.prototype._intersectTriangles=function(b,p,x,P,A,T,_){for(var g=null,O=-1,R=this.indexStart;R<this.indexStart+this.indexCount;R+=P){O++;var N=x[R],V=x[R+1],U=x[R+2];if(A&&U===4294967295)R+=2;else{var L=p[N],j=p[V],Y=p[U];if(!_||_(L,j,Y,b)){var W=b.intersectsTriangle(L,j,Y);if(W){if(W.distance<0)continue;if((T||!g||W.distance<g.distance)&&((g=W).faceId=O,T))break}}}}return g},I.prototype._intersectUnIndexedTriangles=function(b,p,x,P,A){for(var T=null,_=this.verticesStart;_<this.verticesStart+this.verticesCount;_+=3){var g=p[_],O=p[_+1],R=p[_+2];if(!A||A(g,O,R,b)){var N=b.intersectsTriangle(g,O,R);if(N){if(N.distance<0)continue;if((P||!T||N.distance<T.distance)&&((T=N).faceId=_/3,P))break}}}return T},I.prototype._rebuild=function(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)},I.prototype.clone=function(b,p){var x=new I(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,b,p,!1);if(!this.IsGlobal){var P=this.getBoundingInfo();if(!P)return x;x._boundingInfo=new S.a(P.minimum,P.maximum)}return x},I.prototype.dispose=function(){this._linesIndexBuffer&&(this._mesh.getScene().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);var b=this._mesh.subMeshes.indexOf(this);this._mesh.subMeshes.splice(b,1)},I.prototype.getClassName=function(){return"SubMesh"},I.CreateFromIndices=function(b,p,x,P,A){for(var T=Number.MAX_VALUE,_=-Number.MAX_VALUE,g=(A||P).getIndices(),O=p;O<p+x;O++){var R=g[O];R<T&&(T=R),R>_&&(_=R)}return new I(b,T,_-T+1,p,x,P,A)},I}()},function(h,s,c){c.d(s,"a",function(){return C});var E=c(1),m=c(8),S=c(10),d=c(2),M=(c(126),c(70)),C=function(I){function b(p,x,P,A,T,_,g){P===void 0&&(P=null),T===void 0&&(T=d.a.TEXTURE_TRILINEAR_SAMPLINGMODE),_===void 0&&(_=d.a.TEXTUREFORMAT_RGBA);var O=I.call(this,null,P,!A,g,T,void 0,void 0,void 0,void 0,_)||this;O.name=p,O.wrapU=S.a.CLAMP_ADDRESSMODE,O.wrapV=S.a.CLAMP_ADDRESSMODE,O._generateMipMaps=A;var R=O._getEngine();if(!R)return O;x.getContext?(O._canvas=x,O._texture=R.createDynamicTexture(x.width,x.height,A,T)):(O._canvas=M.a.CreateCanvas(1,1),x.width||x.width===0?O._texture=R.createDynamicTexture(x.width,x.height,A,T):O._texture=R.createDynamicTexture(x,x,A,T));var N=O.getSize();return O._canvas.width=N.width,O._canvas.height=N.height,O._context=O._canvas.getContext("2d"),O}return Object(E.d)(b,I),b.prototype.getClassName=function(){return"DynamicTexture"},Object.defineProperty(b.prototype,"canRescale",{get:function(){return!0},enumerable:!1,configurable:!0}),b.prototype._recreate=function(p){this._canvas.width=p.width,this._canvas.height=p.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(p.width,p.height,this._generateMipMaps,this.samplingMode)},b.prototype.scale=function(p){var x=this.getSize();x.width*=p,x.height*=p,this._recreate(x)},b.prototype.scaleTo=function(p,x){var P=this.getSize();P.width=p,P.height=x,this._recreate(P)},b.prototype.getContext=function(){return this._context},b.prototype.clear=function(){var p=this.getSize();this._context.fillRect(0,0,p.width,p.height)},b.prototype.update=function(p,x){x===void 0&&(x=!1),this._getEngine().updateDynamicTexture(this._texture,this._canvas,p===void 0||p,x,this._format||void 0)},b.prototype.drawText=function(p,x,P,A,T,_,g,O){O===void 0&&(O=!0);var R=this.getSize();if(_&&(this._context.fillStyle=_,this._context.fillRect(0,0,R.width,R.height)),this._context.font=A,x==null){var N=this._context.measureText(p);x=(R.width-N.width)/2}if(P==null){var V=parseInt(A.replace(/\D/g,""));P=R.height/2+V/3.65}this._context.fillStyle=T||"",this._context.fillText(p,x,P),O&&this.update(g)},b.prototype.clone=function(){var p=this.getScene();if(!p)return this;var x=this.getSize(),P=new b(this.name,x,p,this._generateMipMaps);return P.hasAlpha=this.hasAlpha,P.level=this.level,P.wrapU=this.wrapU,P.wrapV=this.wrapV,P},b.prototype.serialize=function(){var p=this.getScene();p&&!p.isReady()&&m.a.Warn("The scene must be ready before serializing the dynamic texture");var x=I.prototype.serialize.call(this);return this._IsCanvasElement(this._canvas)&&(x.base64String=this._canvas.toDataURL()),x.invertY=this._invertY,x.samplingMode=this.samplingMode,x},b.prototype._IsCanvasElement=function(p){return p.toDataURL!==void 0},b.prototype._rebuild=function(){this.update()},b}(S.a)},function(h,s,c){c.d(s,"a",function(){return M});var E=c(0),m=c(9),S=c(7),d=c(16);d.a.CreateBox=function(C){var I,b=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23],p=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],x=[],P=C.width||C.size||1,A=C.height||C.size||1,T=C.depth||C.size||1,_=C.wrap||!1,g=C.topBaseAt===void 0?1:C.topBaseAt,O=C.bottomBaseAt===void 0?0:C.bottomBaseAt,R=[2,0,3,1][g=(g+4)%4],N=[2,0,1,3][O=(O+4)%4],V=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(_){b=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],V=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];for(var U=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],L=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]],j=[17,18,19,16],Y=[22,23,20,21];R>0;)U.unshift(U.pop()),j.unshift(j.pop()),R--;for(;N>0;)L.unshift(L.pop()),Y.unshift(Y.pop()),N--;U=U.flat(),L=L.flat(),V=V.concat(U).concat(L),b.push(j[0],j[2],j[3],j[0],j[1],j[2]),b.push(Y[0],Y[2],Y[3],Y[0],Y[1],Y[2])}var W=[P/2,A/2,T/2];I=V.reduce(function(G,$,le){return G.concat($*W[le%3])},[]);for(var re=C.sideOrientation===0?0:C.sideOrientation||d.a.DEFAULTSIDE,ne=C.faceUV||new Array(6),ge=C.faceColors,_e=[],ce=0;ce<6;ce++)ne[ce]===void 0&&(ne[ce]=new E.f(0,0,1,1)),ge&&ge[ce]===void 0&&(ge[ce]=new m.b(1,1,1,1));for(var ie=0;ie<6;ie++)if(x.push(ne[ie].z,ne[ie].w),x.push(ne[ie].x,ne[ie].w),x.push(ne[ie].x,ne[ie].y),x.push(ne[ie].z,ne[ie].y),ge)for(var Z=0;Z<4;Z++)_e.push(ge[ie].r,ge[ie].g,ge[ie].b,ge[ie].a);d.a._ComputeSides(re,I,b,p,x,C.frontUVs,C.backUVs);var te=new d.a;if(te.indices=b,te.positions=I,te.normals=p,te.uvs=x,ge){var B=re===d.a.DOUBLESIDE?_e.concat(_e):_e;te.colors=B}return te},S.a.CreateBox=function(C,I,b,p,x){b===void 0&&(b=null);var P={size:I,sideOrientation:x,updatable:p};return M.CreateBox(C,P,b)};var M=function(){function C(){}return C.CreateBox=function(I,b,p){p===void 0&&(p=null);var x=new S.a(I,p);return b.sideOrientation=S.a._GetDefaultSideOrientation(b.sideOrientation),x._originalBuilderSideOrientation=b.sideOrientation,d.a.CreateBox(b).applyToMesh(x,b.updatable),x},C}()},function(h,s,c){c.d(s,"a",function(){return m});var E=c(0),m=function(){function S(d,M,C,I){this.normal=new E.e(d,M,C),this.d=I}return S.prototype.asArray=function(){return[this.normal.x,this.normal.y,this.normal.z,this.d]},S.prototype.clone=function(){return new S(this.normal.x,this.normal.y,this.normal.z,this.d)},S.prototype.getClassName=function(){return"Plane"},S.prototype.getHashCode=function(){var d=this.normal.getHashCode();return d=397*d^(0|this.d)},S.prototype.normalize=function(){var d=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z),M=0;return d!==0&&(M=1/d),this.normal.x*=M,this.normal.y*=M,this.normal.z*=M,this.d*=M,this},S.prototype.transform=function(d){var M=S._TmpMatrix;d.invertToRef(M);var C=M.m,I=this.normal.x,b=this.normal.y,p=this.normal.z,x=this.d;return new S(I*C[0]+b*C[1]+p*C[2]+x*C[3],I*C[4]+b*C[5]+p*C[6]+x*C[7],I*C[8]+b*C[9]+p*C[10]+x*C[11],I*C[12]+b*C[13]+p*C[14]+x*C[15])},S.prototype.dotCoordinate=function(d){return this.normal.x*d.x+this.normal.y*d.y+this.normal.z*d.z+this.d},S.prototype.copyFromPoints=function(d,M,C){var I,b=M.x-d.x,p=M.y-d.y,x=M.z-d.z,P=C.x-d.x,A=C.y-d.y,T=C.z-d.z,_=p*T-x*A,g=x*P-b*T,O=b*A-p*P,R=Math.sqrt(_*_+g*g+O*O);return I=R!==0?1/R:0,this.normal.x=_*I,this.normal.y=g*I,this.normal.z=O*I,this.d=-(this.normal.x*d.x+this.normal.y*d.y+this.normal.z*d.z),this},S.prototype.isFrontFacingTo=function(d,M){return E.e.Dot(this.normal,d)<=M},S.prototype.signedDistanceTo=function(d){return E.e.Dot(d,this.normal)+this.d},S.FromArray=function(d){return new S(d[0],d[1],d[2],d[3])},S.FromPoints=function(d,M,C){var I=new S(0,0,0,0);return I.copyFromPoints(d,M,C),I},S.FromPositionAndNormal=function(d,M){var C=new S(0,0,0,0);return M.normalize(),C.normal=M,C.d=-(M.x*d.x+M.y*d.y+M.z*d.z),C},S.SignedDistanceToPlaneFromPositionAndNormal=function(d,M,C){var I=-(M.x*d.x+M.y*d.y+M.z*d.z);return E.e.Dot(C,M)+I},S._TmpMatrix=E.a.Identity(),S}()},function(h,s,c){c.d(s,"a",function(){return b});var E=c(7),m=c(20),S=c(6),d=c(0),M=c(18),C=c(39),I=c(60),b=(c(84),function(){function p(x){this._useAlternatePickedPointAboveMaxDragAngleDragSpeed=-1.1,this.maxDragAngle=0,this._useAlternatePickedPointAboveMaxDragAngle=!1,this.currentDraggingPointerID=-1,this.dragging=!1,this.dragDeltaRatio=.2,this.updateDragPlane=!0,this._debugMode=!1,this._moving=!1,this.onDragObservable=new S.c,this.onDragStartObservable=new S.c,this.onDragEndObservable=new S.c,this.moveAttached=!0,this.enabled=!0,this.startAndReleaseDragOnPointerEvents=!0,this.detachCameraControls=!0,this.useObjectOrientationForDragging=!0,this.validateDrag=function(A){return!0},this._tmpVector=new d.e(0,0,0),this._alternatePickedPoint=new d.e(0,0,0),this._worldDragAxis=new d.e(0,0,0),this._targetPosition=new d.e(0,0,0),this._attachedToElement=!1,this._startDragRay=new C.a(new d.e,new d.e),this._lastPointerRay={},this._dragDelta=new d.e,this._pointA=new d.e(0,0,0),this._pointC=new d.e(0,0,0),this._localAxis=new d.e(0,0,0),this._lookAt=new d.e(0,0,0),this._options=x||{};var P=0;if(this._options.dragAxis&&P++,this._options.dragPlaneNormal&&P++,P>1)throw"Multiple drag modes specified in dragBehavior options. Only one expected"}return Object.defineProperty(p.prototype,"options",{get:function(){return this._options},set:function(x){this._options=x},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"name",{get:function(){return"PointerDrag"},enumerable:!1,configurable:!0}),p.prototype.init=function(){},p.prototype.attach=function(x,P){var A=this;this._scene=x.getScene(),this.attachedNode=x,p._planeScene||(this._debugMode?p._planeScene=this._scene:(p._planeScene=new m.a(this._scene.getEngine(),{virtual:!0}),p._planeScene.detachControl(),this._scene.onDisposeObservable.addOnce(function(){p._planeScene.dispose(),p._planeScene=null}))),this._dragPlane=E.a.CreatePlane("pointerDragPlane",this._debugMode?1:1e4,p._planeScene,!1,E.a.DOUBLESIDE),this.lastDragPosition=new d.e(0,0,0);var T=P||function(_){return A.attachedNode==_||_.isDescendantOf(A.attachedNode)};this._pointerObserver=this._scene.onPointerObservable.add(function(_,g){if(A.enabled){if(_.type==M.a.POINTERDOWN)A.startAndReleaseDragOnPointerEvents&&!A.dragging&&_.pickInfo&&_.pickInfo.hit&&_.pickInfo.pickedMesh&&_.pickInfo.pickedPoint&&_.pickInfo.ray&&T(_.pickInfo.pickedMesh)&&A._startDrag(_.event.pointerId,_.pickInfo.ray,_.pickInfo.pickedPoint);else if(_.type==M.a.POINTERUP)A.startAndReleaseDragOnPointerEvents&&A.currentDraggingPointerID==_.event.pointerId&&A.releaseDrag();else if(_.type==M.a.POINTERMOVE){var O=_.event.pointerId;if(A.currentDraggingPointerID===p._AnyMouseID&&O!==p._AnyMouseID){var R=_.event;(R.pointerType==="mouse"||!A._scene.getEngine().hostInformation.isMobile&&R instanceof MouseEvent)&&(A._lastPointerRay[A.currentDraggingPointerID]&&(A._lastPointerRay[O]=A._lastPointerRay[A.currentDraggingPointerID],delete A._lastPointerRay[A.currentDraggingPointerID]),A.currentDraggingPointerID=O)}A._lastPointerRay[O]||(A._lastPointerRay[O]=new C.a(new d.e,new d.e)),_.pickInfo&&_.pickInfo.ray&&(A._lastPointerRay[O].origin.copyFrom(_.pickInfo.ray.origin),A._lastPointerRay[O].direction.copyFrom(_.pickInfo.ray.direction),A.currentDraggingPointerID==O&&A.dragging&&A._moveDrag(_.pickInfo.ray))}}}),this._beforeRenderObserver=this._scene.onBeforeRenderObservable.add(function(){A._moving&&A.moveAttached&&(I.a._RemoveAndStorePivotPoint(A.attachedNode),A._targetPosition.subtractToRef(A.attachedNode.absolutePosition,A._tmpVector),A._tmpVector.scaleInPlace(A.dragDeltaRatio),A.attachedNode.getAbsolutePosition().addToRef(A._tmpVector,A._tmpVector),A.validateDrag(A._tmpVector)&&A.attachedNode.setAbsolutePosition(A._tmpVector),I.a._RestorePivotPoint(A.attachedNode))})},p.prototype.releaseDrag=function(){if(this.dragging&&(this.dragging=!1,this.onDragEndObservable.notifyObservers({dragPlanePoint:this.lastDragPosition,pointerId:this.currentDraggingPointerID})),this.currentDraggingPointerID=-1,this._moving=!1,this.detachCameraControls&&this._attachedToElement&&this._scene.activeCamera&&!this._scene.activeCamera.leftCamera){if(this._scene.activeCamera.getClassName()==="ArcRotateCamera"){var x=this._scene.activeCamera;x.attachControl(!x.inputs||x.inputs.noPreventDefault,x._useCtrlForPanning,x._panningMouseButton)}else this._scene.activeCamera.attachControl(!this._scene.activeCamera.inputs||this._scene.activeCamera.inputs.noPreventDefault);this._attachedToElement=!1}},p.prototype.startDrag=function(x,P,A){x===void 0&&(x=p._AnyMouseID),this._startDrag(x,P,A);var T=this._lastPointerRay[x];x===p._AnyMouseID&&(T=this._lastPointerRay[Object.keys(this._lastPointerRay)[0]]),T&&this._moveDrag(T)},p.prototype._startDrag=function(x,P,A){if(this._scene.activeCamera&&!this.dragging&&this.attachedNode){I.a._RemoveAndStorePivotPoint(this.attachedNode),P?(this._startDragRay.direction.copyFrom(P.direction),this._startDragRay.origin.copyFrom(P.origin)):(this._startDragRay.origin.copyFrom(this._scene.activeCamera.position),this.attachedNode.getWorldMatrix().getTranslationToRef(this._tmpVector),this._tmpVector.subtractToRef(this._scene.activeCamera.position,this._startDragRay.direction)),this._updateDragPlanePosition(this._startDragRay,A||this._tmpVector);var T=this._pickWithRayOnDragPlane(this._startDragRay);T&&(this.dragging=!0,this.currentDraggingPointerID=x,this.lastDragPosition.copyFrom(T),this.onDragStartObservable.notifyObservers({dragPlanePoint:T,pointerId:this.currentDraggingPointerID}),this._targetPosition.copyFrom(this.attachedNode.absolutePosition),this.detachCameraControls&&this._scene.activeCamera&&this._scene.activeCamera.inputs&&!this._scene.activeCamera.leftCamera&&(this._scene.activeCamera.inputs.attachedToElement?(this._scene.activeCamera.detachControl(),this._attachedToElement=!0):this._attachedToElement=!1)),I.a._RestorePivotPoint(this.attachedNode)}},p.prototype._moveDrag=function(x){this._moving=!0;var P=this._pickWithRayOnDragPlane(x);if(P){this.updateDragPlane&&this._updateDragPlanePosition(x,P);var A=0;this._options.dragAxis?(this.useObjectOrientationForDragging?d.e.TransformCoordinatesToRef(this._options.dragAxis,this.attachedNode.getWorldMatrix().getRotationMatrix(),this._worldDragAxis):this._worldDragAxis.copyFrom(this._options.dragAxis),P.subtractToRef(this.lastDragPosition,this._tmpVector),A=d.e.Dot(this._tmpVector,this._worldDragAxis),this._worldDragAxis.scaleToRef(A,this._dragDelta)):(A=this._dragDelta.length(),P.subtractToRef(this.lastDragPosition,this._dragDelta)),this._targetPosition.addInPlace(this._dragDelta),this.onDragObservable.notifyObservers({dragDistance:A,delta:this._dragDelta,dragPlanePoint:P,dragPlaneNormal:this._dragPlane.forward,pointerId:this.currentDraggingPointerID}),this.lastDragPosition.copyFrom(P)}},p.prototype._pickWithRayOnDragPlane=function(x){var P=this;if(!x)return null;var A=Math.acos(d.e.Dot(this._dragPlane.forward,x.direction));if(A>Math.PI/2&&(A=Math.PI-A),this.maxDragAngle>0&&A>this.maxDragAngle){if(this._useAlternatePickedPointAboveMaxDragAngle){this._tmpVector.copyFrom(x.direction),this.attachedNode.absolutePosition.subtractToRef(x.origin,this._alternatePickedPoint),this._alternatePickedPoint.normalize(),this._alternatePickedPoint.scaleInPlace(this._useAlternatePickedPointAboveMaxDragAngleDragSpeed*d.e.Dot(this._alternatePickedPoint,this._tmpVector)),this._tmpVector.addInPlace(this._alternatePickedPoint);var T=d.e.Dot(this._dragPlane.forward,this._tmpVector);return this._dragPlane.forward.scaleToRef(-T,this._alternatePickedPoint),this._alternatePickedPoint.addInPlace(this._tmpVector),this._alternatePickedPoint.addInPlace(this.attachedNode.absolutePosition),this._alternatePickedPoint}return null}var _=p._planeScene.pickWithRay(x,function(g){return g==P._dragPlane});return _&&_.hit&&_.pickedMesh&&_.pickedPoint?_.pickedPoint:null},p.prototype._updateDragPlanePosition=function(x,P){this._pointA.copyFrom(P),this._options.dragAxis?(this.useObjectOrientationForDragging?d.e.TransformCoordinatesToRef(this._options.dragAxis,this.attachedNode.getWorldMatrix().getRotationMatrix(),this._localAxis):this._localAxis.copyFrom(this._options.dragAxis),x.origin.subtractToRef(this._pointA,this._pointC),this._pointC.normalize(),Math.abs(d.e.Dot(this._localAxis,this._pointC))>.999?Math.abs(d.e.Dot(d.e.UpReadOnly,this._pointC))>.999?this._lookAt.copyFrom(d.e.Right()):this._lookAt.copyFrom(d.e.UpReadOnly):(d.e.CrossToRef(this._localAxis,this._pointC,this._lookAt),d.e.CrossToRef(this._localAxis,this._lookAt,this._lookAt),this._lookAt.normalize()),this._dragPlane.position.copyFrom(this._pointA),this._pointA.addToRef(this._lookAt,this._lookAt),this._dragPlane.lookAt(this._lookAt)):this._options.dragPlaneNormal?(this.useObjectOrientationForDragging?d.e.TransformCoordinatesToRef(this._options.dragPlaneNormal,this.attachedNode.getWorldMatrix().getRotationMatrix(),this._localAxis):this._localAxis.copyFrom(this._options.dragPlaneNormal),this._dragPlane.position.copyFrom(this._pointA),this._pointA.addToRef(this._localAxis,this._lookAt),this._dragPlane.lookAt(this._lookAt)):(this._dragPlane.position.copyFrom(this._pointA),this._dragPlane.lookAt(x.origin)),this._dragPlane.position.copyFrom(this.attachedNode.absolutePosition),this._dragPlane.computeWorldMatrix(!0)},p.prototype.detach=function(){this._pointerObserver&&this._scene.onPointerObservable.remove(this._pointerObserver),this._beforeRenderObserver&&this._scene.onBeforeRenderObservable.remove(this._beforeRenderObserver),this.releaseDrag()},p._AnyMouseID=-2,p}())},function(h,s,c){c.d(s,"a",function(){return m}),c.d(s,"b",function(){return S}),c.d(s,"c",function(){return d});var E=c(1),m=function(){function M(){}return M.KEYDOWN=1,M.KEYUP=2,M}(),S=function(M,C){this.type=M,this.event=C},d=function(M){function C(I,b){var p=M.call(this,I,b)||this;return p.type=I,p.event=b,p.skipOnPointerObservable=!1,p}return Object(E.d)(C,M),C}(S)},function(h,s,c){c.d(s,"a",function(){return E});var E=function(){function m(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}return m.prototype.unBindMesh=function(){this._mesh=null},m.prototype.addFallback=function(S,d){this._defines[S]||(S<this._currentRank&&(this._currentRank=S),S>this._maxRank&&(this._maxRank=S),this._defines[S]=new Array),this._defines[S].push(d)},m.prototype.addCPUSkinningFallback=function(S,d){this._mesh=d,S<this._currentRank&&(this._currentRank=S),S>this._maxRank&&(this._maxRank=S)},Object.defineProperty(m.prototype,"hasMoreFallbacks",{get:function(){return this._currentRank<=this._maxRank},enumerable:!1,configurable:!0}),m.prototype.reduce=function(S,d){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,S=S.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),d._bonesComputationForcedToCPU=!0;for(var M=this._mesh.getScene(),C=0;C<M.meshes.length;C++){var I=M.meshes[C];if(I.material){if(I.computeBonesUsingShaders&&I.numBoneInfluencers!==0){if(I.material.getEffect()===d)I.computeBonesUsingShaders=!1;else if(I.subMeshes){for(var b=0,p=I.subMeshes;b<p.length;b++)if(p[b].effect===d){I.computeBonesUsingShaders=!1;break}}}}else!this._mesh.material&&I.computeBonesUsingShaders&&I.numBoneInfluencers>0&&(I.computeBonesUsingShaders=!1)}}else{var x=this._defines[this._currentRank];if(x)for(C=0;C<x.length;C++)S=S.replace("#define "+x[C],"");this._currentRank++}return S},m}()},function(h,s,c){c.d(s,"a",function(){return M});var E=c(1),m=c(25),S=c(37),d=c(11),M=function(C){function I(b,p){var x=C.call(this,b,p,!0)||this;return p.multiMaterials.push(x),x.subMaterials=new Array,x._storeEffectOnSubMeshes=!0,x}return Object(E.d)(I,C),Object.defineProperty(I.prototype,"subMaterials",{get:function(){return this._subMaterials},set:function(b){this._subMaterials=b,this._hookArray(b)},enumerable:!1,configurable:!0}),I.prototype.getChildren=function(){return this.subMaterials},I.prototype._hookArray=function(b){var p=this,x=b.push;b.push=function(){for(var A=[],T=0;T<arguments.length;T++)A[T]=arguments[T];var _=x.apply(b,A);return p._markAllSubMeshesAsTexturesDirty(),_};var P=b.splice;b.splice=function(A,T){var _=P.apply(b,[A,T]);return p._markAllSubMeshesAsTexturesDirty(),_}},I.prototype.getSubMaterial=function(b){return b<0||b>=this.subMaterials.length?this.getScene().defaultMaterial:this.subMaterials[b]},I.prototype.getActiveTextures=function(){var b;return(b=C.prototype.getActiveTextures.call(this)).concat.apply(b,this.subMaterials.map(function(p){return p?p.getActiveTextures():[]}))},I.prototype.hasTexture=function(b){var p;if(C.prototype.hasTexture.call(this,b))return!0;for(var x=0;x<this.subMaterials.length;x++)if((p=this.subMaterials[x])===null||p===void 0?void 0:p.hasTexture(b))return!0;return!1},I.prototype.getClassName=function(){return"MultiMaterial"},I.prototype.isReadyForSubMesh=function(b,p,x){for(var P=0;P<this.subMaterials.length;P++){var A=this.subMaterials[P];if(A){if(A._storeEffectOnSubMeshes){if(!A.isReadyForSubMesh(b,p,x))return!1;continue}if(!A.isReady(b))return!1}}return!0},I.prototype.clone=function(b,p){for(var x=new I(b,this.getScene()),P=0;P<this.subMaterials.length;P++){var A=null,T=this.subMaterials[P];A=p&&T?T.clone(b+"-"+T.name):this.subMaterials[P],x.subMaterials.push(A)}return x},I.prototype.serialize=function(){var b={};b.name=this.name,b.id=this.id,S.a&&(b.tags=S.a.GetTags(this)),b.materials=[];for(var p=0;p<this.subMaterials.length;p++){var x=this.subMaterials[p];x?b.materials.push(x.id):b.materials.push(null)}return b},I.prototype.dispose=function(b,p,x){var P=this.getScene();if(P){if(x)for(var A=0;A<this.subMaterials.length;A++){var T=this.subMaterials[A];T&&T.dispose(b,p)}(A=P.multiMaterials.indexOf(this))>=0&&P.multiMaterials.splice(A,1),C.prototype.dispose.call(this,b,p)}},I.ParseMultiMaterial=function(b,p){var x=new I(b.name,p);x.id=b.id,S.a&&S.a.AddTagsTo(x,b.tags);for(var P=0;P<b.materials.length;P++){var A=b.materials[P];A?x.subMaterials.push(p.getLastMaterialByID(A)):x.subMaterials.push(null)}return x},I}(m.a);d.a.RegisteredTypes["BABYLON.MultiMaterial"]=M},function(h,s,c){c.d(s,"a",function(){return m});var E=c(2),m=function(){function S(){}return Object.defineProperty(S,"ForceFullSceneLoadingForIncremental",{get:function(){return S._ForceFullSceneLoadingForIncremental},set:function(d){S._ForceFullSceneLoadingForIncremental=d},enumerable:!1,configurable:!0}),Object.defineProperty(S,"ShowLoadingScreen",{get:function(){return S._ShowLoadingScreen},set:function(d){S._ShowLoadingScreen=d},enumerable:!1,configurable:!0}),Object.defineProperty(S,"loggingLevel",{get:function(){return S._loggingLevel},set:function(d){S._loggingLevel=d},enumerable:!1,configurable:!0}),Object.defineProperty(S,"CleanBoneMatrixWeights",{get:function(){return S._CleanBoneMatrixWeights},set:function(d){S._CleanBoneMatrixWeights=d},enumerable:!1,configurable:!0}),S._ForceFullSceneLoadingForIncremental=!1,S._ShowLoadingScreen=!0,S._CleanBoneMatrixWeights=!1,S._loggingLevel=E.a.SCENELOADER_NO_LOGGING,S}()},function(h,s,c){c.d(s,"a",function(){return E});var E=function(){function m(){}return m.CreateCanvas=function(S,d){if(typeof document=="undefined")return new OffscreenCanvas(S,d);var M=document.createElement("canvas");return M.width=S,M.height=d,M},m}()},function(h,s,c){c.d(s,"a",function(){return A});var E=c(0),m=c(9),S=c(16),d=c(4),M=c(61),C=c(69),I=c(43),b=c(2),p=c(12),x=c(37),P=c(101),A=function(){function T(_,g,O,R,N){R===void 0&&(R=!1),N===void 0&&(N=null),this.delayLoadState=b.a.DELAYLOADSTATE_NONE,this._totalVertices=0,this._isDisposed=!1,this._indexBufferIsUpdatable=!1,this._positionsCache=[],this.useBoundingInfoFromGeometry=!1,this.id=_,this.uniqueId=g.getUniqueId(),this._engine=g.getEngine(),this._meshes=[],this._scene=g,this._vertexBuffers={},this._indices=[],this._updatable=R,O?this.setAllVerticesData(O,R):(this._totalVertices=0,this._indices=[]),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),N&&(this.applyToMesh(N),N.computeWorldMatrix(!0))}return Object.defineProperty(T.prototype,"boundingBias",{get:function(){return this._boundingBias},set:function(_){this._boundingBias?this._boundingBias.copyFrom(_):this._boundingBias=_.clone(),this._updateBoundingInfo(!0,null)},enumerable:!1,configurable:!0}),T.CreateGeometryForMesh=function(_){var g=new T(T.RandomId(),_.getScene());return g.applyToMesh(_),g},Object.defineProperty(T.prototype,"meshes",{get:function(){return this._meshes},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"extend",{get:function(){return this._extend},enumerable:!1,configurable:!0}),T.prototype.getScene=function(){return this._scene},T.prototype.getEngine=function(){return this._engine},T.prototype.isReady=function(){return this.delayLoadState===b.a.DELAYLOADSTATE_LOADED||this.delayLoadState===b.a.DELAYLOADSTATE_NONE},Object.defineProperty(T.prototype,"doNotSerialize",{get:function(){for(var _=0;_<this._meshes.length;_++)if(!this._meshes[_].doNotSerialize)return!1;return!0},enumerable:!1,configurable:!0}),T.prototype._rebuild=function(){for(var _ in this._vertexArrayObjects&&(this._vertexArrayObjects={}),this._meshes.length!==0&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices)),this._vertexBuffers)this._vertexBuffers[_]._rebuild()},T.prototype.setAllVerticesData=function(_,g){_.applyToGeometry(this,g),this.notifyUpdate()},T.prototype.setVerticesData=function(_,g,O,R){O===void 0&&(O=!1),O&&Array.isArray(g)&&(g=new Float32Array(g));var N=new d.b(this._engine,g,_,O,this._meshes.length===0,R);this.setVerticesBuffer(N)},T.prototype.removeVerticesData=function(_){this._vertexBuffers[_]&&(this._vertexBuffers[_].dispose(),delete this._vertexBuffers[_])},T.prototype.setVerticesBuffer=function(_,g){g===void 0&&(g=null);var O=_.getKind();if(this._vertexBuffers[O]&&this._vertexBuffers[O].dispose(),this._vertexBuffers[O]=_,O===d.b.PositionKind){var R=_.getData();g!=null?this._totalVertices=g:R!=null&&(this._totalVertices=R.length/(_.byteStride/4)),this._updateExtend(R),this._resetPointsArrayCache();for(var N=this._meshes,V=N.length,U=0;U<V;U++){var L=N[U];L._boundingInfo=new I.a(this._extend.minimum,this._extend.maximum),L._createGlobalSubMesh(!1),L.computeWorldMatrix(!0)}}this.notifyUpdate(O),this._vertexArrayObjects&&(this._disposeVertexArrayObjects(),this._vertexArrayObjects={})},T.prototype.updateVerticesDataDirectly=function(_,g,O,R){R===void 0&&(R=!1);var N=this.getVertexBuffer(_);N&&(N.updateDirectly(g,O,R),this.notifyUpdate(_))},T.prototype.updateVerticesData=function(_,g,O){O===void 0&&(O=!1);var R=this.getVertexBuffer(_);R&&(R.update(g),_===d.b.PositionKind&&this._updateBoundingInfo(O,g),this.notifyUpdate(_))},T.prototype._updateBoundingInfo=function(_,g){if(_&&this._updateExtend(g),this._resetPointsArrayCache(),_)for(var O=0,R=this._meshes;O<R.length;O++){var N=R[O];N._boundingInfo?N._boundingInfo.reConstruct(this._extend.minimum,this._extend.maximum):N._boundingInfo=new I.a(this._extend.minimum,this._extend.maximum);for(var V=0,U=N.subMeshes;V<U.length;V++)U[V].refreshBoundingInfo()}},T.prototype._bind=function(_,g){if(_){g===void 0&&(g=this._indexBuffer);var O=this.getVertexBuffers();O&&(g==this._indexBuffer&&this._vertexArrayObjects?(this._vertexArrayObjects[_.key]||(this._vertexArrayObjects[_.key]=this._engine.recordVertexArrayObject(O,g,_)),this._engine.bindVertexArrayObject(this._vertexArrayObjects[_.key],g)):this._engine.bindBuffers(O,g,_))}},T.prototype.getTotalVertices=function(){return this.isReady()?this._totalVertices:0},T.prototype.getVerticesData=function(_,g,O){var R=this.getVertexBuffer(_);if(!R)return null;var N=R.getData();if(!N)return null;var V=R.getSize()*d.b.GetTypeByteLength(R.type),U=this._totalVertices*R.getSize();if(R.type!==d.b.FLOAT||R.byteStride!==V){var L=[];return R.forEach(U,function(ne){return L.push(ne)}),L}if(!(N instanceof Array||N instanceof Float32Array)||R.byteOffset!==0||N.length!==U){if(N instanceof Array){var j=R.byteOffset/4;return p.b.Slice(N,j,j+U)}if(N instanceof ArrayBuffer)return new Float32Array(N,R.byteOffset,U);if(j=N.byteOffset+R.byteOffset,O||g&&this._meshes.length!==1){var Y=new Float32Array(U),W=new Float32Array(N.buffer,j,U);return Y.set(W),Y}var re=j%4;return re&&(j=Math.max(0,j-re)),new Float32Array(N.buffer,j,U)}return O||g&&this._meshes.length!==1?p.b.Slice(N):N},T.prototype.isVertexBufferUpdatable=function(_){var g=this._vertexBuffers[_];return!!g&&g.isUpdatable()},T.prototype.getVertexBuffer=function(_){return this.isReady()?this._vertexBuffers[_]:null},T.prototype.getVertexBuffers=function(){return this.isReady()?this._vertexBuffers:null},T.prototype.isVerticesDataPresent=function(_){return this._vertexBuffers?this._vertexBuffers[_]!==void 0:!!this._delayInfo&&this._delayInfo.indexOf(_)!==-1},T.prototype.getVerticesDataKinds=function(){var _,g=[];if(!this._vertexBuffers&&this._delayInfo)for(_ in this._delayInfo)g.push(_);else for(_ in this._vertexBuffers)g.push(_);return g},T.prototype.updateIndices=function(_,g,O){if(O===void 0&&(O=!1),this._indexBuffer)if(this._indexBufferIsUpdatable){var R=_.length!==this._indices.length;if(O||(this._indices=_.slice()),this._engine.updateDynamicIndexBuffer(this._indexBuffer,_,g),R)for(var N=0,V=this._meshes;N<V.length;N++)V[N]._createGlobalSubMesh(!0)}else this.setIndices(_,null,!0)},T.prototype.setIndices=function(_,g,O){g===void 0&&(g=null),O===void 0&&(O=!1),this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._disposeVertexArrayObjects(),this._indices=_,this._indexBufferIsUpdatable=O,this._meshes.length!==0&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,O)),g!=null&&(this._totalVertices=g);for(var R=0,N=this._meshes;R<N.length;R++)N[R]._createGlobalSubMesh(!0);this.notifyUpdate()},T.prototype.getTotalIndices=function(){return this.isReady()?this._indices.length:0},T.prototype.getIndices=function(_,g){if(!this.isReady())return null;var O=this._indices;if(g||_&&this._meshes.length!==1){for(var R=O.length,N=[],V=0;V<R;V++)N.push(O[V]);return N}return O},T.prototype.getIndexBuffer=function(){return this.isReady()?this._indexBuffer:null},T.prototype._releaseVertexArrayObject=function(_){_===void 0&&(_=null),_&&this._vertexArrayObjects&&this._vertexArrayObjects[_.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[_.key]),delete this._vertexArrayObjects[_.key])},T.prototype.releaseForMesh=function(_,g){var O=this._meshes,R=O.indexOf(_);R!==-1&&(O.splice(R,1),_._geometry=null,O.length===0&&g&&this.dispose())},T.prototype.applyToMesh=function(_){if(_._geometry!==this){var g=_._geometry;g&&g.releaseForMesh(_);var O=this._meshes;_._geometry=this,this._scene.pushGeometry(this),O.push(_),this.isReady()?this._applyToMesh(_):_._boundingInfo=this._boundingInfo}},T.prototype._updateExtend=function(_){_===void 0&&(_=null),this.useBoundingInfoFromGeometry&&this._boundingInfo?this._extend={minimum:this._boundingInfo.minimum.clone(),maximum:this._boundingInfo.maximum.clone()}:(_||(_=this.getVerticesData(d.b.PositionKind)),this._extend=Object(P.a)(_,0,this._totalVertices,this.boundingBias,3))},T.prototype._applyToMesh=function(_){var g=this._meshes.length;for(var O in this._vertexBuffers){g===1&&this._vertexBuffers[O].create();var R=this._vertexBuffers[O].getBuffer();R&&(R.references=g),O===d.b.PositionKind&&(this._extend||this._updateExtend(),_._boundingInfo=new I.a(this._extend.minimum,this._extend.maximum),_._createGlobalSubMesh(!1),_._updateBoundingInfo())}g===1&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices)),this._indexBuffer&&(this._indexBuffer.references=g),_._syncGeometryWithMorphTargetManager(),_.synchronizeInstances()},T.prototype.notifyUpdate=function(_){this.onGeometryUpdated&&this.onGeometryUpdated(this,_);for(var g=0,O=this._meshes;g<O.length;g++)O[g]._markSubMeshesAsAttributesDirty()},T.prototype.load=function(_,g){this.delayLoadState!==b.a.DELAYLOADSTATE_LOADING&&(this.isReady()?g&&g():(this.delayLoadState=b.a.DELAYLOADSTATE_LOADING,this._queueLoad(_,g)))},T.prototype._queueLoad=function(_,g){var O=this;this.delayLoadingFile&&(_._addPendingData(this),_._loadFile(this.delayLoadingFile,function(R){if(O._delayLoadingFunction){O._delayLoadingFunction(JSON.parse(R),O),O.delayLoadState=b.a.DELAYLOADSTATE_LOADED,O._delayInfo=[],_._removePendingData(O);for(var N=O._meshes,V=N.length,U=0;U<V;U++)O._applyToMesh(N[U]);g&&g()}},void 0,!0))},T.prototype.toLeftHanded=function(){var _=this.getIndices(!1);if(_!=null&&_.length>0){for(var g=0;g<_.length;g+=3){var O=_[g+0];_[g+0]=_[g+2],_[g+2]=O}this.setIndices(_)}var R=this.getVerticesData(d.b.PositionKind,!1);if(R!=null&&R.length>0){for(g=0;g<R.length;g+=3)R[g+2]=-R[g+2];this.setVerticesData(d.b.PositionKind,R,!1)}var N=this.getVerticesData(d.b.NormalKind,!1);if(N!=null&&N.length>0){for(g=0;g<N.length;g+=3)N[g+2]=-N[g+2];this.setVerticesData(d.b.NormalKind,N,!1)}},T.prototype._resetPointsArrayCache=function(){this._positions=null},T.prototype._generatePointsArray=function(){if(this._positions)return!0;var _=this.getVerticesData(d.b.PositionKind);if(!_||_.length===0)return!1;for(var g=3*this._positionsCache.length,O=this._positionsCache.length;g<_.length;g+=3,++O)this._positionsCache[O]=E.e.FromArray(_,g);for(g=0,O=0;g<_.length;g+=3,++O)this._positionsCache[O].set(_[0+g],_[1+g],_[2+g]);return this._positionsCache.length=_.length/3,this._positions=this._positionsCache,!0},T.prototype.isDisposed=function(){return this._isDisposed},T.prototype._disposeVertexArrayObjects=function(){if(this._vertexArrayObjects){for(var _ in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[_]);this._vertexArrayObjects={}}},T.prototype.dispose=function(){var _,g=this._meshes,O=g.length;for(_=0;_<O;_++)this.releaseForMesh(g[_]);for(var R in this._meshes=[],this._disposeVertexArrayObjects(),this._vertexBuffers)this._vertexBuffers[R].dispose();this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=b.a.DELAYLOADSTATE_NONE,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._isDisposed=!0},T.prototype.copy=function(_){var g=new S.a;g.indices=[];var O=this.getIndices();if(O)for(var R=0;R<O.length;R++)g.indices.push(O[R]);var N,V=!1,U=!1;for(N in this._vertexBuffers){var L=this.getVerticesData(N);if(L&&(L instanceof Float32Array?g.set(new Float32Array(L),N):g.set(L.slice(0),N),!U)){var j=this.getVertexBuffer(N);j&&(U=!(V=j.isUpdatable()))}}var Y=new T(_,this._scene,g,V);for(N in Y.delayLoadState=this.delayLoadState,Y.delayLoadingFile=this.delayLoadingFile,Y._delayLoadingFunction=this._delayLoadingFunction,this._delayInfo)Y._delayInfo=Y._delayInfo||[],Y._delayInfo.push(N);return Y._boundingInfo=new I.a(this._extend.minimum,this._extend.maximum),Y},T.prototype.serialize=function(){var _={};return _.id=this.id,_.updatable=this._updatable,x.a&&x.a.HasTags(this)&&(_.tags=x.a.GetTags(this)),_},T.prototype.toNumberArray=function(_){return Array.isArray(_)?_:Array.prototype.slice.call(_)},T.prototype.serializeVerticeData=function(){var _=this.serialize();return this.isVerticesDataPresent(d.b.PositionKind)&&(_.positions=this.toNumberArray(this.getVerticesData(d.b.PositionKind)),this.isVertexBufferUpdatable(d.b.PositionKind)&&(_.positions._updatable=!0)),this.isVerticesDataPresent(d.b.NormalKind)&&(_.normals=this.toNumberArray(this.getVerticesData(d.b.NormalKind)),this.isVertexBufferUpdatable(d.b.NormalKind)&&(_.normals._updatable=!0)),this.isVerticesDataPresent(d.b.TangentKind)&&(_.tangets=this.toNumberArray(this.getVerticesData(d.b.TangentKind)),this.isVertexBufferUpdatable(d.b.TangentKind)&&(_.tangets._updatable=!0)),this.isVerticesDataPresent(d.b.UVKind)&&(_.uvs=this.toNumberArray(this.getVerticesData(d.b.UVKind)),this.isVertexBufferUpdatable(d.b.UVKind)&&(_.uvs._updatable=!0)),this.isVerticesDataPresent(d.b.UV2Kind)&&(_.uv2s=this.toNumberArray(this.getVerticesData(d.b.UV2Kind)),this.isVertexBufferUpdatable(d.b.UV2Kind)&&(_.uv2s._updatable=!0)),this.isVerticesDataPresent(d.b.UV3Kind)&&(_.uv3s=this.toNumberArray(this.getVerticesData(d.b.UV3Kind)),this.isVertexBufferUpdatable(d.b.UV3Kind)&&(_.uv3s._updatable=!0)),this.isVerticesDataPresent(d.b.UV4Kind)&&(_.uv4s=this.toNumberArray(this.getVerticesData(d.b.UV4Kind)),this.isVertexBufferUpdatable(d.b.UV4Kind)&&(_.uv4s._updatable=!0)),this.isVerticesDataPresent(d.b.UV5Kind)&&(_.uv5s=this.toNumberArray(this.getVerticesData(d.b.UV5Kind)),this.isVertexBufferUpdatable(d.b.UV5Kind)&&(_.uv5s._updatable=!0)),this.isVerticesDataPresent(d.b.UV6Kind)&&(_.uv6s=this.toNumberArray(this.getVerticesData(d.b.UV6Kind)),this.isVertexBufferUpdatable(d.b.UV6Kind)&&(_.uv6s._updatable=!0)),this.isVerticesDataPresent(d.b.ColorKind)&&(_.colors=this.toNumberArray(this.getVerticesData(d.b.ColorKind)),this.isVertexBufferUpdatable(d.b.ColorKind)&&(_.colors._updatable=!0)),this.isVerticesDataPresent(d.b.MatricesIndicesKind)&&(_.matricesIndices=this.toNumberArray(this.getVerticesData(d.b.MatricesIndicesKind)),_.matricesIndices._isExpanded=!0,this.isVertexBufferUpdatable(d.b.MatricesIndicesKind)&&(_.matricesIndices._updatable=!0)),this.isVerticesDataPresent(d.b.MatricesWeightsKind)&&(_.matricesWeights=this.toNumberArray(this.getVerticesData(d.b.MatricesWeightsKind)),this.isVertexBufferUpdatable(d.b.MatricesWeightsKind)&&(_.matricesWeights._updatable=!0)),_.indices=this.toNumberArray(this.getIndices()),_},T.ExtractFromMesh=function(_,g){var O=_._geometry;return O?O.copy(g):null},T.RandomId=function(){return p.b.RandomId()},T._ImportGeometry=function(_,g){var O=g.getScene(),R=_.geometryId;if(R){var N=O.getGeometryByID(R);N&&N.applyToMesh(g)}else if(_ instanceof ArrayBuffer){var V=g._binaryInfo;if(V.positionsAttrDesc&&V.positionsAttrDesc.count>0){var U=new Float32Array(_,V.positionsAttrDesc.offset,V.positionsAttrDesc.count);g.setVerticesData(d.b.PositionKind,U,!1)}if(V.normalsAttrDesc&&V.normalsAttrDesc.count>0){var L=new Float32Array(_,V.normalsAttrDesc.offset,V.normalsAttrDesc.count);g.setVerticesData(d.b.NormalKind,L,!1)}if(V.tangetsAttrDesc&&V.tangetsAttrDesc.count>0){var j=new Float32Array(_,V.tangetsAttrDesc.offset,V.tangetsAttrDesc.count);g.setVerticesData(d.b.TangentKind,j,!1)}if(V.uvsAttrDesc&&V.uvsAttrDesc.count>0){var Y=new Float32Array(_,V.uvsAttrDesc.offset,V.uvsAttrDesc.count);g.setVerticesData(d.b.UVKind,Y,!1)}if(V.uvs2AttrDesc&&V.uvs2AttrDesc.count>0){var W=new Float32Array(_,V.uvs2AttrDesc.offset,V.uvs2AttrDesc.count);g.setVerticesData(d.b.UV2Kind,W,!1)}if(V.uvs3AttrDesc&&V.uvs3AttrDesc.count>0){var re=new Float32Array(_,V.uvs3AttrDesc.offset,V.uvs3AttrDesc.count);g.setVerticesData(d.b.UV3Kind,re,!1)}if(V.uvs4AttrDesc&&V.uvs4AttrDesc.count>0){var ne=new Float32Array(_,V.uvs4AttrDesc.offset,V.uvs4AttrDesc.count);g.setVerticesData(d.b.UV4Kind,ne,!1)}if(V.uvs5AttrDesc&&V.uvs5AttrDesc.count>0){var ge=new Float32Array(_,V.uvs5AttrDesc.offset,V.uvs5AttrDesc.count);g.setVerticesData(d.b.UV5Kind,ge,!1)}if(V.uvs6AttrDesc&&V.uvs6AttrDesc.count>0){var _e=new Float32Array(_,V.uvs6AttrDesc.offset,V.uvs6AttrDesc.count);g.setVerticesData(d.b.UV6Kind,_e,!1)}if(V.colorsAttrDesc&&V.colorsAttrDesc.count>0){var ce=new Float32Array(_,V.colorsAttrDesc.offset,V.colorsAttrDesc.count);g.setVerticesData(d.b.ColorKind,ce,!1,V.colorsAttrDesc.stride)}if(V.matricesIndicesAttrDesc&&V.matricesIndicesAttrDesc.count>0){for(var ie=new Int32Array(_,V.matricesIndicesAttrDesc.offset,V.matricesIndicesAttrDesc.count),Z=[],te=0;te<ie.length;te++){var B=ie[te];Z.push(255&B),Z.push((65280&B)>>8),Z.push((16711680&B)>>16),Z.push(B>>24&255)}g.setVerticesData(d.b.MatricesIndicesKind,Z,!1)}if(V.matricesIndicesExtraAttrDesc&&V.matricesIndicesExtraAttrDesc.count>0){for(ie=new Int32Array(_,V.matricesIndicesExtraAttrDesc.offset,V.matricesIndicesExtraAttrDesc.count),Z=[],te=0;te<ie.length;te++)B=ie[te],Z.push(255&B),Z.push((65280&B)>>8),Z.push((16711680&B)>>16),Z.push(B>>24&255);g.setVerticesData(d.b.MatricesIndicesExtraKind,Z,!1)}if(V.matricesWeightsAttrDesc&&V.matricesWeightsAttrDesc.count>0){var G=new Float32Array(_,V.matricesWeightsAttrDesc.offset,V.matricesWeightsAttrDesc.count);g.setVerticesData(d.b.MatricesWeightsKind,G,!1)}if(V.indicesAttrDesc&&V.indicesAttrDesc.count>0){var $=new Int32Array(_,V.indicesAttrDesc.offset,V.indicesAttrDesc.count);g.setIndices($,null)}if(V.subMeshesAttrDesc&&V.subMeshesAttrDesc.count>0){var le=new Int32Array(_,V.subMeshesAttrDesc.offset,5*V.subMeshesAttrDesc.count);for(g.subMeshes=[],te=0;te<V.subMeshesAttrDesc.count;te++){var se=le[5*te+0],q=le[5*te+1],H=le[5*te+2],X=le[5*te+3],J=le[5*te+4];M.a.AddToMesh(se,q,H,X,J,g)}}}else if(_.positions&&_.normals&&_.indices){if(g.setVerticesData(d.b.PositionKind,_.positions,_.positions._updatable),g.setVerticesData(d.b.NormalKind,_.normals,_.normals._updatable),_.tangents&&g.setVerticesData(d.b.TangentKind,_.tangents,_.tangents._updatable),_.uvs&&g.setVerticesData(d.b.UVKind,_.uvs,_.uvs._updatable),_.uvs2&&g.setVerticesData(d.b.UV2Kind,_.uvs2,_.uvs2._updatable),_.uvs3&&g.setVerticesData(d.b.UV3Kind,_.uvs3,_.uvs3._updatable),_.uvs4&&g.setVerticesData(d.b.UV4Kind,_.uvs4,_.uvs4._updatable),_.uvs5&&g.setVerticesData(d.b.UV5Kind,_.uvs5,_.uvs5._updatable),_.uvs6&&g.setVerticesData(d.b.UV6Kind,_.uvs6,_.uvs6._updatable),_.colors&&g.setVerticesData(d.b.ColorKind,m.b.CheckColors4(_.colors,_.positions.length/3),_.colors._updatable),_.matricesIndices)if(_.matricesIndices._isExpanded)delete _.matricesIndices._isExpanded,g.setVerticesData(d.b.MatricesIndicesKind,_.matricesIndices,_.matricesIndices._updatable);else{for(Z=[],te=0;te<_.matricesIndices.length;te++){var Q=_.matricesIndices[te];Z.push(255&Q),Z.push((65280&Q)>>8),Z.push((16711680&Q)>>16),Z.push(Q>>24&255)}g.setVerticesData(d.b.MatricesIndicesKind,Z,_.matricesIndices._updatable)}if(_.matricesIndicesExtra)if(_.matricesIndicesExtra._isExpanded)delete _.matricesIndices._isExpanded,g.setVerticesData(d.b.MatricesIndicesExtraKind,_.matricesIndicesExtra,_.matricesIndicesExtra._updatable);else{for(Z=[],te=0;te<_.matricesIndicesExtra.length;te++)Q=_.matricesIndicesExtra[te],Z.push(255&Q),Z.push((65280&Q)>>8),Z.push((16711680&Q)>>16),Z.push(Q>>24&255);g.setVerticesData(d.b.MatricesIndicesExtraKind,Z,_.matricesIndicesExtra._updatable)}_.matricesWeights&&(T._CleanMatricesWeights(_,g),g.setVerticesData(d.b.MatricesWeightsKind,_.matricesWeights,_.matricesWeights._updatable)),_.matricesWeightsExtra&&g.setVerticesData(d.b.MatricesWeightsExtraKind,_.matricesWeightsExtra,_.matricesWeights._updatable),g.setIndices(_.indices,null)}if(_.subMeshes){g.subMeshes=[];for(var ee=0;ee<_.subMeshes.length;ee++){var pe=_.subMeshes[ee];M.a.AddToMesh(pe.materialIndex,pe.verticesStart,pe.verticesCount,pe.indexStart,pe.indexCount,g)}}g._shouldGenerateFlatShading&&(g.convertToFlatShadedMesh(),g._shouldGenerateFlatShading=!1),g.computeWorldMatrix(!0),O.onMeshImportedObservable.notifyObservers(g)},T._CleanMatricesWeights=function(_,g){if(C.a.CleanBoneMatrixWeights){var O=0;if(_.skeletonId>-1){var R=g.getScene().getLastSkeletonByID(_.skeletonId);if(R){O=R.bones.length;for(var N=g.getVerticesData(d.b.MatricesIndicesKind),V=g.getVerticesData(d.b.MatricesIndicesExtraKind),U=_.matricesWeights,L=_.matricesWeightsExtra,j=_.numBoneInfluencer,Y=U.length,W=0;W<Y;W+=4){for(var re=0,ne=-1,ge=0;ge<4;ge++)re+=_e=U[W+ge],_e<.001&&ne<0&&(ne=ge);if(L)for(ge=0;ge<4;ge++){var _e;re+=_e=L[W+ge],_e<.001&&ne<0&&(ne=ge+4)}if((ne<0||ne>j-1)&&(ne=j-1),re>.001){var ce=1/re;for(ge=0;ge<4;ge++)U[W+ge]*=ce;if(L)for(ge=0;ge<4;ge++)L[W+ge]*=ce}else ne>=4?(L[W+ne-4]=1-re,V[W+ne-4]=O):(U[W+ne]=1-re,N[W+ne]=O)}g.setVerticesData(d.b.MatricesIndicesKind,N),_.matricesWeightsExtra&&g.setVerticesData(d.b.MatricesIndicesExtraKind,V)}}}},T.Parse=function(_,g,O){if(g.getGeometryByID(_.id))return null;var R=new T(_.id,g,void 0,_.updatable);return x.a&&x.a.AddTagsTo(R,_.tags),_.delayLoadingFile?(R.delayLoadState=b.a.DELAYLOADSTATE_NOTLOADED,R.delayLoadingFile=O+_.delayLoadingFile,R._boundingInfo=new I.a(E.e.FromArray(_.boundingBoxMinimum),E.e.FromArray(_.boundingBoxMaximum)),R._delayInfo=[],_.hasUVs&&R._delayInfo.push(d.b.UVKind),_.hasUVs2&&R._delayInfo.push(d.b.UV2Kind),_.hasUVs3&&R._delayInfo.push(d.b.UV3Kind),_.hasUVs4&&R._delayInfo.push(d.b.UV4Kind),_.hasUVs5&&R._delayInfo.push(d.b.UV5Kind),_.hasUVs6&&R._delayInfo.push(d.b.UV6Kind),_.hasColors&&R._delayInfo.push(d.b.ColorKind),_.hasMatricesIndices&&R._delayInfo.push(d.b.MatricesIndicesKind),_.hasMatricesWeights&&R._delayInfo.push(d.b.MatricesWeightsKind),R._delayLoadingFunction=S.a.ImportVertexData):S.a.ImportVertexData(_,R),g.pushGeometry(R,!0),R},T}()},function(h,s,c){c.d(s,"e",function(){return E}),c.d(s,"c",function(){return M}),c.d(s,"a",function(){return C}),c.d(s,"b",function(){return I}),c.d(s,"f",function(){return b}),c.d(s,"g",function(){return p}),c.d(s,"d",function(){return x});var E,m=c(14),S=c(0),d=c(28);(function(P){P[P.CW=0]="CW",P[P.CCW=1]="CCW"})(E||(E={}));var M=function(){function P(){}return P.Interpolate=function(A,T,_,g,O){for(var R=1-3*g+3*T,N=3*g-6*T,V=3*T,U=A,L=0;L<5;L++){var j=U*U;U-=(R*(j*U)+N*j+V*U-A)*(1/(3*R*j+2*N*U+V)),U=Math.min(1,Math.max(0,U))}return 3*Math.pow(1-U,2)*U*_+3*(1-U)*Math.pow(U,2)*O+Math.pow(U,3)},P}(),C=function(){function P(A){this._radians=A,this._radians<0&&(this._radians+=2*Math.PI)}return P.prototype.degrees=function(){return 180*this._radians/Math.PI},P.prototype.radians=function(){return this._radians},P.BetweenTwoPoints=function(A,T){var _=T.subtract(A);return new P(Math.atan2(_.y,_.x))},P.FromRadians=function(A){return new P(A)},P.FromDegrees=function(A){return new P(A*Math.PI/180)},P}(),I=function(P,A,T){this.startPoint=P,this.midPoint=A,this.endPoint=T;var _=Math.pow(A.x,2)+Math.pow(A.y,2),g=(Math.pow(P.x,2)+Math.pow(P.y,2)-_)/2,O=(_-Math.pow(T.x,2)-Math.pow(T.y,2))/2,R=(P.x-A.x)*(A.y-T.y)-(A.x-T.x)*(P.y-A.y);this.centerPoint=new S.d((g*(A.y-T.y)-O*(P.y-A.y))/R,((P.x-A.x)*O-(A.x-T.x)*g)/R),this.radius=this.centerPoint.subtract(this.startPoint).length(),this.startAngle=C.BetweenTwoPoints(this.centerPoint,this.startPoint);var N=this.startAngle.degrees(),V=C.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),U=C.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();V-N>180&&(V-=360),V-N<-180&&(V+=360),U-V>180&&(U-=360),U-V<-180&&(U+=360),this.orientation=V-N<0?E.CW:E.CCW,this.angle=C.FromDegrees(this.orientation===E.CW?N-U:U-N)},b=function(){function P(A,T){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new S.d(A,T))}return P.prototype.addLineTo=function(A,T){if(this.closed)return this;var _=new S.d(A,T),g=this._points[this._points.length-1];return this._points.push(_),this._length+=_.subtract(g).length(),this},P.prototype.addArcTo=function(A,T,_,g,O){if(O===void 0&&(O=36),this.closed)return this;var R=this._points[this._points.length-1],N=new S.d(A,T),V=new S.d(_,g),U=new I(R,N,V),L=U.angle.radians()/O;U.orientation===E.CW&&(L*=-1);for(var j=U.startAngle.radians()+L,Y=0;Y<O;Y++){var W=Math.cos(j)*U.radius+U.centerPoint.x,re=Math.sin(j)*U.radius+U.centerPoint.y;this.addLineTo(W,re),j+=L}return this},P.prototype.close=function(){return this.closed=!0,this},P.prototype.length=function(){var A=this._length;if(this.closed){var T=this._points[this._points.length-1];A+=this._points[0].subtract(T).length()}return A},P.prototype.getPoints=function(){return this._points},P.prototype.getPointAtLengthPosition=function(A){if(A<0||A>1)return S.d.Zero();for(var T=A*this.length(),_=0,g=0;g<this._points.length;g++){var O=(g+1)%this._points.length,R=this._points[g],N=this._points[O].subtract(R),V=N.length()+_;if(T>=_&&T<=V){var U=N.normalize(),L=T-_;return new S.d(R.x+U.x*L,R.y+U.y*L)}_=V}return S.d.Zero()},P.StartingAt=function(A,T){return new P(A,T)},P}(),p=function(){function P(A,T,_,g){T===void 0&&(T=null),g===void 0&&(g=!1),this.path=A,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array,this._pointAtData={id:0,point:S.e.Zero(),previousPointArrayIndex:0,position:0,subPosition:0,interpolateReady:!1,interpolationMatrix:S.a.Identity()};for(var O=0;O<A.length;O++)this._curve[O]=A[O].clone();this._raw=_||!1,this._alignTangentsWithPath=g,this._compute(T,g)}return P.prototype.getCurve=function(){return this._curve},P.prototype.getPoints=function(){return this._curve},P.prototype.length=function(){return this._distances[this._distances.length-1]},P.prototype.getTangents=function(){return this._tangents},P.prototype.getNormals=function(){return this._normals},P.prototype.getBinormals=function(){return this._binormals},P.prototype.getDistances=function(){return this._distances},P.prototype.getPointAt=function(A){return this._updatePointAtData(A).point},P.prototype.getTangentAt=function(A,T){return T===void 0&&(T=!1),this._updatePointAtData(A,T),T?S.e.TransformCoordinates(S.e.Forward(),this._pointAtData.interpolationMatrix):this._tangents[this._pointAtData.previousPointArrayIndex]},P.prototype.getNormalAt=function(A,T){return T===void 0&&(T=!1),this._updatePointAtData(A,T),T?S.e.TransformCoordinates(S.e.Right(),this._pointAtData.interpolationMatrix):this._normals[this._pointAtData.previousPointArrayIndex]},P.prototype.getBinormalAt=function(A,T){return T===void 0&&(T=!1),this._updatePointAtData(A,T),T?S.e.TransformCoordinates(S.e.UpReadOnly,this._pointAtData.interpolationMatrix):this._binormals[this._pointAtData.previousPointArrayIndex]},P.prototype.getDistanceAt=function(A){return this.length()*A},P.prototype.getPreviousPointIndexAt=function(A){return this._updatePointAtData(A),this._pointAtData.previousPointArrayIndex},P.prototype.getSubPositionAt=function(A){return this._updatePointAtData(A),this._pointAtData.subPosition},P.prototype.getClosestPositionTo=function(A){for(var T=Number.MAX_VALUE,_=0,g=0;g<this._curve.length-1;g++){var O=this._curve[g+0],R=this._curve[g+1].subtract(O).normalize(),N=this._distances[g+1]-this._distances[g+0],V=Math.min(Math.max(S.e.Dot(R,A.subtract(O).normalize()),0)*S.e.Distance(O,A)/N,1),U=S.e.Distance(O.add(R.scale(V*N)),A);U<T&&(T=U,_=(this._distances[g+0]+N*V)/this.length())}return _},P.prototype.slice=function(A,T){if(A===void 0&&(A=0),T===void 0&&(T=1),A<0&&(A=1- -1*A%1),T<0&&(T=1- -1*T%1),A>T){var _=A;A=T,T=_}var g=this.getCurve(),O=this.getPointAt(A),R=this.getPreviousPointIndexAt(A),N=this.getPointAt(T),V=this.getPreviousPointIndexAt(T)+1,U=[];return A!==0&&(R++,U.push(O)),U.push.apply(U,g.slice(R,V)),T===1&&A!==1||U.push(N),new P(U,this.getNormalAt(A),this._raw,this._alignTangentsWithPath)},P.prototype.update=function(A,T,_){T===void 0&&(T=null),_===void 0&&(_=!1);for(var g=0;g<A.length;g++)this._curve[g].x=A[g].x,this._curve[g].y=A[g].y,this._curve[g].z=A[g].z;return this._compute(T,_),this},P.prototype._compute=function(A,T){T===void 0&&(T=!1);var _=this._curve.length;if(!(_<2)){this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[_-1]=this._curve[_-1].subtract(this._curve[_-2]),this._raw||this._tangents[_-1].normalize();var g,O,R,N,V,U=this._tangents[0],L=this._normalVector(U,A);this._normals[0]=L,this._raw||this._normals[0].normalize(),this._binormals[0]=S.e.Cross(U,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(var j=1;j<_;j++)g=this._getLastNonNullVector(j),j<_-1&&(O=this._getFirstNonNullVector(j),this._tangents[j]=T?O:g.add(O),this._tangents[j].normalize()),this._distances[j]=this._distances[j-1]+this._curve[j].subtract(this._curve[j-1]).length(),R=this._tangents[j],V=this._binormals[j-1],this._normals[j]=S.e.Cross(V,R),this._raw||(this._normals[j].length()===0?(N=this._normals[j-1],this._normals[j]=N.clone()):this._normals[j].normalize()),this._binormals[j]=S.e.Cross(R,this._normals[j]),this._raw||this._binormals[j].normalize();this._pointAtData.id=NaN}},P.prototype._getFirstNonNullVector=function(A){for(var T=1,_=this._curve[A+T].subtract(this._curve[A]);_.length()===0&&A+T+1<this._curve.length;)T++,_=this._curve[A+T].subtract(this._curve[A]);return _},P.prototype._getLastNonNullVector=function(A){for(var T=1,_=this._curve[A].subtract(this._curve[A-T]);_.length()===0&&A>T+1;)T++,_=this._curve[A].subtract(this._curve[A-T]);return _},P.prototype._normalVector=function(A,T){var _,g,O=A.length();return O===0&&(O=1),T==null?(g=m.a.WithinEpsilon(Math.abs(A.y)/O,1,d.a)?m.a.WithinEpsilon(Math.abs(A.x)/O,1,d.a)?m.a.WithinEpsilon(Math.abs(A.z)/O,1,d.a)?S.e.Zero():new S.e(0,0,1):new S.e(1,0,0):new S.e(0,-1,0),_=S.e.Cross(A,g)):(_=S.e.Cross(A,T),S.e.CrossToRef(_,A,_)),_.normalize(),_},P.prototype._updatePointAtData=function(A,T){if(T===void 0&&(T=!1),this._pointAtData.id===A)return this._pointAtData.interpolateReady||this._updateInterpolationMatrix(),this._pointAtData;this._pointAtData.id=A;var _=this.getPoints();if(A<=0)return this._setPointAtData(0,0,_[0],0,T);if(A>=1)return this._setPointAtData(1,1,_[_.length-1],_.length-1,T);for(var g,O=_[0],R=0,N=A*this.length(),V=1;V<_.length;V++){g=_[V];var U=S.e.Distance(O,g);if((R+=U)===N)return this._setPointAtData(A,1,g,V,T);if(R>N){var L=(R-N)/U,j=O.subtract(g),Y=g.add(j.scaleInPlace(L));return this._setPointAtData(A,1-L,Y,V-1,T)}O=g}return this._pointAtData},P.prototype._setPointAtData=function(A,T,_,g,O){return this._pointAtData.point=_,this._pointAtData.position=A,this._pointAtData.subPosition=T,this._pointAtData.previousPointArrayIndex=g,this._pointAtData.interpolateReady=O,O&&this._updateInterpolationMatrix(),this._pointAtData},P.prototype._updateInterpolationMatrix=function(){this._pointAtData.interpolationMatrix=S.a.Identity();var A=this._pointAtData.previousPointArrayIndex;if(A!==this._tangents.length-1){var T=A+1,_=this._tangents[A].clone(),g=this._normals[A].clone(),O=this._binormals[A].clone(),R=this._tangents[T].clone(),N=this._normals[T].clone(),V=this._binormals[T].clone(),U=S.b.RotationQuaternionFromAxis(g,O,_),L=S.b.RotationQuaternionFromAxis(N,V,R);S.b.Slerp(U,L,this._pointAtData.subPosition).toRotationMatrix(this._pointAtData.interpolationMatrix)}},P}(),x=function(){function P(A){this._length=0,this._points=A,this._length=this._computeLength(A)}return P.CreateQuadraticBezier=function(A,T,_,g){g=g>2?g:3;for(var O=new Array,R=function(V,U,L,j){return(1-V)*(1-V)*U+2*V*(1-V)*L+V*V*j},N=0;N<=g;N++)O.push(new S.e(R(N/g,A.x,T.x,_.x),R(N/g,A.y,T.y,_.y),R(N/g,A.z,T.z,_.z)));return new P(O)},P.CreateCubicBezier=function(A,T,_,g,O){O=O>3?O:4;for(var R=new Array,N=function(U,L,j,Y,W){return(1-U)*(1-U)*(1-U)*L+3*U*(1-U)*(1-U)*j+3*U*U*(1-U)*Y+U*U*U*W},V=0;V<=O;V++)R.push(new S.e(N(V/O,A.x,T.x,_.x,g.x),N(V/O,A.y,T.y,_.y,g.y),N(V/O,A.z,T.z,_.z,g.z)));return new P(R)},P.CreateHermiteSpline=function(A,T,_,g,O){for(var R=new Array,N=1/O,V=0;V<=O;V++)R.push(S.e.Hermite(A,T,_,g,V*N));return new P(R)},P.CreateCatmullRomSpline=function(A,T,_){var g=new Array,O=1/T,R=0;if(_){for(var N=A.length,V=0;V<N;V++){R=0;for(var U=0;U<T;U++)g.push(S.e.CatmullRom(A[V%N],A[(V+1)%N],A[(V+2)%N],A[(V+3)%N],R)),R+=O}g.push(g[0])}else{var L=new Array;for(L.push(A[0].clone()),Array.prototype.push.apply(L,A),L.push(A[A.length-1].clone()),V=0;V<L.length-3;V++)for(R=0,U=0;U<T;U++)g.push(S.e.CatmullRom(L[V],L[V+1],L[V+2],L[V+3],R)),R+=O;V--,g.push(S.e.CatmullRom(L[V],L[V+1],L[V+2],L[V+3],R))}return new P(g)},P.prototype.getPoints=function(){return this._points},P.prototype.length=function(){return this._length},P.prototype.continue=function(A){for(var T=this._points[this._points.length-1],_=this._points.slice(),g=A.getPoints(),O=1;O<g.length;O++)_.push(g[O].subtract(g[0]).add(T));return new P(_)},P.prototype._computeLength=function(A){for(var T=0,_=1;_<A.length;_++)T+=A[_].subtract(A[_-1]).length();return T},P}()},function(h,s,c){c.d(s,"a",function(){return _});var E=c(1),m=c(3),S=c(0),d=c(4),M=c(10),C=c(15),I=c(25),b=c(11),p=c(9),x=c(67),P=c(49),A=c(13),T={effect:null,subMesh:null},_=function(g){function O(R,N,V,U){U===void 0&&(U={});var L=g.call(this,R,N)||this;return L._textures={},L._textureArrays={},L._floats={},L._ints={},L._floatsArrays={},L._colors3={},L._colors3Arrays={},L._colors4={},L._colors4Arrays={},L._vectors2={},L._vectors3={},L._vectors4={},L._matrices={},L._matrixArrays={},L._matrices3x3={},L._matrices2x2={},L._vectors2Arrays={},L._vectors3Arrays={},L._vectors4Arrays={},L._cachedWorldViewMatrix=new S.a,L._cachedWorldViewProjectionMatrix=new S.a,L._multiview=!1,L._shaderPath=V,L._options=Object(E.a)({needAlphaBlending:!1,needAlphaTesting:!1,attributes:["position","normal","uv"],uniforms:["worldViewProjection"],uniformBuffers:[],samplers:[],defines:[]},U),L}return Object(E.d)(O,g),Object.defineProperty(O.prototype,"shaderPath",{get:function(){return this._shaderPath},set:function(R){this._shaderPath=R},enumerable:!1,configurable:!0}),Object.defineProperty(O.prototype,"options",{get:function(){return this._options},enumerable:!1,configurable:!0}),O.prototype.getClassName=function(){return"ShaderMaterial"},O.prototype.needAlphaBlending=function(){return this.alpha<1||this._options.needAlphaBlending},O.prototype.needAlphaTesting=function(){return this._options.needAlphaTesting},O.prototype._checkUniform=function(R){this._options.uniforms.indexOf(R)===-1&&this._options.uniforms.push(R)},O.prototype.setTexture=function(R,N){return this._options.samplers.indexOf(R)===-1&&this._options.samplers.push(R),this._textures[R]=N,this},O.prototype.setTextureArray=function(R,N){return this._options.samplers.indexOf(R)===-1&&this._options.samplers.push(R),this._checkUniform(R),this._textureArrays[R]=N,this},O.prototype.setFloat=function(R,N){return this._checkUniform(R),this._floats[R]=N,this},O.prototype.setInt=function(R,N){return this._checkUniform(R),this._ints[R]=N,this},O.prototype.setFloats=function(R,N){return this._checkUniform(R),this._floatsArrays[R]=N,this},O.prototype.setColor3=function(R,N){return this._checkUniform(R),this._colors3[R]=N,this},O.prototype.setColor3Array=function(R,N){return this._checkUniform(R),this._colors3Arrays[R]=N.reduce(function(V,U){return U.toArray(V,V.length),V},[]),this},O.prototype.setColor4=function(R,N){return this._checkUniform(R),this._colors4[R]=N,this},O.prototype.setColor4Array=function(R,N){return this._checkUniform(R),this._colors4Arrays[R]=N.reduce(function(V,U){return U.toArray(V,V.length),V},[]),this},O.prototype.setVector2=function(R,N){return this._checkUniform(R),this._vectors2[R]=N,this},O.prototype.setVector3=function(R,N){return this._checkUniform(R),this._vectors3[R]=N,this},O.prototype.setVector4=function(R,N){return this._checkUniform(R),this._vectors4[R]=N,this},O.prototype.setMatrix=function(R,N){return this._checkUniform(R),this._matrices[R]=N,this},O.prototype.setMatrices=function(R,N){this._checkUniform(R);for(var V=new Float32Array(16*N.length),U=0;U<N.length;U++)N[U].copyToArray(V,16*U);return this._matrixArrays[R]=V,this},O.prototype.setMatrix3x3=function(R,N){return this._checkUniform(R),this._matrices3x3[R]=N,this},O.prototype.setMatrix2x2=function(R,N){return this._checkUniform(R),this._matrices2x2[R]=N,this},O.prototype.setArray2=function(R,N){return this._checkUniform(R),this._vectors2Arrays[R]=N,this},O.prototype.setArray3=function(R,N){return this._checkUniform(R),this._vectors3Arrays[R]=N,this},O.prototype.setArray4=function(R,N){return this._checkUniform(R),this._vectors4Arrays[R]=N,this},O.prototype._checkCache=function(R,N){return!R||!this._effect||this._effect.defines.indexOf("#define INSTANCES")!==-1===N},O.prototype.isReadyForSubMesh=function(R,N,V){return this.isReady(R,V)},O.prototype.isReady=function(R,N){var V,U;if(this._effect&&this.isFrozen&&this._effect._wasPreviouslyReady)return!0;var L=this.getScene(),j=L.getEngine();if(!this.checkReadyOnEveryCall&&this._renderId===L.getRenderId()&&this._checkCache(R,N))return!0;var Y=[],W=[],re=new x.a;j.getCaps().multiview&&L.activeCamera&&L.activeCamera.outputRenderTarget&&L.activeCamera.outputRenderTarget.getViewCount()>1&&(this._multiview=!0,Y.push("#define MULTIVIEW"),this._options.uniforms.indexOf("viewProjection")!==-1&&this._options.uniforms.push("viewProjectionR")===-1&&this._options.uniforms.push("viewProjectionR"));for(var ne=0;ne<this._options.defines.length;ne++)Y.push(this._options.defines[ne]);for(ne=0;ne<this._options.attributes.length;ne++)W.push(this._options.attributes[ne]);R&&R.isVerticesDataPresent(d.b.ColorKind)&&(W.push(d.b.ColorKind),Y.push("#define VERTEXCOLOR")),N&&(Y.push("#define INSTANCES"),C.a.PushAttributesForInstances(W),(R==null?void 0:R.hasThinInstances)&&Y.push("#define THIN_INSTANCES"));var ge=0;if(R&&R.useBones&&R.computeBonesUsingShaders&&R.skeleton){W.push(d.b.MatricesIndicesKind),W.push(d.b.MatricesWeightsKind),R.numBoneInfluencers>4&&(W.push(d.b.MatricesIndicesExtraKind),W.push(d.b.MatricesWeightsExtraKind));var _e=R.skeleton;ge=R.numBoneInfluencers,Y.push("#define NUM_BONE_INFLUENCERS "+ge),re.addCPUSkinningFallback(0,R),_e.isUsingTextureForMatrices?(Y.push("#define BONETEXTURE"),this._options.uniforms.indexOf("boneTextureWidth")===-1&&this._options.uniforms.push("boneTextureWidth"),this._options.samplers.indexOf("boneSampler")===-1&&this._options.samplers.push("boneSampler")):(Y.push("#define BonesPerMesh "+(_e.bones.length+1)),this._options.uniforms.indexOf("mBones")===-1&&this._options.uniforms.push("mBones"))}else Y.push("#define NUM_BONE_INFLUENCERS 0");for(var ce in this._textures)if(!this._textures[ce].isReady())return!1;R&&this._shouldTurnAlphaTestOn(R)&&Y.push("#define ALPHATEST");var ie=this._shaderPath,Z=this._options.uniforms,te=this._options.uniformBuffers,B=this._options.samplers;this.customShaderNameResolve&&(Z=Z.slice(),te=te.slice(),B=B.slice(),ie=this.customShaderNameResolve(ie,Z,te,B,Y,W));var G=this._effect,$=Y.join(`
`);return this._cachedDefines!==$&&(this._cachedDefines=$,this._effect=j.createEffect(ie,{attributes:W,uniformsNames:Z,uniformBuffersNames:te,samplers:B,defines:$,fallbacks:re,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousMorphTargets:ge}},j),this._onEffectCreatedObservable&&(T.effect=this._effect,this._onEffectCreatedObservable.notifyObservers(T))),(U=!((V=this._effect)===null||V===void 0?void 0:V.isReady()))!==null&&U!==void 0&&!U&&(G!==this._effect&&L.resetCachedMaterial(),this._renderId=L.getRenderId(),this._effect._wasPreviouslyReady=!0,!0)},O.prototype.bindOnlyWorldMatrix=function(R,N){var V=this.getScene(),U=N??this._effect;U&&(this._options.uniforms.indexOf("world")!==-1&&U.setMatrix("world",R),this._options.uniforms.indexOf("worldView")!==-1&&(R.multiplyToRef(V.getViewMatrix(),this._cachedWorldViewMatrix),U.setMatrix("worldView",this._cachedWorldViewMatrix)),this._options.uniforms.indexOf("worldViewProjection")!==-1&&(R.multiplyToRef(V.getTransformMatrix(),this._cachedWorldViewProjectionMatrix),U.setMatrix("worldViewProjection",this._cachedWorldViewProjectionMatrix)))},O.prototype.bindForSubMesh=function(R,N,V){this.bind(R,N,V._effectOverride)},O.prototype.bind=function(R,N,V){this.bindOnlyWorldMatrix(R,V);var U=V??this._effect;if(U&&this.getScene().getCachedMaterial()!==this){var L;for(L in this._options.uniforms.indexOf("view")!==-1&&U.setMatrix("view",this.getScene().getViewMatrix()),this._options.uniforms.indexOf("projection")!==-1&&U.setMatrix("projection",this.getScene().getProjectionMatrix()),this._options.uniforms.indexOf("viewProjection")!==-1&&(U.setMatrix("viewProjection",this.getScene().getTransformMatrix()),this._multiview&&U.setMatrix("viewProjectionR",this.getScene()._transformMatrixR)),this.getScene().activeCamera&&this._options.uniforms.indexOf("cameraPosition")!==-1&&U.setVector3("cameraPosition",this.getScene().activeCamera.globalPosition),C.a.BindBonesParameters(N,U),this._textures)U.setTexture(L,this._textures[L]);for(L in this._textureArrays)U.setTextureArray(L,this._textureArrays[L]);for(L in this._ints)U.setInt(L,this._ints[L]);for(L in this._floats)U.setFloat(L,this._floats[L]);for(L in this._floatsArrays)U.setArray(L,this._floatsArrays[L]);for(L in this._colors3)U.setColor3(L,this._colors3[L]);for(L in this._colors3Arrays)U.setArray3(L,this._colors3Arrays[L]);for(L in this._colors4){var j=this._colors4[L];U.setFloat4(L,j.r,j.g,j.b,j.a)}for(L in this._colors4Arrays)U.setArray4(L,this._colors4Arrays[L]);for(L in this._vectors2)U.setVector2(L,this._vectors2[L]);for(L in this._vectors3)U.setVector3(L,this._vectors3[L]);for(L in this._vectors4)U.setVector4(L,this._vectors4[L]);for(L in this._matrices)U.setMatrix(L,this._matrices[L]);for(L in this._matrixArrays)U.setMatrices(L,this._matrixArrays[L]);for(L in this._matrices3x3)U.setMatrix3x3(L,this._matrices3x3[L]);for(L in this._matrices2x2)U.setMatrix2x2(L,this._matrices2x2[L]);for(L in this._vectors2Arrays)U.setArray2(L,this._vectors2Arrays[L]);for(L in this._vectors3Arrays)U.setArray3(L,this._vectors3Arrays[L]);for(L in this._vectors4Arrays)U.setArray4(L,this._vectors4Arrays[L])}var Y=this._effect;this._effect=U,this._afterBind(N),this._effect=Y},O.prototype._afterBind=function(R){g.prototype._afterBind.call(this,R),this.getScene()._cachedEffect=this._effect},O.prototype.getActiveTextures=function(){var R=g.prototype.getActiveTextures.call(this);for(var N in this._textures)R.push(this._textures[N]);for(var N in this._textureArrays)for(var V=this._textureArrays[N],U=0;U<V.length;U++)R.push(V[U]);return R},O.prototype.hasTexture=function(R){if(g.prototype.hasTexture.call(this,R))return!0;for(var N in this._textures)if(this._textures[N]===R)return!0;for(var N in this._textureArrays)for(var V=this._textureArrays[N],U=0;U<V.length;U++)if(V[U]===R)return!0;return!1},O.prototype.clone=function(R){var N=this,V=m.a.Clone(function(){return new O(R,N.getScene(),N._shaderPath,N._options)},this);for(var U in V.name=R,V.id=R,typeof V._shaderPath=="object"&&(V._shaderPath=Object(E.a)({},V._shaderPath)),this._options=Object(E.a)({},this._options),Object.keys(this._options).forEach(function(L){var j=N._options[L];Array.isArray(j)&&(N._options[L]=j.slice(0))}),this._textures)V.setTexture(U,this._textures[U]);for(var U in this._floats)V.setFloat(U,this._floats[U]);for(var U in this._floatsArrays)V.setFloats(U,this._floatsArrays[U]);for(var U in this._colors3)V.setColor3(U,this._colors3[U]);for(var U in this._colors4)V.setColor4(U,this._colors4[U]);for(var U in this._vectors2)V.setVector2(U,this._vectors2[U]);for(var U in this._vectors3)V.setVector3(U,this._vectors3[U]);for(var U in this._vectors4)V.setVector4(U,this._vectors4[U]);for(var U in this._matrices)V.setMatrix(U,this._matrices[U]);for(var U in this._matrices3x3)V.setMatrix3x3(U,this._matrices3x3[U]);for(var U in this._matrices2x2)V.setMatrix2x2(U,this._matrices2x2[U]);return V},O.prototype.dispose=function(R,N,V){if(N){var U;for(U in this._textures)this._textures[U].dispose();for(U in this._textureArrays)for(var L=this._textureArrays[U],j=0;j<L.length;j++)L[j].dispose()}this._textures={},g.prototype.dispose.call(this,R,N,V)},O.prototype.serialize=function(){var R,N=m.a.Serialize(this);for(R in N.customType="BABYLON.ShaderMaterial",N.options=this._options,N.shaderPath=this._shaderPath,N.textures={},this._textures)N.textures[R]=this._textures[R].serialize();for(R in N.textureArrays={},this._textureArrays){N.textureArrays[R]=[];for(var V=this._textureArrays[R],U=0;U<V.length;U++)N.textureArrays[R].push(V[U].serialize())}for(R in N.floats={},this._floats)N.floats[R]=this._floats[R];for(R in N.FloatArrays={},this._floatsArrays)N.FloatArrays[R]=this._floatsArrays[R];for(R in N.colors3={},this._colors3)N.colors3[R]=this._colors3[R].asArray();for(R in N.colors3Arrays={},this._colors3Arrays)N.colors3Arrays[R]=this._colors3Arrays[R];for(R in N.colors4={},this._colors4)N.colors4[R]=this._colors4[R].asArray();for(R in N.colors4Arrays={},this._colors4Arrays)N.colors4Arrays[R]=this._colors4Arrays[R];for(R in N.vectors2={},this._vectors2)N.vectors2[R]=this._vectors2[R].asArray();for(R in N.vectors3={},this._vectors3)N.vectors3[R]=this._vectors3[R].asArray();for(R in N.vectors4={},this._vectors4)N.vectors4[R]=this._vectors4[R].asArray();for(R in N.matrices={},this._matrices)N.matrices[R]=this._matrices[R].asArray();for(R in N.matrixArray={},this._matrixArrays)N.matrixArray[R]=this._matrixArrays[R];for(R in N.matrices3x3={},this._matrices3x3)N.matrices3x3[R]=this._matrices3x3[R];for(R in N.matrices2x2={},this._matrices2x2)N.matrices2x2[R]=this._matrices2x2[R];for(R in N.vectors2Arrays={},this._vectors2Arrays)N.vectors2Arrays[R]=this._vectors2Arrays[R];for(R in N.vectors3Arrays={},this._vectors3Arrays)N.vectors3Arrays[R]=this._vectors3Arrays[R];for(R in N.vectors4Arrays={},this._vectors4Arrays)N.vectors4Arrays[R]=this._vectors4Arrays[R];return N},O.Parse=function(R,N,V){var U,L=m.a.Parse(function(){return new O(R.name,N,R.shaderPath,R.options)},R,N,V);for(U in R.textures)L.setTexture(U,M.a.Parse(R.textures[U],N,V));for(U in R.textureArrays){for(var j=R.textureArrays[U],Y=new Array,W=0;W<j.length;W++)Y.push(M.a.Parse(j[W],N,V));L.setTextureArray(U,Y)}for(U in R.floats)L.setFloat(U,R.floats[U]);for(U in R.floatsArrays)L.setFloats(U,R.floatsArrays[U]);for(U in R.colors3)L.setColor3(U,p.a.FromArray(R.colors3[U]));for(U in R.colors3Arrays){var re=R.colors3Arrays[U].reduce(function(ne,ge,_e){return _e%3==0?ne.push([ge]):ne[ne.length-1].push(ge),ne},[]).map(function(ne){return p.a.FromArray(ne)});L.setColor3Array(U,re)}for(U in R.colors4)L.setColor4(U,p.b.FromArray(R.colors4[U]));for(U in R.colors4Arrays)re=R.colors4Arrays[U].reduce(function(ne,ge,_e){return _e%4==0?ne.push([ge]):ne[ne.length-1].push(ge),ne},[]).map(function(ne){return p.b.FromArray(ne)}),L.setColor4Array(U,re);for(U in R.vectors2)L.setVector2(U,S.d.FromArray(R.vectors2[U]));for(U in R.vectors3)L.setVector3(U,S.e.FromArray(R.vectors3[U]));for(U in R.vectors4)L.setVector4(U,S.f.FromArray(R.vectors4[U]));for(U in R.matrices)L.setMatrix(U,S.a.FromArray(R.matrices[U]));for(U in R.matrixArray)L._matrixArrays[U]=new Float32Array(R.matrixArray[U]);for(U in R.matrices3x3)L.setMatrix3x3(U,R.matrices3x3[U]);for(U in R.matrices2x2)L.setMatrix2x2(U,R.matrices2x2[U]);for(U in R.vectors2Arrays)L.setArray2(U,R.vectors2Arrays[U]);for(U in R.vectors3Arrays)L.setArray3(U,R.vectors3Arrays[U]);for(U in R.vectors4Arrays)L.setArray4(U,R.vectors4Arrays[U]);return L},O.ParseFromFileAsync=function(R,N,V,U){var L=this;return U===void 0&&(U=""),new Promise(function(j,Y){var W=new P.a;W.addEventListener("readystatechange",function(){if(W.readyState==4)if(W.status==200){var re=JSON.parse(W.responseText),ne=L.Parse(re,V||A.a.LastCreatedScene,U);R&&(ne.name=R),j(ne)}else Y("Unable to load the ShaderMaterial")}),W.open("GET",N),W.send()})},O.CreateFromSnippetAsync=function(R,N,V){var U=this;return V===void 0&&(V=""),new Promise(function(L,j){var Y=new P.a;Y.addEventListener("readystatechange",function(){if(Y.readyState==4)if(Y.status==200){var W=JSON.parse(JSON.parse(Y.responseText).jsonPayload),re=JSON.parse(W.shaderMaterial),ne=U.Parse(re,N||A.a.LastCreatedScene,V);ne.snippetId=R,L(ne)}else j("Unable to load the snippet "+R)}),Y.open("GET",U.SnippetUrl+"/"+R.replace(/#/g,"/")),Y.send()})},O.SnippetUrl="https://snippet.babylonjs.com",O}(I.a);b.a.RegisteredTypes["BABYLON.ShaderMaterial"]=_},function(h,s,c){c.d(s,"a",function(){return E});var E=function(){function m(){}return m.SetMatrixPrecision=function(S){if(m.MatrixTrackPrecisionChange=!1,S&&!m.MatrixUse64Bits&&m.MatrixTrackedMatrices)for(var d=0;d<m.MatrixTrackedMatrices.length;++d){var M=m.MatrixTrackedMatrices[d],C=M._m;M._m=new Array(16);for(var I=0;I<16;++I)M._m[I]=C[I]}m.MatrixUse64Bits=S,m.MatrixCurrentType=m.MatrixUse64Bits?Array:Float32Array,m.MatrixTrackedMatrices=null},m.MatrixUse64Bits=!1,m.MatrixTrackPrecisionChange=!0,m.MatrixCurrentType=Float32Array,m.MatrixTrackedMatrices=[],m}()},function(h,s,c){c.d(s,"a",function(){return A});var E=c(1),m=c(6),S=c(0),d=c(46),M=c(7),C=c(53),I=c(65),b=c(51),p=c(36),x=c(30),P=c(9),A=function(T){function _(g,O,R,N,V){var U;O===void 0&&(O=P.a.Gray()),R===void 0&&(R=p.a.DefaultUtilityLayer),N===void 0&&(N=null),V===void 0&&(V=1);var L=T.call(this,R)||this;L._pointerObserver=null,L.snapDistance=0,L.onSnapObservable=new m.c,L._isEnabled=!0,L._parent=null,L._dragging=!1,L._parent=N,L._coloredMaterial=new x.a("",R.utilityLayerScene),L._coloredMaterial.diffuseColor=O,L._coloredMaterial.specularColor=O.subtract(new P.a(.1,.1,.1)),L._hoverMaterial=new x.a("",R.utilityLayerScene),L._hoverMaterial.diffuseColor=P.a.Yellow(),L._disableMaterial=new x.a("",R.utilityLayerScene),L._disableMaterial.diffuseColor=P.a.Gray(),L._disableMaterial.alpha=.4;var j=_._CreateArrow(R.utilityLayerScene,L._coloredMaterial,V),Y=_._CreateArrow(R.utilityLayerScene,L._coloredMaterial,V+4,!0);L._gizmoMesh=new M.a("",R.utilityLayerScene),L._gizmoMesh.addChild(j),L._gizmoMesh.addChild(Y),L._gizmoMesh.lookAt(L._rootMesh.position.add(g)),L._gizmoMesh.scaling.scaleInPlace(1/3),L._gizmoMesh.parent=L._rootMesh;var W=0,re=new S.e,ne={snapDistance:0};L.dragBehavior=new I.a({dragAxis:g}),L.dragBehavior.moveAttached=!1,L._rootMesh.addBehavior(L.dragBehavior),L.dragBehavior.onDragObservable.add(function(ce){if(L.attachedNode){if(L.snapDistance==0)L.attachedNode.position&&L.attachedNode.position.addInPlaceFromFloats(ce.delta.x,ce.delta.y,ce.delta.z),L.attachedNode.getWorldMatrix().addTranslationFromFloats(ce.delta.x,ce.delta.y,ce.delta.z),L.attachedNode.updateCache();else if(W+=ce.dragDistance,Math.abs(W)>L.snapDistance){var ie=Math.floor(Math.abs(W)/L.snapDistance);W%=L.snapDistance,ce.delta.normalizeToRef(re),re.scaleInPlace(L.snapDistance*ie),L.attachedNode.getWorldMatrix().addTranslationFromFloats(re.x,re.y,re.z),L.attachedNode.updateCache(),ne.snapDistance=L.snapDistance*ie,L.onSnapObservable.notifyObservers(ne)}L._matrixChanged()}}),L.dragBehavior.onDragStartObservable.add(function(){L._dragging=!0}),L.dragBehavior.onDragEndObservable.add(function(){L._dragging=!1});var ge=R._getSharedGizmoLight();ge.includedOnlyMeshes=ge.includedOnlyMeshes.concat(L._rootMesh.getChildMeshes(!1));var _e={gizmoMeshes:j.getChildMeshes(),colliderMeshes:Y.getChildMeshes(),material:L._coloredMaterial,hoverMaterial:L._hoverMaterial,disableMaterial:L._disableMaterial,active:!1};return(U=L._parent)===null||U===void 0||U.addToAxisCache(Y,_e),L._pointerObserver=R.utilityLayerScene.onPointerObservable.add(function(ce){var ie;if(!L._customMeshSet&&(L._isHovered=_e.colliderMeshes.indexOf((ie=ce==null?void 0:ce.pickInfo)===null||ie===void 0?void 0:ie.pickedMesh)!=-1,!L._parent)){var Z=L._isHovered||L._dragging?L._hoverMaterial:L._coloredMaterial;_e.gizmoMeshes.forEach(function(te){te.material=Z,te.color&&(te.color=Z.diffuseColor)})}}),L}return Object(E.d)(_,T),_._CreateArrow=function(g,O,R,N){R===void 0&&(R=1),N===void 0&&(N=!1);var V=new d.a("arrow",g),U=C.a.CreateCylinder("cylinder",{diameterTop:0,height:.075,diameterBottom:.0375*(1+(R-1)/4),tessellation:96},g),L=C.a.CreateCylinder("cylinder",{diameterTop:.005*R,height:.275,diameterBottom:.005*R,tessellation:96},g);return U.parent=V,U.material=O,U.rotation.x=Math.PI/2,U.position.z+=.3,L.parent=V,L.material=O,L.position.z+=.1375,L.rotation.x=Math.PI/2,N&&(L.visibility=0,U.visibility=0),V},_._CreateArrowInstance=function(g,O){for(var R=new d.a("arrow",g),N=0,V=O.getChildMeshes();N<V.length;N++){var U=V[N];U.createInstance(U.name).parent=R}return R},_.prototype._attachedNodeChanged=function(g){this.dragBehavior&&(this.dragBehavior.enabled=!!g)},Object.defineProperty(_.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(g){this._isEnabled=g,g?this._parent&&(this.attachedMesh=this._parent.attachedMesh,this.attachedNode=this._parent.attachedNode):(this.attachedMesh=null,this.attachedNode=null)},enumerable:!1,configurable:!0}),_.prototype.dispose=function(){this.onSnapObservable.clear(),this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this.dragBehavior.detach(),this._gizmoMesh&&this._gizmoMesh.dispose(),[this._coloredMaterial,this._hoverMaterial,this._disableMaterial].forEach(function(g){g&&g.dispose()}),T.prototype.dispose.call(this)},_}(b.a)},function(h,s,c){c.d(s,"a",function(){return E});var E=function(){function m(){this._isDirty=!0,this._areLightsDirty=!0,this._areLightsDisposed=!1,this._areAttributesDirty=!0,this._areTexturesDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._normals=!1,this._uvs=!1,this._needNormals=!1,this._needUVs=!1}return Object.defineProperty(m.prototype,"isDirty",{get:function(){return this._isDirty},enumerable:!1,configurable:!0}),m.prototype.markAsProcessed=function(){this._isDirty=!1,this._areAttributesDirty=!1,this._areTexturesDirty=!1,this._areFresnelDirty=!1,this._areLightsDirty=!1,this._areLightsDisposed=!1,this._areMiscDirty=!1,this._arePrePassDirty=!1,this._areImageProcessingDirty=!1},m.prototype.markAsUnprocessed=function(){this._isDirty=!0},m.prototype.markAllAsDirty=function(){this._areTexturesDirty=!0,this._areAttributesDirty=!0,this._areLightsDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._areImageProcessingDirty=!0,this._isDirty=!0},m.prototype.markAsImageProcessingDirty=function(){this._areImageProcessingDirty=!0,this._isDirty=!0},m.prototype.markAsLightDirty=function(S){S===void 0&&(S=!1),this._areLightsDirty=!0,this._areLightsDisposed=this._areLightsDisposed||S,this._isDirty=!0},m.prototype.markAsAttributesDirty=function(){this._areAttributesDirty=!0,this._isDirty=!0},m.prototype.markAsTexturesDirty=function(){this._areTexturesDirty=!0,this._isDirty=!0},m.prototype.markAsFresnelDirty=function(){this._areFresnelDirty=!0,this._isDirty=!0},m.prototype.markAsMiscDirty=function(){this._areMiscDirty=!0,this._isDirty=!0},m.prototype.markAsPrePassDirty=function(){this._arePrePassDirty=!0,this._isDirty=!0},m.prototype.rebuild=function(){this._keys=[];for(var S=0,d=Object.keys(this);S<d.length;S++){var M=d[S];M[0]!=="_"&&this._keys.push(M)}},m.prototype.isEqual=function(S){if(this._keys.length!==S._keys.length)return!1;for(var d=0;d<this._keys.length;d++){var M=this._keys[d];if(this[M]!==S[M])return!1}return!0},m.prototype.cloneTo=function(S){this._keys.length!==S._keys.length&&(S._keys=this._keys.slice(0));for(var d=0;d<this._keys.length;d++){var M=this._keys[d];S[M]=this[M]}},m.prototype.reset=function(){for(var S=0;S<this._keys.length;S++){var d=this._keys[S];switch(typeof this[d]){case"number":this[d]=0;break;case"string":this[d]="";break;default:this[d]=!1}}},m.prototype.toString=function(){for(var S="",d=0;d<this._keys.length;d++){var M=this._keys[d],C=this[M];switch(typeof C){case"number":case"string":S+="#define "+M+" "+C+`
`;break;default:C&&(S+="#define "+M+`
`)}}return S},m}()},function(h,s,c){c.d(s,"a",function(){return E});var E=function(){function m(S,d){this.width=S,this.height=d}return m.prototype.toString=function(){return"{W: "+this.width+", H: "+this.height+"}"},m.prototype.getClassName=function(){return"Size"},m.prototype.getHashCode=function(){var S=0|this.width;return S=397*S^(0|this.height)},m.prototype.copyFrom=function(S){this.width=S.width,this.height=S.height},m.prototype.copyFromFloats=function(S,d){return this.width=S,this.height=d,this},m.prototype.set=function(S,d){return this.copyFromFloats(S,d)},m.prototype.multiplyByFloats=function(S,d){return new m(this.width*S,this.height*d)},m.prototype.clone=function(){return new m(this.width,this.height)},m.prototype.equals=function(S){return!!S&&this.width===S.width&&this.height===S.height},Object.defineProperty(m.prototype,"surface",{get:function(){return this.width*this.height},enumerable:!1,configurable:!0}),m.Zero=function(){return new m(0,0)},m.prototype.add=function(S){return new m(this.width+S.width,this.height+S.height)},m.prototype.subtract=function(S){return new m(this.width-S.width,this.height-S.height)},m.Lerp=function(S,d,M){return new m(S.width+(d.width-S.width)*M,S.height+(d.height-S.height)*M)},m}()},function(h,s,c){var E="bonesDeclaration",m=`#if NUM_BONE_INFLUENCERS>0
#ifdef BONETEXTURE
uniform sampler2D boneSampler;
uniform float boneTextureWidth;
#else
uniform mat4 mBones[BonesPerMesh];
#ifdef BONES_VELOCITY_ENABLED
uniform mat4 mPreviousBones[BonesPerMesh];
#endif
#endif
attribute vec4 matricesIndices;
attribute vec4 matricesWeights;
#if NUM_BONE_INFLUENCERS>4
attribute vec4 matricesIndicesExtra;
attribute vec4 matricesWeightsExtra;
#endif
#ifdef BONETEXTURE
#define inline
mat4 readMatrixFromRawSampler(sampler2D smp,float index)
{
float offset=index*4.0;
float dx=1.0/boneTextureWidth;
vec4 m0=texture2D(smp,vec2(dx*(offset+0.5),0.));
vec4 m1=texture2D(smp,vec2(dx*(offset+1.5),0.));
vec4 m2=texture2D(smp,vec2(dx*(offset+2.5),0.));
vec4 m3=texture2D(smp,vec2(dx*(offset+3.5),0.));
return mat4(m0,m1,m2,m3);
}
#endif
#endif`;c(5).a.IncludesShadersStore[E]=m},function(h,s,c){var E="instancesDeclaration",m=`#ifdef INSTANCES
attribute vec4 world0;
attribute vec4 world1;
attribute vec4 world2;
attribute vec4 world3;
#ifdef THIN_INSTANCES
uniform mat4 world;
#endif
#else
uniform mat4 world;
#endif`;c(5).a.IncludesShadersStore[E]=m},function(h,s,c){var E="instancesVertex",m=`#ifdef INSTANCES
mat4 finalWorld=mat4(world0,world1,world2,world3);
#ifdef THIN_INSTANCES
finalWorld=world*finalWorld;
#endif
#else
mat4 finalWorld=world;
#endif`;c(5).a.IncludesShadersStore[E]=m},function(h,s,c){var E=`#if NUM_BONE_INFLUENCERS>0
mat4 influence;
#ifdef BONETEXTURE
influence=readMatrixFromRawSampler(boneSampler,matricesIndices[0])*matricesWeights[0];
#if NUM_BONE_INFLUENCERS>1
influence+=readMatrixFromRawSampler(boneSampler,matricesIndices[1])*matricesWeights[1];
#endif
#if NUM_BONE_INFLUENCERS>2
influence+=readMatrixFromRawSampler(boneSampler,matricesIndices[2])*matricesWeights[2];
#endif
#if NUM_BONE_INFLUENCERS>3
influence+=readMatrixFromRawSampler(boneSampler,matricesIndices[3])*matricesWeights[3];
#endif
#if NUM_BONE_INFLUENCERS>4
influence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[0])*matricesWeightsExtra[0];
#endif
#if NUM_BONE_INFLUENCERS>5
influence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[1])*matricesWeightsExtra[1];
#endif
#if NUM_BONE_INFLUENCERS>6
influence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[2])*matricesWeightsExtra[2];
#endif
#if NUM_BONE_INFLUENCERS>7
influence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[3])*matricesWeightsExtra[3];
#endif
#else
influence=mBones[int(matricesIndices[0])]*matricesWeights[0];
#if NUM_BONE_INFLUENCERS>1
influence+=mBones[int(matricesIndices[1])]*matricesWeights[1];
#endif
#if NUM_BONE_INFLUENCERS>2
influence+=mBones[int(matricesIndices[2])]*matricesWeights[2];
#endif
#if NUM_BONE_INFLUENCERS>3
influence+=mBones[int(matricesIndices[3])]*matricesWeights[3];
#endif
#if NUM_BONE_INFLUENCERS>4
influence+=mBones[int(matricesIndicesExtra[0])]*matricesWeightsExtra[0];
#endif
#if NUM_BONE_INFLUENCERS>5
influence+=mBones[int(matricesIndicesExtra[1])]*matricesWeightsExtra[1];
#endif
#if NUM_BONE_INFLUENCERS>6
influence+=mBones[int(matricesIndicesExtra[2])]*matricesWeightsExtra[2];
#endif
#if NUM_BONE_INFLUENCERS>7
influence+=mBones[int(matricesIndicesExtra[3])]*matricesWeightsExtra[3];
#endif
#endif
finalWorld=finalWorld*influence;
#endif`;c(5).a.IncludesShadersStore.bonesVertex=E},function(h,s,c){c.d(s,"a",function(){return C});var E=c(0),m=c(7),S=c(4),d=c(16),M=c(43);d.a.CreateRibbon=function(I){var b=I.pathArray,p=I.closeArray||!1,x=I.closePath||!1,P=I.invertUV||!1,A=Math.floor(b[0].length/2),T=I.offset||A;T=T>A?A:Math.floor(T);var _,g,O,R,N=I.sideOrientation===0?0:I.sideOrientation||d.a.DEFAULTSIDE,V=I.uvs,U=I.colors,L=[],j=[],Y=[],W=[],re=[],ne=[],ge=[],_e=[],ce=[],ie=[];if(b.length<2){var Z=[],te=[];for(O=0;O<b[0].length-T;O++)Z.push(b[0][O]),te.push(b[0][O+T]);b=[Z,te]}var B,G,$,le,se,q=0,H=x?1:0;for(_=b[0].length,g=0;g<b.length;g++){for(ge[g]=0,re[g]=[0],_=_<(G=(B=b[g]).length)?_:G,R=0;R<G;)L.push(B[R].x,B[R].y,B[R].z),R>0&&($=B[R].subtract(B[R-1]).length()+ge[g],re[g].push($),ge[g]=$),R++;x&&(R--,L.push(B[0].x,B[0].y,B[0].z),$=B[R].subtract(B[0]).length()+ge[g],re[g].push($),ge[g]=$),ce[g]=G+H,ie[g]=q,q+=G+H}var X,J,Q=null,ee=null;for(O=0;O<_+H;O++){for(_e[O]=0,ne[O]=[0],g=0;g<b.length-1;g++)le=b[g],se=b[g+1],O===_?(Q=le[0],ee=se[0]):(Q=le[O],ee=se[O]),$=ee.subtract(Q).length()+_e[O],ne[O].push($),_e[O]=$;p&&ee&&Q&&(le=b[g],se=b[0],O===_&&(ee=se[0]),$=ee.subtract(Q).length()+_e[O],_e[O]=$)}if(V)for(g=0;g<V.length;g++)W.push(V[g].x,V[g].y);else for(g=0;g<b.length;g++)for(O=0;O<_+H;O++)X=ge[g]!=0?re[g][O]/ge[g]:0,J=_e[O]!=0?ne[O][g]/_e[O]:0,P?W.push(J,X):W.push(X,J);for(var pe=0,Te=ce[g=0]-1,ve=ce[g+1]-1,he=Te<ve?Te:ve,be=ie[1]-ie[0],xe=p?ce.length:ce.length-1;pe<=he&&g<xe;)j.push(pe,pe+be,pe+1),j.push(pe+be+1,pe+1,pe+be),(pe+=1)===he&&(++g==ce.length-1?(be=ie[0]-ie[g],Te=ce[g]-1,ve=ce[0]-1):(be=ie[g+1]-ie[g],Te=ce[g]-1,ve=ce[g+1]-1),pe=ie[g],he=Te<ve?Te+pe:ve+pe);if(d.a.ComputeNormals(L,j,Y),x){var Se=0,Ue=0;for(g=0;g<b.length;g++)Se=3*ie[g],Ue=g+1<b.length?3*(ie[g+1]-1):Y.length-3,Y[Se]=.5*(Y[Se]+Y[Ue]),Y[Se+1]=.5*(Y[Se+1]+Y[Ue+1]),Y[Se+2]=.5*(Y[Se+2]+Y[Ue+2]),Y[Ue]=Y[Se],Y[Ue+1]=Y[Se+1],Y[Ue+2]=Y[Se+2]}d.a._ComputeSides(N,L,j,Y,W,I.frontUVs,I.backUVs);var We=null;if(U){We=new Float32Array(4*U.length);for(var Ze=0;Ze<U.length;Ze++)We[4*Ze]=U[Ze].r,We[4*Ze+1]=U[Ze].g,We[4*Ze+2]=U[Ze].b,We[4*Ze+3]=U[Ze].a}var Qe=new d.a,Xe=new Float32Array(L),nt=new Float32Array(Y),Ke=new Float32Array(W);return Qe.indices=j,Qe.positions=Xe,Qe.normals=nt,Qe.uvs=Ke,We&&Qe.set(We,S.b.ColorKind),x&&(Qe._idx=ie),Qe},m.a.CreateRibbon=function(I,b,p,x,P,A,T,_,g){return p===void 0&&(p=!1),T===void 0&&(T=!1),C.CreateRibbon(I,{pathArray:b,closeArray:p,closePath:x,offset:P,updatable:T,sideOrientation:_,instance:g},A)};var C=function(){function I(){}return I.CreateRibbon=function(b,p,x){x===void 0&&(x=null);var P=p.pathArray,A=p.closeArray,T=p.closePath,_=m.a._GetDefaultSideOrientation(p.sideOrientation),g=p.instance,O=p.updatable;if(g){var R=E.c.Vector3[0].setAll(Number.MAX_VALUE),N=E.c.Vector3[1].setAll(-Number.MAX_VALUE),V=g.getVerticesData(S.b.PositionKind);if(function(G){for(var $=P[0].length,le=g,se=0,q=le._originalBuilderSideOrientation===m.a.DOUBLESIDE?2:1,H=1;H<=q;++H)for(var X=0;X<P.length;++X){var J=P[X],Q=J.length;$=$<Q?$:Q;for(var ee=0;ee<$;++ee){var pe=J[ee];G[se]=pe.x,G[se+1]=pe.y,G[se+2]=pe.z,R.minimizeInPlaceFromFloats(pe.x,pe.y,pe.z),N.maximizeInPlaceFromFloats(pe.x,pe.y,pe.z),se+=3}le._creationDataStorage&&le._creationDataStorage.closePath&&(pe=J[0],G[se]=pe.x,G[se+1]=pe.y,G[se+2]=pe.z,se+=3)}}(V),g._boundingInfo?g._boundingInfo.reConstruct(R,N,g._worldMatrix):g._boundingInfo=new M.a(R,N,g._worldMatrix),g.updateVerticesData(S.b.PositionKind,V,!1,!1),p.colors){for(var U=g.getVerticesData(S.b.ColorKind),L=0,j=0;L<p.colors.length;L++,j+=4){var Y=p.colors[L];U[j]=Y.r,U[j+1]=Y.g,U[j+2]=Y.b,U[j+3]=Y.a}g.updateVerticesData(S.b.ColorKind,U,!1,!1)}if(p.uvs){for(var W=g.getVerticesData(S.b.UVKind),re=0;re<p.uvs.length;re++)W[2*re]=p.uvs[re].x,W[2*re+1]=p.uvs[re].y;g.updateVerticesData(S.b.UVKind,W,!1,!1)}if(!g.areNormalsFrozen||g.isFacetDataEnabled){var ne=g.getIndices(),ge=g.getVerticesData(S.b.NormalKind),_e=g.isFacetDataEnabled?g.getFacetDataParameters():null;if(d.a.ComputeNormals(V,ne,ge,_e),g._creationDataStorage&&g._creationDataStorage.closePath)for(var ce=0,ie=0,Z=0;Z<P.length;Z++)ce=3*g._creationDataStorage.idx[Z],ie=Z+1<P.length?3*(g._creationDataStorage.idx[Z+1]-1):ge.length-3,ge[ce]=.5*(ge[ce]+ge[ie]),ge[ce+1]=.5*(ge[ce+1]+ge[ie+1]),ge[ce+2]=.5*(ge[ce+2]+ge[ie+2]),ge[ie]=ge[ce],ge[ie+1]=ge[ce+1],ge[ie+2]=ge[ce+2];g.areNormalsFrozen||g.updateVerticesData(S.b.NormalKind,ge,!1,!1)}return g}var te=new m.a(b,x);te._originalBuilderSideOrientation=_,te._creationDataStorage=new m.b;var B=d.a.CreateRibbon(p);return T&&(te._creationDataStorage.idx=B._idx),te._creationDataStorage.closePath=T,te._creationDataStorage.closeArray=A,B.applyToMesh(te,O),te},I}()},function(h,s,c){c.d(s,"a",function(){return E});var E=function(){function m(){}return m.FilesToLoad={},m}()},function(h,s,c){c.d(s,"a",function(){return S});var E=c(7),m=c(16);m.a.CreatePlane=function(d){var M=[],C=[],I=[],b=[],p=d.width||d.size||1,x=d.height||d.size||1,P=d.sideOrientation===0?0:d.sideOrientation||m.a.DEFAULTSIDE,A=p/2,T=x/2;C.push(-A,-T,0),I.push(0,0,-1),b.push(0,0),C.push(A,-T,0),I.push(0,0,-1),b.push(1,0),C.push(A,T,0),I.push(0,0,-1),b.push(1,1),C.push(-A,T,0),I.push(0,0,-1),b.push(0,1),M.push(0),M.push(1),M.push(2),M.push(0),M.push(2),M.push(3),m.a._ComputeSides(P,C,M,I,b,d.frontUVs,d.backUVs);var _=new m.a;return _.indices=M,_.positions=C,_.normals=I,_.uvs=b,_},E.a.CreatePlane=function(d,M,C,I,b){var p={size:M,width:M,height:M,sideOrientation:b,updatable:I};return S.CreatePlane(d,p,C)};var S=function(){function d(){}return d.CreatePlane=function(M,C,I){I===void 0&&(I=null);var b=new E.a(M,I);return C.sideOrientation=E.a._GetDefaultSideOrientation(C.sideOrientation),b._originalBuilderSideOrientation=C.sideOrientation,m.a.CreatePlane(C).applyToMesh(b,C.updatable),C.sourcePlane&&(b.translate(C.sourcePlane.normal,-C.sourcePlane.d),b.setDirection(C.sourcePlane.normal.scale(-1))),b},d}()},function(h,s,c){c.d(s,"a",function(){return m});var E=c(8),m=(c(153),function(){function S(d,M,C){this._alreadyBound=!1,this._valueCache={},this._engine=d,this._noUBO=!d.supportsUniformBuffers,this._dynamic=C,this._data=M||[],this._uniformLocations={},this._uniformSizes={},this._uniformLocationPointer=0,this._needSync=!1,this._noUBO?(this.updateMatrix3x3=this._updateMatrix3x3ForEffect,this.updateMatrix2x2=this._updateMatrix2x2ForEffect,this.updateFloat=this._updateFloatForEffect,this.updateFloat2=this._updateFloat2ForEffect,this.updateFloat3=this._updateFloat3ForEffect,this.updateFloat4=this._updateFloat4ForEffect,this.updateMatrix=this._updateMatrixForEffect,this.updateVector3=this._updateVector3ForEffect,this.updateVector4=this._updateVector4ForEffect,this.updateColor3=this._updateColor3ForEffect,this.updateColor4=this._updateColor4ForEffect):(this._engine._uniformBuffers.push(this),this.updateMatrix3x3=this._updateMatrix3x3ForUniform,this.updateMatrix2x2=this._updateMatrix2x2ForUniform,this.updateFloat=this._updateFloatForUniform,this.updateFloat2=this._updateFloat2ForUniform,this.updateFloat3=this._updateFloat3ForUniform,this.updateFloat4=this._updateFloat4ForUniform,this.updateMatrix=this._updateMatrixForUniform,this.updateVector3=this._updateVector3ForUniform,this.updateVector4=this._updateVector4ForUniform,this.updateColor3=this._updateColor3ForUniform,this.updateColor4=this._updateColor4ForUniform)}return Object.defineProperty(S.prototype,"useUbo",{get:function(){return!this._noUBO},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"isSync",{get:function(){return!this._needSync},enumerable:!1,configurable:!0}),S.prototype.isDynamic=function(){return this._dynamic!==void 0},S.prototype.getData=function(){return this._bufferData},S.prototype.getBuffer=function(){return this._buffer},S.prototype._fillAlignment=function(d){var M;if(M=d<=2?d:4,this._uniformLocationPointer%M!=0){var C=this._uniformLocationPointer;this._uniformLocationPointer+=M-this._uniformLocationPointer%M;for(var I=this._uniformLocationPointer-C,b=0;b<I;b++)this._data.push(0)}},S.prototype.addUniform=function(d,M){if(!this._noUBO&&this._uniformLocations[d]===void 0){var C;if(M instanceof Array)M=(C=M).length;else{M=M,C=[];for(var I=0;I<M;I++)C.push(0)}for(this._fillAlignment(M),this._uniformSizes[d]=M,this._uniformLocations[d]=this._uniformLocationPointer,this._uniformLocationPointer+=M,I=0;I<M;I++)this._data.push(C[I]);this._needSync=!0}},S.prototype.addMatrix=function(d,M){this.addUniform(d,Array.prototype.slice.call(M.toArray()))},S.prototype.addFloat2=function(d,M,C){var I=[M,C];this.addUniform(d,I)},S.prototype.addFloat3=function(d,M,C,I){var b=[M,C,I];this.addUniform(d,b)},S.prototype.addColor3=function(d,M){var C=new Array;M.toArray(C),this.addUniform(d,C)},S.prototype.addColor4=function(d,M,C){var I=new Array;M.toArray(I),I.push(C),this.addUniform(d,I)},S.prototype.addVector3=function(d,M){var C=new Array;M.toArray(C),this.addUniform(d,C)},S.prototype.addMatrix3x3=function(d){this.addUniform(d,12)},S.prototype.addMatrix2x2=function(d){this.addUniform(d,8)},S.prototype.create=function(){this._noUBO||this._buffer||(this._fillAlignment(4),this._bufferData=new Float32Array(this._data),this._rebuild(),this._needSync=!0)},S.prototype._rebuild=function(){!this._noUBO&&this._bufferData&&(this._dynamic?this._buffer=this._engine.createDynamicUniformBuffer(this._bufferData):this._buffer=this._engine.createUniformBuffer(this._bufferData))},S.prototype.update=function(){this._buffer?(this._dynamic||this._needSync)&&(this._engine.updateUniformBuffer(this._buffer,this._bufferData),this._needSync=!1):this.create()},S.prototype.updateUniform=function(d,M,C){var I=this._uniformLocations[d];if(I===void 0){if(this._buffer)return void E.a.Error("Cannot add an uniform after UBO has been created.");this.addUniform(d,C),I=this._uniformLocations[d]}if(this._buffer||this.create(),this._dynamic)for(p=0;p<C;p++)this._bufferData[I+p]=M[p];else{for(var b=!1,p=0;p<C;p++)C!==16&&this._bufferData[I+p]===M[p]||(b=!0,this._bufferData[I+p]=M[p]);this._needSync=this._needSync||b}},S.prototype._cacheMatrix=function(d,M){var C=this._valueCache[d],I=M.updateFlag;return(C===void 0||C!==I)&&(this._valueCache[d]=I,!0)},S.prototype._updateMatrix3x3ForUniform=function(d,M){for(var C=0;C<3;C++)S._tempBuffer[4*C]=M[3*C],S._tempBuffer[4*C+1]=M[3*C+1],S._tempBuffer[4*C+2]=M[3*C+2],S._tempBuffer[4*C+3]=0;this.updateUniform(d,S._tempBuffer,12)},S.prototype._updateMatrix3x3ForEffect=function(d,M){this._currentEffect.setMatrix3x3(d,M)},S.prototype._updateMatrix2x2ForEffect=function(d,M){this._currentEffect.setMatrix2x2(d,M)},S.prototype._updateMatrix2x2ForUniform=function(d,M){for(var C=0;C<2;C++)S._tempBuffer[4*C]=M[2*C],S._tempBuffer[4*C+1]=M[2*C+1],S._tempBuffer[4*C+2]=0,S._tempBuffer[4*C+3]=0;this.updateUniform(d,S._tempBuffer,8)},S.prototype._updateFloatForEffect=function(d,M){this._currentEffect.setFloat(d,M)},S.prototype._updateFloatForUniform=function(d,M){S._tempBuffer[0]=M,this.updateUniform(d,S._tempBuffer,1)},S.prototype._updateFloat2ForEffect=function(d,M,C,I){I===void 0&&(I=""),this._currentEffect.setFloat2(d+I,M,C)},S.prototype._updateFloat2ForUniform=function(d,M,C){S._tempBuffer[0]=M,S._tempBuffer[1]=C,this.updateUniform(d,S._tempBuffer,2)},S.prototype._updateFloat3ForEffect=function(d,M,C,I,b){b===void 0&&(b=""),this._currentEffect.setFloat3(d+b,M,C,I)},S.prototype._updateFloat3ForUniform=function(d,M,C,I){S._tempBuffer[0]=M,S._tempBuffer[1]=C,S._tempBuffer[2]=I,this.updateUniform(d,S._tempBuffer,3)},S.prototype._updateFloat4ForEffect=function(d,M,C,I,b,p){p===void 0&&(p=""),this._currentEffect.setFloat4(d+p,M,C,I,b)},S.prototype._updateFloat4ForUniform=function(d,M,C,I,b){S._tempBuffer[0]=M,S._tempBuffer[1]=C,S._tempBuffer[2]=I,S._tempBuffer[3]=b,this.updateUniform(d,S._tempBuffer,4)},S.prototype._updateMatrixForEffect=function(d,M){this._currentEffect.setMatrix(d,M)},S.prototype._updateMatrixForUniform=function(d,M){this._cacheMatrix(d,M)&&this.updateUniform(d,M.toArray(),16)},S.prototype._updateVector3ForEffect=function(d,M){this._currentEffect.setVector3(d,M)},S.prototype._updateVector3ForUniform=function(d,M){M.toArray(S._tempBuffer),this.updateUniform(d,S._tempBuffer,3)},S.prototype._updateVector4ForEffect=function(d,M){this._currentEffect.setVector4(d,M)},S.prototype._updateVector4ForUniform=function(d,M){M.toArray(S._tempBuffer),this.updateUniform(d,S._tempBuffer,4)},S.prototype._updateColor3ForEffect=function(d,M,C){C===void 0&&(C=""),this._currentEffect.setColor3(d+C,M)},S.prototype._updateColor3ForUniform=function(d,M){M.toArray(S._tempBuffer),this.updateUniform(d,S._tempBuffer,3)},S.prototype._updateColor4ForEffect=function(d,M,C,I){I===void 0&&(I=""),this._currentEffect.setColor4(d+I,M,C)},S.prototype._updateColor4ForUniform=function(d,M,C){M.toArray(S._tempBuffer),S._tempBuffer[3]=C,this.updateUniform(d,S._tempBuffer,4)},S.prototype.setTexture=function(d,M){this._currentEffect.setTexture(d,M)},S.prototype.updateUniformDirectly=function(d,M){this.updateUniform(d,M,M.length),this.update()},S.prototype.bindToEffect=function(d,M){this._currentEffect=d,!this._noUBO&&this._buffer&&(this._alreadyBound=!0,d.bindUniformBuffer(this._buffer,M))},S.prototype.dispose=function(){if(!this._noUBO){var d=this._engine._uniformBuffers,M=d.indexOf(this);M!==-1&&(d[M]=d[d.length-1],d.pop()),this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)}},S._MAX_UNIFORM_SIZE=256,S._tempBuffer=new Float32Array(S._MAX_UNIFORM_SIZE),S}())},function(h,s,c){c.d(s,"a",function(){return I});var E=c(1),m=c(3),S=c(0),d=c(9),M=c(29),C=c(48);M.a.AddNodeConstructor("Light_Type_3",function(b,p){return function(){return new I(b,S.e.Zero(),p)}});var I=function(b){function p(x,P,A){var T=b.call(this,x,A)||this;return T.groundColor=new d.a(0,0,0),T.direction=P||S.e.Up(),T}return Object(E.d)(p,b),p.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},p.prototype.getClassName=function(){return"HemisphericLight"},p.prototype.setDirectionToTarget=function(x){return this.direction=S.e.Normalize(x.subtract(S.e.Zero())),this.direction},p.prototype.getShadowGenerator=function(){return null},p.prototype.transferToEffect=function(x,P){var A=S.e.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",A.x,A.y,A.z,0,P),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.intensity),P),this},p.prototype.transferToNodeMaterialEffect=function(x,P){var A=S.e.Normalize(this.direction);return x.setFloat3(P,A.x,A.y,A.z),this},p.prototype.computeWorldMatrix=function(){return this._worldMatrix||(this._worldMatrix=S.a.Identity()),this._worldMatrix},p.prototype.getTypeID=function(){return C.a.LIGHTTYPEID_HEMISPHERICLIGHT},p.prototype.prepareLightSpecificDefines=function(x,P){x["HEMILIGHT"+P]=!0},Object(E.c)([Object(m.e)()],p.prototype,"groundColor",void 0),Object(E.c)([Object(m.o)()],p.prototype,"direction",void 0),p}(C.a)},function(h,s,c){c.d(s,"a",function(){return S});var E=c(1),m=c(0),S=function(d){function M(C,I){var b=d.call(this,C,I)||this;return b._normalMatrix=new m.a,b._storeEffectOnSubMeshes=!0,b}return Object(E.d)(M,d),M.prototype.getEffect=function(){return this._activeEffect},M.prototype.isReady=function(C,I){return!!C&&(!C.subMeshes||C.subMeshes.length===0||this.isReadyForSubMesh(C,C.subMeshes[0],I))},M.prototype._isReadyForSubMesh=function(C){var I=C._materialDefines;return!(this.checkReadyOnEveryCall||!C.effect||!I||I._renderId!==this.getScene().getRenderId())},M.prototype.bindOnlyWorldMatrix=function(C){this._activeEffect.setMatrix("world",C)},M.prototype.bindOnlyNormalMatrix=function(C){this._activeEffect.setMatrix("normalMatrix",C)},M.prototype.bind=function(C,I){I&&this.bindForSubMesh(C,I,I.subMeshes[0])},M.prototype._afterBind=function(C,I){I===void 0&&(I=null),d.prototype._afterBind.call(this,C),this.getScene()._cachedEffect=I},M.prototype._mustRebind=function(C,I,b){return b===void 0&&(b=1),C.isCachedMaterialInvalid(this,I,b)},M}(c(25).a)},function(h,s,c){c.d(s,"a",function(){return m});var E=c(1),m=function(S){function d(M){var C=S.call(this)||this;return C._buffer=M,C}return Object(E.d)(d,S),Object.defineProperty(d.prototype,"underlyingResource",{get:function(){return this._buffer},enumerable:!1,configurable:!0}),d}(c(89).a)},function(h,s,c){c.d(s,"a",function(){return E});var E=function(){function m(){this.references=0,this.capacity=0,this.is32Bits=!1}return Object.defineProperty(m.prototype,"underlyingResource",{get:function(){return null},enumerable:!1,configurable:!0}),m}()},function(h,s,c){c.d(s,"a",function(){return m});var E=c(64),m=function(){function S(){}return S.GetPlanes=function(d){for(var M=[],C=0;C<6;C++)M.push(new E.a(0,0,0,0));return S.GetPlanesToRef(d,M),M},S.GetNearPlaneToRef=function(d,M){var C=d.m;M.normal.x=C[3]+C[2],M.normal.y=C[7]+C[6],M.normal.z=C[11]+C[10],M.d=C[15]+C[14],M.normalize()},S.GetFarPlaneToRef=function(d,M){var C=d.m;M.normal.x=C[3]-C[2],M.normal.y=C[7]-C[6],M.normal.z=C[11]-C[10],M.d=C[15]-C[14],M.normalize()},S.GetLeftPlaneToRef=function(d,M){var C=d.m;M.normal.x=C[3]+C[0],M.normal.y=C[7]+C[4],M.normal.z=C[11]+C[8],M.d=C[15]+C[12],M.normalize()},S.GetRightPlaneToRef=function(d,M){var C=d.m;M.normal.x=C[3]-C[0],M.normal.y=C[7]-C[4],M.normal.z=C[11]-C[8],M.d=C[15]-C[12],M.normalize()},S.GetTopPlaneToRef=function(d,M){var C=d.m;M.normal.x=C[3]-C[1],M.normal.y=C[7]-C[5],M.normal.z=C[11]-C[9],M.d=C[15]-C[13],M.normalize()},S.GetBottomPlaneToRef=function(d,M){var C=d.m;M.normal.x=C[3]+C[1],M.normal.y=C[7]+C[5],M.normal.z=C[11]+C[9],M.d=C[15]+C[13],M.normalize()},S.GetPlanesToRef=function(d,M){S.GetNearPlaneToRef(d,M[0]),S.GetFarPlaneToRef(d,M[1]),S.GetLeftPlaneToRef(d,M[2]),S.GetRightPlaneToRef(d,M[3]),S.GetTopPlaneToRef(d,M[4]),S.GetBottomPlaneToRef(d,M[5])},S}()},function(h,s,c){c.d(s,"a",function(){return m});var E=c(2),m=function(){function S(){this.hoverCursor="",this.actions=new Array,this.isRecursive=!1}return Object.defineProperty(S,"HasTriggers",{get:function(){for(var d in S.Triggers)if(S.Triggers.hasOwnProperty(d))return!0;return!1},enumerable:!1,configurable:!0}),Object.defineProperty(S,"HasPickTriggers",{get:function(){for(var d in S.Triggers)if(S.Triggers.hasOwnProperty(d)){var M=parseInt(d);if(M>=E.a.ACTION_OnPickTrigger&&M<=E.a.ACTION_OnPickUpTrigger)return!0}return!1},enumerable:!1,configurable:!0}),S.HasSpecificTrigger=function(d){for(var M in S.Triggers)if(S.Triggers.hasOwnProperty(M)&&parseInt(M)===d)return!0;return!1},S.Triggers={},S}()},function(h,s,c){c.d(s,"a",function(){return C});var E=c(1),m=c(25),S=c(3),d=c(19),M=c(15),C=function(){function I(b){this._texture=null,this.diffuseBlendLevel=1,this.roughnessBlendLevel=1,this.bumpLevel=1,this._normalBlendMethod=m.a.MATERIAL_NORMALBLENDMETHOD_WHITEOUT,this._isEnabled=!1,this.isEnabled=!1,this._internalMarkAllSubMeshesAsTexturesDirty=b}return I.prototype._markAllSubMeshesAsTexturesDirty=function(){this._internalMarkAllSubMeshesAsTexturesDirty()},I.prototype.isReadyForSubMesh=function(b,p){var x=p.getEngine();return!(b._areTexturesDirty&&p.texturesEnabled&&x.getCaps().standardDerivatives&&this._texture&&d.a.DetailTextureEnabled&&!this._texture.isReady())},I.prototype.prepareDefines=function(b,p){if(this._isEnabled){b.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod;var x=p.getEngine();b._areTexturesDirty&&(x.getCaps().standardDerivatives&&this._texture&&d.a.DetailTextureEnabled&&this._isEnabled?(M.a.PrepareDefinesForMergedUV(this._texture,b,"DETAIL"),b.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod):b.DETAIL=!1)}else b.DETAIL=!1},I.prototype.bindForSubMesh=function(b,p,x){this._isEnabled&&(b.useUbo&&x&&b.isSync||this._texture&&d.a.DetailTextureEnabled&&(b.updateFloat4("vDetailInfos",this._texture.coordinatesIndex,this.diffuseBlendLevel,this.bumpLevel,this.roughnessBlendLevel),M.a.BindTextureMatrix(this._texture,b,"detail")),p.texturesEnabled&&this._texture&&d.a.DetailTextureEnabled&&b.setTexture("detailSampler",this._texture))},I.prototype.hasTexture=function(b){return this._texture===b},I.prototype.getActiveTextures=function(b){this._texture&&b.push(this._texture)},I.prototype.getAnimatables=function(b){this._texture&&this._texture.animations&&this._texture.animations.length>0&&b.push(this._texture)},I.prototype.dispose=function(b){var p;b&&((p=this._texture)===null||p===void 0||p.dispose())},I.prototype.getClassName=function(){return"DetailMap"},I.AddUniforms=function(b){b.push("vDetailInfos")},I.AddSamplers=function(b){b.push("detailSampler")},I.PrepareUniformBuffer=function(b){b.addUniform("vDetailInfos",4),b.addUniform("detailMatrix",16)},I.prototype.copyTo=function(b){S.a.Clone(function(){return b},this)},I.prototype.serialize=function(){return S.a.Serialize(this)},I.prototype.parse=function(b,p,x){var P=this;S.a.Parse(function(){return P},b,p,x)},Object(E.c)([Object(S.m)("detailTexture"),Object(S.b)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"texture",void 0),Object(E.c)([Object(S.c)()],I.prototype,"diffuseBlendLevel",void 0),Object(E.c)([Object(S.c)()],I.prototype,"roughnessBlendLevel",void 0),Object(E.c)([Object(S.c)()],I.prototype,"bumpLevel",void 0),Object(E.c)([Object(S.c)(),Object(S.b)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"normalBlendMethod",void 0),Object(E.c)([Object(S.c)(),Object(S.b)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"isEnabled",void 0),I}()},function(h,s,c){var E="morphTargetsVertexGlobalDeclaration",m=`#ifdef MORPHTARGETS
uniform float morphTargetInfluences[NUM_MORPH_INFLUENCERS];
#endif`;c(5).a.IncludesShadersStore[E]=m},function(h,s,c){var E="morphTargetsVertexDeclaration",m=`#ifdef MORPHTARGETS
attribute vec3 position{X};
#ifdef MORPHTARGETS_NORMAL
attribute vec3 normal{X};
#endif
#ifdef MORPHTARGETS_TANGENT
attribute vec3 tangent{X};
#endif
#ifdef MORPHTARGETS_UV
attribute vec2 uv_{X};
#endif
#endif`;c(5).a.IncludesShadersStore[E]=m},function(h,s,c){c.d(s,"a",function(){return d});var E=c(25),m=c(4),S=c(2),d=function(){function M(C){this._vertexBuffers={},this._scene=C}return M.prototype._prepareBuffers=function(){if(!this._vertexBuffers[m.b.PositionKind]){var C=[];C.push(1,1),C.push(-1,1),C.push(-1,-1),C.push(1,-1),this._vertexBuffers[m.b.PositionKind]=new m.b(this._scene.getEngine(),C,m.b.PositionKind,!1,!1,2),this._buildIndexBuffer()}},M.prototype._buildIndexBuffer=function(){var C=[];C.push(0),C.push(1),C.push(2),C.push(0),C.push(2),C.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(C)},M.prototype._rebuild=function(){var C=this._vertexBuffers[m.b.PositionKind];C&&(C._rebuild(),this._buildIndexBuffer())},M.prototype._prepareFrame=function(C,I){C===void 0&&(C=null),I===void 0&&(I=null);var b=this._scene.activeCamera;return!!b&&!(!(I=I||b._postProcesses.filter(function(p){return p!=null}))||I.length===0||!this._scene.postProcessesEnabled)&&(I[0].activate(b,C,I!=null),!0)},M.prototype.directRender=function(C,I,b,p,x,P){I===void 0&&(I=null),b===void 0&&(b=!1),p===void 0&&(p=0),x===void 0&&(x=0),P===void 0&&(P=!1);for(var A=this._scene.getEngine(),T=0;T<C.length;T++){T<C.length-1?C[T+1].activate(this._scene.activeCamera,I):I?A.bindFramebuffer(I,p,void 0,void 0,b,x):P||A.restoreDefaultFramebuffer();var _=C[T],g=_.apply();g&&(_.onBeforeRenderObservable.notifyObservers(g),this._prepareBuffers(),A.bindBuffers(this._vertexBuffers,this._indexBuffer,g),A.drawElementsType(E.a.TriangleFillMode,0,6),_.onAfterRenderObservable.notifyObservers(g))}A.setDepthBuffer(!0),A.setDepthWrite(!0)},M.prototype._finalizeFrame=function(C,I,b,p,x){x===void 0&&(x=!1);var P=this._scene.activeCamera;if(P&&(p=p||P._postProcesses.filter(function(R){return R!=null})).length!==0&&this._scene.postProcessesEnabled){for(var A=this._scene.getEngine(),T=0,_=p.length;T<_;T++){var g=p[T];if(T<_-1?g._outputTexture=p[T+1].activate(P,I):I?(A.bindFramebuffer(I,b,void 0,void 0,x),g._outputTexture=I):(A.restoreDefaultFramebuffer(),g._outputTexture=null),C)break;var O=g.apply();O&&(g.onBeforeRenderObservable.notifyObservers(O),this._prepareBuffers(),A.bindBuffers(this._vertexBuffers,this._indexBuffer,O),A.drawElementsType(E.a.TriangleFillMode,0,6),g.onAfterRenderObservable.notifyObservers(O))}A.setDepthBuffer(!0),A.setDepthWrite(!0),A.setAlphaMode(S.a.ALPHA_DISABLE)}},M.prototype.dispose=function(){var C=this._vertexBuffers[m.b.PositionKind];C&&(C.dispose(),this._vertexBuffers[m.b.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)},M}()},function(h,s,c){c.d(s,"a",function(){return m}),c.d(s,"b",function(){return S});var E=c(148),m=function(){},S=function(){function d(M){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new m,this._scene=M;for(var C=d.MIN_RENDERINGGROUPS;C<d.MAX_RENDERINGGROUPS;C++)this._autoClearDepthStencil[C]={autoClear:!0,depth:!0,stencil:!0}}return d.prototype._clearDepthStencilBuffer=function(M,C){M===void 0&&(M=!0),C===void 0&&(C=!0),this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,M,C),this._depthStencilBufferAlreadyCleaned=!0)},d.prototype.render=function(M,C,I,b){var p=this._renderingGroupInfo;if(p.scene=this._scene,p.camera=this._scene.activeCamera,this._scene.spriteManagers&&b)for(var x=0;x<this._scene.spriteManagers.length;x++){var P=this._scene.spriteManagers[x];this.dispatchSprites(P)}for(x=d.MIN_RENDERINGGROUPS;x<d.MAX_RENDERINGGROUPS;x++){this._depthStencilBufferAlreadyCleaned=x===d.MIN_RENDERINGGROUPS;var A=this._renderingGroups[x];if(A){var T=Math.pow(2,x);if(p.renderingGroupId=x,this._scene.onBeforeRenderingGroupObservable.notifyObservers(p,T),d.AUTOCLEAR){var _=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(x):this._autoClearDepthStencil[x];_&&_.autoClear&&this._clearDepthStencilBuffer(_.depth,_.stencil)}for(var g=0,O=this._scene._beforeRenderingGroupDrawStage;g<O.length;g++)O[g].action(x);A.render(M,b,I,C);for(var R=0,N=this._scene._afterRenderingGroupDrawStage;R<N.length;R++)N[R].action(x);this._scene.onAfterRenderingGroupObservable.notifyObservers(p,T)}}},d.prototype.reset=function(){for(var M=d.MIN_RENDERINGGROUPS;M<d.MAX_RENDERINGGROUPS;M++){var C=this._renderingGroups[M];C&&C.prepare()}},d.prototype.dispose=function(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null},d.prototype.freeRenderingGroups=function(){for(var M=d.MIN_RENDERINGGROUPS;M<d.MAX_RENDERINGGROUPS;M++){var C=this._renderingGroups[M];C&&C.dispose()}},d.prototype._prepareRenderingGroup=function(M){this._renderingGroups[M]===void 0&&(this._renderingGroups[M]=new E.a(M,this._scene,this._customOpaqueSortCompareFn[M],this._customAlphaTestSortCompareFn[M],this._customTransparentSortCompareFn[M]))},d.prototype.dispatchSprites=function(M){var C=M.renderingGroupId||0;this._prepareRenderingGroup(C),this._renderingGroups[C].dispatchSprites(M)},d.prototype.dispatchParticles=function(M){var C=M.renderingGroupId||0;this._prepareRenderingGroup(C),this._renderingGroups[C].dispatchParticles(M)},d.prototype.dispatch=function(M,C,I){C===void 0&&(C=M.getMesh());var b=C.renderingGroupId||0;this._prepareRenderingGroup(b),this._renderingGroups[b].dispatch(M,C,I)},d.prototype.setRenderingOrder=function(M,C,I,b){if(C===void 0&&(C=null),I===void 0&&(I=null),b===void 0&&(b=null),this._customOpaqueSortCompareFn[M]=C,this._customAlphaTestSortCompareFn[M]=I,this._customTransparentSortCompareFn[M]=b,this._renderingGroups[M]){var p=this._renderingGroups[M];p.opaqueSortCompareFn=this._customOpaqueSortCompareFn[M],p.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[M],p.transparentSortCompareFn=this._customTransparentSortCompareFn[M]}},d.prototype.setRenderingAutoClearDepthStencil=function(M,C,I,b){I===void 0&&(I=!0),b===void 0&&(b=!0),this._autoClearDepthStencil[M]={autoClear:C,depth:I,stencil:b}},d.prototype.getAutoClearDepthStencilSetup=function(M){return this._autoClearDepthStencil[M]},d.MAX_RENDERINGGROUPS=4,d.MIN_RENDERINGGROUPS=0,d.AUTOCLEAR=!0,d}()},function(h,s,c){c.d(s,"a",function(){return M});var E=c(0),m=c(7),S=c(82),d=c(72);m.a.ExtrudeShape=function(C,I,b,p,x,P,A,T,_,g){A===void 0&&(A=null);var O={shape:I,path:b,scale:p,rotation:x,cap:P===0?0:P||m.a.NO_CAP,sideOrientation:_,instance:g,updatable:T};return M.ExtrudeShape(C,O,A)},m.a.ExtrudeShapeCustom=function(C,I,b,p,x,P,A,T,_,g,O,R){var N={shape:I,path:b,scaleFunction:p,rotationFunction:x,ribbonCloseArray:P,ribbonClosePath:A,cap:T===0?0:T||m.a.NO_CAP,sideOrientation:O,instance:R,updatable:g};return M.ExtrudeShapeCustom(C,N,_)};var M=function(){function C(){}return C.ExtrudeShape=function(I,b,p){p===void 0&&(p=null);var x=b.path,P=b.shape,A=b.scale||1,T=b.rotation||0,_=b.cap===0?0:b.cap||m.a.NO_CAP,g=b.updatable,O=m.a._GetDefaultSideOrientation(b.sideOrientation),R=b.instance||null,N=b.invertUV||!1;return C._ExtrudeShapeGeneric(I,P,x,A,T,null,null,!1,!1,_,!1,p,!!g,O,R,N,b.frontUVs||null,b.backUVs||null)},C.ExtrudeShapeCustom=function(I,b,p){p===void 0&&(p=null);var x=b.path,P=b.shape,A=b.scaleFunction||function(){return 1},T=b.rotationFunction||function(){return 0},_=b.ribbonCloseArray||!1,g=b.ribbonClosePath||!1,O=b.cap===0?0:b.cap||m.a.NO_CAP,R=b.updatable,N=m.a._GetDefaultSideOrientation(b.sideOrientation),V=b.instance,U=b.invertUV||!1;return C._ExtrudeShapeGeneric(I,P,x,null,null,A,T,_,g,O,!0,p,!!R,N,V||null,U,b.frontUVs||null,b.backUVs||null)},C._ExtrudeShapeGeneric=function(I,b,p,x,P,A,T,_,g,O,R,N,V,U,L,j,Y,W){var re,ne,ge=function(ie,Z,te,B,G,$,le,se,q,H){for(var X=te.getTangents(),J=te.getNormals(),Q=te.getBinormals(),ee=te.getDistances(),pe=0,Te=H&&se?se:function(){return $!==null?$:0},ve=H&&le?le:function(){return G!==null?G:1},he=q===m.a.NO_CAP||q===m.a.CAP_END?0:2,be=E.c.Matrix[0],xe=0;xe<Z.length;xe++){for(var Se=new Array,Ue=Te(xe,ee[xe]),We=ve(xe,ee[xe]),Ze=0;Ze<ie.length;Ze++){E.a.RotationAxisToRef(X[xe],pe,be);var Qe=X[xe].scale(ie[Ze].z).add(J[xe].scale(ie[Ze].x)).add(Q[xe].scale(ie[Ze].y)),Xe=Se[Ze]?Se[Ze]:E.e.Zero();E.e.TransformCoordinatesToRef(Qe,be,Xe),Xe.scaleInPlace(We).addInPlace(Z[xe]),Se[Ze]=Xe}B[he]=Se,pe+=Ue,he++}var nt=function(Ke){var ct,ot=Array(),_t=E.e.Zero();for(ct=0;ct<Ke.length;ct++)_t.addInPlace(Ke[ct]);for(_t.scaleInPlace(1/Ke.length),ct=0;ct<Ke.length;ct++)ot.push(_t);return ot};switch(q){case m.a.NO_CAP:break;case m.a.CAP_START:B[0]=nt(B[2]),B[1]=B[2];break;case m.a.CAP_END:B[he]=B[he-1],B[he+1]=nt(B[he-1]);break;case m.a.CAP_ALL:B[0]=nt(B[2]),B[1]=B[2],B[he]=B[he-1],B[he+1]=nt(B[he-1])}return B};if(L){var _e=L._creationDataStorage;return re=_e.path3D.update(p),ne=ge(b,p,_e.path3D,_e.pathArray,x,P,A,T,_e.cap,R),L=m.a.CreateRibbon("",ne,!1,!1,0,N||void 0,!1,0,L)}ne=ge(b,p,re=new d.g(p),new Array,x,P,A,T,O=O<0||O>3?0:O,R);var ce=S.a.CreateRibbon(I,{pathArray:ne,closeArray:_,closePath:g,updatable:V,sideOrientation:U,invertUV:j,frontUVs:Y||void 0,backUVs:W||void 0},N);return ce._creationDataStorage.pathArray=ne,ce._creationDataStorage.path3D=re,ce._creationDataStorage.cap=O,ce},C}()},function(h,s,c){c.d(s,"b",function(){return p}),c.d(s,"a",function(){return x});var E=c(1),m=c(9),S=c(4),d=c(7),M=c(151),C=c(25),I=c(73),b=c(15),p=(c(166),c(167),function(P){function A(T,_,g,O,R,N,V){_===void 0&&(_=null),g===void 0&&(g=null),O===void 0&&(O=null);var U=P.call(this,T,_,g,O,R)||this;U.useVertexColor=N,U.useVertexAlpha=V,U.color=new m.a(1,1,1),U.alpha=1,O&&(U.color=O.color.clone(),U.alpha=O.alpha,U.useVertexColor=O.useVertexColor,U.useVertexAlpha=O.useVertexAlpha),U.intersectionThreshold=.1;var L={attributes:[S.b.PositionKind,"world0","world1","world2","world3"],uniforms:["vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","world","viewProjection"],needAlphaBlending:!0,defines:[]};return V===!1&&(L.needAlphaBlending=!1),N?(L.defines.push("#define VERTEXCOLOR"),L.attributes.push(S.b.ColorKind)):(L.uniforms.push("color"),U.color4=new m.b),U._colorShader=new I.a("colorShader",U.getScene(),"color",L),U}return Object(E.d)(A,P),A.prototype._addClipPlaneDefine=function(T){var _="#define "+T;this._colorShader.options.defines.indexOf(_)===-1&&this._colorShader.options.defines.push(_)},A.prototype._removeClipPlaneDefine=function(T){var _="#define "+T,g=this._colorShader.options.defines.indexOf(_);g!==-1&&this._colorShader.options.defines.splice(g,1)},A.prototype.isReady=function(){var T=this.getScene();return T.clipPlane?this._addClipPlaneDefine("CLIPPLANE"):this._removeClipPlaneDefine("CLIPPLANE"),T.clipPlane2?this._addClipPlaneDefine("CLIPPLANE2"):this._removeClipPlaneDefine("CLIPPLANE2"),T.clipPlane3?this._addClipPlaneDefine("CLIPPLANE3"):this._removeClipPlaneDefine("CLIPPLANE3"),T.clipPlane4?this._addClipPlaneDefine("CLIPPLANE4"):this._removeClipPlaneDefine("CLIPPLANE4"),T.clipPlane5?this._addClipPlaneDefine("CLIPPLANE5"):this._removeClipPlaneDefine("CLIPPLANE5"),T.clipPlane6?this._addClipPlaneDefine("CLIPPLANE6"):this._removeClipPlaneDefine("CLIPPLANE6"),!!this._colorShader.isReady(this)&&P.prototype.isReady.call(this)},A.prototype.getClassName=function(){return"LinesMesh"},Object.defineProperty(A.prototype,"material",{get:function(){return this._colorShader},set:function(T){},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"checkCollisions",{get:function(){return!1},enumerable:!1,configurable:!0}),A.prototype._bind=function(T,_,g){if(!this._geometry)return this;var O=this._colorShader.getEffect(),R=this.isUnIndexed?null:this._geometry.getIndexBuffer();if(this._geometry._bind(O,R),!this.useVertexColor){var N=this.color,V=N.r,U=N.g,L=N.b;this.color4.set(V,U,L,this.alpha),this._colorShader.setColor4("color",this.color4)}return b.a.BindClipPlane(O,this.getScene()),this},A.prototype._draw=function(T,_,g){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;var O=this.getScene().getEngine();return this._unIndexed?O.drawArraysType(C.a.LineListDrawMode,T.verticesStart,T.verticesCount,g):O.drawElementsType(C.a.LineListDrawMode,T.indexStart,T.indexCount,g),this},A.prototype.dispose=function(T){this._colorShader.dispose(!1,!1,!0),P.prototype.dispose.call(this,T)},A.prototype.clone=function(T,_,g){return _===void 0&&(_=null),new A(T,this.getScene(),_,this,g)},A.prototype.createInstance=function(T){return new x(T,this)},A}(d.a)),x=function(P){function A(T,_){var g=P.call(this,T,_)||this;return g.intersectionThreshold=_.intersectionThreshold,g}return Object(E.d)(A,P),A.prototype.getClassName=function(){return"InstancedLinesMesh"},A}(M.a)},function(h,s,c){c.r(s),c.d(s,"AxesViewer",function(){return C}),c.d(s,"BoneAxesViewer",function(){return p}),c.d(s,"DebugLayerTab",function(){return E}),c.d(s,"DebugLayer",function(){return _}),c.d(s,"PhysicsViewer",function(){return j}),c.d(s,"RayHelper",function(){return W}),c.d(s,"SkeletonViewer",function(){return Z});var E,m=c(0),S=c(30),d=c(75),M=c(9),C=function(){function te(B,G,$,le,se,q){if(G===void 0&&(G=1),$===void 0&&($=2),this._scaleLinesFactor=4,this._instanced=!1,this.scene=null,this.scaleLines=1,this.scaleLines=G,!le){var H=new S.a("",B);H.disableLighting=!0,H.emissiveColor=M.a.Red().scale(.5),le=d.a._CreateArrow(B,H)}if(!se){var X=new S.a("",B);X.disableLighting=!0,X.emissiveColor=M.a.Green().scale(.5),se=d.a._CreateArrow(B,X)}if(!q){var J=new S.a("",B);J.disableLighting=!0,J.emissiveColor=M.a.Blue().scale(.5),q=d.a._CreateArrow(B,J)}this._xAxis=le,this._xAxis.scaling.setAll(this.scaleLines*this._scaleLinesFactor),this._yAxis=se,this._yAxis.scaling.setAll(this.scaleLines*this._scaleLinesFactor),this._zAxis=q,this._zAxis.scaling.setAll(this.scaleLines*this._scaleLinesFactor),$!=null&&(te._SetRenderingGroupId(this._xAxis,$),te._SetRenderingGroupId(this._yAxis,$),te._SetRenderingGroupId(this._zAxis,$)),this.scene=B,this.update(new m.e,m.e.Right(),m.e.Up(),m.e.Forward())}return Object.defineProperty(te.prototype,"xAxis",{get:function(){return this._xAxis},enumerable:!1,configurable:!0}),Object.defineProperty(te.prototype,"yAxis",{get:function(){return this._yAxis},enumerable:!1,configurable:!0}),Object.defineProperty(te.prototype,"zAxis",{get:function(){return this._zAxis},enumerable:!1,configurable:!0}),te.prototype.update=function(B,G,$,le){this._xAxis.position.copyFrom(B),this._xAxis.setDirection(G),this._xAxis.scaling.setAll(this.scaleLines*this._scaleLinesFactor),this._yAxis.position.copyFrom(B),this._yAxis.setDirection($),this._yAxis.scaling.setAll(this.scaleLines*this._scaleLinesFactor),this._zAxis.position.copyFrom(B),this._zAxis.setDirection(le),this._zAxis.scaling.setAll(this.scaleLines*this._scaleLinesFactor)},te.prototype.createInstance=function(){var B=d.a._CreateArrowInstance(this.scene,this._xAxis),G=d.a._CreateArrowInstance(this.scene,this._yAxis),$=d.a._CreateArrowInstance(this.scene,this._zAxis),le=new te(this.scene,this.scaleLines,null,B,G,$);return le._instanced=!0,le},te.prototype.dispose=function(){this._xAxis&&this._xAxis.dispose(!1,!this._instanced),this._yAxis&&this._yAxis.dispose(!1,!this._instanced),this._zAxis&&this._zAxis.dispose(!1,!this._instanced),this.scene=null},te._SetRenderingGroupId=function(B,G){B.getChildMeshes().forEach(function($){$.renderingGroupId=G})},te}(),I=c(1),b=c(23),p=function(te){function B(G,$,le,se){se===void 0&&(se=1);var q=te.call(this,G,se)||this;return q.pos=m.e.Zero(),q.xaxis=m.e.Zero(),q.yaxis=m.e.Zero(),q.zaxis=m.e.Zero(),q.mesh=le,q.bone=$,q}return Object(I.d)(B,te),B.prototype.update=function(){if(this.mesh&&this.bone){var G=this.bone;G._markAsDirtyAndCompose(),G.getAbsolutePositionToRef(this.mesh,this.pos),G.getDirectionToRef(b.a.X,this.mesh,this.xaxis),G.getDirectionToRef(b.a.Y,this.mesh,this.yaxis),G.getDirectionToRef(b.a.Z,this.mesh,this.zaxis),te.prototype.update.call(this,this.pos,this.xaxis,this.yaxis,this.zaxis)}},B.prototype.dispose=function(){this.mesh&&(this.mesh=null,this.bone=null,te.prototype.dispose.call(this))},B}(C),x=c(12),P=c(6),A=c(20),T=c(13);Object.defineProperty(A.a.prototype,"debugLayer",{get:function(){return this._debugLayer||(this._debugLayer=new _(this)),this._debugLayer},enumerable:!0,configurable:!0}),function(te){te[te.Properties=0]="Properties",te[te.Debug=1]="Debug",te[te.Statistics=2]="Statistics",te[te.Tools=3]="Tools",te[te.Settings=4]="Settings"}(E||(E={}));var _=function(){function te(B){var G=this;this.BJSINSPECTOR=this._getGlobalInspector(),this._scene=B,this._scene.onDisposeObservable.add(function(){G._scene._debugLayer&&G._scene._debugLayer.hide()})}return Object.defineProperty(te.prototype,"onPropertyChangedObservable",{get:function(){return this.BJSINSPECTOR&&this.BJSINSPECTOR.Inspector?this.BJSINSPECTOR.Inspector.OnPropertyChangedObservable:(this._onPropertyChangedObservable||(this._onPropertyChangedObservable=new P.c),this._onPropertyChangedObservable)},enumerable:!1,configurable:!0}),te.prototype._createInspector=function(B){if(!this.isVisible()){if(this._onPropertyChangedObservable){for(var G=0,$=this._onPropertyChangedObservable.observers;G<$.length;G++){var le=$[G];this.BJSINSPECTOR.Inspector.OnPropertyChangedObservable.add(le)}this._onPropertyChangedObservable.clear(),this._onPropertyChangedObservable=void 0}var se=Object(I.a)({overlay:!1,showExplorer:!0,showInspector:!0,embedMode:!1,handleResize:!0,enablePopup:!0},B);this.BJSINSPECTOR=this.BJSINSPECTOR||this._getGlobalInspector(),this.BJSINSPECTOR.Inspector.Show(this._scene,se)}},te.prototype.select=function(B,G){this.BJSINSPECTOR&&(G&&(Object.prototype.toString.call(G)=="[object String]"?this.BJSINSPECTOR.Inspector.MarkLineContainerTitleForHighlighting(G):this.BJSINSPECTOR.Inspector.MarkMultipleLineContainerTitlesForHighlighting(G)),this.BJSINSPECTOR.Inspector.OnSelectionChangeObservable.notifyObservers(B))},te.prototype._getGlobalInspector=function(){return typeof INSPECTOR!="undefined"?INSPECTOR:typeof BABYLON!="undefined"&&BABYLON.Inspector!==void 0?BABYLON:void 0},te.prototype.isVisible=function(){return this.BJSINSPECTOR&&this.BJSINSPECTOR.Inspector.IsVisible},te.prototype.hide=function(){this.BJSINSPECTOR&&this.BJSINSPECTOR.Inspector.Hide()},te.prototype.setAsActiveScene=function(){this.BJSINSPECTOR&&this.BJSINSPECTOR.Inspector._SetNewScene(this._scene)},te.prototype.show=function(B){var G=this;return new Promise(function($,le){if(G.BJSINSPECTOR===void 0){var se=B&&B.inspectorURL?B.inspectorURL:te.InspectorURL;x.b.LoadScript(se,function(){G._createInspector(B),$(G)})}else G._createInspector(B),$(G)})},te.InspectorURL="https://unpkg.com/babylonjs-inspector@"+T.a.Version+"/babylon.inspector.bundle.js",te}(),g=c(7),O=c(63),R=c(45),N=c(22),V=c(32),U=c(36),L=c(53),j=function(){function te(B){this._impostors=[],this._meshes=[],this._numMeshes=0,this._debugMeshMeshes=new Array,this._scene=B||N.a.LastCreatedScene;var G=this._scene.getPhysicsEngine();G&&(this._physicsEnginePlugin=G.getPhysicsPlugin()),this._utilityLayer=new U.a(this._scene,!1),this._utilityLayer.pickUtilitySceneFirst=!1,this._utilityLayer.utilityLayerScene.autoClearDepthAndStencil=!0}return te.prototype._updateDebugMeshes=function(){for(var B=this._physicsEnginePlugin,G=0;G<this._numMeshes;G++){var $=this._impostors[G];if($)if($.isDisposed)this.hideImpostor(this._impostors[G--]);else{if($.type===V.a.MeshImpostor)continue;var le=this._meshes[G];le&&B&&B.syncMeshWithImpostor(le,$)}}},te.prototype.showImpostor=function(B,G){if(!this._scene)return null;for(var $=0;$<this._numMeshes;$++)if(this._impostors[$]==B)return null;var le=this._getDebugMesh(B,G);return le&&(this._impostors[this._numMeshes]=B,this._meshes[this._numMeshes]=le,this._numMeshes===0&&(this._renderFunction=this._updateDebugMeshes.bind(this),this._scene.registerBeforeRender(this._renderFunction)),this._numMeshes++),le},te.prototype.hideImpostor=function(B){if(B&&this._scene&&this._utilityLayer){for(var G=!1,$=this._utilityLayer.utilityLayerScene,le=0;le<this._numMeshes;le++)if(this._impostors[le]==B){var se=this._meshes[le];if(!se)continue;$.removeMesh(se),se.dispose();var q=this._debugMeshMeshes.indexOf(se);q>-1&&this._debugMeshMeshes.splice(q,1),this._numMeshes--,this._numMeshes>0?(this._meshes[le]=this._meshes[this._numMeshes],this._impostors[le]=this._impostors[this._numMeshes],this._meshes[this._numMeshes]=null,this._impostors[this._numMeshes]=null):(this._meshes[0]=null,this._impostors[0]=null),G=!0;break}G&&this._numMeshes===0&&this._scene.unregisterBeforeRender(this._renderFunction)}},te.prototype._getDebugMaterial=function(B){return this._debugMaterial||(this._debugMaterial=new S.a("",B),this._debugMaterial.wireframe=!0,this._debugMaterial.emissiveColor=M.a.White(),this._debugMaterial.disableLighting=!0),this._debugMaterial},te.prototype._getDebugBoxMesh=function(B){return this._debugBoxMesh||(this._debugBoxMesh=O.a.CreateBox("physicsBodyBoxViewMesh",{size:1},B),this._debugBoxMesh.rotationQuaternion=m.b.Identity(),this._debugBoxMesh.material=this._getDebugMaterial(B),this._debugBoxMesh.setEnabled(!1)),this._debugBoxMesh.createInstance("physicsBodyBoxViewInstance")},te.prototype._getDebugSphereMesh=function(B){return this._debugSphereMesh||(this._debugSphereMesh=R.a.CreateSphere("physicsBodySphereViewMesh",{diameter:1},B),this._debugSphereMesh.rotationQuaternion=m.b.Identity(),this._debugSphereMesh.material=this._getDebugMaterial(B),this._debugSphereMesh.setEnabled(!1)),this._debugSphereMesh.createInstance("physicsBodyBoxViewInstance")},te.prototype._getDebugCylinderMesh=function(B){return this._debugCylinderMesh||(this._debugCylinderMesh=L.a.CreateCylinder("physicsBodyCylinderViewMesh",{diameterTop:1,diameterBottom:1,height:1},B),this._debugCylinderMesh.rotationQuaternion=m.b.Identity(),this._debugCylinderMesh.material=this._getDebugMaterial(B),this._debugCylinderMesh.setEnabled(!1)),this._debugCylinderMesh.createInstance("physicsBodyBoxViewInstance")},te.prototype._getDebugMeshMesh=function(B,G){var $=new g.a(B.name,G,null,B);return $.position=m.e.Zero(),$.setParent(B),$.material=this._getDebugMaterial(G),this._debugMeshMeshes.push($),$},te.prototype._getDebugMesh=function(B,G){var $=this;if(!this._utilityLayer||G&&G.parent&&G.parent.physicsImpostor)return null;var le=null,se=this._utilityLayer.utilityLayerScene;switch(B.type){case V.a.BoxImpostor:le=this._getDebugBoxMesh(se),B.getBoxSizeToRef(le.scaling);break;case V.a.SphereImpostor:le=this._getDebugSphereMesh(se);var q=B.getRadius();le.scaling.x=2*q,le.scaling.y=2*q,le.scaling.z=2*q;break;case V.a.MeshImpostor:G&&(le=this._getDebugMeshMesh(G,se));break;case V.a.NoImpostor:G&&G.getChildMeshes().filter(function(X){return X.physicsImpostor?1:0}).forEach(function(X){$._getDebugBoxMesh(se).parent=X});break;case V.a.CylinderImpostor:le=this._getDebugCylinderMesh(se);var H=B.object.getBoundingInfo();le.scaling.x=H.boundingBox.maximum.x-H.boundingBox.minimum.x,le.scaling.y=H.boundingBox.maximum.y-H.boundingBox.minimum.y,le.scaling.z=H.boundingBox.maximum.z-H.boundingBox.minimum.z}return le},te.prototype.dispose=function(){for(var B=this._numMeshes,G=0;G<B;G++)this.hideImpostor(this._impostors[0]);this._debugBoxMesh&&this._debugBoxMesh.dispose(),this._debugSphereMesh&&this._debugSphereMesh.dispose(),this._debugCylinderMesh&&this._debugCylinderMesh.dispose(),this._debugMaterial&&this._debugMaterial.dispose(),this._impostors.length=0,this._scene=null,this._physicsEnginePlugin=null,this._utilityLayer&&(this._utilityLayer.dispose(),this._utilityLayer=null)},te}(),Y=c(40),W=function(){function te(B){this.ray=B}return te.CreateAndShow=function(B,G,$){var le=new te(B);return le.show(G,$),le},te.prototype.show=function(B,G){if(!this._renderFunction&&this.ray){var $=this.ray;this._renderFunction=this._render.bind(this),this._scene=B,this._renderPoints=[$.origin,$.origin.add($.direction.scale($.length))],this._renderLine=g.a.CreateLines("ray",this._renderPoints,B,!0),this._renderLine.isPickable=!1,this._renderFunction&&this._scene.registerBeforeRender(this._renderFunction)}G&&this._renderLine&&this._renderLine.color.copyFrom(G)},te.prototype.hide=function(){this._renderFunction&&this._scene&&(this._scene.unregisterBeforeRender(this._renderFunction),this._scene=null,this._renderFunction=null,this._renderLine&&(this._renderLine.dispose(),this._renderLine=null),this._renderPoints=[])},te.prototype._render=function(){var B=this.ray;if(B){var G=this._renderPoints[1],$=Math.min(B.length,1e6);G.copyFrom(B.direction),G.scaleInPlace($),G.addInPlace(B.origin),this._renderPoints[0].copyFrom(B.origin),g.a.CreateLines("ray",this._renderPoints,this._scene,!0,this._renderLine)}},te.prototype.attachToMesh=function(B,G,$,le){var se=this;this._attachedToMesh=B;var q=this.ray;q&&(q.direction||(q.direction=m.e.Zero()),q.origin||(q.origin=m.e.Zero()),le&&(q.length=le),$||($=m.e.Zero()),G||(G=new m.e(0,0,-1)),this._scene||(this._scene=B.getScene()),this._meshSpaceDirection?(this._meshSpaceDirection.copyFrom(G),this._meshSpaceOrigin.copyFrom($)):(this._meshSpaceDirection=G.clone(),this._meshSpaceOrigin=$.clone()),this._onAfterRenderObserver||(this._onAfterRenderObserver=this._scene.onBeforeRenderObservable.add(function(){return se._updateToMesh()}),this._onAfterStepObserver=this._scene.onAfterStepObservable.add(function(){return se._updateToMesh()})),this._attachedToMesh.computeWorldMatrix(!0),this._updateToMesh())},te.prototype.detachFromMesh=function(){this._attachedToMesh&&this._scene&&(this._onAfterRenderObserver&&(this._scene.onBeforeRenderObservable.remove(this._onAfterRenderObserver),this._scene.onAfterStepObservable.remove(this._onAfterStepObserver)),this._attachedToMesh=null,this._onAfterRenderObserver=null,this._onAfterStepObserver=null,this._scene=null)},te.prototype._updateToMesh=function(){var B=this.ray;this._attachedToMesh&&B&&(this._attachedToMesh._isDisposed?this.detachFromMesh():(this._attachedToMesh.getDirectionToRef(this._meshSpaceDirection,B.direction),m.e.TransformCoordinatesToRef(this._meshSpaceOrigin,this._attachedToMesh.getWorldMatrix(),B.origin)))},te.prototype.dispose=function(){this.hide(),this.detachFromMesh(),this.ray=null},te}(),re=c(25),ne=c(73),ge=c(62),_e=c(4),ce=c(5),ie=c(97),Z=function(){function te(B,G,$,le,se,q){var H,X,J,Q,ee,pe,Te,ve,he,be,xe,Se,Ue,We;le===void 0&&(le=!0),se===void 0&&(se=3),q===void 0&&(q={}),this.skeleton=B,this.mesh=G,this.autoUpdateBonesMatrices=le,this.renderingGroupId=se,this.options=q,this.color=M.a.White(),this._debugLines=new Array,this._localAxes=null,this._isEnabled=!1,this._obs=null,this._scene=$,this._ready=!1,q.pauseAnimations=(H=q.pauseAnimations)===null||H===void 0||H,q.returnToRest=(X=q.returnToRest)!==null&&X!==void 0&&X,q.displayMode=(J=q.displayMode)!==null&&J!==void 0?J:te.DISPLAY_LINES,q.displayOptions=(Q=q.displayOptions)!==null&&Q!==void 0?Q:{},q.displayOptions.midStep=(ee=q.displayOptions.midStep)!==null&&ee!==void 0?ee:.235,q.displayOptions.midStepFactor=(pe=q.displayOptions.midStepFactor)!==null&&pe!==void 0?pe:.155,q.displayOptions.sphereBaseSize=(Te=q.displayOptions.sphereBaseSize)!==null&&Te!==void 0?Te:.15,q.displayOptions.sphereScaleUnit=(ve=q.displayOptions.sphereScaleUnit)!==null&&ve!==void 0?ve:2,q.displayOptions.sphereFactor=(he=q.displayOptions.sphereFactor)!==null&&he!==void 0?he:.865,q.displayOptions.spurFollowsChild=(be=q.displayOptions.spurFollowsChild)!==null&&be!==void 0&&be,q.displayOptions.showLocalAxes=(xe=q.displayOptions.showLocalAxes)!==null&&xe!==void 0&&xe,q.displayOptions.localAxesSize=(Se=q.displayOptions.localAxesSize)!==null&&Se!==void 0?Se:.075,q.computeBonesUsingShaders=(Ue=q.computeBonesUsingShaders)===null||Ue===void 0||Ue,q.useAllBones=(We=q.useAllBones)===null||We===void 0||We;var Ze=G.getVerticesData(_e.b.MatricesIndicesKind),Qe=G.getVerticesData(_e.b.MatricesWeightsKind);if(this._boneIndices=new Set,!q.useAllBones&&Ze&&Qe)for(var Xe=0;Xe<Ze.length;++Xe){var nt=Ze[Xe];Qe[Xe]!==0&&this._boneIndices.add(nt)}this._utilityLayer=new U.a(this._scene,!1),this._utilityLayer.pickUtilitySceneFirst=!1,this._utilityLayer.utilityLayerScene.autoClearDepthAndStencil=!0;var Ke=this.options.displayMode||0;Ke>te.DISPLAY_SPHERE_AND_SPURS&&(Ke=te.DISPLAY_LINES),this.displayMode=Ke,this.update(),this._bindObs()}return te.CreateBoneWeightShader=function(B,G){var $,le,se,q,H,X,J=B.skeleton,Q=($=B.colorBase)!==null&&$!==void 0?$:M.a.Black(),ee=(le=B.colorZero)!==null&&le!==void 0?le:M.a.Blue(),pe=(se=B.colorQuarter)!==null&&se!==void 0?se:M.a.Green(),Te=(q=B.colorHalf)!==null&&q!==void 0?q:M.a.Yellow(),ve=(H=B.colorFull)!==null&&H!==void 0?H:M.a.Red(),he=(X=B.targetBoneIndex)!==null&&X!==void 0?X:0;ce.a.ShadersStore["boneWeights:"+J.name+"VertexShader"]=`precision highp float;

        attribute vec3 position;
        attribute vec2 uv;

        uniform mat4 view;
        uniform mat4 projection;
        uniform mat4 worldViewProjection;

        #include<bonesDeclaration>
        #if NUM_BONE_INFLUENCERS == 0
            attribute vec4 matricesIndices;
            attribute vec4 matricesWeights;
        #endif

        #include<instancesDeclaration>

        varying vec3 vColor;

        uniform vec3 colorBase;
        uniform vec3 colorZero;
        uniform vec3 colorQuarter;
        uniform vec3 colorHalf;
        uniform vec3 colorFull;

        uniform float targetBoneIndex;

        void main() {
            vec3 positionUpdated = position;

            #include<instancesVertex>
            #include<bonesVertex>

            vec4 worldPos = finalWorld * vec4(positionUpdated, 1.0);

            vec3 color = colorBase;
            float totalWeight = 0.;
            if(matricesIndices[0] == targetBoneIndex && matricesWeights[0] > 0.){
                totalWeight += matricesWeights[0];
            }
            if(matricesIndices[1] == targetBoneIndex && matricesWeights[1] > 0.){
                totalWeight += matricesWeights[1];
            }
            if(matricesIndices[2] == targetBoneIndex && matricesWeights[2] > 0.){
                totalWeight += matricesWeights[2];
            }
            if(matricesIndices[3] == targetBoneIndex && matricesWeights[3] > 0.){
                totalWeight += matricesWeights[3];
            }

            color = mix(color, colorZero, smoothstep(0., 0.25, totalWeight));
            color = mix(color, colorQuarter, smoothstep(0.25, 0.5, totalWeight));
            color = mix(color, colorHalf, smoothstep(0.5, 0.75, totalWeight));
            color = mix(color, colorFull, smoothstep(0.75, 1.0, totalWeight));
            vColor = color;

        gl_Position = projection * view * worldPos;
        }`,ce.a.ShadersStore["boneWeights:"+J.name+"FragmentShader"]=`
            precision highp float;
            varying vec3 vPosition;

            varying vec3 vColor;

            void main() {
                vec4 color = vec4(vColor, 1.0);
                gl_FragColor = color;
            }
        `;var be=new ne.a("boneWeight:"+J.name,G,{vertex:"boneWeights:"+J.name,fragment:"boneWeights:"+J.name},{attributes:["position","normal","matricesIndices","matricesWeights"],uniforms:["world","worldView","worldViewProjection","view","projection","viewProjection","colorBase","colorZero","colorQuarter","colorHalf","colorFull","targetBoneIndex"]});return be.setColor3("colorBase",Q),be.setColor3("colorZero",ee),be.setColor3("colorQuarter",pe),be.setColor3("colorHalf",Te),be.setColor3("colorFull",ve),be.setFloat("targetBoneIndex",he),be.getClassName=function(){return"BoneWeightShader"},be.transparencyMode=re.a.MATERIAL_OPAQUE,be},te.CreateSkeletonMapShader=function(B,G){var $,le=B.skeleton,se=($=B.colorMap)!==null&&$!==void 0?$:[{color:new M.a(1,.38,.18),location:0},{color:new M.a(.59,.18,1),location:.2},{color:new M.a(.59,1,.18),location:.4},{color:new M.a(1,.87,.17),location:.6},{color:new M.a(1,.17,.42),location:.8},{color:new M.a(.17,.68,1),location:1}],q=le.bones.length+1,H=te._CreateBoneMapColorBuffer(q,se,G),X=new ne.a("boneWeights:"+le.name,G,{vertexSource:`precision highp float;

            attribute vec3 position;
            attribute vec2 uv;

            uniform mat4 view;
            uniform mat4 projection;
            uniform mat4 worldViewProjection;
            uniform float colorMap[`+4*le.bones.length+`];

            #include<bonesDeclaration>
            #if NUM_BONE_INFLUENCERS == 0
                attribute vec4 matricesIndices;
                attribute vec4 matricesWeights;
            #endif
            #include<instancesDeclaration>

            varying vec3 vColor;

            void main() {
                vec3 positionUpdated = position;

                #include<instancesVertex>
                #include<bonesVertex>

                vec3 color = vec3(0.);
                bool first = true;

                for (int i = 0; i < 4; i++) {
                    int boneIdx = int(matricesIndices[i]);
                    float boneWgt = matricesWeights[i];

                    vec3 c = vec3(colorMap[boneIdx * 4 + 0], colorMap[boneIdx * 4 + 1], colorMap[boneIdx * 4 + 2]);

                    if (boneWgt > 0.) {
                        if (first) {
                            first = false;
                            color = c;
                        } else {
                            color = mix(color, c, boneWgt);
                        }
                    }
                }

                vColor = color;

                vec4 worldPos = finalWorld * vec4(positionUpdated, 1.0);

                gl_Position = projection * view * worldPos;
            }`,fragmentSource:`
            precision highp float;
            varying vec3 vColor;

            void main() {
                vec4 color = vec4( vColor, 1.0 );
                gl_FragColor = color;
            }
            `},{attributes:["position","normal","matricesIndices","matricesWeights"],uniforms:["world","worldView","worldViewProjection","view","projection","viewProjection","colorMap"]});return X.setFloats("colorMap",H),X.getClassName=function(){return"SkeletonMapShader"},X.transparencyMode=re.a.MATERIAL_OPAQUE,X},te._CreateBoneMapColorBuffer=function(B,G,$){var le=new ge.a("temp",{width:B,height:1},$,!1),se=le.getContext(),q=se.createLinearGradient(0,0,B,0);G.forEach(function(Q){q.addColorStop(Q.location,Q.color.toHexString())}),se.fillStyle=q,se.fillRect(0,0,B,1),le.update();for(var H=[],X=se.getImageData(0,0,B,1).data,J=0;J<X.length;J++)H.push(X[J]*(1/255));return le.dispose(),H},Object.defineProperty(te.prototype,"scene",{get:function(){return this._scene},enumerable:!1,configurable:!0}),Object.defineProperty(te.prototype,"utilityLayer",{get:function(){return this._utilityLayer},enumerable:!1,configurable:!0}),Object.defineProperty(te.prototype,"isReady",{get:function(){return this._ready},enumerable:!1,configurable:!0}),Object.defineProperty(te.prototype,"ready",{set:function(B){this._ready=B},enumerable:!1,configurable:!0}),Object.defineProperty(te.prototype,"debugMesh",{get:function(){return this._debugMesh},set:function(B){this._debugMesh=B},enumerable:!1,configurable:!0}),Object.defineProperty(te.prototype,"displayMode",{get:function(){return this.options.displayMode||te.DISPLAY_LINES},set:function(B){B>te.DISPLAY_SPHERE_AND_SPURS&&(B=te.DISPLAY_LINES),this.options.displayMode=B},enumerable:!1,configurable:!0}),te.prototype._bindObs=function(){var B=this;switch(this.displayMode){case te.DISPLAY_LINES:this._obs=this.scene.onBeforeRenderObservable.add(function(){B._displayLinesUpdate()})}},te.prototype.update=function(){switch(this.displayMode){case te.DISPLAY_LINES:this._displayLinesUpdate();break;case te.DISPLAY_SPHERES:this._buildSpheresAndSpurs(!0);break;case te.DISPLAY_SPHERE_AND_SPURS:this._buildSpheresAndSpurs(!1)}this._buildLocalAxes()},Object.defineProperty(te.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(B){this.isEnabled!==B&&(this._isEnabled=B,this.debugMesh&&this.debugMesh.setEnabled(B),B&&!this._obs?this._bindObs():!B&&this._obs&&(this.scene.onBeforeRenderObservable.remove(this._obs),this._obs=null))},enumerable:!1,configurable:!0}),te.prototype._getBonePosition=function(B,G,$,le,se,q){le===void 0&&(le=0),se===void 0&&(se=0),q===void 0&&(q=0);var H=m.c.Matrix[0],X=G.getParent();if(H.copyFrom(G.getLocalMatrix()),le!==0||se!==0||q!==0){var J=m.c.Matrix[1];m.a.IdentityToRef(J),J.setTranslationFromFloats(le,se,q),J.multiplyToRef(H,H)}X&&H.multiplyToRef(X.getAbsoluteTransform(),H),H.multiplyToRef($,H),B.x=H.m[12],B.y=H.m[13],B.z=H.m[14]},te.prototype._getLinesForBonesWithLength=function(B,G){for(var $=B.length,le=this.mesh._effectiveMesh.position,se=0,q=0;q<$;q++){var H=B[q],X=this._debugLines[se];H._index!==-1&&(this._boneIndices.has(H.getIndex())||this.options.useAllBones)&&(X||(X=[m.e.Zero(),m.e.Zero()],this._debugLines[se]=X),this._getBonePosition(X[0],H,G),this._getBonePosition(X[1],H,G,0,H.length,0),X[0].subtractInPlace(le),X[1].subtractInPlace(le),se++)}},te.prototype._getLinesForBonesNoLength=function(B){for(var G=B.length,$=0,le=this.mesh._effectiveMesh,se=le.position,q=G-1;q>=0;q--){var H=B[q],X=H.getParent();if(X&&(this._boneIndices.has(H.getIndex())||this.options.useAllBones)){var J=this._debugLines[$];J||(J=[m.e.Zero(),m.e.Zero()],this._debugLines[$]=J),H.getAbsolutePositionToRef(le,J[0]),X.getAbsolutePositionToRef(le,J[1]),J[0].subtractInPlace(se),J[1].subtractInPlace(se),$++}}},te.prototype._revert=function(B){this.options.pauseAnimations&&(this.scene.animationsEnabled=B,this.utilityLayer.utilityLayerScene.animationsEnabled=B)},te.prototype._getAbsoluteBindPoseToRef=function(B,G){B!==null&&B._index!==-1?(this._getAbsoluteBindPoseToRef(B.getParent(),G),B.getBindPose().multiplyToRef(G,G)):G.copyFrom(m.a.Identity())},te.prototype._buildSpheresAndSpurs=function(B){var G,$;B===void 0&&(B=!0),this._debugMesh&&(this._debugMesh.dispose(),this._debugMesh=null,this.ready=!1),this._ready=!1;var le=(G=this.utilityLayer)===null||G===void 0?void 0:G.utilityLayerScene,se=this.skeleton.bones,q=[],H=[],X=this.scene.animationsEnabled;try{this.options.pauseAnimations&&(this.scene.animationsEnabled=!1,le.animationsEnabled=!1),this.options.returnToRest&&this.skeleton.returnToRest(),this.autoUpdateBonesMatrices&&this.skeleton.computeAbsoluteTransforms();for(var J=Number.NEGATIVE_INFINITY,Q=this.options.displayOptions||{},ee=function(Xe){var nt=se[Xe];if(nt._index===-1||!pe._boneIndices.has(nt.getIndex())&&!pe.options.useAllBones)return"continue";var Ke=new m.a;pe._getAbsoluteBindPoseToRef(nt,Ke);var ct=new m.e;Ke.decompose(void 0,void 0,ct),nt.children.forEach(function(Wt,Ft){var Ht=new m.a;Wt.getBindPose().multiplyToRef(Ke,Ht);var fn=new m.e;Ht.decompose(void 0,void 0,fn);var ln=m.e.Distance(ct,fn);if(ln>J&&(J=ln),!B){for(var Ln=fn.clone().subtract(ct.clone()),Ne=Ln.length(),vr=Ln.normalize().scale(Ne),On=Q.midStep||.165,$n=Q.midStepFactor||.215,Ge=vr.scale(On),zn=ie.a.ExtrudeShapeCustom("skeletonViewer",{shape:[new m.e(1,-1,0),new m.e(1,1,0),new m.e(-1,1,0),new m.e(-1,-1,0),new m.e(1,-1,0)],path:[m.e.Zero(),Ge,vr],scaleFunction:function(ss){switch(ss){case 0:case 2:return 0;case 1:return Ne*$n}return 0},sideOrientation:g.a.DEFAULTSIDE,updatable:!1},le),No=zn.getTotalVertices(),et=[],dr=[],Qr=0;Qr<No;Qr++)et.push(1,0,0,0),Q.spurFollowsChild&&Qr>9?dr.push(Wt.getIndex(),0,0,0):dr.push(nt.getIndex(),0,0,0);zn.position=ct.clone(),zn.setVerticesData(_e.b.MatricesWeightsKind,et,!1),zn.setVerticesData(_e.b.MatricesIndicesKind,dr,!1),zn.convertToFlatShadedMesh(),H.push(zn)}});for(var ot=Q.sphereBaseSize||.2,_t=R.a.CreateSphere("skeletonViewer",{segments:6,diameter:ot,updatable:!0},le),gt=_t.getTotalVertices(),At=[],wt=[],Qt=0;Qt<gt;Qt++)At.push(1,0,0,0),wt.push(nt.getIndex(),0,0,0);_t.setVerticesData(_e.b.MatricesWeightsKind,At,!1),_t.setVerticesData(_e.b.MatricesIndicesKind,wt,!1),_t.position=ct.clone(),q.push([_t,nt])},pe=this,Te=0;Te<se.length;Te++)ee(Te);var ve=Q.sphereScaleUnit||2,he=Q.sphereFactor||.85,be=[];for(Te=0;Te<q.length;Te++){for(var xe=q[Te],Se=xe[0],Ue=xe[1],We=1/(ve/J),Ze=0,Qe=Ue;Qe.getParent()&&Qe.getParent().getIndex()!==-1;)Ze++,Qe=Qe.getParent();Se.scaling.scaleInPlace(We*Math.pow(he,Ze)),be.push(Se)}this.debugMesh=g.a.MergeMeshes(be.concat(H),!0,!0),this.debugMesh&&(this.debugMesh.renderingGroupId=this.renderingGroupId,this.debugMesh.skeleton=this.skeleton,this.debugMesh.parent=this.mesh,this.debugMesh.computeBonesUsingShaders=($=this.options.computeBonesUsingShaders)===null||$===void 0||$,this.debugMesh.alwaysSelectAsActiveMesh=!0),this.utilityLayer._getSharedGizmoLight().intensity=.7,this._revert(X),this.ready=!0}catch(Xe){console.error(Xe),this._revert(X),this.dispose()}},te.prototype._buildLocalAxes=function(){var B;this._localAxes&&this._localAxes.dispose(),this._localAxes=null;var G=this.options.displayOptions||{};if(G.showLocalAxes){var $=this._utilityLayer.utilityLayerScene,le=G.localAxesSize||.075,se=[],q=[],H=new M.b(1,0,0,1),X=new M.b(0,1,0,1),J=new M.b(0,0,1,1),Q=[],ee=[];for(var pe in this.skeleton.bones){var Te=this.skeleton.bones[pe];if(Te._index!==-1&&(this._boneIndices.has(Te.getIndex())||this.options.useAllBones)){var ve=new m.a,he=new m.e;this._getAbsoluteBindPoseToRef(Te,ve),ve.decompose(void 0,void 0,he);var be=Te.getBindPose().getRotationMatrix(),xe=m.e.TransformCoordinates(new m.e(0+le,0,0),be),Se=m.e.TransformCoordinates(new m.e(0,0+le,0),be),Ue=m.e.TransformCoordinates(new m.e(0,0,0+le),be),We=[[he,he.add(xe)],[he,he.add(Se)],[he,he.add(Ue)]],Ze=[[H,H],[X,X],[J,J]];se.push.apply(se,We),q.push.apply(q,Ze);for(var Qe=0;Qe<6;Qe++)Q.push(1,0,0,0),ee.push(Te.getIndex(),0,0,0)}}this._localAxes=Y.a.CreateLineSystem("localAxes",{lines:se,colors:q,updatable:!0},$),this._localAxes.setVerticesData(_e.b.MatricesWeightsKind,Q,!1),this._localAxes.setVerticesData(_e.b.MatricesIndicesKind,ee,!1),this._localAxes.skeleton=this.skeleton,this._localAxes.renderingGroupId=this.renderingGroupId,this._localAxes.parent=this.mesh,this._localAxes.computeBonesUsingShaders=(B=this.options.computeBonesUsingShaders)===null||B===void 0||B}},te.prototype._displayLinesUpdate=function(){if(this._utilityLayer){this.autoUpdateBonesMatrices&&this.skeleton.computeAbsoluteTransforms();var B=this.mesh._effectiveMesh;this.skeleton.bones[0].length===void 0?this._getLinesForBonesNoLength(this.skeleton.bones):this._getLinesForBonesWithLength(this.skeleton.bones,B.getWorldMatrix());var G=this._utilityLayer.utilityLayerScene;G&&(this._debugMesh?Y.a.CreateLineSystem("",{lines:this._debugLines,updatable:!0,instance:this._debugMesh},G):(this._debugMesh=Y.a.CreateLineSystem("",{lines:this._debugLines,updatable:!0,instance:null},G),this._debugMesh.renderingGroupId=this.renderingGroupId),this._debugMesh.position.copyFrom(this.mesh.position),this._debugMesh.color=this.color)}},te.prototype.changeDisplayMode=function(B){var G=!!this.isEnabled;this.displayMode!==B&&(this.isEnabled=!1,this._debugMesh&&(this._debugMesh.dispose(),this._debugMesh=null,this.ready=!1),this.displayMode=B,this.update(),this._bindObs(),this.isEnabled=G)},te.prototype.changeDisplayOptions=function(B,G){var $=!!this.isEnabled;this.options.displayOptions[B]=G,this.isEnabled=!1,this._debugMesh&&(this._debugMesh.dispose(),this._debugMesh=null,this.ready=!1),this.update(),this._bindObs(),this.isEnabled=$},te.prototype.dispose=function(){this.isEnabled=!1,this._debugMesh&&(this._debugMesh.dispose(),this._debugMesh=null),this._utilityLayer&&(this._utilityLayer.dispose(),this._utilityLayer=null),this.ready=!1},te.DISPLAY_LINES=0,te.DISPLAY_SPHERES=1,te.DISPLAY_SPHERE_AND_SPURS=2,te}()},function(h,s,c){var E="morphTargetsVertex",m=`#ifdef MORPHTARGETS
positionUpdated+=(position{X}-position)*morphTargetInfluences[{X}];
#ifdef MORPHTARGETS_NORMAL
normalUpdated+=(normal{X}-normal)*morphTargetInfluences[{X}];
#endif
#ifdef MORPHTARGETS_TANGENT
tangentUpdated.xyz+=(tangent{X}-tangent.xyz)*morphTargetInfluences[{X}];
#endif
#ifdef MORPHTARGETS_UV
uvUpdated+=(uv_{X}-uv)*morphTargetInfluences[{X}];
#endif
#endif`;c(5).a.IncludesShadersStore[E]=m},function(h,s,c){c.d(s,"b",function(){return m}),c.d(s,"a",function(){return S});var E=c(0);function m(d,M,C,I,b){b===void 0&&(b=null);for(var p=new E.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),x=new E.e(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),P=C;P<C+I;P++){var A=3*M[P],T=d[A],_=d[A+1],g=d[A+2];p.minimizeInPlaceFromFloats(T,_,g),x.maximizeInPlaceFromFloats(T,_,g)}return b&&(p.x-=p.x*b.x+b.y,p.y-=p.y*b.x+b.y,p.z-=p.z*b.x+b.y,x.x+=x.x*b.x+b.y,x.y+=x.y*b.x+b.y,x.z+=x.z*b.x+b.y),{minimum:p,maximum:x}}function S(d,M,C,I,b){I===void 0&&(I=null);var p=new E.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),x=new E.e(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);b||(b=3);for(var P=M,A=M*b;P<M+C;P++,A+=b){var T=d[A],_=d[A+1],g=d[A+2];p.minimizeInPlaceFromFloats(T,_,g),x.maximizeInPlaceFromFloats(T,_,g)}return I&&(p.x-=p.x*I.x+I.y,p.y-=p.y*I.x+I.y,p.z-=p.z*I.x+I.y,x.x+=x.x*I.x+I.y,x.y+=x.y*I.x+I.y,x.z+=x.z*I.x+I.y),{minimum:p,maximum:x}}},function(h,s,c){c.d(s,"a",function(){return E});var E=function(){}},function(h,s,c){c.d(s,"a",function(){return d});var E=c(44),m=c(0),S=c(28),d=function(){function M(C,I,b){this.vectors=E.a.BuildArray(8,m.e.Zero),this.center=m.e.Zero(),this.centerWorld=m.e.Zero(),this.extendSize=m.e.Zero(),this.extendSizeWorld=m.e.Zero(),this.directions=E.a.BuildArray(3,m.e.Zero),this.vectorsWorld=E.a.BuildArray(8,m.e.Zero),this.minimumWorld=m.e.Zero(),this.maximumWorld=m.e.Zero(),this.minimum=m.e.Zero(),this.maximum=m.e.Zero(),this.reConstruct(C,I,b)}return M.prototype.reConstruct=function(C,I,b){var p=C.x,x=C.y,P=C.z,A=I.x,T=I.y,_=I.z,g=this.vectors;this.minimum.copyFromFloats(p,x,P),this.maximum.copyFromFloats(A,T,_),g[0].copyFromFloats(p,x,P),g[1].copyFromFloats(A,T,_),g[2].copyFromFloats(A,x,P),g[3].copyFromFloats(p,T,P),g[4].copyFromFloats(p,x,_),g[5].copyFromFloats(A,T,P),g[6].copyFromFloats(p,T,_),g[7].copyFromFloats(A,x,_),I.addToRef(C,this.center).scaleInPlace(.5),I.subtractToRef(C,this.extendSize).scaleInPlace(.5),this._worldMatrix=b||m.a.IdentityReadOnly,this._update(this._worldMatrix)},M.prototype.scale=function(C){var I=M.TmpVector3,b=this.maximum.subtractToRef(this.minimum,I[0]),p=b.length();b.normalizeFromLength(p);var x=p*C,P=b.scaleInPlace(.5*x),A=this.center.subtractToRef(P,I[1]),T=this.center.addToRef(P,I[2]);return this.reConstruct(A,T,this._worldMatrix),this},M.prototype.getWorldMatrix=function(){return this._worldMatrix},M.prototype._update=function(C){var I=this.minimumWorld,b=this.maximumWorld,p=this.directions,x=this.vectorsWorld,P=this.vectors;if(C.isIdentity()){for(I.copyFrom(this.minimum),b.copyFrom(this.maximum),A=0;A<8;++A)x[A].copyFrom(P[A]);this.extendSizeWorld.copyFrom(this.extendSize),this.centerWorld.copyFrom(this.center)}else{I.setAll(Number.MAX_VALUE),b.setAll(-Number.MAX_VALUE);for(var A=0;A<8;++A){var T=x[A];m.e.TransformCoordinatesToRef(P[A],C,T),I.minimizeInPlace(T),b.maximizeInPlace(T)}b.subtractToRef(I,this.extendSizeWorld).scaleInPlace(.5),b.addToRef(I,this.centerWorld).scaleInPlace(.5)}m.e.FromArrayToRef(C.m,0,p[0]),m.e.FromArrayToRef(C.m,4,p[1]),m.e.FromArrayToRef(C.m,8,p[2]),this._worldMatrix=C},M.prototype.isInFrustum=function(C){return M.IsInFrustum(this.vectorsWorld,C)},M.prototype.isCompletelyInFrustum=function(C){return M.IsCompletelyInFrustum(this.vectorsWorld,C)},M.prototype.intersectsPoint=function(C){var I=this.minimumWorld,b=this.maximumWorld,p=I.x,x=I.y,P=I.z,A=b.x,T=b.y,_=b.z,g=C.x,O=C.y,R=C.z,N=-S.a;return!(A-g<N||N>g-p)&&!(T-O<N||N>O-x)&&!(_-R<N||N>R-P)},M.prototype.intersectsSphere=function(C){return M.IntersectsSphere(this.minimumWorld,this.maximumWorld,C.centerWorld,C.radiusWorld)},M.prototype.intersectsMinMax=function(C,I){var b=this.minimumWorld,p=this.maximumWorld,x=b.x,P=b.y,A=b.z,T=p.x,_=p.y,g=p.z,O=C.x,R=C.y,N=C.z,V=I.x,U=I.y,L=I.z;return!(T<O||x>V)&&!(_<R||P>U)&&!(g<N||A>L)},M.Intersects=function(C,I){return C.intersectsMinMax(I.minimumWorld,I.maximumWorld)},M.IntersectsSphere=function(C,I,b,p){var x=M.TmpVector3[0];return m.e.ClampToRef(b,C,I,x),m.e.DistanceSquared(b,x)<=p*p},M.IsCompletelyInFrustum=function(C,I){for(var b=0;b<6;++b)for(var p=I[b],x=0;x<8;++x)if(p.dotCoordinate(C[x])<0)return!1;return!0},M.IsInFrustum=function(C,I){for(var b=0;b<6;++b){for(var p=!0,x=I[b],P=0;P<8;++P)if(x.dotCoordinate(C[P])>=0){p=!1;break}if(p)return!1}return!0},M.TmpVector3=E.a.BuildArray(3,m.e.Zero),M}()},function(h,s,c){c.d(s,"a",function(){return m});var E=c(38),m=function(){function S(){}return S.SetImmediate=function(d){E.a.IsWindowObjectExist()&&window.setImmediate?window.setImmediate(d):setTimeout(d,1)},S}()},function(h,s,c){c.d(s,"a",function(){return S});var E=c(0),m=c(2),S=function(){function d(){this.previousWorldMatrices={},this.previousBones={}}return d.AddUniforms=function(M){M.push("previousWorld","previousViewProjection")},d.AddSamplers=function(M){},d.prototype.bindForSubMesh=function(M,C,I,b,p){C.prePassRenderer&&C.prePassRenderer.enabled&&C.prePassRenderer.getIndex(m.a.PREPASS_VELOCITY_TEXTURE_TYPE)!==-1&&(this.previousWorldMatrices[I.uniqueId]||(this.previousWorldMatrices[I.uniqueId]=E.a.Identity()),this.previousViewProjection||(this.previousViewProjection=C.getTransformMatrix()),M.setMatrix("previousWorld",this.previousWorldMatrices[I.uniqueId]),M.setMatrix("previousViewProjection",this.previousViewProjection),this.previousWorldMatrices[I.uniqueId]=b.clone(),this.previousViewProjection=C.getTransformMatrix().clone())},d}()},function(h,s,c){var E="lightFragmentDeclaration",m=`#ifdef LIGHT{X}
uniform vec4 vLightData{X};
uniform vec4 vLightDiffuse{X};
#ifdef SPECULARTERM
uniform vec4 vLightSpecular{X};
#else
vec4 vLightSpecular{X}=vec4(0.);
#endif
#ifdef SHADOW{X}
#ifdef SHADOWCSM{X}
uniform mat4 lightMatrix{X}[SHADOWCSMNUM_CASCADES{X}];
uniform float viewFrustumZ{X}[SHADOWCSMNUM_CASCADES{X}];
uniform float frustumLengths{X}[SHADOWCSMNUM_CASCADES{X}];
uniform float cascadeBlendFactor{X};
varying vec4 vPositionFromLight{X}[SHADOWCSMNUM_CASCADES{X}];
varying float vDepthMetric{X}[SHADOWCSMNUM_CASCADES{X}];
varying vec4 vPositionFromCamera{X};
#if defined(SHADOWPCSS{X})
uniform highp sampler2DArrayShadow shadowSampler{X};
uniform highp sampler2DArray depthSampler{X};
uniform vec2 lightSizeUVCorrection{X}[SHADOWCSMNUM_CASCADES{X}];
uniform float depthCorrection{X}[SHADOWCSMNUM_CASCADES{X}];
uniform float penumbraDarkness{X};
#elif defined(SHADOWPCF{X})
uniform highp sampler2DArrayShadow shadowSampler{X};
#else
uniform highp sampler2DArray shadowSampler{X};
#endif
#ifdef SHADOWCSMDEBUG{X}
const vec3 vCascadeColorsMultiplier{X}[8]=vec3[8]
(
vec3 ( 1.5,0.0,0.0 ),
vec3 ( 0.0,1.5,0.0 ),
vec3 ( 0.0,0.0,5.5 ),
vec3 ( 1.5,0.0,5.5 ),
vec3 ( 1.5,1.5,0.0 ),
vec3 ( 1.0,1.0,1.0 ),
vec3 ( 0.0,1.0,5.5 ),
vec3 ( 0.5,3.5,0.75 )
);
vec3 shadowDebug{X};
#endif
#ifdef SHADOWCSMUSESHADOWMAXZ{X}
int index{X}=-1;
#else
int index{X}=SHADOWCSMNUM_CASCADES{X}-1;
#endif
float diff{X}=0.;
#elif defined(SHADOWCUBE{X})
uniform samplerCube shadowSampler{X};
#else
varying vec4 vPositionFromLight{X};
varying float vDepthMetric{X};
#if defined(SHADOWPCSS{X})
uniform highp sampler2DShadow shadowSampler{X};
uniform highp sampler2D depthSampler{X};
#elif defined(SHADOWPCF{X})
uniform highp sampler2DShadow shadowSampler{X};
#else
uniform sampler2D shadowSampler{X};
#endif
uniform mat4 lightMatrix{X};
#endif
uniform vec4 shadowsInfo{X};
uniform vec2 depthValues{X};
#endif
#ifdef SPOTLIGHT{X}
uniform vec4 vLightDirection{X};
uniform vec4 vLightFalloff{X};
#elif defined(POINTLIGHT{X})
uniform vec4 vLightFalloff{X};
#elif defined(HEMILIGHT{X})
uniform vec3 vLightGround{X};
#endif
#ifdef PROJECTEDLIGHTTEXTURE{X}
uniform mat4 textureProjectionMatrix{X};
uniform sampler2D projectionLightSampler{X};
#endif
#endif`;c(5).a.IncludesShadersStore[E]=m},function(h,s,c){var E="lightUboDeclaration",m=`#ifdef LIGHT{X}
uniform Light{X}
{
vec4 vLightData;
vec4 vLightDiffuse;
vec4 vLightSpecular;
#ifdef SPOTLIGHT{X}
vec4 vLightDirection;
vec4 vLightFalloff;
#elif defined(POINTLIGHT{X})
vec4 vLightFalloff;
#elif defined(HEMILIGHT{X})
vec3 vLightGround;
#endif
vec4 shadowsInfo;
vec2 depthValues;
} light{X};
#ifdef PROJECTEDLIGHTTEXTURE{X}
uniform mat4 textureProjectionMatrix{X};
uniform sampler2D projectionLightSampler{X};
#endif
#ifdef SHADOW{X}
#ifdef SHADOWCSM{X}
uniform mat4 lightMatrix{X}[SHADOWCSMNUM_CASCADES{X}];
uniform float viewFrustumZ{X}[SHADOWCSMNUM_CASCADES{X}];
uniform float frustumLengths{X}[SHADOWCSMNUM_CASCADES{X}];
uniform float cascadeBlendFactor{X};
varying vec4 vPositionFromLight{X}[SHADOWCSMNUM_CASCADES{X}];
varying float vDepthMetric{X}[SHADOWCSMNUM_CASCADES{X}];
varying vec4 vPositionFromCamera{X};
#if defined(SHADOWPCSS{X})
uniform highp sampler2DArrayShadow shadowSampler{X};
uniform highp sampler2DArray depthSampler{X};
uniform vec2 lightSizeUVCorrection{X}[SHADOWCSMNUM_CASCADES{X}];
uniform float depthCorrection{X}[SHADOWCSMNUM_CASCADES{X}];
uniform float penumbraDarkness{X};
#elif defined(SHADOWPCF{X})
uniform highp sampler2DArrayShadow shadowSampler{X};
#else
uniform highp sampler2DArray shadowSampler{X};
#endif
#ifdef SHADOWCSMDEBUG{X}
const vec3 vCascadeColorsMultiplier{X}[8]=vec3[8]
(
vec3 ( 1.5,0.0,0.0 ),
vec3 ( 0.0,1.5,0.0 ),
vec3 ( 0.0,0.0,5.5 ),
vec3 ( 1.5,0.0,5.5 ),
vec3 ( 1.5,1.5,0.0 ),
vec3 ( 1.0,1.0,1.0 ),
vec3 ( 0.0,1.0,5.5 ),
vec3 ( 0.5,3.5,0.75 )
);
vec3 shadowDebug{X};
#endif
#ifdef SHADOWCSMUSESHADOWMAXZ{X}
int index{X}=-1;
#else
int index{X}=SHADOWCSMNUM_CASCADES{X}-1;
#endif
float diff{X}=0.;
#elif defined(SHADOWCUBE{X})
uniform samplerCube shadowSampler{X};
#else
varying vec4 vPositionFromLight{X};
varying float vDepthMetric{X};
#if defined(SHADOWPCSS{X})
uniform highp sampler2DShadow shadowSampler{X};
uniform highp sampler2D depthSampler{X};
#elif defined(SHADOWPCF{X})
uniform highp sampler2DShadow shadowSampler{X};
#else
uniform sampler2D shadowSampler{X};
#endif
uniform mat4 lightMatrix{X};
#endif
#endif
#endif`;c(5).a.IncludesShadersStore[E]=m},function(h,s,c){var E="imageProcessingDeclaration",m=`#ifdef EXPOSURE
uniform float exposureLinear;
#endif
#ifdef CONTRAST
uniform float contrast;
#endif
#ifdef VIGNETTE
uniform vec2 vInverseScreenSize;
uniform vec4 vignetteSettings1;
uniform vec4 vignetteSettings2;
#endif
#ifdef COLORCURVES
uniform vec4 vCameraColorCurveNegative;
uniform vec4 vCameraColorCurveNeutral;
uniform vec4 vCameraColorCurvePositive;
#endif
#ifdef COLORGRADING
#ifdef COLORGRADING3D
uniform highp sampler3D txColorTransform;
#else
uniform sampler2D txColorTransform;
#endif
uniform vec4 colorTransformSettings;
#endif`;c(5).a.IncludesShadersStore[E]=m},function(h,s,c){var E="imageProcessingFunctions",m=`#if defined(COLORGRADING) && !defined(COLORGRADING3D)

#define inline
vec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)
{
float sliceSize=2.0*sampler3dSetting.x;
#ifdef SAMPLER3DGREENDEPTH
float sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;
#else
float sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;
#endif
float sliceInteger=floor(sliceContinuous);


float sliceFraction=sliceContinuous-sliceInteger;
#ifdef SAMPLER3DGREENDEPTH
vec2 sliceUV=color.rb;
#else
vec2 sliceUV=color.rg;
#endif
sliceUV.x*=sliceSize;
sliceUV.x+=sliceInteger*sliceSize;
sliceUV=saturate(sliceUV);
vec4 slice0Color=texture2D(colorTransform,sliceUV);
sliceUV.x+=sliceSize;
sliceUV=saturate(sliceUV);
vec4 slice1Color=texture2D(colorTransform,sliceUV);
vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);
#ifdef SAMPLER3DBGRMAP
color.rgb=result.rgb;
#else
color.rgb=result.bgr;
#endif
return color;
}
#endif
#ifdef TONEMAPPING_ACES





const mat3 ACESInputMat=mat3(
vec3(0.59719,0.07600,0.02840),
vec3(0.35458,0.90834,0.13383),
vec3(0.04823,0.01566,0.83777)
);

const mat3 ACESOutputMat=mat3(
vec3( 1.60475,-0.10208,-0.00327),
vec3(-0.53108,1.10813,-0.07276),
vec3(-0.07367,-0.00605,1.07602)
);
vec3 RRTAndODTFit(vec3 v)
{
vec3 a=v*(v+0.0245786)-0.000090537;
vec3 b=v*(0.983729*v+0.4329510)+0.238081;
return a/b;
}
vec3 ACESFitted(vec3 color)
{
color=ACESInputMat*color;

color=RRTAndODTFit(color);
color=ACESOutputMat*color;

color=saturate(color);
return color;
}
#endif
vec4 applyImageProcessing(vec4 result) {
#ifdef EXPOSURE
result.rgb*=exposureLinear;
#endif
#ifdef VIGNETTE

vec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;
viewportXY=viewportXY*2.0-1.0;
vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);
float vignetteTerm=dot(vignetteXY1,vignetteXY1);
float vignette=pow(vignetteTerm,vignetteSettings2.w);

vec3 vignetteColor=vignetteSettings2.rgb;
#ifdef VIGNETTEBLENDMODEMULTIPLY
vec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);
result.rgb*=vignetteColorMultiplier;
#endif
#ifdef VIGNETTEBLENDMODEOPAQUE
result.rgb=mix(vignetteColor,result.rgb,vignette);
#endif
#endif
#ifdef TONEMAPPING
#ifdef TONEMAPPING_ACES
result.rgb=ACESFitted(result.rgb);
#else
const float tonemappingCalibration=1.590579;
result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);
#endif
#endif

result.rgb=toGammaSpace(result.rgb);
result.rgb=saturate(result.rgb);
#ifdef CONTRAST

vec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);
if (contrast<1.0) {

result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);
} else {

result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);
}
#endif

#ifdef COLORGRADING
vec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;
#ifdef COLORGRADING3D
vec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;
#else
vec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;
#endif
result.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);
#endif
#ifdef COLORCURVES

float luma=getLuminance(result.rgb);
vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));
vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;
result.rgb*=colorCurve.rgb;
result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);
#endif
return result;
}`;c(5).a.IncludesShadersStore[E]=m},function(h,s,c){var E="clipPlaneFragment",m=`#ifdef CLIPPLANE
if (fClipDistance>0.0)
{
discard;
}
#endif
#ifdef CLIPPLANE2
if (fClipDistance2>0.0)
{
discard;
}
#endif
#ifdef CLIPPLANE3
if (fClipDistance3>0.0)
{
discard;
}
#endif
#ifdef CLIPPLANE4
if (fClipDistance4>0.0)
{
discard;
}
#endif
#ifdef CLIPPLANE5
if (fClipDistance5>0.0)
{
discard;
}
#endif
#ifdef CLIPPLANE6
if (fClipDistance6>0.0)
{
discard;
}
#endif`;c(5).a.IncludesShadersStore[E]=m},function(h,s,c){var E="clipPlaneVertex",m=`#ifdef CLIPPLANE
fClipDistance=dot(worldPos,vClipPlane);
#endif
#ifdef CLIPPLANE2
fClipDistance2=dot(worldPos,vClipPlane2);
#endif
#ifdef CLIPPLANE3
fClipDistance3=dot(worldPos,vClipPlane3);
#endif
#ifdef CLIPPLANE4
fClipDistance4=dot(worldPos,vClipPlane4);
#endif
#ifdef CLIPPLANE5
fClipDistance5=dot(worldPos,vClipPlane5);
#endif
#ifdef CLIPPLANE6
fClipDistance6=dot(worldPos,vClipPlane6);
#endif`;c(5).a.IncludesShadersStore[E]=m},function(h,s,c){c.d(s,"a",function(){return E});var E=function(){function m(){this._count=0,this._data={}}return m.prototype.copyFrom=function(S){var d=this;this.clear(),S.forEach(function(M,C){return d.add(M,C)})},m.prototype.get=function(S){var d=this._data[S];if(d!==void 0)return d},m.prototype.getOrAddWithFactory=function(S,d){var M=this.get(S);return M!==void 0||(M=d(S))&&this.add(S,M),M},m.prototype.getOrAdd=function(S,d){var M=this.get(S);return M!==void 0?M:(this.add(S,d),d)},m.prototype.contains=function(S){return this._data[S]!==void 0},m.prototype.add=function(S,d){return this._data[S]===void 0&&(this._data[S]=d,++this._count,!0)},m.prototype.set=function(S,d){return this._data[S]!==void 0&&(this._data[S]=d,!0)},m.prototype.getAndRemove=function(S){var d=this.get(S);return d!==void 0?(delete this._data[S],--this._count,d):null},m.prototype.remove=function(S){return!!this.contains(S)&&(delete this._data[S],--this._count,!0)},m.prototype.clear=function(){this._data={},this._count=0},Object.defineProperty(m.prototype,"count",{get:function(){return this._count},enumerable:!1,configurable:!0}),m.prototype.forEach=function(S){for(var d in this._data)S(d,this._data[d])},m.prototype.first=function(S){for(var d in this._data){var M=S(d,this._data[d]);if(M)return M}return null},m}()},function(h,s,c){c.d(s,"a",function(){return S});var E=c(44),m=c(0),S=function(){function d(M,C,I){this.center=m.e.Zero(),this.centerWorld=m.e.Zero(),this.minimum=m.e.Zero(),this.maximum=m.e.Zero(),this.reConstruct(M,C,I)}return d.prototype.reConstruct=function(M,C,I){this.minimum.copyFrom(M),this.maximum.copyFrom(C);var b=m.e.Distance(M,C);C.addToRef(M,this.center).scaleInPlace(.5),this.radius=.5*b,this._update(I||m.a.IdentityReadOnly)},d.prototype.scale=function(M){var C=this.radius*M,I=d.TmpVector3,b=I[0].setAll(C),p=this.center.subtractToRef(b,I[1]),x=this.center.addToRef(b,I[2]);return this.reConstruct(p,x,this._worldMatrix),this},d.prototype.getWorldMatrix=function(){return this._worldMatrix},d.prototype._update=function(M){if(M.isIdentity())this.centerWorld.copyFrom(this.center),this.radiusWorld=this.radius;else{m.e.TransformCoordinatesToRef(this.center,M,this.centerWorld);var C=d.TmpVector3[0];m.e.TransformNormalFromFloatsToRef(1,1,1,M,C),this.radiusWorld=Math.max(Math.abs(C.x),Math.abs(C.y),Math.abs(C.z))*this.radius}},d.prototype.isInFrustum=function(M){for(var C=this.centerWorld,I=this.radiusWorld,b=0;b<6;b++)if(M[b].dotCoordinate(C)<=-I)return!1;return!0},d.prototype.isCenterInFrustum=function(M){for(var C=this.centerWorld,I=0;I<6;I++)if(M[I].dotCoordinate(C)<0)return!1;return!0},d.prototype.intersectsPoint=function(M){var C=m.e.DistanceSquared(this.centerWorld,M);return!(this.radiusWorld*this.radiusWorld<C)},d.Intersects=function(M,C){var I=m.e.DistanceSquared(M.centerWorld,C.centerWorld),b=M.radiusWorld+C.radiusWorld;return!(b*b<I)},d.TmpVector3=E.a.BuildArray(3,m.e.Zero),d}()},function(h,s,c){c.d(s,"a",function(){return E});var E=function(m,S,d){this.bu=m,this.bv=S,this.distance=d,this.faceId=0,this.subMeshId=0}},function(h,s,c){var E="clipPlaneFragmentDeclaration",m=`#ifdef CLIPPLANE
varying float fClipDistance;
#endif
#ifdef CLIPPLANE2
varying float fClipDistance2;
#endif
#ifdef CLIPPLANE3
varying float fClipDistance3;
#endif
#ifdef CLIPPLANE4
varying float fClipDistance4;
#endif
#ifdef CLIPPLANE5
varying float fClipDistance5;
#endif
#ifdef CLIPPLANE6
varying float fClipDistance6;
#endif`;c(5).a.IncludesShadersStore[E]=m},function(h,s,c){var E="logDepthDeclaration",m=`#ifdef LOGARITHMICDEPTH
uniform float logarithmicDepthConstant;
varying float vFragmentDepth;
#endif`;c(5).a.IncludesShadersStore[E]=m},function(h,s,c){var E="clipPlaneVertexDeclaration",m=`#ifdef CLIPPLANE
uniform vec4 vClipPlane;
varying float fClipDistance;
#endif
#ifdef CLIPPLANE2
uniform vec4 vClipPlane2;
varying float fClipDistance2;
#endif
#ifdef CLIPPLANE3
uniform vec4 vClipPlane3;
varying float fClipDistance3;
#endif
#ifdef CLIPPLANE4
uniform vec4 vClipPlane4;
varying float fClipDistance4;
#endif
#ifdef CLIPPLANE5
uniform vec4 vClipPlane5;
varying float fClipDistance5;
#endif
#ifdef CLIPPLANE6
uniform vec4 vClipPlane6;
varying float fClipDistance6;
#endif`;c(5).a.IncludesShadersStore[E]=m},function(h,s,c){c.d(s,"a",function(){return E});var E=function(){function m(){}return m.prototype.attributeProcessor=function(S){return S.replace("attribute","in")},m.prototype.varyingProcessor=function(S,d){return S.replace("varying",d?"in":"out")},m.prototype.postProcessor=function(S,d,M){var C=S.search(/#extension.+GL_EXT_draw_buffers.+require/)!==-1;if(S=(S=S.replace(/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,"")).replace(/texture2D\s*\(/g,"texture("),M)S=(S=(S=(S=(S=(S=(S=S.replace(/texture2DLodEXT\s*\(/g,"textureLod(")).replace(/textureCubeLodEXT\s*\(/g,"textureLod(")).replace(/textureCube\s*\(/g,"texture(")).replace(/gl_FragDepthEXT/g,"gl_FragDepth")).replace(/gl_FragColor/g,"glFragColor")).replace(/gl_FragData/g,"glFragData")).replace(/void\s+?main\s*\(/g,(C?"":`out vec4 glFragColor;
`)+"void main(");else if(d.indexOf("#define MULTIVIEW")!==-1)return`#extension GL_OVR_multiview2 : require
layout (num_views = 2) in;
`+S;return S},m}()},function(h,s,c){c.d(s,"a",function(){return E});var E=function(){function m(){}return m.BindClipPlane=function(S,d){if(d.clipPlane){var M=d.clipPlane;S.setFloat4("vClipPlane",M.normal.x,M.normal.y,M.normal.z,M.d)}d.clipPlane2&&(M=d.clipPlane2,S.setFloat4("vClipPlane2",M.normal.x,M.normal.y,M.normal.z,M.d)),d.clipPlane3&&(M=d.clipPlane3,S.setFloat4("vClipPlane3",M.normal.x,M.normal.y,M.normal.z,M.d)),d.clipPlane4&&(M=d.clipPlane4,S.setFloat4("vClipPlane4",M.normal.x,M.normal.y,M.normal.z,M.d)),d.clipPlane5&&(M=d.clipPlane5,S.setFloat4("vClipPlane5",M.normal.x,M.normal.y,M.normal.z,M.d)),d.clipPlane6&&(M=d.clipPlane6,S.setFloat4("vClipPlane6",M.normal.x,M.normal.y,M.normal.z,M.d))},m}()},function(h,s,c){c.d(s,"a",function(){return E});var E=function(){function m(){}return m.RandomId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(S){var d=16*Math.random()|0;return(S==="x"?d:3&d|8).toString(16)})},m}()},function(h,s,c){c.d(s,"a",function(){return d});var E=c(1),m=c(3),S=c(9),d=function(){function M(){this._dirty=!0,this._tempColor=new S.b(0,0,0,0),this._globalCurve=new S.b(0,0,0,0),this._highlightsCurve=new S.b(0,0,0,0),this._midtonesCurve=new S.b(0,0,0,0),this._shadowsCurve=new S.b(0,0,0,0),this._positiveCurve=new S.b(0,0,0,0),this._negativeCurve=new S.b(0,0,0,0),this._globalHue=30,this._globalDensity=0,this._globalSaturation=0,this._globalExposure=0,this._highlightsHue=30,this._highlightsDensity=0,this._highlightsSaturation=0,this._highlightsExposure=0,this._midtonesHue=30,this._midtonesDensity=0,this._midtonesSaturation=0,this._midtonesExposure=0,this._shadowsHue=30,this._shadowsDensity=0,this._shadowsSaturation=0,this._shadowsExposure=0}return Object.defineProperty(M.prototype,"globalHue",{get:function(){return this._globalHue},set:function(C){this._globalHue=C,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"globalDensity",{get:function(){return this._globalDensity},set:function(C){this._globalDensity=C,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"globalSaturation",{get:function(){return this._globalSaturation},set:function(C){this._globalSaturation=C,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"globalExposure",{get:function(){return this._globalExposure},set:function(C){this._globalExposure=C,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"highlightsHue",{get:function(){return this._highlightsHue},set:function(C){this._highlightsHue=C,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"highlightsDensity",{get:function(){return this._highlightsDensity},set:function(C){this._highlightsDensity=C,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"highlightsSaturation",{get:function(){return this._highlightsSaturation},set:function(C){this._highlightsSaturation=C,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"highlightsExposure",{get:function(){return this._highlightsExposure},set:function(C){this._highlightsExposure=C,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"midtonesHue",{get:function(){return this._midtonesHue},set:function(C){this._midtonesHue=C,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"midtonesDensity",{get:function(){return this._midtonesDensity},set:function(C){this._midtonesDensity=C,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"midtonesSaturation",{get:function(){return this._midtonesSaturation},set:function(C){this._midtonesSaturation=C,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"midtonesExposure",{get:function(){return this._midtonesExposure},set:function(C){this._midtonesExposure=C,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"shadowsHue",{get:function(){return this._shadowsHue},set:function(C){this._shadowsHue=C,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"shadowsDensity",{get:function(){return this._shadowsDensity},set:function(C){this._shadowsDensity=C,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"shadowsSaturation",{get:function(){return this._shadowsSaturation},set:function(C){this._shadowsSaturation=C,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"shadowsExposure",{get:function(){return this._shadowsExposure},set:function(C){this._shadowsExposure=C,this._dirty=!0},enumerable:!1,configurable:!0}),M.prototype.getClassName=function(){return"ColorCurves"},M.Bind=function(C,I,b,p,x){b===void 0&&(b="vCameraColorCurvePositive"),p===void 0&&(p="vCameraColorCurveNeutral"),x===void 0&&(x="vCameraColorCurveNegative"),C._dirty&&(C._dirty=!1,C.getColorGradingDataToRef(C._globalHue,C._globalDensity,C._globalSaturation,C._globalExposure,C._globalCurve),C.getColorGradingDataToRef(C._highlightsHue,C._highlightsDensity,C._highlightsSaturation,C._highlightsExposure,C._tempColor),C._tempColor.multiplyToRef(C._globalCurve,C._highlightsCurve),C.getColorGradingDataToRef(C._midtonesHue,C._midtonesDensity,C._midtonesSaturation,C._midtonesExposure,C._tempColor),C._tempColor.multiplyToRef(C._globalCurve,C._midtonesCurve),C.getColorGradingDataToRef(C._shadowsHue,C._shadowsDensity,C._shadowsSaturation,C._shadowsExposure,C._tempColor),C._tempColor.multiplyToRef(C._globalCurve,C._shadowsCurve),C._highlightsCurve.subtractToRef(C._midtonesCurve,C._positiveCurve),C._midtonesCurve.subtractToRef(C._shadowsCurve,C._negativeCurve)),I&&(I.setFloat4(b,C._positiveCurve.r,C._positiveCurve.g,C._positiveCurve.b,C._positiveCurve.a),I.setFloat4(p,C._midtonesCurve.r,C._midtonesCurve.g,C._midtonesCurve.b,C._midtonesCurve.a),I.setFloat4(x,C._negativeCurve.r,C._negativeCurve.g,C._negativeCurve.b,C._negativeCurve.a))},M.PrepareUniforms=function(C){C.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")},M.prototype.getColorGradingDataToRef=function(C,I,b,p,x){C!=null&&(C=M.clamp(C,0,360),I=M.clamp(I,-100,100),b=M.clamp(b,-100,100),p=M.clamp(p,-100,100),I=M.applyColorGradingSliderNonlinear(I),I*=.5,p=M.applyColorGradingSliderNonlinear(p),I<0&&(I*=-1,C=(C+180)%360),M.fromHSBToRef(C,I,50+.25*p,x),x.scaleToRef(2,x),x.a=1+.01*b)},M.applyColorGradingSliderNonlinear=function(C){C/=100;var I=Math.abs(C);return I=Math.pow(I,2),C<0&&(I*=-1),I*=100},M.fromHSBToRef=function(C,I,b,p){var x=M.clamp(C,0,360),P=M.clamp(I/100,0,1),A=M.clamp(b/100,0,1);if(P===0)p.r=A,p.g=A,p.b=A;else{x/=60;var T=Math.floor(x),_=x-T,g=A*(1-P),O=A*(1-P*_),R=A*(1-P*(1-_));switch(T){case 0:p.r=A,p.g=R,p.b=g;break;case 1:p.r=O,p.g=A,p.b=g;break;case 2:p.r=g,p.g=A,p.b=R;break;case 3:p.r=g,p.g=O,p.b=A;break;case 4:p.r=R,p.g=g,p.b=A;break;default:p.r=A,p.g=g,p.b=O}}p.a=1},M.clamp=function(C,I,b){return Math.min(Math.max(C,I),b)},M.prototype.clone=function(){return m.a.Clone(function(){return new M},this)},M.prototype.serialize=function(){return m.a.Serialize(this)},M.Parse=function(C){return m.a.Parse(function(){return new M},C,null,null)},Object(E.c)([Object(m.c)()],M.prototype,"_globalHue",void 0),Object(E.c)([Object(m.c)()],M.prototype,"_globalDensity",void 0),Object(E.c)([Object(m.c)()],M.prototype,"_globalSaturation",void 0),Object(E.c)([Object(m.c)()],M.prototype,"_globalExposure",void 0),Object(E.c)([Object(m.c)()],M.prototype,"_highlightsHue",void 0),Object(E.c)([Object(m.c)()],M.prototype,"_highlightsDensity",void 0),Object(E.c)([Object(m.c)()],M.prototype,"_highlightsSaturation",void 0),Object(E.c)([Object(m.c)()],M.prototype,"_highlightsExposure",void 0),Object(E.c)([Object(m.c)()],M.prototype,"_midtonesHue",void 0),Object(E.c)([Object(m.c)()],M.prototype,"_midtonesDensity",void 0),Object(E.c)([Object(m.c)()],M.prototype,"_midtonesSaturation",void 0),Object(E.c)([Object(m.c)()],M.prototype,"_midtonesExposure",void 0),M}();m.a._ColorCurvesParser=d.Parse},function(h,s,c){c.d(s,"a",function(){return S});var E=c(8),m=c(11),S=function(){function d(){}return d.Instantiate=function(M){if(this.RegisteredExternalClasses&&this.RegisteredExternalClasses[M])return this.RegisteredExternalClasses[M];var C=m.a.GetClass(M);if(C)return C;E.a.Warn(M+" not found, you may have missed an import.");for(var I=M.split("."),b=window||this,p=0,x=I.length;p<x;p++)b=b[I[p]];return typeof b!="function"?null:b},d.RegisteredExternalClasses={},d}()},function(h,s,c){var E=c(26),m=c(2);E.a.prototype.setAlphaConstants=function(S,d,M,C){this._alphaState.setAlphaBlendConstants(S,d,M,C)},E.a.prototype.setAlphaMode=function(S,d){if(d===void 0&&(d=!1),this._alphaMode!==S){switch(S){case m.a.ALPHA_DISABLE:this._alphaState.alphaBlend=!1;break;case m.a.ALPHA_PREMULTIPLIED:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case m.a.ALPHA_PREMULTIPLIED_PORTERDUFF:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case m.a.ALPHA_COMBINE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case m.a.ALPHA_ONEONE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case m.a.ALPHA_ADD:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case m.a.ALPHA_SUBTRACT:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case m.a.ALPHA_MULTIPLY:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case m.a.ALPHA_MAXIMIZED:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case m.a.ALPHA_INTERPOLATE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.CONSTANT_COLOR,this._gl.ONE_MINUS_CONSTANT_COLOR,this._gl.CONSTANT_ALPHA,this._gl.ONE_MINUS_CONSTANT_ALPHA),this._alphaState.alphaBlend=!0;break;case m.a.ALPHA_SCREENMODE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case m.a.ALPHA_ONEONE_ONEONE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case m.a.ALPHA_ALPHATOCOLOR:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case m.a.ALPHA_REVERSEONEMINUS:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE_MINUS_DST_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case m.a.ALPHA_SRC_DSTONEMINUSSRCALPHA:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case m.a.ALPHA_ONEONE_ONEZERO:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case m.a.ALPHA_EXCLUSION:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0}d||(this.depthCullingState.depthMask=S===m.a.ALPHA_DISABLE),this._alphaMode=S}},E.a.prototype.getAlphaMode=function(){return this._alphaMode},E.a.prototype.setAlphaEquation=function(S){if(this._alphaEquation!==S){switch(S){case m.a.ALPHA_EQUATION_ADD:this._alphaState.setAlphaEquationParameters(this._gl.FUNC_ADD,this._gl.FUNC_ADD);break;case m.a.ALPHA_EQUATION_SUBSTRACT:this._alphaState.setAlphaEquationParameters(this._gl.FUNC_SUBTRACT,this._gl.FUNC_SUBTRACT);break;case m.a.ALPHA_EQUATION_REVERSE_SUBTRACT:this._alphaState.setAlphaEquationParameters(this._gl.FUNC_REVERSE_SUBTRACT,this._gl.FUNC_REVERSE_SUBTRACT);break;case m.a.ALPHA_EQUATION_MAX:this._alphaState.setAlphaEquationParameters(this._gl.MAX,this._gl.MAX);break;case m.a.ALPHA_EQUATION_MIN:this._alphaState.setAlphaEquationParameters(this._gl.MIN,this._gl.MIN);break;case m.a.ALPHA_EQUATION_DARKEN:this._alphaState.setAlphaEquationParameters(this._gl.MIN,this._gl.FUNC_ADD)}this._alphaEquation=S}},E.a.prototype.getAlphaEquation=function(){return this._alphaEquation}},function(h,s,c){var E=c(26);E.a.prototype.updateDynamicIndexBuffer=function(m,S,d){var M;this._currentBoundBuffer[this._gl.ELEMENT_ARRAY_BUFFER]=null,this.bindIndexBuffer(m),M=S instanceof Uint16Array||S instanceof Uint32Array?S:m.is32Bits?new Uint32Array(S):new Uint16Array(S),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,M,this._gl.DYNAMIC_DRAW),this._resetIndexBufferBinding()},E.a.prototype.updateDynamicVertexBuffer=function(m,S,d,M){this.bindArrayBuffer(m),d===void 0&&(d=0);var C=S.length||S.byteLength;M===void 0||M>=C&&d===0?S instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,d,new Float32Array(S)):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,d,S):S instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,new Float32Array(S).subarray(d,d+M)):(S=S instanceof ArrayBuffer?new Uint8Array(S,d,M):new Uint8Array(S.buffer,S.byteOffset+d,M),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,S)),this._resetVertexBufferBinding()}},function(h,s,c){var E="fogFragmentDeclaration",m=`#ifdef FOG
#define FOGMODE_NONE 0.
#define FOGMODE_EXP 1.
#define FOGMODE_EXP2 2.
#define FOGMODE_LINEAR 3.
#define E 2.71828
uniform vec4 vFogInfos;
uniform vec3 vFogColor;
varying vec3 vFogDistance;
float CalcFogFactor()
{
float fogCoeff=1.0;
float fogStart=vFogInfos.y;
float fogEnd=vFogInfos.z;
float fogDensity=vFogInfos.w;
float fogDistance=length(vFogDistance);
if (FOGMODE_LINEAR == vFogInfos.x)
{
fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);
}
else if (FOGMODE_EXP == vFogInfos.x)
{
fogCoeff=1.0/pow(E,fogDistance*fogDensity);
}
else if (FOGMODE_EXP2 == vFogInfos.x)
{
fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);
}
return clamp(fogCoeff,0.0,1.0);
}
#endif`;c(5).a.IncludesShadersStore[E]=m},function(h,s,c){var E=c(26),m=c(27);E.a.prototype.createDynamicTexture=function(S,d,M,C){var I=new m.a(this,m.b.Dynamic);return I.baseWidth=S,I.baseHeight=d,M&&(S=this.needPOTTextures?E.a.GetExponentOfTwo(S,this._caps.maxTextureSize):S,d=this.needPOTTextures?E.a.GetExponentOfTwo(d,this._caps.maxTextureSize):d),I.width=S,I.height=d,I.isReady=!1,I.generateMipMaps=M,I.samplingMode=C,this.updateTextureSamplingMode(C,I),this._internalTexturesCache.push(I),I},E.a.prototype.updateDynamicTexture=function(S,d,M,C,I,b){if(C===void 0&&(C=!1),b===void 0&&(b=!1),S){var p=this._gl,x=p.TEXTURE_2D,P=this._bindTextureDirectly(x,S,!0,b);this._unpackFlipY(M===void 0?S.invertY:M),C&&p.pixelStorei(p.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);var A=this._getWebGLTextureType(S.type),T=this._getInternalFormat(I||S.format),_=this._getRGBABufferInternalSizedFormat(S.type,T);p.texImage2D(x,0,_,T,A,d),S.generateMipMaps&&p.generateMipmap(x),P||this._bindTextureDirectly(x,null),C&&p.pixelStorei(p.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),S.isReady=!0}}},function(h,s,c){c.r(s),c.d(s,"AbstractScene",function(){return E.a}),c.d(s,"AbstractActionManager",function(){return m.a}),c.d(s,"Action",function(){return I}),c.d(s,"ActionEvent",function(){return b.a}),c.d(s,"ActionManager",function(){return _e}),c.d(s,"Condition",function(){return x}),c.d(s,"ValueCondition",function(){return P}),c.d(s,"PredicateCondition",function(){return A}),c.d(s,"StateCondition",function(){return T}),c.d(s,"SwitchBooleanAction",function(){return O}),c.d(s,"SetStateAction",function(){return R}),c.d(s,"SetValueAction",function(){return N}),c.d(s,"IncrementValueAction",function(){return V}),c.d(s,"PlayAnimationAction",function(){return U}),c.d(s,"StopAnimationAction",function(){return L}),c.d(s,"DoNothingAction",function(){return j}),c.d(s,"CombineAction",function(){return Y}),c.d(s,"ExecuteCodeAction",function(){return W}),c.d(s,"SetParentAction",function(){return re}),c.d(s,"PlaySoundAction",function(){return ce}),c.d(s,"StopSoundAction",function(){return ie}),c.d(s,"InterpolateValueAction",function(){return X}),c.d(s,"Animatable",function(){return We}),c.d(s,"_IAnimationState",function(){return q}),c.d(s,"Animation",function(){return H}),c.d(s,"TargetedAnimation",function(){return Ze}),c.d(s,"AnimationGroup",function(){return Qe}),c.d(s,"AnimationPropertiesOverride",function(){return Xe}),c.d(s,"EasingFunction",function(){return Ke}),c.d(s,"CircleEase",function(){return ct}),c.d(s,"BackEase",function(){return ot}),c.d(s,"BounceEase",function(){return _t}),c.d(s,"CubicEase",function(){return gt}),c.d(s,"ElasticEase",function(){return At}),c.d(s,"ExponentialEase",function(){return wt}),c.d(s,"PowerEase",function(){return Qt}),c.d(s,"QuadraticEase",function(){return Wt}),c.d(s,"QuarticEase",function(){return Ft}),c.d(s,"QuinticEase",function(){return Ht}),c.d(s,"SineEase",function(){return fn}),c.d(s,"BezierCurveEase",function(){return ln}),c.d(s,"RuntimeAnimation",function(){return ve}),c.d(s,"AnimationEvent",function(){return Ln}),c.d(s,"AnimationKeyInterpolation",function(){return Z}),c.d(s,"AnimationRange",function(){return G}),c.d(s,"KeepAssets",function(){return vr}),c.d(s,"InstantiatedEntries",function(){return On}),c.d(s,"AssetContainer",function(){return $n}),c.d(s,"Analyser",function(){return zn}),c.d(s,"AudioEngine",function(){return No}),c.d(s,"AudioSceneComponent",function(){return qr}),c.d(s,"Sound",function(){return Qr}),c.d(s,"SoundTrack",function(){return ss}),c.d(s,"WeightedSound",function(){return yp}),c.d(s,"AutoRotationBehavior",function(){return Hu}),c.d(s,"BouncingBehavior",function(){return Wu}),c.d(s,"FramingBehavior",function(){return to}),c.d(s,"AttachToBoxBehavior",function(){return Tp}),c.d(s,"FadeInOutBehavior",function(){return Ep}),c.d(s,"MultiPointerScaleBehavior",function(){return Sp}),c.d(s,"PointerDragBehavior",function(){return yi.a}),c.d(s,"SixDofDragBehavior",function(){return Xu}),c.d(s,"Bone",function(){return Ue}),c.d(s,"BoneIKController",function(){return xp}),c.d(s,"BoneLookController",function(){return Ap}),c.d(s,"Skeleton",function(){return xa}),c.d(s,"ArcRotateCameraGamepadInput",function(){return Bc}),c.d(s,"ArcRotateCameraKeyboardMoveInput",function(){return Uc}),c.d(s,"ArcRotateCameraMouseWheelInput",function(){return Vc}),c.d(s,"ArcRotateCameraPointersInput",function(){return kc}),c.d(s,"ArcRotateCameraVRDeviceOrientationInput",function(){return jc}),c.d(s,"FlyCameraKeyboardInput",function(){return zc}),c.d(s,"FlyCameraMouseInput",function(){return Bo}),c.d(s,"FollowCameraKeyboardMoveInput",function(){return Pa}),c.d(s,"FollowCameraMouseWheelInput",function(){return Gc}),c.d(s,"FollowCameraPointersInput",function(){return Hc}),c.d(s,"FreeCameraDeviceOrientationInput",function(){return Yc}),c.d(s,"FreeCameraGamepadInput",function(){return Ra}),c.d(s,"FreeCameraKeyboardMoveInput",function(){return us}),c.d(s,"FreeCameraMouseInput",function(){return Wc}),c.d(s,"FreeCameraMouseWheelInput",function(){return hs}),c.d(s,"FreeCameraTouchInput",function(){return Xc}),c.d(s,"FreeCameraVirtualJoystickInput",function(){return Uo}),c.d(s,"CameraInputTypes",function(){return Kn}),c.d(s,"CameraInputsManager",function(){return Aa}),c.d(s,"Camera",function(){return Pt.a}),c.d(s,"TargetCamera",function(){return ci}),c.d(s,"FreeCamera",function(){return Cr}),c.d(s,"FreeCameraInputsManager",function(){return Ca}),c.d(s,"TouchCamera",function(){return Qc}),c.d(s,"ArcRotateCamera",function(){return Vi}),c.d(s,"ArcRotateCameraInputsManager",function(){return ls}),c.d(s,"DeviceOrientationCamera",function(){return Vo}),c.d(s,"FlyCamera",function(){return ro}),c.d(s,"FlyCameraInputsManager",function(){return qc}),c.d(s,"FollowCamera",function(){return Zc}),c.d(s,"ArcFollowCamera",function(){return Zu}),c.d(s,"FollowCameraInputsManager",function(){return ko}),c.d(s,"GamepadCamera",function(){return Tn}),c.d(s,"AnaglyphArcRotateCamera",function(){return vy}),c.d(s,"AnaglyphFreeCamera",function(){return by}),c.d(s,"AnaglyphGamepadCamera",function(){return yy}),c.d(s,"AnaglyphUniversalCamera",function(){return Ty}),c.d(s,"StereoscopicArcRotateCamera",function(){return Ey}),c.d(s,"StereoscopicFreeCamera",function(){return Sy}),c.d(s,"StereoscopicGamepadCamera",function(){return xy}),c.d(s,"StereoscopicUniversalCamera",function(){return Ay}),c.d(s,"UniversalCamera",function(){return Xt}),c.d(s,"VirtualJoysticksCamera",function(){return Py}),c.d(s,"VRCameraMetrics",function(){return ps}),c.d(s,"VRDeviceOrientationArcRotateCamera",function(){return My}),c.d(s,"VRDeviceOrientationFreeCamera",function(){return Ju}),c.d(s,"VRDeviceOrientationGamepadCamera",function(){return Iy}),c.d(s,"OnAfterEnteringVRObservableEvent",function(){return bI}),c.d(s,"VRExperienceHelper",function(){return Ny}),c.d(s,"WebVRFreeCamera",function(){return th}),c.d(s,"Collider",function(){return Fy}),c.d(s,"DefaultCollisionCoordinator",function(){return By}),c.d(s,"PickingInfo",function(){return Ia.a}),c.d(s,"IntersectionInfo",function(){return yI.a}),c.d(s,"_MeshCollisionData",function(){return TI.a}),c.d(s,"BoundingBox",function(){return Np.a}),c.d(s,"BoundingInfo",function(){return Ho.a}),c.d(s,"BoundingSphere",function(){return Uy.a}),c.d(s,"Octree",function(){return Jc}),c.d(s,"OctreeBlock",function(){return Vy}),c.d(s,"OctreeSceneComponent",function(){return kp}),c.d(s,"Ray",function(){return Qn.a}),c.d(s,"AxesViewer",function(){return Da.AxesViewer}),c.d(s,"BoneAxesViewer",function(){return Da.BoneAxesViewer}),c.d(s,"DebugLayerTab",function(){return Da.DebugLayerTab}),c.d(s,"DebugLayer",function(){return Da.DebugLayer}),c.d(s,"PhysicsViewer",function(){return Da.PhysicsViewer}),c.d(s,"RayHelper",function(){return Da.RayHelper}),c.d(s,"SkeletonViewer",function(){return Da.SkeletonViewer}),c.d(s,"DeviceInputSystem",function(){return ky}),c.d(s,"DeviceType",function(){return En}),c.d(s,"PointerInput",function(){return Fp}),c.d(s,"DualShockInput",function(){return Bp}),c.d(s,"XboxInput",function(){return Up}),c.d(s,"SwitchInput",function(){return Vp}),c.d(s,"DeviceSource",function(){return jy}),c.d(s,"DeviceSourceManager",function(){return EI}),c.d(s,"Constants",function(){return g.a}),c.d(s,"ThinEngine",function(){return en.a}),c.d(s,"Engine",function(){return Ge.a}),c.d(s,"EngineStore",function(){return ne.a}),c.d(s,"NullEngineOptions",function(){return zy.b}),c.d(s,"NullEngine",function(){return zy.a}),c.d(s,"_OcclusionDataStorage",function(){return Hy}),c.d(s,"_forceTransformFeedbackToBundle",function(){return SI}),c.d(s,"EngineView",function(){return xI}),c.d(s,"WebGLPipelineContext",function(){return PI.a}),c.d(s,"WebGL2ShaderProcessor",function(){return Wy.a}),c.d(s,"NativeEngine",function(){return II}),c.d(s,"ShaderCodeInliner",function(){return zp}),c.d(s,"PerformanceConfigurator",function(){return DI.a}),c.d(s,"KeyboardEventTypes",function(){return no.a}),c.d(s,"KeyboardInfo",function(){return no.b}),c.d(s,"KeyboardInfoPre",function(){return no.c}),c.d(s,"PointerEventTypes",function(){return Ot.a}),c.d(s,"PointerInfoBase",function(){return Ot.c}),c.d(s,"PointerInfoPre",function(){return Ot.d}),c.d(s,"PointerInfo",function(){return Ot.b}),c.d(s,"ClipboardEventTypes",function(){return oh}),c.d(s,"ClipboardInfo",function(){return wI}),c.d(s,"DaydreamController",function(){return Hp}),c.d(s,"GearVRController",function(){return Wp}),c.d(s,"GenericController",function(){return ah}),c.d(s,"OculusTouchController",function(){return Xp}),c.d(s,"PoseEnabledControllerType",function(){return Zr}),c.d(s,"PoseEnabledControllerHelper",function(){return ji}),c.d(s,"PoseEnabledController",function(){return we}),c.d(s,"ViveController",function(){return Qy}),c.d(s,"WebVRController",function(){return zo}),c.d(s,"WindowsMotionController",function(){return sh}),c.d(s,"XRWindowsMotionController",function(){return NI}),c.d(s,"StickValues",function(){return Pp}),c.d(s,"Gamepad",function(){return Gn}),c.d(s,"GenericPad",function(){return Ku}),c.d(s,"GamepadManager",function(){return gn}),c.d(s,"GamepadSystemSceneComponent",function(){return Mn}),c.d(s,"Xbox360Button",function(){return br}),c.d(s,"Xbox360Dpad",function(){return ki}),c.d(s,"Xbox360Pad",function(){return xt}),c.d(s,"DualShockButton",function(){return ze}),c.d(s,"DualShockDpad",function(){return Je}),c.d(s,"DualShockPad",function(){return tn}),c.d(s,"AxisDragGizmo",function(){return ch.a}),c.d(s,"AxisScaleGizmo",function(){return nl}),c.d(s,"BoundingBoxGizmo",function(){return qy}),c.d(s,"Gizmo",function(){return jr.a}),c.d(s,"GizmoManager",function(){return FI}),c.d(s,"PlaneRotationGizmo",function(){return lh}),c.d(s,"PositionGizmo",function(){return $y}),c.d(s,"RotationGizmo",function(){return Zy}),c.d(s,"ScaleGizmo",function(){return Jy}),c.d(s,"LightGizmo",function(){return BI}),c.d(s,"CameraGizmo",function(){return VI}),c.d(s,"PlaneDragGizmo",function(){return uh}),c.d(s,"EnvironmentHelper",function(){return $p}),c.d(s,"PhotoDome",function(){return ZI}),c.d(s,"_forceSceneHelpersToBundle",function(){return zD}),c.d(s,"VideoDome",function(){return GD}),c.d(s,"EngineInstrumentation",function(){return HD}),c.d(s,"SceneInstrumentation",function(){return WD}),c.d(s,"_TimeToken",function(){return Gy}),c.d(s,"EffectLayer",function(){return ul}),c.d(s,"EffectLayerSceneComponent",function(){return _0}),c.d(s,"GlowLayer",function(){return bh}),c.d(s,"HighlightLayer",function(){return am}),c.d(s,"Layer",function(){return JD}),c.d(s,"LayerSceneComponent",function(){return v0}),c.d(s,"LensFlare",function(){return b0}),c.d(s,"LensFlareSystem",function(){return sm}),c.d(s,"LensFlareSystemSceneComponent",function(){return y0}),c.d(s,"Light",function(){return uo.a}),c.d(s,"ShadowLight",function(){return hh}),c.d(s,"ShadowGenerator",function(){return Hr}),c.d(s,"CascadedShadowGenerator",function(){return cm}),c.d(s,"ShadowGeneratorSceneComponent",function(){return C0}),c.d(s,"DirectionalLight",function(){return Kp}),c.d(s,"HemisphericLight",function(){return eh.a}),c.d(s,"PointLight",function(){return lm}),c.d(s,"SpotLight",function(){return Qp}),c.d(s,"DefaultLoadingScreen",function(){return R0}),c.d(s,"_BabylonLoaderRegistered",function(){return vw}),c.d(s,"BabylonFileLoaderConfiguration",function(){return xh}),c.d(s,"SceneLoaderAnimationGroupLoadingMode",function(){return co}),c.d(s,"SceneLoader",function(){return an}),c.d(s,"SceneLoaderFlags",function(){return lo.a}),c.d(s,"BackgroundMaterial",function(){return il}),c.d(s,"ColorCurves",function(){return yw.a}),c.d(s,"EffectFallbacks",function(){return Ts.a}),c.d(s,"Effect",function(){return Ye.a}),c.d(s,"FresnelParameters",function(){return k0}),c.d(s,"ImageProcessingConfigurationDefines",function(){return fr.b}),c.d(s,"ImageProcessingConfiguration",function(){return fr.a}),c.d(s,"Material",function(){return pn.a}),c.d(s,"MaterialDefines",function(){return fh.a}),c.d(s,"ThinMaterialHelper",function(){return j0.a}),c.d(s,"MaterialHelper",function(){return lt.a}),c.d(s,"MultiMaterial",function(){return wa.a}),c.d(s,"PBRMaterialDefines",function(){return em}),c.d(s,"PBRBaseMaterial",function(){return nr}),c.d(s,"PBRBaseSimpleMaterial",function(){return pm}),c.d(s,"PBRMaterial",function(){return sl}),c.d(s,"PBRMetallicRoughnessMaterial",function(){return z0}),c.d(s,"PBRSpecularGlossinessMaterial",function(){return G0}),c.d(s,"PushMaterial",function(){return ph.a}),c.d(s,"ShaderMaterial",function(){return Ah.a}),c.d(s,"StandardMaterialDefines",function(){return on.b}),c.d(s,"StandardMaterial",function(){return on.a}),c.d(s,"BaseTexture",function(){return $r.a}),c.d(s,"ColorGradingTexture",function(){return H0}),c.d(s,"CubeTexture",function(){return Ei}),c.d(s,"DynamicTexture",function(){return io.a}),c.d(s,"EquiRectangularCubeTexture",function(){return W0}),c.d(s,"HDRFiltering",function(){return D0}),c.d(s,"HDRCubeTexture",function(){return Th}),c.d(s,"HtmlElementTexture",function(){return Tw}),c.d(s,"InternalTextureSource",function(){return Nt.b}),c.d(s,"InternalTexture",function(){return Nt.a}),c.d(s,"_DDSTextureLoader",function(){return i0}),c.d(s,"_ENVTextureLoader",function(){return o0}),c.d(s,"_KTXTextureLoader",function(){return a0}),c.d(s,"_TGATextureLoader",function(){return X0}),c.d(s,"_BasisTextureLoader",function(){return Y0}),c.d(s,"MirrorTexture",function(){return Zp}),c.d(s,"MultiRenderTarget",function(){return mm}),c.d(s,"TexturePacker",function(){return xw}),c.d(s,"TexturePackerFrame",function(){return _m}),c.d(s,"CustomProceduralTexture",function(){return Pw}),c.d(s,"NoiseProceduralTexture",function(){return Q0}),c.d(s,"ProceduralTexture",function(){return fl}),c.d(s,"ProceduralTextureSceneComponent",function(){return K0}),c.d(s,"RawCubeTexture",function(){return Rw}),c.d(s,"RawTexture",function(){return Pr}),c.d(s,"RawTexture2DArray",function(){return Ow}),c.d(s,"RawTexture3D",function(){return Mw}),c.d(s,"RefractionTexture",function(){return Iw}),c.d(s,"RenderTargetTexture",function(){return qn}),c.d(s,"Texture",function(){return ke.a}),c.d(s,"VideoTexture",function(){return m0}),c.d(s,"UniformBuffer",function(){return Cy.a}),c.d(s,"MaterialFlags",function(){return bt.a}),c.d(s,"NodeMaterialBlockTargets",function(){return Me}),c.d(s,"NodeMaterialBlockConnectionPointTypes",function(){return fe}),c.d(s,"NodeMaterialBlockConnectionPointMode",function(){return cr}),c.d(s,"NodeMaterialSystemValues",function(){return Mt}),c.d(s,"NodeMaterialModes",function(){return Dr}),c.d(s,"NodeMaterialConnectionPointCompatibilityStates",function(){return Ai}),c.d(s,"NodeMaterialConnectionPointDirection",function(){return yr}),c.d(s,"NodeMaterialConnectionPoint",function(){return Ch}),c.d(s,"NodeMaterialBlock",function(){return Et}),c.d(s,"NodeMaterialDefines",function(){return gl}),c.d(s,"NodeMaterial",function(){return Dh}),c.d(s,"VertexOutputBlock",function(){return pl}),c.d(s,"BonesBlock",function(){return eT}),c.d(s,"InstancesBlock",function(){return tT}),c.d(s,"MorphTargetsBlock",function(){return nT}),c.d(s,"LightInformationBlock",function(){return rT}),c.d(s,"FragmentOutputBlock",function(){return Is}),c.d(s,"ImageProcessingBlock",function(){return iT}),c.d(s,"PerturbNormalBlock",function(){return oT}),c.d(s,"DiscardBlock",function(){return aT}),c.d(s,"FrontFacingBlock",function(){return sT}),c.d(s,"DerivativeBlock",function(){return cT}),c.d(s,"FragCoordBlock",function(){return lT}),c.d(s,"ScreenSizeBlock",function(){return uT}),c.d(s,"FogBlock",function(){return hT}),c.d(s,"LightBlock",function(){return dT}),c.d(s,"TextureBlock",function(){return fT}),c.d(s,"ReflectionTextureBlock",function(){return pT}),c.d(s,"CurrentScreenBlock",function(){return vm}),c.d(s,"InputBlock",function(){return Bt}),c.d(s,"AnimatedInputBlockTypes",function(){return Ko}),c.d(s,"MultiplyBlock",function(){return Oh}),c.d(s,"AddBlock",function(){return mT}),c.d(s,"ScaleBlock",function(){return _T}),c.d(s,"ClampBlock",function(){return gT}),c.d(s,"CrossBlock",function(){return vT}),c.d(s,"DotBlock",function(){return bT}),c.d(s,"TransformBlock",function(){return Rh}),c.d(s,"RemapBlock",function(){return Em}),c.d(s,"NormalizeBlock",function(){return yT}),c.d(s,"TrigonometryBlockOperations",function(){return Un}),c.d(s,"TrigonometryBlock",function(){return Om}),c.d(s,"ColorMergerBlock",function(){return TT}),c.d(s,"VectorMergerBlock",function(){return ml}),c.d(s,"ColorSplitterBlock",function(){return Rm}),c.d(s,"VectorSplitterBlock",function(){return ET}),c.d(s,"LerpBlock",function(){return ST}),c.d(s,"DivideBlock",function(){return xT}),c.d(s,"SubtractBlock",function(){return AT}),c.d(s,"StepBlock",function(){return PT}),c.d(s,"OneMinusBlock",function(){return Dm}),c.d(s,"ViewDirectionBlock",function(){return wm}),c.d(s,"FresnelBlock",function(){return CT}),c.d(s,"MaxBlock",function(){return RT}),c.d(s,"MinBlock",function(){return OT}),c.d(s,"DistanceBlock",function(){return MT}),c.d(s,"LengthBlock",function(){return IT}),c.d(s,"NegateBlock",function(){return DT}),c.d(s,"PowBlock",function(){return wT}),c.d(s,"RandomNumberBlock",function(){return LT}),c.d(s,"ArcTan2Block",function(){return NT}),c.d(s,"SmoothStepBlock",function(){return FT}),c.d(s,"ReciprocalBlock",function(){return BT}),c.d(s,"ReplaceColorBlock",function(){return UT}),c.d(s,"PosterizeBlock",function(){return VT}),c.d(s,"WaveBlockKind",function(){return La}),c.d(s,"WaveBlock",function(){return kT}),c.d(s,"GradientBlockColorStep",function(){return wh}),c.d(s,"GradientBlock",function(){return jT}),c.d(s,"NLerpBlock",function(){return zT}),c.d(s,"WorleyNoise3DBlock",function(){return GT}),c.d(s,"SimplexPerlin3DBlock",function(){return HT}),c.d(s,"NormalBlendBlock",function(){return WT}),c.d(s,"Rotate2dBlock",function(){return XT}),c.d(s,"ReflectBlock",function(){return YT}),c.d(s,"RefractBlock",function(){return KT}),c.d(s,"DesaturateBlock",function(){return QT}),c.d(s,"PBRMetallicRoughnessBlock",function(){return qT}),c.d(s,"SheenBlock",function(){return Lm}),c.d(s,"AnisotropyBlock",function(){return Nm}),c.d(s,"ReflectionBlock",function(){return Fm}),c.d(s,"ClearCoatBlock",function(){return Lh}),c.d(s,"RefractionBlock",function(){return Bm}),c.d(s,"SubSurfaceBlock",function(){return Nh}),c.d(s,"ParticleTextureBlock",function(){return bm}),c.d(s,"ParticleRampGradientBlock",function(){return ym}),c.d(s,"ParticleBlendMultiplyBlock",function(){return Tm}),c.d(s,"ModBlock",function(){return ZT}),c.d(s,"NodeMaterialOptimizer",function(){return Fw}),c.d(s,"PropertyTypeForEdition",function(){return $t}),c.d(s,"editableInPropertyPage",function(){return sn}),c.d(s,"EffectRenderer",function(){return M0}),c.d(s,"EffectWrapper",function(){return I0}),c.d(s,"ShadowDepthWrapper",function(){return Vw}),c.d(s,"Scalar",function(){return te.a}),c.d(s,"extractMinAndMaxIndexed",function(){return $T.b}),c.d(s,"extractMinAndMax",function(){return $T.a}),c.d(s,"Space",function(){return Se.c}),c.d(s,"Axis",function(){return Se.a}),c.d(s,"Coordinate",function(){return Se.b}),c.d(s,"Color3",function(){return M.a}),c.d(s,"Color4",function(){return M.b}),c.d(s,"TmpColors",function(){return M.c}),c.d(s,"ToGammaSpace",function(){return Zt.b}),c.d(s,"ToLinearSpace",function(){return Zt.c}),c.d(s,"Epsilon",function(){return Zt.a}),c.d(s,"Frustum",function(){return Oy.a}),c.d(s,"Orientation",function(){return nt.e}),c.d(s,"BezierCurve",function(){return nt.c}),c.d(s,"Angle",function(){return nt.a}),c.d(s,"Arc2",function(){return nt.b}),c.d(s,"Path2",function(){return nt.f}),c.d(s,"Path3D",function(){return nt.g}),c.d(s,"Curve3",function(){return nt.d}),c.d(s,"Plane",function(){return _s.a}),c.d(s,"Size",function(){return le.a}),c.d(s,"Vector2",function(){return d.d}),c.d(s,"Vector3",function(){return d.e}),c.d(s,"Vector4",function(){return d.f}),c.d(s,"Quaternion",function(){return d.b}),c.d(s,"Matrix",function(){return d.a}),c.d(s,"TmpVectors",function(){return d.c}),c.d(s,"PositionNormalVertex",function(){return qp}),c.d(s,"PositionNormalTextureVertex",function(){return UI}),c.d(s,"Viewport",function(){return li.a}),c.d(s,"SphericalHarmonics",function(){return jp}),c.d(s,"SphericalPolynomial",function(){return tl}),c.d(s,"AbstractMesh",function(){return jt.a}),c.d(s,"Buffer",function(){return De.a}),c.d(s,"VertexBuffer",function(){return De.b}),c.d(s,"DracoCompression",function(){return jw}),c.d(s,"CSG",function(){return Hw}),c.d(s,"Geometry",function(){return um.a}),c.d(s,"GroundMesh",function(){return rh}),c.d(s,"TrailMesh",function(){return Ww}),c.d(s,"InstancedMesh",function(){return Xw.a}),c.d(s,"LinesMesh",function(){return bl.b}),c.d(s,"InstancedLinesMesh",function(){return bl.a}),c.d(s,"_CreationDataStorage",function(){return Ne.b}),c.d(s,"_InstancesBatch",function(){return Ne.c}),c.d(s,"Mesh",function(){return Ne.a}),c.d(s,"VertexData",function(){return Tt.a}),c.d(s,"MeshBuilder",function(){return Qw}),c.d(s,"SimplificationSettings",function(){return qw}),c.d(s,"SimplificationQueue",function(){return iE}),c.d(s,"SimplificationType",function(){return El}),c.d(s,"QuadraticErrorSimplification",function(){return aE}),c.d(s,"SimplicationQueueSceneComponent",function(){return sE}),c.d(s,"Polygon",function(){return Kw}),c.d(s,"PolygonMeshBuilder",function(){return nE}),c.d(s,"SubMesh",function(){return vl.a}),c.d(s,"MeshLODLevel",function(){return eL.a}),c.d(s,"TransformNode",function(){return ys.a}),c.d(s,"BoxBuilder",function(){return bs.a}),c.d(s,"TiledBoxBuilder",function(){return tE}),c.d(s,"DiscBuilder",function(){return Fh}),c.d(s,"RibbonBuilder",function(){return yl.a}),c.d(s,"SphereBuilder",function(){return zr.a}),c.d(s,"HemisphereBuilder",function(){return dh}),c.d(s,"CylinderBuilder",function(){return zi.a}),c.d(s,"TorusBuilder",function(){return ms}),c.d(s,"TorusKnotBuilder",function(){return km}),c.d(s,"LinesBuilder",function(){return Jn.a}),c.d(s,"PolygonBuilder",function(){return Tl}),c.d(s,"ShapeBuilder",function(){return Sh.a}),c.d(s,"LatheBuilder",function(){return zm}),c.d(s,"PlaneBuilder",function(){return Yp.a}),c.d(s,"TiledPlaneBuilder",function(){return rE}),c.d(s,"GroundBuilder",function(){return Go}),c.d(s,"TubeBuilder",function(){return Gm}),c.d(s,"PolyhedronBuilder",function(){return rl}),c.d(s,"IcoSphereBuilder",function(){return Hm}),c.d(s,"DecalBuilder",function(){return Wm}),c.d(s,"CapsuleBuilder",function(){return Xm}),c.d(s,"DataBuffer",function(){return Xy.a}),c.d(s,"WebGLDataBuffer",function(){return tL.a}),c.d(s,"MorphTarget",function(){return w0}),c.d(s,"MorphTargetManager",function(){return Eh}),c.d(s,"RecastJSPlugin",function(){return nL}),c.d(s,"RecastJSCrowd",function(){return cE}),c.d(s,"Node",function(){return $.a}),c.d(s,"Database",function(){return lE}),c.d(s,"BaseParticleSystem",function(){return _l}),c.d(s,"BoxParticleEmitter",function(){return Ds}),c.d(s,"ConeParticleEmitter",function(){return Sm}),c.d(s,"CylinderParticleEmitter",function(){return Mh}),c.d(s,"CylinderDirectedParticleEmitter",function(){return xm}),c.d(s,"HemisphericParticleEmitter",function(){return Am}),c.d(s,"PointParticleEmitter",function(){return Pm}),c.d(s,"SphereParticleEmitter",function(){return Ih}),c.d(s,"SphereDirectedParticleEmitter",function(){return Cm}),c.d(s,"CustomParticleEmitter",function(){return ws}),c.d(s,"MeshParticleEmitter",function(){return $0}),c.d(s,"GPUParticleSystem",function(){return Na}),c.d(s,"Particle",function(){return hE}),c.d(s,"ParticleHelper",function(){return uL}),c.d(s,"ParticleSystem",function(){return er}),c.d(s,"ParticleSystemSet",function(){return Bh}),c.d(s,"SolidParticle",function(){return Qm}),c.d(s,"ModelShape",function(){return qm}),c.d(s,"DepthSortedParticle",function(){return dE}),c.d(s,"SolidParticleVertex",function(){return fE}),c.d(s,"SolidParticleSystem",function(){return hL}),c.d(s,"CloudPoint",function(){return pE}),c.d(s,"PointsGroup",function(){return Uh}),c.d(s,"PointColor",function(){return Tr}),c.d(s,"PointsCloudSystem",function(){return dL}),c.d(s,"SubEmitterType",function(){return Ls}),c.d(s,"SubEmitter",function(){return Sl}),c.d(s,"PhysicsEngine",function(){return Os}),c.d(s,"PhysicsEngineSceneComponent",function(){return mE}),c.d(s,"PhysicsHelper",function(){return fL}),c.d(s,"PhysicsRadialExplosionEventOptions",function(){return Fs}),c.d(s,"PhysicsUpdraftEventOptions",function(){return Zm}),c.d(s,"PhysicsVortexEventOptions",function(){return $m}),c.d(s,"PhysicsRadialImpulseFalloff",function(){return xl}),c.d(s,"PhysicsUpdraftMode",function(){return Ns}),c.d(s,"PhysicsImpostor",function(){return Ut.a}),c.d(s,"PhysicsJoint",function(){return Fn.e}),c.d(s,"DistanceJoint",function(){return Fn.a}),c.d(s,"MotorEnabledJoint",function(){return Fn.d}),c.d(s,"HingeJoint",function(){return Fn.c}),c.d(s,"Hinge2Joint",function(){return Fn.b}),c.d(s,"CannonJSPlugin",function(){return fm}),c.d(s,"AmmoJSPlugin",function(){return N0}),c.d(s,"OimoJSPlugin",function(){return L0}),c.d(s,"AnaglyphPostProcess",function(){return Rp}),c.d(s,"BlackAndWhitePostProcess",function(){return gE}),c.d(s,"BloomEffect",function(){return t_}),c.d(s,"BloomMergePostProcess",function(){return e_}),c.d(s,"BlurPostProcess",function(){return ar}),c.d(s,"ChromaticAberrationPostProcess",function(){return n_}),c.d(s,"CircleOfConfusionPostProcess",function(){return r_}),c.d(s,"ColorCorrectionPostProcess",function(){return vE}),c.d(s,"ConvolutionPostProcess",function(){return bE}),c.d(s,"DepthOfFieldBlurPostProcess",function(){return Vh}),c.d(s,"DepthOfFieldEffectBlurLevel",function(){return Fa}),c.d(s,"DepthOfFieldEffect",function(){return i_}),c.d(s,"DepthOfFieldMergePostProcessOptions",function(){return AL}),c.d(s,"DepthOfFieldMergePostProcess",function(){return yE}),c.d(s,"DisplayPassPostProcess",function(){return TE}),c.d(s,"ExtractHighlightsPostProcess",function(){return Jm}),c.d(s,"FilterPostProcess",function(){return EE}),c.d(s,"FxaaPostProcess",function(){return Al}),c.d(s,"GrainPostProcess",function(){return o_}),c.d(s,"HighlightsPostProcess",function(){return DL}),c.d(s,"ImageProcessingPostProcess",function(){return nh}),c.d(s,"MotionBlurPostProcess",function(){return a_}),c.d(s,"PassPostProcess",function(){return jo}),c.d(s,"PassCubePostProcess",function(){return fI}),c.d(s,"PostProcess",function(){return St}),c.d(s,"PostProcessManager",function(){return Mp.a}),c.d(s,"RefractionPostProcess",function(){return xE}),c.d(s,"DefaultRenderingPipeline",function(){return CE}),c.d(s,"LensRenderingPipeline",function(){return jL}),c.d(s,"SSAO2RenderingPipeline",function(){return RE}),c.d(s,"SSAORenderingPipeline",function(){return XL}),c.d(s,"StandardRenderingPipeline",function(){return OE}),c.d(s,"PostProcessRenderEffect",function(){return Yt}),c.d(s,"PostProcessRenderPipeline",function(){return Bs}),c.d(s,"PostProcessRenderPipelineManager",function(){return AE}),c.d(s,"PostProcessRenderPipelineManagerSceneComponent",function(){return PE}),c.d(s,"SharpenPostProcess",function(){return s_}),c.d(s,"StereoscopicInterlacePostProcessI",function(){return ZL}),c.d(s,"StereoscopicInterlacePostProcess",function(){return $L}),c.d(s,"TonemappingOperator",function(){return Ba}),c.d(s,"TonemapPostProcess",function(){return eN}),c.d(s,"VolumetricLightScatteringPostProcess",function(){return ME}),c.d(s,"VRDistortionCorrectionPostProcess",function(){return Op}),c.d(s,"VRMultiviewToSingleviewPostProcess",function(){return Ip}),c.d(s,"ScreenSpaceReflectionPostProcess",function(){return c_}),c.d(s,"ScreenSpaceCurvaturePostProcess",function(){return IE}),c.d(s,"ReflectionProbe",function(){return F0}),c.d(s,"BoundingBoxRenderer",function(){return DE}),c.d(s,"DepthRenderer",function(){return yh}),c.d(s,"DepthRendererSceneComponent",function(){return wE}),c.d(s,"EdgesRenderer",function(){return l_}),c.d(s,"LineEdgesRenderer",function(){return LE}),c.d(s,"GeometryBufferRenderer",function(){return Pi}),c.d(s,"GeometryBufferRendererSceneComponent",function(){return SE}),c.d(s,"PrePassRenderer",function(){return u_}),c.d(s,"PrePassRendererSceneComponent",function(){return NE}),c.d(s,"SubSurfaceSceneComponent",function(){return BE}),c.d(s,"OutlineRenderer",function(){return UE}),c.d(s,"RenderingGroup",function(){return fN.a}),c.d(s,"RenderingGroupInfo",function(){return $c.a}),c.d(s,"RenderingManager",function(){return $c.b}),c.d(s,"UtilityLayerRenderer",function(){return Ir.a}),c.d(s,"Scene",function(){return he.a}),c.d(s,"SceneComponentConstants",function(){return dt.a}),c.d(s,"Stage",function(){return dt.b}),c.d(s,"Sprite",function(){return VE}),c.d(s,"SpriteManager",function(){return jE}),c.d(s,"SpriteMap",function(){return bN}),c.d(s,"SpritePackedManager",function(){return yN}),c.d(s,"SpriteSceneComponent",function(){return kE}),c.d(s,"AlphaState",function(){return TN.a}),c.d(s,"DepthCullingState",function(){return EN.a}),c.d(s,"StencilState",function(){return SN.a}),c.d(s,"AndOrNotEvaluator",function(){return xN.a}),c.d(s,"AssetTaskState",function(){return Hi}),c.d(s,"AbstractAssetTask",function(){return Wi}),c.d(s,"AssetsProgressEvent",function(){return zE}),c.d(s,"ContainerAssetTask",function(){return GE}),c.d(s,"MeshAssetTask",function(){return HE}),c.d(s,"TextFileAssetTask",function(){return WE}),c.d(s,"BinaryFileAssetTask",function(){return XE}),c.d(s,"ImageAssetTask",function(){return YE}),c.d(s,"TextureAssetTask",function(){return KE}),c.d(s,"CubeTextureAssetTask",function(){return QE}),c.d(s,"HDRCubeTextureAssetTask",function(){return qE}),c.d(s,"EquiRectangularCubeTextureAssetTask",function(){return ZE}),c.d(s,"AssetsManager",function(){return AN}),c.d(s,"BasisTranscodeConfiguration",function(){return Ew}),c.d(s,"BasisTools",function(){return dl}),c.d(s,"DDSTools",function(){return Xo}),c.d(s,"expandToProperty",function(){return B.b}),c.d(s,"serialize",function(){return B.c}),c.d(s,"serializeAsTexture",function(){return B.m}),c.d(s,"serializeAsColor3",function(){return B.e}),c.d(s,"serializeAsFresnelParameters",function(){return B.h}),c.d(s,"serializeAsVector2",function(){return B.n}),c.d(s,"serializeAsVector3",function(){return B.o}),c.d(s,"serializeAsMeshReference",function(){return B.k}),c.d(s,"serializeAsColorCurves",function(){return B.g}),c.d(s,"serializeAsColor4",function(){return B.f}),c.d(s,"serializeAsImageProcessingConfiguration",function(){return B.i}),c.d(s,"serializeAsQuaternion",function(){return B.l}),c.d(s,"serializeAsMatrix",function(){return B.j}),c.d(s,"serializeAsCameraReference",function(){return B.d}),c.d(s,"SerializationHelper",function(){return B.a}),c.d(s,"Deferred",function(){return PN}),c.d(s,"EnvironmentTextureTools",function(){return so}),c.d(s,"MeshExploder",function(){return CN}),c.d(s,"FilesInput",function(){return RN}),c.d(s,"CubeMapToSphericalPolynomialTools",function(){return ih}),c.d(s,"HDRTools",function(){return O0}),c.d(s,"PanoramaToCubeMapTools",function(){return hm}),c.d(s,"KhronosTextureContainer",function(){return vh}),c.d(s,"EventState",function(){return S.a}),c.d(s,"Observer",function(){return S.d}),c.d(s,"MultiObserver",function(){return S.b}),c.d(s,"Observable",function(){return S.c}),c.d(s,"PerformanceMonitor",function(){return $E.a}),c.d(s,"RollingAverage",function(){return $E.b}),c.d(s,"PromisePolyfill",function(){return ON.a}),c.d(s,"SceneOptimization",function(){return Xi}),c.d(s,"TextureOptimization",function(){return kh}),c.d(s,"HardwareScalingOptimization",function(){return d_}),c.d(s,"ShadowsOptimization",function(){return jh}),c.d(s,"PostProcessesOptimization",function(){return zh}),c.d(s,"LensFlaresOptimization",function(){return Gh}),c.d(s,"CustomOptimization",function(){return JE}),c.d(s,"ParticlesOptimization",function(){return Hh}),c.d(s,"RenderTargetsOptimization",function(){return f_}),c.d(s,"MergeMeshesOptimization",function(){return Wh}),c.d(s,"SceneOptimizerOptions",function(){return p_}),c.d(s,"SceneOptimizer",function(){return MN}),c.d(s,"SceneSerializer",function(){return __}),c.d(s,"SmartArray",function(){return Hn.a}),c.d(s,"SmartArrayNoDuplicate",function(){return Hn.b}),c.d(s,"StringDictionary",function(){return qu.a}),c.d(s,"Tags",function(){return IN.a}),c.d(s,"TextureTools",function(){return DN}),c.d(s,"TGATools",function(){return Ph}),c.d(s,"Tools",function(){return et.b}),c.d(s,"className",function(){return et.c}),c.d(s,"AsyncLoop",function(){return et.a}),c.d(s,"VideoRecorder",function(){return wN}),c.d(s,"JoystickAxis",function(){return Nn}),c.d(s,"VirtualJoystick",function(){return Kc}),c.d(s,"WorkerPool",function(){return nm}),c.d(s,"Logger",function(){return _.a}),c.d(s,"_TypeStore",function(){return C.a}),c.d(s,"FilesInputStore",function(){return Gp.a}),c.d(s,"DeepCopier",function(){return ge.a}),c.d(s,"PivotTools",function(){return Mr.a}),c.d(s,"PrecisionDate",function(){return be.a}),c.d(s,"ScreenshotTools",function(){return Pl}),c.d(s,"WebRequest",function(){return se.a}),c.d(s,"InspectableType",function(){return h_}),c.d(s,"BRDFTextureTools",function(){return mh}),c.d(s,"RGBDTextureTools",function(){return e0}),c.d(s,"ColorGradient",function(){return Ym}),c.d(s,"Color3Gradient",function(){return uE}),c.d(s,"FactorGradient",function(){return Km}),c.d(s,"GradientHelper",function(){return wr}),c.d(s,"PerfCounter",function(){return Jr.a}),c.d(s,"RetryStrategy",function(){return LN.a}),c.d(s,"CanvasGenerator",function(){return Dp.a}),c.d(s,"LoadFileError",function(){return el.b}),c.d(s,"RequestFileError",function(){return el.d}),c.d(s,"ReadFileError",function(){return el.c}),c.d(s,"FileTools",function(){return el.a}),c.d(s,"StringTools",function(){return ui.a}),c.d(s,"DataReader",function(){return NN}),c.d(s,"MinMaxReducer",function(){return S0}),c.d(s,"DepthReducer",function(){return x0}),c.d(s,"DataStorage",function(){return FN}),c.d(s,"SceneRecorder",function(){return BN}),c.d(s,"KhronosTextureContainer2",function(){return rm}),c.d(s,"Trajectory",function(){return UN}),c.d(s,"TrajectoryClassifier",function(){return VN}),c.d(s,"TimerState",function(){return Yo}),c.d(s,"setAndStartTimer",function(){return om}),c.d(s,"AdvancedTimer",function(){return kD}),c.d(s,"CopyTools",function(){return kN.a}),c.d(s,"WebXRCamera",function(){return s0}),c.d(s,"WebXREnterExitUIButton",function(){return d0}),c.d(s,"WebXREnterExitUIOptions",function(){return VD}),c.d(s,"WebXREnterExitUI",function(){return f0}),c.d(s,"WebXRExperienceHelper",function(){return c0}),c.d(s,"WebXRInput",function(){return h0}),c.d(s,"WebXRInputSource",function(){return u0}),c.d(s,"WebXRManagedOutputCanvasOptions",function(){return wp}),c.d(s,"WebXRManagedOutputCanvas",function(){return Dy}),c.d(s,"WebXRState",function(){return tr}),c.d(s,"WebXRTrackingState",function(){return Ma}),c.d(s,"WebXRSessionManager",function(){return Lp}),c.d(s,"WebXRDefaultExperienceOptions",function(){return jD}),c.d(s,"WebXRDefaultExperience",function(){return p0}),c.d(s,"WebXRFeatureName",function(){return Si}),c.d(s,"WebXRFeaturesManager",function(){return hi}),c.d(s,"WebXRAbstractFeature",function(){return xi}),c.d(s,"WebXRHitTestLegacy",function(){return Yh}),c.d(s,"WebXRAnchorSystem",function(){return Kh}),c.d(s,"WebXRPlaneDetector",function(){return Qh}),c.d(s,"WebXRBackgroundRemover",function(){return qh}),c.d(s,"WebXRMotionControllerTeleportation",function(){return ll}),c.d(s,"WebXRControllerPointerSelection",function(){return cl}),c.d(s,"IWebXRControllerPhysicsOptions",function(){return GN}),c.d(s,"WebXRControllerPhysics",function(){return Zh}),c.d(s,"WebXRHitTest",function(){return $h}),c.d(s,"WebXRFeaturePointSystem",function(){return Jh}),c.d(s,"WebXRHand",function(){return rS}),c.d(s,"WebXRHandTracking",function(){return ed}),c.d(s,"WebXRAbstractMotionController",function(){return Ps}),c.d(s,"WebXRControllerComponent",function(){return As}),c.d(s,"WebXRGenericTriggerMotionController",function(){return im}),c.d(s,"WebXRMicrosoftMixedRealityController",function(){return iS}),c.d(s,"WebXRMotionControllerManager",function(){return Gr}),c.d(s,"WebXROculusTouchMotionController",function(){return v_}),c.d(s,"WebXRHTCViveMotionController",function(){return oS}),c.d(s,"WebXRProfiledMotionController",function(){return l0});var E=c(35),m=c(91),S=c(6),d=c(0),M=c(9),C=c(11),I=function(){function i(t,e){this.triggerOptions=t,this.onBeforeExecuteObservable=new S.c,t.parameter?(this.trigger=t.trigger,this._triggerParameter=t.parameter):t.trigger?this.trigger=t.trigger:this.trigger=t,this._nextActiveAction=this,this._condition=e}return i.prototype._prepare=function(){},i.prototype.getTriggerParameter=function(){return this._triggerParameter},i.prototype._executeCurrent=function(t){if(this._nextActiveAction._condition){var e=this._nextActiveAction._condition,n=this._actionManager.getScene().getRenderId();if(e._evaluationId===n){if(!e._currentResult)return}else{if(e._evaluationId=n,!e.isValid())return void(e._currentResult=!1);e._currentResult=!0}}this.onBeforeExecuteObservable.notifyObservers(this),this._nextActiveAction.execute(t),this.skipToNextActiveAction()},i.prototype.execute=function(t){},i.prototype.skipToNextActiveAction=function(){this._nextActiveAction._child?(this._nextActiveAction._child._actionManager||(this._nextActiveAction._child._actionManager=this._actionManager),this._nextActiveAction=this._nextActiveAction._child):this._nextActiveAction=this},i.prototype.then=function(t){return this._child=t,t._actionManager=this._actionManager,t._prepare(),t},i.prototype._getProperty=function(t){return this._actionManager._getProperty(t)},i.prototype._getEffectiveTarget=function(t,e){return this._actionManager._getEffectiveTarget(t,e)},i.prototype.serialize=function(t){},i.prototype._serialize=function(t,e){var n={type:1,children:[],name:t.name,properties:t.properties||[]};if(this._child&&this._child.serialize(n),this._condition){var r=this._condition.serialize();return r.children.push(n),e&&e.children.push(r),r}return e&&e.children.push(n),n},i._SerializeValueAsString=function(t){return typeof t=="number"?t.toString():typeof t=="boolean"?t?"true":"false":t instanceof d.d?t.x+", "+t.y:t instanceof d.e?t.x+", "+t.y+", "+t.z:t instanceof M.a?t.r+", "+t.g+", "+t.b:t instanceof M.b?t.r+", "+t.g+", "+t.b+", "+t.a:t},i._GetTargetProperty=function(t){return{name:"target",targetType:t._isMesh?"MeshProperties":t._isLight?"LightProperties":t._isCamera?"CameraProperties":"SceneProperties",value:t._isScene?"Scene":t.name}},i}();C.a.RegisteredTypes["BABYLON.Action"]=I;var b=c(47),p=c(1),x=function(){function i(t){this._actionManager=t}return i.prototype.isValid=function(){return!0},i.prototype._getProperty=function(t){return this._actionManager._getProperty(t)},i.prototype._getEffectiveTarget=function(t,e){return this._actionManager._getEffectiveTarget(t,e)},i.prototype.serialize=function(){},i.prototype._serialize=function(t){return{type:2,children:[],name:t.name,properties:t.properties}},i}(),P=function(i){function t(e,n,r,o,u){u===void 0&&(u=t.IsEqual);var f=i.call(this,e)||this;return f.propertyPath=r,f.value=o,f.operator=u,f._target=n,f._effectiveTarget=f._getEffectiveTarget(n,f.propertyPath),f._property=f._getProperty(f.propertyPath),f}return Object(p.d)(t,i),Object.defineProperty(t,"IsEqual",{get:function(){return t._IsEqual},enumerable:!1,configurable:!0}),Object.defineProperty(t,"IsDifferent",{get:function(){return t._IsDifferent},enumerable:!1,configurable:!0}),Object.defineProperty(t,"IsGreater",{get:function(){return t._IsGreater},enumerable:!1,configurable:!0}),Object.defineProperty(t,"IsLesser",{get:function(){return t._IsLesser},enumerable:!1,configurable:!0}),t.prototype.isValid=function(){switch(this.operator){case t.IsGreater:return this._effectiveTarget[this._property]>this.value;case t.IsLesser:return this._effectiveTarget[this._property]<this.value;case t.IsEqual:case t.IsDifferent:var e;return e=this.value.equals?this.value.equals(this._effectiveTarget[this._property]):this.value===this._effectiveTarget[this._property],this.operator===t.IsEqual?e:!e}return!1},t.prototype.serialize=function(){return this._serialize({name:"ValueCondition",properties:[I._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:I._SerializeValueAsString(this.value)},{name:"operator",value:t.GetOperatorName(this.operator)}]})},t.GetOperatorName=function(e){switch(e){case t._IsEqual:return"IsEqual";case t._IsDifferent:return"IsDifferent";case t._IsGreater:return"IsGreater";case t._IsLesser:return"IsLesser";default:return""}},t._IsEqual=0,t._IsDifferent=1,t._IsGreater=2,t._IsLesser=3,t}(x),A=function(i){function t(e,n){var r=i.call(this,e)||this;return r.predicate=n,r}return Object(p.d)(t,i),t.prototype.isValid=function(){return this.predicate()},t}(x),T=function(i){function t(e,n,r){var o=i.call(this,e)||this;return o.value=r,o._target=n,o}return Object(p.d)(t,i),t.prototype.isValid=function(){return this._target.state===this.value},t.prototype.serialize=function(){return this._serialize({name:"StateCondition",properties:[I._GetTargetProperty(this._target),{name:"value",value:this.value}]})},t}(x);C.a.RegisteredTypes["BABYLON.ValueCondition"]=P,C.a.RegisteredTypes["BABYLON.PredicateCondition"]=A,C.a.RegisteredTypes["BABYLON.StateCondition"]=T;var _=c(8),g=c(2),O=function(i){function t(e,n,r,o){var u=i.call(this,e,o)||this;return u.propertyPath=r,u._target=u._effectiveTarget=n,u}return Object(p.d)(t,i),t.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath),this._property=this._getProperty(this.propertyPath)},t.prototype.execute=function(){this._effectiveTarget[this._property]=!this._effectiveTarget[this._property]},t.prototype.serialize=function(e){return i.prototype._serialize.call(this,{name:"SwitchBooleanAction",properties:[I._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath}]},e)},t}(I),R=function(i){function t(e,n,r,o){var u=i.call(this,e,o)||this;return u.value=r,u._target=n,u}return Object(p.d)(t,i),t.prototype.execute=function(){this._target.state=this.value},t.prototype.serialize=function(e){return i.prototype._serialize.call(this,{name:"SetStateAction",properties:[I._GetTargetProperty(this._target),{name:"value",value:this.value}]},e)},t}(I),N=function(i){function t(e,n,r,o,u){var f=i.call(this,e,u)||this;return f.propertyPath=r,f.value=o,f._target=f._effectiveTarget=n,f}return Object(p.d)(t,i),t.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath),this._property=this._getProperty(this.propertyPath)},t.prototype.execute=function(){this._effectiveTarget[this._property]=this.value,this._target.markAsDirty&&this._target.markAsDirty(this._property)},t.prototype.serialize=function(e){return i.prototype._serialize.call(this,{name:"SetValueAction",properties:[I._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:I._SerializeValueAsString(this.value)}]},e)},t}(I),V=function(i){function t(e,n,r,o,u){var f=i.call(this,e,u)||this;return f.propertyPath=r,f.value=o,f._target=f._effectiveTarget=n,f}return Object(p.d)(t,i),t.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath),this._property=this._getProperty(this.propertyPath),typeof this._effectiveTarget[this._property]!="number"&&_.a.Warn("Warning: IncrementValueAction can only be used with number values")},t.prototype.execute=function(){this._effectiveTarget[this._property]+=this.value,this._target.markAsDirty&&this._target.markAsDirty(this._property)},t.prototype.serialize=function(e){return i.prototype._serialize.call(this,{name:"IncrementValueAction",properties:[I._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:I._SerializeValueAsString(this.value)}]},e)},t}(I),U=function(i){function t(e,n,r,o,u,f){var v=i.call(this,e,f)||this;return v.from=r,v.to=o,v.loop=u,v._target=n,v}return Object(p.d)(t,i),t.prototype._prepare=function(){},t.prototype.execute=function(){this._actionManager.getScene().beginAnimation(this._target,this.from,this.to,this.loop)},t.prototype.serialize=function(e){return i.prototype._serialize.call(this,{name:"PlayAnimationAction",properties:[I._GetTargetProperty(this._target),{name:"from",value:String(this.from)},{name:"to",value:String(this.to)},{name:"loop",value:I._SerializeValueAsString(this.loop)||!1}]},e)},t}(I),L=function(i){function t(e,n,r){var o=i.call(this,e,r)||this;return o._target=n,o}return Object(p.d)(t,i),t.prototype._prepare=function(){},t.prototype.execute=function(){this._actionManager.getScene().stopAnimation(this._target)},t.prototype.serialize=function(e){return i.prototype._serialize.call(this,{name:"StopAnimationAction",properties:[I._GetTargetProperty(this._target)]},e)},t}(I),j=function(i){function t(e,n){return e===void 0&&(e=g.a.ACTION_NothingTrigger),i.call(this,e,n)||this}return Object(p.d)(t,i),t.prototype.execute=function(){},t.prototype.serialize=function(e){return i.prototype._serialize.call(this,{name:"DoNothingAction",properties:[]},e)},t}(I),Y=function(i){function t(e,n,r){var o=i.call(this,e,r)||this;return o.children=n,o}return Object(p.d)(t,i),t.prototype._prepare=function(){for(var e=0;e<this.children.length;e++)this.children[e]._actionManager=this._actionManager,this.children[e]._prepare()},t.prototype.execute=function(e){for(var n=0;n<this.children.length;n++)this.children[n].execute(e)},t.prototype.serialize=function(e){for(var n=i.prototype._serialize.call(this,{name:"CombineAction",properties:[],combine:[]},e),r=0;r<this.children.length;r++)n.combine.push(this.children[r].serialize(null));return n},t}(I),W=function(i){function t(e,n,r){var o=i.call(this,e,r)||this;return o.func=n,o}return Object(p.d)(t,i),t.prototype.execute=function(e){this.func(e)},t}(I),re=function(i){function t(e,n,r,o){var u=i.call(this,e,o)||this;return u._target=n,u._parent=r,u}return Object(p.d)(t,i),t.prototype._prepare=function(){},t.prototype.execute=function(){if(this._target.parent!==this._parent){var e=this._parent.getWorldMatrix().clone();e.invert(),this._target.position=d.e.TransformCoordinates(this._target.position,e),this._target.parent=this._parent}},t.prototype.serialize=function(e){return i.prototype._serialize.call(this,{name:"SetParentAction",properties:[I._GetTargetProperty(this._target),I._GetTargetProperty(this._parent)]},e)},t}(I);C.a.RegisteredTypes["BABYLON.SetParentAction"]=re,C.a.RegisteredTypes["BABYLON.ExecuteCodeAction"]=W,C.a.RegisteredTypes["BABYLON.DoNothingAction"]=j,C.a.RegisteredTypes["BABYLON.StopAnimationAction"]=L,C.a.RegisteredTypes["BABYLON.PlayAnimationAction"]=U,C.a.RegisteredTypes["BABYLON.IncrementValueAction"]=V,C.a.RegisteredTypes["BABYLON.SetValueAction"]=N,C.a.RegisteredTypes["BABYLON.SetStateAction"]=R,C.a.RegisteredTypes["BABYLON.SetParentAction"]=re;var ne=c(22),ge=c(41),_e=function(i){function t(e){var n=i.call(this)||this;return n._scene=e||ne.a.LastCreatedScene,e.actionManagers.push(n),n}return Object(p.d)(t,i),t.prototype.dispose=function(){for(var e=this._scene.actionManagers.indexOf(this),n=0;n<this.actions.length;n++){var r=this.actions[n];t.Triggers[r.trigger]--,t.Triggers[r.trigger]===0&&delete t.Triggers[r.trigger]}e>-1&&this._scene.actionManagers.splice(e,1)},t.prototype.getScene=function(){return this._scene},t.prototype.hasSpecificTriggers=function(e){for(var n=0;n<this.actions.length;n++){var r=this.actions[n];if(e.indexOf(r.trigger)>-1)return!0}return!1},t.prototype.hasSpecificTriggers2=function(e,n){for(var r=0;r<this.actions.length;r++){var o=this.actions[r];if(e==o.trigger||n==o.trigger)return!0}return!1},t.prototype.hasSpecificTrigger=function(e,n){for(var r=0;r<this.actions.length;r++){var o=this.actions[r];if(o.trigger===e&&(!n||n(o.getTriggerParameter())))return!0}return!1},Object.defineProperty(t.prototype,"hasPointerTriggers",{get:function(){for(var e=0;e<this.actions.length;e++){var n=this.actions[e];if(n.trigger>=t.OnPickTrigger&&n.trigger<=t.OnPointerOutTrigger)return!0}return!1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasPickTriggers",{get:function(){for(var e=0;e<this.actions.length;e++){var n=this.actions[e];if(n.trigger>=t.OnPickTrigger&&n.trigger<=t.OnPickUpTrigger)return!0}return!1},enumerable:!1,configurable:!0}),t.prototype.registerAction=function(e){return e.trigger===t.OnEveryFrameTrigger&&this.getScene().actionManager!==this?(_.a.Warn("OnEveryFrameTrigger can only be used with scene.actionManager"),null):(this.actions.push(e),t.Triggers[e.trigger]?t.Triggers[e.trigger]++:t.Triggers[e.trigger]=1,e._actionManager=this,e._prepare(),e)},t.prototype.unregisterAction=function(e){var n=this.actions.indexOf(e);return n!==-1&&(this.actions.splice(n,1),t.Triggers[e.trigger]-=1,t.Triggers[e.trigger]===0&&delete t.Triggers[e.trigger],e._actionManager=null,!0)},t.prototype.processTrigger=function(e,n){for(var r=0;r<this.actions.length;r++){var o=this.actions[r];if(o.trigger===e){if(n&&(e===t.OnKeyUpTrigger||e===t.OnKeyDownTrigger)){var u=o.getTriggerParameter();if(u&&u!==n.sourceEvent.keyCode){if(!u.toLowerCase)continue;var f=u.toLowerCase();if(f!==n.sourceEvent.key){var v=n.sourceEvent.charCode?n.sourceEvent.charCode:n.sourceEvent.keyCode;if(String.fromCharCode(v).toLowerCase()!==f)continue}}}o._executeCurrent(n)}}},t.prototype._getEffectiveTarget=function(e,n){for(var r=n.split("."),o=0;o<r.length-1;o++)e=e[r[o]];return e},t.prototype._getProperty=function(e){var n=e.split(".");return n[n.length-1]},t.prototype.serialize=function(e){for(var n={children:new Array,name:e,type:3,properties:new Array},r=0;r<this.actions.length;r++){var o={type:0,children:new Array,name:t.GetTriggerName(this.actions[r].trigger),properties:new Array},u=this.actions[r].triggerOptions;if(u&&typeof u!="number")if(u.parameter instanceof Node)o.properties.push(I._GetTargetProperty(u.parameter));else{var f={};ge.a.DeepCopy(u.parameter,f,["mesh"]),u.parameter&&u.parameter.mesh&&(f._meshId=u.parameter.mesh.id),o.properties.push({name:"parameter",targetType:null,value:f})}this.actions[r].serialize(o),n.children.push(o)}return n},t.Parse=function(e,n,r){var o=new t(r);n===null?r.actionManager=o:n.actionManager=o;for(var u=function(k,K,oe,ae){if(ae===null){var ue=parseFloat(K);return K==="true"||K==="false"?K==="true":isNaN(ue)?K:ue}for(var de=ae.split("."),me=K.split(","),ye=0;ye<de.length;ye++)oe=oe[de[ye]];if(typeof oe=="boolean")return me[0]==="true";if(typeof oe=="string")return me[0];var Ee=new Array;for(ye=0;ye<me.length;ye++)Ee.push(parseFloat(me[ye]));return oe instanceof d.e?d.e.FromArray(Ee):oe instanceof d.f?d.f.FromArray(Ee):oe instanceof M.a?M.a.FromArray(Ee):oe instanceof M.b?M.b.FromArray(Ee):parseFloat(me[0])},f=function(k,K,oe,ae,ue){if(ue===void 0&&(ue=null),!k.detached){var de=new Array,me=null,ye=null,Ee=k.combine&&k.combine.length>0;if(k.type===2?de.push(o):de.push(K),Ee){for(var Ae=new Array,Ie=0;Ie<k.combine.length;Ie++)f(k.combine[Ie],t.NothingTrigger,oe,ae,Ae);de.push(Ae)}else for(var Re=0;Re<k.properties.length;Re++){var Pe=k.properties[Re].value,Ce=k.properties[Re].name,Be=k.properties[Re].targetType;Ce==="target"?Pe=me=Be!==null&&Be==="SceneProperties"?r:r.getNodeByName(Pe):Ce==="parent"?Pe=r.getNodeByName(Pe):Ce==="sound"?r.getSoundByName&&(Pe=r.getSoundByName(Pe)):Ce!=="propertyPath"?Pe=k.type===2&&Ce==="operator"?P[Pe]:u(0,Pe,me,Ce==="value"?ye:null):ye=Pe,de.push(Pe)}if(ue===null?de.push(oe):de.push(null),k.name==="InterpolateValueAction"){var Oe=de[de.length-2];de[de.length-1]=Oe,de[de.length-2]=oe}var Ve=function(je,tt){var ut=C.a.GetClass("BABYLON."+je);if(ut){var ft=Object.create(ut.prototype);return ft.constructor.apply(ft,tt),ft}}(k.name,de);if(Ve instanceof x&&oe!==null){var Le=new j(K,oe);ae?ae.then(Le):o.registerAction(Le),ae=Le}for(ue===null?Ve instanceof x?(oe=Ve,Ve=ae):(oe=null,ae?ae.then(Ve):o.registerAction(Ve)):ue.push(Ve),Re=0;Re<k.children.length;Re++)f(k.children[Re],K,oe,Ve,null)}},v=0;v<e.children.length;v++){var y,D=e.children[v];if(D.properties.length>0){var w=D.properties[0].value,F=D.properties[0].targetType===null?w:r.getMeshByName(w);F._meshId&&(F.mesh=r.getMeshByID(F._meshId)),y={trigger:t[D.name],parameter:F}}else y=t[D.name];for(var z=0;z<D.children.length;z++)D.detached||f(D.children[z],y,null,null)}},t.GetTriggerName=function(e){switch(e){case 0:return"NothingTrigger";case 1:return"OnPickTrigger";case 2:return"OnLeftPickTrigger";case 3:return"OnRightPickTrigger";case 4:return"OnCenterPickTrigger";case 5:return"OnPickDownTrigger";case 6:return"OnPickUpTrigger";case 7:return"OnLongPressTrigger";case 8:return"OnPointerOverTrigger";case 9:return"OnPointerOutTrigger";case 10:return"OnEveryFrameTrigger";case 11:return"OnIntersectionEnterTrigger";case 12:return"OnIntersectionExitTrigger";case 13:return"OnKeyDownTrigger";case 14:return"OnKeyUpTrigger";case 15:return"OnPickOutTrigger";default:return""}},t.NothingTrigger=g.a.ACTION_NothingTrigger,t.OnPickTrigger=g.a.ACTION_OnPickTrigger,t.OnLeftPickTrigger=g.a.ACTION_OnLeftPickTrigger,t.OnRightPickTrigger=g.a.ACTION_OnRightPickTrigger,t.OnCenterPickTrigger=g.a.ACTION_OnCenterPickTrigger,t.OnPickDownTrigger=g.a.ACTION_OnPickDownTrigger,t.OnDoublePickTrigger=g.a.ACTION_OnDoublePickTrigger,t.OnPickUpTrigger=g.a.ACTION_OnPickUpTrigger,t.OnPickOutTrigger=g.a.ACTION_OnPickOutTrigger,t.OnLongPressTrigger=g.a.ACTION_OnLongPressTrigger,t.OnPointerOverTrigger=g.a.ACTION_OnPointerOverTrigger,t.OnPointerOutTrigger=g.a.ACTION_OnPointerOutTrigger,t.OnEveryFrameTrigger=g.a.ACTION_OnEveryFrameTrigger,t.OnIntersectionEnterTrigger=g.a.ACTION_OnIntersectionEnterTrigger,t.OnIntersectionExitTrigger=g.a.ACTION_OnIntersectionExitTrigger,t.OnKeyDownTrigger=g.a.ACTION_OnKeyDownTrigger,t.OnKeyUpTrigger=15,t}(m.a),ce=function(i){function t(e,n,r){var o=i.call(this,e,r)||this;return o._sound=n,o}return Object(p.d)(t,i),t.prototype._prepare=function(){},t.prototype.execute=function(){this._sound!==void 0&&this._sound.play()},t.prototype.serialize=function(e){return i.prototype._serialize.call(this,{name:"PlaySoundAction",properties:[{name:"sound",value:this._sound.name}]},e)},t}(I),ie=function(i){function t(e,n,r){var o=i.call(this,e,r)||this;return o._sound=n,o}return Object(p.d)(t,i),t.prototype._prepare=function(){},t.prototype.execute=function(){this._sound!==void 0&&this._sound.stop()},t.prototype.serialize=function(e){return i.prototype._serialize.call(this,{name:"StopSoundAction",properties:[{name:"sound",value:this._sound.name}]},e)},t}(I);C.a.RegisteredTypes["BABYLON.PlaySoundAction"]=ie,C.a.RegisteredTypes["BABYLON.StopSoundAction"]=ie;var Z,te=c(14),B=c(3);(function(i){i[i.STEP=1]="STEP"})(Z||(Z={}));var G=function(){function i(t,e,n){this.name=t,this.from=e,this.to=n}return i.prototype.clone=function(){return new i(this.name,this.from,this.to)},i}(),$=c(29),le=c(77),se=c(49),q=function(){},H=function(){function i(t,e,n,r,o,u){this.name=t,this.targetProperty=e,this.framePerSecond=n,this.dataType=r,this.loopMode=o,this.enableBlending=u,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this.targetPropertyPath=e.split("."),this.dataType=r,this.loopMode=o===void 0?i.ANIMATIONLOOPMODE_CYCLE:o}return i._PrepareAnimation=function(t,e,n,r,o,u,f,v){var y=void 0;if(!isNaN(parseFloat(o))&&isFinite(o)?y=i.ANIMATIONTYPE_FLOAT:o instanceof d.b?y=i.ANIMATIONTYPE_QUATERNION:o instanceof d.e?y=i.ANIMATIONTYPE_VECTOR3:o instanceof d.d?y=i.ANIMATIONTYPE_VECTOR2:o instanceof M.a?y=i.ANIMATIONTYPE_COLOR3:o instanceof M.b?y=i.ANIMATIONTYPE_COLOR4:o instanceof le.a&&(y=i.ANIMATIONTYPE_SIZE),y==null)return null;var D=new i(t,e,n,y,f),w=[{frame:0,value:o},{frame:r,value:u}];return D.setKeys(w),v!==void 0&&D.setEasingFunction(v),D},i.CreateAnimation=function(t,e,n,r){var o=new i(t+"Animation",t,n,e,i.ANIMATIONLOOPMODE_CONSTANT);return o.setEasingFunction(r),o},i.CreateAndStartAnimation=function(t,e,n,r,o,u,f,v,y,D){var w=i._PrepareAnimation(t,n,r,o,u,f,v,y);return w?e.getScene().beginDirectAnimation(e,[w],0,o,w.loopMode===1,1,D):null},i.CreateAndStartHierarchyAnimation=function(t,e,n,r,o,u,f,v,y,D,w){var F=i._PrepareAnimation(t,r,o,u,f,v,y,D);return F?e.getScene().beginDirectHierarchyAnimation(e,n,[F],0,u,F.loopMode===1,1,w):null},i.CreateMergeAndStartAnimation=function(t,e,n,r,o,u,f,v,y,D){var w=i._PrepareAnimation(t,n,r,o,u,f,v,y);return w?(e.animations.push(w),e.getScene().beginAnimation(e,0,o,w.loopMode===1,1,D)):null},i.MakeAnimationAdditive=function(t,e,n,r,o){e===void 0&&(e=0),r===void 0&&(r=!1);var u=t;if(r&&((u=t.clone()).name=o||u.name),!u._keys.length)return u;e=e>=0?e:0;var f=0,v=u._keys[0],y=u._keys.length-1,D=u._keys[y],w={referenceValue:v.value,referencePosition:d.c.Vector3[0],referenceQuaternion:d.c.Quaternion[0],referenceScaling:d.c.Vector3[1],keyPosition:d.c.Vector3[2],keyQuaternion:d.c.Quaternion[1],keyScaling:d.c.Vector3[3]},F=!1,z=v.frame,k=D.frame;if(n){var K=u.getRange(n);K&&(z=K.from,k=K.to)}var oe=v.frame===z,ae=D.frame===k;if(u._keys.length===1){var ue=u._getKeyValue(u._keys[0]);w.referenceValue=ue.clone?ue.clone():ue,F=!0}else e<=v.frame?(ue=u._getKeyValue(v.value),w.referenceValue=ue.clone?ue.clone():ue,F=!0):e>=D.frame&&(ue=u._getKeyValue(D.value),w.referenceValue=ue.clone?ue.clone():ue,F=!0);for(var de=0;!F||!oe||!ae&&de<u._keys.length-1;){var me=u._keys[de],ye=u._keys[de+1];if(!F&&e>=me.frame&&e<=ye.frame){if(ue=void 0,e===me.frame)ue=u._getKeyValue(me.value);else if(e===ye.frame)ue=u._getKeyValue(ye.value);else{var Ee={key:de,repeatCount:0,loopMode:this.ANIMATIONLOOPMODE_CONSTANT};ue=u._interpolate(e,Ee)}w.referenceValue=ue.clone?ue.clone():ue,F=!0}if(!oe&&z>=me.frame&&z<=ye.frame){if(z===me.frame)f=de;else if(z===ye.frame)f=de+1;else{Ee={key:de,repeatCount:0,loopMode:this.ANIMATIONLOOPMODE_CONSTANT};var Ae={frame:z,value:(ue=u._interpolate(z,Ee)).clone?ue.clone():ue};u._keys.splice(de+1,0,Ae),f=de+1}oe=!0}!ae&&k>=me.frame&&k<=ye.frame&&(k===me.frame?y=de:k===ye.frame?y=de+1:(Ee={key:de,repeatCount:0,loopMode:this.ANIMATIONLOOPMODE_CONSTANT},Ae={frame:k,value:(ue=u._interpolate(k,Ee)).clone?ue.clone():ue},u._keys.splice(de+1,0,Ae),y=de+1),ae=!0),de++}for(u.dataType===i.ANIMATIONTYPE_QUATERNION?w.referenceValue.normalize().conjugateInPlace():u.dataType===i.ANIMATIONTYPE_MATRIX&&(w.referenceValue.decompose(w.referenceScaling,w.referenceQuaternion,w.referencePosition),w.referenceQuaternion.normalize().conjugateInPlace()),de=f;de<=y;de++)if(Ae=u._keys[de],!de||u.dataType===i.ANIMATIONTYPE_FLOAT||Ae.value!==v.value)switch(u.dataType){case i.ANIMATIONTYPE_MATRIX:Ae.value.decompose(w.keyScaling,w.keyQuaternion,w.keyPosition),w.keyPosition.subtractInPlace(w.referencePosition),w.keyScaling.divideInPlace(w.referenceScaling),w.referenceQuaternion.multiplyToRef(w.keyQuaternion,w.keyQuaternion),d.a.ComposeToRef(w.keyScaling,w.keyQuaternion,w.keyPosition,Ae.value);break;case i.ANIMATIONTYPE_QUATERNION:w.referenceValue.multiplyToRef(Ae.value,Ae.value);break;case i.ANIMATIONTYPE_VECTOR2:case i.ANIMATIONTYPE_VECTOR3:case i.ANIMATIONTYPE_COLOR3:case i.ANIMATIONTYPE_COLOR4:Ae.value.subtractToRef(w.referenceValue,Ae.value);break;case i.ANIMATIONTYPE_SIZE:Ae.value.width-=w.referenceValue.width,Ae.value.height-=w.referenceValue.height;break;default:Ae.value-=w.referenceValue}return u},i.TransitionTo=function(t,e,n,r,o,u,f,v){if(v===void 0&&(v=null),f<=0)return n[t]=e,v&&v(),null;var y=o*(f/1e3);u.setKeys([{frame:0,value:n[t].clone?n[t].clone():n[t]},{frame:y,value:e}]),n.animations||(n.animations=[]),n.animations.push(u);var D=r.beginAnimation(n,0,y,!1);return D.onAnimationEnd=v,D},Object.defineProperty(i.prototype,"runtimeAnimations",{get:function(){return this._runtimeAnimations},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"hasRunningRuntimeAnimations",{get:function(){for(var t=0,e=this._runtimeAnimations;t<e.length;t++)if(!e[t].isStopped)return!0;return!1},enumerable:!1,configurable:!0}),i.prototype.toString=function(t){var e="Name: "+this.name+", property: "+this.targetProperty;if(e+=", datatype: "+["Float","Vector3","Quaternion","Matrix","Color3","Vector2"][this.dataType],e+=", nKeys: "+(this._keys?this._keys.length:"none"),e+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),t){e+=", Ranges: {";var n=!0;for(var r in this._ranges)n&&(e+=", ",n=!1),e+=r;e+="}"}return e},i.prototype.addEvent=function(t){this._events.push(t),this._events.sort(function(e,n){return e.frame-n.frame})},i.prototype.removeEvents=function(t){for(var e=0;e<this._events.length;e++)this._events[e].frame===t&&(this._events.splice(e,1),e--)},i.prototype.getEvents=function(){return this._events},i.prototype.createRange=function(t,e,n){this._ranges[t]||(this._ranges[t]=new G(t,e,n))},i.prototype.deleteRange=function(t,e){e===void 0&&(e=!0);var n=this._ranges[t];if(n){if(e)for(var r=n.from,o=n.to,u=this._keys.length-1;u>=0;u--)this._keys[u].frame>=r&&this._keys[u].frame<=o&&this._keys.splice(u,1);this._ranges[t]=null}},i.prototype.getRange=function(t){return this._ranges[t]},i.prototype.getKeys=function(){return this._keys},i.prototype.getHighestFrame=function(){for(var t=0,e=0,n=this._keys.length;e<n;e++)t<this._keys[e].frame&&(t=this._keys[e].frame);return t},i.prototype.getEasingFunction=function(){return this._easingFunction},i.prototype.setEasingFunction=function(t){this._easingFunction=t},i.prototype.floatInterpolateFunction=function(t,e,n){return te.a.Lerp(t,e,n)},i.prototype.floatInterpolateFunctionWithTangents=function(t,e,n,r,o){return te.a.Hermite(t,e,n,r,o)},i.prototype.quaternionInterpolateFunction=function(t,e,n){return d.b.Slerp(t,e,n)},i.prototype.quaternionInterpolateFunctionWithTangents=function(t,e,n,r,o){return d.b.Hermite(t,e,n,r,o).normalize()},i.prototype.vector3InterpolateFunction=function(t,e,n){return d.e.Lerp(t,e,n)},i.prototype.vector3InterpolateFunctionWithTangents=function(t,e,n,r,o){return d.e.Hermite(t,e,n,r,o)},i.prototype.vector2InterpolateFunction=function(t,e,n){return d.d.Lerp(t,e,n)},i.prototype.vector2InterpolateFunctionWithTangents=function(t,e,n,r,o){return d.d.Hermite(t,e,n,r,o)},i.prototype.sizeInterpolateFunction=function(t,e,n){return le.a.Lerp(t,e,n)},i.prototype.color3InterpolateFunction=function(t,e,n){return M.a.Lerp(t,e,n)},i.prototype.color4InterpolateFunction=function(t,e,n){return M.b.Lerp(t,e,n)},i.prototype._getKeyValue=function(t){return typeof t=="function"?t():t},i.prototype._interpolate=function(t,e){if(e.loopMode===i.ANIMATIONLOOPMODE_CONSTANT&&e.repeatCount>0)return e.highLimitValue.clone?e.highLimitValue.clone():e.highLimitValue;var n=this._keys;if(n.length===1)return this._getKeyValue(n[0].value);var r=e.key;if(n[r].frame>=t)for(;r-1>=0&&n[r].frame>=t;)r--;for(var o=r;o<n.length;o++){var u=n[o+1];if(u.frame>=t){e.key=o;var f=n[o],v=this._getKeyValue(f.value);if(f.interpolation===Z.STEP)return v;var y=this._getKeyValue(u.value),D=f.outTangent!==void 0&&u.inTangent!==void 0,w=u.frame-f.frame,F=(t-f.frame)/w,z=this.getEasingFunction();switch(z!=null&&(F=z.ease(F)),this.dataType){case i.ANIMATIONTYPE_FLOAT:var k=D?this.floatInterpolateFunctionWithTangents(v,f.outTangent*w,y,u.inTangent*w,F):this.floatInterpolateFunction(v,y,F);switch(e.loopMode){case i.ANIMATIONLOOPMODE_CYCLE:case i.ANIMATIONLOOPMODE_CONSTANT:return k;case i.ANIMATIONLOOPMODE_RELATIVE:return e.offsetValue*e.repeatCount+k}break;case i.ANIMATIONTYPE_QUATERNION:var K=D?this.quaternionInterpolateFunctionWithTangents(v,f.outTangent.scale(w),y,u.inTangent.scale(w),F):this.quaternionInterpolateFunction(v,y,F);switch(e.loopMode){case i.ANIMATIONLOOPMODE_CYCLE:case i.ANIMATIONLOOPMODE_CONSTANT:return K;case i.ANIMATIONLOOPMODE_RELATIVE:return K.addInPlace(e.offsetValue.scale(e.repeatCount))}return K;case i.ANIMATIONTYPE_VECTOR3:var oe=D?this.vector3InterpolateFunctionWithTangents(v,f.outTangent.scale(w),y,u.inTangent.scale(w),F):this.vector3InterpolateFunction(v,y,F);switch(e.loopMode){case i.ANIMATIONLOOPMODE_CYCLE:case i.ANIMATIONLOOPMODE_CONSTANT:return oe;case i.ANIMATIONLOOPMODE_RELATIVE:return oe.add(e.offsetValue.scale(e.repeatCount))}case i.ANIMATIONTYPE_VECTOR2:var ae=D?this.vector2InterpolateFunctionWithTangents(v,f.outTangent.scale(w),y,u.inTangent.scale(w),F):this.vector2InterpolateFunction(v,y,F);switch(e.loopMode){case i.ANIMATIONLOOPMODE_CYCLE:case i.ANIMATIONLOOPMODE_CONSTANT:return ae;case i.ANIMATIONLOOPMODE_RELATIVE:return ae.add(e.offsetValue.scale(e.repeatCount))}case i.ANIMATIONTYPE_SIZE:switch(e.loopMode){case i.ANIMATIONLOOPMODE_CYCLE:case i.ANIMATIONLOOPMODE_CONSTANT:return this.sizeInterpolateFunction(v,y,F);case i.ANIMATIONLOOPMODE_RELATIVE:return this.sizeInterpolateFunction(v,y,F).add(e.offsetValue.scale(e.repeatCount))}case i.ANIMATIONTYPE_COLOR3:switch(e.loopMode){case i.ANIMATIONLOOPMODE_CYCLE:case i.ANIMATIONLOOPMODE_CONSTANT:return this.color3InterpolateFunction(v,y,F);case i.ANIMATIONLOOPMODE_RELATIVE:return this.color3InterpolateFunction(v,y,F).add(e.offsetValue.scale(e.repeatCount))}case i.ANIMATIONTYPE_COLOR4:switch(e.loopMode){case i.ANIMATIONLOOPMODE_CYCLE:case i.ANIMATIONLOOPMODE_CONSTANT:return this.color4InterpolateFunction(v,y,F);case i.ANIMATIONLOOPMODE_RELATIVE:return this.color4InterpolateFunction(v,y,F).add(e.offsetValue.scale(e.repeatCount))}case i.ANIMATIONTYPE_MATRIX:switch(e.loopMode){case i.ANIMATIONLOOPMODE_CYCLE:case i.ANIMATIONLOOPMODE_CONSTANT:if(i.AllowMatricesInterpolation)return this.matrixInterpolateFunction(v,y,F,e.workValue);case i.ANIMATIONLOOPMODE_RELATIVE:return v}}break}}return this._getKeyValue(n[n.length-1].value)},i.prototype.matrixInterpolateFunction=function(t,e,n,r){return i.AllowMatrixDecomposeForInterpolation?r?(d.a.DecomposeLerpToRef(t,e,n,r),r):d.a.DecomposeLerp(t,e,n):r?(d.a.LerpToRef(t,e,n,r),r):d.a.Lerp(t,e,n)},i.prototype.clone=function(){var t=new i(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(t.enableBlending=this.enableBlending,t.blendingSpeed=this.blendingSpeed,this._keys&&t.setKeys(this._keys),this._ranges)for(var e in t._ranges={},this._ranges){var n=this._ranges[e];n&&(t._ranges[e]=n.clone())}return t},i.prototype.setKeys=function(t){this._keys=t.slice(0)},i.prototype.serialize=function(){var t={};t.name=this.name,t.property=this.targetProperty,t.framePerSecond=this.framePerSecond,t.dataType=this.dataType,t.loopBehavior=this.loopMode,t.enableBlending=this.enableBlending,t.blendingSpeed=this.blendingSpeed;var e=this.dataType;t.keys=[];for(var n=this.getKeys(),r=0;r<n.length;r++){var o=n[r],u={};switch(u.frame=o.frame,e){case i.ANIMATIONTYPE_FLOAT:u.values=[o.value],o.inTangent!==void 0&&u.values.push(o.inTangent),o.outTangent!==void 0&&(o.inTangent===void 0&&u.values.push(void 0),u.values.push(o.outTangent));break;case i.ANIMATIONTYPE_QUATERNION:case i.ANIMATIONTYPE_MATRIX:case i.ANIMATIONTYPE_VECTOR3:case i.ANIMATIONTYPE_COLOR3:case i.ANIMATIONTYPE_COLOR4:u.values=o.value.asArray(),o.inTangent!=null&&u.values.push(o.inTangent.asArray()),o.outTangent!=null&&(o.inTangent===void 0&&u.values.push(void 0),u.values.push(o.outTangent.asArray()))}t.keys.push(u)}for(var f in t.ranges=[],this._ranges){var v=this._ranges[f];if(v){var y={};y.name=f,y.from=v.from,y.to=v.to,t.ranges.push(y)}}return t},i._UniversalLerp=function(t,e,n){var r=t.constructor;return r.Lerp?r.Lerp(t,e,n):r.Slerp?r.Slerp(t,e,n):t.toFixed?t*(1-n)+n*e:e},i.Parse=function(t){var e,n,r=new i(t.name,t.property,t.framePerSecond,t.dataType,t.loopBehavior),o=t.dataType,u=[];for(t.enableBlending&&(r.enableBlending=t.enableBlending),t.blendingSpeed&&(r.blendingSpeed=t.blendingSpeed),n=0;n<t.keys.length;n++){var f,v,y=t.keys[n];switch(o){case i.ANIMATIONTYPE_FLOAT:e=y.values[0],y.values.length>=1&&(f=y.values[1]),y.values.length>=2&&(v=y.values[2]);break;case i.ANIMATIONTYPE_QUATERNION:if(e=d.b.FromArray(y.values),y.values.length>=8){var D=d.b.FromArray(y.values.slice(4,8));D.equals(d.b.Zero())||(f=D)}if(y.values.length>=12){var w=d.b.FromArray(y.values.slice(8,12));w.equals(d.b.Zero())||(v=w)}break;case i.ANIMATIONTYPE_MATRIX:e=d.a.FromArray(y.values);break;case i.ANIMATIONTYPE_COLOR3:e=M.a.FromArray(y.values);break;case i.ANIMATIONTYPE_COLOR4:e=M.b.FromArray(y.values);break;case i.ANIMATIONTYPE_VECTOR3:default:e=d.e.FromArray(y.values)}var F={};F.frame=y.frame,F.value=e,f!=null&&(F.inTangent=f),v!=null&&(F.outTangent=v),u.push(F)}if(r.setKeys(u),t.ranges)for(n=0;n<t.ranges.length;n++)e=t.ranges[n],r.createRange(e.name,e.from,e.to);return r},i.AppendSerializedAnimations=function(t,e){B.a.AppendSerializedAnimations(t,e)},i.ParseFromFileAsync=function(t,e){var n=this;return new Promise(function(r,o){var u=new se.a;u.addEventListener("readystatechange",function(){if(u.readyState==4)if(u.status==200){var f=JSON.parse(u.responseText);if(f.length){for(var v=new Array,y=0,D=f;y<D.length;y++){var w=D[y];v.push(n.Parse(w))}r(v)}else v=n.Parse(f),t&&(v.name=t),r(v)}else o("Unable to load the animation")}),u.open("GET",e),u.send()})},i.CreateFromSnippetAsync=function(t){var e=this;return new Promise(function(n,r){var o=new se.a;o.addEventListener("readystatechange",function(){if(o.readyState==4)if(o.status==200){var u=JSON.parse(JSON.parse(o.responseText).jsonPayload);if(u.animations){for(var f=JSON.parse(u.animations),v=new Array,y=0,D=f;y<D.length;y++){var w=D[y];v.push(e.Parse(w))}n(v)}else f=JSON.parse(u.animation),(v=e.Parse(f)).snippetId=t,n(v)}else r("Unable to load the snippet "+t)}),o.open("GET",e.SnippetUrl+"/"+t.replace(/#/g,"/")),o.send()})},i.AllowMatricesInterpolation=!1,i.AllowMatrixDecomposeForInterpolation=!0,i.SnippetUrl="https://snippet.babylonjs.com",i.ANIMATIONTYPE_FLOAT=0,i.ANIMATIONTYPE_VECTOR3=1,i.ANIMATIONTYPE_QUATERNION=2,i.ANIMATIONTYPE_MATRIX=3,i.ANIMATIONTYPE_COLOR3=4,i.ANIMATIONTYPE_COLOR4=7,i.ANIMATIONTYPE_VECTOR2=5,i.ANIMATIONTYPE_SIZE=6,i.ANIMATIONLOOPMODE_RELATIVE=0,i.ANIMATIONLOOPMODE_CYCLE=1,i.ANIMATIONLOOPMODE_CONSTANT=2,i}();C.a.RegisteredTypes["BABYLON.Animation"]=H,$.a._AnimationRangeFactory=function(i,t,e){return new G(i,t,e)};var X=function(i){function t(e,n,r,o,u,f,v,y){u===void 0&&(u=1e3);var D=i.call(this,e,f)||this;return D.duration=1e3,D.onInterpolationDoneObservable=new S.c,D.propertyPath=r,D.value=o,D.duration=u,D.stopOtherAnimations=v,D.onInterpolationDone=y,D._target=D._effectiveTarget=n,D}return Object(p.d)(t,i),t.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath),this._property=this._getProperty(this.propertyPath)},t.prototype.execute=function(){var e,n=this,r=this._actionManager.getScene(),o=[{frame:0,value:this._effectiveTarget[this._property]},{frame:100,value:this.value}];if(typeof this.value=="number")e=H.ANIMATIONTYPE_FLOAT;else if(this.value instanceof M.a)e=H.ANIMATIONTYPE_COLOR3;else if(this.value instanceof d.e)e=H.ANIMATIONTYPE_VECTOR3;else if(this.value instanceof d.a)e=H.ANIMATIONTYPE_MATRIX;else{if(!(this.value instanceof d.b))return void _.a.Warn("InterpolateValueAction: Unsupported type ("+typeof this.value+")");e=H.ANIMATIONTYPE_QUATERNION}var u=new H("InterpolateValueAction",this._property,1e3/this.duration*100,e,H.ANIMATIONLOOPMODE_CONSTANT);u.setKeys(o),this.stopOtherAnimations&&r.stopAnimation(this._effectiveTarget),r.beginDirectAnimation(this._effectiveTarget,[u],0,100,!1,1,function(){n.onInterpolationDoneObservable.notifyObservers(n),n.onInterpolationDone&&n.onInterpolationDone()})},t.prototype.serialize=function(e){return i.prototype._serialize.call(this,{name:"InterpolateValueAction",properties:[I._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:I._SerializeValueAsString(this.value)},{name:"duration",value:I._SerializeValueAsString(this.duration)},{name:"stopOtherAnimations",value:I._SerializeValueAsString(this.stopOtherAnimations)||!1}]},e)},t}(I);C.a.RegisteredTypes["BABYLON.InterpolateValueAction"]=X;var J=Object.freeze(new d.b(0,0,0,0)),Q=Object.freeze(d.e.Zero()),ee=Object.freeze(d.d.Zero()),pe=Object.freeze(le.a.Zero()),Te=Object.freeze(M.a.Black()),ve=function(){function i(t,e,n,r){var o=this;if(this._events=new Array,this._currentFrame=0,this._originalValue=new Array,this._originalBlendValue=null,this._offsetsCache={},this._highLimitsCache={},this._stopped=!1,this._blendingFactor=0,this._currentValue=null,this._currentActiveTarget=null,this._directTarget=null,this._targetPath="",this._weight=1,this._ratioOffset=0,this._previousDelay=0,this._previousRatio=0,this._targetIsArray=!1,this._animation=e,this._target=t,this._scene=n,this._host=r,this._activeTargets=[],e._runtimeAnimations.push(this),this._animationState={key:0,repeatCount:0,loopMode:this._getCorrectLoopMode()},this._animation.dataType===H.ANIMATIONTYPE_MATRIX&&(this._animationState.workValue=d.a.Zero()),this._keys=this._animation.getKeys(),this._minFrame=this._keys[0].frame,this._maxFrame=this._keys[this._keys.length-1].frame,this._minValue=this._keys[0].value,this._maxValue=this._keys[this._keys.length-1].value,this._minFrame!==0){var u={frame:0,value:this._minValue};this._keys.splice(0,0,u)}if(this._target instanceof Array){for(var f=0,v=0,y=this._target;v<y.length;v++){var D=y[v];this._preparePath(D,f),this._getOriginalValues(f),f++}this._targetIsArray=!0}else this._preparePath(this._target),this._getOriginalValues(),this._targetIsArray=!1,this._directTarget=this._activeTargets[0];var w=e.getEvents();w&&w.length>0&&w.forEach(function(F){o._events.push(F._clone())}),this._enableBlending=t&&t.animationPropertiesOverride?t.animationPropertiesOverride.enableBlending:this._animation.enableBlending}return Object.defineProperty(i.prototype,"currentFrame",{get:function(){return this._currentFrame},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"weight",{get:function(){return this._weight},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"currentValue",{get:function(){return this._currentValue},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"targetPath",{get:function(){return this._targetPath},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"target",{get:function(){return this._currentActiveTarget},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isAdditive",{get:function(){return this._host&&this._host.isAdditive},enumerable:!1,configurable:!0}),i.prototype._preparePath=function(t,e){e===void 0&&(e=0);var n=this._animation.targetPropertyPath;if(n.length>1){for(var r=t[n[0]],o=1;o<n.length-1;o++)r=r[n[o]];this._targetPath=n[n.length-1],this._activeTargets[e]=r}else this._targetPath=n[0],this._activeTargets[e]=t},Object.defineProperty(i.prototype,"animation",{get:function(){return this._animation},enumerable:!1,configurable:!0}),i.prototype.reset=function(t){if(t===void 0&&(t=!1),t)if(this._target instanceof Array)for(var e=0,n=0,r=this._target;n<r.length;n++){var o=r[n];this._originalValue[e]!==void 0&&this._setValue(o,this._activeTargets[e],this._originalValue[e],-1,e),e++}else this._originalValue[0]!==void 0&&this._setValue(this._target,this._directTarget,this._originalValue[0],-1,0);for(this._offsetsCache={},this._highLimitsCache={},this._currentFrame=0,this._blendingFactor=0,e=0;e<this._events.length;e++)this._events[e].isDone=!1},i.prototype.isStopped=function(){return this._stopped},i.prototype.dispose=function(){var t=this._animation.runtimeAnimations.indexOf(this);t>-1&&this._animation.runtimeAnimations.splice(t,1)},i.prototype.setValue=function(t,e){if(this._targetIsArray)for(var n=0;n<this._target.length;n++){var r=this._target[n];this._setValue(r,this._activeTargets[n],t,e,n)}else this._setValue(this._target,this._directTarget,t,e,0)},i.prototype._getOriginalValues=function(t){var e;t===void 0&&(t=0);var n=this._activeTargets[t];(e=n.getRestPose&&this._targetPath==="_matrix"?n.getRestPose():n[this._targetPath])&&e.clone?this._originalValue[t]=e.clone():this._originalValue[t]=e},i.prototype._setValue=function(t,e,n,r,o){if(this._currentActiveTarget=e,this._weight=r,this._enableBlending&&this._blendingFactor<=1){if(!this._originalBlendValue){var u=e[this._targetPath];u.clone?this._originalBlendValue=u.clone():this._originalBlendValue=u}this._originalBlendValue.m?H.AllowMatrixDecomposeForInterpolation?this._currentValue?d.a.DecomposeLerpToRef(this._originalBlendValue,n,this._blendingFactor,this._currentValue):this._currentValue=d.a.DecomposeLerp(this._originalBlendValue,n,this._blendingFactor):this._currentValue?d.a.LerpToRef(this._originalBlendValue,n,this._blendingFactor,this._currentValue):this._currentValue=d.a.Lerp(this._originalBlendValue,n,this._blendingFactor):this._currentValue=H._UniversalLerp(this._originalBlendValue,n,this._blendingFactor);var f=t&&t.animationPropertiesOverride?t.animationPropertiesOverride.blendingSpeed:this._animation.blendingSpeed;this._blendingFactor+=f}else this._currentValue=n;r!==-1?this._scene._registerTargetForLateAnimationBinding(this,this._originalValue[o]):e[this._targetPath]=this._currentValue,t.markAsDirty&&t.markAsDirty(this._animation.targetProperty)},i.prototype._getCorrectLoopMode=function(){return this._target&&this._target.animationPropertiesOverride?this._target.animationPropertiesOverride.loopMode:this._animation.loopMode},i.prototype.goToFrame=function(t){var e=this._animation.getKeys();t<e[0].frame?t=e[0].frame:t>e[e.length-1].frame&&(t=e[e.length-1].frame);var n=this._events;if(n.length)for(var r=0;r<n.length;r++)n[r].onlyOnce||(n[r].isDone=n[r].frame<t);this._currentFrame=t;var o=this._animation._interpolate(t,this._animationState);this.setValue(o,-1)},i.prototype._prepareForSpeedRatioChange=function(t){var e=this._previousDelay*(this._animation.framePerSecond*t)/1e3;this._ratioOffset=this._previousRatio-e},i.prototype.animate=function(t,e,n,r,o,u){u===void 0&&(u=-1);var f=this._animation,v=f.targetPropertyPath;if(!v||v.length<1)return this._stopped=!0,!1;var y=!0;(e<this._minFrame||e>this._maxFrame)&&(e=this._minFrame),(n<this._minFrame||n>this._maxFrame)&&(n=this._maxFrame);var D,w,F=n-e,z=t*(f.framePerSecond*o)/1e3+this._ratioOffset,k=0;if(this._previousDelay=t,this._previousRatio=z,!r&&n>=e&&z>=F)y=!1,k=f._getKeyValue(this._maxValue);else if(!r&&e>=n&&z<=F)y=!1,k=f._getKeyValue(this._minValue);else if(this._animationState.loopMode!==H.ANIMATIONLOOPMODE_CYCLE){var K=n.toString()+e.toString();if(!this._offsetsCache[K]){this._animationState.repeatCount=0,this._animationState.loopMode=H.ANIMATIONLOOPMODE_CYCLE;var oe=f._interpolate(e,this._animationState),ae=f._interpolate(n,this._animationState);switch(this._animationState.loopMode=this._getCorrectLoopMode(),f.dataType){case H.ANIMATIONTYPE_FLOAT:this._offsetsCache[K]=ae-oe;break;case H.ANIMATIONTYPE_QUATERNION:this._offsetsCache[K]=ae.subtract(oe);break;case H.ANIMATIONTYPE_VECTOR3:this._offsetsCache[K]=ae.subtract(oe);case H.ANIMATIONTYPE_VECTOR2:this._offsetsCache[K]=ae.subtract(oe);case H.ANIMATIONTYPE_SIZE:this._offsetsCache[K]=ae.subtract(oe);case H.ANIMATIONTYPE_COLOR3:this._offsetsCache[K]=ae.subtract(oe)}this._highLimitsCache[K]=ae}k=this._highLimitsCache[K],D=this._offsetsCache[K]}if(D===void 0)switch(f.dataType){case H.ANIMATIONTYPE_FLOAT:D=0;break;case H.ANIMATIONTYPE_QUATERNION:D=J;break;case H.ANIMATIONTYPE_VECTOR3:D=Q;break;case H.ANIMATIONTYPE_VECTOR2:D=ee;break;case H.ANIMATIONTYPE_SIZE:D=pe;break;case H.ANIMATIONTYPE_COLOR3:D=Te}if(this._host&&this._host.syncRoot){var ue=this._host.syncRoot;w=e+(n-e)*((ue.masterFrame-ue.fromFrame)/(ue.toFrame-ue.fromFrame))}else w=y&&F!==0?e+z%F:n;var de=this._events;if((F>0&&this.currentFrame>w||F<0&&this.currentFrame<w)&&(this._onLoop(),de.length))for(var me=0;me<de.length;me++)de[me].onlyOnce||(de[me].isDone=!1);this._currentFrame=w,this._animationState.repeatCount=F===0?0:z/F>>0,this._animationState.highLimitValue=k,this._animationState.offsetValue=D;var ye=f._interpolate(w,this._animationState);if(this.setValue(ye,u),de.length){for(me=0;me<de.length;me++)if(F>0&&w>=de[me].frame&&de[me].frame>=e||F<0&&w<=de[me].frame&&de[me].frame<=e){var Ee=de[me];Ee.isDone||(Ee.onlyOnce&&(de.splice(me,1),me--),Ee.isDone=!0,Ee.action(w))}}return y||(this._stopped=!0),y},i}(),he=c(20),be=c(57),xe=c(44),Se=c(23),Ue=function(i){function t(e,n,r,o,u,f,v){r===void 0&&(r=null),o===void 0&&(o=null),u===void 0&&(u=null),f===void 0&&(f=null),v===void 0&&(v=null);var y=i.call(this,e,n.getScene())||this;return y.name=e,y.children=new Array,y.animations=new Array,y._index=null,y._absoluteTransform=new d.a,y._invertedAbsoluteTransform=new d.a,y._scalingDeterminant=1,y._worldTransform=new d.a,y._needToDecompose=!0,y._needToCompose=!1,y._linkedTransformNode=null,y._waitingTransformNodeId=null,y._skeleton=n,y._localMatrix=o?o.clone():d.a.Identity(),y._restPose=u||y._localMatrix.clone(),y._bindPose=y._localMatrix.clone(),y._baseMatrix=f||y._localMatrix.clone(),y._index=v,n.bones.push(y),y.setParent(r,!1),(f||o)&&y._updateDifferenceMatrix(),y}return Object(p.d)(t,i),Object.defineProperty(t.prototype,"_matrix",{get:function(){return this._compose(),this._localMatrix},set:function(e){this._localMatrix.copyFrom(e),this._needToDecompose=!0},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"Bone"},t.prototype.getSkeleton=function(){return this._skeleton},t.prototype.getParent=function(){return this._parent},t.prototype.getChildren=function(){return this.children},t.prototype.getIndex=function(){return this._index===null?this.getSkeleton().bones.indexOf(this):this._index},t.prototype.setParent=function(e,n){if(n===void 0&&(n=!0),this._parent!==e){if(this._parent){var r=this._parent.children.indexOf(this);r!==-1&&this._parent.children.splice(r,1)}this._parent=e,this._parent&&this._parent.children.push(this),n&&this._updateDifferenceMatrix(),this.markAsDirty()}},t.prototype.getLocalMatrix=function(){return this._compose(),this._localMatrix},t.prototype.getBaseMatrix=function(){return this._baseMatrix},t.prototype.getRestPose=function(){return this._restPose},t.prototype.setRestPose=function(e){this._restPose.copyFrom(e)},t.prototype.getBindPose=function(){return this._bindPose},t.prototype.setBindPose=function(e){this._bindPose.copyFrom(e)},t.prototype.getWorldMatrix=function(){return this._worldTransform},t.prototype.returnToRest=function(){this._skeleton._numBonesWithLinkedTransformNode>0?this.updateMatrix(this._restPose,!1,!1):this.updateMatrix(this._restPose,!1,!0)},t.prototype.getInvertedAbsoluteTransform=function(){return this._invertedAbsoluteTransform},t.prototype.getAbsoluteTransform=function(){return this._absoluteTransform},t.prototype.linkTransformNode=function(e){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=e,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++},t.prototype.getTransformNode=function(){return this._linkedTransformNode},Object.defineProperty(t.prototype,"position",{get:function(){return this._decompose(),this._localPosition},set:function(e){this._decompose(),this._localPosition.copyFrom(e),this._markAsDirtyAndCompose()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rotation",{get:function(){return this.getRotation()},set:function(e){this.setRotation(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rotationQuaternion",{get:function(){return this._decompose(),this._localRotation},set:function(e){this.setRotationQuaternion(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scaling",{get:function(){return this.getScale()},set:function(e){this.setScale(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"animationPropertiesOverride",{get:function(){return this._skeleton.animationPropertiesOverride},enumerable:!1,configurable:!0}),t.prototype._decompose=function(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=d.e.Zero(),this._localRotation=d.b.Zero(),this._localPosition=d.e.Zero()),this._localMatrix.decompose(this._localScaling,this._localRotation,this._localPosition))},t.prototype._compose=function(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,d.a.ComposeToRef(this._localScaling,this._localRotation,this._localPosition,this._localMatrix)):this._needToCompose=!1)},t.prototype.updateMatrix=function(e,n,r){n===void 0&&(n=!0),r===void 0&&(r=!0),this._baseMatrix.copyFrom(e),n&&this._updateDifferenceMatrix(),r?(this._needToCompose=!1,this._localMatrix.copyFrom(e),this._markAsDirtyAndDecompose()):this.markAsDirty()},t.prototype._updateDifferenceMatrix=function(e,n){if(n===void 0&&(n=!0),e||(e=this._baseMatrix),this._parent?e.multiplyToRef(this._parent._absoluteTransform,this._absoluteTransform):this._absoluteTransform.copyFrom(e),this._absoluteTransform.invertToRef(this._invertedAbsoluteTransform),n)for(var r=0;r<this.children.length;r++)this.children[r]._updateDifferenceMatrix();this._scalingDeterminant=this._absoluteTransform.determinant()<0?-1:1},t.prototype.markAsDirty=function(){this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty()},t.prototype._markAsDirtyAndCompose=function(){this.markAsDirty(),this._needToCompose=!0},t.prototype._markAsDirtyAndDecompose=function(){this.markAsDirty(),this._needToDecompose=!0},t.prototype.translate=function(e,n,r){n===void 0&&(n=Se.c.LOCAL);var o=this.getLocalMatrix();if(n==Se.c.LOCAL)o.addAtIndex(12,e.x),o.addAtIndex(13,e.y),o.addAtIndex(14,e.z);else{var u=null;r&&(u=r.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var f=t._tmpMats[0],v=t._tmpVecs[0];this._parent?r&&u?(f.copyFrom(this._parent.getAbsoluteTransform()),f.multiplyToRef(u,f)):f.copyFrom(this._parent.getAbsoluteTransform()):d.a.IdentityToRef(f),f.setTranslationFromFloats(0,0,0),f.invert(),d.e.TransformCoordinatesToRef(e,f,v),o.addAtIndex(12,v.x),o.addAtIndex(13,v.y),o.addAtIndex(14,v.z)}this._markAsDirtyAndDecompose()},t.prototype.setPosition=function(e,n,r){n===void 0&&(n=Se.c.LOCAL);var o=this.getLocalMatrix();if(n==Se.c.LOCAL)o.setTranslationFromFloats(e.x,e.y,e.z);else{var u=null;r&&(u=r.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var f=t._tmpMats[0],v=t._tmpVecs[0];this._parent?(r&&u?(f.copyFrom(this._parent.getAbsoluteTransform()),f.multiplyToRef(u,f)):f.copyFrom(this._parent.getAbsoluteTransform()),f.invert()):d.a.IdentityToRef(f),d.e.TransformCoordinatesToRef(e,f,v),o.setTranslationFromFloats(v.x,v.y,v.z)}this._markAsDirtyAndDecompose()},t.prototype.setAbsolutePosition=function(e,n){this.setPosition(e,Se.c.WORLD,n)},t.prototype.scale=function(e,n,r,o){o===void 0&&(o=!1);var u=this.getLocalMatrix(),f=t._tmpMats[0];d.a.ScalingToRef(e,n,r,f),f.multiplyToRef(u,u),f.invert();for(var v=0,y=this.children;v<y.length;v++){var D=(z=y[v]).getLocalMatrix();D.multiplyToRef(f,D),D.multiplyAtIndex(12,e),D.multiplyAtIndex(13,n),D.multiplyAtIndex(14,r),z._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),o)for(var w=0,F=this.children;w<F.length;w++){var z;(z=F[w]).scale(e,n,r,o)}},t.prototype.setScale=function(e){this._decompose(),this._localScaling.copyFrom(e),this._markAsDirtyAndCompose()},t.prototype.getScale=function(){return this._decompose(),this._localScaling},t.prototype.getScaleToRef=function(e){this._decompose(),e.copyFrom(this._localScaling)},t.prototype.setYawPitchRoll=function(e,n,r,o,u){if(o===void 0&&(o=Se.c.LOCAL),o===Se.c.LOCAL){var f=t._tmpQuat;return d.b.RotationYawPitchRollToRef(e,n,r,f),void this.setRotationQuaternion(f,o,u)}var v=t._tmpMats[0];if(this._getNegativeRotationToRef(v,u)){var y=t._tmpMats[1];d.a.RotationYawPitchRollToRef(e,n,r,y),v.multiplyToRef(y,y),this._rotateWithMatrix(y,o,u)}},t.prototype.rotate=function(e,n,r,o){r===void 0&&(r=Se.c.LOCAL);var u=t._tmpMats[0];u.setTranslationFromFloats(0,0,0),d.a.RotationAxisToRef(e,n,u),this._rotateWithMatrix(u,r,o)},t.prototype.setAxisAngle=function(e,n,r,o){if(r===void 0&&(r=Se.c.LOCAL),r===Se.c.LOCAL){var u=t._tmpQuat;return d.b.RotationAxisToRef(e,n,u),void this.setRotationQuaternion(u,r,o)}var f=t._tmpMats[0];if(this._getNegativeRotationToRef(f,o)){var v=t._tmpMats[1];d.a.RotationAxisToRef(e,n,v),f.multiplyToRef(v,v),this._rotateWithMatrix(v,r,o)}},t.prototype.setRotation=function(e,n,r){n===void 0&&(n=Se.c.LOCAL),this.setYawPitchRoll(e.y,e.x,e.z,n,r)},t.prototype.setRotationQuaternion=function(e,n,r){if(n===void 0&&(n=Se.c.LOCAL),n===Se.c.LOCAL)return this._decompose(),this._localRotation.copyFrom(e),void this._markAsDirtyAndCompose();var o=t._tmpMats[0];if(this._getNegativeRotationToRef(o,r)){var u=t._tmpMats[1];d.a.FromQuaternionToRef(e,u),o.multiplyToRef(u,u),this._rotateWithMatrix(u,n,r)}},t.prototype.setRotationMatrix=function(e,n,r){if(n===void 0&&(n=Se.c.LOCAL),n===Se.c.LOCAL){var o=t._tmpQuat;return d.b.FromRotationMatrixToRef(e,o),void this.setRotationQuaternion(o,n,r)}var u=t._tmpMats[0];if(this._getNegativeRotationToRef(u,r)){var f=t._tmpMats[1];f.copyFrom(e),u.multiplyToRef(e,f),this._rotateWithMatrix(f,n,r)}},t.prototype._rotateWithMatrix=function(e,n,r){n===void 0&&(n=Se.c.LOCAL);var o=this.getLocalMatrix(),u=o.m[12],f=o.m[13],v=o.m[14],y=this.getParent(),D=t._tmpMats[3],w=t._tmpMats[4];y&&n==Se.c.WORLD?(r?(D.copyFrom(r.getWorldMatrix()),y.getAbsoluteTransform().multiplyToRef(D,D)):D.copyFrom(y.getAbsoluteTransform()),w.copyFrom(D),w.invert(),o.multiplyToRef(D,o),o.multiplyToRef(e,o),o.multiplyToRef(w,o)):n==Se.c.WORLD&&r?(D.copyFrom(r.getWorldMatrix()),w.copyFrom(D),w.invert(),o.multiplyToRef(D,o),o.multiplyToRef(e,o),o.multiplyToRef(w,o)):o.multiplyToRef(e,o),o.setTranslationFromFloats(u,f,v),this.computeAbsoluteTransforms(),this._markAsDirtyAndDecompose()},t.prototype._getNegativeRotationToRef=function(e,n){var r=t._tmpMats[2];return e.copyFrom(this.getAbsoluteTransform()),n&&(e.multiplyToRef(n.getWorldMatrix(),e),d.a.ScalingToRef(n.scaling.x,n.scaling.y,n.scaling.z,r)),e.invert(),!isNaN(e.m[0])&&(r.multiplyAtIndex(0,this._scalingDeterminant),e.multiplyToRef(r,e),!0)},t.prototype.getPosition=function(e,n){e===void 0&&(e=Se.c.LOCAL),n===void 0&&(n=null);var r=d.e.Zero();return this.getPositionToRef(e,n,r),r},t.prototype.getPositionToRef=function(e,n,r){if(e===void 0&&(e=Se.c.LOCAL),e==Se.c.LOCAL){var o=this.getLocalMatrix();r.x=o.m[12],r.y=o.m[13],r.z=o.m[14]}else{var u=null;n&&(u=n.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var f=t._tmpMats[0];n&&u?(f.copyFrom(this.getAbsoluteTransform()),f.multiplyToRef(u,f)):f=this.getAbsoluteTransform(),r.x=f.m[12],r.y=f.m[13],r.z=f.m[14]}},t.prototype.getAbsolutePosition=function(e){e===void 0&&(e=null);var n=d.e.Zero();return this.getPositionToRef(Se.c.WORLD,e,n),n},t.prototype.getAbsolutePositionToRef=function(e,n){this.getPositionToRef(Se.c.WORLD,e,n)},t.prototype.computeAbsoluteTransforms=function(){if(this._compose(),this._parent)this._localMatrix.multiplyToRef(this._parent._absoluteTransform,this._absoluteTransform);else{this._absoluteTransform.copyFrom(this._localMatrix);var e=this._skeleton.getPoseMatrix();e&&this._absoluteTransform.multiplyToRef(e,this._absoluteTransform)}for(var n=this.children,r=n.length,o=0;o<r;o++)n[o].computeAbsoluteTransforms()},t.prototype.getDirection=function(e,n){n===void 0&&(n=null);var r=d.e.Zero();return this.getDirectionToRef(e,n,r),r},t.prototype.getDirectionToRef=function(e,n,r){n===void 0&&(n=null);var o=null;n&&(o=n.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var u=t._tmpMats[0];u.copyFrom(this.getAbsoluteTransform()),n&&o&&u.multiplyToRef(o,u),d.e.TransformNormalToRef(e,u,r),r.normalize()},t.prototype.getRotation=function(e,n){e===void 0&&(e=Se.c.LOCAL),n===void 0&&(n=null);var r=d.e.Zero();return this.getRotationToRef(e,n,r),r},t.prototype.getRotationToRef=function(e,n,r){e===void 0&&(e=Se.c.LOCAL),n===void 0&&(n=null);var o=t._tmpQuat;this.getRotationQuaternionToRef(e,n,o),o.toEulerAnglesToRef(r)},t.prototype.getRotationQuaternion=function(e,n){e===void 0&&(e=Se.c.LOCAL),n===void 0&&(n=null);var r=d.b.Identity();return this.getRotationQuaternionToRef(e,n,r),r},t.prototype.getRotationQuaternionToRef=function(e,n,r){if(e===void 0&&(e=Se.c.LOCAL),n===void 0&&(n=null),e==Se.c.LOCAL)this._decompose(),r.copyFrom(this._localRotation);else{var o=t._tmpMats[0],u=this.getAbsoluteTransform();n?u.multiplyToRef(n.getWorldMatrix(),o):o.copyFrom(u),o.multiplyAtIndex(0,this._scalingDeterminant),o.multiplyAtIndex(1,this._scalingDeterminant),o.multiplyAtIndex(2,this._scalingDeterminant),o.decompose(void 0,r,void 0)}},t.prototype.getRotationMatrix=function(e,n){e===void 0&&(e=Se.c.LOCAL);var r=d.a.Identity();return this.getRotationMatrixToRef(e,n,r),r},t.prototype.getRotationMatrixToRef=function(e,n,r){if(e===void 0&&(e=Se.c.LOCAL),e==Se.c.LOCAL)this.getLocalMatrix().getRotationMatrixToRef(r);else{var o=t._tmpMats[0],u=this.getAbsoluteTransform();n?u.multiplyToRef(n.getWorldMatrix(),o):o.copyFrom(u),o.multiplyAtIndex(0,this._scalingDeterminant),o.multiplyAtIndex(1,this._scalingDeterminant),o.multiplyAtIndex(2,this._scalingDeterminant),o.getRotationMatrixToRef(r)}},t.prototype.getAbsolutePositionFromLocal=function(e,n){n===void 0&&(n=null);var r=d.e.Zero();return this.getAbsolutePositionFromLocalToRef(e,n,r),r},t.prototype.getAbsolutePositionFromLocalToRef=function(e,n,r){n===void 0&&(n=null);var o=null;n&&(o=n.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var u=t._tmpMats[0];n&&o?(u.copyFrom(this.getAbsoluteTransform()),u.multiplyToRef(o,u)):u=this.getAbsoluteTransform(),d.e.TransformCoordinatesToRef(e,u,r)},t.prototype.getLocalPositionFromAbsolute=function(e,n){n===void 0&&(n=null);var r=d.e.Zero();return this.getLocalPositionFromAbsoluteToRef(e,n,r),r},t.prototype.getLocalPositionFromAbsoluteToRef=function(e,n,r){n===void 0&&(n=null);var o=null;n&&(o=n.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var u=t._tmpMats[0];u.copyFrom(this.getAbsoluteTransform()),n&&o&&u.multiplyToRef(o,u),u.invert(),d.e.TransformCoordinatesToRef(e,u,r)},t.prototype.setCurrentPoseAsRest=function(){this.setRestPose(this.getLocalMatrix())},t._tmpVecs=xe.a.BuildArray(2,d.e.Zero),t._tmpQuat=d.b.Identity(),t._tmpMats=xe.a.BuildArray(5,d.a.Identity),t}($.a),We=function(){function i(t,e,n,r,o,u,f,v,y,D){n===void 0&&(n=0),r===void 0&&(r=100),o===void 0&&(o=!1),u===void 0&&(u=1),D===void 0&&(D=!1),this.target=e,this.fromFrame=n,this.toFrame=r,this.loopAnimation=o,this.onAnimationEnd=f,this.onAnimationLoop=y,this.isAdditive=D,this._localDelayOffset=null,this._pausedDelay=null,this._runtimeAnimations=new Array,this._paused=!1,this._speedRatio=1,this._weight=-1,this._syncRoot=null,this.disposeOnEnd=!0,this.animationStarted=!1,this.onAnimationEndObservable=new S.c,this.onAnimationLoopObservable=new S.c,this._scene=t,v&&this.appendAnimations(e,v),this._speedRatio=u,t._activeAnimatables.push(this)}return Object.defineProperty(i.prototype,"syncRoot",{get:function(){return this._syncRoot},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"masterFrame",{get:function(){return this._runtimeAnimations.length===0?0:this._runtimeAnimations[0].currentFrame},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"weight",{get:function(){return this._weight},set:function(t){this._weight=t!==-1?Math.min(Math.max(t,0),1):-1},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"speedRatio",{get:function(){return this._speedRatio},set:function(t){for(var e=0;e<this._runtimeAnimations.length;e++)this._runtimeAnimations[e]._prepareForSpeedRatioChange(t);this._speedRatio=t},enumerable:!1,configurable:!0}),i.prototype.syncWith=function(t){if(this._syncRoot=t,t){var e=this._scene._activeAnimatables.indexOf(this);e>-1&&(this._scene._activeAnimatables.splice(e,1),this._scene._activeAnimatables.push(this))}return this},i.prototype.getAnimations=function(){return this._runtimeAnimations},i.prototype.appendAnimations=function(t,e){for(var n=this,r=0;r<e.length;r++){var o=e[r],u=new ve(t,o,this._scene,this);u._onLoop=function(){n.onAnimationLoopObservable.notifyObservers(n),n.onAnimationLoop&&n.onAnimationLoop()},this._runtimeAnimations.push(u)}},i.prototype.getAnimationByTargetProperty=function(t){for(var e=this._runtimeAnimations,n=0;n<e.length;n++)if(e[n].animation.targetProperty===t)return e[n].animation;return null},i.prototype.getRuntimeAnimationByTargetProperty=function(t){for(var e=this._runtimeAnimations,n=0;n<e.length;n++)if(e[n].animation.targetProperty===t)return e[n];return null},i.prototype.reset=function(){for(var t=this._runtimeAnimations,e=0;e<t.length;e++)t[e].reset(!0);this._localDelayOffset=null,this._pausedDelay=null},i.prototype.enableBlending=function(t){for(var e=this._runtimeAnimations,n=0;n<e.length;n++)e[n].animation.enableBlending=!0,e[n].animation.blendingSpeed=t},i.prototype.disableBlending=function(){for(var t=this._runtimeAnimations,e=0;e<t.length;e++)t[e].animation.enableBlending=!1},i.prototype.goToFrame=function(t){var e=this._runtimeAnimations;if(e[0]){var n=e[0].animation.framePerSecond,r=e[0].currentFrame,o=this.speedRatio===0?0:(t-r)/n*1e3/this.speedRatio;this._localDelayOffset===null&&(this._localDelayOffset=0),this._localDelayOffset-=o}for(var u=0;u<e.length;u++)e[u].goToFrame(t)},i.prototype.pause=function(){this._paused||(this._paused=!0)},i.prototype.restart=function(){this._paused=!1},i.prototype._raiseOnAnimationEnd=function(){this.onAnimationEnd&&this.onAnimationEnd(),this.onAnimationEndObservable.notifyObservers(this)},i.prototype.stop=function(t,e){if(t||e){var n=this._scene._activeAnimatables.indexOf(this);if(n>-1){for(var r=(u=this._runtimeAnimations).length-1;r>=0;r--){var o=u[r];t&&o.animation.name!=t||e&&!e(o.target)||(o.dispose(),u.splice(r,1))}u.length==0&&(this._scene._activeAnimatables.splice(n,1),this._raiseOnAnimationEnd())}}else if((r=this._scene._activeAnimatables.indexOf(this))>-1){this._scene._activeAnimatables.splice(r,1);var u=this._runtimeAnimations;for(r=0;r<u.length;r++)u[r].dispose();this._raiseOnAnimationEnd()}},i.prototype.waitAsync=function(){var t=this;return new Promise(function(e,n){t.onAnimationEndObservable.add(function(){e(t)},void 0,void 0,t,!0)})},i.prototype._animate=function(t){if(this._paused)return this.animationStarted=!1,this._pausedDelay===null&&(this._pausedDelay=t),!0;if(this._localDelayOffset===null?(this._localDelayOffset=t,this._pausedDelay=null):this._pausedDelay!==null&&(this._localDelayOffset+=t-this._pausedDelay,this._pausedDelay=null),this._weight===0)return!0;var e,n=!1,r=this._runtimeAnimations;for(e=0;e<r.length;e++){var o=r[e].animate(t-this._localDelayOffset,this.fromFrame,this.toFrame,this.loopAnimation,this._speedRatio,this._weight);n=n||o}if(this.animationStarted=n,!n){if(this.disposeOnEnd)for(e=this._scene._activeAnimatables.indexOf(this),this._scene._activeAnimatables.splice(e,1),e=0;e<r.length;e++)r[e].dispose();this._raiseOnAnimationEnd(),this.disposeOnEnd&&(this.onAnimationEnd=null,this.onAnimationLoop=null,this.onAnimationLoopObservable.clear(),this.onAnimationEndObservable.clear())}return n},i}();he.a.prototype._animate=function(){if(this.animationsEnabled){var i=be.a.Now;if(!this._animationTimeLast){if(this._pendingData.length>0)return;this._animationTimeLast=i}this.deltaTime=this.useConstantAnimationDeltaTime?16:(i-this._animationTimeLast)*this.animationTimeScale,this._animationTimeLast=i;var t=this._activeAnimatables;if(t.length!==0){this._animationTime+=this.deltaTime;for(var e=this._animationTime,n=0;n<t.length;n++){var r=t[n];!r._animate(e)&&r.disposeOnEnd&&n--}this._processLateAnimationBindings()}}},he.a.prototype.beginWeightedAnimation=function(i,t,e,n,r,o,u,f,v,y,D){n===void 0&&(n=1),o===void 0&&(o=1),D===void 0&&(D=!1);var w=this.beginAnimation(i,t,e,r,o,u,f,!1,v,y,D);return w.weight=n,w},he.a.prototype.beginAnimation=function(i,t,e,n,r,o,u,f,v,y,D){r===void 0&&(r=1),f===void 0&&(f=!0),D===void 0&&(D=!1),t>e&&r>0&&(r*=-1),f&&this.stopAnimation(i,void 0,v),u||(u=new We(this,i,t,e,n,r,o,void 0,y,D));var w=!v||v(i);if(i.animations&&w&&u.appendAnimations(i,i.animations),i.getAnimatables)for(var F=i.getAnimatables(),z=0;z<F.length;z++)this.beginAnimation(F[z],t,e,n,r,o,u,f,v,y);return u.reset(),u},he.a.prototype.beginHierarchyAnimation=function(i,t,e,n,r,o,u,f,v,y,D,w){o===void 0&&(o=1),v===void 0&&(v=!0),w===void 0&&(w=!1);var F=i.getDescendants(t),z=[];z.push(this.beginAnimation(i,e,n,r,o,u,f,v,y,void 0,w));for(var k=0,K=F;k<K.length;k++){var oe=K[k];z.push(this.beginAnimation(oe,e,n,r,o,u,f,v,y,void 0,w))}return z},he.a.prototype.beginDirectAnimation=function(i,t,e,n,r,o,u,f,v){return v===void 0&&(v=!1),o===void 0&&(o=1),e>n&&o>0&&(o*=-1),new We(this,i,e,n,r,o,u,t,f,v)},he.a.prototype.beginDirectHierarchyAnimation=function(i,t,e,n,r,o,u,f,v,y){y===void 0&&(y=!1);var D=i.getDescendants(t),w=[];w.push(this.beginDirectAnimation(i,e,n,r,o,u,f,v,y));for(var F=0,z=D;F<z.length;F++){var k=z[F];w.push(this.beginDirectAnimation(k,e,n,r,o,u,f,v,y))}return w},he.a.prototype.getAnimatableByTarget=function(i){for(var t=0;t<this._activeAnimatables.length;t++)if(this._activeAnimatables[t].target===i)return this._activeAnimatables[t];return null},he.a.prototype.getAllAnimatablesByTarget=function(i){for(var t=[],e=0;e<this._activeAnimatables.length;e++)this._activeAnimatables[e].target===i&&t.push(this._activeAnimatables[e]);return t},he.a.prototype.stopAnimation=function(i,t,e){for(var n=0,r=this.getAllAnimatablesByTarget(i);n<r.length;n++)r[n].stop(t,e)},he.a.prototype.stopAllAnimations=function(){if(this._activeAnimatables){for(var i=0;i<this._activeAnimatables.length;i++)this._activeAnimatables[i].stop();this._activeAnimatables=[]}for(var t=0,e=this.animationGroups;t<e.length;t++)e[t].stop()},he.a.prototype._registerTargetForLateAnimationBinding=function(i,t){var e=i.target;this._registeredForLateAnimationBindings.pushNoDuplicate(e),e._lateAnimationHolders||(e._lateAnimationHolders={}),e._lateAnimationHolders[i.targetPath]||(e._lateAnimationHolders[i.targetPath]={totalWeight:0,totalAdditiveWeight:0,animations:[],additiveAnimations:[],originalValue:t}),i.isAdditive?(e._lateAnimationHolders[i.targetPath].additiveAnimations.push(i),e._lateAnimationHolders[i.targetPath].totalAdditiveWeight+=i.weight):(e._lateAnimationHolders[i.targetPath].animations.push(i),e._lateAnimationHolders[i.targetPath].totalWeight+=i.weight)},he.a.prototype._processLateAnimationBindingsForMatrices=function(i){if(i.totalWeight===0&&i.totalAdditiveWeight===0)return i.originalValue;var t=1,e=d.c.Vector3[0],n=d.c.Vector3[1],r=d.c.Quaternion[0],o=0,u=i.animations[0],f=i.originalValue,v=1,y=!1;if(i.totalWeight<1)v=1-i.totalWeight,f.decompose(n,r,e);else{if(o=1,t=i.totalWeight,(v=u.weight/t)==1){if(!i.totalAdditiveWeight)return u.currentValue;y=!0}u.currentValue.decompose(n,r,e)}if(!y){n.scaleInPlace(v),e.scaleInPlace(v),r.scaleInPlace(v);for(var D=o;D<i.animations.length;D++)if((K=i.animations[D]).weight!==0){v=K.weight/t;var w=d.c.Vector3[2],F=d.c.Vector3[3],z=d.c.Quaternion[1];K.currentValue.decompose(F,z,w),F.scaleAndAddToRef(v,n),z.scaleAndAddToRef(v,r),w.scaleAndAddToRef(v,e)}}for(var k=0;k<i.additiveAnimations.length;k++){var K;(K=i.additiveAnimations[k]).weight!==0&&(w=d.c.Vector3[2],F=d.c.Vector3[3],z=d.c.Quaternion[1],K.currentValue.decompose(F,z,w),F.multiplyToRef(n,F),d.e.LerpToRef(n,F,K.weight,n),r.multiplyToRef(z,z),d.b.SlerpToRef(r,z,K.weight,r),w.scaleAndAddToRef(K.weight,e))}var oe=u?u._animationState.workValue:d.c.Matrix[0].clone();return d.a.ComposeToRef(n,r,e,oe),oe},he.a.prototype._processLateAnimationBindingsForQuaternions=function(i,t){if(i.totalWeight===0&&i.totalAdditiveWeight===0)return t;var e=i.animations[0],n=i.originalValue,r=t;if(i.totalWeight===0&&i.totalAdditiveWeight>0)r.copyFrom(n);else if(i.animations.length===1){if(d.b.SlerpToRef(n,e.currentValue,Math.min(1,i.totalWeight),r),i.totalAdditiveWeight===0)return r}else if(i.animations.length>1){var o=1,u=void 0,f=void 0;if(i.totalWeight<1){var v=1-i.totalWeight;f=[],(u=[]).push(n),f.push(v)}else{if(i.animations.length===2&&(d.b.SlerpToRef(i.animations[0].currentValue,i.animations[1].currentValue,i.animations[1].weight/i.totalWeight,t),i.totalAdditiveWeight===0))return t;u=[],f=[],o=i.totalWeight}for(var y=0;y<i.animations.length;y++){var D=i.animations[y];u.push(D.currentValue),f.push(D.weight/o)}for(var w=0,F=0;F<u.length;)F?(w+=f[F],d.b.SlerpToRef(r,u[F],f[F]/w,r),F++):(d.b.SlerpToRef(u[F],u[F+1],f[F+1]/(f[F]+f[F+1]),t),r=t,w=f[F]+f[F+1],F+=2)}for(var z=0;z<i.additiveAnimations.length;z++)(D=i.additiveAnimations[z]).weight!==0&&(r.multiplyToRef(D.currentValue,d.c.Quaternion[0]),d.b.SlerpToRef(r,d.c.Quaternion[0],D.weight,r));return r},he.a.prototype._processLateAnimationBindings=function(){if(this._registeredForLateAnimationBindings.length){for(var i=0;i<this._registeredForLateAnimationBindings.length;i++){var t=this._registeredForLateAnimationBindings.data[i];for(var e in t._lateAnimationHolders){var n=t._lateAnimationHolders[e],r=n.animations[0],o=n.originalValue,u=H.AllowMatrixDecomposeForInterpolation&&o.m,f=t[e];if(u)f=this._processLateAnimationBindingsForMatrices(n);else if(o.w!==void 0)f=this._processLateAnimationBindingsForQuaternions(n,f||d.b.Identity());else{var v=0,y=1;if(n.totalWeight<1)f=r&&o.scale?o.scale(1-n.totalWeight):r?o*(1-n.totalWeight):o.clone?o.clone():o;else if(r){y=n.totalWeight;var D=r.weight/y;f=D!==1?r.currentValue.scale?r.currentValue.scale(D):r.currentValue*D:r.currentValue,v=1}for(var w=v;w<n.animations.length;w++)(k=(z=n.animations[w]).weight/y)&&(z.currentValue.scaleAndAddToRef?z.currentValue.scaleAndAddToRef(k,f):f+=z.currentValue*k);for(var F=0;F<n.additiveAnimations.length;F++){var z,k;(k=(z=n.additiveAnimations[F]).weight)&&(z.currentValue.scaleAndAddToRef?z.currentValue.scaleAndAddToRef(k,f):f+=z.currentValue*k)}}t[e]=f}t._lateAnimationHolders={}}this._registeredForLateAnimationBindings.reset()}},Ue.prototype.copyAnimationRange=function(i,t,e,n,r){n===void 0&&(n=!1),r===void 0&&(r=null),this.animations.length===0&&(this.animations.push(new H(this.name,"_matrix",i.animations[0].framePerSecond,H.ANIMATIONTYPE_MATRIX,0)),this.animations[0].setKeys([]));var o=i.animations[0].getRange(t);if(!o)return!1;for(var u,f,v,y=o.from,D=o.to,w=i.animations[0].getKeys(),F=i.length,z=i.getParent(),k=this.getParent(),K=n&&z&&F&&this.length&&F!==this.length,oe=K&&k&&z?k.length/z.length:1,ae=n&&!k&&r&&(r.x!==1||r.y!==1||r.z!==1),ue=this.animations[0].getKeys(),de=0,me=w.length;de<me;de++)(u=w[de]).frame>=y&&u.frame<=D&&(n?(v=u.value.clone(),K?(f=v.getTranslation(),v.setTranslation(f.scaleInPlace(oe))):ae&&r?(f=v.getTranslation(),v.setTranslation(f.multiplyInPlace(r))):v=u.value):v=u.value,ue.push({frame:u.frame+e,value:v}));return this.animations[0].createRange(t,y+e,D+e),!0};var Ze=function(){function i(){}return i.prototype.getClassName=function(){return"TargetedAnimation"},i.prototype.serialize=function(){var t={};return t.animation=this.animation.serialize(),t.targetId=this.target.id,t},i}(),Qe=function(){function i(t,e){e===void 0&&(e=null),this.name=t,this._targetedAnimations=new Array,this._animatables=new Array,this._from=Number.MAX_VALUE,this._to=-Number.MAX_VALUE,this._speedRatio=1,this._loopAnimation=!1,this._isAdditive=!1,this.onAnimationEndObservable=new S.c,this.onAnimationLoopObservable=new S.c,this.onAnimationGroupLoopObservable=new S.c,this.onAnimationGroupEndObservable=new S.c,this.onAnimationGroupPauseObservable=new S.c,this.onAnimationGroupPlayObservable=new S.c,this._scene=e||ne.a.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._scene.addAnimationGroup(this)}return Object.defineProperty(i.prototype,"from",{get:function(){return this._from},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"to",{get:function(){return this._to},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isStarted",{get:function(){return this._isStarted},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isPlaying",{get:function(){return this._isStarted&&!this._isPaused},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"speedRatio",{get:function(){return this._speedRatio},set:function(t){if(this._speedRatio!==t){this._speedRatio=t;for(var e=0;e<this._animatables.length;e++)this._animatables[e].speedRatio=this._speedRatio}},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"loopAnimation",{get:function(){return this._loopAnimation},set:function(t){if(this._loopAnimation!==t){this._loopAnimation=t;for(var e=0;e<this._animatables.length;e++)this._animatables[e].loopAnimation=this._loopAnimation}},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isAdditive",{get:function(){return this._isAdditive},set:function(t){if(this._isAdditive!==t){this._isAdditive=t;for(var e=0;e<this._animatables.length;e++)this._animatables[e].isAdditive=this._isAdditive}},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"targetedAnimations",{get:function(){return this._targetedAnimations},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"animatables",{get:function(){return this._animatables},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"children",{get:function(){return this._targetedAnimations},enumerable:!1,configurable:!0}),i.prototype.addTargetedAnimation=function(t,e){var n=new Ze;n.animation=t,n.target=e;var r=t.getKeys();return this._from>r[0].frame&&(this._from=r[0].frame),this._to<r[r.length-1].frame&&(this._to=r[r.length-1].frame),this._targetedAnimations.push(n),n},i.prototype.normalize=function(t,e){t===void 0&&(t=null),e===void 0&&(e=null),t==null&&(t=this._from),e==null&&(e=this._to);for(var n=0;n<this._targetedAnimations.length;n++){var r=this._targetedAnimations[n].animation.getKeys(),o=r[0],u=r[r.length-1];if(o.frame>t){var f={frame:t,value:o.value,inTangent:o.inTangent,outTangent:o.outTangent,interpolation:o.interpolation};r.splice(0,0,f)}u.frame<e&&(f={frame:e,value:u.value,inTangent:u.inTangent,outTangent:u.outTangent,interpolation:u.interpolation},r.push(f))}return this._from=t,this._to=e,this},i.prototype._processLoop=function(t,e,n){var r=this;t.onAnimationLoop=function(){r.onAnimationLoopObservable.notifyObservers(e),r._animationLoopFlags[n]||(r._animationLoopFlags[n]=!0,r._animationLoopCount++,r._animationLoopCount===r._targetedAnimations.length&&(r.onAnimationGroupLoopObservable.notifyObservers(r),r._animationLoopCount=0,r._animationLoopFlags=[]))}},i.prototype.start=function(t,e,n,r,o){var u=this;if(t===void 0&&(t=!1),e===void 0&&(e=1),this._isStarted||this._targetedAnimations.length===0)return this;this._loopAnimation=t,this._animationLoopCount=0,this._animationLoopFlags=[];for(var f=function(){var w=v._targetedAnimations[y],F=v._scene.beginDirectAnimation(w.target,[w.animation],n!==void 0?n:v._from,r!==void 0?r:v._to,t,e,void 0,void 0,o!==void 0?o:v._isAdditive);F.onAnimationEnd=function(){u.onAnimationEndObservable.notifyObservers(w),u._checkAnimationGroupEnded(F)},v._processLoop(F,w,y),v._animatables.push(F)},v=this,y=0;y<this._targetedAnimations.length;y++)f();if(this._speedRatio=e,n!==void 0&&r!==void 0)if(n<r&&this._speedRatio<0){var D=r;r=n,n=D}else n>r&&this._speedRatio>0&&(this._speedRatio=-e);return this._isStarted=!0,this._isPaused=!1,this.onAnimationGroupPlayObservable.notifyObservers(this),this},i.prototype.pause=function(){if(!this._isStarted)return this;this._isPaused=!0;for(var t=0;t<this._animatables.length;t++)this._animatables[t].pause();return this.onAnimationGroupPauseObservable.notifyObservers(this),this},i.prototype.play=function(t){return this.isStarted&&this._animatables.length===this._targetedAnimations.length?(t!==void 0&&(this.loopAnimation=t),this.restart()):(this.stop(),this.start(t,this._speedRatio)),this._isPaused=!1,this},i.prototype.reset=function(){if(!this._isStarted)return this.play(),this.goToFrame(0),this.stop(),this;for(var t=0;t<this._animatables.length;t++)this._animatables[t].reset();return this},i.prototype.restart=function(){if(!this._isStarted)return this;for(var t=0;t<this._animatables.length;t++)this._animatables[t].restart();return this.onAnimationGroupPlayObservable.notifyObservers(this),this},i.prototype.stop=function(){if(!this._isStarted)return this;for(var t=this._animatables.slice(),e=0;e<t.length;e++)t[e].stop();return this._isStarted=!1,this},i.prototype.setWeightForAllAnimatables=function(t){for(var e=0;e<this._animatables.length;e++)this._animatables[e].weight=t;return this},i.prototype.syncAllAnimationsWith=function(t){for(var e=0;e<this._animatables.length;e++)this._animatables[e].syncWith(t);return this},i.prototype.goToFrame=function(t){if(!this._isStarted)return this;for(var e=0;e<this._animatables.length;e++)this._animatables[e].goToFrame(t);return this},i.prototype.dispose=function(){this._targetedAnimations=[],this._animatables=[];var t=this._scene.animationGroups.indexOf(this);t>-1&&this._scene.animationGroups.splice(t,1),this.onAnimationEndObservable.clear(),this.onAnimationGroupEndObservable.clear(),this.onAnimationGroupPauseObservable.clear(),this.onAnimationGroupPlayObservable.clear(),this.onAnimationLoopObservable.clear(),this.onAnimationGroupLoopObservable.clear()},i.prototype._checkAnimationGroupEnded=function(t){var e=this._animatables.indexOf(t);e>-1&&this._animatables.splice(e,1),this._animatables.length===0&&(this._isStarted=!1,this.onAnimationGroupEndObservable.notifyObservers(this))},i.prototype.clone=function(t,e){for(var n=new i(t||this.name,this._scene),r=0,o=this._targetedAnimations;r<o.length;r++){var u=o[r];n.addTargetedAnimation(u.animation.clone(),e?e(u.target):u.target)}return n},i.prototype.serialize=function(){var t={};t.name=this.name,t.from=this.from,t.to=this.to,t.targetedAnimations=[];for(var e=0;e<this.targetedAnimations.length;e++){var n=this.targetedAnimations[e];t.targetedAnimations[e]=n.serialize()}return t},i.Parse=function(t,e){for(var n=new i(t.name,e),r=0;r<t.targetedAnimations.length;r++){var o=t.targetedAnimations[r],u=H.Parse(o.animation),f=o.targetId;if(o.animation.property==="influence"){var v=e.getMorphTargetById(f);v&&n.addTargetedAnimation(u,v)}else{var y=e.getNodeByID(f);y!=null&&n.addTargetedAnimation(u,y)}}return t.from!==null&&t.to!==null&&n.normalize(t.from,t.to),n},i.MakeAnimationAdditive=function(t,e,n,r,o){e===void 0&&(e=0),r===void 0&&(r=!1);var u=t;r&&(u=t.clone(o||u.name));for(var f=u.targetedAnimations,v=0;v<f.length;v++){var y=f[v];H.MakeAnimationAdditive(y.animation,e,n)}return u.isAdditive=!0,u},i.prototype.getClassName=function(){return"AnimationGroup"},i.prototype.toString=function(t){var e="Name: "+this.name;return e+=", type: "+this.getClassName(),t&&(e+=", from: "+this._from,e+=", to: "+this._to,e+=", isStarted: "+this._isStarted,e+=", speedRatio: "+this._speedRatio,e+=", targetedAnimations length: "+this._targetedAnimations.length,e+=", animatables length: "+this._animatables),e},i}(),Xe=function(){this.enableBlending=!1,this.blendingSpeed=.01,this.loopMode=H.ANIMATIONLOOPMODE_CYCLE},nt=c(72),Ke=function(){function i(){this._easingMode=i.EASINGMODE_EASEIN}return i.prototype.setEasingMode=function(t){var e=Math.min(Math.max(t,0),2);this._easingMode=e},i.prototype.getEasingMode=function(){return this._easingMode},i.prototype.easeInCore=function(t){throw new Error("You must implement this method")},i.prototype.ease=function(t){switch(this._easingMode){case i.EASINGMODE_EASEIN:return this.easeInCore(t);case i.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-t)}return t>=.5?.5*(1-this.easeInCore(2*(1-t)))+.5:.5*this.easeInCore(2*t)},i.EASINGMODE_EASEIN=0,i.EASINGMODE_EASEOUT=1,i.EASINGMODE_EASEINOUT=2,i}(),ct=function(i){function t(){return i!==null&&i.apply(this,arguments)||this}return Object(p.d)(t,i),t.prototype.easeInCore=function(e){return e=Math.max(0,Math.min(1,e)),1-Math.sqrt(1-e*e)},t}(Ke),ot=function(i){function t(e){e===void 0&&(e=1);var n=i.call(this)||this;return n.amplitude=e,n}return Object(p.d)(t,i),t.prototype.easeInCore=function(e){var n=Math.max(0,this.amplitude);return Math.pow(e,3)-e*n*Math.sin(3.141592653589793*e)},t}(Ke),_t=function(i){function t(e,n){e===void 0&&(e=3),n===void 0&&(n=2);var r=i.call(this)||this;return r.bounces=e,r.bounciness=n,r}return Object(p.d)(t,i),t.prototype.easeInCore=function(e){var n=Math.max(0,this.bounces),r=this.bounciness;r<=1&&(r=1.001);var o=Math.pow(r,n),u=1-r,f=(1-o)/u+.5*o,v=e*f,y=Math.log(-v*(1-r)+1)/Math.log(r),D=Math.floor(y),w=D+1,F=(1-Math.pow(r,D))/(u*f),z=.5*(F+(1-Math.pow(r,w))/(u*f)),k=e-z,K=z-F;return-Math.pow(1/r,n-D)/(K*K)*(k-K)*(k+K)},t}(Ke),gt=function(i){function t(){return i!==null&&i.apply(this,arguments)||this}return Object(p.d)(t,i),t.prototype.easeInCore=function(e){return e*e*e},t}(Ke),At=function(i){function t(e,n){e===void 0&&(e=3),n===void 0&&(n=3);var r=i.call(this)||this;return r.oscillations=e,r.springiness=n,r}return Object(p.d)(t,i),t.prototype.easeInCore=function(e){var n=Math.max(0,this.oscillations),r=Math.max(0,this.springiness);return(r==0?e:(Math.exp(r*e)-1)/(Math.exp(r)-1))*Math.sin((6.283185307179586*n+1.5707963267948966)*e)},t}(Ke),wt=function(i){function t(e){e===void 0&&(e=2);var n=i.call(this)||this;return n.exponent=e,n}return Object(p.d)(t,i),t.prototype.easeInCore=function(e){return this.exponent<=0?e:(Math.exp(this.exponent*e)-1)/(Math.exp(this.exponent)-1)},t}(Ke),Qt=function(i){function t(e){e===void 0&&(e=2);var n=i.call(this)||this;return n.power=e,n}return Object(p.d)(t,i),t.prototype.easeInCore=function(e){var n=Math.max(0,this.power);return Math.pow(e,n)},t}(Ke),Wt=function(i){function t(){return i!==null&&i.apply(this,arguments)||this}return Object(p.d)(t,i),t.prototype.easeInCore=function(e){return e*e},t}(Ke),Ft=function(i){function t(){return i!==null&&i.apply(this,arguments)||this}return Object(p.d)(t,i),t.prototype.easeInCore=function(e){return e*e*e*e},t}(Ke),Ht=function(i){function t(){return i!==null&&i.apply(this,arguments)||this}return Object(p.d)(t,i),t.prototype.easeInCore=function(e){return e*e*e*e*e},t}(Ke),fn=function(i){function t(){return i!==null&&i.apply(this,arguments)||this}return Object(p.d)(t,i),t.prototype.easeInCore=function(e){return 1-Math.sin(1.5707963267948966*(1-e))},t}(Ke),ln=function(i){function t(e,n,r,o){e===void 0&&(e=0),n===void 0&&(n=0),r===void 0&&(r=1),o===void 0&&(o=1);var u=i.call(this)||this;return u.x1=e,u.y1=n,u.x2=r,u.y2=o,u}return Object(p.d)(t,i),t.prototype.easeInCore=function(e){return nt.c.Interpolate(e,this.x1,this.y1,this.x2,this.y2)},t}(Ke),Ln=function(){function i(t,e,n){this.frame=t,this.action=e,this.onlyOnce=n,this.isDone=!1}return i.prototype._clone=function(){return new i(this.frame,this.action,this.onlyOnce)},i}(),Ne=c(7),vr=function(i){function t(){return i!==null&&i.apply(this,arguments)||this}return Object(p.d)(t,i),t}(E.a),On=function(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]},$n=function(i){function t(e){var n=i.call(this)||this;return n._wasAddedToScene=!1,n.scene=e,n.sounds=[],n.effectLayers=[],n.layers=[],n.lensFlareSystems=[],n.proceduralTextures=[],n.reflectionProbes=[],e.onDisposeObservable.add(function(){n._wasAddedToScene||n.dispose()}),n}return Object(p.d)(t,i),t.prototype.instantiateModelsToScene=function(e,n){var r=this;n===void 0&&(n=!1);var o={},u={},f=new On,v=[],y=[],D={doNotInstantiate:!0},w=function(F,z){if(o[F.uniqueId]=z.uniqueId,u[z.uniqueId]=z,e&&(z.name=e(F.name)),z instanceof Ne.a){var k=z;if(k.morphTargetManager){var K=F.morphTargetManager;k.morphTargetManager=K.clone();for(var oe=0;oe<K.numTargets;oe++){var ae=K.getTarget(oe),ue=k.morphTargetManager.getTarget(oe);o[ae.uniqueId]=ue.uniqueId,u[ue.uniqueId]=ue}}}};return this.transformNodes.forEach(function(F){if(!F.parent){var z=F.instantiateHierarchy(null,D,function(k,K){w(k,K)});z&&f.rootNodes.push(z)}}),this.meshes.forEach(function(F){if(!F.parent){var z=F.instantiateHierarchy(null,D,function(k,K){if(w(k,K),K.material){var oe=K;if(oe.material)if(n){var ae=k.material;if(y.indexOf(ae)===-1){var ue=ae.clone(e?e(ae.name):"Clone of "+ae.name);if(y.push(ae),o[ae.uniqueId]=ue.uniqueId,u[ue.uniqueId]=ue,ae.getClassName()==="MultiMaterial"){for(var de=ae,me=0,ye=de.subMaterials;me<ye.length;me++){var Ee=ye[me];Ee&&(ue=Ee.clone(e?e(Ee.name):"Clone of "+Ee.name),y.push(Ee),o[Ee.uniqueId]=ue.uniqueId,u[ue.uniqueId]=ue)}de.subMaterials=de.subMaterials.map(function(Ae){return Ae&&u[o[Ae.uniqueId]]})}}oe.material=u[o[ae.uniqueId]]}else oe.material.getClassName()==="MultiMaterial"?r.scene.multiMaterials.indexOf(oe.material)===-1&&r.scene.addMultiMaterial(oe.material):r.scene.materials.indexOf(oe.material)===-1&&r.scene.addMaterial(oe.material)}});z&&f.rootNodes.push(z)}}),this.skeletons.forEach(function(F){var z=F.clone(e?e(F.name):"Clone of "+F.name);F.overrideMesh&&(z.overrideMesh=u[o[F.overrideMesh.uniqueId]]);for(var k=0,K=r.meshes;k<K.length;k++){var oe=K[k];if(oe.skeleton===F&&!oe.isAnInstance){if(u[o[oe.uniqueId]].skeleton=z,v.indexOf(z)!==-1)continue;v.push(z);for(var ae=0,ue=z.bones;ae<ue.length;ae++){var de=ue[ae];de._linkedTransformNode&&(de._linkedTransformNode=u[o[de._linkedTransformNode.uniqueId]])}}}f.skeletons.push(z)}),this.animationGroups.forEach(function(F){var z=F.clone(F.name,function(k){return u[o[k.uniqueId]]||k});f.animationGroups.push(z)}),f},t.prototype.addAllToScene=function(){var e=this;this._wasAddedToScene=!0,this.cameras.forEach(function(o){e.scene.addCamera(o)}),this.lights.forEach(function(o){e.scene.addLight(o)}),this.meshes.forEach(function(o){e.scene.addMesh(o)}),this.skeletons.forEach(function(o){e.scene.addSkeleton(o)}),this.animations.forEach(function(o){e.scene.addAnimation(o)}),this.animationGroups.forEach(function(o){e.scene.addAnimationGroup(o)}),this.multiMaterials.forEach(function(o){e.scene.addMultiMaterial(o)}),this.materials.forEach(function(o){e.scene.addMaterial(o)}),this.morphTargetManagers.forEach(function(o){e.scene.addMorphTargetManager(o)}),this.geometries.forEach(function(o){e.scene.addGeometry(o)}),this.transformNodes.forEach(function(o){e.scene.addTransformNode(o)}),this.actionManagers.forEach(function(o){e.scene.addActionManager(o)}),this.textures.forEach(function(o){e.scene.addTexture(o)}),this.reflectionProbes.forEach(function(o){e.scene.addReflectionProbe(o)}),this.environmentTexture&&(this.scene.environmentTexture=this.environmentTexture);for(var n=0,r=this.scene._serializableComponents;n<r.length;n++)r[n].addFromContainer(this)},t.prototype.removeAllFromScene=function(){var e=this;this._wasAddedToScene=!1,this.cameras.forEach(function(o){e.scene.removeCamera(o)}),this.lights.forEach(function(o){e.scene.removeLight(o)}),this.meshes.forEach(function(o){e.scene.removeMesh(o)}),this.skeletons.forEach(function(o){e.scene.removeSkeleton(o)}),this.animations.forEach(function(o){e.scene.removeAnimation(o)}),this.animationGroups.forEach(function(o){e.scene.removeAnimationGroup(o)}),this.multiMaterials.forEach(function(o){e.scene.removeMultiMaterial(o)}),this.materials.forEach(function(o){e.scene.removeMaterial(o)}),this.morphTargetManagers.forEach(function(o){e.scene.removeMorphTargetManager(o)}),this.geometries.forEach(function(o){e.scene.removeGeometry(o)}),this.transformNodes.forEach(function(o){e.scene.removeTransformNode(o)}),this.actionManagers.forEach(function(o){e.scene.removeActionManager(o)}),this.textures.forEach(function(o){e.scene.removeTexture(o)}),this.reflectionProbes.forEach(function(o){e.scene.removeReflectionProbe(o)}),this.environmentTexture===this.scene.environmentTexture&&(this.scene.environmentTexture=null);for(var n=0,r=this.scene._serializableComponents;n<r.length;n++)r[n].removeFromContainer(this)},t.prototype.dispose=function(){this.cameras.forEach(function(r){r.dispose()}),this.cameras=[],this.lights.forEach(function(r){r.dispose()}),this.lights=[],this.meshes.forEach(function(r){r.dispose()}),this.meshes=[],this.skeletons.forEach(function(r){r.dispose()}),this.skeletons=[],this.animationGroups.forEach(function(r){r.dispose()}),this.animationGroups=[],this.multiMaterials.forEach(function(r){r.dispose()}),this.multiMaterials=[],this.materials.forEach(function(r){r.dispose()}),this.materials=[],this.geometries.forEach(function(r){r.dispose()}),this.geometries=[],this.transformNodes.forEach(function(r){r.dispose()}),this.transformNodes=[],this.actionManagers.forEach(function(r){r.dispose()}),this.actionManagers=[],this.textures.forEach(function(r){r.dispose()}),this.textures=[],this.reflectionProbes.forEach(function(r){r.dispose()}),this.reflectionProbes=[],this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(var e=0,n=this.scene._serializableComponents;e<n.length;e++)n[e].removeFromContainer(this,!0)},t.prototype._moveAssets=function(e,n,r){if(e)for(var o=0,u=e;o<u.length;o++){var f=u[o],v=!0;if(r){for(var y=0,D=r;y<D.length;y++)if(f===D[y]){v=!1;break}}v&&n.push(f)}},t.prototype.moveAllFromScene=function(e){for(var n in this._wasAddedToScene=!1,e===void 0&&(e=new vr),this)this.hasOwnProperty(n)&&(this[n]=this[n]||(n==="environmentTexture"?null:[]),this._moveAssets(this.scene[n],this[n],e[n]));this.environmentTexture=this.scene.environmentTexture,this.removeAllFromScene()},t.prototype.createRootMesh=function(){var e=new Ne.a("assetContainerRootMesh",this.scene);return this.meshes.forEach(function(n){n.parent||e.addChild(n)}),this.meshes.unshift(e),e},t.prototype.mergeAnimationsTo=function(e,n,r){if(e===void 0&&(e=ne.a.LastCreatedScene),r===void 0&&(r=null),!e)return _.a.Error("No scene available to merge animations to"),[];var o=r||function(f){var v=null,y=f.animations.length?f.animations[0].targetProperty:"",D=f.name.split(".").join("").split("_primitive")[0];switch(y){case"position":case"rotationQuaternion":v=e.getTransformNodeByName(f.name)||e.getTransformNodeByName(D);break;case"influence":v=e.getMorphTargetByName(f.name)||e.getMorphTargetByName(D);break;default:v=e.getNodeByName(f.name)||e.getNodeByName(D)}return v};this.getNodes().forEach(function(f){var v=o(f);if(v!==null){for(var y=function(F){for(var z=0,k=v.animations.filter(function(ae){return ae.targetProperty===F.targetProperty});z<k.length;z++){var K=k[z],oe=v.animations.indexOf(K,0);oe>-1&&v.animations.splice(oe,1)}},D=0,w=f.animations;D<w.length;D++)y(w[D]);v.animations=v.animations.concat(f.animations)}});var u=new Array;return this.animationGroups.slice().forEach(function(f){u.push(f.clone(f.name,o)),f.animatables.forEach(function(v){v.stop()})}),n.forEach(function(f){var v=o(f.target);v&&(e.beginAnimation(v,f.fromFrame,f.toFrame,f.loopAnimation,f.speedRatio,f.onAnimationEnd?f.onAnimationEnd:void 0,void 0,!0,void 0,f.onAnimationLoop?f.onAnimationLoop:void 0),e.stopAnimation(f.target))}),u},t}(E.a),Ge=c(13),zn=function(){function i(t){this.SMOOTHING=.75,this.FFT_SIZE=512,this.BARGRAPHAMPLITUDE=256,this.DEBUGCANVASPOS={x:20,y:20},this.DEBUGCANVASSIZE={width:320,height:200},this._scene=t,this._audioEngine=Ge.a.audioEngine,this._audioEngine.canUseWebAudio&&this._audioEngine.audioContext&&(this._webAudioAnalyser=this._audioEngine.audioContext.createAnalyser(),this._webAudioAnalyser.minDecibels=-140,this._webAudioAnalyser.maxDecibels=0,this._byteFreqs=new Uint8Array(this._webAudioAnalyser.frequencyBinCount),this._byteTime=new Uint8Array(this._webAudioAnalyser.frequencyBinCount),this._floatFreqs=new Float32Array(this._webAudioAnalyser.frequencyBinCount))}return i.prototype.getFrequencyBinCount=function(){return this._audioEngine.canUseWebAudio?this._webAudioAnalyser.frequencyBinCount:0},i.prototype.getByteFrequencyData=function(){return this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser.smoothingTimeConstant=this.SMOOTHING,this._webAudioAnalyser.fftSize=this.FFT_SIZE,this._webAudioAnalyser.getByteFrequencyData(this._byteFreqs)),this._byteFreqs},i.prototype.getByteTimeDomainData=function(){return this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser.smoothingTimeConstant=this.SMOOTHING,this._webAudioAnalyser.fftSize=this.FFT_SIZE,this._webAudioAnalyser.getByteTimeDomainData(this._byteTime)),this._byteTime},i.prototype.getFloatFrequencyData=function(){return this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser.smoothingTimeConstant=this.SMOOTHING,this._webAudioAnalyser.fftSize=this.FFT_SIZE,this._webAudioAnalyser.getFloatFrequencyData(this._floatFreqs)),this._floatFreqs},i.prototype.drawDebugCanvas=function(){var t=this;if(this._audioEngine.canUseWebAudio&&(this._debugCanvas||(this._debugCanvas=document.createElement("canvas"),this._debugCanvas.width=this.DEBUGCANVASSIZE.width,this._debugCanvas.height=this.DEBUGCANVASSIZE.height,this._debugCanvas.style.position="absolute",this._debugCanvas.style.top=this.DEBUGCANVASPOS.y+"px",this._debugCanvas.style.left=this.DEBUGCANVASPOS.x+"px",this._debugCanvasContext=this._debugCanvas.getContext("2d"),document.body.appendChild(this._debugCanvas),this._registerFunc=function(){t.drawDebugCanvas()},this._scene.registerBeforeRender(this._registerFunc)),this._registerFunc&&this._debugCanvasContext)){var e=this.getByteFrequencyData();this._debugCanvasContext.fillStyle="rgb(0, 0, 0)",this._debugCanvasContext.fillRect(0,0,this.DEBUGCANVASSIZE.width,this.DEBUGCANVASSIZE.height);for(var n=0;n<this.getFrequencyBinCount();n++){var r=e[n]/this.BARGRAPHAMPLITUDE,o=this.DEBUGCANVASSIZE.height*r,u=this.DEBUGCANVASSIZE.height-o-1,f=this.DEBUGCANVASSIZE.width/this.getFrequencyBinCount(),v=n/this.getFrequencyBinCount()*360;this._debugCanvasContext.fillStyle="hsl("+v+", 100%, 50%)",this._debugCanvasContext.fillRect(n*f,u,f,o)}}},i.prototype.stopDebugCanvas=function(){this._debugCanvas&&(this._registerFunc&&(this._scene.unregisterBeforeRender(this._registerFunc),this._registerFunc=null),document.body.removeChild(this._debugCanvas),this._debugCanvas=null,this._debugCanvasContext=null)},i.prototype.connectAudioNodes=function(t,e){this._audioEngine.canUseWebAudio&&(t.connect(this._webAudioAnalyser),this._webAudioAnalyser.connect(e))},i.prototype.dispose=function(){this._audioEngine.canUseWebAudio&&this._webAudioAnalyser.disconnect()},i}();Ge.a.AudioEngineFactory=function(i){return new No(i)};var No=function(){function i(t){var e=this;t===void 0&&(t=null),this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!0,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new S.c,this.onAudioLockedObservable=new S.c,this._tryToRun=!1,this._onResize=function(){e._moveButtonToTopLeft()},window.AudioContext===void 0&&window.webkitAudioContext===void 0||(window.AudioContext=window.AudioContext||window.webkitAudioContext,this.canUseWebAudio=!0);var n=document.createElement("audio");this._hostElement=t;try{n&&n.canPlayType&&(n.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||n.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(r){}try{n&&n.canPlayType&&n.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(r){}}return Object.defineProperty(i.prototype,"audioContext",{get:function(){return this._audioContextInitialized?this.unlocked||this._muteButton||this._displayMuteButton():this._initializeAudioContext(),this._audioContext},enumerable:!1,configurable:!0}),i.prototype.lock=function(){this._triggerSuspendedState()},i.prototype.unlock=function(){this._triggerRunningState()},i.prototype._resumeAudioContext=function(){var t;return this._audioContext.resume!==void 0&&(t=this._audioContext.resume()),t||Promise.resolve()},i.prototype._initializeAudioContext=function(){try{this.canUseWebAudio&&(this._audioContext=new AudioContext,this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this.masterGain.connect(this._audioContext.destination),this._audioContextInitialized=!0,this._audioContext.state==="running"&&this._triggerRunningState())}catch(t){this.canUseWebAudio=!1,_.a.Error("Web Audio: "+t.message)}},i.prototype._triggerRunningState=function(){var t=this;this._tryToRun||(this._tryToRun=!0,this._resumeAudioContext().then(function(){t._tryToRun=!1,t._muteButton&&t._hideMuteButton(),t.unlocked=!0,t.onAudioUnlockedObservable.notifyObservers(t)}).catch(function(){t._tryToRun=!1,t.unlocked=!1}))},i.prototype._triggerSuspendedState=function(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()},i.prototype._displayMuteButton=function(){var t=this;if(!this.useCustomUnlockedButton&&!this._muteButton){this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";var e=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",n=document.createElement("style");n.appendChild(document.createTextNode(e)),document.getElementsByTagName("head")[0].appendChild(n),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",function(){t._triggerRunningState()},!0),this._muteButton.addEventListener("click",function(){t._triggerRunningState()},!0),window.addEventListener("resize",this._onResize)}},i.prototype._moveButtonToTopLeft=function(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")},i.prototype._hideMuteButton=function(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)},i.prototype.dispose=function(){this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear()},i.prototype.getGlobalVolume=function(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1},i.prototype.setGlobalVolume=function(t){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=t)},i.prototype.connectToAnalyser=function(t){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=t,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))},i}(),et=c(12),dr=c(21),Qr=function(){function i(t,e,n,r,o){var u,f,v,y,D=this;if(r===void 0&&(r=null),this.autoplay=!1,this.loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.spatialSound=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new S.c,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._startOffset=0,this._position=d.e.Zero(),this._positionInEmitterSpace=!1,this._localDirection=new d.e(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=t,this._scene=n,i._SceneComponentInitialization(n),this._readyToPlayCallback=r,this._customAttenuationFunction=function(oe,ae,ue,de,me){return ae<ue?oe*(1-ae/ue):0},o&&(this.autoplay=o.autoplay||!1,this.loop=o.loop||!1,o.volume!==void 0&&(this._volume=o.volume),this.spatialSound=(u=o.spatialSound)!==null&&u!==void 0&&u,this.maxDistance=(f=o.maxDistance)!==null&&f!==void 0?f:100,this.useCustomAttenuation=(v=o.useCustomAttenuation)!==null&&v!==void 0&&v,this.rolloffFactor=o.rolloffFactor||1,this.refDistance=o.refDistance||1,this.distanceModel=o.distanceModel||"linear",this._playbackRate=o.playbackRate||1,this._streaming=(y=o.streaming)!==null&&y!==void 0&&y,this._length=o.length,this._offset=o.offset),Ge.a.audioEngine.canUseWebAudio&&Ge.a.audioEngine.audioContext){this._soundGain=Ge.a.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this.spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);var w=!0;if(e)try{typeof e=="string"?this._urlType="String":e instanceof ArrayBuffer?this._urlType="ArrayBuffer":e instanceof MediaStream?this._urlType="MediaStream":Array.isArray(e)&&(this._urlType="Array");var F=[],z=!1;switch(this._urlType){case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Ge.a.audioEngine.audioContext.createMediaStreamSource(e),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":e.byteLength>0&&(z=!0,this._soundLoaded(e));break;case"String":F.push(e);case"Array":F.length===0&&(F=e);for(var k=0;k<F.length;k++){var K=F[k];if(z=o&&o.skipCodecCheck||K.indexOf(".mp3",K.length-4)!==-1&&Ge.a.audioEngine.isMP3supported||K.indexOf(".ogg",K.length-4)!==-1&&Ge.a.audioEngine.isOGGsupported||K.indexOf(".wav",K.length-4)!==-1||K.indexOf(".m4a",K.length-4)!==-1||K.indexOf("blob:")!==-1){this._streaming?(this._htmlAudioElement=new Audio(K),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,et.b.SetCorsBehavior(K,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",function(){D._isReadyToPlay=!0,D.autoplay&&D.play(0,D._offset,D._length),D._readyToPlayCallback&&D._readyToPlayCallback()}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(K,function(oe){D._soundLoaded(oe)},void 0,!0,!0,function(oe){oe&&_.a.Error("XHR "+oe.status+" error on: "+K+"."),_.a.Error("Sound creation aborted."),D._scene.mainSoundTrack.removeSound(D)});break}}break;default:w=!1}w?z||(this._isReadyToPlay=!0,this._readyToPlayCallback&&window.setTimeout(function(){D._readyToPlayCallback&&D._readyToPlayCallback()},1e3)):_.a.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(oe){_.a.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),Ge.a.audioEngine.WarnedWebAudioUnsupported||(_.a.Error("Web Audio is not supported by your browser."),Ge.a.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&window.setTimeout(function(){D._readyToPlayCallback&&D._readyToPlayCallback()},1e3)}return Object.defineProperty(i.prototype,"currentTime",{get:function(){if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;var t=this._startOffset;return this.isPlaying&&Ge.a.audioEngine.audioContext&&(t+=Ge.a.audioEngine.audioContext.currentTime-this._startTime),t},enumerable:!1,configurable:!0}),i.prototype.dispose=function(){Ge.a.audioEngine.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,this.soundTrackId===-1?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement)),this._streamingSource&&this._streamingSource.disconnect(),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null))},i.prototype.isReady=function(){return this._isReadyToPlay},i.prototype._soundLoaded=function(t){var e=this;Ge.a.audioEngine.audioContext&&Ge.a.audioEngine.audioContext.decodeAudioData(t,function(n){e._audioBuffer=n,e._isReadyToPlay=!0,e.autoplay&&e.play(0,e._offset,e._length),e._readyToPlayCallback&&e._readyToPlayCallback()},function(n){_.a.Error("Error while decoding audio data for: "+e.name+" / Error: "+n)})},i.prototype.setAudioBuffer=function(t){Ge.a.audioEngine.canUseWebAudio&&(this._audioBuffer=t,this._isReadyToPlay=!0)},i.prototype.updateOptions=function(t){var e,n,r,o,u,f,v,y,D;t&&(this.loop=(e=t.loop)!==null&&e!==void 0?e:this.loop,this.maxDistance=(n=t.maxDistance)!==null&&n!==void 0?n:this.maxDistance,this.useCustomAttenuation=(r=t.useCustomAttenuation)!==null&&r!==void 0?r:this.useCustomAttenuation,this.rolloffFactor=(o=t.rolloffFactor)!==null&&o!==void 0?o:this.rolloffFactor,this.refDistance=(u=t.refDistance)!==null&&u!==void 0?u:this.refDistance,this.distanceModel=(f=t.distanceModel)!==null&&f!==void 0?f:this.distanceModel,this._playbackRate=(v=t.playbackRate)!==null&&v!==void 0?v:this._playbackRate,this._length=(y=t.length)!==null&&y!==void 0?y:void 0,this._offset=(D=t.offset)!==null&&D!==void 0?D:void 0,this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),this._offset!==void 0&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),this._length!==void 0&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))},i.prototype._createSpatialParameters=function(){Ge.a.audioEngine.canUseWebAudio&&Ge.a.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=Ge.a.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))},i.prototype._updateSpatialParameters=function(){this.spatialSound&&this._soundPanner&&(this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel))},i.prototype.switchPanningModelToHRTF=function(){this._panningModel="HRTF",this._switchPanningModel()},i.prototype.switchPanningModelToEqualPower=function(){this._panningModel="equalpower",this._switchPanningModel()},i.prototype._switchPanningModel=function(){Ge.a.audioEngine.canUseWebAudio&&this.spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)},i.prototype.connectToSoundTrackAudioNode=function(t){Ge.a.audioEngine.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(t),this._isOutputConnected=!0)},i.prototype.setDirectionalCone=function(t,e,n){e<t?_.a.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=t,this._coneOuterAngle=e,this._coneOuterGain=n,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))},Object.defineProperty(i.prototype,"directionalConeInnerAngle",{get:function(){return this._coneInnerAngle},set:function(t){if(t!=this._coneInnerAngle){if(this._coneOuterAngle<t)return void _.a.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=t,Ge.a.audioEngine.canUseWebAudio&&this.spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"directionalConeOuterAngle",{get:function(){return this._coneOuterAngle},set:function(t){if(t!=this._coneOuterAngle){if(t<this._coneInnerAngle)return void _.a.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=t,Ge.a.audioEngine.canUseWebAudio&&this.spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}},enumerable:!1,configurable:!0}),i.prototype.setPosition=function(t){this._position=t,Ge.a.audioEngine.canUseWebAudio&&this.spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&this._soundPanner.setPosition(this._position.x,this._position.y,this._position.z)},i.prototype.setLocalDirectionToMesh=function(t){this._localDirection=t,Ge.a.audioEngine.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()},i.prototype._updateDirection=function(){if(this._connectedTransformNode&&this._soundPanner){var t=this._connectedTransformNode.getWorldMatrix(),e=d.e.TransformNormal(this._localDirection,t);e.normalize(),this._soundPanner.setOrientation(e.x,e.y,e.z)}},i.prototype.updateDistanceFromListener=function(){if(Ge.a.audioEngine.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){var t=this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,t,this.maxDistance,this.refDistance,this.rolloffFactor)}},i.prototype.setAttenuationFunction=function(t){this._customAttenuationFunction=t},i.prototype.play=function(t,e,n){var r=this;if(this._isReadyToPlay&&this._scene.audioEnabled&&Ge.a.audioEngine.audioContext)try{this._startOffset<0&&(t=-this._startOffset,this._startOffset=0);var o=t?Ge.a.audioEngine.audioContext.currentTime+t:Ge.a.audioEngine.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this.spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||this._soundPanner.setPosition(this._position.x,this._position.y,this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming)this._streamingSource||(this._streamingSource=Ge.a.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=function(){r._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode),this._htmlAudioElement&&(u=function(){if(Ge.a.audioEngine.unlocked){var f=r._htmlAudioElement.play();f!==void 0&&f.catch(function(v){Ge.a.audioEngine.lock(),(r.loop||r.autoplay)&&Ge.a.audioEngine.onAudioUnlockedObservable.addOnce(function(){u()})})}else(r.loop||r.autoplay)&&Ge.a.audioEngine.onAudioUnlockedObservable.addOnce(function(){u()})})();else{var u=function(){if(Ge.a.audioEngine.audioContext){if(n=n||r._length,e=e||r._offset,r._soundSource){var f=r._soundSource;f.onended=function(){f.disconnect()}}if(r._soundSource=Ge.a.audioEngine.audioContext.createBufferSource(),r._soundSource&&r._inputAudioNode){r._soundSource.buffer=r._audioBuffer,r._soundSource.connect(r._inputAudioNode),r._soundSource.loop=r.loop,e!==void 0&&(r._soundSource.loopStart=e),n!==void 0&&(r._soundSource.loopEnd=(0|e)+n),r._soundSource.playbackRate.value=r._playbackRate,r._soundSource.onended=function(){r._onended()},o=t?Ge.a.audioEngine.audioContext.currentTime+t:Ge.a.audioEngine.audioContext.currentTime;var v=r.isPaused?r._startOffset%r._soundSource.buffer.duration:e||0;r._soundSource.start(o,v,r.loop?void 0:n)}}};Ge.a.audioEngine.audioContext.state==="suspended"?setTimeout(function(){Ge.a.audioEngine.audioContext.state==="suspended"?(Ge.a.audioEngine.lock(),(r.loop||r.autoplay)&&Ge.a.audioEngine.onAudioUnlockedObservable.addOnce(function(){u()})):u()},500):u()}this._startTime=o,this.isPlaying=!0,this.isPaused=!1}catch(f){_.a.Error("Error while trying to play audio: "+this.name+", "+f.message)}},i.prototype._onended=function(){this.isPlaying=!1,this._startOffset=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)},i.prototype.stop=function(t){var e=this;if(this.isPlaying){if(this._streaming)this._htmlAudioElement?(this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0)):this._streamingSource.disconnect(),this.isPlaying=!1;else if(Ge.a.audioEngine.audioContext&&this._soundSource){var n=t?Ge.a.audioEngine.audioContext.currentTime+t:Ge.a.audioEngine.audioContext.currentTime;this._soundSource.stop(n),this._soundSource.onended=function(){e.isPlaying=!1},this.isPaused||(this._startOffset=0)}}},i.prototype.pause=function(){this.isPlaying&&(this.isPaused=!0,this._streaming?this._htmlAudioElement?this._htmlAudioElement.pause():this._streamingSource.disconnect():Ge.a.audioEngine.audioContext&&(this.stop(0),this._startOffset+=Ge.a.audioEngine.audioContext.currentTime-this._startTime))},i.prototype.setVolume=function(t,e){Ge.a.audioEngine.canUseWebAudio&&this._soundGain&&(e&&Ge.a.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(Ge.a.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,Ge.a.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(t,Ge.a.audioEngine.audioContext.currentTime+e)):this._soundGain.gain.value=t),this._volume=t},i.prototype.setPlaybackRate=function(t){this._playbackRate=t,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))},i.prototype.getVolume=function(){return this._volume},i.prototype.attachToMesh=function(t){var e=this;this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=t,this.spatialSound||(this.spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=function(n){return e._onRegisterAfterWorldMatrixUpdate(n)},this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)},i.prototype.detachFromMesh=function(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)},i.prototype._onRegisterAfterWorldMatrixUpdate=function(t){if(this._positionInEmitterSpace)t.worldMatrixFromCache.invertToRef(d.c.Matrix[0]),this.setPosition(d.c.Matrix[0].getTranslation());else if(t.getBoundingInfo){var e=t.getBoundingInfo();this.setPosition(e.boundingSphere.centerWorld)}else this.setPosition(t.absolutePosition);Ge.a.audioEngine.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()},i.prototype.clone=function(){var t=this;if(this._streaming)return null;var e=function(){t._isReadyToPlay?(r._audioBuffer=t.getAudioBuffer(),r._isReadyToPlay=!0,r.autoplay&&r.play(0,t._offset,t._length)):window.setTimeout(e,300)},n={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this.spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},r=new i(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,n);return this.useCustomAttenuation&&r.setAttenuationFunction(this._customAttenuationFunction),r.setPosition(this._position),r.setPlaybackRate(this._playbackRate),e(),r},i.prototype.getAudioBuffer=function(){return this._audioBuffer},i.prototype.getSoundSource=function(){return this._soundSource},i.prototype.getSoundGain=function(){return this._soundGain},i.prototype.serialize=function(){var t={name:this.name,url:this.name,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this.spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this.spatialSound&&(this._connectedTransformNode&&(t.connectedMeshId=this._connectedTransformNode.id),t.position=this._position.asArray(),t.refDistance=this.refDistance,t.distanceModel=this.distanceModel,t.isDirectional=this._isDirectional,t.localDirectionToMesh=this._localDirection.asArray(),t.coneInnerAngle=this._coneInnerAngle,t.coneOuterAngle=this._coneOuterAngle,t.coneOuterGain=this._coneOuterGain),t},i.Parse=function(t,e,n,r){var o,u=t.name;o=t.url?n+t.url:n+u;var f,v={autoplay:t.autoplay,loop:t.loop,volume:t.volume,spatialSound:t.spatialSound,maxDistance:t.maxDistance,rolloffFactor:t.rolloffFactor,refDistance:t.refDistance,distanceModel:t.distanceModel,playbackRate:t.playbackRate};if(r){var y=function(){r._isReadyToPlay?(f._audioBuffer=r.getAudioBuffer(),f._isReadyToPlay=!0,f.autoplay&&f.play(0,f._offset,f._length)):window.setTimeout(y,300)};f=new i(u,new ArrayBuffer(0),e,null,v),y()}else f=new i(u,o,e,function(){e._removePendingData(f)},v),e._addPendingData(f);if(t.position){var D=d.e.FromArray(t.position);f.setPosition(D)}if(t.isDirectional&&(f.setDirectionalCone(t.coneInnerAngle||360,t.coneOuterAngle||360,t.coneOuterGain||0),t.localDirectionToMesh)){var w=d.e.FromArray(t.localDirectionToMesh);f.setLocalDirectionToMesh(w)}if(t.connectedMeshId){var F=e.getMeshByID(t.connectedMeshId);F&&f.attachToMesh(F)}return t.metadata&&(f.metadata=t.metadata),f},i._SceneComponentInitialization=function(t){throw dr.a.WarnImport("AudioSceneComponent")},i}(),ss=function(){function i(t,e){e===void 0&&(e={}),this.id=-1,this._isInitialized=!1,this._scene=t,this.soundCollection=new Array,this._options=e,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1)}return i.prototype._initializeSoundTrackAudioGraph=function(){Ge.a.audioEngine.canUseWebAudio&&Ge.a.audioEngine.audioContext&&(this._outputAudioNode=Ge.a.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(Ge.a.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)},i.prototype.dispose=function(){if(Ge.a.audioEngine&&Ge.a.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}},i.prototype.addSound=function(t){this._isInitialized||this._initializeSoundTrackAudioGraph(),Ge.a.audioEngine.canUseWebAudio&&this._outputAudioNode&&t.connectToSoundTrackAudioNode(this._outputAudioNode),t.soundTrackId&&(t.soundTrackId===-1?this._scene.mainSoundTrack.removeSound(t):this._scene.soundTracks&&this._scene.soundTracks[t.soundTrackId].removeSound(t)),this.soundCollection.push(t),t.soundTrackId=this.id},i.prototype.removeSound=function(t){var e=this.soundCollection.indexOf(t);e!==-1&&this.soundCollection.splice(e,1)},i.prototype.setVolume=function(t){Ge.a.audioEngine.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=t)},i.prototype.switchPanningModelToHRTF=function(){if(Ge.a.audioEngine.canUseWebAudio)for(var t=0;t<this.soundCollection.length;t++)this.soundCollection[t].switchPanningModelToHRTF()},i.prototype.switchPanningModelToEqualPower=function(){if(Ge.a.audioEngine.canUseWebAudio)for(var t=0;t<this.soundCollection.length;t++)this.soundCollection[t].switchPanningModelToEqualPower()},i.prototype.connectToAnalyser=function(t){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=t,Ge.a.audioEngine.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,Ge.a.audioEngine.masterGain))},i}(),dt=c(17);E.a.AddParser(dt.a.NAME_AUDIO,function(i,t,e,n){var r,o=[];if(e.sounds=e.sounds||[],i.sounds!==void 0&&i.sounds!==null)for(var u=0,f=i.sounds.length;u<f;u++){var v=i.sounds[u];Ge.a.audioEngine.canUseWebAudio?(v.url||(v.url=v.name),o[v.url]?e.sounds.push(Qr.Parse(v,t,n,o[v.url])):(r=Qr.Parse(v,t,n),o[v.url]=r,e.sounds.push(r))):e.sounds.push(new Qr(v.name,null,t))}o=[]}),Object.defineProperty(he.a.prototype,"mainSoundTrack",{get:function(){var i=this._getComponent(dt.a.NAME_AUDIO);return i||(i=new qr(this),this._addComponent(i)),this._mainSoundTrack||(this._mainSoundTrack=new ss(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),he.a.prototype.getSoundByName=function(i){var t;for(t=0;t<this.mainSoundTrack.soundCollection.length;t++)if(this.mainSoundTrack.soundCollection[t].name===i)return this.mainSoundTrack.soundCollection[t];if(this.soundTracks){for(var e=0;e<this.soundTracks.length;e++)for(t=0;t<this.soundTracks[e].soundCollection.length;t++)if(this.soundTracks[e].soundCollection[t].name===i)return this.soundTracks[e].soundCollection[t]}return null},Object.defineProperty(he.a.prototype,"audioEnabled",{get:function(){var i=this._getComponent(dt.a.NAME_AUDIO);return i||(i=new qr(this),this._addComponent(i)),i.audioEnabled},set:function(i){var t=this._getComponent(dt.a.NAME_AUDIO);t||(t=new qr(this),this._addComponent(t)),i?t.enableAudio():t.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(he.a.prototype,"headphone",{get:function(){var i=this._getComponent(dt.a.NAME_AUDIO);return i||(i=new qr(this),this._addComponent(i)),i.headphone},set:function(i){var t=this._getComponent(dt.a.NAME_AUDIO);t||(t=new qr(this),this._addComponent(t)),i?t.switchAudioModeForHeadphones():t.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(he.a.prototype,"audioListenerPositionProvider",{get:function(){var i=this._getComponent(dt.a.NAME_AUDIO);return i||(i=new qr(this),this._addComponent(i)),i.audioListenerPositionProvider},set:function(i){var t=this._getComponent(dt.a.NAME_AUDIO);if(t||(t=new qr(this),this._addComponent(t)),typeof i!="function")throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");t.audioListenerPositionProvider=i},enumerable:!0,configurable:!0}),Object.defineProperty(he.a.prototype,"audioPositioningRefreshRate",{get:function(){var i=this._getComponent(dt.a.NAME_AUDIO);return i||(i=new qr(this),this._addComponent(i)),i.audioPositioningRefreshRate},set:function(i){var t=this._getComponent(dt.a.NAME_AUDIO);t||(t=new qr(this),this._addComponent(t)),t.audioPositioningRefreshRate=i},enumerable:!0,configurable:!0});var qr=function(){function i(t){this.name=dt.a.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this._audioListenerPositionProvider=null,this._cachedCameraDirection=new d.e,this._cachedCameraPosition=new d.e,this._lastCheck=0,this.scene=t,t.soundTracks=new Array,t.sounds=new Array}return Object.defineProperty(i.prototype,"audioEnabled",{get:function(){return this._audioEnabled},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"headphone",{get:function(){return this._headphone},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"audioListenerPositionProvider",{get:function(){return this._audioListenerPositionProvider},set:function(t){this._audioListenerPositionProvider=t},enumerable:!1,configurable:!0}),i.prototype.register=function(){this.scene._afterRenderStage.registerStep(dt.a.STEP_AFTERRENDER_AUDIO,this,this._afterRender)},i.prototype.rebuild=function(){},i.prototype.serialize=function(t){if(t.sounds=[],this.scene.soundTracks)for(var e=0;e<this.scene.soundTracks.length;e++)for(var n=this.scene.soundTracks[e],r=0;r<n.soundCollection.length;r++)t.sounds.push(n.soundCollection[r].serialize())},i.prototype.addFromContainer=function(t){var e=this;t.sounds&&t.sounds.forEach(function(n){n.play(),n.autoplay=!0,e.scene.mainSoundTrack.addSound(n)})},i.prototype.removeFromContainer=function(t,e){var n=this;e===void 0&&(e=!1),t.sounds&&t.sounds.forEach(function(r){r.stop(),r.autoplay=!1,n.scene.mainSoundTrack.removeSound(r),e&&r.dispose()})},i.prototype.dispose=function(){var t=this.scene;if(t._mainSoundTrack&&t.mainSoundTrack.dispose(),t.soundTracks)for(var e=0;e<t.soundTracks.length;e++)t.soundTracks[e].dispose()},i.prototype.disableAudio=function(){var t,e=this.scene;for(this._audioEnabled=!1,Ge.a.audioEngine&&Ge.a.audioEngine.audioContext&&Ge.a.audioEngine.audioContext.suspend(),t=0;t<e.mainSoundTrack.soundCollection.length;t++)e.mainSoundTrack.soundCollection[t].pause();if(e.soundTracks)for(t=0;t<e.soundTracks.length;t++)for(var n=0;n<e.soundTracks[t].soundCollection.length;n++)e.soundTracks[t].soundCollection[n].pause()},i.prototype.enableAudio=function(){var t,e=this.scene;for(this._audioEnabled=!0,Ge.a.audioEngine&&Ge.a.audioEngine.audioContext&&Ge.a.audioEngine.audioContext.resume(),t=0;t<e.mainSoundTrack.soundCollection.length;t++)e.mainSoundTrack.soundCollection[t].isPaused&&e.mainSoundTrack.soundCollection[t].play();if(e.soundTracks)for(t=0;t<e.soundTracks.length;t++)for(var n=0;n<e.soundTracks[t].soundCollection.length;n++)e.soundTracks[t].soundCollection[n].isPaused&&e.soundTracks[t].soundCollection[n].play()},i.prototype.switchAudioModeForHeadphones=function(){var t=this.scene;if(this._headphone=!0,t.mainSoundTrack.switchPanningModelToHRTF(),t.soundTracks)for(var e=0;e<t.soundTracks.length;e++)t.soundTracks[e].switchPanningModelToHRTF()},i.prototype.switchAudioModeForNormalSpeakers=function(){var t=this.scene;if(this._headphone=!1,t.mainSoundTrack.switchPanningModelToEqualPower(),t.soundTracks)for(var e=0;e<t.soundTracks.length;e++)t.soundTracks[e].switchPanningModelToEqualPower()},i.prototype._afterRender=function(){var t=be.a.Now;if(!(this._lastCheck&&t-this._lastCheck<this.audioPositioningRefreshRate)){this._lastCheck=t;var e=this.scene;if(this._audioEnabled&&e._mainSoundTrack&&e.soundTracks&&(e._mainSoundTrack.soundCollection.length!==0||e.soundTracks.length!==1)){var n=Ge.a.audioEngine;if(n&&n.audioContext){if(this._audioListenerPositionProvider){var r=this._audioListenerPositionProvider();r.x=r.x||0,r.y=r.y||0,r.z=r.z||0,n.audioContext.listener.setPosition(r.x,r.y,r.z)}else{var o;if(o=e.activeCameras&&e.activeCameras.length>0?e.activeCameras[0]:e.activeCamera){this._cachedCameraPosition.equals(o.globalPosition)||(this._cachedCameraPosition.copyFrom(o.globalPosition),n.audioContext.listener.setPosition(o.globalPosition.x,o.globalPosition.y,o.globalPosition.z)),o.rigCameras&&o.rigCameras.length>0&&(o=o.rigCameras[0]);var u=d.a.Invert(o.getViewMatrix()),f=d.e.TransformNormal(e.useRightHandedSystem?i._CameraDirectionRH:i._CameraDirectionLH,u);f.normalize(),isNaN(f.x)||isNaN(f.y)||isNaN(f.z)||this._cachedCameraDirection.equals(f)||(this._cachedCameraDirection.copyFrom(f),n.audioContext.listener.setOrientation(f.x,f.y,f.z,0,1,0))}else n.audioContext.listener.setPosition(0,0,0)}var v;for(v=0;v<e.mainSoundTrack.soundCollection.length;v++){var y=e.mainSoundTrack.soundCollection[v];y.useCustomAttenuation&&y.updateDistanceFromListener()}if(e.soundTracks)for(v=0;v<e.soundTracks.length;v++)for(var D=0;D<e.soundTracks[v].soundCollection.length;D++)(y=e.soundTracks[v].soundCollection[D]).useCustomAttenuation&&y.updateDistanceFromListener()}}}},i._CameraDirectionLH=new d.e(0,0,-1),i._CameraDirectionRH=new d.e(0,0,1),i}();Qr._SceneComponentInitialization=function(i){var t=i._getComponent(dt.a.NAME_AUDIO);t||(t=new qr(i),i._addComponent(t))};var yp=function(){function i(t,e,n){var r=this;if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],e.length!==n.length)throw new Error("Sounds length does not equal weights length");this.loop=t,this._weights=n;for(var o=0,u=0,f=n;u<f.length;u++)o+=f[u];for(var v=o>0?1/o:0,y=0;y<this._weights.length;y++)this._weights[y]*=v;this._sounds=e;for(var D=0,w=this._sounds;D<w.length;D++)w[D].onEndedObservable.add(function(){r._onended()})}return Object.defineProperty(i.prototype,"directionalConeInnerAngle",{get:function(){return this._coneInnerAngle},set:function(t){if(t!==this._coneInnerAngle){if(this._coneOuterAngle<t)return void _.a.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=t;for(var e=0,n=this._sounds;e<n.length;e++)n[e].directionalConeInnerAngle=t}},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"directionalConeOuterAngle",{get:function(){return this._coneOuterAngle},set:function(t){if(t!==this._coneOuterAngle){if(t<this._coneInnerAngle)return void _.a.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=t;for(var e=0,n=this._sounds;e<n.length;e++)n[e].directionalConeOuterAngle=t}},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"volume",{get:function(){return this._volume},set:function(t){if(t!==this._volume)for(var e=0,n=this._sounds;e<n.length;e++)n[e].setVolume(t)},enumerable:!1,configurable:!0}),i.prototype._onended=function(){this._currentIndex!==void 0&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1},i.prototype.pause=function(){this.isPaused=!0,this._currentIndex!==void 0&&this._sounds[this._currentIndex].pause()},i.prototype.stop=function(){this.isPlaying=!1,this._currentIndex!==void 0&&this._sounds[this._currentIndex].stop()},i.prototype.play=function(t){if(!this.isPaused){this.stop();for(var e=Math.random(),n=0,r=0;r<this._weights.length;r++)if(e<=(n+=this._weights[r])){this._currentIndex=r;break}}var o=this._sounds[this._currentIndex];o.isReady()?o.play(0,this.isPaused?void 0:t):o.autoplay=!0,this.isPlaying=!0,this.isPaused=!1},i}(),Ot=c(18),Hu=function(){function i(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}return Object.defineProperty(i.prototype,"name",{get:function(){return"AutoRotation"},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"zoomStopsAnimation",{get:function(){return this._zoomStopsAnimation},set:function(t){this._zoomStopsAnimation=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"idleRotationSpeed",{get:function(){return this._idleRotationSpeed},set:function(t){this._idleRotationSpeed=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"idleRotationWaitTime",{get:function(){return this._idleRotationWaitTime},set:function(t){this._idleRotationWaitTime=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"idleRotationSpinupTime",{get:function(){return this._idleRotationSpinupTime},set:function(t){this._idleRotationSpinupTime=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"rotationInProgress",{get:function(){return Math.abs(this._cameraRotationSpeed)>0},enumerable:!1,configurable:!0}),i.prototype.init=function(){},i.prototype.attach=function(t){var e=this;this._attachedCamera=t;var n=this._attachedCamera.getScene();this._onPrePointerObservableObserver=n.onPrePointerObservable.add(function(r){r.type!==Ot.a.POINTERDOWN?r.type===Ot.a.POINTERUP&&(e._isPointerDown=!1):e._isPointerDown=!0}),this._onAfterCheckInputsObserver=t.onAfterCheckInputsObservable.add(function(){var r=be.a.Now,o=0;e._lastFrameTime!=null&&(o=r-e._lastFrameTime),e._lastFrameTime=r,e._applyUserInteraction();var u=r-e._lastInteractionTime-e._idleRotationWaitTime,f=Math.max(Math.min(u/e._idleRotationSpinupTime,1),0);e._cameraRotationSpeed=e._idleRotationSpeed*f,e._attachedCamera&&(e._attachedCamera.alpha-=e._cameraRotationSpeed*(o/1e3))})},i.prototype.detach=function(){if(this._attachedCamera){var t=this._attachedCamera.getScene();this._onPrePointerObservableObserver&&t.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null}},i.prototype._userIsZooming=function(){return!!this._attachedCamera&&this._attachedCamera.inertialRadiusOffset!==0},i.prototype._shouldAnimationStopForInteraction=function(){if(!this._attachedCamera)return!1;var t=!1;return this._lastFrameRadius===this._attachedCamera.radius&&this._attachedCamera.inertialRadiusOffset!==0&&(t=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?t:this._userIsZooming()},i.prototype._applyUserInteraction=function(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=be.a.Now)},i.prototype._userIsMoving=function(){return!!this._attachedCamera&&(this._attachedCamera.inertialAlphaOffset!==0||this._attachedCamera.inertialBetaOffset!==0||this._attachedCamera.inertialRadiusOffset!==0||this._attachedCamera.inertialPanningX!==0||this._attachedCamera.inertialPanningY!==0||this._isPointerDown)},i}(),Wu=function(){function i(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}return Object.defineProperty(i.prototype,"name",{get:function(){return"Bouncing"},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"autoTransitionRange",{get:function(){return this._autoTransitionRange},set:function(t){var e=this;if(this._autoTransitionRange!==t){this._autoTransitionRange=t;var n=this._attachedCamera;n&&(t?this._onMeshTargetChangedObserver=n.onMeshTargetChangedObservable.add(function(r){if(r){r.computeWorldMatrix(!0);var o=r.getBoundingInfo().diagonalLength;e.lowerRadiusTransitionRange=.05*o,e.upperRadiusTransitionRange=.05*o}}):this._onMeshTargetChangedObserver&&n.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}},enumerable:!1,configurable:!0}),i.prototype.init=function(){},i.prototype.attach=function(t){var e=this;this._attachedCamera=t,this._onAfterCheckInputsObserver=t.onAfterCheckInputsObservable.add(function(){e._attachedCamera&&(e._isRadiusAtLimit(e._attachedCamera.lowerRadiusLimit)&&e._applyBoundRadiusAnimation(e.lowerRadiusTransitionRange),e._isRadiusAtLimit(e._attachedCamera.upperRadiusLimit)&&e._applyBoundRadiusAnimation(e.upperRadiusTransitionRange))})},i.prototype.detach=function(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)},i.prototype._isRadiusAtLimit=function(t){return!!this._attachedCamera&&this._attachedCamera.radius===t&&!this._radiusIsAnimating},i.prototype._applyBoundRadiusAnimation=function(t){var e=this;if(this._attachedCamera){this._radiusBounceTransition||(i.EasingFunction.setEasingMode(i.EasingMode),this._radiusBounceTransition=H.CreateAnimation("radius",H.ANIMATIONTYPE_FLOAT,60,i.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;var n=H.TransitionTo("radius",this._attachedCamera.radius+t,this._attachedCamera,this._attachedCamera.getScene(),60,this._radiusBounceTransition,this.transitionDuration,function(){return e._clearAnimationLocks()});n&&this._animatables.push(n)}},i.prototype._clearAnimationLocks=function(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)},i.prototype.stopAllAnimations=function(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()},i.EasingFunction=new ot(.3),i.EasingMode=Ke.EASINGMODE_EASEOUT,i}(),to=function(){function i(){this._mode=i.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}return Object.defineProperty(i.prototype,"name",{get:function(){return"Framing"},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"mode",{get:function(){return this._mode},set:function(t){this._mode=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"radiusScale",{get:function(){return this._radiusScale},set:function(t){this._radiusScale=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"positionScale",{get:function(){return this._positionScale},set:function(t){this._positionScale=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"defaultElevation",{get:function(){return this._defaultElevation},set:function(t){this._defaultElevation=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"elevationReturnTime",{get:function(){return this._elevationReturnTime},set:function(t){this._elevationReturnTime=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"elevationReturnWaitTime",{get:function(){return this._elevationReturnWaitTime},set:function(t){this._elevationReturnWaitTime=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"zoomStopsAnimation",{get:function(){return this._zoomStopsAnimation},set:function(t){this._zoomStopsAnimation=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"framingTime",{get:function(){return this._framingTime},set:function(t){this._framingTime=t},enumerable:!1,configurable:!0}),i.prototype.init=function(){},i.prototype.attach=function(t){var e=this;this._attachedCamera=t;var n=this._attachedCamera.getScene();i.EasingFunction.setEasingMode(i.EasingMode),this._onPrePointerObservableObserver=n.onPrePointerObservable.add(function(r){r.type!==Ot.a.POINTERDOWN?r.type===Ot.a.POINTERUP&&(e._isPointerDown=!1):e._isPointerDown=!0}),this._onMeshTargetChangedObserver=t.onMeshTargetChangedObservable.add(function(r){r&&e.zoomOnMesh(r)}),this._onAfterCheckInputsObserver=t.onAfterCheckInputsObservable.add(function(){e._applyUserInteraction(),e._maintainCameraAboveGround()})},i.prototype.detach=function(){if(this._attachedCamera){var t=this._attachedCamera.getScene();this._onPrePointerObservableObserver&&t.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}},i.prototype.zoomOnMesh=function(t,e,n){e===void 0&&(e=!1),n===void 0&&(n=null),t.computeWorldMatrix(!0);var r=t.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(r.minimumWorld,r.maximumWorld,e,n)},i.prototype.zoomOnMeshHierarchy=function(t,e,n){e===void 0&&(e=!1),n===void 0&&(n=null),t.computeWorldMatrix(!0);var r=t.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(r.min,r.max,e,n)},i.prototype.zoomOnMeshesHierarchy=function(t,e,n){e===void 0&&(e=!1),n===void 0&&(n=null);for(var r=new d.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),o=new d.e(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),u=0;u<t.length;u++){var f=t[u].getHierarchyBoundingVectors(!0);d.e.CheckExtends(f.min,r,o),d.e.CheckExtends(f.max,r,o)}this.zoomOnBoundingInfo(r,o,e,n)},i.prototype.zoomOnBoundingInfo=function(t,e,n,r){var o,u=this;if(n===void 0&&(n=!1),r===void 0&&(r=null),this._attachedCamera){var f=t.y,v=f+(e.y-f)*this._positionScale,y=e.subtract(t).scale(.5);if(n)o=new d.e(0,v,0);else{var D=t.add(y);o=new d.e(D.x,v,D.z)}this._vectorTransition||(this._vectorTransition=H.CreateAnimation("target",H.ANIMATIONTYPE_VECTOR3,60,i.EasingFunction)),this._betaIsAnimating=!0;var w=H.TransitionTo("target",o,this._attachedCamera,this._attachedCamera.getScene(),60,this._vectorTransition,this._framingTime);w&&this._animatables.push(w);var F=0;if(this._mode===i.FitFrustumSidesMode){var z=this._calculateLowerRadiusFromModelBoundingSphere(t,e);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=y.length()+this._attachedCamera.minZ),F=z}else this._mode===i.IgnoreBoundsSizeMode&&(F=this._calculateLowerRadiusFromModelBoundingSphere(t,e),this.autoCorrectCameraLimitsAndSensibility&&this._attachedCamera.lowerRadiusLimit===null&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.minZ));if(this.autoCorrectCameraLimitsAndSensibility){var k=e.subtract(t).length();this._attachedCamera.panningSensibility=5e3/k,this._attachedCamera.wheelPrecision=100/F}this._radiusTransition||(this._radiusTransition=H.CreateAnimation("radius",H.ANIMATIONTYPE_FLOAT,60,i.EasingFunction)),(w=H.TransitionTo("radius",F,this._attachedCamera,this._attachedCamera.getScene(),60,this._radiusTransition,this._framingTime,function(){u.stopAllAnimations(),r&&r(),u._attachedCamera&&u._attachedCamera.useInputToRestoreState&&u._attachedCamera.storeState()}))&&this._animatables.push(w)}},i.prototype._calculateLowerRadiusFromModelBoundingSphere=function(t,e){var n=e.subtract(t).length(),r=this._getFrustumSlope(),o=.5*n*this._radiusScale,u=o*Math.sqrt(1+1/(r.x*r.x)),f=o*Math.sqrt(1+1/(r.y*r.y)),v=Math.max(u,f),y=this._attachedCamera;return y?(y.lowerRadiusLimit&&this._mode===i.IgnoreBoundsSizeMode&&(v=v<y.lowerRadiusLimit?y.lowerRadiusLimit:v),y.upperRadiusLimit&&(v=v>y.upperRadiusLimit?y.upperRadiusLimit:v),v):0},i.prototype._maintainCameraAboveGround=function(){var t=this;if(!(this._elevationReturnTime<0)){var e=be.a.Now-this._lastInteractionTime,n=.5*Math.PI-this._defaultElevation,r=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>r&&e>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=H.CreateAnimation("beta",H.ANIMATIONTYPE_FLOAT,60,i.EasingFunction));var o=H.TransitionTo("beta",n,this._attachedCamera,this._attachedCamera.getScene(),60,this._betaTransition,this._elevationReturnTime,function(){t._clearAnimationLocks(),t.stopAllAnimations()});o&&this._animatables.push(o)}}},i.prototype._getFrustumSlope=function(){var t=this._attachedCamera;if(!t)return d.d.Zero();var e=t.getScene().getEngine().getAspectRatio(t),n=Math.tan(t.fov/2),r=n*e;return new d.d(r,n)},i.prototype._clearAnimationLocks=function(){this._betaIsAnimating=!1},i.prototype._applyUserInteraction=function(){this.isUserIsMoving&&(this._lastInteractionTime=be.a.Now,this.stopAllAnimations(),this._clearAnimationLocks())},i.prototype.stopAllAnimations=function(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()},Object.defineProperty(i.prototype,"isUserIsMoving",{get:function(){return!!this._attachedCamera&&(this._attachedCamera.inertialAlphaOffset!==0||this._attachedCamera.inertialBetaOffset!==0||this._attachedCamera.inertialRadiusOffset!==0||this._attachedCamera.inertialPanningX!==0||this._attachedCamera.inertialPanningY!==0||this._isPointerDown)},enumerable:!1,configurable:!0}),i.EasingFunction=new wt,i.EasingMode=Ke.EASINGMODE_EASEINOUT,i.IgnoreBoundsSizeMode=0,i.FitFrustumSidesMode=1,i}(),Fo=function(i,t,e,n){t===void 0&&(t=new d.e),e===void 0&&(e=0),n===void 0&&(n=!1),this.direction=i,this.rotatedDirection=t,this.diff=e,this.ignore=n},Tp=function(){function i(t){this.ui=t,this.name="AttachToBoxBehavior",this.distanceAwayFromFace=.15,this.distanceAwayFromBottomOfFace=.15,this._faceVectors=[new Fo(d.e.Up()),new Fo(d.e.Down()),new Fo(d.e.Left()),new Fo(d.e.Right()),new Fo(d.e.Forward()),new Fo(d.e.Forward().scaleInPlace(-1))],this._tmpMatrix=new d.a,this._tmpVector=new d.e,this._zeroVector=d.e.Zero(),this._lookAtTmpMatrix=new d.a}return i.prototype.init=function(){},i.prototype._closestFace=function(t){var e=this;return this._faceVectors.forEach(function(n){e._target.rotationQuaternion||(e._target.rotationQuaternion=d.b.RotationYawPitchRoll(e._target.rotation.y,e._target.rotation.x,e._target.rotation.z)),e._target.rotationQuaternion.toRotationMatrix(e._tmpMatrix),d.e.TransformCoordinatesToRef(n.direction,e._tmpMatrix,n.rotatedDirection),n.diff=d.e.GetAngleBetweenVectors(n.rotatedDirection,t,d.e.Cross(n.rotatedDirection,t))}),this._faceVectors.reduce(function(n,r){return n.ignore?r:r.ignore||n.diff<r.diff?n:r},this._faceVectors[0])},i.prototype._lookAtToRef=function(t,e,n){e===void 0&&(e=new d.e(0,1,0)),d.a.LookAtLHToRef(this._zeroVector,t,e,this._lookAtTmpMatrix),this._lookAtTmpMatrix.invert(),d.b.FromRotationMatrixToRef(this._lookAtTmpMatrix,n)},i.prototype.attach=function(t){var e=this;this._target=t,this._scene=this._target.getScene(),this._onRenderObserver=this._scene.onBeforeRenderObservable.add(function(){if(e._scene.activeCamera){var n=e._scene.activeCamera.position;e._scene.activeCamera.devicePosition&&(n=e._scene.activeCamera.devicePosition);var r=e._closestFace(n.subtract(t.position));e._scene.activeCamera.leftCamera?e._scene.activeCamera.leftCamera.computeWorldMatrix().getRotationMatrixToRef(e._tmpMatrix):e._scene.activeCamera.computeWorldMatrix().getRotationMatrixToRef(e._tmpMatrix),d.e.TransformCoordinatesToRef(d.e.Up(),e._tmpMatrix,e._tmpVector),e._faceVectors.forEach(function(u){r.direction.x&&u.direction.x&&(u.ignore=!0),r.direction.y&&u.direction.y&&(u.ignore=!0),r.direction.z&&u.direction.z&&(u.ignore=!0)});var o=e._closestFace(e._tmpVector);e._faceVectors.forEach(function(u){u.ignore=!1}),e.ui.position.copyFrom(t.position),r.direction.x&&(r.rotatedDirection.scaleToRef(t.scaling.x/2+e.distanceAwayFromFace,e._tmpVector),e.ui.position.addInPlace(e._tmpVector)),r.direction.y&&(r.rotatedDirection.scaleToRef(t.scaling.y/2+e.distanceAwayFromFace,e._tmpVector),e.ui.position.addInPlace(e._tmpVector)),r.direction.z&&(r.rotatedDirection.scaleToRef(t.scaling.z/2+e.distanceAwayFromFace,e._tmpVector),e.ui.position.addInPlace(e._tmpVector)),e.ui.rotationQuaternion||(e.ui.rotationQuaternion=d.b.RotationYawPitchRoll(e.ui.rotation.y,e.ui.rotation.x,e.ui.rotation.z)),r.rotatedDirection.scaleToRef(-1,e._tmpVector),e._lookAtToRef(e._tmpVector,o.rotatedDirection,e.ui.rotationQuaternion),o.direction.x&&e.ui.up.scaleToRef(e.distanceAwayFromBottomOfFace-t.scaling.x/2,e._tmpVector),o.direction.y&&e.ui.up.scaleToRef(e.distanceAwayFromBottomOfFace-t.scaling.y/2,e._tmpVector),o.direction.z&&e.ui.up.scaleToRef(e.distanceAwayFromBottomOfFace-t.scaling.z/2,e._tmpVector),e.ui.position.addInPlace(e._tmpVector)}})},i.prototype.detach=function(){this._scene.onBeforeRenderObservable.remove(this._onRenderObserver)},i}(),Ep=function(){function i(){var t=this;this.delay=0,this.fadeInTime=300,this._millisecondsPerFrame=1e3/60,this._hovered=!1,this._hoverValue=0,this._ownerNode=null,this._update=function(){if(t._ownerNode){if(t._hoverValue+=t._hovered?t._millisecondsPerFrame:-t._millisecondsPerFrame,t._setAllVisibility(t._ownerNode,(t._hoverValue-t.delay)/t.fadeInTime),t._ownerNode.visibility>1)return t._setAllVisibility(t._ownerNode,1),void(t._hoverValue=t.fadeInTime+t.delay);if(t._ownerNode.visibility<0&&(t._setAllVisibility(t._ownerNode,0),t._hoverValue<0))return void(t._hoverValue=0);setTimeout(t._update,t._millisecondsPerFrame)}}}return Object.defineProperty(i.prototype,"name",{get:function(){return"FadeInOut"},enumerable:!1,configurable:!0}),i.prototype.init=function(){},i.prototype.attach=function(t){this._ownerNode=t,this._setAllVisibility(this._ownerNode,0)},i.prototype.detach=function(){this._ownerNode=null},i.prototype.fadeIn=function(t){this._hovered=t,this._update()},i.prototype._setAllVisibility=function(t,e){var n=this;t.visibility=e,t.getChildMeshes().forEach(function(r){n._setAllVisibility(r,e)})},i}(),yi=c(65),Sp=function(){function i(){this._startDistance=0,this._initialScale=new d.e(0,0,0),this._targetScale=new d.e(0,0,0),this._sceneRenderObserver=null,this._dragBehaviorA=new yi.a({}),this._dragBehaviorA.moveAttached=!1,this._dragBehaviorB=new yi.a({}),this._dragBehaviorB.moveAttached=!1}return Object.defineProperty(i.prototype,"name",{get:function(){return"MultiPointerScale"},enumerable:!1,configurable:!0}),i.prototype.init=function(){},i.prototype._getCurrentDistance=function(){return this._dragBehaviorA.lastDragPosition.subtract(this._dragBehaviorB.lastDragPosition).length()},i.prototype.attach=function(t){var e=this;this._ownerNode=t,this._dragBehaviorA.onDragStartObservable.add(function(n){e._dragBehaviorA.dragging&&e._dragBehaviorB.dragging&&(e._dragBehaviorA.currentDraggingPointerID==e._dragBehaviorB.currentDraggingPointerID?e._dragBehaviorA.releaseDrag():(e._initialScale.copyFrom(t.scaling),e._startDistance=e._getCurrentDistance()))}),this._dragBehaviorB.onDragStartObservable.add(function(n){e._dragBehaviorA.dragging&&e._dragBehaviorB.dragging&&(e._dragBehaviorA.currentDraggingPointerID==e._dragBehaviorB.currentDraggingPointerID?e._dragBehaviorB.releaseDrag():(e._initialScale.copyFrom(t.scaling),e._startDistance=e._getCurrentDistance()))}),[this._dragBehaviorA,this._dragBehaviorB].forEach(function(n){n.onDragObservable.add(function(){if(e._dragBehaviorA.dragging&&e._dragBehaviorB.dragging){var r=e._getCurrentDistance()/e._startDistance;e._initialScale.scaleToRef(r,e._targetScale)}})}),t.addBehavior(this._dragBehaviorA),t.addBehavior(this._dragBehaviorB),this._sceneRenderObserver=t.getScene().onBeforeRenderObservable.add(function(){if(e._dragBehaviorA.dragging&&e._dragBehaviorB.dragging){var n=e._targetScale.subtract(t.scaling).scaleInPlace(.1);n.length()>.01&&t.scaling.addInPlace(n)}})},i.prototype.detach=function(){var t=this;this._ownerNode.getScene().onBeforeRenderObservable.remove(this._sceneRenderObserver),[this._dragBehaviorA,this._dragBehaviorB].forEach(function(e){e.onDragStartObservable.clear(),e.onDragObservable.clear(),t._ownerNode.removeBehavior(e)})},i}(),jt=c(31),Pt=c(24),Mr=c(60),Xu=function(){function i(){this._sceneRenderObserver=null,this._targetPosition=new d.e(0,0,0),this._moving=!1,this._startingOrientation=new d.b,this._attachedToElement=!1,this.zDragFactor=3,this.rotateDraggedObject=!0,this.dragging=!1,this.dragDeltaRatio=.2,this.currentDraggingPointerID=-1,this.detachCameraControls=!0,this.onDragStartObservable=new S.c,this.onDragObservable=new S.c,this.onDragEndObservable=new S.c}return Object.defineProperty(i.prototype,"name",{get:function(){return"SixDofDrag"},enumerable:!1,configurable:!0}),i.prototype.init=function(){},Object.defineProperty(i.prototype,"_pointerCamera",{get:function(){return this._scene.cameraToUseForPointers?this._scene.cameraToUseForPointers:this._scene.activeCamera},enumerable:!1,configurable:!0}),i.prototype.attach=function(t){var e=this;this._ownerNode=t,this._scene=this._ownerNode.getScene(),i._virtualScene||(i._virtualScene=new he.a(this._scene.getEngine(),{virtual:!0}),i._virtualScene.detachControl(),this._scene.getEngine().scenes.pop());var n=null,r=new d.e(0,0,0);this._virtualOriginMesh=new jt.a("",i._virtualScene),this._virtualOriginMesh.rotationQuaternion=new d.b,this._virtualDragMesh=new jt.a("",i._virtualScene),this._virtualDragMesh.rotationQuaternion=new d.b,this._pointerObserver=this._scene.onPointerObservable.add(function(u,f){if(u.type==Ot.a.POINTERDOWN){if(!e.dragging&&u.pickInfo&&u.pickInfo.hit&&u.pickInfo.pickedMesh&&u.pickInfo.ray&&(F=u.pickInfo.pickedMesh,e._ownerNode==F||F.isDescendantOf(e._ownerNode))){e._pointerCamera&&e._pointerCamera.cameraRigMode==Pt.a.RIG_MODE_NONE&&u.pickInfo.ray.origin.copyFrom(e._pointerCamera.globalPosition),n=e._ownerNode,Mr.a._RemoveAndStorePivotPoint(n),r.copyFrom(u.pickInfo.ray.origin),e._virtualOriginMesh.position.copyFrom(u.pickInfo.ray.origin),e._virtualOriginMesh.lookAt(u.pickInfo.ray.origin.add(u.pickInfo.ray.direction)),e._virtualOriginMesh.removeChild(e._virtualDragMesh),n.computeWorldMatrix(),e._virtualDragMesh.position.copyFrom(n.absolutePosition),n.rotationQuaternion||(n.rotationQuaternion=d.b.RotationYawPitchRoll(n.rotation.y,n.rotation.x,n.rotation.z));var v=n.parent;n.setParent(null),e._virtualDragMesh.rotationQuaternion.copyFrom(n.rotationQuaternion),n.setParent(v),e._virtualOriginMesh.addChild(e._virtualDragMesh),e._targetPosition.copyFrom(e._virtualDragMesh.absolutePosition),e.dragging=!0,e.currentDraggingPointerID=u.event.pointerId,e.detachCameraControls&&e._pointerCamera&&!e._pointerCamera.leftCamera&&(e._pointerCamera.inputs.attachedToElement?(e._pointerCamera.detachControl(),e._attachedToElement=!0):e._attachedToElement=!1),Mr.a._RestorePivotPoint(n),e.onDragStartObservable.notifyObservers({})}}else if(u.type==Ot.a.POINTERUP||u.type==Ot.a.POINTERDOUBLETAP)e.currentDraggingPointerID==u.event.pointerId&&(e.dragging=!1,e._moving=!1,e.currentDraggingPointerID=-1,n=null,e._virtualOriginMesh.removeChild(e._virtualDragMesh),e.detachCameraControls&&e._attachedToElement&&e._pointerCamera&&!e._pointerCamera.leftCamera&&(e._pointerCamera.attachControl(!0),e._attachedToElement=!1),e.onDragEndObservable.notifyObservers({}));else if(u.type==Ot.a.POINTERMOVE&&e.currentDraggingPointerID==u.event.pointerId&&e.dragging&&u.pickInfo&&u.pickInfo.ray&&n){var y=e.zDragFactor;e._pointerCamera&&e._pointerCamera.cameraRigMode==Pt.a.RIG_MODE_NONE&&(u.pickInfo.ray.origin.copyFrom(e._pointerCamera.globalPosition),y=0);var D=u.pickInfo.ray.origin.subtract(r);r.copyFrom(u.pickInfo.ray.origin);var w=-d.e.Dot(D,u.pickInfo.ray.direction);e._virtualOriginMesh.addChild(e._virtualDragMesh),e._virtualDragMesh.position.z-=e._virtualDragMesh.position.z<1?w*e.zDragFactor:w*y*e._virtualDragMesh.position.z,e._virtualDragMesh.position.z<0&&(e._virtualDragMesh.position.z=0),e._virtualOriginMesh.position.copyFrom(u.pickInfo.ray.origin),e._virtualOriginMesh.lookAt(u.pickInfo.ray.origin.add(u.pickInfo.ray.direction)),e._virtualOriginMesh.removeChild(e._virtualDragMesh),e._targetPosition.copyFrom(e._virtualDragMesh.absolutePosition),n.parent&&d.e.TransformCoordinatesToRef(e._targetPosition,d.a.Invert(n.parent.getWorldMatrix()),e._targetPosition),e._moving||e._startingOrientation.copyFrom(e._virtualDragMesh.rotationQuaternion),e._moving=!0}var F});var o=new d.b;this._sceneRenderObserver=t.getScene().onBeforeRenderObservable.add(function(){if(e.dragging&&e._moving&&n){if(Mr.a._RemoveAndStorePivotPoint(n),n.position.addInPlace(e._targetPosition.subtract(n.position).scale(e.dragDeltaRatio)),e.rotateDraggedObject){o.copyFrom(e._startingOrientation),o.x=-o.x,o.y=-o.y,o.z=-o.z,e._virtualDragMesh.rotationQuaternion.multiplyToRef(o,o),d.b.RotationYawPitchRollToRef(o.toEulerAngles("xyz").y,0,0,o),o.multiplyToRef(e._startingOrientation,o);var u=n.parent;(!u||u.scaling&&!u.scaling.isNonUniformWithinEpsilon(.001))&&(n.setParent(null),d.b.SlerpToRef(n.rotationQuaternion,o,e.dragDeltaRatio,n.rotationQuaternion),n.setParent(u))}Mr.a._RestorePivotPoint(n),e.onDragObservable.notifyObservers()}})},i.prototype.detach=function(){this._scene&&(this.detachCameraControls&&this._attachedToElement&&this._pointerCamera&&!this._pointerCamera.leftCamera&&(this._pointerCamera.attachControl(!0),this._attachedToElement=!1),this._scene.onPointerObservable.remove(this._pointerObserver)),this._ownerNode&&this._ownerNode.getScene().onBeforeRenderObservable.remove(this._sceneRenderObserver),this._virtualOriginMesh&&this._virtualOriginMesh.dispose(),this._virtualDragMesh&&this._virtualDragMesh.dispose(),this.onDragEndObservable.clear(),this.onDragObservable.clear(),this.onDragStartObservable.clear()},i}(),xp=function(){function i(t,e,n){if(this.targetPosition=d.e.Zero(),this.poleTargetPosition=d.e.Zero(),this.poleTargetLocalOffset=d.e.Zero(),this.poleAngle=0,this.slerpAmount=1,this._bone1Quat=d.b.Identity(),this._bone1Mat=d.a.Identity(),this._bone2Ang=Math.PI,this._maxAngle=Math.PI,this._rightHandedSystem=!1,this._bendAxis=d.e.Right(),this._slerping=!1,this._adjustRoll=0,this._bone2=e,this._bone1=e.getParent(),this._bone1){this.mesh=t;var r=e.getPosition();if(e.getAbsoluteTransform().determinant()>0&&(this._rightHandedSystem=!0,this._bendAxis.x=0,this._bendAxis.y=0,this._bendAxis.z=-1,r.x>r.y&&r.x>r.z&&(this._adjustRoll=.5*Math.PI,this._bendAxis.z=1)),this._bone1.length){var o=this._bone1.getScale(),u=this._bone2.getScale();this._bone1Length=this._bone1.length*o.y*this.mesh.scaling.y,this._bone2Length=this._bone2.length*u.y*this.mesh.scaling.y}else if(this._bone1.children[0]){t.computeWorldMatrix(!0);var f=this._bone2.children[0].getAbsolutePosition(t),v=this._bone2.getAbsolutePosition(t),y=this._bone1.getAbsolutePosition(t);this._bone1Length=d.e.Distance(f,v),this._bone2Length=d.e.Distance(v,y)}this._bone1.getRotationMatrixToRef(Se.c.WORLD,t,this._bone1Mat),this.maxAngle=Math.PI,n&&(n.targetMesh&&(this.targetMesh=n.targetMesh,this.targetMesh.computeWorldMatrix(!0)),n.poleTargetMesh?(this.poleTargetMesh=n.poleTargetMesh,this.poleTargetMesh.computeWorldMatrix(!0)):n.poleTargetBone?this.poleTargetBone=n.poleTargetBone:this._bone1.getParent()&&(this.poleTargetBone=this._bone1.getParent()),n.poleTargetLocalOffset&&this.poleTargetLocalOffset.copyFrom(n.poleTargetLocalOffset),n.poleAngle&&(this.poleAngle=n.poleAngle),n.bendAxis&&this._bendAxis.copyFrom(n.bendAxis),n.maxAngle&&(this.maxAngle=n.maxAngle),n.slerpAmount&&(this.slerpAmount=n.slerpAmount))}}return Object.defineProperty(i.prototype,"maxAngle",{get:function(){return this._maxAngle},set:function(t){this._setMaxAngle(t)},enumerable:!1,configurable:!0}),i.prototype._setMaxAngle=function(t){t<0&&(t=0),(t>Math.PI||t==null)&&(t=Math.PI),this._maxAngle=t;var e=this._bone1Length,n=this._bone2Length;this._maxReach=Math.sqrt(e*e+n*n-2*e*n*Math.cos(t))},i.prototype.update=function(){var t=this._bone1;if(t){var e=this.targetPosition,n=this.poleTargetPosition,r=i._tmpMats[0],o=i._tmpMats[1];this.targetMesh&&e.copyFrom(this.targetMesh.getAbsolutePosition()),this.poleTargetBone?this.poleTargetBone.getAbsolutePositionFromLocalToRef(this.poleTargetLocalOffset,this.mesh,n):this.poleTargetMesh&&d.e.TransformCoordinatesToRef(this.poleTargetLocalOffset,this.poleTargetMesh.getWorldMatrix(),n);var u=i._tmpVecs[0],f=i._tmpVecs[1],v=i._tmpVecs[2],y=i._tmpVecs[3],D=i._tmpVecs[4],w=i._tmpQuat;t.getAbsolutePositionToRef(this.mesh,u),n.subtractToRef(u,D),D.x==0&&D.y==0&&D.z==0?D.y=1:D.normalize(),e.subtractToRef(u,y),y.normalize(),d.e.CrossToRef(y,D,f),f.normalize(),d.e.CrossToRef(y,f,v),v.normalize(),d.a.FromXYZAxesToRef(v,y,f,r);var F=this._bone1Length,z=this._bone2Length,k=d.e.Distance(u,e);this._maxReach>0&&(k=Math.min(this._maxReach,k));var K=(z*z+k*k-F*F)/(2*z*k),oe=(k*k+F*F-z*z)/(2*k*F);K>1&&(K=1),oe>1&&(oe=1),K<-1&&(K=-1),oe<-1&&(oe=-1);var ae=Math.acos(K),ue=Math.acos(oe),de=-ae-ue;if(this._rightHandedSystem)d.a.RotationYawPitchRollToRef(0,0,this._adjustRoll,o),o.multiplyToRef(r,r),d.a.RotationAxisToRef(this._bendAxis,ue,o),o.multiplyToRef(r,r);else{var me=i._tmpVecs[5];me.copyFrom(this._bendAxis),me.x*=-1,d.a.RotationAxisToRef(me,-ue,o),o.multiplyToRef(r,r)}this.poleAngle&&(d.a.RotationAxisToRef(y,this.poleAngle,o),r.multiplyToRef(o,r)),this._bone1&&(this.slerpAmount<1?(this._slerping||d.b.FromRotationMatrixToRef(this._bone1Mat,this._bone1Quat),d.b.FromRotationMatrixToRef(r,w),d.b.SlerpToRef(this._bone1Quat,w,this.slerpAmount,this._bone1Quat),de=this._bone2Ang*(1-this.slerpAmount)+de*this.slerpAmount,this._bone1.setRotationQuaternion(this._bone1Quat,Se.c.WORLD,this.mesh),this._slerping=!0):(this._bone1.setRotationMatrix(r,Se.c.WORLD,this.mesh),this._bone1Mat.copyFrom(r),this._slerping=!1)),this._bone2.setAxisAngle(this._bendAxis,de,Se.c.LOCAL),this._bone2Ang=de}},i._tmpVecs=[d.e.Zero(),d.e.Zero(),d.e.Zero(),d.e.Zero(),d.e.Zero(),d.e.Zero()],i._tmpQuat=d.b.Identity(),i._tmpMats=[d.a.Identity(),d.a.Identity()],i}(),Ap=function(){function i(t,e,n,r){if(this.upAxis=d.e.Up(),this.upAxisSpace=Se.c.LOCAL,this.adjustYaw=0,this.adjustPitch=0,this.adjustRoll=0,this.slerpAmount=1,this._boneQuat=d.b.Identity(),this._slerping=!1,this._firstFrameSkipped=!1,this._fowardAxis=d.e.Forward(),this.mesh=t,this.bone=e,this.target=n,r&&(r.adjustYaw&&(this.adjustYaw=r.adjustYaw),r.adjustPitch&&(this.adjustPitch=r.adjustPitch),r.adjustRoll&&(this.adjustRoll=r.adjustRoll),r.maxYaw!=null?this.maxYaw=r.maxYaw:this.maxYaw=Math.PI,r.minYaw!=null?this.minYaw=r.minYaw:this.minYaw=-Math.PI,r.maxPitch!=null?this.maxPitch=r.maxPitch:this.maxPitch=Math.PI,r.minPitch!=null?this.minPitch=r.minPitch:this.minPitch=-Math.PI,r.slerpAmount!=null&&(this.slerpAmount=r.slerpAmount),r.upAxis!=null&&(this.upAxis=r.upAxis),r.upAxisSpace!=null&&(this.upAxisSpace=r.upAxisSpace),r.yawAxis!=null||r.pitchAxis!=null)){var o=Se.a.Y,u=Se.a.X;r.yawAxis!=null&&(o=r.yawAxis.clone()).normalize(),r.pitchAxis!=null&&(u=r.pitchAxis.clone()).normalize();var f=d.e.Cross(u,o);this._transformYawPitch=d.a.Identity(),d.a.FromXYZAxesToRef(u,o,f,this._transformYawPitch),this._transformYawPitchInv=this._transformYawPitch.clone(),this._transformYawPitch.invert()}e.getParent()||this.upAxisSpace!=Se.c.BONE||(this.upAxisSpace=Se.c.LOCAL)}return Object.defineProperty(i.prototype,"minYaw",{get:function(){return this._minYaw},set:function(t){this._minYaw=t,this._minYawSin=Math.sin(t),this._minYawCos=Math.cos(t),this._maxYaw!=null&&(this._midYawConstraint=.5*this._getAngleDiff(this._minYaw,this._maxYaw)+this._minYaw,this._yawRange=this._maxYaw-this._minYaw)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"maxYaw",{get:function(){return this._maxYaw},set:function(t){this._maxYaw=t,this._maxYawSin=Math.sin(t),this._maxYawCos=Math.cos(t),this._minYaw!=null&&(this._midYawConstraint=.5*this._getAngleDiff(this._minYaw,this._maxYaw)+this._minYaw,this._yawRange=this._maxYaw-this._minYaw)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"minPitch",{get:function(){return this._minPitch},set:function(t){this._minPitch=t,this._minPitchTan=Math.tan(t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"maxPitch",{get:function(){return this._maxPitch},set:function(t){this._maxPitch=t,this._maxPitchTan=Math.tan(t)},enumerable:!1,configurable:!0}),i.prototype.update=function(){if(this.slerpAmount<1&&!this._firstFrameSkipped)this._firstFrameSkipped=!0;else{var t=this.bone,e=i._tmpVecs[0];t.getAbsolutePositionToRef(this.mesh,e);var n=this.target,r=i._tmpMats[0],o=i._tmpMats[1],u=this.mesh,f=t.getParent(),v=i._tmpVecs[1];v.copyFrom(this.upAxis),this.upAxisSpace==Se.c.BONE&&f?(this._transformYawPitch&&d.e.TransformCoordinatesToRef(v,this._transformYawPitchInv,v),f.getDirectionToRef(v,this.mesh,v)):this.upAxisSpace==Se.c.LOCAL&&(u.getDirectionToRef(v,v),u.scaling.x==1&&u.scaling.y==1&&u.scaling.z==1||v.normalize());var y=!1,D=!1;if(this._maxYaw==Math.PI&&this._minYaw==-Math.PI||(y=!0),this._maxPitch==Math.PI&&this._minPitch==-Math.PI||(D=!0),y||D){var w=i._tmpMats[2],F=i._tmpMats[3];if(this.upAxisSpace==Se.c.BONE&&v.y==1&&f)f.getRotationMatrixToRef(Se.c.WORLD,this.mesh,w);else if(this.upAxisSpace!=Se.c.LOCAL||v.y!=1||f){(k=i._tmpVecs[2]).copyFrom(this._fowardAxis),this._transformYawPitch&&d.e.TransformCoordinatesToRef(k,this._transformYawPitchInv,k),f?f.getDirectionToRef(k,this.mesh,k):u.getDirectionToRef(k,k);var z=d.e.Cross(v,k);z.normalize();var k=d.e.Cross(z,v);d.a.FromXYZAxesToRef(z,v,k,w)}else w.copyFrom(u.getWorldMatrix());w.invertToRef(F);var K=null;if(D){var oe=i._tmpVecs[3];n.subtractToRef(e,oe),d.e.TransformCoordinatesToRef(oe,F,oe),K=Math.sqrt(oe.x*oe.x+oe.z*oe.z);var ae=Math.atan2(oe.y,K),ue=ae;ae>this._maxPitch?(oe.y=this._maxPitchTan*K,ue=this._maxPitch):ae<this._minPitch&&(oe.y=this._minPitchTan*K,ue=this._minPitch),ae!=ue&&(d.e.TransformCoordinatesToRef(oe,w,oe),oe.addInPlace(e),n=oe)}if(y){oe=i._tmpVecs[4],n.subtractToRef(e,oe),d.e.TransformCoordinatesToRef(oe,F,oe);var de=Math.atan2(oe.x,oe.z),me=de;if((de>this._maxYaw||de<this._minYaw)&&(K==null&&(K=Math.sqrt(oe.x*oe.x+oe.z*oe.z)),this._yawRange>Math.PI?this._isAngleBetween(de,this._maxYaw,this._midYawConstraint)?(oe.z=this._maxYawCos*K,oe.x=this._maxYawSin*K,me=this._maxYaw):this._isAngleBetween(de,this._midYawConstraint,this._minYaw)&&(oe.z=this._minYawCos*K,oe.x=this._minYawSin*K,me=this._minYaw):de>this._maxYaw?(oe.z=this._maxYawCos*K,oe.x=this._maxYawSin*K,me=this._maxYaw):de<this._minYaw&&(oe.z=this._minYawCos*K,oe.x=this._minYawSin*K,me=this._minYaw)),this._slerping&&this._yawRange>Math.PI){var ye=i._tmpVecs[8];ye.copyFrom(Se.a.Z),this._transformYawPitch&&d.e.TransformCoordinatesToRef(ye,this._transformYawPitchInv,ye);var Ee=i._tmpMats[4];this._boneQuat.toRotationMatrix(Ee),this.mesh.getWorldMatrix().multiplyToRef(Ee,Ee),d.e.TransformCoordinatesToRef(ye,Ee,ye),d.e.TransformCoordinatesToRef(ye,F,ye);var Ae=Math.atan2(ye.x,ye.z);if(this._getAngleBetween(Ae,de)>this._getAngleBetween(Ae,this._midYawConstraint)){K==null&&(K=Math.sqrt(oe.x*oe.x+oe.z*oe.z));var Ie=this._getAngleBetween(Ae,this._maxYaw);this._getAngleBetween(Ae,this._minYaw)<Ie?(me=Ae+.75*Math.PI,oe.z=Math.cos(me)*K,oe.x=Math.sin(me)*K):(me=Ae-.75*Math.PI,oe.z=Math.cos(me)*K,oe.x=Math.sin(me)*K)}}de!=me&&(d.e.TransformCoordinatesToRef(oe,w,oe),oe.addInPlace(e),n=oe)}}var Re=i._tmpVecs[5],Pe=i._tmpVecs[6],Ce=i._tmpVecs[7],Be=i._tmpQuat;n.subtractToRef(e,Re),Re.normalize(),d.e.CrossToRef(v,Re,Pe),Pe.normalize(),d.e.CrossToRef(Re,Pe,Ce),Ce.normalize(),d.a.FromXYZAxesToRef(Pe,Ce,Re,r),Pe.x===0&&Pe.y===0&&Pe.z===0||Ce.x===0&&Ce.y===0&&Ce.z===0||Re.x===0&&Re.y===0&&Re.z===0||((this.adjustYaw||this.adjustPitch||this.adjustRoll)&&(d.a.RotationYawPitchRollToRef(this.adjustYaw,this.adjustPitch,this.adjustRoll,o),o.multiplyToRef(r,r)),this.slerpAmount<1?(this._slerping||this.bone.getRotationQuaternionToRef(Se.c.WORLD,this.mesh,this._boneQuat),this._transformYawPitch&&this._transformYawPitch.multiplyToRef(r,r),d.b.FromRotationMatrixToRef(r,Be),d.b.SlerpToRef(this._boneQuat,Be,this.slerpAmount,this._boneQuat),this.bone.setRotationQuaternion(this._boneQuat,Se.c.WORLD,this.mesh),this._slerping=!0):(this._transformYawPitch&&this._transformYawPitch.multiplyToRef(r,r),this.bone.setRotationMatrix(r,Se.c.WORLD,this.mesh),this._slerping=!1))}},i.prototype._getAngleDiff=function(t,e){var n=e-t;return(n%=2*Math.PI)>Math.PI?n-=2*Math.PI:n<-Math.PI&&(n+=2*Math.PI),n},i.prototype._getAngleBetween=function(t,e){var n=0;return(n=(t=(t%=2*Math.PI)<0?t+2*Math.PI:t)<(e=(e%=2*Math.PI)<0?e+2*Math.PI:e)?e-t:t-e)>Math.PI&&(n=2*Math.PI-n),n},i.prototype._isAngleBetween=function(t,e,n){if(t=(t%=2*Math.PI)<0?t+2*Math.PI:t,(e=(e%=2*Math.PI)<0?e+2*Math.PI:e)<(n=(n%=2*Math.PI)<0?n+2*Math.PI:n)){if(t>e&&t<n)return!0}else if(t>n&&t<e)return!0;return!1},i._tmpVecs=xe.a.BuildArray(10,d.e.Zero),i._tmpQuat=d.b.Identity(),i._tmpMats=xe.a.BuildArray(5,d.a.Identity),i}(),ke=c(10),Nt=c(27),en=c(26);function Sa(i,t,e,n){var r;r=n===g.a.TEXTURETYPE_FLOAT?new Float32Array(t*e*4):new Uint32Array(t*e*4);for(var o=0;o<t;o++)for(var u=0;u<e;u++){var f=3*(u*t+o),v=4*(u*t+o);r[v+0]=i[f+0],r[v+1]=i[f+1],r[v+2]=i[f+2],r[v+3]=1}return r}function cs(i){return function(t,e,n,r,o,u,f,v,y,D){y===void 0&&(y=null),D===void 0&&(D=g.a.TEXTURETYPE_UNSIGNED_INT);var w=i?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,F=i?Nt.b.Raw3D:Nt.b.Raw2DArray,z=new Nt.a(this,F);z.baseWidth=e,z.baseHeight=n,z.baseDepth=r,z.width=e,z.height=n,z.depth=r,z.format=o,z.type=D,z.generateMipMaps=u,z.samplingMode=v,i?z.is3D=!0:z.is2DArray=!0,this._doNotHandleContextLost||(z._bufferView=t),i?this.updateRawTexture3D(z,t,o,f,y,D):this.updateRawTexture2DArray(z,t,o,f,y,D),this._bindTextureDirectly(w,z,!0);var k=this._getSamplingParameters(v,u);return this._gl.texParameteri(w,this._gl.TEXTURE_MAG_FILTER,k.mag),this._gl.texParameteri(w,this._gl.TEXTURE_MIN_FILTER,k.min),u&&this._gl.generateMipmap(w),this._bindTextureDirectly(w,null),this._internalTexturesCache.push(z),z}}function Yu(i){return function(t,e,n,r,o,u){o===void 0&&(o=null),u===void 0&&(u=g.a.TEXTURETYPE_UNSIGNED_INT);var f=i?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,v=this._getWebGLTextureType(u),y=this._getInternalFormat(n),D=this._getRGBABufferInternalSizedFormat(u,n);this._bindTextureDirectly(f,t,!0),this._unpackFlipY(r===void 0||!!r),this._doNotHandleContextLost||(t._bufferView=e,t.format=n,t.invertY=r,t._compression=o),t.width%4!=0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),o&&e?this._gl.compressedTexImage3D(f,0,this.getCaps().s3tc[o],t.width,t.height,t.depth,0,e):this._gl.texImage3D(f,0,D,t.width,t.height,t.depth,0,y,v,e),t.generateMipMaps&&this._gl.generateMipmap(f),this._bindTextureDirectly(f,null),t.isReady=!0}}en.a.prototype.updateRawTexture=function(i,t,e,n,r,o){if(r===void 0&&(r=null),o===void 0&&(o=g.a.TEXTURETYPE_UNSIGNED_INT),i){var u=this._getRGBABufferInternalSizedFormat(o,e),f=this._getInternalFormat(e),v=this._getWebGLTextureType(o);this._bindTextureDirectly(this._gl.TEXTURE_2D,i,!0),this._unpackFlipY(n===void 0||!!n),this._doNotHandleContextLost||(i._bufferView=t,i.format=e,i.type=o,i.invertY=n,i._compression=r),i.width%4!=0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),r&&t?this._gl.compressedTexImage2D(this._gl.TEXTURE_2D,0,this.getCaps().s3tc[r],i.width,i.height,0,t):this._gl.texImage2D(this._gl.TEXTURE_2D,0,u,i.width,i.height,0,f,v,t),i.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),i.isReady=!0}},en.a.prototype.createRawTexture=function(i,t,e,n,r,o,u,f,v){f===void 0&&(f=null),v===void 0&&(v=g.a.TEXTURETYPE_UNSIGNED_INT);var y=new Nt.a(this,Nt.b.Raw);y.baseWidth=t,y.baseHeight=e,y.width=t,y.height=e,y.format=n,y.generateMipMaps=r,y.samplingMode=u,y.invertY=o,y._compression=f,y.type=v,this._doNotHandleContextLost||(y._bufferView=i),this.updateRawTexture(y,i,n,o,f,v),this._bindTextureDirectly(this._gl.TEXTURE_2D,y,!0);var D=this._getSamplingParameters(u,r);return this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,D.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,D.min),r&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._internalTexturesCache.push(y),y},en.a.prototype.createRawCubeTexture=function(i,t,e,n,r,o,u,f){f===void 0&&(f=null);var v=this._gl,y=new Nt.a(this,Nt.b.CubeRaw);y.isCube=!0,y.format=e,y.type=n,this._doNotHandleContextLost||(y._bufferViewArray=i);var D=this._getWebGLTextureType(n),w=this._getInternalFormat(e);w===v.RGB&&(w=v.RGBA),D!==v.FLOAT||this._caps.textureFloatLinearFiltering?D!==this._gl.HALF_FLOAT_OES||this._caps.textureHalfFloatLinearFiltering?D!==v.FLOAT||this._caps.textureFloatRender?D!==v.HALF_FLOAT||this._caps.colorBufferFloat||(r=!1,_.a.Warn("Render to half float textures is not supported. Mipmap generation forced to false.")):(r=!1,_.a.Warn("Render to float textures is not supported. Mipmap generation forced to false.")):(r=!1,u=g.a.TEXTURE_NEAREST_SAMPLINGMODE,_.a.Warn("Half float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.")):(r=!1,u=g.a.TEXTURE_NEAREST_SAMPLINGMODE,_.a.Warn("Float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively."));var F=t,z=F;y.width=F,y.height=z,!this.needPOTTextures||et.b.IsExponentOfTwo(y.width)&&et.b.IsExponentOfTwo(y.height)||(r=!1),i&&this.updateRawCubeTexture(y,i,e,n,o,f),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,y,!0),i&&r&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP);var k=this._getSamplingParameters(u,r);return v.texParameteri(v.TEXTURE_CUBE_MAP,v.TEXTURE_MAG_FILTER,k.mag),v.texParameteri(v.TEXTURE_CUBE_MAP,v.TEXTURE_MIN_FILTER,k.min),v.texParameteri(v.TEXTURE_CUBE_MAP,v.TEXTURE_WRAP_S,v.CLAMP_TO_EDGE),v.texParameteri(v.TEXTURE_CUBE_MAP,v.TEXTURE_WRAP_T,v.CLAMP_TO_EDGE),this._bindTextureDirectly(v.TEXTURE_CUBE_MAP,null),y.generateMipMaps=r,y},en.a.prototype.updateRawCubeTexture=function(i,t,e,n,r,o,u){o===void 0&&(o=null),u===void 0&&(u=0),i._bufferViewArray=t,i.format=e,i.type=n,i.invertY=r,i._compression=o;var f=this._gl,v=this._getWebGLTextureType(n),y=this._getInternalFormat(e),D=this._getRGBABufferInternalSizedFormat(n),w=!1;y===f.RGB&&(y=f.RGBA,w=!0),this._bindTextureDirectly(f.TEXTURE_CUBE_MAP,i,!0),this._unpackFlipY(r===void 0||!!r),i.width%4!=0&&f.pixelStorei(f.UNPACK_ALIGNMENT,1);for(var F=0;F<6;F++){var z=t[F];o?f.compressedTexImage2D(f.TEXTURE_CUBE_MAP_POSITIVE_X+F,u,this.getCaps().s3tc[o],i.width,i.height,0,z):(w&&(z=Sa(z,i.width,i.height,n)),f.texImage2D(f.TEXTURE_CUBE_MAP_POSITIVE_X+F,u,D,i.width,i.height,0,y,v,z))}(!this.needPOTTextures||et.b.IsExponentOfTwo(i.width)&&et.b.IsExponentOfTwo(i.height))&&i.generateMipMaps&&u===0&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),i.isReady=!0},en.a.prototype.createRawCubeTextureFromUrl=function(i,t,e,n,r,o,u,f,v,y,D,w){var F=this;v===void 0&&(v=null),y===void 0&&(y=null),D===void 0&&(D=g.a.TEXTURE_TRILINEAR_SAMPLINGMODE),w===void 0&&(w=!1);var z=this._gl,k=this.createRawCubeTexture(null,e,n,r,!o,w,D,null);return t==null||t._addPendingData(k),k.url=i,this._internalTexturesCache.push(k),this._loadFile(i,function(K){(function(oe){var ae=k.width,ue=u(oe);if(ue){if(f){var de=F._getWebGLTextureType(r),me=F._getInternalFormat(n),ye=F._getRGBABufferInternalSizedFormat(r),Ee=!1;me===z.RGB&&(me=z.RGBA,Ee=!0),F._bindTextureDirectly(z.TEXTURE_CUBE_MAP,k,!0),F._unpackFlipY(!1);for(var Ae=f(ue),Ie=0;Ie<Ae.length;Ie++)for(var Re=ae>>Ie,Pe=0;Pe<6;Pe++){var Ce=Ae[Ie][Pe];Ee&&(Ce=Sa(Ce,Re,Re,r)),z.texImage2D(Pe,Ie,ye,Re,Re,0,me,de,Ce)}F._bindTextureDirectly(z.TEXTURE_CUBE_MAP,null)}else F.updateRawCubeTexture(k,ue,n,r,w);k.isReady=!0,t==null||t._removePendingData(k),v&&v()}})(K)},void 0,t==null?void 0:t.offlineProvider,!0,function(K,oe){t==null||t._removePendingData(k),y&&K&&y(K.status+" "+K.statusText,oe)}),k},en.a.prototype.createRawTexture2DArray=cs(!1),en.a.prototype.createRawTexture3D=cs(!0),en.a.prototype.updateRawTexture2DArray=Yu(!1),en.a.prototype.updateRawTexture3D=Yu(!0);var Pr=function(i){function t(e,n,r,o,u,f,v,y,D){f===void 0&&(f=!0),v===void 0&&(v=!1),y===void 0&&(y=g.a.TEXTURE_TRILINEAR_SAMPLINGMODE),D===void 0&&(D=g.a.TEXTURETYPE_UNSIGNED_INT);var w=i.call(this,null,u,!f,v)||this;return w.format=o,w._engine&&(w._texture=w._engine.createRawTexture(e,n,r,o,f,v,y,null,D),w.wrapU=ke.a.CLAMP_ADDRESSMODE,w.wrapV=ke.a.CLAMP_ADDRESSMODE),w}return Object(p.d)(t,i),t.prototype.update=function(e){this._getEngine().updateRawTexture(this._texture,e,this._texture.format,this._texture.invertY,null,this._texture.type)},t.CreateLuminanceTexture=function(e,n,r,o,u,f,v){return u===void 0&&(u=!0),f===void 0&&(f=!1),v===void 0&&(v=g.a.TEXTURE_TRILINEAR_SAMPLINGMODE),new t(e,n,r,g.a.TEXTUREFORMAT_LUMINANCE,o,u,f,v)},t.CreateLuminanceAlphaTexture=function(e,n,r,o,u,f,v){return u===void 0&&(u=!0),f===void 0&&(f=!1),v===void 0&&(v=g.a.TEXTURE_TRILINEAR_SAMPLINGMODE),new t(e,n,r,g.a.TEXTUREFORMAT_LUMINANCE_ALPHA,o,u,f,v)},t.CreateAlphaTexture=function(e,n,r,o,u,f,v){return u===void 0&&(u=!0),f===void 0&&(f=!1),v===void 0&&(v=g.a.TEXTURE_TRILINEAR_SAMPLINGMODE),new t(e,n,r,g.a.TEXTUREFORMAT_ALPHA,o,u,f,v)},t.CreateRGBTexture=function(e,n,r,o,u,f,v,y){return u===void 0&&(u=!0),f===void 0&&(f=!1),v===void 0&&(v=g.a.TEXTURE_TRILINEAR_SAMPLINGMODE),y===void 0&&(y=g.a.TEXTURETYPE_UNSIGNED_INT),new t(e,n,r,g.a.TEXTUREFORMAT_RGB,o,u,f,v,y)},t.CreateRGBATexture=function(e,n,r,o,u,f,v,y){return u===void 0&&(u=!0),f===void 0&&(f=!1),v===void 0&&(v=g.a.TEXTURE_TRILINEAR_SAMPLINGMODE),y===void 0&&(y=g.a.TEXTURETYPE_UNSIGNED_INT),new t(e,n,r,g.a.TEXTUREFORMAT_RGBA,o,u,f,v,y)},t.CreateRTexture=function(e,n,r,o,u,f,v,y){return u===void 0&&(u=!0),f===void 0&&(f=!1),v===void 0&&(v=ke.a.TRILINEAR_SAMPLINGMODE),y===void 0&&(y=g.a.TEXTURETYPE_FLOAT),new t(e,n,r,g.a.TEXTUREFORMAT_R,o,u,f,v,y)},t}(ke.a),xa=function(){function i(t,e,n){this.name=t,this.id=e,this.bones=new Array,this.needInitialSkinMatrix=!1,this.overrideMesh=null,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=d.a.Identity(),this._ranges={},this._lastAbsoluteTransformsUpdateId=-1,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._waitingOverrideMeshId=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new S.c,this.bones=[],this._scene=n||ne.a.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;var r=this._scene.getEngine().getCaps();this._canUseTextureForBones=r.textureFloat&&r.maxVertexTextureImageUnits>0}return Object.defineProperty(i.prototype,"useTextureToStoreBoneMatrices",{get:function(){return this._useTextureToStoreBoneMatrices},set:function(t){this._useTextureToStoreBoneMatrices=t,this._markAsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"animationPropertiesOverride",{get:function(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride},set:function(t){this._animationPropertiesOverride=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isUsingTextureForMatrices",{get:function(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"uniqueId",{get:function(){return this._uniqueId},enumerable:!1,configurable:!0}),i.prototype.getClassName=function(){return"Skeleton"},i.prototype.getChildren=function(){return this.bones.filter(function(t){return!t.getParent()})},i.prototype.getTransformMatrices=function(t){return this.needInitialSkinMatrix&&t._bonesTransformMatrices?t._bonesTransformMatrices:(this._transformMatrices||this.prepare(),this._transformMatrices)},i.prototype.getTransformMatrixTexture=function(t){return this.needInitialSkinMatrix&&t._transformMatrixTexture?t._transformMatrixTexture:this._transformMatrixTexture},i.prototype.getScene=function(){return this._scene},i.prototype.toString=function(t){var e="Name: "+this.name+", nBones: "+this.bones.length;if(e+=", nAnimationRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),t){e+=", Ranges: {";var n=!0;for(var r in this._ranges)n&&(e+=", ",n=!1),e+=r;e+="}"}return e},i.prototype.getBoneIndexByName=function(t){for(var e=0,n=this.bones.length;e<n;e++)if(this.bones[e].name===t)return e;return-1},i.prototype.createAnimationRange=function(t,e,n){if(!this._ranges[t]){this._ranges[t]=new G(t,e,n);for(var r=0,o=this.bones.length;r<o;r++)this.bones[r].animations[0]&&this.bones[r].animations[0].createRange(t,e,n)}},i.prototype.deleteAnimationRange=function(t,e){e===void 0&&(e=!0);for(var n=0,r=this.bones.length;n<r;n++)this.bones[n].animations[0]&&this.bones[n].animations[0].deleteRange(t,e);this._ranges[t]=null},i.prototype.getAnimationRange=function(t){return this._ranges[t]||null},i.prototype.getAnimationRanges=function(){var t,e=[];for(t in this._ranges)e.push(this._ranges[t]);return e},i.prototype.copyAnimationRange=function(t,e,n){if(n===void 0&&(n=!1),this._ranges[e]||!t.getAnimationRange(e))return!1;var r,o,u=!0,f=this._getHighestAnimationFrame()+1,v={},y=t.bones;for(o=0,r=y.length;o<r;o++)v[y[o].name]=y[o];this.bones.length!==y.length&&(_.a.Warn("copyAnimationRange: this rig has "+this.bones.length+" bones, while source as "+y.length),u=!1);var D=n&&this.dimensionsAtRest&&t.dimensionsAtRest?this.dimensionsAtRest.divide(t.dimensionsAtRest):null;for(o=0,r=this.bones.length;o<r;o++){var w=this.bones[o].name,F=v[w];F?u=u&&this.bones[o].copyAnimationRange(F,e,f,n,D):(_.a.Warn("copyAnimationRange: not same rig, missing source bone "+w),u=!1)}var z=t.getAnimationRange(e);return z&&(this._ranges[e]=new G(e,z.from+f,z.to+f)),u},i.prototype.returnToRest=function(){for(var t=d.c.Vector3[0],e=d.c.Quaternion[0],n=d.c.Vector3[1],r=0;r<this.bones.length;r++){var o=this.bones[r];o._index!==-1&&(o.returnToRest(),o._linkedTransformNode&&(o.getRestPose().decompose(t,e,n),o._linkedTransformNode.position=n.clone(),o._linkedTransformNode.rotationQuaternion=e.clone(),o._linkedTransformNode.scaling=t.clone()))}},i.prototype._getHighestAnimationFrame=function(){for(var t=0,e=0,n=this.bones.length;e<n;e++)if(this.bones[e].animations[0]){var r=this.bones[e].animations[0].getHighestFrame();t<r&&(t=r)}return t},i.prototype.beginAnimation=function(t,e,n,r){var o=this.getAnimationRange(t);return o?this._scene.beginAnimation(this,o.from,o.to,e,n,r):null},i.MakeAnimationAdditive=function(t,e,n){e===void 0&&(e=0);var r=t.getAnimationRange(n);if(!r)return null;for(var o=t._scene.getAllAnimatablesByTarget(t),u=null,f=0;f<o.length;f++){var v=o[f];if(v.fromFrame===(r==null?void 0:r.from)&&v.toFrame===(r==null?void 0:r.to)){u=v;break}}var y=t.getAnimatables();for(f=0;f<y.length;f++){var D=y[f].animations;if(D)for(var w=0;w<D.length;w++)H.MakeAnimationAdditive(D[w],e,n)}return u&&(u.isAdditive=!0),t},i.prototype._markAsDirty=function(){this._isDirty=!0},i.prototype._registerMeshWithPoseMatrix=function(t){this._meshesWithPoseMatrix.push(t)},i.prototype._unregisterMeshWithPoseMatrix=function(t){var e=this._meshesWithPoseMatrix.indexOf(t);e>-1&&this._meshesWithPoseMatrix.splice(e,1)},i.prototype._computeTransformMatrices=function(t,e){this.onBeforeComputeObservable.notifyObservers(this);for(var n=0;n<this.bones.length;n++){var r=this.bones[n];r._childUpdateId++;var o=r.getParent();if(o?r.getLocalMatrix().multiplyToRef(o.getWorldMatrix(),r.getWorldMatrix()):e?r.getLocalMatrix().multiplyToRef(e,r.getWorldMatrix()):r.getWorldMatrix().copyFrom(r.getLocalMatrix()),r._index!==-1){var u=r._index===null?n:r._index;r.getInvertedAbsoluteTransform().multiplyToArray(r.getWorldMatrix(),t,16*u)}}this._identity.copyToArray(t,16*this.bones.length)},i.prototype.prepare=function(){if(this._numBonesWithLinkedTransformNode>0)for(var t=0,e=this.bones;t<e.length;t++){var n=e[t];n._linkedTransformNode&&(n._linkedTransformNode.computeWorldMatrix(),n._matrix=n._linkedTransformNode._localMatrix,n.markAsDirty())}if(this._isDirty){if(this.needInitialSkinMatrix)for(var r=0;r<this._meshesWithPoseMatrix.length;r++){var o=this._meshesWithPoseMatrix[r],u=o.getPoseMatrix();if(o._bonesTransformMatrices&&o._bonesTransformMatrices.length===16*(this.bones.length+1)||(o._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1))),this._synchronizedWithMesh!==o){this._synchronizedWithMesh=o;for(var f=0;f<this.bones.length;f++){var v=this.bones[f];v.getParent()||(v.getBaseMatrix().multiplyToRef(u,d.c.Matrix[1]),v._updateDifferenceMatrix(d.c.Matrix[1]))}if(this.isUsingTextureForMatrices){var y=4*(this.bones.length+1);o._transformMatrixTexture&&o._transformMatrixTexture.getSize().width===y||(o._transformMatrixTexture&&o._transformMatrixTexture.dispose(),o._transformMatrixTexture=Pr.CreateRGBATexture(o._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,g.a.TEXTURE_NEAREST_SAMPLINGMODE,g.a.TEXTURETYPE_FLOAT))}}this._computeTransformMatrices(o._bonesTransformMatrices,u),this.isUsingTextureForMatrices&&o._transformMatrixTexture&&o._transformMatrixTexture.update(o._bonesTransformMatrices)}else this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=Pr.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,g.a.TEXTURE_NEAREST_SAMPLINGMODE,g.a.TEXTURETYPE_FLOAT))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices);this._isDirty=!1,this._scene._activeBones.addCount(this.bones.length,!1)}},i.prototype.getAnimatables=function(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(var t=0;t<this.bones.length;t++)this._animatables.push(this.bones[t])}return this._animatables},i.prototype.clone=function(t,e){var n=new i(t,e||t,this._scene);n.needInitialSkinMatrix=this.needInitialSkinMatrix,n.overrideMesh=this.overrideMesh;for(var r=0;r<this.bones.length;r++){var o=this.bones[r],u=null,f=o.getParent();if(f){var v=this.bones.indexOf(f);u=n.bones[v]}var y=new Ue(o.name,n,u,o.getBaseMatrix().clone(),o.getRestPose().clone());y._index=o._index,o._linkedTransformNode&&y.linkTransformNode(o._linkedTransformNode),ge.a.DeepCopy(o.animations,y.animations)}if(this._ranges)for(var D in n._ranges={},this._ranges){var w=this._ranges[D];w&&(n._ranges[D]=w.clone())}return this._isDirty=!0,n},i.prototype.enableBlending=function(t){t===void 0&&(t=.01),this.bones.forEach(function(e){e.animations.forEach(function(n){n.enableBlending=!0,n.blendingSpeed=t})})},i.prototype.dispose=function(){this._meshesWithPoseMatrix=[],this.getScene().stopAnimation(this),this.getScene().removeSkeleton(this),this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)},i.prototype.serialize=function(){var t,e,n={};n.name=this.name,n.id=this.id,this.dimensionsAtRest&&(n.dimensionsAtRest=this.dimensionsAtRest.asArray()),n.bones=[],n.needInitialSkinMatrix=this.needInitialSkinMatrix,n.overrideMeshId=(t=this.overrideMesh)===null||t===void 0?void 0:t.id;for(var r=0;r<this.bones.length;r++){var o=this.bones[r],u=o.getParent(),f={parentBoneIndex:u?this.bones.indexOf(u):-1,index:o.getIndex(),name:o.name,matrix:o.getBaseMatrix().toArray(),rest:o.getRestPose().toArray(),linkedTransformNodeId:(e=o.getTransformNode())===null||e===void 0?void 0:e.id};for(var v in n.bones.push(f),o.length&&(f.length=o.length),o.metadata&&(f.metadata=o.metadata),o.animations&&o.animations.length>0&&(f.animation=o.animations[0].serialize()),n.ranges=[],this._ranges){var y=this._ranges[v];if(y){var D={};D.name=v,D.from=y.from,D.to=y.to,n.ranges.push(D)}}}return n},i.Parse=function(t,e){var n,r=new i(t.name,t.id,e);for(t.dimensionsAtRest&&(r.dimensionsAtRest=d.e.FromArray(t.dimensionsAtRest)),r.needInitialSkinMatrix=t.needInitialSkinMatrix,t.overrideMeshId&&(r._hasWaitingData=!0,r._waitingOverrideMeshId=t.overrideMeshId),n=0;n<t.bones.length;n++){var o=t.bones[n],u=t.bones[n].index,f=null;o.parentBoneIndex>-1&&(f=r.bones[o.parentBoneIndex]);var v=o.rest?d.a.FromArray(o.rest):null,y=new Ue(o.name,r,f,d.a.FromArray(o.matrix),v,null,u);o.id!==void 0&&o.id!==null&&(y.id=o.id),o.length&&(y.length=o.length),o.metadata&&(y.metadata=o.metadata),o.animation&&y.animations.push(H.Parse(o.animation)),o.linkedTransformNodeId!==void 0&&o.linkedTransformNodeId!==null&&(r._hasWaitingData=!0,y._waitingTransformNodeId=o.linkedTransformNodeId)}if(t.ranges)for(n=0;n<t.ranges.length;n++){var D=t.ranges[n];r.createAnimationRange(D.name,D.from,D.to)}return r},i.prototype.computeAbsoluteTransforms=function(t){t===void 0&&(t=!1);var e=this._scene.getRenderId();(this._lastAbsoluteTransformsUpdateId!=e||t)&&(this.bones[0].computeAbsoluteTransforms(),this._lastAbsoluteTransformsUpdateId=e)},i.prototype.getPoseMatrix=function(){var t=null;return this._meshesWithPoseMatrix.length>0&&(t=this._meshesWithPoseMatrix[0].getPoseMatrix()),t},i.prototype.sortBones=function(){for(var t=new Array,e=new Array(this.bones.length),n=0;n<this.bones.length;n++)this._sortBones(n,t,e);this.bones=t},i.prototype._sortBones=function(t,e,n){if(!n[t]){n[t]=!0;var r=this.bones[t];r._index===void 0&&(r._index=t);var o=r.getParent();o&&this._sortBones(this.bones.indexOf(o),e,n),e.push(r)}},i.prototype.setCurrentPoseAsRest=function(){this.bones.forEach(function(t){t.setCurrentPoseAsRest()})},i}(),Kn={},Aa=function(){function i(t){this.attachedToElement=!1,this.attached={},this.camera=t,this.checkInputs=function(){}}return i.prototype.add=function(t){var e=t.getSimpleName();this.attached[e]?_.a.Warn("camera input of type "+e+" already exists on camera"):(this.attached[e]=t,t.camera=this.camera,t.checkInputs&&(this.checkInputs=this._addCheckInputs(t.checkInputs.bind(t))),this.attachedToElement&&t.attachControl())},i.prototype.remove=function(t){for(var e in this.attached){var n=this.attached[e];n===t&&(n.detachControl(),n.camera=null,delete this.attached[e],this.rebuildInputCheck())}},i.prototype.removeByType=function(t){for(var e in this.attached){var n=this.attached[e];n.getClassName()===t&&(n.detachControl(),n.camera=null,delete this.attached[e],this.rebuildInputCheck())}},i.prototype._addCheckInputs=function(t){var e=this.checkInputs;return function(){e(),t()}},i.prototype.attachInput=function(t){this.attachedToElement&&t.attachControl(this.noPreventDefault)},i.prototype.attachElement=function(t){if(t===void 0&&(t=!1),!this.attachedToElement)for(var e in t=!Pt.a.ForceAttachControlToAlwaysPreventDefault&&t,this.attachedToElement=!0,this.noPreventDefault=t,this.attached)this.attached[e].attachControl(t)},i.prototype.detachElement=function(t){for(var e in t===void 0&&(t=!1),this.attached)this.attached[e].detachControl(),t&&(this.attached[e].camera=null);this.attachedToElement=!1},i.prototype.rebuildInputCheck=function(){for(var t in this.checkInputs=function(){},this.attached){var e=this.attached[t];e.checkInputs&&(this.checkInputs=this._addCheckInputs(e.checkInputs.bind(e)))}},i.prototype.clear=function(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=function(){}},i.prototype.serialize=function(t){var e={};for(var n in this.attached){var r=this.attached[n],o=B.a.Serialize(r);e[r.getClassName()]=o}t.inputsmgr=e},i.prototype.parse=function(t){var e=t.inputsmgr;if(e){for(var n in this.clear(),e)if(u=Kn[n]){var r=e[n],o=B.a.Parse(function(){return new u},r,null);this.add(o)}}else for(var n in this.attached){var u;(u=Kn[this.attached[n].getClassName()])&&(o=B.a.Parse(function(){return new u},t,null),this.remove(this.attached[n]),this.add(o))}},i}(),Pp=function(i,t){this.x=i,this.y=t},Gn=function(){function i(t,e,n,r,o,u,f){r===void 0&&(r=0),o===void 0&&(o=1),u===void 0&&(u=2),f===void 0&&(f=3),this.id=t,this.index=e,this.browserGamepad=n,this._leftStick={x:0,y:0},this._rightStick={x:0,y:0},this._isConnected=!0,this._invertLeftStickY=!1,this.type=i.GAMEPAD,this._leftStickAxisX=r,this._leftStickAxisY=o,this._rightStickAxisX=u,this._rightStickAxisY=f,this.browserGamepad.axes.length>=2&&(this._leftStick={x:this.browserGamepad.axes[this._leftStickAxisX],y:this.browserGamepad.axes[this._leftStickAxisY]}),this.browserGamepad.axes.length>=4&&(this._rightStick={x:this.browserGamepad.axes[this._rightStickAxisX],y:this.browserGamepad.axes[this._rightStickAxisY]})}return Object.defineProperty(i.prototype,"isConnected",{get:function(){return this._isConnected},enumerable:!1,configurable:!0}),i.prototype.onleftstickchanged=function(t){this._onleftstickchanged=t},i.prototype.onrightstickchanged=function(t){this._onrightstickchanged=t},Object.defineProperty(i.prototype,"leftStick",{get:function(){return this._leftStick},set:function(t){!this._onleftstickchanged||this._leftStick.x===t.x&&this._leftStick.y===t.y||this._onleftstickchanged(t),this._leftStick=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"rightStick",{get:function(){return this._rightStick},set:function(t){!this._onrightstickchanged||this._rightStick.x===t.x&&this._rightStick.y===t.y||this._onrightstickchanged(t),this._rightStick=t},enumerable:!1,configurable:!0}),i.prototype.update=function(){this._leftStick&&(this.leftStick={x:this.browserGamepad.axes[this._leftStickAxisX],y:this.browserGamepad.axes[this._leftStickAxisY]},this._invertLeftStickY&&(this.leftStick.y*=-1)),this._rightStick&&(this.rightStick={x:this.browserGamepad.axes[this._rightStickAxisX],y:this.browserGamepad.axes[this._rightStickAxisY]})},i.prototype.dispose=function(){},i.GAMEPAD=0,i.GENERIC=1,i.XBOX=2,i.POSE_ENABLED=3,i.DUALSHOCK=4,i}(),Ku=function(i){function t(e,n,r){var o=i.call(this,e,n,r)||this;return o.onButtonDownObservable=new S.c,o.onButtonUpObservable=new S.c,o.type=Gn.GENERIC,o._buttons=new Array(r.buttons.length),o}return Object(p.d)(t,i),t.prototype.onbuttondown=function(e){this._onbuttondown=e},t.prototype.onbuttonup=function(e){this._onbuttonup=e},t.prototype._setButtonValue=function(e,n,r){return e!==n&&(e===1&&(this._onbuttondown&&this._onbuttondown(r),this.onButtonDownObservable.notifyObservers(r)),e===0&&(this._onbuttonup&&this._onbuttonup(r),this.onButtonUpObservable.notifyObservers(r))),e},t.prototype.update=function(){i.prototype.update.call(this);for(var e=0;e<this._buttons.length;e++)this._buttons[e]=this._setButtonValue(this.browserGamepad.buttons[e].value,this._buttons[e],e)},t.prototype.dispose=function(){i.prototype.dispose.call(this),this.onButtonDownObservable.clear(),this.onButtonUpObservable.clear()},t}(Gn),Bc=function(){function i(){this.gamepadRotationSensibility=80,this.gamepadMoveSensibility=40,this._yAxisScale=1}return Object.defineProperty(i.prototype,"invertYAxis",{get:function(){return this._yAxisScale!==1},set:function(t){this._yAxisScale=t?-1:1},enumerable:!1,configurable:!0}),i.prototype.attachControl=function(){var t=this,e=this.camera.getScene().gamepadManager;this._onGamepadConnectedObserver=e.onGamepadConnectedObservable.add(function(n){n.type!==Gn.POSE_ENABLED&&(t.gamepad&&n.type!==Gn.XBOX||(t.gamepad=n))}),this._onGamepadDisconnectedObserver=e.onGamepadDisconnectedObservable.add(function(n){t.gamepad===n&&(t.gamepad=null)}),this.gamepad=e.getGamepadByType(Gn.XBOX)},i.prototype.detachControl=function(t){this.camera.getScene().gamepadManager.onGamepadConnectedObservable.remove(this._onGamepadConnectedObserver),this.camera.getScene().gamepadManager.onGamepadDisconnectedObservable.remove(this._onGamepadDisconnectedObserver),this.gamepad=null},i.prototype.checkInputs=function(){if(this.gamepad){var t=this.camera,e=this.gamepad.rightStick;if(e){if(e.x!=0){var n=e.x/this.gamepadRotationSensibility;n!=0&&Math.abs(n)>.005&&(t.inertialAlphaOffset+=n)}if(e.y!=0){var r=e.y/this.gamepadRotationSensibility*this._yAxisScale;r!=0&&Math.abs(r)>.005&&(t.inertialBetaOffset+=r)}}var o=this.gamepad.leftStick;if(o&&o.y!=0){var u=o.y/this.gamepadMoveSensibility;u!=0&&Math.abs(u)>.005&&(this.camera.inertialRadiusOffset-=u)}}},i.prototype.getClassName=function(){return"ArcRotateCameraGamepadInput"},i.prototype.getSimpleName=function(){return"gamepad"},Object(p.c)([Object(B.c)()],i.prototype,"gamepadRotationSensibility",void 0),Object(p.c)([Object(B.c)()],i.prototype,"gamepadMoveSensibility",void 0),i}();Kn.ArcRotateCameraGamepadInput=Bc;var no=c(66),Uc=function(){function i(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}return i.prototype.attachControl=function(t){var e=this;t=et.b.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add(function(){e._keys=[]}),this._onKeyboardObserver=this._scene.onKeyboardObservable.add(function(n){var r,o=n.event;o.metaKey||(n.type===no.a.KEYDOWN?(e._ctrlPressed=o.ctrlKey,e._altPressed=o.altKey,(e.keysUp.indexOf(o.keyCode)!==-1||e.keysDown.indexOf(o.keyCode)!==-1||e.keysLeft.indexOf(o.keyCode)!==-1||e.keysRight.indexOf(o.keyCode)!==-1||e.keysReset.indexOf(o.keyCode)!==-1)&&((r=e._keys.indexOf(o.keyCode))===-1&&e._keys.push(o.keyCode),o.preventDefault&&(t||o.preventDefault()))):e.keysUp.indexOf(o.keyCode)===-1&&e.keysDown.indexOf(o.keyCode)===-1&&e.keysLeft.indexOf(o.keyCode)===-1&&e.keysRight.indexOf(o.keyCode)===-1&&e.keysReset.indexOf(o.keyCode)===-1||((r=e._keys.indexOf(o.keyCode))>=0&&e._keys.splice(r,1),o.preventDefault&&(t||o.preventDefault())))}))},i.prototype.detachControl=function(t){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys=[]},i.prototype.checkInputs=function(){if(this._onKeyboardObserver)for(var t=this.camera,e=0;e<this._keys.length;e++){var n=this._keys[e];this.keysLeft.indexOf(n)!==-1?this._ctrlPressed&&this.camera._useCtrlForPanning?t.inertialPanningX-=1/this.panningSensibility:t.inertialAlphaOffset-=this.angularSpeed:this.keysUp.indexOf(n)!==-1?this._ctrlPressed&&this.camera._useCtrlForPanning?t.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?t.inertialRadiusOffset+=1/this.zoomingSensibility:t.inertialBetaOffset-=this.angularSpeed:this.keysRight.indexOf(n)!==-1?this._ctrlPressed&&this.camera._useCtrlForPanning?t.inertialPanningX+=1/this.panningSensibility:t.inertialAlphaOffset+=this.angularSpeed:this.keysDown.indexOf(n)!==-1?this._ctrlPressed&&this.camera._useCtrlForPanning?t.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?t.inertialRadiusOffset-=1/this.zoomingSensibility:t.inertialBetaOffset+=this.angularSpeed:this.keysReset.indexOf(n)!==-1&&t.useInputToRestoreState&&t.restoreState()}},i.prototype.getClassName=function(){return"ArcRotateCameraKeyboardMoveInput"},i.prototype.getSimpleName=function(){return"keyboard"},Object(p.c)([Object(B.c)()],i.prototype,"keysUp",void 0),Object(p.c)([Object(B.c)()],i.prototype,"keysDown",void 0),Object(p.c)([Object(B.c)()],i.prototype,"keysLeft",void 0),Object(p.c)([Object(B.c)()],i.prototype,"keysRight",void 0),Object(p.c)([Object(B.c)()],i.prototype,"keysReset",void 0),Object(p.c)([Object(B.c)()],i.prototype,"panningSensibility",void 0),Object(p.c)([Object(B.c)()],i.prototype,"zoomingSensibility",void 0),Object(p.c)([Object(B.c)()],i.prototype,"useAltToZoom",void 0),Object(p.c)([Object(B.c)()],i.prototype,"angularSpeed",void 0),i}();Kn.ArcRotateCameraKeyboardMoveInput=Uc;var Vc=function(){function i(){this.wheelPrecision=3,this.wheelDeltaPercentage=0}return i.prototype.computeDeltaFromMouseWheelLegacyEvent=function(t,e){var n=.01*t*this.wheelDeltaPercentage*e;return t>0?n/(1+this.wheelDeltaPercentage):n*(1+this.wheelDeltaPercentage)},i.prototype.attachControl=function(t){var e=this;t=et.b.BackCompatCameraNoPreventDefault(arguments),this._wheel=function(n,r){if(n.type===Ot.a.POINTERWHEEL){var o=n.event,u=0,f=o,v=0;if(v=f.wheelDelta?f.wheelDelta:60*-(o.deltaY||o.detail),e.wheelDeltaPercentage){if((u=e.computeDeltaFromMouseWheelLegacyEvent(v,e.camera.radius))>0){for(var y=e.camera.radius,D=e.camera.inertialRadiusOffset+u,w=0;w<20&&Math.abs(D)>.001;w++)y-=D,D*=e.camera.inertia;y=te.a.Clamp(y,0,Number.MAX_VALUE),u=e.computeDeltaFromMouseWheelLegacyEvent(v,y)}}else u=v/(40*e.wheelPrecision);u&&(e.camera.inertialRadiusOffset+=u),o.preventDefault&&(t||o.preventDefault())}},this._observer=this.camera.getScene().onPointerObservable.add(this._wheel,Ot.a.POINTERWHEEL)},i.prototype.detachControl=function(t){this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this._wheel=null)},i.prototype.getClassName=function(){return"ArcRotateCameraMouseWheelInput"},i.prototype.getSimpleName=function(){return"mousewheel"},Object(p.c)([Object(B.c)()],i.prototype,"wheelPrecision",void 0),Object(p.c)([Object(B.c)()],i.prototype,"wheelDeltaPercentage",void 0),i}();Kn.ArcRotateCameraMouseWheelInput=Vc;var Qu=function(){function i(){this.buttons=[0,1,2]}return i.prototype.attachControl=function(t){var e=this;t=et.b.BackCompatCameraNoPreventDefault(arguments);var n=this.camera.getEngine(),r=n.getInputElement(),o=0,u=null;this.pointA=null,this.pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=function(v,y){var D=v.event,w=D.pointerType==="touch";if(!n.isInVRExclusivePointerMode&&(v.type===Ot.a.POINTERMOVE||e.buttons.indexOf(D.button)!==-1)){var F=D.srcElement||D.target;if(e._altKey=D.altKey,e._ctrlKey=D.ctrlKey,e._metaKey=D.metaKey,e._shiftKey=D.shiftKey,e._buttonsPressed=D.buttons,n.isPointerLock){var z=D.movementX||D.mozMovementX||D.webkitMovementX||D.msMovementX||0,k=D.movementY||D.mozMovementY||D.webkitMovementY||D.msMovementY||0;e.onTouch(null,z,k),e.pointA=null,e.pointB=null}else if(v.type===Ot.a.POINTERDOWN&&F){try{F.setPointerCapture(D.pointerId)}catch(me){}e.pointA===null?e.pointA={x:D.clientX,y:D.clientY,pointerId:D.pointerId,type:D.pointerType}:e.pointB===null&&(e.pointB={x:D.clientX,y:D.clientY,pointerId:D.pointerId,type:D.pointerType}),e.onButtonDown(D),t||(D.preventDefault(),r&&r.focus())}else if(v.type===Ot.a.POINTERDOUBLETAP)e.onDoubleTap(D.pointerType);else if(v.type===Ot.a.POINTERUP&&F){try{F.releasePointerCapture(D.pointerId)}catch(me){}w||(e.pointB=null),n._badOS?e.pointA=e.pointB=null:e.pointB&&e.pointA&&e.pointA.pointerId==D.pointerId?(e.pointA=e.pointB,e.pointB=null):e.pointA&&e.pointB&&e.pointB.pointerId==D.pointerId?e.pointB=null:e.pointA=e.pointB=null,(o!==0||u)&&(e.onMultiTouch(e.pointA,e.pointB,o,0,u,null),o=0,u=null),e.onButtonUp(D),t||D.preventDefault()}else if(v.type===Ot.a.POINTERMOVE){if(t||D.preventDefault(),e.pointA&&e.pointB===null)z=D.clientX-e.pointA.x,k=D.clientY-e.pointA.y,e.onTouch(e.pointA,z,k),e.pointA.x=D.clientX,e.pointA.y=D.clientY;else if(e.pointA&&e.pointB){var K=e.pointA.pointerId===D.pointerId?e.pointA:e.pointB;K.x=D.clientX,K.y=D.clientY;var oe=e.pointA.x-e.pointB.x,ae=e.pointA.y-e.pointB.y,ue=oe*oe+ae*ae,de={x:(e.pointA.x+e.pointB.x)/2,y:(e.pointA.y+e.pointB.y)/2,pointerId:D.pointerId,type:v.type};e.onMultiTouch(e.pointA,e.pointB,o,ue,u,de),u=de,o=ue}}}},this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,Ot.a.POINTERDOWN|Ot.a.POINTERUP|Ot.a.POINTERMOVE),this._onLostFocus=function(){e.pointA=e.pointB=null,o=0,u=null,e.onLostFocus()},r&&r.addEventListener("contextmenu",this.onContextMenu.bind(this),!1);var f=this.camera.getScene().getEngine().getHostWindow();f&&et.b.RegisterTopRootEvents(f,[{name:"blur",handler:this._onLostFocus}])},i.prototype.detachControl=function(t){if(this._onLostFocus){var e=this.camera.getScene().getEngine().getHostWindow();e&&et.b.UnregisterTopRootEvents(e,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this.onContextMenu){var n=this.camera.getScene().getEngine().getInputElement();n&&n.removeEventListener("contextmenu",this.onContextMenu)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0},i.prototype.getClassName=function(){return"BaseCameraPointersInput"},i.prototype.getSimpleName=function(){return"pointers"},i.prototype.onDoubleTap=function(t){},i.prototype.onTouch=function(t,e,n){},i.prototype.onMultiTouch=function(t,e,n,r,o,u){},i.prototype.onContextMenu=function(t){t.preventDefault()},i.prototype.onButtonDown=function(t){},i.prototype.onButtonUp=function(t){},i.prototype.onLostFocus=function(){},Object(p.c)([Object(B.c)()],i.prototype,"buttons",void 0),i}(),kc=function(i){function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.buttons=[0,1,2],e.angularSensibilityX=1e3,e.angularSensibilityY=1e3,e.pinchPrecision=12,e.pinchDeltaPercentage=0,e.useNaturalPinchZoom=!1,e.panningSensibility=1e3,e.multiTouchPanning=!0,e.multiTouchPanAndZoom=!0,e.pinchInwards=!0,e._isPanClick=!1,e._twoFingerActivityCount=0,e._isPinching=!1,e}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"ArcRotateCameraPointersInput"},t.prototype.onTouch=function(e,n,r){this.panningSensibility!==0&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-n/this.panningSensibility,this.camera.inertialPanningY+=r/this.panningSensibility):(this.camera.inertialAlphaOffset-=n/this.angularSensibilityX,this.camera.inertialBetaOffset-=r/this.angularSensibilityY)},t.prototype.onDoubleTap=function(e){this.camera.useInputToRestoreState&&this.camera.restoreState()},t.prototype.onMultiTouch=function(e,n,r,o,u,f){if(!(r===0&&u===null||o===0&&f===null)){var v=this.pinchInwards?1:-1;if(this.multiTouchPanAndZoom){if(this.useNaturalPinchZoom?this.camera.radius=this.camera.radius*Math.sqrt(r)/Math.sqrt(o):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(o-r)*this.camera.radius*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(o-r)/(this.pinchPrecision*v*(this.angularSensibilityX+this.angularSensibilityY)/2),this.panningSensibility!==0&&u&&f){var y=f.x-u.x,D=f.y-u.y;this.camera.inertialPanningX+=-y/this.panningSensibility,this.camera.inertialPanningY+=D/this.panningSensibility}}else{this._twoFingerActivityCount++;var w=Math.sqrt(r),F=Math.sqrt(o);this._isPinching||this._twoFingerActivityCount<20&&Math.abs(F-w)>this.camera.pinchToPanMaxDistance?(this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(o-r)*this.camera.radius*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(o-r)/(this.pinchPrecision*v*(this.angularSensibilityX+this.angularSensibilityY)/2),this._isPinching=!0):this.panningSensibility!==0&&this.multiTouchPanning&&f&&u&&(y=f.x-u.x,D=f.y-u.y,this.camera.inertialPanningX+=-y/this.panningSensibility,this.camera.inertialPanningY+=D/this.panningSensibility)}}},t.prototype.onButtonDown=function(e){this._isPanClick=e.button===this.camera._panningMouseButton},t.prototype.onButtonUp=function(e){this._twoFingerActivityCount=0,this._isPinching=!1},t.prototype.onLostFocus=function(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1},Object(p.c)([Object(B.c)()],t.prototype,"buttons",void 0),Object(p.c)([Object(B.c)()],t.prototype,"angularSensibilityX",void 0),Object(p.c)([Object(B.c)()],t.prototype,"angularSensibilityY",void 0),Object(p.c)([Object(B.c)()],t.prototype,"pinchPrecision",void 0),Object(p.c)([Object(B.c)()],t.prototype,"pinchDeltaPercentage",void 0),Object(p.c)([Object(B.c)()],t.prototype,"useNaturalPinchZoom",void 0),Object(p.c)([Object(B.c)()],t.prototype,"panningSensibility",void 0),Object(p.c)([Object(B.c)()],t.prototype,"multiTouchPanning",void 0),Object(p.c)([Object(B.c)()],t.prototype,"multiTouchPanAndZoom",void 0),t}(Qu);Kn.ArcRotateCameraPointersInput=kc;var ls=function(i){function t(e){return i.call(this,e)||this}return Object(p.d)(t,i),t.prototype.addMouseWheel=function(){return this.add(new Vc),this},t.prototype.addPointers=function(){return this.add(new kc),this},t.prototype.addKeyboard=function(){return this.add(new Uc),this},t}(Aa);ls.prototype.addVRDeviceOrientation=function(){return this.add(new jc),this};var jc=function(){function i(){this.alphaCorrection=1,this.gammaCorrection=1,this._alpha=0,this._gamma=0,this._dirty=!1,this._deviceOrientationHandler=this._onOrientationEvent.bind(this)}return i.prototype.attachControl=function(t){var e=this;t=et.b.BackCompatCameraNoPreventDefault(arguments),this.camera.attachControl(t);var n=this.camera.getScene().getEngine().getHostWindow();n&&(typeof DeviceOrientationEvent!="undefined"&&typeof DeviceOrientationEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(function(r){r==="granted"?n.addEventListener("deviceorientation",e._deviceOrientationHandler):et.b.Warn("Permission not granted.")}).catch(function(r){et.b.Error(r)}):n.addEventListener("deviceorientation",this._deviceOrientationHandler))},i.prototype._onOrientationEvent=function(t){t.alpha!==null&&(this._alpha=(0|+t.alpha)*this.alphaCorrection),t.gamma!==null&&(this._gamma=(0|+t.gamma)*this.gammaCorrection),this._dirty=!0},i.prototype.checkInputs=function(){this._dirty&&(this._dirty=!1,this._gamma<0&&(this._gamma=180+this._gamma),this.camera.alpha=-this._alpha/180*Math.PI%Math.PI*2,this.camera.beta=this._gamma/180*Math.PI)},i.prototype.detachControl=function(t){window.removeEventListener("deviceorientation",this._deviceOrientationHandler)},i.prototype.getClassName=function(){return"ArcRotateCameraVRDeviceOrientationInput"},i.prototype.getSimpleName=function(){return"VRDeviceOrientation"},i}();Kn.ArcRotateCameraVRDeviceOrientationInput=jc;var zc=function(){function i(){this.keysForward=[87],this.keysBackward=[83],this.keysUp=[69],this.keysDown=[81],this.keysRight=[68],this.keysLeft=[65],this._keys=new Array}return i.prototype.attachControl=function(t){var e=this;t=et.b.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add(function(){e._keys=[]}),this._onKeyboardObserver=this._scene.onKeyboardObservable.add(function(n){var r,o=n.event;n.type===no.a.KEYDOWN?e.keysForward.indexOf(o.keyCode)===-1&&e.keysBackward.indexOf(o.keyCode)===-1&&e.keysUp.indexOf(o.keyCode)===-1&&e.keysDown.indexOf(o.keyCode)===-1&&e.keysLeft.indexOf(o.keyCode)===-1&&e.keysRight.indexOf(o.keyCode)===-1||((r=e._keys.indexOf(o.keyCode))===-1&&e._keys.push(o.keyCode),t||o.preventDefault()):e.keysForward.indexOf(o.keyCode)===-1&&e.keysBackward.indexOf(o.keyCode)===-1&&e.keysUp.indexOf(o.keyCode)===-1&&e.keysDown.indexOf(o.keyCode)===-1&&e.keysLeft.indexOf(o.keyCode)===-1&&e.keysRight.indexOf(o.keyCode)===-1||((r=e._keys.indexOf(o.keyCode))>=0&&e._keys.splice(r,1),t||o.preventDefault())}))},i.prototype.detachControl=function(t){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys=[]},i.prototype.getClassName=function(){return"FlyCameraKeyboardInput"},i.prototype._onLostFocus=function(t){this._keys=[]},i.prototype.getSimpleName=function(){return"keyboard"},i.prototype.checkInputs=function(){if(this._onKeyboardObserver)for(var t=this.camera,e=0;e<this._keys.length;e++){var n=this._keys[e],r=t._computeLocalCameraSpeed();this.keysForward.indexOf(n)!==-1?t._localDirection.copyFromFloats(0,0,r):this.keysBackward.indexOf(n)!==-1?t._localDirection.copyFromFloats(0,0,-r):this.keysUp.indexOf(n)!==-1?t._localDirection.copyFromFloats(0,r,0):this.keysDown.indexOf(n)!==-1?t._localDirection.copyFromFloats(0,-r,0):this.keysRight.indexOf(n)!==-1?t._localDirection.copyFromFloats(r,0,0):this.keysLeft.indexOf(n)!==-1&&t._localDirection.copyFromFloats(-r,0,0),t.getScene().useRightHandedSystem&&(t._localDirection.z*=-1),t.getViewMatrix().invertToRef(t._cameraTransformMatrix),d.e.TransformNormalToRef(t._localDirection,t._cameraTransformMatrix,t._transformedDirection),t.cameraDirection.addInPlace(t._transformedDirection)}},Object(p.c)([Object(B.c)()],i.prototype,"keysForward",void 0),Object(p.c)([Object(B.c)()],i.prototype,"keysBackward",void 0),Object(p.c)([Object(B.c)()],i.prototype,"keysUp",void 0),Object(p.c)([Object(B.c)()],i.prototype,"keysDown",void 0),Object(p.c)([Object(B.c)()],i.prototype,"keysRight",void 0),Object(p.c)([Object(B.c)()],i.prototype,"keysLeft",void 0),i}();Kn.FlyCameraKeyboardInput=zc;var Bo=function(){function i(t){this.buttons=[0,1,2],this.buttonsYaw=[-1,0,1],this.buttonsPitch=[-1,0,1],this.buttonsRoll=[2],this.activeButton=-1,this.angularSensibility=1e3,this.previousPosition=null}return i.prototype.attachControl=function(t){var e=this;t=et.b.BackCompatCameraNoPreventDefault(arguments),this.noPreventDefault=t,this._observer=this.camera.getScene().onPointerObservable.add(function(n,r){e._pointerInput(n,r)},Ot.a.POINTERDOWN|Ot.a.POINTERUP|Ot.a.POINTERMOVE),this._rollObserver=this.camera.getScene().onBeforeRenderObservable.add(function(){e.camera.rollCorrect&&e.camera.restoreRoll(e.camera.rollCorrect)})},i.prototype.detachControl=function(t){this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),this.camera.getScene().onBeforeRenderObservable.remove(this._rollObserver),this._observer=null,this._rollObserver=null,this.previousPosition=null,this.noPreventDefault=void 0)},i.prototype.getClassName=function(){return"FlyCameraMouseInput"},i.prototype.getSimpleName=function(){return"mouse"},i.prototype._pointerInput=function(t,e){var n=t.event,r=this.camera.getEngine();if(!r.isInVRExclusivePointerMode&&(this.touchEnabled||n.pointerType!=="touch")&&(t.type===Ot.a.POINTERMOVE||this.buttons.indexOf(n.button)!==-1)){var o=n.srcElement||n.target;if(t.type===Ot.a.POINTERDOWN&&o){try{o.setPointerCapture(n.pointerId)}catch(v){}this.previousPosition={x:n.clientX,y:n.clientY},this.activeButton=n.button,this.noPreventDefault||(n.preventDefault(),this.element.focus()),r.isPointerLock&&this._onMouseMove(t.event)}else if(t.type===Ot.a.POINTERUP&&o){try{o.releasePointerCapture(n.pointerId)}catch(v){}this.activeButton=-1,this.previousPosition=null,this.noPreventDefault||n.preventDefault()}else if(t.type===Ot.a.POINTERMOVE){if(!this.previousPosition)return void(r.isPointerLock&&this._onMouseMove(t.event));var u=n.clientX-this.previousPosition.x,f=n.clientY-this.previousPosition.y;this.rotateCamera(u,f),this.previousPosition={x:n.clientX,y:n.clientY},this.noPreventDefault||n.preventDefault()}}},i.prototype._onMouseMove=function(t){var e=this.camera.getEngine();if(e.isPointerLock&&!e.isInVRExclusivePointerMode){var n=t.movementX||t.mozMovementX||t.webkitMovementX||t.msMovementX||0,r=t.movementY||t.mozMovementY||t.webkitMovementY||t.msMovementY||0;this.rotateCamera(n,r),this.previousPosition=null,this.noPreventDefault||t.preventDefault()}},i.prototype.rotateCamera=function(t,e){var n=this,r=this.camera;this.camera.getScene().useRightHandedSystem&&(t*=-1),r.parent&&r.parent._getWorldMatrixDeterminant()<0&&(t*=-1);var o,u=t/this.angularSensibility,f=e/this.angularSensibility,v=d.b.RotationYawPitchRoll(r.rotation.y,r.rotation.x,r.rotation.z);if(this.buttonsPitch.some(function(w){return w===n.activeButton})&&(o=d.b.RotationAxis(Se.a.X,f),v.multiplyInPlace(o)),this.buttonsYaw.some(function(w){return w===n.activeButton})){o=d.b.RotationAxis(Se.a.Y,u),v.multiplyInPlace(o);var y=r.bankedTurnLimit+r._trackRoll;if(r.bankedTurn&&-y<r.rotation.z&&r.rotation.z<y){var D=r.bankedTurnMultiplier*-u;o=d.b.RotationAxis(Se.a.Z,D),v.multiplyInPlace(o)}}this.buttonsRoll.some(function(w){return w===n.activeButton})&&(o=d.b.RotationAxis(Se.a.Z,-u),r._trackRoll-=u,v.multiplyInPlace(o)),v.toEulerAnglesToRef(r.rotation)},Object(p.c)([Object(B.c)()],i.prototype,"buttons",void 0),Object(p.c)([Object(B.c)()],i.prototype,"angularSensibility",void 0),i}();Kn.FlyCameraMouseInput=Bo;var Pa=function(){function i(){this.keysHeightOffsetIncr=[38],this.keysHeightOffsetDecr=[40],this.keysHeightOffsetModifierAlt=!1,this.keysHeightOffsetModifierCtrl=!1,this.keysHeightOffsetModifierShift=!1,this.keysRotationOffsetIncr=[37],this.keysRotationOffsetDecr=[39],this.keysRotationOffsetModifierAlt=!1,this.keysRotationOffsetModifierCtrl=!1,this.keysRotationOffsetModifierShift=!1,this.keysRadiusIncr=[40],this.keysRadiusDecr=[38],this.keysRadiusModifierAlt=!0,this.keysRadiusModifierCtrl=!1,this.keysRadiusModifierShift=!1,this.heightSensibility=1,this.rotationSensibility=1,this.radiusSensibility=1,this._keys=new Array}return i.prototype.attachControl=function(t){var e=this;t=et.b.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add(function(){e._keys=[]}),this._onKeyboardObserver=this._scene.onKeyboardObservable.add(function(n){var r,o=n.event;o.metaKey||(n.type===no.a.KEYDOWN?(e._ctrlPressed=o.ctrlKey,e._altPressed=o.altKey,e._shiftPressed=o.shiftKey,(e.keysHeightOffsetIncr.indexOf(o.keyCode)!==-1||e.keysHeightOffsetDecr.indexOf(o.keyCode)!==-1||e.keysRotationOffsetIncr.indexOf(o.keyCode)!==-1||e.keysRotationOffsetDecr.indexOf(o.keyCode)!==-1||e.keysRadiusIncr.indexOf(o.keyCode)!==-1||e.keysRadiusDecr.indexOf(o.keyCode)!==-1)&&((r=e._keys.indexOf(o.keyCode))===-1&&e._keys.push(o.keyCode),o.preventDefault&&(t||o.preventDefault()))):e.keysHeightOffsetIncr.indexOf(o.keyCode)===-1&&e.keysHeightOffsetDecr.indexOf(o.keyCode)===-1&&e.keysRotationOffsetIncr.indexOf(o.keyCode)===-1&&e.keysRotationOffsetDecr.indexOf(o.keyCode)===-1&&e.keysRadiusIncr.indexOf(o.keyCode)===-1&&e.keysRadiusDecr.indexOf(o.keyCode)===-1||((r=e._keys.indexOf(o.keyCode))>=0&&e._keys.splice(r,1),o.preventDefault&&(t||o.preventDefault())))}))},i.prototype.detachControl=function(t){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys=[]},i.prototype.checkInputs=function(){var t=this;this._onKeyboardObserver&&this._keys.forEach(function(e){t.keysHeightOffsetIncr.indexOf(e)!==-1&&t._modifierHeightOffset()?t.camera.heightOffset+=t.heightSensibility:t.keysHeightOffsetDecr.indexOf(e)!==-1&&t._modifierHeightOffset()?t.camera.heightOffset-=t.heightSensibility:t.keysRotationOffsetIncr.indexOf(e)!==-1&&t._modifierRotationOffset()?(t.camera.rotationOffset+=t.rotationSensibility,t.camera.rotationOffset%=360):t.keysRotationOffsetDecr.indexOf(e)!==-1&&t._modifierRotationOffset()?(t.camera.rotationOffset-=t.rotationSensibility,t.camera.rotationOffset%=360):t.keysRadiusIncr.indexOf(e)!==-1&&t._modifierRadius()?t.camera.radius+=t.radiusSensibility:t.keysRadiusDecr.indexOf(e)!==-1&&t._modifierRadius()&&(t.camera.radius-=t.radiusSensibility)})},i.prototype.getClassName=function(){return"FollowCameraKeyboardMoveInput"},i.prototype.getSimpleName=function(){return"keyboard"},i.prototype._modifierHeightOffset=function(){return this.keysHeightOffsetModifierAlt===this._altPressed&&this.keysHeightOffsetModifierCtrl===this._ctrlPressed&&this.keysHeightOffsetModifierShift===this._shiftPressed},i.prototype._modifierRotationOffset=function(){return this.keysRotationOffsetModifierAlt===this._altPressed&&this.keysRotationOffsetModifierCtrl===this._ctrlPressed&&this.keysRotationOffsetModifierShift===this._shiftPressed},i.prototype._modifierRadius=function(){return this.keysRadiusModifierAlt===this._altPressed&&this.keysRadiusModifierCtrl===this._ctrlPressed&&this.keysRadiusModifierShift===this._shiftPressed},Object(p.c)([Object(B.c)()],i.prototype,"keysHeightOffsetIncr",void 0),Object(p.c)([Object(B.c)()],i.prototype,"keysHeightOffsetDecr",void 0),Object(p.c)([Object(B.c)()],i.prototype,"keysHeightOffsetModifierAlt",void 0),Object(p.c)([Object(B.c)()],i.prototype,"keysHeightOffsetModifierCtrl",void 0),Object(p.c)([Object(B.c)()],i.prototype,"keysHeightOffsetModifierShift",void 0),Object(p.c)([Object(B.c)()],i.prototype,"keysRotationOffsetIncr",void 0),Object(p.c)([Object(B.c)()],i.prototype,"keysRotationOffsetDecr",void 0),Object(p.c)([Object(B.c)()],i.prototype,"keysRotationOffsetModifierAlt",void 0),Object(p.c)([Object(B.c)()],i.prototype,"keysRotationOffsetModifierCtrl",void 0),Object(p.c)([Object(B.c)()],i.prototype,"keysRotationOffsetModifierShift",void 0),Object(p.c)([Object(B.c)()],i.prototype,"keysRadiusIncr",void 0),Object(p.c)([Object(B.c)()],i.prototype,"keysRadiusDecr",void 0),Object(p.c)([Object(B.c)()],i.prototype,"keysRadiusModifierAlt",void 0),Object(p.c)([Object(B.c)()],i.prototype,"keysRadiusModifierCtrl",void 0),Object(p.c)([Object(B.c)()],i.prototype,"keysRadiusModifierShift",void 0),Object(p.c)([Object(B.c)()],i.prototype,"heightSensibility",void 0),Object(p.c)([Object(B.c)()],i.prototype,"rotationSensibility",void 0),Object(p.c)([Object(B.c)()],i.prototype,"radiusSensibility",void 0),i}();Kn.FollowCameraKeyboardMoveInput=Pa;var Gc=function(){function i(){this.axisControlRadius=!0,this.axisControlHeight=!1,this.axisControlRotation=!1,this.wheelPrecision=3,this.wheelDeltaPercentage=0}return i.prototype.attachControl=function(t){var e=this;t=et.b.BackCompatCameraNoPreventDefault(arguments),this._wheel=function(n,r){if(n.type===Ot.a.POINTERWHEEL){var o=n.event,u=0,f=Math.max(-1,Math.min(1,o.deltaY||o.wheelDelta||-o.detail));e.wheelDeltaPercentage?(console.assert(e.axisControlRadius+e.axisControlHeight+e.axisControlRotation<=1,"wheelDeltaPercentage only usable when mouse wheel controlls ONE axis. Currently enabled: axisControlRadius: "+e.axisControlRadius+", axisControlHeightOffset: "+e.axisControlHeight+", axisControlRotationOffset: "+e.axisControlRotation),e.axisControlRadius?u=.01*f*e.wheelDeltaPercentage*e.camera.radius:e.axisControlHeight?u=.01*f*e.wheelDeltaPercentage*e.camera.heightOffset:e.axisControlRotation&&(u=.01*f*e.wheelDeltaPercentage*e.camera.rotationOffset)):u=f*e.wheelPrecision,u&&(e.axisControlRadius?e.camera.radius+=u:e.axisControlHeight?e.camera.heightOffset-=u:e.axisControlRotation&&(e.camera.rotationOffset-=u)),o.preventDefault&&(t||o.preventDefault())}},this._observer=this.camera.getScene().onPointerObservable.add(this._wheel,Ot.a.POINTERWHEEL)},i.prototype.detachControl=function(t){this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this._wheel=null)},i.prototype.getClassName=function(){return"ArcRotateCameraMouseWheelInput"},i.prototype.getSimpleName=function(){return"mousewheel"},Object(p.c)([Object(B.c)()],i.prototype,"axisControlRadius",void 0),Object(p.c)([Object(B.c)()],i.prototype,"axisControlHeight",void 0),Object(p.c)([Object(B.c)()],i.prototype,"axisControlRotation",void 0),Object(p.c)([Object(B.c)()],i.prototype,"wheelPrecision",void 0),Object(p.c)([Object(B.c)()],i.prototype,"wheelDeltaPercentage",void 0),i}();Kn.FollowCameraMouseWheelInput=Gc;var Hc=function(i){function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.angularSensibilityX=1,e.angularSensibilityY=1,e.pinchPrecision=1e4,e.pinchDeltaPercentage=0,e.axisXControlRadius=!1,e.axisXControlHeight=!1,e.axisXControlRotation=!0,e.axisYControlRadius=!1,e.axisYControlHeight=!0,e.axisYControlRotation=!1,e.axisPinchControlRadius=!0,e.axisPinchControlHeight=!1,e.axisPinchControlRotation=!1,e.warningEnable=!0,e._warningCounter=0,e}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"FollowCameraPointersInput"},t.prototype.onTouch=function(e,n,r){this._warning(),this.axisXControlRotation?this.camera.rotationOffset+=n/this.angularSensibilityX:this.axisYControlRotation&&(this.camera.rotationOffset+=r/this.angularSensibilityX),this.axisXControlHeight?this.camera.heightOffset+=n/this.angularSensibilityY:this.axisYControlHeight&&(this.camera.heightOffset+=r/this.angularSensibilityY),this.axisXControlRadius?this.camera.radius-=n/this.angularSensibilityY:this.axisYControlRadius&&(this.camera.radius-=r/this.angularSensibilityY)},t.prototype.onMultiTouch=function(e,n,r,o,u,f){if(!(r===0&&u===null||o===0&&f===null)){var v=(o-r)/(this.pinchPrecision*(this.angularSensibilityX+this.angularSensibilityY)/2);this.pinchDeltaPercentage?(v*=.01*this.pinchDeltaPercentage,this.axisPinchControlRotation&&(this.camera.rotationOffset+=v*this.camera.rotationOffset),this.axisPinchControlHeight&&(this.camera.heightOffset+=v*this.camera.heightOffset),this.axisPinchControlRadius&&(this.camera.radius-=v*this.camera.radius)):(this.axisPinchControlRotation&&(this.camera.rotationOffset+=v),this.axisPinchControlHeight&&(this.camera.heightOffset+=v),this.axisPinchControlRadius&&(this.camera.radius-=v))}},t.prototype._warning=function(){if(this.warningEnable&&this._warningCounter++%100==0){var e="It probably only makes sense to control ONE camera property with each pointer axis. Set 'warningEnable = false' if you are sure. Currently enabled: ";console.assert(this.axisXControlRotation+this.axisXControlHeight+this.axisXControlRadius<=1,e+"axisXControlRotation: "+this.axisXControlRotation+", axisXControlHeight: "+this.axisXControlHeight+", axisXControlRadius: "+this.axisXControlRadius),console.assert(this.axisYControlRotation+this.axisYControlHeight+this.axisYControlRadius<=1,e+"axisYControlRotation: "+this.axisYControlRotation+", axisYControlHeight: "+this.axisYControlHeight+", axisYControlRadius: "+this.axisYControlRadius),console.assert(this.axisPinchControlRotation+this.axisPinchControlHeight+this.axisPinchControlRadius<=1,e+"axisPinchControlRotation: "+this.axisPinchControlRotation+", axisPinchControlHeight: "+this.axisPinchControlHeight+", axisPinchControlRadius: "+this.axisPinchControlRadius)}},Object(p.c)([Object(B.c)()],t.prototype,"angularSensibilityX",void 0),Object(p.c)([Object(B.c)()],t.prototype,"angularSensibilityY",void 0),Object(p.c)([Object(B.c)()],t.prototype,"pinchPrecision",void 0),Object(p.c)([Object(B.c)()],t.prototype,"pinchDeltaPercentage",void 0),Object(p.c)([Object(B.c)()],t.prototype,"axisXControlRadius",void 0),Object(p.c)([Object(B.c)()],t.prototype,"axisXControlHeight",void 0),Object(p.c)([Object(B.c)()],t.prototype,"axisXControlRotation",void 0),Object(p.c)([Object(B.c)()],t.prototype,"axisYControlRadius",void 0),Object(p.c)([Object(B.c)()],t.prototype,"axisYControlHeight",void 0),Object(p.c)([Object(B.c)()],t.prototype,"axisYControlRotation",void 0),Object(p.c)([Object(B.c)()],t.prototype,"axisPinchControlRadius",void 0),Object(p.c)([Object(B.c)()],t.prototype,"axisPinchControlHeight",void 0),Object(p.c)([Object(B.c)()],t.prototype,"axisPinchControlRotation",void 0),t}(Qu);Kn.FollowCameraPointersInput=Hc;var us=function(){function i(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this._keys=new Array}return i.prototype.attachControl=function(t){var e=this;t=et.b.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add(function(){e._keys=[]}),this._onKeyboardObserver=this._scene.onKeyboardObservable.add(function(n){var r,o=n.event;o.metaKey||(n.type===no.a.KEYDOWN?e.keysUp.indexOf(o.keyCode)===-1&&e.keysDown.indexOf(o.keyCode)===-1&&e.keysLeft.indexOf(o.keyCode)===-1&&e.keysRight.indexOf(o.keyCode)===-1&&e.keysUpward.indexOf(o.keyCode)===-1&&e.keysDownward.indexOf(o.keyCode)===-1||((r=e._keys.indexOf(o.keyCode))===-1&&e._keys.push(o.keyCode),t||o.preventDefault()):e.keysUp.indexOf(o.keyCode)===-1&&e.keysDown.indexOf(o.keyCode)===-1&&e.keysLeft.indexOf(o.keyCode)===-1&&e.keysRight.indexOf(o.keyCode)===-1&&e.keysUpward.indexOf(o.keyCode)===-1&&e.keysDownward.indexOf(o.keyCode)===-1||((r=e._keys.indexOf(o.keyCode))>=0&&e._keys.splice(r,1),t||o.preventDefault()))}))},i.prototype.detachControl=function(t){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys=[]},i.prototype.checkInputs=function(){if(this._onKeyboardObserver)for(var t=this.camera,e=0;e<this._keys.length;e++){var n=this._keys[e],r=t._computeLocalCameraSpeed();this.keysLeft.indexOf(n)!==-1?t._localDirection.copyFromFloats(-r,0,0):this.keysUp.indexOf(n)!==-1?t._localDirection.copyFromFloats(0,0,r):this.keysRight.indexOf(n)!==-1?t._localDirection.copyFromFloats(r,0,0):this.keysDown.indexOf(n)!==-1?t._localDirection.copyFromFloats(0,0,-r):this.keysUpward.indexOf(n)!==-1?t._localDirection.copyFromFloats(0,r,0):this.keysDownward.indexOf(n)!==-1&&t._localDirection.copyFromFloats(0,-r,0),t.getScene().useRightHandedSystem&&(t._localDirection.z*=-1),t.getViewMatrix().invertToRef(t._cameraTransformMatrix),d.e.TransformNormalToRef(t._localDirection,t._cameraTransformMatrix,t._transformedDirection),t.cameraDirection.addInPlace(t._transformedDirection)}},i.prototype.getClassName=function(){return"FreeCameraKeyboardMoveInput"},i.prototype._onLostFocus=function(){this._keys=[]},i.prototype.getSimpleName=function(){return"keyboard"},Object(p.c)([Object(B.c)()],i.prototype,"keysUp",void 0),Object(p.c)([Object(B.c)()],i.prototype,"keysUpward",void 0),Object(p.c)([Object(B.c)()],i.prototype,"keysDown",void 0),Object(p.c)([Object(B.c)()],i.prototype,"keysDownward",void 0),Object(p.c)([Object(B.c)()],i.prototype,"keysLeft",void 0),Object(p.c)([Object(B.c)()],i.prototype,"keysRight",void 0),i}();Kn.FreeCameraKeyboardMoveInput=us;var Wc=function(){function i(t){t===void 0&&(t=!0),this.touchEnabled=t,this.buttons=[0,1,2],this.angularSensibility=2e3,this.previousPosition=null,this.onPointerMovedObservable=new S.c,this._allowCameraRotation=!0}return i.prototype.attachControl=function(t){var e=this;t=et.b.BackCompatCameraNoPreventDefault(arguments);var n=this.camera.getEngine(),r=n.getInputElement();this._pointerInput||(this._pointerInput=function(o){var u=o.event;if(!n.isInVRExclusivePointerMode&&(e.touchEnabled||u.pointerType!=="touch")&&(o.type===Ot.a.POINTERMOVE||e.buttons.indexOf(u.button)!==-1)){var f=u.srcElement||u.target;if(o.type===Ot.a.POINTERDOWN&&f){try{f.setPointerCapture(u.pointerId)}catch(D){}e.previousPosition={x:u.clientX,y:u.clientY},t||(u.preventDefault(),r&&r.focus()),n.isPointerLock&&e._onMouseMove&&e._onMouseMove(o.event)}else if(o.type===Ot.a.POINTERUP&&f){try{f.releasePointerCapture(u.pointerId)}catch(D){}e.previousPosition=null,t||u.preventDefault()}else if(o.type===Ot.a.POINTERMOVE){if(!e.previousPosition)return void(n.isPointerLock&&e._onMouseMove&&e._onMouseMove(o.event));var v=u.clientX-e.previousPosition.x,y=u.clientY-e.previousPosition.y;e.camera.getScene().useRightHandedSystem&&(v*=-1),e.camera.parent&&e.camera.parent._getWorldMatrixDeterminant()<0&&(v*=-1),e._allowCameraRotation&&(e.camera.cameraRotation.y+=v/e.angularSensibility,e.camera.cameraRotation.x+=y/e.angularSensibility),e.onPointerMovedObservable.notifyObservers({offsetX:v,offsetY:y}),e.previousPosition={x:u.clientX,y:u.clientY},t||u.preventDefault()}}}),this._onMouseMove=function(o){if(n.isPointerLock&&!n.isInVRExclusivePointerMode){var u=o.movementX||o.mozMovementX||o.webkitMovementX||o.msMovementX||0;e.camera.getScene().useRightHandedSystem&&(u*=-1),e.camera.parent&&e.camera.parent._getWorldMatrixDeterminant()<0&&(u*=-1),e.camera.cameraRotation.y+=u/e.angularSensibility;var f=o.movementY||o.mozMovementY||o.webkitMovementY||o.msMovementY||0;e.camera.cameraRotation.x+=f/e.angularSensibility,e.previousPosition=null,t||o.preventDefault()}},this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,Ot.a.POINTERDOWN|Ot.a.POINTERUP|Ot.a.POINTERMOVE),r&&r.addEventListener("contextmenu",this.onContextMenu.bind(this),!1)},i.prototype.onContextMenu=function(t){t.preventDefault()},i.prototype.detachControl=function(t){if(this._observer){if(this.camera.getScene().onPointerObservable.remove(this._observer),this.onContextMenu){var e=this.camera.getEngine().getInputElement();e&&e.removeEventListener("contextmenu",this.onContextMenu)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this.previousPosition=null}},i.prototype.getClassName=function(){return"FreeCameraMouseInput"},i.prototype.getSimpleName=function(){return"mouse"},Object(p.c)([Object(B.c)()],i.prototype,"buttons",void 0),Object(p.c)([Object(B.c)()],i.prototype,"angularSensibility",void 0),i}();Kn.FreeCameraMouseInput=Wc;var rn,Cp=function(){function i(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new S.c,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}return i.prototype.attachControl=function(t){var e=this;t=et.b.BackCompatCameraNoPreventDefault(arguments),this._wheel=function(n){if(n.type===Ot.a.POINTERWHEEL){var r=n.event,o=r.deltaMode===WheelEvent.DOM_DELTA_LINE?e._ffMultiplier:1;r.deltaY!==void 0?(e._wheelDeltaX+=e.wheelPrecisionX*o*r.deltaX/e._normalize,e._wheelDeltaY-=e.wheelPrecisionY*o*r.deltaY/e._normalize,e._wheelDeltaZ+=e.wheelPrecisionZ*o*r.deltaZ/e._normalize):r.wheelDeltaY!==void 0?(e._wheelDeltaX+=e.wheelPrecisionX*o*r.wheelDeltaX/e._normalize,e._wheelDeltaY-=e.wheelPrecisionY*o*r.wheelDeltaY/e._normalize,e._wheelDeltaZ+=e.wheelPrecisionZ*o*r.wheelDeltaZ/e._normalize):r.wheelDelta&&(e._wheelDeltaY-=e.wheelPrecisionY*r.wheelDelta/e._normalize),r.preventDefault&&(t||r.preventDefault())}},this._observer=this.camera.getScene().onPointerObservable.add(this._wheel,Ot.a.POINTERWHEEL)},i.prototype.detachControl=function(t){this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()},i.prototype.checkInputs=function(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0},i.prototype.getClassName=function(){return"BaseCameraMouseWheelInput"},i.prototype.getSimpleName=function(){return"mousewheel"},Object(p.c)([Object(B.c)()],i.prototype,"wheelPrecisionX",void 0),Object(p.c)([Object(B.c)()],i.prototype,"wheelPrecisionY",void 0),Object(p.c)([Object(B.c)()],i.prototype,"wheelPrecisionZ",void 0),i}();(function(i){i[i.MoveRelative=0]="MoveRelative",i[i.RotateRelative=1]="RotateRelative",i[i.MoveScene=2]="MoveScene"})(rn||(rn={}));var hs=function(i){function t(){var e=i!==null&&i.apply(this,arguments)||this;return e._moveRelative=d.e.Zero(),e._rotateRelative=d.e.Zero(),e._moveScene=d.e.Zero(),e._wheelXAction=rn.MoveRelative,e._wheelXActionCoordinate=Se.b.X,e._wheelYAction=rn.MoveRelative,e._wheelYActionCoordinate=Se.b.Z,e._wheelZAction=null,e._wheelZActionCoordinate=null,e}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"FreeCameraMouseWheelInput"},Object.defineProperty(t.prototype,"wheelXMoveRelative",{get:function(){return this._wheelXAction!==rn.MoveRelative?null:this._wheelXActionCoordinate},set:function(e){e===null&&this._wheelXAction!==rn.MoveRelative||(this._wheelXAction=rn.MoveRelative,this._wheelXActionCoordinate=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wheelYMoveRelative",{get:function(){return this._wheelYAction!==rn.MoveRelative?null:this._wheelYActionCoordinate},set:function(e){e===null&&this._wheelYAction!==rn.MoveRelative||(this._wheelYAction=rn.MoveRelative,this._wheelYActionCoordinate=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wheelZMoveRelative",{get:function(){return this._wheelZAction!==rn.MoveRelative?null:this._wheelZActionCoordinate},set:function(e){e===null&&this._wheelZAction!==rn.MoveRelative||(this._wheelZAction=rn.MoveRelative,this._wheelZActionCoordinate=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wheelXRotateRelative",{get:function(){return this._wheelXAction!==rn.RotateRelative?null:this._wheelXActionCoordinate},set:function(e){e===null&&this._wheelXAction!==rn.RotateRelative||(this._wheelXAction=rn.RotateRelative,this._wheelXActionCoordinate=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wheelYRotateRelative",{get:function(){return this._wheelYAction!==rn.RotateRelative?null:this._wheelYActionCoordinate},set:function(e){e===null&&this._wheelYAction!==rn.RotateRelative||(this._wheelYAction=rn.RotateRelative,this._wheelYActionCoordinate=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wheelZRotateRelative",{get:function(){return this._wheelZAction!==rn.RotateRelative?null:this._wheelZActionCoordinate},set:function(e){e===null&&this._wheelZAction!==rn.RotateRelative||(this._wheelZAction=rn.RotateRelative,this._wheelZActionCoordinate=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wheelXMoveScene",{get:function(){return this._wheelXAction!==rn.MoveScene?null:this._wheelXActionCoordinate},set:function(e){e===null&&this._wheelXAction!==rn.MoveScene||(this._wheelXAction=rn.MoveScene,this._wheelXActionCoordinate=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wheelYMoveScene",{get:function(){return this._wheelYAction!==rn.MoveScene?null:this._wheelYActionCoordinate},set:function(e){e===null&&this._wheelYAction!==rn.MoveScene||(this._wheelYAction=rn.MoveScene,this._wheelYActionCoordinate=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wheelZMoveScene",{get:function(){return this._wheelZAction!==rn.MoveScene?null:this._wheelZActionCoordinate},set:function(e){e===null&&this._wheelZAction!==rn.MoveScene||(this._wheelZAction=rn.MoveScene,this._wheelZActionCoordinate=e)},enumerable:!1,configurable:!0}),t.prototype.checkInputs=function(){if(this._wheelDeltaX!==0||this._wheelDeltaY!==0||this._wheelDeltaZ!=0){this._moveRelative.setAll(0),this._rotateRelative.setAll(0),this._moveScene.setAll(0),this._updateCamera(),this.camera.getScene().useRightHandedSystem&&(this._moveRelative.z*=-1);var e=d.a.Zero();this.camera.getViewMatrix().invertToRef(e);var n=d.e.Zero();d.e.TransformNormalToRef(this._moveRelative,e,n),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(n),this.camera.cameraDirection.addInPlace(this._moveScene),i.prototype.checkInputs.call(this)}},t.prototype._updateCamera=function(){var e=this._moveRelative,n=this._rotateRelative,r=this._moveScene,o=function(u,f,v){if(u!==0&&f!==null&&v!==null){var y=null;switch(f){case rn.MoveRelative:y=e;break;case rn.RotateRelative:y=n;break;case rn.MoveScene:y=r}switch(v){case Se.b.X:y.set(u,0,0);break;case Se.b.Y:y.set(0,u,0);break;case Se.b.Z:y.set(0,0,u)}}};o(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),o(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),o(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)},Object(p.c)([Object(B.c)()],t.prototype,"wheelXMoveRelative",null),Object(p.c)([Object(B.c)()],t.prototype,"wheelYMoveRelative",null),Object(p.c)([Object(B.c)()],t.prototype,"wheelZMoveRelative",null),Object(p.c)([Object(B.c)()],t.prototype,"wheelXRotateRelative",null),Object(p.c)([Object(B.c)()],t.prototype,"wheelYRotateRelative",null),Object(p.c)([Object(B.c)()],t.prototype,"wheelZRotateRelative",null),Object(p.c)([Object(B.c)()],t.prototype,"wheelXMoveScene",null),Object(p.c)([Object(B.c)()],t.prototype,"wheelYMoveScene",null),Object(p.c)([Object(B.c)()],t.prototype,"wheelZMoveScene",null),t}(Cp);Kn.FreeCameraMouseWheelInput=hs;var Xc=function(){function i(t){t===void 0&&(t=!1),this.allowMouse=t,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array}return i.prototype.attachControl=function(t){var e=this;t=et.b.BackCompatCameraNoPreventDefault(arguments);var n=null;if(this._pointerInput===void 0&&(this._onLostFocus=function(){e._offsetX=null,e._offsetY=null},this._pointerInput=function(u){var f=u.event,v=!e.camera.getEngine().hostInformation.isMobile&&f instanceof MouseEvent;if(e.allowMouse||f.pointerType!=="mouse"&&!v){if(u.type===Ot.a.POINTERDOWN){if(t||f.preventDefault(),e._pointerPressed.push(f.pointerId),e._pointerPressed.length!==1)return;n={x:f.clientX,y:f.clientY}}else if(u.type===Ot.a.POINTERUP){if(t||f.preventDefault(),(y=e._pointerPressed.indexOf(f.pointerId))===-1||(e._pointerPressed.splice(y,1),y!=0))return;n=null,e._offsetX=null,e._offsetY=null}else if(u.type===Ot.a.POINTERMOVE){if(t||f.preventDefault(),!n)return;var y;if((y=e._pointerPressed.indexOf(f.pointerId))!=0)return;e._offsetX=f.clientX-n.x,e._offsetY=-(f.clientY-n.y)}}}),this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,Ot.a.POINTERDOWN|Ot.a.POINTERUP|Ot.a.POINTERMOVE),this._onLostFocus){var r=this.camera.getEngine(),o=r.getInputElement();o&&o.addEventListener("blur",this._onLostFocus)}},i.prototype.detachControl=function(t){if(this._pointerInput){if(this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null),this._onLostFocus){var e=this.camera.getEngine().getInputElement();e&&e.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed=[],this._offsetX=null,this._offsetY=null}},i.prototype.checkInputs=function(){if(this._offsetX!==null&&this._offsetY!==null&&(this._offsetX!==0||this._offsetY!==0)){var t=this.camera;if(t.cameraRotation.y=this._offsetX/this.touchAngularSensibility,this._pointerPressed.length>1)t.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{var e=t._computeLocalCameraSpeed(),n=new d.e(0,0,e*this._offsetY/this.touchMoveSensibility);d.a.RotationYawPitchRollToRef(t.rotation.y,t.rotation.x,0,t._cameraRotationMatrix),t.cameraDirection.addInPlace(d.e.TransformCoordinates(n,t._cameraRotationMatrix))}}},i.prototype.getClassName=function(){return"FreeCameraTouchInput"},i.prototype.getSimpleName=function(){return"touch"},Object(p.c)([Object(B.c)()],i.prototype,"touchAngularSensibility",void 0),Object(p.c)([Object(B.c)()],i.prototype,"touchMoveSensibility",void 0),i}();Kn.FreeCameraTouchInput=Xc;var Ca=function(i){function t(e){var n=i.call(this,e)||this;return n._mouseInput=null,n._mouseWheelInput=null,n}return Object(p.d)(t,i),t.prototype.addKeyboard=function(){return this.add(new us),this},t.prototype.addMouse=function(e){return e===void 0&&(e=!0),this._mouseInput||(this._mouseInput=new Wc(e),this.add(this._mouseInput)),this},t.prototype.removeMouse=function(){return this._mouseInput&&this.remove(this._mouseInput),this},t.prototype.addMouseWheel=function(){return this._mouseWheelInput||(this._mouseWheelInput=new hs,this.add(this._mouseWheelInput)),this},t.prototype.removeMouseWheel=function(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this},t.prototype.addTouch=function(){return this.add(new Xc),this},t.prototype.clear=function(){i.prototype.clear.call(this),this._mouseInput=null},t}(Aa);Ca.prototype.addDeviceOrientation=function(){return this._deviceOrientationInput||(this._deviceOrientationInput=new Yc,this.add(this._deviceOrientationInput)),this};var Yc=function(){function i(){var t=this;this._screenOrientationAngle=0,this._screenQuaternion=new d.b,this._alpha=0,this._beta=0,this._gamma=0,this._onDeviceOrientationChangedObservable=new S.c,this._orientationChanged=function(){t._screenOrientationAngle=window.orientation!==void 0?+window.orientation:window.screen.orientation&&window.screen.orientation.angle?window.screen.orientation.angle:0,t._screenOrientationAngle=-et.b.ToRadians(t._screenOrientationAngle/2),t._screenQuaternion.copyFromFloats(0,Math.sin(t._screenOrientationAngle),0,Math.cos(t._screenOrientationAngle))},this._deviceOrientation=function(e){t._alpha=e.alpha!==null?e.alpha:0,t._beta=e.beta!==null?e.beta:0,t._gamma=e.gamma!==null?e.gamma:0,e.alpha!==null&&t._onDeviceOrientationChangedObservable.notifyObservers()},this._constantTranform=new d.b(-Math.sqrt(.5),0,0,Math.sqrt(.5)),this._orientationChanged()}return i.WaitForOrientationChangeAsync=function(t){return new Promise(function(e,n){var r=!1,o=function(){window.removeEventListener("deviceorientation",o),r=!0,e()};t&&setTimeout(function(){r||(window.removeEventListener("deviceorientation",o),n("WaitForOrientationChangeAsync timed out"))},t),typeof DeviceOrientationEvent!="undefined"&&typeof DeviceOrientationEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(function(u){u=="granted"?window.addEventListener("deviceorientation",o):et.b.Warn("Permission not granted.")}).catch(function(u){et.b.Error(u)}):window.addEventListener("deviceorientation",o)})},Object.defineProperty(i.prototype,"camera",{get:function(){return this._camera},set:function(t){var e=this;this._camera=t,this._camera==null||this._camera.rotationQuaternion||(this._camera.rotationQuaternion=new d.b),this._camera&&this._camera.onDisposeObservable.add(function(){e._onDeviceOrientationChangedObservable.clear()})},enumerable:!1,configurable:!0}),i.prototype.attachControl=function(){var t=this,e=this.camera.getScene().getEngine().getHostWindow();if(e){var n=function(){e.addEventListener("orientationchange",t._orientationChanged),e.addEventListener("deviceorientation",t._deviceOrientation),t._orientationChanged()};typeof DeviceOrientationEvent!="undefined"&&typeof DeviceOrientationEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(function(r){r==="granted"?n():et.b.Warn("Permission not granted.")}).catch(function(r){et.b.Error(r)}):n()}},i.prototype.detachControl=function(t){window.removeEventListener("orientationchange",this._orientationChanged),window.removeEventListener("deviceorientation",this._deviceOrientation),this._alpha=0},i.prototype.checkInputs=function(){this._alpha&&(d.b.RotationYawPitchRollToRef(et.b.ToRadians(this._alpha),et.b.ToRadians(this._beta),-et.b.ToRadians(this._gamma),this.camera.rotationQuaternion),this._camera.rotationQuaternion.multiplyInPlace(this._screenQuaternion),this._camera.rotationQuaternion.multiplyInPlace(this._constantTranform),this._camera.rotationQuaternion.z*=-1,this._camera.rotationQuaternion.w*=-1)},i.prototype.getClassName=function(){return"FreeCameraDeviceOrientationInput"},i.prototype.getSimpleName=function(){return"deviceOrientation"},i}();Kn.FreeCameraDeviceOrientationInput=Yc;var Ra=function(){function i(){this.gamepadAngularSensibility=200,this.gamepadMoveSensibility=40,this._yAxisScale=1,this._cameraTransform=d.a.Identity(),this._deltaTransform=d.e.Zero(),this._vector3=d.e.Zero(),this._vector2=d.d.Zero()}return Object.defineProperty(i.prototype,"invertYAxis",{get:function(){return this._yAxisScale!==1},set:function(t){this._yAxisScale=t?-1:1},enumerable:!1,configurable:!0}),i.prototype.attachControl=function(){var t=this,e=this.camera.getScene().gamepadManager;this._onGamepadConnectedObserver=e.onGamepadConnectedObservable.add(function(n){n.type!==Gn.POSE_ENABLED&&(t.gamepad&&n.type!==Gn.XBOX||(t.gamepad=n))}),this._onGamepadDisconnectedObserver=e.onGamepadDisconnectedObservable.add(function(n){t.gamepad===n&&(t.gamepad=null)}),this.gamepad=e.getGamepadByType(Gn.XBOX),!this.gamepad&&e.gamepads.length&&(this.gamepad=e.gamepads[0])},i.prototype.detachControl=function(t){this.camera.getScene().gamepadManager.onGamepadConnectedObservable.remove(this._onGamepadConnectedObserver),this.camera.getScene().gamepadManager.onGamepadDisconnectedObservable.remove(this._onGamepadDisconnectedObserver),this.gamepad=null},i.prototype.checkInputs=function(){if(this.gamepad&&this.gamepad.leftStick){var t=this.camera,e=this.gamepad.leftStick,n=e.x/this.gamepadMoveSensibility,r=e.y/this.gamepadMoveSensibility;e.x=Math.abs(n)>.005?0+n:0,e.y=Math.abs(r)>.005?0+r:0;var o=this.gamepad.rightStick;if(o){var u=o.x/this.gamepadAngularSensibility,f=o.y/this.gamepadAngularSensibility*this._yAxisScale;o.x=Math.abs(u)>.001?0+u:0,o.y=Math.abs(f)>.001?0+f:0}else o={x:0,y:0};t.rotationQuaternion?t.rotationQuaternion.toRotationMatrix(this._cameraTransform):d.a.RotationYawPitchRollToRef(t.rotation.y,t.rotation.x,0,this._cameraTransform);var v=50*t._computeLocalCameraSpeed();this._vector3.copyFromFloats(e.x*v,0,-e.y*v),d.e.TransformCoordinatesToRef(this._vector3,this._cameraTransform,this._deltaTransform),t.cameraDirection.addInPlace(this._deltaTransform),this._vector2.copyFromFloats(o.y,o.x),t.cameraRotation.addInPlace(this._vector2)}},i.prototype.getClassName=function(){return"FreeCameraGamepadInput"},i.prototype.getSimpleName=function(){return"gamepad"},Object(p.c)([Object(B.c)()],i.prototype,"gamepadAngularSensibility",void 0),Object(p.c)([Object(B.c)()],i.prototype,"gamepadMoveSensibility",void 0),i}();Kn.FreeCameraGamepadInput=Ra;var Nn,qu=c(112);(function(i){i[i.X=0]="X",i[i.Y=1]="Y",i[i.Z=2]="Z"})(Nn||(Nn={}));var Kc=function(){function i(t,e){var n=this,r=Object(p.a)(Object(p.a)({},i._GetDefaultOptions()),e);if(this._leftJoystick=!!t,i._globalJoystickIndex++,this._axisTargetedByLeftAndRight=Nn.X,this._axisTargetedByUpAndDown=Nn.Y,this.reverseLeftRight=!1,this.reverseUpDown=!1,this._touches=new qu.a,this.deltaPosition=d.e.Zero(),this._joystickSensibility=25,this._inversedSensibility=1/(this._joystickSensibility/1e3),this._onResize=function(u){i.vjCanvasWidth=window.innerWidth,i.vjCanvasHeight=window.innerHeight,i.Canvas&&(i.Canvas.width=i.vjCanvasWidth,i.Canvas.height=i.vjCanvasHeight),i.halfWidth=i.vjCanvasWidth/2},!i.Canvas){window.addEventListener("resize",this._onResize,!1),i.Canvas=document.createElement("canvas"),i.vjCanvasWidth=window.innerWidth,i.vjCanvasHeight=window.innerHeight,i.Canvas.width=window.innerWidth,i.Canvas.height=window.innerHeight,i.Canvas.style.width="100%",i.Canvas.style.height="100%",i.Canvas.style.position="absolute",i.Canvas.style.backgroundColor="transparent",i.Canvas.style.top="0px",i.Canvas.style.left="0px",i.Canvas.style.zIndex="5",i.Canvas.style.msTouchAction="none",i.Canvas.style.touchAction="none",i.Canvas.setAttribute("touch-action","none");var o=i.Canvas.getContext("2d");if(!o)throw new Error("Unable to create canvas for virtual joystick");i.vjCanvasContext=o,i.vjCanvasContext.strokeStyle="#ffffff",i.vjCanvasContext.lineWidth=2,document.body.appendChild(i.Canvas)}i.halfWidth=i.Canvas.width/2,this.pressed=!1,this.limitToContainer=r.limitToContainer,this._joystickColor=r.color,this.containerSize=r.containerSize,this.puckSize=r.puckSize,r.position&&this.setPosition(r.position.x,r.position.y),r.puckImage&&this.setPuckImage(r.puckImage),r.containerImage&&this.setContainerImage(r.containerImage),r.alwaysVisible&&i._alwaysVisibleSticks++,this.alwaysVisible=r.alwaysVisible,this._joystickPointerID=-1,this._joystickPointerPos=new d.d(0,0),this._joystickPreviousPointerPos=new d.d(0,0),this._joystickPointerStartPos=new d.d(0,0),this._deltaJoystickVector=new d.d(0,0),this._onPointerDownHandlerRef=function(u){n._onPointerDown(u)},this._onPointerMoveHandlerRef=function(u){n._onPointerMove(u)},this._onPointerUpHandlerRef=function(u){n._onPointerUp(u)},i.Canvas.addEventListener("pointerdown",this._onPointerDownHandlerRef,!1),i.Canvas.addEventListener("pointermove",this._onPointerMoveHandlerRef,!1),i.Canvas.addEventListener("pointerup",this._onPointerUpHandlerRef,!1),i.Canvas.addEventListener("pointerout",this._onPointerUpHandlerRef,!1),i.Canvas.addEventListener("contextmenu",function(u){u.preventDefault()},!1),requestAnimationFrame(function(){n._drawVirtualJoystick()})}return i._GetDefaultOptions=function(){return{puckSize:40,containerSize:60,color:"cyan",puckImage:void 0,containerImage:void 0,position:void 0,alwaysVisible:!1,limitToContainer:!1}},i.prototype.setJoystickSensibility=function(t){this._joystickSensibility=t,this._inversedSensibility=1/(this._joystickSensibility/1e3)},i.prototype._onPointerDown=function(t){t.preventDefault(),(this._leftJoystick===!0?t.clientX<i.halfWidth:t.clientX>i.halfWidth)&&this._joystickPointerID<0?(this._joystickPointerID=t.pointerId,this._joystickPosition?(this._joystickPointerStartPos=this._joystickPosition.clone(),this._joystickPointerPos=this._joystickPosition.clone(),this._joystickPreviousPointerPos=this._joystickPosition.clone(),this._onPointerMove(t)):(this._joystickPointerStartPos.x=t.clientX,this._joystickPointerStartPos.y=t.clientY,this._joystickPointerPos=this._joystickPointerStartPos.clone(),this._joystickPreviousPointerPos=this._joystickPointerStartPos.clone()),this._deltaJoystickVector.x=0,this._deltaJoystickVector.y=0,this.pressed=!0,this._touches.add(t.pointerId.toString(),t)):i._globalJoystickIndex<2&&this._action&&(this._action(),this._touches.add(t.pointerId.toString(),{x:t.clientX,y:t.clientY,prevX:t.clientX,prevY:t.clientY}))},i.prototype._onPointerMove=function(t){if(this._joystickPointerID==t.pointerId){if(this.limitToContainer){var e=new d.d(t.clientX-this._joystickPointerStartPos.x,t.clientY-this._joystickPointerStartPos.y),n=e.length();n>this.containerSize&&e.scaleInPlace(this.containerSize/n),this._joystickPointerPos.x=this._joystickPointerStartPos.x+e.x,this._joystickPointerPos.y=this._joystickPointerStartPos.y+e.y}else this._joystickPointerPos.x=t.clientX,this._joystickPointerPos.y=t.clientY;this._deltaJoystickVector=this._joystickPointerPos.clone(),this._deltaJoystickVector=this._deltaJoystickVector.subtract(this._joystickPointerStartPos),0<i._alwaysVisibleSticks&&(this._leftJoystick?this._joystickPointerPos.x=Math.min(i.halfWidth,this._joystickPointerPos.x):this._joystickPointerPos.x=Math.max(i.halfWidth,this._joystickPointerPos.x));var r=(this.reverseLeftRight?-1:1)*this._deltaJoystickVector.x/this._inversedSensibility;switch(this._axisTargetedByLeftAndRight){case Nn.X:this.deltaPosition.x=Math.min(1,Math.max(-1,r));break;case Nn.Y:this.deltaPosition.y=Math.min(1,Math.max(-1,r));break;case Nn.Z:this.deltaPosition.z=Math.min(1,Math.max(-1,r))}var o=(this.reverseUpDown?1:-1)*this._deltaJoystickVector.y/this._inversedSensibility;switch(this._axisTargetedByUpAndDown){case Nn.X:this.deltaPosition.x=Math.min(1,Math.max(-1,o));break;case Nn.Y:this.deltaPosition.y=Math.min(1,Math.max(-1,o));break;case Nn.Z:this.deltaPosition.z=Math.min(1,Math.max(-1,o))}}else{var u=this._touches.get(t.pointerId.toString());u&&(u.x=t.clientX,u.y=t.clientY)}},i.prototype._onPointerUp=function(t){if(this._joystickPointerID==t.pointerId)this._clearPreviousDraw(),this._joystickPointerID=-1,this.pressed=!1;else{var e=this._touches.get(t.pointerId.toString());e&&i.vjCanvasContext.clearRect(e.prevX-44,e.prevY-44,88,88)}this._deltaJoystickVector.x=0,this._deltaJoystickVector.y=0,this._touches.remove(t.pointerId.toString())},i.prototype.setJoystickColor=function(t){this._joystickColor=t},Object.defineProperty(i.prototype,"containerSize",{get:function(){return this._joystickContainerSize},set:function(t){this._joystickContainerSize=t,this._clearContainerSize=~~(2.1*this._joystickContainerSize),this._clearContainerSizeOffset=~~(this._clearContainerSize/2)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"puckSize",{get:function(){return this._joystickPuckSize},set:function(t){this._joystickPuckSize=t,this._clearPuckSize=~~(2.1*this._joystickPuckSize),this._clearPuckSizeOffset=~~(this._clearPuckSize/2)},enumerable:!1,configurable:!0}),i.prototype.clearPosition=function(){this.alwaysVisible=!1,this._joystickPosition=null},Object.defineProperty(i.prototype,"alwaysVisible",{get:function(){return this._alwaysVisible},set:function(t){this._alwaysVisible!==t&&(t&&this._joystickPosition?(i._alwaysVisibleSticks++,this._alwaysVisible=!0):(i._alwaysVisibleSticks--,this._alwaysVisible=!1))},enumerable:!1,configurable:!0}),i.prototype.setPosition=function(t,e){this._joystickPointerStartPos&&this._clearPreviousDraw(),this._joystickPosition=new d.d(t,e)},i.prototype.setActionOnTouch=function(t){this._action=t},i.prototype.setAxisForLeftRight=function(t){switch(t){case Nn.X:case Nn.Y:case Nn.Z:this._axisTargetedByLeftAndRight=t;break;default:this._axisTargetedByLeftAndRight=Nn.X}},i.prototype.setAxisForUpDown=function(t){switch(t){case Nn.X:case Nn.Y:case Nn.Z:this._axisTargetedByUpAndDown=t;break;default:this._axisTargetedByUpAndDown=Nn.Y}},i.prototype._clearPreviousDraw=function(){var t=this._joystickPosition||this._joystickPointerStartPos;i.vjCanvasContext.clearRect(t.x-this._clearContainerSizeOffset,t.y-this._clearContainerSizeOffset,this._clearContainerSize,this._clearContainerSize),i.vjCanvasContext.clearRect(this._joystickPreviousPointerPos.x-this._clearPuckSizeOffset,this._joystickPreviousPointerPos.y-this._clearPuckSizeOffset,this._clearPuckSize,this._clearPuckSize)},i.prototype.setContainerImage=function(t){var e=this,n=new Image;n.src=t,n.onload=function(){return e._containerImage=n}},i.prototype.setPuckImage=function(t){var e=this,n=new Image;n.src=t,n.onload=function(){return e._puckImage=n}},i.prototype._drawContainer=function(){var t=this._joystickPosition||this._joystickPointerStartPos;this._clearPreviousDraw(),this._containerImage?i.vjCanvasContext.drawImage(this._containerImage,t.x-this.containerSize,t.y-this.containerSize,2*this.containerSize,2*this.containerSize):(i.vjCanvasContext.beginPath(),i.vjCanvasContext.strokeStyle=this._joystickColor,i.vjCanvasContext.lineWidth=2,i.vjCanvasContext.arc(t.x,t.y,this.containerSize,0,2*Math.PI,!0),i.vjCanvasContext.stroke(),i.vjCanvasContext.closePath(),i.vjCanvasContext.beginPath(),i.vjCanvasContext.lineWidth=6,i.vjCanvasContext.strokeStyle=this._joystickColor,i.vjCanvasContext.arc(t.x,t.y,this.puckSize,0,2*Math.PI,!0),i.vjCanvasContext.stroke(),i.vjCanvasContext.closePath())},i.prototype._drawPuck=function(){this._puckImage?i.vjCanvasContext.drawImage(this._puckImage,this._joystickPointerPos.x-this.puckSize,this._joystickPointerPos.y-this.puckSize,2*this.puckSize,2*this.puckSize):(i.vjCanvasContext.beginPath(),i.vjCanvasContext.strokeStyle=this._joystickColor,i.vjCanvasContext.lineWidth=2,i.vjCanvasContext.arc(this._joystickPointerPos.x,this._joystickPointerPos.y,this.puckSize,0,2*Math.PI,!0),i.vjCanvasContext.stroke(),i.vjCanvasContext.closePath())},i.prototype._drawVirtualJoystick=function(){var t=this;this.alwaysVisible&&this._drawContainer(),this.pressed&&this._touches.forEach(function(e,n){n.pointerId===t._joystickPointerID?(t.alwaysVisible||t._drawContainer(),t._drawPuck(),t._joystickPreviousPointerPos=t._joystickPointerPos.clone()):(i.vjCanvasContext.clearRect(n.prevX-44,n.prevY-44,88,88),i.vjCanvasContext.beginPath(),i.vjCanvasContext.fillStyle="white",i.vjCanvasContext.beginPath(),i.vjCanvasContext.strokeStyle="red",i.vjCanvasContext.lineWidth=6,i.vjCanvasContext.arc(n.x,n.y,40,0,2*Math.PI,!0),i.vjCanvasContext.stroke(),i.vjCanvasContext.closePath(),n.prevX=n.x,n.prevY=n.y)}),requestAnimationFrame(function(){t._drawVirtualJoystick()})},i.prototype.releaseCanvas=function(){i.Canvas&&(i.Canvas.removeEventListener("pointerdown",this._onPointerDownHandlerRef),i.Canvas.removeEventListener("pointermove",this._onPointerMoveHandlerRef),i.Canvas.removeEventListener("pointerup",this._onPointerUpHandlerRef),i.Canvas.removeEventListener("pointerout",this._onPointerUpHandlerRef),window.removeEventListener("resize",this._onResize),document.body.removeChild(i.Canvas),i.Canvas=null)},i._globalJoystickIndex=0,i._alwaysVisibleSticks=0,i}();Ca.prototype.addVirtualJoystick=function(){return this.add(new Uo),this};var Uo=function(){function i(){}return i.prototype.getLeftJoystick=function(){return this._leftjoystick},i.prototype.getRightJoystick=function(){return this._rightjoystick},i.prototype.checkInputs=function(){if(this._leftjoystick){var t=this.camera,e=50*t._computeLocalCameraSpeed(),n=d.a.RotationYawPitchRoll(t.rotation.y,t.rotation.x,0),r=d.e.TransformCoordinates(new d.e(this._leftjoystick.deltaPosition.x*e,this._leftjoystick.deltaPosition.y*e,this._leftjoystick.deltaPosition.z*e),n);t.cameraDirection=t.cameraDirection.add(r),t.cameraRotation=t.cameraRotation.addVector3(this._rightjoystick.deltaPosition),this._leftjoystick.pressed||(this._leftjoystick.deltaPosition=this._leftjoystick.deltaPosition.scale(.9)),this._rightjoystick.pressed||(this._rightjoystick.deltaPosition=this._rightjoystick.deltaPosition.scale(.9))}},i.prototype.attachControl=function(){this._leftjoystick=new Kc(!0),this._leftjoystick.setAxisForUpDown(Nn.Z),this._leftjoystick.setAxisForLeftRight(Nn.X),this._leftjoystick.setJoystickSensibility(.15),this._rightjoystick=new Kc(!1),this._rightjoystick.setAxisForUpDown(Nn.X),this._rightjoystick.setAxisForLeftRight(Nn.Y),this._rightjoystick.reverseUpDown=!0,this._rightjoystick.setJoystickSensibility(.05),this._rightjoystick.setJoystickColor("yellow")},i.prototype.detachControl=function(t){this._leftjoystick.releaseCanvas(),this._rightjoystick.releaseCanvas()},i.prototype.getClassName=function(){return"FreeCameraVirtualJoystickInput"},i.prototype.getSimpleName=function(){return"virtualJoystick"},i}();Kn.FreeCameraVirtualJoystickInput=Uo;var Zt=c(28),ci=function(i){function t(e,n,r,o){o===void 0&&(o=!0);var u=i.call(this,e,n,r,o)||this;return u._tmpUpVector=d.e.Zero(),u._tmpTargetVector=d.e.Zero(),u.cameraDirection=new d.e(0,0,0),u.cameraRotation=new d.d(0,0),u.ignoreParentScaling=!1,u.updateUpVectorFromRotation=!1,u._tmpQuaternion=new d.b,u.rotation=new d.e(0,0,0),u.speed=2,u.noRotationConstraint=!1,u.invertRotation=!1,u.inverseRotationSpeed=.2,u.lockedTarget=null,u._currentTarget=d.e.Zero(),u._initialFocalDistance=1,u._viewMatrix=d.a.Zero(),u._camMatrix=d.a.Zero(),u._cameraTransformMatrix=d.a.Zero(),u._cameraRotationMatrix=d.a.Zero(),u._referencePoint=new d.e(0,0,1),u._transformedReferencePoint=d.e.Zero(),u._defaultUp=d.e.Up(),u._cachedRotationZ=0,u._cachedQuaternionRotationZ=0,u}return Object(p.d)(t,i),t.prototype.getFrontPosition=function(e){this.getWorldMatrix();var n=this.getTarget().subtract(this.position);return n.normalize(),n.scaleInPlace(e),this.globalPosition.add(n)},t.prototype._getLockedTargetPosition=function(){return this.lockedTarget?(this.lockedTarget.absolutePosition&&this.lockedTarget.computeWorldMatrix(),this.lockedTarget.absolutePosition||this.lockedTarget):null},t.prototype.storeState=function(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),i.prototype.storeState.call(this)},t.prototype._restoreStateValues=function(){return!!i.prototype._restoreStateValues.call(this)&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.copyFromFloats(0,0,0),this.cameraRotation.copyFromFloats(0,0),!0)},t.prototype._initCache=function(){i.prototype._initCache.call(this),this._cache.lockedTarget=new d.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new d.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new d.b(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},t.prototype._updateCache=function(e){e||i.prototype._updateCache.call(this);var n=this._getLockedTargetPosition();n?this._cache.lockedTarget?this._cache.lockedTarget.copyFrom(n):this._cache.lockedTarget=n.clone():this._cache.lockedTarget=null,this._cache.rotation.copyFrom(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion)},t.prototype._isSynchronizedViewMatrix=function(){if(!i.prototype._isSynchronizedViewMatrix.call(this))return!1;var e=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(e):!e)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))},t.prototype._computeLocalCameraSpeed=function(){var e=this.getEngine();return this.speed*Math.sqrt(e.getDeltaTime()/(100*e.getFps()))},t.prototype.setTarget=function(e){this.upVector.normalize(),this._initialFocalDistance=e.subtract(this.position).length(),this.position.z===e.z&&(this.position.z+=Zt.a),this._referencePoint.normalize().scaleInPlace(this._initialFocalDistance),d.a.LookAtLHToRef(this.position,e,this._defaultUp,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);var n=e.subtract(this.position);n.x>=0?this.rotation.y=-Math.atan(n.z/n.x)+Math.PI/2:this.rotation.y=-Math.atan(n.z/n.x)-Math.PI/2,this.rotation.z=0,isNaN(this.rotation.x)&&(this.rotation.x=0),isNaN(this.rotation.y)&&(this.rotation.y=0),isNaN(this.rotation.z)&&(this.rotation.z=0),this.rotationQuaternion&&d.b.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)},Object.defineProperty(t.prototype,"target",{get:function(){return this.getTarget()},set:function(e){this.setTarget(e)},enumerable:!1,configurable:!0}),t.prototype.getTarget=function(){return this._currentTarget},t.prototype._decideIfNeedsToMove=function(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0},t.prototype._updatePosition=function(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(d.c.Matrix[0]),d.e.TransformNormalToRef(this.cameraDirection,d.c.Matrix[0],d.c.Vector3[0]),void this.position.addInPlace(d.c.Vector3[0]);this.position.addInPlace(this.cameraDirection)},t.prototype._checkInputs=function(){var e=this.invertRotation?-this.inverseRotationSpeed:1,n=this._decideIfNeedsToMove(),r=Math.abs(this.cameraRotation.x)>0||Math.abs(this.cameraRotation.y)>0;n&&this._updatePosition(),r&&(this.rotationQuaternion&&this.rotationQuaternion.toEulerAnglesToRef(this.rotation),this.rotation.x+=this.cameraRotation.x*e,this.rotation.y+=this.cameraRotation.y*e,!this.noRotationConstraint&&(this.rotation.x>1.570796&&(this.rotation.x=1.570796),this.rotation.x<-1.570796&&(this.rotation.x=-1.570796)),this.rotationQuaternion&&this.rotation.lengthSquared()&&d.b.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)),n&&(Math.abs(this.cameraDirection.x)<this.speed*Zt.a&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*Zt.a&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*Zt.a&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),r&&(Math.abs(this.cameraRotation.x)<this.speed*Zt.a&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*Zt.a&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),i.prototype._checkInputs.call(this)},t.prototype._updateCameraRotationMatrix=function(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):d.a.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)},t.prototype._rotateUpVectorWithCameraRotationMatrix=function(){return d.e.TransformNormalToRef(this._defaultUp,this._cameraRotationMatrix,this.upVector),this},t.prototype._getViewMatrix=function(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!=this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),d.e.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?Se.a.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(d.b.FromEulerVectorToRef(this.rotation,this._tmpQuaternion),Se.a.Y.rotateByQuaternionToRef(this._tmpQuaternion,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix},t.prototype._computeViewMatrix=function(e,n,r){if(this.ignoreParentScaling){if(this.parent){var o=this.parent.getWorldMatrix();d.e.TransformCoordinatesToRef(e,o,this._globalPosition),d.e.TransformCoordinatesToRef(n,o,this._tmpTargetVector),d.e.TransformNormalToRef(r,o,this._tmpUpVector),this._markSyncedWithParent()}else this._globalPosition.copyFrom(e),this._tmpTargetVector.copyFrom(n),this._tmpUpVector.copyFrom(r);this.getScene().useRightHandedSystem?d.a.LookAtRHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix):d.a.LookAtLHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix)}else this.getScene().useRightHandedSystem?d.a.LookAtRHToRef(e,n,r,this._viewMatrix):d.a.LookAtLHToRef(e,n,r,this._viewMatrix),this.parent?(o=this.parent.getWorldMatrix(),this._viewMatrix.invert(),this._viewMatrix.multiplyToRef(o,this._viewMatrix),this._viewMatrix.getTranslationToRef(this._globalPosition),this._viewMatrix.invert(),this._markSyncedWithParent()):this._globalPosition.copyFrom(e)},t.prototype.createRigCamera=function(e,n){if(this.cameraRigMode!==Pt.a.RIG_MODE_NONE){var r=new t(e,this.position.clone(),this.getScene());return r.isRigCamera=!0,r.rigParent=this,this.cameraRigMode!==Pt.a.RIG_MODE_VR&&this.cameraRigMode!==Pt.a.RIG_MODE_WEBVR||(this.rotationQuaternion||(this.rotationQuaternion=new d.b),r._cameraRigParams={},r.rotationQuaternion=new d.b),r}return null},t.prototype._updateRigCameras=function(){var e=this._rigCameras[0],n=this._rigCameras[1];switch(this.computeWorldMatrix(),this.cameraRigMode){case Pt.a.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case Pt.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case Pt.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case Pt.a.RIG_MODE_STEREOSCOPIC_OVERUNDER:case Pt.a.RIG_MODE_STEREOSCOPIC_INTERLACED:var r=this.cameraRigMode===Pt.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,o=this.cameraRigMode===Pt.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*r,e),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*o,n);break;case Pt.a.RIG_MODE_VR:e.rotationQuaternion?(e.rotationQuaternion.copyFrom(this.rotationQuaternion),n.rotationQuaternion.copyFrom(this.rotationQuaternion)):(e.rotation.copyFrom(this.rotation),n.rotation.copyFrom(this.rotation)),e.position.copyFrom(this.position),n.position.copyFrom(this.position)}i.prototype._updateRigCameras.call(this)},t.prototype._getRigCamPositionAndTarget=function(e,n){this.getTarget().subtractToRef(this.position,t._TargetFocalPoint),t._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);var r=t._TargetFocalPoint.addInPlace(this.position);d.a.TranslationToRef(-r.x,-r.y,-r.z,t._TargetTransformMatrix),t._TargetTransformMatrix.multiplyToRef(d.a.RotationAxis(n.upVector,e),t._RigCamTransformMatrix),d.a.TranslationToRef(r.x,r.y,r.z,t._TargetTransformMatrix),t._RigCamTransformMatrix.multiplyToRef(t._TargetTransformMatrix,t._RigCamTransformMatrix),d.e.TransformCoordinatesToRef(this.position,t._RigCamTransformMatrix,n.position),n.setTarget(r)},t.prototype.getClassName=function(){return"TargetCamera"},t._RigCamTransformMatrix=new d.a,t._TargetTransformMatrix=new d.a,t._TargetFocalPoint=new d.e,Object(p.c)([Object(B.o)()],t.prototype,"rotation",void 0),Object(p.c)([Object(B.c)()],t.prototype,"speed",void 0),Object(p.c)([Object(B.k)("lockedTargetId")],t.prototype,"lockedTarget",void 0),t}(Pt.a),Cr=function(i){function t(e,n,r,o){o===void 0&&(o=!0);var u=i.call(this,e,n,r,o)||this;return u.ellipsoid=new d.e(.5,1,.5),u.ellipsoidOffset=new d.e(0,0,0),u.checkCollisions=!1,u.applyGravity=!1,u._needMoveForGravity=!1,u._oldPosition=d.e.Zero(),u._diffPosition=d.e.Zero(),u._newPosition=d.e.Zero(),u._collisionMask=-1,u._onCollisionPositionChange=function(f,v,y){y===void 0&&(y=null);var D;D=v,u._newPosition.copyFrom(D),u._newPosition.subtractToRef(u._oldPosition,u._diffPosition),u._diffPosition.length()>Ge.a.CollisionsEpsilon&&(u.position.addInPlace(u._diffPosition),u.onCollide&&y&&u.onCollide(y))},u.inputs=new Ca(u),u.inputs.addKeyboard().addMouse(),u}return Object(p.d)(t,i),Object.defineProperty(t.prototype,"angularSensibility",{get:function(){var e=this.inputs.attached.mouse;return e?e.angularSensibility:0},set:function(e){var n=this.inputs.attached.mouse;n&&(n.angularSensibility=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keysUp",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysUp:[]},set:function(e){var n=this.inputs.attached.keyboard;n&&(n.keysUp=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keysUpward",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysUpward:[]},set:function(e){var n=this.inputs.attached.keyboard;n&&(n.keysUpward=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keysDown",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysDown:[]},set:function(e){var n=this.inputs.attached.keyboard;n&&(n.keysDown=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keysDownward",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysDownward:[]},set:function(e){var n=this.inputs.attached.keyboard;n&&(n.keysDownward=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keysLeft",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysLeft:[]},set:function(e){var n=this.inputs.attached.keyboard;n&&(n.keysLeft=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keysRight",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysRight:[]},set:function(e){var n=this.inputs.attached.keyboard;n&&(n.keysRight=e)},enumerable:!1,configurable:!0}),t.prototype.attachControl=function(e,n){n=et.b.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(n)},t.prototype.detachControl=function(e){this.inputs.detachElement(),this.cameraDirection=new d.e(0,0,0),this.cameraRotation=new d.d(0,0)},Object.defineProperty(t.prototype,"collisionMask",{get:function(){return this._collisionMask},set:function(e){this._collisionMask=isNaN(e)?-1:e},enumerable:!1,configurable:!0}),t.prototype._collideWithWorld=function(e){(this.parent?d.e.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position).subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);var n=this.getScene().collisionCoordinator;this._collider||(this._collider=n.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;var r=e;this.applyGravity&&(r=e.add(this.getScene().gravity)),n.getNewPosition(this._oldPosition,r,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)},t.prototype._checkInputs=function(){this._localDirection||(this._localDirection=d.e.Zero(),this._transformedDirection=d.e.Zero()),this.inputs.checkInputs(),i.prototype._checkInputs.call(this)},t.prototype._decideIfNeedsToMove=function(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0},t.prototype._updatePosition=function(){this.checkCollisions&&this.getScene().collisionsEnabled?this._collideWithWorld(this.cameraDirection):i.prototype._updatePosition.call(this)},t.prototype.dispose=function(){this.inputs.clear(),i.prototype.dispose.call(this)},t.prototype.getClassName=function(){return"FreeCamera"},Object(p.c)([Object(B.o)()],t.prototype,"ellipsoid",void 0),Object(p.c)([Object(B.o)()],t.prototype,"ellipsoidOffset",void 0),Object(p.c)([Object(B.c)()],t.prototype,"checkCollisions",void 0),Object(p.c)([Object(B.c)()],t.prototype,"applyGravity",void 0),t}(ci);$.a.AddNodeConstructor("TouchCamera",function(i,t){return function(){return new Qc(i,d.e.Zero(),t)}});var Qc=function(i){function t(e,n,r){var o=i.call(this,e,n,r)||this;return o.inputs.addTouch(),o._setupInputs(),o}return Object(p.d)(t,i),Object.defineProperty(t.prototype,"touchAngularSensibility",{get:function(){var e=this.inputs.attached.touch;return e?e.touchAngularSensibility:0},set:function(e){var n=this.inputs.attached.touch;n&&(n.touchAngularSensibility=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"touchMoveSensibility",{get:function(){var e=this.inputs.attached.touch;return e?e.touchMoveSensibility:0},set:function(e){var n=this.inputs.attached.touch;n&&(n.touchMoveSensibility=e)},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"TouchCamera"},t.prototype._setupInputs=function(){var e=this.inputs.attached.touch,n=this.inputs.attached.mouse;n?n.touchEnabled=!1:e.allowMouse=!0},t}(Cr);$.a.AddNodeConstructor("ArcRotateCamera",function(i,t){return function(){return new Vi(i,0,0,1,d.e.Zero(),t)}});var Vi=function(i){function t(e,n,r,o,u,f,v){v===void 0&&(v=!0);var y=i.call(this,e,d.e.Zero(),f,v)||this;return y.inertialAlphaOffset=0,y.inertialBetaOffset=0,y.inertialRadiusOffset=0,y.lowerAlphaLimit=null,y.upperAlphaLimit=null,y.lowerBetaLimit=.01,y.upperBetaLimit=Math.PI-.01,y.lowerRadiusLimit=null,y.upperRadiusLimit=null,y.inertialPanningX=0,y.inertialPanningY=0,y.pinchToPanMaxDistance=20,y.panningDistanceLimit=null,y.panningOriginTarget=d.e.Zero(),y.panningInertia=.9,y.zoomOnFactor=1,y.targetScreenOffset=d.d.Zero(),y.allowUpsideDown=!0,y.useInputToRestoreState=!0,y._viewMatrix=new d.a,y.panningAxis=new d.e(1,1,0),y.onMeshTargetChangedObservable=new S.c,y.checkCollisions=!1,y.collisionRadius=new d.e(.5,.5,.5),y._previousPosition=d.e.Zero(),y._collisionVelocity=d.e.Zero(),y._newPosition=d.e.Zero(),y._computationVector=d.e.Zero(),y._onCollisionPositionChange=function(D,w,F){F===void 0&&(F=null),F?(y.setPosition(w),y.onCollide&&y.onCollide(F)):y._previousPosition.copyFrom(y._position);var z=Math.cos(y.alpha),k=Math.sin(y.alpha),K=Math.cos(y.beta),oe=Math.sin(y.beta);oe===0&&(oe=1e-4);var ae=y._getTargetPosition();y._computationVector.copyFromFloats(y.radius*z*oe,y.radius*K,y.radius*k*oe),ae.addToRef(y._computationVector,y._newPosition),y._position.copyFrom(y._newPosition);var ue=y.upVector;y.allowUpsideDown&&y.beta<0&&(ue=(ue=ue.clone()).negate()),y._computeViewMatrix(y._position,ae,ue),y._viewMatrix.addAtIndex(12,y.targetScreenOffset.x),y._viewMatrix.addAtIndex(13,y.targetScreenOffset.y),y._collisionTriggered=!1},y._target=d.e.Zero(),u&&y.setTarget(u),y.alpha=n,y.beta=r,y.radius=o,y.getViewMatrix(),y.inputs=new ls(y),y.inputs.addKeyboard().addMouseWheel().addPointers(),y}return Object(p.d)(t,i),Object.defineProperty(t.prototype,"target",{get:function(){return this._target},set:function(e){this.setTarget(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(e){this.setPosition(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"upVector",{get:function(){return this._upVector},set:function(e){this._upToYMatrix||(this._YToUpMatrix=new d.a,this._upToYMatrix=new d.a,this._upVector=d.e.Zero()),e.normalize(),this._upVector.copyFrom(e),this.setMatUp()},enumerable:!1,configurable:!0}),t.prototype.setMatUp=function(){d.a.RotationAlignToRef(d.e.UpReadOnly,this._upVector,this._YToUpMatrix),d.a.RotationAlignToRef(this._upVector,d.e.UpReadOnly,this._upToYMatrix)},Object.defineProperty(t.prototype,"angularSensibilityX",{get:function(){var e=this.inputs.attached.pointers;return e?e.angularSensibilityX:0},set:function(e){var n=this.inputs.attached.pointers;n&&(n.angularSensibilityX=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"angularSensibilityY",{get:function(){var e=this.inputs.attached.pointers;return e?e.angularSensibilityY:0},set:function(e){var n=this.inputs.attached.pointers;n&&(n.angularSensibilityY=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pinchPrecision",{get:function(){var e=this.inputs.attached.pointers;return e?e.pinchPrecision:0},set:function(e){var n=this.inputs.attached.pointers;n&&(n.pinchPrecision=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pinchDeltaPercentage",{get:function(){var e=this.inputs.attached.pointers;return e?e.pinchDeltaPercentage:0},set:function(e){var n=this.inputs.attached.pointers;n&&(n.pinchDeltaPercentage=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"useNaturalPinchZoom",{get:function(){var e=this.inputs.attached.pointers;return!!e&&e.useNaturalPinchZoom},set:function(e){var n=this.inputs.attached.pointers;n&&(n.useNaturalPinchZoom=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"panningSensibility",{get:function(){var e=this.inputs.attached.pointers;return e?e.panningSensibility:0},set:function(e){var n=this.inputs.attached.pointers;n&&(n.panningSensibility=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keysUp",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysUp:[]},set:function(e){var n=this.inputs.attached.keyboard;n&&(n.keysUp=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keysDown",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysDown:[]},set:function(e){var n=this.inputs.attached.keyboard;n&&(n.keysDown=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keysLeft",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysLeft:[]},set:function(e){var n=this.inputs.attached.keyboard;n&&(n.keysLeft=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keysRight",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysRight:[]},set:function(e){var n=this.inputs.attached.keyboard;n&&(n.keysRight=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wheelPrecision",{get:function(){var e=this.inputs.attached.mousewheel;return e?e.wheelPrecision:0},set:function(e){var n=this.inputs.attached.mousewheel;n&&(n.wheelPrecision=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wheelDeltaPercentage",{get:function(){var e=this.inputs.attached.mousewheel;return e?e.wheelDeltaPercentage:0},set:function(e){var n=this.inputs.attached.mousewheel;n&&(n.wheelDeltaPercentage=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bouncingBehavior",{get:function(){return this._bouncingBehavior},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"useBouncingBehavior",{get:function(){return this._bouncingBehavior!=null},set:function(e){e!==this.useBouncingBehavior&&(e?(this._bouncingBehavior=new Wu,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"framingBehavior",{get:function(){return this._framingBehavior},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"useFramingBehavior",{get:function(){return this._framingBehavior!=null},set:function(e){e!==this.useFramingBehavior&&(e?(this._framingBehavior=new to,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"autoRotationBehavior",{get:function(){return this._autoRotationBehavior},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"useAutoRotationBehavior",{get:function(){return this._autoRotationBehavior!=null},set:function(e){e!==this.useAutoRotationBehavior&&(e?(this._autoRotationBehavior=new Hu,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))},enumerable:!1,configurable:!0}),t.prototype._initCache=function(){i.prototype._initCache.call(this),this._cache._target=new d.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=d.d.Zero()},t.prototype._updateCache=function(e){e||i.prototype._updateCache.call(this),this._cache._target.copyFrom(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.copyFrom(this.targetScreenOffset)},t.prototype._getTargetPosition=function(){if(this._targetHost&&this._targetHost.getAbsolutePosition){var e=this._targetHost.absolutePosition;this._targetBoundingCenter?e.addToRef(this._targetBoundingCenter,this._target):this._target.copyFrom(e)}var n=this._getLockedTargetPosition();return n||this._target},t.prototype.storeState=function(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),i.prototype.storeState.call(this)},t.prototype._restoreStateValues=function(){return!!i.prototype._restoreStateValues.call(this)&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)},t.prototype._isSynchronizedViewMatrix=function(){return!!i.prototype._isSynchronizedViewMatrix.call(this)&&this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset)},t.prototype.attachControl=function(e,n,r,o){var u=this;r===void 0&&(r=!0),o===void 0&&(o=2),n=et.b.BackCompatCameraNoPreventDefault(arguments),this._useCtrlForPanning=r,this._panningMouseButton=o,typeof arguments[0]=="boolean"&&(arguments.length>1&&(this._useCtrlForPanning=arguments[1]),arguments.length>2&&(this._panningMouseButton=arguments[2])),this.inputs.attachElement(n),this._reset=function(){u.inertialAlphaOffset=0,u.inertialBetaOffset=0,u.inertialRadiusOffset=0,u.inertialPanningX=0,u.inertialPanningY=0}},t.prototype.detachControl=function(e){this.inputs.detachElement(),this._reset&&this._reset()},t.prototype._checkInputs=function(){if(!this._collisionTriggered){if(this.inputs.checkInputs(),this.inertialAlphaOffset!==0||this.inertialBetaOffset!==0||this.inertialRadiusOffset!==0){var e=this.inertialAlphaOffset;this.beta<=0&&(e*=-1),this.getScene().useRightHandedSystem&&(e*=-1),this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(e*=-1),this.alpha+=e,this.beta+=this.inertialBetaOffset,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<Zt.a&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<Zt.a&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*Zt.a&&(this.inertialRadiusOffset=0)}(this.inertialPanningX!==0||this.inertialPanningY!==0)&&(this._localDirection||(this._localDirection=d.e.Zero(),this._transformedDirection=d.e.Zero()),this._localDirection.copyFromFloats(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY),this._localDirection.multiplyInPlace(this.panningAxis),this._viewMatrix.invertToRef(this._cameraTransformMatrix),d.e.TransformNormalToRef(this._localDirection,this._cameraTransformMatrix,this._transformedDirection),this.panningAxis.y||(this._transformedDirection.y=0),!this._targetHost&&(this.panningDistanceLimit?(this._transformedDirection.addInPlace(this._target),d.e.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.copyFrom(this._transformedDirection)):this._target.addInPlace(this._transformedDirection)),this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*Zt.a&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*Zt.a&&(this.inertialPanningY=0)),this._checkLimits(),i.prototype._checkInputs.call(this)}},t.prototype._checkLimits=function(){this.lowerBetaLimit===null||this.lowerBetaLimit===void 0?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),this.upperBetaLimit===null||this.upperBetaLimit===void 0?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),this.lowerAlphaLimit!==null&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),this.upperAlphaLimit!==null&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),this.lowerRadiusLimit!==null&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),this.upperRadiusLimit!==null&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0)},t.prototype.rebuildAnglesAndRadius=function(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),this._upVector.x===0&&this._upVector.y===1&&this._upVector.z===0||d.e.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),this.radius===0&&(this.radius=1e-4);var e=this.alpha;this._computationVector.x===0&&this._computationVector.z===0?this.alpha=Math.PI/2:this.alpha=Math.acos(this._computationVector.x/Math.sqrt(Math.pow(this._computationVector.x,2)+Math.pow(this._computationVector.z,2))),this._computationVector.z<0&&(this.alpha=2*Math.PI-this.alpha);var n=Math.round((e-this.alpha)/(2*Math.PI));this.alpha+=2*n*Math.PI,this.beta=Math.acos(this._computationVector.y/this.radius),this._checkLimits()},t.prototype.setPosition=function(e){this._position.equals(e)||(this._position.copyFrom(e),this.rebuildAnglesAndRadius())},t.prototype.setTarget=function(e,n,r){if(n===void 0&&(n=!1),r===void 0&&(r=!1),e.getBoundingInfo)this._targetBoundingCenter=n?e.getBoundingInfo().boundingBox.centerWorld.clone():null,e.computeWorldMatrix(),this._targetHost=e,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{var o=e,u=this._getTargetPosition();if(u&&!r&&u.equals(o))return;this._targetHost=null,this._target=o,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}this.rebuildAnglesAndRadius()},t.prototype._getViewMatrix=function(){var e=Math.cos(this.alpha),n=Math.sin(this.alpha),r=Math.cos(this.beta),o=Math.sin(this.beta);o===0&&(o=1e-4),this.radius===0&&(this.radius=1e-4);var u=this._getTargetPosition();if(this._computationVector.copyFromFloats(this.radius*e*o,this.radius*r,this.radius*n*o),this._upVector.x===0&&this._upVector.y===1&&this._upVector.z===0||d.e.TransformCoordinatesToRef(this._computationVector,this._YToUpMatrix,this._computationVector),u.addToRef(this._computationVector,this._newPosition),this.getScene().collisionsEnabled&&this.checkCollisions){var f=this.getScene().collisionCoordinator;this._collider||(this._collider=f.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,f.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.copyFrom(this._newPosition);var v=this.upVector;this.allowUpsideDown&&o<0&&(v=v.negate()),this._computeViewMatrix(this._position,u,v),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget=u,this._viewMatrix},t.prototype.zoomOn=function(e,n){n===void 0&&(n=!1),e=e||this.getScene().meshes;var r=Ne.a.MinMax(e),o=d.e.Distance(r.min,r.max);this.radius=o*this.zoomOnFactor,this.focusOn({min:r.min,max:r.max,distance:o},n)},t.prototype.focusOn=function(e,n){var r,o;if(n===void 0&&(n=!1),e.min===void 0){var u=e||this.getScene().meshes;r=Ne.a.MinMax(u),o=d.e.Distance(r.min,r.max)}else r=e,o=e.distance;this._target=Ne.a.Center(r),n||(this.maxZ=2*o)},t.prototype.createRigCamera=function(e,n){var r=0;switch(this.cameraRigMode){case Pt.a.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case Pt.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case Pt.a.RIG_MODE_STEREOSCOPIC_OVERUNDER:case Pt.a.RIG_MODE_STEREOSCOPIC_INTERLACED:case Pt.a.RIG_MODE_VR:r=this._cameraRigParams.stereoHalfAngle*(n===0?1:-1);break;case Pt.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:r=this._cameraRigParams.stereoHalfAngle*(n===0?-1:1)}var o=new t(e,this.alpha+r,this.beta,this.radius,this._target,this.getScene());return o._cameraRigParams={},o.isRigCamera=!0,o.rigParent=this,o.upVector=this.upVector,o},t.prototype._updateRigCameras=function(){var e=this._rigCameras[0],n=this._rigCameras[1];switch(e.beta=n.beta=this.beta,this.cameraRigMode){case Pt.a.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case Pt.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case Pt.a.RIG_MODE_STEREOSCOPIC_OVERUNDER:case Pt.a.RIG_MODE_STEREOSCOPIC_INTERLACED:case Pt.a.RIG_MODE_VR:e.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,n.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case Pt.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:e.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,n.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}i.prototype._updateRigCameras.call(this)},t.prototype.dispose=function(){this.inputs.clear(),i.prototype.dispose.call(this)},t.prototype.getClassName=function(){return"ArcRotateCamera"},Object(p.c)([Object(B.c)()],t.prototype,"alpha",void 0),Object(p.c)([Object(B.c)()],t.prototype,"beta",void 0),Object(p.c)([Object(B.c)()],t.prototype,"radius",void 0),Object(p.c)([Object(B.o)("target")],t.prototype,"_target",void 0),Object(p.c)([Object(B.c)()],t.prototype,"inertialAlphaOffset",void 0),Object(p.c)([Object(B.c)()],t.prototype,"inertialBetaOffset",void 0),Object(p.c)([Object(B.c)()],t.prototype,"inertialRadiusOffset",void 0),Object(p.c)([Object(B.c)()],t.prototype,"lowerAlphaLimit",void 0),Object(p.c)([Object(B.c)()],t.prototype,"upperAlphaLimit",void 0),Object(p.c)([Object(B.c)()],t.prototype,"lowerBetaLimit",void 0),Object(p.c)([Object(B.c)()],t.prototype,"upperBetaLimit",void 0),Object(p.c)([Object(B.c)()],t.prototype,"lowerRadiusLimit",void 0),Object(p.c)([Object(B.c)()],t.prototype,"upperRadiusLimit",void 0),Object(p.c)([Object(B.c)()],t.prototype,"inertialPanningX",void 0),Object(p.c)([Object(B.c)()],t.prototype,"inertialPanningY",void 0),Object(p.c)([Object(B.c)()],t.prototype,"pinchToPanMaxDistance",void 0),Object(p.c)([Object(B.c)()],t.prototype,"panningDistanceLimit",void 0),Object(p.c)([Object(B.o)()],t.prototype,"panningOriginTarget",void 0),Object(p.c)([Object(B.c)()],t.prototype,"panningInertia",void 0),Object(p.c)([Object(B.c)()],t.prototype,"zoomOnFactor",void 0),Object(p.c)([Object(B.c)()],t.prototype,"targetScreenOffset",void 0),Object(p.c)([Object(B.c)()],t.prototype,"allowUpsideDown",void 0),Object(p.c)([Object(B.c)()],t.prototype,"useInputToRestoreState",void 0),t}(ci);$.a.AddNodeConstructor("DeviceOrientationCamera",function(i,t){return function(){return new Vo(i,d.e.Zero(),t)}});var Vo=function(i){function t(e,n,r){var o=i.call(this,e,n,r)||this;return o._tmpDragQuaternion=new d.b,o._disablePointerInputWhenUsingDeviceOrientation=!0,o._dragFactor=0,o._quaternionCache=new d.b,o.inputs.addDeviceOrientation(),o.inputs._deviceOrientationInput&&o.inputs._deviceOrientationInput._onDeviceOrientationChangedObservable.addOnce(function(){o._disablePointerInputWhenUsingDeviceOrientation&&o.inputs._mouseInput&&(o.inputs._mouseInput._allowCameraRotation=!1,o.inputs._mouseInput.onPointerMovedObservable.add(function(u){o._dragFactor!=0&&(o._initialQuaternion||(o._initialQuaternion=new d.b),d.b.FromEulerAnglesToRef(0,u.offsetX*o._dragFactor,0,o._tmpDragQuaternion),o._initialQuaternion.multiplyToRef(o._tmpDragQuaternion,o._initialQuaternion))}))}),o}return Object(p.d)(t,i),Object.defineProperty(t.prototype,"disablePointerInputWhenUsingDeviceOrientation",{get:function(){return this._disablePointerInputWhenUsingDeviceOrientation},set:function(e){this._disablePointerInputWhenUsingDeviceOrientation=e},enumerable:!1,configurable:!0}),t.prototype.enableHorizontalDragging=function(e){e===void 0&&(e=1/300),this._dragFactor=e},t.prototype.getClassName=function(){return"DeviceOrientationCamera"},t.prototype._checkInputs=function(){i.prototype._checkInputs.call(this),this._quaternionCache.copyFrom(this.rotationQuaternion),this._initialQuaternion&&this._initialQuaternion.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)},t.prototype.resetToCurrentRotation=function(e){var n=this;e===void 0&&(e=Se.a.Y),this.rotationQuaternion&&(this._initialQuaternion||(this._initialQuaternion=new d.b),this._initialQuaternion.copyFrom(this._quaternionCache||this.rotationQuaternion),["x","y","z"].forEach(function(r){e[r]?n._initialQuaternion[r]*=-1:n._initialQuaternion[r]=0}),this._initialQuaternion.normalize(),this._initialQuaternion.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion))},t}(Cr),qc=function(i){function t(e){return i.call(this,e)||this}return Object(p.d)(t,i),t.prototype.addKeyboard=function(){return this.add(new zc),this},t.prototype.addMouse=function(e){return e===void 0&&(e=!0),this.add(new Bo(e)),this},t}(Aa),ro=function(i){function t(e,n,r,o){o===void 0&&(o=!0);var u=i.call(this,e,n,r,o)||this;return u.ellipsoid=new d.e(1,1,1),u.ellipsoidOffset=new d.e(0,0,0),u.checkCollisions=!1,u.applyGravity=!1,u.cameraDirection=d.e.Zero(),u._trackRoll=0,u.rollCorrect=100,u.bankedTurn=!1,u.bankedTurnLimit=Math.PI/2,u.bankedTurnMultiplier=1,u._needMoveForGravity=!1,u._oldPosition=d.e.Zero(),u._diffPosition=d.e.Zero(),u._newPosition=d.e.Zero(),u._collisionMask=-1,u._onCollisionPositionChange=function(f,v,y){y===void 0&&(y=null);var D;D=v,u._newPosition.copyFrom(D),u._newPosition.subtractToRef(u._oldPosition,u._diffPosition),u._diffPosition.length()>Ge.a.CollisionsEpsilon&&(u.position.addInPlace(u._diffPosition),u.onCollide&&y&&u.onCollide(y))},u.inputs=new qc(u),u.inputs.addKeyboard().addMouse(),u}return Object(p.d)(t,i),Object.defineProperty(t.prototype,"angularSensibility",{get:function(){var e=this.inputs.attached.mouse;return e?e.angularSensibility:0},set:function(e){var n=this.inputs.attached.mouse;n&&(n.angularSensibility=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keysForward",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysForward:[]},set:function(e){var n=this.inputs.attached.keyboard;n&&(n.keysForward=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keysBackward",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysBackward:[]},set:function(e){var n=this.inputs.attached.keyboard;n&&(n.keysBackward=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keysUp",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysUp:[]},set:function(e){var n=this.inputs.attached.keyboard;n&&(n.keysUp=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keysDown",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysDown:[]},set:function(e){var n=this.inputs.attached.keyboard;n&&(n.keysDown=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keysLeft",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysLeft:[]},set:function(e){var n=this.inputs.attached.keyboard;n&&(n.keysLeft=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keysRight",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysRight:[]},set:function(e){var n=this.inputs.attached.keyboard;n&&(n.keysRight=e)},enumerable:!1,configurable:!0}),t.prototype.attachControl=function(e,n){n=et.b.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(n)},t.prototype.detachControl=function(){this.inputs.detachElement(),this.cameraDirection=new d.e(0,0,0)},Object.defineProperty(t.prototype,"collisionMask",{get:function(){return this._collisionMask},set:function(e){this._collisionMask=isNaN(e)?-1:e},enumerable:!1,configurable:!0}),t.prototype._collideWithWorld=function(e){(this.parent?d.e.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position).subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);var n=this.getScene().collisionCoordinator;this._collider||(this._collider=n.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;var r=e;this.applyGravity&&(r=e.add(this.getScene().gravity)),n.getNewPosition(this._oldPosition,r,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)},t.prototype._checkInputs=function(){this._localDirection||(this._localDirection=d.e.Zero(),this._transformedDirection=d.e.Zero()),this.inputs.checkInputs(),i.prototype._checkInputs.call(this)},t.prototype._decideIfNeedsToMove=function(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0},t.prototype._updatePosition=function(){this.checkCollisions&&this.getScene().collisionsEnabled?this._collideWithWorld(this.cameraDirection):i.prototype._updatePosition.call(this)},t.prototype.restoreRoll=function(e){var n=this._trackRoll,r=n-this.rotation.z;Math.abs(r)>=.001&&(this.rotation.z+=r/e,Math.abs(n-this.rotation.z)<=.001&&(this.rotation.z=n))},t.prototype.dispose=function(){this.inputs.clear(),i.prototype.dispose.call(this)},t.prototype.getClassName=function(){return"FlyCamera"},Object(p.c)([Object(B.o)()],t.prototype,"ellipsoid",void 0),Object(p.c)([Object(B.o)()],t.prototype,"ellipsoidOffset",void 0),Object(p.c)([Object(B.c)()],t.prototype,"checkCollisions",void 0),Object(p.c)([Object(B.c)()],t.prototype,"applyGravity",void 0),t}(ci),ko=function(i){function t(e){return i.call(this,e)||this}return Object(p.d)(t,i),t.prototype.addKeyboard=function(){return this.add(new Pa),this},t.prototype.addMouseWheel=function(){return this.add(new Gc),this},t.prototype.addPointers=function(){return this.add(new Hc),this},t.prototype.addVRDeviceOrientation=function(){return console.warn("DeviceOrientation support not yet implemented for FollowCamera."),this},t}(Aa);$.a.AddNodeConstructor("FollowCamera",function(i,t){return function(){return new Zc(i,d.e.Zero(),t)}}),$.a.AddNodeConstructor("ArcFollowCamera",function(i,t){return function(){return new Zu(i,0,0,1,null,t)}});var Zr,Zc=function(i){function t(e,n,r,o){o===void 0&&(o=null);var u=i.call(this,e,n,r)||this;return u.radius=12,u.lowerRadiusLimit=null,u.upperRadiusLimit=null,u.rotationOffset=0,u.lowerRotationOffsetLimit=null,u.upperRotationOffsetLimit=null,u.heightOffset=4,u.lowerHeightOffsetLimit=null,u.upperHeightOffsetLimit=null,u.cameraAcceleration=.05,u.maxCameraSpeed=20,u.lockedTarget=o,u.inputs=new ko(u),u.inputs.addKeyboard().addMouseWheel().addPointers(),u}return Object(p.d)(t,i),t.prototype._follow=function(e){if(e){var n;if(e.rotationQuaternion){var r=new d.a;e.rotationQuaternion.toRotationMatrix(r),n=Math.atan2(r.m[8],r.m[10])}else n=e.rotation.y;var o=et.b.ToRadians(this.rotationOffset)+n,u=e.getAbsolutePosition(),f=u.x+Math.sin(o)*this.radius,v=u.z+Math.cos(o)*this.radius,y=f-this.position.x,D=u.y+this.heightOffset-this.position.y,w=v-this.position.z,F=y*this.cameraAcceleration*2,z=D*this.cameraAcceleration,k=w*this.cameraAcceleration*2;(F>this.maxCameraSpeed||F<-this.maxCameraSpeed)&&(F=F<1?-this.maxCameraSpeed:this.maxCameraSpeed),(z>this.maxCameraSpeed||z<-this.maxCameraSpeed)&&(z=z<1?-this.maxCameraSpeed:this.maxCameraSpeed),(k>this.maxCameraSpeed||k<-this.maxCameraSpeed)&&(k=k<1?-this.maxCameraSpeed:this.maxCameraSpeed),this.position=new d.e(this.position.x+F,this.position.y+z,this.position.z+k),this.setTarget(u)}},t.prototype.attachControl=function(e,n){n=et.b.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(n),this._reset=function(){}},t.prototype.detachControl=function(e){this.inputs.detachElement(),this._reset&&this._reset()},t.prototype._checkInputs=function(){this.inputs.checkInputs(),this._checkLimits(),i.prototype._checkInputs.call(this),this.lockedTarget&&this._follow(this.lockedTarget)},t.prototype._checkLimits=function(){this.lowerRadiusLimit!==null&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit),this.upperRadiusLimit!==null&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit),this.lowerHeightOffsetLimit!==null&&this.heightOffset<this.lowerHeightOffsetLimit&&(this.heightOffset=this.lowerHeightOffsetLimit),this.upperHeightOffsetLimit!==null&&this.heightOffset>this.upperHeightOffsetLimit&&(this.heightOffset=this.upperHeightOffsetLimit),this.lowerRotationOffsetLimit!==null&&this.rotationOffset<this.lowerRotationOffsetLimit&&(this.rotationOffset=this.lowerRotationOffsetLimit),this.upperRotationOffsetLimit!==null&&this.rotationOffset>this.upperRotationOffsetLimit&&(this.rotationOffset=this.upperRotationOffsetLimit)},t.prototype.getClassName=function(){return"FollowCamera"},Object(p.c)([Object(B.c)()],t.prototype,"radius",void 0),Object(p.c)([Object(B.c)()],t.prototype,"lowerRadiusLimit",void 0),Object(p.c)([Object(B.c)()],t.prototype,"upperRadiusLimit",void 0),Object(p.c)([Object(B.c)()],t.prototype,"rotationOffset",void 0),Object(p.c)([Object(B.c)()],t.prototype,"lowerRotationOffsetLimit",void 0),Object(p.c)([Object(B.c)()],t.prototype,"upperRotationOffsetLimit",void 0),Object(p.c)([Object(B.c)()],t.prototype,"heightOffset",void 0),Object(p.c)([Object(B.c)()],t.prototype,"lowerHeightOffsetLimit",void 0),Object(p.c)([Object(B.c)()],t.prototype,"upperHeightOffsetLimit",void 0),Object(p.c)([Object(B.c)()],t.prototype,"cameraAcceleration",void 0),Object(p.c)([Object(B.c)()],t.prototype,"maxCameraSpeed",void 0),Object(p.c)([Object(B.k)("lockedTargetId")],t.prototype,"lockedTarget",void 0),t}(ci),Zu=function(i){function t(e,n,r,o,u,f){var v=i.call(this,e,d.e.Zero(),f)||this;return v.alpha=n,v.beta=r,v.radius=o,v._cartesianCoordinates=d.e.Zero(),v._meshTarget=u,v._follow(),v}return Object(p.d)(t,i),t.prototype._follow=function(){if(this._meshTarget){this._cartesianCoordinates.x=this.radius*Math.cos(this.alpha)*Math.cos(this.beta),this._cartesianCoordinates.y=this.radius*Math.sin(this.beta),this._cartesianCoordinates.z=this.radius*Math.sin(this.alpha)*Math.cos(this.beta);var e=this._meshTarget.getAbsolutePosition();this.position=e.add(this._cartesianCoordinates),this.setTarget(e)}},t.prototype._checkInputs=function(){i.prototype._checkInputs.call(this),this._follow()},t.prototype.getClassName=function(){return"ArcFollowCamera"},t}(ci),ds=c(38),Qn=c(39);(function(i){i[i.VIVE=0]="VIVE",i[i.OCULUS=1]="OCULUS",i[i.WINDOWS=2]="WINDOWS",i[i.GEAR_VR=3]="GEAR_VR",i[i.DAYDREAM=4]="DAYDREAM",i[i.GENERIC=5]="GENERIC"})(Zr||(Zr={}));var br,ki,ji=function(){function i(){}return i.InitiateController=function(t){for(var e=0,n=this._ControllerFactories;e<n.length;e++){var r=n[e];if(r.canCreate(t))return r.create(t)}if(this._DefaultControllerFactory)return this._DefaultControllerFactory(t);throw"The type of gamepad you are trying to load needs to be imported first or is not supported."},i._ControllerFactories=[],i._DefaultControllerFactory=null,i}(),we=function(i){function t(e){var n=i.call(this,e.id,e.index,e)||this;return n.isXR=!1,n._deviceRoomPosition=d.e.Zero(),n._deviceRoomRotationQuaternion=new d.b,n.devicePosition=d.e.Zero(),n.deviceRotationQuaternion=new d.b,n.deviceScaleFactor=1,n._trackPosition=!0,n._maxRotationDistFromHeadset=Math.PI/5,n._draggedRoomRotation=0,n._leftHandSystemQuaternion=new d.b,n._deviceToWorld=d.a.Identity(),n._pointingPoseNode=null,n._workingMatrix=d.a.Identity(),n._meshAttachedObservable=new S.c,n.type=Gn.POSE_ENABLED,n.controllerType=Zr.GENERIC,n.position=d.e.Zero(),n.rotationQuaternion=new d.b,n._calculatedPosition=d.e.Zero(),n._calculatedRotation=new d.b,d.b.RotationYawPitchRollToRef(Math.PI,0,0,n._leftHandSystemQuaternion),n}return Object(p.d)(t,i),t.prototype._disableTrackPosition=function(e){this._trackPosition&&(this._calculatedPosition.copyFrom(e),this._trackPosition=!1)},t.prototype.update=function(){i.prototype.update.call(this),this._updatePoseAndMesh()},t.prototype._updatePoseAndMesh=function(){if(!this.isXR){var e=this.browserGamepad.pose;if(this.updateFromDevice(e),!this._trackPosition&&ne.a.LastCreatedScene&&ne.a.LastCreatedScene.activeCamera&&ne.a.LastCreatedScene.activeCamera.devicePosition&&((n=ne.a.LastCreatedScene.activeCamera)._computeDevicePosition(),this._deviceToWorld.setTranslation(n.devicePosition),n.deviceRotationQuaternion)){var n;(n=n)._deviceRoomRotationQuaternion.toEulerAnglesToRef(d.c.Vector3[0]);var r=Math.atan2(Math.sin(d.c.Vector3[0].y-this._draggedRoomRotation),Math.cos(d.c.Vector3[0].y-this._draggedRoomRotation));if(Math.abs(r)>this._maxRotationDistFromHeadset){var o=r-(r<0?-this._maxRotationDistFromHeadset:this._maxRotationDistFromHeadset);this._draggedRoomRotation+=o;var u=Math.sin(-o),f=Math.cos(-o);this._calculatedPosition.x=this._calculatedPosition.x*f-this._calculatedPosition.z*u,this._calculatedPosition.z=this._calculatedPosition.x*u+this._calculatedPosition.z*f}}d.e.TransformCoordinatesToRef(this._calculatedPosition,this._deviceToWorld,this.devicePosition),this._deviceToWorld.getRotationMatrixToRef(this._workingMatrix),d.b.FromRotationMatrixToRef(this._workingMatrix,this.deviceRotationQuaternion),this.deviceRotationQuaternion.multiplyInPlace(this._calculatedRotation),this._mesh&&(this._mesh.position.copyFrom(this.devicePosition),this._mesh.rotationQuaternion&&this._mesh.rotationQuaternion.copyFrom(this.deviceRotationQuaternion))}},t.prototype.updateFromDevice=function(e){if(!this.isXR&&e){this.rawPose=e,e.position&&(this._deviceRoomPosition.copyFromFloats(e.position[0],e.position[1],-e.position[2]),this._mesh&&this._mesh.getScene().useRightHandedSystem&&(this._deviceRoomPosition.z*=-1),this._trackPosition&&this._deviceRoomPosition.scaleToRef(this.deviceScaleFactor,this._calculatedPosition),this._calculatedPosition.addInPlace(this.position));var n=this.rawPose;e.orientation&&n.orientation&&n.orientation.length===4&&(this._deviceRoomRotationQuaternion.copyFromFloats(n.orientation[0],n.orientation[1],-n.orientation[2],-n.orientation[3]),this._mesh&&(this._mesh.getScene().useRightHandedSystem?(this._deviceRoomRotationQuaternion.z*=-1,this._deviceRoomRotationQuaternion.w*=-1):this._deviceRoomRotationQuaternion.multiplyToRef(this._leftHandSystemQuaternion,this._deviceRoomRotationQuaternion)),this._deviceRoomRotationQuaternion.multiplyToRef(this.rotationQuaternion,this._calculatedRotation))}},t.prototype.attachToMesh=function(e){if(this._mesh&&(this._mesh.parent=null),this._mesh=e,this._poseControlledCamera&&(this._mesh.parent=this._poseControlledCamera),this._mesh.rotationQuaternion||(this._mesh.rotationQuaternion=new d.b),!this.isXR&&(this._updatePoseAndMesh(),this._pointingPoseNode)){for(var n=[],r=this._pointingPoseNode;r.parent;)n.push(r.parent),r=r.parent;n.reverse().forEach(function(o){o.computeWorldMatrix(!0)})}this._meshAttachedObservable.notifyObservers(e)},t.prototype.attachToPoseControlledCamera=function(e){this._poseControlledCamera=e,this._mesh&&(this._mesh.parent=this._poseControlledCamera)},t.prototype.dispose=function(){this._mesh&&this._mesh.dispose(),this._mesh=null,i.prototype.dispose.call(this)},Object.defineProperty(t.prototype,"mesh",{get:function(){return this._mesh},enumerable:!1,configurable:!0}),t.prototype.getForwardRay=function(e){if(e===void 0&&(e=100),!this.mesh)return new Qn.a(d.e.Zero(),new d.e(0,0,1),e);var n=this._pointingPoseNode?this._pointingPoseNode.getWorldMatrix():this.mesh.getWorldMatrix(),r=n.getTranslation(),o=new d.e(0,0,-1),u=d.e.TransformNormal(o,n),f=d.e.Normalize(u);return new Qn.a(r,f,e)},t.POINTING_POSE="POINTING_POSE",t}(Gn);(function(i){i[i.A=0]="A",i[i.B=1]="B",i[i.X=2]="X",i[i.Y=3]="Y",i[i.LB=4]="LB",i[i.RB=5]="RB",i[i.Back=8]="Back",i[i.Start=9]="Start",i[i.LeftStick=10]="LeftStick",i[i.RightStick=11]="RightStick"})(br||(br={})),function(i){i[i.Up=12]="Up",i[i.Down=13]="Down",i[i.Left=14]="Left",i[i.Right=15]="Right"}(ki||(ki={}));var ze,Je,xt=function(i){function t(e,n,r,o){o===void 0&&(o=!1);var u=i.call(this,e,n,r,0,1,2,3)||this;return u._leftTrigger=0,u._rightTrigger=0,u.onButtonDownObservable=new S.c,u.onButtonUpObservable=new S.c,u.onPadDownObservable=new S.c,u.onPadUpObservable=new S.c,u._buttonA=0,u._buttonB=0,u._buttonX=0,u._buttonY=0,u._buttonBack=0,u._buttonStart=0,u._buttonLB=0,u._buttonRB=0,u._buttonLeftStick=0,u._buttonRightStick=0,u._dPadUp=0,u._dPadDown=0,u._dPadLeft=0,u._dPadRight=0,u._isXboxOnePad=!1,u.type=Gn.XBOX,u._isXboxOnePad=o,u}return Object(p.d)(t,i),t.prototype.onlefttriggerchanged=function(e){this._onlefttriggerchanged=e},t.prototype.onrighttriggerchanged=function(e){this._onrighttriggerchanged=e},Object.defineProperty(t.prototype,"leftTrigger",{get:function(){return this._leftTrigger},set:function(e){this._onlefttriggerchanged&&this._leftTrigger!==e&&this._onlefttriggerchanged(e),this._leftTrigger=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rightTrigger",{get:function(){return this._rightTrigger},set:function(e){this._onrighttriggerchanged&&this._rightTrigger!==e&&this._onrighttriggerchanged(e),this._rightTrigger=e},enumerable:!1,configurable:!0}),t.prototype.onbuttondown=function(e){this._onbuttondown=e},t.prototype.onbuttonup=function(e){this._onbuttonup=e},t.prototype.ondpaddown=function(e){this._ondpaddown=e},t.prototype.ondpadup=function(e){this._ondpadup=e},t.prototype._setButtonValue=function(e,n,r){return e!==n&&(e===1&&(this._onbuttondown&&this._onbuttondown(r),this.onButtonDownObservable.notifyObservers(r)),e===0&&(this._onbuttonup&&this._onbuttonup(r),this.onButtonUpObservable.notifyObservers(r))),e},t.prototype._setDPadValue=function(e,n,r){return e!==n&&(e===1&&(this._ondpaddown&&this._ondpaddown(r),this.onPadDownObservable.notifyObservers(r)),e===0&&(this._ondpadup&&this._ondpadup(r),this.onPadUpObservable.notifyObservers(r))),e},Object.defineProperty(t.prototype,"buttonA",{get:function(){return this._buttonA},set:function(e){this._buttonA=this._setButtonValue(e,this._buttonA,br.A)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonB",{get:function(){return this._buttonB},set:function(e){this._buttonB=this._setButtonValue(e,this._buttonB,br.B)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonX",{get:function(){return this._buttonX},set:function(e){this._buttonX=this._setButtonValue(e,this._buttonX,br.X)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonY",{get:function(){return this._buttonY},set:function(e){this._buttonY=this._setButtonValue(e,this._buttonY,br.Y)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonStart",{get:function(){return this._buttonStart},set:function(e){this._buttonStart=this._setButtonValue(e,this._buttonStart,br.Start)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonBack",{get:function(){return this._buttonBack},set:function(e){this._buttonBack=this._setButtonValue(e,this._buttonBack,br.Back)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonLB",{get:function(){return this._buttonLB},set:function(e){this._buttonLB=this._setButtonValue(e,this._buttonLB,br.LB)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonRB",{get:function(){return this._buttonRB},set:function(e){this._buttonRB=this._setButtonValue(e,this._buttonRB,br.RB)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonLeftStick",{get:function(){return this._buttonLeftStick},set:function(e){this._buttonLeftStick=this._setButtonValue(e,this._buttonLeftStick,br.LeftStick)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonRightStick",{get:function(){return this._buttonRightStick},set:function(e){this._buttonRightStick=this._setButtonValue(e,this._buttonRightStick,br.RightStick)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dPadUp",{get:function(){return this._dPadUp},set:function(e){this._dPadUp=this._setDPadValue(e,this._dPadUp,ki.Up)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dPadDown",{get:function(){return this._dPadDown},set:function(e){this._dPadDown=this._setDPadValue(e,this._dPadDown,ki.Down)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dPadLeft",{get:function(){return this._dPadLeft},set:function(e){this._dPadLeft=this._setDPadValue(e,this._dPadLeft,ki.Left)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dPadRight",{get:function(){return this._dPadRight},set:function(e){this._dPadRight=this._setDPadValue(e,this._dPadRight,ki.Right)},enumerable:!1,configurable:!0}),t.prototype.update=function(){i.prototype.update.call(this),this._isXboxOnePad,this.buttonA=this.browserGamepad.buttons[0].value,this.buttonB=this.browserGamepad.buttons[1].value,this.buttonX=this.browserGamepad.buttons[2].value,this.buttonY=this.browserGamepad.buttons[3].value,this.buttonLB=this.browserGamepad.buttons[4].value,this.buttonRB=this.browserGamepad.buttons[5].value,this.leftTrigger=this.browserGamepad.buttons[6].value,this.rightTrigger=this.browserGamepad.buttons[7].value,this.buttonBack=this.browserGamepad.buttons[8].value,this.buttonStart=this.browserGamepad.buttons[9].value,this.buttonLeftStick=this.browserGamepad.buttons[10].value,this.buttonRightStick=this.browserGamepad.buttons[11].value,this.dPadUp=this.browserGamepad.buttons[12].value,this.dPadDown=this.browserGamepad.buttons[13].value,this.dPadLeft=this.browserGamepad.buttons[14].value,this.dPadRight=this.browserGamepad.buttons[15].value},t.prototype.dispose=function(){i.prototype.dispose.call(this),this.onButtonDownObservable.clear(),this.onButtonUpObservable.clear(),this.onPadDownObservable.clear(),this.onPadUpObservable.clear()},t}(Gn);(function(i){i[i.Cross=0]="Cross",i[i.Circle=1]="Circle",i[i.Square=2]="Square",i[i.Triangle=3]="Triangle",i[i.L1=4]="L1",i[i.R1=5]="R1",i[i.Share=8]="Share",i[i.Options=9]="Options",i[i.LeftStick=10]="LeftStick",i[i.RightStick=11]="RightStick"})(ze||(ze={})),function(i){i[i.Up=12]="Up",i[i.Down=13]="Down",i[i.Left=14]="Left",i[i.Right=15]="Right"}(Je||(Je={}));var tn=function(i){function t(e,n,r){var o=i.call(this,e.replace("STANDARD GAMEPAD","SONY PLAYSTATION DUALSHOCK"),n,r,0,1,2,3)||this;return o._leftTrigger=0,o._rightTrigger=0,o.onButtonDownObservable=new S.c,o.onButtonUpObservable=new S.c,o.onPadDownObservable=new S.c,o.onPadUpObservable=new S.c,o._buttonCross=0,o._buttonCircle=0,o._buttonSquare=0,o._buttonTriangle=0,o._buttonShare=0,o._buttonOptions=0,o._buttonL1=0,o._buttonR1=0,o._buttonLeftStick=0,o._buttonRightStick=0,o._dPadUp=0,o._dPadDown=0,o._dPadLeft=0,o._dPadRight=0,o.type=Gn.DUALSHOCK,o}return Object(p.d)(t,i),t.prototype.onlefttriggerchanged=function(e){this._onlefttriggerchanged=e},t.prototype.onrighttriggerchanged=function(e){this._onrighttriggerchanged=e},Object.defineProperty(t.prototype,"leftTrigger",{get:function(){return this._leftTrigger},set:function(e){this._onlefttriggerchanged&&this._leftTrigger!==e&&this._onlefttriggerchanged(e),this._leftTrigger=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rightTrigger",{get:function(){return this._rightTrigger},set:function(e){this._onrighttriggerchanged&&this._rightTrigger!==e&&this._onrighttriggerchanged(e),this._rightTrigger=e},enumerable:!1,configurable:!0}),t.prototype.onbuttondown=function(e){this._onbuttondown=e},t.prototype.onbuttonup=function(e){this._onbuttonup=e},t.prototype.ondpaddown=function(e){this._ondpaddown=e},t.prototype.ondpadup=function(e){this._ondpadup=e},t.prototype._setButtonValue=function(e,n,r){return e!==n&&(e===1&&(this._onbuttondown&&this._onbuttondown(r),this.onButtonDownObservable.notifyObservers(r)),e===0&&(this._onbuttonup&&this._onbuttonup(r),this.onButtonUpObservable.notifyObservers(r))),e},t.prototype._setDPadValue=function(e,n,r){return e!==n&&(e===1&&(this._ondpaddown&&this._ondpaddown(r),this.onPadDownObservable.notifyObservers(r)),e===0&&(this._ondpadup&&this._ondpadup(r),this.onPadUpObservable.notifyObservers(r))),e},Object.defineProperty(t.prototype,"buttonCross",{get:function(){return this._buttonCross},set:function(e){this._buttonCross=this._setButtonValue(e,this._buttonCross,ze.Cross)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonCircle",{get:function(){return this._buttonCircle},set:function(e){this._buttonCircle=this._setButtonValue(e,this._buttonCircle,ze.Circle)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonSquare",{get:function(){return this._buttonSquare},set:function(e){this._buttonSquare=this._setButtonValue(e,this._buttonSquare,ze.Square)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonTriangle",{get:function(){return this._buttonTriangle},set:function(e){this._buttonTriangle=this._setButtonValue(e,this._buttonTriangle,ze.Triangle)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonOptions",{get:function(){return this._buttonOptions},set:function(e){this._buttonOptions=this._setButtonValue(e,this._buttonOptions,ze.Options)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonShare",{get:function(){return this._buttonShare},set:function(e){this._buttonShare=this._setButtonValue(e,this._buttonShare,ze.Share)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonL1",{get:function(){return this._buttonL1},set:function(e){this._buttonL1=this._setButtonValue(e,this._buttonL1,ze.L1)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonR1",{get:function(){return this._buttonR1},set:function(e){this._buttonR1=this._setButtonValue(e,this._buttonR1,ze.R1)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonLeftStick",{get:function(){return this._buttonLeftStick},set:function(e){this._buttonLeftStick=this._setButtonValue(e,this._buttonLeftStick,ze.LeftStick)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonRightStick",{get:function(){return this._buttonRightStick},set:function(e){this._buttonRightStick=this._setButtonValue(e,this._buttonRightStick,ze.RightStick)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dPadUp",{get:function(){return this._dPadUp},set:function(e){this._dPadUp=this._setDPadValue(e,this._dPadUp,Je.Up)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dPadDown",{get:function(){return this._dPadDown},set:function(e){this._dPadDown=this._setDPadValue(e,this._dPadDown,Je.Down)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dPadLeft",{get:function(){return this._dPadLeft},set:function(e){this._dPadLeft=this._setDPadValue(e,this._dPadLeft,Je.Left)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dPadRight",{get:function(){return this._dPadRight},set:function(e){this._dPadRight=this._setDPadValue(e,this._dPadRight,Je.Right)},enumerable:!1,configurable:!0}),t.prototype.update=function(){i.prototype.update.call(this),this.buttonCross=this.browserGamepad.buttons[0].value,this.buttonCircle=this.browserGamepad.buttons[1].value,this.buttonSquare=this.browserGamepad.buttons[2].value,this.buttonTriangle=this.browserGamepad.buttons[3].value,this.buttonL1=this.browserGamepad.buttons[4].value,this.buttonR1=this.browserGamepad.buttons[5].value,this.leftTrigger=this.browserGamepad.buttons[6].value,this.rightTrigger=this.browserGamepad.buttons[7].value,this.buttonShare=this.browserGamepad.buttons[8].value,this.buttonOptions=this.browserGamepad.buttons[9].value,this.buttonLeftStick=this.browserGamepad.buttons[10].value,this.buttonRightStick=this.browserGamepad.buttons[11].value,this.dPadUp=this.browserGamepad.buttons[12].value,this.dPadDown=this.browserGamepad.buttons[13].value,this.dPadLeft=this.browserGamepad.buttons[14].value,this.dPadRight=this.browserGamepad.buttons[15].value},t.prototype.dispose=function(){i.prototype.dispose.call(this),this.onButtonDownObservable.clear(),this.onButtonUpObservable.clear(),this.onPadDownObservable.clear(),this.onPadUpObservable.clear()},t}(Gn),gn=function(){function i(t){var e=this;if(this._scene=t,this._babylonGamepads=[],this._oneGamepadConnected=!1,this._isMonitoring=!1,this.onGamepadDisconnectedObservable=new S.c,ds.a.IsWindowObjectExist()?(this._gamepadEventSupported="GamepadEvent"in window,this._gamepadSupport=navigator.getGamepads||navigator.webkitGetGamepads||navigator.msGetGamepads||navigator.webkitGamepads):this._gamepadEventSupported=!1,this.onGamepadConnectedObservable=new S.c(function(r){for(var o in e._babylonGamepads){var u=e._babylonGamepads[o];u&&u._isConnected&&e.onGamepadConnectedObservable.notifyObserver(r,u)}}),this._onGamepadConnectedEvent=function(r){var o,u=r.gamepad;u.index in e._babylonGamepads&&e._babylonGamepads[u.index].isConnected||(e._babylonGamepads[u.index]?((o=e._babylonGamepads[u.index]).browserGamepad=u,o._isConnected=!0):o=e._addNewGamepad(u),e.onGamepadConnectedObservable.notifyObservers(o),e._startMonitoringGamepads())},this._onGamepadDisconnectedEvent=function(r){var o=r.gamepad;for(var u in e._babylonGamepads)if(e._babylonGamepads[u].index===o.index){var f=e._babylonGamepads[u];f._isConnected=!1,e.onGamepadDisconnectedObservable.notifyObservers(f),f.dispose&&f.dispose();break}},this._gamepadSupport)if(this._updateGamepadObjects(),this._babylonGamepads.length&&this._startMonitoringGamepads(),this._gamepadEventSupported){var n=this._scene?this._scene.getEngine().getHostWindow():window;n&&(n.addEventListener("gamepadconnected",this._onGamepadConnectedEvent,!1),n.addEventListener("gamepaddisconnected",this._onGamepadDisconnectedEvent,!1))}else this._startMonitoringGamepads()}return Object.defineProperty(i.prototype,"gamepads",{get:function(){return this._babylonGamepads},enumerable:!1,configurable:!0}),i.prototype.getGamepadByType=function(t){t===void 0&&(t=Gn.XBOX);for(var e=0,n=this._babylonGamepads;e<n.length;e++){var r=n[e];if(r&&r.type===t)return r}return null},i.prototype.dispose=function(){this._gamepadEventSupported&&(this._onGamepadConnectedEvent&&window.removeEventListener("gamepadconnected",this._onGamepadConnectedEvent),this._onGamepadDisconnectedEvent&&window.removeEventListener("gamepaddisconnected",this._onGamepadDisconnectedEvent),this._onGamepadConnectedEvent=null,this._onGamepadDisconnectedEvent=null),this._babylonGamepads.forEach(function(t){t.dispose()}),this.onGamepadConnectedObservable.clear(),this.onGamepadDisconnectedObservable.clear(),this._oneGamepadConnected=!1,this._stopMonitoringGamepads(),this._babylonGamepads=[]},i.prototype._addNewGamepad=function(t){var e;this._oneGamepadConnected||(this._oneGamepadConnected=!0);var n=t.id.search("054c")!==-1,r=t.id.search("Xbox One")!==-1;return e=r||t.id.search("Xbox 360")!==-1||t.id.search("xinput")!==-1?new xt(t.id,t.index,t,r):n?new tn(t.id,t.index,t):t.pose?ji.InitiateController(t):new Ku(t.id,t.index,t),this._babylonGamepads[e.index]=e,e},i.prototype._startMonitoringGamepads=function(){this._isMonitoring||(this._isMonitoring=!0,this._scene||this._checkGamepadsStatus())},i.prototype._stopMonitoringGamepads=function(){this._isMonitoring=!1},i.prototype._checkGamepadsStatus=function(){var t=this;for(var e in this._updateGamepadObjects(),this._babylonGamepads){var n=this._babylonGamepads[e];n&&n.isConnected&&n.update()}this._isMonitoring&&!this._scene&&Ge.a.QueueNewFrame(function(){t._checkGamepadsStatus()})},i.prototype._updateGamepadObjects=function(){for(var t=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[],e=0;e<t.length;e++){var n=t[e];if(n)if(this._babylonGamepads[n.index])this._babylonGamepads[e].browserGamepad=n,this._babylonGamepads[e].isConnected||(this._babylonGamepads[e]._isConnected=!0,this.onGamepadConnectedObservable.notifyObservers(this._babylonGamepads[e]));else{var r=this._addNewGamepad(n);this.onGamepadConnectedObservable.notifyObservers(r)}}},i}();Object.defineProperty(he.a.prototype,"gamepadManager",{get:function(){if(!this._gamepadManager){this._gamepadManager=new gn(this);var i=this._getComponent(dt.a.NAME_GAMEPAD);i||(i=new Mn(this),this._addComponent(i))}return this._gamepadManager},enumerable:!0,configurable:!0}),Ca.prototype.addGamepad=function(){return this.add(new Ra),this},ls.prototype.addGamepad=function(){return this.add(new Bc),this};var Mn=function(){function i(t){this.name=dt.a.NAME_GAMEPAD,this.scene=t}return i.prototype.register=function(){this.scene._beforeCameraUpdateStage.registerStep(dt.a.STEP_BEFORECAMERAUPDATE_GAMEPAD,this,this._beforeCameraUpdate)},i.prototype.rebuild=function(){},i.prototype.dispose=function(){var t=this.scene._gamepadManager;t&&(t.dispose(),this.scene._gamepadManager=null)},i.prototype._beforeCameraUpdate=function(){var t=this.scene._gamepadManager;t&&t._isMonitoring&&t._checkGamepadsStatus()},i}();$.a.AddNodeConstructor("FreeCamera",function(i,t){return function(){return new Xt(i,d.e.Zero(),t)}});var Xt=function(i){function t(e,n,r){var o=i.call(this,e,n,r)||this;return o.inputs.addGamepad(),o}return Object(p.d)(t,i),Object.defineProperty(t.prototype,"gamepadAngularSensibility",{get:function(){var e=this.inputs.attached.gamepad;return e?e.gamepadAngularSensibility:0},set:function(e){var n=this.inputs.attached.gamepad;n&&(n.gamepadAngularSensibility=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"gamepadMoveSensibility",{get:function(){var e=this.inputs.attached.gamepad;return e?e.gamepadMoveSensibility:0},set:function(e){var n=this.inputs.attached.gamepad;n&&(n.gamepadMoveSensibility=e)},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"UniversalCamera"},t}(Qc);Pt.a._createDefaultParsedCamera=function(i,t){return new Xt(i,d.e.Zero(),t)},$.a.AddNodeConstructor("GamepadCamera",function(i,t){return function(){return new Tn(i,d.e.Zero(),t)}});var Tn=function(i){function t(e,n,r){return i.call(this,e,n,r)||this}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"GamepadCamera"},t}(Xt),Hn=c(33),Ye=c(5),Oa=`
attribute vec2 position;
uniform vec2 scale;

varying vec2 vUV;
const vec2 madd=vec2(0.5,0.5);
void main(void) {
vUV=(position*madd+madd)*scale;
gl_Position=vec4(position,0.0,1.0);
}`;Ye.a.ShadersStore.postprocessVertexShader=Oa;var fs=c(102);en.a.prototype.createRenderTargetTexture=function(i,t){var e=new fs.a;t!==void 0&&typeof t=="object"?(e.generateMipMaps=t.generateMipMaps,e.generateDepthBuffer=!!t.generateDepthBuffer,e.generateStencilBuffer=!!t.generateStencilBuffer,e.type=t.type===void 0?g.a.TEXTURETYPE_UNSIGNED_INT:t.type,e.samplingMode=t.samplingMode===void 0?g.a.TEXTURE_TRILINEAR_SAMPLINGMODE:t.samplingMode,e.format=t.format===void 0?g.a.TEXTUREFORMAT_RGBA:t.format):(e.generateMipMaps=t,e.generateDepthBuffer=!0,e.generateStencilBuffer=!1,e.type=g.a.TEXTURETYPE_UNSIGNED_INT,e.samplingMode=g.a.TEXTURE_TRILINEAR_SAMPLINGMODE,e.format=g.a.TEXTUREFORMAT_RGBA),(e.type!==g.a.TEXTURETYPE_FLOAT||this._caps.textureFloatLinearFiltering)&&(e.type!==g.a.TEXTURETYPE_HALF_FLOAT||this._caps.textureHalfFloatLinearFiltering)||(e.samplingMode=g.a.TEXTURE_NEAREST_SAMPLINGMODE),e.type!==g.a.TEXTURETYPE_FLOAT||this._caps.textureFloat||(e.type=g.a.TEXTURETYPE_UNSIGNED_INT,_.a.Warn("Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type"));var n=this._gl,r=new Nt.a(this,Nt.b.RenderTarget),o=i.width||i,u=i.height||i,f=i.layers||0,v=this._getSamplingParameters(e.samplingMode,!!e.generateMipMaps),y=f!==0?n.TEXTURE_2D_ARRAY:n.TEXTURE_2D,D=this._getRGBABufferInternalSizedFormat(e.type,e.format),w=this._getInternalFormat(e.format),F=this._getWebGLTextureType(e.type);this._bindTextureDirectly(y,r),f!==0?(r.is2DArray=!0,n.texImage3D(y,0,D,o,u,f,0,w,F,null)):n.texImage2D(y,0,D,o,u,0,w,F,null),n.texParameteri(y,n.TEXTURE_MAG_FILTER,v.mag),n.texParameteri(y,n.TEXTURE_MIN_FILTER,v.min),n.texParameteri(y,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(y,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),e.generateMipMaps&&this._gl.generateMipmap(y),this._bindTextureDirectly(y,null);var z=this._currentFramebuffer,k=n.createFramebuffer();return this._bindUnboundFramebuffer(k),r._depthStencilBuffer=this._setupFramebufferDepthAttachments(!!e.generateStencilBuffer,e.generateDepthBuffer,o,u),r.is2DArray||n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,r._webGLTexture,0),this._bindUnboundFramebuffer(z),r._framebuffer=k,r.baseWidth=o,r.baseHeight=u,r.width=o,r.height=u,r.depth=f,r.isReady=!0,r.samples=1,r.generateMipMaps=!!e.generateMipMaps,r.samplingMode=e.samplingMode,r.type=e.type,r.format=e.format,r._generateDepthBuffer=e.generateDepthBuffer,r._generateStencilBuffer=!!e.generateStencilBuffer,this._internalTexturesCache.push(r),r},en.a.prototype.createDepthStencilTexture=function(i,t){if(t.isCube){var e=i.width||i;return this._createDepthStencilCubeTexture(e,t)}return this._createDepthStencilTexture(i,t)},en.a.prototype._createDepthStencilTexture=function(i,t){var e=this._gl,n=i.layers||0,r=n!==0?e.TEXTURE_2D_ARRAY:e.TEXTURE_2D,o=new Nt.a(this,Nt.b.Depth);if(!this._caps.depthTextureExtension)return _.a.Error("Depth texture is not supported by your browser or hardware."),o;var u=Object(p.a)({bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1},t);this._bindTextureDirectly(r,o,!0),this._setupDepthStencilTexture(o,i,u.generateStencil,u.bilinearFiltering,u.comparisonFunction);var f=u.generateStencil?e.UNSIGNED_INT_24_8:e.UNSIGNED_INT,v=u.generateStencil?e.DEPTH_STENCIL:e.DEPTH_COMPONENT,y=v;return this.webGLVersion>1&&(y=u.generateStencil?e.DEPTH24_STENCIL8:e.DEPTH_COMPONENT24),o.is2DArray?e.texImage3D(r,0,y,o.width,o.height,n,0,v,f,null):e.texImage2D(r,0,y,o.width,o.height,0,v,f,null),this._bindTextureDirectly(r,null),o};var St=function(){function i(t,e,n,r,o,u,f,v,y,D,w,F,z,k,K){f===void 0&&(f=g.a.TEXTURE_NEAREST_SAMPLINGMODE),D===void 0&&(D=null),w===void 0&&(w=g.a.TEXTURETYPE_UNSIGNED_INT),F===void 0&&(F="postprocess"),k===void 0&&(k=!1),K===void 0&&(K=g.a.TEXTUREFORMAT_RGBA),this.width=-1,this.height=-1,this.nodeMaterialSource=null,this._outputTexture=null,this.autoClear=!0,this.alphaMode=g.a.ALPHA_DISABLE,this.animations=new Array,this.enablePixelPerfectMode=!1,this.forceFullscreenViewport=!0,this.scaleMode=g.a.SCALEMODE_FLOOR,this.alwaysForcePOT=!1,this._samples=1,this.adaptScaleToCurrentViewport=!1,this._reusable=!1,this._textures=new Hn.a(2),this._currentRenderTextureInd=0,this._scaleRatio=new d.d(1,1),this._texelSize=d.d.Zero(),this.onActivateObservable=new S.c,this.onSizeChangedObservable=new S.c,this.onApplyObservable=new S.c,this.onBeforeRenderObservable=new S.c,this.onAfterRenderObservable=new S.c,this.name=t,u!=null?(this._camera=u,this._scene=u.getScene(),u.attachPostProcess(this),this._engine=this._scene.getEngine(),this._scene.postProcesses.push(this),this.uniqueId=this._scene.getUniqueId()):v&&(this._engine=v,this._engine.postProcesses.push(this)),this._options=o,this.renderTargetSamplingMode=f||g.a.TEXTURE_NEAREST_SAMPLINGMODE,this._reusable=y||!1,this._textureType=w,this._textureFormat=K,this._samplers=r||[],this._samplers.push("textureSampler"),this._fragmentUrl=e,this._vertexUrl=F,this._parameters=n||[],this._parameters.push("scale"),this._indexParameters=z,k||this.updateEffect(D)}return Object.defineProperty(i.prototype,"samples",{get:function(){return this._samples},set:function(t){var e=this;this._samples=Math.min(t,this._engine.getCaps().maxMSAASamples),this._textures.forEach(function(n){n.samples!==e._samples&&e._engine.updateRenderTargetTextureSampleCount(n,e._samples)})},enumerable:!1,configurable:!0}),i.prototype.getEffectName=function(){return this._fragmentUrl},Object.defineProperty(i.prototype,"onActivate",{set:function(t){this._onActivateObserver&&this.onActivateObservable.remove(this._onActivateObserver),t&&(this._onActivateObserver=this.onActivateObservable.add(t))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"onSizeChanged",{set:function(t){this._onSizeChangedObserver&&this.onSizeChangedObservable.remove(this._onSizeChangedObserver),this._onSizeChangedObserver=this.onSizeChangedObservable.add(t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"onApply",{set:function(t){this._onApplyObserver&&this.onApplyObservable.remove(this._onApplyObserver),this._onApplyObserver=this.onApplyObservable.add(t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"onBeforeRender",{set:function(t){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"onAfterRender",{set:function(t){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"inputTexture",{get:function(){return this._textures.data[this._currentRenderTextureInd]},set:function(t){this._forcedOutputTexture=t},enumerable:!1,configurable:!0}),i.prototype.restoreDefaultInputTexture=function(){this._forcedOutputTexture=null},i.prototype.getCamera=function(){return this._camera},Object.defineProperty(i.prototype,"texelSize",{get:function(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.texelSize:(this._forcedOutputTexture&&this._texelSize.copyFromFloats(1/this._forcedOutputTexture.width,1/this._forcedOutputTexture.height),this._texelSize)},enumerable:!1,configurable:!0}),i.prototype.getClassName=function(){return"PostProcess"},i.prototype.getEngine=function(){return this._engine},i.prototype.getEffect=function(){return this._effect},i.prototype.shareOutputWith=function(t){return this._disposeTextures(),this._shareOutputWithPostProcess=t,this},i.prototype.useOwnOutput=function(){this._textures.length==0&&(this._textures=new Hn.a(2)),this._shareOutputWithPostProcess=null},i.prototype.updateEffect=function(t,e,n,r,o,u,f,v){t===void 0&&(t=null),e===void 0&&(e=null),n===void 0&&(n=null),this._effect=this._engine.createEffect({vertex:f??this._vertexUrl,fragment:v??this._fragmentUrl},["position"],e||this._parameters,n||this._samplers,t!==null?t:"",void 0,o,u,r||this._indexParameters)},i.prototype.isReusable=function(){return this._reusable},i.prototype.markTextureDirty=function(){this.width=-1},i.prototype.activate=function(t,e,n){var r=this;e===void 0&&(e=null);var o=(t=t||this._camera).getScene(),u=o.getEngine(),f=u.getCaps().maxTextureSize,v=(e?e.width:this._engine.getRenderWidth(!0))*this._options|0,y=(e?e.height:this._engine.getRenderHeight(!0))*this._options|0,D=t.parent;!D||D.leftCamera!=t&&D.rightCamera!=t||(v/=2);var w,F=this._options.width||v,z=this._options.height||y,k=this.renderTargetSamplingMode!==g.a.TEXTURE_NEAREST_LINEAR&&this.renderTargetSamplingMode!==g.a.TEXTURE_NEAREST_NEAREST&&this.renderTargetSamplingMode!==g.a.TEXTURE_LINEAR_LINEAR;if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(this.adaptScaleToCurrentViewport){var K=u.currentViewport;K&&(F*=K.width,z*=K.height)}if((k||this.alwaysForcePOT)&&(this._options.width||(F=u.needPOTTextures?Ge.a.GetExponentOfTwo(F,f,this.scaleMode):F),this._options.height||(z=u.needPOTTextures?Ge.a.GetExponentOfTwo(z,f,this.scaleMode):z)),this.width!==F||this.height!==z){if(this._textures.length>0){for(var oe=0;oe<this._textures.length;oe++)this._engine._releaseTexture(this._textures.data[oe]);this._textures.reset()}this.width=F,this.height=z;var ae={width:this.width,height:this.height},ue={generateMipMaps:k,generateDepthBuffer:n||t._postProcesses.indexOf(this)===0,generateStencilBuffer:(n||t._postProcesses.indexOf(this)===0)&&this._engine.isStencilEnable,samplingMode:this.renderTargetSamplingMode,type:this._textureType,format:this._textureFormat};this._textures.push(this._engine.createRenderTargetTexture(ae,ue)),this._reusable&&this._textures.push(this._engine.createRenderTargetTexture(ae,ue)),this._texelSize.copyFromFloats(1/this.width,1/this.height),this.onSizeChangedObservable.notifyObservers(this)}this._textures.forEach(function(de){de.samples!==r.samples&&r._engine.updateRenderTargetTextureSampleCount(de,r.samples)})}return this._shareOutputWithPostProcess?w=this._shareOutputWithPostProcess.inputTexture:this._forcedOutputTexture?(w=this._forcedOutputTexture,this.width=this._forcedOutputTexture.width,this.height=this._forcedOutputTexture.height):w=this.inputTexture,this.enablePixelPerfectMode?(this._scaleRatio.copyFromFloats(v/F,y/z),this._engine.bindFramebuffer(w,0,v,y,this.forceFullscreenViewport)):(this._scaleRatio.copyFromFloats(1,1),this._engine.bindFramebuffer(w,0,void 0,void 0,this.forceFullscreenViewport)),this.onActivateObservable.notifyObservers(t),this.autoClear&&this.alphaMode===g.a.ALPHA_DISABLE&&this._engine.clear(this.clearColor?this.clearColor:o.clearColor,o._allowPostProcessClearColor,!0,!0),this._reusable&&(this._currentRenderTextureInd=(this._currentRenderTextureInd+1)%2),w},Object.defineProperty(i.prototype,"isSupported",{get:function(){return this._effect.isSupported},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"aspectRatio",{get:function(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.aspectRatio:this._forcedOutputTexture?this._forcedOutputTexture.width/this._forcedOutputTexture.height:this.width/this.height},enumerable:!1,configurable:!0}),i.prototype.isReady=function(){return this._effect&&this._effect.isReady()},i.prototype.apply=function(){return this._effect&&this._effect.isReady()?(this._engine.enableEffect(this._effect),this._engine.setState(!1),this._engine.setDepthBuffer(!1),this._engine.setDepthWrite(!1),this._engine.setAlphaMode(this.alphaMode),this.alphaConstants&&this.getEngine().setAlphaConstants(this.alphaConstants.r,this.alphaConstants.g,this.alphaConstants.b,this.alphaConstants.a),t=this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.inputTexture:this._forcedOutputTexture?this._forcedOutputTexture:this.inputTexture,this._effect._bindTexture("textureSampler",t),this._effect.setVector2("scale",this._scaleRatio),this.onApplyObservable.notifyObservers(this._effect),this._effect):null;var t},i.prototype._disposeTextures=function(){if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(this._textures.length>0)for(var t=0;t<this._textures.length;t++)this._engine._releaseTexture(this._textures.data[t]);this._textures.dispose()}},i.prototype.setPrePassRenderer=function(t){return!!this._prePassEffectConfiguration&&(this._prePassEffectConfiguration=t.addEffectConfiguration(this._prePassEffectConfiguration),this._prePassEffectConfiguration.enabled=!0,!0)},i.prototype.dispose=function(t){var e;if(t=t||this._camera,this._disposeTextures(),this._scene&&(e=this._scene.postProcesses.indexOf(this))!==-1&&this._scene.postProcesses.splice(e,1),(e=this._engine.postProcesses.indexOf(this))!==-1&&this._engine.postProcesses.splice(e,1),t){if(t.detachPostProcess(this),(e=t._postProcesses.indexOf(this))===0&&t._postProcesses.length>0){var n=this._camera._getFirstPostProcess();n&&n.markTextureDirty()}this.onActivateObservable.clear(),this.onAfterRenderObservable.clear(),this.onApplyObservable.clear(),this.onBeforeRenderObservable.clear(),this.onSizeChangedObservable.clear()}},i.prototype.serialize=function(){var t=B.a.Serialize(this);return t.customType="BABYLON."+this.getClassName(),t.cameraId=this.getCamera().id,t.reusable=this._reusable,t.options=this._options,t.textureType=this._textureType,t},i.Parse=function(t,e,n){var r=C.a.GetClass(t.customType);if(!r||!r._Parse)return null;var o=e.getCameraByID(t.cameraId);return o?r._Parse(t,o,e,n):null},Object(p.c)([Object(B.c)()],i.prototype,"uniqueId",void 0),Object(p.c)([Object(B.c)()],i.prototype,"name",void 0),Object(p.c)([Object(B.c)()],i.prototype,"width",void 0),Object(p.c)([Object(B.c)()],i.prototype,"height",void 0),Object(p.c)([Object(B.c)()],i.prototype,"renderTargetSamplingMode",void 0),Object(p.c)([Object(B.f)()],i.prototype,"clearColor",void 0),Object(p.c)([Object(B.c)()],i.prototype,"autoClear",void 0),Object(p.c)([Object(B.c)()],i.prototype,"alphaMode",void 0),Object(p.c)([Object(B.c)()],i.prototype,"alphaConstants",void 0),Object(p.c)([Object(B.c)()],i.prototype,"enablePixelPerfectMode",void 0),Object(p.c)([Object(B.c)()],i.prototype,"forceFullscreenViewport",void 0),Object(p.c)([Object(B.c)()],i.prototype,"scaleMode",void 0),Object(p.c)([Object(B.c)()],i.prototype,"alwaysForcePOT",void 0),Object(p.c)([Object(B.c)("samples")],i.prototype,"_samples",void 0),Object(p.c)([Object(B.c)()],i.prototype,"adaptScaleToCurrentViewport",void 0),i}();C.a.RegisteredTypes["BABYLON.PostProcess"]=St;var $u=`
varying vec2 vUV;
uniform sampler2D textureSampler;
void main(void)
{
gl_FragColor=texture2D(textureSampler,vUV);
}`;Ye.a.ShadersStore.passPixelShader=$u;var dI=`
varying vec2 vUV;
uniform samplerCube textureSampler;
void main(void)
{
vec2 uv=vUV*2.0-1.0;
#ifdef POSITIVEX
gl_FragColor=textureCube(textureSampler,vec3(1.001,uv.y,uv.x));
#endif
#ifdef NEGATIVEX
gl_FragColor=textureCube(textureSampler,vec3(-1.001,uv.y,uv.x));
#endif
#ifdef POSITIVEY
gl_FragColor=textureCube(textureSampler,vec3(uv.y,1.001,uv.x));
#endif
#ifdef NEGATIVEY
gl_FragColor=textureCube(textureSampler,vec3(uv.y,-1.001,uv.x));
#endif
#ifdef POSITIVEZ
gl_FragColor=textureCube(textureSampler,vec3(uv,1.001));
#endif
#ifdef NEGATIVEZ
gl_FragColor=textureCube(textureSampler,vec3(uv,-1.001));
#endif
}`;Ye.a.ShadersStore.passCubePixelShader=dI;var jo=function(i){function t(e,n,r,o,u,f,v,y){return r===void 0&&(r=null),v===void 0&&(v=g.a.TEXTURETYPE_UNSIGNED_INT),y===void 0&&(y=!1),i.call(this,e,"pass",null,null,n,r,o,u,f,void 0,v,void 0,null,y)||this}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"PassPostProcess"},t._Parse=function(e,n,r,o){return B.a.Parse(function(){return new t(e.name,e.options,n,e.renderTargetSamplingMode,r.getEngine(),e.reusable)},e,r,o)},t}(St);C.a.RegisteredTypes["BABYLON.PassPostProcess"]=jo;var fI=function(i){function t(e,n,r,o,u,f,v,y){r===void 0&&(r=null),v===void 0&&(v=g.a.TEXTURETYPE_UNSIGNED_INT),y===void 0&&(y=!1);var D=i.call(this,e,"passCube",null,null,n,r,o,u,f,"#define POSITIVEX",v,void 0,null,y)||this;return D._face=0,D}return Object(p.d)(t,i),Object.defineProperty(t.prototype,"face",{get:function(){return this._face},set:function(e){if(!(e<0||e>5))switch(this._face=e,this._face){case 0:this.updateEffect("#define POSITIVEX");break;case 1:this.updateEffect("#define NEGATIVEX");break;case 2:this.updateEffect("#define POSITIVEY");break;case 3:this.updateEffect("#define NEGATIVEY");break;case 4:this.updateEffect("#define POSITIVEZ");break;case 5:this.updateEffect("#define NEGATIVEZ")}},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"PassCubePostProcess"},t._Parse=function(e,n,r,o){return B.a.Parse(function(){return new t(e.name,e.options,n,e.renderTargetSamplingMode,r.getEngine(),e.reusable)},e,r,o)},t}(St);Ge.a._RescalePostProcessFactory=function(i){return new jo("rescale",1,null,g.a.TEXTURE_BILINEAR_SAMPLINGMODE,i,!1,g.a.TEXTURETYPE_UNSIGNED_INT)};var pI=`
varying vec2 vUV;
uniform sampler2D textureSampler;
uniform sampler2D leftSampler;
void main(void)
{
vec4 leftFrag=texture2D(leftSampler,vUV);
leftFrag=vec4(1.0,leftFrag.g,leftFrag.b,1.0);
vec4 rightFrag=texture2D(textureSampler,vUV);
rightFrag=vec4(rightFrag.r,1.0,1.0,1.0);
gl_FragColor=vec4(rightFrag.rgb*leftFrag.rgb,1.0);
}`;Ye.a.ShadersStore.anaglyphPixelShader=pI;var Rp=function(i){function t(e,n,r,o,u,f){var v=i.call(this,e,"anaglyph",null,["leftSampler"],n,r[1],o,u,f)||this;return v._passedProcess=r[0]._rigPostProcess,v.onApplyObservable.add(function(y){y.setTextureFromPostProcess("leftSampler",v._passedProcess)}),v}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"AnaglyphPostProcess"},t}(St);C.a.RegisteredTypes["BABYLON.AnaglyphPostProcess"]=Rp,Pt.a._setStereoscopicAnaglyphRigMode=function(i){i._rigCameras[0]._rigPostProcess=new jo(i.name+"_passthru",1,i._rigCameras[0]),i._rigCameras[1]._rigPostProcess=new Rp(i.name+"_anaglyph",1,i._rigCameras)},$.a.AddNodeConstructor("AnaglyphArcRotateCamera",function(i,t,e){return function(){return new vy(i,0,0,1,d.e.Zero(),e.interaxial_distance,t)}});var vy=function(i){function t(e,n,r,o,u,f,v){var y=i.call(this,e,n,r,o,u,v)||this;return y.interaxialDistance=f,y.setCameraRigMode(Pt.a.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:f}),y}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"AnaglyphArcRotateCamera"},t}(Vi);$.a.AddNodeConstructor("AnaglyphFreeCamera",function(i,t,e){return function(){return new by(i,d.e.Zero(),e.interaxial_distance,t)}});var by=function(i){function t(e,n,r,o){var u=i.call(this,e,n,o)||this;return u.interaxialDistance=r,u.setCameraRigMode(Pt.a.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:r}),u}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"AnaglyphFreeCamera"},t}(Cr);$.a.AddNodeConstructor("AnaglyphGamepadCamera",function(i,t,e){return function(){return new yy(i,d.e.Zero(),e.interaxial_distance,t)}});var yy=function(i){function t(e,n,r,o){var u=i.call(this,e,n,o)||this;return u.interaxialDistance=r,u.setCameraRigMode(Pt.a.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:r}),u}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"AnaglyphGamepadCamera"},t}(Tn);$.a.AddNodeConstructor("AnaglyphUniversalCamera",function(i,t,e){return function(){return new Ty(i,d.e.Zero(),e.interaxial_distance,t)}});var Ty=function(i){function t(e,n,r,o){var u=i.call(this,e,n,o)||this;return u.interaxialDistance=r,u.setCameraRigMode(Pt.a.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:r}),u}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"AnaglyphUniversalCamera"},t}(Xt),li=c(58);Pt.a._setStereoscopicRigMode=function(i){var t=i.cameraRigMode===Pt.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL||i.cameraRigMode===Pt.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED,e=i.cameraRigMode===Pt.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED;i._rigCameras[e?1:0].viewport=new li.a(0,0,t?.5:1,t?1:.5),i._rigCameras[e?0:1].viewport=new li.a(t?.5:0,t?0:.5,t?.5:1,t?1:.5)},$.a.AddNodeConstructor("StereoscopicArcRotateCamera",function(i,t,e){return function(){return new Ey(i,0,0,1,d.e.Zero(),e.interaxial_distance,e.isStereoscopicSideBySide,t)}});var Ey=function(i){function t(e,n,r,o,u,f,v,y){var D=i.call(this,e,n,r,o,u,y)||this;return D.interaxialDistance=f,D.isStereoscopicSideBySide=v,D.setCameraRigMode(v?Pt.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:Pt.a.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:f}),D}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"StereoscopicArcRotateCamera"},t}(Vi);$.a.AddNodeConstructor("StereoscopicFreeCamera",function(i,t,e){return function(){return new Sy(i,d.e.Zero(),e.interaxial_distance,e.isStereoscopicSideBySide,t)}});var Sy=function(i){function t(e,n,r,o,u){var f=i.call(this,e,n,u)||this;return f.interaxialDistance=r,f.isStereoscopicSideBySide=o,f.setCameraRigMode(o?Pt.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:Pt.a.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:r}),f}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"StereoscopicFreeCamera"},t}(Cr);$.a.AddNodeConstructor("StereoscopicGamepadCamera",function(i,t,e){return function(){return new xy(i,d.e.Zero(),e.interaxial_distance,e.isStereoscopicSideBySide,t)}});var xy=function(i){function t(e,n,r,o,u){var f=i.call(this,e,n,u)||this;return f.interaxialDistance=r,f.isStereoscopicSideBySide=o,f.setCameraRigMode(o?Pt.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:Pt.a.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:r}),f}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"StereoscopicGamepadCamera"},t}(Tn);$.a.AddNodeConstructor("StereoscopicFreeCamera",function(i,t,e){return function(){return new Ay(i,d.e.Zero(),e.interaxial_distance,e.isStereoscopicSideBySide,t)}});var Ay=function(i){function t(e,n,r,o,u){var f=i.call(this,e,n,u)||this;return f.interaxialDistance=r,f.isStereoscopicSideBySide=o,f.setCameraRigMode(o?Pt.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:Pt.a.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:r}),f}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"StereoscopicUniversalCamera"},t}(Xt);$.a.AddNodeConstructor("VirtualJoysticksCamera",function(i,t){return function(){return new Py(i,d.e.Zero(),t)}});var Py=function(i){function t(e,n,r){var o=i.call(this,e,n,r)||this;return o.inputs.addVirtualJoystick(),o}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"VirtualJoysticksCamera"},t}(Cr),ps=function(){function i(){this.compensateDistortion=!0,this.multiviewEnabled=!1}return Object.defineProperty(i.prototype,"aspectRatio",{get:function(){return this.hResolution/(2*this.vResolution)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"aspectRatioFov",{get:function(){return 2*Math.atan(this.postProcessScaleFactor*this.vScreenSize/(2*this.eyeToScreenDistance))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"leftHMatrix",{get:function(){var t=4*(this.hScreenSize/4-this.lensSeparationDistance/2)/this.hScreenSize;return d.a.Translation(t,0,0)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"rightHMatrix",{get:function(){var t=4*(this.hScreenSize/4-this.lensSeparationDistance/2)/this.hScreenSize;return d.a.Translation(-t,0,0)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"leftPreViewMatrix",{get:function(){return d.a.Translation(.5*this.interpupillaryDistance,0,0)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"rightPreViewMatrix",{get:function(){return d.a.Translation(-.5*this.interpupillaryDistance,0,0)},enumerable:!1,configurable:!0}),i.GetDefault=function(){var t=new i;return t.hResolution=1280,t.vResolution=800,t.hScreenSize=.149759993,t.vScreenSize=.0935999975,t.vScreenCenter=.0467999987,t.eyeToScreenDistance=.0410000011,t.lensSeparationDistance=.063500002,t.interpupillaryDistance=.064000003,t.distortionK=[1,.219999999,.239999995,0],t.chromaAbCorrection=[.995999992,-.00400000019,1.01400006,0],t.postProcessScaleFactor=1.714605507808412,t.lensCenterOffset=.151976421,t},i}(),mI=`
varying vec2 vUV;
uniform sampler2D textureSampler;
uniform vec2 LensCenter;
uniform vec2 Scale;
uniform vec2 ScaleIn;
uniform vec4 HmdWarpParam;
vec2 HmdWarp(vec2 in01) {
vec2 theta=(in01-LensCenter)*ScaleIn;
float rSq=theta.x*theta.x+theta.y*theta.y;
vec2 rvector=theta*(HmdWarpParam.x+HmdWarpParam.y*rSq+HmdWarpParam.z*rSq*rSq+HmdWarpParam.w*rSq*rSq*rSq);
return LensCenter+Scale*rvector;
}
void main(void)
{
vec2 tc=HmdWarp(vUV);
if (tc.x <0.0 || tc.x>1.0 || tc.y<0.0 || tc.y>1.0)
gl_FragColor=vec4(0.0,0.0,0.0,0.0);
else{
gl_FragColor=texture2D(textureSampler,tc);
}
}`;Ye.a.ShadersStore.vrDistortionCorrectionPixelShader=mI;var Op=function(i){function t(e,n,r,o){var u=i.call(this,e,"vrDistortionCorrection",["LensCenter","Scale","ScaleIn","HmdWarpParam"],null,o.postProcessScaleFactor,n,ke.a.BILINEAR_SAMPLINGMODE)||this;return u._isRightEye=r,u._distortionFactors=o.distortionK,u._postProcessScaleFactor=o.postProcessScaleFactor,u._lensCenterOffset=o.lensCenterOffset,u.adaptScaleToCurrentViewport=!0,u.onSizeChangedObservable.add(function(){u._scaleIn=new d.d(2,2/u.aspectRatio),u._scaleFactor=new d.d(1/u._postProcessScaleFactor*.5,1/u._postProcessScaleFactor*.5*u.aspectRatio),u._lensCenter=new d.d(u._isRightEye?.5-.5*u._lensCenterOffset:.5+.5*u._lensCenterOffset,.5)}),u.onApplyObservable.add(function(f){f.setFloat2("LensCenter",u._lensCenter.x,u._lensCenter.y),f.setFloat2("Scale",u._scaleFactor.x,u._scaleFactor.y),f.setFloat2("ScaleIn",u._scaleIn.x,u._scaleIn.y),f.setFloat4("HmdWarpParam",u._distortionFactors[0],u._distortionFactors[1],u._distortionFactors[2],u._distortionFactors[3])}),u}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"VRDistortionCorrectionPostProcess"},t}(St),_I=`precision mediump sampler2DArray;
varying vec2 vUV;
uniform sampler2DArray multiviewSampler;
uniform int imageIndex;
void main(void)
{
gl_FragColor=texture(multiviewSampler,vec3(vUV,imageIndex));
}`;Ye.a.ShadersStore.vrMultiviewToSingleviewPixelShader=_I;var Cy=c(85),Mp=c(95),$c=c(96);en.a.prototype.createRenderTargetCubeTexture=function(i,t){var e=Object(p.a)({generateMipMaps:!0,generateDepthBuffer:!0,generateStencilBuffer:!1,type:g.a.TEXTURETYPE_UNSIGNED_INT,samplingMode:g.a.TEXTURE_TRILINEAR_SAMPLINGMODE,format:g.a.TEXTUREFORMAT_RGBA},t);e.generateStencilBuffer=e.generateDepthBuffer&&e.generateStencilBuffer,(e.type!==g.a.TEXTURETYPE_FLOAT||this._caps.textureFloatLinearFiltering)&&(e.type!==g.a.TEXTURETYPE_HALF_FLOAT||this._caps.textureHalfFloatLinearFiltering)||(e.samplingMode=g.a.TEXTURE_NEAREST_SAMPLINGMODE);var n=this._gl,r=new Nt.a(this,Nt.b.RenderTarget);this._bindTextureDirectly(n.TEXTURE_CUBE_MAP,r,!0);var o=this._getSamplingParameters(e.samplingMode,e.generateMipMaps);e.type!==g.a.TEXTURETYPE_FLOAT||this._caps.textureFloat||(e.type=g.a.TEXTURETYPE_UNSIGNED_INT,_.a.Warn("Float textures are not supported. Cube render target forced to TEXTURETYPE_UNESIGNED_BYTE type")),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_MAG_FILTER,o.mag),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_MIN_FILTER,o.min),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE);for(var u=0;u<6;u++)n.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+u,0,this._getRGBABufferInternalSizedFormat(e.type,e.format),i,i,0,this._getInternalFormat(e.format),this._getWebGLTextureType(e.type),null);var f=n.createFramebuffer();return this._bindUnboundFramebuffer(f),r._depthStencilBuffer=this._setupFramebufferDepthAttachments(e.generateStencilBuffer,e.generateDepthBuffer,i,i),e.generateMipMaps&&n.generateMipmap(n.TEXTURE_CUBE_MAP),this._bindTextureDirectly(n.TEXTURE_CUBE_MAP,null),this._bindUnboundFramebuffer(null),r._framebuffer=f,r.width=i,r.height=i,r.isReady=!0,r.isCube=!0,r.samples=1,r.generateMipMaps=e.generateMipMaps,r.samplingMode=e.samplingMode,r.type=e.type,r.format=e.format,r._generateDepthBuffer=e.generateDepthBuffer,r._generateStencilBuffer=e.generateStencilBuffer,this._internalTexturesCache.push(r),r};var qn=function(i){function t(e,n,r,o,u,f,v,y,D,w,F,z,k){u===void 0&&(u=!0),f===void 0&&(f=g.a.TEXTURETYPE_UNSIGNED_INT),v===void 0&&(v=!1),y===void 0&&(y=ke.a.TRILINEAR_SAMPLINGMODE),D===void 0&&(D=!0),w===void 0&&(w=!1),F===void 0&&(F=!1),z===void 0&&(z=g.a.TEXTUREFORMAT_RGBA),k===void 0&&(k=!1);var K=i.call(this,null,r,!o)||this;return K.renderParticles=!0,K.renderSprites=!1,K.ignoreCameraViewport=!1,K.onBeforeBindObservable=new S.c,K.onAfterUnbindObservable=new S.c,K.onBeforeRenderObservable=new S.c,K.onAfterRenderObservable=new S.c,K.onClearObservable=new S.c,K.onResizeObservable=new S.c,K._currentRefreshId=-1,K._refreshRate=1,K._samples=1,K.boundingBoxPosition=d.e.Zero(),(r=K.getScene())&&(K._coordinatesMode=ke.a.PROJECTION_MODE,K.renderList=new Array,K.name=e,K.isRenderTarget=!0,K._initialSizeParameter=n,K._processSizeParameter(n),K._resizeObserver=K.getScene().getEngine().onResizeObservable.add(function(){}),K._generateMipMaps=!!o,K._doNotChangeAspectRatio=u,K._renderingManager=new $c.b(r),K._renderingManager._useSceneAutoClearSetup=!0,F||(K._renderTargetOptions={generateMipMaps:o,type:f,format:z,samplingMode:y,generateDepthBuffer:D,generateStencilBuffer:w},y===ke.a.NEAREST_SAMPLINGMODE&&(K.wrapU=ke.a.CLAMP_ADDRESSMODE,K.wrapV=ke.a.CLAMP_ADDRESSMODE),k||(v?(K._texture=r.getEngine().createRenderTargetCubeTexture(K.getRenderSize(),K._renderTargetOptions),K.coordinatesMode=ke.a.INVCUBIC_MODE,K._textureMatrix=d.a.Identity()):K._texture=r.getEngine().createRenderTargetTexture(K._size,K._renderTargetOptions)))),K}return Object(p.d)(t,i),Object.defineProperty(t.prototype,"renderList",{get:function(){return this._renderList},set:function(e){this._renderList=e,this._renderList&&this._hookArray(this._renderList)},enumerable:!1,configurable:!0}),t.prototype._hookArray=function(e){var n=this,r=e.push;e.push=function(){for(var u=[],f=0;f<arguments.length;f++)u[f]=arguments[f];var v=e.length===0,y=r.apply(e,u);return v&&n.getScene()&&n.getScene().meshes.forEach(function(D){D._markSubMeshesAsLightDirty()}),y};var o=e.splice;e.splice=function(u,f){var v=o.apply(e,[u,f]);return e.length===0&&n.getScene().meshes.forEach(function(y){y._markSubMeshesAsLightDirty()}),v}},Object.defineProperty(t.prototype,"onAfterUnbind",{set:function(e){this._onAfterUnbindObserver&&this.onAfterUnbindObservable.remove(this._onAfterUnbindObserver),this._onAfterUnbindObserver=this.onAfterUnbindObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onBeforeRender",{set:function(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onAfterRender",{set:function(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onClear",{set:function(e){this._onClearObserver&&this.onClearObservable.remove(this._onClearObserver),this._onClearObserver=this.onClearObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"renderTargetOptions",{get:function(){return this._renderTargetOptions},enumerable:!1,configurable:!0}),t.prototype._onRatioRescale=function(){this._sizeRatio&&this.resize(this._initialSizeParameter)},Object.defineProperty(t.prototype,"boundingBoxSize",{get:function(){return this._boundingBoxSize},set:function(e){if(!this._boundingBoxSize||!this._boundingBoxSize.equals(e)){this._boundingBoxSize=e;var n=this.getScene();n&&n.markAllMaterialsAsDirty(g.a.MATERIAL_TextureDirtyFlag)}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"depthStencilTexture",{get:function(){var e;return((e=this.getInternalTexture())===null||e===void 0?void 0:e._depthStencilTexture)||null},enumerable:!1,configurable:!0}),t.prototype.createDepthStencilTexture=function(e,n,r){e===void 0&&(e=0),n===void 0&&(n=!0),r===void 0&&(r=!1);var o=this.getInternalTexture();if(this.getScene()&&o){var u=this.getScene().getEngine();o._depthStencilTexture=u.createDepthStencilTexture(this._size,{bilinearFiltering:n,comparisonFunction:e,generateStencil:r,isCube:this.isCube})}},t.prototype._processSizeParameter=function(e){if(e.ratio){this._sizeRatio=e.ratio;var n=this._getEngine();this._size={width:this._bestReflectionRenderTargetDimension(n.getRenderWidth(),this._sizeRatio),height:this._bestReflectionRenderTargetDimension(n.getRenderHeight(),this._sizeRatio)}}else this._size=e},Object.defineProperty(t.prototype,"samples",{get:function(){return this._samples},set:function(e){if(this._samples!==e){var n=this.getScene();n&&(this._samples=n.getEngine().updateRenderTargetTextureSampleCount(this._texture,e))}},enumerable:!1,configurable:!0}),t.prototype.resetRefreshCounter=function(){this._currentRefreshId=-1},Object.defineProperty(t.prototype,"refreshRate",{get:function(){return this._refreshRate},set:function(e){this._refreshRate=e,this.resetRefreshCounter()},enumerable:!1,configurable:!0}),t.prototype.addPostProcess=function(e){if(!this._postProcessManager){var n=this.getScene();if(!n)return;this._postProcessManager=new Mp.a(n),this._postProcesses=new Array}this._postProcesses.push(e),this._postProcesses[0].autoClear=!1},t.prototype.clearPostProcesses=function(e){if(e===void 0&&(e=!1),this._postProcesses){if(e)for(var n=0,r=this._postProcesses;n<r.length;n++)r[n].dispose();this._postProcesses=[]}},t.prototype.removePostProcess=function(e){if(this._postProcesses){var n=this._postProcesses.indexOf(e);n!==-1&&(this._postProcesses.splice(n,1),this._postProcesses.length>0&&(this._postProcesses[0].autoClear=!1))}},t.prototype._shouldRender=function(){return this._currentRefreshId===-1||this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)},t.prototype.getRenderSize=function(){return this.getRenderWidth()},t.prototype.getRenderWidth=function(){return this._size.width?this._size.width:this._size},t.prototype.getRenderHeight=function(){return this._size.width?this._size.height:this._size},t.prototype.getRenderLayers=function(){var e=this._size.layers;return e||0},Object.defineProperty(t.prototype,"canRescale",{get:function(){return!0},enumerable:!1,configurable:!0}),t.prototype.scale=function(e){var n=Math.max(1,this.getRenderSize()*e);this.resize(n)},t.prototype.getReflectionTextureMatrix=function(){return this.isCube?this._textureMatrix:i.prototype.getReflectionTextureMatrix.call(this)},t.prototype.resize=function(e){var n=this.isCube;this.releaseInternalTexture();var r=this.getScene();r&&(this._processSizeParameter(e),this._texture=n?r.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions):r.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this))},t.prototype.render=function(e,n){if(e===void 0&&(e=!1),n===void 0&&(n=!1),y=this.getScene()){var r,o=y.getEngine();if(this.useCameraPostProcesses!==void 0&&(e=this.useCameraPostProcesses),this._waitingRenderList){this.renderList=[];for(var u=0;u<this._waitingRenderList.length;u++){var f=this._waitingRenderList[u],v=y.getMeshByID(f);v&&this.renderList.push(v)}this._waitingRenderList=void 0}if(this.renderListPredicate){var y;if(this.renderList?this.renderList.length=0:this.renderList=[],!(y=this.getScene()))return;var D=y.meshes;for(u=0;u<D.length;u++){var w=D[u];this.renderListPredicate(w)&&this.renderList.push(w)}}if(this.onBeforeBindObservable.notifyObservers(this),this.activeCamera?(r=this.activeCamera,o.setViewport(this.activeCamera.viewport,this.getRenderWidth(),this.getRenderHeight()),this.activeCamera!==y.activeCamera&&y.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix(!0))):(r=y.activeCamera)&&o.setViewport(r.viewport,this.getRenderWidth(),this.getRenderHeight()),this._defaultRenderListPrepared=!1,this.is2DArray)for(var F=0;F<this.getRenderLayers();F++)this.renderToTarget(0,e,n,F,r),y.incrementRenderId(),y.resetCachedMaterial();else if(this.isCube)for(var z=0;z<6;z++)this.renderToTarget(z,e,n,void 0,r),y.incrementRenderId(),y.resetCachedMaterial();else this.renderToTarget(0,e,n,void 0,r);this.onAfterUnbindObservable.notifyObservers(this),y.activeCamera&&((y.getEngine().scenes.length>1||this.activeCamera&&this.activeCamera!==y.activeCamera)&&y.setTransformMatrix(y.activeCamera.getViewMatrix(),y.activeCamera.getProjectionMatrix(!0)),o.setViewport(y.activeCamera.viewport)),y.resetCachedMaterial()}},t.prototype._bestReflectionRenderTargetDimension=function(e,n){var r=e*n,o=Ge.a.NearestPOT(r+16384/(128+r));return Math.min(Ge.a.FloorPOT(e),o)},t.prototype._prepareRenderingManager=function(e,n,r,o){var u=this.getScene();if(u){this._renderingManager.reset();for(var f=u.getRenderId(),v=0;v<n;v++){var y=e[v];if(y&&!y.isBlocked){if(this.customIsReadyFunction){if(!this.customIsReadyFunction(y,this.refreshRate)){this.resetRefreshCounter();continue}}else if(!y.isReady(this.refreshRate===0)){this.resetRefreshCounter();continue}if(!y._internalAbstractMeshDataInfo._currentLODIsUpToDate&&u.activeCamera&&(y._internalAbstractMeshDataInfo._currentLOD=u.customLODSelector?u.customLODSelector(y,u.activeCamera):y.getLOD(u.activeCamera),y._internalAbstractMeshDataInfo._currentLODIsUpToDate=!0),!y._internalAbstractMeshDataInfo._currentLOD)continue;var D=y._internalAbstractMeshDataInfo._currentLOD;D._preActivateForIntermediateRendering(f);var w=void 0;if(w=!(!o||!r)&&(y.layerMask&r.layerMask)==0,y.isEnabled()&&y.isVisible&&y.subMeshes&&!w&&(D!==y&&D._activate(f,!0),y._activate(f,!0)&&y.subMeshes.length)){y.isAnInstance?y._internalAbstractMeshDataInfo._actAsRegularMesh&&(D=y):D._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!1,D._internalAbstractMeshDataInfo._isActiveIntermediate=!0;for(var F=0;F<D.subMeshes.length;F++){var z=D.subMeshes[F];this._renderingManager.dispatch(z,D)}}}}for(var k=0;k<u.particleSystems.length;k++){var K=u.particleSystems[k],oe=K.emitter;K.isStarted()&&oe&&oe.position&&oe.isEnabled()&&e.indexOf(oe)>=0&&this._renderingManager.dispatchParticles(K)}}},t.prototype._bindFrameBuffer=function(e,n){e===void 0&&(e=0),n===void 0&&(n=0);var r=this.getScene();if(r){var o=r.getEngine();this._texture&&o.bindFramebuffer(this._texture,this.isCube?e:void 0,void 0,void 0,this.ignoreCameraViewport,0,n)}},t.prototype.unbindFrameBuffer=function(e,n){var r=this;this._texture&&e.unBindFramebuffer(this._texture,this.isCube,function(){r.onAfterRenderObservable.notifyObservers(n)})},t.prototype.renderToTarget=function(e,n,r,o,u){o===void 0&&(o=0),u===void 0&&(u=null);var f=this.getScene();if(f){var v=f.getEngine();if(this._texture){this._postProcessManager?this._postProcessManager._prepareFrame(this._texture,this._postProcesses):n&&f.postProcessManager._prepareFrame(this._texture)||this._bindFrameBuffer(e,o),this.is2DArray?this.onBeforeRenderObservable.notifyObservers(o):this.onBeforeRenderObservable.notifyObservers(e);var y=null,D=this.renderList?this.renderList:f.getActiveMeshes().data,w=this.renderList?this.renderList.length:f.getActiveMeshes().length;this.getCustomRenderList&&(y=this.getCustomRenderList(this.is2DArray?o:e,D,w)),y?this._prepareRenderingManager(y,y.length,u,!1):(this._defaultRenderListPrepared||(this._prepareRenderingManager(D,w,u,!this.renderList),this._defaultRenderListPrepared=!0),y=D),this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(v):v.clear(this.clearColor||f.clearColor,!0,!0,!0),this._doNotChangeAspectRatio||f.updateTransformMatrix(!0);for(var F=0,z=f._beforeRenderTargetDrawStage;F<z.length;F++)z[F].action(this);this._renderingManager.render(this.customRenderFunction,y,this.renderParticles,this.renderSprites);for(var k=0,K=f._afterRenderTargetDrawStage;k<K.length;k++)K[k].action(this);this._postProcessManager?this._postProcessManager._finalizeFrame(!1,this._texture,e,this._postProcesses,this.ignoreCameraViewport):n&&f.postProcessManager._finalizeFrame(!1,this._texture,e),this._doNotChangeAspectRatio||f.updateTransformMatrix(!0),r&&et.b.DumpFramebuffer(this.getRenderWidth(),this.getRenderHeight(),v),this.isCube&&e!==5?this.onAfterRenderObservable.notifyObservers(e):(this.isCube&&e===5&&v.generateMipMapsForCubemap(this._texture),this.unbindFrameBuffer(v,e))}}},t.prototype.setRenderingOrder=function(e,n,r,o){n===void 0&&(n=null),r===void 0&&(r=null),o===void 0&&(o=null),this._renderingManager.setRenderingOrder(e,n,r,o)},t.prototype.setRenderingAutoClearDepthStencil=function(e,n){this._renderingManager.setRenderingAutoClearDepthStencil(e,n),this._renderingManager._useSceneAutoClearSetup=!1},t.prototype.clone=function(){var e=this.getSize(),n=new t(this.name,e,this.getScene(),this._renderTargetOptions.generateMipMaps,this._doNotChangeAspectRatio,this._renderTargetOptions.type,this.isCube,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer,this._renderTargetOptions.generateStencilBuffer);return n.hasAlpha=this.hasAlpha,n.level=this.level,n.coordinatesMode=this.coordinatesMode,this.renderList&&(n.renderList=this.renderList.slice(0)),n},t.prototype.serialize=function(){if(!this.name)return null;var e=i.prototype.serialize.call(this);if(e.renderTargetSize=this.getRenderSize(),e.renderList=[],this.renderList)for(var n=0;n<this.renderList.length;n++)e.renderList.push(this.renderList[n].id);return e},t.prototype.disposeFramebufferObjects=function(){var e=this.getInternalTexture(),n=this.getScene();e&&n&&n.getEngine()._releaseFramebufferObjects(e)},t.prototype.dispose=function(){this.onResizeObservable.clear(),this.onClearObservable.clear(),this.onAfterRenderObservable.clear(),this.onAfterUnbindObservable.clear(),this.onBeforeBindObservable.clear(),this.onBeforeRenderObservable.clear(),this._postProcessManager&&(this._postProcessManager.dispose(),this._postProcessManager=null),this.clearPostProcesses(!0),this._resizeObserver&&(this.getScene().getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null),this.renderList=null;var e=this.getScene();if(e){var n=e.customRenderTargets.indexOf(this);n>=0&&e.customRenderTargets.splice(n,1);for(var r=0,o=e.cameras;r<o.length;r++){var u=o[r];(n=u.customRenderTargets.indexOf(this))>=0&&u.customRenderTargets.splice(n,1)}this.depthStencilTexture&&this.getScene().getEngine()._releaseTexture(this.depthStencilTexture),i.prototype.dispose.call(this)}},t.prototype._rebuild=function(){this.refreshRate===t.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=t.REFRESHRATE_RENDER_ONCE),this._postProcessManager&&this._postProcessManager._rebuild()},t.prototype.freeRenderingGroups=function(){this._renderingManager&&this._renderingManager.freeRenderingGroups()},t.prototype.getViewCount=function(){return 1},t.REFRESHRATE_RENDER_ONCE=0,t.REFRESHRATE_RENDER_ONEVERYFRAME=1,t.REFRESHRATE_RENDER_ONEVERYTWOFRAMES=2,t}(ke.a);ke.a._CreateRenderTargetTexture=function(i,t,e,n){return new qn(i,t,e,n)};var Ry=function(i){function t(e,n){n===void 0&&(n=512);var r=i.call(this,"multiview rtt",n,e,!1,!0,Nt.b.Unknown,!1,void 0,!1,!1,!0,void 0,!0)||this,o=e.getEngine().createMultiviewRenderTargetTexture(r.getRenderWidth(),r.getRenderHeight());return o.isMultiview=!0,o.format=g.a.TEXTUREFORMAT_RGBA,r._texture=o,r.samples=r._getEngine().getCaps().maxSamples||r.samples,r}return Object(p.d)(t,i),t.prototype._bindFrameBuffer=function(e){this._texture&&this.getScene().getEngine().bindMultiviewFramebuffer(this._texture)},t.prototype.getViewCount=function(){return 2},t}(qn),Oy=c(90);Ge.a.prototype.createMultiviewRenderTargetTexture=function(i,t){var e=this._gl;if(!this.getCaps().multiview)throw"Multiview is not supported";var n=new Nt.a(this,Nt.b.Unknown,!0);return n.width=i,n.height=t,n._framebuffer=e.createFramebuffer(),n._colorTextureArray=e.createTexture(),e.bindTexture(e.TEXTURE_2D_ARRAY,n._colorTextureArray),e.texStorage3D(e.TEXTURE_2D_ARRAY,1,e.RGBA8,i,t,2),n._depthStencilTextureArray=e.createTexture(),e.bindTexture(e.TEXTURE_2D_ARRAY,n._depthStencilTextureArray),e.texStorage3D(e.TEXTURE_2D_ARRAY,1,e.DEPTH32F_STENCIL8,i,t,2),n.isReady=!0,n},Ge.a.prototype.bindMultiviewFramebuffer=function(i){var t=this._gl,e=this.getCaps().oculusMultiview||this.getCaps().multiview;if(this.bindFramebuffer(i,void 0,void 0,void 0,!0),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,i._framebuffer),!i._colorTextureArray||!i._depthStencilTextureArray)throw"Invalid multiview frame buffer";this.getCaps().oculusMultiview?(e.framebufferTextureMultisampleMultiviewOVR(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0,i._colorTextureArray,0,i.samples,0,2),e.framebufferTextureMultisampleMultiviewOVR(t.DRAW_FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,i._depthStencilTextureArray,0,i.samples,0,2)):(e.framebufferTextureMultiviewOVR(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0,i._colorTextureArray,0,0,2),e.framebufferTextureMultiviewOVR(t.DRAW_FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,i._depthStencilTextureArray,0,0,2))},Pt.a.prototype._useMultiviewToSingleView=!1,Pt.a.prototype._multiviewTexture=null,Pt.a.prototype._resizeOrCreateMultiviewTexture=function(i,t){this._multiviewTexture?this._multiviewTexture.getRenderWidth()==i&&this._multiviewTexture.getRenderHeight()==t||(this._multiviewTexture.dispose(),this._multiviewTexture=new Ry(this.getScene(),{width:i,height:t})):this._multiviewTexture=new Ry(this.getScene(),{width:i,height:t})},he.a.prototype._transformMatrixR=d.a.Zero(),he.a.prototype._multiviewSceneUbo=null,he.a.prototype._createMultiviewUbo=function(){this._multiviewSceneUbo=new Cy.a(this.getEngine(),void 0,!0),this._multiviewSceneUbo.addUniform("viewProjection",16),this._multiviewSceneUbo.addUniform("viewProjectionR",16),this._multiviewSceneUbo.addUniform("view",16)},he.a.prototype._updateMultiviewUbo=function(i,t){i&&t&&i.multiplyToRef(t,this._transformMatrixR),i&&t&&(i.multiplyToRef(t,d.c.Matrix[0]),Oy.a.GetRightPlaneToRef(d.c.Matrix[0],this._frustumPlanes[3])),this._multiviewSceneUbo&&(this._multiviewSceneUbo.updateMatrix("viewProjection",this.getTransformMatrix()),this._multiviewSceneUbo.updateMatrix("viewProjectionR",this._transformMatrixR),this._multiviewSceneUbo.updateMatrix("view",this._viewMatrix),this._multiviewSceneUbo.update())},he.a.prototype._renderMultiviewToSingleView=function(i){i._resizeOrCreateMultiviewTexture(i._rigPostProcess&&i._rigPostProcess&&i._rigPostProcess.width>0?i._rigPostProcess.width:this.getEngine().getRenderWidth(!0),i._rigPostProcess&&i._rigPostProcess&&i._rigPostProcess.height>0?i._rigPostProcess.height:this.getEngine().getRenderHeight(!0)),this._multiviewSceneUbo||this._createMultiviewUbo(),i.outputRenderTarget=i._multiviewTexture,this._renderForCamera(i),i.outputRenderTarget=null;for(var t=0;t<i._rigCameras.length;t++){var e=this.getEngine();this._activeCamera=i._rigCameras[t],e.setViewport(this._activeCamera.viewport),this.postProcessManager&&(this.postProcessManager._prepareFrame(),this.postProcessManager._finalizeFrame(this._activeCamera.isIntermediate))}};var Ip=function(i){function t(e,n,r){var o=i.call(this,e,"vrMultiviewToSingleview",["imageIndex"],["multiviewSampler"],r,n,ke.a.BILINEAR_SAMPLINGMODE)||this;return o.onSizeChangedObservable.add(function(){}),o.onApplyObservable.add(function(u){n._scene.activeCamera&&n._scene.activeCamera.isLeftCamera?u.setInt("imageIndex",0):u.setInt("imageIndex",1),u.setTexture("multiviewSampler",n._multiviewTexture)}),o}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"VRMultiviewToSingleviewPostProcess"},t}(St);Pt.a._setVRRigMode=function(i,t){var e=t.vrCameraMetrics||ps.GetDefault();i._rigCameras[0]._cameraRigParams.vrMetrics=e,i._rigCameras[0].viewport=new li.a(0,0,.5,1),i._rigCameras[0]._cameraRigParams.vrWorkMatrix=new d.a,i._rigCameras[0]._cameraRigParams.vrHMatrix=e.leftHMatrix,i._rigCameras[0]._cameraRigParams.vrPreViewMatrix=e.leftPreViewMatrix,i._rigCameras[0].getProjectionMatrix=i._rigCameras[0]._getVRProjectionMatrix,i._rigCameras[1]._cameraRigParams.vrMetrics=e,i._rigCameras[1].viewport=new li.a(.5,0,.5,1),i._rigCameras[1]._cameraRigParams.vrWorkMatrix=new d.a,i._rigCameras[1]._cameraRigParams.vrHMatrix=e.rightHMatrix,i._rigCameras[1]._cameraRigParams.vrPreViewMatrix=e.rightPreViewMatrix,i._rigCameras[1].getProjectionMatrix=i._rigCameras[1]._getVRProjectionMatrix,e.multiviewEnabled&&(i.getScene().getEngine().getCaps().multiview?(i._useMultiviewToSingleView=!0,i._rigPostProcess=new Ip("VRMultiviewToSingleview",i,e.postProcessScaleFactor)):(_.a.Warn("Multiview is not supported, falling back to standard rendering"),e.multiviewEnabled=!1)),e.compensateDistortion&&(i._rigCameras[0]._rigPostProcess=new Op("VR_Distort_Compensation_Left",i._rigCameras[0],!1,e),i._rigCameras[1]._rigPostProcess=new Op("VR_Distort_Compensation_Right",i._rigCameras[1],!0,e))},$.a.AddNodeConstructor("VRDeviceOrientationFreeCamera",function(i,t){return function(){return new My(i,0,0,1,d.e.Zero(),t)}});var My=function(i){function t(e,n,r,o,u,f,v,y){v===void 0&&(v=!0),y===void 0&&(y=ps.GetDefault());var D=i.call(this,e,n,r,o,u,f)||this;return y.compensateDistortion=v,D.setCameraRigMode(Pt.a.RIG_MODE_VR,{vrCameraMetrics:y}),D.inputs.addVRDeviceOrientation(),D}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"VRDeviceOrientationArcRotateCamera"},t}(Vi);$.a.AddNodeConstructor("VRDeviceOrientationFreeCamera",function(i,t){return function(){return new Ju(i,d.e.Zero(),t)}});var Ju=function(i){function t(e,n,r,o,u){o===void 0&&(o=!0),u===void 0&&(u=ps.GetDefault());var f=i.call(this,e,n,r)||this;return u.compensateDistortion=o,f.setCameraRigMode(Pt.a.RIG_MODE_VR,{vrCameraMetrics:u}),f}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"VRDeviceOrientationFreeCamera"},t}(Vo);$.a.AddNodeConstructor("VRDeviceOrientationGamepadCamera",function(i,t){return function(){return new Iy(i,d.e.Zero(),t)}});var Iy=function(i){function t(e,n,r,o,u){o===void 0&&(o=!0),u===void 0&&(u=ps.GetDefault());var f=i.call(this,e,n,r,o,u)||this;return f.inputs.addGamepad(),f}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"VRDeviceOrientationGamepadCamera"},t}(Ju),eh=c(86);Pt.a._setWebVRRigMode=function(i,t){if(t.vrDisplay){var e=t.vrDisplay.getEyeParameters("left"),n=t.vrDisplay.getEyeParameters("right");i._rigCameras[0].viewport=new li.a(0,0,.5,1),i._rigCameras[0].setCameraRigParameter("left",!0),i._rigCameras[0].setCameraRigParameter("specs",t.specs),i._rigCameras[0].setCameraRigParameter("eyeParameters",e),i._rigCameras[0].setCameraRigParameter("frameData",t.frameData),i._rigCameras[0].setCameraRigParameter("parentCamera",t.parentCamera),i._rigCameras[0]._cameraRigParams.vrWorkMatrix=new d.a,i._rigCameras[0].getProjectionMatrix=i._getWebVRProjectionMatrix,i._rigCameras[0].parent=i,i._rigCameras[0]._getViewMatrix=i._getWebVRViewMatrix,i._rigCameras[1].viewport=new li.a(.5,0,.5,1),i._rigCameras[1].setCameraRigParameter("eyeParameters",n),i._rigCameras[1].setCameraRigParameter("specs",t.specs),i._rigCameras[1].setCameraRigParameter("frameData",t.frameData),i._rigCameras[1].setCameraRigParameter("parentCamera",t.parentCamera),i._rigCameras[1]._cameraRigParams.vrWorkMatrix=new d.a,i._rigCameras[1].getProjectionMatrix=i._getWebVRProjectionMatrix,i._rigCameras[1].parent=i,i._rigCameras[1]._getViewMatrix=i._getWebVRViewMatrix}},Object.defineProperty(Ge.a.prototype,"isInVRExclusivePointerMode",{get:function(){return this._vrExclusivePointerMode},enumerable:!0,configurable:!0}),Ge.a.prototype._prepareVRComponent=function(){this._vrSupported=!1,this._vrExclusivePointerMode=!1,this.onVRDisplayChangedObservable=new S.c,this.onVRRequestPresentComplete=new S.c,this.onVRRequestPresentStart=new S.c},Ge.a.prototype.isVRDevicePresent=function(){return!!this._vrDisplay},Ge.a.prototype.getVRDevice=function(){return this._vrDisplay},Ge.a.prototype.initWebVR=function(){return this.initWebVRAsync(),this.onVRDisplayChangedObservable},Ge.a.prototype.initWebVRAsync=function(){var i=this,t=function(){var n={vrDisplay:i._vrDisplay,vrSupported:i._vrSupported};i.onVRDisplayChangedObservable.notifyObservers(n),i._webVRInitPromise=new Promise(function(r){r(n)})};if(!this._onVrDisplayConnect){this._onVrDisplayConnect=function(n){i._vrDisplay=n.display,t()},this._onVrDisplayDisconnect=function(){i._vrDisplay.cancelAnimationFrame(i._frameHandler),i._vrDisplay=void 0,i._frameHandler=Ge.a.QueueNewFrame(i._boundRenderFunction),t()},this._onVrDisplayPresentChange=function(){i._vrExclusivePointerMode=i._vrDisplay&&i._vrDisplay.isPresenting};var e=this.getHostWindow();e&&(e.addEventListener("vrdisplayconnect",this._onVrDisplayConnect),e.addEventListener("vrdisplaydisconnect",this._onVrDisplayDisconnect),e.addEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChange))}return this._webVRInitPromise=this._webVRInitPromise||this._getVRDisplaysAsync(),this._webVRInitPromise.then(t),this._webVRInitPromise},Ge.a.prototype._getVRDisplaysAsync=function(){var i=this;return new Promise(function(t){navigator.getVRDisplays?navigator.getVRDisplays().then(function(e){i._vrSupported=!0,i._vrDisplay=e[0],t({vrDisplay:i._vrDisplay,vrSupported:i._vrSupported})}):(i._vrDisplay=void 0,i._vrSupported=!1,t({vrDisplay:i._vrDisplay,vrSupported:i._vrSupported}))})},Ge.a.prototype.enableVR=function(i){var t=this;if(this._vrDisplay&&!this._vrDisplay.isPresenting){this.onVRRequestPresentStart.notifyObservers(this);var e={highRefreshRate:!!this.vrPresentationAttributes&&this.vrPresentationAttributes.highRefreshRate,foveationLevel:this.vrPresentationAttributes?this.vrPresentationAttributes.foveationLevel:1,multiview:(this.getCaps().multiview||this.getCaps().oculusMultiview)&&i.useMultiview};this._vrDisplay.requestPresent([Object(p.a)({source:this.getRenderingCanvas(),attributes:e},e)]).then(function(){t.onVRRequestPresentComplete.notifyObservers(!0),t._onVRFullScreenTriggered()}).catch(function(){t.onVRRequestPresentComplete.notifyObservers(!1)})}},Ge.a.prototype._onVRFullScreenTriggered=function(){if(this._vrDisplay&&this._vrDisplay.isPresenting){this._oldSize=new le.a(this.getRenderWidth(),this.getRenderHeight()),this._oldHardwareScaleFactor=this.getHardwareScalingLevel();var i=this._vrDisplay.getEyeParameters("left");this.setHardwareScalingLevel(1),this.setSize(2*i.renderWidth,i.renderHeight)}else this.setHardwareScalingLevel(this._oldHardwareScaleFactor),this.setSize(this._oldSize.width,this._oldSize.height)},Ge.a.prototype.disableVR=function(){var i=this;this._vrDisplay&&this._vrDisplay.isPresenting&&this._vrDisplay.exitPresent().then(function(){return i._onVRFullScreenTriggered()}).catch(function(){return i._onVRFullScreenTriggered()}),ds.a.IsWindowObjectExist()&&(window.removeEventListener("vrdisplaypointerrestricted",this._onVRDisplayPointerRestricted),window.removeEventListener("vrdisplaypointerunrestricted",this._onVRDisplayPointerUnrestricted),this._onVrDisplayConnect&&(window.removeEventListener("vrdisplayconnect",this._onVrDisplayConnect),this._onVrDisplayDisconnect&&window.removeEventListener("vrdisplaydisconnect",this._onVrDisplayDisconnect),this._onVrDisplayPresentChange&&window.removeEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChange),this._onVrDisplayConnect=null,this._onVrDisplayDisconnect=null))},Ge.a.prototype._connectVREvents=function(i,t){var e=this;if(this._onVRDisplayPointerRestricted=function(){i&&i.requestPointerLock()},this._onVRDisplayPointerUnrestricted=function(){if(t)t.exitPointerLock&&t.exitPointerLock();else{var r=e.getHostWindow();r.document&&r.document.exitPointerLock&&r.document.exitPointerLock()}},ds.a.IsWindowObjectExist()){var n=this.getHostWindow();n.addEventListener("vrdisplaypointerrestricted",this._onVRDisplayPointerRestricted,!1),n.addEventListener("vrdisplaypointerunrestricted",this._onVRDisplayPointerUnrestricted,!1)}},Ge.a.prototype._submitVRFrame=function(){if(this._vrDisplay&&this._vrDisplay.isPresenting)try{this._vrDisplay.submitFrame()}catch(i){et.b.Warn("webVR submitFrame has had an unexpected failure: "+i)}},Ge.a.prototype.isVRPresenting=function(){return this._vrDisplay&&this._vrDisplay.isPresenting},Ge.a.prototype._requestVRFrame=function(){this._frameHandler=Ge.a.QueueNewFrame(this._boundRenderFunction,this._vrDisplay)},$.a.AddNodeConstructor("WebVRFreeCamera",function(i,t){return function(){return new th(i,d.e.Zero(),t)}}),$.a.AddNodeConstructor("WebVRGamepadCamera",function(i,t){return function(){return new th(i,d.e.Zero(),t)}});var th=function(i){function t(e,n,r,o){o===void 0&&(o={});var u=i.call(this,e,n,r)||this;u.webVROptions=o,u._vrDevice=null,u.rawPose=null,u._specsVersion="1.1",u._attached=!1,u._descendants=[],u._deviceRoomPosition=d.e.Zero(),u._deviceRoomRotationQuaternion=d.b.Identity(),u._standingMatrix=null,u.devicePosition=d.e.Zero(),u.deviceRotationQuaternion=d.b.Identity(),u.deviceScaleFactor=1,u._deviceToWorld=d.a.Identity(),u._worldToDevice=d.a.Identity(),u.controllers=[],u.onControllersAttachedObservable=new S.c,u.onControllerMeshLoadedObservable=new S.c,u.onPoseUpdatedFromDeviceObservable=new S.c,u._poseSet=!1,u.rigParenting=!0,u._defaultHeight=void 0,u._detachIfAttached=function(){var v=u.getEngine().getVRDevice();v&&!v.isPresenting&&u.detachControl()},u._workingVector=d.e.Zero(),u._oneVector=d.e.One(),u._workingMatrix=d.a.Identity(),u._tmpMatrix=new d.a,u._cache.position=d.e.Zero(),o.defaultHeight&&(u._defaultHeight=o.defaultHeight,u.position.y=u._defaultHeight),u.minZ=.1,arguments.length===5&&(u.webVROptions=arguments[4]),u.webVROptions.trackPosition==null&&(u.webVROptions.trackPosition=!0),u.webVROptions.controllerMeshes==null&&(u.webVROptions.controllerMeshes=!0),u.webVROptions.defaultLightingOnControllers==null&&(u.webVROptions.defaultLightingOnControllers=!0),u.rotationQuaternion=new d.b,u.webVROptions&&u.webVROptions.positionScale&&(u.deviceScaleFactor=u.webVROptions.positionScale);var f=u.getEngine();return u._onVREnabled=function(v){v&&u.initControllers()},f.onVRRequestPresentComplete.add(u._onVREnabled),f.initWebVR().add(function(v){v.vrDisplay&&u._vrDevice!==v.vrDisplay&&(u._vrDevice=v.vrDisplay,u.setCameraRigMode(Pt.a.RIG_MODE_WEBVR,{parentCamera:u,vrDisplay:u._vrDevice,frameData:u._frameData,specs:u._specsVersion}),u._attached&&u.getEngine().enableVR(u.webVROptions))}),typeof VRFrameData!="undefined"&&(u._frameData=new VRFrameData),o.useMultiview&&(u.getScene().getEngine().getCaps().multiview?(u._useMultiviewToSingleView=!0,u._rigPostProcess=new Ip("VRMultiviewToSingleview",u,1)):(_.a.Warn("Multiview is not supported, falling back to standard rendering"),u._useMultiviewToSingleView=!1)),r.onBeforeCameraRenderObservable.add(function(v){v.parent===u&&u.rigParenting&&(u._descendants=u.getDescendants(!0,function(y){var D=u.controllers.some(function(F){return F._mesh===y}),w=u._rigCameras.indexOf(y)!==-1;return!D&&!w}),u._descendants.forEach(function(y){y.parent=v}))}),r.onAfterCameraRenderObservable.add(function(v){v.parent===u&&u.rigParenting&&u._descendants.forEach(function(y){y.parent=u})}),u}return Object(p.d)(t,i),t.prototype.deviceDistanceToRoomGround=function(){return this._standingMatrix?(this._standingMatrix.getTranslationToRef(this._workingVector),this._deviceRoomPosition.y+this._workingVector.y):this._defaultHeight||0},t.prototype.useStandingMatrix=function(e){var n=this;e===void 0&&(e=function(r){}),this.getEngine().initWebVRAsync().then(function(r){r.vrDisplay&&r.vrDisplay.stageParameters&&r.vrDisplay.stageParameters.sittingToStandingTransform&&n.webVROptions.trackPosition?(n._standingMatrix=new d.a,d.a.FromFloat32ArrayToRefScaled(r.vrDisplay.stageParameters.sittingToStandingTransform,0,1,n._standingMatrix),n.getScene().useRightHandedSystem||n._standingMatrix&&n._standingMatrix.toggleModelMatrixHandInPlace(),e(!0)):e(!1)})},t.prototype.useStandingMatrixAsync=function(){var e=this;return new Promise(function(n){e.useStandingMatrix(function(r){n(r)})})},t.prototype.dispose=function(){this._detachIfAttached(),this.getEngine().onVRRequestPresentComplete.removeCallback(this._onVREnabled),this._updateCacheWhenTrackingDisabledObserver&&this._scene.onBeforeRenderObservable.remove(this._updateCacheWhenTrackingDisabledObserver),i.prototype.dispose.call(this)},t.prototype.getControllerByName=function(e){for(var n=0,r=this.controllers;n<r.length;n++){var o=r[n];if(o.hand===e)return o}return null},Object.defineProperty(t.prototype,"leftController",{get:function(){return this._leftController||(this._leftController=this.getControllerByName("left")),this._leftController},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rightController",{get:function(){return this._rightController||(this._rightController=this.getControllerByName("right")),this._rightController},enumerable:!1,configurable:!0}),t.prototype.getForwardRay=function(e){return e===void 0&&(e=100),this.leftCamera?i.prototype.getForwardRay.call(this,e,this.leftCamera.getWorldMatrix(),this.leftCamera.globalPosition):i.prototype.getForwardRay.call(this,e)},t.prototype._checkInputs=function(){this._vrDevice&&this._vrDevice.isPresenting&&(this._vrDevice.getFrameData(this._frameData),this.updateFromDevice(this._frameData.pose)),i.prototype._checkInputs.call(this)},t.prototype.updateFromDevice=function(e){e&&e.orientation&&e.orientation.length===4&&(this.rawPose=e,this._deviceRoomRotationQuaternion.copyFromFloats(e.orientation[0],e.orientation[1],-e.orientation[2],-e.orientation[3]),this.getScene().useRightHandedSystem&&(this._deviceRoomRotationQuaternion.z*=-1,this._deviceRoomRotationQuaternion.w*=-1),this.webVROptions.trackPosition&&this.rawPose.position&&(this._deviceRoomPosition.copyFromFloats(this.rawPose.position[0],this.rawPose.position[1],-this.rawPose.position[2]),this.getScene().useRightHandedSystem&&(this._deviceRoomPosition.z*=-1)),this._poseSet=!0)},t.prototype.attachControl=function(e){e=et.b.BackCompatCameraNoPreventDefault(arguments),i.prototype.attachControl.call(this,e),this._attached=!0,e=!Pt.a.ForceAttachControlToAlwaysPreventDefault&&e,this._vrDevice&&this.getEngine().enableVR(this.webVROptions);var n=this._scene.getEngine().getHostWindow();n&&n.addEventListener("vrdisplaypresentchange",this._detachIfAttached)},t.prototype.detachControl=function(e){this.getScene().gamepadManager.onGamepadConnectedObservable.remove(this._onGamepadConnectedObserver),this.getScene().gamepadManager.onGamepadDisconnectedObservable.remove(this._onGamepadDisconnectedObserver),i.prototype.detachControl.call(this),this._attached=!1,this.getEngine().disableVR(),window.removeEventListener("vrdisplaypresentchange",this._detachIfAttached)},t.prototype.getClassName=function(){return"WebVRFreeCamera"},t.prototype.resetToCurrentRotation=function(){this._vrDevice.resetPose()},t.prototype._updateRigCameras=function(){var e=this._rigCameras[0],n=this._rigCameras[1];e.rotationQuaternion.copyFrom(this._deviceRoomRotationQuaternion),n.rotationQuaternion.copyFrom(this._deviceRoomRotationQuaternion),e.position.copyFrom(this._deviceRoomPosition),n.position.copyFrom(this._deviceRoomPosition)},t.prototype._correctPositionIfNotTrackPosition=function(e,n){n===void 0&&(n=!1),this.rawPose&&this.rawPose.position&&!this.webVROptions.trackPosition&&(d.a.TranslationToRef(this.rawPose.position[0],this.rawPose.position[1],-this.rawPose.position[2],this._tmpMatrix),n||this._tmpMatrix.invert(),this._tmpMatrix.multiplyToRef(e,e))},t.prototype._updateCache=function(e){var n=this;this.rotationQuaternion.equals(this._cache.rotationQuaternion)&&this.position.equals(this._cache.position)||(this.updateCacheCalled||(this.updateCacheCalled=!0,this.update()),this.rotationQuaternion.toRotationMatrix(this._workingMatrix),d.e.TransformCoordinatesToRef(this._deviceRoomPosition,this._workingMatrix,this._workingVector),this.devicePosition.subtractToRef(this._workingVector,this._workingVector),d.a.ComposeToRef(this._oneVector,this.rotationQuaternion,this._workingVector,this._deviceToWorld),this._deviceToWorld.getTranslationToRef(this._workingVector),this._workingVector.addInPlace(this.position),this._workingVector.subtractInPlace(this._cache.position),this._deviceToWorld.setTranslation(this._workingVector),this._deviceToWorld.invertToRef(this._worldToDevice),this.controllers.forEach(function(r){r._deviceToWorld.copyFrom(n._deviceToWorld),n._correctPositionIfNotTrackPosition(r._deviceToWorld),r.update()})),e||i.prototype._updateCache.call(this),this.updateCacheCalled=!1},t.prototype._computeDevicePosition=function(){d.e.TransformCoordinatesToRef(this._deviceRoomPosition,this._deviceToWorld,this.devicePosition)},t.prototype.update=function(){this._computeDevicePosition(),d.a.FromQuaternionToRef(this._deviceRoomRotationQuaternion,this._workingMatrix),this._workingMatrix.multiplyToRef(this._deviceToWorld,this._workingMatrix),d.b.FromRotationMatrixToRef(this._workingMatrix,this.deviceRotationQuaternion),this._poseSet&&this.onPoseUpdatedFromDeviceObservable.notifyObservers(null),i.prototype.update.call(this)},t.prototype._getViewMatrix=function(){return d.a.Identity()},t.prototype._getWebVRViewMatrix=function(){var e=this._cameraRigParams.parentCamera;e._updateCache();var n=this._cameraRigParams.left?this._cameraRigParams.frameData.leftViewMatrix:this._cameraRigParams.frameData.rightViewMatrix;return d.a.FromArrayToRef(n,0,this._webvrViewMatrix),this.getScene().useRightHandedSystem||this._webvrViewMatrix.toggleModelMatrixHandInPlace(),this._webvrViewMatrix.getRotationMatrixToRef(this._cameraRotationMatrix),d.e.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),e.deviceScaleFactor!==1&&(this._webvrViewMatrix.invert(),e.deviceScaleFactor&&(this._webvrViewMatrix.multiplyAtIndex(12,e.deviceScaleFactor),this._webvrViewMatrix.multiplyAtIndex(13,e.deviceScaleFactor),this._webvrViewMatrix.multiplyAtIndex(14,e.deviceScaleFactor)),this._webvrViewMatrix.invert()),e._correctPositionIfNotTrackPosition(this._webvrViewMatrix,!0),e._worldToDevice.multiplyToRef(this._webvrViewMatrix,this._webvrViewMatrix),this._workingMatrix=this._workingMatrix||d.a.Identity(),this._webvrViewMatrix.invertToRef(this._workingMatrix),this._workingMatrix.multiplyToRef(e.getWorldMatrix(),this._workingMatrix),this._workingMatrix.getTranslationToRef(this._globalPosition),this._markSyncedWithParent(),this._webvrViewMatrix},t.prototype._getWebVRProjectionMatrix=function(){var e=this.parent;e._vrDevice.depthNear=e.minZ,e._vrDevice.depthFar=e.maxZ;var n=this._cameraRigParams.left?this._cameraRigParams.frameData.leftProjectionMatrix:this._cameraRigParams.frameData.rightProjectionMatrix;return d.a.FromArrayToRef(n,0,this._projectionMatrix),this.getScene().useRightHandedSystem||this._projectionMatrix.toggleProjectionMatrixHandInPlace(),this._projectionMatrix},t.prototype.initControllers=function(){var e=this;this.controllers=[];var n=this.getScene().gamepadManager;this._onGamepadDisconnectedObserver=n.onGamepadDisconnectedObservable.add(function(r){if(r.type===Gn.POSE_ENABLED){var o=r;o.defaultModel&&o.defaultModel.setEnabled(!1),o.hand==="right"&&(e._rightController=null),o.hand==="left"&&(e._leftController=null);var u=e.controllers.indexOf(o);u!==-1&&e.controllers.splice(u,1)}}),this._onGamepadConnectedObserver=n.onGamepadConnectedObservable.add(function(r){if(r.type===Gn.POSE_ENABLED){var o=r;if(e.webVROptions.trackPosition||(o._disableTrackPosition(new d.e(o.hand=="left"?-.15:.15,-.5,.25)),e._updateCacheWhenTrackingDisabledObserver||(e._updateCacheWhenTrackingDisabledObserver=e._scene.onBeforeRenderObservable.add(function(){e._updateCache()}))),o.deviceScaleFactor=e.deviceScaleFactor,o._deviceToWorld.copyFrom(e._deviceToWorld),e._correctPositionIfNotTrackPosition(o._deviceToWorld),e.webVROptions.controllerMeshes&&(o.defaultModel?o.defaultModel.setEnabled(!0):o.initControllerMesh(e.getScene(),function(v){if(v.scaling.scaleInPlace(e.deviceScaleFactor),e.onControllerMeshLoadedObservable.notifyObservers(o),e.webVROptions.defaultLightingOnControllers){e._lightOnControllers||(e._lightOnControllers=new eh.a("vrControllersLight",new d.e(0,1,0),e.getScene()));var y=function(D,w){var F=D.getChildren();F&&F.length!==0&&F.forEach(function(z){w.includedOnlyMeshes.push(z),y(z,w)})};e._lightOnControllers.includedOnlyMeshes.push(v),y(v,e._lightOnControllers)}})),o.attachToPoseControlledCamera(e),e.controllers.indexOf(o)===-1){e.controllers.push(o);for(var u=!1,f=0;f<e.controllers.length;f++)e.controllers[f].controllerType===Zr.VIVE&&(u?e.controllers[f].hand="right":(u=!0,e.controllers[f].hand="left"));e.controllers.length>=2&&e.onControllersAttachedObservable.notifyObservers(e.controllers)}}})},t}(Cr),zo=function(i){function t(e){var n=i.call(this,e)||this;return n.onTriggerStateChangedObservable=new S.c,n.onMainButtonStateChangedObservable=new S.c,n.onSecondaryButtonStateChangedObservable=new S.c,n.onPadStateChangedObservable=new S.c,n.onPadValuesChangedObservable=new S.c,n.pad={x:0,y:0},n._changes={pressChanged:!1,touchChanged:!1,valueChanged:!1,changed:!1},n._buttons=new Array(e.buttons.length),n.hand=e.hand,n}return Object(p.d)(t,i),t.prototype.onButtonStateChange=function(e){this._onButtonStateChange=e},Object.defineProperty(t.prototype,"defaultModel",{get:function(){return this._defaultModel},enumerable:!1,configurable:!0}),t.prototype.update=function(){i.prototype.update.call(this);for(var e=0;e<this._buttons.length;e++)this._setButtonValue(this.browserGamepad.buttons[e],this._buttons[e],e);this.leftStick.x===this.pad.x&&this.leftStick.y===this.pad.y||(this.pad.x=this.leftStick.x,this.pad.y=this.leftStick.y,this.onPadValuesChangedObservable.notifyObservers(this.pad))},t.prototype._setButtonValue=function(e,n,r){e||(e={pressed:!1,touched:!1,value:0}),n?(this._checkChanges(e,n),this._changes.changed&&(this._onButtonStateChange&&this._onButtonStateChange(this.index,r,e),this._handleButtonChange(r,e,this._changes)),this._buttons[r].pressed=e.pressed,this._buttons[r].touched=e.touched,this._buttons[r].value=e.value<1e-8?0:e.value):this._buttons[r]={pressed:e.pressed,touched:e.touched,value:e.value}},t.prototype._checkChanges=function(e,n){return this._changes.pressChanged=e.pressed!==n.pressed,this._changes.touchChanged=e.touched!==n.touched,this._changes.valueChanged=e.value!==n.value,this._changes.changed=this._changes.pressChanged||this._changes.touchChanged||this._changes.valueChanged,this._changes},t.prototype.dispose=function(){i.prototype.dispose.call(this),this._defaultModel=null,this.onTriggerStateChangedObservable.clear(),this.onMainButtonStateChangedObservable.clear(),this.onSecondaryButtonStateChangedObservable.clear(),this.onPadStateChangedObservable.clear(),this.onPadValuesChangedObservable.clear()},t}(we),fr=c(42),on=c(30),io=c(62),gI=(c(108),c(59),c(109),`
varying vec2 vUV;
uniform sampler2D textureSampler;
#include<imageProcessingDeclaration>
#include<helperFunctions>
#include<imageProcessingFunctions>
void main(void)
{
vec4 result=texture2D(textureSampler,vUV);
#ifdef IMAGEPROCESSING
#ifndef FROMLINEARSPACE

result.rgb=toLinearSpace(result.rgb);
#endif
result=applyImageProcessing(result);
#else

#ifdef FROMLINEARSPACE
result=applyImageProcessing(result);
#endif
#endif
gl_FragColor=result;
}`);Ye.a.ShadersStore.imageProcessingPixelShader=gI;var nh=function(i){function t(e,n,r,o,u,f,v,y){r===void 0&&(r=null),v===void 0&&(v=g.a.TEXTURETYPE_UNSIGNED_INT);var D=i.call(this,e,"imageProcessing",[],[],n,r,o,u,f,null,v,"postprocess",null,!0)||this;return D._fromLinearSpace=!0,D._defines={IMAGEPROCESSING:!1,VIGNETTE:!1,VIGNETTEBLENDMODEMULTIPLY:!1,VIGNETTEBLENDMODEOPAQUE:!1,TONEMAPPING:!1,TONEMAPPING_ACES:!1,CONTRAST:!1,COLORCURVES:!1,COLORGRADING:!1,COLORGRADING3D:!1,FROMLINEARSPACE:!1,SAMPLER3DGREENDEPTH:!1,SAMPLER3DBGRMAP:!1,IMAGEPROCESSINGPOSTPROCESS:!1,EXPOSURE:!1},y?(y.applyByPostProcess=!0,D._attachImageProcessingConfiguration(y,!0),D.fromLinearSpace=!1):(D._attachImageProcessingConfiguration(null,!0),D.imageProcessingConfiguration.applyByPostProcess=!0),D.onApply=function(w){D.imageProcessingConfiguration.bind(w,D.aspectRatio)},D}return Object(p.d)(t,i),Object.defineProperty(t.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(e){e.applyByPostProcess=!0,this._attachImageProcessingConfiguration(e)},enumerable:!1,configurable:!0}),t.prototype._attachImageProcessingConfiguration=function(e,n){var r=this;if(n===void 0&&(n=!1),e!==this._imageProcessingConfiguration){if(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),e)this._imageProcessingConfiguration=e;else{var o=null,u=this.getEngine(),f=this.getCamera();if(f)o=f.getScene();else if(u&&u.scenes){var v=u.scenes;o=v[v.length-1]}else o=ne.a.LastCreatedScene;this._imageProcessingConfiguration=o?o.imageProcessingConfiguration:new fr.a}this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add(function(){r._updateParameters()})),n||this._updateParameters()}},Object.defineProperty(t.prototype,"isSupported",{get:function(){var e=this.getEffect();return!e||e.isSupported},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"colorCurves",{get:function(){return this.imageProcessingConfiguration.colorCurves},set:function(e){this.imageProcessingConfiguration.colorCurves=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"colorCurvesEnabled",{get:function(){return this.imageProcessingConfiguration.colorCurvesEnabled},set:function(e){this.imageProcessingConfiguration.colorCurvesEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"colorGradingTexture",{get:function(){return this.imageProcessingConfiguration.colorGradingTexture},set:function(e){this.imageProcessingConfiguration.colorGradingTexture=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"colorGradingEnabled",{get:function(){return this.imageProcessingConfiguration.colorGradingEnabled},set:function(e){this.imageProcessingConfiguration.colorGradingEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"exposure",{get:function(){return this.imageProcessingConfiguration.exposure},set:function(e){this.imageProcessingConfiguration.exposure=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"toneMappingEnabled",{get:function(){return this._imageProcessingConfiguration.toneMappingEnabled},set:function(e){this._imageProcessingConfiguration.toneMappingEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"toneMappingType",{get:function(){return this._imageProcessingConfiguration.toneMappingType},set:function(e){this._imageProcessingConfiguration.toneMappingType=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"contrast",{get:function(){return this.imageProcessingConfiguration.contrast},set:function(e){this.imageProcessingConfiguration.contrast=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"vignetteStretch",{get:function(){return this.imageProcessingConfiguration.vignetteStretch},set:function(e){this.imageProcessingConfiguration.vignetteStretch=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"vignetteCentreX",{get:function(){return this.imageProcessingConfiguration.vignetteCentreX},set:function(e){this.imageProcessingConfiguration.vignetteCentreX=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"vignetteCentreY",{get:function(){return this.imageProcessingConfiguration.vignetteCentreY},set:function(e){this.imageProcessingConfiguration.vignetteCentreY=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"vignetteWeight",{get:function(){return this.imageProcessingConfiguration.vignetteWeight},set:function(e){this.imageProcessingConfiguration.vignetteWeight=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"vignetteColor",{get:function(){return this.imageProcessingConfiguration.vignetteColor},set:function(e){this.imageProcessingConfiguration.vignetteColor=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"vignetteCameraFov",{get:function(){return this.imageProcessingConfiguration.vignetteCameraFov},set:function(e){this.imageProcessingConfiguration.vignetteCameraFov=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"vignetteBlendMode",{get:function(){return this.imageProcessingConfiguration.vignetteBlendMode},set:function(e){this.imageProcessingConfiguration.vignetteBlendMode=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"vignetteEnabled",{get:function(){return this.imageProcessingConfiguration.vignetteEnabled},set:function(e){this.imageProcessingConfiguration.vignetteEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fromLinearSpace",{get:function(){return this._fromLinearSpace},set:function(e){this._fromLinearSpace!==e&&(this._fromLinearSpace=e,this._updateParameters())},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"ImageProcessingPostProcess"},t.prototype._updateParameters=function(){this._defines.FROMLINEARSPACE=this._fromLinearSpace,this.imageProcessingConfiguration.prepareDefines(this._defines,!0);var e="";for(var n in this._defines)this._defines[n]&&(e+="#define "+n+`;\r
`);var r=["textureSampler"],o=["scale"];fr.a&&(fr.a.PrepareSamplers(r,this._defines),fr.a.PrepareUniforms(o,this._defines)),this.updateEffect(e,o,r)},t.prototype.dispose=function(e){i.prototype.dispose.call(this,e),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration&&(this.imageProcessingConfiguration.applyByPostProcess=!1)},Object(p.c)([Object(B.c)()],t.prototype,"_fromLinearSpace",void 0),t}(St),Tt=c(16),De=c(4);Ne.a._GroundMeshParser=function(i,t){return rh.Parse(i,t)};var rh=function(i){function t(e,n){var r=i.call(this,e,n)||this;return r.generateOctree=!1,r}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"GroundMesh"},Object.defineProperty(t.prototype,"subdivisions",{get:function(){return Math.min(this._subdivisionsX,this._subdivisionsY)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"subdivisionsX",{get:function(){return this._subdivisionsX},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"subdivisionsY",{get:function(){return this._subdivisionsY},enumerable:!1,configurable:!0}),t.prototype.optimize=function(e,n){n===void 0&&(n=32),this._subdivisionsX=e,this._subdivisionsY=e,this.subdivide(e),this.createOrUpdateSubmeshesOctree&&this.createOrUpdateSubmeshesOctree(n)},t.prototype.getHeightAtCoordinates=function(e,n){var r=this.getWorldMatrix(),o=d.c.Matrix[5];r.invertToRef(o);var u=d.c.Vector3[8];if(d.e.TransformCoordinatesFromFloatsToRef(e,0,n,o,u),e=u.x,n=u.z,e<this._minX||e>this._maxX||n<this._minZ||n>this._maxZ)return this.position.y;this._heightQuads&&this._heightQuads.length!=0||(this._initHeightQuads(),this._computeHeightQuads());var f=this._getFacetAt(e,n),v=-(f.x*e+f.z*n+f.w)/f.y;return d.e.TransformCoordinatesFromFloatsToRef(0,v,0,r,u),u.y},t.prototype.getNormalAtCoordinates=function(e,n){var r=new d.e(0,1,0);return this.getNormalAtCoordinatesToRef(e,n,r),r},t.prototype.getNormalAtCoordinatesToRef=function(e,n,r){var o=this.getWorldMatrix(),u=d.c.Matrix[5];o.invertToRef(u);var f=d.c.Vector3[8];if(d.e.TransformCoordinatesFromFloatsToRef(e,0,n,u,f),e=f.x,n=f.z,e<this._minX||e>this._maxX||n<this._minZ||n>this._maxZ)return this;this._heightQuads&&this._heightQuads.length!=0||(this._initHeightQuads(),this._computeHeightQuads());var v=this._getFacetAt(e,n);return d.e.TransformNormalFromFloatsToRef(v.x,v.y,v.z,o,r),this},t.prototype.updateCoordinateHeights=function(){return this._heightQuads&&this._heightQuads.length!=0||this._initHeightQuads(),this._computeHeightQuads(),this},t.prototype._getFacetAt=function(e,n){var r=Math.floor((e+this._maxX)*this._subdivisionsX/this._width),o=Math.floor(-(n+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),u=this._heightQuads[o*this._subdivisionsX+r];return n<u.slope.x*e+u.slope.y?u.facet1:u.facet2},t.prototype._initHeightQuads=function(){var e=this._subdivisionsX,n=this._subdivisionsY;this._heightQuads=new Array;for(var r=0;r<n;r++)for(var o=0;o<e;o++){var u={slope:d.d.Zero(),facet1:new d.f(0,0,0,0),facet2:new d.f(0,0,0,0)};this._heightQuads[r*e+o]=u}return this},t.prototype._computeHeightQuads=function(){var e=this.getVerticesData(De.b.PositionKind);if(!e)return this;for(var n=d.c.Vector3[3],r=d.c.Vector3[2],o=d.c.Vector3[1],u=d.c.Vector3[0],f=d.c.Vector3[4],v=d.c.Vector3[5],y=d.c.Vector3[6],D=d.c.Vector3[7],w=d.c.Vector3[8],F=0,z=0,k=0,K=0,oe=0,ae=0,ue=0,de=this._subdivisionsX,me=this._subdivisionsY,ye=0;ye<me;ye++)for(var Ee=0;Ee<de;Ee++){F=3*Ee,z=ye*(de+1)*3,k=(ye+1)*(de+1)*3,n.x=e[z+F],n.y=e[z+F+1],n.z=e[z+F+2],r.x=e[z+F+3],r.y=e[z+F+4],r.z=e[z+F+5],o.x=e[k+F],o.y=e[k+F+1],o.z=e[k+F+2],u.x=e[k+F+3],u.y=e[k+F+4],u.z=e[k+F+5],K=(u.z-n.z)/(u.x-n.x),oe=n.z-K*n.x,r.subtractToRef(n,f),o.subtractToRef(n,v),u.subtractToRef(n,y),d.e.CrossToRef(y,v,D),d.e.CrossToRef(f,y,w),D.normalize(),w.normalize(),ae=-(D.x*n.x+D.y*n.y+D.z*n.z),ue=-(w.x*r.x+w.y*r.y+w.z*r.z);var Ae=this._heightQuads[ye*de+Ee];Ae.slope.copyFromFloats(K,oe),Ae.facet1.copyFromFloats(D.x,D.y,D.z,ae),Ae.facet2.copyFromFloats(w.x,w.y,w.z,ue)}return this},t.prototype.serialize=function(e){i.prototype.serialize.call(this,e),e.subdivisionsX=this._subdivisionsX,e.subdivisionsY=this._subdivisionsY,e.minX=this._minX,e.maxX=this._maxX,e.minZ=this._minZ,e.maxZ=this._maxZ,e.width=this._width,e.height=this._height},t.Parse=function(e,n){var r=new t(e.name,n);return r._subdivisionsX=e.subdivisionsX||1,r._subdivisionsY=e.subdivisionsY||1,r._minX=e.minX,r._maxX=e.maxX,r._minZ=e.minZ,r._maxZ=e.maxZ,r._width=e.width,r._height=e.height,r},t}(Ne.a),Dp=c(70);Tt.a.CreateGround=function(i){var t,e,n=[],r=[],o=[],u=[],f=i.width||1,v=i.height||1,y=i.subdivisionsX||i.subdivisions||1,D=i.subdivisionsY||i.subdivisions||1;for(t=0;t<=D;t++)for(e=0;e<=y;e++){var w=new d.e(e*f/y-f/2,0,(D-t)*v/D-v/2),F=new d.e(0,1,0);r.push(w.x,w.y,w.z),o.push(F.x,F.y,F.z),u.push(e/y,1-t/D)}for(t=0;t<D;t++)for(e=0;e<y;e++)n.push(e+1+(t+1)*(y+1)),n.push(e+1+t*(y+1)),n.push(e+t*(y+1)),n.push(e+(t+1)*(y+1)),n.push(e+1+(t+1)*(y+1)),n.push(e+t*(y+1));var z=new Tt.a;return z.indices=n,z.positions=r,z.normals=o,z.uvs=u,z},Tt.a.CreateTiledGround=function(i){var t,e,n,r,o=i.xmin!==void 0&&i.xmin!==null?i.xmin:-1,u=i.zmin!==void 0&&i.zmin!==null?i.zmin:-1,f=i.xmax!==void 0&&i.xmax!==null?i.xmax:1,v=i.zmax!==void 0&&i.zmax!==null?i.zmax:1,y=i.subdivisions||{w:1,h:1},D=i.precision||{w:1,h:1},w=new Array,F=new Array,z=new Array,k=new Array;y.h=y.h<1?1:y.h,y.w=y.w<1?1:y.w,D.w=D.w<1?1:D.w,D.h=D.h<1?1:D.h;var K=(f-o)/y.w,oe=(v-u)/y.h;function ae(de,me,ye,Ee){var Ae=F.length/3,Ie=D.w+1;for(t=0;t<D.h;t++)for(e=0;e<D.w;e++){var Re=[Ae+e+t*Ie,Ae+(e+1)+t*Ie,Ae+(e+1)+(t+1)*Ie,Ae+e+(t+1)*Ie];w.push(Re[1]),w.push(Re[2]),w.push(Re[3]),w.push(Re[0]),w.push(Re[1]),w.push(Re[3])}var Pe=d.e.Zero(),Ce=new d.e(0,1,0);for(t=0;t<=D.h;t++)for(Pe.z=t*(Ee-me)/D.h+me,e=0;e<=D.w;e++)Pe.x=e*(ye-de)/D.w+de,Pe.y=0,F.push(Pe.x,Pe.y,Pe.z),z.push(Ce.x,Ce.y,Ce.z),k.push(e/D.w,t/D.h)}for(n=0;n<y.h;n++)for(r=0;r<y.w;r++)ae(o+r*K,u+n*oe,o+(r+1)*K,u+(n+1)*oe);var ue=new Tt.a;return ue.indices=w,ue.positions=F,ue.normals=z,ue.uvs=k,ue},Tt.a.CreateGroundFromHeightMap=function(i){var t,e,n=[],r=[],o=[],u=[],f=i.colorFilter||new M.a(.3,.59,.11),v=i.alphaFilter||0,y=!1;if(i.minHeight>i.maxHeight){y=!0;var D=i.maxHeight;i.maxHeight=i.minHeight,i.minHeight=D}for(t=0;t<=i.subdivisions;t++)for(e=0;e<=i.subdivisions;e++){var w=new d.e(e*i.width/i.subdivisions-i.width/2,0,(i.subdivisions-t)*i.height/i.subdivisions-i.height/2),F=4*(((w.x+i.width/2)/i.width*(i.bufferWidth-1)|0)+((1-(w.z+i.height/2)/i.height)*(i.bufferHeight-1)|0)*i.bufferWidth),z=i.buffer[F]/255,k=i.buffer[F+1]/255,K=i.buffer[F+2]/255,oe=i.buffer[F+3]/255;y&&(z=1-z,k=1-k,K=1-K);var ae=z*f.r+k*f.g+K*f.b;w.y=oe>=v?i.minHeight+(i.maxHeight-i.minHeight)*ae:i.minHeight-Zt.a,r.push(w.x,w.y,w.z),o.push(0,0,0),u.push(e/i.subdivisions,1-t/i.subdivisions)}for(t=0;t<i.subdivisions;t++)for(e=0;e<i.subdivisions;e++){var ue=e+1+(t+1)*(i.subdivisions+1),de=e+1+t*(i.subdivisions+1),me=e+t*(i.subdivisions+1),ye=e+(t+1)*(i.subdivisions+1),Ee=r[3*ue+1]>=i.minHeight,Ae=r[3*de+1]>=i.minHeight,Ie=r[3*me+1]>=i.minHeight;Ee&&Ae&&Ie&&(n.push(ue),n.push(de),n.push(me)),r[3*ye+1]>=i.minHeight&&Ee&&Ie&&(n.push(ye),n.push(ue),n.push(me))}Tt.a.ComputeNormals(r,n,o);var Re=new Tt.a;return Re.indices=n,Re.positions=r,Re.normals=o,Re.uvs=u,Re},Ne.a.CreateGround=function(i,t,e,n,r,o){var u={width:t,height:e,subdivisions:n,updatable:o};return Go.CreateGround(i,u,r)},Ne.a.CreateTiledGround=function(i,t,e,n,r,o,u,f,v){var y={xmin:t,zmin:e,xmax:n,zmax:r,subdivisions:o,precision:u,updatable:v};return Go.CreateTiledGround(i,y,f)},Ne.a.CreateGroundFromHeightMap=function(i,t,e,n,r,o,u,f,v,y,D){var w={width:e,height:n,subdivisions:r,minHeight:o,maxHeight:u,updatable:v,onReady:y,alphaFilter:D};return Go.CreateGroundFromHeightMap(i,t,w,f)};var Go=function(){function i(){}return i.CreateGround=function(t,e,n){var r=new rh(t,n);return r._setReady(!1),r._subdivisionsX=e.subdivisionsX||e.subdivisions||1,r._subdivisionsY=e.subdivisionsY||e.subdivisions||1,r._width=e.width||1,r._height=e.height||1,r._maxX=r._width/2,r._maxZ=r._height/2,r._minX=-r._maxX,r._minZ=-r._maxZ,Tt.a.CreateGround(e).applyToMesh(r,e.updatable),r._setReady(!0),r},i.CreateTiledGround=function(t,e,n){n===void 0&&(n=null);var r=new Ne.a(t,n);return Tt.a.CreateTiledGround(e).applyToMesh(r,e.updatable),r},i.CreateGroundFromHeightMap=function(t,e,n,r){r===void 0&&(r=null);var o=n.width||10,u=n.height||10,f=n.subdivisions||1,v=n.minHeight||0,y=n.maxHeight||1,D=n.colorFilter||new M.a(.3,.59,.11),w=n.alphaFilter||0,F=n.updatable,z=n.onReady;r=r||ne.a.LastCreatedScene;var k=new rh(t,r);return k._subdivisionsX=f,k._subdivisionsY=f,k._width=o,k._height=u,k._maxX=k._width/2,k._maxZ=k._height/2,k._minX=-k._maxX,k._minZ=-k._maxZ,k._setReady(!1),et.b.LoadImage(e,function(K){var oe=K.width,ae=K.height,ue=Dp.a.CreateCanvas(oe,ae).getContext("2d");if(!ue)throw new Error("Unable to get 2d context for CreateGroundFromHeightMap");if(!r.isDisposed){ue.drawImage(K,0,0);var de=ue.getImageData(0,0,oe,ae).data;Tt.a.CreateGroundFromHeightMap({width:o,height:u,subdivisions:f,minHeight:v,maxHeight:y,colorFilter:D,buffer:de,bufferWidth:oe,bufferHeight:ae,alphaFilter:w}).applyToMesh(k,F),z&&z(k),k._setReady(!0)}},function(){},r.offlineProvider),k},i}();Tt.a.CreateTorus=function(i){for(var t=[],e=[],n=[],r=[],o=i.diameter||1,u=i.thickness||.5,f=i.tessellation||16,v=i.sideOrientation===0?0:i.sideOrientation||Tt.a.DEFAULTSIDE,y=f+1,D=0;D<=f;D++)for(var w=D/f,F=D*Math.PI*2/f-Math.PI/2,z=d.a.Translation(o/2,0,0).multiply(d.a.RotationY(F)),k=0;k<=f;k++){var K=1-k/f,oe=k*Math.PI*2/f+Math.PI,ae=Math.cos(oe),ue=Math.sin(oe),de=new d.e(ae,ue,0),me=de.scale(u/2),ye=new d.d(w,K);me=d.e.TransformCoordinates(me,z),de=d.e.TransformNormal(de,z),e.push(me.x,me.y,me.z),n.push(de.x,de.y,de.z),r.push(ye.x,ye.y);var Ee=(D+1)%y,Ae=(k+1)%y;t.push(D*y+k),t.push(D*y+Ae),t.push(Ee*y+k),t.push(D*y+Ae),t.push(Ee*y+Ae),t.push(Ee*y+k)}Tt.a._ComputeSides(v,e,t,n,r,i.frontUVs,i.backUVs);var Ie=new Tt.a;return Ie.indices=t,Ie.positions=e,Ie.normals=n,Ie.uvs=r,Ie},Ne.a.CreateTorus=function(i,t,e,n,r,o,u){var f={diameter:t,thickness:e,tessellation:n,sideOrientation:u,updatable:o};return ms.CreateTorus(i,f,r)};var tr,Ma,ms=function(){function i(){}return i.CreateTorus=function(t,e,n){var r=new Ne.a(t,n);return e.sideOrientation=Ne.a._GetDefaultSideOrientation(e.sideOrientation),r._originalBuilderSideOrientation=e.sideOrientation,Tt.a.CreateTorus(e).applyToMesh(r,e.updatable),r},i}(),zi=c(53),wp=function(){function i(){}return i.GetDefaults=function(t){var e=new i;return e.canvasOptions={antialias:!0,depth:!0,stencil:!t||t.isStencilEnable,alpha:!0,multiview:!1,framebufferScaleFactor:1},e.newCanvasCssStyle="position:absolute; bottom:0px;right:0px;z-index:10;width:90%;height:100%;background-color: #000000;",e},i}(),Dy=function(){function i(t,e){var n=this;if(e===void 0&&(e=wp.GetDefaults()),this._options=e,this._canvas=null,this.xrLayer=null,this.onXRLayerInitObservable=new S.c,this._engine=t.scene.getEngine(),e.canvasElement)this._setManagedOutputCanvas(e.canvasElement);else{var r=document.createElement("canvas");r.style.cssText=this._options.newCanvasCssStyle||"position:absolute; bottom:0px;right:0px;",this._setManagedOutputCanvas(r)}t.onXRSessionInit.add(function(){n._addCanvas()}),t.onXRSessionEnded.add(function(){n._removeCanvas()})}return i.prototype.dispose=function(){this._removeCanvas(),this._setManagedOutputCanvas(null)},i.prototype.initializeXRLayerAsync=function(t){var e=this,n=function(){var r=new XRWebGLLayer(t,e.canvasContext,e._options.canvasOptions);return e.onXRLayerInitObservable.notifyObservers(r),r};return this.canvasContext.makeXRCompatible?this.canvasContext.makeXRCompatible().then(function(){return e.xrLayer=n(),e.xrLayer}):(this.xrLayer=n(),Promise.resolve(this.xrLayer))},i.prototype._addCanvas=function(){var t=this;this._canvas&&this._canvas!==this._engine.getRenderingCanvas()&&document.body.appendChild(this._canvas),this.xrLayer?this._setCanvasSize(!0):this.onXRLayerInitObservable.addOnce(function(e){t._setCanvasSize(!0,e)})},i.prototype._removeCanvas=function(){this._canvas&&document.body.contains(this._canvas)&&this._canvas!==this._engine.getRenderingCanvas()&&document.body.removeChild(this._canvas),this._setCanvasSize(!1)},i.prototype._setCanvasSize=function(t,e){t===void 0&&(t=!0),e===void 0&&(e=this.xrLayer),this._canvas&&(t?e&&(this._canvas!==this._engine.getRenderingCanvas()?(this._canvas.style.width=e.framebufferWidth+"px",this._canvas.style.height=e.framebufferHeight+"px"):this._engine.setSize(e.framebufferWidth,e.framebufferHeight)):this._originalCanvasSize&&(this._canvas!==this._engine.getRenderingCanvas()?(this._canvas.style.width=this._originalCanvasSize.width+"px",this._canvas.style.height=this._originalCanvasSize.height+"px"):this._engine.setSize(this._originalCanvasSize.width,this._originalCanvasSize.height)))},i.prototype._setManagedOutputCanvas=function(t){this._removeCanvas(),t?(this._originalCanvasSize={width:t.offsetWidth,height:t.offsetHeight},this._canvas=t,this.canvasContext=this._canvas.getContext("webgl2"),this.canvasContext||(this.canvasContext=this._canvas.getContext("webgl"))):(this._canvas=null,this.canvasContext=null)},i}(),Lp=function(){function i(t){this.scene=t,this._sessionEnded=!1,this.baseLayer=null,this.currentTimestamp=-1,this.defaultHeightCompensation=1.7,this.onXRFrameObservable=new S.c,this.onXRReferenceSpaceChanged=new S.c,this.onXRSessionEnded=new S.c,this.onXRSessionInit=new S.c}return Object.defineProperty(i.prototype,"referenceSpace",{get:function(){return this._referenceSpace},set:function(t){this._referenceSpace=t,this.onXRReferenceSpaceChanged.notifyObservers(this._referenceSpace)},enumerable:!1,configurable:!0}),i.prototype.dispose=function(){this._sessionEnded||this.exitXRAsync(),this.onXRFrameObservable.clear(),this.onXRSessionEnded.clear(),this.onXRReferenceSpaceChanged.clear(),this.onXRSessionInit.clear()},i.prototype.exitXRAsync=function(){return this.session&&!this._sessionEnded?(this._sessionEnded=!0,this.session.end().catch(function(t){_.a.Warn("Could not end XR session.")})):Promise.resolve()},i.prototype.getRenderTargetTextureForEye=function(t){return this._rttProvider.getRenderTargetForEye(t)},i.prototype.getWebXRRenderTarget=function(t){var e=this.scene.getEngine();return this._xrNavigator.xr.native?this._xrNavigator.xr.getWebXRRenderTarget(e):((t=t||wp.GetDefaults(e)).canvasElement=e.getRenderingCanvas()||void 0,new Dy(this,t))},i.prototype.initializeAsync=function(){return this._xrNavigator=navigator,this._xrNavigator.xr?Promise.resolve():Promise.reject("WebXR not available")},i.prototype.initializeSessionAsync=function(t,e){var n=this;return t===void 0&&(t="immersive-vr"),e===void 0&&(e={}),this._xrNavigator.xr.requestSession(t,e).then(function(r){return n.session=r,n.onXRSessionInit.notifyObservers(r),n._sessionEnded=!1,n.session.addEventListener("end",function(){var o=n.scene.getEngine();n._sessionEnded=!0,n._rttProvider=null,o.framebufferDimensionsObject=null,o.restoreDefaultFramebuffer(),o.customAnimationFrameRequester=null,n.onXRSessionEnded.notifyObservers(null),o._renderLoop()},{once:!0}),n.session})},i.prototype.isSessionSupportedAsync=function(t){return i.IsSessionSupportedAsync(t)},i.prototype.resetReferenceSpace=function(){this.referenceSpace=this.baseReferenceSpace},i.prototype.runXRRenderLoop=function(){var t=this,e=this.scene.getEngine();if(e.customAnimationFrameRequester={requestAnimationFrame:this.session.requestAnimationFrame.bind(this.session),renderFunction:function(r,o){t._sessionEnded||(t.currentFrame=o,t.currentTimestamp=r,o&&(e.framebufferDimensionsObject=t.baseLayer,t.onXRFrameObservable.notifyObservers(o),e._renderLoop(),e.framebufferDimensionsObject=null))}},this._xrNavigator.xr.native)this._rttProvider=this._xrNavigator.xr.getNativeRenderTargetProvider(this.session,this._createRenderTargetTexture.bind(this));else{var n=this._createRenderTargetTexture(this.baseLayer.framebufferWidth,this.baseLayer.framebufferHeight,this.baseLayer.framebuffer);this._rttProvider={getRenderTargetForEye:function(){return n}},e.framebufferDimensionsObject=this.baseLayer}typeof window!="undefined"&&window.cancelAnimationFrame&&window.cancelAnimationFrame(e._frameHandler),e._renderLoop()},i.prototype.setReferenceSpaceTypeAsync=function(t){var e=this;return t===void 0&&(t="local-floor"),this.session.requestReferenceSpace(t).then(function(n){return n},function(n){return _.a.Error("XR.requestReferenceSpace failed for the following reason: "),_.a.Error(n),_.a.Log('Defaulting to universally-supported "viewer" reference space type.'),e.session.requestReferenceSpace("viewer").then(function(r){var o=new XRRigidTransform({x:0,y:-e.defaultHeightCompensation,z:0});return r.getOffsetReferenceSpace(o)},function(r){throw _.a.Error(r),'XR initialization failed: required "viewer" reference space type not supported.'})}).then(function(n){return e.session.requestReferenceSpace("viewer").then(function(r){return e.viewerReferenceSpace=r,n})}).then(function(n){return e.referenceSpace=e.baseReferenceSpace=n,e.referenceSpace})},i.prototype.updateRenderStateAsync=function(t){return t.baseLayer&&(this.baseLayer=t.baseLayer),this.session.updateRenderState(t)},i.IsSessionSupportedAsync=function(t){if(!navigator.xr)return Promise.resolve(!1);var e=navigator.xr.isSessionSupported||navigator.xr.supportsSession;return e?e.call(navigator.xr,t).then(function(n){var r=n===void 0||n;return Promise.resolve(r)}).catch(function(n){return _.a.Warn(n),Promise.resolve(!1)}):Promise.resolve(!1)},i.prototype._createRenderTargetTexture=function(t,e,n){n===void 0&&(n=null);var r=new Nt.a(this.scene.getEngine(),Nt.b.Unknown,!0);r.width=t,r.height=e,r._framebuffer=n;var o=new qn("XR renderTargetTexture",{width:t,height:e},this.scene,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,!0);return o._texture=r,o},i}();(function(i){i[i.ENTERING_XR=0]="ENTERING_XR",i[i.EXITING_XR=1]="EXITING_XR",i[i.IN_XR=2]="IN_XR",i[i.NOT_IN_XR=3]="NOT_IN_XR"})(tr||(tr={})),function(i){i[i.NOT_TRACKING=0]="NOT_TRACKING",i[i.TRACKING_LOST=1]="TRACKING_LOST",i[i.TRACKING=2]="TRACKING"}(Ma||(Ma={}));var Ti,wy=function(){function i(t,e){if(e===void 0&&(e=null),this.scene=t,this._pointerDownOnMeshAsked=!1,this._isActionableMesh=!1,this._teleportationRequestInitiated=!1,this._teleportationBackRequestInitiated=!1,this._rotationRightAsked=!1,this._rotationLeftAsked=!1,this._dpadPressed=!0,this._activePointer=!1,this._id=i._idCounter++,e)this._gazeTracker=e.clone("gazeTracker");else{this._gazeTracker=Ne.a.CreateTorus("gazeTracker",.0035,.0025,20,t,!1),this._gazeTracker.bakeCurrentTransformIntoVertices(),this._gazeTracker.isPickable=!1,this._gazeTracker.isVisible=!1;var n=new on.a("targetMat",t);n.specularColor=M.a.Black(),n.emissiveColor=new M.a(.7,.7,.7),n.backFaceCulling=!1,this._gazeTracker.material=n}}return i.prototype._getForwardRay=function(t){return new Qn.a(d.e.Zero(),new d.e(0,0,t))},i.prototype._selectionPointerDown=function(){this._pointerDownOnMeshAsked=!0,this._currentHit&&this.scene.simulatePointerDown(this._currentHit,{pointerId:this._id})},i.prototype._selectionPointerUp=function(){this._currentHit&&this.scene.simulatePointerUp(this._currentHit,{pointerId:this._id}),this._pointerDownOnMeshAsked=!1},i.prototype._activatePointer=function(){this._activePointer=!0},i.prototype._deactivatePointer=function(){this._activePointer=!1},i.prototype._updatePointerDistance=function(t){},i.prototype.dispose=function(){this._interactionsEnabled=!1,this._teleportationEnabled=!1,this._gazeTracker&&this._gazeTracker.dispose()},i._idCounter=0,i}(),vI=function(i){function t(e,n,r){var o=i.call(this,n,r)||this;o.webVRController=e,o._laserPointer=Ne.a.CreateCylinder("laserPointer",1,.004,2e-4,20,1,n,!1);var u=new on.a("laserPointerMat",n);if(u.emissiveColor=new M.a(.7,.7,.7),u.alpha=.6,o._laserPointer.material=u,o._laserPointer.rotation.x=Math.PI/2,o._laserPointer.position.z=-.5,o._laserPointer.isVisible=!1,o._laserPointer.isPickable=!1,!e.mesh){var f=new Ne.a("preloadControllerMesh",n),v=new Ne.a(we.POINTING_POSE,n);v.rotation.x=-.7,f.addChild(v),e.attachToMesh(f)}return o._setLaserPointerParent(e.mesh),o._meshAttachedObserver=e._meshAttachedObservable.add(function(y){o._setLaserPointerParent(y)}),o}return Object(p.d)(t,i),t.prototype._getForwardRay=function(e){return this.webVRController.getForwardRay(e)},t.prototype._activatePointer=function(){i.prototype._activatePointer.call(this),this._laserPointer.isVisible=!0},t.prototype._deactivatePointer=function(){i.prototype._deactivatePointer.call(this),this._laserPointer.isVisible=!1},t.prototype._setLaserPointerColor=function(e){this._laserPointer.material.emissiveColor=e},t.prototype._setLaserPointerLightingDisabled=function(e){this._laserPointer.material.disableLighting=e},t.prototype._setLaserPointerParent=function(e){var n=function(f){f.isPickable=!1,f.getChildMeshes().forEach(function(v){n(v)})};n(e);var r=e.getChildren(void 0,!1),o=e;this.webVRController._pointingPoseNode=null;for(var u=0;u<r.length;u++)if(r[u].name&&r[u].name.indexOf(we.POINTING_POSE)>=0){o=r[u],this.webVRController._pointingPoseNode=o;break}this._laserPointer.parent=o},t.prototype._updatePointerDistance=function(e){e===void 0&&(e=100),this._laserPointer.scaling.y=e,this._laserPointer.position.z=-e/2},t.prototype.dispose=function(){i.prototype.dispose.call(this),this._laserPointer.dispose(),this._meshAttachedObserver&&this.webVRController._meshAttachedObservable.remove(this._meshAttachedObserver)},t}(wy),Ly=function(i){function t(e,n){var r=i.call(this,n)||this;return r.getCamera=e,r}return Object(p.d)(t,i),t.prototype._getForwardRay=function(e){var n=this.getCamera();return n?n.getForwardRay(e):new Qn.a(d.e.Zero(),d.e.Forward())},t}(wy),bI=function(){},Ny=function(){function i(t,e){var n=this;if(e===void 0&&(e={}),this.webVROptions=e,this._webVRsupported=!1,this._webVRready=!1,this._webVRrequesting=!1,this._webVRpresenting=!1,this._fullscreenVRpresenting=!1,this.enableGazeEvenWhenNoPointerLock=!1,this.exitVROnDoubleTap=!0,this.onEnteringVRObservable=new S.c,this.onAfterEnteringVRObservable=new S.c,this.onExitingVRObservable=new S.c,this.onControllerMeshLoadedObservable=new S.c,this._useCustomVRButton=!1,this._teleportationRequested=!1,this._teleportActive=!1,this._floorMeshesCollection=[],this._teleportationMode=i.TELEPORTATIONMODE_CONSTANTTIME,this._teleportationTime=122,this._teleportationSpeed=20,this._rotationAllowed=!0,this._teleportBackwardsVector=new d.e(0,-1,-1),this._isDefaultTeleportationTarget=!0,this._teleportationFillColor="#444444",this._teleportationBorderColor="#FFFFFF",this._rotationAngle=0,this._haloCenter=new d.e(0,0,0),this._padSensibilityUp=.65,this._padSensibilityDown=.35,this._leftController=null,this._rightController=null,this._gazeColor=new M.a(.7,.7,.7),this._laserColor=new M.a(.7,.7,.7),this._pickedLaserColor=new M.a(.2,.2,1),this._pickedGazeColor=new M.a(0,0,1),this.onNewMeshSelected=new S.c,this.onMeshSelectedWithController=new S.c,this.onNewMeshPicked=new S.c,this.onBeforeCameraTeleport=new S.c,this.onAfterCameraTeleport=new S.c,this.onSelectedMeshUnselected=new S.c,this.teleportationEnabled=!0,this._teleportationInitialized=!1,this._interactionsEnabled=!1,this._interactionsRequested=!1,this._displayGaze=!0,this._displayLaserPointer=!0,this.updateGazeTrackerScale=!0,this.updateGazeTrackerColor=!0,this.updateControllerLaserColor=!0,this.requestPointerLockOnFullScreen=!0,this.xrTestDone=!1,this._onResize=function(){n.moveButtonToBottomRight(),n._fullscreenVRpresenting&&n._webVRready&&n.exitVR()},this._onFullscreenChange=function(){var o=document;o.fullscreen!==void 0?n._fullscreenVRpresenting=document.fullscreen:o.mozFullScreen!==void 0?n._fullscreenVRpresenting=o.mozFullScreen:o.webkitIsFullScreen!==void 0?n._fullscreenVRpresenting=o.webkitIsFullScreen:o.msIsFullScreen!==void 0?n._fullscreenVRpresenting=o.msIsFullScreen:document.msFullscreenElement!==void 0&&(n._fullscreenVRpresenting=document.msFullscreenElement),!n._fullscreenVRpresenting&&n._inputElement&&(n.exitVR(),!n._useCustomVRButton&&n._btnVR&&(n._btnVR.style.top=n._inputElement.offsetTop+n._inputElement.offsetHeight-70+"px",n._btnVR.style.left=n._inputElement.offsetLeft+n._inputElement.offsetWidth-100+"px",n.updateButtonVisibility()))},this._cachedAngularSensibility={angularSensibilityX:null,angularSensibilityY:null,angularSensibility:null},this.beforeRender=function(){n._leftController&&n._leftController._activePointer&&n._castRayAndSelectObject(n._leftController),n._rightController&&n._rightController._activePointer&&n._castRayAndSelectObject(n._rightController),n._noControllerIsActive&&(n._scene.getEngine().isPointerLock||n.enableGazeEvenWhenNoPointerLock)?n._castRayAndSelectObject(n._cameraGazer):n._cameraGazer._gazeTracker.isVisible=!1},this._onNewGamepadConnected=function(o){if(o.type!==Gn.POSE_ENABLED)o.leftStick&&o.onleftstickchanged(function(v){n._teleportationInitialized&&n.teleportationEnabled&&(!n._leftController&&!n._rightController||n._leftController&&!n._leftController._activePointer&&n._rightController&&!n._rightController._activePointer)&&(n._checkTeleportWithRay(v,n._cameraGazer),n._checkTeleportBackwards(v,n._cameraGazer))}),o.rightStick&&o.onrightstickchanged(function(v){n._teleportationInitialized&&n._checkRotate(v,n._cameraGazer)}),o.type===Gn.XBOX&&(o.onbuttondown(function(v){n._interactionsEnabled&&v===br.A&&n._cameraGazer._selectionPointerDown()}),o.onbuttonup(function(v){n._interactionsEnabled&&v===br.A&&n._cameraGazer._selectionPointerUp()}));else{var u=o,f=new vI(u,n._scene,n._cameraGazer._gazeTracker);u.hand==="right"||n._leftController&&n._leftController.webVRController!=u?n._rightController=f:n._leftController=f,n._tryEnableInteractionOnController(f)}},this._tryEnableInteractionOnController=function(o){n._interactionsRequested&&!o._interactionsEnabled&&n._enableInteractionOnController(o),n._teleportationRequested&&!o._teleportationEnabled&&n._enableTeleportationOnController(o)},this._onNewGamepadDisconnected=function(o){o instanceof zo&&(o.hand==="left"&&n._leftController!=null&&(n._leftController.dispose(),n._leftController=null),o.hand==="right"&&n._rightController!=null&&(n._rightController.dispose(),n._rightController=null))},this._workingVector=d.e.Zero(),this._workingQuaternion=d.b.Identity(),this._workingMatrix=d.a.Identity(),this._scene=t,this._inputElement=t.getEngine().getInputElement(),"getVRDisplays"in navigator||(e.useXR=!0),e.createFallbackVRDeviceOrientationFreeCamera===void 0&&(e.createFallbackVRDeviceOrientationFreeCamera=!0),e.createDeviceOrientationCamera===void 0&&(e.createDeviceOrientationCamera=!0),e.laserToggle===void 0&&(e.laserToggle=!0),e.defaultHeight===void 0&&(e.defaultHeight=1.7),e.useCustomVRButton&&(this._useCustomVRButton=!0,e.customVRButton&&(this._btnVR=e.customVRButton)),e.rayLength&&(this._rayLength=e.rayLength),this._defaultHeight=e.defaultHeight,e.positionScale&&(this._rayLength*=e.positionScale,this._defaultHeight*=e.positionScale),this._hasEnteredVR=!1,this._scene.activeCamera?this._position=this._scene.activeCamera.position.clone():this._position=new d.e(0,this._defaultHeight,0),e.createDeviceOrientationCamera||!this._scene.activeCamera){if(this._deviceOrientationCamera=new Vo("deviceOrientationVRHelper",this._position.clone(),t),this._scene.activeCamera&&(this._deviceOrientationCamera.minZ=this._scene.activeCamera.minZ,this._deviceOrientationCamera.maxZ=this._scene.activeCamera.maxZ,this._scene.activeCamera instanceof ci&&this._scene.activeCamera.rotation)){var r=this._scene.activeCamera;r.rotationQuaternion?this._deviceOrientationCamera.rotationQuaternion.copyFrom(r.rotationQuaternion):this._deviceOrientationCamera.rotationQuaternion.copyFrom(d.b.RotationYawPitchRoll(r.rotation.y,r.rotation.x,r.rotation.z)),this._deviceOrientationCamera.rotation=r.rotation.clone()}this._scene.activeCamera=this._deviceOrientationCamera,this._inputElement&&this._scene.activeCamera.attachControl()}else this._existingCamera=this._scene.activeCamera;this.webVROptions.useXR&&navigator.xr?Lp.IsSessionSupportedAsync("immersive-vr").then(function(o){o?(_.a.Log("Using WebXR. It is recommended to use the WebXRDefaultExperience directly"),t.createDefaultXRExperienceAsync({floorMeshes:e.floorMeshes||[]}).then(function(u){n.xr=u,n.xrTestDone=!0,n._cameraGazer=new Ly(function(){return n.xr.baseExperience.camera},t),n.xr.baseExperience.onStateChangedObservable.add(function(f){switch(f){case tr.ENTERING_XR:n.onEnteringVRObservable.notifyObservers(n),n._interactionsEnabled||n.xr.pointerSelection.detach(),n.xr.pointerSelection.displayLaserPointer=n._displayLaserPointer;break;case tr.EXITING_XR:n.onExitingVRObservable.notifyObservers(n),n._scene.getEngine().resize();break;case tr.IN_XR:n._hasEnteredVR=!0;break;case tr.NOT_IN_XR:n._hasEnteredVR=!1}})})):n.completeVRInit(t,e)}):this.completeVRInit(t,e)}return Object.defineProperty(i.prototype,"onEnteringVR",{get:function(){return this.onEnteringVRObservable},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"onExitingVR",{get:function(){return this.onExitingVRObservable},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"onControllerMeshLoaded",{get:function(){return this.onControllerMeshLoadedObservable},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"teleportationTarget",{get:function(){return this._teleportationTarget},set:function(t){t&&(t.name="teleportationTarget",this._isDefaultTeleportationTarget=!1,this._teleportationTarget=t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"gazeTrackerMesh",{get:function(){return this._cameraGazer._gazeTracker},set:function(t){t&&(this._cameraGazer._gazeTracker&&this._cameraGazer._gazeTracker.dispose(),this._leftController&&this._leftController._gazeTracker&&this._leftController._gazeTracker.dispose(),this._rightController&&this._rightController._gazeTracker&&this._rightController._gazeTracker.dispose(),this._cameraGazer._gazeTracker=t,this._cameraGazer._gazeTracker.bakeCurrentTransformIntoVertices(),this._cameraGazer._gazeTracker.isPickable=!1,this._cameraGazer._gazeTracker.isVisible=!1,this._cameraGazer._gazeTracker.name="gazeTracker",this._leftController&&(this._leftController._gazeTracker=this._cameraGazer._gazeTracker.clone("gazeTracker")),this._rightController&&(this._rightController._gazeTracker=this._cameraGazer._gazeTracker.clone("gazeTracker")))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"leftControllerGazeTrackerMesh",{get:function(){return this._leftController?this._leftController._gazeTracker:null},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"rightControllerGazeTrackerMesh",{get:function(){return this._rightController?this._rightController._gazeTracker:null},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"displayGaze",{get:function(){return this._displayGaze},set:function(t){this._displayGaze=t,t||(this._cameraGazer._gazeTracker.isVisible=!1,this._leftController&&(this._leftController._gazeTracker.isVisible=!1),this._rightController&&(this._rightController._gazeTracker.isVisible=!1))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"displayLaserPointer",{get:function(){return this._displayLaserPointer},set:function(t){this._displayLaserPointer=t,t?(this._rightController&&this._rightController._activatePointer(),this._leftController&&this._leftController._activatePointer()):(this._rightController&&(this._rightController._deactivatePointer(),this._rightController._gazeTracker.isVisible=!1),this._leftController&&(this._leftController._deactivatePointer(),this._leftController._gazeTracker.isVisible=!1))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"deviceOrientationCamera",{get:function(){return this._deviceOrientationCamera},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"currentVRCamera",{get:function(){return this._webVRready?this._webVRCamera:this._scene.activeCamera},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"webVRCamera",{get:function(){return this._webVRCamera},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"vrDeviceOrientationCamera",{get:function(){return this._vrDeviceOrientationCamera},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"vrButton",{get:function(){return this._btnVR},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"_teleportationRequestInitiated",{get:function(){return this._cameraGazer._teleportationRequestInitiated||this._leftController!==null&&this._leftController._teleportationRequestInitiated||this._rightController!==null&&this._rightController._teleportationRequestInitiated},enumerable:!1,configurable:!0}),i.prototype.completeVRInit=function(t,e){var n=this;if(this.xrTestDone=!0,e.createFallbackVRDeviceOrientationFreeCamera&&(e.useMultiview&&(e.vrDeviceOrientationCameraMetrics||(e.vrDeviceOrientationCameraMetrics=ps.GetDefault()),e.vrDeviceOrientationCameraMetrics.multiviewEnabled=!0),this._vrDeviceOrientationCamera=new Ju("VRDeviceOrientationVRHelper",this._position,this._scene,!0,e.vrDeviceOrientationCameraMetrics),this._vrDeviceOrientationCamera.angularSensibility=Number.MAX_VALUE),this._webVRCamera=new th("WebVRHelper",this._position,this._scene,e),this._webVRCamera.useStandingMatrix(),this._cameraGazer=new Ly(function(){return n.currentVRCamera},t),!this._useCustomVRButton){this._btnVR=document.createElement("BUTTON"),this._btnVR.className="babylonVRicon",this._btnVR.id="babylonVRiconbtn",this._btnVR.title="Click to switch to VR";var r=".babylonVRicon { position: absolute; right: 20px; height: 50px; width: 80px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%222048%22%20height%3D%221152%22%20viewBox%3D%220%200%202048%201152%22%20version%3D%221.1%22%3E%3Cpath%20transform%3D%22rotate%28180%201024%2C576.0000000000001%29%22%20d%3D%22m1109%2C896q17%2C0%2030%2C-12t13%2C-30t-12.5%2C-30.5t-30.5%2C-12.5l-170%2C0q-18%2C0%20-30.5%2C12.5t-12.5%2C30.5t13%2C30t30%2C12l170%2C0zm-85%2C256q59%2C0%20132.5%2C-1.5t154.5%2C-5.5t164.5%2C-11.5t163%2C-20t150%2C-30t124.5%2C-41.5q23%2C-11%2042%2C-24t38%2C-30q27%2C-25%2041%2C-61.5t14%2C-72.5l0%2C-257q0%2C-123%20-47%2C-232t-128%2C-190t-190%2C-128t-232%2C-47l-81%2C0q-37%2C0%20-68.5%2C14t-60.5%2C34.5t-55.5%2C45t-53%2C45t-53%2C34.5t-55.5%2C14t-55.5%2C-14t-53%2C-34.5t-53%2C-45t-55.5%2C-45t-60.5%2C-34.5t-68.5%2C-14l-81%2C0q-123%2C0%20-232%2C47t-190%2C128t-128%2C190t-47%2C232l0%2C257q0%2C68%2038%2C115t97%2C73q54%2C24%20124.5%2C41.5t150%2C30t163%2C20t164.5%2C11.5t154.5%2C5.5t132.5%2C1.5zm939%2C-298q0%2C39%20-24.5%2C67t-58.5%2C42q-54%2C23%20-122%2C39.5t-143.5%2C28t-155.5%2C19t-157%2C11t-148.5%2C5t-129.5%2C1.5q-59%2C0%20-130%2C-1.5t-148%2C-5t-157%2C-11t-155.5%2C-19t-143.5%2C-28t-122%2C-39.5q-34%2C-14%20-58.5%2C-42t-24.5%2C-67l0%2C-257q0%2C-106%2040.5%2C-199t110%2C-162.5t162.5%2C-109.5t199%2C-40l81%2C0q27%2C0%2052%2C14t50%2C34.5t51%2C44.5t55.5%2C44.5t63.5%2C34.5t74%2C14t74%2C-14t63.5%2C-34.5t55.5%2C-44.5t51%2C-44.5t50%2C-34.5t52%2C-14l14%2C0q37%2C0%2070%2C0.5t64.5%2C4.5t63.5%2C12t68%2C23q71%2C30%20128.5%2C78.5t98.5%2C110t63.5%2C133.5t22.5%2C149l0%2C257z%22%20fill%3D%22white%22%20/%3E%3C/svg%3E%0A":"https://cdn.babylonjs.com/Assets/vrButton.png")+"); background-size: 80%; background-repeat:no-repeat; background-position: center; border: none; outline: none; transition: transform 0.125s ease-out } .babylonVRicon:hover { transform: scale(1.05) } .babylonVRicon:active {background-color: rgba(51,51,51,1) } .babylonVRicon:focus {background-color: rgba(51,51,51,1) }";r+=".babylonVRicon.vrdisplaypresenting { display: none; }";var o=document.createElement("style");o.appendChild(document.createTextNode(r)),document.getElementsByTagName("head")[0].appendChild(o),this.moveButtonToBottomRight()}this._btnVR&&this._btnVR.addEventListener("click",function(){n.isInVRMode?n._scene.getEngine().disableVR():n.enterVR()});var u=this._scene.getEngine().getHostWindow();u&&(u.addEventListener("resize",this._onResize),document.addEventListener("fullscreenchange",this._onFullscreenChange,!1),document.addEventListener("mozfullscreenchange",this._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",this._onFullscreenChange,!1),document.addEventListener("msfullscreenchange",this._onFullscreenChange,!1),document.onmsfullscreenchange=this._onFullscreenChange,e.createFallbackVRDeviceOrientationFreeCamera?this.displayVRButton():this._scene.getEngine().onVRDisplayChangedObservable.add(function(f){f.vrDisplay&&n.displayVRButton()}),this._onKeyDown=function(f){f.keyCode===27&&n.isInVRMode&&n.exitVR()},document.addEventListener("keydown",this._onKeyDown),this._scene.onPrePointerObservable.add(function(){n._hasEnteredVR&&n.exitVROnDoubleTap&&(n.exitVR(),n._fullscreenVRpresenting&&n._scene.getEngine().exitFullscreen())},Ot.a.POINTERDOUBLETAP,!1),this._onVRDisplayChanged=function(f){return n.onVRDisplayChanged(f)},this._onVrDisplayPresentChange=function(){return n.onVrDisplayPresentChange()},this._onVRRequestPresentStart=function(){n._webVRrequesting=!0,n.updateButtonVisibility()},this._onVRRequestPresentComplete=function(){n._webVRrequesting=!1,n.updateButtonVisibility()},t.getEngine().onVRDisplayChangedObservable.add(this._onVRDisplayChanged),t.getEngine().onVRRequestPresentStart.add(this._onVRRequestPresentStart),t.getEngine().onVRRequestPresentComplete.add(this._onVRRequestPresentComplete),u.addEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChange),t.onDisposeObservable.add(function(){n.dispose()}),this._webVRCamera.onControllerMeshLoadedObservable.add(function(f){return n._onDefaultMeshLoaded(f)}),this._scene.gamepadManager.onGamepadConnectedObservable.add(this._onNewGamepadConnected),this._scene.gamepadManager.onGamepadDisconnectedObservable.add(this._onNewGamepadDisconnected),this.updateButtonVisibility(),this._circleEase=new ct,this._circleEase.setEasingMode(Ke.EASINGMODE_EASEINOUT),this._teleportationEasing=this._circleEase,t.onPointerObservable.add(function(f){n._interactionsEnabled&&t.activeCamera===n.vrDeviceOrientationCamera&&f.event.pointerType==="mouse"&&(f.type===Ot.a.POINTERDOWN?n._cameraGazer._selectionPointerDown():f.type===Ot.a.POINTERUP&&n._cameraGazer._selectionPointerUp())}),this.webVROptions.floorMeshes&&this.enableTeleportation({floorMeshes:this.webVROptions.floorMeshes}))},i.prototype._onDefaultMeshLoaded=function(t){this._leftController&&this._leftController.webVRController==t&&t.mesh&&this._leftController._setLaserPointerParent(t.mesh),this._rightController&&this._rightController.webVRController==t&&t.mesh&&this._rightController._setLaserPointerParent(t.mesh);try{this.onControllerMeshLoadedObservable.notifyObservers(t)}catch(e){_.a.Warn("Error in your custom logic onControllerMeshLoaded: "+e)}},Object.defineProperty(i.prototype,"isInVRMode",{get:function(){return this.xr&&this.webVROptions.useXR&&this.xr.baseExperience.state===tr.IN_XR||this._webVRpresenting||this._fullscreenVRpresenting},enumerable:!1,configurable:!0}),i.prototype.onVrDisplayPresentChange=function(){var t=this._scene.getEngine().getVRDevice();if(t){var e=this._webVRpresenting;this._webVRpresenting=t.isPresenting,e&&!this._webVRpresenting&&this.exitVR()}else _.a.Warn("Detected VRDisplayPresentChange on an unknown VRDisplay. Did you can enterVR on the vrExperienceHelper?");this.updateButtonVisibility()},i.prototype.onVRDisplayChanged=function(t){this._webVRsupported=t.vrSupported,this._webVRready=!!t.vrDisplay,this._webVRpresenting=t.vrDisplay&&t.vrDisplay.isPresenting,this.updateButtonVisibility()},i.prototype.moveButtonToBottomRight=function(){if(this._inputElement&&!this._useCustomVRButton&&this._btnVR){var t=this._inputElement.getBoundingClientRect();this._btnVR.style.top=t.top+t.height-70+"px",this._btnVR.style.left=t.left+t.width-100+"px"}},i.prototype.displayVRButton=function(){this._useCustomVRButton||this._btnVRDisplayed||!this._btnVR||(document.body.appendChild(this._btnVR),this._btnVRDisplayed=!0)},i.prototype.updateButtonVisibility=function(){this._btnVR&&!this._useCustomVRButton&&(this._btnVR.className="babylonVRicon",this.isInVRMode?this._btnVR.className+=" vrdisplaypresenting":(this._webVRready&&(this._btnVR.className+=" vrdisplayready"),this._webVRsupported&&(this._btnVR.className+=" vrdisplaysupported"),this._webVRrequesting&&(this._btnVR.className+=" vrdisplayrequesting")))},i.prototype.enterVR=function(){var t=this;if(this.xr)this.xr.baseExperience.enterXRAsync("immersive-vr","local-floor",this.xr.renderTarget);else{if(this.onEnteringVRObservable)try{this.onEnteringVRObservable.notifyObservers(this)}catch(o){_.a.Warn("Error in your custom logic onEnteringVR: "+o)}if(this._scene.activeCamera){if(this._position=this._scene.activeCamera.position.clone(),this.vrDeviceOrientationCamera&&(this.vrDeviceOrientationCamera.rotation=d.b.FromRotationMatrix(this._scene.activeCamera.getWorldMatrix().getRotationMatrix()).toEulerAngles(),this.vrDeviceOrientationCamera.angularSensibility=2e3),this.webVRCamera){var e=this.webVRCamera.deviceRotationQuaternion.toEulerAngles().y,n=d.b.FromRotationMatrix(this._scene.activeCamera.getWorldMatrix().getRotationMatrix()).toEulerAngles().y-e,r=this.webVRCamera.rotationQuaternion.toEulerAngles().y;this.webVRCamera.rotationQuaternion=d.b.FromEulerAngles(0,r+n,0)}this._existingCamera=this._scene.activeCamera,this._existingCamera.angularSensibilityX&&(this._cachedAngularSensibility.angularSensibilityX=this._existingCamera.angularSensibilityX,this._existingCamera.angularSensibilityX=Number.MAX_VALUE),this._existingCamera.angularSensibilityY&&(this._cachedAngularSensibility.angularSensibilityY=this._existingCamera.angularSensibilityY,this._existingCamera.angularSensibilityY=Number.MAX_VALUE),this._existingCamera.angularSensibility&&(this._cachedAngularSensibility.angularSensibility=this._existingCamera.angularSensibility,this._existingCamera.angularSensibility=Number.MAX_VALUE)}this._webVRrequesting||(this._webVRready?this._webVRpresenting||(this._scene.getEngine().onVRRequestPresentComplete.addOnce(function(o){t.onAfterEnteringVRObservable.notifyObservers({success:o})}),this._webVRCamera.position=this._position,this._scene.activeCamera=this._webVRCamera):this._vrDeviceOrientationCamera&&(this._vrDeviceOrientationCamera.position=this._position,this._scene.activeCamera&&(this._vrDeviceOrientationCamera.minZ=this._scene.activeCamera.minZ),this._scene.activeCamera=this._vrDeviceOrientationCamera,this._scene.getEngine().enterFullscreen(this.requestPointerLockOnFullScreen),this.updateButtonVisibility(),this._vrDeviceOrientationCamera.onViewMatrixChangedObservable.addOnce(function(){t.onAfterEnteringVRObservable.notifyObservers({success:!0})})),this._scene.activeCamera&&this._inputElement&&this._scene.activeCamera.attachControl(),this._interactionsEnabled&&this._scene.registerBeforeRender(this.beforeRender),this._displayLaserPointer&&[this._leftController,this._rightController].forEach(function(o){o&&o._activatePointer()}),this._hasEnteredVR=!0)}},i.prototype.exitVR=function(){if(this.xr)this.xr.baseExperience.exitXRAsync();else if(this._hasEnteredVR){if(this.onExitingVRObservable)try{this.onExitingVRObservable.notifyObservers(this)}catch(e){_.a.Warn("Error in your custom logic onExitingVR: "+e)}this._webVRpresenting&&this._scene.getEngine().disableVR(),this._scene.activeCamera&&(this._position=this._scene.activeCamera.position.clone()),this.vrDeviceOrientationCamera&&(this.vrDeviceOrientationCamera.angularSensibility=Number.MAX_VALUE),this._deviceOrientationCamera?(this._deviceOrientationCamera.position=this._position,this._scene.activeCamera=this._deviceOrientationCamera,this._cachedAngularSensibility.angularSensibilityX&&(this._deviceOrientationCamera.angularSensibilityX=this._cachedAngularSensibility.angularSensibilityX,this._cachedAngularSensibility.angularSensibilityX=null),this._cachedAngularSensibility.angularSensibilityY&&(this._deviceOrientationCamera.angularSensibilityY=this._cachedAngularSensibility.angularSensibilityY,this._cachedAngularSensibility.angularSensibilityY=null),this._cachedAngularSensibility.angularSensibility&&(this._deviceOrientationCamera.angularSensibility=this._cachedAngularSensibility.angularSensibility,this._cachedAngularSensibility.angularSensibility=null)):this._existingCamera&&(this._existingCamera.position=this._position,this._scene.activeCamera=this._existingCamera,this._inputElement&&this._scene.activeCamera.attachControl(),this._cachedAngularSensibility.angularSensibilityX&&(this._existingCamera.angularSensibilityX=this._cachedAngularSensibility.angularSensibilityX,this._cachedAngularSensibility.angularSensibilityX=null),this._cachedAngularSensibility.angularSensibilityY&&(this._existingCamera.angularSensibilityY=this._cachedAngularSensibility.angularSensibilityY,this._cachedAngularSensibility.angularSensibilityY=null),this._cachedAngularSensibility.angularSensibility&&(this._existingCamera.angularSensibility=this._cachedAngularSensibility.angularSensibility,this._cachedAngularSensibility.angularSensibility=null)),this.updateButtonVisibility(),this._interactionsEnabled&&(this._scene.unregisterBeforeRender(this.beforeRender),this._cameraGazer._gazeTracker.isVisible=!1,this._leftController&&(this._leftController._gazeTracker.isVisible=!1),this._rightController&&(this._rightController._gazeTracker.isVisible=!1)),this._scene.getEngine().resize(),[this._leftController,this._rightController].forEach(function(e){e&&e._deactivatePointer()}),this._hasEnteredVR=!1;var t=this._scene.getEngine();t._onVrDisplayPresentChange&&t._onVrDisplayPresentChange()}},Object.defineProperty(i.prototype,"position",{get:function(){return this._position},set:function(t){this._position=t,this._scene.activeCamera&&(this._scene.activeCamera.position=t)},enumerable:!1,configurable:!0}),i.prototype.enableInteractions=function(){var t=this;if(!this._interactionsEnabled){if(this._interactionsRequested=!0,this.xr)return void(this.xr.baseExperience.state===tr.IN_XR&&this.xr.pointerSelection.attach());this._leftController&&this._enableInteractionOnController(this._leftController),this._rightController&&this._enableInteractionOnController(this._rightController),this.raySelectionPredicate=function(e){return e.isVisible&&(e.isPickable||e.name===t._floorMeshName)},this.meshSelectionPredicate=function(){return!0},this._raySelectionPredicate=function(e){return!!(t._isTeleportationFloor(e)||e.name.indexOf("gazeTracker")===-1&&e.name.indexOf("teleportationTarget")===-1&&e.name.indexOf("torusTeleportation")===-1)&&t.raySelectionPredicate(e)},this._interactionsEnabled=!0}},Object.defineProperty(i.prototype,"_noControllerIsActive",{get:function(){return!(this._leftController&&this._leftController._activePointer||this._rightController&&this._rightController._activePointer)},enumerable:!1,configurable:!0}),i.prototype._isTeleportationFloor=function(t){for(var e=0;e<this._floorMeshesCollection.length;e++)if(this._floorMeshesCollection[e].id===t.id)return!0;return!(!this._floorMeshName||t.name!==this._floorMeshName)},i.prototype.addFloorMesh=function(t){this._floorMeshesCollection&&(this._floorMeshesCollection.indexOf(t)>-1||this._floorMeshesCollection.push(t))},i.prototype.removeFloorMesh=function(t){if(this._floorMeshesCollection){var e=this._floorMeshesCollection.indexOf(t);e!==-1&&this._floorMeshesCollection.splice(e,1)}},i.prototype.enableTeleportation=function(t){var e=this;if(t===void 0&&(t={}),!this._teleportationInitialized){if(this._teleportationRequested=!0,this.enableInteractions(),this.webVROptions.useXR&&(t.floorMeshes||t.floorMeshName)){var n=t.floorMeshes||[];if(!n.length){var r=this._scene.getMeshByName(t.floorMeshName);r&&n.push(r)}if(this.xr)return n.forEach(function(f){e.xr.teleportation.addFloorMesh(f)}),void(this.xr.teleportation.attached||this.xr.teleportation.attach());if(!this.xrTestDone){var o=function(){e.xrTestDone&&(e._scene.unregisterBeforeRender(o),e.xr?e.xr.teleportation.attached||e.xr.teleportation.attach():e.enableTeleportation(t))};return void this._scene.registerBeforeRender(o)}}t.floorMeshName&&(this._floorMeshName=t.floorMeshName),t.floorMeshes&&(this._floorMeshesCollection=t.floorMeshes),t.teleportationMode&&(this._teleportationMode=t.teleportationMode),t.teleportationTime&&t.teleportationTime>0&&(this._teleportationTime=t.teleportationTime),t.teleportationSpeed&&t.teleportationSpeed>0&&(this._teleportationSpeed=t.teleportationSpeed),t.easingFunction!==void 0&&(this._teleportationEasing=t.easingFunction),this._leftController!=null&&this._enableTeleportationOnController(this._leftController),this._rightController!=null&&this._enableTeleportationOnController(this._rightController);var u=new fr.a;u.vignetteColor=new M.b(0,0,0,0),u.vignetteEnabled=!0,this._postProcessMove=new nh("postProcessMove",1,this._webVRCamera,void 0,void 0,void 0,void 0,u),this._webVRCamera.detachPostProcess(this._postProcessMove),this._teleportationInitialized=!0,this._isDefaultTeleportationTarget&&(this._createTeleportationCircles(),this._teleportationTarget.scaling.scaleInPlace(this._webVRCamera.deviceScaleFactor))}},i.prototype._enableInteractionOnController=function(t){var e=this;t.webVRController.mesh&&(t._interactionsEnabled=!0,this.isInVRMode&&this._displayLaserPointer&&t._activatePointer(),this.webVROptions.laserToggle&&t.webVRController.onMainButtonStateChangedObservable.add(function(n){e._displayLaserPointer&&n.value===1&&(t._activePointer?t._deactivatePointer():t._activatePointer(),e.displayGaze&&(t._gazeTracker.isVisible=t._activePointer))}),t.webVRController.onTriggerStateChangedObservable.add(function(n){var r=t;e._noControllerIsActive&&(r=e._cameraGazer),r._pointerDownOnMeshAsked?n.value<e._padSensibilityDown&&r._selectionPointerUp():n.value>e._padSensibilityUp&&r._selectionPointerDown()}))},i.prototype._checkTeleportWithRay=function(t,e){this._teleportationRequestInitiated&&!e._teleportationRequestInitiated||(e._teleportationRequestInitiated?Math.sqrt(t.y*t.y+t.x*t.x)<this._padSensibilityDown&&(this._teleportActive&&this.teleportCamera(this._haloCenter),e._teleportationRequestInitiated=!1):t.y<-this._padSensibilityUp&&e._dpadPressed&&(e._activatePointer(),e._teleportationRequestInitiated=!0))},i.prototype._checkRotate=function(t,e){e._teleportationRequestInitiated||(e._rotationLeftAsked?t.x>-this._padSensibilityDown&&(e._rotationLeftAsked=!1):t.x<-this._padSensibilityUp&&e._dpadPressed&&(e._rotationLeftAsked=!0,this._rotationAllowed&&this._rotateCamera(!1)),e._rotationRightAsked?t.x<this._padSensibilityDown&&(e._rotationRightAsked=!1):t.x>this._padSensibilityUp&&e._dpadPressed&&(e._rotationRightAsked=!0,this._rotationAllowed&&this._rotateCamera(!0)))},i.prototype._checkTeleportBackwards=function(t,e){if(!e._teleportationRequestInitiated)if(t.y>this._padSensibilityUp&&e._dpadPressed){if(!e._teleportationBackRequestInitiated){if(!this.currentVRCamera)return;var n=d.b.FromRotationMatrix(this.currentVRCamera.getWorldMatrix().getRotationMatrix()),r=this.currentVRCamera.position;this.currentVRCamera.devicePosition&&this.currentVRCamera.deviceRotationQuaternion&&(n=this.currentVRCamera.deviceRotationQuaternion,r=this.currentVRCamera.devicePosition),n.toEulerAnglesToRef(this._workingVector),this._workingVector.z=0,this._workingVector.x=0,d.b.RotationYawPitchRollToRef(this._workingVector.y,this._workingVector.x,this._workingVector.z,this._workingQuaternion),this._workingQuaternion.toRotationMatrix(this._workingMatrix),d.e.TransformCoordinatesToRef(this._teleportBackwardsVector,this._workingMatrix,this._workingVector);var o=new Qn.a(r,this._workingVector),u=this._scene.pickWithRay(o,this._raySelectionPredicate);u&&u.pickedPoint&&u.pickedMesh&&this._isTeleportationFloor(u.pickedMesh)&&u.distance<5&&this.teleportCamera(u.pickedPoint),e._teleportationBackRequestInitiated=!0}}else e._teleportationBackRequestInitiated=!1},i.prototype._enableTeleportationOnController=function(t){var e=this;t.webVRController.mesh&&(t._interactionsEnabled||this._enableInteractionOnController(t),t._interactionsEnabled=!0,t._teleportationEnabled=!0,t.webVRController.controllerType===Zr.VIVE&&(t._dpadPressed=!1,t.webVRController.onPadStateChangedObservable.add(function(n){t._dpadPressed=n.pressed,t._dpadPressed||(t._rotationLeftAsked=!1,t._rotationRightAsked=!1,t._teleportationBackRequestInitiated=!1)})),t.webVRController.onPadValuesChangedObservable.add(function(n){e.teleportationEnabled&&(e._checkTeleportBackwards(n,t),e._checkTeleportWithRay(n,t)),e._checkRotate(n,t)}))},i.prototype._createTeleportationCircles=function(){this._teleportationTarget=Ne.a.CreateGround("teleportationTarget",2,2,2,this._scene),this._teleportationTarget.isPickable=!1;var t=new io.a("DynamicTexture",512,this._scene,!0);t.hasAlpha=!0;var e=t.getContext();e.beginPath(),e.arc(256,256,200,0,2*Math.PI,!1),e.fillStyle=this._teleportationFillColor,e.fill(),e.lineWidth=10,e.strokeStyle=this._teleportationBorderColor,e.stroke(),e.closePath(),t.update();var n=new on.a("TextPlaneMaterial",this._scene);n.diffuseTexture=t,this._teleportationTarget.material=n;var r=Ne.a.CreateTorus("torusTeleportation",.75,.1,25,this._scene,!1);r.isPickable=!1,r.parent=this._teleportationTarget;var o=new H("animationInnerCircle","position.y",30,H.ANIMATIONTYPE_FLOAT,H.ANIMATIONLOOPMODE_CYCLE),u=[];u.push({frame:0,value:0}),u.push({frame:30,value:.4}),u.push({frame:60,value:0}),o.setKeys(u);var f=new fn;f.setEasingMode(Ke.EASINGMODE_EASEINOUT),o.setEasingFunction(f),r.animations=[],r.animations.push(o),this._scene.beginAnimation(r,0,60,!0),this._hideTeleportationTarget()},i.prototype._displayTeleportationTarget=function(){this._teleportActive=!0,this._teleportationInitialized&&(this._teleportationTarget.isVisible=!0,this._isDefaultTeleportationTarget&&(this._teleportationTarget.getChildren()[0].isVisible=!0))},i.prototype._hideTeleportationTarget=function(){this._teleportActive=!1,this._teleportationInitialized&&(this._teleportationTarget.isVisible=!1,this._isDefaultTeleportationTarget&&(this._teleportationTarget.getChildren()[0].isVisible=!1))},i.prototype._rotateCamera=function(t){var e=this;if(this.currentVRCamera instanceof Cr){t?this._rotationAngle++:this._rotationAngle--,this.currentVRCamera.animations=[];var n=d.b.FromRotationMatrix(d.a.RotationY(Math.PI/4*this._rotationAngle)),r=new H("animationRotation","rotationQuaternion",90,H.ANIMATIONTYPE_QUATERNION,H.ANIMATIONLOOPMODE_CONSTANT),o=[];o.push({frame:0,value:this.currentVRCamera.rotationQuaternion}),o.push({frame:6,value:n}),r.setKeys(o),r.setEasingFunction(this._circleEase),this.currentVRCamera.animations.push(r),this._postProcessMove.animations=[];var u=new H("animationPP","vignetteWeight",90,H.ANIMATIONTYPE_FLOAT,H.ANIMATIONLOOPMODE_CONSTANT),f=[];f.push({frame:0,value:0}),f.push({frame:3,value:4}),f.push({frame:6,value:0}),u.setKeys(f),u.setEasingFunction(this._circleEase),this._postProcessMove.animations.push(u);var v=new H("animationPP2","vignetteStretch",90,H.ANIMATIONTYPE_FLOAT,H.ANIMATIONLOOPMODE_CONSTANT),y=[];y.push({frame:0,value:0}),y.push({frame:3,value:10}),y.push({frame:6,value:0}),v.setKeys(y),v.setEasingFunction(this._circleEase),this._postProcessMove.animations.push(v),this._postProcessMove.imageProcessingConfiguration.vignetteWeight=0,this._postProcessMove.imageProcessingConfiguration.vignetteStretch=0,this._postProcessMove.samples=4,this._webVRCamera.attachPostProcess(this._postProcessMove),this._scene.beginAnimation(this._postProcessMove,0,6,!1,1,function(){e._webVRCamera.detachPostProcess(e._postProcessMove)}),this._scene.beginAnimation(this.currentVRCamera,0,6,!1,1)}},i.prototype._moveTeleportationSelectorTo=function(t,e,n){if(t.pickedPoint){e._teleportationRequestInitiated&&(this._displayTeleportationTarget(),this._haloCenter.copyFrom(t.pickedPoint),this._teleportationTarget.position.copyFrom(t.pickedPoint));var r=this._convertNormalToDirectionOfRay(t.getNormal(!0,!1),n);if(r){var o=d.e.Cross(Se.a.Y,r),u=d.e.Cross(r,o);d.e.RotationFromAxisToRef(u,r,o,this._teleportationTarget.rotation)}this._teleportationTarget.position.y+=.1}},i.prototype.teleportCamera=function(t){var e=this;if(this.currentVRCamera instanceof Cr){this.webVRCamera.leftCamera?(this._workingVector.copyFrom(this.webVRCamera.leftCamera.globalPosition),this._workingVector.subtractInPlace(this.webVRCamera.position),t.subtractToRef(this._workingVector,this._workingVector)):this._workingVector.copyFrom(t),this.isInVRMode?this._workingVector.y+=this.webVRCamera.deviceDistanceToRoomGround()*this._webVRCamera.deviceScaleFactor:this._workingVector.y+=this._defaultHeight,this.onBeforeCameraTeleport.notifyObservers(this._workingVector);var n,r;if(this._teleportationMode==i.TELEPORTATIONMODE_CONSTANTSPEED){r=90;var o=d.e.Distance(this.currentVRCamera.position,this._workingVector);n=this._teleportationSpeed/o}else r=Math.round(90*this._teleportationTime/1e3),n=1;this.currentVRCamera.animations=[];var u=new H("animationCameraTeleportation","position",90,H.ANIMATIONTYPE_VECTOR3,H.ANIMATIONLOOPMODE_CONSTANT),f=[{frame:0,value:this.currentVRCamera.position},{frame:r,value:this._workingVector}];u.setKeys(f),u.setEasingFunction(this._teleportationEasing),this.currentVRCamera.animations.push(u),this._postProcessMove.animations=[];var v=Math.round(r/2),y=new H("animationPP","vignetteWeight",90,H.ANIMATIONTYPE_FLOAT,H.ANIMATIONLOOPMODE_CONSTANT),D=[];D.push({frame:0,value:0}),D.push({frame:v,value:8}),D.push({frame:r,value:0}),y.setKeys(D),this._postProcessMove.animations.push(y);var w=new H("animationPP2","vignetteStretch",90,H.ANIMATIONTYPE_FLOAT,H.ANIMATIONLOOPMODE_CONSTANT),F=[];F.push({frame:0,value:0}),F.push({frame:v,value:10}),F.push({frame:r,value:0}),w.setKeys(F),this._postProcessMove.animations.push(w),this._postProcessMove.imageProcessingConfiguration.vignetteWeight=0,this._postProcessMove.imageProcessingConfiguration.vignetteStretch=0,this._webVRCamera.attachPostProcess(this._postProcessMove),this._scene.beginAnimation(this._postProcessMove,0,r,!1,n,function(){e._webVRCamera.detachPostProcess(e._postProcessMove)}),this._scene.beginAnimation(this.currentVRCamera,0,r,!1,n,function(){e.onAfterCameraTeleport.notifyObservers(e._workingVector)}),this._hideTeleportationTarget()}},i.prototype._convertNormalToDirectionOfRay=function(t,e){return t&&Math.acos(d.e.Dot(t,e.direction))<Math.PI/2&&t.scaleInPlace(-1),t},i.prototype._castRayAndSelectObject=function(t){if(this.currentVRCamera instanceof Cr){var e=t._getForwardRay(this._rayLength),n=this._scene.pickWithRay(e,this._raySelectionPredicate);if(n&&(t._laserPointer&&(n.originMesh=t._laserPointer.parent),this._scene.simulatePointerMove(n,{pointerId:t._id})),t._currentHit=n,n&&n.pickedPoint){if(this._displayGaze){var r=1;t._gazeTracker.isVisible=!0,t._isActionableMesh&&(r=3),this.updateGazeTrackerScale&&(t._gazeTracker.scaling.x=n.distance*r,t._gazeTracker.scaling.y=n.distance*r,t._gazeTracker.scaling.z=n.distance*r);var o=this._convertNormalToDirectionOfRay(n.getNormal(),e);if(o){var u=d.e.Cross(Se.a.Y,o),f=d.e.Cross(o,u);d.e.RotationFromAxisToRef(f,o,u,t._gazeTracker.rotation)}t._gazeTracker.position.copyFrom(n.pickedPoint),t._gazeTracker.position.x<0?t._gazeTracker.position.x+=.002:t._gazeTracker.position.x-=.002,t._gazeTracker.position.y<0?t._gazeTracker.position.y+=.002:t._gazeTracker.position.y-=.002,t._gazeTracker.position.z<0?t._gazeTracker.position.z+=.002:t._gazeTracker.position.z-=.002}t._updatePointerDistance(n.distance)}else t._updatePointerDistance(),t._gazeTracker.isVisible=!1;if(n&&n.pickedMesh){if(this._teleportationInitialized&&this._isTeleportationFloor(n.pickedMesh)&&n.pickedPoint)return t._currentMeshSelected&&!this._isTeleportationFloor(t._currentMeshSelected)&&this._notifySelectedMeshUnselected(t._currentMeshSelected),t._currentMeshSelected=null,void(t._teleportationRequestInitiated&&this._moveTeleportationSelectorTo(n,t,e));if(n.pickedMesh!==t._currentMeshSelected)if(this.meshSelectionPredicate(n.pickedMesh)){this.onNewMeshPicked.notifyObservers(n),t._currentMeshSelected=n.pickedMesh,n.pickedMesh.isPickable&&n.pickedMesh.actionManager?(this.changeGazeColor(this._pickedGazeColor),this.changeLaserColor(this._pickedLaserColor),t._isActionableMesh=!0):(this.changeGazeColor(this._gazeColor),this.changeLaserColor(this._laserColor),t._isActionableMesh=!1);try{this.onNewMeshSelected.notifyObservers(n.pickedMesh);var v=t;v.webVRController&&this.onMeshSelectedWithController.notifyObservers({mesh:n.pickedMesh,controller:v.webVRController})}catch(y){_.a.Warn("Error while raising onNewMeshSelected or onMeshSelectedWithController: "+y)}}else this._notifySelectedMeshUnselected(t._currentMeshSelected),t._currentMeshSelected=null,this.changeGazeColor(this._gazeColor),this.changeLaserColor(this._laserColor)}else this._notifySelectedMeshUnselected(t._currentMeshSelected),t._currentMeshSelected=null,this.changeGazeColor(this._gazeColor),this.changeLaserColor(this._laserColor)}},i.prototype._notifySelectedMeshUnselected=function(t){t&&this.onSelectedMeshUnselected.notifyObservers(t)},i.prototype.setLaserColor=function(t,e){e===void 0&&(e=this._pickedLaserColor),this._laserColor=t,this._pickedLaserColor=e},i.prototype.setLaserLightingState=function(t){t===void 0&&(t=!0),this._leftController&&this._leftController._setLaserPointerLightingDisabled(!t),this._rightController&&this._rightController._setLaserPointerLightingDisabled(!t)},i.prototype.setGazeColor=function(t,e){e===void 0&&(e=this._pickedGazeColor),this._gazeColor=t,this._pickedGazeColor=e},i.prototype.changeLaserColor=function(t){this.updateControllerLaserColor&&(this._leftController&&this._leftController._setLaserPointerColor(t),this._rightController&&this._rightController._setLaserPointerColor(t))},i.prototype.changeGazeColor=function(t){this.updateGazeTrackerColor&&this._cameraGazer._gazeTracker.material&&(this._cameraGazer._gazeTracker.material.emissiveColor=t,this._leftController&&(this._leftController._gazeTracker.material.emissiveColor=t),this._rightController&&(this._rightController._gazeTracker.material.emissiveColor=t))},i.prototype.dispose=function(){this.isInVRMode&&this.exitVR(),this._postProcessMove&&this._postProcessMove.dispose(),this._webVRCamera&&this._webVRCamera.dispose(),this._vrDeviceOrientationCamera&&this._vrDeviceOrientationCamera.dispose(),!this._useCustomVRButton&&this._btnVR&&this._btnVR.parentNode&&document.body.removeChild(this._btnVR),this._deviceOrientationCamera&&this._scene.activeCamera!=this._deviceOrientationCamera&&this._deviceOrientationCamera.dispose(),this._cameraGazer&&this._cameraGazer.dispose(),this._leftController&&this._leftController.dispose(),this._rightController&&this._rightController.dispose(),this._teleportationTarget&&this._teleportationTarget.dispose(),this.xr&&this.xr.dispose(),this._floorMeshesCollection=[],document.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChange),window.removeEventListener("resize",this._onResize),document.removeEventListener("fullscreenchange",this._onFullscreenChange),document.removeEventListener("mozfullscreenchange",this._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",this._onFullscreenChange),document.removeEventListener("msfullscreenchange",this._onFullscreenChange),document.onmsfullscreenchange=null,this._scene.getEngine().onVRDisplayChangedObservable.removeCallback(this._onVRDisplayChanged),this._scene.getEngine().onVRRequestPresentStart.removeCallback(this._onVRRequestPresentStart),this._scene.getEngine().onVRRequestPresentComplete.removeCallback(this._onVRRequestPresentComplete),window.removeEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChange),this._scene.gamepadManager.onGamepadConnectedObservable.removeCallback(this._onNewGamepadConnected),this._scene.gamepadManager.onGamepadDisconnectedObservable.removeCallback(this._onNewGamepadDisconnected),this._scene.unregisterBeforeRender(this.beforeRender)},i.prototype.getClassName=function(){return"VRExperienceHelper"},i.TELEPORTATIONMODE_CONSTANTTIME=0,i.TELEPORTATIONMODE_CONSTANTSPEED=1,i}(),_s=c(64),gs=(Ti={root:0,found:!1},function(i,t,e,n){Ti.root=0,Ti.found=!1;var r=t*t-4*i*e;if(r<0)return Ti;var o=Math.sqrt(r),u=(-t-o)/(2*i),f=(-t+o)/(2*i);if(u>f){var v=f;f=u,u=v}return u>0&&u<n?(Ti.root=u,Ti.found=!0,Ti):(f>0&&f<n&&(Ti.root=f,Ti.found=!0),Ti)}),Fy=function(){function i(){this._collisionPoint=d.e.Zero(),this._planeIntersectionPoint=d.e.Zero(),this._tempVector=d.e.Zero(),this._tempVector2=d.e.Zero(),this._tempVector3=d.e.Zero(),this._tempVector4=d.e.Zero(),this._edge=d.e.Zero(),this._baseToVertex=d.e.Zero(),this._destinationPoint=d.e.Zero(),this._slidePlaneNormal=d.e.Zero(),this._displacementVector=d.e.Zero(),this._radius=d.e.One(),this._retry=0,this._basePointWorld=d.e.Zero(),this._velocityWorld=d.e.Zero(),this._normalizedVelocity=d.e.Zero(),this._collisionMask=-1}return Object.defineProperty(i.prototype,"collisionMask",{get:function(){return this._collisionMask},set:function(t){this._collisionMask=isNaN(t)?-1:t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"slidePlaneNormal",{get:function(){return this._slidePlaneNormal},enumerable:!1,configurable:!0}),i.prototype._initialize=function(t,e,n){this._velocity=e,d.e.NormalizeToRef(e,this._normalizedVelocity),this._basePoint=t,t.multiplyToRef(this._radius,this._basePointWorld),e.multiplyToRef(this._radius,this._velocityWorld),this._velocityWorldLength=this._velocityWorld.length(),this._epsilon=n,this.collisionFound=!1},i.prototype._checkPointInTriangle=function(t,e,n,r,o){e.subtractToRef(t,this._tempVector),n.subtractToRef(t,this._tempVector2),d.e.CrossToRef(this._tempVector,this._tempVector2,this._tempVector4);var u=d.e.Dot(this._tempVector4,o);return!(u<0)&&(r.subtractToRef(t,this._tempVector3),d.e.CrossToRef(this._tempVector2,this._tempVector3,this._tempVector4),!((u=d.e.Dot(this._tempVector4,o))<0)&&(d.e.CrossToRef(this._tempVector3,this._tempVector,this._tempVector4),(u=d.e.Dot(this._tempVector4,o))>=0))},i.prototype._canDoCollision=function(t,e,n,r){var o=d.e.Distance(this._basePointWorld,t),u=Math.max(this._radius.x,this._radius.y,this._radius.z);return!(o>this._velocityWorldLength+u+e)&&!!function(f,v,y,D){return!(f.x>y.x+D)&&!(y.x-D>v.x)&&!(f.y>y.y+D)&&!(y.y-D>v.y)&&!(f.z>y.z+D)&&!(y.z-D>v.z)}(n,r,this._basePointWorld,this._velocityWorldLength+u)},i.prototype._testTriangle=function(t,e,n,r,o,u,f){var v,y=!1;e||(e=[]),e[t]||(e[t]=new _s.a(0,0,0,0),e[t].copyFromPoints(n,r,o));var D=e[t];if(u||D.isFrontFacingTo(this._normalizedVelocity,0)){var w=D.signedDistanceTo(this._basePoint),F=d.e.Dot(D.normal,this._velocity);if(F==0){if(Math.abs(w)>=1)return;y=!0,v=0}else{var z=(1-w)/F;if((v=(-1-w)/F)>z){var k=z;z=v,v=k}if(v>1||z<0)return;v<0&&(v=0),v>1&&(v=1)}this._collisionPoint.copyFromFloats(0,0,0);var K=!1,oe=1;if(y||(this._basePoint.subtractToRef(D.normal,this._planeIntersectionPoint),this._velocity.scaleToRef(v,this._tempVector),this._planeIntersectionPoint.addInPlace(this._tempVector),this._checkPointInTriangle(this._planeIntersectionPoint,n,r,o,D.normal)&&(K=!0,oe=v,this._collisionPoint.copyFrom(this._planeIntersectionPoint))),!K){var ae=this._velocity.lengthSquared(),ue=ae;this._basePoint.subtractToRef(n,this._tempVector);var de=2*d.e.Dot(this._velocity,this._tempVector),me=this._tempVector.lengthSquared()-1,ye=gs(ue,de,me,oe);ye.found&&(oe=ye.root,K=!0,this._collisionPoint.copyFrom(n)),this._basePoint.subtractToRef(r,this._tempVector),de=2*d.e.Dot(this._velocity,this._tempVector),me=this._tempVector.lengthSquared()-1,(ye=gs(ue,de,me,oe)).found&&(oe=ye.root,K=!0,this._collisionPoint.copyFrom(r)),this._basePoint.subtractToRef(o,this._tempVector),de=2*d.e.Dot(this._velocity,this._tempVector),me=this._tempVector.lengthSquared()-1,(ye=gs(ue,de,me,oe)).found&&(oe=ye.root,K=!0,this._collisionPoint.copyFrom(o)),r.subtractToRef(n,this._edge),n.subtractToRef(this._basePoint,this._baseToVertex);var Ee=this._edge.lengthSquared(),Ae=d.e.Dot(this._edge,this._velocity),Ie=d.e.Dot(this._edge,this._baseToVertex);if(ue=Ee*-ae+Ae*Ae,de=Ee*(2*d.e.Dot(this._velocity,this._baseToVertex))-2*Ae*Ie,me=Ee*(1-this._baseToVertex.lengthSquared())+Ie*Ie,(ye=gs(ue,de,me,oe)).found){var Re=(Ae*ye.root-Ie)/Ee;Re>=0&&Re<=1&&(oe=ye.root,K=!0,this._edge.scaleInPlace(Re),n.addToRef(this._edge,this._collisionPoint))}o.subtractToRef(r,this._edge),r.subtractToRef(this._basePoint,this._baseToVertex),Ee=this._edge.lengthSquared(),Ae=d.e.Dot(this._edge,this._velocity),Ie=d.e.Dot(this._edge,this._baseToVertex),ue=Ee*-ae+Ae*Ae,de=Ee*(2*d.e.Dot(this._velocity,this._baseToVertex))-2*Ae*Ie,me=Ee*(1-this._baseToVertex.lengthSquared())+Ie*Ie,(ye=gs(ue,de,me,oe)).found&&(Re=(Ae*ye.root-Ie)/Ee)>=0&&Re<=1&&(oe=ye.root,K=!0,this._edge.scaleInPlace(Re),r.addToRef(this._edge,this._collisionPoint)),n.subtractToRef(o,this._edge),o.subtractToRef(this._basePoint,this._baseToVertex),Ee=this._edge.lengthSquared(),Ae=d.e.Dot(this._edge,this._velocity),Ie=d.e.Dot(this._edge,this._baseToVertex),ue=Ee*-ae+Ae*Ae,de=Ee*(2*d.e.Dot(this._velocity,this._baseToVertex))-2*Ae*Ie,me=Ee*(1-this._baseToVertex.lengthSquared())+Ie*Ie,(ye=gs(ue,de,me,oe)).found&&(Re=(Ae*ye.root-Ie)/Ee)>=0&&Re<=1&&(oe=ye.root,K=!0,this._edge.scaleInPlace(Re),o.addToRef(this._edge,this._collisionPoint))}if(K){var Pe=oe*this._velocity.length();(!this.collisionFound||Pe<this._nearestDistance)&&(f.collisionResponse&&(this.intersectionPoint?this.intersectionPoint.copyFrom(this._collisionPoint):this.intersectionPoint=this._collisionPoint.clone(),this._nearestDistance=Pe,this.collisionFound=!0),this.collidedMesh=f)}}},i.prototype._collide=function(t,e,n,r,o,u,f,v){if(n&&n.length!==0)for(y=r;y<o;y+=3)D=e[n[y]-u],w=e[n[y+1]-u],F=e[n[y+2]-u],this._testTriangle(y,t,F,w,D,f,v);else for(var y=0;y<e.length;y+=3){var D=e[y],w=e[y+1],F=e[y+2];this._testTriangle(y,t,F,w,D,f,v)}},i.prototype._getResponse=function(t,e){t.addToRef(e,this._destinationPoint),e.scaleInPlace(this._nearestDistance/e.length()),this._basePoint.addToRef(e,t),t.subtractToRef(this.intersectionPoint,this._slidePlaneNormal),this._slidePlaneNormal.normalize(),this._slidePlaneNormal.scaleToRef(this._epsilon,this._displacementVector),t.addInPlace(this._displacementVector),this.intersectionPoint.addInPlace(this._displacementVector),this._slidePlaneNormal.scaleInPlace(_s.a.SignedDistanceToPlaneFromPositionAndNormal(this.intersectionPoint,this._slidePlaneNormal,this._destinationPoint)),this._destinationPoint.subtractInPlace(this._slidePlaneNormal),this._destinationPoint.subtractToRef(this.intersectionPoint,e)},i}(),By=function(){function i(){this._scaledPosition=d.e.Zero(),this._scaledVelocity=d.e.Zero(),this._finalPosition=d.e.Zero()}return i.prototype.getNewPosition=function(t,e,n,r,o,u,f){t.divideToRef(n._radius,this._scaledPosition),e.divideToRef(n._radius,this._scaledVelocity),n.collidedMesh=null,n._retry=0,n._initialVelocity=this._scaledVelocity,n._initialPosition=this._scaledPosition,this._collideWithWorld(this._scaledPosition,this._scaledVelocity,n,r,this._finalPosition,o),this._finalPosition.multiplyInPlace(n._radius),u(f,this._finalPosition,n.collidedMesh)},i.prototype.createCollider=function(){return new Fy},i.prototype.init=function(t){this._scene=t},i.prototype._collideWithWorld=function(t,e,n,r,o,u){u===void 0&&(u=null);var f=10*Ge.a.CollisionsEpsilon;if(n._retry>=r)o.copyFrom(t);else{var v=u?u.collisionMask:n.collisionMask;n._initialize(t,e,f);for(var y=u&&u.surroundingMeshes||this._scene.meshes,D=0;D<y.length;D++){var w=y[D];w.isEnabled()&&w.checkCollisions&&w.subMeshes&&w!==u&&(v&w.collisionGroup)!=0&&w._checkCollision(n)}n.collisionFound?(e.x===0&&e.y===0&&e.z===0||n._getResponse(t,e),e.length()<=f?o.copyFrom(t):(n._retry++,this._collideWithWorld(t,e,n,r,o,u))):t.addToRef(e,o)}},i}();he.a.CollisionCoordinatorFactory=function(){return new By};var Ia=c(54),yI=c(114),TI=c(147),Np=c(103),Ho=c(43),Uy=c(113),Vy=function(){function i(t,e,n,r,o,u){this.entries=new Array,this._boundingVectors=new Array,this._capacity=n,this._depth=r,this._maxDepth=o,this._creationFunc=u,this._minPoint=t,this._maxPoint=e,this._boundingVectors.push(t.clone()),this._boundingVectors.push(e.clone()),this._boundingVectors.push(t.clone()),this._boundingVectors[2].x=e.x,this._boundingVectors.push(t.clone()),this._boundingVectors[3].y=e.y,this._boundingVectors.push(t.clone()),this._boundingVectors[4].z=e.z,this._boundingVectors.push(e.clone()),this._boundingVectors[5].z=t.z,this._boundingVectors.push(e.clone()),this._boundingVectors[6].x=t.x,this._boundingVectors.push(e.clone()),this._boundingVectors[7].y=t.y}return Object.defineProperty(i.prototype,"capacity",{get:function(){return this._capacity},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"minPoint",{get:function(){return this._minPoint},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"maxPoint",{get:function(){return this._maxPoint},enumerable:!1,configurable:!0}),i.prototype.addEntry=function(t){if(this.blocks)for(var e=0;e<this.blocks.length;e++)this.blocks[e].addEntry(t);else this._creationFunc(t,this),this.entries.length>this.capacity&&this._depth<this._maxDepth&&this.createInnerBlocks()},i.prototype.removeEntry=function(t){if(this.blocks)for(var e=0;e<this.blocks.length;e++)this.blocks[e].removeEntry(t);else{var n=this.entries.indexOf(t);n>-1&&this.entries.splice(n,1)}},i.prototype.addEntries=function(t){for(var e=0;e<t.length;e++){var n=t[e];this.addEntry(n)}},i.prototype.select=function(t,e,n){if(Np.a.IsInFrustum(this._boundingVectors,t)){if(this.blocks){for(var r=0;r<this.blocks.length;r++)this.blocks[r].select(t,e,n);return}n?e.concat(this.entries):e.concatWithNoDuplicate(this.entries)}},i.prototype.intersects=function(t,e,n,r){if(Np.a.IntersectsSphere(this._minPoint,this._maxPoint,t,e)){if(this.blocks){for(var o=0;o<this.blocks.length;o++)this.blocks[o].intersects(t,e,n,r);return}r?n.concat(this.entries):n.concatWithNoDuplicate(this.entries)}},i.prototype.intersectsRay=function(t,e){if(t.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.blocks){for(var n=0;n<this.blocks.length;n++)this.blocks[n].intersectsRay(t,e);return}e.concatWithNoDuplicate(this.entries)}},i.prototype.createInnerBlocks=function(){i._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc)},i._CreateBlocks=function(t,e,n,r,o,u,f,v){f.blocks=new Array;for(var y=new d.e((e.x-t.x)/2,(e.y-t.y)/2,(e.z-t.z)/2),D=0;D<2;D++)for(var w=0;w<2;w++)for(var F=0;F<2;F++){var z=new i(t.add(y.multiplyByFloats(D,w,F)),t.add(y.multiplyByFloats(D+1,w+1,F+1)),r,o+1,u,v);z.addEntries(n),f.blocks.push(z)}},i}(),Jc=function(){function i(t,e,n){n===void 0&&(n=2),this.maxDepth=n,this.dynamicContent=new Array,this._maxBlockCapacity=e||64,this._selectionContent=new Hn.b(1024),this._creationFunc=t}return i.prototype.update=function(t,e,n){Vy._CreateBlocks(t,e,n,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)},i.prototype.addMesh=function(t){for(var e=0;e<this.blocks.length;e++)this.blocks[e].addEntry(t)},i.prototype.removeMesh=function(t){for(var e=0;e<this.blocks.length;e++)this.blocks[e].removeEntry(t)},i.prototype.select=function(t,e){this._selectionContent.reset();for(var n=0;n<this.blocks.length;n++)this.blocks[n].select(t,this._selectionContent,e);return e?this._selectionContent.concat(this.dynamicContent):this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},i.prototype.intersects=function(t,e,n){this._selectionContent.reset();for(var r=0;r<this.blocks.length;r++)this.blocks[r].intersects(t,e,this._selectionContent,n);return n?this._selectionContent.concat(this.dynamicContent):this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},i.prototype.intersectsRay=function(t){this._selectionContent.reset();for(var e=0;e<this.blocks.length;e++)this.blocks[e].intersectsRay(t,this._selectionContent);return this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},i.CreationFuncForMeshes=function(t,e){var n=t.getBoundingInfo();!t.isBlocked&&n.boundingBox.intersectsMinMax(e.minPoint,e.maxPoint)&&e.entries.push(t)},i.CreationFuncForSubMeshes=function(t,e){t.getBoundingInfo().boundingBox.intersectsMinMax(e.minPoint,e.maxPoint)&&e.entries.push(t)},i}();he.a.prototype.createOrUpdateSelectionOctree=function(i,t){i===void 0&&(i=64),t===void 0&&(t=2);var e=this._getComponent(dt.a.NAME_OCTREE);e||(e=new kp(this),this._addComponent(e)),this._selectionOctree||(this._selectionOctree=new Jc(Jc.CreationFuncForMeshes,i,t));var n=this.getWorldExtends();return this._selectionOctree.update(n.min,n.max,this.meshes),this._selectionOctree},Object.defineProperty(he.a.prototype,"selectionOctree",{get:function(){return this._selectionOctree},enumerable:!0,configurable:!0}),jt.a.prototype.createOrUpdateSubmeshesOctree=function(i,t){i===void 0&&(i=64),t===void 0&&(t=2);var e=this.getScene(),n=e._getComponent(dt.a.NAME_OCTREE);n||(n=new kp(e),e._addComponent(n)),this._submeshesOctree||(this._submeshesOctree=new Jc(Jc.CreationFuncForSubMeshes,i,t)),this.computeWorldMatrix(!0);var r=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(r.minimumWorld,r.maximumWorld,this.subMeshes),this._submeshesOctree};var En,Fp,Bp,Up,Vp,kp=function(){function i(t){this.name=dt.a.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new Qn.a(d.e.Zero(),new d.e(1,1,1)),this.scene=t,this.scene.getActiveMeshCandidates=this.getActiveMeshCandidates.bind(this),this.scene.getActiveSubMeshCandidates=this.getActiveSubMeshCandidates.bind(this),this.scene.getCollidingSubMeshCandidates=this.getCollidingSubMeshCandidates.bind(this),this.scene.getIntersectingSubMeshCandidates=this.getIntersectingSubMeshCandidates.bind(this)}return i.prototype.register=function(){var t=this;this.scene.onMeshRemovedObservable.add(function(e){var n=t.scene.selectionOctree;if(n!=null){var r=n.dynamicContent.indexOf(e);r!==-1&&n.dynamicContent.splice(r,1)}}),this.scene.onMeshImportedObservable.add(function(e){var n=t.scene.selectionOctree;n!=null&&n.addMesh(e)})},i.prototype.getActiveMeshCandidates=function(){return this.scene._selectionOctree?this.scene._selectionOctree.select(this.scene.frustumPlanes):this.scene._getDefaultMeshCandidates()},i.prototype.getActiveSubMeshCandidates=function(t){return t._submeshesOctree&&t.useOctreeForRenderingSelection?t._submeshesOctree.select(this.scene.frustumPlanes):this.scene._getDefaultSubMeshCandidates(t)},i.prototype.getIntersectingSubMeshCandidates=function(t,e){return t._submeshesOctree&&t.useOctreeForPicking?(Qn.a.TransformToRef(e,t.getWorldMatrix(),this._tempRay),t._submeshesOctree.intersectsRay(this._tempRay)):this.scene._getDefaultSubMeshCandidates(t)},i.prototype.getCollidingSubMeshCandidates=function(t,e){if(t._submeshesOctree&&t.useOctreeForCollisions){var n=e._velocityWorldLength+Math.max(e._radius.x,e._radius.y,e._radius.z);return t._submeshesOctree.intersects(e._basePointWorld,n)}return this.scene._getDefaultSubMeshCandidates(t)},i.prototype.rebuild=function(){},i.prototype.dispose=function(){},i}(),Da=c(99);(function(i){i[i.Generic=0]="Generic",i[i.Keyboard=1]="Keyboard",i[i.Mouse=2]="Mouse",i[i.Touch=3]="Touch",i[i.DualShock=4]="DualShock",i[i.Xbox=5]="Xbox",i[i.Switch=6]="Switch"})(En||(En={})),function(i){i[i.Horizontal=0]="Horizontal",i[i.Vertical=1]="Vertical",i[i.LeftClick=2]="LeftClick",i[i.MiddleClick=3]="MiddleClick",i[i.RightClick=4]="RightClick",i[i.BrowserBack=5]="BrowserBack",i[i.BrowserForward=6]="BrowserForward"}(Fp||(Fp={})),function(i){i[i.Cross=0]="Cross",i[i.Circle=1]="Circle",i[i.Square=2]="Square",i[i.Triangle=3]="Triangle",i[i.L1=4]="L1",i[i.R1=5]="R1",i[i.L2=6]="L2",i[i.R2=7]="R2",i[i.Share=8]="Share",i[i.Options=9]="Options",i[i.L3=10]="L3",i[i.R3=11]="R3",i[i.DPadUp=12]="DPadUp",i[i.DPadDown=13]="DPadDown",i[i.DPadLeft=14]="DPadLeft",i[i.DPadRight=15]="DPadRight",i[i.Home=16]="Home",i[i.TouchPad=17]="TouchPad",i[i.LStickXAxis=18]="LStickXAxis",i[i.LStickYAxis=19]="LStickYAxis",i[i.RStickXAxis=20]="RStickXAxis",i[i.RStickYAxis=21]="RStickYAxis"}(Bp||(Bp={})),function(i){i[i.A=0]="A",i[i.B=1]="B",i[i.X=2]="X",i[i.Y=3]="Y",i[i.LB=4]="LB",i[i.RB=5]="RB",i[i.LT=6]="LT",i[i.RT=7]="RT",i[i.Back=8]="Back",i[i.Start=9]="Start",i[i.LS=10]="LS",i[i.RS=11]="RS",i[i.DPadUp=12]="DPadUp",i[i.DPadDown=13]="DPadDown",i[i.DPadLeft=14]="DPadLeft",i[i.DPadRight=15]="DPadRight",i[i.Home=16]="Home",i[i.LStickXAxis=17]="LStickXAxis",i[i.LStickYAxis=18]="LStickYAxis",i[i.RStickXAxis=19]="RStickXAxis",i[i.RStickYAxis=20]="RStickYAxis"}(Up||(Up={})),function(i){i[i.B=0]="B",i[i.A=1]="A",i[i.Y=2]="Y",i[i.X=3]="X",i[i.L=4]="L",i[i.R=5]="R",i[i.ZL=6]="ZL",i[i.ZR=7]="ZR",i[i.Minus=8]="Minus",i[i.Plus=9]="Plus",i[i.LS=10]="LS",i[i.RS=11]="RS",i[i.DPadUp=12]="DPadUp",i[i.DPadDown=13]="DPadDown",i[i.DPadLeft=14]="DPadLeft",i[i.DPadRight=15]="DPadRight",i[i.Home=16]="Home",i[i.Capture=17]="Capture",i[i.LStickXAxis=18]="LStickXAxis",i[i.LStickYAxis=19]="LStickYAxis",i[i.RStickXAxis=20]="RStickXAxis",i[i.RStickYAxis=21]="RStickYAxis"}(Vp||(Vp={}));var ky=function(){function i(t){this.onDeviceDisconnected=function(){},this._inputs=[],this._keyboardActive=!1,this._pointerActive=!1,this._keyboardDownEvent=function(n){},this._keyboardUpEvent=function(n){},this._pointerMoveEvent=function(n){},this._pointerDownEvent=function(n){},this._pointerUpEvent=function(n){},this._gamepadConnectedEvent=function(n){},this._gamepadDisconnectedEvent=function(n){},this._onDeviceConnected=function(){};var e=t.getInputElement();e&&(this._elementToAttachTo=e,this._handleKeyActions(),this._handlePointerActions(),this._handleGamepadActions(),this._checkForConnectedDevices())}return Object.defineProperty(i.prototype,"onDeviceConnected",{get:function(){return this._onDeviceConnected},set:function(t){this._onDeviceConnected=t;for(var e=0;e<this._inputs.length;e++)if(this._inputs[e])for(var n=0;n<this._inputs[e].length;n++)this._inputs[e][n]&&this._onDeviceConnected(e,n)},enumerable:!1,configurable:!0}),i.Create=function(t){return typeof _native!="undefined"&&_native.DeviceInputSystem?new _native.DeviceInputSystem(t):new i(t)},i.prototype.pollInput=function(t,e,n){var r=this._inputs[t][e];if(!r)throw"Unable to find device "+En[t];if(this._updateDevice(t,e,n),r[n]===void 0)throw"Unable to find input "+n+" for device "+En[t]+" in slot "+e;return r[n]},i.prototype.dispose=function(){this._keyboardActive&&(window.removeEventListener("keydown",this._keyboardDownEvent),window.removeEventListener("keyup",this._keyboardUpEvent)),this._pointerActive&&(this._elementToAttachTo.removeEventListener("pointermove",this._pointerMoveEvent),this._elementToAttachTo.removeEventListener("pointerdown",this._pointerDownEvent),this._elementToAttachTo.removeEventListener("pointerup",this._pointerUpEvent)),window.removeEventListener("gamepadconnected",this._gamepadConnectedEvent),window.removeEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)},i.prototype._checkForConnectedDevices=function(){for(var t=0,e=navigator.getGamepads();t<e.length;t++){var n=e[t];n&&this._addGamePad(n)}matchMedia("(pointer:fine)").matches&&this._addPointerDevice(En.Mouse,0,0,0)},i.prototype._addGamePad=function(t){var e=this._getGamepadDeviceType(t.id),n=t.index;this._registerDevice(e,n,t.buttons.length+t.axes.length),this._gamepads=this._gamepads||new Array(t.index+1),this._gamepads[n]=e},i.prototype._addPointerDevice=function(t,e,n,r){this._pointerActive=!0,this._registerDevice(t,e,i._MAX_POINTER_INPUTS);var o=this._inputs[t][e];o[0]=n,o[1]=r},i.prototype._registerDevice=function(t,e,n){if(this._inputs[t]||(this._inputs[t]=[]),!this._inputs[t][e]){for(var r=new Array(n),o=0;o<n;o++)r[o]=0;this._inputs[t][e]=r,this.onDeviceConnected(t,e)}},i.prototype._unregisterDevice=function(t,e){this._inputs[t][e]&&(delete this._inputs[t][e],this.onDeviceDisconnected(t,e))},i.prototype._handleKeyActions=function(){var t=this;this._keyboardDownEvent=function(e){t._keyboardActive||(t._keyboardActive=!0,t._registerDevice(En.Keyboard,0,i._MAX_KEYCODES));var n=t._inputs[En.Keyboard][0];n&&(t.onInputChanged&&t.onInputChanged(En.Keyboard,0,e.keyCode,n[e.keyCode],1),n[e.keyCode]=1)},this._keyboardUpEvent=function(e){var n=t._inputs[En.Keyboard][0];n&&(t.onInputChanged&&t.onInputChanged(En.Keyboard,0,e.keyCode,n[e.keyCode],0),n[e.keyCode]=0)},window.addEventListener("keydown",this._keyboardDownEvent),window.addEventListener("keyup",this._keyboardUpEvent)},i.prototype._handlePointerActions=function(){var t=this;this._pointerMoveEvent=function(e){var n=e.pointerType=="mouse"?En.Mouse:En.Touch,r=e.pointerType=="mouse"?0:e.pointerId;t._inputs[n]||(t._inputs[n]=[]),t._inputs[n][r]||t._addPointerDevice(n,r,e.clientX,e.clientY);var o=t._inputs[n][r];o&&(t.onInputChanged&&(t.onInputChanged(n,r,0,o[0],e.clientX),t.onInputChanged(n,r,1,o[1],e.clientY)),o[0]=e.clientX,o[1]=e.clientY)},this._pointerDownEvent=function(e){var n=e.pointerType=="mouse"?En.Mouse:En.Touch,r=e.pointerType=="mouse"?0:e.pointerId;t._inputs[n]||(t._inputs[n]=[]),t._inputs[n][r]||t._addPointerDevice(n,r,e.clientX,e.clientY);var o=t._inputs[n][r];o&&(t.onInputChanged&&(t.onInputChanged(n,r,0,o[0],e.clientX),t.onInputChanged(n,r,1,o[1],e.clientY),t.onInputChanged(n,r,e.button+2,o[e.button+2],1)),o[0]=e.clientX,o[1]=e.clientY,o[e.button+2]=1)},this._pointerUpEvent=function(e){var n=e.pointerType=="mouse"?En.Mouse:En.Touch,r=e.pointerType=="mouse"?0:e.pointerId,o=t._inputs[n][r];o&&(t.onInputChanged&&t.onInputChanged(n,r,e.button+2,o[e.button+2],0),o[0]=e.clientX,o[1]=e.clientY,o[e.button+2]=0),e.pointerType!="mouse"&&t._unregisterDevice(n,r)},this._elementToAttachTo.addEventListener("pointermove",this._pointerMoveEvent),this._elementToAttachTo.addEventListener("pointerdown",this._pointerDownEvent),this._elementToAttachTo.addEventListener("pointerup",this._pointerUpEvent)},i.prototype._handleGamepadActions=function(){var t=this;this._gamepadConnectedEvent=function(e){t._addGamePad(e.gamepad)},this._gamepadDisconnectedEvent=function(e){if(t._gamepads){var n=t._getGamepadDeviceType(e.gamepad.id),r=e.gamepad.index;t._unregisterDevice(n,r),delete t._gamepads[r]}},window.addEventListener("gamepadconnected",this._gamepadConnectedEvent),window.addEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)},i.prototype._updateDevice=function(t,e,n){var r=navigator.getGamepads()[e];if(r&&t==this._gamepads[e]){var o=this._inputs[t][e];n>=r.buttons.length?o[n]=r.axes[n-r.buttons.length].valueOf():o[n]=r.buttons[n].value}},i.prototype._getGamepadDeviceType=function(t){return t.indexOf("054c")!==-1?En.DualShock:t.indexOf("Xbox One")!==-1||t.search("Xbox 360")!==-1||t.search("xinput")!==-1?En.Xbox:t.indexOf("057e")!==-1?En.Switch:En.Generic},i._MAX_KEYCODES=255,i._MAX_POINTER_INPUTS=7,i}(),jy=function(){function i(t,e,n){n===void 0&&(n=0),this.deviceType=e,this.deviceSlot=n,this.onInputChangedObservable=new S.c,this._deviceInputSystem=t}return i.prototype.getInput=function(t){return this._deviceInputSystem.pollInput(this.deviceType,this.deviceSlot,t)},i}(),EI=function(){function i(t){var e=this;this.onDeviceConnectedObservable=new S.c(function(r){e.getDevices().forEach(function(o){e.onDeviceConnectedObservable.notifyObserver(r,o)})}),this.onDeviceDisconnectedObservable=new S.c;var n=Object.keys(En).length/2;this._devices=new Array(n),this._firstDevice=new Array(n),this._deviceInputSystem=ky.Create(t),this._deviceInputSystem.onDeviceConnected=function(r,o){e._addDevice(r,o),e.onDeviceConnectedObservable.notifyObservers(e.getDeviceSource(r,o))},this._deviceInputSystem.onDeviceDisconnected=function(r,o){var u=e.getDeviceSource(r,o);e._removeDevice(r,o),e.onDeviceDisconnectedObservable.notifyObservers(u)},this._deviceInputSystem.onInputChanged||(this._deviceInputSystem.onInputChanged=function(r,o,u,f,v){var y;(y=e.getDeviceSource(r,o))===null||y===void 0||y.onInputChangedObservable.notifyObservers({inputIndex:u,previousState:f,currentState:v})})}return i.prototype.getDeviceSource=function(t,e){if(e===void 0){if(this._firstDevice[t]===void 0)return null;e=this._firstDevice[t]}return this._devices[t]&&this._devices[t][e]!==void 0?this._devices[t][e]:null},i.prototype.getDeviceSources=function(t){return this._devices[t].filter(function(e){return!!e})},i.prototype.getDevices=function(){var t=new Array;return this._devices.forEach(function(e){t.push.apply(t,e)}),t},i.prototype.dispose=function(){this.onDeviceConnectedObservable.clear(),this.onDeviceDisconnectedObservable.clear(),this._deviceInputSystem.dispose()},i.prototype._addDevice=function(t,e){this._devices[t]||(this._devices[t]=new Array),this._devices[t][e]||(this._devices[t][e]=new jy(this._deviceInputSystem,t,e),this._updateFirstDevices(t))},i.prototype._removeDevice=function(t,e){delete this._devices[t][e],this._updateFirstDevices(t)},i.prototype._updateFirstDevices=function(t){switch(t){case En.Keyboard:case En.Mouse:this._firstDevice[t]=0;break;case En.Touch:case En.DualShock:case En.Xbox:case En.Switch:case En.Generic:var e=this._devices[t];delete this._firstDevice[t];for(var n=0;n<e.length;n++)if(e[n]){this._firstDevice[t]=n;break}}},i}(),zy=c(168),Gy=(c(123),function(){this._timeElapsedQueryEnded=!1}),Hy=function(){this.occlusionInternalRetryCounter=0,this.isOcclusionQueryInProgress=!1,this.isOccluded=!1,this.occlusionRetryCount=-1,this.occlusionType=jt.a.OCCLUSION_TYPE_NONE,this.occlusionQueryAlgorithmType=jt.a.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE};Ge.a.prototype.createQuery=function(){return this._gl.createQuery()},Ge.a.prototype.deleteQuery=function(i){return this._gl.deleteQuery(i),this},Ge.a.prototype.isQueryResultAvailable=function(i){return this._gl.getQueryParameter(i,this._gl.QUERY_RESULT_AVAILABLE)},Ge.a.prototype.getQueryResult=function(i){return this._gl.getQueryParameter(i,this._gl.QUERY_RESULT)},Ge.a.prototype.beginOcclusionQuery=function(i,t){var e=this._getGlAlgorithmType(i);return this._gl.beginQuery(e,t),this},Ge.a.prototype.endOcclusionQuery=function(i){var t=this._getGlAlgorithmType(i);return this._gl.endQuery(t),this},Ge.a.prototype._createTimeQuery=function(){var i=this.getCaps().timerQuery;return i.createQueryEXT?i.createQueryEXT():this.createQuery()},Ge.a.prototype._deleteTimeQuery=function(i){var t=this.getCaps().timerQuery;t.deleteQueryEXT?t.deleteQueryEXT(i):this.deleteQuery(i)},Ge.a.prototype._getTimeQueryResult=function(i){var t=this.getCaps().timerQuery;return t.getQueryObjectEXT?t.getQueryObjectEXT(i,t.QUERY_RESULT_EXT):this.getQueryResult(i)},Ge.a.prototype._getTimeQueryAvailability=function(i){var t=this.getCaps().timerQuery;return t.getQueryObjectEXT?t.getQueryObjectEXT(i,t.QUERY_RESULT_AVAILABLE_EXT):this.isQueryResultAvailable(i)},Ge.a.prototype.startTimeQuery=function(){var i=this.getCaps(),t=i.timerQuery;if(!t)return null;var e=new Gy;if(this._gl.getParameter(t.GPU_DISJOINT_EXT),i.canUseTimestampForTimerQuery)e._startTimeQuery=this._createTimeQuery(),t.queryCounterEXT(e._startTimeQuery,t.TIMESTAMP_EXT);else{if(this._currentNonTimestampToken)return this._currentNonTimestampToken;e._timeElapsedQuery=this._createTimeQuery(),t.beginQueryEXT?t.beginQueryEXT(t.TIME_ELAPSED_EXT,e._timeElapsedQuery):this._gl.beginQuery(t.TIME_ELAPSED_EXT,e._timeElapsedQuery),this._currentNonTimestampToken=e}return e},Ge.a.prototype.endTimeQuery=function(i){var t=this.getCaps(),e=t.timerQuery;if(!e||!i)return-1;if(t.canUseTimestampForTimerQuery){if(!i._startTimeQuery)return-1;i._endTimeQuery||(i._endTimeQuery=this._createTimeQuery(),e.queryCounterEXT(i._endTimeQuery,e.TIMESTAMP_EXT))}else if(!i._timeElapsedQueryEnded){if(!i._timeElapsedQuery)return-1;e.endQueryEXT?e.endQueryEXT(e.TIME_ELAPSED_EXT):this._gl.endQuery(e.TIME_ELAPSED_EXT),i._timeElapsedQueryEnded=!0}var n=this._gl.getParameter(e.GPU_DISJOINT_EXT),r=!1;if(i._endTimeQuery?r=this._getTimeQueryAvailability(i._endTimeQuery):i._timeElapsedQuery&&(r=this._getTimeQueryAvailability(i._timeElapsedQuery)),r&&!n){var o=0;if(t.canUseTimestampForTimerQuery){if(!i._startTimeQuery||!i._endTimeQuery)return-1;var u=this._getTimeQueryResult(i._startTimeQuery);o=this._getTimeQueryResult(i._endTimeQuery)-u,this._deleteTimeQuery(i._startTimeQuery),this._deleteTimeQuery(i._endTimeQuery),i._startTimeQuery=null,i._endTimeQuery=null}else{if(!i._timeElapsedQuery)return-1;o=this._getTimeQueryResult(i._timeElapsedQuery),this._deleteTimeQuery(i._timeElapsedQuery),i._timeElapsedQuery=null,i._timeElapsedQueryEnded=!1,this._currentNonTimestampToken=null}return o}return-1},Ge.a.prototype._getGlAlgorithmType=function(i){return i===jt.a.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE?this._gl.ANY_SAMPLES_PASSED_CONSERVATIVE:this._gl.ANY_SAMPLES_PASSED},Object.defineProperty(jt.a.prototype,"isOcclusionQueryInProgress",{get:function(){return this._occlusionDataStorage.isOcclusionQueryInProgress},set:function(i){this._occlusionDataStorage.isOcclusionQueryInProgress=i},enumerable:!1,configurable:!0}),Object.defineProperty(jt.a.prototype,"_occlusionDataStorage",{get:function(){return this.__occlusionDataStorage||(this.__occlusionDataStorage=new Hy),this.__occlusionDataStorage},enumerable:!1,configurable:!0}),Object.defineProperty(jt.a.prototype,"isOccluded",{get:function(){return this._occlusionDataStorage.isOccluded},set:function(i){this._occlusionDataStorage.isOccluded=i},enumerable:!0,configurable:!0}),Object.defineProperty(jt.a.prototype,"occlusionQueryAlgorithmType",{get:function(){return this._occlusionDataStorage.occlusionQueryAlgorithmType},set:function(i){this._occlusionDataStorage.occlusionQueryAlgorithmType=i},enumerable:!0,configurable:!0}),Object.defineProperty(jt.a.prototype,"occlusionType",{get:function(){return this._occlusionDataStorage.occlusionType},set:function(i){this._occlusionDataStorage.occlusionType=i},enumerable:!0,configurable:!0}),Object.defineProperty(jt.a.prototype,"occlusionRetryCount",{get:function(){return this._occlusionDataStorage.occlusionRetryCount},set:function(i){this._occlusionDataStorage.occlusionRetryCount=i},enumerable:!0,configurable:!0}),jt.a.prototype._checkOcclusionQuery=function(){var i=this._occlusionDataStorage;if(i.occlusionType===jt.a.OCCLUSION_TYPE_NONE)return i.isOccluded=!1,!1;var t=this.getEngine();if(t.webGLVersion<2||!t.isQueryResultAvailable)return i.isOccluded=!1,!1;if(this.isOcclusionQueryInProgress&&this._occlusionQuery)if(t.isQueryResultAvailable(this._occlusionQuery)){var e=t.getQueryResult(this._occlusionQuery);i.isOcclusionQueryInProgress=!1,i.occlusionInternalRetryCounter=0,i.isOccluded=e!==1}else{if(i.occlusionInternalRetryCounter++,!(i.occlusionRetryCount!==-1&&i.occlusionInternalRetryCounter>i.occlusionRetryCount))return!1;i.isOcclusionQueryInProgress=!1,i.occlusionInternalRetryCounter=0,i.isOccluded=i.occlusionType!==jt.a.OCCLUSION_TYPE_OPTIMISTIC&&i.isOccluded}var n=this.getScene();if(n.getBoundingBoxRenderer){var r=n.getBoundingBoxRenderer();this._occlusionQuery||(this._occlusionQuery=t.createQuery()),t.beginOcclusionQuery(i.occlusionQueryAlgorithmType,this._occlusionQuery),r.renderOcclusionBoundingBox(this),t.endOcclusionQuery(i.occlusionQueryAlgorithmType),this._occlusionDataStorage.isOcclusionQueryInProgress=!0}return i.isOccluded};var SI=!0;Ge.a.prototype.createTransformFeedback=function(){return this._gl.createTransformFeedback()},Ge.a.prototype.deleteTransformFeedback=function(i){this._gl.deleteTransformFeedback(i)},Ge.a.prototype.bindTransformFeedback=function(i){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,i)},Ge.a.prototype.beginTransformFeedback=function(i){i===void 0&&(i=!0),this._gl.beginTransformFeedback(i?this._gl.POINTS:this._gl.TRIANGLES)},Ge.a.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},Ge.a.prototype.setTranformFeedbackVaryings=function(i,t){this._gl.transformFeedbackVaryings(i,t,this._gl.INTERLEAVED_ATTRIBS)},Ge.a.prototype.bindTransformFeedbackBuffer=function(i){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,i?i.underlyingResource:null)},c(126),en.a.prototype.updateVideoTexture=function(i,t,e){if(i&&!i._isDisabled){var n=this._bindTextureDirectly(this._gl.TEXTURE_2D,i,!0);this._unpackFlipY(!e);try{if(this._videoTextureSupported===void 0&&(this._gl.getError(),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,t),this._gl.getError()!==0?this._videoTextureSupported=!1:this._videoTextureSupported=!0),this._videoTextureSupported)this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,t);else{if(!i._workingCanvas){i._workingCanvas=Dp.a.CreateCanvas(i.width,i.height);var r=i._workingCanvas.getContext("2d");if(!r)throw new Error("Unable to get 2d context");i._workingContext=r,i._workingCanvas.width=i.width,i._workingCanvas.height=i.height}i._workingContext.clearRect(0,0,i.width,i.height),i._workingContext.drawImage(t,0,0,t.videoWidth,t.videoHeight,0,0,i.width,i.height),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,i._workingCanvas)}i.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),n||this._bindTextureDirectly(this._gl.TEXTURE_2D,null),i.isReady=!0}catch(o){i._isDisabled=!0}}},en.a.prototype.restoreSingleAttachment=function(){var i=this._gl;this.bindAttachments([i.BACK])},en.a.prototype.buildTextureLayout=function(i){for(var t=this._gl,e=[],n=0;n<i.length;n++)i[n]?e.push(t["COLOR_ATTACHMENT"+n]):e.push(t.NONE);return e},en.a.prototype.bindAttachments=function(i){this._gl.drawBuffers(i)},en.a.prototype.unBindMultiColorAttachmentFramebuffer=function(i,t,e){t===void 0&&(t=!1),this._currentRenderTarget=null;var n=this._gl,r=i[0]._attachments,o=r.length;if(i[0]._MSAAFramebuffer){n.bindFramebuffer(n.READ_FRAMEBUFFER,i[0]._MSAAFramebuffer),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,i[0]._framebuffer);for(var u=0;u<o;u++){for(var f=i[u],v=0;v<o;v++)r[v]=n.NONE;r[u]=n[this.webGLVersion>1?"COLOR_ATTACHMENT"+u:"COLOR_ATTACHMENT"+u+"_WEBGL"],n.readBuffer(r[u]),n.drawBuffers(r),n.blitFramebuffer(0,0,f.width,f.height,0,0,f.width,f.height,n.COLOR_BUFFER_BIT,n.NEAREST)}for(u=0;u<o;u++)r[u]=n[this.webGLVersion>1?"COLOR_ATTACHMENT"+u:"COLOR_ATTACHMENT"+u+"_WEBGL"];n.drawBuffers(r)}for(u=0;u<o;u++)!(f=i[u]).generateMipMaps||t||f.isCube||(this._bindTextureDirectly(n.TEXTURE_2D,f,!0),n.generateMipmap(n.TEXTURE_2D),this._bindTextureDirectly(n.TEXTURE_2D,null));e&&(i[0]._MSAAFramebuffer&&this._bindUnboundFramebuffer(i[0]._framebuffer),e()),this._bindUnboundFramebuffer(null)},en.a.prototype.createMultipleRenderTarget=function(i,t){var e=!1,n=!0,r=!1,o=!1,u=1,f=g.a.TEXTURETYPE_UNSIGNED_INT,v=g.a.TEXTURE_TRILINEAR_SAMPLINGMODE,y=new Array,D=new Array;t!==void 0&&(e=t.generateMipMaps!==void 0&&t.generateMipMaps,n=t.generateDepthBuffer===void 0||t.generateDepthBuffer,r=t.generateStencilBuffer!==void 0&&t.generateStencilBuffer,o=t.generateDepthTexture!==void 0&&t.generateDepthTexture,u=t.textureCount||1,t.types&&(y=t.types),t.samplingModes&&(D=t.samplingModes));var w=this._gl,F=w.createFramebuffer();this._bindUnboundFramebuffer(F);for(var z=i.width||i,k=i.height||i,K=[],oe=[],ae=this._setupFramebufferDepthAttachments(r,n,z,k),ue=0;ue<u;ue++){var de=D[ue]||v,me=y[ue]||f;(me!==g.a.TEXTURETYPE_FLOAT||this._caps.textureFloatLinearFiltering)&&(me!==g.a.TEXTURETYPE_HALF_FLOAT||this._caps.textureHalfFloatLinearFiltering)||(de=g.a.TEXTURE_NEAREST_SAMPLINGMODE);var ye=this._getSamplingParameters(de,e);me!==g.a.TEXTURETYPE_FLOAT||this._caps.textureFloat||(me=g.a.TEXTURETYPE_UNSIGNED_INT,_.a.Warn("Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type"));var Ee=new Nt.a(this,Nt.b.MultiRenderTarget),Ae=w[this.webGLVersion>1?"COLOR_ATTACHMENT"+ue:"COLOR_ATTACHMENT"+ue+"_WEBGL"];K.push(Ee),oe.push(Ae),w.activeTexture(w["TEXTURE"+ue]),w.bindTexture(w.TEXTURE_2D,Ee._webGLTexture),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MAG_FILTER,ye.mag),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MIN_FILTER,ye.min),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_S,w.CLAMP_TO_EDGE),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_T,w.CLAMP_TO_EDGE),w.texImage2D(w.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(me),z,k,0,w.RGBA,this._getWebGLTextureType(me),null),w.framebufferTexture2D(w.DRAW_FRAMEBUFFER,Ae,w.TEXTURE_2D,Ee._webGLTexture,0),e&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(w.TEXTURE_2D,null),Ee._framebuffer=F,Ee._depthStencilBuffer=ae,Ee.baseWidth=z,Ee.baseHeight=k,Ee.width=z,Ee.height=k,Ee.isReady=!0,Ee.samples=1,Ee.generateMipMaps=e,Ee.samplingMode=de,Ee.type=me,Ee._generateDepthBuffer=n,Ee._generateStencilBuffer=r,Ee._attachments=oe,Ee._textureArray=K,this._internalTexturesCache.push(Ee)}if(o&&this._caps.depthTextureExtension){var Ie=new Nt.a(this,Nt.b.MultiRenderTarget);w.activeTexture(w.TEXTURE0),w.bindTexture(w.TEXTURE_2D,Ie._webGLTexture),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MAG_FILTER,w.NEAREST),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MIN_FILTER,w.NEAREST),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_S,w.CLAMP_TO_EDGE),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_T,w.CLAMP_TO_EDGE),w.texImage2D(w.TEXTURE_2D,0,this.webGLVersion<2?w.DEPTH_COMPONENT:w.DEPTH_COMPONENT16,z,k,0,w.DEPTH_COMPONENT,w.UNSIGNED_SHORT,null),w.framebufferTexture2D(w.FRAMEBUFFER,w.DEPTH_ATTACHMENT,w.TEXTURE_2D,Ie._webGLTexture,0),Ie._framebuffer=F,Ie.baseWidth=z,Ie.baseHeight=k,Ie.width=z,Ie.height=k,Ie.isReady=!0,Ie.samples=1,Ie.generateMipMaps=e,Ie.samplingMode=w.NEAREST,Ie._generateDepthBuffer=n,Ie._generateStencilBuffer=r,K.push(Ie),this._internalTexturesCache.push(Ie)}return w.drawBuffers(oe),this._bindUnboundFramebuffer(null),this.resetTextureCache(),K},en.a.prototype.updateMultipleRenderTargetTextureSampleCount=function(i,t){if(this.webGLVersion<2||!i)return 1;if(i[0].samples===t)return t;var e=i[0]._attachments.length;if(e===0)return 1;var n=this._gl;t=Math.min(t,this.getCaps().maxMSAASamples),i[0]._depthStencilBuffer&&(n.deleteRenderbuffer(i[0]._depthStencilBuffer),i[0]._depthStencilBuffer=null),i[0]._MSAAFramebuffer&&(n.deleteFramebuffer(i[0]._MSAAFramebuffer),i[0]._MSAAFramebuffer=null);for(var r=0;r<e;r++)i[r]._MSAARenderBuffer&&(n.deleteRenderbuffer(i[r]._MSAARenderBuffer),i[r]._MSAARenderBuffer=null);if(t>1&&n.renderbufferStorageMultisample){var o=n.createFramebuffer();if(!o)throw new Error("Unable to create multi sampled framebuffer");this._bindUnboundFramebuffer(o);var u=this._setupFramebufferDepthAttachments(i[0]._generateStencilBuffer,i[0]._generateDepthBuffer,i[0].width,i[0].height,t),f=[];for(r=0;r<e;r++){var v=i[r],y=n[this.webGLVersion>1?"COLOR_ATTACHMENT"+r:"COLOR_ATTACHMENT"+r+"_WEBGL"],D=n.createRenderbuffer();if(!D)throw new Error("Unable to create multi sampled framebuffer");n.bindRenderbuffer(n.RENDERBUFFER,D),n.renderbufferStorageMultisample(n.RENDERBUFFER,t,this._getRGBAMultiSampleBufferFormat(v.type),v.width,v.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,y,n.RENDERBUFFER,D),v._MSAAFramebuffer=o,v._MSAARenderBuffer=D,v.samples=t,v._depthStencilBuffer=u,n.bindRenderbuffer(n.RENDERBUFFER,null),f.push(y)}n.drawBuffers(f)}else this._bindUnboundFramebuffer(i[0]._framebuffer);return this._bindUnboundFramebuffer(null),t};var el=c(56);en.a.prototype._createDepthStencilCubeTexture=function(i,t){var e=new Nt.a(this,Nt.b.Unknown);if(e.isCube=!0,this.webGLVersion===1)return _.a.Error("Depth cube texture is not supported by WebGL 1."),e;var n=Object(p.a)({bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1},t),r=this._gl;this._bindTextureDirectly(r.TEXTURE_CUBE_MAP,e,!0),this._setupDepthStencilTexture(e,i,n.generateStencil,n.bilinearFiltering,n.comparisonFunction);for(var o=0;o<6;o++)n.generateStencil?r.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,r.DEPTH24_STENCIL8,i,i,0,r.DEPTH_STENCIL,r.UNSIGNED_INT_24_8,null):r.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,r.DEPTH_COMPONENT24,i,i,0,r.DEPTH_COMPONENT,r.UNSIGNED_INT,null);return this._bindTextureDirectly(r.TEXTURE_CUBE_MAP,null),e},en.a.prototype._partialLoadFile=function(i,t,e,n,r){r===void 0&&(r=null),this._loadFile(i,function(o){e[t]=o,e._internalCount++,e._internalCount===6&&n(e)},void 0,void 0,!0,function(o,u){r&&o&&r(o.status+" "+o.statusText,u)})},en.a.prototype._cascadeLoadFiles=function(i,t,e,n){n===void 0&&(n=null);var r=[];r._internalCount=0;for(var o=0;o<6;o++)this._partialLoadFile(e[o],o,r,t,n)},en.a.prototype._cascadeLoadImgs=function(i,t,e,n,r){n===void 0&&(n=null);var o=[];o._internalCount=0;for(var u=0;u<6;u++)this._partialLoadImg(e[u],u,o,i,t,n,r)},en.a.prototype._partialLoadImg=function(i,t,e,n,r,o,u){var f;o===void 0&&(o=null),f=el.a.LoadImage(i,function(){f&&(e[t]=f,e._internalCount++,n&&n._removePendingData(f)),e._internalCount===6&&r(e)},function(v,y){n&&n._removePendingData(f),o&&o(v,y)},n?n.offlineProvider:null,u),n&&f&&n._addPendingData(f)},en.a.prototype._setCubeMapTextureParams=function(i,t){var e=this._gl;e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,t?e.LINEAR_MIPMAP_LINEAR:e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),i.samplingMode=t?g.a.TEXTURE_TRILINEAR_SAMPLINGMODE:g.a.TEXTURE_LINEAR_LINEAR,this._bindTextureDirectly(e.TEXTURE_CUBE_MAP,null)},en.a.prototype.createCubeTexture=function(i,t,e,n,r,o,u,f,v,y,D,w,F){var z=this;r===void 0&&(r=null),o===void 0&&(o=null),f===void 0&&(f=null),v===void 0&&(v=!1),y===void 0&&(y=0),D===void 0&&(D=0),w===void 0&&(w=null);var k=this._gl,K=w||new Nt.a(this,Nt.b.Cube);K.isCube=!0,K.url=i,K.generateMipMaps=!n,K._lodGenerationScale=y,K._lodGenerationOffset=D,this._doNotHandleContextLost||(K._extension=f,K._files=e);var oe=i;this._transformTextureUrl&&!w&&(i=this._transformTextureUrl(i));for(var ae=i.lastIndexOf("."),ue=f||(ae>-1?i.substring(ae).toLowerCase():""),de=null,me=0,ye=en.a._TextureLoaders;me<ye.length;me++){var Ee=ye[me];if(Ee.canLoad(ue)){de=Ee;break}}if(de){var Ae=function(Ie){z._bindTextureDirectly(k.TEXTURE_CUBE_MAP,K,!0),de.loadCubeData(Ie,K,v,r,o)};e&&e.length===6?de.supportCascades?this._cascadeLoadFiles(t,function(Ie){return Ae(Ie.map(function(Re){return new Uint8Array(Re)}))},e,o):o?o("Textures type does not support cascades."):_.a.Warn("Texture loader does not support cascades."):this._loadFile(i,function(Ie){return Ae(new Uint8Array(Ie))},void 0,void 0,!0,function(Ie,Re){i===oe?o&&Ie&&o(Ie.status+" "+Ie.statusText,Re):(_.a.Warn("Failed to load "+i+", falling back to the "+oe),z.createCubeTexture(oe,t,e,n,r,o,u,f,v,y,D,K,F))})}else{if(!e)throw new Error("Cannot load cubemap because files were not defined");this._cascadeLoadImgs(t,function(Ie){var Re=z.needPOTTextures?en.a.GetExponentOfTwo(Ie[0].width,z._caps.maxCubemapTextureSize):Ie[0].width,Pe=Re,Ce=[k.TEXTURE_CUBE_MAP_POSITIVE_X,k.TEXTURE_CUBE_MAP_POSITIVE_Y,k.TEXTURE_CUBE_MAP_POSITIVE_Z,k.TEXTURE_CUBE_MAP_NEGATIVE_X,k.TEXTURE_CUBE_MAP_NEGATIVE_Y,k.TEXTURE_CUBE_MAP_NEGATIVE_Z];z._bindTextureDirectly(k.TEXTURE_CUBE_MAP,K,!0),z._unpackFlipY(!1);for(var Be=u?z._getInternalFormat(u):z._gl.RGBA,Oe=0;Oe<Ce.length;Oe++)if(Ie[Oe].width!==Re||Ie[Oe].height!==Pe){if(z._prepareWorkingCanvas(),!z._workingCanvas||!z._workingContext)return void _.a.Warn("Cannot create canvas to resize texture.");z._workingCanvas.width=Re,z._workingCanvas.height=Pe,z._workingContext.drawImage(Ie[Oe],0,0,Ie[Oe].width,Ie[Oe].height,0,0,Re,Pe),k.texImage2D(Ce[Oe],0,Be,Be,k.UNSIGNED_BYTE,z._workingCanvas)}else k.texImage2D(Ce[Oe],0,Be,Be,k.UNSIGNED_BYTE,Ie[Oe]);n||k.generateMipmap(k.TEXTURE_CUBE_MAP),z._setCubeMapTextureParams(K,!n),K.width=Re,K.height=Pe,K.isReady=!0,u&&(K.format=u),K.onLoadedObservable.notifyObservers(K),K.onLoadedObservable.clear(),r&&r()},e,o)}return this._internalTexturesCache.push(K),K},c(153),c(124);var xI=function(){};Ge.a.prototype.getInputElement=function(){return this.inputElement||this.getRenderingCanvas()},Ge.a.prototype.registerView=function(i,t){var e=this;this.views||(this.views=[]);for(var n=0,r=this.views;n<r.length;n++){var o=r[n];if(o.target===i)return o}var u=this.getRenderingCanvas();u&&(i.width=u.width,i.height=u.height);var f={target:i,camera:t};return this.views.push(f),t&&t.onDisposeObservable.add(function(){e.unRegisterView(i)}),f},Ge.a.prototype.unRegisterView=function(i){if(!this.views)return this;for(var t=0,e=this.views;t<e.length;t++){var n=e[t];if(n.target===i){var r=this.views.indexOf(n);r!==-1&&this.views.splice(r,1);break}}return this},Ge.a.prototype._renderViews=function(){if(!this.views)return!1;var i=this.getRenderingCanvas();if(!i)return!1;for(var t=0,e=this.views;t<e.length;t++){var n=e[t],r=n.target,o=r.getContext("2d");if(o){var u=n.camera,f=null,v=null;if(u){if((v=u.getScene()).activeCameras&&v.activeCameras.length)continue;this.activeView=n,f=v.activeCamera,v.activeCamera=u}var y=r.width!==r.clientWidth||r.height!==r.clientHeight;if(r.clientWidth&&r.clientHeight&&y&&(r.width=r.clientWidth,r.height=r.clientHeight,i.width=r.clientWidth,i.height=r.clientHeight,this.resize()),!i.width||!i.height)return!1;this._renderFrame(),o.drawImage(i,0,0),f&&v&&(v.activeCamera=f)}}return this.activeView=null,!0},c(129);function AI(i){if(this._excludedCompressedTextures&&this._excludedCompressedTextures.some(function(r){var o="\\b"+r+"\\b";return i&&(i===r||i.match(new RegExp(o,"g")))}))return i;var t=i.lastIndexOf("."),e=i.lastIndexOf("?"),n=e>-1?i.substring(e,i.length):"";return(t>-1?i.substring(0,t):i)+this._textureFormatInUse+n}Object.defineProperty(Ge.a.prototype,"texturesSupported",{get:function(){var i=new Array;return this._caps.astc&&i.push("-astc.ktx"),this._caps.s3tc&&i.push("-dxt.ktx"),this._caps.pvrtc&&i.push("-pvrtc.ktx"),this._caps.etc2&&i.push("-etc2.ktx"),this._caps.etc1&&i.push("-etc1.ktx"),i},enumerable:!0,configurable:!0}),Object.defineProperty(Ge.a.prototype,"textureFormatInUse",{get:function(){return this._textureFormatInUse||null},enumerable:!0,configurable:!0}),Ge.a.prototype.setCompressedTextureExclusions=function(i){this._excludedCompressedTextures=i},Ge.a.prototype.setTextureFormatToUse=function(i){for(var t=this.texturesSupported,e=0,n=t.length;e<n;e++)for(var r=0,o=i.length;r<o;r++)if(t[e]===i[r].toLowerCase())return this._transformTextureUrl=AI.bind(this),this._textureFormatInUse=t[e];return this._textureFormatInUse="",this._transformTextureUrl=null,null};var PI=c(144),Wy=c(118),Xy=c(89),Gi=[Math.sqrt(1/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(3/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(15/(4*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(5/(16*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(15/(16*Math.PI))],CI=[function(i){return 1},function(i){return i.y},function(i){return i.z},function(i){return i.x},function(i){return i.x*i.y},function(i){return i.y*i.z},function(i){return 3*i.z*i.z-1},function(i){return i.x*i.z},function(i){return i.x*i.x-i.y*i.y}],oo=function(i,t){return Gi[i]*CI[i](t)},ao=[Math.PI,2*Math.PI/3,2*Math.PI/3,2*Math.PI/3,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4],jp=function(){function i(){this.preScaled=!1,this.l00=d.e.Zero(),this.l1_1=d.e.Zero(),this.l10=d.e.Zero(),this.l11=d.e.Zero(),this.l2_2=d.e.Zero(),this.l2_1=d.e.Zero(),this.l20=d.e.Zero(),this.l21=d.e.Zero(),this.l22=d.e.Zero()}return i.prototype.addLight=function(t,e,n){var r=new d.e(e.r,e.g,e.b).scale(n);this.l00=this.l00.add(r.scale(oo(0,t))),this.l1_1=this.l1_1.add(r.scale(oo(1,t))),this.l10=this.l10.add(r.scale(oo(2,t))),this.l11=this.l11.add(r.scale(oo(3,t))),this.l2_2=this.l2_2.add(r.scale(oo(4,t))),this.l2_1=this.l2_1.add(r.scale(oo(5,t))),this.l20=this.l20.add(r.scale(oo(6,t))),this.l21=this.l21.add(r.scale(oo(7,t))),this.l22=this.l22.add(r.scale(oo(8,t)))},i.prototype.scaleInPlace=function(t){this.l00.scaleInPlace(t),this.l1_1.scaleInPlace(t),this.l10.scaleInPlace(t),this.l11.scaleInPlace(t),this.l2_2.scaleInPlace(t),this.l2_1.scaleInPlace(t),this.l20.scaleInPlace(t),this.l21.scaleInPlace(t),this.l22.scaleInPlace(t)},i.prototype.convertIncidentRadianceToIrradiance=function(){this.l00.scaleInPlace(ao[0]),this.l1_1.scaleInPlace(ao[1]),this.l10.scaleInPlace(ao[2]),this.l11.scaleInPlace(ao[3]),this.l2_2.scaleInPlace(ao[4]),this.l2_1.scaleInPlace(ao[5]),this.l20.scaleInPlace(ao[6]),this.l21.scaleInPlace(ao[7]),this.l22.scaleInPlace(ao[8])},i.prototype.convertIrradianceToLambertianRadiance=function(){this.scaleInPlace(1/Math.PI)},i.prototype.preScaleForRendering=function(){this.preScaled=!0,this.l00.scaleInPlace(Gi[0]),this.l1_1.scaleInPlace(Gi[1]),this.l10.scaleInPlace(Gi[2]),this.l11.scaleInPlace(Gi[3]),this.l2_2.scaleInPlace(Gi[4]),this.l2_1.scaleInPlace(Gi[5]),this.l20.scaleInPlace(Gi[6]),this.l21.scaleInPlace(Gi[7]),this.l22.scaleInPlace(Gi[8])},i.FromArray=function(t){var e=new i;return d.e.FromArrayToRef(t[0],0,e.l00),d.e.FromArrayToRef(t[1],0,e.l1_1),d.e.FromArrayToRef(t[2],0,e.l10),d.e.FromArrayToRef(t[3],0,e.l11),d.e.FromArrayToRef(t[4],0,e.l2_2),d.e.FromArrayToRef(t[5],0,e.l2_1),d.e.FromArrayToRef(t[6],0,e.l20),d.e.FromArrayToRef(t[7],0,e.l21),d.e.FromArrayToRef(t[8],0,e.l22),e},i.FromPolynomial=function(t){var e=new i;return e.l00=t.xx.scale(.376127).add(t.yy.scale(.376127)).add(t.zz.scale(.376126)),e.l1_1=t.y.scale(.977204),e.l10=t.z.scale(.977204),e.l11=t.x.scale(.977204),e.l2_2=t.xy.scale(1.16538),e.l2_1=t.yz.scale(1.16538),e.l20=t.zz.scale(1.34567).subtract(t.xx.scale(.672834)).subtract(t.yy.scale(.672834)),e.l21=t.zx.scale(1.16538),e.l22=t.xx.scale(1.16538).subtract(t.yy.scale(1.16538)),e.l1_1.scaleInPlace(-1),e.l11.scaleInPlace(-1),e.l2_1.scaleInPlace(-1),e.l21.scaleInPlace(-1),e.scaleInPlace(Math.PI),e},i}(),tl=function(){function i(){this.x=d.e.Zero(),this.y=d.e.Zero(),this.z=d.e.Zero(),this.xx=d.e.Zero(),this.yy=d.e.Zero(),this.zz=d.e.Zero(),this.xy=d.e.Zero(),this.yz=d.e.Zero(),this.zx=d.e.Zero()}return Object.defineProperty(i.prototype,"preScaledHarmonics",{get:function(){return this._harmonics||(this._harmonics=jp.FromPolynomial(this)),this._harmonics.preScaled||this._harmonics.preScaleForRendering(),this._harmonics},enumerable:!1,configurable:!0}),i.prototype.addAmbient=function(t){var e=new d.e(t.r,t.g,t.b);this.xx=this.xx.add(e),this.yy=this.yy.add(e),this.zz=this.zz.add(e)},i.prototype.scaleInPlace=function(t){this.x.scaleInPlace(t),this.y.scaleInPlace(t),this.z.scaleInPlace(t),this.xx.scaleInPlace(t),this.yy.scaleInPlace(t),this.zz.scaleInPlace(t),this.yz.scaleInPlace(t),this.zx.scaleInPlace(t),this.xy.scaleInPlace(t)},i.FromHarmonics=function(t){var e=new i;return e._harmonics=t,e.x=t.l11.scale(1.02333).scale(-1),e.y=t.l1_1.scale(1.02333).scale(-1),e.z=t.l10.scale(1.02333),e.xx=t.l00.scale(.886277).subtract(t.l20.scale(.247708)).add(t.l22.scale(.429043)),e.yy=t.l00.scale(.886277).subtract(t.l20.scale(.247708)).subtract(t.l22.scale(.429043)),e.zz=t.l00.scale(.886277).add(t.l20.scale(.495417)),e.yz=t.l2_1.scale(.858086).scale(-1),e.zx=t.l21.scale(.858086).scale(-1),e.xy=t.l2_2.scale(.858086),e.scaleInPlace(1/Math.PI),e},i.FromArray=function(t){var e=new i;return d.e.FromArrayToRef(t[0],0,e.x),d.e.FromArrayToRef(t[1],0,e.y),d.e.FromArrayToRef(t[2],0,e.z),d.e.FromArrayToRef(t[3],0,e.xx),d.e.FromArrayToRef(t[4],0,e.yy),d.e.FromArrayToRef(t[5],0,e.zz),d.e.FromArrayToRef(t[6],0,e.yz),d.e.FromArrayToRef(t[7],0,e.zx),d.e.FromArrayToRef(t[8],0,e.xy),e},i}(),$r=c(52),vs=function(i,t,e,n){this.name=i,this.worldAxisForNormal=t,this.worldAxisForFileX=e,this.worldAxisForFileY=n},ih=function(){function i(){}return i.ConvertCubeMapTextureToSphericalPolynomial=function(t){if(!t.isCube)return null;var e,n,r=t.getSize().width,o=t.readPixels(0),u=t.readPixels(1);t.isRenderTarget?(e=t.readPixels(3),n=t.readPixels(2)):(e=t.readPixels(2),n=t.readPixels(3));var f=t.readPixels(4),v=t.readPixels(5),y=t.gammaSpace,D=g.a.TEXTUREFORMAT_RGBA,w=g.a.TEXTURETYPE_UNSIGNED_INT;t.textureType!=g.a.TEXTURETYPE_FLOAT&&t.textureType!=g.a.TEXTURETYPE_HALF_FLOAT||(w=g.a.TEXTURETYPE_FLOAT);var F={size:r,right:o,left:u,up:e,down:n,front:f,back:v,format:D,type:w,gammaSpace:y};return this.ConvertCubeMapToSphericalPolynomial(F)},i.ConvertCubeMapToSphericalPolynomial=function(t){for(var e=new jp,n=0,r=2/t.size,o=r,u=.5*r-1,f=0;f<6;f++)for(var v=this.FileFaces[f],y=t[v.name],D=u,w=t.format===g.a.TEXTUREFORMAT_RGBA?4:3,F=0;F<t.size;F++){for(var z=u,k=0;k<t.size;k++){var K=v.worldAxisForFileX.scale(z).add(v.worldAxisForFileY.scale(D)).add(v.worldAxisForNormal);K.normalize();var oe=Math.pow(1+z*z+D*D,-1.5),ae=y[F*t.size*w+k*w+0],ue=y[F*t.size*w+k*w+1],de=y[F*t.size*w+k*w+2];isNaN(ae)&&(ae=0),isNaN(ue)&&(ue=0),isNaN(de)&&(de=0),t.type===g.a.TEXTURETYPE_UNSIGNED_INT&&(ae/=255,ue/=255,de/=255),t.gammaSpace&&(ae=Math.pow(te.a.Clamp(ae),Zt.c),ue=Math.pow(te.a.Clamp(ue),Zt.c),de=Math.pow(te.a.Clamp(de),Zt.c)),ae=te.a.Clamp(ae,0,4096),ue=te.a.Clamp(ue,0,4096),de=te.a.Clamp(de,0,4096);var me=new M.a(ae,ue,de);e.addLight(K,me,oe),n+=oe,z+=r}D+=o}var ye=6*(4*Math.PI)/6/n;return e.scaleInPlace(ye),e.convertIncidentRadianceToIrradiance(),e.convertIrradianceToLambertianRadiance(),tl.FromHarmonics(e)},i.FileFaces=[new vs("right",new d.e(1,0,0),new d.e(0,0,-1),new d.e(0,-1,0)),new vs("left",new d.e(-1,0,0),new d.e(0,0,1),new d.e(0,-1,0)),new vs("up",new d.e(0,1,0),new d.e(1,0,0),new d.e(0,0,1)),new vs("down",new d.e(0,-1,0),new d.e(1,0,0),new d.e(0,0,-1)),new vs("front",new d.e(0,0,1),new d.e(1,0,0),new d.e(0,-1,0)),new vs("back",new d.e(0,0,-1),new d.e(-1,0,0),new d.e(0,-1,0))],i}();Object.defineProperty($r.a.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomial=ih.ConvertCubeMapTextureToSphericalPolynomial(this),this._texture._sphericalPolynomial}return null},set:function(i){this._texture&&(this._texture._sphericalPolynomial=i)},enumerable:!0,configurable:!0});var RI=`
varying vec2 vUV;
uniform sampler2D textureSampler;
#include<helperFunctions>
void main(void)
{
gl_FragColor=toRGBD(texture2D(textureSampler,vUV).rgb);
}`;Ye.a.ShadersStore.rgbdEncodePixelShader=RI;var OI=`
varying vec2 vUV;
uniform sampler2D textureSampler;
#include<helperFunctions>
void main(void)
{
gl_FragColor=vec4(fromRGBD(texture2D(textureSampler,vUV)),1.0);
}`;Ye.a.ShadersStore.rgbdDecodePixelShader=OI;var so=function(){function i(){}return i.GetEnvInfo=function(t){for(var e=new DataView(t.buffer,t.byteOffset,t.byteLength),n=0,r=0;r<i._MagicBytes.length;r++)if(e.getUint8(n++)!==i._MagicBytes[r])return _.a.Error("Not a babylon environment map"),null;for(var o="",u=0;u=e.getUint8(n++);)o+=String.fromCharCode(u);var f=JSON.parse(o);return f.specular&&(f.specular.specularDataPosition=n,f.specular.lodGenerationScale=f.specular.lodGenerationScale||.8),f},i.CreateEnvTextureAsync=function(t){var e=this,n=t.getInternalTexture();if(!n)return Promise.reject("The cube texture is invalid.");var r=n.getEngine();if(r&&r.premultipliedAlpha)return Promise.reject("Env texture can only be created when the engine is created with the premultipliedAlpha option set to false.");if(t.textureType===g.a.TEXTURETYPE_UNSIGNED_INT)return Promise.reject("The cube texture should allow HDR (Full Float or Half Float).");var o=r.getRenderingCanvas();if(!o)return Promise.reject("Env texture can only be created when the engine is associated to a canvas.");var u=g.a.TEXTURETYPE_FLOAT;if(!r.getCaps().textureFloatRender&&(u=g.a.TEXTURETYPE_HALF_FLOAT,!r.getCaps().textureHalfFloatRender))return Promise.reject("Env texture can only be created when the browser supports half float or full float rendering.");var f=n.width,v=new he.a(r),y={},D=[],w=te.a.Log2(n.width);w=Math.round(w);for(var F=function(k){for(var K=Math.pow(2,w-k),oe=function(ue){var de=t.readPixels(ue,k),me=r.createRawTexture(de,K,K,g.a.TEXTUREFORMAT_RGBA,!1,!1,g.a.TEXTURE_NEAREST_SAMPLINGMODE,null,u),ye=new Promise(function(Ee,Ae){var Ie=new St("rgbdEncode","rgbdEncode",null,null,1,null,g.a.TEXTURE_NEAREST_SAMPLINGMODE,r,!1,void 0,g.a.TEXTURETYPE_UNSIGNED_INT,void 0,null,!1);Ie.getEffect().executeWhenCompiled(function(){Ie.onApply=function(Ce){Ce._bindTexture("textureSampler",me)};var Re=r.getRenderWidth(),Pe=r.getRenderHeight();r.setSize(K,K),v.postProcessManager.directRender([Ie],null),et.b.ToBlob(o,function(Ce){var Be=new FileReader;Be.onload=function(Oe){var Ve=Oe.target.result;y[6*k+ue]=Ve,Ee()},Be.readAsArrayBuffer(Ce)}),r.setSize(Re,Pe)})});D.push(ye)},ae=0;ae<6;ae++)oe(ae)},z=0;z<=w;z++)F(z);return Promise.all(D).then(function(){v.dispose();for(var k={version:1,width:f,irradiance:e._CreateEnvTextureIrradiance(t),specular:{mipmaps:[],lodGenerationScale:t.lodGenerationScale}},K=0,oe=0;oe<=w;oe++)for(var ae=0;ae<6;ae++){var ue=y[6*oe+ae].byteLength;k.specular.mipmaps.push({length:ue,position:K}),K+=ue}for(var de=JSON.stringify(k),me=new ArrayBuffer(de.length+1),ye=new Uint8Array(me),Ee=(oe=0,de.length);oe<Ee;oe++)ye[oe]=de.charCodeAt(oe);ye[de.length]=0;var Ae=i._MagicBytes.length+K+me.byteLength,Ie=new ArrayBuffer(Ae),Re=new Uint8Array(Ie),Pe=new DataView(Ie),Ce=0;for(oe=0;oe<i._MagicBytes.length;oe++)Pe.setUint8(Ce++,i._MagicBytes[oe]);for(Re.set(new Uint8Array(me),Ce),Ce+=me.byteLength,oe=0;oe<=w;oe++)for(ae=0;ae<6;ae++){var Be=y[6*oe+ae];Re.set(new Uint8Array(Be),Ce),Ce+=Be.byteLength}return Ie})},i._CreateEnvTextureIrradiance=function(t){var e=t.sphericalPolynomial;return e==null?null:{x:[e.x.x,e.x.y,e.x.z],y:[e.y.x,e.y.y,e.y.z],z:[e.z.x,e.z.y,e.z.z],xx:[e.xx.x,e.xx.y,e.xx.z],yy:[e.yy.x,e.yy.y,e.yy.z],zz:[e.zz.x,e.zz.y,e.zz.z],yz:[e.yz.x,e.yz.y,e.yz.z],zx:[e.zx.x,e.zx.y,e.zx.z],xy:[e.xy.x,e.xy.y,e.xy.z]}},i.CreateImageDataArrayBufferViews=function(t,e){if(e.version!==1)throw new Error('Unsupported babylon environment map version "'+e.version+'"');var n=e.specular,r=te.a.Log2(e.width);if(r=Math.round(r)+1,n.mipmaps.length!==6*r)throw new Error('Unsupported specular mipmaps number "'+n.mipmaps.length+'"');for(var o=new Array(r),u=0;u<r;u++){o[u]=new Array(6);for(var f=0;f<6;f++){var v=n.mipmaps[6*u+f];o[u][f]=new Uint8Array(t.buffer,t.byteOffset+n.specularDataPosition+v.position,v.length)}}return o},i.UploadEnvLevelsAsync=function(t,e,n){if(n.version!==1)throw new Error('Unsupported babylon environment map version "'+n.version+'"');var r=n.specular;if(!r)return Promise.resolve();t._lodGenerationScale=r.lodGenerationScale;var o=i.CreateImageDataArrayBufferViews(e,n);return i.UploadLevelsAsync(t,o)},i._OnImageReadyAsync=function(t,e,n,r,o,u,f,v,y,D,w){return new Promise(function(F,z){if(n){var k=e.createTexture(null,!0,!0,null,g.a.TEXTURE_NEAREST_SAMPLINGMODE,null,function(oe){z(oe)},t);r.getEffect().executeWhenCompiled(function(){r.onApply=function(oe){oe._bindTexture("textureSampler",k),oe.setFloat2("scale",1,1)},e.scenes[0].postProcessManager.directRender([r],D,!0,u,f),e.restoreDefaultFramebuffer(),k.dispose(),URL.revokeObjectURL(o),F()})}else{if(e._uploadImageToTexture(w,t,u,f),v){var K=y[f];K&&e._uploadImageToTexture(K._texture,t,u,0)}F()}})},i.UploadLevelsAsync=function(t,e){var n=this;if(!et.b.IsExponentOfTwo(t.width))throw new Error("Texture size must be a power of two");var r=Math.round(te.a.Log2(t.width))+1,o=t.getEngine(),u=!1,f=!1,v=null,y=null,D=null,w=o.getCaps();if(t.format=g.a.TEXTUREFORMAT_RGBA,t.type=g.a.TEXTURETYPE_UNSIGNED_INT,t.generateMipMaps=!0,t._cachedAnisotropicFilteringLevel=null,o.updateTextureSamplingMode(g.a.TEXTURE_TRILINEAR_SAMPLINGMODE,t),w.textureLOD?o.webGLVersion<2?u=!1:w.textureHalfFloatRender&&w.textureHalfFloatLinearFiltering?(u=!0,t.type=g.a.TEXTURETYPE_HALF_FLOAT):w.textureFloatRender&&w.textureFloatLinearFiltering&&(u=!0,t.type=g.a.TEXTURETYPE_FLOAT):(u=!1,f=!0,D={}),u)v=new St("rgbdDecode","rgbdDecode",null,null,1,null,g.a.TEXTURE_TRILINEAR_SAMPLINGMODE,o,!1,void 0,t.type,void 0,null,!1),t._isRGBD=!1,t.invertY=!1,y=o.createRenderTargetCubeTexture(t.width,{generateDepthBuffer:!1,generateMipMaps:!0,generateStencilBuffer:!1,samplingMode:g.a.TEXTURE_TRILINEAR_SAMPLINGMODE,type:t.type,format:g.a.TEXTUREFORMAT_RGBA});else if(t._isRGBD=!0,t.invertY=!0,f)for(var F=t._lodGenerationScale,z=t._lodGenerationOffset,k=0;k<3;k++){var K=(r-1)*F+z,oe=z+(K-z)*(1-k/2),ae=Math.round(Math.min(Math.max(oe,0),K)),ue=new Nt.a(o,Nt.b.Temp);ue.isCube=!0,ue.invertY=!0,ue.generateMipMaps=!1,o.updateTextureSamplingMode(g.a.TEXTURE_LINEAR_LINEAR,ue);var de=new $r.a(null);switch(de.isCube=!0,de._texture=ue,D[ae]=de,k){case 0:t._lodTextureLow=de;break;case 1:t._lodTextureMid=de;break;case 2:t._lodTextureHigh=de}}var me=[],ye=function(Pe){for(var Ce=function(Oe){var Ve=e[Pe][Oe],Le=new Blob([Ve],{type:"image/png"}),je=URL.createObjectURL(Le),tt=void 0;if(typeof Image=="undefined")tt=createImageBitmap(Le).then(function(ft){return n._OnImageReadyAsync(ft,o,u,v,je,Oe,Pe,f,D,y,t)});else{var ut=new Image;ut.src=je,tt=new Promise(function(ft,vt){ut.onload=function(){n._OnImageReadyAsync(ut,o,u,v,je,Oe,Pe,f,D,y,t).then(function(){return ft()}).catch(function(rt){vt(rt)})},ut.onerror=function(rt){vt(rt)}})}me.push(tt)},Be=0;Be<6;Be++)Ce(Be)};for(k=0;k<e.length;k++)ye(k);if(e.length<r){var Ee=void 0,Ae=Math.pow(2,r-1-e.length),Ie=Ae*Ae*4;switch(t.type){case g.a.TEXTURETYPE_UNSIGNED_INT:Ee=new Uint8Array(Ie);break;case g.a.TEXTURETYPE_HALF_FLOAT:Ee=new Uint16Array(Ie);break;case g.a.TEXTURETYPE_FLOAT:Ee=new Float32Array(Ie)}for(k=e.length;k<r;k++)for(var Re=0;Re<6;Re++)o._uploadArrayBufferViewToTexture(t,Ee,Re,k)}return Promise.all(me).then(function(){y&&(o._releaseFramebufferObjects(y),o._releaseTexture(t),y._swapAndDie(t)),v&&v.dispose(),f&&(t._lodTextureHigh&&t._lodTextureHigh._texture&&(t._lodTextureHigh._texture.isReady=!0),t._lodTextureMid&&t._lodTextureMid._texture&&(t._lodTextureMid._texture.isReady=!0),t._lodTextureLow&&t._lodTextureLow._texture&&(t._lodTextureLow._texture.isReady=!0))})},i.UploadEnvSpherical=function(t,e){e.version!==1&&_.a.Warn('Unsupported babylon environment map version "'+e.version+'"');var n=e.irradiance;if(n){var r=new tl;d.e.FromArrayToRef(n.x,0,r.x),d.e.FromArrayToRef(n.y,0,r.y),d.e.FromArrayToRef(n.z,0,r.z),d.e.FromArrayToRef(n.xx,0,r.xx),d.e.FromArrayToRef(n.yy,0,r.yy),d.e.FromArrayToRef(n.zz,0,r.zz),d.e.FromArrayToRef(n.yz,0,r.yz),d.e.FromArrayToRef(n.zx,0,r.zx),d.e.FromArrayToRef(n.xy,0,r.xy),t._sphericalPolynomial=r}},i._UpdateRGBDAsync=function(t,e,n,r,o){return t._source=Nt.b.CubeRawRGBD,t._bufferViewArrayArray=e,t._lodGenerationScale=r,t._lodGenerationOffset=o,t._sphericalPolynomial=n,i.UploadLevelsAsync(t,e).then(function(){t.isReady=!0})},i._MagicBytes=[134,22,135,150,246,214,150,54],i}();Nt.a._UpdateRGBDAsync=so._UpdateRGBDAsync;var co,zp=function(){function i(t,e){e===void 0&&(e=20),this.debug=!1,this._sourceCode=t,this._numMaxIterations=e,this._functionDescr=[],this.inlineToken="#define inline"}return Object.defineProperty(i.prototype,"code",{get:function(){return this._sourceCode},enumerable:!1,configurable:!0}),i.prototype.processCode=function(){this.debug&&console.log("Start inlining process (code size="+this._sourceCode.length+")..."),this._collectFunctions(),this._processInlining(this._numMaxIterations),this.debug&&console.log("End of inlining process.")},i.prototype._collectFunctions=function(){for(var t=0;t<this._sourceCode.length;){var e=this._sourceCode.indexOf(this.inlineToken,t);if(e<0)break;var n=this._sourceCode.indexOf("(",e+this.inlineToken.length);if(n<0)this.debug&&console.warn("Could not find the opening parenthesis after the token. startIndex="+t),t=e+this.inlineToken.length;else{var r=i._RegexpFindFunctionNameAndType.exec(this._sourceCode.substring(e+this.inlineToken.length,n));if(r){var o=[r[3],r[4]],u=o[0],f=o[1],v=this._extractBetweenMarkers("(",")",this._sourceCode,n);if(v<0)this.debug&&console.warn("Could not extract the parameters the function '"+f+"' (type="+u+"). funcParamsStartIndex="+n),t=e+this.inlineToken.length;else{var y=this._sourceCode.substring(n+1,v),D=this._skipWhitespaces(this._sourceCode,v+1);if(D!==this._sourceCode.length){var w=this._extractBetweenMarkers("{","}",this._sourceCode,D);if(w<0)this.debug&&console.warn("Could not extract the body of the function '"+f+"' (type="+u+"). funcBodyStartIndex="+D),t=e+this.inlineToken.length;else{for(var F=this._sourceCode.substring(D,w+1),z=this._removeComments(y).split(","),k=[],K=0;K<z.length;++K){var oe=z[K].trim(),ae=oe.lastIndexOf(" ");ae>=0&&k.push(oe.substring(ae+1))}u!=="void"&&k.push("return"),this._functionDescr.push({name:f,type:u,parameters:k,body:F,callIndex:0}),t=w+1;var ue=e>0?this._sourceCode.substring(0,e):"",de=w+1<this._sourceCode.length-1?this._sourceCode.substring(w+1):"";this._sourceCode=ue+de,t-=w+1-e}}else this.debug&&console.warn("Could not extract the body of the function '"+f+"' (type="+u+"). funcParamsEndIndex="+v),t=e+this.inlineToken.length}}else this.debug&&console.warn("Could not extract the name/type of the function from: "+this._sourceCode.substring(e+this.inlineToken.length,n)),t=e+this.inlineToken.length}}this.debug&&console.log("Collect functions: "+this._functionDescr.length+" functions found. functionDescr=",this._functionDescr)},i.prototype._processInlining=function(t){for(t===void 0&&(t=20);t-->=0&&this._replaceFunctionCallsByCode(););return this.debug&&console.log("numMaxIterations is "+t+" after inlining process"),t>=0},i.prototype._extractBetweenMarkers=function(t,e,n,r){for(var o=r,u=0,f="";o<n.length;){var v=n.charAt(o);if(f)v===f?f==='"'||f==="'"?n.charAt(o-1)!=="\\"&&(f=""):f="":f==="*/"&&v==="*"&&o+1<n.length&&(n.charAt(o+1)==="/"&&(f=""),f===""&&o++);else switch(v){case t:u++;break;case e:u--;break;case'"':case"'":case"`":f=v;break;case"/":if(o+1<n.length){var y=n.charAt(o+1);y==="/"?f=`
`:y==="*"&&(f="*/")}}if(o++,u===0)break}return u===0?o-1:-1},i.prototype._skipWhitespaces=function(t,e){for(;e<t.length;){var n=t[e];if(n!==" "&&n!==`
`&&n!=="\r"&&n!=="	"&&n!==`
`&&n!=="\xA0")break;e++}return e},i.prototype._removeComments=function(t){for(var e=0,n="",r=!1,o=[];e<t.length;){var u=t.charAt(e);if(n)u===n?n==='"'||n==="'"?(t.charAt(e-1)!=="\\"&&(n=""),o.push(u)):(n="",r=!1):n==="*/"&&u==="*"&&e+1<t.length?(t.charAt(e+1)==="/"&&(n=""),n===""&&(r=!1,e++)):r||o.push(u);else{switch(u){case'"':case"'":case"`":n=u;break;case"/":if(e+1<t.length){var f=t.charAt(e+1);f==="/"?(n=`
`,r=!0):f==="*"&&(n="*/",r=!0)}}r||o.push(u)}e++}return o.join("")},i.prototype._replaceFunctionCallsByCode=function(){for(var t=!1,e=0,n=this._functionDescr;e<n.length;e++)for(var r=n[e],o=r.name,u=r.type,f=r.parameters,v=r.body,y=0;y<this._sourceCode.length;){var D=this._sourceCode.indexOf(o,y);if(D<0)break;var w=this._skipWhitespaces(this._sourceCode,D+o.length);if(w!==this._sourceCode.length&&this._sourceCode.charAt(w)==="("){var F=this._extractBetweenMarkers("(",")",this._sourceCode,w);if(F<0)this.debug&&console.warn("Could not extract the parameters of the function call. Function '"+o+"' (type="+u+"). callParamsStartIndex="+w),y=D+o.length;else{for(var z=this._sourceCode.substring(w+1,F),k=this._removeComments(z).split(","),K=[],oe=0;oe<k.length;++oe){var ae=k[oe].trim();K.push(ae)}var ue=u!=="void"?o+"_"+r.callIndex++:null;if(ue&&K.push(ue+" ="),K.length===f.length){y=F+1;var de=this._replaceNames(v,f,K),me=D>0?this._sourceCode.substring(0,D):"",ye=F+1<this._sourceCode.length-1?this._sourceCode.substring(F+1):"";if(ue){var Ee=this._findBackward(this._sourceCode,D-1,`
`);me=this._sourceCode.substring(0,Ee+1);var Ae=this._sourceCode.substring(Ee+1,D);this._sourceCode=me+u+" "+ue+`;
`+de+`
`+Ae+ue+ye,this.debug&&console.log("Replace function call by code. Function '"+o+"' (type="+u+"). injectDeclarationIndex="+Ee)}else this._sourceCode=me+de+ye,y+=de.length-(F+1-D),this.debug&&console.log("Replace function call by code. Function '"+o+"' (type="+u+"). functionCallIndex="+D);t=!0}else this.debug&&console.warn("Invalid function call: not the same number of parameters for the call than the number expected by the function. Function '"+o+"' (type="+u+"). function parameters="+f+", call parameters="+K),y=D+o.length}}else y=D+o.length}return t},i.prototype._findBackward=function(t,e,n){for(;e>=0&&t.charAt(e)!==n;)e--;return e},i.prototype._escapeRegExp=function(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")},i.prototype._replaceNames=function(t,e,n){for(var r=0;r<e.length;++r){var o=new RegExp(this._escapeRegExp(e[r]),"g"),u=n[r];t=t.replace(o,u)}return t},i._RegexpFindFunctionNameAndType=/((\s+?)(\w+)\s+(\w+)\s*?)$/,i}(),MI=function(){function i(){this.isAsync=!1,this.isReady=!1}return i.prototype._getVertexShaderCode=function(){return null},i.prototype._getFragmentShaderCode=function(){return null},i.prototype._handlesSpectorRebuildCallback=function(t){throw new Error("Not implemented")},i}(),Yy=function(i){function t(){return i!==null&&i.apply(this,arguments)||this}return Object(p.d)(t,i),t}(Xy.a),Ky=function(i){function t(){return i!==null&&i.apply(this,arguments)||this}return Object(p.d)(t,i),t.prototype.getInternalTexture=function(){return this},t.prototype.getViewCount=function(){return 1},t}(Nt.a),II=function(i){function t(){var e=i.call(this,null)||this;return e._native=new _native.Engine,e.INVALID_HANDLE=65535,e._boundBuffersVertexArray=null,e._currentDepthTest=e._native.DEPTH_TEST_LEQUAL,e._webGLVersion=2,e.disableUniformBuffers=!0,e._caps={maxTexturesImageUnits:16,maxVertexTextureImageUnits:16,maxCombinedTexturesImageUnits:32,maxTextureSize:512,maxCubemapTextureSize:512,maxRenderTextureSize:512,maxVertexAttribs:16,maxVaryingVectors:16,maxFragmentUniformVectors:16,maxVertexUniformVectors:16,standardDerivatives:!0,astc:null,pvrtc:null,etc1:null,etc2:null,bptc:null,maxAnisotropy:16,uintIndices:!0,fragmentDepthSupported:!1,highPrecisionShaderSupported:!0,colorBufferFloat:!1,textureFloat:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloat:!1,textureHalfFloatLinearFiltering:!1,textureHalfFloatRender:!1,textureLOD:!0,drawBuffersExtension:!1,depthTextureExtension:!1,vertexArrayObject:!0,instancedArrays:!1,canUseTimestampForTimerQuery:!1,blendMinMax:!1,maxMSAASamples:1},et.b.Log("Babylon Native (v"+Ge.a.Version+") launched"),et.b.LoadScript=function(n,r,o,u){et.b.LoadFile(n,function(f){Function(f).apply(null),r&&r()},void 0,void 0,!1,function(f,v){o&&o("LoadScript Error",v)})},typeof URL=="undefined"&&(window.URL={createObjectURL:function(){},revokeObjectURL:function(){}}),typeof Blob=="undefined"&&(window.Blob=function(){}),e._shaderProcessor=new Wy.a,e}return Object(p.d)(t,i),t.prototype.getHardwareScalingLevel=function(){return 1},t.prototype.dispose=function(){i.prototype.dispose.call(this),this._boundBuffersVertexArray&&this._native.deleteVertexArray(this._boundBuffersVertexArray),this._native.dispose()},t.prototype._queueNewFrame=function(e,n){return n.requestAnimationFrame&&n!==window?n.requestAnimationFrame(e):this._native.requestAnimationFrame(e),0},t.prototype._bindUnboundFramebuffer=function(e){this._currentFramebuffer!==e&&(this._currentFramebuffer&&this._native.unbindFramebuffer(this._currentFramebuffer),e&&this._native.bindFramebuffer(e),this._currentFramebuffer=e)},t.prototype.getHostDocument=function(){return null},t.prototype.clear=function(e,n,r,o){o===void 0&&(o=!1);var u=0;n&&e&&(this._native.clearColor(e.r,e.g,e.b,e.a!==void 0?e.a:1),u|=this._native.CLEAR_FLAG_COLOR),r&&(this._native.clearDepth(1),u|=this._native.CLEAR_FLAG_DEPTH),o&&(this._native.clearStencil(0),u|=this._native.CLEAR_FLAG_STENCIL),this._native.clear(u)},t.prototype.createIndexBuffer=function(e,n){var r=this._normalizeIndexData(e),o=new Yy;if(o.references=1,o.is32Bits=r.BYTES_PER_ELEMENT===4,r.length){if(o.nativeIndexBuffer=this._native.createIndexBuffer(r,n!=null&&n),o.nativeVertexBuffer===this.INVALID_HANDLE)throw new Error("Could not create a native index buffer.")}else o.nativeVertexBuffer=this.INVALID_HANDLE;return o},t.prototype.createVertexBuffer=function(e,n){var r=new Yy;if(r.references=1,r.nativeVertexBuffer=this._native.createVertexBuffer(ArrayBuffer.isView(e)?e:new Float32Array(e),n!=null&&n),r.nativeVertexBuffer===this.INVALID_HANDLE)throw new Error("Could not create a native vertex buffer.");return r},t.prototype._recordVertexArrayObject=function(e,n,r,o){r&&this._native.recordIndexBuffer(e,r.nativeIndexBuffer);for(var u=o.getAttributesNames(),f=0;f<u.length;f++){var v=o.getAttributeLocation(f);if(v>=0){var y=n[u[f]];if(y){var D=y.getBuffer();D&&this._native.recordVertexBuffer(e,D.nativeVertexBuffer,v,y.byteOffset,y.byteStride,y.getSize(),this._getNativeAttribType(y.type),y.normalized)}}}},t.prototype.bindBuffers=function(e,n,r){this._boundBuffersVertexArray&&this._native.deleteVertexArray(this._boundBuffersVertexArray),this._boundBuffersVertexArray=this._native.createVertexArray(),this._recordVertexArrayObject(this._boundBuffersVertexArray,e,n,r),this._native.bindVertexArray(this._boundBuffersVertexArray)},t.prototype.recordVertexArrayObject=function(e,n,r){var o=this._native.createVertexArray();return this._recordVertexArrayObject(o,e,n,r),o},t.prototype.bindVertexArrayObject=function(e){this._native.bindVertexArray(e)},t.prototype.releaseVertexArrayObject=function(e){this._native.deleteVertexArray(e)},t.prototype.getAttributes=function(e,n){var r=e;return this._native.getAttributes(r.nativeProgram,n)},t.prototype.drawElementsType=function(e,n,r,o){this._drawCalls.addCount(1,!1),this._native.drawIndexed(e,n,r)},t.prototype.drawArraysType=function(e,n,r,o){this._drawCalls.addCount(1,!1),this._native.draw(e,n,r)},t.prototype.createPipelineContext=function(){return new MI},t.prototype._preparePipelineContext=function(e,n,r,o,u,f,v){var y=e;y.nativeProgram=o?this.createRawShaderProgram(e,n,r,void 0,v):this.createShaderProgram(e,n,r,f,void 0,v)},t.prototype._isRenderingStateCompiled=function(e){return!0},t.prototype._executeWhenRenderingStateIsCompiled=function(e,n){n()},t.prototype.createRawShaderProgram=function(e,n,r,o,u){throw new Error("Not Supported")},t.prototype.createShaderProgram=function(e,n,r,o,u,f){this.onBeforeShaderCompilationObservable.notifyObservers(this);var v=new zp(n);v.processCode(),n=v.code;var y=new zp(r);y.processCode(),r=y.code,n=en.a._ConcatenateShader(n,o),r=en.a._ConcatenateShader(r,o);var D=this._native.createProgram(n,r);return this.onAfterShaderCompilationObservable.notifyObservers(this),D},t.prototype._setProgram=function(e){this._currentProgram!==e&&(this._native.setProgram(e),this._currentProgram=e)},t.prototype._releaseEffect=function(e){},t.prototype._deletePipelineContext=function(e){},t.prototype.getUniforms=function(e,n){var r=e;return this._native.getUniforms(r.nativeProgram,n)},t.prototype.bindUniformBlock=function(e,n,r){throw new Error("Not Implemented")},t.prototype.bindSamplers=function(e){var n=e.getPipelineContext();this._setProgram(n.nativeProgram);for(var r=e.getSamplers(),o=0;o<r.length;o++){var u=e.getUniform(r[o]);u&&(this._boundUniforms[o]=u)}this._currentEffect=null},t.prototype.setMatrix=function(e,n){e&&this._native.setMatrix(e,n.toArray())},t.prototype.getRenderWidth=function(e){return e===void 0&&(e=!1),!e&&this._currentRenderTarget?this._currentRenderTarget.width:this._native.getRenderWidth()},t.prototype.getRenderHeight=function(e){return e===void 0&&(e=!1),!e&&this._currentRenderTarget?this._currentRenderTarget.height:this._native.getRenderHeight()},t.prototype.setViewport=function(e,n,r){this._cachedViewport=e,this._native.setViewPort(e.x,e.y,e.width,e.height)},t.prototype.setState=function(e,n,r,o){n===void 0&&(n=0),o===void 0&&(o=!1),this._native.setState(e,n,o)},t.prototype.setZOffset=function(e){this._native.setZOffset(e)},t.prototype.getZOffset=function(){return this._native.getZOffset()},t.prototype.setDepthBuffer=function(e){this._native.setDepthTest(e?this._currentDepthTest:this._native.DEPTH_TEST_ALWAYS)},t.prototype.getDepthWrite=function(){return this._native.getDepthWrite()},t.prototype.setDepthFunctionToGreater=function(){this._currentDepthTest=this._native.DEPTH_TEST_GREATER,this._native.setDepthTest(this._currentDepthTest)},t.prototype.setDepthFunctionToGreaterOrEqual=function(){this._currentDepthTest=this._native.DEPTH_TEST_GEQUAL,this._native.setDepthTest(this._currentDepthTest)},t.prototype.setDepthFunctionToLess=function(){this._currentDepthTest=this._native.DEPTH_TEST_LESS,this._native.setDepthTest(this._currentDepthTest)},t.prototype.setDepthFunctionToLessOrEqual=function(){this._currentDepthTest=this._native.DEPTH_TEST_LEQUAL,this._native.setDepthTest(this._currentDepthTest)},t.prototype.setDepthWrite=function(e){this._native.setDepthWrite(e)},t.prototype.setColorWrite=function(e){this._native.setColorWrite(e),this._colorWrite=e},t.prototype.getColorWrite=function(){return this._colorWrite},t.prototype.setAlphaConstants=function(e,n,r,o){throw new Error("Setting alpha blend constant color not yet implemented.")},t.prototype.setAlphaMode=function(e,n){n===void 0&&(n=!1),this._alphaMode!==e&&(e=this._getNativeAlphaMode(e),this._native.setBlendMode(e),n||this.setDepthWrite(e===g.a.ALPHA_DISABLE),this._alphaMode=e)},t.prototype.getAlphaMode=function(){return this._alphaMode},t.prototype.setInt=function(e,n){return!!e&&(this._native.setInt(e,n),!0)},t.prototype.setIntArray=function(e,n){return!!e&&(this._native.setIntArray(e,n),!0)},t.prototype.setIntArray2=function(e,n){return!!e&&(this._native.setIntArray2(e,n),!0)},t.prototype.setIntArray3=function(e,n){return!!e&&(this._native.setIntArray3(e,n),!0)},t.prototype.setIntArray4=function(e,n){return!!e&&(this._native.setIntArray4(e,n),!0)},t.prototype.setFloatArray=function(e,n){return!!e&&(this._native.setFloatArray(e,n),!0)},t.prototype.setFloatArray2=function(e,n){return!!e&&(this._native.setFloatArray2(e,n),!0)},t.prototype.setFloatArray3=function(e,n){return!!e&&(this._native.setFloatArray3(e,n),!0)},t.prototype.setFloatArray4=function(e,n){return!!e&&(this._native.setFloatArray4(e,n),!0)},t.prototype.setArray=function(e,n){return!!e&&(this._native.setFloatArray(e,n),!0)},t.prototype.setArray2=function(e,n){return!!e&&(this._native.setFloatArray2(e,n),!0)},t.prototype.setArray3=function(e,n){return!!e&&(this._native.setFloatArray3(e,n),!0)},t.prototype.setArray4=function(e,n){return!!e&&(this._native.setFloatArray4(e,n),!0)},t.prototype.setMatrices=function(e,n){return!!e&&(this._native.setMatrices(e,n),!0)},t.prototype.setMatrix3x3=function(e,n){return!!e&&(this._native.setMatrix3x3(e,n),!0)},t.prototype.setMatrix2x2=function(e,n){return!!e&&(this._native.setMatrix2x2(e,n),!0)},t.prototype.setFloat=function(e,n){return!!e&&(this._native.setFloat(e,n),!0)},t.prototype.setFloat2=function(e,n,r){return!!e&&(this._native.setFloat2(e,n,r),!0)},t.prototype.setFloat3=function(e,n,r,o){return!!e&&(this._native.setFloat3(e,n,r,o),!0)},t.prototype.setFloat4=function(e,n,r,o,u){return!!e&&(this._native.setFloat4(e,n,r,o,u),!0)},t.prototype.setColor3=function(e,n){return!!e&&(this._native.setFloat3(e,n.r,n.g,n.b),!0)},t.prototype.setColor4=function(e,n,r){return!!e&&(this._native.setFloat4(e,n.r,n.g,n.b,r),!0)},t.prototype.wipeCaches=function(e){this.preventCacheWipeBetweenFrames||(this.resetTextureCache(),this._currentEffect=null,e&&(this._currentProgram=null,this._stencilState.reset(),this._depthCullingState.reset(),this._alphaState.reset()),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null)},t.prototype._createTexture=function(){return this._native.createTexture()},t.prototype._deleteTexture=function(e){this._native.deleteTexture(e)},t.prototype.updateDynamicTexture=function(e,n,r,o,u){this.createTexture("data:my_image_name",!0,r,null,ke.a.BILINEAR_SAMPLINGMODE,void 0,void 0,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAYSURBVChTY/z//z8DPsAEpXGC4aCAgQEAGGMDDWwwgqsAAAAASUVORK5CYII=",e,t.TEXTUREFORMAT_RGBA,null,void 0)},t.prototype.createTexture=function(e,n,r,o,u,f,v,y,D,w,F,z,k){var K=this;u===void 0&&(u=g.a.TEXTURE_TRILINEAR_SAMPLINGMODE),f===void 0&&(f=null),v===void 0&&(v=null),y===void 0&&(y=null),D===void 0&&(D=null),w===void 0&&(w=null),F===void 0&&(F=null);var oe=(e=e||"").substr(0,5)==="data:",ae=oe&&e.indexOf(";base64,")!==-1,ue=D||new Nt.a(this,Nt.b.Url),de=e;!this._transformTextureUrl||ae||D||y||(e=this._transformTextureUrl(e));for(var me=e.lastIndexOf("."),ye=F||(me>-1?e.substring(me).toLowerCase():""),Ee=null,Ae=0,Ie=Ge.a._TextureLoaders;Ae<Ie.length;Ae++){var Re=Ie[Ae];if(Re.canLoad(ye)){Ee=Re;break}}o&&o._addPendingData(ue),ue.url=e,ue.generateMipMaps=!n,ue.samplingMode=u,ue.invertY=r,this.doNotHandleContextLost||(ue._buffer=y);var Pe=null;if(f&&!D&&(Pe=ue.onLoadedObservable.add(f)),D||this._internalTexturesCache.push(ue),Ee)throw new Error("Loading textures from IInternalTextureLoader not yet implemented.");var Ce=function(Be){var Oe=ue._webGLTexture;Oe?K._native.loadTexture(Oe,Be,!n,r,function(){ue.baseWidth=K._native.getTextureWidth(Oe),ue.baseHeight=K._native.getTextureHeight(Oe),ue.width=ue.baseWidth,ue.height=ue.baseHeight,ue.isReady=!0;var Ve=K._getNativeSamplingMode(u);K._native.setTextureSampling(Oe,Ve),o&&o._removePendingData(ue),ue.onLoadedObservable.notifyObservers(ue),ue.onLoadedObservable.clear()},function(){throw new Error("Could not load a native texture.")}):o&&o._removePendingData(ue)};if(oe)if(y instanceof ArrayBuffer)Ce(new Uint8Array(y));else if(ArrayBuffer.isView(y))Ce(y);else{if(typeof y!="string")throw new Error("Unsupported buffer type");Ce(new Uint8Array(et.b.DecodeBase64(y)))}else ae?Ce(new Uint8Array(et.b.DecodeBase64(e))):this._loadFile(e,function(Be){return Ce(new Uint8Array(Be))},void 0,void 0,!0,function(Be,Oe){(function(Ve,Le){o&&o._removePendingData(ue),e===de?(Pe&&ue.onLoadedObservable.remove(Pe),ne.a.UseFallbackTexture&&K.createTexture(ne.a.FallbackTexture,n,ue.invertY,o,u,null,v,y,ue),v&&v((Ve||"Unknown error")+(ne.a.UseFallbackTexture?" - Fallback texture was used":""),Le)):(_.a.Warn("Failed to load "+e+", falling back to "+de),K.createTexture(de,n,ue.invertY,o,u,f,v,y,ue,w,F,z,k))})("Unable to load "+(Be&&Be.responseURL,Oe))});return ue},t.prototype._createDepthStencilTexture=function(e,n){var r=new Ky(this,Nt.b.Depth),o=e.width||e,u=e.height||e,f=this._native.createDepthTexture(r._webGLTexture,o,u);return r._framebuffer=f,r},t.prototype._releaseFramebufferObjects=function(e){},t.prototype.createCubeTexture=function(e,n,r,o,u,f,v,y,D,w,F,z){var k=this;u===void 0&&(u=null),f===void 0&&(f=null),y===void 0&&(y=null),w===void 0&&(w=0),F===void 0&&(F=0),z===void 0&&(z=null);var K=z||new Nt.a(this,Nt.b.Cube);K.isCube=!0,K.url=e,K.generateMipMaps=!o,K._lodGenerationScale=w,K._lodGenerationOffset=F,this._doNotHandleContextLost||(K._extension=y,K._files=r);var oe=e.lastIndexOf(".");if((y||(oe>-1?e.substring(oe).toLowerCase():""))===".env"){if(r&&r.length===6)throw new Error("Multi-file loading not allowed on env files.");this._loadFile(e,function(ue){return function(de){var me=so.GetEnvInfo(de);if(K.width=me.width,K.height=me.width,so.UploadEnvSpherical(K,me),me.version!==1)throw new Error('Unsupported babylon environment map version "'+me.version+'"');var ye=me.specular;if(!ye)throw new Error("Nothing else parsed so far");K._lodGenerationScale=ye.lodGenerationScale;var Ee=so.CreateImageDataArrayBufferViews(de,me);K.format=g.a.TEXTUREFORMAT_RGBA,K.type=g.a.TEXTURETYPE_UNSIGNED_INT,K.generateMipMaps=!0,K.getEngine().updateTextureSamplingMode(ke.a.TRILINEAR_SAMPLINGMODE,K),K._isRGBD=!0,K.invertY=!0,k._native.loadCubeTextureWithMips(K._webGLTexture,Ee,function(){K.isReady=!0,u&&u()},function(){throw new Error("Could not load a native cube texture.")})}(new Uint8Array(ue))},void 0,void 0,!0,function(ue,de){f&&ue&&f(ue.status+" "+ue.statusText,de)})}else{if(!r||r.length!==6)throw new Error("Cannot load cubemap because 6 files were not defined");var ae=[r[0],r[3],r[1],r[4],r[2],r[5]];Promise.all(ae.map(function(ue){return et.b.LoadFileAsync(ue).then(function(de){return new Uint8Array(de)})})).then(function(ue){return new Promise(function(de,me){k._native.loadCubeTexture(K._webGLTexture,ue,!o,de,me)})}).then(function(){K.isReady=!0,u&&u()},function(ue){f&&f("Failed to load cubemap: "+ue.message,ue)})}return this._internalTexturesCache.push(K),K},t.prototype.createRenderTargetTexture=function(e,n){var r=new fs.a;n!==void 0&&typeof n=="object"?(r.generateMipMaps=n.generateMipMaps,r.generateDepthBuffer=n.generateDepthBuffer===void 0||n.generateDepthBuffer,r.generateStencilBuffer=r.generateDepthBuffer&&n.generateStencilBuffer,r.type=n.type===void 0?g.a.TEXTURETYPE_UNSIGNED_INT:n.type,r.samplingMode=n.samplingMode===void 0?g.a.TEXTURE_TRILINEAR_SAMPLINGMODE:n.samplingMode,r.format=n.format===void 0?g.a.TEXTUREFORMAT_RGBA:n.format):(r.generateMipMaps=n,r.generateDepthBuffer=!0,r.generateStencilBuffer=!1,r.type=g.a.TEXTURETYPE_UNSIGNED_INT,r.samplingMode=g.a.TEXTURE_TRILINEAR_SAMPLINGMODE,r.format=g.a.TEXTUREFORMAT_RGBA),(r.type!==g.a.TEXTURETYPE_FLOAT||this._caps.textureFloatLinearFiltering)&&(r.type!==g.a.TEXTURETYPE_HALF_FLOAT||this._caps.textureHalfFloatLinearFiltering)||(r.samplingMode=g.a.TEXTURE_NEAREST_SAMPLINGMODE);var o=new Ky(this,Nt.b.RenderTarget),u=e.width||e,f=e.height||e;r.type!==g.a.TEXTURETYPE_FLOAT||this._caps.textureFloat||(r.type=g.a.TEXTURETYPE_UNSIGNED_INT,_.a.Warn("Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type"));var v=this._native.createFramebuffer(o._webGLTexture,u,f,this._getNativeTextureFormat(r.format,r.type),r.samplingMode,!!r.generateStencilBuffer,r.generateDepthBuffer,!!r.generateMipMaps);return o._framebuffer=v,o.baseWidth=u,o.baseHeight=f,o.width=u,o.height=f,o.isReady=!0,o.samples=1,o.generateMipMaps=!!r.generateMipMaps,o.samplingMode=r.samplingMode,o.type=r.type,o.format=r.format,o._generateDepthBuffer=r.generateDepthBuffer,o._generateStencilBuffer=!!r.generateStencilBuffer,this._internalTexturesCache.push(o),o},t.prototype.updateTextureSamplingMode=function(e,n){if(n._webGLTexture){var r=this._getNativeSamplingMode(e);this._native.setTextureSampling(n._webGLTexture,r)}n.samplingMode=e},t.prototype.bindFramebuffer=function(e,n,r,o,u){if(n)throw new Error("Cuboid frame buffers are not yet supported in NativeEngine.");if(r||o)throw new Error("Required width/height for frame buffers not yet supported in NativeEngine.");e._depthStencilTexture?this._bindUnboundFramebuffer(e._depthStencilTexture._framebuffer):this._bindUnboundFramebuffer(e._framebuffer)},t.prototype.unBindFramebuffer=function(e,n,r){n===void 0&&(n=!1),n&&_.a.Warn("Disabling mipmap generation not yet supported in NativeEngine. Ignoring."),r&&r(),this._bindUnboundFramebuffer(null)},t.prototype.createDynamicVertexBuffer=function(e){return this.createVertexBuffer(e,!0)},t.prototype.updateDynamicIndexBuffer=function(e,n,r){r===void 0&&(r=0);var o=e,u=this._normalizeIndexData(n);o.is32Bits=u.BYTES_PER_ELEMENT===4,this._native.updateDynamicIndexBuffer(o.nativeIndexBuffer,u,r)},t.prototype.updateDynamicVertexBuffer=function(e,n,r,o){var u=e,f=ArrayBuffer.isView(n)?n:new Float32Array(n);this._native.updateDynamicVertexBuffer(u.nativeVertexBuffer,f,r??0,o??f.byteLength)},t.prototype._setTexture=function(e,n,r,o){o===void 0&&(o=!1);var u,f=this._boundUniforms[e];if(!f)return!1;if(!n)return this._boundTexturesCache[e]!=null&&(this._activeChannel=e,this._native.setTexture(f,null)),!1;if(n.video)this._activeChannel=e,n.update();else if(n.delayLoadState===g.a.DELAYLOADSTATE_NOTLOADED)return n.delayLoad(),!1;return u=o?n.depthStencilTexture:n.isReady()?n.getInternalTexture():n.isCube?this.emptyCubeTexture:n.is3D?this.emptyTexture3D:n.is2DArray?this.emptyTexture2DArray:this.emptyTexture,this._activeChannel=e,!(!u||!u._webGLTexture)&&(this._native.setTextureWrapMode(u._webGLTexture,this._getAddressMode(n.wrapU),this._getAddressMode(n.wrapV),this._getAddressMode(n.wrapR)),this._updateAnisotropicLevel(n),this._native.setTexture(f,u._webGLTexture),!0)},t.prototype._updateAnisotropicLevel=function(e){var n=e.getInternalTexture(),r=e.anisotropicFilteringLevel;n&&n._webGLTexture&&n._cachedAnisotropicFilteringLevel!==r&&(this._native.setTextureAnisotropicLevel(n._webGLTexture,r),n._cachedAnisotropicFilteringLevel=r)},t.prototype._getAddressMode=function(e){switch(e){case g.a.TEXTURE_WRAP_ADDRESSMODE:return this._native.ADDRESS_MODE_WRAP;case g.a.TEXTURE_CLAMP_ADDRESSMODE:return this._native.ADDRESS_MODE_CLAMP;case g.a.TEXTURE_MIRROR_ADDRESSMODE:return this._native.ADDRESS_MODE_MIRROR;default:throw new Error("Unexpected wrap mode: "+e+".")}},t.prototype._bindTexture=function(e,n){var r=this._boundUniforms[e];r&&this._native.setTexture(r,n._webGLTexture)},t.prototype._deleteBuffer=function(e){e.nativeIndexBuffer&&(this._native.deleteIndexBuffer(e.nativeIndexBuffer),delete e.nativeIndexBuffer),e.nativeVertexBuffer&&(this._native.deleteVertexBuffer(e.nativeVertexBuffer),delete e.nativeVertexBuffer)},t.prototype.releaseEffects=function(){},t.prototype._uploadCompressedDataToTextureDirectly=function(e,n,r,o,u,f,v){throw new Error("_uploadCompressedDataToTextureDirectly not implemented.")},t.prototype._uploadDataToTextureDirectly=function(e,n,r,o){throw new Error("_uploadDataToTextureDirectly not implemented.")},t.prototype._uploadArrayBufferViewToTexture=function(e,n,r,o){throw new Error("_uploadArrayBufferViewToTexture not implemented.")},t.prototype._uploadImageToTexture=function(e,n,r,o){throw new Error("_uploadArrayBufferViewToTexture not implemented.")},t.prototype._getNativeSamplingMode=function(e){switch(e){case g.a.TEXTURE_NEAREST_NEAREST:return this._native.TEXTURE_NEAREST_NEAREST;case g.a.TEXTURE_LINEAR_LINEAR:return this._native.TEXTURE_LINEAR_LINEAR;case g.a.TEXTURE_LINEAR_LINEAR_MIPLINEAR:return this._native.TEXTURE_LINEAR_LINEAR_MIPLINEAR;case g.a.TEXTURE_NEAREST_NEAREST_MIPNEAREST:return this._native.TEXTURE_NEAREST_NEAREST_MIPNEAREST;case g.a.TEXTURE_NEAREST_LINEAR_MIPNEAREST:return this._native.TEXTURE_NEAREST_LINEAR_MIPNEAREST;case g.a.TEXTURE_NEAREST_LINEAR_MIPLINEAR:return this._native.TEXTURE_NEAREST_LINEAR_MIPLINEAR;case g.a.TEXTURE_NEAREST_LINEAR:return this._native.TEXTURE_NEAREST_LINEAR;case g.a.TEXTURE_NEAREST_NEAREST_MIPLINEAR:return this._native.TEXTURE_NEAREST_NEAREST_MIPLINEAR;case g.a.TEXTURE_LINEAR_NEAREST_MIPNEAREST:return this._native.TEXTURE_LINEAR_NEAREST_MIPNEAREST;case g.a.TEXTURE_LINEAR_NEAREST_MIPLINEAR:return this._native.TEXTURE_LINEAR_NEAREST_MIPLINEAR;case g.a.TEXTURE_LINEAR_LINEAR_MIPNEAREST:return this._native.TEXTURE_LINEAR_LINEAR_MIPNEAREST;case g.a.TEXTURE_LINEAR_NEAREST:return this._native.TEXTURE_LINEAR_NEAREST;default:throw new Error("Unsupported sampling mode: "+e+".")}},t.prototype._getNativeTextureFormat=function(e,n){if(e==g.a.TEXTUREFORMAT_RGBA&&n==g.a.TEXTURETYPE_UNSIGNED_INT)return this._native.TEXTURE_FORMAT_RGBA8;if(e==g.a.TEXTUREFORMAT_RGBA&&n==g.a.TEXTURETYPE_FLOAT)return this._native.TEXTURE_FORMAT_RGBA32F;throw new Error("Unsupported texture format or type: format "+e+", type "+n+".")},t.prototype._getNativeAlphaMode=function(e){switch(e){case g.a.ALPHA_DISABLE:return this._native.ALPHA_DISABLE;case g.a.ALPHA_ADD:return this._native.ALPHA_ADD;case g.a.ALPHA_COMBINE:return this._native.ALPHA_COMBINE;case g.a.ALPHA_SUBTRACT:return this._native.ALPHA_SUBTRACT;case g.a.ALPHA_MULTIPLY:return this._native.ALPHA_MULTIPLY;case g.a.ALPHA_MAXIMIZED:return this._native.ALPHA_MAXIMIZED;case g.a.ALPHA_ONEONE:return this._native.ALPHA_ONEONE;case g.a.ALPHA_PREMULTIPLIED:return this._native.ALPHA_PREMULTIPLIED;case g.a.ALPHA_PREMULTIPLIED_PORTERDUFF:return this._native.ALPHA_PREMULTIPLIED_PORTERDUFF;case g.a.ALPHA_INTERPOLATE:return this._native.ALPHA_INTERPOLATE;case g.a.ALPHA_SCREENMODE:return this._native.ALPHA_SCREENMODE;default:throw new Error("Unsupported alpha mode: "+e+".")}},t.prototype._getNativeAttribType=function(e){switch(e){case De.b.UNSIGNED_BYTE:return this._native.ATTRIB_TYPE_UINT8;case De.b.SHORT:return this._native.ATTRIB_TYPE_INT16;case De.b.FLOAT:return this._native.ATTRIB_TYPE_FLOAT;default:throw new Error("Unsupported attribute type: "+e+".")}},t}(Ge.a),DI=c(74),oh=function(){function i(){}return i.COPY=1,i.CUT=2,i.PASTE=3,i}(),wI=function(){function i(t,e){this.type=t,this.event=e}return i.GetTypeFromCharacter=function(t){switch(t){case 67:return oh.COPY;case 86:return oh.PASTE;case 88:return oh.CUT;default:return-1}},i}(),Gp=c(83),lo=c(69);(function(i){i[i.Clean=0]="Clean",i[i.Stop=1]="Stop",i[i.Sync=2]="Sync",i[i.NoSync=3]="NoSync"})(co||(co={}));var an=function(){function i(){}return Object.defineProperty(i,"ForceFullSceneLoadingForIncremental",{get:function(){return lo.a.ForceFullSceneLoadingForIncremental},set:function(t){lo.a.ForceFullSceneLoadingForIncremental=t},enumerable:!1,configurable:!0}),Object.defineProperty(i,"ShowLoadingScreen",{get:function(){return lo.a.ShowLoadingScreen},set:function(t){lo.a.ShowLoadingScreen=t},enumerable:!1,configurable:!0}),Object.defineProperty(i,"loggingLevel",{get:function(){return lo.a.loggingLevel},set:function(t){lo.a.loggingLevel=t},enumerable:!1,configurable:!0}),Object.defineProperty(i,"CleanBoneMatrixWeights",{get:function(){return lo.a.CleanBoneMatrixWeights},set:function(t){lo.a.CleanBoneMatrixWeights=t},enumerable:!1,configurable:!0}),i.GetDefaultPlugin=function(){return i._registeredPlugins[".babylon"]},i._GetPluginForExtension=function(t){var e=i._registeredPlugins[t];return e||(_.a.Warn("Unable to find a plugin to load "+t+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/how_to/load_from_any_file_type"),i.GetDefaultPlugin())},i._GetPluginForDirectLoad=function(t){for(var e in i._registeredPlugins){var n=i._registeredPlugins[e].plugin;if(n.canDirectLoad&&n.canDirectLoad(t))return i._registeredPlugins[e]}return i.GetDefaultPlugin()},i._GetPluginForFilename=function(t){var e=t.indexOf("?");e!==-1&&(t=t.substring(0,e));var n=t.lastIndexOf("."),r=t.substring(n,t.length).toLowerCase();return i._GetPluginForExtension(r)},i._GetDirectLoad=function(t){return t.substr(0,5)==="data:"?t.substr(5):null},i._LoadData=function(t,e,n,r,o,u,f){var v,y=i._GetDirectLoad(t.name),D=f?i._GetPluginForExtension(f):y?i._GetPluginForDirectLoad(t.name):i._GetPluginForFilename(t.name);if(!(v=D.plugin.createPlugin!==void 0?D.plugin.createPlugin():D.plugin))throw"The loader plugin corresponding to the file type you are trying to load has not been found. If using es6, please import the plugin you wish to use before.";if(i.OnPluginActivatedObservable.notifyObservers(v),y){if(v.directLoad){var w=v.directLoad(e,y);w.then?w.then(function(Re){n(v,Re)}).catch(function(Re){o("Error in directLoad of _loadData: "+Re,Re)}):n(v,w)}else n(v,y);return v}var F=D.isBinary,z=function(Re,Pe){e.isDisposed?o("Scene has been disposed"):n(v,Re,Pe)},k=null,K=!1,oe=v.onDisposeObservable;oe&&oe.add(function(){K=!0,k&&(k.abort(),k=null),u()});var ae=function(){if(!K){var Re=function(Ce,Be){z(Ce,Be?Be.responseURL:void 0)},Pe=function(Ce){o(Ce.message,Ce)};k=v.requestFile?v.requestFile(e,t.url,Re,r,F,Pe):e._requestFile(t.url,Re,r,!0,F,Pe)}},ue=t.file||Gp.a.FilesToLoad[t.name.toLowerCase()];if(t.rootUrl.indexOf("file:")===-1||t.rootUrl.indexOf("file:")!==-1&&!ue){var de=e.getEngine(),me=de.enableOfflineSupport;if(me){for(var ye=!1,Ee=0,Ae=e.disableOfflineSupportExceptionRules;Ee<Ae.length;Ee++)if(Ae[Ee].test(t.url)){ye=!0;break}me=!ye}me&&Ge.a.OfflineProviderFactory?e.offlineProvider=Ge.a.OfflineProviderFactory(t.url,ae,de.disableManifestCheck):ae()}else if(ue){var Ie=function(Re){o(Re.message,Re)};k=v.readFile?v.readFile(e,ue,z,r,F,Ie):e._readFile(ue,z,r,F,Ie)}else o("Unable to find file named "+t.name);return v},i._GetFileInfo=function(t,e){var n,r,o=null;if(e)if(e.name){var u=e;n=t+u.name,r=u.name,o=u}else{var f=e;if(f.substr(0,1)==="/")return et.b.Error("Wrong sceneFilename parameter"),null;n=t+f,r=f}else n=t,r=et.b.GetFilename(t),t=et.b.GetFolderPath(t);return{url:n,rootUrl:t,name:r,file:o}},i.GetPluginForExtension=function(t){return i._GetPluginForExtension(t).plugin},i.IsPluginForExtensionAvailable=function(t){return!!i._registeredPlugins[t]},i.RegisterPlugin=function(t){if(typeof t.extensions=="string"){var e=t.extensions;i._registeredPlugins[e.toLowerCase()]={plugin:t,isBinary:!1}}else{var n=t.extensions;Object.keys(n).forEach(function(r){i._registeredPlugins[r.toLowerCase()]={plugin:t,isBinary:n[r].isBinary}})}},i.ImportMesh=function(t,e,n,r,o,u,f,v){if(n===void 0&&(n=""),r===void 0&&(r=ne.a.LastCreatedScene),o===void 0&&(o=null),u===void 0&&(u=null),f===void 0&&(f=null),v===void 0&&(v=null),!r)return _.a.Error("No scene available to import mesh to"),null;var y=i._GetFileInfo(e,n);if(!y)return null;var D={};r._addPendingData(D);var w=function(){r._removePendingData(D)},F=function(K,oe){var ae="Unable to import meshes from "+y.url+": "+K;f?f(r,ae,oe):_.a.Error(ae),w()},z=u?function(K){try{u(K)}catch(oe){F("Error in onProgress callback: "+oe,oe)}}:void 0,k=function(K,oe,ae,ue,de,me,ye){if(r.importedMeshesFiles.push(y.url),o)try{o(K,oe,ae,ue,de,me,ye)}catch(Ee){F("Error in onSuccess callback: "+Ee,Ee)}r._removePendingData(D)};return i._LoadData(y,r,function(K,oe,ae){if(K.rewriteRootURL&&(y.rootUrl=K.rewriteRootURL(y.rootUrl,ae)),K.importMesh){var ue=K,de=new Array,me=new Array,ye=new Array;if(!ue.importMesh(t,r,oe,y.rootUrl,de,me,ye,F))return;r.loadingPluginName=K.name,k(de,me,ye,[],[],[],[])}else K.importMeshAsync(t,r,oe,y.rootUrl,z,y.name).then(function(Ee){r.loadingPluginName=K.name,k(Ee.meshes,Ee.particleSystems,Ee.skeletons,Ee.animationGroups,Ee.transformNodes,Ee.geometries,Ee.lights)}).catch(function(Ee){F(Ee.message,Ee)})},z,F,w,v)},i.ImportMeshAsync=function(t,e,n,r,o,u){return n===void 0&&(n=""),r===void 0&&(r=ne.a.LastCreatedScene),o===void 0&&(o=null),u===void 0&&(u=null),new Promise(function(f,v){i.ImportMesh(t,e,n,r,function(y,D,w,F,z,k,K){f({meshes:y,particleSystems:D,skeletons:w,animationGroups:F,transformNodes:z,geometries:k,lights:K})},o,function(y,D,w){v(w||new Error(D))},u)})},i.Load=function(t,e,n,r,o,u,f){return e===void 0&&(e=""),n===void 0&&(n=ne.a.LastCreatedEngine),r===void 0&&(r=null),o===void 0&&(o=null),u===void 0&&(u=null),f===void 0&&(f=null),n?i.Append(t,e,new he.a(n),r,o,u,f):(et.b.Error("No engine available"),null)},i.LoadAsync=function(t,e,n,r,o){return e===void 0&&(e=""),n===void 0&&(n=ne.a.LastCreatedEngine),r===void 0&&(r=null),o===void 0&&(o=null),new Promise(function(u,f){i.Load(t,e,n,function(v){u(v)},r,function(v,y,D){f(D||new Error(y))},o)})},i.Append=function(t,e,n,r,o,u,f){var v=this;if(e===void 0&&(e=""),n===void 0&&(n=ne.a.LastCreatedScene),r===void 0&&(r=null),o===void 0&&(o=null),u===void 0&&(u=null),f===void 0&&(f=null),!n)return _.a.Error("No scene available to append to"),null;var y=i._GetFileInfo(t,e);if(!y)return null;i.ShowLoadingScreen&&!this._showingLoadingScreen&&(this._showingLoadingScreen=!0,n.getEngine().displayLoadingUI(),n.executeWhenReady(function(){n.getEngine().hideLoadingUI(),v._showingLoadingScreen=!1}));var D={};n._addPendingData(D);var w=function(){n._removePendingData(D)},F=function(K,oe){var ae="Unable to load from "+y.url+(K?": "+K:"");u?u(n,ae,oe):_.a.Error(ae),w()},z=o?function(K){try{o(K)}catch(oe){F("Error in onProgress callback",oe)}}:void 0,k=function(){if(r)try{r(n)}catch(K){F("Error in onSuccess callback",K)}n._removePendingData(D)};return i._LoadData(y,n,function(K,oe){if(K.load){if(!K.load(n,oe,y.rootUrl,F))return;n.loadingPluginName=K.name,k()}else K.loadAsync(n,oe,y.rootUrl,z,y.name).then(function(){n.loadingPluginName=K.name,k()}).catch(function(ae){F(ae.message,ae)})},z,F,w,f)},i.AppendAsync=function(t,e,n,r,o){return e===void 0&&(e=""),n===void 0&&(n=ne.a.LastCreatedScene),r===void 0&&(r=null),o===void 0&&(o=null),new Promise(function(u,f){i.Append(t,e,n,function(v){u(v)},r,function(v,y,D){f(D||new Error(y))},o)})},i.LoadAssetContainer=function(t,e,n,r,o,u,f){if(e===void 0&&(e=""),n===void 0&&(n=ne.a.LastCreatedScene),r===void 0&&(r=null),o===void 0&&(o=null),u===void 0&&(u=null),f===void 0&&(f=null),!n)return _.a.Error("No scene available to load asset container to"),null;var v=i._GetFileInfo(t,e);if(!v)return null;var y={};n._addPendingData(y);var D=function(){n._removePendingData(y)},w=function(k,K){var oe="Unable to load assets from "+v.url+(k?": "+k:"");K&&K.message&&(oe+=" ("+K.message+")"),u?u(n,oe,K):_.a.Error(oe),D()},F=o?function(k){try{o(k)}catch(K){w("Error in onProgress callback",K)}}:void 0,z=function(k){if(r)try{r(k)}catch(K){w("Error in onSuccess callback",K)}n._removePendingData(y)};return i._LoadData(v,n,function(k,K){if(k.loadAssetContainer){var oe=k.loadAssetContainer(n,K,v.rootUrl,w);if(!oe)return;n.loadingPluginName=k.name,z(oe)}else k.loadAssetContainerAsync?k.loadAssetContainerAsync(n,K,v.rootUrl,F,v.name).then(function(ae){n.loadingPluginName=k.name,z(ae)}).catch(function(ae){w(ae.message,ae)}):w("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")},F,w,D,f)},i.LoadAssetContainerAsync=function(t,e,n,r,o){return e===void 0&&(e=""),n===void 0&&(n=ne.a.LastCreatedScene),r===void 0&&(r=null),o===void 0&&(o=null),new Promise(function(u,f){i.LoadAssetContainer(t,e,n,function(v){u(v)},r,function(v,y,D){f(D||new Error(y))},o)})},i.ImportAnimations=function(t,e,n,r,o,u,f,v,y,D){if(e===void 0&&(e=""),n===void 0&&(n=ne.a.LastCreatedScene),r===void 0&&(r=!0),o===void 0&&(o=co.Clean),u===void 0&&(u=null),f===void 0&&(f=null),v===void 0&&(v=null),y===void 0&&(y=null),D===void 0&&(D=null),n){if(r){for(var w=0,F=n.animatables;w<F.length;w++)F[w].reset();n.stopAllAnimations(),n.animationGroups.slice().forEach(function(k){k.dispose()}),n.getNodes().forEach(function(k){k.animations&&(k.animations=[])})}else switch(o){case co.Clean:n.animationGroups.slice().forEach(function(k){k.dispose()});break;case co.Stop:n.animationGroups.forEach(function(k){k.stop()});break;case co.Sync:n.animationGroups.forEach(function(k){k.reset(),k.restart()});break;case co.NoSync:break;default:return void _.a.Error("Unknown animation group loading mode value '"+o+"'")}var z=n.animatables.length;this.LoadAssetContainer(t,e,n,function(k){k.mergeAnimationsTo(n,n.animatables.slice(z),u),k.dispose(),n.onAnimationFileImportedObservable.notifyObservers(n),f&&f(n)},v,y,D)}else _.a.Error("No scene available to load animations to")},i.ImportAnimationsAsync=function(t,e,n,r,o,u,f,v,y,D){return e===void 0&&(e=""),n===void 0&&(n=ne.a.LastCreatedScene),r===void 0&&(r=!0),o===void 0&&(o=co.Clean),u===void 0&&(u=null),v===void 0&&(v=null),D===void 0&&(D=null),new Promise(function(w,F){i.ImportAnimations(t,e,n,r,o,u,function(z){w(z)},v,function(z,k,K){F(K||new Error(k))},D)})},i.NO_LOGGING=g.a.SCENELOADER_NO_LOGGING,i.MINIMAL_LOGGING=g.a.SCENELOADER_MINIMAL_LOGGING,i.SUMMARY_LOGGING=g.a.SCENELOADER_SUMMARY_LOGGING,i.DETAILED_LOGGING=g.a.SCENELOADER_DETAILED_LOGGING,i.OnPluginActivatedObservable=new S.c,i._registeredPlugins={},i._showingLoadingScreen=!1,i}(),Hp=function(i){function t(e){var n=i.call(this,e)||this;return n.controllerType=Zr.DAYDREAM,n}return Object(p.d)(t,i),t.prototype.initControllerMesh=function(e,n){var r=this;an.ImportMesh("",t.MODEL_BASE_URL,t.MODEL_FILENAME,e,function(o){r._defaultModel=o[1],r.attachToMesh(r._defaultModel),n&&n(r._defaultModel)})},t.prototype._handleButtonChange=function(e,n,r){if(e===0){var o=this.onTriggerStateChangedObservable;o&&o.notifyObservers(n)}else _.a.Warn("Unrecognized Daydream button index: "+e)},t.MODEL_BASE_URL="https://controllers.babylonjs.com/generic/",t.MODEL_FILENAME="generic.babylon",t.GAMEPAD_ID_PREFIX="Daydream",t}(zo);ji._ControllerFactories.push({canCreate:function(i){return i.id.indexOf(Hp.GAMEPAD_ID_PREFIX)===0},create:function(i){return new Hp(i)}});var Wp=function(i){function t(e){var n=i.call(this,e)||this;return n._buttonIndexToObservableNameMap=["onPadStateChangedObservable","onTriggerStateChangedObservable"],n.controllerType=Zr.GEAR_VR,n._calculatedPosition=new d.e(n.hand=="left"?-.15:.15,-.5,.25),n._disableTrackPosition(n._calculatedPosition),n}return Object(p.d)(t,i),t.prototype.initControllerMesh=function(e,n){var r=this;an.ImportMesh("",t.MODEL_BASE_URL,t.MODEL_FILENAME,e,function(o){var u=new Ne.a("",e);o[1].parent=u,o[1].position.z=-.15,r._defaultModel=u,r.attachToMesh(r._defaultModel),n&&n(r._defaultModel)})},t.prototype._handleButtonChange=function(e,n,r){if(e<this._buttonIndexToObservableNameMap.length){var o=this[this._buttonIndexToObservableNameMap[e]];o&&o.notifyObservers(n)}},t.MODEL_BASE_URL="https://controllers.babylonjs.com/generic/",t.MODEL_FILENAME="generic.babylon",t.GAMEPAD_ID_PREFIX="Gear VR",t}(zo);ji._ControllerFactories.push({canCreate:function(i){return i.id.indexOf(Wp.GAMEPAD_ID_PREFIX)===0||i.id.indexOf("Oculus Go")!==-1||i.id.indexOf("Vive Focus")!==-1},create:function(i){return new Wp(i)}});var ah=function(i){function t(e){return i.call(this,e)||this}return Object(p.d)(t,i),t.prototype.initControllerMesh=function(e,n){var r=this;an.ImportMesh("",t.MODEL_BASE_URL,t.MODEL_FILENAME,e,function(o){r._defaultModel=o[1],r.attachToMesh(r._defaultModel),n&&n(r._defaultModel)})},t.prototype._handleButtonChange=function(e,n,r){console.log("Button id: "+e+"state: "),console.dir(n)},t.MODEL_BASE_URL="https://controllers.babylonjs.com/generic/",t.MODEL_FILENAME="generic.babylon",t}(zo);ji._DefaultControllerFactory=function(i){return new ah(i)};var Xp=function(i){function t(e){var n=i.call(this,e)||this;return n.onSecondaryTriggerStateChangedObservable=new S.c,n.onThumbRestChangedObservable=new S.c,n.controllerType=Zr.OCULUS,n}return Object(p.d)(t,i),t.prototype.initControllerMesh=function(e,n){var r,o=this;r=this.hand==="left"?t.MODEL_LEFT_FILENAME:t.MODEL_RIGHT_FILENAME,an.ImportMesh("",t._IsQuest?t.QUEST_MODEL_BASE_URL:t.MODEL_BASE_URL,r,e,function(u){o._defaultModel=t._IsQuest?u[0]:u[1],o.attachToMesh(o._defaultModel),n&&n(o._defaultModel)})},Object.defineProperty(t.prototype,"onAButtonStateChangedObservable",{get:function(){if(this.hand==="right")return this.onMainButtonStateChangedObservable;throw new Error("No A button on left hand")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onBButtonStateChangedObservable",{get:function(){if(this.hand==="right")return this.onSecondaryButtonStateChangedObservable;throw new Error("No B button on left hand")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onXButtonStateChangedObservable",{get:function(){if(this.hand==="left")return this.onMainButtonStateChangedObservable;throw new Error("No X button on right hand")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onYButtonStateChangedObservable",{get:function(){if(this.hand==="left")return this.onSecondaryButtonStateChangedObservable;throw new Error("No Y button on right hand")},enumerable:!1,configurable:!0}),t.prototype._handleButtonChange=function(e,n,r){var o=n,u=this.hand==="right"?-1:1;switch(e){case 0:return void this.onPadStateChangedObservable.notifyObservers(o);case 1:return!t._IsQuest&&this._defaultModel&&(this._defaultModel.getChildren()[3].rotation.x=.2*-o.value,this._defaultModel.getChildren()[3].position.y=.005*-o.value,this._defaultModel.getChildren()[3].position.z=.005*-o.value),void this.onTriggerStateChangedObservable.notifyObservers(o);case 2:return!t._IsQuest&&this._defaultModel&&(this._defaultModel.getChildren()[4].position.x=u*o.value*.0035),void this.onSecondaryTriggerStateChangedObservable.notifyObservers(o);case 3:return!t._IsQuest&&this._defaultModel&&(o.pressed?this._defaultModel.getChildren()[1].position.y=-.001:this._defaultModel.getChildren()[1].position.y=0),void this.onMainButtonStateChangedObservable.notifyObservers(o);case 4:return!t._IsQuest&&this._defaultModel&&(o.pressed?this._defaultModel.getChildren()[2].position.y=-.001:this._defaultModel.getChildren()[2].position.y=0),void this.onSecondaryButtonStateChangedObservable.notifyObservers(o);case 5:return void this.onThumbRestChangedObservable.notifyObservers(o)}},t.MODEL_BASE_URL="https://controllers.babylonjs.com/oculus/",t.MODEL_LEFT_FILENAME="left.babylon",t.MODEL_RIGHT_FILENAME="right.babylon",t.QUEST_MODEL_BASE_URL="https://controllers.babylonjs.com/oculusQuest/",t._IsQuest=!1,t}(zo);ji._ControllerFactories.push({canCreate:function(i){return Ge.a.LastCreatedEngine&&Ge.a.LastCreatedEngine._vrDisplay&&Ge.a.LastCreatedEngine._vrDisplay.displayName==="Oculus Quest"&&(Xp._IsQuest=!0),i.id.indexOf("Oculus Touch")!==-1},create:function(i){return new Xp(i)}});var Qy=function(i){function t(e){var n=i.call(this,e)||this;return n.controllerType=Zr.VIVE,n._invertLeftStickY=!0,n}return Object(p.d)(t,i),t.prototype.initControllerMesh=function(e,n){var r=this;an.ImportMesh("",t.MODEL_BASE_URL,t.MODEL_FILENAME,e,function(o){r._defaultModel=o[1],r.attachToMesh(r._defaultModel),n&&n(r._defaultModel)})},Object.defineProperty(t.prototype,"onLeftButtonStateChangedObservable",{get:function(){return this.onMainButtonStateChangedObservable},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onRightButtonStateChangedObservable",{get:function(){return this.onMainButtonStateChangedObservable},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onMenuButtonStateChangedObservable",{get:function(){return this.onSecondaryButtonStateChangedObservable},enumerable:!1,configurable:!0}),t.prototype._handleButtonChange=function(e,n,r){var o=n;switch(e){case 0:return void this.onPadStateChangedObservable.notifyObservers(o);case 1:return this._defaultModel&&(this._defaultModel.getChildren()[6].rotation.x=.15*-o.value),void this.onTriggerStateChangedObservable.notifyObservers(o);case 2:return void this.onMainButtonStateChangedObservable.notifyObservers(o);case 3:return this._defaultModel&&(o.pressed?this._defaultModel.getChildren()[2].position.y=-.001:this._defaultModel.getChildren()[2].position.y=0),void this.onSecondaryButtonStateChangedObservable.notifyObservers(o)}},t.MODEL_BASE_URL="https://controllers.babylonjs.com/vive/",t.MODEL_FILENAME="wand.babylon",t}(zo);ji._ControllerFactories.push({canCreate:function(i){return i.id.toLowerCase().indexOf("openvr")!==-1},create:function(i){return new Qy(i)}});var LI=function(){this.buttonMeshes={},this.axisMeshes={}},sh=function(i){function t(e){var n=i.call(this,e)||this;return n._mapping={buttons:["thumbstick","trigger","grip","menu","trackpad"],buttonMeshNames:{trigger:"SELECT",menu:"MENU",grip:"GRASP",thumbstick:"THUMBSTICK_PRESS",trackpad:"TOUCHPAD_PRESS"},buttonObservableNames:{trigger:"onTriggerStateChangedObservable",menu:"onSecondaryButtonStateChangedObservable",grip:"onMainButtonStateChangedObservable",thumbstick:"onPadStateChangedObservable",trackpad:"onTrackpadChangedObservable"},axisMeshNames:["THUMBSTICK_X","THUMBSTICK_Y","TOUCHPAD_TOUCH_X","TOUCHPAD_TOUCH_Y"],pointingPoseMeshName:we.POINTING_POSE},n.onTrackpadChangedObservable=new S.c,n.onTrackpadValuesChangedObservable=new S.c,n.trackpad={x:0,y:0},n.controllerType=Zr.WINDOWS,n._loadedMeshInfo=null,n}return Object(p.d)(t,i),Object.defineProperty(t.prototype,"onTriggerButtonStateChangedObservable",{get:function(){return this.onTriggerStateChangedObservable},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onMenuButtonStateChangedObservable",{get:function(){return this.onSecondaryButtonStateChangedObservable},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onGripButtonStateChangedObservable",{get:function(){return this.onMainButtonStateChangedObservable},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onThumbstickButtonStateChangedObservable",{get:function(){return this.onPadStateChangedObservable},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onTouchpadButtonStateChangedObservable",{get:function(){return this.onTrackpadChangedObservable},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onTouchpadValuesChangedObservable",{get:function(){return this.onTrackpadValuesChangedObservable},enumerable:!1,configurable:!0}),t.prototype._updateTrackpad=function(){!this.browserGamepad.axes||this.browserGamepad.axes[2]==this.trackpad.x&&this.browserGamepad.axes[3]==this.trackpad.y||(this.trackpad.x=this.browserGamepad.axes[this._mapping.axisMeshNames.indexOf("TOUCHPAD_TOUCH_X")],this.trackpad.y=this.browserGamepad.axes[this._mapping.axisMeshNames.indexOf("TOUCHPAD_TOUCH_Y")],this.onTrackpadValuesChangedObservable.notifyObservers(this.trackpad))},t.prototype.update=function(){if(i.prototype.update.call(this),this.browserGamepad.axes&&(this._updateTrackpad(),this._loadedMeshInfo))for(var e=0;e<this._mapping.axisMeshNames.length;e++)this._lerpAxisTransform(e,this.browserGamepad.axes[e])},t.prototype._handleButtonChange=function(e,n,r){var o=this._mapping.buttons[e];if(o){this._updateTrackpad();var u=this[this._mapping.buttonObservableNames[o]];u&&u.notifyObservers(n),this._lerpButtonTransform(o,n.value)}},t.prototype._lerpButtonTransform=function(e,n){if(this._loadedMeshInfo){var r=this._loadedMeshInfo.buttonMeshes[e];r&&r.unpressed.rotationQuaternion&&r.pressed.rotationQuaternion&&r.value.rotationQuaternion&&(d.b.SlerpToRef(r.unpressed.rotationQuaternion,r.pressed.rotationQuaternion,n,r.value.rotationQuaternion),d.e.LerpToRef(r.unpressed.position,r.pressed.position,n,r.value.position))}},t.prototype._lerpAxisTransform=function(e,n){if(this._loadedMeshInfo){var r=this._loadedMeshInfo.axisMeshes[e];if(r&&r.min.rotationQuaternion&&r.max.rotationQuaternion&&r.value.rotationQuaternion){var o=.5*n+.5;d.b.SlerpToRef(r.min.rotationQuaternion,r.max.rotationQuaternion,o,r.value.rotationQuaternion),d.e.LerpToRef(r.min.position,r.max.position,o,r.value.position)}}},t.prototype.initControllerMesh=function(e,n,r){var o,u,f=this;if(r===void 0&&(r=!1),an.IsPluginForExtensionAvailable(".glb")){var v="default";if(this.id&&!r){var y=this.id.match(t.GAMEPAD_ID_PATTERN);v=y&&y[0]||v}u=this.hand==="left"?t.MODEL_LEFT_FILENAME:t.MODEL_RIGHT_FILENAME,o=t.MODEL_BASE_URL+v+"/"}else _.a.Warn("You need to reference GLTF loader to load Windows Motion Controllers model. Falling back to generic models"),o=ah.MODEL_BASE_URL,u=ah.MODEL_FILENAME;an.ImportMesh("",o,u,e,function(D){f._loadedMeshInfo=f.processModel(e,D),f._loadedMeshInfo&&(f._defaultModel=f._loadedMeshInfo.rootNode,f.attachToMesh(f._defaultModel),n&&n(f._defaultModel))},null,function(D,w){_.a.Log(w),_.a.Warn("Failed to retrieve controller model from the remote server: "+o+u),r||f.initControllerMesh(D,n,!0)})},t.prototype.processModel=function(e,n){for(var r=null,o=new Ne.a(this.id+" "+this.hand,e),u=null,f=0;f<n.length;f++){var v=n[f];if(!v.parent){v.isPickable=!1,u=v;break}}return u?(u.setParent(o),r=this.createMeshInfo(o)):_.a.Warn("Could not find root node in model file."),r},t.prototype.createMeshInfo=function(e){var n,r=new LI;for(r.rootNode=e,r.buttonMeshes={},r.axisMeshes={},n=0;n<this._mapping.buttons.length;n++){var o=this._mapping.buttonMeshNames[this._mapping.buttons[n]];if(o){var u=w(e,o);if(u){var f={index:n,value:F(u,"VALUE"),pressed:F(u,"PRESSED"),unpressed:F(u,"UNPRESSED")};f.value&&f.pressed&&f.unpressed?r.buttonMeshes[this._mapping.buttons[n]]=f:_.a.Warn("Missing button submesh under mesh with name: "+o+"(VALUE: "+!!f.value+", PRESSED: "+!!f.pressed+", UNPRESSED:"+!!f.unpressed+")")}else _.a.Warn("Missing button mesh with name: "+o)}else _.a.Log("Skipping unknown button at index: "+n+" with mapped name: "+this._mapping.buttons[n])}for(n=0;n<this._mapping.axisMeshNames.length;n++){var v=this._mapping.axisMeshNames[n];if(v){var y=w(e,v);if(y){var D={index:n,value:F(y,"VALUE"),min:F(y,"MIN"),max:F(y,"MAX")};D.value&&D.min&&D.max?r.axisMeshes[n]=D:_.a.Warn("Missing axis submesh under mesh with name: "+v+"(VALUE: "+!!D.value+", MIN: "+!!D.min+", MAX:"+!!D.max+")")}else _.a.Warn("Missing axis mesh with name: "+v)}else _.a.Log("Skipping unknown axis at index: "+n)}return r.pointingPoseNode=w(e,this._mapping.pointingPoseMeshName),r.pointingPoseNode?this._pointingPoseNode=r.pointingPoseNode:_.a.Warn("Missing pointing pose mesh with name: "+this._mapping.pointingPoseMeshName),r;function w(z,k){return z.getChildren(function(K){return K.name===k},!1)[0]}function F(z,k){return z.getChildren(function(K){return K.name==k},!0)[0]}},t.prototype.getForwardRay=function(e){if(e===void 0&&(e=100),!this._loadedMeshInfo||!this._loadedMeshInfo.pointingPoseNode)return i.prototype.getForwardRay.call(this,e);var n=this._loadedMeshInfo.pointingPoseNode.getWorldMatrix(),r=n.getTranslation(),o=new d.e(0,0,-1),u=d.e.TransformNormal(o,n),f=d.e.Normalize(u);return new Qn.a(r,f,e)},t.prototype.dispose=function(){i.prototype.dispose.call(this),this.onTrackpadChangedObservable.clear(),this.onTrackpadValuesChangedObservable.clear()},t.MODEL_BASE_URL="https://controllers.babylonjs.com/microsoft/",t.MODEL_LEFT_FILENAME="left.glb",t.MODEL_RIGHT_FILENAME="right.glb",t.GAMEPAD_ID_PREFIX="Spatial Controller (Spatial Interaction Source) ",t.GAMEPAD_ID_PATTERN=/([0-9a-zA-Z]+-[0-9a-zA-Z]+)$/,t}(zo),NI=function(i){function t(e){var n=i.call(this,e)||this;return n._mapping={buttons:["trigger","grip","trackpad","thumbstick","menu"],buttonMeshNames:{trigger:"SELECT",menu:"MENU",grip:"GRASP",thumbstick:"THUMBSTICK_PRESS",trackpad:"TOUCHPAD_PRESS"},buttonObservableNames:{trigger:"onTriggerStateChangedObservable",menu:"onSecondaryButtonStateChangedObservable",grip:"onMainButtonStateChangedObservable",thumbstick:"onThumbstickStateChangedObservable",trackpad:"onTrackpadChangedObservable"},axisMeshNames:["TOUCHPAD_TOUCH_X","TOUCHPAD_TOUCH_Y","THUMBSTICK_X","THUMBSTICK_Y"],pointingPoseMeshName:we.POINTING_POSE},n.thumbstickValues={x:0,y:0},n.onThumbstickStateChangedObservable=new S.c,n.onThumbstickValuesChangedObservable=new S.c,n.onTrackpadChangedObservable=n.onPadStateChangedObservable,n.onTrackpadValuesChangedObservable=n.onPadValuesChangedObservable,n}return Object(p.d)(t,i),Object.defineProperty(t.prototype,"onThumbstickButtonStateChangedObservable",{get:function(){return this.onThumbstickStateChangedObservable},enumerable:!1,configurable:!0}),t.prototype._updateTrackpad=function(){!this.browserGamepad.axes||this.browserGamepad.axes[2]==this.thumbstickValues.x&&this.browserGamepad.axes[3]==this.thumbstickValues.y||(this.trackpad.x=this.browserGamepad.axes[2],this.trackpad.y=this.browserGamepad.axes[3],this.onThumbstickValuesChangedObservable.notifyObservers(this.trackpad))},t.prototype.dispose=function(){i.prototype.dispose.call(this),this.onThumbstickStateChangedObservable.clear(),this.onThumbstickValuesChangedObservable.clear()},t}(sh);ji._ControllerFactories.push({canCreate:function(i){return i.id.indexOf(sh.GAMEPAD_ID_PREFIX)===0},create:function(i){return new sh(i)}});var ch=c(75),bs=c(63),jr=c(51),Ir=c(36),nl=function(i){function t(e,n,r,o,u){var f,v,y,D,w,F,z;n===void 0&&(n=M.a.Gray()),r===void 0&&(r=Ir.a.DefaultUtilityLayer),o===void 0&&(o=null),u===void 0&&(u=1);var k=i.call(this,r)||this;k._pointerObserver=null,k.snapDistance=0,k.onSnapObservable=new S.c,k.uniformScaling=!1,k.sensitivity=1,k._isEnabled=!0,k._parent=null,k._dragging=!1,k._tmpVector=new d.e,k._tmpMatrix=new d.a,k._tmpMatrix2=new d.a,k._parent=o,k._coloredMaterial=new on.a("",r.utilityLayerScene),k._coloredMaterial.diffuseColor=n,k._coloredMaterial.specularColor=n.subtract(new M.a(.1,.1,.1)),k._hoverMaterial=new on.a("",r.utilityLayerScene),k._hoverMaterial.diffuseColor=M.a.Yellow(),k._disableMaterial=new on.a("",r.utilityLayerScene),k._disableMaterial.diffuseColor=M.a.Gray(),k._disableMaterial.alpha=.4,k._gizmoMesh=new Ne.a("axis",r.utilityLayerScene);var K=k._createGizmoMesh(k._gizmoMesh,u),oe=K.arrowMesh,ae=K.arrowTail,ue=k._createGizmoMesh(k._gizmoMesh,u+4,!0);k._gizmoMesh.lookAt(k._rootMesh.position.add(e)),k._rootMesh.addChild(k._gizmoMesh),k._gizmoMesh.scaling.scaleInPlace(1/3);var de=oe.position.clone(),me=ae.position.clone(),ye=ae.scaling.clone(),Ee=function(Oe){var Ve=Oe*(3/k._rootMesh.scaling.length())*6;oe.position.z+=Ve/3.5,ae.scaling.y+=Ve,ae.position.z=oe.position.z/2},Ae=function(){oe.position.set(de.x,de.y,de.z),ae.position.set(me.x,me.y,me.z),ae.scaling.set(ye.x,ye.y,ye.z),k._dragging=!1};k.dragBehavior=new yi.a({dragAxis:e}),k.dragBehavior.moveAttached=!1,k._rootMesh.addBehavior(k.dragBehavior);var Ie=0,Re=new d.e,Pe={snapDistance:0};k.dragBehavior.onDragObservable.add(function(Oe){if(k.attachedNode){var Ve=k.sensitivity*Oe.dragDistance*(3*k.scaleRatio/k._rootMesh.scaling.length()),Le=!1,je=0;k.uniformScaling?(k.attachedNode.getWorldMatrix().decompose(Re),Re.normalize(),Re.y<0&&Re.scaleInPlace(-1)):Re.copyFrom(e),k.snapDistance==0?Re.scaleToRef(Ve,Re):(Ie+=Ve,Math.abs(Ie)>k.snapDistance?(je=Math.floor(Math.abs(Ie)/k.snapDistance),Ie<0&&(je*=-1),Ie%=k.snapDistance,Re.scaleToRef(k.snapDistance*je,Re),Le=!0):Re.scaleInPlace(0)),d.a.ScalingToRef(1+Re.x,1+Re.y,1+Re.z,k._tmpMatrix2),k._tmpMatrix2.multiplyToRef(k.attachedNode.getWorldMatrix(),k._tmpMatrix),k._tmpMatrix.decompose(k._tmpVector),Math.abs(k._tmpVector.x)<1e5&&Math.abs(k._tmpVector.y)<1e5&&Math.abs(k._tmpVector.z)<1e5&&k.attachedNode.getWorldMatrix().copyFrom(k._tmpMatrix),Le&&(Pe.snapDistance=k.snapDistance*je,k.onSnapObservable.notifyObservers(Pe)),k._matrixChanged()}}),k.dragBehavior.onDragStartObservable.add(function(){k._dragging=!0}),k.dragBehavior.onDragObservable.add(function(Oe){return Ee(Oe.dragDistance)}),k.dragBehavior.onDragEndObservable.add(Ae),(y=(v=(f=o==null?void 0:o.uniformScaleGizmo)===null||f===void 0?void 0:f.dragBehavior)===null||v===void 0?void 0:v.onDragObservable)===null||y===void 0||y.add(function(Oe){return Ee(Oe.delta.y)}),(F=(w=(D=o==null?void 0:o.uniformScaleGizmo)===null||D===void 0?void 0:D.dragBehavior)===null||w===void 0?void 0:w.onDragEndObservable)===null||F===void 0||F.add(Ae);var Ce={gizmoMeshes:[oe,ae],colliderMeshes:[ue.arrowMesh,ue.arrowTail],material:k._coloredMaterial,hoverMaterial:k._hoverMaterial,disableMaterial:k._disableMaterial,active:!1};(z=k._parent)===null||z===void 0||z.addToAxisCache(k._gizmoMesh,Ce),k._pointerObserver=r.utilityLayerScene.onPointerObservable.add(function(Oe){var Ve;if(!k._customMeshSet&&(k._isHovered=Ce.colliderMeshes.indexOf((Ve=Oe==null?void 0:Oe.pickInfo)===null||Ve===void 0?void 0:Ve.pickedMesh)!=-1,!k._parent)){var Le=k._isHovered||k._dragging?k._hoverMaterial:k._coloredMaterial;Ce.gizmoMeshes.forEach(function(je){je.material=Le,je.color&&(je.color=Le.diffuseColor)})}});var Be=r._getSharedGizmoLight();return Be.includedOnlyMeshes=Be.includedOnlyMeshes.concat(k._rootMesh.getChildMeshes()),k}return Object(p.d)(t,i),t.prototype._createGizmoMesh=function(e,n,r){r===void 0&&(r=!1);var o=bs.a.CreateBox("yPosMesh",{size:.4*(1+(n-1)/4)},this.gizmoLayer.utilityLayerScene),u=zi.a.CreateCylinder("cylinder",{diameterTop:.005*n,height:.275,diameterBottom:.005*n,tessellation:96},this.gizmoLayer.utilityLayerScene);return o.scaling.scaleInPlace(.1),o.material=this._coloredMaterial,o.rotation.x=Math.PI/2,o.position.z+=.3,u.material=this._coloredMaterial,u.position.z+=.1375,u.rotation.x=Math.PI/2,r&&(o.visibility=0,u.visibility=0),e.addChild(o),e.addChild(u),{arrowMesh:o,arrowTail:u}},t.prototype._attachedNodeChanged=function(e){this.dragBehavior&&(this.dragBehavior.enabled=!!e)},Object.defineProperty(t.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(e){this._isEnabled=e,e?this._parent&&(this.attachedMesh=this._parent.attachedMesh,this.attachedNode=this._parent.attachedNode):(this.attachedMesh=null,this.attachedNode=null)},enumerable:!1,configurable:!0}),t.prototype.dispose=function(){this.onSnapObservable.clear(),this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this.dragBehavior.detach(),this._gizmoMesh&&this._gizmoMesh.dispose(),[this._coloredMaterial,this._hoverMaterial,this._disableMaterial].forEach(function(e){e&&e.dispose()}),i.prototype.dispose.call(this)},t.prototype.setCustomMesh=function(e,n){var r=this;n===void 0&&(n=!1),i.prototype.setCustomMesh.call(this,e),n&&(this._rootMesh.getChildMeshes().forEach(function(o){o.material=r._coloredMaterial,o.color&&(o.color=r._coloredMaterial.diffuseColor)}),this._customMeshSet=!1)},t}(jr.a),zr=c(45),Jn=c(40),qy=function(i){function t(e,n){e===void 0&&(e=M.a.Gray()),n===void 0&&(n=Ir.a.DefaultKeepDepthUtilityLayer);var r=i.call(this,n)||this;r._boundingDimensions=new d.e(1,1,1),r._renderObserver=null,r._pointerObserver=null,r._scaleDragSpeed=.2,r._tmpQuaternion=new d.b,r._tmpVector=new d.e(0,0,0),r._tmpRotationMatrix=new d.a,r.ignoreChildren=!1,r.includeChildPredicate=null,r.rotationSphereSize=.1,r.scaleBoxSize=.1,r.fixedDragMeshScreenSize=!1,r.fixedDragMeshBoundsSize=!1,r.fixedDragMeshScreenSizeDistanceFactor=10,r.onDragStartObservable=new S.c,r.onScaleBoxDragObservable=new S.c,r.onScaleBoxDragEndObservable=new S.c,r.onRotationSphereDragObservable=new S.c,r.onRotationSphereDragEndObservable=new S.c,r.scalePivot=null,r._existingMeshScale=new d.e,r._dragMesh=null,r.pointerDragBehavior=new yi.a,r.updateScale=!1,r._anchorMesh=new jt.a("anchor",n.utilityLayerScene),r.coloredMaterial=new on.a("",n.utilityLayerScene),r.coloredMaterial.disableLighting=!0,r.hoverColoredMaterial=new on.a("",n.utilityLayerScene),r.hoverColoredMaterial.disableLighting=!0,r._lineBoundingBox=new jt.a("",n.utilityLayerScene),r._lineBoundingBox.rotationQuaternion=new d.b;var o=[];o.push(Jn.a.CreateLines("lines",{points:[new d.e(0,0,0),new d.e(r._boundingDimensions.x,0,0)]},n.utilityLayerScene)),o.push(Jn.a.CreateLines("lines",{points:[new d.e(0,0,0),new d.e(0,r._boundingDimensions.y,0)]},n.utilityLayerScene)),o.push(Jn.a.CreateLines("lines",{points:[new d.e(0,0,0),new d.e(0,0,r._boundingDimensions.z)]},n.utilityLayerScene)),o.push(Jn.a.CreateLines("lines",{points:[new d.e(r._boundingDimensions.x,0,0),new d.e(r._boundingDimensions.x,r._boundingDimensions.y,0)]},n.utilityLayerScene)),o.push(Jn.a.CreateLines("lines",{points:[new d.e(r._boundingDimensions.x,0,0),new d.e(r._boundingDimensions.x,0,r._boundingDimensions.z)]},n.utilityLayerScene)),o.push(Jn.a.CreateLines("lines",{points:[new d.e(0,r._boundingDimensions.y,0),new d.e(r._boundingDimensions.x,r._boundingDimensions.y,0)]},n.utilityLayerScene)),o.push(Jn.a.CreateLines("lines",{points:[new d.e(0,r._boundingDimensions.y,0),new d.e(0,r._boundingDimensions.y,r._boundingDimensions.z)]},n.utilityLayerScene)),o.push(Jn.a.CreateLines("lines",{points:[new d.e(0,0,r._boundingDimensions.z),new d.e(r._boundingDimensions.x,0,r._boundingDimensions.z)]},n.utilityLayerScene)),o.push(Jn.a.CreateLines("lines",{points:[new d.e(0,0,r._boundingDimensions.z),new d.e(0,r._boundingDimensions.y,r._boundingDimensions.z)]},n.utilityLayerScene)),o.push(Jn.a.CreateLines("lines",{points:[new d.e(r._boundingDimensions.x,r._boundingDimensions.y,r._boundingDimensions.z),new d.e(0,r._boundingDimensions.y,r._boundingDimensions.z)]},n.utilityLayerScene)),o.push(Jn.a.CreateLines("lines",{points:[new d.e(r._boundingDimensions.x,r._boundingDimensions.y,r._boundingDimensions.z),new d.e(r._boundingDimensions.x,0,r._boundingDimensions.z)]},n.utilityLayerScene)),o.push(Jn.a.CreateLines("lines",{points:[new d.e(r._boundingDimensions.x,r._boundingDimensions.y,r._boundingDimensions.z),new d.e(r._boundingDimensions.x,r._boundingDimensions.y,0)]},n.utilityLayerScene)),o.forEach(function(oe){oe.color=e,oe.position.addInPlace(new d.e(-r._boundingDimensions.x/2,-r._boundingDimensions.y/2,-r._boundingDimensions.z/2)),oe.isPickable=!1,r._lineBoundingBox.addChild(oe)}),r._rootMesh.addChild(r._lineBoundingBox),r.setColor(e),r._rotateSpheresParent=new jt.a("",n.utilityLayerScene),r._rotateSpheresParent.rotationQuaternion=new d.b;for(var u=function(oe){var ae=zr.a.CreateSphere("",{diameter:1},n.utilityLayerScene);ae.rotationQuaternion=new d.b,ae.material=f.coloredMaterial,(w=new yi.a({})).moveAttached=!1,w.updateDragPlane=!1,ae.addBehavior(w);var ue=new d.e(1,0,0),de=0;w.onDragStartObservable.add(function(){ue.copyFrom(ae.forward),de=0}),w.onDragObservable.add(function(me){if(r.onRotationSphereDragObservable.notifyObservers({}),r.attachedMesh){var ye=r.attachedMesh.parent;if(ye&&ye.scaling&&ye.scaling.isNonUniformWithinEpsilon(.001))return void _.a.Warn("BoundingBoxGizmo controls are not supported on child meshes with non-uniform parent scaling");Mr.a._RemoveAndStorePivotPoint(r.attachedMesh);var Ee=ue,Ae=me.dragPlaneNormal.scale(d.e.Dot(me.dragPlaneNormal,Ee)),Ie=Ee.subtract(Ae).normalizeToNew(),Re=d.e.Dot(Ie,me.delta)<0?Math.abs(me.delta.length()):-Math.abs(me.delta.length());Re=Re/r._boundingDimensions.length()*r._anchorMesh.scaling.length(),r.attachedMesh.rotationQuaternion||(r.attachedMesh.rotationQuaternion=d.b.RotationYawPitchRoll(r.attachedMesh.rotation.y,r.attachedMesh.rotation.x,r.attachedMesh.rotation.z)),r._anchorMesh.rotationQuaternion||(r._anchorMesh.rotationQuaternion=d.b.RotationYawPitchRoll(r._anchorMesh.rotation.y,r._anchorMesh.rotation.x,r._anchorMesh.rotation.z)),de+=Re,Math.abs(de)<=2*Math.PI&&(oe>=8?d.b.RotationYawPitchRollToRef(0,0,Re,r._tmpQuaternion):oe>=4?d.b.RotationYawPitchRollToRef(Re,0,0,r._tmpQuaternion):d.b.RotationYawPitchRollToRef(0,Re,0,r._tmpQuaternion),r._anchorMesh.addChild(r.attachedMesh),r._anchorMesh.rotationQuaternion.multiplyToRef(r._tmpQuaternion,r._anchorMesh.rotationQuaternion),r._anchorMesh.removeChild(r.attachedMesh),r.attachedMesh.setParent(ye)),r.updateBoundingBox(),Mr.a._RestorePivotPoint(r.attachedMesh)}r._updateDummy()}),w.onDragStartObservable.add(function(){r.onDragStartObservable.notifyObservers({}),r._selectNode(ae)}),w.onDragEndObservable.add(function(){r.onRotationSphereDragEndObservable.notifyObservers({}),r._selectNode(null),r._updateDummy()}),f._rotateSpheresParent.addChild(ae)},f=this,v=0;v<12;v++)u(v);r._rootMesh.addChild(r._rotateSpheresParent),r._scaleBoxesParent=new jt.a("",n.utilityLayerScene),r._scaleBoxesParent.rotationQuaternion=new d.b;for(var y=0;y<3;y++)for(var D=0;D<3;D++)for(var w,F=function(){var oe=(y===1?1:0)+(D===1?1:0)+(k===1?1:0);if(oe===1||oe===3)return"continue";var ae=bs.a.CreateBox("",{size:1},n.utilityLayerScene);ae.material=z.coloredMaterial,ae.metadata=oe===2;var ue=new d.e(y-1,D-1,k-1).normalize();(w=new yi.a({dragAxis:ue})).updateDragPlane=!1,w.moveAttached=!1,ae.addBehavior(w),w.onDragObservable.add(function(de){if(r.onScaleBoxDragObservable.notifyObservers({}),r.attachedMesh){var me=r.attachedMesh.parent;if(me&&me.scaling&&me.scaling.isNonUniformWithinEpsilon(.001))return void _.a.Warn("BoundingBoxGizmo controls are not supported on child meshes with non-uniform parent scaling");Mr.a._RemoveAndStorePivotPoint(r.attachedMesh);var ye=de.dragDistance/r._boundingDimensions.length()*r._anchorMesh.scaling.length(),Ee=new d.e(ye,ye,ye);oe===2&&(Ee.x*=Math.abs(ue.x),Ee.y*=Math.abs(ue.y),Ee.z*=Math.abs(ue.z)),Ee.scaleInPlace(r._scaleDragSpeed),r.updateBoundingBox(),r.scalePivot?(r.attachedMesh.getWorldMatrix().getRotationMatrixToRef(r._tmpRotationMatrix),r._boundingDimensions.scaleToRef(.5,r._tmpVector),d.e.TransformCoordinatesToRef(r._tmpVector,r._tmpRotationMatrix,r._tmpVector),r._anchorMesh.position.subtractInPlace(r._tmpVector),r._boundingDimensions.multiplyToRef(r.scalePivot,r._tmpVector),d.e.TransformCoordinatesToRef(r._tmpVector,r._tmpRotationMatrix,r._tmpVector),r._anchorMesh.position.addInPlace(r._tmpVector)):(ae.absolutePosition.subtractToRef(r._anchorMesh.position,r._tmpVector),r._anchorMesh.position.subtractInPlace(r._tmpVector)),r._anchorMesh.addChild(r.attachedMesh),r._anchorMesh.scaling.addInPlace(Ee),(r._anchorMesh.scaling.x<0||r._anchorMesh.scaling.y<0||r._anchorMesh.scaling.z<0)&&r._anchorMesh.scaling.subtractInPlace(Ee),r._anchorMesh.removeChild(r.attachedMesh),r.attachedMesh.setParent(me),Mr.a._RestorePivotPoint(r.attachedMesh)}r._updateDummy()}),w.onDragStartObservable.add(function(){r.onDragStartObservable.notifyObservers({}),r._selectNode(ae)}),w.onDragEndObservable.add(function(){r.onScaleBoxDragEndObservable.notifyObservers({}),r._selectNode(null),r._updateDummy()}),z._scaleBoxesParent.addChild(ae)},z=this,k=0;k<3;k++)F();r._rootMesh.addChild(r._scaleBoxesParent);var K=new Array;return r._pointerObserver=n.utilityLayerScene.onPointerObservable.add(function(oe){K[oe.event.pointerId]?oe.pickInfo&&oe.pickInfo.pickedMesh!=K[oe.event.pointerId]&&(K[oe.event.pointerId].material=r.coloredMaterial,delete K[oe.event.pointerId]):r._rotateSpheresParent.getChildMeshes().concat(r._scaleBoxesParent.getChildMeshes()).forEach(function(ae){oe.pickInfo&&oe.pickInfo.pickedMesh==ae&&(K[oe.event.pointerId]=ae,ae.material=r.hoverColoredMaterial)})}),r._renderObserver=r.gizmoLayer.originalScene.onBeforeRenderObservable.add(function(){r.attachedMesh&&!r._existingMeshScale.equals(r.attachedMesh.scaling)?r.updateBoundingBox():(r.fixedDragMeshScreenSize||r.fixedDragMeshBoundsSize)&&(r._updateRotationSpheres(),r._updateScaleBoxes()),r._dragMesh&&r.attachedMesh&&r.pointerDragBehavior.dragging&&(r._lineBoundingBox.position.rotateByQuaternionToRef(r._rootMesh.rotationQuaternion,r._tmpVector),r.attachedMesh.setAbsolutePosition(r._dragMesh.position.add(r._tmpVector.scale(-1))))}),r.updateBoundingBox(),r}return Object(p.d)(t,i),t.prototype.setColor=function(e){this.coloredMaterial.emissiveColor=e,this.hoverColoredMaterial.emissiveColor=e.clone().add(new M.a(.3,.3,.3)),this._lineBoundingBox.getChildren().forEach(function(n){n.color&&(n.color=e)})},t.prototype._attachedNodeChanged=function(e){var n=this;if(e){Mr.a._RemoveAndStorePivotPoint(e);var r=e.parent;this._anchorMesh.addChild(e),this._anchorMesh.removeChild(e),e.setParent(r),Mr.a._RestorePivotPoint(e),this.updateBoundingBox(),e.getChildMeshes(!1).forEach(function(o){o.markAsDirty("scaling")}),this.gizmoLayer.utilityLayerScene.onAfterRenderObservable.addOnce(function(){n._updateDummy()})}},t.prototype._selectNode=function(e){this._rotateSpheresParent.getChildMeshes().concat(this._scaleBoxesParent.getChildMeshes()).forEach(function(n){n.isVisible=!e||n==e})},t.prototype.updateBoundingBox=function(){if(this.attachedMesh){Mr.a._RemoveAndStorePivotPoint(this.attachedMesh);var e=this.attachedMesh.parent;this.attachedMesh.setParent(null);var n=null;this.attachedMesh.skeleton&&(n=this.attachedMesh.skeleton.overrideMesh,this.attachedMesh.skeleton.overrideMesh=null),this._update(),this.attachedMesh.rotationQuaternion||(this.attachedMesh.rotationQuaternion=d.b.RotationYawPitchRoll(this.attachedMesh.rotation.y,this.attachedMesh.rotation.x,this.attachedMesh.rotation.z)),this._anchorMesh.rotationQuaternion||(this._anchorMesh.rotationQuaternion=d.b.RotationYawPitchRoll(this._anchorMesh.rotation.y,this._anchorMesh.rotation.x,this._anchorMesh.rotation.z)),this._anchorMesh.rotationQuaternion.copyFrom(this.attachedMesh.rotationQuaternion),this._tmpQuaternion.copyFrom(this.attachedMesh.rotationQuaternion),this._tmpVector.copyFrom(this.attachedMesh.position),this.attachedMesh.rotationQuaternion.set(0,0,0,1),this.attachedMesh.position.set(0,0,0);var r=this.attachedMesh.getHierarchyBoundingVectors(!this.ignoreChildren,this.includeChildPredicate);r.max.subtractToRef(r.min,this._boundingDimensions),this._lineBoundingBox.scaling.copyFrom(this._boundingDimensions),this._lineBoundingBox.position.set((r.max.x+r.min.x)/2,(r.max.y+r.min.y)/2,(r.max.z+r.min.z)/2),this._rotateSpheresParent.position.copyFrom(this._lineBoundingBox.position),this._scaleBoxesParent.position.copyFrom(this._lineBoundingBox.position),this._lineBoundingBox.computeWorldMatrix(),this._anchorMesh.position.copyFrom(this._lineBoundingBox.absolutePosition),this.attachedMesh.rotationQuaternion.copyFrom(this._tmpQuaternion),this.attachedMesh.position.copyFrom(this._tmpVector),this.attachedMesh.setParent(e),this.attachedMesh.skeleton&&(this.attachedMesh.skeleton.overrideMesh=n)}this._updateRotationSpheres(),this._updateScaleBoxes(),this.attachedMesh&&(this._existingMeshScale.copyFrom(this.attachedMesh.scaling),Mr.a._RestorePivotPoint(this.attachedMesh))},t.prototype._updateRotationSpheres=function(){for(var e=this._rotateSpheresParent.getChildMeshes(),n=0;n<3;n++)for(var r=0;r<2;r++)for(var o=0;o<2;o++){var u=4*n+2*r+o;if(n==0&&(e[u].position.set(this._boundingDimensions.x/2,this._boundingDimensions.y*r,this._boundingDimensions.z*o),e[u].position.addInPlace(new d.e(-this._boundingDimensions.x/2,-this._boundingDimensions.y/2,-this._boundingDimensions.z/2)),e[u].lookAt(d.e.Cross(e[u].position.normalizeToNew(),d.e.Right()).normalizeToNew().add(e[u].position))),n==1&&(e[u].position.set(this._boundingDimensions.x*r,this._boundingDimensions.y/2,this._boundingDimensions.z*o),e[u].position.addInPlace(new d.e(-this._boundingDimensions.x/2,-this._boundingDimensions.y/2,-this._boundingDimensions.z/2)),e[u].lookAt(d.e.Cross(e[u].position.normalizeToNew(),d.e.Up()).normalizeToNew().add(e[u].position))),n==2&&(e[u].position.set(this._boundingDimensions.x*r,this._boundingDimensions.y*o,this._boundingDimensions.z/2),e[u].position.addInPlace(new d.e(-this._boundingDimensions.x/2,-this._boundingDimensions.y/2,-this._boundingDimensions.z/2)),e[u].lookAt(d.e.Cross(e[u].position.normalizeToNew(),d.e.Forward()).normalizeToNew().add(e[u].position))),this.fixedDragMeshScreenSize&&this.gizmoLayer.utilityLayerScene.activeCamera){e[u].absolutePosition.subtractToRef(this.gizmoLayer.utilityLayerScene.activeCamera.position,this._tmpVector);var f=this.rotationSphereSize*this._tmpVector.length()/this.fixedDragMeshScreenSizeDistanceFactor;e[u].scaling.set(f,f,f)}else this.fixedDragMeshBoundsSize?e[u].scaling.set(this.rotationSphereSize*this._boundingDimensions.x,this.rotationSphereSize*this._boundingDimensions.y,this.rotationSphereSize*this._boundingDimensions.z):e[u].scaling.set(this.rotationSphereSize,this.rotationSphereSize,this.rotationSphereSize)}},t.prototype._updateScaleBoxes=function(){for(var e=this._scaleBoxesParent.getChildMeshes(),n=0,r=0;r<3;r++)for(var o=0;o<3;o++)for(var u=0;u<3;u++){var f=(r===1?1:0)+(o===1?1:0)+(u===1?1:0);if(f!==1&&f!==3){if(e[n])if(e[n].position.set(this._boundingDimensions.x*(r/2),this._boundingDimensions.y*(o/2),this._boundingDimensions.z*(u/2)),e[n].position.addInPlace(new d.e(-this._boundingDimensions.x/2,-this._boundingDimensions.y/2,-this._boundingDimensions.z/2)),this.fixedDragMeshScreenSize&&this.gizmoLayer.utilityLayerScene.activeCamera){e[n].absolutePosition.subtractToRef(this.gizmoLayer.utilityLayerScene.activeCamera.position,this._tmpVector);var v=this.scaleBoxSize*this._tmpVector.length()/this.fixedDragMeshScreenSizeDistanceFactor;e[n].scaling.set(v,v,v)}else this.fixedDragMeshBoundsSize?e[n].scaling.set(this.scaleBoxSize*this._boundingDimensions.x,this.scaleBoxSize*this._boundingDimensions.y,this.scaleBoxSize*this._boundingDimensions.z):e[n].scaling.set(this.scaleBoxSize,this.scaleBoxSize,this.scaleBoxSize);n++}}},t.prototype.setEnabledRotationAxis=function(e){this._rotateSpheresParent.getChildMeshes().forEach(function(n,r){r<4?n.setEnabled(e.indexOf("x")!=-1):r<8?n.setEnabled(e.indexOf("y")!=-1):n.setEnabled(e.indexOf("z")!=-1)})},t.prototype.setEnabledScaling=function(e,n){n===void 0&&(n=!1),this._scaleBoxesParent.getChildMeshes().forEach(function(r,o){var u=e;n&&r.metadata===!0&&(u=!1),r.setEnabled(u)})},t.prototype._updateDummy=function(){this._dragMesh&&(this._dragMesh.position.copyFrom(this._lineBoundingBox.getAbsolutePosition()),this._dragMesh.scaling.copyFrom(this._lineBoundingBox.scaling),this._dragMesh.rotationQuaternion.copyFrom(this._rootMesh.rotationQuaternion))},t.prototype.enableDragBehavior=function(){this._dragMesh=Ne.a.CreateBox("dummy",1,this.gizmoLayer.utilityLayerScene),this._dragMesh.visibility=0,this._dragMesh.rotationQuaternion=new d.b,this.pointerDragBehavior.useObjectOrientationForDragging=!1,this._dragMesh.addBehavior(this.pointerDragBehavior)},t.prototype.dispose=function(){this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this.gizmoLayer.originalScene.onBeforeRenderObservable.remove(this._renderObserver),this._lineBoundingBox.dispose(),this._rotateSpheresParent.dispose(),this._scaleBoxesParent.dispose(),this._dragMesh&&this._dragMesh.dispose(),i.prototype.dispose.call(this)},t.MakeNotPickableAndWrapInBoundingBox=function(e){var n=function(v){v.isPickable=!1,v.getChildMeshes().forEach(function(y){n(y)})};n(e),e.rotationQuaternion||(e.rotationQuaternion=d.b.RotationYawPitchRoll(e.rotation.y,e.rotation.x,e.rotation.z));var r=e.position.clone(),o=e.rotationQuaternion.clone();e.rotationQuaternion.set(0,0,0,1),e.position.set(0,0,0);var u=bs.a.CreateBox("box",{size:1},e.getScene()),f=e.getHierarchyBoundingVectors();return f.max.subtractToRef(f.min,u.scaling),u.scaling.y===0&&(u.scaling.y=Zt.a),u.scaling.x===0&&(u.scaling.x=Zt.a),u.scaling.z===0&&(u.scaling.z=Zt.a),u.position.set((f.max.x+f.min.x)/2,(f.max.y+f.min.y)/2,(f.max.z+f.min.z)/2),e.addChild(u),e.rotationQuaternion.copyFrom(o),e.position.copyFrom(r),e.removeChild(u),u.addChild(e),u.visibility=0,u},t.prototype.setCustomMesh=function(e){_.a.Error("Custom meshes are not supported on this gizmo")},t}(jr.a),lh=function(i){function t(e,n,r,o,u,f,v){var y;n===void 0&&(n=M.a.Gray()),r===void 0&&(r=Ir.a.DefaultUtilityLayer),o===void 0&&(o=32),u===void 0&&(u=null),v===void 0&&(v=1);var D=i.call(this,r)||this;D._pointerObserver=null,D.snapDistance=0,D.onSnapObservable=new S.c,D._isEnabled=!0,D._parent=null,D._dragging=!1,D._parent=u,D._coloredMaterial=new on.a("",r.utilityLayerScene),D._coloredMaterial.diffuseColor=n,D._coloredMaterial.specularColor=n.subtract(new M.a(.1,.1,.1)),D._hoverMaterial=new on.a("",r.utilityLayerScene),D._hoverMaterial.diffuseColor=M.a.Yellow(),D._disableMaterial=new on.a("",r.utilityLayerScene),D._disableMaterial.diffuseColor=M.a.Gray(),D._disableMaterial.alpha=.4,D._gizmoMesh=new Ne.a("",r.utilityLayerScene);var w=D._createGizmoMesh(D._gizmoMesh,v,o),F=w.rotationMesh,z=w.collider,k=[];D._rotationCircle=D.setupRotationCircle(k,D._gizmoMesh),D._gizmoMesh.lookAt(D._rootMesh.position.add(e)),D._rootMesh.addChild(D._gizmoMesh),D._gizmoMesh.scaling.scaleInPlace(1/3),D.dragBehavior=new yi.a({dragPlaneNormal:e}),D.dragBehavior.moveAttached=!1,D.dragBehavior.maxDragAngle=9*Math.PI/20,D.dragBehavior._useAlternatePickedPointAboveMaxDragAngle=!0,D._rootMesh.addBehavior(D.dragBehavior);var K=0,oe=new d.e,ae=new d.e,ue=new d.a,de=new d.e,me=new d.e;D.dragBehavior.onDragStartObservable.add(function(Ce){if(D.attachedNode){oe.copyFrom(Ce.dragPlanePoint);var Be=new d.e(0,0,1),Oe=D._rotationCircle.getDirection(Be);Oe.normalize(),D._gizmoMesh.removeChild(D._rotationCircle),oe.copyFrom(Ce.dragPlanePoint),ae=Ce.dragPlanePoint;var Ve=D._rotationCircle.getAbsolutePosition().clone(),Le=D._rotationCircle.getAbsolutePosition().clone().addInPlace(Oe),je=Ce.dragPlanePoint,tt=d.e.GetAngleBetweenVectors(Le.subtract(Ve),je.subtract(Ve),D._rotationCircle.up);D._rotationCircle.addRotation(0,tt,0),D._dragging=!0}}),D.dragBehavior.onDragEndObservable.add(function(){K=0,D.updateRotationCircle(D._rotationCircle,k,K,ae),D._gizmoMesh.addChild(D._rotationCircle),D._dragging=!1});var ye={snapDistance:0},Ee=0,Ae=new d.a,Ie=new d.b;D.dragBehavior.onDragObservable.add(function(Ce){if(D.attachedNode){var Be=new d.e(1,1,1),Oe=new d.b(0,0,0,1),Ve=new d.e(0,0,0);D.attachedNode.getWorldMatrix().decompose(Be,Oe,Ve);var Le=Ce.dragPlanePoint.subtract(Ve).normalize(),je=oe.subtract(Ve).normalize(),tt=d.e.Cross(Le,je),ut=d.e.Dot(Le,je),ft=Math.atan2(tt.length(),ut);de.copyFrom(e),me.copyFrom(e),D.updateGizmoRotationToMatchAttachedMesh&&(Oe.toRotationMatrix(ue),me=d.e.TransformCoordinates(de,ue));var vt=!1;if(r.utilityLayerScene.activeCamera){var rt=r.utilityLayerScene.activeCamera.position.subtract(Ve);d.e.Dot(rt,me)>0&&(de.scaleInPlace(-1),me.scaleInPlace(-1),vt=!0)}d.e.Dot(me,tt)>0&&(ft=-ft);var mt=!1;if(D.snapDistance!=0)if(Ee+=ft,Math.abs(Ee)>D.snapDistance){var pt=Math.floor(Math.abs(Ee)/D.snapDistance);Ee<0&&(pt*=-1),Ee%=D.snapDistance,ft=D.snapDistance*pt,mt=!0}else ft=0;K+=vt?-ft:ft,D.updateRotationCircle(D._rotationCircle,k,K,ae);var it=Math.sin(ft/2);if(Ie.set(de.x*it,de.y*it,de.z*it,Math.cos(ft/2)),Ae.determinant()>0){var yt=new d.e;Ie.toEulerAnglesToRef(yt),d.b.RotationYawPitchRollToRef(yt.y,-yt.x,-yt.z,Ie)}D.updateGizmoRotationToMatchAttachedMesh?Oe.multiplyToRef(Ie,Oe):Ie.multiplyToRef(Oe,Oe),D.attachedNode.getWorldMatrix().copyFrom(d.a.Compose(Be,Oe,Ve)),oe.copyFrom(Ce.dragPlanePoint),mt&&(ye.snapDistance=ft,D.onSnapObservable.notifyObservers(ye)),D._matrixChanged()}});var Re=r._getSharedGizmoLight();Re.includedOnlyMeshes=Re.includedOnlyMeshes.concat(D._rootMesh.getChildMeshes(!1));var Pe={colliderMeshes:[z],gizmoMeshes:[F],material:D._coloredMaterial,hoverMaterial:D._hoverMaterial,disableMaterial:D._disableMaterial,active:!1};return(y=D._parent)===null||y===void 0||y.addToAxisCache(D._gizmoMesh,Pe),D._pointerObserver=r.utilityLayerScene.onPointerObservable.add(function(Ce){var Be;if(!D._customMeshSet&&(D._isHovered=Pe.colliderMeshes.indexOf((Be=Ce==null?void 0:Ce.pickInfo)===null||Be===void 0?void 0:Be.pickedMesh)!=-1,!D._parent)){var Oe=D._isHovered||D._dragging?D._hoverMaterial:D._coloredMaterial;Pe.gizmoMeshes.forEach(function(Ve){Ve.material=Oe,Ve.color&&(Ve.color=Oe.diffuseColor)})}}),D}return Object(p.d)(t,i),t.prototype._createGizmoMesh=function(e,n,r){var o=Ne.a.CreateTorus("ignore",.6,.03*n,r,this.gizmoLayer.utilityLayerScene);o.visibility=0;var u=Ne.a.CreateTorus("",.6,.005*n,r,this.gizmoLayer.utilityLayerScene);return u.material=this._coloredMaterial,u.rotation.x=Math.PI/2,o.rotation.x=Math.PI/2,e.addChild(u),e.addChild(o),{rotationMesh:u,collider:o}},t.prototype._attachedNodeChanged=function(e){this.dragBehavior&&(this.dragBehavior.enabled=!!e)},t.prototype.setupRotationCircle=function(e,n){for(var r=t._CircleConstants.pi2/t._CircleConstants.tessellation,o=-Math.PI/2;o<Math.PI/2-1.5;o+=r/2){for(var u=[],f=0;f<t._CircleConstants.pi2*t._CircleConstants.rotationCircleRange+.01;f+=r)if(f<0){var v=t._CircleConstants.radius*Math.sin(f)*Math.cos(o),y=t._CircleConstants.radius*Math.cos(f)*Math.cos(o);u.push(new d.e(v,0,y))}else u.push(new d.e(0,0,0));e.push(u)}var D=new on.a("",this.gizmoLayer.utilityLayerScene);D.diffuseColor=M.a.Yellow(),D.backFaceCulling=!1;var w=Ne.a.CreateRibbon("rotationCircle",e,!1,!1,0,this.gizmoLayer.utilityLayerScene,!0);return w.material=D,w.material.alpha=.25,w.rotation.x=Math.PI/2,n.addChild(w),w},t.prototype.updateRotationPath=function(e,n){for(var r=t._CircleConstants.pi2/t._CircleConstants.tessellation,o=0,u=-Math.PI/2;u<Math.PI/2-1.5;u+=r/2){var f=e[o];if(f)for(var v=0,y=0;y<t._CircleConstants.pi2*t._CircleConstants.rotationCircleRange+.01;y+=r){if(f[v])if(y<Math.abs(n)){var D=n>0?y:-1*y,w=n>0?u:-1*u;f[v].set(t._CircleConstants.radius*Math.sin(D)*Math.cos(w),0,t._CircleConstants.radius*Math.cos(D)*Math.cos(w))}else f[v].set(0,0,0);v++}o++}},t.prototype.updateRotationCircle=function(e,n,r,o){this.updateRotationPath(n,r),Ne.a.CreateRibbon("rotationCircle",n,!1,!1,0,this.gizmoLayer.utilityLayerScene,void 0,void 0,e.geometry?e:void 0)},Object.defineProperty(t.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(e){this._isEnabled=e,e?this._parent&&(this.attachedMesh=this._parent.attachedMesh):this.attachedMesh=null},enumerable:!1,configurable:!0}),t.prototype.dispose=function(){this.onSnapObservable.clear(),this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this.dragBehavior.detach(),this._gizmoMesh&&this._gizmoMesh.dispose(),this._rotationCircle&&this._rotationCircle.dispose(),[this._coloredMaterial,this._hoverMaterial,this._disableMaterial].forEach(function(e){e&&e.dispose()}),i.prototype.dispose.call(this)},t._CircleConstants={radius:.3,pi2:2*Math.PI,tessellation:70,rotationCircleRange:4},t}(jr.a),Zy=function(i){function t(e,n,r,o,u){e===void 0&&(e=Ir.a.DefaultUtilityLayer),n===void 0&&(n=32),r===void 0&&(r=!1),o===void 0&&(o=1);var f=i.call(this,e)||this;return f.onDragStartObservable=new S.c,f.onDragEndObservable=new S.c,f._observables=[],f._gizmoAxisCache=new Map,f.xGizmo=new lh(new d.e(1,0,0),M.a.Red().scale(.5),e,n,f,r,o),f.yGizmo=new lh(new d.e(0,1,0),M.a.Green().scale(.5),e,n,f,r,o),f.zGizmo=new lh(new d.e(0,0,1),M.a.Blue().scale(.5),e,n,f,r,o),[f.xGizmo,f.yGizmo,f.zGizmo].forEach(function(v){v.dragBehavior.onDragStartObservable.add(function(){f.onDragStartObservable.notifyObservers({})}),v.dragBehavior.onDragEndObservable.add(function(){f.onDragEndObservable.notifyObservers({})})}),f.attachedMesh=null,f.attachedNode=null,u?u.addToAxisCache(f._gizmoAxisCache):jr.a.GizmoAxisPointerObserver(e,f._gizmoAxisCache),f}return Object(p.d)(t,i),Object.defineProperty(t.prototype,"attachedMesh",{get:function(){return this._meshAttached},set:function(e){this._meshAttached=e,this._nodeAttached=e,this._checkBillboardTransform(),[this.xGizmo,this.yGizmo,this.zGizmo].forEach(function(n){n.isEnabled?n.attachedMesh=e:n.attachedMesh=null})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"attachedNode",{get:function(){return this._nodeAttached},set:function(e){this._meshAttached=null,this._nodeAttached=e,this._checkBillboardTransform(),[this.xGizmo,this.yGizmo,this.zGizmo].forEach(function(n){n.isEnabled?n.attachedNode=e:n.attachedNode=null})},enumerable:!1,configurable:!0}),t.prototype._checkBillboardTransform=function(){this._nodeAttached&&this._nodeAttached.billboardMode&&console.log("Rotation Gizmo will not work with transforms in billboard mode.")},Object.defineProperty(t.prototype,"isHovered",{get:function(){var e=!1;return[this.xGizmo,this.yGizmo,this.zGizmo].forEach(function(n){e=e||n.isHovered}),e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"updateGizmoRotationToMatchAttachedMesh",{get:function(){return this.xGizmo.updateGizmoRotationToMatchAttachedMesh},set:function(e){this.xGizmo&&(this.xGizmo.updateGizmoRotationToMatchAttachedMesh=e,this.yGizmo.updateGizmoRotationToMatchAttachedMesh=e,this.zGizmo.updateGizmoRotationToMatchAttachedMesh=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"snapDistance",{get:function(){return this.xGizmo.snapDistance},set:function(e){this.xGizmo&&(this.xGizmo.snapDistance=e,this.yGizmo.snapDistance=e,this.zGizmo.snapDistance=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scaleRatio",{get:function(){return this.xGizmo.scaleRatio},set:function(e){this.xGizmo&&(this.xGizmo.scaleRatio=e,this.yGizmo.scaleRatio=e,this.zGizmo.scaleRatio=e)},enumerable:!1,configurable:!0}),t.prototype.addToAxisCache=function(e,n){this._gizmoAxisCache.set(e,n)},t.prototype.dispose=function(){var e=this;this.xGizmo.dispose(),this.yGizmo.dispose(),this.zGizmo.dispose(),this.onDragStartObservable.clear(),this.onDragEndObservable.clear(),this._observables.forEach(function(n){e.gizmoLayer.utilityLayerScene.onPointerObservable.remove(n)})},t.prototype.setCustomMesh=function(e){_.a.Error("Custom meshes are not supported on this gizmo, please set the custom meshes on the gizmos contained within this one (gizmo.xGizmo, gizmo.yGizmo, gizmo.zGizmo)")},t}(jr.a),ys=c(46),Yp=c(84),uh=function(i){function t(e,n,r,o){var u;n===void 0&&(n=M.a.Gray()),r===void 0&&(r=Ir.a.DefaultUtilityLayer),o===void 0&&(o=null);var f=i.call(this,r)||this;f._pointerObserver=null,f.snapDistance=0,f.onSnapObservable=new S.c,f._isEnabled=!1,f._parent=null,f._dragging=!1,f._parent=o,f._coloredMaterial=new on.a("",r.utilityLayerScene),f._coloredMaterial.diffuseColor=n,f._coloredMaterial.specularColor=n.subtract(new M.a(.1,.1,.1)),f._hoverMaterial=new on.a("",r.utilityLayerScene),f._hoverMaterial.diffuseColor=M.a.Yellow(),f._disableMaterial=new on.a("",r.utilityLayerScene),f._disableMaterial.diffuseColor=M.a.Gray(),f._disableMaterial.alpha=.4,f._gizmoMesh=t._CreatePlane(r.utilityLayerScene,f._coloredMaterial),f._gizmoMesh.lookAt(f._rootMesh.position.add(e)),f._gizmoMesh.scaling.scaleInPlace(1/3),f._gizmoMesh.parent=f._rootMesh;var v=0,y=new d.e,D={snapDistance:0};f.dragBehavior=new yi.a({dragPlaneNormal:e}),f.dragBehavior.moveAttached=!1,f._rootMesh.addBehavior(f.dragBehavior),f.dragBehavior.onDragObservable.add(function(z){if(f.attachedNode){if(f.snapDistance==0)f.attachedNode.getWorldMatrix().addTranslationFromFloats(z.delta.x,z.delta.y,z.delta.z);else if(v+=z.dragDistance,Math.abs(v)>f.snapDistance){var k=Math.floor(Math.abs(v)/f.snapDistance);v%=f.snapDistance,z.delta.normalizeToRef(y),y.scaleInPlace(f.snapDistance*k),f.attachedNode.getWorldMatrix().addTranslationFromFloats(y.x,y.y,y.z),D.snapDistance=f.snapDistance*k,f.onSnapObservable.notifyObservers(D)}f._matrixChanged()}}),f.dragBehavior.onDragStartObservable.add(function(){f._dragging=!0}),f.dragBehavior.onDragEndObservable.add(function(){f._dragging=!1});var w=r._getSharedGizmoLight();w.includedOnlyMeshes=w.includedOnlyMeshes.concat(f._rootMesh.getChildMeshes(!1));var F={gizmoMeshes:f._gizmoMesh.getChildMeshes(),colliderMeshes:f._gizmoMesh.getChildMeshes(),material:f._coloredMaterial,hoverMaterial:f._hoverMaterial,disableMaterial:f._disableMaterial,active:!1};return(u=f._parent)===null||u===void 0||u.addToAxisCache(f._gizmoMesh,F),f._pointerObserver=r.utilityLayerScene.onPointerObservable.add(function(z){var k;if(!f._customMeshSet&&(f._isHovered=F.colliderMeshes.indexOf((k=z==null?void 0:z.pickInfo)===null||k===void 0?void 0:k.pickedMesh)!=-1,!f._parent)){var K=f._isHovered||f._dragging?f._hoverMaterial:f._coloredMaterial;F.gizmoMeshes.forEach(function(oe){oe.material=K})}}),f}return Object(p.d)(t,i),t._CreatePlane=function(e,n){var r=new ys.a("plane",e),o=Yp.a.CreatePlane("dragPlane",{width:.1375,height:.1375,sideOrientation:2},e);return o.material=n,o.parent=r,r},t.prototype._attachedNodeChanged=function(e){this.dragBehavior&&(this.dragBehavior.enabled=!!e)},Object.defineProperty(t.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(e){this._isEnabled=e,e?this._parent&&(this.attachedNode=this._parent.attachedNode):this.attachedNode=null},enumerable:!1,configurable:!0}),t.prototype.dispose=function(){this.onSnapObservable.clear(),this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this.dragBehavior.detach(),i.prototype.dispose.call(this),this._gizmoMesh&&this._gizmoMesh.dispose(),[this._coloredMaterial,this._hoverMaterial,this._disableMaterial].forEach(function(e){e&&e.dispose()})},t}(jr.a),$y=function(i){function t(e,n,r){e===void 0&&(e=Ir.a.DefaultUtilityLayer),n===void 0&&(n=1);var o=i.call(this,e)||this;return o._meshAttached=null,o._nodeAttached=null,o._observables=[],o._gizmoAxisCache=new Map,o.onDragStartObservable=new S.c,o.onDragEndObservable=new S.c,o._planarGizmoEnabled=!1,o.xGizmo=new ch.a(new d.e(1,0,0),M.a.Red().scale(.5),e,o,n),o.yGizmo=new ch.a(new d.e(0,1,0),M.a.Green().scale(.5),e,o,n),o.zGizmo=new ch.a(new d.e(0,0,1),M.a.Blue().scale(.5),e,o,n),o.xPlaneGizmo=new uh(new d.e(1,0,0),M.a.Red().scale(.5),o.gizmoLayer,o),o.yPlaneGizmo=new uh(new d.e(0,1,0),M.a.Green().scale(.5),o.gizmoLayer,o),o.zPlaneGizmo=new uh(new d.e(0,0,1),M.a.Blue().scale(.5),o.gizmoLayer,o),[o.xGizmo,o.yGizmo,o.zGizmo,o.xPlaneGizmo,o.yPlaneGizmo,o.zPlaneGizmo].forEach(function(u){u.dragBehavior.onDragStartObservable.add(function(){o.onDragStartObservable.notifyObservers({})}),u.dragBehavior.onDragEndObservable.add(function(){o.onDragEndObservable.notifyObservers({})})}),o.attachedMesh=null,r?r.addToAxisCache(o._gizmoAxisCache):jr.a.GizmoAxisPointerObserver(e,o._gizmoAxisCache),o}return Object(p.d)(t,i),Object.defineProperty(t.prototype,"attachedMesh",{get:function(){return this._meshAttached},set:function(e){this._meshAttached=e,this._nodeAttached=e,[this.xGizmo,this.yGizmo,this.zGizmo,this.xPlaneGizmo,this.yPlaneGizmo,this.zPlaneGizmo].forEach(function(n){n.isEnabled?n.attachedMesh=e:n.attachedMesh=null})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"attachedNode",{get:function(){return this._nodeAttached},set:function(e){this._meshAttached=null,this._nodeAttached=null,[this.xGizmo,this.yGizmo,this.zGizmo,this.xPlaneGizmo,this.yPlaneGizmo,this.zPlaneGizmo].forEach(function(n){n.isEnabled?n.attachedNode=e:n.attachedNode=null})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isHovered",{get:function(){var e=!1;return[this.xGizmo,this.yGizmo,this.zGizmo,this.xPlaneGizmo,this.yPlaneGizmo,this.zPlaneGizmo].forEach(function(n){e=e||n.isHovered}),e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"planarGizmoEnabled",{get:function(){return this._planarGizmoEnabled},set:function(e){var n=this;this._planarGizmoEnabled=e,[this.xPlaneGizmo,this.yPlaneGizmo,this.zPlaneGizmo].forEach(function(r){r&&(r.isEnabled=e,e&&(r.attachedMesh?r.attachedMesh=n.attachedMesh:r.attachedNode=n.attachedNode))},this)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"updateGizmoRotationToMatchAttachedMesh",{get:function(){return this._updateGizmoRotationToMatchAttachedMesh},set:function(e){this._updateGizmoRotationToMatchAttachedMesh=e,[this.xGizmo,this.yGizmo,this.zGizmo,this.xPlaneGizmo,this.yPlaneGizmo,this.zPlaneGizmo].forEach(function(n){n&&(n.updateGizmoRotationToMatchAttachedMesh=e)})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"snapDistance",{get:function(){return this._snapDistance},set:function(e){this._snapDistance=e,[this.xGizmo,this.yGizmo,this.zGizmo,this.xPlaneGizmo,this.yPlaneGizmo,this.zPlaneGizmo].forEach(function(n){n&&(n.snapDistance=e)})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scaleRatio",{get:function(){return this._scaleRatio},set:function(e){this._scaleRatio=e,[this.xGizmo,this.yGizmo,this.zGizmo,this.xPlaneGizmo,this.yPlaneGizmo,this.zPlaneGizmo].forEach(function(n){n&&(n.scaleRatio=e)})},enumerable:!1,configurable:!0}),t.prototype.addToAxisCache=function(e,n){this._gizmoAxisCache.set(e,n)},t.prototype.dispose=function(){var e=this;[this.xGizmo,this.yGizmo,this.zGizmo,this.xPlaneGizmo,this.yPlaneGizmo,this.zPlaneGizmo].forEach(function(n){n&&n.dispose()}),this._observables.forEach(function(n){e.gizmoLayer.utilityLayerScene.onPointerObservable.remove(n)}),this.onDragStartObservable.clear(),this.onDragEndObservable.clear()},t.prototype.setCustomMesh=function(e){_.a.Error("Custom meshes are not supported on this gizmo, please set the custom meshes on the gizmos contained within this one (gizmo.xGizmo, gizmo.yGizmo, gizmo.zGizmo,gizmo.xPlaneGizmo, gizmo.yPlaneGizmo, gizmo.zPlaneGizmo)")},t}(jr.a);Tt.a.CreatePolyhedron=function(i){var t=[];t[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},t[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},t[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},t[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},t[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},t[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},t[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},t[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},t[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},t[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},t[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},t[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},t[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},t[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},t[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};var e,n,r,o,u,f,v=i.type&&(i.type<0||i.type>=t.length)?0:i.type||0,y=i.size,D=i.sizeX||y||1,w=i.sizeY||y||1,F=i.sizeZ||y||1,z=i.custom||t[v],k=z.face.length,K=i.faceUV||new Array(k),oe=i.faceColors,ae=i.flat===void 0||i.flat,ue=i.sideOrientation===0?0:i.sideOrientation||Tt.a.DEFAULTSIDE,de=new Array,me=new Array,ye=new Array,Ee=new Array,Ae=new Array,Ie=0,Re=0,Pe=new Array,Ce=0,Be=0;if(ae)for(Be=0;Be<k;Be++)oe&&oe[Be]===void 0&&(oe[Be]=new M.b(1,1,1,1)),K&&K[Be]===void 0&&(K[Be]=new d.f(0,0,1,1));if(ae)for(Be=0;Be<k;Be++){var Oe=z.face[Be].length;for(r=2*Math.PI/Oe,o=.5*Math.tan(r/2),u=.5,Ce=0;Ce<Oe;Ce++)de.push(z.vertex[z.face[Be][Ce]][0]*D,z.vertex[z.face[Be][Ce]][1]*w,z.vertex[z.face[Be][Ce]][2]*F),Pe.push(Ie),Ie++,e=K[Be].x+(K[Be].z-K[Be].x)*(.5+o),n=K[Be].y+(K[Be].w-K[Be].y)*(u-.5),Ee.push(e,n),f=o*Math.cos(r)-u*Math.sin(r),u=o*Math.sin(r)+u*Math.cos(r),o=f,oe&&Ae.push(oe[Be].r,oe[Be].g,oe[Be].b,oe[Be].a);for(Ce=0;Ce<Oe-2;Ce++)me.push(Pe[0+Re],Pe[Ce+2+Re],Pe[Ce+1+Re]);Re+=Oe}else{for(Ce=0;Ce<z.vertex.length;Ce++)de.push(z.vertex[Ce][0]*D,z.vertex[Ce][1]*w,z.vertex[Ce][2]*F),Ee.push(0,0);for(Be=0;Be<k;Be++)for(Ce=0;Ce<z.face[Be].length-2;Ce++)me.push(z.face[Be][0],z.face[Be][Ce+2],z.face[Be][Ce+1])}Tt.a.ComputeNormals(de,me,ye),Tt.a._ComputeSides(ue,de,me,ye,Ee,i.frontUVs,i.backUVs);var Ve=new Tt.a;return Ve.positions=de,Ve.indices=me,Ve.normals=ye,Ve.uvs=Ee,oe&&ae&&(Ve.colors=Ae),Ve},Ne.a.CreatePolyhedron=function(i,t,e){return rl.CreatePolyhedron(i,t,e)};var rl=function(){function i(){}return i.CreatePolyhedron=function(t,e,n){n===void 0&&(n=null);var r=new Ne.a(t,n);return e.sideOrientation=Ne.a._GetDefaultSideOrientation(e.sideOrientation),r._originalBuilderSideOrientation=e.sideOrientation,Tt.a.CreatePolyhedron(e).applyToMesh(r,e.updatable),r},i}(),Jy=function(i){function t(e,n,r){e===void 0&&(e=Ir.a.DefaultUtilityLayer),n===void 0&&(n=1);var o=i.call(this,e)||this;return o._meshAttached=null,o._nodeAttached=null,o._sensitivity=1,o._observables=[],o._gizmoAxisCache=new Map,o.onDragStartObservable=new S.c,o.onDragEndObservable=new S.c,o.uniformScaleGizmo=o._createUniformScaleMesh(),o.xGizmo=new nl(new d.e(1,0,0),M.a.Red().scale(.5),e,o,n),o.yGizmo=new nl(new d.e(0,1,0),M.a.Green().scale(.5),e,o,n),o.zGizmo=new nl(new d.e(0,0,1),M.a.Blue().scale(.5),e,o,n),[o.xGizmo,o.yGizmo,o.zGizmo,o.uniformScaleGizmo].forEach(function(u){u.dragBehavior.onDragStartObservable.add(function(){o.onDragStartObservable.notifyObservers({})}),u.dragBehavior.onDragEndObservable.add(function(){o.onDragEndObservable.notifyObservers({})})}),o.attachedMesh=null,o.attachedNode=null,r?r.addToAxisCache(o._gizmoAxisCache):jr.a.GizmoAxisPointerObserver(e,o._gizmoAxisCache),o}return Object(p.d)(t,i),Object.defineProperty(t.prototype,"attachedMesh",{get:function(){return this._meshAttached},set:function(e){this._meshAttached=e,this._nodeAttached=e,[this.xGizmo,this.yGizmo,this.zGizmo,this.uniformScaleGizmo].forEach(function(n){n.isEnabled?n.attachedMesh=e:n.attachedMesh=null})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"attachedNode",{get:function(){return this._nodeAttached},set:function(e){this._meshAttached=null,this._nodeAttached=e,[this.xGizmo,this.yGizmo,this.zGizmo,this.uniformScaleGizmo].forEach(function(n){n.isEnabled?n.attachedNode=e:n.attachedNode=null})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isHovered",{get:function(){var e=!1;return[this.xGizmo,this.yGizmo,this.zGizmo].forEach(function(n){e=e||n.isHovered}),e},enumerable:!1,configurable:!0}),t.prototype._createUniformScaleMesh=function(){this._coloredMaterial=new on.a("",this.gizmoLayer.utilityLayerScene),this._coloredMaterial.diffuseColor=M.a.Gray(),this._hoverMaterial=new on.a("",this.gizmoLayer.utilityLayerScene),this._hoverMaterial.diffuseColor=M.a.Yellow(),this._disableMaterial=new on.a("",this.gizmoLayer.utilityLayerScene),this._disableMaterial.diffuseColor=M.a.Gray(),this._disableMaterial.alpha=.4;var e=new nl(new d.e(0,1,0),M.a.Gray().scale(.5),this.gizmoLayer,this);e.updateGizmoRotationToMatchAttachedMesh=!1,e.uniformScaling=!0,this._uniformScalingMesh=rl.CreatePolyhedron("uniform",{type:1},e.gizmoLayer.utilityLayerScene),this._uniformScalingMesh.scaling.scaleInPlace(.01),this._uniformScalingMesh.visibility=0,this._octahedron=rl.CreatePolyhedron("",{type:1},e.gizmoLayer.utilityLayerScene),this._octahedron.scaling.scaleInPlace(.007),this._uniformScalingMesh.addChild(this._octahedron),e.setCustomMesh(this._uniformScalingMesh,!0);var n=this.gizmoLayer._getSharedGizmoLight();n.includedOnlyMeshes=n.includedOnlyMeshes.concat(this._octahedron);var r={gizmoMeshes:[this._octahedron,this._uniformScalingMesh],colliderMeshes:[this._uniformScalingMesh],material:this._coloredMaterial,hoverMaterial:this._hoverMaterial,disableMaterial:this._disableMaterial,active:!1};return this.addToAxisCache(e._rootMesh,r),e},Object.defineProperty(t.prototype,"updateGizmoRotationToMatchAttachedMesh",{get:function(){return this._updateGizmoRotationToMatchAttachedMesh},set:function(e){e?(this._updateGizmoRotationToMatchAttachedMesh=e,[this.xGizmo,this.yGizmo,this.zGizmo,this.uniformScaleGizmo].forEach(function(n){n&&(n.updateGizmoRotationToMatchAttachedMesh=e)})):_.a.Warn("Setting updateGizmoRotationToMatchAttachedMesh = false on scaling gizmo is not supported.")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"snapDistance",{get:function(){return this._snapDistance},set:function(e){this._snapDistance=e,[this.xGizmo,this.yGizmo,this.zGizmo,this.uniformScaleGizmo].forEach(function(n){n&&(n.snapDistance=e)})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scaleRatio",{get:function(){return this._scaleRatio},set:function(e){this._scaleRatio=e,[this.xGizmo,this.yGizmo,this.zGizmo,this.uniformScaleGizmo].forEach(function(n){n&&(n.scaleRatio=e)})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sensitivity",{get:function(){return this._sensitivity},set:function(e){this._sensitivity=e,[this.xGizmo,this.yGizmo,this.zGizmo,this.uniformScaleGizmo].forEach(function(n){n&&(n.sensitivity=e)})},enumerable:!1,configurable:!0}),t.prototype.addToAxisCache=function(e,n){this._gizmoAxisCache.set(e,n)},t.prototype.dispose=function(){var e=this;[this.xGizmo,this.yGizmo,this.zGizmo,this.uniformScaleGizmo].forEach(function(n){n&&n.dispose()}),this._observables.forEach(function(n){e.gizmoLayer.utilityLayerScene.onPointerObservable.remove(n)}),this.onDragStartObservable.clear(),this.onDragEndObservable.clear(),[this._uniformScalingMesh,this._octahedron].forEach(function(n){n&&n.dispose()}),[this._coloredMaterial,this._hoverMaterial,this._disableMaterial].forEach(function(n){n&&n.dispose()})},t}(jr.a),FI=function(){function i(t,e,n,r){e===void 0&&(e=1),n===void 0&&(n=Ir.a.DefaultUtilityLayer),r===void 0&&(r=Ir.a.DefaultKeepDepthUtilityLayer),this.scene=t,this.clearGizmoOnEmptyPointerEvent=!1,this.onAttachedToMeshObservable=new S.c,this.onAttachedToNodeObservable=new S.c,this._gizmosEnabled={positionGizmo:!1,rotationGizmo:!1,scaleGizmo:!1,boundingBoxGizmo:!1},this._pointerObservers=[],this._attachedMesh=null,this._attachedNode=null,this._boundingBoxColor=M.a.FromHexString("#0984e3"),this._thickness=1,this._gizmoAxisCache=new Map,this.boundingBoxDragBehavior=new Xu,this.attachableMeshes=null,this.attachableNodes=null,this.usePointerToAttachGizmos=!0,this._defaultUtilityLayer=n,this._defaultKeepDepthUtilityLayer=r,this._defaultKeepDepthUtilityLayer.utilityLayerScene.autoClearDepthAndStencil=!1,this._thickness=e,this.gizmos={positionGizmo:null,rotationGizmo:null,scaleGizmo:null,boundingBoxGizmo:null};var o=this._attachToMeshPointerObserver(t),u=jr.a.GizmoAxisPointerObserver(this._defaultUtilityLayer,this._gizmoAxisCache);this._pointerObservers=[o,u]}return Object.defineProperty(i.prototype,"keepDepthUtilityLayer",{get:function(){return this._defaultKeepDepthUtilityLayer},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"utilityLayer",{get:function(){return this._defaultUtilityLayer},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isHovered",{get:function(){var t=!1;for(var e in this.gizmos){var n=this.gizmos[e];if(n&&n.isHovered){t=!0;break}}return t},enumerable:!1,configurable:!0}),i.prototype._attachToMeshPointerObserver=function(t){var e=this;return t.onPointerObservable.add(function(n){if(e.usePointerToAttachGizmos&&n.type==Ot.a.POINTERDOWN)if(n.pickInfo&&n.pickInfo.pickedMesh){var r=n.pickInfo.pickedMesh;if(e.attachableMeshes==null)for(;r&&r.parent!=null;)r=r.parent;else{var o=!1;e.attachableMeshes.forEach(function(u){r&&(r==u||r.isDescendantOf(u))&&(r=u,o=!0)}),o||(r=null)}r instanceof jt.a?e._attachedMesh!=r&&e.attachToMesh(r):e.clearGizmoOnEmptyPointerEvent&&e.attachToMesh(null)}else e.clearGizmoOnEmptyPointerEvent&&e.attachToMesh(null)})},i.prototype.attachToMesh=function(t){for(var e in this._attachedMesh&&this._attachedMesh.removeBehavior(this.boundingBoxDragBehavior),this._attachedNode&&this._attachedNode.removeBehavior(this.boundingBoxDragBehavior),this._attachedMesh=t,this._attachedNode=null,this.gizmos){var n=this.gizmos[e];n&&this._gizmosEnabled[e]&&(n.attachedMesh=t)}this.boundingBoxGizmoEnabled&&this._attachedMesh&&this._attachedMesh.addBehavior(this.boundingBoxDragBehavior),this.onAttachedToMeshObservable.notifyObservers(t)},i.prototype.attachToNode=function(t){for(var e in this._attachedMesh&&this._attachedMesh.removeBehavior(this.boundingBoxDragBehavior),this._attachedNode&&this._attachedNode.removeBehavior(this.boundingBoxDragBehavior),this._attachedMesh=null,this._attachedNode=t,this.gizmos){var n=this.gizmos[e];n&&this._gizmosEnabled[e]&&(n.attachedNode=t)}this.boundingBoxGizmoEnabled&&this._attachedNode&&this._attachedNode.addBehavior(this.boundingBoxDragBehavior),this.onAttachedToNodeObservable.notifyObservers(t)},Object.defineProperty(i.prototype,"positionGizmoEnabled",{get:function(){return this._gizmosEnabled.positionGizmo},set:function(t){t?(this.gizmos.positionGizmo||(this.gizmos.positionGizmo=new $y(this._defaultUtilityLayer,this._thickness,this)),this._attachedNode?this.gizmos.positionGizmo.attachedNode=this._attachedNode:this.gizmos.positionGizmo.attachedMesh=this._attachedMesh):this.gizmos.positionGizmo&&(this.gizmos.positionGizmo.attachedNode=null),this._gizmosEnabled.positionGizmo=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"rotationGizmoEnabled",{get:function(){return this._gizmosEnabled.rotationGizmo},set:function(t){t?(this.gizmos.rotationGizmo||(this.gizmos.rotationGizmo=new Zy(this._defaultUtilityLayer,32,!1,this._thickness,this)),this._attachedNode?this.gizmos.rotationGizmo.attachedNode=this._attachedNode:this.gizmos.rotationGizmo.attachedMesh=this._attachedMesh):this.gizmos.rotationGizmo&&(this.gizmos.rotationGizmo.attachedNode=null),this._gizmosEnabled.rotationGizmo=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"scaleGizmoEnabled",{get:function(){return this._gizmosEnabled.scaleGizmo},set:function(t){t?(this.gizmos.scaleGizmo=this.gizmos.scaleGizmo||new Jy(this._defaultUtilityLayer,this._thickness,this),this._attachedNode?this.gizmos.scaleGizmo.attachedNode=this._attachedNode:this.gizmos.scaleGizmo.attachedMesh=this._attachedMesh):this.gizmos.scaleGizmo&&(this.gizmos.scaleGizmo.attachedNode=null),this._gizmosEnabled.scaleGizmo=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"boundingBoxGizmoEnabled",{get:function(){return this._gizmosEnabled.boundingBoxGizmo},set:function(t){t?(this.gizmos.boundingBoxGizmo=this.gizmos.boundingBoxGizmo||new qy(this._boundingBoxColor,this._defaultKeepDepthUtilityLayer),this._attachedMesh?this.gizmos.boundingBoxGizmo.attachedMesh=this._attachedMesh:this.gizmos.boundingBoxGizmo.attachedNode=this._attachedNode,this._attachedMesh?(this._attachedMesh.removeBehavior(this.boundingBoxDragBehavior),this._attachedMesh.addBehavior(this.boundingBoxDragBehavior)):this._attachedNode&&(this._attachedNode.removeBehavior(this.boundingBoxDragBehavior),this._attachedNode.addBehavior(this.boundingBoxDragBehavior))):this.gizmos.boundingBoxGizmo&&(this._attachedMesh?this._attachedMesh.removeBehavior(this.boundingBoxDragBehavior):this._attachedNode&&this._attachedNode.removeBehavior(this.boundingBoxDragBehavior),this.gizmos.boundingBoxGizmo.attachedNode=null),this._gizmosEnabled.boundingBoxGizmo=t},enumerable:!1,configurable:!0}),i.prototype.addToAxisCache=function(t){var e=this;t.size>0&&t.forEach(function(n,r){e._gizmoAxisCache.set(r,n)})},i.prototype.dispose=function(){var t=this;for(var e in this._pointerObservers.forEach(function(r){t.scene.onPointerObservable.remove(r)}),this.gizmos){var n=this.gizmos[e];n&&n.dispose()}this._defaultKeepDepthUtilityLayer.dispose(),this._defaultUtilityLayer.dispose(),this.boundingBoxDragBehavior.detach(),this.onAttachedToMeshObservable.clear()},i}(),uo=c(48),hh=function(i){function t(){var e=i!==null&&i.apply(this,arguments)||this;return e._needProjectionMatrixCompute=!0,e}return Object(p.d)(t,i),t.prototype._setPosition=function(e){this._position=e},Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(e){this._setPosition(e)},enumerable:!1,configurable:!0}),t.prototype._setDirection=function(e){this._direction=e},Object.defineProperty(t.prototype,"direction",{get:function(){return this._direction},set:function(e){this._setDirection(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"shadowMinZ",{get:function(){return this._shadowMinZ},set:function(e){this._shadowMinZ=e,this.forceProjectionMatrixCompute()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"shadowMaxZ",{get:function(){return this._shadowMaxZ},set:function(e){this._shadowMaxZ=e,this.forceProjectionMatrixCompute()},enumerable:!1,configurable:!0}),t.prototype.computeTransformedInformation=function(){return!(!this.parent||!this.parent.getWorldMatrix)&&(this.transformedPosition||(this.transformedPosition=d.e.Zero()),d.e.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=d.e.Zero()),d.e.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection)),!0)},t.prototype.getDepthScale=function(){return 50},t.prototype.getShadowDirection=function(e){return this.transformedDirection?this.transformedDirection:this.direction},t.prototype.getAbsolutePosition=function(){return this.transformedPosition?this.transformedPosition:this.position},t.prototype.setDirectionToTarget=function(e){return this.direction=d.e.Normalize(e.subtract(this.position)),this.direction},t.prototype.getRotation=function(){this.direction.normalize();var e=d.e.Cross(this.direction,Se.a.Y),n=d.e.Cross(e,this.direction);return d.e.RotationFromAxis(e,n,this.direction)},t.prototype.needCube=function(){return!1},t.prototype.needProjectionMatrixCompute=function(){return this._needProjectionMatrixCompute},t.prototype.forceProjectionMatrixCompute=function(){this._needProjectionMatrixCompute=!0},t.prototype._initCache=function(){i.prototype._initCache.call(this),this._cache.position=d.e.Zero()},t.prototype._isSynchronized=function(){return!!this._cache.position.equals(this.position)},t.prototype.computeWorldMatrix=function(e){return!e&&this.isSynchronized()?(this._currentRenderId=this.getScene().getRenderId(),this._worldMatrix):(this._updateCache(),this._cache.position.copyFrom(this.position),this._worldMatrix||(this._worldMatrix=d.a.Identity()),d.a.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this.parent&&this.parent.getWorldMatrix&&(this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix)},t.prototype.getDepthMinZ=function(e){return this.shadowMinZ!==void 0?this.shadowMinZ:e.minZ},t.prototype.getDepthMaxZ=function(e){return this.shadowMaxZ!==void 0?this.shadowMaxZ:e.maxZ},t.prototype.setShadowProjectionMatrix=function(e,n,r){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(n,r,e):this._setDefaultShadowProjectionMatrix(e,n,r),this},Object(p.c)([Object(B.o)()],t.prototype,"position",null),Object(p.c)([Object(B.o)()],t.prototype,"direction",null),Object(p.c)([Object(B.c)()],t.prototype,"shadowMinZ",null),Object(p.c)([Object(B.c)()],t.prototype,"shadowMaxZ",null),t}(uo.a);$.a.AddNodeConstructor("Light_Type_1",function(i,t){return function(){return new Kp(i,d.e.Zero(),t)}});var Kp=function(i){function t(e,n,r){var o=i.call(this,e,r)||this;return o._shadowFrustumSize=0,o._shadowOrthoScale=.1,o.autoUpdateExtends=!0,o.autoCalcShadowZBounds=!1,o._orthoLeft=Number.MAX_VALUE,o._orthoRight=Number.MIN_VALUE,o._orthoTop=Number.MIN_VALUE,o._orthoBottom=Number.MAX_VALUE,o.position=n.scale(-1),o.direction=n,o}return Object(p.d)(t,i),Object.defineProperty(t.prototype,"shadowFrustumSize",{get:function(){return this._shadowFrustumSize},set:function(e){this._shadowFrustumSize=e,this.forceProjectionMatrixCompute()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"shadowOrthoScale",{get:function(){return this._shadowOrthoScale},set:function(e){this._shadowOrthoScale=e,this.forceProjectionMatrixCompute()},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"DirectionalLight"},t.prototype.getTypeID=function(){return uo.a.LIGHTTYPEID_DIRECTIONALLIGHT},t.prototype._setDefaultShadowProjectionMatrix=function(e,n,r){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(e):this._setDefaultAutoExtendShadowProjectionMatrix(e,n,r)},t.prototype._setDefaultFixedFrustumShadowProjectionMatrix=function(e){var n=this.getScene().activeCamera;n&&d.a.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,this.shadowMinZ!==void 0?this.shadowMinZ:n.minZ,this.shadowMaxZ!==void 0?this.shadowMaxZ:n.maxZ,e)},t.prototype._setDefaultAutoExtendShadowProjectionMatrix=function(e,n,r){var o=this.getScene().activeCamera;if(o){if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){var u=d.e.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE;for(var f=Number.MAX_VALUE,v=Number.MIN_VALUE,y=0;y<r.length;y++){var D=r[y];if(D)for(var w=D.getBoundingInfo().boundingBox,F=0;F<w.vectorsWorld.length;F++)d.e.TransformCoordinatesToRef(w.vectorsWorld[F],n,u),u.x<this._orthoLeft&&(this._orthoLeft=u.x),u.y<this._orthoBottom&&(this._orthoBottom=u.y),u.x>this._orthoRight&&(this._orthoRight=u.x),u.y>this._orthoTop&&(this._orthoTop=u.y),this.autoCalcShadowZBounds&&(u.z<f&&(f=u.z),u.z>v&&(v=u.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=f,this._shadowMaxZ=v)}var z=this._orthoRight-this._orthoLeft,k=this._orthoTop-this._orthoBottom;d.a.OrthoOffCenterLHToRef(this._orthoLeft-z*this.shadowOrthoScale,this._orthoRight+z*this.shadowOrthoScale,this._orthoBottom-k*this.shadowOrthoScale,this._orthoTop+k*this.shadowOrthoScale,this.shadowMinZ!==void 0?this.shadowMinZ:o.minZ,this.shadowMaxZ!==void 0?this.shadowMaxZ:o.maxZ,e)}},t.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},t.prototype.transferToEffect=function(e,n){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,n),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,n),this)},t.prototype.transferToNodeMaterialEffect=function(e,n){return this.computeTransformedInformation()?(e.setFloat3(n,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(e.setFloat3(n,this.direction.x,this.direction.y,this.direction.z),this)},t.prototype.getDepthMinZ=function(e){return 1},t.prototype.getDepthMaxZ=function(e){return 1},t.prototype.prepareLightSpecificDefines=function(e,n){e["DIRLIGHT"+n]=!0},Object(p.c)([Object(B.c)()],t.prototype,"shadowFrustumSize",null),Object(p.c)([Object(B.c)()],t.prototype,"shadowOrthoScale",null),Object(p.c)([Object(B.c)()],t.prototype,"autoUpdateExtends",void 0),Object(p.c)([Object(B.c)()],t.prototype,"autoCalcShadowZBounds",void 0),t}(hh);Ne.a.CreateHemisphere=function(i,t,e,n){var r={segments:t,diameter:e};return dh.CreateHemisphere(i,r,n)};var dh=function(){function i(){}return i.CreateHemisphere=function(t,e,n){e.diameter||(e.diameter=1),e.segments||(e.segments=16);var r=zr.a.CreateSphere("",{slice:.5,diameter:e.diameter,segments:e.segments},n),o=Ne.a.CreateDisc("",e.diameter/2,3*e.segments+(4-e.segments),n);o.rotation.x=-Math.PI/2,o.parent=r;var u=Ne.a.MergeMeshes([o,r],!0);return u.name=t,u},i}();$.a.AddNodeConstructor("Light_Type_2",function(i,t){return function(){return new Qp(i,d.e.Zero(),d.e.Zero(),0,0,t)}});var Qp=function(i){function t(e,n,r,o,u,f){var v=i.call(this,e,f)||this;return v._innerAngle=0,v._projectionTextureMatrix=d.a.Zero(),v._projectionTextureLightNear=1e-6,v._projectionTextureLightFar=1e3,v._projectionTextureUpDirection=d.e.Up(),v._projectionTextureViewLightDirty=!0,v._projectionTextureProjectionLightDirty=!0,v._projectionTextureDirty=!0,v._projectionTextureViewTargetVector=d.e.Zero(),v._projectionTextureViewLightMatrix=d.a.Zero(),v._projectionTextureProjectionLightMatrix=d.a.Zero(),v._projectionTextureScalingMatrix=d.a.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),v.position=n,v.direction=r,v.angle=o,v.exponent=u,v}return Object(p.d)(t,i),Object.defineProperty(t.prototype,"angle",{get:function(){return this._angle},set:function(e){this._angle=e,this._cosHalfAngle=Math.cos(.5*e),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"innerAngle",{get:function(){return this._innerAngle},set:function(e){this._innerAngle=e,this._computeAngleValues()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"shadowAngleScale",{get:function(){return this._shadowAngleScale},set:function(e){this._shadowAngleScale=e,this.forceProjectionMatrixCompute()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"projectionTextureMatrix",{get:function(){return this._projectionTextureMatrix},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"projectionTextureLightNear",{get:function(){return this._projectionTextureLightNear},set:function(e){this._projectionTextureLightNear=e,this._projectionTextureProjectionLightDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"projectionTextureLightFar",{get:function(){return this._projectionTextureLightFar},set:function(e){this._projectionTextureLightFar=e,this._projectionTextureProjectionLightDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"projectionTextureUpDirection",{get:function(){return this._projectionTextureUpDirection},set:function(e){this._projectionTextureUpDirection=e,this._projectionTextureProjectionLightDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"projectionTexture",{get:function(){return this._projectionTexture},set:function(e){var n=this;this._projectionTexture!==e&&(this._projectionTexture=e,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(t._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled(function(){n._markMeshesAsLightDirty()}):t._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce(function(){n._markMeshesAsLightDirty()})))},enumerable:!1,configurable:!0}),t._IsProceduralTexture=function(e){return e.onGeneratedObservable!==void 0},t._IsTexture=function(e){return e.onLoadObservable!==void 0},t.prototype.getClassName=function(){return"SpotLight"},t.prototype.getTypeID=function(){return uo.a.LIGHTTYPEID_SPOTLIGHT},t.prototype._setDirection=function(e){i.prototype._setDirection.call(this,e),this._projectionTextureViewLightDirty=!0},t.prototype._setPosition=function(e){i.prototype._setPosition.call(this,e),this._projectionTextureViewLightDirty=!0},t.prototype._setDefaultShadowProjectionMatrix=function(e,n,r){var o=this.getScene().activeCamera;if(o){this._shadowAngleScale=this._shadowAngleScale||1;var u=this._shadowAngleScale*this._angle;d.a.PerspectiveFovLHToRef(u,1,this.getDepthMinZ(o),this.getDepthMaxZ(o),e)}},t.prototype._computeProjectionTextureViewLightMatrix=function(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.position.addToRef(this.direction,this._projectionTextureViewTargetVector),d.a.LookAtLHToRef(this.position,this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)},t.prototype._computeProjectionTextureProjectionLightMatrix=function(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;var e=this.projectionTextureLightFar,n=this.projectionTextureLightNear,r=e/(e-n),o=-r*n,u=1/Math.tan(this._angle/2);d.a.FromValuesToRef(u/1,0,0,0,0,u,0,0,0,0,r,1,0,0,o,0,this._projectionTextureProjectionLightMatrix)},t.prototype._computeProjectionTextureMatrix=function(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof ke.a){var e=this._projectionTexture.uScale/2,n=this._projectionTexture.vScale/2;d.a.FromValuesToRef(e,0,0,0,0,n,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)},t.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},t.prototype._computeAngleValues=function(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale},t.prototype.transferTexturesToEffect=function(e,n){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),e.setMatrix("textureProjectionMatrix"+n,this._projectionTextureMatrix),e.setTexture("projectionLightSampler"+n,this.projectionTexture)),this},t.prototype.transferToEffect=function(e,n){var r;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,n),r=d.e.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,n),r=d.e.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",r.x,r.y,r.z,this._cosHalfAngle,n),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,n),this},t.prototype.transferToNodeMaterialEffect=function(e,n){var r;return r=this.computeTransformedInformation()?d.e.Normalize(this.transformedDirection):d.e.Normalize(this.direction),this.getScene().useRightHandedSystem?e.setFloat3(n,-r.x,-r.y,-r.z):e.setFloat3(n,r.x,r.y,r.z),this},t.prototype.dispose=function(){i.prototype.dispose.call(this),this._projectionTexture&&this._projectionTexture.dispose()},t.prototype.prepareLightSpecificDefines=function(e,n){e["SPOTLIGHT"+n]=!0,e["PROJECTEDLIGHTTEXTURE"+n]=!(!this.projectionTexture||!this.projectionTexture.isReady())},Object(p.c)([Object(B.c)()],t.prototype,"angle",null),Object(p.c)([Object(B.c)()],t.prototype,"innerAngle",null),Object(p.c)([Object(B.c)()],t.prototype,"shadowAngleScale",null),Object(p.c)([Object(B.c)()],t.prototype,"exponent",void 0),Object(p.c)([Object(B.c)()],t.prototype,"projectionTextureLightNear",null),Object(p.c)([Object(B.c)()],t.prototype,"projectionTextureLightFar",null),Object(p.c)([Object(B.c)()],t.prototype,"projectionTextureUpDirection",null),Object(p.c)([Object(B.m)("projectedLightTexture")],t.prototype,"_projectionTexture",void 0),t}(hh),BI=function(i){function t(e){e===void 0&&(e=Ir.a.DefaultUtilityLayer);var n=i.call(this,e)||this;return n._cachedPosition=new d.e,n._cachedForward=new d.e(0,0,1),n._pointerObserver=null,n.onClickedObservable=new S.c,n._light=null,n.attachedMesh=new jt.a("",n.gizmoLayer.utilityLayerScene),n._attachedMeshParent=new ys.a("parent",n.gizmoLayer.utilityLayerScene),n.attachedMesh.parent=n._attachedMeshParent,n._material=new on.a("light",n.gizmoLayer.utilityLayerScene),n._material.diffuseColor=new M.a(.5,.5,.5),n._material.specularColor=new M.a(.1,.1,.1),n._pointerObserver=e.utilityLayerScene.onPointerObservable.add(function(r){n._light&&(n._isHovered=!(!r.pickInfo||n._rootMesh.getChildMeshes().indexOf(r.pickInfo.pickedMesh)==-1),n._isHovered&&r.event.button===0&&n.onClickedObservable.notifyObservers(n._light))},Ot.a.POINTERDOWN),n}return Object(p.d)(t,i),Object.defineProperty(t.prototype,"light",{get:function(){return this._light},set:function(e){var n=this;if(this._light=e,e){this._lightMesh&&this._lightMesh.dispose(),e instanceof eh.a?this._lightMesh=t._CreateHemisphericLightMesh(this.gizmoLayer.utilityLayerScene):this._lightMesh=e instanceof Kp?t._CreateDirectionalLightMesh(this.gizmoLayer.utilityLayerScene):e instanceof Qp?t._CreateSpotLightMesh(this.gizmoLayer.utilityLayerScene):t._CreatePointLightMesh(this.gizmoLayer.utilityLayerScene),this._lightMesh.getChildMeshes(!1).forEach(function(o){o.material=n._material}),this._lightMesh.parent=this._rootMesh;var r=this.gizmoLayer._getSharedGizmoLight();r.includedOnlyMeshes=r.includedOnlyMeshes.concat(this._lightMesh.getChildMeshes(!1)),this._lightMesh.rotationQuaternion=new d.b,this.attachedMesh.reservedDataStore||(this.attachedMesh.reservedDataStore={}),this.attachedMesh.reservedDataStore.lightGizmo=this,e.parent&&this._attachedMeshParent.freezeWorldMatrix(e.parent.getWorldMatrix()),e.position&&(this.attachedMesh.position.copyFrom(e.position),this.attachedMesh.computeWorldMatrix(!0),this._cachedPosition.copyFrom(this.attachedMesh.position)),e.direction&&(this.attachedMesh.setDirection(e.direction),this.attachedMesh.computeWorldMatrix(!0),this._cachedForward.copyFrom(this.attachedMesh.forward)),this._update()}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"material",{get:function(){return this._material},enumerable:!1,configurable:!0}),t.prototype._update=function(){i.prototype._update.call(this),this._light&&(this._light.parent&&this._attachedMeshParent.freezeWorldMatrix(this._light.parent.getWorldMatrix()),this._light.position&&(this.attachedMesh.position.equals(this._cachedPosition)?(this.attachedMesh.position.copyFrom(this._light.position),this.attachedMesh.computeWorldMatrix(!0),this._cachedPosition.copyFrom(this.attachedMesh.position)):(this._light.position.copyFrom(this.attachedMesh.position),this._cachedPosition.copyFrom(this.attachedMesh.position))),this._light.direction&&(d.e.DistanceSquared(this.attachedMesh.forward,this._cachedForward)>1e-4?(this._light.direction.copyFrom(this.attachedMesh.forward),this._cachedForward.copyFrom(this.attachedMesh.forward)):d.e.DistanceSquared(this.attachedMesh.forward,this._light.direction)>1e-4&&(this.attachedMesh.setDirection(this._light.direction),this.attachedMesh.computeWorldMatrix(!0),this._cachedForward.copyFrom(this.attachedMesh.forward))))},t.prototype.dispose=function(){this.onClickedObservable.clear(),this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this._material.dispose(),i.prototype.dispose.call(this),this._attachedMeshParent.dispose()},t._CreateHemisphericLightMesh=function(e){var n=new Ne.a("hemisphereLight",e),r=dh.CreateHemisphere(n.name,{segments:10,diameter:1},e);r.position.z=-.15,r.rotation.x=Math.PI/2,r.parent=n;var o=this._CreateLightLines(3,e);return o.parent=n,o.position.z,n.scaling.scaleInPlace(t._Scale),n.rotation.x=Math.PI/2,n},t._CreatePointLightMesh=function(e){var n=new Ne.a("pointLight",e),r=zr.a.CreateSphere(n.name,{segments:10,diameter:1},e);return r.rotation.x=Math.PI/2,r.parent=n,this._CreateLightLines(5,e).parent=n,n.scaling.scaleInPlace(t._Scale),n.rotation.x=Math.PI/2,n},t._CreateSpotLightMesh=function(e){var n=new Ne.a("spotLight",e);zr.a.CreateSphere(n.name,{segments:10,diameter:1},e).parent=n;var r=dh.CreateHemisphere(n.name,{segments:10,diameter:2},e);return r.parent=n,r.rotation.x=-Math.PI/2,this._CreateLightLines(2,e).parent=n,n.scaling.scaleInPlace(t._Scale),n.rotation.x=Math.PI/2,n},t._CreateDirectionalLightMesh=function(e){var n=new Ne.a("directionalLight",e),r=new Ne.a(n.name,e);r.parent=n,zr.a.CreateSphere(n.name,{diameter:1.2,segments:10},e).parent=r;var o=Ne.a.CreateCylinder(n.name,6,.3,.3,6,1,e);o.parent=r,(u=o.clone(n.name)).scaling.y=.5,u.position.x+=1.25,(f=o.clone(n.name)).scaling.y=.5,f.position.x+=-1.25;var u,f,v=Ne.a.CreateCylinder(n.name,1,0,.6,6,1,e);return v.position.y+=3,v.parent=r,(u=v.clone(n.name)).position.y=1.5,u.position.x+=1.25,(f=v.clone(n.name)).position.y=1.5,f.position.x+=-1.25,r.scaling.scaleInPlace(t._Scale),r.rotation.z=Math.PI/2,r.rotation.y=Math.PI/2,n},t._Scale=.007,t._CreateLightLines=function(e,n){var r=new Ne.a("root",n);r.rotation.x=Math.PI/2;var o=new Ne.a("linePivot",n);o.parent=r;var u=Ne.a.CreateCylinder("line",2,.2,.3,6,1,n);if(u.position.y=u.scaling.y/2+1.2,u.parent=o,e<2)return o;for(var f=0;f<4;f++)(v=o.clone("lineParentClone")).rotation.z=Math.PI/4,v.rotation.y=Math.PI/2+Math.PI/2*f,v.getChildMeshes()[0].scaling.y=.5,v.getChildMeshes()[0].scaling.x=v.getChildMeshes()[0].scaling.z=.8,v.getChildMeshes()[0].position.y=v.getChildMeshes()[0].scaling.y/2+1.2;if(e<3)return r;for(f=0;f<4;f++)(v=o.clone("linePivotClone")).rotation.z=Math.PI/2,v.rotation.y=Math.PI/2*f;if(e<4)return r;for(f=0;f<4;f++){var v;(v=o.clone("linePivotClone")).rotation.z=Math.PI+Math.PI/4,v.rotation.y=Math.PI/2+Math.PI/2*f,v.getChildMeshes()[0].scaling.y=.5,v.getChildMeshes()[0].scaling.x=v.getChildMeshes()[0].scaling.z=.8,v.getChildMeshes()[0].position.y=v.getChildMeshes()[0].scaling.y/2+1.2}return e<5||((v=o.clone("linePivotClone")).rotation.z=Math.PI),r},t}(jr.a),qp=function(){function i(t,e){t===void 0&&(t=d.e.Zero()),e===void 0&&(e=d.e.Up()),this.position=t,this.normal=e}return i.prototype.clone=function(){return new i(this.position.clone(),this.normal.clone())},i}(),UI=function(){function i(t,e,n){t===void 0&&(t=d.e.Zero()),e===void 0&&(e=d.e.Up()),n===void 0&&(n=d.d.Zero()),this.position=t,this.normal=e,this.uv=n}return i.prototype.clone=function(){return new i(this.position.clone(),this.normal.clone(),this.uv.clone())},i}(),VI=function(i){function t(e){e===void 0&&(e=Ir.a.DefaultUtilityLayer);var n=i.call(this,e)||this;return n._pointerObserver=null,n.onClickedObservable=new S.c,n._camera=null,n._invProjection=new d.a,n._material=new on.a("cameraGizmoMaterial",n.gizmoLayer.utilityLayerScene),n._material.diffuseColor=new M.a(.5,.5,.5),n._material.specularColor=new M.a(.1,.1,.1),n._pointerObserver=e.utilityLayerScene.onPointerObservable.add(function(r){n._camera&&(n._isHovered=!(!r.pickInfo||n._rootMesh.getChildMeshes().indexOf(r.pickInfo.pickedMesh)==-1),n._isHovered&&r.event.button===0&&n.onClickedObservable.notifyObservers(n._camera))},Ot.a.POINTERDOWN),n}return Object(p.d)(t,i),Object.defineProperty(t.prototype,"displayFrustum",{get:function(){return this._cameraLinesMesh.isEnabled()},set:function(e){this._cameraLinesMesh.setEnabled(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"camera",{get:function(){return this._camera},set:function(e){var n=this;if(this._camera=e,this.attachedNode=e,e){this._cameraMesh&&this._cameraMesh.dispose(),this._cameraLinesMesh&&this._cameraLinesMesh.dispose(),this._cameraMesh=t._CreateCameraMesh(this.gizmoLayer.utilityLayerScene),this._cameraLinesMesh=t._CreateCameraFrustum(this.gizmoLayer.utilityLayerScene),this._cameraMesh.getChildMeshes(!1).forEach(function(o){o.material=n._material}),this._cameraMesh.parent=this._rootMesh,this._cameraLinesMesh.parent=this._rootMesh,this.gizmoLayer.utilityLayerScene.activeCamera&&this.gizmoLayer.utilityLayerScene.activeCamera.maxZ<1.5*e.maxZ&&(this.gizmoLayer.utilityLayerScene.activeCamera.maxZ=1.5*e.maxZ),this.attachedNode.reservedDataStore||(this.attachedNode.reservedDataStore={}),this.attachedNode.reservedDataStore.cameraGizmo=this;var r=this.gizmoLayer._getSharedGizmoLight();r.includedOnlyMeshes=r.includedOnlyMeshes.concat(this._cameraMesh.getChildMeshes(!1)),this._update()}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"material",{get:function(){return this._material},enumerable:!1,configurable:!0}),t.prototype._update=function(){i.prototype._update.call(this),this._camera&&(this._camera.getProjectionMatrix().invertToRef(this._invProjection),this._cameraLinesMesh.setPivotMatrix(this._invProjection,!1),this._cameraLinesMesh.scaling.x=1/this._rootMesh.scaling.x,this._cameraLinesMesh.scaling.y=1/this._rootMesh.scaling.y,this._cameraLinesMesh.scaling.z=1/this._rootMesh.scaling.z,this._cameraMesh.parent=null,this._cameraMesh.rotation.y=.5*Math.PI*(this._camera.getScene().useRightHandedSystem?1:-1),this._cameraMesh.parent=this._rootMesh)},t.prototype.dispose=function(){this.onClickedObservable.clear(),this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this._cameraMesh&&this._cameraMesh.dispose(),this._cameraLinesMesh&&this._cameraLinesMesh.dispose(),this._material.dispose(),i.prototype.dispose.call(this)},t._CreateCameraMesh=function(e){var n=new Ne.a("rootCameraGizmo",e),r=new Ne.a(n.name,e);r.parent=n,bs.a.CreateBox(n.name,{width:1,height:.8,depth:.5},e).parent=r;var o=zi.a.CreateCylinder(n.name,{height:.5,diameterTop:.8,diameterBottom:.8},e);o.parent=r,o.position.y=.3,o.position.x=-.6,o.rotation.x=.5*Math.PI;var u=zi.a.CreateCylinder(n.name,{height:.5,diameterTop:.6,diameterBottom:.6},e);u.parent=r,u.position.y=.5,u.position.x=.4,u.rotation.x=.5*Math.PI;var f=zi.a.CreateCylinder(n.name,{height:.5,diameterTop:.5,diameterBottom:.5},e);return f.parent=r,f.position.y=0,f.position.x=.6,f.rotation.z=.5*Math.PI,n.scaling.scaleInPlace(t._Scale),r.position.x=-.9,n},t._CreateCameraFrustum=function(e){var n=new Ne.a("rootCameraGizmo",e),r=new Ne.a(n.name,e);r.parent=n;for(var o=0;o<4;o+=2)for(var u=0;u<4;u+=2){var f;(f=Jn.a.CreateLines("lines",{points:[new d.e(-1+u,-1+o,-1),new d.e(-1+u,-1+o,1)]},e)).parent=r,f.alwaysSelectAsActiveMesh=!0,f.isPickable=!1,(f=Jn.a.CreateLines("lines",{points:[new d.e(-1,-1+u,-1+o),new d.e(1,-1+u,-1+o)]},e)).parent=r,f.alwaysSelectAsActiveMesh=!0,f.isPickable=!1,(f=Jn.a.CreateLines("lines",{points:[new d.e(-1+u,-1,-1+o),new d.e(-1+u,1,-1+o)]},e)).parent=r,f.alwaysSelectAsActiveMesh=!0,f.isPickable=!1}return n},t._Scale=.05,t}(jr.a);Ye.a.IncludesShadersStore.kernelBlurVaryingDeclaration="varying vec2 sampleCoord{X};";var kI=`vec4 pack(float depth)
{
const vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);
const vec4 bit_mask=vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);
vec4 res=fract(depth*bit_shift);
res-=res.xxyz*bit_mask;
return res;
}
float unpack(vec4 color)
{
const vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);
return dot(color,bit_shift);
}`;Ye.a.IncludesShadersStore.packingFunctions=kI;var jI=`#ifdef DOF
factor=sampleCoC(sampleCoord{X});
computedWeight=KERNEL_WEIGHT{X}*factor;
sumOfWeights+=computedWeight;
#else
computedWeight=KERNEL_WEIGHT{X};
#endif
#ifdef PACKEDFLOAT
blend+=unpack(texture2D(textureSampler,sampleCoord{X}))*computedWeight;
#else
blend+=texture2D(textureSampler,sampleCoord{X})*computedWeight;
#endif`;Ye.a.IncludesShadersStore.kernelBlurFragment=jI;var zI=`#ifdef DOF
factor=sampleCoC(sampleCenter+delta*KERNEL_DEP_OFFSET{X});
computedWeight=KERNEL_DEP_WEIGHT{X}*factor;
sumOfWeights+=computedWeight;
#else
computedWeight=KERNEL_DEP_WEIGHT{X};
#endif
#ifdef PACKEDFLOAT
blend+=unpack(texture2D(textureSampler,sampleCenter+delta*KERNEL_DEP_OFFSET{X}))*computedWeight;
#else
blend+=texture2D(textureSampler,sampleCenter+delta*KERNEL_DEP_OFFSET{X})*computedWeight;
#endif`;Ye.a.IncludesShadersStore.kernelBlurFragment2=zI;var GI=`
uniform sampler2D textureSampler;
uniform vec2 delta;

varying vec2 sampleCenter;
#ifdef DOF
uniform sampler2D circleOfConfusionSampler;
uniform vec2 cameraMinMaxZ;
float sampleDistance(const in vec2 offset) {
float depth=texture2D(circleOfConfusionSampler,offset).g;
return cameraMinMaxZ.x+(cameraMinMaxZ.y-cameraMinMaxZ.x)*depth;
}
float sampleCoC(const in vec2 offset) {
float coc=texture2D(circleOfConfusionSampler,offset).r;
return coc;
}
#endif
#include<kernelBlurVaryingDeclaration>[0..varyingCount]
#ifdef PACKEDFLOAT
#include<packingFunctions>
#endif
void main(void)
{
float computedWeight=0.0;
#ifdef PACKEDFLOAT
float blend=0.;
#else
vec4 blend=vec4(0.);
#endif
#ifdef DOF
float sumOfWeights=CENTER_WEIGHT;
float factor=0.0;

#ifdef PACKEDFLOAT
blend+=unpack(texture2D(textureSampler,sampleCenter))*CENTER_WEIGHT;
#else
blend+=texture2D(textureSampler,sampleCenter)*CENTER_WEIGHT;
#endif
#endif
#include<kernelBlurFragment>[0..varyingCount]
#include<kernelBlurFragment2>[0..depCount]
#ifdef PACKEDFLOAT
gl_FragColor=pack(blend);
#else
gl_FragColor=blend;
#endif
#ifdef DOF
gl_FragColor/=sumOfWeights;
#endif
}`;Ye.a.ShadersStore.kernelBlurPixelShader=GI,Ye.a.IncludesShadersStore.kernelBlurVertex="sampleCoord{X}=sampleCenter+delta*KERNEL_OFFSET{X};";var HI=`
attribute vec2 position;

uniform vec2 delta;

varying vec2 sampleCenter;
#include<kernelBlurVaryingDeclaration>[0..varyingCount]
const vec2 madd=vec2(0.5,0.5);
void main(void) {
sampleCenter=(position*madd+madd);
#include<kernelBlurVertex>[0..varyingCount]
gl_Position=vec4(position,0.0,1.0);
}`;Ye.a.ShadersStore.kernelBlurVertexShader=HI;var ar=function(i){function t(e,n,r,o,u,f,v,y,D,w,F){f===void 0&&(f=ke.a.BILINEAR_SAMPLINGMODE),D===void 0&&(D=g.a.TEXTURETYPE_UNSIGNED_INT),w===void 0&&(w=""),F===void 0&&(F=!1);var z=i.call(this,e,"kernelBlur",["delta","direction","cameraMinMaxZ"],["circleOfConfusionSampler"],o,u,f,v,y,null,D,"kernelBlur",{varyingCount:0,depCount:0},!0)||this;return z.blockCompilation=F,z._packedFloat=!1,z._staticDefines="",z._staticDefines=w,z.direction=n,z.onApplyObservable.add(function(k){z._outputTexture?k.setFloat2("delta",1/z._outputTexture.width*z.direction.x,1/z._outputTexture.height*z.direction.y):k.setFloat2("delta",1/z.width*z.direction.x,1/z.height*z.direction.y)}),z.kernel=r,z}return Object(p.d)(t,i),Object.defineProperty(t.prototype,"kernel",{get:function(){return this._idealKernel},set:function(e){this._idealKernel!==e&&(e=Math.max(e,1),this._idealKernel=e,this._kernel=this._nearestBestKernel(e),this.blockCompilation||this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"packedFloat",{get:function(){return this._packedFloat},set:function(e){this._packedFloat!==e&&(this._packedFloat=e,this.blockCompilation||this._updateParameters())},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"BlurPostProcess"},t.prototype.updateEffect=function(e,n,r,o,u,f){this._updateParameters(u,f)},t.prototype._updateParameters=function(e,n){for(var r=this._kernel,o=(r-1)/2,u=[],f=[],v=0,y=0;y<r;y++){var D=y/(r-1),w=this._gaussianWeight(2*D-1);u[y]=y-o,f[y]=w,v+=w}for(y=0;y<f.length;y++)f[y]/=v;var F=[],z=[],k=[];for(y=0;y<=o;y+=2){var K=Math.min(y+1,Math.floor(o));if(y===K)k.push({o:u[y],w:f[y]});else{var oe=K===o,ae=f[y]+f[K]*(oe?.5:1),ue=u[y]+1/(1+f[y]/f[K]);ue===0?(k.push({o:u[y],w:f[y]}),k.push({o:u[y+1],w:f[y+1]})):(k.push({o:ue,w:ae}),k.push({o:-ue,w:ae}))}}for(y=0;y<k.length;y++)z[y]=k[y].o,F[y]=k[y].w;u=z,f=F;var de=this.getEngine().getCaps().maxVaryingVectors,me=Math.max(de,0)-1,ye=Math.min(u.length,me),Ee="";for(Ee+=this._staticDefines,this._staticDefines.indexOf("DOF")!=-1&&(Ee+="#define CENTER_WEIGHT "+this._glslFloat(f[ye-1])+`\r
`,ye--),y=0;y<ye;y++)Ee+="#define KERNEL_OFFSET"+y+" "+this._glslFloat(u[y])+`\r
`,Ee+="#define KERNEL_WEIGHT"+y+" "+this._glslFloat(f[y])+`\r
`;var Ae=0;for(y=me;y<u.length;y++)Ee+="#define KERNEL_DEP_OFFSET"+Ae+" "+this._glslFloat(u[y])+`\r
`,Ee+="#define KERNEL_DEP_WEIGHT"+Ae+" "+this._glslFloat(f[y])+`\r
`,Ae++;this.packedFloat&&(Ee+="#define PACKEDFLOAT 1"),this.blockCompilation=!1,i.prototype.updateEffect.call(this,Ee,null,null,{varyingCount:ye,depCount:Ae},e,n)},t.prototype._nearestBestKernel=function(e){for(var n=Math.round(e),r=0,o=[n,n-1,n+1,n-2,n+2];r<o.length;r++){var u=o[r];if(u%2!=0&&Math.floor(u/2)%2==0&&u>0)return Math.max(u,3)}return Math.max(n,3)},t.prototype._gaussianWeight=function(e){var n=-e*e/(1/3*2*(1/3));return 1/(Math.sqrt(2*Math.PI)*(1/3))*Math.exp(n)},t.prototype._glslFloat=function(e,n){return n===void 0&&(n=8),e.toFixed(n).replace(/0+$/,"")},t._Parse=function(e,n,r,o){return B.a.Parse(function(){return new t(e.name,e.direction,e.kernel,e.options,n,e.renderTargetSamplingMode,r.getEngine(),e.reusable,e.textureType,void 0,!1)},e,r,o)},Object(p.c)([Object(B.c)("kernel")],t.prototype,"_kernel",void 0),Object(p.c)([Object(B.c)("packedFloat")],t.prototype,"_packedFloat",void 0),Object(p.c)([Object(B.n)()],t.prototype,"direction",void 0),t}(St);C.a.RegisteredTypes["BABYLON.BlurPostProcess"]=ar;var Zp=function(i){function t(e,n,r,o,u,f,v){u===void 0&&(u=g.a.TEXTURETYPE_UNSIGNED_INT),f===void 0&&(f=ke.a.BILINEAR_SAMPLINGMODE),v===void 0&&(v=!0);var y=i.call(this,e,n,r,o,!0,u,!1,f,v)||this;return y.scene=r,y.mirrorPlane=new _s.a(0,1,0,1),y._transformMatrix=d.a.Zero(),y._mirrorMatrix=d.a.Zero(),y._adaptiveBlurKernel=0,y._blurKernelX=0,y._blurKernelY=0,y._blurRatio=1,y.ignoreCameraViewport=!0,y._updateGammaSpace(),y._imageProcessingConfigChangeObserver=r.imageProcessingConfiguration.onUpdateParameters.add(function(){y._updateGammaSpace}),y.onBeforeRenderObservable.add(function(){d.a.ReflectionToRef(y.mirrorPlane,y._mirrorMatrix),y._savedViewMatrix=r.getViewMatrix(),y._mirrorMatrix.multiplyToRef(y._savedViewMatrix,y._transformMatrix),r.setTransformMatrix(y._transformMatrix,r.getProjectionMatrix()),r.clipPlane=y.mirrorPlane,r.getEngine().cullBackFaces=!1,r._mirroredCameraPosition=d.e.TransformCoordinates(r.activeCamera.globalPosition,y._mirrorMatrix)}),y.onAfterRenderObservable.add(function(){r.setTransformMatrix(y._savedViewMatrix,r.getProjectionMatrix()),r.getEngine().cullBackFaces=!0,r._mirroredCameraPosition=null,r.clipPlane=null}),y}return Object(p.d)(t,i),Object.defineProperty(t.prototype,"blurRatio",{get:function(){return this._blurRatio},set:function(e){this._blurRatio!==e&&(this._blurRatio=e,this._preparePostProcesses())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"adaptiveBlurKernel",{set:function(e){this._adaptiveBlurKernel=e,this._autoComputeBlurKernel()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"blurKernel",{set:function(e){this.blurKernelX=e,this.blurKernelY=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"blurKernelX",{get:function(){return this._blurKernelX},set:function(e){this._blurKernelX!==e&&(this._blurKernelX=e,this._preparePostProcesses())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"blurKernelY",{get:function(){return this._blurKernelY},set:function(e){this._blurKernelY!==e&&(this._blurKernelY=e,this._preparePostProcesses())},enumerable:!1,configurable:!0}),t.prototype._autoComputeBlurKernel=function(){var e=this.getScene().getEngine(),n=this.getRenderWidth()/e.getRenderWidth(),r=this.getRenderHeight()/e.getRenderHeight();this.blurKernelX=this._adaptiveBlurKernel*n,this.blurKernelY=this._adaptiveBlurKernel*r},t.prototype._onRatioRescale=function(){this._sizeRatio&&(this.resize(this._initialSizeParameter),this._adaptiveBlurKernel||this._preparePostProcesses()),this._adaptiveBlurKernel&&this._autoComputeBlurKernel()},t.prototype._updateGammaSpace=function(){this.gammaSpace=!this.scene.imageProcessingConfiguration.isEnabled||!this.scene.imageProcessingConfiguration.applyByPostProcess},t.prototype._preparePostProcesses=function(){if(this.clearPostProcesses(!0),this._blurKernelX&&this._blurKernelY){var e=this.getScene().getEngine(),n=e.getCaps().textureFloatRender?g.a.TEXTURETYPE_FLOAT:g.a.TEXTURETYPE_HALF_FLOAT;this._blurX=new ar("horizontal blur",new d.d(1,0),this._blurKernelX,this._blurRatio,null,ke.a.BILINEAR_SAMPLINGMODE,e,!1,n),this._blurX.autoClear=!1,this._blurRatio===1&&this.samples<2&&this._texture?this._blurX.inputTexture=this._texture:this._blurX.alwaysForcePOT=!0,this._blurY=new ar("vertical blur",new d.d(0,1),this._blurKernelY,this._blurRatio,null,ke.a.BILINEAR_SAMPLINGMODE,e,!1,n),this._blurY.autoClear=!1,this._blurY.alwaysForcePOT=this._blurRatio!==1,this.addPostProcess(this._blurX),this.addPostProcess(this._blurY)}else this._blurY&&(this.removePostProcess(this._blurY),this._blurY.dispose(),this._blurY=null),this._blurX&&(this.removePostProcess(this._blurX),this._blurX.dispose(),this._blurX=null)},t.prototype.clone=function(){var e=this.getScene();if(!e)return this;var n=this.getSize(),r=new t(this.name,n.width,e,this._renderTargetOptions.generateMipMaps,this._renderTargetOptions.type,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer);return r.hasAlpha=this.hasAlpha,r.level=this.level,r.mirrorPlane=this.mirrorPlane.clone(),this.renderList&&(r.renderList=this.renderList.slice(0)),r},t.prototype.serialize=function(){if(!this.name)return null;var e=i.prototype.serialize.call(this);return e.mirrorPlane=this.mirrorPlane.asArray(),e},t.prototype.dispose=function(){i.prototype.dispose.call(this),this.scene.imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingConfigChangeObserver)},t}(qn);ke.a._CreateMirror=function(i,t,e,n){return new Zp(i,t,e,n)};var ui=c(34),Ei=function(i){function t(e,n,r,o,u,f,v,y,D,w,F,z,k,K){var oe;r===void 0&&(r=null),o===void 0&&(o=!1),u===void 0&&(u=null),f===void 0&&(f=null),v===void 0&&(v=null),y===void 0&&(y=g.a.TEXTUREFORMAT_RGBA),D===void 0&&(D=!1),w===void 0&&(w=null),F===void 0&&(F=!1),z===void 0&&(z=.8),k===void 0&&(k=0);var ae=i.call(this,n)||this;if(ae.onLoadObservable=new S.c,ae.boundingBoxPosition=d.e.Zero(),ae._rotationY=0,ae._files=null,ae._forcedExtension=null,ae._extensions=null,ae.name=e,ae.url=e,ae._noMipmap=o,ae.hasAlpha=!1,ae._format=y,ae.isCube=!0,ae._textureMatrix=d.a.Identity(),ae._createPolynomials=F,ae.coordinatesMode=ke.a.CUBIC_MODE,ae._extensions=r,ae._files=u,ae._forcedExtension=w,ae._loaderOptions=K,!e&&!u)return ae;var ue=e.lastIndexOf("."),de=w||(ue>-1?e.substring(ue).toLowerCase():""),me=de===".dds",ye=de===".env";if(ye?(ae.gammaSpace=!1,ae._prefiltered=!1,ae.anisotropicFilteringLevel=1):(ae._prefiltered=D,D&&(ae.gammaSpace=!1,ae.anisotropicFilteringLevel=1)),ae._texture=ae._getFromCache(e,o),!u&&(ye||me||r||(r=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),u=[],r))for(var Ee=0;Ee<r.length;Ee++)u.push(e+r[Ee]);ae._files=u;var Ae=function(){ae.onLoadObservable.notifyObservers(ae),f&&f()};if(ae._texture)ae._texture.isReady?et.b.SetImmediate(function(){return Ae()}):ae._texture.onLoadedObservable.add(function(){return Ae()});else{var Ie=ae.getScene();(Ie==null?void 0:Ie.useDelayedTextureLoading)?ae.delayLoadState=g.a.DELAYLOADSTATE_NOTLOADED:(ae._texture=D?ae._getEngine().createPrefilteredCubeTexture(e,Ie,z,k,f,v,y,w,ae._createPolynomials):ae._getEngine().createCubeTexture(e,Ie,u,o,f,v,ae._format,w,!1,z,k,null,K),(oe=ae._texture)===null||oe===void 0||oe.onLoadedObservable.add(function(){return ae.onLoadObservable.notifyObservers(ae)}))}return ae}return Object(p.d)(t,i),Object.defineProperty(t.prototype,"boundingBoxSize",{get:function(){return this._boundingBoxSize},set:function(e){if(!this._boundingBoxSize||!this._boundingBoxSize.equals(e)){this._boundingBoxSize=e;var n=this.getScene();n&&n.markAllMaterialsAsDirty(g.a.MATERIAL_TextureDirtyFlag)}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rotationY",{get:function(){return this._rotationY},set:function(e){this._rotationY=e,this.setReflectionTextureMatrix(d.a.RotationY(this._rotationY))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"noMipmap",{get:function(){return this._noMipmap},enumerable:!1,configurable:!0}),t.CreateFromImages=function(e,n,r){var o="";return e.forEach(function(u){return o+=u}),new t(o,n,null,r,e)},t.CreateFromPrefilteredData=function(e,n,r,o){r===void 0&&(r=null),o===void 0&&(o=!0);var u=n.useDelayedTextureLoading;n.useDelayedTextureLoading=!1;var f=new t(e,n,null,!1,null,null,null,void 0,!0,r,o);return n.useDelayedTextureLoading=u,f},t.prototype.getClassName=function(){return"CubeTexture"},t.prototype.updateURL=function(e,n,r,o){var u;o===void 0&&(o=!1),this.url&&(this.releaseInternalTexture(),(u=this.getScene())===null||u===void 0||u.markAllMaterialsAsDirty(g.a.MATERIAL_TextureDirtyFlag)),this.name&&!ui.a.StartsWith(this.name,"data:")||(this.name=e),this.url=e,this.delayLoadState=g.a.DELAYLOADSTATE_NOTLOADED,this._prefiltered=o,this._prefiltered&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1),this._forcedExtension=n||null,r&&(this._delayedOnLoad=r),this.delayLoad(n)},t.prototype.delayLoad=function(e){var n,r=this;if(this.delayLoadState===g.a.DELAYLOADSTATE_NOTLOADED&&(this.delayLoadState=g.a.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,this._noMipmap),!this._texture)){var o=this.getScene();this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,o,.8,0,this._delayedOnLoad,void 0,this._format,e,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,o,this._files,this._noMipmap,this._delayedOnLoad,null,this._format,e,!1,0,0,null,this._loaderOptions),(n=this._texture)===null||n===void 0||n.onLoadedObservable.add(function(){return r.onLoadObservable.notifyObservers(r)})}},t.prototype.getReflectionTextureMatrix=function(){return this._textureMatrix},t.prototype.setReflectionTextureMatrix=function(e){var n,r=this;e.updateFlag!==this._textureMatrix.updateFlag&&(e.isIdentity()!==this._textureMatrix.isIdentity()&&((n=this.getScene())===null||n===void 0||n.markAllMaterialsAsDirty(g.a.MATERIAL_TextureDirtyFlag,function(o){return o.getActiveTextures().indexOf(r)!==-1})),this._textureMatrix=e)},t.Parse=function(e,n,r){var o=B.a.Parse(function(){var y=!1;return e.prefiltered&&(y=e.prefiltered),new t(r+e.name,n,e.extensions,!1,e.files||null,null,null,void 0,y,e.forcedExtension)},e,n);if(e.boundingBoxPosition&&(o.boundingBoxPosition=d.e.FromArray(e.boundingBoxPosition)),e.boundingBoxSize&&(o.boundingBoxSize=d.e.FromArray(e.boundingBoxSize)),e.animations)for(var u=0;u<e.animations.length;u++){var f=e.animations[u],v=C.a.GetClass("BABYLON.Animation");v&&o.animations.push(v.Parse(f))}return o},t.prototype.clone=function(){var e=this,n=0,r=B.a.Clone(function(){var o=new t(e.url,e.getScene()||e._getEngine(),e._extensions,e._noMipmap,e._files);return n=o.uniqueId,o},this);return r.uniqueId=n,r},Object(p.c)([Object(B.c)()],t.prototype,"url",void 0),Object(p.c)([Object(B.c)("rotationY")],t.prototype,"rotationY",null),Object(p.c)([Object(B.c)("files")],t.prototype,"_files",void 0),Object(p.c)([Object(B.c)("forcedExtension")],t.prototype,"_forcedExtension",void 0),Object(p.c)([Object(B.c)("extensions")],t.prototype,"_extensions",void 0),Object(p.c)([Object(B.j)("textureMatrix")],t.prototype,"_textureMatrix",void 0),t}($r.a);ke.a._CubeTextureParser=Ei.Parse,C.a.RegisteredTypes["BABYLON.CubeTexture"]=Ei;var lt=c(15),fh=c(76),ph=c(87),bt=c(19),WI=` uniform vec4 vPrimaryColor;
#ifdef USEHIGHLIGHTANDSHADOWCOLORS
uniform vec4 vPrimaryColorShadow;
#endif
uniform float shadowLevel;
uniform float alpha;
#ifdef DIFFUSE
uniform vec2 vDiffuseInfos;
#endif
#ifdef REFLECTION
uniform vec2 vReflectionInfos;
uniform mat4 reflectionMatrix;
uniform vec3 vReflectionMicrosurfaceInfos;
#endif
#if defined(REFLECTIONFRESNEL) || defined(OPACITYFRESNEL)
uniform vec3 vBackgroundCenter;
#endif
#ifdef REFLECTIONFRESNEL
uniform vec4 vReflectionControl;
#endif
#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(REFRACTION)
uniform mat4 view;
#endif`;Ye.a.IncludesShadersStore.backgroundFragmentDeclaration=WI;var XI=`layout(std140,column_major) uniform;
uniform Material
{
uniform vec4 vPrimaryColor;
uniform vec4 vPrimaryColorShadow;
uniform vec2 vDiffuseInfos;
uniform vec2 vReflectionInfos;
uniform mat4 diffuseMatrix;
uniform mat4 reflectionMatrix;
uniform vec3 vReflectionMicrosurfaceInfos;
uniform float fFovMultiplier;
uniform float pointSize;
uniform float shadowLevel;
uniform float alpha;
#if defined(REFLECTIONFRESNEL) || defined(OPACITYFRESNEL)
uniform vec3 vBackgroundCenter;
#endif
#ifdef REFLECTIONFRESNEL
uniform vec4 vReflectionControl;
#endif
};
uniform Scene {
mat4 viewProjection;
#ifdef MULTIVIEW
mat4 viewProjectionR;
#endif
mat4 view;
};`;Ye.a.IncludesShadersStore.backgroundUboDeclaration=XI,c(131),c(106),c(107),c(154),c(130),c(115),c(125),c(110),c(135),c(136);var YI=`#ifdef TEXTURELODSUPPORT
#extension GL_EXT_shader_texture_lod : enable
#endif
precision highp float;
#include<__decl__backgroundFragment>
#define RECIPROCAL_PI2 0.15915494

uniform vec3 vEyePosition;

varying vec3 vPositionW;
#ifdef MAINUV1
varying vec2 vMainUV1;
#endif
#ifdef MAINUV2
varying vec2 vMainUV2;
#endif
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef DIFFUSE
#if DIFFUSEDIRECTUV == 1
#define vDiffuseUV vMainUV1
#elif DIFFUSEDIRECTUV == 2
#define vDiffuseUV vMainUV2
#else
varying vec2 vDiffuseUV;
#endif
uniform sampler2D diffuseSampler;
#endif

#ifdef REFLECTION
#ifdef REFLECTIONMAP_3D
#define sampleReflection(s,c) textureCube(s,c)
uniform samplerCube reflectionSampler;
#ifdef TEXTURELODSUPPORT
#define sampleReflectionLod(s,c,l) textureCubeLodEXT(s,c,l)
#else
uniform samplerCube reflectionSamplerLow;
uniform samplerCube reflectionSamplerHigh;
#endif
#else
#define sampleReflection(s,c) texture2D(s,c)
uniform sampler2D reflectionSampler;
#ifdef TEXTURELODSUPPORT
#define sampleReflectionLod(s,c,l) texture2DLodEXT(s,c,l)
#else
uniform samplerCube reflectionSamplerLow;
uniform samplerCube reflectionSamplerHigh;
#endif
#endif
#ifdef REFLECTIONMAP_SKYBOX
varying vec3 vPositionUVW;
#else
#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)
varying vec3 vDirectionW;
#endif
#endif
#include<reflectionFunction>
#endif

#ifndef FROMLINEARSPACE
#define FROMLINEARSPACE;
#endif

#ifndef SHADOWONLY
#define SHADOWONLY;
#endif
#include<imageProcessingDeclaration>

#include<__decl__lightFragment>[0..maxSimultaneousLights]
#include<helperFunctions>
#include<lightsFragmentFunctions>
#include<shadowsFragmentFunctions>
#include<imageProcessingFunctions>
#include<clipPlaneFragmentDeclaration>

#include<fogFragmentDeclaration>
#ifdef REFLECTIONFRESNEL
#define FRESNEL_MAXIMUM_ON_ROUGH 0.25
vec3 fresnelSchlickEnvironmentGGX(float VdotN,vec3 reflectance0,vec3 reflectance90,float smoothness)
{

float weight=mix(FRESNEL_MAXIMUM_ON_ROUGH,1.0,smoothness);
return reflectance0+weight*(reflectance90-reflectance0)*pow5(saturate(1.0-VdotN));
}
#endif
void main(void) {
#include<clipPlaneFragment>
vec3 viewDirectionW=normalize(vEyePosition-vPositionW);

#ifdef NORMAL
vec3 normalW=normalize(vNormalW);
#else
vec3 normalW=vec3(0.0,1.0,0.0);
#endif

float shadow=1.;
float globalShadow=0.;
float shadowLightCount=0.;
#include<lightFragment>[0..maxSimultaneousLights]
#ifdef SHADOWINUSE
globalShadow/=shadowLightCount;
#else
globalShadow=1.0;
#endif
#ifndef BACKMAT_SHADOWONLY

vec4 reflectionColor=vec4(1.,1.,1.,1.);
#ifdef REFLECTION
vec3 reflectionVector=computeReflectionCoords(vec4(vPositionW,1.0),normalW);
#ifdef REFLECTIONMAP_OPPOSITEZ
reflectionVector.z*=-1.0;
#endif

#ifdef REFLECTIONMAP_3D
vec3 reflectionCoords=reflectionVector;
#else
vec2 reflectionCoords=reflectionVector.xy;
#ifdef REFLECTIONMAP_PROJECTION
reflectionCoords/=reflectionVector.z;
#endif
reflectionCoords.y=1.0-reflectionCoords.y;
#endif
#ifdef REFLECTIONBLUR
float reflectionLOD=vReflectionInfos.y;
#ifdef TEXTURELODSUPPORT

reflectionLOD=reflectionLOD*log2(vReflectionMicrosurfaceInfos.x)*vReflectionMicrosurfaceInfos.y+vReflectionMicrosurfaceInfos.z;
reflectionColor=sampleReflectionLod(reflectionSampler,reflectionCoords,reflectionLOD);
#else
float lodReflectionNormalized=saturate(reflectionLOD);
float lodReflectionNormalizedDoubled=lodReflectionNormalized*2.0;
vec4 reflectionSpecularMid=sampleReflection(reflectionSampler,reflectionCoords);
if(lodReflectionNormalizedDoubled<1.0){
reflectionColor=mix(
sampleReflection(reflectionSamplerHigh,reflectionCoords),
reflectionSpecularMid,
lodReflectionNormalizedDoubled
);
} else {
reflectionColor=mix(
reflectionSpecularMid,
sampleReflection(reflectionSamplerLow,reflectionCoords),
lodReflectionNormalizedDoubled-1.0
);
}
#endif
#else
vec4 reflectionSample=sampleReflection(reflectionSampler,reflectionCoords);
reflectionColor=reflectionSample;
#endif
#ifdef RGBDREFLECTION
reflectionColor.rgb=fromRGBD(reflectionColor);
#endif
#ifdef GAMMAREFLECTION
reflectionColor.rgb=toLinearSpace(reflectionColor.rgb);
#endif
#ifdef REFLECTIONBGR
reflectionColor.rgb=reflectionColor.bgr;
#endif

reflectionColor.rgb*=vReflectionInfos.x;
#endif

vec3 diffuseColor=vec3(1.,1.,1.);
float finalAlpha=alpha;
#ifdef DIFFUSE
vec4 diffuseMap=texture2D(diffuseSampler,vDiffuseUV);
#ifdef GAMMADIFFUSE
diffuseMap.rgb=toLinearSpace(diffuseMap.rgb);
#endif

diffuseMap.rgb*=vDiffuseInfos.y;
#ifdef DIFFUSEHASALPHA
finalAlpha*=diffuseMap.a;
#endif
diffuseColor=diffuseMap.rgb;
#endif

#ifdef REFLECTIONFRESNEL
vec3 colorBase=diffuseColor;
#else
vec3 colorBase=reflectionColor.rgb*diffuseColor;
#endif
colorBase=max(colorBase,0.0);

#ifdef USERGBCOLOR
vec3 finalColor=colorBase;
#else
#ifdef USEHIGHLIGHTANDSHADOWCOLORS
vec3 mainColor=mix(vPrimaryColorShadow.rgb,vPrimaryColor.rgb,colorBase);
#else
vec3 mainColor=vPrimaryColor.rgb;
#endif
vec3 finalColor=colorBase*mainColor;
#endif

#ifdef REFLECTIONFRESNEL
vec3 reflectionAmount=vReflectionControl.xxx;
vec3 reflectionReflectance0=vReflectionControl.yyy;
vec3 reflectionReflectance90=vReflectionControl.zzz;
float VdotN=dot(normalize(vEyePosition),normalW);
vec3 planarReflectionFresnel=fresnelSchlickEnvironmentGGX(saturate(VdotN),reflectionReflectance0,reflectionReflectance90,1.0);
reflectionAmount*=planarReflectionFresnel;
#ifdef REFLECTIONFALLOFF
float reflectionDistanceFalloff=1.0-saturate(length(vPositionW.xyz-vBackgroundCenter)*vReflectionControl.w);
reflectionDistanceFalloff*=reflectionDistanceFalloff;
reflectionAmount*=reflectionDistanceFalloff;
#endif
finalColor=mix(finalColor,reflectionColor.rgb,saturate(reflectionAmount));
#endif
#ifdef OPACITYFRESNEL
float viewAngleToFloor=dot(normalW,normalize(vEyePosition-vBackgroundCenter));

const float startAngle=0.1;
float fadeFactor=saturate(viewAngleToFloor/startAngle);
finalAlpha*=fadeFactor*fadeFactor;
#endif

#ifdef SHADOWINUSE
finalColor=mix(finalColor*shadowLevel,finalColor,globalShadow);
#endif

vec4 color=vec4(finalColor,finalAlpha);
#else
vec4 color=vec4(vPrimaryColor.rgb,(1.0-clamp(globalShadow,0.,1.))*alpha);
#endif
#include<fogFragment>
#ifdef IMAGEPROCESSINGPOSTPROCESS


color.rgb=clamp(color.rgb,0.,30.0);
#else

color=applyImageProcessing(color);
#endif
#ifdef PREMULTIPLYALPHA

color.rgb*=color.a;
#endif
#ifdef NOISE
color.rgb+=dither(vPositionW.xy,0.5);
color=max(color,0.0);
#endif
gl_FragColor=color;
}
`;Ye.a.ShadersStore.backgroundPixelShader=YI;var KI=`uniform mat4 view;
uniform mat4 viewProjection;
uniform float shadowLevel;
#ifdef DIFFUSE
uniform mat4 diffuseMatrix;
uniform vec2 vDiffuseInfos;
#endif
#ifdef REFLECTION
uniform vec2 vReflectionInfos;
uniform mat4 reflectionMatrix;
uniform vec3 vReflectionMicrosurfaceInfos;
uniform float fFovMultiplier;
#endif
#ifdef POINTSIZE
uniform float pointSize;
#endif`;Ye.a.IncludesShadersStore.backgroundVertexDeclaration=KI,c(78),c(79),c(117),c(137),c(80),c(81),c(111),c(157),c(138);var QI=`precision highp float;
#include<__decl__backgroundVertex>
#include<helperFunctions>

attribute vec3 position;
#ifdef NORMAL
attribute vec3 normal;
#endif
#include<bonesDeclaration>

#include<instancesDeclaration>

varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#ifdef MAINUV1
varying vec2 vMainUV1;
#endif
#ifdef MAINUV2
varying vec2 vMainUV2;
#endif
#if defined(DIFFUSE) && DIFFUSEDIRECTUV == 0
varying vec2 vDiffuseUV;
#endif
#include<clipPlaneVertexDeclaration>
#include<fogVertexDeclaration>
#include<__decl__lightFragment>[0..maxSimultaneousLights]
#ifdef REFLECTIONMAP_SKYBOX
varying vec3 vPositionUVW;
#endif
#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)
varying vec3 vDirectionW;
#endif
void main(void) {
#ifdef REFLECTIONMAP_SKYBOX
vPositionUVW=position;
#endif
#include<instancesVertex>
#include<bonesVertex>
#ifdef MULTIVIEW
if (gl_ViewID_OVR == 0u) {
gl_Position=viewProjection*finalWorld*vec4(position,1.0);
} else {
gl_Position=viewProjectionR*finalWorld*vec4(position,1.0);
}
#else
gl_Position=viewProjection*finalWorld*vec4(position,1.0);
#endif
vec4 worldPos=finalWorld*vec4(position,1.0);
vPositionW=vec3(worldPos);
#ifdef NORMAL
mat3 normalWorld=mat3(finalWorld);
#ifdef NONUNIFORMSCALING
normalWorld=transposeMat3(inverseMat3(normalWorld));
#endif
vNormalW=normalize(normalWorld*normal);
#endif
#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)
vDirectionW=normalize(vec3(finalWorld*vec4(position,0.0)));
#ifdef EQUIRECTANGULAR_RELFECTION_FOV
mat3 screenToWorld=inverseMat3(mat3(finalWorld*viewProjection));
vec3 segment=mix(vDirectionW,screenToWorld*vec3(0.0,0.0,1.0),abs(fFovMultiplier-1.0));
if (fFovMultiplier<=1.0) {
vDirectionW=normalize(segment);
} else {
vDirectionW=normalize(vDirectionW+(vDirectionW-segment));
}
#endif
#endif
#ifndef UV1
vec2 uv=vec2(0.,0.);
#endif
#ifndef UV2
vec2 uv2=vec2(0.,0.);
#endif
#ifdef MAINUV1
vMainUV1=uv;
#endif
#ifdef MAINUV2
vMainUV2=uv2;
#endif
#if defined(DIFFUSE) && DIFFUSEDIRECTUV == 0
if (vDiffuseInfos.x == 0.)
{
vDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));
}
else
{
vDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));
}
#endif

#include<clipPlaneVertex>

#include<fogVertex>

#include<shadowsVertex>[0..maxSimultaneousLights]

#ifdef VERTEXCOLOR
vColor=color;
#endif

#ifdef POINTSIZE
gl_PointSize=pointSize;
#endif
}
`;Ye.a.ShadersStore.backgroundVertexShader=QI;var Ts=c(67),qI=function(i){function t(){var e=i.call(this)||this;return e.DIFFUSE=!1,e.DIFFUSEDIRECTUV=0,e.GAMMADIFFUSE=!1,e.DIFFUSEHASALPHA=!1,e.OPACITYFRESNEL=!1,e.REFLECTIONBLUR=!1,e.REFLECTIONFRESNEL=!1,e.REFLECTIONFALLOFF=!1,e.TEXTURELODSUPPORT=!1,e.PREMULTIPLYALPHA=!1,e.USERGBCOLOR=!1,e.USEHIGHLIGHTANDSHADOWCOLORS=!1,e.BACKMAT_SHADOWONLY=!1,e.NOISE=!1,e.REFLECTIONBGR=!1,e.IMAGEPROCESSING=!1,e.VIGNETTE=!1,e.VIGNETTEBLENDMODEMULTIPLY=!1,e.VIGNETTEBLENDMODEOPAQUE=!1,e.TONEMAPPING=!1,e.TONEMAPPING_ACES=!1,e.CONTRAST=!1,e.COLORCURVES=!1,e.COLORGRADING=!1,e.COLORGRADING3D=!1,e.SAMPLER3DGREENDEPTH=!1,e.SAMPLER3DBGRMAP=!1,e.IMAGEPROCESSINGPOSTPROCESS=!1,e.EXPOSURE=!1,e.MULTIVIEW=!1,e.REFLECTION=!1,e.REFLECTIONMAP_3D=!1,e.REFLECTIONMAP_SPHERICAL=!1,e.REFLECTIONMAP_PLANAR=!1,e.REFLECTIONMAP_CUBIC=!1,e.REFLECTIONMAP_PROJECTION=!1,e.REFLECTIONMAP_SKYBOX=!1,e.REFLECTIONMAP_EXPLICIT=!1,e.REFLECTIONMAP_EQUIRECTANGULAR=!1,e.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,e.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,e.INVERTCUBICMAP=!1,e.REFLECTIONMAP_OPPOSITEZ=!1,e.LODINREFLECTIONALPHA=!1,e.GAMMAREFLECTION=!1,e.RGBDREFLECTION=!1,e.EQUIRECTANGULAR_RELFECTION_FOV=!1,e.MAINUV1=!1,e.MAINUV2=!1,e.UV1=!1,e.UV2=!1,e.CLIPPLANE=!1,e.CLIPPLANE2=!1,e.CLIPPLANE3=!1,e.CLIPPLANE4=!1,e.CLIPPLANE5=!1,e.CLIPPLANE6=!1,e.POINTSIZE=!1,e.FOG=!1,e.NORMAL=!1,e.NUM_BONE_INFLUENCERS=0,e.BonesPerMesh=0,e.INSTANCES=!1,e.SHADOWFLOAT=!1,e.rebuild(),e}return Object(p.d)(t,i),t}(fh.a),il=function(i){function t(e,n){var r=i.call(this,e,n)||this;return r.primaryColor=M.a.White(),r._primaryColorShadowLevel=0,r._primaryColorHighlightLevel=0,r.reflectionTexture=null,r.reflectionBlur=0,r.diffuseTexture=null,r._shadowLights=null,r.shadowLights=null,r.shadowLevel=0,r.sceneCenter=d.e.Zero(),r.opacityFresnel=!0,r.reflectionFresnel=!1,r.reflectionFalloffDistance=0,r.reflectionAmount=1,r.reflectionReflectance0=.05,r.reflectionReflectance90=.5,r.useRGBColor=!0,r.enableNoise=!1,r._fovMultiplier=1,r.useEquirectangularFOV=!1,r._maxSimultaneousLights=4,r.maxSimultaneousLights=4,r._shadowOnly=!1,r.shadowOnly=!1,r._imageProcessingObserver=null,r.switchToBGR=!1,r._renderTargets=new Hn.a(16),r._reflectionControls=d.f.Zero(),r._white=M.a.White(),r._primaryShadowColor=M.a.Black(),r._primaryHighlightColor=M.a.Black(),r._attachImageProcessingConfiguration(null),r.getRenderTargetTextures=function(){return r._renderTargets.reset(),r._diffuseTexture&&r._diffuseTexture.isRenderTarget&&r._renderTargets.push(r._diffuseTexture),r._reflectionTexture&&r._reflectionTexture.isRenderTarget&&r._renderTargets.push(r._reflectionTexture),r._renderTargets},r}return Object(p.d)(t,i),Object.defineProperty(t.prototype,"_perceptualColor",{get:function(){return this.__perceptualColor},set:function(e){this.__perceptualColor=e,this._computePrimaryColorFromPerceptualColor(),this._markAllSubMeshesAsLightsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"primaryColorShadowLevel",{get:function(){return this._primaryColorShadowLevel},set:function(e){this._primaryColorShadowLevel=e,this._computePrimaryColors(),this._markAllSubMeshesAsLightsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"primaryColorHighlightLevel",{get:function(){return this._primaryColorHighlightLevel},set:function(e){this._primaryColorHighlightLevel=e,this._computePrimaryColors(),this._markAllSubMeshesAsLightsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"reflectionStandardFresnelWeight",{set:function(e){var n=e;n<.5?(n*=2,this.reflectionReflectance0=t.StandardReflectance0*n,this.reflectionReflectance90=t.StandardReflectance90*n):(n=2*n-1,this.reflectionReflectance0=t.StandardReflectance0+(1-t.StandardReflectance0)*n,this.reflectionReflectance90=t.StandardReflectance90+(1-t.StandardReflectance90)*n)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fovMultiplier",{get:function(){return this._fovMultiplier},set:function(e){isNaN(e)&&(e=1),this._fovMultiplier=Math.max(0,Math.min(2,e))},enumerable:!1,configurable:!0}),t.prototype._attachImageProcessingConfiguration=function(e){var n=this;e!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=e||this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add(function(){n._computePrimaryColorFromPerceptualColor(),n._markAllSubMeshesAsImageProcessingDirty()})))},Object.defineProperty(t.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(e){this._attachImageProcessingConfiguration(e),this._markAllSubMeshesAsTexturesDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraColorCurvesEnabled",{get:function(){return this.imageProcessingConfiguration.colorCurvesEnabled},set:function(e){this.imageProcessingConfiguration.colorCurvesEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraColorGradingEnabled",{get:function(){return this.imageProcessingConfiguration.colorGradingEnabled},set:function(e){this.imageProcessingConfiguration.colorGradingEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraToneMappingEnabled",{get:function(){return this._imageProcessingConfiguration.toneMappingEnabled},set:function(e){this._imageProcessingConfiguration.toneMappingEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraExposure",{get:function(){return this._imageProcessingConfiguration.exposure},set:function(e){this._imageProcessingConfiguration.exposure=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraContrast",{get:function(){return this._imageProcessingConfiguration.contrast},set:function(e){this._imageProcessingConfiguration.contrast=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraColorGradingTexture",{get:function(){return this._imageProcessingConfiguration.colorGradingTexture},set:function(e){this.imageProcessingConfiguration.colorGradingTexture=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraColorCurves",{get:function(){return this.imageProcessingConfiguration.colorCurves},set:function(e){this.imageProcessingConfiguration.colorCurves=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasRenderTargetTextures",{get:function(){return!(!this._diffuseTexture||!this._diffuseTexture.isRenderTarget)||!(!this._reflectionTexture||!this._reflectionTexture.isRenderTarget)},enumerable:!1,configurable:!0}),t.prototype.needAlphaTesting=function(){return!0},t.prototype.needAlphaBlending=function(){return this.alpha<1||this._diffuseTexture!=null&&this._diffuseTexture.hasAlpha||this._shadowOnly},t.prototype.isReadyForSubMesh=function(e,n,r){var o=this;if(r===void 0&&(r=!1),n.effect&&this.isFrozen&&n.effect._wasPreviouslyReady)return!0;n._materialDefines||(n._materialDefines=new qI);var u=this.getScene(),f=n._materialDefines;if(this._isReadyForSubMesh(n))return!0;var v=u.getEngine();if(lt.a.PrepareDefinesForLights(u,e,f,!1,this._maxSimultaneousLights),f._needNormals=!0,lt.a.PrepareDefinesForMultiview(u,f),f._areTexturesDirty){if(f._needUVs=!1,u.texturesEnabled){if(u.getEngine().getCaps().textureLOD&&(f.TEXTURELODSUPPORT=!0),this._diffuseTexture&&bt.a.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;lt.a.PrepareDefinesForMergedUV(this._diffuseTexture,f,"DIFFUSE"),f.DIFFUSEHASALPHA=this._diffuseTexture.hasAlpha,f.GAMMADIFFUSE=this._diffuseTexture.gammaSpace,f.OPACITYFRESNEL=this._opacityFresnel}else f.DIFFUSE=!1,f.DIFFUSEHASALPHA=!1,f.GAMMADIFFUSE=!1,f.OPACITYFRESNEL=!1;var y=this._reflectionTexture;if(y&&bt.a.ReflectionTextureEnabled){if(!y.isReadyOrNotBlocking())return!1;switch(f.REFLECTION=!0,f.GAMMAREFLECTION=y.gammaSpace,f.RGBDREFLECTION=y.isRGBD,f.REFLECTIONBLUR=this._reflectionBlur>0,f.REFLECTIONMAP_OPPOSITEZ=this.getScene().useRightHandedSystem?!y.invertZ:y.invertZ,f.LODINREFLECTIONALPHA=y.lodLevelInAlpha,f.EQUIRECTANGULAR_RELFECTION_FOV=this.useEquirectangularFOV,f.REFLECTIONBGR=this.switchToBGR,y.coordinatesMode===ke.a.INVCUBIC_MODE&&(f.INVERTCUBICMAP=!0),f.REFLECTIONMAP_3D=y.isCube,y.coordinatesMode){case ke.a.EXPLICIT_MODE:f.REFLECTIONMAP_EXPLICIT=!0;break;case ke.a.PLANAR_MODE:f.REFLECTIONMAP_PLANAR=!0;break;case ke.a.PROJECTION_MODE:f.REFLECTIONMAP_PROJECTION=!0;break;case ke.a.SKYBOX_MODE:f.REFLECTIONMAP_SKYBOX=!0;break;case ke.a.SPHERICAL_MODE:f.REFLECTIONMAP_SPHERICAL=!0;break;case ke.a.EQUIRECTANGULAR_MODE:f.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case ke.a.FIXED_EQUIRECTANGULAR_MODE:f.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case ke.a.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:f.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case ke.a.CUBIC_MODE:case ke.a.INVCUBIC_MODE:default:f.REFLECTIONMAP_CUBIC=!0}this.reflectionFresnel?(f.REFLECTIONFRESNEL=!0,f.REFLECTIONFALLOFF=this.reflectionFalloffDistance>0,this._reflectionControls.x=this.reflectionAmount,this._reflectionControls.y=this.reflectionReflectance0,this._reflectionControls.z=this.reflectionReflectance90,this._reflectionControls.w=1/this.reflectionFalloffDistance):(f.REFLECTIONFRESNEL=!1,f.REFLECTIONFALLOFF=!1)}else f.REFLECTION=!1,f.REFLECTIONFRESNEL=!1,f.REFLECTIONFALLOFF=!1,f.REFLECTIONBLUR=!1,f.REFLECTIONMAP_3D=!1,f.REFLECTIONMAP_SPHERICAL=!1,f.REFLECTIONMAP_PLANAR=!1,f.REFLECTIONMAP_CUBIC=!1,f.REFLECTIONMAP_PROJECTION=!1,f.REFLECTIONMAP_SKYBOX=!1,f.REFLECTIONMAP_EXPLICIT=!1,f.REFLECTIONMAP_EQUIRECTANGULAR=!1,f.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,f.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,f.INVERTCUBICMAP=!1,f.REFLECTIONMAP_OPPOSITEZ=!1,f.LODINREFLECTIONALPHA=!1,f.GAMMAREFLECTION=!1,f.RGBDREFLECTION=!1}f.PREMULTIPLYALPHA=this.alphaMode===g.a.ALPHA_PREMULTIPLIED||this.alphaMode===g.a.ALPHA_PREMULTIPLIED_PORTERDUFF,f.USERGBCOLOR=this._useRGBColor,f.NOISE=this._enableNoise}if(f._areLightsDirty&&(f.USEHIGHLIGHTANDSHADOWCOLORS=!this._useRGBColor&&(this._primaryColorShadowLevel!==0||this._primaryColorHighlightLevel!==0),f.BACKMAT_SHADOWONLY=this._shadowOnly),f._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(f)}if(lt.a.PrepareDefinesForMisc(e,u,!1,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(e),f),lt.a.PrepareDefinesForFrameBoundValues(u,v,f,r,null,n.getRenderingMesh().hasThinInstances),lt.a.PrepareDefinesForAttributes(e,f,!1,!0,!1)&&e&&(u.getEngine().getCaps().standardDerivatives||e.isVerticesDataPresent(De.b.NormalKind)||(e.createNormals(!0),_.a.Warn("BackgroundMaterial: Normals have been created for the mesh: "+e.name))),f.isDirty){f.markAsProcessed(),u.resetCachedMaterial();var D=new Ts.a;f.FOG&&D.addFallback(0,"FOG"),f.POINTSIZE&&D.addFallback(1,"POINTSIZE"),f.MULTIVIEW&&D.addFallback(0,"MULTIVIEW"),lt.a.HandleFallbacksForShadows(f,D,this._maxSimultaneousLights);var w=[De.b.PositionKind];f.NORMAL&&w.push(De.b.NormalKind),f.UV1&&w.push(De.b.UVKind),f.UV2&&w.push(De.b.UV2Kind),lt.a.PrepareAttributesForBones(w,e,f,D),lt.a.PrepareAttributesForInstances(w,f);var F=["world","view","viewProjection","vEyePosition","vLightsType","vFogInfos","vFogColor","pointSize","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","mBones","vPrimaryColor","vPrimaryColorShadow","vReflectionInfos","reflectionMatrix","vReflectionMicrosurfaceInfos","fFovMultiplier","shadowLevel","alpha","vBackgroundCenter","vReflectionControl","vDiffuseInfos","diffuseMatrix"],z=["diffuseSampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh"],k=["Material","Scene"];fr.a&&(fr.a.PrepareUniforms(F,f),fr.a.PrepareSamplers(z,f)),lt.a.PrepareUniformsAndSamplersList({uniformsNames:F,uniformBuffersNames:k,samplers:z,defines:f,maxSimultaneousLights:this._maxSimultaneousLights});var K=f.toString();n.setEffect(u.getEngine().createEffect("background",{attributes:w,uniformsNames:F,uniformBuffersNames:k,samplers:z,defines:K,fallbacks:D,onCompiled:function(oe){o.onCompiled&&o.onCompiled(oe),o.bindSceneUniformBuffer(oe,u.getSceneUniformBuffer())},onError:this.onError,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights}},v),f),this.buildUniformLayout()}return!(!n.effect||!n.effect.isReady())&&(f._renderId=u.getRenderId(),n.effect._wasPreviouslyReady=!0,!0)},t.prototype._computePrimaryColorFromPerceptualColor=function(){this.__perceptualColor&&(this._primaryColor.copyFrom(this.__perceptualColor),this._primaryColor.toLinearSpaceToRef(this._primaryColor),this._imageProcessingConfiguration&&this._primaryColor.scaleToRef(1/this._imageProcessingConfiguration.exposure,this._primaryColor),this._computePrimaryColors())},t.prototype._computePrimaryColors=function(){this._primaryColorShadowLevel===0&&this._primaryColorHighlightLevel===0||(this._primaryColor.scaleToRef(this._primaryColorShadowLevel,this._primaryShadowColor),this._primaryColor.subtractToRef(this._primaryShadowColor,this._primaryShadowColor),this._white.subtractToRef(this._primaryColor,this._primaryHighlightColor),this._primaryHighlightColor.scaleToRef(this._primaryColorHighlightLevel,this._primaryHighlightColor),this._primaryColor.addToRef(this._primaryHighlightColor,this._primaryHighlightColor))},t.prototype.buildUniformLayout=function(){this._uniformBuffer.addUniform("vPrimaryColor",4),this._uniformBuffer.addUniform("vPrimaryColorShadow",4),this._uniformBuffer.addUniform("vDiffuseInfos",2),this._uniformBuffer.addUniform("vReflectionInfos",2),this._uniformBuffer.addUniform("diffuseMatrix",16),this._uniformBuffer.addUniform("reflectionMatrix",16),this._uniformBuffer.addUniform("vReflectionMicrosurfaceInfos",3),this._uniformBuffer.addUniform("fFovMultiplier",1),this._uniformBuffer.addUniform("pointSize",1),this._uniformBuffer.addUniform("shadowLevel",1),this._uniformBuffer.addUniform("alpha",1),this._uniformBuffer.addUniform("vBackgroundCenter",3),this._uniformBuffer.addUniform("vReflectionControl",4),this._uniformBuffer.create()},t.prototype.unbind=function(){this._diffuseTexture&&this._diffuseTexture.isRenderTarget&&this._uniformBuffer.setTexture("diffuseSampler",null),this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._uniformBuffer.setTexture("reflectionSampler",null),i.prototype.unbind.call(this)},t.prototype.bindOnlyWorldMatrix=function(e){this._activeEffect.setMatrix("world",e)},t.prototype.bindForSubMesh=function(e,n,r){var o=this.getScene(),u=r._materialDefines;if(u){var f=r.effect;if(f){this._activeEffect=f,this.bindOnlyWorldMatrix(e),lt.a.BindBonesParameters(n,this._activeEffect);var v=this._mustRebind(o,f,n.visibility);if(v){this._uniformBuffer.bindToEffect(f,"Material"),this.bindViewProjection(f);var y=this._reflectionTexture;this._uniformBuffer.useUbo&&this.isFrozen&&this._uniformBuffer.isSync||(o.texturesEnabled&&(this._diffuseTexture&&bt.a.DiffuseTextureEnabled&&(this._uniformBuffer.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),lt.a.BindTextureMatrix(this._diffuseTexture,this._uniformBuffer,"diffuse")),y&&bt.a.ReflectionTextureEnabled&&(this._uniformBuffer.updateMatrix("reflectionMatrix",y.getReflectionTextureMatrix()),this._uniformBuffer.updateFloat2("vReflectionInfos",y.level,this._reflectionBlur),this._uniformBuffer.updateFloat3("vReflectionMicrosurfaceInfos",y.getSize().width,y.lodGenerationScale,y.lodGenerationOffset))),this.shadowLevel>0&&this._uniformBuffer.updateFloat("shadowLevel",this.shadowLevel),this._uniformBuffer.updateFloat("alpha",this.alpha),this.pointsCloud&&this._uniformBuffer.updateFloat("pointSize",this.pointSize),u.USEHIGHLIGHTANDSHADOWCOLORS?(this._uniformBuffer.updateColor4("vPrimaryColor",this._primaryHighlightColor,1),this._uniformBuffer.updateColor4("vPrimaryColorShadow",this._primaryShadowColor,1)):this._uniformBuffer.updateColor4("vPrimaryColor",this._primaryColor,1)),this._uniformBuffer.updateFloat("fFovMultiplier",this._fovMultiplier),o.texturesEnabled&&(this._diffuseTexture&&bt.a.DiffuseTextureEnabled&&this._uniformBuffer.setTexture("diffuseSampler",this._diffuseTexture),y&&bt.a.ReflectionTextureEnabled&&(u.REFLECTIONBLUR&&u.TEXTURELODSUPPORT?this._uniformBuffer.setTexture("reflectionSampler",y):u.REFLECTIONBLUR?(this._uniformBuffer.setTexture("reflectionSampler",y._lodTextureMid||y),this._uniformBuffer.setTexture("reflectionSamplerLow",y._lodTextureLow||y),this._uniformBuffer.setTexture("reflectionSamplerHigh",y._lodTextureHigh||y)):this._uniformBuffer.setTexture("reflectionSampler",y),u.REFLECTIONFRESNEL&&(this._uniformBuffer.updateFloat3("vBackgroundCenter",this.sceneCenter.x,this.sceneCenter.y,this.sceneCenter.z),this._uniformBuffer.updateFloat4("vReflectionControl",this._reflectionControls.x,this._reflectionControls.y,this._reflectionControls.z,this._reflectionControls.w)))),lt.a.BindClipPlane(this._activeEffect,o),lt.a.BindEyePosition(f,o)}!v&&this.isFrozen||(o.lightsEnabled&&lt.a.BindLights(o,n,this._activeEffect,u,this._maxSimultaneousLights,!1),this.bindView(f),lt.a.BindFogParameters(o,n,this._activeEffect,!0),this._imageProcessingConfiguration&&this._imageProcessingConfiguration.bind(this._activeEffect)),this._uniformBuffer.update(),this._afterBind(n,this._activeEffect)}}},t.prototype.hasTexture=function(e){return!!i.prototype.hasTexture.call(this,e)||this._reflectionTexture===e||this._diffuseTexture===e},t.prototype.dispose=function(e,n){e===void 0&&(e=!1),n===void 0&&(n=!1),n&&(this.diffuseTexture&&this.diffuseTexture.dispose(),this.reflectionTexture&&this.reflectionTexture.dispose()),this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),i.prototype.dispose.call(this,e)},t.prototype.clone=function(e){var n=this;return B.a.Clone(function(){return new t(e,n.getScene())},this)},t.prototype.serialize=function(){var e=B.a.Serialize(this);return e.customType="BABYLON.BackgroundMaterial",e},t.prototype.getClassName=function(){return"BackgroundMaterial"},t.Parse=function(e,n,r){return B.a.Parse(function(){return new t(e.name,n)},e,n,r)},t.StandardReflectance0=.05,t.StandardReflectance90=.5,Object(p.c)([Object(B.e)()],t.prototype,"_primaryColor",void 0),Object(p.c)([Object(B.b)("_markAllSubMeshesAsLightsDirty")],t.prototype,"primaryColor",void 0),Object(p.c)([Object(B.e)()],t.prototype,"__perceptualColor",void 0),Object(p.c)([Object(B.c)()],t.prototype,"_primaryColorShadowLevel",void 0),Object(p.c)([Object(B.c)()],t.prototype,"_primaryColorHighlightLevel",void 0),Object(p.c)([Object(B.b)("_markAllSubMeshesAsLightsDirty")],t.prototype,"primaryColorHighlightLevel",null),Object(p.c)([Object(B.m)()],t.prototype,"_reflectionTexture",void 0),Object(p.c)([Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectionTexture",void 0),Object(p.c)([Object(B.c)()],t.prototype,"_reflectionBlur",void 0),Object(p.c)([Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectionBlur",void 0),Object(p.c)([Object(B.m)()],t.prototype,"_diffuseTexture",void 0),Object(p.c)([Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"diffuseTexture",void 0),Object(p.c)([Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"shadowLights",void 0),Object(p.c)([Object(B.c)()],t.prototype,"_shadowLevel",void 0),Object(p.c)([Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"shadowLevel",void 0),Object(p.c)([Object(B.o)()],t.prototype,"_sceneCenter",void 0),Object(p.c)([Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"sceneCenter",void 0),Object(p.c)([Object(B.c)()],t.prototype,"_opacityFresnel",void 0),Object(p.c)([Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"opacityFresnel",void 0),Object(p.c)([Object(B.c)()],t.prototype,"_reflectionFresnel",void 0),Object(p.c)([Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectionFresnel",void 0),Object(p.c)([Object(B.c)()],t.prototype,"_reflectionFalloffDistance",void 0),Object(p.c)([Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectionFalloffDistance",void 0),Object(p.c)([Object(B.c)()],t.prototype,"_reflectionAmount",void 0),Object(p.c)([Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectionAmount",void 0),Object(p.c)([Object(B.c)()],t.prototype,"_reflectionReflectance0",void 0),Object(p.c)([Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectionReflectance0",void 0),Object(p.c)([Object(B.c)()],t.prototype,"_reflectionReflectance90",void 0),Object(p.c)([Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectionReflectance90",void 0),Object(p.c)([Object(B.c)()],t.prototype,"_useRGBColor",void 0),Object(p.c)([Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useRGBColor",void 0),Object(p.c)([Object(B.c)()],t.prototype,"_enableNoise",void 0),Object(p.c)([Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"enableNoise",void 0),Object(p.c)([Object(B.c)()],t.prototype,"_maxSimultaneousLights",void 0),Object(p.c)([Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"maxSimultaneousLights",void 0),Object(p.c)([Object(B.c)()],t.prototype,"_shadowOnly",void 0),Object(p.c)([Object(B.b)("_markAllSubMeshesAsLightsDirty")],t.prototype,"shadowOnly",void 0),Object(p.c)([Object(B.i)()],t.prototype,"_imageProcessingConfiguration",void 0),t}(ph.a);C.a.RegisteredTypes["BABYLON.BackgroundMaterial"]=il;var $p=function(){function i(t,e){var n=this;this._errorHandler=function(r,o){n.onErrorObservable.notifyObservers({message:r,exception:o})},this._options=Object(p.a)(Object(p.a)({},i._getDefaultOptions()),t),this._scene=e,this.onErrorObservable=new S.c,this._setupBackground(),this._setupImageProcessing()}return i._getDefaultOptions=function(){return{createGround:!0,groundSize:15,groundTexture:this._groundTextureCDNUrl,groundColor:new M.a(.2,.2,.3).toLinearSpace().scale(3),groundOpacity:.9,enableGroundShadow:!0,groundShadowLevel:.5,enableGroundMirror:!1,groundMirrorSizeRatio:.3,groundMirrorBlurKernel:64,groundMirrorAmount:1,groundMirrorFresnelWeight:1,groundMirrorFallOffDistance:0,groundMirrorTextureType:g.a.TEXTURETYPE_UNSIGNED_INT,groundYBias:1e-5,createSkybox:!0,skyboxSize:20,skyboxTexture:this._skyboxTextureCDNUrl,skyboxColor:new M.a(.2,.2,.3).toLinearSpace().scale(3),backgroundYRotation:0,sizeAuto:!0,rootPosition:d.e.Zero(),setupImageProcessing:!0,environmentTexture:this._environmentTextureCDNUrl,cameraExposure:.8,cameraContrast:1.2,toneMappingEnabled:!0}},Object.defineProperty(i.prototype,"rootMesh",{get:function(){return this._rootMesh},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"skybox",{get:function(){return this._skybox},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"skyboxTexture",{get:function(){return this._skyboxTexture},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"skyboxMaterial",{get:function(){return this._skyboxMaterial},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"ground",{get:function(){return this._ground},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"groundTexture",{get:function(){return this._groundTexture},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"groundMirror",{get:function(){return this._groundMirror},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"groundMirrorRenderList",{get:function(){return this._groundMirror?this._groundMirror.renderList:null},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"groundMaterial",{get:function(){return this._groundMaterial},enumerable:!1,configurable:!0}),i.prototype.updateOptions=function(t){var e=Object(p.a)(Object(p.a)({},this._options),t);this._ground&&!e.createGround&&(this._ground.dispose(),this._ground=null),this._groundMaterial&&!e.createGround&&(this._groundMaterial.dispose(),this._groundMaterial=null),this._groundTexture&&this._options.groundTexture!=e.groundTexture&&(this._groundTexture.dispose(),this._groundTexture=null),this._skybox&&!e.createSkybox&&(this._skybox.dispose(),this._skybox=null),this._skyboxMaterial&&!e.createSkybox&&(this._skyboxMaterial.dispose(),this._skyboxMaterial=null),this._skyboxTexture&&this._options.skyboxTexture!=e.skyboxTexture&&(this._skyboxTexture.dispose(),this._skyboxTexture=null),this._groundMirror&&!e.enableGroundMirror&&(this._groundMirror.dispose(),this._groundMirror=null),this._scene.environmentTexture&&this._options.environmentTexture!=e.environmentTexture&&this._scene.environmentTexture.dispose(),this._options=e,this._setupBackground(),this._setupImageProcessing()},i.prototype.setMainColor=function(t){this.groundMaterial&&(this.groundMaterial.primaryColor=t),this.skyboxMaterial&&(this.skyboxMaterial.primaryColor=t),this.groundMirror&&(this.groundMirror.clearColor=new M.b(t.r,t.g,t.b,1))},i.prototype._setupImageProcessing=function(){this._options.setupImageProcessing&&(this._scene.imageProcessingConfiguration.contrast=this._options.cameraContrast,this._scene.imageProcessingConfiguration.exposure=this._options.cameraExposure,this._scene.imageProcessingConfiguration.toneMappingEnabled=this._options.toneMappingEnabled,this._setupEnvironmentTexture())},i.prototype._setupEnvironmentTexture=function(){if(!this._scene.environmentTexture)if(this._options.environmentTexture instanceof $r.a)this._scene.environmentTexture=this._options.environmentTexture;else{var t=Ei.CreateFromPrefilteredData(this._options.environmentTexture,this._scene);this._scene.environmentTexture=t}},i.prototype._setupBackground=function(){this._rootMesh||(this._rootMesh=new Ne.a("BackgroundHelper",this._scene)),this._rootMesh.rotation.y=this._options.backgroundYRotation;var t=this._getSceneSize();this._options.createGround&&(this._setupGround(t),this._setupGroundMaterial(),this._setupGroundDiffuseTexture(),this._options.enableGroundMirror&&this._setupGroundMirrorTexture(t),this._setupMirrorInGroundMaterial()),this._options.createSkybox&&(this._setupSkybox(t),this._setupSkyboxMaterial(),this._setupSkyboxReflectionTexture()),this._rootMesh.position.x=t.rootPosition.x,this._rootMesh.position.z=t.rootPosition.z,this._rootMesh.position.y=t.rootPosition.y},i.prototype._getSceneSize=function(){var t=this,e=this._options.groundSize,n=this._options.skyboxSize,r=this._options.rootPosition;if(!this._scene.meshes||this._scene.meshes.length===1)return{groundSize:e,skyboxSize:n,rootPosition:r};var o=this._scene.getWorldExtends(function(v){return v!==t._ground&&v!==t._rootMesh&&v!==t._skybox}),u=o.max.subtract(o.min);if(this._options.sizeAuto){this._scene.activeCamera instanceof Vi&&this._scene.activeCamera.upperRadiusLimit&&(n=e=2*this._scene.activeCamera.upperRadiusLimit);var f=u.length();f>e&&(n=e=2*f),e*=1.1,n*=1.5,(r=o.min.add(u.scale(.5))).y=o.min.y-this._options.groundYBias}return{groundSize:e,skyboxSize:n,rootPosition:r}},i.prototype._setupGround=function(t){var e=this;this._ground&&!this._ground.isDisposed()||(this._ground=Ne.a.CreatePlane("BackgroundPlane",t.groundSize,this._scene),this._ground.rotation.x=Math.PI/2,this._ground.parent=this._rootMesh,this._ground.onDisposeObservable.add(function(){e._ground=null})),this._ground.receiveShadows=this._options.enableGroundShadow},i.prototype._setupGroundMaterial=function(){this._groundMaterial||(this._groundMaterial=new il("BackgroundPlaneMaterial",this._scene)),this._groundMaterial.alpha=this._options.groundOpacity,this._groundMaterial.alphaMode=g.a.ALPHA_PREMULTIPLIED_PORTERDUFF,this._groundMaterial.shadowLevel=this._options.groundShadowLevel,this._groundMaterial.primaryColor=this._options.groundColor,this._groundMaterial.useRGBColor=!1,this._groundMaterial.enableNoise=!0,this._ground&&(this._ground.material=this._groundMaterial)},i.prototype._setupGroundDiffuseTexture=function(){this._groundMaterial&&(this._groundTexture||(this._options.groundTexture instanceof $r.a?this._groundMaterial.diffuseTexture=this._options.groundTexture:(this._groundTexture=new ke.a(this._options.groundTexture,this._scene,void 0,void 0,void 0,void 0,this._errorHandler),this._groundTexture.gammaSpace=!1,this._groundTexture.hasAlpha=!0,this._groundMaterial.diffuseTexture=this._groundTexture)))},i.prototype._setupGroundMirrorTexture=function(t){var e=ke.a.CLAMP_ADDRESSMODE;if(!this._groundMirror&&(this._groundMirror=new Zp("BackgroundPlaneMirrorTexture",{ratio:this._options.groundMirrorSizeRatio},this._scene,!1,this._options.groundMirrorTextureType,ke.a.BILINEAR_SAMPLINGMODE,!0),this._groundMirror.mirrorPlane=new _s.a(0,-1,0,t.rootPosition.y),this._groundMirror.anisotropicFilteringLevel=1,this._groundMirror.wrapU=e,this._groundMirror.wrapV=e,this._groundMirror.gammaSpace=!1,this._groundMirror.renderList))for(var n=0;n<this._scene.meshes.length;n++){var r=this._scene.meshes[n];r!==this._ground&&r!==this._skybox&&r!==this._rootMesh&&this._groundMirror.renderList.push(r)}this._groundMirror.clearColor=new M.b(this._options.groundColor.r,this._options.groundColor.g,this._options.groundColor.b,1),this._groundMirror.adaptiveBlurKernel=this._options.groundMirrorBlurKernel},i.prototype._setupMirrorInGroundMaterial=function(){this._groundMaterial&&(this._groundMaterial.reflectionTexture=this._groundMirror,this._groundMaterial.reflectionFresnel=!0,this._groundMaterial.reflectionAmount=this._options.groundMirrorAmount,this._groundMaterial.reflectionStandardFresnelWeight=this._options.groundMirrorFresnelWeight,this._groundMaterial.reflectionFalloffDistance=this._options.groundMirrorFallOffDistance)},i.prototype._setupSkybox=function(t){var e=this;this._skybox&&!this._skybox.isDisposed()||(this._skybox=Ne.a.CreateBox("BackgroundSkybox",t.skyboxSize,this._scene,void 0,Ne.a.BACKSIDE),this._skybox.onDisposeObservable.add(function(){e._skybox=null})),this._skybox.parent=this._rootMesh},i.prototype._setupSkyboxMaterial=function(){this._skybox&&(this._skyboxMaterial||(this._skyboxMaterial=new il("BackgroundSkyboxMaterial",this._scene)),this._skyboxMaterial.useRGBColor=!1,this._skyboxMaterial.primaryColor=this._options.skyboxColor,this._skyboxMaterial.enableNoise=!0,this._skybox.material=this._skyboxMaterial)},i.prototype._setupSkyboxReflectionTexture=function(){this._skyboxMaterial&&(this._skyboxTexture||(this._options.skyboxTexture instanceof $r.a?this._skyboxMaterial.reflectionTexture=this._options.skyboxTexture:(this._skyboxTexture=new Ei(this._options.skyboxTexture,this._scene,void 0,void 0,void 0,void 0,this._errorHandler),this._skyboxTexture.coordinatesMode=ke.a.SKYBOX_MODE,this._skyboxTexture.gammaSpace=!1,this._skyboxMaterial.reflectionTexture=this._skyboxTexture)))},i.prototype.dispose=function(){this._groundMaterial&&this._groundMaterial.dispose(!0,!0),this._skyboxMaterial&&this._skyboxMaterial.dispose(!0,!0),this._rootMesh.dispose(!1)},i._groundTextureCDNUrl="https://assets.babylonjs.com/environments/backgroundGround.png",i._skyboxTextureCDNUrl="https://assets.babylonjs.com/environments/backgroundSkybox.dds",i._environmentTextureCDNUrl="https://assets.babylonjs.com/environments/environmentSpecular.env",i}(),Wo=function(i){function t(e,n,r,o,u){u===void 0&&(u=null);var f=i.call(this,e,o)||this;f.onError=u,f._halfDome=!1,f._crossEye=!1,f._useDirectMapping=!1,f._textureMode=t.MODE_MONOSCOPIC,f._onBeforeCameraRenderObserver=null,f.onLoadErrorObservable=new S.c,o=f.getScene(),e=e||"textureDome",r.resolution=0|Math.abs(r.resolution)||32,r.clickToPlay=Boolean(r.clickToPlay),r.autoPlay=r.autoPlay===void 0||Boolean(r.autoPlay),r.loop=r.loop===void 0||Boolean(r.loop),r.size=Math.abs(r.size)||(o.activeCamera?.48*o.activeCamera.maxZ:1e3),r.useDirectMapping===void 0?f._useDirectMapping=!0:f._useDirectMapping=r.useDirectMapping,r.faceForward===void 0&&(r.faceForward=!0),f._setReady(!1),f._mesh=Ne.a.CreateSphere(e+"_mesh",r.resolution,r.size,o,!1,Ne.a.BACKSIDE);var v=f._material=new il(e+"_material",o);v.useEquirectangularFOV=!0,v.fovMultiplier=1,v.opacityFresnel=!1;var y=f._initTexture(n,o,r);if(f.texture=y,f._mesh.material=v,f._mesh.parent=f,f._halfDomeMask=zr.a.CreateSphere("",{slice:.5,diameter:.98*r.size,segments:2*r.resolution,sideOrientation:Ne.a.BACKSIDE},o),f._halfDomeMask.rotate(Se.a.X,-Math.PI/2),f._halfDomeMask.parent=f._mesh,f._halfDome=!!r.halfDomeMode,f._halfDomeMask.setEnabled(f._halfDome),f._crossEye=!!r.crossEyeMode,f._texture.anisotropicFilteringLevel=1,f._texture.onLoadObservable.addOnce(function(){f._setReady(!0)}),r.faceForward&&o.activeCamera){var D=o.activeCamera,w=d.e.Forward(),F=d.e.TransformNormal(w,D.getViewMatrix());F.normalize(),f.rotation.y=Math.acos(d.e.Dot(w,F))}return f._changeTextureMode(f._textureMode),f}return Object(p.d)(t,i),Object.defineProperty(t.prototype,"texture",{get:function(){return this._texture},set:function(e){this._texture!==e&&(this._texture=e,this._useDirectMapping?(this._texture.wrapU=ke.a.CLAMP_ADDRESSMODE,this._texture.wrapV=ke.a.CLAMP_ADDRESSMODE,this._material.diffuseTexture=this._texture):(this._texture.coordinatesMode=ke.a.FIXED_EQUIRECTANGULAR_MIRRORED_MODE,this._texture.wrapV=ke.a.CLAMP_ADDRESSMODE,this._material.reflectionTexture=this._texture),this._changeTextureMode(this._textureMode))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mesh",{get:function(){return this._mesh},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fovMultiplier",{get:function(){return this._material.fovMultiplier},set:function(e){this._material.fovMultiplier=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"textureMode",{get:function(){return this._textureMode},set:function(e){this._textureMode!==e&&this._changeTextureMode(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"halfDome",{get:function(){return this._halfDome},set:function(e){this._halfDome=e,this._halfDomeMask.setEnabled(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"crossEye",{get:function(){return this._crossEye},set:function(e){this._crossEye=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"material",{get:function(){return this._material},enumerable:!1,configurable:!0}),t.prototype._changeTextureMode=function(e){var n=this;switch(this._scene.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._textureMode=e,this._texture.uScale=1,this._texture.vScale=1,this._texture.uOffset=0,this._texture.vOffset=0,this._texture.vAng=0,e){case t.MODE_MONOSCOPIC:this._halfDome&&(this._texture.uScale=2,this._texture.uOffset=-1);break;case t.MODE_SIDEBYSIDE:this._texture.uScale=this._halfDome?.99999:.5;var r=this._halfDome?0:.5,o=this._halfDome?-.5:0;this._onBeforeCameraRenderObserver=this._scene.onBeforeCameraRenderObservable.add(function(u){var f=u.isRightCamera;n._crossEye&&(f=!f),n._texture.uOffset=f?r:o});break;case t.MODE_TOPBOTTOM:this._texture.vScale=this._halfDome?.99999:.5,this._onBeforeCameraRenderObserver=this._scene.onBeforeCameraRenderObservable.add(function(u){var f=u.isRightCamera;n._crossEye&&(f=!f),n._texture.vOffset=f?.5:0})}},t.prototype.dispose=function(e,n){n===void 0&&(n=!1),this._texture.dispose(),this._mesh.dispose(),this._material.dispose(),this._scene.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this.onLoadErrorObservable.clear(),i.prototype.dispose.call(this,e,n)},t.MODE_MONOSCOPIC=0,t.MODE_TOPBOTTOM=1,t.MODE_SIDEBYSIDE=2,t}(ys.a),ZI=function(i){function t(){return i!==null&&i.apply(this,arguments)||this}return Object(p.d)(t,i),Object.defineProperty(t.prototype,"photoTexture",{get:function(){return this.texture},set:function(e){this.texture=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"imageMode",{get:function(){return this.textureMode},set:function(e){this.textureMode=e},enumerable:!1,configurable:!0}),t.prototype._initTexture=function(e,n,r){var o=this;return new ke.a(e,n,!r.generateMipMaps,!this._useDirectMapping,void 0,void 0,function(u,f){o.onLoadErrorObservable.notifyObservers(u||"Unknown error occured"),o.onError&&o.onError(u,f)})},t.MODE_MONOSCOPIC=Wo.MODE_MONOSCOPIC,t.MODE_TOPBOTTOM=Wo.MODE_TOPBOTTOM,t.MODE_SIDEBYSIDE=Wo.MODE_SIDEBYSIDE,t}(Wo),e0=function(){function i(){}return i.ExpandRGBDTexture=function(t){var e=t._texture;if(e&&t.isRGBD){var n=e.getEngine(),r=n.getCaps(),o=!1;r.textureHalfFloatRender&&r.textureHalfFloatLinearFiltering?(o=!0,e.type=g.a.TEXTURETYPE_HALF_FLOAT):r.textureFloatRender&&r.textureFloatLinearFiltering&&(o=!0,e.type=g.a.TEXTURETYPE_FLOAT),o&&(e.isReady=!1,e._isRGBD=!1,e.invertY=!1),t.onLoadObservable.addOnce(function(){if(o){var u=new St("rgbdDecode","rgbdDecode",null,null,1,null,g.a.TEXTURE_TRILINEAR_SAMPLINGMODE,n,!1,void 0,e.type,void 0,null,!1),f=n.createRenderTargetTexture(e.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:e.samplingMode,type:e.type,format:g.a.TEXTUREFORMAT_RGBA});u.getEffect().executeWhenCompiled(function(){u.onApply=function(v){v._bindTexture("textureSampler",e),v.setFloat2("scale",1,1)},t.getScene().postProcessManager.directRender([u],f,!0),n.restoreDefaultFramebuffer(),n._releaseTexture(e),n._releaseFramebufferObjects(f),u&&u.dispose(),f._swapAndDie(e),e.isReady=!0})}})}},i}(),mh=function(){function i(){}return i.GetEnvironmentBRDFTexture=function(t){if(!t.environmentBRDFTexture){var e=t.useDelayedTextureLoading;t.useDelayedTextureLoading=!1;var n=t._blockEntityCollection;t._blockEntityCollection=!1;var r=ke.a.CreateFromBase64String(this._environmentBRDFBase64Texture,"EnvironmentBRDFTexture"+this._instanceNumber++,t,!0,!1,ke.a.BILINEAR_SAMPLINGMODE);t._blockEntityCollection=n;var o=t.getEngine().getLoadedTexturesCache(),u=o.indexOf(r.getInternalTexture());u!==-1&&o.splice(u,1),r.isRGBD=!0,r.wrapU=ke.a.CLAMP_ADDRESSMODE,r.wrapV=ke.a.CLAMP_ADDRESSMODE,t.environmentBRDFTexture=r,t.useDelayedTextureLoading=e,e0.ExpandRGBDTexture(r)}return t.environmentBRDFTexture},i._instanceNumber=0,i._environmentBRDFBase64Texture="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAgAElEQVR42u29yY5tWXIlZnbuiSaTbZFUkZRKrCKhElASQA0EoQABgn6hJvoXzfUP+gP9hWb6Bg00IgRoQJaKqUxmZmTEe8/v0uB2u7Fm2T7HIyIrnz88uPvt3f2a2WrMbOvf/u3PvvzP/sUf/N6//i8vf/lv/3v5H//d//Sb//Uq/5u8yf8hV/m/5Cp/L1f5hVzlG7nKJ7mKyJuIXN/hPwqXI/g++zq6rPI5u8z+WqfLre+zy7PrVv9L8brsMiGvk8XLmM/sdfHXal4e3ad6GXPdyu2ij8u/+uv/5cuf/OSLfdtEfvUr+dnf/d0X//t3H/7bf/hP//N/928h/0Yg/4VA/kogfyGQP5Wr/IFAvhbIlwK5CGQTPP+9z5uPeePJSW+yo2+s/GtN30Rnv1E+f5zxof9R/lSXv/nr//mrr3+i+5dfyX7ZZQP07Tffys//8R/l/9TtX7790T/7r/8G8pdy+/8XAvnnAvkzgfwzgfyxQP5AIL8vkJ8K5KsmMVzu1U7p5PA5AXxOAJ8TwPf7sX/51ZeXfcemqnp9w/W77/S7X/6T/vzf/7383RWCX3/z05/9i3/13/0PX//eX/2FyP8tIv+PiPy9iPy/IvIzEfm5iPxCRH4lIt/c/393//9BRD6KyKf7f488fP74/PH544dJAF9cLl98IZfLBZtuqterXr/7Dt9982v95S9+Lv+gF/3i7Spv/8lf/vnf/vGf/dF/JfKnIvLnIvLvReQ/NEngn0TklyLy6/v/34jIt00iGJOBlxAsdvv54/PH5493SQCXy9t2ueh2ueimKorrFbjq9eNH+fDtb+TXv/ol/vHyhX4Fxfbx7euPf/Lnf/PfiPyeiPyhiPxxkwB+fk8AvxzQgJcIrGTwFsiAEXH4/PH54/PHUgLY7whgu2C7bLqpQgHB2xvePn6SDx8+6G9+84384vKF/IPu8iVU9Y/+7C/+jWxffiHytYj8VER+X0T+oEEBvxqQwCMJeIngo5EI3goIwVMIPn98/vj8ESaAbbtu2ybbvl8u2ybbdtluSECA65u8ffqIDx8+6G++/VZ/efkV/sO261dQXP7wT/7kX8vl8qXIFyLylbySwe/dE0CLAr65B/9vGn0gQwRMMqgmhM/J4fPH548eAezbZd/lsm3YtssNAYiqiogAAkCvb5/k46cP8u2HD/rrb7+R/2/b9Wu9yJe//8d/9Ney6S5yEZFdRL68/38khG/uKOCnAwoYkcCoEXwkEgGDDq7CeQfyOTl8/vhd1QCum26ybZtu2yabbrKpQvXue1yvuF6v+vbpTT5+/CDffviAX1++1V9sO77WXb/66R/+4V/dgkbllQi+aBLBV/dE8LWRALwkYCWCNyMZXElkwLTMeMkga/P4/PH547ccAVwuctkvdxSw6bbdtYDbTfSZBN7e8PHTR/3u4wf55vKd/nL7DX6mu3791U9//5+/gkNFZGuSgZUQvnKowKgLWLTAQgRtEniTuEfwaELw0MJvf3LQzynud+53uG+X6y3gN9kul+2y6XVT1U27JCDAFVc8ksAn/e7jR/nN5YP+avtWfq6Xy9f7Vz/9w1dgRYngiyYhfNkkgzYBWHTg44AEMmqQUYQKOmDaiCIa8TmsfmzB+DnZDQjgcpGLbti2y3bZHjRAdRMVvb/dcYU8kcDbPQlsH/CrbddfbF98+RPZfvLFnAQeieCRDC5DMvju/vmD4JkEvjRQgKULeGggowdHkAHTYxihg89vu88I5UeGAPSOAFTlrgPopiqbKPSmCKreUoAAkCcSePukHz590m8vH+WbD9/JP335k6/+tA86KxFchv8jMvhiogE4JQm8XhfKqOAqx5qRPyeGzx8/cgSwbXcUoLJtim27C4Oi93+4v6VxQwKAvl2v+Hj9pB8+fZJvt4/yzfbF9lPdv/wJnsE2BogmyeCRED40tGFvksIXiSbgiYSRRpDNDZ6BDI6ghM+J4fPHeyKAO+zX7cb9t4tedMMNAQju5V+f1uAtBSiu1zsduMrHy5t8ePsk3376KN98sX/xE5FPAnm7/782o0DiUINXMkCXCB7/P94/e87AWUmARQWVvgMuKej9t1RLBp+Tw+ePgwngsutFFdu26WXbbl+rSvdfbnqAiuA23QcBgCugV1zl7e1NPm5v+LC96XfbJ/1W9y++fgXjA3bDYXV+MuhRwSPwL3JLMFYC+HS/LU8HYrGwIhwyNOF12SvgM4SgztdifP85MXz+KGsA2C6X7aJ6bXSAOwrY5OYIqGy3d5uq4P5GhABXuV6veLvRAf10fZMPb2/y3b7vX7+g+9v98/WOBq7GG7RNAlYy+Dgkhhb+Xxp0sE8IAC4SGAP/TbgVJK/PoJPBnAiwPKxsXfbbnRg+i3s/JAK4Q/4b9NfLtomBAqCickMBjy7BuywAUVyv8na94tMjCVzf9KNcLl/0SeA6oAEYb1i9g+FtSALb/bKL8/+t+wxXFMyswqiHoK4ToIgKqslgpg1qUC0QoYbvJZg/B/q5v4szHmPX7YEAsD0CX25OwEUVm9xag1+agKg+nxQArnKjAtDr9U0+Xd/k4/UqH7bL5YsewrcBBiMJZPRAp6TwQgWfjM9vgRbgUYGL8AvLWH2gqhesCokeUmCSwPsnhs8fP2YNYMO2XeSmAWxy2VQaXeDmDIhApf33rD4PTUCuV+DtCn27XuXT5ir8VmCJ2G5BpBM8/r/dEcJb8/0lEQMtJHA5TAlqNuLRhJChhEpSqFabH3di+G1AGj+W1/dyAR4IYJNNnuLf6+tWC9CHHiAtFhAIFLjK2/Uqn65X+SS67aK+3QeTDoy/IG2ogQ7fb/dAtz5vBgrYGqrwNtCHsVfgIvwK07OTQBURVNCBFpKCOjqCHn5L/67TgTN+fpySAC56nwSUi256kXsSuFGAVyLoUIDo8/Pz7fdoErr/v17lk162HbgHvFpIYDfoAJJfW4sGPjkU4VNAF8ZEcLmLhdc7kljdY1y1Dq9yLiI4IiRqcLujb138KIPn80ejATwRwIbtBvn1cqv+2J78/5EI5N4cJA8qIPcmwRsKAHDF9WYP6mV7VmrgLuTpxYTcMEW0LAmoQxFsuvAI8tv/a/C5fV2ZMMiKg++FCM7RDPRu8ebWY7VG6VJi+Bzk35MI2LsAckMAgwvQ0gC5DQjd3ABg2HQLAPpEAlZ1Bu7VV7MGHDFRAbo3VKsTbAY9sPWC/uvx86gBbDK3D1eEQS8pbAeSgSwmhepnJb6uBv/o/PzHLzxWA/X7TH77De5j6AGQi6o0CUGfCOD2X7cXAlCFQABtEsGLDtxuOyQB2UTQBKZe5GUPXgkUYCUAbZJRhBDeuq8xBf+bgwbehDm+BFQi2IJksOocvA8ysIMfxluVcRsY/eB3JzH8GFDAXQO48X/dcIf9jyDHptIigDsFkEe066tBSETQUYF7ElDdYEBytN4+rk9UcBPfrKaZqFHWcw3i4J8/X4ev2//bSXqAhwTay6OEIPLD2Ipt8OtAGzxkwLw9WVFRjTc/qC6H3+YK/b1oAA0KuOizHfieCLaHHiAb5NYTIC9EMEbZrVEQt1xwhVy1UfBh8PUOquMizwaap3tQXfY5B//tea/NZdfhsvbz+PURQTDSGWB87VX/7WSd4KxjUqrIgE0IUkoKGnhIvwvawpGf6eECXJ7tv4qbA7DJgwpsKthEmmYgfaAAffYF3HLxo0vwNjJ0SwRWMG4db4eh1gPNm18vQ+us/0eGmxDemu/fnM/X4evq/8342ksGHgLY5LyT/zg0wM8lcMjgGFXwqIOVFJBQw99eCvF9oZL9Mfl3QwAvIXDsBRC9R+fz8x0FPBLB0xJEpwUobrfAkARgIAF41h3wQgP6QAmX5E/7eI43IxGwwf/moIkRyWRJQIPgt9CA9b39nzt4bYUWjAlCjWDPgv8IEjgLJfzuaAsrv9VdVG4OwOXW/fdoA35qAdL0BDwvf6AAUVHd8LIEu94A3K+Q+2YxaB84MOH62P//qoo38fCRDERE2zf0JfmDa+MieElAjcDPKz+mRKCOtdgGtXaBjgNJ4H2owSpNeAW/rRH4CaHSpMwnBYYycjgSJwfie9CR6mPu20Uv8kABF206AvXlBMiIBPSlB9wjBW1fwEuSb94296VCqgMaGCt/G1BbExi3IG+r3a3J6P48Gv/J0YmEYoiGY7V/SxwFCwGoE/xa0AJ0CEiV9QPCJb1OJ5F1VTjEY2/MO9AEJvj1BJTQpqLfTlGwjABuzT962e4IoKnyrdh3+/6mzDVJ4PHOxj0JqGKoy20+wBMN6D1gLWi9NQHfVP5MEEPzjGYy8BMAOnTAJgEr8HUIejRo5xrA5xkR5AngmiSHs+zDDAmMgWzTg55GSJEmHE8IvWPAoYTfhWak/Wn/bQ0CGLSAjv83SUEfKp5q24LXuQICpzrjrgWoza8xVE00CQCORdhMJuTUT/rjuls0gO4Iby8BIEgK6gS7BsGuTtDrScH/fR68biUHNVGBnxjeNyHEvQe/ve3LZQqgG3rof6cEclsNflG9J4KtaQ8WHcVBHS1BtHE4QP9OBMS98mpbKTeDW7dJwRsnHpMBTFJpV4I+b0kY/NqInVFSyBLANbnMSgBM8F+Fqfxq/h657/Up+GaBnwV9hRqc9bZ/vA6vu+T9E8KPJWns94UfTeCj2QXwCHS9dNL8Xf3Ho/rfewSeFODGDV69AU0y6NFAE1DP3qK++rdB7/1HRxf86gT376zOr99T/h/ioBiXWQkgQgVeIrCC/WomhDmQK+hASI2ARQZKooHMLdCJwGEBBXC3+uERwg+VOHZ9ioAt9H80AI06wGgJ3nQA3BoCut6AhxYwgcPOFnxuFnrphk+NIKIGrWPQtgz3b0i7Y6D5rs1GKqTop0nQX52vmQC4BkjA+r4a7Kx9WLENGeegkhSETBCrNXIMdi/444Rw1n6E96ry7OPuj8UfLxtQ78NA2iSBbg7gIiIbdDLsb5agPhLC3RkYKv8NDbS2YGsatNRAG2oQwf9ZIOydgy1MAzBkAw8UwEEIDzSAqdPQ6za0PkeJAMH3Z0wXniUSZoHvBXU2mcjQgv56TedIKglCpIoQfgwCIjOytd8WgN0bfxoR8Fn9Gx0Aj5Zgq0lIZbsH/ibSJoFnS+C98g9ooHEELI3gliy25yONIiE6pb0NfBlyNEYyENoodkKwgl6I6s8kARgJ4ZoEfuYWHLEJa0LhSBXm7kImGeSfVdoJ1DO2G7WXsehAptupSOoyrCSF904k+6vt98X/ZcM98Hsd4JYIXhQAIg3/f9AAUYhsLQKAtkHVBnzjCKhOoYl2ym+iBtvzDzQ2DLXJ4PUmbJHAVnBQX4jkxfvHhNDqAdHXGQJgv0aSDGItgOseHIU+K9hXnIJzkoGlEKzNHagTdJ6VWEUH4iCKH4fd2AwDPaYBm4Wgng4gQ9V/CoGiuNmD04AQtNGMGzSAAQ2I2pzfogY9LRh7BrbOh4+D30sAencljFu2CUFrwY8UAWRfWwGvVOVfbx2uIILM0pwDv082dUTw8hYs8L+uIWiHGpWgClnAa1lMPJogovvvbePPs/q3Xr++kgCsfgB5oQF9WYKPJqEn6G+OE3i5AqouF59FQOmahQC8rlPLj38kg1c2f30vw+XaoIX24/pMGIgSBoZqoH3wo0sIIGlA9PWcCPrAtpPB8eBf6x1o6cHra+2+tpIFP4PgBfxZtZUJfo4qxELT948D9ucK8Mt9+ccjIQw6QJcEbrD/1g340ATuDgDkFfx6twSf1f9xvuBECYxq/7ythQQGm+5JDx6Brw4CkMGT3wgscCUoQ4sU2t6DR2ciBjTgtcpenQoZVX9NuL4Owc+dVaDursYVkVALX+shjSBKBuvCYDUZjE5BdNkxdHAUBexyHwB6NP7Iyw7sxUDViwge1t+mz8B/LAvVx/c3PeBBCToB8IUGOgqA3iV4yUg6UAOxaUFHDx6CYS8SorMOue0CCJGAf5YfRhoAI+A1CvwxqNkAY5yAIx2EQmkFfeWOXi+nEdSQQA0ZHMEItiagJArQxDXIrj8nCfQi4HZPAttrIahso9oPQ/2/JwV5JQU8zw+7I4D7/sBn4EO6rjw0FR+i3Z9fHtahzsFvJgM0X+tmVH5vaYiNDGAigewAz+gyNLThnjCURQFR1b9d3lZvnVqmj9mEPDKIUIC4KCCjBXywS4N+otp/Hk3QVthOkwEKlV9PQwXjT7s/zwF4Qf9toAAzFdjuaEB6S7D1//U5FIQu2MevO0rQQH8ZmoXE6B/IkgE60XCjVoq8gt2iCG0S8L5GdxkM1cGsfsCMArSCAnrr7dzAZxCEEpepvB8tqHJ/q+bmJGGts/AcAXFOMMeTwC7Pw0B6CtCtA2vWgonqBQJFSwH0JQK29OB2kvgj2HHXAoyeAIsCQO0kMNECAhFMqCBf8mElAkyBbX1tJQP2RJ/ha0gpAfS9l+/5n00CkrQpq0MZbOdAuxmMvHswog62jZj7BnYQe19b14kxNq2D/ehX/p68HEcF+x3yP7z/V/A/q/5DA3i5A/dzA5pdgbKp3v3/wQF4Bb70WkCTHGRAA6+KL0bFl6FJaFw0ImZwm6igSwbbwPn9RMBWf3sN2JgA/BVh/Rg0kQBgePf6HglAHLFQwqQQOwDjbdVxNZjR4iM6Qa3WxwvNxh0JFb3g/WzFQQS8b/ttKcDWoABtUMAd8j9hf0MB2uDXhzX4CHj03L9DBU3Qjz0C0l4mLSLQPicOOwZoVCB6P6dA7nDbGkVuxcNr8PU2JQO4wX5trEqmccZaHU4q8oCDFOpzAnOwqyMIMktNNNAHouDGxO37DgArQZzlmp/14W1QlqHTMaIIx7SCx0+5yza7AKJ3IXBrNAHVDcMZAU/BT/vgv/ULPOA+XiLggAREDF2g0ci6xNDRglegd7P7TWWH5oJfayliEg7bScQRBVgI4Ookg/F6rvpLWP29swREqA3CaG8/FpKqS8DTAV4TiBqIqtxfzaQRLys5I0XEFIFrPbZRQb+16Fgi2LvJv8EFUPW1gGfQv1T/F/d/HBnccP7rAwnIIyHI4ArgWeGbU4eHy6Tx/EeTZIb5bo/BsMBjmjBE08f/RB0PHYBd9eVRAGY7cHRwiBf8WeCPHY1bgBTa9xKTELzEkQX9CPtl0gJiqsAmCT7I8xbjivh3JGFI+D2nBcSJQJ8agDX+O9iBL7UfG4bzAkcaICrbtYHz1ycSmGmAjJfL3CMgT3tQpmrfB7gxSzC1DnvdhQMieG47u75+kTouKNkM8c/+vq/Q7ZYjO/hhVvRq8F/9gGfhP8aqE9EIdR6LTwJ1h0BItyDqB8iFwuNqASscRnYioxOg9ApvnYA35f8e9Ohbfe8J4rknoFkO0lmA2gmAG0YK0DkB4ieEjiLoMD8wBzom27ANZkzIoU8EMHk/uo1mzeVoEoRWKn8L/62EYAX/lsB7D/LXg74uAMr9oGivJ0CNJCGD6i9DhZdQF+gtOp4S+NODRzsDVbhdgv4BqTMNyIL9SCKwL9/FGPp5oQKxIf8A/UX6r231H7YIqLML0Ae2GtrADOvRQH5b/MPE9dt9BGLNG8jVTAQvIaK5TtvvvWQgDvyXIClUA78S9Nfg7VtIBlO7cbsEYkQDMot+ygQ7QwmOawTHnAM2XUSnJvPIYRYMmYPS+sv3J+cfP3d04JYIXsF/EwMbBKB9Q9AY+BiSwFj9mzrSXmcJhFPVHySTbgHJCPvRQ/z7G/SVUETsg0ZF+i3CRoCjhf7y1A9mOiDD7TwdwEoEXjLwAv+avLE2B7Jnb+OqDpBoAchoQJskxKnss0vu7Q2YhcDv4ySeLOg9GsCKiUIihP7yfW7zbTsBh0TQfN0iAWn9f72Z56/Ax9P7j5OAH/Qvv3/QxKfk0DgDuP+R3USg3bzBC7bO/QT9Eeh9QvDPG7glBQzJwK740lAFFgFk8P88CqDGAa223YckWYhr+c0BPdwetl2ocnsfzePAWcVnnAIp6gDVhDLyfV4nqFEDPxHsbWD3k4BDkN+pARqKMLYBPzYEvxp9xmCHQQdgWH/9EtH2TIFpu3AH/cdGydv1j0TQbRrq+D/mLcX3ZACZ15bF378CG0My6Kq/zoGOQwhASDFwFbxyNGBuSxbCEhQ/uEPe/6gAERWQObCVVfjPpQX+rexxYhYFxIkgpgX7Y/vPs+Pvxf9vwt8kAs7i32t3QCP+3SPaTwIytQXP38u0PESm+YER+o9B3vr8mETAUfDrEkPI80ck0FZ0dXh9U+HRbhey0cAc2H7A4y4egoD6y8JfkBiigLdFP8v2W00E8deT2IeAKujZ/QAVKpAtKI20gLWksHedfgPcb+0+NEHefd9vB9rayi8h7J91gBbaw20MsnWAF5xHkyDUCOoXp+yrOwwxcKj0aL6fFppaaKDv6OpHR5sgx5BAlK/+fYhuP1D196o8e7lFBaKqv5YIMnFQpd0FGVR35RJCnCDaABaXBtgbiSwtICMtalKC+1JQ6bx/PLcDPQL91QFodQNKpwOgF/9eqcBxBBqRcKAAVk+ArQOMx1RYGgB6naDhlK+uQQwJYx4meQbxtNnYQwMjt/d4f3M9ZE4UOld1LAh99fbfzOxiEkKFCkTJIUIMUeVnJ/9sDt8/e1NEJOi9oVHDGYhgnSLss9DX2IAqw1zALUncKcDr0FB5NP+0cBQNrEezDiyiADPkt9qGpwoPdL0AGPx/NOKeyf3b9WJNdfcFv6bKd2cLMJVfJ6Y3B6wB9WFUfWWEwKMfGiQL+3bz9XGQz2EHKhF41GCtZyDi/gUCsNhYoAr3UNJ58YidHKqnMb/6AB5J4N73/4L+t7mAkeeP3P+1LNSB/l0SkMEd8DcEuUlguEw6t2AU/PCE/q++Akw6QFf1u6SBrj1ZnnhG50AfkoGIdf7gJv1KcSfgzWWkQ9U33Z3tHXYASKJ9e/YhU90rvD+q9Ej69/wxYJVs506Eg/r3DkMDzEdDBRGgcZay49XihLA30P+l8N+hf1f57/0AoxbQbwYaan/rBMirE9Dk+sBzTkC8JNDEUlv5McB8PP19Y01Gayep+hC/2zvQ/2HGLAurowsNGlA1cnqGGzeH5weiYLZm7h3QQC4O2tXdhvMMk1ZS5ebpgI8eMrPvPGkwaxayk8Yc6PMOBPEdC1XZ+2UfbfOPtxLMQQAG9BcZFoF0gp/RKjxe7+oAw9T7ZPWhgedodgz0gf5KBtrtIZhQAZpAV1Bi36w6t98qVfH7hqGI318lLCjLCUFlxRHwqYEH9a2qb4XjWvDT7kBwfbZA5P0+PNuRuW1yf4yNQH3zzwv6b70QOJ0G9OT/dhoYRUGT15uQH/71MjQLtQlxfDuiCXrtM+SkA+icQdH6sU/xz7Ze7FlubV4TpoTQ2osdpaEjtqADmEU7OkBEFoLeC3IWFFeswJXKXzkboNL+wzcFHU8hTGKIboO7CLi1/P+5F+gydQhuvRbwEgxvtACmANikhLTbj0gCYk8KdlYgmj+4Ymaod7TwahwadICuX0Cm2fE5iNHPK0x/CDV66Kyg1MnqjNFBnhBoLQCgUULfaVe5nq/6EQWY67bXCszUb+7232fVPz51iGB12owK9peyP1T4raMFF/OEYJP792mgXYfZ04GHMAhBkCSmSj+dKqRPgVFGHbpLEGMiGFeQWfSgrY52VxaeDUPSNJI0P7NoisG729HHl78z6hxfs9rV3m4JjgM/lsui2qmThjCfDFSb+I9vwUqG5wwL55U7C+6ot8B+7N2o6r3q37T9trfpjgmTvv7PSQATLLeRAOZhIJHBQfDQQJPBdUwEbVW3+L08EcEE/9G4ANrCeWcnPKRHDupbNynMx5AA9IRYLmrc/YLSiD5EaEBS/s/TgnU9ILcH19n+CpHwegLejx7Mn/d25fdN+e9U/1vgb7bqf08MOtf8EXxaoh+GY8L6gDfhvs4i6HQ7seYI2sv1GchdMsBIG3xlvxcCRzdgCPTn+6q/TW00VE8Q9FaFv+R2VlOM1vm/hhjhDCdgNflVKME5B47I9xT8z0YgPAJ8myb/LqHy36j/Mwqw9AALxuO1JVjiuQAYLcFzIhiEPe05fk8tRjGw7yWQbsfuLAT2VqOId1osnr0F49VM8INACPHDoBz4B5mqqSnUgyh3ArjXxfQH5BbgUS8gP7aU+w0zHD9GGD0CGHf+P1p/DeivlhU4BbxR9a2kYFR58YaDZCUR2P0DMmgED2eg77puegy6PgDphEB0CwlG/i9d+/Hs34pBEQrBn0W51mqGnJAk3ACCHeiqkQ1XFQA5AlKH7Lk8yJKWY3/nym14h2C3JvxeMwD9ZVMz0BPMi1n1RbKl1cYhIVblF3G0ATsRiCMUvoK9//OgcwYMoe+ZKOLlC6/Xk50br9NFz9fanqA8UIYSpCwlBO4kHc4WLLBfBHVaKwKgLQjmP4Un61Vq+3s7Bsyi0WztmLjJwJwFeE0I2vD/1Q6MVwefxfUf32skCPbCnxQqf+QMPEUDHZ7vGeyj020JgkPXXwsldA7SYR1RE3h94NvNtugswcgxXEkIcBPCGZ1rmrgDC0A4K88nm2fn/eTnpQtWyZfybRoK8Dro4zYDIMGsf7saTBzvX0SMbkAD6o9CYbsfMK38cJKD9l2FJt9/VGs0h5Gib33pxMKWNsigFUh3G2un+/N1WUglI/EEx8fq27vUNnwsiOoKecL7kQS8VnWAGCFUgn6dBtQhv40CmIYggwK0uwDHRGAuBXVdfwzHUjZzATLMAoyJ4FmBhzaWBlrHld9CCWpPHRqofBqMReMGTJ78q9rDes1Tv7/0m0v0AFHXNR6P6g30SHivin7V1BOhh3iWPwvps/yE836L2XiwnUT8x2iHgfqhnwn667QHEE8oLQjEvtEW7GYBZDrDVkwNIO4G5GiBDf9fGoFM6n+vbEtzXwP6u9AduaWnGYSLAlVdl/AU+ikrSeEIKgwdaZ4AACAASURBVKj4/wtgHcHtdO2nWKcBkPfxcvnNQvsj2Me9f02r76T8q0IBn9OLKfz1HX8yVXQYGoAB/2UeBQ5/5kCL6+H/OGGoRnLSwdd3oH8r7KkGTbgIxEwVWvnF8KOpHnyzfF9Jod5Px+IF1h8owyitDw/XEgRb5bPqbt1uvn7qBIQ16vtS/u+DP3cR7CH0WWJgd5mTJKYgNzoGjQrfvu99NDBC+bnyW1x/qhTatv2OaMKgJWPvv5kwnMgxHYGFRtJW8VMl3uP+MgoqSZyWFKr7+KIDw1d6+IiOgZI4+d5iYL3imzbgyO+tph9t2oSBxOM3ugHtPoFZ1LM0hF4kXNEBssvVgPdjdXZWK7uKvyS3q1Xb1WQwtVDqSUggq+Vw3t56JA2cz7PXOwGNW1ecwxPhfe3QEUsDsFaAz8jg0nf+iZMAHNg/XSazDuC18Iq1HBRrOsAQ8NLB+16g614jmuSgs3bROxE55D+WDDQNA4ivdMJ9M1b309UqknaDU8ObV9/PwmMPATvTMAxpABLBzugUtV9bLdhNDQA+7B9tQJ06/7QNDHGSwtgZOCIA47InIoDdROQGtt0U1HI3GaoUnCnC/rzBMQJteN17+VaAzYNA7e+PFqHQUyXPUYB7iQYa5ZFjq1Zqpx8Uqu/XT7+6BWC1Xaj0GlBIwMoHu7UzcI/6/Acb8KIq+hzmGWmAYnADrIpvKP7TZeLaf0LAeQkGgebbq9FToI44p654F47tekKkI0L5PQNZPsDwPBpy/ni+wKMN76Vav4+2cFZFf8+JwAraMt0DFB7beA/u4Zz/a+RXx0M/ct4/jwaNAS8G17eSwmta0Fhx0VRxJkHMivso+onMXr+YwdWKbgioy1jp4x4AzIKg5lEA7wvHEYCRmdx11TAuT6lDLVl4KvXkAET9P4RT8H2u+lg9EPQIpw+/NpJ7RwE8HaDv/Mu4f3OdNkq/EfAiEiOANjEALvcWL9gfFV4NZbgbQc6qPky4Pm35QZxtH1f4j+P/jXuaYPcWwIEH/fmEPBoAO4m4LGxV3txOQqDU+dXgey+UwSzuqP++uImO/u/6ogCb7wTc1n61sL+vZi87rxnrNas+giTg6QLzaUCjIp6JfhwtGI7AjBBB9JjDY4ePYVR6ZPgN4owVv6Q2N5hhVHwNeYrM+w6dN6K1sMHZm/Ce7bHe3dzKr1xw1w4JrSQMZtgnoQHlr18fzunAszD4qurNUg/TDqzx/lfCaO6t4tACMUQ6P6htWjDPC1hCoZ8kpODzJ70MUR9AODcgwyqyPhmE+wfHYB/hvSqt6qeXUShhXH+d9SR8DzrDaZZdpSp/HxqLMQuATgDU/qDPRgOIeT8cvz/h/XC6BtE7ACLOWPE0KIS4UUjmZaJ2grBphiWgT41BUVWZfP3AnEIT6OrfoF122l2rMycBoU5i/OXoUZ4/aglsXwLzHNU++FVF3qikOj5HXm2PBitT1WuvJRAB+6O//W0/PY8vQH5IrAsMs/WuVmAdHBrQgrbOxJShXwRSsu08h8JMBpo0+aDTALwV4tbswgzHrftG/dJKIAQb5h9KCssWIMeto+GYqG12/HWGjx8kzqNJaa0noMWOr2KwW01AMwJoNvhMQda2/RKQP/3ecABM3g9uD6BY68Ntz9+nDOMb5iV+hIE+dP/Zs/wwJhJ9mgBnohBuStABUXjugF3hkXF9ZZJAjefKdHZCc389LoStKvIl7QIEb1d9RyciQgFDI9Cjyccc/23Aam7/PZJBhgDgin5CtQvbCzX8ip9YgIFtOAt+w0owp/hOiCWgEGbVHuYjRigPGR/YOnEoqPDoV5z5YqB3mRq2ox5ICmSSgAP1Ne+XV2NE+/vuFbCTRADxtS70VRBCjgBk2OyDUQiUgfl77b7DwaHm2rAZ7osRSOOUoHgKfNBSLI767+oDYrfwZvqChSpGfj3pFwZFsCJg2jeIQQBUiyI4WgD68ww4qO8khuWkkIuDrxWv2nv+UTBpJYiPd0KemTA8qqFiuUF1jWS3BoG6pADJq751JqBI0wvAVPyMQvjcX1zbELltKK+zBiXRFiRxG+b7q3M9xuLdzR8g0gCGNzSM5gNYfqGO9CBT8OHct6oB3KsSDBisUnwsFuISQaRHxDSv0vptt2oeLHMERfRn/FG/Cx01EpgIQG8LP+/i37PKw53xn6sYCM4/JwSRrCnIeB1ZkLsawDhaPKv/njU3wnZ/dBdGE8+YTHSG8+ofGgIjsC19YnwdM/KAnTSsqj6ig7uGgIPw3nYFzhhIIvriAxFP9CQd4HSlnzgxONIdrE7A8ZDPx9fjib8ifgegNIliRgdx95+E1T7+3nQVNNhEzDgGA3T2rEDLduwtPpuuouPcs8swwXFjdTaMKt+jA5gUAQPcf95KJQxYU0cYxEDvsBSmYuukp7AwnqniC9Afa5z8vboI68ImT0t26CvwBzSggkj447r9IojvCn7U92J/Hw0QSdwZKNNjxPCfSxRqnATkdwpOwh88oc4J8KTSm/wdbZjrc+4iFP8YO0/5JJDCfaijK5xVXevqfg6zGRrQf83chvX4aRfAE//6vv5+6490U4ADdO7QgM/5bcHP/n4OtCQhBEFeDWSvos8DPq8/IwzLzjpa8/U6MMSkBklDm8e0mn3QIY7XG1Om8wzN48y7HwhOK3P0/ZwUQHHv4psbdoVeb9VlAjChBCdtDDpOKTh9ZfcagOYq31RFjN4/gwBYzp8lAwYNwBELhZoxECeZxMlAzWGdCRV0fQWGHo8+8Kx+AAxnCIzowAxy9KvNepWfsfp4RR9kUrD88CPVTuXRybhqqTHcnxEGndsgub1Gdug8yz9fHt3Hpl57x/mfCOC29FOSQ7/noAZR5W3Ob24UMpuPYAYiQrQgk1gnFoUIKr4vKFpV15pHUJO3Y5rfH3UFHU4bGkU+NKJ9f2hJyOMxDBDpjAgwiYqvk5TqNl9EH2Arb6fA3yaA4cBtPWewhkEcIQJBlGzYp6zRmr1v+e3Fv27xpzvyI44NGDkCIi7CGNV9Dw0M8NtHC2vUwHINumCGNG8erxOwtQINsW88Tlwdoc+F85nI559ngEDpt2F/Uu3hiXYrkN/pBFS26hYDAkFgErMK67y9mGBA3L5ore5izf8b3n805MOq/t7XU4WHv1DUF/5gugCSOAIW/59uMwl6CHWAib8bvfxWl9/rBGEMTTwDfG+ezEYG4yk6FvRPuPwE+wvc39IRjENWM+/cm5b0W4Pf4WuKUnw/vD6eDbB1ETs5vl77Dhnm/51g6wPWwQAqxnivgQaeS3gy/u/1H4hpTPrIgHAN0mSgXUX13YP5PMIuQAfBr/f70cdeE+QoCX3i8nFMLcAjInBoAIYqt1LhC1WdtvmSab28AYffaeivCB+ohdYQgfUa/WS4ToMsNLHLc9nnvPZLwn1/EefPVf+U/xvnCVSEQEkEQEnEQJO7S7RvYDxNeNYKrG7DKMhtsQ8cMmhgPKKKj+F7CiHYFR5KIIPxOmg5IVAtu3ACQSPh7CzUQOgAej5CWEkIe3vgxz0ROGO//qYfz/dnLT+ZxDr4QW0eNCJBorCFOVC312Ec2TiY5Bk0cAaQmiA1VH1MOwDHQ0kHdEDDf+2UTWhS4Z8diQMicLx8MLBfverLcP/jQzF0P8EJj5+NGK9RCz755S6F/f1+X/gxeP+Wsedv+vF8/54aSPJYFjIQd624MDz/UDLQnr8HU3ztKHRf8Qeno1vyAQJBaLcMtTV3cvgP56COCqd/QP9xLgBkH4BxO13n4hNUDtACC6G1S3zqooZ6Ba4lp/zcAFb7iERKQwQcF39IFJjdXECGADw0IE4gg674pYAnk4HoHPx54tD5daO5vxrugSkMjgiiqc7TVKAT6AT8R4ckbHEQCYR/IZBxJgA+XZjsR7vaoRpIxWqeqfXuGC2CxwudicwePEB1kNkaZCuwyF0DuKv/4sz9mzP/Qxdg3BDkBTMC8Q+loD6UGBzx0Kz6eAX/KArOQTlPHFoI4vVtf4rNuLrca9edRn4xBP7k8w+9AgZCgBfEUZWfEs8iFNZ3UO7TqmkjCO/rWdgco/yIqHcQWaC2EGTzgz5y/iXQAvyx3riyxxV/JeBriaGB9OrTA5g9/eokM+37GszqfA/UZk9iW5UnCtBqBl3XoNN6Ag/+zy6A5evPAp+TIFDn15gQw9rjrOzFX0s2JBVAxa/nP1a6AsNWYGjPNGPLTQgBsNUFvOA3Ht9o/rGDN0tWOCcxJGp+f7++kkP7PxcGv1+GjkaLt/fawpwwerQxBJNW4b+PJsYEgiAYYdEAGIlDNaAbRkIgK3ut0jKByp+8yz23X6GttmBmjwDvChgiYLP5V/zhH6/110sGcKo5CkggCngxnIPoPja0j2B+1BRkiYJiviaLJqghDI63G2nAgAxMCuDdnoD0wIQm+urMB3VuAwbBrFGgGgnhAFqg9+ujKsLxB3qGCQNEEtPinIQlAj4WgIw7/iXc9V/x/yUWFs2KH504bAh4aYWf4TrTLGTy9YbftyLeVOWNfYNyt/ji29mQnqMAltU3ioTtbX343yv/1u0YPUBz6zB702tQucnX0gWaFh6DgPdmhXaapGotw0SFz1qDiTMdd8h45HfcqCPRUhA3+NmKz1l9teCPaMd4urGaewRitNBDdahR5c3AfQmDCFT9vmtQEwqAYXX4XI2n23Z9B/Yb1FL+LWox6wHGbZSo6FR1LzyG+3hriSZvWT6jfXhl2cmQZJDrAbuYAqAHo1GA/EOgD8eGcU7A8eDvH4fQBuAhBL/Zp/vamPTrRENDGLTV/7E1WEPLDlP/PwzU4YhusIMUgfIPAr6Dhv5R4y2r8ldFwiFoYHnmr8TAHbhRQSZOctH598ZYhqt6wP7q/ouqe77RJxvzFYaji/z4vna4v5cUMDXqDAJ5ytktqtBDckyjvJg04hl16LB0xFfyMfD77PZjErGQRRjYIfSvoAXntks0ok8MsUC4KARWnYPlJBeIgLeFrUgDOHYCag0/XNAbWgRwQuLAsaQwIhC1g7+jCNKuT38JfnYSyTi+QQEwwHeT4/dWHYxJPxfOj5oAnRQqgU3YgGZSOaDyK3n/qkDYBKptzR3oD6B4fyRKjp2AzSl80YR/3P+/1vBjX18Jbu+YsrMRgbqPP8zrDLTAaupphfeZtyPs9BPztpLSBZjowF3woYRwBwOWaqbev15b7X4RWsiqYiY6ZkFEIoUwUA2OrkeEQE8HYNyD/rl3m88jCGgO/nPW3xy8x4Q/HBcM1dYg5q8N+B/SBSYhtD0EY1PRGLDoKIBHF3yLz4H/gSYQJRETgqeB2d4vC8L2NVnQn4PoVJJAcP0inahAfdXVI8CFszjRagCTtRdV7Sr895NBpRKXIT64RMFw/iw5eChhEvmmyUIH+k+Qu3cLzOAN6ILlFvgWnx3YWFDz0f38ze9GlfP6UQ3ojEY0gtqRIEbA5/WgQFhsEuIeL75uTzvqHktAWfj/OD6sQXssROcGiRgFn0QVkld7OznMDT7CJKzhMIqxW9B+LCOQdH4uyxIcE49VTSeLj0wKjzcp2oDXQA8YoDEGBLMW0BJw+eAxXejPV/IXd59/tp5rVyYXDw5BlRetSpQAcvgfOwVM8ObzBq/AQ2wX4lwkQV3vNhYFfn2LFgaoDU1ogqsfqGkJYmrj9Tr22KQwBLzbLuzDeA9yzyJjVRfwegWq0H+FThDPA6ZhZwX2M2Kh4waovCzAWJTzD/qY00c+6PM8coz08VNqglzx54LfHuTJK7z2rwX35ABLg1DzsZ7Qv7l/f2yXDlbf4C/irg0MJ0aCuD0wP74MrxfdFlX7tq+vtRdCpvt599EG9Yz3V+P+Oj/n4zLruZHcJ7oMt/MNp9eD6HEeFb6/TMfbWo85Pb79HJo8t3371/PuIAZqMvjPC34nVV6ZB4hEuA7AzA5cfU0y2n6ux89D/35/n2/vWY5Bf0qwf3tPLISO1Tap9qzFB6eap/beqI94NCCbGwgqOItY3CGl446CaQ8i2Q9g0AvmgJOnBoAA0gu17tsKtKS7D4udgCYERy2QIceCX/P7mBW+g/7D9S6Mn50CS0eAoQPDcBjopIA5+EcxEjLweRjXq0UbLIjcBxsGx2IZvlf0ATjz/6qypAmY7bhrk4ahsIis6ccXKHdueAfUgk+RWPCLh42c6zEeKyJpRTdRAOqBbl/Wq/uT+q+Fx3FoTIuCzc6+hN8j4veGjuAnhSE5gKnco3A3XwYlq2sq+lmP4yEOpqEoG0M+mGDYuYT0pKCFHgLHKt3T7T9p8GcWH+n1UwGa8X6kQt2x4CeqPexegT6o/Z4Cr313PHdgrsS2ZReLfpKIf+IMFnmVmwxQ9AhithYT73+p2s+JIVfrjwiHnpAZrSsr9CMstQXP1+1+510N/q8E/YoekMN9OMFvi5LvkRDsy9rgFCOoPdpgaQIWBZjf5KCSQszZJ1ivTvLokpen6tsJAVND0NFqb6GUGg2Im4Dyx9Pn7/0dm4pADAslJzTv+dKNrAPQ0wyySm7bj1RQgbAXsRa4R+mBJzpaQmHLmy0BLoL+Nh2ZRca8uUc6P37k97n451fvTieAE8BdZ2ItqFEK6oOJIYPsiU4woo140Oh+H/UC++gatHYcOFT+2y3AYvD1rM/fpxdUcsAi70c0OxAEP45X/hymE9XeoC0zfYhbcqfbhs09HpwnKMDR6g0mmYyKth/UcLl9ITGQ8N1S6s+gA1HvQCc2pluPvN2Br8SyZyfyxPP/VhCi1L1HWX2CQCuAE8TIq/sBYdANZmTIwqq0sb0HIzhhugBeUpBZLFyA8y+EErsBUYDZHYN9QAAooQwOws+uQlhdESSSqk5Qsh8LSYI6LDS1AbmOvLlRBqQIeITvM36+TP63VfE5hFClCTr9zEyVFwS3STQBy66DMHB+PJWIrfgGnYBx2dTboPa2X49GaBVlePA7CFx4iaGi4ns0aLVjMGvtPTDtmO4XEE8E5Kb/8qYai+NHl60LgAICcUCoJPVeiYG6Pxw/X9VFNVbFn9FNPzXoIRDTyzcpREYB5Fm1EQQn3KRi9wKApR8Tz48SwxnV3qM0q7ZhpdKvr0zfY+gO4oQf+EGPFYW/Xf5hwWsUgxiBbShGoGIx+D2eH1h2EeR3UQMH4zMaUKr4033nzkSkfQADelFbLOQCalxdxvN8mInhPas9bxtGJw29Fx3Y8429MAS0fL33Oeo7qFZeiToCC3B/VSNYuU0fgDnkhxGgMFdxiYEY7MYel+OHPH30IMeVFK1C79l+QdXVpFqHlMAXEf3EYDyfkkGdNvJ8f3RAXU0jpgM7jMNA5yCrtfzOicKG/M9bgEkEjqqPPDEcDfqVwGZv6zcO9avDfOhf4OmLFd9OLBHHdxp51HvOBlnAoQksYjASA1xnIhPsapTCPjbsGB2YevpPpgM73EYeSYIftgPgte6CWesVBB9QEgfnWYMgoeC8ql69bWoRIqYHvSIv/u26bj/jdqZ9KSGk74JRo6QS9PuTiSHm6Z62kLUGH0UO4rwWrhtRETkR4iKRdI8giJ2D2nUCMjsA0TXiVDb98NAf/rCMlajA9wesWHZrAe1dlwRyVI2jx4KkyUHSx7YDe6YD4tOC6XW01puEdAJwaEJzf1uATHi6ZlSCpBQscsh6C1xRcWEG4bCFeKcAVhVlDu54JQIkTT21hptIT/Afk0kMcS9BKfjBJozcDXCrtgbWXxbMAw3INQIxtQJPAGwXmYaBbYh4SCsuKwLOAQ5awKskCMmRg8P3xwlBfbosQaDqyZqBkyQe1CLQACoTgN4qbyHsPwkTiF2pYaj6MAXBmUosQHnUEYCsBL3MW39SNKMJ5PfoBsT33DVJCEbFnBCMOkHfvj6Xq8uw+dgRIhGgAiUqf5QgKDFyhe8nnYrlqn9sG1GoAfirubygX4H+8IM1CmQrMFAJ5ExzKIp54nPoVU2Auh6eBShDlTV4u5c4HE/fVvjFrsII0Ik6QX+Iq68jB19ziLoKC27FYe0gC+j1RSS+BgB7AvAM3m8HLdy5fV60C8RMVuhD1ieQB32MCCq0QPJuvuw5IHF/geMKwOPdpmsxBwVEfGEOgeincJqNmuSFIPhPq/xM81CWIIi+gCFBqDX3QPYd2OcCRo6GZBoA3AM+00aesAOQ7/2Pe/vBCXoguD4OBD1WfPwClzcui12AuH+gC0gEwW72KfjBCQRBr05D0IQc7N8PzOCMehPWK384MPVDJQim7yDdoiRTItzzFV/ZOX9sYFetP0fsQzb6O7wOoFjxk89YoQXv+BmSN+yYHYO+BsDRAXHhuJXsEFbdIEGZQWUkNVNzGA9NZUVBIQL7jASR0AclE4Pb7JN3BO72mG92+o8UG3nybj+mASh0FsLKn9GPxDrEcS2Au35BzHO1BksriIJdpqWjKR1wlpR4fN977rZqI+XbYjYDgVDpcYQalOYKMiuQbB3G6Pu/HlMbi9a0EMkksXtjvvXTfgMKAEZRN/i/O7yD8Da2S2Bdh3ICWfp8yuMkYl5a4df4vVWt4UF0yyqEnaT6swYyWB8/j111Y1ERS9oB0SLMtBGDEBD1PEHwtdjUEAHnqmoHU4wCDAoAS+lHwtu9eQLUAgmxVvAuMB9cELMV3m8EUtcBYYI9nkNIEEJYrQeUHfnzzRyC39j8CgSkir/E0P2odnAmAqDnDIhqrtV9BDNS2POjv/0pwKr6z1h/PMz3uf9ykFYq9TtoAXSwpz0HljdvBCVAPY6t7osv6gFhMpkX13rcfXQMIpuTsfTibkfOPRAC2meLRipI4mDPwMD5x+v3+Ey+qEfACwoUEkKQSMZxYJDz9R68PyP43yvo2aYf881rNQbZgRU/jp80QnW/hdXqJxMvCFxXQSNHpE8QiF4XI+wFfQcw7VL2Md7RRajsKgh2D+6SLAKPF356+/7yXYBTUgFy/38StUjFHweD+iiHh8/LV/i/TSvGk4L5x7F6AsIKbgb4C0YjgdGRIToGUx7cgS3JKP8pRcgak95BJGQbjaJdBYQ1qHYnYHL8F45QgHx2gLMQ2cDxBD/4SeR0LSDi5XzPQNjM4ySE/HGG6g+ugltLNSARn281BPtNO72eJLjdX4ITSEgpQvJYFEUg24f1qAYQNQdxx6Q/RcB85j9f+03zf2QV33IDPHegNgPABTfqFR8cZK9TA7/ll0EQbUUHW8Gr1d+MSadia+LRHwhunv87yWoJ3h/pRDwJAbDNQQFd2P2mH4kP/wDT/ZeN3CK3+ZjvgVpw4r20AMafb58j4N1UMknuj6iCx883PU9g2VHVH5JX2eEcPghSgRBCKPzK0Q3fknwPN0Hk0CyC0zBkz//7duEetgFjVtypASDI4CsknYJgYDhqsBxxy29+eyxrAZX75EEf8f+CkOcijMDDHx4ASYGGu8WHgPwpHJc0qOG8FgFTuVk0cRZVePFwHEIUEu8xSHoL5qWg4I7/HgOKXe2dcnu2SSdCGIDTA+AcxY1zYL6Q6AAFu+/1GvjKPSeEoJV3NiM4Dz9C6oWkEav+NWjPWXNOIkKgNTi2I8LeBgaZHJxqrC4oNXoB9pzzMws/OW3ghSyQJgjbygOVEDhoj4nHLld8HPD6UUMFVLIgKrTL7cFoBRLQgEdXIseZ2/HhFPKbk4d5tYWwwR0nIFQSD2P5gQhs6meVfB+Bkyz2fOIvX/zxqsSODuAGIOLtPNnmIPCrv6Kqvgz3q4tCwNl9lWYfnsdHj2HTgQw5IBHwULmfSu1jEV3gDFSxTBmqSEVqiYK2IkWcRiAkwV/cyW9YhqHXDw9dkNQAcO6HFNJT7oChfrPUYc3KY17zAd+evAwF2w5SCKLV4EuCEKsKfjBVWHu9Q9Arh4CoBqEMWYBsNX7YgKP/69uC3M7/mOOz232QT+ox4iCyJGEFP4oBHd+GVvXBwX35nqp7qeIbV6L6tdZub3ueJ+gBIKgC6S5gOQFxDoGr+Bv2nzqbknd7ph/EmXzO0o+kZdc/wqvQkAOUffVMzKtYgx5Vob1/+HAfCdzHSiXHenX35/2JTr3KZ9Ruj2lYiMhLIFoNyMq9hFroeYMTE0bSLbhb4l3YlFPa6hMd2jk8dmrDgdQCnC4/+ANFlYTB6ATlx2GDGXP1rvL+SnWHw+cJes5/rRWt4H2pw9GklD4uSMpwasIQiaYR92gIyFX5S8dtRZt/nCAH48VXW3hRE/HKOsGquj8EM85Q9cfeAV4XwNGAlmIFIwPYrfLKuxV476RRetzcdeAsRSZhiHizCKEIOHn3EMOWy5X4uIJnXX6sFiBFLaBm/THOQAkVJK9j6TKwiSDTBWpwHkSPQJX7U959uAkoaTUuug6oQCBz1Zlxm0OJSIoIw04M+7zCGuYiznCfHww9AN6Ir+HXA7lfn2oBSJ2FOOh8SzINfmcAyITq8JX/sOMPx6A9LeYtVfwgCBZhdu25OB9/XmWWNPUEPD5dUuJ68wd1AqD2+w1PI9KxE9BW5t3z/igdYGWiL7L+wPv9jgVY8f0ZcbCKCuLAHN+c5wa69Zpr0J9t2KnpAGzyiAIPiFalJ8/xXrrA6Y+/8NoDnWCPNwFJzf5DpVkHte8hx76P+HU1+HEytEeSEIzAsu5r6wPJGu6oLz8VrKofXLce+ywIHhNa/Dmw8LrptWXZ4NKZm4pr/QQ7Qk8ehMrPtAF7PQCD309QgRgRZMKgAbFREAfBBXNalbHA9cEHMo4IgIUuPjjBWEUFEQpYTkhVO43eRiynJw9Jjj8TOUIlJExK+0wA4gWgQvcFBHAc7P4/u78/Ff4CC5ATB3P3oUwFClYgcALcxzp/B9Ez4DUV8RjBbsCBrMH4dLNwIDaCGhA6o3pXksdBvYBsktrXDgNJKAFy1Z+ZGIy5NXgXoBT8a3ZgVSPIUAMV6DjLxhsV8wX4n4ibbONObHNyCr8Z4FinNFjg8ziiF5zSV8A99u7Zdf5OisvVaAAAG3VJREFU/kIPAJLWX3hUIFD6o7MD4WkHIMXBk4IftSrPNBJVk0OoC7ice8HGS8XBKDoz/YFBLaQi392lGpCMJfhD9xVkx5Xbj73P9V4m1j0v73x9FjDDPlYvATkgFAVWcdNvJBamliOjAwRV0EpeRymAe717kMYRyy/j5FwFBX0fP7Dyx8gq8wn2ZXi8GfGYR+lFcGJSxa3Y84WgzBHetlU4cvKY44Ps4iP9fsgsPGEhQTAcHqwwGCj61SoPexKwasXFqtxq8qhD9SixoBBYcJEDNzmIoi3J7QkoJActVHocTVpPBCDhElAvMDK1PT/Sq3DwB/ygmyB9GNhYDH4so4Foy48kkPtZfZEv1PQTxYpyX0EI3Bu+/5krcN8fgwVdwWu2JNVNWAk+PcOOPMNdGFyAZ5Aj6gicgzNfwuHZg0HrLxBWfjSRl88fVCo/apX/IBrIvf65ZxtEoK9Bec4KZIPLe76osQns46NwW0pUPCPAyMc4A/KXOwZzFLGbAqD5xhhbgBcWfoJBAlarcCSQgdQJ+Movnih4gjZQTw51rz588y/ZgxVUEAQ8soCfX8OR26JwujCLGFAMsOjnwGrlPuQw9D/PPv8BYVR7pG/eeFtQpsLzR2KFI8SwKj9KlX++HeLOPuSBKrKeHBi7L4b+Kx184+ptAp4Trcscv69oARVYzWgaK01H1X0K3zNSmARKtxXYHvwJuT+8gLGGWgpHcWOmBeljFB2Ckg6wiAYOqfxEK3GMCAj6kIiTWdCBCXhkjUKMgJcLk271N9uLSbtvvK0S69OXAvoA5z94VsFubbmZvx4QAnXgBnJxENyQjy38wef81uPhxMpPJIQzr5ckuUTKe0wZyN57iFTWga8GvCwlh5UqvYgmaNV9XSxEVWs40kkosFwA70RgNOu8mLZfR6wDiwRa35y7j08NksqPQhcfkRBK/J8R75Iz+9C8gJpqzwiIeZII3QnYOkJWbVEI5jNuA+o2BwK82ifwnpSgHwaC+GNAdmW2VXfC+vPu6wR6lBj84C9WfvivZyUhZMJlJhjSukDlFJ3g4AvGJfC1iEpQJ/CaEd7G9wds7p71+odruKrHip/C7RdsxeVjzIxhoNkFGOW/+sk/YVAGtltfzZAIfzix8gcHhZCXpcGN2u69qWqD9OlRFAy7x2fQBhHUiETB+DocqvArYt98f+AEAXApsEmEcNLC0t2uPHCqPQIXwHYDfI4/9+8LMpchqr5HK39MJSrBXwnutNqjovjHFdq+fcHLp7YLR4mGgduW5hFpAXUoL4cTTuW5HJSkB5PC0S7A+8c+837DyoM1J9iv/po/o3BunlDqPjOSO/YbLFd+FGy9sxKFeT8b+nLNPrkAyD53FtT27yUS32yqUaEGTMBiASGcZ0FmK8nWxbvjC1q6WQC4VdWdAcBY8eFoAzIrC0b7Wt8wlPcIdE1FhUWeKU1Igv8Q/0dl4k/NnYSxdlDon8diUDeuQB4c8XVzcahRgyyZmNC+LAgeCfSVALde8/t1DCYawNoePGT83wlOpFUdOZKwxn89OsMEf0X8CxJCBN/dwKbFwkSMgx0ACJJDJD4iC1JEYh6XcEqVHpx4+J4I4UiAl26r5x64sttvSlAn3LBuQCz6edU8C+J5epBrC4YP52EFDgHrCw1B0eU9bOaTgh3wmYvQV3Oqqcf53XnVNXUBELX1xtSgFrirlII5d3HFulxBCNEfZx0h7K2f34XwdHpuYQcguN189Ow/nPXclaUcqMH5leCXjKOjbv3F0a7i2ZaRHmBe5zwnhA9S736ZC8AH8LHkg/T5znYgmES1dtuzGo92qwHIquiWX+4KgVLd8utv9Ml1BQNhEJW/FOgweiTguCUoQHkEwYhjfQIgm8eAzPKzHqAG5xGiiPyxeGRRaYetUpDVpHVC1T9bHGyaknb/TQTnuG7rDYwYCUT7/cMjtILzA+Go/FPw581F/mWeTkDuBsBCAK8ki+A29nMzPn4Rzjv6QV7xWW4fzQFUxb9jQQ1qc28kMi4mDl1NBr4usIsz5ltZqNm7AeJXfuTHd7nioLEyPBISU+8/tP1AC4Il/n+YGmjg2NiBRdl6yCw//zG5ph7bqaBuz8B4VMU/TqSsNPbwCeZA1cdxyG9SgKzRZPL+GXFOiH1/SFZ9wX8M3zUgvH8a4rMBjZj/h1W9MrwTiN6MlsCKiI4gycBzgV/xUaQGjGDHwHiYi0VIzeEAasCpNuL76AC7BIEl7i4AIxnAfoMxk35eJbZ68wWEUChs8IPz/EEE9BkUoNA4RCWSLJkY1h0Y/dG9bVCtUVPe7QRhtStXG4nOECDfUxc4Uw/Ik8JkA9o9+a83IrfHH11EdFUWc4phNgVFWkPsIHBnCvCCYBSgqEN9qtoXuwHhByYoJJA7BxIkkRwpDGgAHo+vQ3ZGOwCFJCJKUAx4MBpFZWvReeLgtBBkDDQu2OJxXa7SE/P4ZiUPHABjY1DsFIhPAaygWewiXK72hHjow/k8gCL6gKES8qcDZ7A+EhYlWCPGCX1wXIwzkQEKt8cP6iqkC0FEhFj/ZYtvXCtwuBLcDT5wXN+9H6ZEIkTwV/x/s78fXFX3siWHEKrC3tw7EFZ31Ll7ttknQyEMGgAqCaVe1bGk8r8nFWCQQR0h7CY0dsU/mIeIuA1AGCo02Q0YVXxub36sG1Qgfo0CBBUXxap+ECFEycQVyViBEBFPt14TK9rZHB9EwMG7DPXOv0OVHkdtx7OSCXfb3av4CFZGTwQBwT7/hKPHE4PzpJ4L4+FM9r1n8B+B+9R9I4Fu9brYUZgCunZWNxdQgIs8mASBQ4F8hJpEiaf4GPihk8FdAxin/kybjZjTj+mAQy6ihZ9whDvHAWB6BKrBXQr+5SBfqPaINwiz12UIwoTmbPACZY/fshBBBKNlW8ZCHwH/cVKSOZMm4Mxk4OwE9JeB+EFkn1IzcPQoiSB4vGgNeJSoik1A7m0TCmE/HrggB+/1M12C1Z18ACGoIeH1pH2IhAqFWgBq+kDFEWAvA3X8tpW0cnSD5WAOriOHhnYraF1eLTkS8P/QsHUBdtMPnOrMaANJE9AZiaKWII5Ue/8PTHn/UcCSTgIF2xN4zdmAQYIAKeBFl6FiO0aKfq5jcImHfPwTxcEdRmD3LcFoAva1Hdjm9UgGggI9YOoPkOBYLsT8HlG3nucMDGkOOJ8CkNOELdSO7D5qqAeJYBb2GpABgRi2gxLITgrOQ9C937HgB+0i7MeRx3gfPWCXLtgbLJAu/gCFBPzRX8eADJqCvA3FViC/BlOQC4LZyrBq8BdQAOUKoKjqR7v7EFfVFMojPgEoSlJesNIePyLHwW9NRgq7E6HvUN8A0yj0wyWDHRZ3J2A1jHdMyu3hCGwSDwdRir7h9VP7AKLgPoMCgKziOFLtrUm8aIFHlgxYfz8WBYUU55iAXauo+evJaIK/NTgRJM9sUcZRzcCnMdNKMJc7usnAyrpxHYkTRHK+n1HxS01LheAHqRWwKIDqLvQC0+PupHZgBawfVGsiniTVHwZHRqbUI/D4Cd+ftgyLAR1ehkIiqaKFw7MJEwUIuK5zsu4svoFYCFKgBJZACBuppOId2RDkPZas8H9kULcA9a0KTCQDGtpnzT+RMJiOGseHl4BQ1C29AWUXIIf/OIwwqoNEK3SCuA7FRiBrE9B4/PcrGJ1OQNj83F4Xbol/TgVHfMiIZLAdcaVkgh8sLrd+liNQH/FqsNTfj15m1J0X+ffZuq/gTY7QnvIfJz6UzBJLs83ItQpt3RfZz5iuGfNPajpngUm0R8DoA5jDlzsOTAwZjzsC3Jjxg7H914PjlcskGdghgx9HG4OOQH34uwQyzz61/0qiYNQjXxECuWYbGM/DrjtPH/Mw/K+gBLLSA+cEfPr4MroArzcDuybbr8Zc72i2UnzeHnTgzD4Ug78SzIvCoARVOQxaFFR3TzWnkkHUVFShEuqKxZnKz4p4YYcf8ZhYhuu8wFgSHcuuwCJagI4bgchJQK/qe9c/RT6nGcg6KGREJpb+MI0EY/b0jcsni3AJBeCQNsBOFVYoApcM2Aom4VFgIRdHpeIG8D3YaxBD+qCiQ+rBOSVnci8hzkAG1t/pgHA4uwDzmu8xFKkkkIqCfkIRs204r/hiDgutoAAcowBMZ9+KS0CcXVBOHCvJw2jMQSJyeoeExF2DuTuRcuWAo9sefyUQ6/oBaIjPtiRH1KvQKvygAHb171d+vc4GRMDPoxN/kL5pwlVh1mBQ1quQJAJ5j0TgOAis+h8d3mnC8xTKE34+8sDNjyVXE6nFMN+H39TQDmocHScENvN74LoGScGU4f7g6IG3n3C3qnG6JBS+Z5tHOOzRYQx+u7MZmAl0OSsRLAS/VIKfRAWU92+12aaVPksGDBWQuCMvgNy2M2Mt8EwqbjosZAec5xLEAmXmcFTHiOWARWglpNpjdEtBQRxJJU5VL5/7F1X86XntXgUK4q+KggsUoIIK8oA+kgy4+zLaACqQGTVOX6MBWdehL6BxHn+tlyBMDGAqufd7WOX5WTJwKYDfXJJP2GXDPk7Tj5Ed7BOG7DMFaBRAJgI/+H2Ngeb2SKb0zkoGlQBHkefDr7xMA5HZeJPtKIzyApI9gmnPgf1c3mulfhe0gFekDCdNFnrOwi4Gs6eTACNjB+Uegcgojog4V25P8bctRYY6RL8AJklE9ACFAGZdBEahd4d4CmghFhbzcwaXYH5qTlS6DY+KfNH5Avzjo2JJ0poDkSCMxLn73H/eB+ifvgvyIFCWAji7BWC8hd0qj0FziMdrS70BlVbgamIgcmotGZDNPwm0L9l5iHv7WRoAFx57ScFS2r2iwot8oKu8l+TOCOg2mZ2nFdjTgOFQENzKkJ8OjEnsE8f6AzyXwT6MNF3RDRnuj0Lwo6wTlBMDIyqaz6G+RiLJMg/KUrQV/rh9uH0tWduwoxmky0kSMQ+rnXxZsGadgnxfgk1pCnsIsGYltvfdzTOBIclIsN8MLAGcz5gBwj94AE8DuC9Molip/JGwB57nRyJiyD3pyk6q5ij+3TzRLohcqyqCEQBTepF15+WVmW8SEr5jMUUkx3oMIsrH3ndwAQganKzyMpOJNxMQooGBYwcByw7axIhgPRGEr6GSGJhkAELoQ1YRg+dPeD5IIRDIqq5PA2Jh0Rq0YcS8XBi0ghGRFpCtWTdum5+yLOsQf2EuYY8AfnbQZDgCjHxBSKwTGpt8QCIDVH3/4H5OwEvldhliINwAFLsEyyIfGKV+vm3eEehVqKTdNxtDiPoLHCRiuwTJxCECxMDqDjTvZ63KaPKvRgV2i/F3ohm88V8LN8hgJcXD5pVGIPPNn9EBqSQC0I4AMxBUcQNCkarkFgSn/oCs9GCVep4eUG5BRAOcQOCWlGSc3If0IFqRfURQGRrKewPKEJ9sLnIowKCcw+f48N6UHjqYtgInaCCkBbPSj8VEkCr2g8U43wY1xX/BNkwreQrzg+oaJghOCGTU8RBxuIp6VFOGoEXgEsBLIgV6gBgxoLSI5CgiYNT+GBHsU01GthrceiMUtv9KgAYktgVNeGrBbtiOQVi9x8WjiAW7UNUnm4Vet7WtsFgDCDYEwQ/EVL1PnQf/xCDLTowTh4c4HPRDoQaiwhKIAae4B7xgCBydI/CDPOrevK0FR4p6w3VfoXgQiB3T1N8Y1PCD0X19JqcHGfzB5WkQE4p/kdeXBcEVUXEIFqSij82lMyrWq/7c+LFHA7z5/dwOHHg8s/Y8C2CmhbmALtare+4UWLfb25BmXABKABTniC8gRAP2yvDAiUAsElnrxFzITQa/sAFecAOY7zPV/8jMQHSbWAiUPGkQNABhw85xrSCv+mMSzFR8+7mjw01A8f4F8S/td4jnDHYxpT8/OEyV3gz2+GTfdAeAszswfJNGlQhEIjB0Bls0BKn4Iw7WKu9f1gmSagmvqleEwJwnZwjO7npz1HdCJ1hS/mlBcRXyF3i/M7NxqJFoeH27z7nnJaBmpUZKHsTbGUc1ALEoIGsGYl9ixS50gjAT/VhB8IzvGTrBVfWEz1MzAkRFTtecW731VdjNQPukVdhdn0Y8d/a7WYH6i/TBPBzUFwAlHwtGHOQISrgb1AMUgDETTA3+THAdeRJhg59V/Ektofa9I8wxVICkC7QQSAd2O3cftzPzdMK6aA4iZI4ILfYRbb9RgqICt2AxVnYZ4kkBvHOBxT/zN9ybHx/f5Ql2fkGCX6ANm6F8WCfqAS+Eq5AGcHJd2IFHagTMHAAj+mWBnDXuc81CjhsAi5dL2K8QCYI1aJ/PJtSSxEFXASv7C2I3ZB9/a0j/7nDn/j1pHsz9Jr8fNpxPBUAUUYD4wz5GBlmyAiORjtAIGDFwzSUwqiNZ1d1tPiB7/Q9VeI9KeJU16/knkEeQJEALjY4rkp74fCZiMDSA/PgvT/aT2gYgp5E/P29AKBQAo6TRth5T4VesQFb0i4K7RA2MZpgyFXCEQHCOixuYMPgy2L7+45ezSSKt2oUkURlpXkEMOLSiXPuDQZjk63N5bmzOSxQdLHX7AhwUEA0BAeQPJIQzkAuFlOK/GtyLdiGDKEBdllQ7YouxV2Xdwza9So4Kp5Z0yAgUhTlJgFzSFrznIHYIwKcCu2/L3LsCg6UI1b1/CA+ApIV5/32HqOIjdQusE4azip5Wc1b0q/QGIAlaWEJbXP3r/L+AEipw/+BtkQVY9fIM2i/ZhgVEgJO6DZ1ksVtlYdoQAPhVO0oKmYBmnAYco4DRCRB3TwCziptaE0auER9/VzRqKNOEYINOQg2m1l9GpGNQAhh1v6UmxNQh2M4+LmlUzll0OTjYQOaGlZAEMCrdhmBphaMBwBADrSQQc3//He8KgFETT7p6BHnjj2X9EXsDjrgBS6ihoAmcSQVYmE4JgYWFpp1waAQRoqDzxDhU+HxSnZHz/9JEY6Y5MJA+cwoWrt99+U3Mc/9g/NQTFaigAEtwB1yBzwzucZSX7RZEILhR1d5GDCsBLVUdIQvsldZfEJt5i/MHx2hGJZFkVVyK242iFeh58oBUFqIQbkfp2DV2X0CkAYgv1sU+P+I/HmBu8nErugdRnUWhfp+A/ddlbEH3uQlBsNobUEMHasK1HOYn8BEEvCUaiuigXRIKj+sGOPA4KAWz9/s7WxcgB4+a6/fI2osEwv4yOENAiPf+wQhbc/5f0gGisWuQaRFmGoIqguARWsBQgTTocDLMT5OJUQnhqdCEig+/EShKSEgTVV0MBMnz04BcshPnLk/+OaV0/dwKzB4QUt1NB6uTDfGOP+cNm9mEsBAFiM7AQh9AKVEU75vy68jeOxrUC4mDEuYO0oLqoSdHaEF2eXYYSm0V+oEOwpLmYFOF3Z4CmAeBTIGueiIw2xoKPzDBJVBXQ5g5O8/twwA+QguIjJt3+g0NQEcDfUXgO5gsqlTBLkQLdl86K3CWneitQ8sg/5oWAUJP2C3V3RoEyji5n4b9lB4t9pz2CA+cAFn1Z9I/uzYsU/ELtEBOCHYQQqGcFejV+yeuRJX31zsKV5IGjway9z6PLDxKwNEPsBuOEiqw57jGgOtZ1Y++T50AuMFl7hPIbhskiOwsATtRoc7rS7dXrpcgrMCGJca6ELJo+Y0be0BW5ZKGcFz4y8W9BduwcDnK9iO5fagsKpp9ANnvDPxeP8THNyIVFo1AMas8Qk5v2Ytm0LCCYAXqn+wQsPTBh/5Bcnne14Os3uCQt28vsK1WUESJFviBgAW//3u9PLxusXchcCR2WsNzv/ImvgZzzkUByDUAIrjTvmSHAowpJBQE4SUlxMxnARlQbIqkArVAJ6pBBvELCCKlkyCDAP45BYfEPfcUpfMch3Vn4bheYK4E66BxAxHSVd5INgEPgU/NBCDfNQ8Ho1CoINAPQAW/QT8OCIZlNFCB84XhoDChFByHGjx35v9BLgyhmojqHYb5QYXnuAecvua0hZe6BV9f7v4ibvgvamrmAc1TmaEir0LQ9h97eYAYVoM/nWA60i8Q3Ifezha9BqaaL3zvqd6IAuwwLSCCuCLuJWch4h30giPtyiAphKEBcCu9BV5wwzkMxID8rhMwdwMhcSFgrBT3RUTQboAUg3+p+Qe1IGarOioVnazmefV3lHpwA0AcLWCahUiXwePHWJsP+GH1gnp/we5KfOhJAbsj0H/BIEb04TbrTPsAyb2LLu93KwfCvn5PLAwrOXAa72eEQRo1CNdw5IprsAZ3hApy9zlcITG2vpCihsRSYxNS+J4vdBZ6B52eqRcQ/QXmSjAWSfa/5GA5qEg4iJFtm624AqXLrSA2gx8p1Mdqcghv41S0lSp/xAYs9gakQc4Ie2RTUYwYgt748mV+FU1Xgp14eW3XYZ6cdqGTNHwHICTwEeTPl0jEZwIgP9gDEaogeg5IHWCF+1eoAhvEKPB/EAeTRsM/pSAP5wjWEUMM1/NJRhwJbpJSgK7S7zF3EOsI5jBQBK9DV80Z8Y0COzvmWzJXgDl40KEC6cqvqgi4OB5cpgLFYK/1CvDiItXqC6/S87wfAUfPtxqfGNzlYaOjlf1IsHPPvffHgDAoEeEST4ZLZUd/RSo91/BjXY5ggWgQ4In3fyj4mUqPrInHOCLKO3wUwRsfyXpt1nEIRLrqcWeTuk7bigsbid1zD4iDRQtnIdQsyIXnFCn1I9D7ADgxEhOvR5AJosoUbu1FkJyYCi9OhQERoIx+4AX/YqUXQhtYEwKN4Cy1HntLMmtaAQpqfrT/UCoLSxeswjA5UWPPi0mjajUWxMTdVusNvt/ChMdmILK5IRMFu90BMEzFYHdg2GAgeYVHMMJIBTA7EFTx/5fpgTFXz9w/en0ZjD8kCDoKPNGwlB01BmoWQbh+AxR689mBponGJOr9OwmMu3dtJ/ylW1Tik4ElUPmR9RqII+pVhD9ychABMQ51gOIZg+/G+5mGIzLB1JJC5WhzYjhJ7IWmLDpA8jzsAafUPkB2WnFBF4iSxkq1ty7f25rv/+EQLOxs2oUdTSA9HIR9swdBlCcFe9owPC3XWDDC0ISVzsEVbSCF/sWdA5Fu4HJqankp2SeQCYYrImNalfmhpVxYrGkUS4LeSUjg8dD7+D7w/ybIfy7vlB9/HJ978zr7/45Qgajzj+4EjIK/ULHPRAOlKr/aG0AFcqCyu0GcW45Igh6JMJmhA49/U+cEssHNJhtXDC1MOya3j/sAiAGcrEtqtgjBD6wEzSDc7D8o6C8rIqAZyPk+NQoNLAZ1hR64Yl1FBY648smUYKnSg1Xwk/0DyRyArByMUobyByhCcPnOaPyoegREFS4jNfYAw+IHCjdC1J2WDZBke/OyN85J24WiXwDYPoJyYuCD238ulvuzwt6KgHf0shWKsqCFFGjB/w8HU8eeTED9wAAAAABJRU5ErkJggg==",i}(),Es=function(){function i(t){this._isEnabled=!1,this.isEnabled=!1,this.intensity=1,this.roughness=0,this._indexOfRefraction=i._DefaultIndexOfRefraction,this.indexOfRefraction=i._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._textureRoughness=null,this.textureRoughness=null,this._remapF0OnInterfaceChange=!0,this.remapF0OnInterfaceChange=!0,this._bumpTexture=null,this.bumpTexture=null,this._isTintEnabled=!1,this.isTintEnabled=!1,this.tintColor=M.a.White(),this.tintColorAtDistance=1,this.tintThickness=1,this._tintTexture=null,this.tintTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=t}return i.prototype._markAllSubMeshesAsTexturesDirty=function(){this._internalMarkAllSubMeshesAsTexturesDirty()},i.prototype.isReadyForSubMesh=function(t,e,n,r){return!(t._areTexturesDirty&&e.texturesEnabled&&(this._texture&&bt.a.ClearCoatTextureEnabled&&!this._texture.isReadyOrNotBlocking()||this._textureRoughness&&bt.a.ClearCoatTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking()||n.getCaps().standardDerivatives&&this._bumpTexture&&bt.a.ClearCoatBumpTextureEnabled&&!r&&!this._bumpTexture.isReady()||this._isTintEnabled&&this._tintTexture&&bt.a.ClearCoatTintTextureEnabled&&!this._tintTexture.isReadyOrNotBlocking()))},i.prototype.prepareDefines=function(t,e){var n;this._isEnabled?(t.CLEARCOAT=!0,t.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,t.CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL=this._texture!==null&&this._texture._texture===((n=this._textureRoughness)===null||n===void 0?void 0:n._texture)&&this._texture.checkTransformsAreIdentical(this._textureRoughness),t.CLEARCOAT_REMAP_F0=this._remapF0OnInterfaceChange,t._areTexturesDirty&&e.texturesEnabled&&(this._texture&&bt.a.ClearCoatTextureEnabled?lt.a.PrepareDefinesForMergedUV(this._texture,t,"CLEARCOAT_TEXTURE"):t.CLEARCOAT_TEXTURE=!1,this._textureRoughness&&bt.a.ClearCoatTextureEnabled?lt.a.PrepareDefinesForMergedUV(this._textureRoughness,t,"CLEARCOAT_TEXTURE_ROUGHNESS"):t.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this._bumpTexture&&bt.a.ClearCoatBumpTextureEnabled?lt.a.PrepareDefinesForMergedUV(this._bumpTexture,t,"CLEARCOAT_BUMP"):t.CLEARCOAT_BUMP=!1,t.CLEARCOAT_DEFAULTIOR=this._indexOfRefraction===i._DefaultIndexOfRefraction,this._isTintEnabled?(t.CLEARCOAT_TINT=!0,this._tintTexture&&bt.a.ClearCoatTintTextureEnabled?lt.a.PrepareDefinesForMergedUV(this._tintTexture,t,"CLEARCOAT_TINT_TEXTURE"):t.CLEARCOAT_TINT_TEXTURE=!1):(t.CLEARCOAT_TINT=!1,t.CLEARCOAT_TINT_TEXTURE=!1))):(t.CLEARCOAT=!1,t.CLEARCOAT_TEXTURE=!1,t.CLEARCOAT_TEXTURE_ROUGHNESS=!1,t.CLEARCOAT_BUMP=!1,t.CLEARCOAT_TINT=!1,t.CLEARCOAT_TINT_TEXTURE=!1,t.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,t.CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL=!1)},i.prototype.bindForSubMesh=function(t,e,n,r,o,u,f,v){var y,D,w,F,z,k,K,oe,ae=v._materialDefines,ue=ae.CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL;if(!t.useUbo||!o||!t.isSync){ue&&bt.a.ClearCoatTextureEnabled?(t.updateFloat4("vClearCoatInfos",this._texture.coordinatesIndex,this._texture.level,-1,-1),lt.a.BindTextureMatrix(this._texture,t,"clearCoat")):(this._texture||this._textureRoughness)&&bt.a.ClearCoatTextureEnabled&&(t.updateFloat4("vClearCoatInfos",(D=(y=this._texture)===null||y===void 0?void 0:y.coordinatesIndex)!==null&&D!==void 0?D:0,(F=(w=this._texture)===null||w===void 0?void 0:w.level)!==null&&F!==void 0?F:0,(k=(z=this._textureRoughness)===null||z===void 0?void 0:z.coordinatesIndex)!==null&&k!==void 0?k:0,(oe=(K=this._textureRoughness)===null||K===void 0?void 0:K.level)!==null&&oe!==void 0?oe:0),this._texture&&lt.a.BindTextureMatrix(this._texture,t,"clearCoat"),!this._textureRoughness||ue||ae.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE||lt.a.BindTextureMatrix(this._textureRoughness,t,"clearCoatRoughness")),this._bumpTexture&&n.getCaps().standardDerivatives&&bt.a.ClearCoatTextureEnabled&&!r&&(t.updateFloat2("vClearCoatBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level),lt.a.BindTextureMatrix(this._bumpTexture,t,"clearCoatBump"),e._mirroredCameraPosition?t.updateFloat2("vClearCoatTangentSpaceParams",u?1:-1,f?1:-1):t.updateFloat2("vClearCoatTangentSpaceParams",u?-1:1,f?-1:1)),this._tintTexture&&bt.a.ClearCoatTintTextureEnabled&&(t.updateFloat2("vClearCoatTintInfos",this._tintTexture.coordinatesIndex,this._tintTexture.level),lt.a.BindTextureMatrix(this._tintTexture,t,"clearCoatTint")),t.updateFloat2("vClearCoatParams",this.intensity,this.roughness);var de=1-this._indexOfRefraction,me=1+this._indexOfRefraction,ye=Math.pow(-de/me,2),Ee=1/this._indexOfRefraction;t.updateFloat4("vClearCoatRefractionParams",ye,Ee,de,me),this._isTintEnabled&&(t.updateFloat4("vClearCoatTintParams",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintThickness)),t.updateFloat("clearCoatColorAtDistance",Math.max(1e-5,this.tintColorAtDistance)))}e.texturesEnabled&&(this._texture&&bt.a.ClearCoatTextureEnabled&&t.setTexture("clearCoatSampler",this._texture),this._textureRoughness&&!ue&&!ae.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&bt.a.ClearCoatTextureEnabled&&t.setTexture("clearCoatRoughnessSampler",this._textureRoughness),this._bumpTexture&&n.getCaps().standardDerivatives&&bt.a.ClearCoatBumpTextureEnabled&&!r&&t.setTexture("clearCoatBumpSampler",this._bumpTexture),this._isTintEnabled&&this._tintTexture&&bt.a.ClearCoatTintTextureEnabled&&t.setTexture("clearCoatTintSampler",this._tintTexture))},i.prototype.hasTexture=function(t){return this._texture===t||this._textureRoughness===t||this._bumpTexture===t||this._tintTexture===t},i.prototype.getActiveTextures=function(t){this._texture&&t.push(this._texture),this._textureRoughness&&t.push(this._textureRoughness),this._bumpTexture&&t.push(this._bumpTexture),this._tintTexture&&t.push(this._tintTexture)},i.prototype.getAnimatables=function(t){this._texture&&this._texture.animations&&this._texture.animations.length>0&&t.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&t.push(this._textureRoughness),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&t.push(this._bumpTexture),this._tintTexture&&this._tintTexture.animations&&this._tintTexture.animations.length>0&&t.push(this._tintTexture)},i.prototype.dispose=function(t){var e,n,r,o;t&&((e=this._texture)===null||e===void 0||e.dispose(),(n=this._textureRoughness)===null||n===void 0||n.dispose(),(r=this._bumpTexture)===null||r===void 0||r.dispose(),(o=this._tintTexture)===null||o===void 0||o.dispose())},i.prototype.getClassName=function(){return"PBRClearCoatConfiguration"},i.AddFallbacks=function(t,e,n){return t.CLEARCOAT_BUMP&&e.addFallback(n++,"CLEARCOAT_BUMP"),t.CLEARCOAT_TINT&&e.addFallback(n++,"CLEARCOAT_TINT"),t.CLEARCOAT&&e.addFallback(n++,"CLEARCOAT"),n},i.AddUniforms=function(t){t.push("vClearCoatTangentSpaceParams","vClearCoatParams","vClearCoatRefractionParams","vClearCoatTintParams","clearCoatColorAtDistance","clearCoatMatrix","clearCoatRoughnessMatrix","clearCoatBumpMatrix","clearCoatTintMatrix","vClearCoatInfos","vClearCoatBumpInfos","vClearCoatTintInfos")},i.AddSamplers=function(t){t.push("clearCoatSampler","clearCoatRoughnessSampler","clearCoatBumpSampler","clearCoatTintSampler")},i.PrepareUniformBuffer=function(t){t.addUniform("vClearCoatParams",2),t.addUniform("vClearCoatRefractionParams",4),t.addUniform("vClearCoatInfos",4),t.addUniform("clearCoatMatrix",16),t.addUniform("clearCoatRoughnessMatrix",16),t.addUniform("vClearCoatBumpInfos",2),t.addUniform("vClearCoatTangentSpaceParams",2),t.addUniform("clearCoatBumpMatrix",16),t.addUniform("vClearCoatTintParams",4),t.addUniform("clearCoatColorAtDistance",1),t.addUniform("vClearCoatTintInfos",2),t.addUniform("clearCoatTintMatrix",16)},i.prototype.copyTo=function(t){B.a.Clone(function(){return t},this)},i.prototype.serialize=function(){return B.a.Serialize(this)},i.prototype.parse=function(t,e,n){var r=this;B.a.Parse(function(){return r},t,e,n)},i._DefaultIndexOfRefraction=1.5,Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"isEnabled",void 0),Object(p.c)([Object(B.c)()],i.prototype,"intensity",void 0),Object(p.c)([Object(B.c)()],i.prototype,"roughness",void 0),Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"indexOfRefraction",void 0),Object(p.c)([Object(B.m)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"texture",void 0),Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useRoughnessFromMainTexture",void 0),Object(p.c)([Object(B.m)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"textureRoughness",void 0),Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"remapF0OnInterfaceChange",void 0),Object(p.c)([Object(B.m)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"bumpTexture",void 0),Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"isTintEnabled",void 0),Object(p.c)([Object(B.e)()],i.prototype,"tintColor",void 0),Object(p.c)([Object(B.c)()],i.prototype,"tintColorAtDistance",void 0),Object(p.c)([Object(B.c)()],i.prototype,"tintThickness",void 0),Object(p.c)([Object(B.m)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"tintTexture",void 0),i}(),Ss=function(){function i(t){this._isEnabled=!1,this.isEnabled=!1,this.intensity=1,this.direction=new d.d(1,0),this._texture=null,this.texture=null,this._internalMarkAllSubMeshesAsTexturesDirty=t}return i.prototype._markAllSubMeshesAsTexturesDirty=function(){this._internalMarkAllSubMeshesAsTexturesDirty()},i.prototype.isReadyForSubMesh=function(t,e){return!(t._areTexturesDirty&&e.texturesEnabled&&this._texture&&bt.a.AnisotropicTextureEnabled&&!this._texture.isReadyOrNotBlocking())},i.prototype.prepareDefines=function(t,e,n){this._isEnabled?(t.ANISOTROPIC=this._isEnabled,this._isEnabled&&!e.isVerticesDataPresent(De.b.TangentKind)&&(t._needUVs=!0,t.MAINUV1=!0),t._areTexturesDirty&&n.texturesEnabled&&(this._texture&&bt.a.AnisotropicTextureEnabled?lt.a.PrepareDefinesForMergedUV(this._texture,t,"ANISOTROPIC_TEXTURE"):t.ANISOTROPIC_TEXTURE=!1)):(t.ANISOTROPIC=!1,t.ANISOTROPIC_TEXTURE=!1)},i.prototype.bindForSubMesh=function(t,e,n){t.useUbo&&n&&t.isSync||(this._texture&&bt.a.AnisotropicTextureEnabled&&(t.updateFloat2("vAnisotropyInfos",this._texture.coordinatesIndex,this._texture.level),lt.a.BindTextureMatrix(this._texture,t,"anisotropy")),t.updateFloat3("vAnisotropy",this.direction.x,this.direction.y,this.intensity)),e.texturesEnabled&&this._texture&&bt.a.AnisotropicTextureEnabled&&t.setTexture("anisotropySampler",this._texture)},i.prototype.hasTexture=function(t){return this._texture===t},i.prototype.getActiveTextures=function(t){this._texture&&t.push(this._texture)},i.prototype.getAnimatables=function(t){this._texture&&this._texture.animations&&this._texture.animations.length>0&&t.push(this._texture)},i.prototype.dispose=function(t){t&&this._texture&&this._texture.dispose()},i.prototype.getClassName=function(){return"PBRAnisotropicConfiguration"},i.AddFallbacks=function(t,e,n){return t.ANISOTROPIC&&e.addFallback(n++,"ANISOTROPIC"),n},i.AddUniforms=function(t){t.push("vAnisotropy","vAnisotropyInfos","anisotropyMatrix")},i.PrepareUniformBuffer=function(t){t.addUniform("vAnisotropy",3),t.addUniform("vAnisotropyInfos",2),t.addUniform("anisotropyMatrix",16)},i.AddSamplers=function(t){t.push("anisotropySampler")},i.prototype.copyTo=function(t){B.a.Clone(function(){return t},this)},i.prototype.serialize=function(){return B.a.Serialize(this)},i.prototype.parse=function(t,e,n){var r=this;B.a.Parse(function(){return r},t,e,n)},Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"isEnabled",void 0),Object(p.c)([Object(B.c)()],i.prototype,"intensity",void 0),Object(p.c)([Object(B.n)()],i.prototype,"direction",void 0),Object(p.c)([Object(B.m)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"texture",void 0),i}(),$I=function(){function i(t){this._useEnergyConservation=i.DEFAULT_USE_ENERGY_CONSERVATION,this.useEnergyConservation=i.DEFAULT_USE_ENERGY_CONSERVATION,this._useSmithVisibilityHeightCorrelated=i.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this.useSmithVisibilityHeightCorrelated=i.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this._useSphericalHarmonics=i.DEFAULT_USE_SPHERICAL_HARMONICS,this.useSphericalHarmonics=i.DEFAULT_USE_SPHERICAL_HARMONICS,this._useSpecularGlossinessInputEnergyConservation=i.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this.useSpecularGlossinessInputEnergyConservation=i.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this._internalMarkAllSubMeshesAsMiscDirty=t}return i.prototype._markAllSubMeshesAsMiscDirty=function(){this._internalMarkAllSubMeshesAsMiscDirty()},i.prototype.prepareDefines=function(t){t.BRDF_V_HEIGHT_CORRELATED=this._useSmithVisibilityHeightCorrelated,t.MS_BRDF_ENERGY_CONSERVATION=this._useEnergyConservation&&this._useSmithVisibilityHeightCorrelated,t.SPHERICAL_HARMONICS=this._useSphericalHarmonics,t.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=this._useSpecularGlossinessInputEnergyConservation},i.prototype.getClassName=function(){return"PBRBRDFConfiguration"},i.prototype.copyTo=function(t){B.a.Clone(function(){return t},this)},i.prototype.serialize=function(){return B.a.Serialize(this)},i.prototype.parse=function(t,e,n){var r=this;B.a.Parse(function(){return r},t,e,n)},i.DEFAULT_USE_ENERGY_CONSERVATION=!0,i.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED=!0,i.DEFAULT_USE_SPHERICAL_HARMONICS=!0,i.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION=!0,Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsMiscDirty")],i.prototype,"useEnergyConservation",void 0),Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsMiscDirty")],i.prototype,"useSmithVisibilityHeightCorrelated",void 0),Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsMiscDirty")],i.prototype,"useSphericalHarmonics",void 0),Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsMiscDirty")],i.prototype,"useSpecularGlossinessInputEnergyConservation",void 0),i}(),ol=function(){function i(t){this._isEnabled=!1,this.isEnabled=!1,this._linkSheenWithAlbedo=!1,this.linkSheenWithAlbedo=!1,this.intensity=1,this.color=M.a.White(),this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._roughness=null,this.roughness=null,this._textureRoughness=null,this.textureRoughness=null,this._albedoScaling=!1,this.albedoScaling=!1,this._internalMarkAllSubMeshesAsTexturesDirty=t}return i.prototype._markAllSubMeshesAsTexturesDirty=function(){this._internalMarkAllSubMeshesAsTexturesDirty()},i.prototype.isReadyForSubMesh=function(t,e){return!(t._areTexturesDirty&&e.texturesEnabled&&(this._texture&&bt.a.SheenTextureEnabled&&!this._texture.isReadyOrNotBlocking()||this._textureRoughness&&bt.a.SheenTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking()))},i.prototype.prepareDefines=function(t,e){var n;this._isEnabled?(t.SHEEN=this._isEnabled,t.SHEEN_LINKWITHALBEDO=this._linkSheenWithAlbedo,t.SHEEN_ROUGHNESS=this._roughness!==null,t.SHEEN_ALBEDOSCALING=this._albedoScaling,t.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,t.SHEEN_TEXTURE_ROUGHNESS_IDENTICAL=this._texture!==null&&this._texture._texture===((n=this._textureRoughness)===null||n===void 0?void 0:n._texture)&&this._texture.checkTransformsAreIdentical(this._textureRoughness),t._areTexturesDirty&&e.texturesEnabled&&(this._texture&&bt.a.SheenTextureEnabled?lt.a.PrepareDefinesForMergedUV(this._texture,t,"SHEEN_TEXTURE"):t.SHEEN_TEXTURE=!1,this._textureRoughness&&bt.a.SheenTextureEnabled?lt.a.PrepareDefinesForMergedUV(this._textureRoughness,t,"SHEEN_TEXTURE_ROUGHNESS"):t.SHEEN_TEXTURE_ROUGHNESS=!1)):(t.SHEEN=!1,t.SHEEN_TEXTURE=!1,t.SHEEN_TEXTURE_ROUGHNESS=!1,t.SHEEN_LINKWITHALBEDO=!1,t.SHEEN_ROUGHNESS=!1,t.SHEEN_ALBEDOSCALING=!1,t.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,t.SHEEN_TEXTURE_ROUGHNESS_IDENTICAL=!1)},i.prototype.bindForSubMesh=function(t,e,n,r){var o,u,f,v,y,D,w,F,z=r._materialDefines,k=z.SHEEN_TEXTURE_ROUGHNESS_IDENTICAL;t.useUbo&&n&&t.isSync||(k&&bt.a.SheenTextureEnabled?(t.updateFloat4("vSheenInfos",this._texture.coordinatesIndex,this._texture.level,-1,-1),lt.a.BindTextureMatrix(this._texture,t,"sheen")):(this._texture||this._textureRoughness)&&bt.a.SheenTextureEnabled&&(t.updateFloat4("vSheenInfos",(u=(o=this._texture)===null||o===void 0?void 0:o.coordinatesIndex)!==null&&u!==void 0?u:0,(v=(f=this._texture)===null||f===void 0?void 0:f.level)!==null&&v!==void 0?v:0,(D=(y=this._textureRoughness)===null||y===void 0?void 0:y.coordinatesIndex)!==null&&D!==void 0?D:0,(F=(w=this._textureRoughness)===null||w===void 0?void 0:w.level)!==null&&F!==void 0?F:0),this._texture&&lt.a.BindTextureMatrix(this._texture,t,"sheen"),!this._textureRoughness||k||z.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE||lt.a.BindTextureMatrix(this._textureRoughness,t,"sheenRoughness")),t.updateFloat4("vSheenColor",this.color.r,this.color.g,this.color.b,this.intensity),this._roughness!==null&&t.updateFloat("vSheenRoughness",this._roughness)),e.texturesEnabled&&(this._texture&&bt.a.SheenTextureEnabled&&t.setTexture("sheenSampler",this._texture),this._textureRoughness&&!k&&!z.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&bt.a.SheenTextureEnabled&&t.setTexture("sheenRoughnessSampler",this._textureRoughness))},i.prototype.hasTexture=function(t){return this._texture===t||this._textureRoughness===t},i.prototype.getActiveTextures=function(t){this._texture&&t.push(this._texture),this._textureRoughness&&t.push(this._textureRoughness)},i.prototype.getAnimatables=function(t){this._texture&&this._texture.animations&&this._texture.animations.length>0&&t.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&t.push(this._textureRoughness)},i.prototype.dispose=function(t){var e,n;t&&((e=this._texture)===null||e===void 0||e.dispose(),(n=this._textureRoughness)===null||n===void 0||n.dispose())},i.prototype.getClassName=function(){return"PBRSheenConfiguration"},i.AddFallbacks=function(t,e,n){return t.SHEEN&&e.addFallback(n++,"SHEEN"),n},i.AddUniforms=function(t){t.push("vSheenColor","vSheenRoughness","vSheenInfos","sheenMatrix","sheenRoughnessMatrix")},i.PrepareUniformBuffer=function(t){t.addUniform("vSheenColor",4),t.addUniform("vSheenRoughness",1),t.addUniform("vSheenInfos",4),t.addUniform("sheenMatrix",16),t.addUniform("sheenRoughnessMatrix",16)},i.AddSamplers=function(t){t.push("sheenSampler"),t.push("sheenRoughnessSampler")},i.prototype.copyTo=function(t){B.a.Clone(function(){return t},this)},i.prototype.serialize=function(){return B.a.Serialize(this)},i.prototype.parse=function(t,e,n){var r=this;B.a.Parse(function(){return r},t,e,n)},Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"isEnabled",void 0),Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"linkSheenWithAlbedo",void 0),Object(p.c)([Object(B.c)()],i.prototype,"intensity",void 0),Object(p.c)([Object(B.e)()],i.prototype,"color",void 0),Object(p.c)([Object(B.m)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"texture",void 0),Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useRoughnessFromMainTexture",void 0),Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"roughness",void 0),Object(p.c)([Object(B.m)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"textureRoughness",void 0),Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"albedoScaling",void 0),i}(),al=function(){function i(t,e,n){this._isRefractionEnabled=!1,this.isRefractionEnabled=!1,this._isTranslucencyEnabled=!1,this.isTranslucencyEnabled=!1,this._isScatteringEnabled=!1,this.isScatteringEnabled=!1,this._scatteringDiffusionProfileIndex=0,this.refractionIntensity=1,this.translucencyIntensity=1,this.useAlbedoToTintRefraction=!1,this._thicknessTexture=null,this.thicknessTexture=null,this._refractionTexture=null,this.refractionTexture=null,this._indexOfRefraction=1.5,this.indexOfRefraction=1.5,this._volumeIndexOfRefraction=-1,this._invertRefractionY=!1,this.invertRefractionY=!1,this._linkRefractionWithTransparency=!1,this.linkRefractionWithTransparency=!1,this.minimumThickness=0,this.maximumThickness=1,this.tintColor=M.a.White(),this.tintColorAtDistance=1,this.diffusionDistance=M.a.White(),this._useMaskFromThicknessTexture=!1,this.useMaskFromThicknessTexture=!1,this._useMaskFromThicknessTextureGltf=!1,this.useMaskFromThicknessTextureGltf=!1,this._internalMarkAllSubMeshesAsTexturesDirty=t,this._internalMarkScenePrePassDirty=e,this._scene=n}return Object.defineProperty(i.prototype,"scatteringDiffusionProfile",{get:function(){return this._scene.subSurfaceConfiguration?this._scene.subSurfaceConfiguration.ssDiffusionProfileColors[this._scatteringDiffusionProfileIndex]:null},set:function(t){this._scene.enableSubSurfaceForPrePass()&&t&&(this._scatteringDiffusionProfileIndex=this._scene.subSurfaceConfiguration.addDiffusionProfile(t))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"volumeIndexOfRefraction",{get:function(){return this._volumeIndexOfRefraction>=1?this._volumeIndexOfRefraction:this._indexOfRefraction},set:function(t){this._volumeIndexOfRefraction=t>=1?t:-1},enumerable:!1,configurable:!0}),i.prototype._markAllSubMeshesAsTexturesDirty=function(){this._internalMarkAllSubMeshesAsTexturesDirty()},i.prototype._markScenePrePassDirty=function(){this._internalMarkAllSubMeshesAsTexturesDirty(),this._internalMarkScenePrePassDirty()},i.prototype.isReadyForSubMesh=function(t,e){if(t._areTexturesDirty&&e.texturesEnabled){if(this._thicknessTexture&&bt.a.ThicknessTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1;var n=this._getRefractionTexture(e);if(n&&bt.a.RefractionTextureEnabled&&!n.isReadyOrNotBlocking())return!1}return!0},i.prototype.prepareDefines=function(t,e){if(t._areTexturesDirty&&(t.SUBSURFACE=!1,t.SS_TRANSLUCENCY=this._isTranslucencyEnabled,t.SS_SCATTERING=this._isScatteringEnabled,t.SS_THICKNESSANDMASK_TEXTURE=!1,t.SS_MASK_FROM_THICKNESS_TEXTURE=!1,t.SS_MASK_FROM_THICKNESS_TEXTURE_GLTF=!1,t.SS_REFRACTION=!1,t.SS_REFRACTIONMAP_3D=!1,t.SS_GAMMAREFRACTION=!1,t.SS_RGBDREFRACTION=!1,t.SS_LINEARSPECULARREFRACTION=!1,t.SS_REFRACTIONMAP_OPPOSITEZ=!1,t.SS_LODINREFRACTIONALPHA=!1,t.SS_LINKREFRACTIONTOTRANSPARENCY=!1,t.SS_ALBEDOFORREFRACTIONTINT=!1,(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled)&&(t.SUBSURFACE=!0,t._areTexturesDirty&&e.texturesEnabled&&this._thicknessTexture&&bt.a.ThicknessTextureEnabled&&lt.a.PrepareDefinesForMergedUV(this._thicknessTexture,t,"SS_THICKNESSANDMASK_TEXTURE"),t.SS_MASK_FROM_THICKNESS_TEXTURE=this._useMaskFromThicknessTexture,t.SS_MASK_FROM_THICKNESS_TEXTURE_GLTF=this._useMaskFromThicknessTextureGltf),this._isRefractionEnabled&&e.texturesEnabled)){var n=this._getRefractionTexture(e);n&&bt.a.RefractionTextureEnabled&&(t.SS_REFRACTION=!0,t.SS_REFRACTIONMAP_3D=n.isCube,t.SS_GAMMAREFRACTION=n.gammaSpace,t.SS_RGBDREFRACTION=n.isRGBD,t.SS_LINEARSPECULARREFRACTION=n.linearSpecularLOD,t.SS_REFRACTIONMAP_OPPOSITEZ=n.invertZ,t.SS_LODINREFRACTIONALPHA=n.lodLevelInAlpha,t.SS_LINKREFRACTIONTOTRANSPARENCY=this._linkRefractionWithTransparency,t.SS_ALBEDOFORREFRACTIONTINT=this.useAlbedoToTintRefraction)}},i.prototype.bindForSubMesh=function(t,e,n,r,o,u){var f=this._getRefractionTexture(e);if(!t.useUbo||!r||!t.isSync){if(this._thicknessTexture&&bt.a.ThicknessTextureEnabled&&(t.updateFloat2("vThicknessInfos",this._thicknessTexture.coordinatesIndex,this._thicknessTexture.level),lt.a.BindTextureMatrix(this._thicknessTexture,t,"thickness")),t.updateFloat2("vThicknessParam",this.minimumThickness,this.maximumThickness-this.minimumThickness),f&&bt.a.RefractionTextureEnabled){t.updateMatrix("refractionMatrix",f.getReflectionTextureMatrix());var v=1;f.isCube||f.depth&&(v=f.depth);var y=f.getSize().width,D=this.volumeIndexOfRefraction;t.updateFloat4("vRefractionInfos",f.level,1/D,v,this._invertRefractionY?-1:1),t.updateFloat3("vRefractionMicrosurfaceInfos",y,f.lodGenerationScale,f.lodGenerationOffset),u&&t.updateFloat2("vRefractionFilteringInfo",y,te.a.Log2(y))}this.isScatteringEnabled&&t.updateFloat("scatteringDiffusionProfile",this._scatteringDiffusionProfileIndex),t.updateColor3("vDiffusionDistance",this.diffusionDistance),t.updateFloat4("vTintColor",this.tintColor.r,this.tintColor.g,this.tintColor.b,this.tintColorAtDistance),t.updateFloat3("vSubSurfaceIntensity",this.refractionIntensity,this.translucencyIntensity,0)}e.texturesEnabled&&(this._thicknessTexture&&bt.a.ThicknessTextureEnabled&&t.setTexture("thicknessSampler",this._thicknessTexture),f&&bt.a.RefractionTextureEnabled&&(o?t.setTexture("refractionSampler",f):(t.setTexture("refractionSampler",f._lodTextureMid||f),t.setTexture("refractionSamplerLow",f._lodTextureLow||f),t.setTexture("refractionSamplerHigh",f._lodTextureHigh||f))))},i.prototype.unbind=function(t){return!(!this._refractionTexture||!this._refractionTexture.isRenderTarget)&&(t.setTexture("refractionSampler",null),!0)},i.prototype._getRefractionTexture=function(t){return this._refractionTexture?this._refractionTexture:this._isRefractionEnabled?t.environmentTexture:null},Object.defineProperty(i.prototype,"disableAlphaBlending",{get:function(){return this.isRefractionEnabled&&this._linkRefractionWithTransparency},enumerable:!1,configurable:!0}),i.prototype.fillRenderTargetTextures=function(t){bt.a.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&t.push(this._refractionTexture)},i.prototype.hasTexture=function(t){return this._thicknessTexture===t||this._refractionTexture===t},i.prototype.hasRenderTargetTextures=function(){return!!(bt.a.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)},i.prototype.getActiveTextures=function(t){this._thicknessTexture&&t.push(this._thicknessTexture),this._refractionTexture&&t.push(this._refractionTexture)},i.prototype.getAnimatables=function(t){this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&t.push(this._thicknessTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&t.push(this._refractionTexture)},i.prototype.dispose=function(t){t&&(this._thicknessTexture&&this._thicknessTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose())},i.prototype.getClassName=function(){return"PBRSubSurfaceConfiguration"},i.AddFallbacks=function(t,e,n){return t.SS_SCATTERING&&e.addFallback(n++,"SS_SCATTERING"),t.SS_TRANSLUCENCY&&e.addFallback(n++,"SS_TRANSLUCENCY"),n},i.AddUniforms=function(t){t.push("vDiffusionDistance","vTintColor","vSubSurfaceIntensity","vRefractionMicrosurfaceInfos","vRefractionFilteringInfo","vRefractionInfos","vThicknessInfos","vThicknessParam","refractionMatrix","thicknessMatrix","scatteringDiffusionProfile")},i.AddSamplers=function(t){t.push("thicknessSampler","refractionSampler","refractionSamplerLow","refractionSamplerHigh")},i.PrepareUniformBuffer=function(t){t.addUniform("vRefractionMicrosurfaceInfos",3),t.addUniform("vRefractionFilteringInfo",2),t.addUniform("vRefractionInfos",4),t.addUniform("refractionMatrix",16),t.addUniform("vThicknessInfos",2),t.addUniform("thicknessMatrix",16),t.addUniform("vThicknessParam",2),t.addUniform("vDiffusionDistance",3),t.addUniform("vTintColor",4),t.addUniform("vSubSurfaceIntensity",3),t.addUniform("scatteringDiffusionProfile",1)},i.prototype.copyTo=function(t){B.a.Clone(function(){return t},this)},i.prototype.serialize=function(){return B.a.Serialize(this)},i.prototype.parse=function(t,e,n){var r=this;B.a.Parse(function(){return r},t,e,n)},Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"isRefractionEnabled",void 0),Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"isTranslucencyEnabled",void 0),Object(p.c)([Object(B.c)(),Object(B.b)("_markScenePrePassDirty")],i.prototype,"isScatteringEnabled",void 0),Object(p.c)([Object(B.c)()],i.prototype,"_scatteringDiffusionProfileIndex",void 0),Object(p.c)([Object(B.c)()],i.prototype,"refractionIntensity",void 0),Object(p.c)([Object(B.c)()],i.prototype,"translucencyIntensity",void 0),Object(p.c)([Object(B.c)()],i.prototype,"useAlbedoToTintRefraction",void 0),Object(p.c)([Object(B.m)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"thicknessTexture",void 0),Object(p.c)([Object(B.m)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"refractionTexture",void 0),Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"indexOfRefraction",void 0),Object(p.c)([Object(B.c)()],i.prototype,"_volumeIndexOfRefraction",void 0),Object(p.c)([Object(B.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"volumeIndexOfRefraction",null),Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"invertRefractionY",void 0),Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"linkRefractionWithTransparency",void 0),Object(p.c)([Object(B.c)()],i.prototype,"minimumThickness",void 0),Object(p.c)([Object(B.c)()],i.prototype,"maximumThickness",void 0),Object(p.c)([Object(B.e)()],i.prototype,"tintColor",void 0),Object(p.c)([Object(B.c)()],i.prototype,"tintColorAtDistance",void 0),Object(p.c)([Object(B.e)()],i.prototype,"diffusionDistance",void 0),Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useMaskFromThicknessTexture",void 0),Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useMaskFromThicknessTextureGltf",void 0),i}(),Jp=c(105),pn=c(25),JI=(c(160),`uniform vec3 vReflectionColor;
uniform vec4 vAlbedoColor;

uniform vec4 vLightingIntensity;
uniform vec4 vReflectivityColor;
uniform vec4 vMetallicReflectanceFactors;
uniform vec3 vEmissiveColor;
uniform float visibility;

#ifdef ALBEDO
uniform vec2 vAlbedoInfos;
#endif
#ifdef AMBIENT
uniform vec4 vAmbientInfos;
#endif
#ifdef BUMP
uniform vec3 vBumpInfos;
uniform vec2 vTangentSpaceParams;
#endif
#ifdef OPACITY
uniform vec2 vOpacityInfos;
#endif
#ifdef EMISSIVE
uniform vec2 vEmissiveInfos;
#endif
#ifdef LIGHTMAP
uniform vec2 vLightmapInfos;
#endif
#ifdef REFLECTIVITY
uniform vec3 vReflectivityInfos;
#endif
#ifdef MICROSURFACEMAP
uniform vec2 vMicroSurfaceSamplerInfos;
#endif

#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(SS_REFRACTION)
uniform mat4 view;
#endif

#ifdef REFLECTION
uniform vec2 vReflectionInfos;
#ifdef REALTIME_FILTERING
uniform vec2 vReflectionFilteringInfo;
#endif
uniform mat4 reflectionMatrix;
uniform vec3 vReflectionMicrosurfaceInfos;
#if defined(USE_LOCAL_REFLECTIONMAP_CUBIC) && defined(REFLECTIONMAP_CUBIC)
uniform vec3 vReflectionPosition;
uniform vec3 vReflectionSize;
#endif
#endif

#ifdef CLEARCOAT
uniform vec2 vClearCoatParams;
uniform vec4 vClearCoatRefractionParams;
#if defined(CLEARCOAT_TEXTURE) || defined(CLEARCOAT_TEXTURE_ROUGHNESS)
uniform vec4 vClearCoatInfos;
#endif
#ifdef CLEARCOAT_TEXTURE
uniform mat4 clearCoatMatrix;
#endif
#ifdef CLEARCOAT_TEXTURE_ROUGHNESS
uniform mat4 clearCoatRoughnessMatrix;
#endif
#ifdef CLEARCOAT_BUMP
uniform vec2 vClearCoatBumpInfos;
uniform vec2 vClearCoatTangentSpaceParams;
uniform mat4 clearCoatBumpMatrix;
#endif
#ifdef CLEARCOAT_TINT
uniform vec4 vClearCoatTintParams;
uniform float clearCoatColorAtDistance;
#ifdef CLEARCOAT_TINT_TEXTURE
uniform vec2 vClearCoatTintInfos;
uniform mat4 clearCoatTintMatrix;
#endif
#endif
#endif

#ifdef ANISOTROPIC
uniform vec3 vAnisotropy;
#ifdef ANISOTROPIC_TEXTURE
uniform vec2 vAnisotropyInfos;
uniform mat4 anisotropyMatrix;
#endif
#endif

#ifdef SHEEN
uniform vec4 vSheenColor;
#ifdef SHEEN_ROUGHNESS
uniform float vSheenRoughness;
#endif
#if defined(SHEEN_TEXTURE) || defined(SHEEN_TEXTURE_ROUGHNESS)
uniform vec4 vSheenInfos;
#endif
#ifdef SHEEN_TEXTURE
uniform mat4 sheenMatrix;
#endif
#ifdef SHEEN_TEXTURE_ROUGHNESS
uniform mat4 sheenRoughnessMatrix;
#endif
#endif

#ifdef SUBSURFACE
#ifdef SS_REFRACTION
uniform vec3 vRefractionMicrosurfaceInfos;
uniform vec4 vRefractionInfos;
uniform mat4 refractionMatrix;
#ifdef REALTIME_FILTERING
uniform vec2 vRefractionFilteringInfo;
#endif
#endif
#ifdef SS_THICKNESSANDMASK_TEXTURE
uniform vec2 vThicknessInfos;
uniform mat4 thicknessMatrix;
#endif
uniform vec2 vThicknessParam;
uniform vec3 vDiffusionDistance;
uniform vec4 vTintColor;
uniform vec3 vSubSurfaceIntensity;
#endif
#ifdef PREPASS
#ifdef PREPASS_IRRADIANCE
uniform float scatteringDiffusionProfile;
#endif
#endif`);Ye.a.IncludesShadersStore.pbrFragmentDeclaration=JI;var eD=`layout(std140,column_major) uniform;
uniform Material
{
uniform vec2 vAlbedoInfos;
uniform vec4 vAmbientInfos;
uniform vec2 vOpacityInfos;
uniform vec2 vEmissiveInfos;
uniform vec2 vLightmapInfos;
uniform vec3 vReflectivityInfos;
uniform vec2 vMicroSurfaceSamplerInfos;
uniform vec2 vReflectionInfos;
uniform vec2 vReflectionFilteringInfo;
uniform vec3 vReflectionPosition;
uniform vec3 vReflectionSize;
uniform vec3 vBumpInfos;
uniform mat4 albedoMatrix;
uniform mat4 ambientMatrix;
uniform mat4 opacityMatrix;
uniform mat4 emissiveMatrix;
uniform mat4 lightmapMatrix;
uniform mat4 reflectivityMatrix;
uniform mat4 microSurfaceSamplerMatrix;
uniform mat4 bumpMatrix;
uniform vec2 vTangentSpaceParams;
uniform mat4 reflectionMatrix;
uniform vec3 vReflectionColor;
uniform vec4 vAlbedoColor;
uniform vec4 vLightingIntensity;
uniform vec3 vReflectionMicrosurfaceInfos;
uniform float pointSize;
uniform vec4 vReflectivityColor;
uniform vec3 vEmissiveColor;
uniform float visibility;
uniform vec4 vMetallicReflectanceFactors;
uniform vec2 vMetallicReflectanceInfos;
uniform mat4 metallicReflectanceMatrix;
uniform vec2 vClearCoatParams;
uniform vec4 vClearCoatRefractionParams;
uniform vec4 vClearCoatInfos;
uniform mat4 clearCoatMatrix;
uniform mat4 clearCoatRoughnessMatrix;
uniform vec2 vClearCoatBumpInfos;
uniform vec2 vClearCoatTangentSpaceParams;
uniform mat4 clearCoatBumpMatrix;
uniform vec4 vClearCoatTintParams;
uniform float clearCoatColorAtDistance;
uniform vec2 vClearCoatTintInfos;
uniform mat4 clearCoatTintMatrix;
uniform vec3 vAnisotropy;
uniform vec2 vAnisotropyInfos;
uniform mat4 anisotropyMatrix;
uniform vec4 vSheenColor;
uniform float vSheenRoughness;
uniform vec4 vSheenInfos;
uniform mat4 sheenMatrix;
uniform mat4 sheenRoughnessMatrix;
uniform vec3 vRefractionMicrosurfaceInfos;
uniform vec2 vRefractionFilteringInfo;
uniform vec4 vRefractionInfos;
uniform mat4 refractionMatrix;
uniform vec2 vThicknessInfos;
uniform mat4 thicknessMatrix;
uniform vec2 vThicknessParam;
uniform vec3 vDiffusionDistance;
uniform vec4 vTintColor;
uniform vec3 vSubSurfaceIntensity;
uniform float scatteringDiffusionProfile;
uniform vec4 vDetailInfos;
uniform mat4 detailMatrix;
};
uniform Scene {
mat4 viewProjection;
#ifdef MULTIVIEW
mat4 viewProjectionR;
#endif
mat4 view;
};`;Ye.a.IncludesShadersStore.pbrUboDeclaration=eD;var tD=`uniform vec4 vEyePosition;
uniform vec3 vAmbientColor;
uniform vec4 vCameraInfos;

varying vec3 vPositionW;
#if DEBUGMODE>0
uniform vec2 vDebugMode;
varying vec4 vClipSpacePosition;
#endif
#ifdef MAINUV1
varying vec2 vMainUV1;
#endif
#ifdef MAINUV2
varying vec2 vMainUV2;
#endif
#ifdef NORMAL
varying vec3 vNormalW;
#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)
varying vec3 vEnvironmentIrradiance;
#endif
#endif
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif`;Ye.a.IncludesShadersStore.pbrFragmentExtraDeclaration=tD;var nD=`#ifdef ALBEDO
#if ALBEDODIRECTUV == 1
#define vAlbedoUV vMainUV1
#elif ALBEDODIRECTUV == 2
#define vAlbedoUV vMainUV2
#else
varying vec2 vAlbedoUV;
#endif
uniform sampler2D albedoSampler;
#endif
#ifdef AMBIENT
#if AMBIENTDIRECTUV == 1
#define vAmbientUV vMainUV1
#elif AMBIENTDIRECTUV == 2
#define vAmbientUV vMainUV2
#else
varying vec2 vAmbientUV;
#endif
uniform sampler2D ambientSampler;
#endif
#ifdef OPACITY
#if OPACITYDIRECTUV == 1
#define vOpacityUV vMainUV1
#elif OPACITYDIRECTUV == 2
#define vOpacityUV vMainUV2
#else
varying vec2 vOpacityUV;
#endif
uniform sampler2D opacitySampler;
#endif
#ifdef EMISSIVE
#if EMISSIVEDIRECTUV == 1
#define vEmissiveUV vMainUV1
#elif EMISSIVEDIRECTUV == 2
#define vEmissiveUV vMainUV2
#else
varying vec2 vEmissiveUV;
#endif
uniform sampler2D emissiveSampler;
#endif
#ifdef LIGHTMAP
#if LIGHTMAPDIRECTUV == 1
#define vLightmapUV vMainUV1
#elif LIGHTMAPDIRECTUV == 2
#define vLightmapUV vMainUV2
#else
varying vec2 vLightmapUV;
#endif
uniform sampler2D lightmapSampler;
#endif
#ifdef REFLECTIVITY
#if REFLECTIVITYDIRECTUV == 1
#define vReflectivityUV vMainUV1
#elif REFLECTIVITYDIRECTUV == 2
#define vReflectivityUV vMainUV2
#else
varying vec2 vReflectivityUV;
#endif
uniform sampler2D reflectivitySampler;
#endif
#ifdef MICROSURFACEMAP
#if MICROSURFACEMAPDIRECTUV == 1
#define vMicroSurfaceSamplerUV vMainUV1
#elif MICROSURFACEMAPDIRECTUV == 2
#define vMicroSurfaceSamplerUV vMainUV2
#else
varying vec2 vMicroSurfaceSamplerUV;
#endif
uniform sampler2D microSurfaceSampler;
#endif
#ifdef METALLIC_REFLECTANCE
#if METALLIC_REFLECTANCEDIRECTUV == 1
#define vMetallicReflectanceUV vMainUV1
#elif METALLIC_REFLECTANCEDIRECTUV == 2
#define vMetallicReflectanceUV vMainUV2
#else
varying vec2 vMetallicReflectanceUV;
#endif
uniform sampler2D metallicReflectanceSampler;
#endif
#ifdef CLEARCOAT
#if defined(CLEARCOAT_TEXTURE)
#if CLEARCOAT_TEXTUREDIRECTUV == 1
#define vClearCoatUV vMainUV1
#elif CLEARCOAT_TEXTUREDIRECTUV == 2
#define vClearCoatUV vMainUV2
#else
varying vec2 vClearCoatUV;
#endif
#endif
#if defined(CLEARCOAT_TEXTURE_ROUGHNESS)
#if CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV == 1
#define vClearCoatRoughnessUV vMainUV1
#elif CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV == 2
#define vClearCoatRoughnessUV vMainUV2
#else
varying vec2 vClearCoatRoughnessUV;
#endif
#endif
#ifdef CLEARCOAT_TEXTURE
uniform sampler2D clearCoatSampler;
#endif
#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && !defined(CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL)
uniform sampler2D clearCoatRoughnessSampler;
#endif
#ifdef CLEARCOAT_BUMP
#if CLEARCOAT_BUMPDIRECTUV == 1
#define vClearCoatBumpUV vMainUV1
#elif CLEARCOAT_BUMPDIRECTUV == 2
#define vClearCoatBumpUV vMainUV2
#else
varying vec2 vClearCoatBumpUV;
#endif
uniform sampler2D clearCoatBumpSampler;
#endif
#ifdef CLEARCOAT_TINT_TEXTURE
#if CLEARCOAT_TINT_TEXTUREDIRECTUV == 1
#define vClearCoatTintUV vMainUV1
#elif CLEARCOAT_TINT_TEXTUREDIRECTUV == 2
#define vClearCoatTintUV vMainUV2
#else
varying vec2 vClearCoatTintUV;
#endif
uniform sampler2D clearCoatTintSampler;
#endif
#endif
#ifdef SHEEN
#ifdef SHEEN_TEXTURE
#if SHEEN_TEXTUREDIRECTUV == 1
#define vSheenUV vMainUV1
#elif SHEEN_TEXTUREDIRECTUV == 2
#define vSheenUV vMainUV2
#else
varying vec2 vSheenUV;
#endif
#endif
#ifdef SHEEN_TEXTURE_ROUGHNESS
#if SHEEN_TEXTURE_ROUGHNESSDIRECTUV == 1
#define vSheenRoughnessUV vMainUV1
#elif SHEEN_TEXTURE_ROUGHNESSDIRECTUV == 2
#define vSheenRoughnessUV vMainUV2
#else
varying vec2 vSheenRoughnessUV;
#endif
#endif
#ifdef SHEEN_TEXTURE
uniform sampler2D sheenSampler;
#endif
#if defined(SHEEN_ROUGHNESS) && defined(SHEEN_TEXTURE_ROUGHNESS) && !defined(SHEEN_TEXTURE_ROUGHNESS_IDENTICAL)
uniform sampler2D sheenRoughnessSampler;
#endif
#endif
#ifdef ANISOTROPIC
#ifdef ANISOTROPIC_TEXTURE
#if ANISOTROPIC_TEXTUREDIRECTUV == 1
#define vAnisotropyUV vMainUV1
#elif ANISOTROPIC_TEXTUREDIRECTUV == 2
#define vAnisotropyUV vMainUV2
#else
varying vec2 vAnisotropyUV;
#endif
uniform sampler2D anisotropySampler;
#endif
#endif

#ifdef REFLECTION
#ifdef REFLECTIONMAP_3D
#define sampleReflection(s,c) textureCube(s,c)
uniform samplerCube reflectionSampler;
#ifdef LODBASEDMICROSFURACE
#define sampleReflectionLod(s,c,l) textureCubeLodEXT(s,c,l)
#else
uniform samplerCube reflectionSamplerLow;
uniform samplerCube reflectionSamplerHigh;
#endif
#ifdef USEIRRADIANCEMAP
uniform samplerCube irradianceSampler;
#endif
#else
#define sampleReflection(s,c) texture2D(s,c)
uniform sampler2D reflectionSampler;
#ifdef LODBASEDMICROSFURACE
#define sampleReflectionLod(s,c,l) texture2DLodEXT(s,c,l)
#else
uniform sampler2D reflectionSamplerLow;
uniform sampler2D reflectionSamplerHigh;
#endif
#ifdef USEIRRADIANCEMAP
uniform sampler2D irradianceSampler;
#endif
#endif
#ifdef REFLECTIONMAP_SKYBOX
varying vec3 vPositionUVW;
#else
#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)
varying vec3 vDirectionW;
#endif
#endif
#endif
#ifdef ENVIRONMENTBRDF
uniform sampler2D environmentBrdfSampler;
#endif

#ifdef SUBSURFACE
#ifdef SS_REFRACTION
#ifdef SS_REFRACTIONMAP_3D
#define sampleRefraction(s,c) textureCube(s,c)
uniform samplerCube refractionSampler;
#ifdef LODBASEDMICROSFURACE
#define sampleRefractionLod(s,c,l) textureCubeLodEXT(s,c,l)
#else
uniform samplerCube refractionSamplerLow;
uniform samplerCube refractionSamplerHigh;
#endif
#else
#define sampleRefraction(s,c) texture2D(s,c)
uniform sampler2D refractionSampler;
#ifdef LODBASEDMICROSFURACE
#define sampleRefractionLod(s,c,l) texture2DLodEXT(s,c,l)
#else
uniform sampler2D refractionSamplerLow;
uniform sampler2D refractionSamplerHigh;
#endif
#endif
#endif
#ifdef SS_THICKNESSANDMASK_TEXTURE
#if SS_THICKNESSANDMASK_TEXTUREDIRECTUV == 1
#define vThicknessUV vMainUV1
#elif SS_THICKNESSANDMASK_TEXTUREDIRECTUV == 2
#define vThicknessUV vMainUV2
#else
varying vec2 vThicknessUV;
#endif
uniform sampler2D thicknessSampler;
#endif
#endif`;Ye.a.IncludesShadersStore.pbrFragmentSamplersDeclaration=nD,c(116),Ye.a.IncludesShadersStore.subSurfaceScatteringFunctions=`bool testLightingForSSS(float diffusionProfile)
{
return diffusionProfile<1.;
}`;var rD=`




























vec3 hemisphereCosSample(vec2 u) {

float phi=2.*PI*u.x;
float cosTheta2=1.-u.y;
float cosTheta=sqrt(cosTheta2);
float sinTheta=sqrt(1.-cosTheta2);
return vec3(sinTheta*cos(phi),sinTheta*sin(phi),cosTheta);
}





































vec3 hemisphereImportanceSampleDggx(vec2 u,float a) {

float phi=2.*PI*u.x;

float cosTheta2=(1.-u.y)/(1.+(a+1.)*((a-1.)*u.y));
float cosTheta=sqrt(cosTheta2);
float sinTheta=sqrt(1.-cosTheta2);
return vec3(sinTheta*cos(phi),sinTheta*sin(phi),cosTheta);
}

























































vec3 hemisphereImportanceSampleDCharlie(vec2 u,float a) {

float phi=2.*PI*u.x;
float sinTheta=pow(u.y,a/(2.*a+1.));
float cosTheta=sqrt(1.-sinTheta*sinTheta);
return vec3(sinTheta*cos(phi),sinTheta*sin(phi),cosTheta);
}`;Ye.a.IncludesShadersStore.importanceSampling=rD;var iD=`
#define RECIPROCAL_PI2 0.15915494
#define RECIPROCAL_PI 0.31830988618

#define MINIMUMVARIANCE 0.0005
float convertRoughnessToAverageSlope(float roughness)
{

return square(roughness)+MINIMUMVARIANCE;
}
float fresnelGrazingReflectance(float reflectance0) {


float reflectance90=saturate(reflectance0*25.0);
return reflectance90;
}
vec2 getAARoughnessFactors(vec3 normalVector) {
#ifdef SPECULARAA
vec3 nDfdx=dFdx(normalVector.xyz);
vec3 nDfdy=dFdy(normalVector.xyz);
float slopeSquare=max(dot(nDfdx,nDfdx),dot(nDfdy,nDfdy));

float geometricRoughnessFactor=pow(saturate(slopeSquare),0.333);

float geometricAlphaGFactor=sqrt(slopeSquare);

geometricAlphaGFactor*=0.75;
return vec2(geometricRoughnessFactor,geometricAlphaGFactor);
#else
return vec2(0.);
#endif
}
#ifdef ANISOTROPIC


vec2 getAnisotropicRoughness(float alphaG,float anisotropy) {
float alphaT=max(alphaG*(1.0+anisotropy),MINIMUMVARIANCE);
float alphaB=max(alphaG*(1.0-anisotropy),MINIMUMVARIANCE);
return vec2(alphaT,alphaB);
}


vec3 getAnisotropicBentNormals(const vec3 T,const vec3 B,const vec3 N,const vec3 V,float anisotropy) {
vec3 anisotropicFrameDirection=anisotropy>=0.0 ? B : T;
vec3 anisotropicFrameTangent=cross(normalize(anisotropicFrameDirection),V);
vec3 anisotropicFrameNormal=cross(anisotropicFrameTangent,anisotropicFrameDirection);
vec3 anisotropicNormal=normalize(mix(N,anisotropicFrameNormal,abs(anisotropy)));
return anisotropicNormal;

}
#endif
#if defined(CLEARCOAT) || defined(SS_REFRACTION)



vec3 cocaLambert(vec3 alpha,float distance) {
return exp(-alpha*distance);
}

vec3 cocaLambert(float NdotVRefract,float NdotLRefract,vec3 alpha,float thickness) {
return cocaLambert(alpha,(thickness*((NdotLRefract+NdotVRefract)/(NdotLRefract*NdotVRefract))));
}

vec3 computeColorAtDistanceInMedia(vec3 color,float distance) {
return -log(color)/distance;
}
vec3 computeClearCoatAbsorption(float NdotVRefract,float NdotLRefract,vec3 clearCoatColor,float clearCoatThickness,float clearCoatIntensity) {
vec3 clearCoatAbsorption=mix(vec3(1.0),
cocaLambert(NdotVRefract,NdotLRefract,clearCoatColor,clearCoatThickness),
clearCoatIntensity);
return clearCoatAbsorption;
}
#endif




#ifdef MICROSURFACEAUTOMATIC
float computeDefaultMicroSurface(float microSurface,vec3 reflectivityColor)
{
const float kReflectivityNoAlphaWorkflow_SmoothnessMax=0.95;
float reflectivityLuminance=getLuminance(reflectivityColor);
float reflectivityLuma=sqrt(reflectivityLuminance);
microSurface=reflectivityLuma*kReflectivityNoAlphaWorkflow_SmoothnessMax;
return microSurface;
}
#endif`;Ye.a.IncludesShadersStore.pbrHelperFunctions=iD;var oD=`#ifdef USESPHERICALFROMREFLECTIONMAP
#ifdef SPHERICAL_HARMONICS
uniform vec3 vSphericalL00;
uniform vec3 vSphericalL1_1;
uniform vec3 vSphericalL10;
uniform vec3 vSphericalL11;
uniform vec3 vSphericalL2_2;
uniform vec3 vSphericalL2_1;
uniform vec3 vSphericalL20;
uniform vec3 vSphericalL21;
uniform vec3 vSphericalL22;







vec3 computeEnvironmentIrradiance(vec3 normal) {
return vSphericalL00
+vSphericalL1_1*(normal.y)
+vSphericalL10*(normal.z)
+vSphericalL11*(normal.x)
+vSphericalL2_2*(normal.y*normal.x)
+vSphericalL2_1*(normal.y*normal.z)
+vSphericalL20*((3.0*normal.z*normal.z)-1.0)
+vSphericalL21*(normal.z*normal.x)
+vSphericalL22*(normal.x*normal.x-(normal.y*normal.y));
}
#else
uniform vec3 vSphericalX;
uniform vec3 vSphericalY;
uniform vec3 vSphericalZ;
uniform vec3 vSphericalXX_ZZ;
uniform vec3 vSphericalYY_ZZ;
uniform vec3 vSphericalZZ;
uniform vec3 vSphericalXY;
uniform vec3 vSphericalYZ;
uniform vec3 vSphericalZX;

vec3 computeEnvironmentIrradiance(vec3 normal) {









float Nx=normal.x;
float Ny=normal.y;
float Nz=normal.z;
vec3 C1=vSphericalZZ.rgb;
vec3 Cx=vSphericalX.rgb;
vec3 Cy=vSphericalY.rgb;
vec3 Cz=vSphericalZ.rgb;
vec3 Cxx_zz=vSphericalXX_ZZ.rgb;
vec3 Cyy_zz=vSphericalYY_ZZ.rgb;
vec3 Cxy=vSphericalXY.rgb;
vec3 Cyz=vSphericalYZ.rgb;
vec3 Czx=vSphericalZX.rgb;
vec3 a1=Cyy_zz*Ny+Cy;
vec3 a2=Cyz*Nz+a1;
vec3 b1=Czx*Nz+Cx;
vec3 b2=Cxy*Ny+b1;
vec3 b3=Cxx_zz*Nx+b2;
vec3 t1=Cz*Nz+C1;
vec3 t2=a2*Ny+t1;
vec3 t3=b3*Nx+t2;
return t3;
}
#endif
#endif`;Ye.a.IncludesShadersStore.harmonicsFunctions=oD;var aD=`
struct preLightingInfo
{

vec3 lightOffset;
float lightDistanceSquared;
float lightDistance;

float attenuation;

vec3 L;
vec3 H;
float NdotV;
float NdotLUnclamped;
float NdotL;
float VdotH;
float roughness;
};
preLightingInfo computePointAndSpotPreLightingInfo(vec4 lightData,vec3 V,vec3 N) {
preLightingInfo result;

result.lightOffset=lightData.xyz-vPositionW;
result.lightDistanceSquared=dot(result.lightOffset,result.lightOffset);

result.lightDistance=sqrt(result.lightDistanceSquared);

result.L=normalize(result.lightOffset);
result.H=normalize(V+result.L);
result.VdotH=saturate(dot(V,result.H));
result.NdotLUnclamped=dot(N,result.L);
result.NdotL=saturateEps(result.NdotLUnclamped);
return result;
}
preLightingInfo computeDirectionalPreLightingInfo(vec4 lightData,vec3 V,vec3 N) {
preLightingInfo result;

result.lightDistance=length(-lightData.xyz);

result.L=normalize(-lightData.xyz);
result.H=normalize(V+result.L);
result.VdotH=saturate(dot(V,result.H));
result.NdotLUnclamped=dot(N,result.L);
result.NdotL=saturateEps(result.NdotLUnclamped);
return result;
}
preLightingInfo computeHemisphericPreLightingInfo(vec4 lightData,vec3 V,vec3 N) {
preLightingInfo result;


result.NdotL=dot(N,lightData.xyz)*0.5+0.5;
result.NdotL=saturateEps(result.NdotL);
result.NdotLUnclamped=result.NdotL;
#ifdef SPECULARTERM
result.L=normalize(lightData.xyz);
result.H=normalize(V+result.L);
result.VdotH=saturate(dot(V,result.H));
#endif
return result;
}`;Ye.a.IncludesShadersStore.pbrDirectLightingSetupFunctions=aD;var sD=`float computeDistanceLightFalloff_Standard(vec3 lightOffset,float range)
{
return max(0.,1.0-length(lightOffset)/range);
}
float computeDistanceLightFalloff_Physical(float lightDistanceSquared)
{
return 1.0/maxEps(lightDistanceSquared);
}
float computeDistanceLightFalloff_GLTF(float lightDistanceSquared,float inverseSquaredRange)
{
float lightDistanceFalloff=1.0/maxEps(lightDistanceSquared);
float factor=lightDistanceSquared*inverseSquaredRange;
float attenuation=saturate(1.0-factor*factor);
attenuation*=attenuation;

lightDistanceFalloff*=attenuation;
return lightDistanceFalloff;
}
float computeDistanceLightFalloff(vec3 lightOffset,float lightDistanceSquared,float range,float inverseSquaredRange)
{
#ifdef USEPHYSICALLIGHTFALLOFF
return computeDistanceLightFalloff_Physical(lightDistanceSquared);
#elif defined(USEGLTFLIGHTFALLOFF)
return computeDistanceLightFalloff_GLTF(lightDistanceSquared,inverseSquaredRange);
#else
return computeDistanceLightFalloff_Standard(lightOffset,range);
#endif
}
float computeDirectionalLightFalloff_Standard(vec3 lightDirection,vec3 directionToLightCenterW,float cosHalfAngle,float exponent)
{
float falloff=0.0;
float cosAngle=maxEps(dot(-lightDirection,directionToLightCenterW));
if (cosAngle>=cosHalfAngle)
{
falloff=max(0.,pow(cosAngle,exponent));
}
return falloff;
}
float computeDirectionalLightFalloff_Physical(vec3 lightDirection,vec3 directionToLightCenterW,float cosHalfAngle)
{
const float kMinusLog2ConeAngleIntensityRatio=6.64385618977;





float concentrationKappa=kMinusLog2ConeAngleIntensityRatio/(1.0-cosHalfAngle);


vec4 lightDirectionSpreadSG=vec4(-lightDirection*concentrationKappa,-concentrationKappa);
float falloff=exp2(dot(vec4(directionToLightCenterW,1.0),lightDirectionSpreadSG));
return falloff;
}
float computeDirectionalLightFalloff_GLTF(vec3 lightDirection,vec3 directionToLightCenterW,float lightAngleScale,float lightAngleOffset)
{



float cd=dot(-lightDirection,directionToLightCenterW);
float falloff=saturate(cd*lightAngleScale+lightAngleOffset);

falloff*=falloff;
return falloff;
}
float computeDirectionalLightFalloff(vec3 lightDirection,vec3 directionToLightCenterW,float cosHalfAngle,float exponent,float lightAngleScale,float lightAngleOffset)
{
#ifdef USEPHYSICALLIGHTFALLOFF
return computeDirectionalLightFalloff_Physical(lightDirection,directionToLightCenterW,cosHalfAngle);
#elif defined(USEGLTFLIGHTFALLOFF)
return computeDirectionalLightFalloff_GLTF(lightDirection,directionToLightCenterW,lightAngleScale,lightAngleOffset);
#else
return computeDirectionalLightFalloff_Standard(lightDirection,directionToLightCenterW,cosHalfAngle,exponent);
#endif
}`;Ye.a.IncludesShadersStore.pbrDirectLightingFalloffFunctions=sD;var cD=`
#define FRESNEL_MAXIMUM_ON_ROUGH 0.25




#ifdef MS_BRDF_ENERGY_CONSERVATION


vec3 getEnergyConservationFactor(const vec3 specularEnvironmentR0,const vec3 environmentBrdf) {
return 1.0+specularEnvironmentR0*(1.0/environmentBrdf.y-1.0);
}
#endif
#ifdef ENVIRONMENTBRDF
vec3 getBRDFLookup(float NdotV,float perceptualRoughness) {

vec2 UV=vec2(NdotV,perceptualRoughness);

vec4 brdfLookup=texture2D(environmentBrdfSampler,UV);
#ifdef ENVIRONMENTBRDF_RGBD
brdfLookup.rgb=fromRGBD(brdfLookup.rgba);
#endif
return brdfLookup.rgb;
}
vec3 getReflectanceFromBRDFLookup(const vec3 specularEnvironmentR0,const vec3 specularEnvironmentR90,const vec3 environmentBrdf) {
#ifdef BRDF_V_HEIGHT_CORRELATED
vec3 reflectance=(specularEnvironmentR90-specularEnvironmentR0)*environmentBrdf.x+specularEnvironmentR0*environmentBrdf.y;

#else
vec3 reflectance=specularEnvironmentR0*environmentBrdf.x+specularEnvironmentR90*environmentBrdf.y;
#endif
return reflectance;
}
vec3 getReflectanceFromBRDFLookup(const vec3 specularEnvironmentR0,const vec3 environmentBrdf) {
#ifdef BRDF_V_HEIGHT_CORRELATED
vec3 reflectance=mix(environmentBrdf.xxx,environmentBrdf.yyy,specularEnvironmentR0);
#else
vec3 reflectance=specularEnvironmentR0*environmentBrdf.x+environmentBrdf.y;
#endif
return reflectance;
}
#endif

#if !defined(ENVIRONMENTBRDF) || defined(REFLECTIONMAP_SKYBOX) || defined(ALPHAFRESNEL)
vec3 getReflectanceFromAnalyticalBRDFLookup_Jones(float VdotN,vec3 reflectance0,vec3 reflectance90,float smoothness)
{

float weight=mix(FRESNEL_MAXIMUM_ON_ROUGH,1.0,smoothness);
return reflectance0+weight*(reflectance90-reflectance0)*pow5(saturate(1.0-VdotN));
}
#endif
#if defined(SHEEN) && defined(ENVIRONMENTBRDF)

vec3 getSheenReflectanceFromBRDFLookup(const vec3 reflectance0,const vec3 environmentBrdf) {
vec3 sheenEnvironmentReflectance=reflectance0*environmentBrdf.b;
return sheenEnvironmentReflectance;
}
#endif
























vec3 fresnelSchlickGGX(float VdotH,vec3 reflectance0,vec3 reflectance90)
{
return reflectance0+(reflectance90-reflectance0)*pow5(1.0-VdotH);
}
float fresnelSchlickGGX(float VdotH,float reflectance0,float reflectance90)
{
return reflectance0+(reflectance90-reflectance0)*pow5(1.0-VdotH);
}
#ifdef CLEARCOAT





vec3 getR0RemappedForClearCoat(vec3 f0) {
#ifdef CLEARCOAT_DEFAULTIOR
#ifdef MOBILE
return saturate(f0*(f0*0.526868+0.529324)-0.0482256);
#else
return saturate(f0*(f0*(0.941892-0.263008*f0)+0.346479)-0.0285998);
#endif
#else
vec3 s=sqrt(f0);
vec3 t=(vClearCoatRefractionParams.z+vClearCoatRefractionParams.w*s)/(vClearCoatRefractionParams.w+vClearCoatRefractionParams.z*s);
return t*t;
#endif
}
#endif






float normalDistributionFunction_TrowbridgeReitzGGX(float NdotH,float alphaG)
{



float a2=square(alphaG);
float d=NdotH*NdotH*(a2-1.0)+1.0;
return a2/(PI*d*d);
}
#ifdef SHEEN


float normalDistributionFunction_CharlieSheen(float NdotH,float alphaG)
{
float invR=1./alphaG;
float cos2h=NdotH*NdotH;
float sin2h=1.-cos2h;
return (2.+invR)*pow(sin2h,invR*.5)/(2.*PI);
}
#endif
#ifdef ANISOTROPIC


float normalDistributionFunction_BurleyGGX_Anisotropic(float NdotH,float TdotH,float BdotH,const vec2 alphaTB) {
float a2=alphaTB.x*alphaTB.y;
vec3 v=vec3(alphaTB.y*TdotH,alphaTB.x*BdotH,a2*NdotH);
float v2=dot(v,v);
float w2=a2/v2;
return a2*w2*w2*RECIPROCAL_PI;
}
#endif




#ifdef BRDF_V_HEIGHT_CORRELATED



float smithVisibility_GGXCorrelated(float NdotL,float NdotV,float alphaG) {
#ifdef MOBILE

float GGXV=NdotL*(NdotV*(1.0-alphaG)+alphaG);
float GGXL=NdotV*(NdotL*(1.0-alphaG)+alphaG);
return 0.5/(GGXV+GGXL);
#else
float a2=alphaG*alphaG;
float GGXV=NdotL*sqrt(NdotV*(NdotV-a2*NdotV)+a2);
float GGXL=NdotV*sqrt(NdotL*(NdotL-a2*NdotL)+a2);
return 0.5/(GGXV+GGXL);
#endif
}
#else















float smithVisibilityG1_TrowbridgeReitzGGXFast(float dot,float alphaG)
{
#ifdef MOBILE

return 1.0/(dot+alphaG+(1.0-alphaG)*dot ));
#else
float alphaSquared=alphaG*alphaG;
return 1.0/(dot+sqrt(alphaSquared+(1.0-alphaSquared)*dot*dot));
#endif
}
float smithVisibility_TrowbridgeReitzGGXFast(float NdotL,float NdotV,float alphaG)
{
float visibility=smithVisibilityG1_TrowbridgeReitzGGXFast(NdotL,alphaG)*smithVisibilityG1_TrowbridgeReitzGGXFast(NdotV,alphaG);

return visibility;
}
#endif
#ifdef ANISOTROPIC


float smithVisibility_GGXCorrelated_Anisotropic(float NdotL,float NdotV,float TdotV,float BdotV,float TdotL,float BdotL,const vec2 alphaTB) {
float lambdaV=NdotL*length(vec3(alphaTB.x*TdotV,alphaTB.y*BdotV,NdotV));
float lambdaL=NdotV*length(vec3(alphaTB.x*TdotL,alphaTB.y*BdotL,NdotL));
float v=0.5/(lambdaV+lambdaL);
return v;
}
#endif
#ifdef CLEARCOAT
float visibility_Kelemen(float VdotH) {



return 0.25/(VdotH*VdotH);
}
#endif
#ifdef SHEEN



float visibility_Ashikhmin(float NdotL,float NdotV)
{
return 1./(4.*(NdotL+NdotV-NdotL*NdotV));
}

#endif







float diffuseBRDF_Burley(float NdotL,float NdotV,float VdotH,float roughness) {


float diffuseFresnelNV=pow5(saturateEps(1.0-NdotL));
float diffuseFresnelNL=pow5(saturateEps(1.0-NdotV));
float diffuseFresnel90=0.5+2.0*VdotH*VdotH*roughness;
float fresnel =
(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNL) *
(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNV);
return fresnel/PI;
}
#ifdef SS_TRANSLUCENCY


vec3 transmittanceBRDF_Burley(const vec3 tintColor,const vec3 diffusionDistance,float thickness) {
vec3 S=1./maxEps(diffusionDistance);
vec3 temp=exp((-0.333333333*thickness)*S);
return tintColor.rgb*0.25*(temp*temp*temp+3.0*temp);
}


float computeWrappedDiffuseNdotL(float NdotL,float w) {
float t=1.0+w;
float invt2=1.0/square(t);
return saturate((NdotL+w)*invt2);
}
#endif
`;Ye.a.IncludesShadersStore.pbrBRDFFunctions=cD;var lD=`#ifdef NUM_SAMPLES
#if NUM_SAMPLES>0
#ifdef WEBGL2


float radicalInverse_VdC(uint bits)
{
bits=(bits << 16u) | (bits >> 16u);
bits=((bits & 0x55555555u) << 1u) | ((bits & 0xAAAAAAAAu) >> 1u);
bits=((bits & 0x33333333u) << 2u) | ((bits & 0xCCCCCCCCu) >> 2u);
bits=((bits & 0x0F0F0F0Fu) << 4u) | ((bits & 0xF0F0F0F0u) >> 4u);
bits=((bits & 0x00FF00FFu) << 8u) | ((bits & 0xFF00FF00u) >> 8u);
return float(bits)*2.3283064365386963e-10;
}
vec2 hammersley(uint i,uint N)
{
return vec2(float(i)/float(N),radicalInverse_VdC(i));
}
#else
float vanDerCorpus(int n,int base)
{
float invBase=1.0/float(base);
float denom=1.0;
float result=0.0;
for(int i=0; i<32; ++i)
{
if(n>0)
{
denom=mod(float(n),2.0);
result+=denom*invBase;
invBase=invBase/2.0;
n=int(float(n)/2.0);
}
}
return result;
}
vec2 hammersley(int i,int N)
{
return vec2(float(i)/float(N),vanDerCorpus(i,2));
}
#endif
float log4(float x) {
return log2(x)/2.;
}
const float NUM_SAMPLES_FLOAT=float(NUM_SAMPLES);
const float NUM_SAMPLES_FLOAT_INVERSED=1./NUM_SAMPLES_FLOAT;
const float K=4.;



















































































































#define inline
vec3 irradiance(samplerCube inputTexture,vec3 inputN,vec2 filteringInfo)
{
vec3 n=normalize(inputN);
vec3 result=vec3(0.0);
vec3 tangent=abs(n.z)<0.999 ? vec3(0.,0.,1.) : vec3(1.,0.,0.);
tangent=normalize(cross(tangent,n));
vec3 bitangent=cross(n,tangent);
mat3 tbn=mat3(tangent,bitangent,n);
float maxLevel=filteringInfo.y;
float dim0=filteringInfo.x;
float omegaP=(4.*PI)/(6.*dim0*dim0);
#ifdef WEBGL2
for(uint i=0u; i<NUM_SAMPLES; ++i)
#else
for(int i=0; i<NUM_SAMPLES; ++i)
#endif
{
vec2 Xi=hammersley(i,NUM_SAMPLES);
vec3 Ls=hemisphereCosSample(Xi);
Ls=normalize(Ls);
vec3 Ns=vec3(0.,0.,1.);
float NoL=dot(Ns,Ls);
if (NoL>0.) {
float pdf_inversed=PI/NoL;
float omegaS=NUM_SAMPLES_FLOAT_INVERSED*pdf_inversed;
float l=log4(omegaS)-log4(omegaP)+log4(K);
float mipLevel=clamp(l,0.0,maxLevel);
vec3 c=textureCubeLodEXT(inputTexture,tbn*Ls,mipLevel).rgb;
#ifdef GAMMA_INPUT
c=toLinearSpace(c);
#endif
result+=c;
}
}
result=result*NUM_SAMPLES_FLOAT_INVERSED;
return result;
}
#define inline
vec3 radiance(float alphaG,samplerCube inputTexture,vec3 inputN,vec2 filteringInfo)
{
vec3 n=normalize(inputN);
if (alphaG == 0.) {
vec3 c=textureCube(inputTexture,n).rgb;
#ifdef GAMMA_INPUT
c=toLinearSpace(c);
#endif
return c;
}
vec3 result=vec3(0.);
vec3 tangent=abs(n.z)<0.999 ? vec3(0.,0.,1.) : vec3(1.,0.,0.);
tangent=normalize(cross(tangent,n));
vec3 bitangent=cross(n,tangent);
mat3 tbn=mat3(tangent,bitangent,n);
float maxLevel=filteringInfo.y;
float dim0=filteringInfo.x;
float omegaP=(4.*PI)/(6.*dim0*dim0);
float weight=0.;
#ifdef WEBGL2
for(uint i=0u; i<NUM_SAMPLES; ++i)
#else
for(int i=0; i<NUM_SAMPLES; ++i)
#endif
{
vec2 Xi=hammersley(i,NUM_SAMPLES);
vec3 H=hemisphereImportanceSampleDggx(Xi,alphaG);
float NoV=1.;
float NoH=H.z;
float NoH2=H.z*H.z;
float NoL=2.*NoH2-1.;
vec3 L=vec3(2.*NoH*H.x,2.*NoH*H.y,NoL);
L=normalize(L);
if (NoL>0.) {
float pdf_inversed=4./normalDistributionFunction_TrowbridgeReitzGGX(NoH,alphaG);
float omegaS=NUM_SAMPLES_FLOAT_INVERSED*pdf_inversed;
float l=log4(omegaS)-log4(omegaP)+log4(K);
float mipLevel=clamp(float(l),0.0,maxLevel);
weight+=NoL;
vec3 c=textureCubeLodEXT(inputTexture,tbn*L,mipLevel).rgb;
#ifdef GAMMA_INPUT
c=toLinearSpace(c);
#endif
result+=c*NoL;
}
}
result=result/weight;
return result;
}
#endif
#endif`;Ye.a.IncludesShadersStore.hdrFilteringFunctions=lD;var uD=`#define CLEARCOATREFLECTANCE90 1.0

struct lightingInfo
{
vec3 diffuse;
#ifdef SPECULARTERM
vec3 specular;
#endif
#ifdef CLEARCOAT


vec4 clearCoat;
#endif
#ifdef SHEEN
vec3 sheen;
#endif
};

float adjustRoughnessFromLightProperties(float roughness,float lightRadius,float lightDistance) {
#if defined(USEPHYSICALLIGHTFALLOFF) || defined(USEGLTFLIGHTFALLOFF)

float lightRoughness=lightRadius/lightDistance;

float totalRoughness=saturate(lightRoughness+roughness);
return totalRoughness;
#else
return roughness;
#endif
}
vec3 computeHemisphericDiffuseLighting(preLightingInfo info,vec3 lightColor,vec3 groundColor) {
return mix(groundColor,lightColor,info.NdotL);
}
vec3 computeDiffuseLighting(preLightingInfo info,vec3 lightColor) {
float diffuseTerm=diffuseBRDF_Burley(info.NdotL,info.NdotV,info.VdotH,info.roughness);
return diffuseTerm*info.attenuation*info.NdotL*lightColor;
}
#define inline
vec3 computeProjectionTextureDiffuseLighting(sampler2D projectionLightSampler,mat4 textureProjectionMatrix){
vec4 strq=textureProjectionMatrix*vec4(vPositionW,1.0);
strq/=strq.w;
vec3 textureColor=texture2D(projectionLightSampler,strq.xy).rgb;
return toLinearSpace(textureColor);
}
#ifdef SS_TRANSLUCENCY
vec3 computeDiffuseAndTransmittedLighting(preLightingInfo info,vec3 lightColor,vec3 transmittance) {
float NdotL=absEps(info.NdotLUnclamped);

float wrapNdotL=computeWrappedDiffuseNdotL(NdotL,0.02);

float trAdapt=step(0.,info.NdotLUnclamped);
vec3 transmittanceNdotL=mix(transmittance*wrapNdotL,vec3(wrapNdotL),trAdapt);
float diffuseTerm=diffuseBRDF_Burley(NdotL,info.NdotV,info.VdotH,info.roughness);
return diffuseTerm*transmittanceNdotL*info.attenuation*lightColor;
}
#endif
#ifdef SPECULARTERM
vec3 computeSpecularLighting(preLightingInfo info,vec3 N,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor,vec3 lightColor) {
float NdotH=saturateEps(dot(N,info.H));
float roughness=max(info.roughness,geometricRoughnessFactor);
float alphaG=convertRoughnessToAverageSlope(roughness);
vec3 fresnel=fresnelSchlickGGX(info.VdotH,reflectance0,reflectance90);
float distribution=normalDistributionFunction_TrowbridgeReitzGGX(NdotH,alphaG);
#ifdef BRDF_V_HEIGHT_CORRELATED
float smithVisibility=smithVisibility_GGXCorrelated(info.NdotL,info.NdotV,alphaG);
#else
float smithVisibility=smithVisibility_TrowbridgeReitzGGXFast(info.NdotL,info.NdotV,alphaG);
#endif
vec3 specTerm=fresnel*distribution*smithVisibility;
return specTerm*info.attenuation*info.NdotL*lightColor;
}
#endif
#ifdef ANISOTROPIC
vec3 computeAnisotropicSpecularLighting(preLightingInfo info,vec3 V,vec3 N,vec3 T,vec3 B,float anisotropy,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor,vec3 lightColor) {
float NdotH=saturateEps(dot(N,info.H));
float TdotH=dot(T,info.H);
float BdotH=dot(B,info.H);
float TdotV=dot(T,V);
float BdotV=dot(B,V);
float TdotL=dot(T,info.L);
float BdotL=dot(B,info.L);
float alphaG=convertRoughnessToAverageSlope(info.roughness);
vec2 alphaTB=getAnisotropicRoughness(alphaG,anisotropy);
alphaTB=max(alphaTB,square(geometricRoughnessFactor));
vec3 fresnel=fresnelSchlickGGX(info.VdotH,reflectance0,reflectance90);
float distribution=normalDistributionFunction_BurleyGGX_Anisotropic(NdotH,TdotH,BdotH,alphaTB);
float smithVisibility=smithVisibility_GGXCorrelated_Anisotropic(info.NdotL,info.NdotV,TdotV,BdotV,TdotL,BdotL,alphaTB);
vec3 specTerm=fresnel*distribution*smithVisibility;
return specTerm*info.attenuation*info.NdotL*lightColor;
}
#endif
#ifdef CLEARCOAT
vec4 computeClearCoatLighting(preLightingInfo info,vec3 Ncc,float geometricRoughnessFactor,float clearCoatIntensity,vec3 lightColor) {
float NccdotL=saturateEps(dot(Ncc,info.L));
float NccdotH=saturateEps(dot(Ncc,info.H));
float clearCoatRoughness=max(info.roughness,geometricRoughnessFactor);
float alphaG=convertRoughnessToAverageSlope(clearCoatRoughness);
float fresnel=fresnelSchlickGGX(info.VdotH,vClearCoatRefractionParams.x,CLEARCOATREFLECTANCE90);
fresnel*=clearCoatIntensity;
float distribution=normalDistributionFunction_TrowbridgeReitzGGX(NccdotH,alphaG);
float kelemenVisibility=visibility_Kelemen(info.VdotH);
float clearCoatTerm=fresnel*distribution*kelemenVisibility;
return vec4(
clearCoatTerm*info.attenuation*NccdotL*lightColor,
1.0-fresnel
);
}
vec3 computeClearCoatLightingAbsorption(float NdotVRefract,vec3 L,vec3 Ncc,vec3 clearCoatColor,float clearCoatThickness,float clearCoatIntensity) {
vec3 LRefract=-refract(L,Ncc,vClearCoatRefractionParams.y);
float NdotLRefract=saturateEps(dot(Ncc,LRefract));
vec3 absorption=computeClearCoatAbsorption(NdotVRefract,NdotLRefract,clearCoatColor,clearCoatThickness,clearCoatIntensity);
return absorption;
}
#endif
#ifdef SHEEN
vec3 computeSheenLighting(preLightingInfo info,vec3 N,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor,vec3 lightColor) {
float NdotH=saturateEps(dot(N,info.H));
float roughness=max(info.roughness,geometricRoughnessFactor);
float alphaG=convertRoughnessToAverageSlope(roughness);


float fresnel=1.;
float distribution=normalDistributionFunction_CharlieSheen(NdotH,alphaG);

float visibility=visibility_Ashikhmin(info.NdotL,info.NdotV);

float sheenTerm=fresnel*distribution*visibility;
return sheenTerm*info.attenuation*info.NdotL*lightColor;
}
#endif
`;Ye.a.IncludesShadersStore.pbrDirectLightingFunctions=uD;var hD=`#if defined(REFLECTION) || defined(SS_REFRACTION)
float getLodFromAlphaG(float cubeMapDimensionPixels,float microsurfaceAverageSlope) {
float microsurfaceAverageSlopeTexels=cubeMapDimensionPixels*microsurfaceAverageSlope;
float lod=log2(microsurfaceAverageSlopeTexels);
return lod;
}
float getLinearLodFromRoughness(float cubeMapDimensionPixels,float roughness) {
float lod=log2(cubeMapDimensionPixels)*roughness;
return lod;
}
#endif
#if defined(ENVIRONMENTBRDF) && defined(RADIANCEOCCLUSION)
float environmentRadianceOcclusion(float ambientOcclusion,float NdotVUnclamped) {


float temp=NdotVUnclamped+ambientOcclusion;
return saturate(square(temp)-1.0+ambientOcclusion);
}
#endif
#if defined(ENVIRONMENTBRDF) && defined(HORIZONOCCLUSION)
float environmentHorizonOcclusion(vec3 view,vec3 normal,vec3 geometricNormal) {

vec3 reflection=reflect(view,normal);
float temp=saturate(1.0+1.1*dot(reflection,geometricNormal));
return square(temp);
}
#endif




#if defined(LODINREFLECTIONALPHA) || defined(SS_LODINREFRACTIONALPHA)


#define UNPACK_LOD(x) (1.0-x)*255.0
float getLodFromAlphaG(float cubeMapDimensionPixels,float alphaG,float NdotV) {
float microsurfaceAverageSlope=alphaG;






microsurfaceAverageSlope*=sqrt(abs(NdotV));
return getLodFromAlphaG(cubeMapDimensionPixels,microsurfaceAverageSlope);
}
#endif`;Ye.a.IncludesShadersStore.pbrIBLFunctions=hD,c(132),c(133);var dD=`struct albedoOpacityOutParams
{
vec3 surfaceAlbedo;
float alpha;
};
#define pbr_inline
void albedoOpacityBlock(
const in vec4 vAlbedoColor,
#ifdef ALBEDO
const in vec4 albedoTexture,
const in vec2 albedoInfos,
#endif
#ifdef OPACITY
const in vec4 opacityMap,
const in vec2 vOpacityInfos,
#endif
#ifdef DETAIL
const in vec4 detailColor,
const in vec4 vDetailInfos,
#endif
out albedoOpacityOutParams outParams
)
{

vec3 surfaceAlbedo=vAlbedoColor.rgb;
float alpha=vAlbedoColor.a;
#ifdef ALBEDO
#if defined(ALPHAFROMALBEDO) || defined(ALPHATEST)
alpha*=albedoTexture.a;
#endif
#ifdef GAMMAALBEDO
surfaceAlbedo*=toLinearSpace(albedoTexture.rgb);
#else
surfaceAlbedo*=albedoTexture.rgb;
#endif
surfaceAlbedo*=albedoInfos.y;
#endif
#ifdef VERTEXCOLOR
surfaceAlbedo*=vColor.rgb;
#endif
#ifdef DETAIL
float detailAlbedo=2.0*mix(0.5,detailColor.r,vDetailInfos.y);
surfaceAlbedo.rgb=surfaceAlbedo.rgb*detailAlbedo*detailAlbedo;
#endif
#define CUSTOM_FRAGMENT_UPDATE_ALBEDO

#ifdef OPACITY
#ifdef OPACITYRGB
alpha=getLuminance(opacityMap.rgb);
#else
alpha*=opacityMap.a;
#endif
alpha*=vOpacityInfos.y;
#endif
#ifdef VERTEXALPHA
alpha*=vColor.a;
#endif
#if !defined(SS_LINKREFRACTIONTOTRANSPARENCY) && !defined(ALPHAFRESNEL)
#ifdef ALPHATEST
if (alpha<ALPHATESTVALUE)
discard;
#ifndef ALPHABLEND

alpha=1.0;
#endif
#endif
#endif
outParams.surfaceAlbedo=surfaceAlbedo;
outParams.alpha=alpha;
}
`;Ye.a.IncludesShadersStore.pbrBlockAlbedoOpacity=dD;var fD=`struct reflectivityOutParams
{
float microSurface;
float roughness;
vec3 surfaceReflectivityColor;
#ifdef METALLICWORKFLOW
vec3 surfaceAlbedo;
#endif
#if defined(METALLICWORKFLOW) && defined(REFLECTIVITY) && defined(AOSTOREINMETALMAPRED)
vec3 ambientOcclusionColor;
#endif
#if DEBUGMODE>0
vec4 surfaceMetallicColorMap;
vec4 surfaceReflectivityColorMap;
vec2 metallicRoughness;
vec3 metallicF0;
#endif
};
#define pbr_inline
void reflectivityBlock(
const in vec4 vReflectivityColor,
#ifdef METALLICWORKFLOW
const in vec3 surfaceAlbedo,
const in vec4 metallicReflectanceFactors,
#endif
#ifdef REFLECTIVITY
const in vec3 reflectivityInfos,
const in vec4 surfaceMetallicOrReflectivityColorMap,
#endif
#if defined(METALLICWORKFLOW) && defined(REFLECTIVITY) && defined(AOSTOREINMETALMAPRED)
const in vec3 ambientOcclusionColorIn,
#endif
#ifdef MICROSURFACEMAP
const in vec4 microSurfaceTexel,
#endif
#ifdef DETAIL
const in vec4 detailColor,
const in vec4 vDetailInfos,
#endif
out reflectivityOutParams outParams
)
{
float microSurface=vReflectivityColor.a;
vec3 surfaceReflectivityColor=vReflectivityColor.rgb;
#ifdef METALLICWORKFLOW
vec2 metallicRoughness=surfaceReflectivityColor.rg;
#ifdef REFLECTIVITY
#if DEBUGMODE>0
outParams.surfaceMetallicColorMap=surfaceMetallicOrReflectivityColorMap;
#endif
#ifdef AOSTOREINMETALMAPRED
vec3 aoStoreInMetalMap=vec3(surfaceMetallicOrReflectivityColorMap.r,surfaceMetallicOrReflectivityColorMap.r,surfaceMetallicOrReflectivityColorMap.r);
outParams.ambientOcclusionColor=mix(ambientOcclusionColorIn,aoStoreInMetalMap,reflectivityInfos.z);
#endif
#ifdef METALLNESSSTOREINMETALMAPBLUE
metallicRoughness.r*=surfaceMetallicOrReflectivityColorMap.b;
#else
metallicRoughness.r*=surfaceMetallicOrReflectivityColorMap.r;
#endif
#ifdef ROUGHNESSSTOREINMETALMAPALPHA
metallicRoughness.g*=surfaceMetallicOrReflectivityColorMap.a;
#else
#ifdef ROUGHNESSSTOREINMETALMAPGREEN
metallicRoughness.g*=surfaceMetallicOrReflectivityColorMap.g;
#endif
#endif
#endif
#ifdef DETAIL
float detailRoughness=mix(0.5,detailColor.b,vDetailInfos.w);
float loLerp=mix(0.,metallicRoughness.g,detailRoughness*2.);
float hiLerp=mix(metallicRoughness.g,1.,(detailRoughness-0.5)*2.);
metallicRoughness.g=mix(loLerp,hiLerp,step(detailRoughness,0.5));
#endif
#ifdef MICROSURFACEMAP
metallicRoughness.g*=microSurfaceTexel.r;
#endif
#if DEBUGMODE>0
outParams.metallicRoughness=metallicRoughness;
#endif
#define CUSTOM_FRAGMENT_UPDATE_METALLICROUGHNESS

microSurface=1.0-metallicRoughness.g;

vec3 baseColor=surfaceAlbedo;
#ifdef FROSTBITE_REFLECTANCE






outParams.surfaceAlbedo=baseColor.rgb*(1.0-metallicRoughness.r);

surfaceReflectivityColor=mix(0.16*reflectance*reflectance,baseColor,metallicRoughness.r);
#else
vec3 metallicF0=metallicReflectanceFactors.rgb;
#if DEBUGMODE>0
outParams.metallicF0=metallicF0;
#endif

outParams.surfaceAlbedo=mix(baseColor.rgb*(1.0-metallicF0),vec3(0.,0.,0.),metallicRoughness.r);

surfaceReflectivityColor=mix(metallicF0,baseColor,metallicRoughness.r);
#endif
#else
#ifdef REFLECTIVITY
surfaceReflectivityColor*=surfaceMetallicOrReflectivityColorMap.rgb;
#if DEBUGMODE>0
outParams.surfaceReflectivityColorMap=surfaceMetallicOrReflectivityColorMap;
#endif
#ifdef MICROSURFACEFROMREFLECTIVITYMAP
microSurface*=surfaceMetallicOrReflectivityColorMap.a;
microSurface*=reflectivityInfos.z;
#else
#ifdef MICROSURFACEAUTOMATIC
microSurface*=computeDefaultMicroSurface(microSurface,surfaceReflectivityColor);
#endif
#ifdef MICROSURFACEMAP
microSurface*=microSurfaceTexel.r;
#endif
#define CUSTOM_FRAGMENT_UPDATE_MICROSURFACE
#endif
#endif
#endif

microSurface=saturate(microSurface);

float roughness=1.-microSurface;
outParams.microSurface=microSurface;
outParams.roughness=roughness;
outParams.surfaceReflectivityColor=surfaceReflectivityColor;
}
`;Ye.a.IncludesShadersStore.pbrBlockReflectivity=fD;var pD=`struct ambientOcclusionOutParams
{
vec3 ambientOcclusionColor;
#if DEBUGMODE>0
vec3 ambientOcclusionColorMap;
#endif
};
#define pbr_inline
void ambientOcclusionBlock(
#ifdef AMBIENT
const in vec3 ambientOcclusionColorMap_,
const in vec4 vAmbientInfos,
#endif
out ambientOcclusionOutParams outParams
)
{
vec3 ambientOcclusionColor=vec3(1.,1.,1.);
#ifdef AMBIENT
vec3 ambientOcclusionColorMap=ambientOcclusionColorMap_*vAmbientInfos.y;
#ifdef AMBIENTINGRAYSCALE
ambientOcclusionColorMap=vec3(ambientOcclusionColorMap.r,ambientOcclusionColorMap.r,ambientOcclusionColorMap.r);
#endif
ambientOcclusionColor=mix(ambientOcclusionColor,ambientOcclusionColorMap,vAmbientInfos.z);
#if DEBUGMODE>0
outParams.ambientOcclusionColorMap=ambientOcclusionColorMap;
#endif
#endif
outParams.ambientOcclusionColor=ambientOcclusionColor;
}
`;Ye.a.IncludesShadersStore.pbrBlockAmbientOcclusion=pD;var mD=`#ifdef ALPHAFRESNEL
#if defined(ALPHATEST) || defined(ALPHABLEND)
struct alphaFresnelOutParams
{
float alpha;
};
#define pbr_inline
void alphaFresnelBlock(
const in vec3 normalW,
const in vec3 viewDirectionW,
const in float alpha,
const in float microSurface,
out alphaFresnelOutParams outParams
)
{



float opacityPerceptual=alpha;
#ifdef LINEARALPHAFRESNEL
float opacity0=opacityPerceptual;
#else
float opacity0=opacityPerceptual*opacityPerceptual;
#endif
float opacity90=fresnelGrazingReflectance(opacity0);
vec3 normalForward=faceforward(normalW,-viewDirectionW,normalW);

outParams.alpha=getReflectanceFromAnalyticalBRDFLookup_Jones(saturate(dot(viewDirectionW,normalForward)),vec3(opacity0),vec3(opacity90),sqrt(microSurface)).x;
#ifdef ALPHATEST
if (outParams.alpha<ALPHATESTVALUE)
discard;
#ifndef ALPHABLEND

outParams.alpha=1.0;
#endif
#endif
}
#endif
#endif
`;Ye.a.IncludesShadersStore.pbrBlockAlphaFresnel=mD;var _D=`#ifdef ANISOTROPIC
struct anisotropicOutParams
{
float anisotropy;
vec3 anisotropicTangent;
vec3 anisotropicBitangent;
vec3 anisotropicNormal;
#if DEBUGMODE>0
vec3 anisotropyMapData;
#endif
};
#define pbr_inline
void anisotropicBlock(
const in vec3 vAnisotropy,
#ifdef ANISOTROPIC_TEXTURE
const in vec3 anisotropyMapData,
#endif
const in mat3 TBN,
const in vec3 normalW,
const in vec3 viewDirectionW,
out anisotropicOutParams outParams
)
{
float anisotropy=vAnisotropy.b;
vec3 anisotropyDirection=vec3(vAnisotropy.xy,0.);
#ifdef ANISOTROPIC_TEXTURE
anisotropy*=anisotropyMapData.b;
anisotropyDirection.rg*=anisotropyMapData.rg*2.0-1.0;
#if DEBUGMODE>0
outParams.anisotropyMapData=anisotropyMapData;
#endif
#endif
mat3 anisoTBN=mat3(normalize(TBN[0]),normalize(TBN[1]),normalize(TBN[2]));
vec3 anisotropicTangent=normalize(anisoTBN*anisotropyDirection);
vec3 anisotropicBitangent=normalize(cross(anisoTBN[2],anisotropicTangent));
outParams.anisotropy=anisotropy;
outParams.anisotropicTangent=anisotropicTangent;
outParams.anisotropicBitangent=anisotropicBitangent;
outParams.anisotropicNormal=getAnisotropicBentNormals(anisotropicTangent,anisotropicBitangent,normalW,viewDirectionW,anisotropy);
}
#endif
`;Ye.a.IncludesShadersStore.pbrBlockAnisotropic=_D;var gD=`#ifdef REFLECTION
struct reflectionOutParams
{
vec4 environmentRadiance;
vec3 environmentIrradiance;
#ifdef REFLECTIONMAP_3D
vec3 reflectionCoords;
#else
vec2 reflectionCoords;
#endif
#ifdef SS_TRANSLUCENCY
#ifdef USESPHERICALFROMREFLECTIONMAP
#if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)
vec3 irradianceVector;
#endif
#endif
#endif
};
#define pbr_inline
void createReflectionCoords(
const in vec3 vPositionW,
const in vec3 normalW,
#ifdef ANISOTROPIC
const in anisotropicOutParams anisotropicOut,
#endif
#ifdef REFLECTIONMAP_3D
out vec3 reflectionCoords
#else
out vec2 reflectionCoords
#endif
)
{
#ifdef ANISOTROPIC
vec3 reflectionVector=computeReflectionCoords(vec4(vPositionW,1.0),anisotropicOut.anisotropicNormal);
#else
vec3 reflectionVector=computeReflectionCoords(vec4(vPositionW,1.0),normalW);
#endif
#ifdef REFLECTIONMAP_OPPOSITEZ
reflectionVector.z*=-1.0;
#endif

#ifdef REFLECTIONMAP_3D
reflectionCoords=reflectionVector;
#else
reflectionCoords=reflectionVector.xy;
#ifdef REFLECTIONMAP_PROJECTION
reflectionCoords/=reflectionVector.z;
#endif
reflectionCoords.y=1.0-reflectionCoords.y;
#endif
}
#define pbr_inline
#define inline
void sampleReflectionTexture(
const in float alphaG,
const in vec3 vReflectionMicrosurfaceInfos,
const in vec2 vReflectionInfos,
const in vec3 vReflectionColor,
#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)
const in float NdotVUnclamped,
#endif
#ifdef LINEARSPECULARREFLECTION
const in float roughness,
#endif
#ifdef REFLECTIONMAP_3D
const in samplerCube reflectionSampler,
const vec3 reflectionCoords,
#else
const in sampler2D reflectionSampler,
const vec2 reflectionCoords,
#endif
#ifndef LODBASEDMICROSFURACE
#ifdef REFLECTIONMAP_3D
const in samplerCube reflectionSamplerLow,
const in samplerCube reflectionSamplerHigh,
#else
const in sampler2D reflectionSamplerLow,
const in sampler2D reflectionSamplerHigh,
#endif
#endif
#ifdef REALTIME_FILTERING
const in vec2 vReflectionFilteringInfo,
#endif
out vec4 environmentRadiance
)
{

#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)
float reflectionLOD=getLodFromAlphaG(vReflectionMicrosurfaceInfos.x,alphaG,NdotVUnclamped);
#elif defined(LINEARSPECULARREFLECTION)
float reflectionLOD=getLinearLodFromRoughness(vReflectionMicrosurfaceInfos.x,roughness);
#else
float reflectionLOD=getLodFromAlphaG(vReflectionMicrosurfaceInfos.x,alphaG);
#endif
#ifdef LODBASEDMICROSFURACE

reflectionLOD=reflectionLOD*vReflectionMicrosurfaceInfos.y+vReflectionMicrosurfaceInfos.z;
#ifdef LODINREFLECTIONALPHA









float automaticReflectionLOD=UNPACK_LOD(sampleReflection(reflectionSampler,reflectionCoords).a);
float requestedReflectionLOD=max(automaticReflectionLOD,reflectionLOD);
#else
float requestedReflectionLOD=reflectionLOD;
#endif
#ifdef REALTIME_FILTERING
environmentRadiance=vec4(radiance(alphaG,reflectionSampler,reflectionCoords,vReflectionFilteringInfo),1.0);
#else
environmentRadiance=sampleReflectionLod(reflectionSampler,reflectionCoords,reflectionLOD);
#endif
#else
float lodReflectionNormalized=saturate(reflectionLOD/log2(vReflectionMicrosurfaceInfos.x));
float lodReflectionNormalizedDoubled=lodReflectionNormalized*2.0;
vec4 environmentMid=sampleReflection(reflectionSampler,reflectionCoords);
if (lodReflectionNormalizedDoubled<1.0){
environmentRadiance=mix(
sampleReflection(reflectionSamplerHigh,reflectionCoords),
environmentMid,
lodReflectionNormalizedDoubled
);
} else {
environmentRadiance=mix(
environmentMid,
sampleReflection(reflectionSamplerLow,reflectionCoords),
lodReflectionNormalizedDoubled-1.0
);
}
#endif
#ifdef RGBDREFLECTION
environmentRadiance.rgb=fromRGBD(environmentRadiance);
#endif
#ifdef GAMMAREFLECTION
environmentRadiance.rgb=toLinearSpace(environmentRadiance.rgb);
#endif

environmentRadiance.rgb*=vReflectionInfos.x;
environmentRadiance.rgb*=vReflectionColor.rgb;
}
#define pbr_inline
#define inline
void reflectionBlock(
const in vec3 vPositionW,
const in vec3 normalW,
const in float alphaG,
const in vec3 vReflectionMicrosurfaceInfos,
const in vec2 vReflectionInfos,
const in vec3 vReflectionColor,
#ifdef ANISOTROPIC
const in anisotropicOutParams anisotropicOut,
#endif
#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)
const in float NdotVUnclamped,
#endif
#ifdef LINEARSPECULARREFLECTION
const in float roughness,
#endif
#ifdef REFLECTIONMAP_3D
const in samplerCube reflectionSampler,
#else
const in sampler2D reflectionSampler,
#endif
#if defined(NORMAL) && defined(USESPHERICALINVERTEX)
const in vec3 vEnvironmentIrradiance,
#endif
#ifdef USESPHERICALFROMREFLECTIONMAP
#if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)
const in mat4 reflectionMatrix,
#endif
#endif
#ifdef USEIRRADIANCEMAP
#ifdef REFLECTIONMAP_3D
const in samplerCube irradianceSampler,
#else
const in sampler2D irradianceSampler,
#endif
#endif
#ifndef LODBASEDMICROSFURACE
#ifdef REFLECTIONMAP_3D
const in samplerCube reflectionSamplerLow,
const in samplerCube reflectionSamplerHigh,
#else
const in sampler2D reflectionSamplerLow,
const in sampler2D reflectionSamplerHigh,
#endif
#endif
#ifdef REALTIME_FILTERING
const in vec2 vReflectionFilteringInfo,
#endif
out reflectionOutParams outParams
)
{

vec4 environmentRadiance=vec4(0.,0.,0.,0.);
#ifdef REFLECTIONMAP_3D
vec3 reflectionCoords=vec3(0.);
#else
vec2 reflectionCoords=vec2(0.);
#endif
createReflectionCoords(
vPositionW,
normalW,
#ifdef ANISOTROPIC
anisotropicOut,
#endif
reflectionCoords
);
sampleReflectionTexture(
alphaG,
vReflectionMicrosurfaceInfos,
vReflectionInfos,
vReflectionColor,
#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)
NdotVUnclamped,
#endif
#ifdef LINEARSPECULARREFLECTION
roughness,
#endif
#ifdef REFLECTIONMAP_3D
reflectionSampler,
reflectionCoords,
#else
reflectionSampler,
reflectionCoords,
#endif
#ifndef LODBASEDMICROSFURACE
reflectionSamplerLow,
reflectionSamplerHigh,
#endif
#ifdef REALTIME_FILTERING
vReflectionFilteringInfo,
#endif
environmentRadiance
);

vec3 environmentIrradiance=vec3(0.,0.,0.);
#ifdef USESPHERICALFROMREFLECTIONMAP
#if defined(NORMAL) && defined(USESPHERICALINVERTEX)
environmentIrradiance=vEnvironmentIrradiance;
#else
#ifdef ANISOTROPIC
vec3 irradianceVector=vec3(reflectionMatrix*vec4(anisotropicOut.anisotropicNormal,0)).xyz;
#else
vec3 irradianceVector=vec3(reflectionMatrix*vec4(normalW,0)).xyz;
#endif
#ifdef REFLECTIONMAP_OPPOSITEZ
irradianceVector.z*=-1.0;
#endif
#ifdef INVERTCUBICMAP
irradianceVector.y*=-1.0;
#endif
#if defined(REALTIME_FILTERING)
environmentIrradiance=irradiance(reflectionSampler,irradianceVector,vReflectionFilteringInfo);
#else
environmentIrradiance=computeEnvironmentIrradiance(irradianceVector);
#endif
#ifdef SS_TRANSLUCENCY
outParams.irradianceVector=irradianceVector;
#endif
#endif
#elif defined(USEIRRADIANCEMAP)
vec4 environmentIrradiance4=sampleReflection(irradianceSampler,reflectionCoords);
environmentIrradiance=environmentIrradiance4.rgb;
#ifdef RGBDREFLECTION
environmentIrradiance.rgb=fromRGBD(environmentIrradiance4);
#endif
#ifdef GAMMAREFLECTION
environmentIrradiance.rgb=toLinearSpace(environmentIrradiance.rgb);
#endif
#endif
environmentIrradiance*=vReflectionColor.rgb;
outParams.environmentRadiance=environmentRadiance;
outParams.environmentIrradiance=environmentIrradiance;
outParams.reflectionCoords=reflectionCoords;
}
#endif
`;Ye.a.IncludesShadersStore.pbrBlockReflection=gD;var vD=`#ifdef SHEEN
struct sheenOutParams
{
float sheenIntensity;
vec3 sheenColor;
float sheenRoughness;
#ifdef SHEEN_LINKWITHALBEDO
vec3 surfaceAlbedo;
#endif
#if defined(ENVIRONMENTBRDF) && defined(SHEEN_ALBEDOSCALING)
float sheenAlbedoScaling;
#endif
#if defined(REFLECTION) && defined(ENVIRONMENTBRDF)
vec3 finalSheenRadianceScaled;
#endif
#if DEBUGMODE>0
vec4 sheenMapData;
vec3 sheenEnvironmentReflectance;
#endif
};
#define pbr_inline
#define inline
void sheenBlock(
const in vec4 vSheenColor,
#ifdef SHEEN_ROUGHNESS
const in float vSheenRoughness,
#if defined(SHEEN_TEXTURE_ROUGHNESS) && !defined(SHEEN_TEXTURE_ROUGHNESS_IDENTICAL) && !defined(SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE)
const in vec4 sheenMapRoughnessData,
#endif
#endif
const in float roughness,
#ifdef SHEEN_TEXTURE
const in vec4 sheenMapData,
#endif
const in float reflectance,
#ifdef SHEEN_LINKWITHALBEDO
const in vec3 baseColor,
const in vec3 surfaceAlbedo,
#endif
#ifdef ENVIRONMENTBRDF
const in float NdotV,
const in vec3 environmentBrdf,
#endif
#if defined(REFLECTION) && defined(ENVIRONMENTBRDF)
const in vec2 AARoughnessFactors,
const in vec3 vReflectionMicrosurfaceInfos,
const in vec2 vReflectionInfos,
const in vec3 vReflectionColor,
const in vec4 vLightingIntensity,
#ifdef REFLECTIONMAP_3D
const in samplerCube reflectionSampler,
const in vec3 reflectionCoords,
#else
const in sampler2D reflectionSampler,
const in vec2 reflectionCoords,
#endif
const in float NdotVUnclamped,
#ifndef LODBASEDMICROSFURACE
#ifdef REFLECTIONMAP_3D
const in samplerCube reflectionSamplerLow,
const in samplerCube reflectionSamplerHigh,
#else
const in sampler2D reflectionSamplerLow,
const in sampler2D reflectionSamplerHigh,
#endif
#endif
#ifdef REALTIME_FILTERING
const in vec2 vReflectionFilteringInfo,
#endif
#if !defined(REFLECTIONMAP_SKYBOX) && defined(RADIANCEOCCLUSION)
const in float seo,
#endif
#if !defined(REFLECTIONMAP_SKYBOX) && defined(HORIZONOCCLUSION) && defined(BUMP) && defined(REFLECTIONMAP_3D)
const in float eho,
#endif
#endif
out sheenOutParams outParams
)
{
float sheenIntensity=vSheenColor.a;
#ifdef SHEEN_TEXTURE
#if DEBUGMODE>0
outParams.sheenMapData=sheenMapData;
#endif
#endif
#ifdef SHEEN_LINKWITHALBEDO
float sheenFactor=pow5(1.0-sheenIntensity);
vec3 sheenColor=baseColor.rgb*(1.0-sheenFactor);
float sheenRoughness=sheenIntensity;
outParams.surfaceAlbedo=surfaceAlbedo*sheenFactor;
#ifdef SHEEN_TEXTURE
sheenIntensity*=sheenMapData.a;
#endif
#else
vec3 sheenColor=vSheenColor.rgb;
#ifdef SHEEN_TEXTURE
sheenColor.rgb*=sheenMapData.rgb;
#endif
#ifdef SHEEN_ROUGHNESS
float sheenRoughness=vSheenRoughness;
#ifdef SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE
#if defined(SHEEN_TEXTURE)
sheenRoughness*=sheenMapData.a;
#endif
#elif defined(SHEEN_TEXTURE_ROUGHNESS)
#ifdef SHEEN_TEXTURE_ROUGHNESS_IDENTICAL
sheenRoughness*=sheenMapData.a;
#else
sheenRoughness*=sheenMapRoughnessData.a;
#endif
#endif
#else
float sheenRoughness=roughness;
#ifdef SHEEN_TEXTURE
sheenIntensity*=sheenMapData.a;
#endif
#endif

#if !defined(SHEEN_ALBEDOSCALING)
sheenIntensity*=(1.-reflectance);
#endif

sheenColor*=sheenIntensity;
#endif

#ifdef ENVIRONMENTBRDF

#ifdef SHEEN_ROUGHNESS
vec3 environmentSheenBrdf=getBRDFLookup(NdotV,sheenRoughness);
#else
vec3 environmentSheenBrdf=environmentBrdf;
#endif

#endif
#if defined(REFLECTION) && defined(ENVIRONMENTBRDF)
float sheenAlphaG=convertRoughnessToAverageSlope(sheenRoughness);
#ifdef SPECULARAA

sheenAlphaG+=AARoughnessFactors.y;
#endif
vec4 environmentSheenRadiance=vec4(0.,0.,0.,0.);
sampleReflectionTexture(
sheenAlphaG,
vReflectionMicrosurfaceInfos,
vReflectionInfos,
vReflectionColor,
#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)
NdotVUnclamped,
#endif
#ifdef LINEARSPECULARREFLECTION
sheenRoughness,
#endif
reflectionSampler,
reflectionCoords,
#ifndef LODBASEDMICROSFURACE
reflectionSamplerLow,
reflectionSamplerHigh,
#endif
#ifdef REALTIME_FILTERING
vReflectionFilteringInfo,
#endif
environmentSheenRadiance
);
vec3 sheenEnvironmentReflectance=getSheenReflectanceFromBRDFLookup(sheenColor,environmentSheenBrdf);
#if !defined(REFLECTIONMAP_SKYBOX) && defined(RADIANCEOCCLUSION)
sheenEnvironmentReflectance*=seo;
#endif
#if !defined(REFLECTIONMAP_SKYBOX) && defined(HORIZONOCCLUSION) && defined(BUMP) && defined(REFLECTIONMAP_3D)
sheenEnvironmentReflectance*=eho;
#endif
#if DEBUGMODE>0
outParams.sheenEnvironmentReflectance=sheenEnvironmentReflectance;
#endif
outParams.finalSheenRadianceScaled=
environmentSheenRadiance.rgb *
sheenEnvironmentReflectance *
vLightingIntensity.z;





#endif
#if defined(ENVIRONMENTBRDF) && defined(SHEEN_ALBEDOSCALING)



outParams.sheenAlbedoScaling=1.0-sheenIntensity*max(max(sheenColor.r,sheenColor.g),sheenColor.b)*environmentSheenBrdf.b;
#endif

outParams.sheenIntensity=sheenIntensity;
outParams.sheenColor=sheenColor;
outParams.sheenRoughness=sheenRoughness;
}
#endif
`;Ye.a.IncludesShadersStore.pbrBlockSheen=vD;var bD=`struct clearcoatOutParams
{
vec3 specularEnvironmentR0;
float conservationFactor;
vec3 clearCoatNormalW;
vec2 clearCoatAARoughnessFactors;
float clearCoatIntensity;
float clearCoatRoughness;
#ifdef REFLECTION
vec3 finalClearCoatRadianceScaled;
#endif
#ifdef CLEARCOAT_TINT
vec3 absorption;
float clearCoatNdotVRefract;
vec3 clearCoatColor;
float clearCoatThickness;
#endif
#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)
vec3 energyConservationFactorClearCoat;
#endif
#if DEBUGMODE>0
mat3 TBNClearCoat;
vec2 clearCoatMapData;
vec4 clearCoatTintMapData;
vec4 environmentClearCoatRadiance;
float clearCoatNdotV;
vec3 clearCoatEnvironmentReflectance;
#endif
};
#ifdef CLEARCOAT
#define pbr_inline
#define inline
void clearcoatBlock(
const in vec3 vPositionW,
const in vec3 geometricNormalW,
const in vec3 viewDirectionW,
const in vec2 vClearCoatParams,
#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && !defined(CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL) && !defined(CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE)
const in vec4 clearCoatMapRoughnessData,
#endif
const in vec3 specularEnvironmentR0,
#ifdef CLEARCOAT_TEXTURE
const in vec2 clearCoatMapData,
#endif
#ifdef CLEARCOAT_TINT
const in vec4 vClearCoatTintParams,
const in float clearCoatColorAtDistance,
const in vec4 vClearCoatRefractionParams,
#ifdef CLEARCOAT_TINT_TEXTURE
const in vec4 clearCoatTintMapData,
#endif
#endif
#ifdef CLEARCOAT_BUMP
const in vec2 vClearCoatBumpInfos,
const in vec4 clearCoatBumpMapData,
const in vec2 vClearCoatBumpUV,
#if defined(TANGENT) && defined(NORMAL)
const in mat3 vTBN,
#else
const in vec2 vClearCoatTangentSpaceParams,
#endif
#ifdef OBJECTSPACE_NORMALMAP
const in mat4 normalMatrix,
#endif
#endif
#if defined(FORCENORMALFORWARD) && defined(NORMAL)
const in vec3 faceNormal,
#endif
#ifdef REFLECTION
const in vec3 vReflectionMicrosurfaceInfos,
const in vec2 vReflectionInfos,
const in vec3 vReflectionColor,
const in vec4 vLightingIntensity,
#ifdef REFLECTIONMAP_3D
const in samplerCube reflectionSampler,
#else
const in sampler2D reflectionSampler,
#endif
#ifndef LODBASEDMICROSFURACE
#ifdef REFLECTIONMAP_3D
const in samplerCube reflectionSamplerLow,
const in samplerCube reflectionSamplerHigh,
#else
const in sampler2D reflectionSamplerLow,
const in sampler2D reflectionSamplerHigh,
#endif
#endif
#ifdef REALTIME_FILTERING
const in vec2 vReflectionFilteringInfo,
#endif
#endif
#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)
#ifdef RADIANCEOCCLUSION
const in float ambientMonochrome,
#endif
#endif
out clearcoatOutParams outParams
)
{

float clearCoatIntensity=vClearCoatParams.x;
float clearCoatRoughness=vClearCoatParams.y;
#ifdef CLEARCOAT_TEXTURE
clearCoatIntensity*=clearCoatMapData.x;
#ifdef CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE
clearCoatRoughness*=clearCoatMapData.y;
#endif
#if DEBUGMODE>0
outParams.clearCoatMapData=clearCoatMapData;
#endif
#endif
#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && !defined(CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE)
#ifdef CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL
clearCoatRoughness*=clearCoatMapData.y;
#else
clearCoatRoughness*=clearCoatMapRoughnessData.y;
#endif
#endif
outParams.clearCoatIntensity=clearCoatIntensity;
outParams.clearCoatRoughness=clearCoatRoughness;
#ifdef CLEARCOAT_TINT
vec3 clearCoatColor=vClearCoatTintParams.rgb;
float clearCoatThickness=vClearCoatTintParams.a;
#ifdef CLEARCOAT_TINT_TEXTURE
clearCoatColor*=clearCoatTintMapData.rgb;
clearCoatThickness*=clearCoatTintMapData.a;
#if DEBUGMODE>0
outParams.clearCoatTintMapData=clearCoatTintMapData;
#endif
#endif
outParams.clearCoatColor=computeColorAtDistanceInMedia(clearCoatColor,clearCoatColorAtDistance);
outParams.clearCoatThickness=clearCoatThickness;
#endif




#ifdef CLEARCOAT_REMAP_F0
vec3 specularEnvironmentR0Updated=getR0RemappedForClearCoat(specularEnvironmentR0);
#else
vec3 specularEnvironmentR0Updated=specularEnvironmentR0;
#endif
outParams.specularEnvironmentR0=mix(specularEnvironmentR0,specularEnvironmentR0Updated,clearCoatIntensity);

vec3 clearCoatNormalW=geometricNormalW;
#ifdef CLEARCOAT_BUMP
#ifdef NORMALXYSCALE
float clearCoatNormalScale=1.0;
#else
float clearCoatNormalScale=vClearCoatBumpInfos.y;
#endif
#if defined(TANGENT) && defined(NORMAL)
mat3 TBNClearCoat=vTBN;
#else
mat3 TBNClearCoat=cotangent_frame(clearCoatNormalW*clearCoatNormalScale,vPositionW,vClearCoatBumpUV,vClearCoatTangentSpaceParams);
#endif
#if DEBUGMODE>0
outParams.TBNClearCoat=TBNClearCoat;
#endif
#ifdef OBJECTSPACE_NORMALMAP
clearCoatNormalW=normalize(clearCoatBumpMapData.xyz*2.0-1.0);
clearCoatNormalW=normalize(mat3(normalMatrix)*clearCoatNormalW);
#else
clearCoatNormalW=perturbNormal(TBNClearCoat,clearCoatBumpMapData.xyz,vClearCoatBumpInfos.y);
#endif
#endif
#if defined(FORCENORMALFORWARD) && defined(NORMAL)
clearCoatNormalW*=sign(dot(clearCoatNormalW,faceNormal));
#endif
#if defined(TWOSIDEDLIGHTING) && defined(NORMAL)
clearCoatNormalW=gl_FrontFacing ? clearCoatNormalW : -clearCoatNormalW;
#endif
outParams.clearCoatNormalW=clearCoatNormalW;

outParams.clearCoatAARoughnessFactors=getAARoughnessFactors(clearCoatNormalW.xyz);

float clearCoatNdotVUnclamped=dot(clearCoatNormalW,viewDirectionW);

float clearCoatNdotV=absEps(clearCoatNdotVUnclamped);
#if DEBUGMODE>0
outParams.clearCoatNdotV=clearCoatNdotV;
#endif
#ifdef CLEARCOAT_TINT

vec3 clearCoatVRefract=-refract(vPositionW,clearCoatNormalW,vClearCoatRefractionParams.y);

outParams.clearCoatNdotVRefract=absEps(dot(clearCoatNormalW,clearCoatVRefract));
#endif
#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)

vec3 environmentClearCoatBrdf=getBRDFLookup(clearCoatNdotV,clearCoatRoughness);
#endif

#if defined(REFLECTION)
float clearCoatAlphaG=convertRoughnessToAverageSlope(clearCoatRoughness);
#ifdef SPECULARAA

clearCoatAlphaG+=outParams.clearCoatAARoughnessFactors.y;
#endif
vec4 environmentClearCoatRadiance=vec4(0.,0.,0.,0.);
vec3 clearCoatReflectionVector=computeReflectionCoords(vec4(vPositionW,1.0),clearCoatNormalW);
#ifdef REFLECTIONMAP_OPPOSITEZ
clearCoatReflectionVector.z*=-1.0;
#endif

#ifdef REFLECTIONMAP_3D
vec3 clearCoatReflectionCoords=clearCoatReflectionVector;
#else
vec2 clearCoatReflectionCoords=clearCoatReflectionVector.xy;
#ifdef REFLECTIONMAP_PROJECTION
clearCoatReflectionCoords/=clearCoatReflectionVector.z;
#endif
clearCoatReflectionCoords.y=1.0-clearCoatReflectionCoords.y;
#endif
sampleReflectionTexture(
clearCoatAlphaG,
vReflectionMicrosurfaceInfos,
vReflectionInfos,
vReflectionColor,
#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)
clearCoatNdotVUnclamped,
#endif
#ifdef LINEARSPECULARREFLECTION
clearCoatRoughness,
#endif
reflectionSampler,
clearCoatReflectionCoords,
#ifndef LODBASEDMICROSFURACE
reflectionSamplerLow,
reflectionSamplerHigh,
#endif
#ifdef REALTIME_FILTERING
vReflectionFilteringInfo,
#endif
environmentClearCoatRadiance
);
#if DEBUGMODE>0
outParams.environmentClearCoatRadiance=environmentClearCoatRadiance;
#endif

#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)
vec3 clearCoatEnvironmentReflectance=getReflectanceFromBRDFLookup(vec3(vClearCoatRefractionParams.x),environmentClearCoatBrdf);
#ifdef RADIANCEOCCLUSION
float clearCoatSeo=environmentRadianceOcclusion(ambientMonochrome,clearCoatNdotVUnclamped);
clearCoatEnvironmentReflectance*=clearCoatSeo;
#endif
#ifdef HORIZONOCCLUSION
#ifdef BUMP
#ifdef REFLECTIONMAP_3D
float clearCoatEho=environmentHorizonOcclusion(-viewDirectionW,clearCoatNormalW,geometricNormalW);
clearCoatEnvironmentReflectance*=clearCoatEho;
#endif
#endif
#endif
#else

vec3 clearCoatEnvironmentReflectance=getReflectanceFromAnalyticalBRDFLookup_Jones(clearCoatNdotV,vec3(1.),vec3(1.),sqrt(1.-clearCoatRoughness));
#endif
clearCoatEnvironmentReflectance*=clearCoatIntensity;
#if DEBUGMODE>0
outParams.clearCoatEnvironmentReflectance=clearCoatEnvironmentReflectance;
#endif
outParams.finalClearCoatRadianceScaled=
environmentClearCoatRadiance.rgb *
clearCoatEnvironmentReflectance *
vLightingIntensity.z;
#endif
#if defined(CLEARCOAT_TINT)

outParams.absorption=computeClearCoatAbsorption(outParams.clearCoatNdotVRefract,outParams.clearCoatNdotVRefract,outParams.clearCoatColor,clearCoatThickness,clearCoatIntensity);
#endif

float fresnelIBLClearCoat=fresnelSchlickGGX(clearCoatNdotV,vClearCoatRefractionParams.x,CLEARCOATREFLECTANCE90);
fresnelIBLClearCoat*=clearCoatIntensity;
outParams.conservationFactor=(1.-fresnelIBLClearCoat);
#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)
outParams.energyConservationFactorClearCoat=getEnergyConservationFactor(outParams.specularEnvironmentR0,environmentClearCoatBrdf);
#endif
}
#endif
`;Ye.a.IncludesShadersStore.pbrBlockClearcoat=bD;var yD=`struct subSurfaceOutParams
{
vec3 specularEnvironmentReflectance;
#ifdef SS_REFRACTION
vec3 finalRefraction;
vec3 surfaceAlbedo;
#ifdef SS_LINKREFRACTIONTOTRANSPARENCY
float alpha;
#endif
#ifdef REFLECTION
float refractionFactorForIrradiance;
#endif
#endif
#ifdef SS_TRANSLUCENCY
vec3 transmittance;
float translucencyIntensity;
#ifdef REFLECTION
vec3 refractionIrradiance;
#endif
#endif
#if DEBUGMODE>0
vec4 thicknessMap;
vec4 environmentRefraction;
vec3 refractionTransmittance;
#endif
};
#ifdef SUBSURFACE
#define pbr_inline
#define inline
void subSurfaceBlock(
const in vec3 vSubSurfaceIntensity,
const in vec2 vThicknessParam,
const in vec4 vTintColor,
const in vec3 normalW,
const in vec3 specularEnvironmentReflectance,
#ifdef SS_THICKNESSANDMASK_TEXTURE
const in vec4 thicknessMap,
#endif
#ifdef REFLECTION
#ifdef SS_TRANSLUCENCY
const in mat4 reflectionMatrix,
#ifdef USESPHERICALFROMREFLECTIONMAP
#if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)
const in vec3 irradianceVector_,
#endif
#if defined(REALTIME_FILTERING)
const in samplerCube reflectionSampler,
const in vec2 vReflectionFilteringInfo,
#endif
#endif
#ifdef USEIRRADIANCEMAP
#ifdef REFLECTIONMAP_3D
const in samplerCube irradianceSampler,
#else
const in sampler2D irradianceSampler,
#endif
#endif
#endif
#endif
#ifdef SS_REFRACTION
const in vec3 vPositionW,
const in vec3 viewDirectionW,
const in mat4 view,
const in vec3 surfaceAlbedo,
const in vec4 vRefractionInfos,
const in mat4 refractionMatrix,
const in vec3 vRefractionMicrosurfaceInfos,
const in vec4 vLightingIntensity,
#ifdef SS_LINKREFRACTIONTOTRANSPARENCY
const in float alpha,
#endif
#ifdef SS_LODINREFRACTIONALPHA
const in float NdotVUnclamped,
#endif
#ifdef SS_LINEARSPECULARREFRACTION
const in float roughness,
#else
const in float alphaG,
#endif
#ifdef SS_REFRACTIONMAP_3D
const in samplerCube refractionSampler,
#ifndef LODBASEDMICROSFURACE
const in samplerCube refractionSamplerLow,
const in samplerCube refractionSamplerHigh,
#endif
#else
const in sampler2D refractionSampler,
#ifndef LODBASEDMICROSFURACE
const in sampler2D refractionSamplerLow,
const in sampler2D refractionSamplerHigh,
#endif
#endif
#ifdef ANISOTROPIC
const in anisotropicOutParams anisotropicOut,
#endif
#ifdef REALTIME_FILTERING
const in vec2 vRefractionFilteringInfo,
#endif
#endif
#ifdef SS_TRANSLUCENCY
const in vec3 vDiffusionDistance,
#endif
out subSurfaceOutParams outParams
)
{
outParams.specularEnvironmentReflectance=specularEnvironmentReflectance;



#ifdef SS_REFRACTION
float refractionIntensity=vSubSurfaceIntensity.x;
#ifdef SS_LINKREFRACTIONTOTRANSPARENCY
refractionIntensity*=(1.0-alpha);

outParams.alpha=1.0;
#endif
#endif
#ifdef SS_TRANSLUCENCY
float translucencyIntensity=vSubSurfaceIntensity.y;
#endif
#ifdef SS_THICKNESSANDMASK_TEXTURE
float thickness=thicknessMap.r*vThicknessParam.y+vThicknessParam.x;
#if DEBUGMODE>0
outParams.thicknessMap=thicknessMap;
#endif
#ifdef SS_MASK_FROM_THICKNESS_TEXTURE
#ifdef SS_REFRACTION
refractionIntensity*=thicknessMap.g;
#endif
#ifdef SS_TRANSLUCENCY
translucencyIntensity*=thicknessMap.b;
#endif
#elif defined(SS_MASK_FROM_THICKNESS_TEXTURE_GLTF)
#ifdef SS_REFRACTION
refractionIntensity*=thicknessMap.r;
#elif defined(SS_TRANSLUCENCY)
translucencyIntensity*=thicknessMap.r;
#endif
thickness=thicknessMap.g*vThicknessParam.y+vThicknessParam.x;
#endif
#else
float thickness=vThicknessParam.y;
#endif



#ifdef SS_TRANSLUCENCY
thickness=maxEps(thickness);
vec3 transmittance=transmittanceBRDF_Burley(vTintColor.rgb,vDiffusionDistance,thickness);
transmittance*=translucencyIntensity;
outParams.transmittance=transmittance;
outParams.translucencyIntensity=translucencyIntensity;
#endif



#ifdef SS_REFRACTION
vec4 environmentRefraction=vec4(0.,0.,0.,0.);
#ifdef ANISOTROPIC
vec3 refractionVector=refract(-viewDirectionW,anisotropicOut.anisotropicNormal,vRefractionInfos.y);
#else
vec3 refractionVector=refract(-viewDirectionW,normalW,vRefractionInfos.y);
#endif
#ifdef SS_REFRACTIONMAP_OPPOSITEZ
refractionVector.z*=-1.0;
#endif

#ifdef SS_REFRACTIONMAP_3D
refractionVector.y=refractionVector.y*vRefractionInfos.w;
vec3 refractionCoords=refractionVector;
refractionCoords=vec3(refractionMatrix*vec4(refractionCoords,0));
#else
vec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*vRefractionInfos.z,1.0)));
vec2 refractionCoords=vRefractionUVW.xy/vRefractionUVW.z;
refractionCoords.y=1.0-refractionCoords.y;
#endif
#ifdef SS_LODINREFRACTIONALPHA
float refractionLOD=getLodFromAlphaG(vRefractionMicrosurfaceInfos.x,alphaG,NdotVUnclamped);
#elif defined(SS_LINEARSPECULARREFRACTION)
float refractionLOD=getLinearLodFromRoughness(vRefractionMicrosurfaceInfos.x,roughness);
#else
float refractionLOD=getLodFromAlphaG(vRefractionMicrosurfaceInfos.x,alphaG);
#endif
#ifdef LODBASEDMICROSFURACE

refractionLOD=refractionLOD*vRefractionMicrosurfaceInfos.y+vRefractionMicrosurfaceInfos.z;
#ifdef SS_LODINREFRACTIONALPHA









float automaticRefractionLOD=UNPACK_LOD(sampleRefraction(refractionSampler,refractionCoords).a);
float requestedRefractionLOD=max(automaticRefractionLOD,refractionLOD);
#else
float requestedRefractionLOD=refractionLOD;
#endif
#ifdef REALTIME_FILTERING
environmentRefraction=vec4(radiance(alphaG,refractionSampler,refractionCoords,vRefractionFilteringInfo),1.0);
#else
environmentRefraction=sampleRefractionLod(refractionSampler,refractionCoords,requestedRefractionLOD);
#endif
#else
float lodRefractionNormalized=saturate(refractionLOD/log2(vRefractionMicrosurfaceInfos.x));
float lodRefractionNormalizedDoubled=lodRefractionNormalized*2.0;
vec4 environmentRefractionMid=sampleRefraction(refractionSampler,refractionCoords);
if (lodRefractionNormalizedDoubled<1.0){
environmentRefraction=mix(
sampleRefraction(refractionSamplerHigh,refractionCoords),
environmentRefractionMid,
lodRefractionNormalizedDoubled
);
} else {
environmentRefraction=mix(
environmentRefractionMid,
sampleRefraction(refractionSamplerLow,refractionCoords),
lodRefractionNormalizedDoubled-1.0
);
}
#endif
#ifdef SS_RGBDREFRACTION
environmentRefraction.rgb=fromRGBD(environmentRefraction);
#endif
#ifdef SS_GAMMAREFRACTION
environmentRefraction.rgb=toLinearSpace(environmentRefraction.rgb);
#endif

environmentRefraction.rgb*=vRefractionInfos.x;
#endif



#ifdef SS_REFRACTION
vec3 refractionTransmittance=vec3(refractionIntensity);
#ifdef SS_THICKNESSANDMASK_TEXTURE
vec3 volumeAlbedo=computeColorAtDistanceInMedia(vTintColor.rgb,vTintColor.w);





refractionTransmittance*=cocaLambert(volumeAlbedo,thickness);
#elif defined(SS_LINKREFRACTIONTOTRANSPARENCY)

float maxChannel=max(max(surfaceAlbedo.r,surfaceAlbedo.g),surfaceAlbedo.b);
vec3 volumeAlbedo=saturate(maxChannel*surfaceAlbedo);

environmentRefraction.rgb*=volumeAlbedo;
#else

vec3 volumeAlbedo=computeColorAtDistanceInMedia(vTintColor.rgb,vTintColor.w);
refractionTransmittance*=cocaLambert(volumeAlbedo,vThicknessParam.y);
#endif
#ifdef SS_ALBEDOFORREFRACTIONTINT

environmentRefraction.rgb*=surfaceAlbedo.rgb;
#endif

outParams.surfaceAlbedo=surfaceAlbedo*(1.-refractionIntensity);
#ifdef REFLECTION

outParams.refractionFactorForIrradiance=(1.-refractionIntensity);

#endif

vec3 bounceSpecularEnvironmentReflectance=(2.0*specularEnvironmentReflectance)/(1.0+specularEnvironmentReflectance);
outParams.specularEnvironmentReflectance=mix(bounceSpecularEnvironmentReflectance,specularEnvironmentReflectance,refractionIntensity);

refractionTransmittance*=1.0-outParams.specularEnvironmentReflectance;
#if DEBUGMODE>0
outParams.refractionTransmittance=refractionTransmittance;
#endif
outParams.finalRefraction=environmentRefraction.rgb*refractionTransmittance*vLightingIntensity.z;
#if DEBUGMODE>0
outParams.environmentRefraction=environmentRefraction;
#endif
#endif



#if defined(REFLECTION) && defined(SS_TRANSLUCENCY)
#if defined(NORMAL) && defined(USESPHERICALINVERTEX) || !defined(USESPHERICALFROMREFLECTIONMAP)
vec3 irradianceVector=vec3(reflectionMatrix*vec4(normalW,0)).xyz;
#ifdef REFLECTIONMAP_OPPOSITEZ
irradianceVector.z*=-1.0;
#endif
#ifdef INVERTCUBICMAP
irradianceVector.y*=-1.0;
#endif
#else
vec3 irradianceVector=irradianceVector_;
#endif
#if defined(USESPHERICALFROMREFLECTIONMAP)
#if defined(REALTIME_FILTERING)
vec3 refractionIrradiance=irradiance(reflectionSampler,-irradianceVector,vReflectionFilteringInfo);
#else
vec3 refractionIrradiance=computeEnvironmentIrradiance(-irradianceVector);
#endif
#elif defined(USEIRRADIANCEMAP)
#ifdef REFLECTIONMAP_3D
vec3 irradianceCoords=irradianceVector;
#else
vec2 irradianceCoords=irradianceVector.xy;
#ifdef REFLECTIONMAP_PROJECTION
irradianceCoords/=irradianceVector.z;
#endif
irradianceCoords.y=1.0-irradianceCoords.y;
#endif
vec4 refractionIrradiance=sampleReflection(irradianceSampler,-irradianceCoords);
#ifdef RGBDREFLECTION
refractionIrradiance.rgb=fromRGBD(refractionIrradiance);
#endif
#ifdef GAMMAREFLECTION
refractionIrradiance.rgb=toLinearSpace(refractionIrradiance.rgb);
#endif
#else
vec4 refractionIrradiance=vec4(0.);
#endif
refractionIrradiance.rgb*=transmittance;
outParams.refractionIrradiance=refractionIrradiance.rgb;
#endif
}
#endif
`;Ye.a.IncludesShadersStore.pbrBlockSubSurface=yD;var TD=`vec3 viewDirectionW=normalize(vEyePosition.xyz-vPositionW);
#ifdef NORMAL
vec3 normalW=normalize(vNormalW);
#else
vec3 normalW=normalize(cross(dFdx(vPositionW),dFdy(vPositionW)))*vEyePosition.w;
#endif
vec3 geometricNormalW=normalW;
#if defined(TWOSIDEDLIGHTING) && defined(NORMAL)
geometricNormalW=gl_FrontFacing ? geometricNormalW : -geometricNormalW;
#endif
`;Ye.a.IncludesShadersStore.pbrBlockNormalGeometric=TD,c(134);var ED=`#if defined(FORCENORMALFORWARD) && defined(NORMAL)
vec3 faceNormal=normalize(cross(dFdx(vPositionW),dFdy(vPositionW)))*vEyePosition.w;
#if defined(TWOSIDEDLIGHTING)
faceNormal=gl_FrontFacing ? faceNormal : -faceNormal;
#endif
normalW*=sign(dot(normalW,faceNormal));
#endif
#if defined(TWOSIDEDLIGHTING) && defined(NORMAL)
normalW=gl_FrontFacing ? normalW : -normalW;
#endif
`;Ye.a.IncludesShadersStore.pbrBlockNormalFinal=ED,c(162);var SD=`#ifdef LIGHTMAP
vec4 lightmapColor=texture2D(lightmapSampler,vLightmapUV+uvOffset);
#ifdef RGBDLIGHTMAP
lightmapColor.rgb=fromRGBD(lightmapColor);
#endif
#ifdef GAMMALIGHTMAP
lightmapColor.rgb=toLinearSpace(lightmapColor.rgb);
#endif
lightmapColor.rgb*=vLightmapInfos.y;
#endif
`;Ye.a.IncludesShadersStore.pbrBlockLightmapInit=SD;var xD=`float NdotVUnclamped=dot(normalW,viewDirectionW);

float NdotV=absEps(NdotVUnclamped);
float alphaG=convertRoughnessToAverageSlope(roughness);
vec2 AARoughnessFactors=getAARoughnessFactors(normalW.xyz);
#ifdef SPECULARAA

alphaG+=AARoughnessFactors.y;
#endif
#if defined(ENVIRONMENTBRDF)

vec3 environmentBrdf=getBRDFLookup(NdotV,roughness);
#endif
#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)
#ifdef RADIANCEOCCLUSION
#ifdef AMBIENTINGRAYSCALE
float ambientMonochrome=aoOut.ambientOcclusionColor.r;
#else
float ambientMonochrome=getLuminance(aoOut.ambientOcclusionColor);
#endif
float seo=environmentRadianceOcclusion(ambientMonochrome,NdotVUnclamped);
#endif
#ifdef HORIZONOCCLUSION
#ifdef BUMP
#ifdef REFLECTIONMAP_3D
float eho=environmentHorizonOcclusion(-viewDirectionW,normalW,geometricNormalW);
#endif
#endif
#endif
#endif
`;Ye.a.IncludesShadersStore.pbrBlockGeometryInfo=xD;var AD=`float reflectance=max(max(reflectivityOut.surfaceReflectivityColor.r,reflectivityOut.surfaceReflectivityColor.g),reflectivityOut.surfaceReflectivityColor.b);
vec3 specularEnvironmentR0=reflectivityOut.surfaceReflectivityColor.rgb;
#ifdef METALLICWORKFLOW
vec3 specularEnvironmentR90=vec3(metallicReflectanceFactors.a);
#else
vec3 specularEnvironmentR90=vec3(1.0,1.0,1.0);
#endif

#ifdef ALPHAFRESNEL
float reflectance90=fresnelGrazingReflectance(reflectance);
specularEnvironmentR90=specularEnvironmentR90*reflectance90;
#endif
`;Ye.a.IncludesShadersStore.pbrBlockReflectance0=AD;var PD=`#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)
vec3 specularEnvironmentReflectance=getReflectanceFromBRDFLookup(clearcoatOut.specularEnvironmentR0,specularEnvironmentR90,environmentBrdf);
#ifdef RADIANCEOCCLUSION
specularEnvironmentReflectance*=seo;
#endif
#ifdef HORIZONOCCLUSION
#ifdef BUMP
#ifdef REFLECTIONMAP_3D
specularEnvironmentReflectance*=eho;
#endif
#endif
#endif
#else

vec3 specularEnvironmentReflectance=getReflectanceFromAnalyticalBRDFLookup_Jones(NdotV,clearcoatOut.specularEnvironmentR0,specularEnvironmentR90,sqrt(microSurface));
#endif
#ifdef CLEARCOAT
specularEnvironmentReflectance*=clearcoatOut.conservationFactor;
#if defined(CLEARCOAT_TINT)
specularEnvironmentReflectance*=clearcoatOut.absorption;
#endif
#endif
`;Ye.a.IncludesShadersStore.pbrBlockReflectance=PD;var CD=`vec3 diffuseBase=vec3(0.,0.,0.);
#ifdef SPECULARTERM
vec3 specularBase=vec3(0.,0.,0.);
#endif
#ifdef CLEARCOAT
vec3 clearCoatBase=vec3(0.,0.,0.);
#endif
#ifdef SHEEN
vec3 sheenBase=vec3(0.,0.,0.);
#endif

preLightingInfo preInfo;
lightingInfo info;
float shadow=1.;
#if defined(CLEARCOAT) && defined(CLEARCOAT_TINT)
vec3 absorption=vec3(0.);
#endif
`;Ye.a.IncludesShadersStore.pbrBlockDirectLighting=CD;var RD=`



#if defined(ENVIRONMENTBRDF)
#ifdef MS_BRDF_ENERGY_CONSERVATION
vec3 energyConservationFactor=getEnergyConservationFactor(clearcoatOut.specularEnvironmentR0,environmentBrdf);
#endif
#endif
#ifndef METALLICWORKFLOW
#ifdef SPECULAR_GLOSSINESS_ENERGY_CONSERVATION
surfaceAlbedo.rgb=(1.-reflectance)*surfaceAlbedo.rgb;
#endif
#endif
#if defined(SHEEN) && defined(SHEEN_ALBEDOSCALING) && defined(ENVIRONMENTBRDF)
surfaceAlbedo.rgb=sheenOut.sheenAlbedoScaling*surfaceAlbedo.rgb;
#endif

#ifdef REFLECTION
vec3 finalIrradiance=reflectionOut.environmentIrradiance;
#if defined(CLEARCOAT)
finalIrradiance*=clearcoatOut.conservationFactor;
#if defined(CLEARCOAT_TINT)
finalIrradiance*=clearcoatOut.absorption;
#endif
#endif
#if defined(SS_REFRACTION)
finalIrradiance*=subSurfaceOut.refractionFactorForIrradiance;
#endif
#if defined(SS_TRANSLUCENCY)
finalIrradiance*=(1.0-subSurfaceOut.translucencyIntensity);
finalIrradiance+=subSurfaceOut.refractionIrradiance;
#endif
finalIrradiance*=surfaceAlbedo.rgb;
finalIrradiance*=vLightingIntensity.z;
finalIrradiance*=aoOut.ambientOcclusionColor;
#endif

#ifdef SPECULARTERM
vec3 finalSpecular=specularBase;
finalSpecular=max(finalSpecular,0.0);
vec3 finalSpecularScaled=finalSpecular*vLightingIntensity.x*vLightingIntensity.w;
#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)
finalSpecularScaled*=energyConservationFactor;
#endif
#if defined(SHEEN) && defined(ENVIRONMENTBRDF) && defined(SHEEN_ALBEDOSCALING)
finalSpecularScaled*=sheenOut.sheenAlbedoScaling;
#endif
#endif

#ifdef REFLECTION
vec3 finalRadiance=reflectionOut.environmentRadiance.rgb;
finalRadiance*=subSurfaceOut.specularEnvironmentReflectance;
vec3 finalRadianceScaled=finalRadiance*vLightingIntensity.z;
#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)
finalRadianceScaled*=energyConservationFactor;
#endif
#if defined(SHEEN) && defined(ENVIRONMENTBRDF) && defined(SHEEN_ALBEDOSCALING)
finalRadianceScaled*=sheenOut.sheenAlbedoScaling;
#endif
#endif

#ifdef SHEEN
vec3 finalSheen=sheenBase*sheenOut.sheenColor;
finalSheen=max(finalSheen,0.0);
vec3 finalSheenScaled=finalSheen*vLightingIntensity.x*vLightingIntensity.w;
#if defined(CLEARCOAT) && defined(REFLECTION) && defined(ENVIRONMENTBRDF)
sheenOut.finalSheenRadianceScaled*=clearcoatOut.conservationFactor;
#if defined(CLEARCOAT_TINT)
sheenOut.finalSheenRadianceScaled*=clearcoatOut.absorption;
#endif
#endif
#endif

#ifdef CLEARCOAT
vec3 finalClearCoat=clearCoatBase;
finalClearCoat=max(finalClearCoat,0.0);
vec3 finalClearCoatScaled=finalClearCoat*vLightingIntensity.x*vLightingIntensity.w;
#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)
finalClearCoatScaled*=clearcoatOut.energyConservationFactorClearCoat;
#endif
#ifdef SS_REFRACTION
subSurfaceOut.finalRefraction*=clearcoatOut.conservationFactor;
#ifdef CLEARCOAT_TINT
subSurfaceOut.finalRefraction*=clearcoatOut.absorption;
#endif
#endif
#endif

#ifdef ALPHABLEND
float luminanceOverAlpha=0.0;
#if defined(REFLECTION) && defined(RADIANCEOVERALPHA)
luminanceOverAlpha+=getLuminance(finalRadianceScaled);
#if defined(CLEARCOAT)
luminanceOverAlpha+=getLuminance(clearcoatOut.finalClearCoatRadianceScaled);
#endif
#endif
#if defined(SPECULARTERM) && defined(SPECULAROVERALPHA)
luminanceOverAlpha+=getLuminance(finalSpecularScaled);
#endif
#if defined(CLEARCOAT) && defined(CLEARCOATOVERALPHA)
luminanceOverAlpha+=getLuminance(finalClearCoatScaled);
#endif
#if defined(RADIANCEOVERALPHA) || defined(SPECULAROVERALPHA) || defined(CLEARCOATOVERALPHA)
alpha=saturate(alpha+luminanceOverAlpha*luminanceOverAlpha);
#endif
#endif
`;Ye.a.IncludesShadersStore.pbrBlockFinalLitComponents=RD;var OD=`
vec3 finalDiffuse=diffuseBase;
finalDiffuse*=surfaceAlbedo.rgb;
finalDiffuse=max(finalDiffuse,0.0);
finalDiffuse*=vLightingIntensity.x;

vec3 finalAmbient=vAmbientColor;
finalAmbient*=surfaceAlbedo.rgb;

vec3 finalEmissive=vEmissiveColor;
#ifdef EMISSIVE
vec3 emissiveColorTex=texture2D(emissiveSampler,vEmissiveUV+uvOffset).rgb;
finalEmissive*=toLinearSpace(emissiveColorTex.rgb);
finalEmissive*=vEmissiveInfos.y;
#endif
finalEmissive*=vLightingIntensity.y;

#ifdef AMBIENT
vec3 ambientOcclusionForDirectDiffuse=mix(vec3(1.),aoOut.ambientOcclusionColor,vAmbientInfos.w);
#else
vec3 ambientOcclusionForDirectDiffuse=aoOut.ambientOcclusionColor;
#endif
finalAmbient*=aoOut.ambientOcclusionColor;
finalDiffuse*=ambientOcclusionForDirectDiffuse;
`;Ye.a.IncludesShadersStore.pbrBlockFinalUnlitComponents=OD;var MD=`vec4 finalColor=vec4(
finalAmbient +
finalDiffuse +
#ifndef UNLIT
#ifdef REFLECTION
finalIrradiance +
#endif
#ifdef SPECULARTERM
finalSpecularScaled +
#endif
#ifdef SHEEN
finalSheenScaled +
#endif
#ifdef CLEARCOAT
finalClearCoatScaled +
#endif
#ifdef REFLECTION
finalRadianceScaled +
#if defined(SHEEN) && defined(ENVIRONMENTBRDF)
sheenOut.finalSheenRadianceScaled +
#endif
#ifdef CLEARCOAT
clearcoatOut.finalClearCoatRadianceScaled +
#endif
#endif
#ifdef SS_REFRACTION
subSurfaceOut.finalRefraction +
#endif
#endif
finalEmissive,
alpha);

#ifdef LIGHTMAP
#ifndef LIGHTMAPEXCLUDED
#ifdef USELIGHTMAPASSHADOWMAP
finalColor.rgb*=lightmapColor.rgb;
#else
finalColor.rgb+=lightmapColor.rgb;
#endif
#endif
#endif
#define CUSTOM_FRAGMENT_BEFORE_FOG

finalColor=max(finalColor,0.0);
`;Ye.a.IncludesShadersStore.pbrBlockFinalColorComposition=MD,c(155);var ID=`#ifdef IMAGEPROCESSINGPOSTPROCESS


finalColor.rgb=clamp(finalColor.rgb,0.,30.0);
#else

finalColor=applyImageProcessing(finalColor);
#endif
finalColor.a*=visibility;
#ifdef PREMULTIPLYALPHA

finalColor.rgb*=finalColor.a;
#endif
`;Ye.a.IncludesShadersStore.pbrBlockImageProcessing=ID;var DD=`#if DEBUGMODE>0
if (vClipSpacePosition.x/vClipSpacePosition.w>=vDebugMode.x) {

#if DEBUGMODE == 1
gl_FragColor.rgb=vPositionW.rgb;
#define DEBUGMODE_NORMALIZE
#elif DEBUGMODE == 2 && defined(NORMAL)
gl_FragColor.rgb=vNormalW.rgb;
#define DEBUGMODE_NORMALIZE
#elif DEBUGMODE == 3 && defined(BUMP) || DEBUGMODE == 3 && defined(PARALLAX) || DEBUGMODE == 3 && defined(ANISOTROPIC)

gl_FragColor.rgb=TBN[0];
#define DEBUGMODE_NORMALIZE
#elif DEBUGMODE == 4 && defined(BUMP) || DEBUGMODE == 4 && defined(PARALLAX) || DEBUGMODE == 4 && defined(ANISOTROPIC)

gl_FragColor.rgb=TBN[1];
#define DEBUGMODE_NORMALIZE
#elif DEBUGMODE == 5

gl_FragColor.rgb=normalW;
#define DEBUGMODE_NORMALIZE
#elif DEBUGMODE == 6 && defined(MAINUV1)
gl_FragColor.rgb=vec3(vMainUV1,0.0);
#elif DEBUGMODE == 7 && defined(MAINUV2)
gl_FragColor.rgb=vec3(vMainUV2,0.0);
#elif DEBUGMODE == 8 && defined(CLEARCOAT) && defined(CLEARCOAT_BUMP)

gl_FragColor.rgb=clearcoatOut.TBNClearCoat[0];
#define DEBUGMODE_NORMALIZE
#elif DEBUGMODE == 9 && defined(CLEARCOAT) && defined(CLEARCOAT_BUMP)

gl_FragColor.rgb=clearcoatOut.TBNClearCoat[1];
#define DEBUGMODE_NORMALIZE
#elif DEBUGMODE == 10 && defined(CLEARCOAT)

gl_FragColor.rgb=clearcoatOut.clearCoatNormalW;
#define DEBUGMODE_NORMALIZE
#elif DEBUGMODE == 11 && defined(ANISOTROPIC)
gl_FragColor.rgb=anisotropicOut.anisotropicNormal;
#define DEBUGMODE_NORMALIZE
#elif DEBUGMODE == 12 && defined(ANISOTROPIC)
gl_FragColor.rgb=anisotropicOut.anisotropicTangent;
#define DEBUGMODE_NORMALIZE
#elif DEBUGMODE == 13 && defined(ANISOTROPIC)
gl_FragColor.rgb=anisotropicOut.anisotropicBitangent;
#define DEBUGMODE_NORMALIZE

#elif DEBUGMODE == 20 && defined(ALBEDO)
gl_FragColor.rgb=albedoTexture.rgb;
#elif DEBUGMODE == 21 && defined(AMBIENT)
gl_FragColor.rgb=aoOut.ambientOcclusionColorMap.rgb;
#elif DEBUGMODE == 22 && defined(OPACITY)
gl_FragColor.rgb=opacityMap.rgb;
#elif DEBUGMODE == 23 && defined(EMISSIVE)
gl_FragColor.rgb=emissiveColorTex.rgb;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 24 && defined(LIGHTMAP)
gl_FragColor.rgb=lightmapColor.rgb;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 25 && defined(REFLECTIVITY) && defined(METALLICWORKFLOW)
gl_FragColor.rgb=reflectivityOut.surfaceMetallicColorMap.rgb;
#elif DEBUGMODE == 26 && defined(REFLECTIVITY) && !defined(METALLICWORKFLOW)
gl_FragColor.rgb=reflectivityOut.surfaceReflectivityColorMap.rgb;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 27 && defined(CLEARCOAT) && defined(CLEARCOAT_TEXTURE)
gl_FragColor.rgb=vec3(clearcoatOut.clearCoatMapData.rg,0.0);
#elif DEBUGMODE == 28 && defined(CLEARCOAT) && defined(CLEARCOAT_TINT) && defined(CLEARCOAT_TINT_TEXTURE)
gl_FragColor.rgb=clearcoatOut.clearCoatTintMapData.rgb;
#elif DEBUGMODE == 29 && defined(SHEEN) && defined(SHEEN_TEXTURE)
gl_FragColor.rgb=sheenOut.sheenMapData.rgb;
#elif DEBUGMODE == 30 && defined(ANISOTROPIC) && defined(ANISOTROPIC_TEXTURE)
gl_FragColor.rgb=anisotropicOut.anisotropyMapData.rgb;
#elif DEBUGMODE == 31 && defined(SUBSURFACE) && defined(SS_THICKNESSANDMASK_TEXTURE)
gl_FragColor.rgb=subSurfaceOut.thicknessMap.rgb;

#elif DEBUGMODE == 40 && defined(SS_REFRACTION)

gl_FragColor.rgb=subSurfaceOut.environmentRefraction.rgb;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 41 && defined(REFLECTION)
gl_FragColor.rgb=reflectionOut.environmentRadiance.rgb;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 42 && defined(CLEARCOAT) && defined(REFLECTION)
gl_FragColor.rgb=clearcoatOut.environmentClearCoatRadiance.rgb;
#define DEBUGMODE_GAMMA

#elif DEBUGMODE == 50
gl_FragColor.rgb=diffuseBase.rgb;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 51 && defined(SPECULARTERM)
gl_FragColor.rgb=specularBase.rgb;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 52 && defined(CLEARCOAT)
gl_FragColor.rgb=clearCoatBase.rgb;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 53 && defined(SHEEN)
gl_FragColor.rgb=sheenBase.rgb;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 54 && defined(REFLECTION)
gl_FragColor.rgb=reflectionOut.environmentIrradiance.rgb;
#define DEBUGMODE_GAMMA

#elif DEBUGMODE == 60
gl_FragColor.rgb=surfaceAlbedo.rgb;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 61
gl_FragColor.rgb=clearcoatOut.specularEnvironmentR0;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 62 && defined(METALLICWORKFLOW)
gl_FragColor.rgb=vec3(reflectivityOut.metallicRoughness.r);
#elif DEBUGMODE == 71 && defined(METALLICWORKFLOW)
gl_FragColor.rgb=reflectivityOut.metallicF0;
#elif DEBUGMODE == 63
gl_FragColor.rgb=vec3(roughness);
#elif DEBUGMODE == 64
gl_FragColor.rgb=vec3(alphaG);
#elif DEBUGMODE == 65
gl_FragColor.rgb=vec3(NdotV);
#elif DEBUGMODE == 66 && defined(CLEARCOAT) && defined(CLEARCOAT_TINT)
gl_FragColor.rgb=clearcoatOut.clearCoatColor.rgb;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 67 && defined(CLEARCOAT)
gl_FragColor.rgb=vec3(clearcoatOut.clearCoatRoughness);
#elif DEBUGMODE == 68 && defined(CLEARCOAT)
gl_FragColor.rgb=vec3(clearcoatOut.clearCoatNdotV);
#elif DEBUGMODE == 69 && defined(SUBSURFACE) && defined(SS_TRANSLUCENCY)
gl_FragColor.rgb=subSurfaceOut.transmittance;
#elif DEBUGMODE == 70 && defined(SUBSURFACE) && defined(SS_REFRACTION)
gl_FragColor.rgb=subSurfaceOut.refractionTransmittance;

#elif DEBUGMODE == 80 && defined(RADIANCEOCCLUSION)
gl_FragColor.rgb=vec3(seo);
#elif DEBUGMODE == 81 && defined(HORIZONOCCLUSION)
gl_FragColor.rgb=vec3(eho);
#elif DEBUGMODE == 82 && defined(MS_BRDF_ENERGY_CONSERVATION)
gl_FragColor.rgb=vec3(energyConservationFactor);
#elif DEBUGMODE == 83 && defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)
gl_FragColor.rgb=specularEnvironmentReflectance;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 84 && defined(CLEARCOAT) && defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)
gl_FragColor.rgb=clearcoatOut.clearCoatEnvironmentReflectance;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 85 && defined(SHEEN) && defined(REFLECTION)
gl_FragColor.rgb=sheenOut.sheenEnvironmentReflectance;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 86 && defined(ALPHABLEND)
gl_FragColor.rgb=vec3(luminanceOverAlpha);
#elif DEBUGMODE == 87
gl_FragColor.rgb=vec3(alpha);
#endif
gl_FragColor.rgb*=vDebugMode.y;
#ifdef DEBUGMODE_NORMALIZE
gl_FragColor.rgb=normalize(gl_FragColor.rgb)*0.5+0.5;
#endif
#ifdef DEBUGMODE_GAMMA
gl_FragColor.rgb=toGammaSpace(gl_FragColor.rgb);
#endif
gl_FragColor.a=1.0;
#ifdef PREPASS
gl_FragData[0]=toLinearSpace(gl_FragColor);
gl_FragData[1]=vec4(0.,0.,0.,0.);
#endif
return;
}
#endif`;Ye.a.IncludesShadersStore.pbrDebug=DD;var wD=`#if defined(BUMP) || !defined(NORMAL) || defined(FORCENORMALFORWARD) || defined(SPECULARAA) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC)
#extension GL_OES_standard_derivatives : enable
#endif
#ifdef LODBASEDMICROSFURACE
#extension GL_EXT_shader_texture_lod : enable
#endif
#define CUSTOM_FRAGMENT_BEGIN
#ifdef LOGARITHMICDEPTH
#extension GL_EXT_frag_depth : enable
#endif
#include<prePassDeclaration>[SCENE_MRT_COUNT]
precision highp float;

#ifndef FROMLINEARSPACE
#define FROMLINEARSPACE
#endif

#include<__decl__pbrFragment>
#include<pbrFragmentExtraDeclaration>
#include<__decl__lightFragment>[0..maxSimultaneousLights]
#include<pbrFragmentSamplersDeclaration>
#include<imageProcessingDeclaration>
#include<clipPlaneFragmentDeclaration>
#include<logDepthDeclaration>
#include<fogFragmentDeclaration>

#include<helperFunctions>
#include<subSurfaceScatteringFunctions>
#include<importanceSampling>
#include<pbrHelperFunctions>
#include<imageProcessingFunctions>
#include<shadowsFragmentFunctions>
#include<harmonicsFunctions>
#include<pbrDirectLightingSetupFunctions>
#include<pbrDirectLightingFalloffFunctions>
#include<pbrBRDFFunctions>
#include<hdrFilteringFunctions>
#include<pbrDirectLightingFunctions>
#include<pbrIBLFunctions>
#include<bumpFragmentMainFunctions>
#include<bumpFragmentFunctions>
#ifdef REFLECTION
#include<reflectionFunction>
#endif
#define CUSTOM_FRAGMENT_DEFINITIONS
#include<pbrBlockAlbedoOpacity>
#include<pbrBlockReflectivity>
#include<pbrBlockAmbientOcclusion>
#include<pbrBlockAlphaFresnel>
#include<pbrBlockAnisotropic>
#include<pbrBlockReflection>
#include<pbrBlockSheen>
#include<pbrBlockClearcoat>
#include<pbrBlockSubSurface>

void main(void) {
#define CUSTOM_FRAGMENT_MAIN_BEGIN
#include<clipPlaneFragment>

#include<pbrBlockNormalGeometric>
#include<bumpFragment>
#include<pbrBlockNormalFinal>

albedoOpacityOutParams albedoOpacityOut;
#ifdef ALBEDO
vec4 albedoTexture=texture2D(albedoSampler,vAlbedoUV+uvOffset);
#endif
#ifdef OPACITY
vec4 opacityMap=texture2D(opacitySampler,vOpacityUV+uvOffset);
#endif
albedoOpacityBlock(
vAlbedoColor,
#ifdef ALBEDO
albedoTexture,
vAlbedoInfos,
#endif
#ifdef OPACITY
opacityMap,
vOpacityInfos,
#endif
#ifdef DETAIL
detailColor,
vDetailInfos,
#endif
albedoOpacityOut
);
vec3 surfaceAlbedo=albedoOpacityOut.surfaceAlbedo;
float alpha=albedoOpacityOut.alpha;
#define CUSTOM_FRAGMENT_UPDATE_ALPHA
#include<depthPrePass>
#define CUSTOM_FRAGMENT_BEFORE_LIGHTS

ambientOcclusionOutParams aoOut;
#ifdef AMBIENT
vec3 ambientOcclusionColorMap=texture2D(ambientSampler,vAmbientUV+uvOffset).rgb;
#endif
ambientOcclusionBlock(
#ifdef AMBIENT
ambientOcclusionColorMap,
vAmbientInfos,
#endif
aoOut
);
#include<pbrBlockLightmapInit>
#ifdef UNLIT
vec3 diffuseBase=vec3(1.,1.,1.);
#else

vec3 baseColor=surfaceAlbedo;
reflectivityOutParams reflectivityOut;
#if defined(REFLECTIVITY)
vec4 surfaceMetallicOrReflectivityColorMap=texture2D(reflectivitySampler,vReflectivityUV+uvOffset);
vec4 baseReflectivity=surfaceMetallicOrReflectivityColorMap;
#ifndef METALLICWORKFLOW
surfaceMetallicOrReflectivityColorMap=toLinearSpace(surfaceMetallicOrReflectivityColorMap);
surfaceMetallicOrReflectivityColorMap.rgb*=vReflectivityInfos.y;
#endif
#endif
#if defined(MICROSURFACEMAP)
vec4 microSurfaceTexel=texture2D(microSurfaceSampler,vMicroSurfaceSamplerUV+uvOffset)*vMicroSurfaceSamplerInfos.y;
#endif
#ifdef METALLICWORKFLOW
vec4 metallicReflectanceFactors=vMetallicReflectanceFactors;
#ifdef METALLIC_REFLECTANCE
vec4 metallicReflectanceFactorsMap=texture2D(metallicReflectanceSampler,vMetallicReflectanceUV+uvOffset);
metallicReflectanceFactorsMap=toLinearSpace(metallicReflectanceFactorsMap);
metallicReflectanceFactors*=metallicReflectanceFactorsMap;
#endif
#endif
reflectivityBlock(
vReflectivityColor,
#ifdef METALLICWORKFLOW
surfaceAlbedo,
metallicReflectanceFactors,
#endif
#ifdef REFLECTIVITY
vReflectivityInfos,
surfaceMetallicOrReflectivityColorMap,
#endif
#if defined(METALLICWORKFLOW) && defined(REFLECTIVITY) && defined(AOSTOREINMETALMAPRED)
aoOut.ambientOcclusionColor,
#endif
#ifdef MICROSURFACEMAP
microSurfaceTexel,
#endif
#ifdef DETAIL
detailColor,
vDetailInfos,
#endif
reflectivityOut
);
float microSurface=reflectivityOut.microSurface;
float roughness=reflectivityOut.roughness;
#ifdef METALLICWORKFLOW
surfaceAlbedo=reflectivityOut.surfaceAlbedo;
#endif
#if defined(METALLICWORKFLOW) && defined(REFLECTIVITY) && defined(AOSTOREINMETALMAPRED)
aoOut.ambientOcclusionColor=reflectivityOut.ambientOcclusionColor;
#endif

#ifdef ALPHAFRESNEL
#if defined(ALPHATEST) || defined(ALPHABLEND)
alphaFresnelOutParams alphaFresnelOut;
alphaFresnelBlock(
normalW,
viewDirectionW,
alpha,
microSurface,
alphaFresnelOut
);
alpha=alphaFresnelOut.alpha;
#endif
#endif

#include<pbrBlockGeometryInfo>

#ifdef ANISOTROPIC
anisotropicOutParams anisotropicOut;
#ifdef ANISOTROPIC_TEXTURE
vec3 anisotropyMapData=texture2D(anisotropySampler,vAnisotropyUV+uvOffset).rgb*vAnisotropyInfos.y;
#endif
anisotropicBlock(
vAnisotropy,
#ifdef ANISOTROPIC_TEXTURE
anisotropyMapData,
#endif
TBN,
normalW,
viewDirectionW,
anisotropicOut
);
#endif

#ifdef REFLECTION
reflectionOutParams reflectionOut;
reflectionBlock(
vPositionW,
normalW,
alphaG,
vReflectionMicrosurfaceInfos,
vReflectionInfos,
vReflectionColor,
#ifdef ANISOTROPIC
anisotropicOut,
#endif
#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)
NdotVUnclamped,
#endif
#ifdef LINEARSPECULARREFLECTION
roughness,
#endif
reflectionSampler,
#if defined(NORMAL) && defined(USESPHERICALINVERTEX)
vEnvironmentIrradiance,
#endif
#ifdef USESPHERICALFROMREFLECTIONMAP
#if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)
reflectionMatrix,
#endif
#endif
#ifdef USEIRRADIANCEMAP
irradianceSampler,
#endif
#ifndef LODBASEDMICROSFURACE
reflectionSamplerLow,
reflectionSamplerHigh,
#endif
#ifdef REALTIME_FILTERING
vReflectionFilteringInfo,
#endif
reflectionOut
);
#endif

#include<pbrBlockReflectance0>

#ifdef SHEEN
sheenOutParams sheenOut;
#ifdef SHEEN_TEXTURE
vec4 sheenMapData=toLinearSpace(texture2D(sheenSampler,vSheenUV+uvOffset))*vSheenInfos.y;
#endif
#if defined(SHEEN_ROUGHNESS) && defined(SHEEN_TEXTURE_ROUGHNESS) && !defined(SHEEN_TEXTURE_ROUGHNESS_IDENTICAL) && !defined(SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE)
vec4 sheenMapRoughnessData=texture2D(sheenRoughnessSampler,vSheenRoughnessUV+uvOffset)*vSheenInfos.w;
#endif
sheenBlock(
vSheenColor,
#ifdef SHEEN_ROUGHNESS
vSheenRoughness,
#if defined(SHEEN_TEXTURE_ROUGHNESS) && !defined(SHEEN_TEXTURE_ROUGHNESS_IDENTICAL) && !defined(SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE)
sheenMapRoughnessData,
#endif
#endif
roughness,
#ifdef SHEEN_TEXTURE
sheenMapData,
#endif
reflectance,
#ifdef SHEEN_LINKWITHALBEDO
baseColor,
surfaceAlbedo,
#endif
#ifdef ENVIRONMENTBRDF
NdotV,
environmentBrdf,
#endif
#if defined(REFLECTION) && defined(ENVIRONMENTBRDF)
AARoughnessFactors,
vReflectionMicrosurfaceInfos,
vReflectionInfos,
vReflectionColor,
vLightingIntensity,
reflectionSampler,
reflectionOut.reflectionCoords,
NdotVUnclamped,
#ifndef LODBASEDMICROSFURACE
reflectionSamplerLow,
reflectionSamplerHigh,
#endif
#ifdef REALTIME_FILTERING
vReflectionFilteringInfo,
#endif
#if !defined(REFLECTIONMAP_SKYBOX) && defined(RADIANCEOCCLUSION)
seo,
#endif
#if !defined(REFLECTIONMAP_SKYBOX) && defined(HORIZONOCCLUSION) && defined(BUMP) && defined(REFLECTIONMAP_3D)
eho,
#endif
#endif
sheenOut
);
#ifdef SHEEN_LINKWITHALBEDO
surfaceAlbedo=sheenOut.surfaceAlbedo;
#endif
#endif

clearcoatOutParams clearcoatOut;
#ifdef CLEARCOAT
#ifdef CLEARCOAT_TEXTURE
vec2 clearCoatMapData=texture2D(clearCoatSampler,vClearCoatUV+uvOffset).rg*vClearCoatInfos.y;
#endif
#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && !defined(CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL) && !defined(CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE)
vec4 clearCoatMapRoughnessData=texture2D(clearCoatRoughnessSampler,vClearCoatRoughnessUV+uvOffset)*vClearCoatInfos.w;
#endif
#if defined(CLEARCOAT_TINT) && defined(CLEARCOAT_TINT_TEXTURE)
vec4 clearCoatTintMapData=toLinearSpace(texture2D(clearCoatTintSampler,vClearCoatTintUV+uvOffset));
#endif
#ifdef CLEARCOAT_BUMP
vec4 clearCoatBumpMapData=texture2D(clearCoatBumpSampler,vClearCoatBumpUV+uvOffset);
#endif
clearcoatBlock(
vPositionW,
geometricNormalW,
viewDirectionW,
vClearCoatParams,
#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && !defined(CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL) && !defined(CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE)
clearCoatMapRoughnessData,
#endif
specularEnvironmentR0,
#ifdef CLEARCOAT_TEXTURE
clearCoatMapData,
#endif
#ifdef CLEARCOAT_TINT
vClearCoatTintParams,
clearCoatColorAtDistance,
vClearCoatRefractionParams,
#ifdef CLEARCOAT_TINT_TEXTURE
clearCoatTintMapData,
#endif
#endif
#ifdef CLEARCOAT_BUMP
vClearCoatBumpInfos,
clearCoatBumpMapData,
vClearCoatBumpUV,
#if defined(TANGENT) && defined(NORMAL)
vTBN,
#else
vClearCoatTangentSpaceParams,
#endif
#ifdef OBJECTSPACE_NORMALMAP
normalMatrix,
#endif
#endif
#if defined(FORCENORMALFORWARD) && defined(NORMAL)
faceNormal,
#endif
#ifdef REFLECTION
vReflectionMicrosurfaceInfos,
vReflectionInfos,
vReflectionColor,
vLightingIntensity,
reflectionSampler,
#ifndef LODBASEDMICROSFURACE
reflectionSamplerLow,
reflectionSamplerHigh,
#endif
#ifdef REALTIME_FILTERING
vReflectionFilteringInfo,
#endif
#endif
#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)
#ifdef RADIANCEOCCLUSION
ambientMonochrome,
#endif
#endif
clearcoatOut
);
#else
clearcoatOut.specularEnvironmentR0=specularEnvironmentR0;
#endif

#include<pbrBlockReflectance>

subSurfaceOutParams subSurfaceOut;
#ifdef SUBSURFACE
#ifdef SS_THICKNESSANDMASK_TEXTURE
vec4 thicknessMap=texture2D(thicknessSampler,vThicknessUV+uvOffset);
#endif
subSurfaceBlock(
vSubSurfaceIntensity,
vThicknessParam,
vTintColor,
normalW,
specularEnvironmentReflectance,
#ifdef SS_THICKNESSANDMASK_TEXTURE
thicknessMap,
#endif
#ifdef REFLECTION
#ifdef SS_TRANSLUCENCY
reflectionMatrix,
#ifdef USESPHERICALFROMREFLECTIONMAP
#if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)
reflectionOut.irradianceVector,
#endif
#if defined(REALTIME_FILTERING)
reflectionSampler,
vReflectionFilteringInfo,
#endif
#endif
#ifdef USEIRRADIANCEMAP
irradianceSampler,
#endif
#endif
#endif
#ifdef SS_REFRACTION
vPositionW,
viewDirectionW,
view,
surfaceAlbedo,
vRefractionInfos,
refractionMatrix,
vRefractionMicrosurfaceInfos,
vLightingIntensity,
#ifdef SS_LINKREFRACTIONTOTRANSPARENCY
alpha,
#endif
#ifdef SS_LODINREFRACTIONALPHA
NdotVUnclamped,
#endif
#ifdef SS_LINEARSPECULARREFRACTION
roughness,
#else
alphaG,
#endif
refractionSampler,
#ifndef LODBASEDMICROSFURACE
refractionSamplerLow,
refractionSamplerHigh,
#endif
#ifdef ANISOTROPIC
anisotropicOut,
#endif
#ifdef REALTIME_FILTERING
vRefractionFilteringInfo,
#endif
#endif
#ifdef SS_TRANSLUCENCY
vDiffusionDistance,
#endif
subSurfaceOut
);
#ifdef SS_REFRACTION
surfaceAlbedo=subSurfaceOut.surfaceAlbedo;
#ifdef SS_LINKREFRACTIONTOTRANSPARENCY
alpha=subSurfaceOut.alpha;
#endif
#endif
#else
subSurfaceOut.specularEnvironmentReflectance=specularEnvironmentReflectance;
#endif

#include<pbrBlockDirectLighting>
#include<lightFragment>[0..maxSimultaneousLights]

#include<pbrBlockFinalLitComponents>
#endif
#include<pbrBlockFinalUnlitComponents>
#include<pbrBlockFinalColorComposition>
#include<logDepthFragment>
#include<fogFragment>(color,finalColor)
#include<pbrBlockImageProcessing>
#define CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR
#ifdef PREPASS
#ifdef PREPASS_POSITION
gl_FragData[PREPASS_POSITION_INDEX]=vec4(vPositionW,1.0);
#endif
#ifdef PREPASS_VELOCITY
vec2 a=(vCurrentPosition.xy/vCurrentPosition.w)*0.5+0.5;
vec2 b=(vPreviousPosition.xy/vPreviousPosition.w)*0.5+0.5;
vec2 velocity=abs(a-b);
velocity=vec2(pow(velocity.x,1.0/3.0),pow(velocity.y,1.0/3.0))*sign(a-b)*0.5+0.5;
gl_FragData[PREPASS_VELOCITY_INDEX]=vec4(velocity,0.0,1.0);
#endif
#ifdef PREPASS_IRRADIANCE
vec3 irradiance=finalDiffuse;
#ifndef UNLIT
#ifdef REFLECTION
irradiance+=finalIrradiance;
#endif
#endif
vec3 sqAlbedo=sqrt(surfaceAlbedo);
#ifdef SS_SCATTERING
gl_FragData[0]=vec4(finalColor.rgb-irradiance,finalColor.a);
irradiance/=sqAlbedo;
#else
gl_FragData[0]=finalColor;
float scatteringDiffusionProfile=255.;
#endif
gl_FragData[PREPASS_IRRADIANCE_INDEX]=vec4(irradiance,scatteringDiffusionProfile/255.);
#else
gl_FragData[0]=vec4(finalColor.rgb,finalColor.a);
#endif
#ifdef PREPASS_DEPTHNORMAL
gl_FragData[PREPASS_DEPTHNORMAL_INDEX]=vec4(vViewPos.z,(view*vec4(normalW,0.0)).rgb);
#endif
#ifdef PREPASS_ALBEDO
gl_FragData[PREPASS_ALBEDO_INDEX]=vec4(sqAlbedo,1.0);
#endif
#ifdef PREPASS_REFLECTIVITY
#if defined(REFLECTIVITY)
gl_FragData[PREPASS_REFLECTIVITY_INDEX]=vec4(baseReflectivity.rgb,1.0);
#else
gl_FragData[PREPASS_REFLECTIVITY_INDEX]=vec4(0.0,0.0,0.0,1.0);
#endif
#endif
#endif
#if !defined(PREPASS) || defined(WEBGL2)
gl_FragColor=finalColor;
#endif
#include<pbrDebug>
}
`;Ye.a.ShadersStore.pbrPixelShader=wD;var LD=`uniform mat4 view;
uniform mat4 viewProjection;
#ifdef ALBEDO
uniform mat4 albedoMatrix;
uniform vec2 vAlbedoInfos;
#endif
#ifdef AMBIENT
uniform mat4 ambientMatrix;
uniform vec4 vAmbientInfos;
#endif
#ifdef OPACITY
uniform mat4 opacityMatrix;
uniform vec2 vOpacityInfos;
#endif
#ifdef EMISSIVE
uniform vec2 vEmissiveInfos;
uniform mat4 emissiveMatrix;
#endif
#ifdef LIGHTMAP
uniform vec2 vLightmapInfos;
uniform mat4 lightmapMatrix;
#endif
#ifdef REFLECTIVITY
uniform vec3 vReflectivityInfos;
uniform mat4 reflectivityMatrix;
#endif
#ifdef METALLIC_REFLECTANCE
uniform vec2 vMetallicReflectanceInfos;
uniform mat4 metallicReflectanceMatrix;
#endif
#ifdef MICROSURFACEMAP
uniform vec2 vMicroSurfaceSamplerInfos;
uniform mat4 microSurfaceSamplerMatrix;
#endif
#ifdef BUMP
uniform vec3 vBumpInfos;
uniform mat4 bumpMatrix;
#endif
#ifdef POINTSIZE
uniform float pointSize;
#endif

#ifdef REFLECTION
uniform vec2 vReflectionInfos;
uniform mat4 reflectionMatrix;
#endif

#ifdef CLEARCOAT
#if defined(CLEARCOAT_TEXTURE) || defined(CLEARCOAT_TEXTURE_ROUGHNESS)
uniform vec4 vClearCoatInfos;
#endif
#ifdef CLEARCOAT_TEXTURE
uniform mat4 clearCoatMatrix;
#endif
#ifdef CLEARCOAT_TEXTURE_ROUGHNESS
uniform mat4 clearCoatRoughnessMatrix;
#endif
#ifdef CLEARCOAT_BUMP
uniform vec2 vClearCoatBumpInfos;
uniform mat4 clearCoatBumpMatrix;
#endif
#ifdef CLEARCOAT_TINT_TEXTURE
uniform vec2 vClearCoatTintInfos;
uniform mat4 clearCoatTintMatrix;
#endif
#endif

#ifdef ANISOTROPIC
#ifdef ANISOTROPIC_TEXTURE
uniform vec2 vAnisotropyInfos;
uniform mat4 anisotropyMatrix;
#endif
#endif

#ifdef SHEEN
#if defined(SHEEN_TEXTURE) || defined(SHEEN_TEXTURE_ROUGHNESS)
uniform vec4 vSheenInfos;
#endif
#ifdef SHEEN_TEXTURE
uniform mat4 sheenMatrix;
#endif
#ifdef SHEEN_TEXTURE_ROUGHNESS
uniform mat4 sheenRoughnessMatrix;
#endif
#endif

#ifdef SUBSURFACE
#ifdef SS_REFRACTION
uniform vec4 vRefractionInfos;
uniform mat4 refractionMatrix;
#endif
#ifdef SS_THICKNESSANDMASK_TEXTURE
uniform vec2 vThicknessInfos;
uniform mat4 thicknessMatrix;
#endif
#endif
`;Ye.a.IncludesShadersStore.pbrVertexDeclaration=LD,c(163),c(164),c(93),c(94),c(100),c(165),c(156),c(158);var ND=`precision highp float;
#include<__decl__pbrVertex>
#define CUSTOM_VERTEX_BEGIN

attribute vec3 position;
#ifdef NORMAL
attribute vec3 normal;
#endif
#ifdef TANGENT
attribute vec4 tangent;
#endif
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#ifdef MAINUV1
varying vec2 vMainUV1;
#endif
#ifdef MAINUV2
varying vec2 vMainUV2;
#endif
#ifdef VERTEXCOLOR
attribute vec4 color;
#endif
#include<helperFunctions>
#include<bonesDeclaration>

#include<instancesDeclaration>
#include<prePassVertexDeclaration>
#if defined(ALBEDO) && ALBEDODIRECTUV == 0
varying vec2 vAlbedoUV;
#endif
#if defined(DETAIL) && DETAILDIRECTUV == 0
varying vec2 vDetailUV;
#endif
#if defined(AMBIENT) && AMBIENTDIRECTUV == 0
varying vec2 vAmbientUV;
#endif
#if defined(OPACITY) && OPACITYDIRECTUV == 0
varying vec2 vOpacityUV;
#endif
#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0
varying vec2 vEmissiveUV;
#endif
#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0
varying vec2 vLightmapUV;
#endif
#if defined(REFLECTIVITY) && REFLECTIVITYDIRECTUV == 0
varying vec2 vReflectivityUV;
#endif
#if defined(MICROSURFACEMAP) && MICROSURFACEMAPDIRECTUV == 0
varying vec2 vMicroSurfaceSamplerUV;
#endif
#if defined(METALLIC_REFLECTANCE) && METALLIC_REFLECTANCEDIRECTUV == 0
varying vec2 vMetallicReflectanceUV;
#endif
#if defined(BUMP) && BUMPDIRECTUV == 0
varying vec2 vBumpUV;
#endif
#ifdef CLEARCOAT
#if defined(CLEARCOAT_TEXTURE) && CLEARCOAT_TEXTUREDIRECTUV == 0
varying vec2 vClearCoatUV;
#endif
#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV == 0
varying vec2 vClearCoatRoughnessUV;
#endif
#if defined(CLEARCOAT_BUMP) && CLEARCOAT_BUMPDIRECTUV == 0
varying vec2 vClearCoatBumpUV;
#endif
#if defined(CLEARCOAT_TINT_TEXTURE) && CLEARCOAT_TINT_TEXTUREDIRECTUV == 0
varying vec2 vClearCoatTintUV;
#endif
#endif
#ifdef SHEEN
#if defined(SHEEN_TEXTURE) && SHEEN_TEXTUREDIRECTUV == 0
varying vec2 vSheenUV;
#endif
#if defined(SHEEN_TEXTURE_ROUGHNESS) && SHEEN_TEXTURE_ROUGHNESSDIRECTUV == 0
varying vec2 vSheenRoughnessUV;
#endif
#endif
#ifdef ANISOTROPIC
#if defined(ANISOTROPIC_TEXTURE) && ANISOTROPIC_TEXTUREDIRECTUV == 0
varying vec2 vAnisotropyUV;
#endif
#endif
#ifdef SUBSURFACE
#if defined(SS_THICKNESSANDMASK_TEXTURE) && SS_THICKNESSANDMASK_TEXTUREDIRECTUV == 0
varying vec2 vThicknessUV;
#endif
#endif

varying vec3 vPositionW;
#if DEBUGMODE>0
varying vec4 vClipSpacePosition;
#endif
#ifdef NORMAL
varying vec3 vNormalW;
#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)
varying vec3 vEnvironmentIrradiance;
#include<harmonicsFunctions>
#endif
#endif
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif
#include<bumpVertexDeclaration>
#include<clipPlaneVertexDeclaration>
#include<fogVertexDeclaration>
#include<__decl__lightFragment>[0..maxSimultaneousLights]
#include<morphTargetsVertexGlobalDeclaration>
#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]
#ifdef REFLECTIONMAP_SKYBOX
varying vec3 vPositionUVW;
#endif
#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)
varying vec3 vDirectionW;
#endif
#include<logDepthDeclaration>
#define CUSTOM_VERTEX_DEFINITIONS
void main(void) {
#define CUSTOM_VERTEX_MAIN_BEGIN
vec3 positionUpdated=position;
#ifdef NORMAL
vec3 normalUpdated=normal;
#endif
#ifdef TANGENT
vec4 tangentUpdated=tangent;
#endif
#ifdef UV1
vec2 uvUpdated=uv;
#endif
#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]
#ifdef REFLECTIONMAP_SKYBOX
vPositionUVW=positionUpdated;
#endif
#define CUSTOM_VERTEX_UPDATE_POSITION
#define CUSTOM_VERTEX_UPDATE_NORMAL
#include<instancesVertex>
#if defined(PREPASS) && defined(PREPASS_VELOCITY) && !defined(BONES_VELOCITY_ENABLED)

vCurrentPosition=viewProjection*finalWorld*vec4(positionUpdated,1.0);
vPreviousPosition=previousViewProjection*previousWorld*vec4(positionUpdated,1.0);
#endif
#include<bonesVertex>
vec4 worldPos=finalWorld*vec4(positionUpdated,1.0);
vPositionW=vec3(worldPos);
#include<prePassVertex>
#ifdef NORMAL
mat3 normalWorld=mat3(finalWorld);
#if defined(INSTANCES) && defined(THIN_INSTANCES)
vNormalW=normalUpdated/vec3(dot(normalWorld[0],normalWorld[0]),dot(normalWorld[1],normalWorld[1]),dot(normalWorld[2],normalWorld[2]));
vNormalW=normalize(normalWorld*vNormalW);
#else
#ifdef NONUNIFORMSCALING
normalWorld=transposeMat3(inverseMat3(normalWorld));
#endif
vNormalW=normalize(normalWorld*normalUpdated);
#endif
#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)
vec3 reflectionVector=vec3(reflectionMatrix*vec4(vNormalW,0)).xyz;
#ifdef REFLECTIONMAP_OPPOSITEZ
reflectionVector.z*=-1.0;
#endif
vEnvironmentIrradiance=computeEnvironmentIrradiance(reflectionVector);
#endif
#endif
#define CUSTOM_VERTEX_UPDATE_WORLDPOS
#ifdef MULTIVIEW
if (gl_ViewID_OVR == 0u) {
gl_Position=viewProjection*worldPos;
} else {
gl_Position=viewProjectionR*worldPos;
}
#else
gl_Position=viewProjection*worldPos;
#endif
#if DEBUGMODE>0
vClipSpacePosition=gl_Position;
#endif
#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)
vDirectionW=normalize(vec3(finalWorld*vec4(positionUpdated,0.0)));
#endif

#ifndef UV1
vec2 uvUpdated=vec2(0.,0.);
#endif
#ifndef UV2
vec2 uv2=vec2(0.,0.);
#endif
#ifdef MAINUV1
vMainUV1=uvUpdated;
#endif
#ifdef MAINUV2
vMainUV2=uv2;
#endif
#if defined(ALBEDO) && ALBEDODIRECTUV == 0
if (vAlbedoInfos.x == 0.)
{
vAlbedoUV=vec2(albedoMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vAlbedoUV=vec2(albedoMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(DETAIL) && DETAILDIRECTUV == 0
if (vDetailInfos.x == 0.)
{
vDetailUV=vec2(detailMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vDetailUV=vec2(detailMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(AMBIENT) && AMBIENTDIRECTUV == 0
if (vAmbientInfos.x == 0.)
{
vAmbientUV=vec2(ambientMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vAmbientUV=vec2(ambientMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(OPACITY) && OPACITYDIRECTUV == 0
if (vOpacityInfos.x == 0.)
{
vOpacityUV=vec2(opacityMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0
if (vEmissiveInfos.x == 0.)
{
vEmissiveUV=vec2(emissiveMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vEmissiveUV=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0
if (vLightmapInfos.x == 0.)
{
vLightmapUV=vec2(lightmapMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vLightmapUV=vec2(lightmapMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(REFLECTIVITY) && REFLECTIVITYDIRECTUV == 0
if (vReflectivityInfos.x == 0.)
{
vReflectivityUV=vec2(reflectivityMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vReflectivityUV=vec2(reflectivityMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(MICROSURFACEMAP) && MICROSURFACEMAPDIRECTUV == 0
if (vMicroSurfaceSamplerInfos.x == 0.)
{
vMicroSurfaceSamplerUV=vec2(microSurfaceSamplerMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vMicroSurfaceSamplerUV=vec2(microSurfaceSamplerMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(METALLIC_REFLECTANCE) && METALLIC_REFLECTANCEDIRECTUV == 0
if (vMetallicReflectanceInfos.x == 0.)
{
vMetallicReflectanceUV=vec2(metallicReflectanceMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vMetallicReflectanceUV=vec2(metallicReflectanceMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(BUMP) && BUMPDIRECTUV == 0
if (vBumpInfos.x == 0.)
{
vBumpUV=vec2(bumpMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vBumpUV=vec2(bumpMatrix*vec4(uv2,1.0,0.0));
}
#endif
#ifdef CLEARCOAT
#if defined(CLEARCOAT_TEXTURE) && CLEARCOAT_TEXTUREDIRECTUV == 0
if (vClearCoatInfos.x == 0.)
{
vClearCoatUV=vec2(clearCoatMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vClearCoatUV=vec2(clearCoatMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV == 0
if (vClearCoatInfos.z == 0.)
{
vClearCoatRoughnessUV=vec2(clearCoatRoughnessMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vClearCoatRoughnessUV=vec2(clearCoatRoughnessMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(CLEARCOAT_BUMP) && CLEARCOAT_BUMPDIRECTUV == 0
if (vClearCoatBumpInfos.x == 0.)
{
vClearCoatBumpUV=vec2(clearCoatBumpMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vClearCoatBumpUV=vec2(clearCoatBumpMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(CLEARCOAT_TINT_TEXTURE) && CLEARCOAT_TINT_TEXTUREDIRECTUV == 0
if (vClearCoatTintInfos.x == 0.)
{
vClearCoatTintUV=vec2(clearCoatTintMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vClearCoatTintUV=vec2(clearCoatTintMatrix*vec4(uv2,1.0,0.0));
}
#endif
#endif
#ifdef SHEEN
#if defined(SHEEN_TEXTURE) && SHEEN_TEXTUREDIRECTUV == 0
if (vSheenInfos.x == 0.)
{
vSheenUV=vec2(sheenMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vSheenUV=vec2(sheenMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(SHEEN_TEXTURE_ROUGHNESS) && SHEEN_TEXTURE_ROUGHNESSDIRECTUV == 0
if (vSheenInfos.z == 0.)
{
vSheenRoughnessUV=vec2(sheenRoughnessMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vSheenRoughnessUV=vec2(sheenRoughnessMatrix*vec4(uv2,1.0,0.0));
}
#endif
#endif
#ifdef ANISOTROPIC
#if defined(ANISOTROPIC_TEXTURE) && ANISOTROPIC_TEXTUREDIRECTUV == 0
if (vAnisotropyInfos.x == 0.)
{
vAnisotropyUV=vec2(anisotropyMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vAnisotropyUV=vec2(anisotropyMatrix*vec4(uv2,1.0,0.0));
}
#endif
#endif
#ifdef SUBSURFACE
#if defined(SS_THICKNESSANDMASK_TEXTURE) && SS_THICKNESSANDMASK_TEXTUREDIRECTUV == 0
if (vThicknessInfos.x == 0.)
{
vThicknessUV=vec2(thicknessMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vThicknessUV=vec2(thicknessMatrix*vec4(uv2,1.0,0.0));
}
#endif
#endif

#include<bumpVertex>

#include<clipPlaneVertex>

#include<fogVertex>

#include<shadowsVertex>[0..maxSimultaneousLights]

#ifdef VERTEXCOLOR
vColor=color;
#endif

#ifdef POINTSIZE
gl_PointSize=pointSize;
#endif

#include<logDepthVertex>
#define CUSTOM_VERTEX_MAIN_END
}`;Ye.a.ShadersStore.pbrVertexShader=ND;var _h=c(92),xs={effect:null,subMesh:null},em=function(i){function t(){var e=i.call(this)||this;return e.PBR=!0,e.NUM_SAMPLES="0",e.REALTIME_FILTERING=!1,e.MAINUV1=!1,e.MAINUV2=!1,e.UV1=!1,e.UV2=!1,e.ALBEDO=!1,e.GAMMAALBEDO=!1,e.ALBEDODIRECTUV=0,e.VERTEXCOLOR=!1,e.DETAIL=!1,e.DETAILDIRECTUV=0,e.DETAIL_NORMALBLENDMETHOD=0,e.AMBIENT=!1,e.AMBIENTDIRECTUV=0,e.AMBIENTINGRAYSCALE=!1,e.OPACITY=!1,e.VERTEXALPHA=!1,e.OPACITYDIRECTUV=0,e.OPACITYRGB=!1,e.ALPHATEST=!1,e.DEPTHPREPASS=!1,e.ALPHABLEND=!1,e.ALPHAFROMALBEDO=!1,e.ALPHATESTVALUE="0.5",e.SPECULAROVERALPHA=!1,e.RADIANCEOVERALPHA=!1,e.ALPHAFRESNEL=!1,e.LINEARALPHAFRESNEL=!1,e.PREMULTIPLYALPHA=!1,e.EMISSIVE=!1,e.EMISSIVEDIRECTUV=0,e.REFLECTIVITY=!1,e.REFLECTIVITYDIRECTUV=0,e.SPECULARTERM=!1,e.MICROSURFACEFROMREFLECTIVITYMAP=!1,e.MICROSURFACEAUTOMATIC=!1,e.LODBASEDMICROSFURACE=!1,e.MICROSURFACEMAP=!1,e.MICROSURFACEMAPDIRECTUV=0,e.METALLICWORKFLOW=!1,e.ROUGHNESSSTOREINMETALMAPALPHA=!1,e.ROUGHNESSSTOREINMETALMAPGREEN=!1,e.METALLNESSSTOREINMETALMAPBLUE=!1,e.AOSTOREINMETALMAPRED=!1,e.METALLIC_REFLECTANCE=!1,e.METALLIC_REFLECTANCEDIRECTUV=0,e.ENVIRONMENTBRDF=!1,e.ENVIRONMENTBRDF_RGBD=!1,e.NORMAL=!1,e.TANGENT=!1,e.BUMP=!1,e.BUMPDIRECTUV=0,e.OBJECTSPACE_NORMALMAP=!1,e.PARALLAX=!1,e.PARALLAXOCCLUSION=!1,e.NORMALXYSCALE=!0,e.LIGHTMAP=!1,e.LIGHTMAPDIRECTUV=0,e.USELIGHTMAPASSHADOWMAP=!1,e.GAMMALIGHTMAP=!1,e.RGBDLIGHTMAP=!1,e.REFLECTION=!1,e.REFLECTIONMAP_3D=!1,e.REFLECTIONMAP_SPHERICAL=!1,e.REFLECTIONMAP_PLANAR=!1,e.REFLECTIONMAP_CUBIC=!1,e.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,e.REFLECTIONMAP_PROJECTION=!1,e.REFLECTIONMAP_SKYBOX=!1,e.REFLECTIONMAP_EXPLICIT=!1,e.REFLECTIONMAP_EQUIRECTANGULAR=!1,e.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,e.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,e.INVERTCUBICMAP=!1,e.USESPHERICALFROMREFLECTIONMAP=!1,e.USEIRRADIANCEMAP=!1,e.SPHERICAL_HARMONICS=!1,e.USESPHERICALINVERTEX=!1,e.REFLECTIONMAP_OPPOSITEZ=!1,e.LODINREFLECTIONALPHA=!1,e.GAMMAREFLECTION=!1,e.RGBDREFLECTION=!1,e.LINEARSPECULARREFLECTION=!1,e.RADIANCEOCCLUSION=!1,e.HORIZONOCCLUSION=!1,e.INSTANCES=!1,e.THIN_INSTANCES=!1,e.PREPASS=!1,e.PREPASS_IRRADIANCE=!1,e.PREPASS_IRRADIANCE_INDEX=-1,e.PREPASS_ALBEDO=!1,e.PREPASS_ALBEDO_INDEX=-1,e.PREPASS_DEPTHNORMAL=!1,e.PREPASS_DEPTHNORMAL_INDEX=-1,e.PREPASS_POSITION=!1,e.PREPASS_POSITION_INDEX=-1,e.PREPASS_VELOCITY=!1,e.PREPASS_VELOCITY_INDEX=-1,e.PREPASS_REFLECTIVITY=!1,e.PREPASS_REFLECTIVITY_INDEX=-1,e.SCENE_MRT_COUNT=0,e.NUM_BONE_INFLUENCERS=0,e.BonesPerMesh=0,e.BONETEXTURE=!1,e.BONES_VELOCITY_ENABLED=!1,e.NONUNIFORMSCALING=!1,e.MORPHTARGETS=!1,e.MORPHTARGETS_NORMAL=!1,e.MORPHTARGETS_TANGENT=!1,e.MORPHTARGETS_UV=!1,e.NUM_MORPH_INFLUENCERS=0,e.IMAGEPROCESSING=!1,e.VIGNETTE=!1,e.VIGNETTEBLENDMODEMULTIPLY=!1,e.VIGNETTEBLENDMODEOPAQUE=!1,e.TONEMAPPING=!1,e.TONEMAPPING_ACES=!1,e.CONTRAST=!1,e.COLORCURVES=!1,e.COLORGRADING=!1,e.COLORGRADING3D=!1,e.SAMPLER3DGREENDEPTH=!1,e.SAMPLER3DBGRMAP=!1,e.IMAGEPROCESSINGPOSTPROCESS=!1,e.EXPOSURE=!1,e.MULTIVIEW=!1,e.USEPHYSICALLIGHTFALLOFF=!1,e.USEGLTFLIGHTFALLOFF=!1,e.TWOSIDEDLIGHTING=!1,e.SHADOWFLOAT=!1,e.CLIPPLANE=!1,e.CLIPPLANE2=!1,e.CLIPPLANE3=!1,e.CLIPPLANE4=!1,e.CLIPPLANE5=!1,e.CLIPPLANE6=!1,e.POINTSIZE=!1,e.FOG=!1,e.LOGARITHMICDEPTH=!1,e.FORCENORMALFORWARD=!1,e.SPECULARAA=!1,e.CLEARCOAT=!1,e.CLEARCOAT_DEFAULTIOR=!1,e.CLEARCOAT_TEXTURE=!1,e.CLEARCOAT_TEXTURE_ROUGHNESS=!1,e.CLEARCOAT_TEXTUREDIRECTUV=0,e.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,e.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,e.CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL=!1,e.CLEARCOAT_BUMP=!1,e.CLEARCOAT_BUMPDIRECTUV=0,e.CLEARCOAT_REMAP_F0=!0,e.CLEARCOAT_TINT=!1,e.CLEARCOAT_TINT_TEXTURE=!1,e.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,e.ANISOTROPIC=!1,e.ANISOTROPIC_TEXTURE=!1,e.ANISOTROPIC_TEXTUREDIRECTUV=0,e.BRDF_V_HEIGHT_CORRELATED=!1,e.MS_BRDF_ENERGY_CONSERVATION=!1,e.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=!1,e.SHEEN=!1,e.SHEEN_TEXTURE=!1,e.SHEEN_TEXTURE_ROUGHNESS=!1,e.SHEEN_TEXTUREDIRECTUV=0,e.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0,e.SHEEN_LINKWITHALBEDO=!1,e.SHEEN_ROUGHNESS=!1,e.SHEEN_ALBEDOSCALING=!1,e.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,e.SHEEN_TEXTURE_ROUGHNESS_IDENTICAL=!1,e.SUBSURFACE=!1,e.SS_REFRACTION=!1,e.SS_TRANSLUCENCY=!1,e.SS_SCATTERING=!1,e.SS_THICKNESSANDMASK_TEXTURE=!1,e.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,e.SS_REFRACTIONMAP_3D=!1,e.SS_REFRACTIONMAP_OPPOSITEZ=!1,e.SS_LODINREFRACTIONALPHA=!1,e.SS_GAMMAREFRACTION=!1,e.SS_RGBDREFRACTION=!1,e.SS_LINEARSPECULARREFRACTION=!1,e.SS_LINKREFRACTIONTOTRANSPARENCY=!1,e.SS_ALBEDOFORREFRACTIONTINT=!1,e.SS_MASK_FROM_THICKNESS_TEXTURE=!1,e.SS_MASK_FROM_THICKNESS_TEXTURE_GLTF=!1,e.UNLIT=!1,e.DEBUGMODE=0,e.rebuild(),e}return Object(p.d)(t,i),t.prototype.reset=function(){i.prototype.reset.call(this),this.ALPHATESTVALUE="0.5",this.PBR=!0},t}(fh.a),nr=function(i){function t(e,n){var r=i.call(this,e,n)||this;return r._directIntensity=1,r._emissiveIntensity=1,r._environmentIntensity=1,r._specularIntensity=1,r._lightingInfos=new d.f(r._directIntensity,r._emissiveIntensity,r._environmentIntensity,r._specularIntensity),r._disableBumpMap=!1,r._albedoTexture=null,r._ambientTexture=null,r._ambientTextureStrength=1,r._ambientTextureImpactOnAnalyticalLights=t.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,r._opacityTexture=null,r._reflectionTexture=null,r._emissiveTexture=null,r._reflectivityTexture=null,r._metallicTexture=null,r._metallic=null,r._roughness=null,r._metallicF0Factor=1,r._metallicReflectanceColor=M.a.White(),r._metallicReflectanceTexture=null,r._microSurfaceTexture=null,r._bumpTexture=null,r._lightmapTexture=null,r._ambientColor=new M.a(0,0,0),r._albedoColor=new M.a(1,1,1),r._reflectivityColor=new M.a(1,1,1),r._reflectionColor=new M.a(1,1,1),r._emissiveColor=new M.a(0,0,0),r._microSurface=.9,r._useLightmapAsShadowmap=!1,r._useHorizonOcclusion=!0,r._useRadianceOcclusion=!0,r._useAlphaFromAlbedoTexture=!1,r._useSpecularOverAlpha=!0,r._useMicroSurfaceFromReflectivityMapAlpha=!1,r._useRoughnessFromMetallicTextureAlpha=!0,r._useRoughnessFromMetallicTextureGreen=!1,r._useMetallnessFromMetallicTextureBlue=!1,r._useAmbientOcclusionFromMetallicTextureRed=!1,r._useAmbientInGrayScale=!1,r._useAutoMicroSurfaceFromReflectivityMap=!1,r._lightFalloff=t.LIGHTFALLOFF_PHYSICAL,r._useRadianceOverAlpha=!0,r._useObjectSpaceNormalMap=!1,r._useParallax=!1,r._useParallaxOcclusion=!1,r._parallaxScaleBias=.05,r._disableLighting=!1,r._maxSimultaneousLights=4,r._invertNormalMapX=!1,r._invertNormalMapY=!1,r._twoSidedLighting=!1,r._alphaCutOff=.4,r._forceAlphaTest=!1,r._useAlphaFresnel=!1,r._useLinearAlphaFresnel=!1,r._environmentBRDFTexture=null,r._forceIrradianceInFragment=!1,r._realTimeFiltering=!1,r._realTimeFilteringQuality=g.a.TEXTURE_FILTERING_QUALITY_LOW,r._forceNormalForward=!1,r._enableSpecularAntiAliasing=!1,r._imageProcessingObserver=null,r._renderTargets=new Hn.a(16),r._globalAmbientColor=new M.a(0,0,0),r._useLogarithmicDepth=!1,r._unlit=!1,r._debugMode=0,r.debugMode=0,r.debugLimit=-1,r.debugFactor=1,r.clearCoat=new Es(r._markAllSubMeshesAsTexturesDirty.bind(r)),r.anisotropy=new Ss(r._markAllSubMeshesAsTexturesDirty.bind(r)),r.brdf=new $I(r._markAllSubMeshesAsMiscDirty.bind(r)),r.sheen=new ol(r._markAllSubMeshesAsTexturesDirty.bind(r)),r.detailMap=new _h.a(r._markAllSubMeshesAsTexturesDirty.bind(r)),r._rebuildInParallel=!1,r._attachImageProcessingConfiguration(null),r.getRenderTargetTextures=function(){return r._renderTargets.reset(),bt.a.ReflectionTextureEnabled&&r._reflectionTexture&&r._reflectionTexture.isRenderTarget&&r._renderTargets.push(r._reflectionTexture),r.subSurface.fillRenderTargetTextures(r._renderTargets),r._renderTargets},r._environmentBRDFTexture=mh.GetEnvironmentBRDFTexture(n),r.subSurface=new al(r._markAllSubMeshesAsTexturesDirty.bind(r),r._markScenePrePassDirty.bind(r),n),r.prePassConfiguration=new Jp.a,r}return Object(p.d)(t,i),Object.defineProperty(t.prototype,"realTimeFiltering",{get:function(){return this._realTimeFiltering},set:function(e){this._realTimeFiltering=e,this.markAsDirty(g.a.MATERIAL_TextureDirtyFlag)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"realTimeFilteringQuality",{get:function(){return this._realTimeFilteringQuality},set:function(e){this._realTimeFilteringQuality=e,this.markAsDirty(g.a.MATERIAL_TextureDirtyFlag)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"canRenderToMRT",{get:function(){return!0},enumerable:!1,configurable:!0}),t.prototype._attachImageProcessingConfiguration=function(e){var n=this;e!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=e||this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add(function(){n._markAllSubMeshesAsImageProcessingDirty()})))},Object.defineProperty(t.prototype,"hasRenderTargetTextures",{get:function(){return!!(bt.a.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||this.subSurface.hasRenderTargetTextures()},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"PBRBaseMaterial"},Object.defineProperty(t.prototype,"useLogarithmicDepth",{get:function(){return this._useLogarithmicDepth},set:function(e){this._useLogarithmicDepth=e&&this.getScene().getEngine().getCaps().fragmentDepthSupported},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_disableAlphaBlending",{get:function(){return this.subSurface.disableAlphaBlending||this._transparencyMode===t.PBRMATERIAL_OPAQUE||this._transparencyMode===t.PBRMATERIAL_ALPHATEST},enumerable:!1,configurable:!0}),t.prototype.needAlphaBlending=function(){return!this._disableAlphaBlending&&(this.alpha<1||this._opacityTexture!=null||this._shouldUseAlphaFromAlbedoTexture())},t.prototype.needAlphaTesting=function(){return!!this._forceAlphaTest||!this.subSurface.disableAlphaBlending&&this._hasAlphaChannel()&&(this._transparencyMode==null||this._transparencyMode===t.PBRMATERIAL_ALPHATEST)},t.prototype._shouldUseAlphaFromAlbedoTexture=function(){return this._albedoTexture!=null&&this._albedoTexture.hasAlpha&&this._useAlphaFromAlbedoTexture&&this._transparencyMode!==t.PBRMATERIAL_OPAQUE},t.prototype._hasAlphaChannel=function(){return this._albedoTexture!=null&&this._albedoTexture.hasAlpha||this._opacityTexture!=null},t.prototype.getAlphaTestTexture=function(){return this._albedoTexture},t.prototype.isReadyForSubMesh=function(e,n,r){if(n.effect&&this.isFrozen&&n.effect._wasPreviouslyReady)return!0;n._materialDefines||(n._materialDefines=new em);var o=n._materialDefines;if(this._isReadyForSubMesh(n))return!0;var u=this.getScene(),f=u.getEngine();if(o._areTexturesDirty&&u.texturesEnabled){if(this._albedoTexture&&bt.a.DiffuseTextureEnabled&&!this._albedoTexture.isReadyOrNotBlocking()||this._ambientTexture&&bt.a.AmbientTextureEnabled&&!this._ambientTexture.isReadyOrNotBlocking()||this._opacityTexture&&bt.a.OpacityTextureEnabled&&!this._opacityTexture.isReadyOrNotBlocking())return!1;var v=this._getReflectionTexture();if(v&&bt.a.ReflectionTextureEnabled&&(!v.isReadyOrNotBlocking()||v.irradianceTexture&&!v.irradianceTexture.isReadyOrNotBlocking())||this._lightmapTexture&&bt.a.LightmapTextureEnabled&&!this._lightmapTexture.isReadyOrNotBlocking()||this._emissiveTexture&&bt.a.EmissiveTextureEnabled&&!this._emissiveTexture.isReadyOrNotBlocking())return!1;if(bt.a.SpecularTextureEnabled){if(this._metallicTexture){if(!this._metallicTexture.isReadyOrNotBlocking())return!1}else if(this._reflectivityTexture&&!this._reflectivityTexture.isReadyOrNotBlocking())return!1;if(this._metallicReflectanceTexture&&!this._metallicReflectanceTexture.isReadyOrNotBlocking()||this._microSurfaceTexture&&!this._microSurfaceTexture.isReadyOrNotBlocking())return!1}if(f.getCaps().standardDerivatives&&this._bumpTexture&&bt.a.BumpTextureEnabled&&!this._disableBumpMap&&!this._bumpTexture.isReady()||this._environmentBRDFTexture&&bt.a.ReflectionTextureEnabled&&!this._environmentBRDFTexture.isReady())return!1}if(!(this.subSurface.isReadyForSubMesh(o,u)&&this.clearCoat.isReadyForSubMesh(o,u,f,this._disableBumpMap)&&this.sheen.isReadyForSubMesh(o,u)&&this.anisotropy.isReadyForSubMesh(o,u)&&this.detailMap.isReadyForSubMesh(o,u))||o._areImageProcessingDirty&&this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady())return!1;f.getCaps().standardDerivatives||e.isVerticesDataPresent(De.b.NormalKind)||(e.createNormals(!0),_.a.Warn("PBRMaterial: Normals have been created for the mesh: "+e.name));var y=n.effect,D=o._areLightsDisposed,w=this._prepareEffect(e,o,this.onCompiled,this.onError,r,null,n.getRenderingMesh().hasThinInstances);if(w)if(this._onEffectCreatedObservable&&(xs.effect=w,xs.subMesh=n,this._onEffectCreatedObservable.notifyObservers(xs)),this.allowShaderHotSwapping&&y&&!w.isReady()){if(w=y,this._rebuildInParallel=!0,o.markAsUnprocessed(),D)return o._areLightsDisposed=!0,!1}else this._rebuildInParallel=!1,u.resetCachedMaterial(),n.setEffect(w,o),this.buildUniformLayout();return!(!n.effect||!n.effect.isReady())&&(o._renderId=u.getRenderId(),n.effect._wasPreviouslyReady=!0,!0)},t.prototype.isMetallicWorkflow=function(){return!(this._metallic==null&&this._roughness==null&&!this._metallicTexture)},t.prototype._prepareEffect=function(e,n,r,o,u,f,v){if(r===void 0&&(r=null),o===void 0&&(o=null),u===void 0&&(u=null),f===void 0&&(f=null),this._prepareDefines(e,n,u,f,v),!n.isDirty)return null;n.markAsProcessed();var y=this.getScene().getEngine(),D=new Ts.a,w=0;n.USESPHERICALINVERTEX&&D.addFallback(w++,"USESPHERICALINVERTEX"),n.FOG&&D.addFallback(w,"FOG"),n.SPECULARAA&&D.addFallback(w,"SPECULARAA"),n.POINTSIZE&&D.addFallback(w,"POINTSIZE"),n.LOGARITHMICDEPTH&&D.addFallback(w,"LOGARITHMICDEPTH"),n.PARALLAX&&D.addFallback(w,"PARALLAX"),n.PARALLAXOCCLUSION&&D.addFallback(w++,"PARALLAXOCCLUSION"),w=Ss.AddFallbacks(n,D,w),w=Ss.AddFallbacks(n,D,w),w=al.AddFallbacks(n,D,w),w=ol.AddFallbacks(n,D,w),n.ENVIRONMENTBRDF&&D.addFallback(w++,"ENVIRONMENTBRDF"),n.TANGENT&&D.addFallback(w++,"TANGENT"),n.BUMP&&D.addFallback(w++,"BUMP"),w=lt.a.HandleFallbacksForShadows(n,D,this._maxSimultaneousLights,w++),n.SPECULARTERM&&D.addFallback(w++,"SPECULARTERM"),n.USESPHERICALFROMREFLECTIONMAP&&D.addFallback(w++,"USESPHERICALFROMREFLECTIONMAP"),n.USEIRRADIANCEMAP&&D.addFallback(w++,"USEIRRADIANCEMAP"),n.LIGHTMAP&&D.addFallback(w++,"LIGHTMAP"),n.NORMAL&&D.addFallback(w++,"NORMAL"),n.AMBIENT&&D.addFallback(w++,"AMBIENT"),n.EMISSIVE&&D.addFallback(w++,"EMISSIVE"),n.VERTEXCOLOR&&D.addFallback(w++,"VERTEXCOLOR"),n.MORPHTARGETS&&D.addFallback(w++,"MORPHTARGETS"),n.MULTIVIEW&&D.addFallback(0,"MULTIVIEW");var F=[De.b.PositionKind];n.NORMAL&&F.push(De.b.NormalKind),n.TANGENT&&F.push(De.b.TangentKind),n.UV1&&F.push(De.b.UVKind),n.UV2&&F.push(De.b.UV2Kind),n.VERTEXCOLOR&&F.push(De.b.ColorKind),lt.a.PrepareAttributesForBones(F,e,n,D),lt.a.PrepareAttributesForInstances(F,n),lt.a.PrepareAttributesForMorphTargets(F,e,n);var z="pbr",k=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","vReflectivityColor","vMetallicReflectanceFactors","vEmissiveColor","visibility","vReflectionColor","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vReflectionPosition","vReflectionSize","vEmissiveInfos","vReflectivityInfos","vReflectionFilteringInfo","vMetallicReflectanceInfos","vMicroSurfaceSamplerInfos","vBumpInfos","vLightmapInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","albedoMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","reflectivityMatrix","normalMatrix","microSurfaceSamplerMatrix","bumpMatrix","lightmapMatrix","metallicReflectanceMatrix","vLightingIntensity","logarithmicDepthConstant","vSphericalX","vSphericalY","vSphericalZ","vSphericalXX_ZZ","vSphericalYY_ZZ","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vSphericalL00","vSphericalL1_1","vSphericalL10","vSphericalL11","vSphericalL2_2","vSphericalL2_1","vSphericalL20","vSphericalL21","vSphericalL22","vReflectionMicrosurfaceInfos","vTangentSpaceParams","boneTextureWidth","vDebugMode"],K=["albedoSampler","reflectivitySampler","ambientSampler","emissiveSampler","bumpSampler","lightmapSampler","opacitySampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh","irradianceSampler","microSurfaceSampler","environmentBrdfSampler","boneSampler","metallicReflectanceSampler"],oe=["Material","Scene"];_h.a.AddUniforms(k),_h.a.AddSamplers(K),al.AddUniforms(k),al.AddSamplers(K),Es.AddUniforms(k),Es.AddSamplers(K),Ss.AddUniforms(k),Ss.AddSamplers(K),ol.AddUniforms(k),ol.AddSamplers(K),Jp.a.AddUniforms(k),Jp.a.AddSamplers(k),fr.a&&(fr.a.PrepareUniforms(k,n),fr.a.PrepareSamplers(K,n)),lt.a.PrepareUniformsAndSamplersList({uniformsNames:k,uniformBuffersNames:oe,samplers:K,defines:n,maxSimultaneousLights:this._maxSimultaneousLights});var ae={};this.customShaderNameResolve&&(z=this.customShaderNameResolve(z,k,oe,K,n,F,ae));var ue=n.toString();return y.createEffect(z,{attributes:F,uniformsNames:k,uniformBuffersNames:oe,samplers:K,defines:ue,fallbacks:D,onCompiled:r,onError:o,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:n.NUM_MORPH_INFLUENCERS},processFinalCode:ae.processFinalCode,multiTarget:n.PREPASS},y)},t.prototype._prepareDefines=function(e,n,r,o,u){r===void 0&&(r=null),o===void 0&&(o=null),u===void 0&&(u=!1);var f=this.getScene(),v=f.getEngine();if(lt.a.PrepareDefinesForLights(f,e,n,!0,this._maxSimultaneousLights,this._disableLighting),n._needNormals=!0,lt.a.PrepareDefinesForMultiview(f,n),lt.a.PrepareDefinesForPrePass(f,n,this.canRenderToMRT),n.METALLICWORKFLOW=this.isMetallicWorkflow(),n._areTexturesDirty){if(n._needUVs=!1,f.texturesEnabled){f.getEngine().getCaps().textureLOD&&(n.LODBASEDMICROSFURACE=!0),this._albedoTexture&&bt.a.DiffuseTextureEnabled?(lt.a.PrepareDefinesForMergedUV(this._albedoTexture,n,"ALBEDO"),n.GAMMAALBEDO=this._albedoTexture.gammaSpace):n.ALBEDO=!1,this._ambientTexture&&bt.a.AmbientTextureEnabled?(lt.a.PrepareDefinesForMergedUV(this._ambientTexture,n,"AMBIENT"),n.AMBIENTINGRAYSCALE=this._useAmbientInGrayScale):n.AMBIENT=!1,this._opacityTexture&&bt.a.OpacityTextureEnabled?(lt.a.PrepareDefinesForMergedUV(this._opacityTexture,n,"OPACITY"),n.OPACITYRGB=this._opacityTexture.getAlphaFromRGB):n.OPACITY=!1;var y=this._getReflectionTexture();if(y&&bt.a.ReflectionTextureEnabled){switch(n.REFLECTION=!0,n.GAMMAREFLECTION=y.gammaSpace,n.RGBDREFLECTION=y.isRGBD,n.REFLECTIONMAP_OPPOSITEZ=this.getScene().useRightHandedSystem?!y.invertZ:y.invertZ,n.LODINREFLECTIONALPHA=y.lodLevelInAlpha,n.LINEARSPECULARREFLECTION=y.linearSpecularLOD,this.realTimeFiltering&&this.realTimeFilteringQuality>0?(n.NUM_SAMPLES=""+this.realTimeFilteringQuality,v.webGLVersion>1&&(n.NUM_SAMPLES=n.NUM_SAMPLES+"u"),n.REALTIME_FILTERING=!0):n.REALTIME_FILTERING=!1,y.coordinatesMode===ke.a.INVCUBIC_MODE&&(n.INVERTCUBICMAP=!0),n.REFLECTIONMAP_3D=y.isCube,n.REFLECTIONMAP_CUBIC=!1,n.REFLECTIONMAP_EXPLICIT=!1,n.REFLECTIONMAP_PLANAR=!1,n.REFLECTIONMAP_PROJECTION=!1,n.REFLECTIONMAP_SKYBOX=!1,n.REFLECTIONMAP_SPHERICAL=!1,n.REFLECTIONMAP_EQUIRECTANGULAR=!1,n.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,n.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,y.coordinatesMode){case ke.a.EXPLICIT_MODE:n.REFLECTIONMAP_EXPLICIT=!0;break;case ke.a.PLANAR_MODE:n.REFLECTIONMAP_PLANAR=!0;break;case ke.a.PROJECTION_MODE:n.REFLECTIONMAP_PROJECTION=!0;break;case ke.a.SKYBOX_MODE:n.REFLECTIONMAP_SKYBOX=!0;break;case ke.a.SPHERICAL_MODE:n.REFLECTIONMAP_SPHERICAL=!0;break;case ke.a.EQUIRECTANGULAR_MODE:n.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case ke.a.FIXED_EQUIRECTANGULAR_MODE:n.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case ke.a.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:n.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case ke.a.CUBIC_MODE:case ke.a.INVCUBIC_MODE:default:n.REFLECTIONMAP_CUBIC=!0,n.USE_LOCAL_REFLECTIONMAP_CUBIC=!!y.boundingBoxSize}y.coordinatesMode!==ke.a.SKYBOX_MODE&&(y.irradianceTexture?(n.USEIRRADIANCEMAP=!0,n.USESPHERICALFROMREFLECTIONMAP=!1):y.isCube&&(n.USESPHERICALFROMREFLECTIONMAP=!0,n.USEIRRADIANCEMAP=!1,this._forceIrradianceInFragment||this.realTimeFiltering||f.getEngine().getCaps().maxVaryingVectors<=8?n.USESPHERICALINVERTEX=!1:n.USESPHERICALINVERTEX=!0))}else n.REFLECTION=!1,n.REFLECTIONMAP_3D=!1,n.REFLECTIONMAP_SPHERICAL=!1,n.REFLECTIONMAP_PLANAR=!1,n.REFLECTIONMAP_CUBIC=!1,n.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,n.REFLECTIONMAP_PROJECTION=!1,n.REFLECTIONMAP_SKYBOX=!1,n.REFLECTIONMAP_EXPLICIT=!1,n.REFLECTIONMAP_EQUIRECTANGULAR=!1,n.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,n.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,n.INVERTCUBICMAP=!1,n.USESPHERICALFROMREFLECTIONMAP=!1,n.USEIRRADIANCEMAP=!1,n.USESPHERICALINVERTEX=!1,n.REFLECTIONMAP_OPPOSITEZ=!1,n.LODINREFLECTIONALPHA=!1,n.GAMMAREFLECTION=!1,n.RGBDREFLECTION=!1,n.LINEARSPECULARREFLECTION=!1;this._lightmapTexture&&bt.a.LightmapTextureEnabled?(lt.a.PrepareDefinesForMergedUV(this._lightmapTexture,n,"LIGHTMAP"),n.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,n.GAMMALIGHTMAP=this._lightmapTexture.gammaSpace,n.RGBDLIGHTMAP=this._lightmapTexture.isRGBD):n.LIGHTMAP=!1,this._emissiveTexture&&bt.a.EmissiveTextureEnabled?lt.a.PrepareDefinesForMergedUV(this._emissiveTexture,n,"EMISSIVE"):n.EMISSIVE=!1,bt.a.SpecularTextureEnabled?(this._metallicTexture?(lt.a.PrepareDefinesForMergedUV(this._metallicTexture,n,"REFLECTIVITY"),n.ROUGHNESSSTOREINMETALMAPALPHA=this._useRoughnessFromMetallicTextureAlpha,n.ROUGHNESSSTOREINMETALMAPGREEN=!this._useRoughnessFromMetallicTextureAlpha&&this._useRoughnessFromMetallicTextureGreen,n.METALLNESSSTOREINMETALMAPBLUE=this._useMetallnessFromMetallicTextureBlue,n.AOSTOREINMETALMAPRED=this._useAmbientOcclusionFromMetallicTextureRed):this._reflectivityTexture?(lt.a.PrepareDefinesForMergedUV(this._reflectivityTexture,n,"REFLECTIVITY"),n.MICROSURFACEFROMREFLECTIVITYMAP=this._useMicroSurfaceFromReflectivityMapAlpha,n.MICROSURFACEAUTOMATIC=this._useAutoMicroSurfaceFromReflectivityMap):n.REFLECTIVITY=!1,this._metallicReflectanceTexture?lt.a.PrepareDefinesForMergedUV(this._metallicReflectanceTexture,n,"METALLIC_REFLECTANCE"):n.METALLIC_REFLECTANCE=!1,this._microSurfaceTexture?lt.a.PrepareDefinesForMergedUV(this._microSurfaceTexture,n,"MICROSURFACEMAP"):n.MICROSURFACEMAP=!1):(n.REFLECTIVITY=!1,n.MICROSURFACEMAP=!1),f.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&bt.a.BumpTextureEnabled&&!this._disableBumpMap?(lt.a.PrepareDefinesForMergedUV(this._bumpTexture,n,"BUMP"),this._useParallax&&this._albedoTexture&&bt.a.DiffuseTextureEnabled?(n.PARALLAX=!0,n.PARALLAXOCCLUSION=!!this._useParallaxOcclusion):n.PARALLAX=!1,n.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap):n.BUMP=!1,this._environmentBRDFTexture&&bt.a.ReflectionTextureEnabled?(n.ENVIRONMENTBRDF=!0,n.ENVIRONMENTBRDF_RGBD=this._environmentBRDFTexture.isRGBD):(n.ENVIRONMENTBRDF=!1,n.ENVIRONMENTBRDF_RGBD=!1),this._shouldUseAlphaFromAlbedoTexture()?n.ALPHAFROMALBEDO=!0:n.ALPHAFROMALBEDO=!1}n.SPECULAROVERALPHA=this._useSpecularOverAlpha,this._lightFalloff===t.LIGHTFALLOFF_STANDARD?(n.USEPHYSICALLIGHTFALLOFF=!1,n.USEGLTFLIGHTFALLOFF=!1):this._lightFalloff===t.LIGHTFALLOFF_GLTF?(n.USEPHYSICALLIGHTFALLOFF=!1,n.USEGLTFLIGHTFALLOFF=!0):(n.USEPHYSICALLIGHTFALLOFF=!0,n.USEGLTFLIGHTFALLOFF=!1),n.RADIANCEOVERALPHA=this._useRadianceOverAlpha,!this.backFaceCulling&&this._twoSidedLighting?n.TWOSIDEDLIGHTING=!0:n.TWOSIDEDLIGHTING=!1,n.SPECULARAA=f.getEngine().getCaps().standardDerivatives&&this._enableSpecularAntiAliasing}(n._areTexturesDirty||n._areMiscDirty)&&(n.ALPHATESTVALUE=this._alphaCutOff+(this._alphaCutOff%1==0?".":""),n.PREMULTIPLYALPHA=this.alphaMode===g.a.ALPHA_PREMULTIPLIED||this.alphaMode===g.a.ALPHA_PREMULTIPLIED_PORTERDUFF,n.ALPHABLEND=this.needAlphaBlendingForMesh(e),n.ALPHAFRESNEL=this._useAlphaFresnel||this._useLinearAlphaFresnel,n.LINEARALPHAFRESNEL=this._useLinearAlphaFresnel),n._areImageProcessingDirty&&this._imageProcessingConfiguration&&this._imageProcessingConfiguration.prepareDefines(n),n.FORCENORMALFORWARD=this._forceNormalForward,n.RADIANCEOCCLUSION=this._useRadianceOcclusion,n.HORIZONOCCLUSION=this._useHorizonOcclusion,n._areMiscDirty&&(lt.a.PrepareDefinesForMisc(e,f,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(e)||this._forceAlphaTest,n),n.UNLIT=this._unlit||(this.pointsCloud||this.wireframe)&&!e.isVerticesDataPresent(De.b.NormalKind),n.DEBUGMODE=this._debugMode),this.detailMap.prepareDefines(n,f),this.subSurface.prepareDefines(n,f),this.clearCoat.prepareDefines(n,f),this.anisotropy.prepareDefines(n,e,f),this.brdf.prepareDefines(n),this.sheen.prepareDefines(n,f),lt.a.PrepareDefinesForFrameBoundValues(f,v,n,!!r,o,u),lt.a.PrepareDefinesForAttributes(e,n,!0,!0,!0,this._transparencyMode!==t.PBRMATERIAL_OPAQUE)},t.prototype.forceCompilation=function(e,n,r){var o=this,u=Object(p.a)({clipPlane:!1,useInstances:!1},r),f=new em,v=this._prepareEffect(e,f,void 0,void 0,u.useInstances,u.clipPlane,e.hasThinInstances);this._onEffectCreatedObservable&&(xs.effect=v,xs.subMesh=null,this._onEffectCreatedObservable.notifyObservers(xs)),v.isReady()?n&&n(this):v.onCompileObservable.add(function(){n&&n(o)})},t.prototype.buildUniformLayout=function(){var e=this._uniformBuffer;e.addUniform("vAlbedoInfos",2),e.addUniform("vAmbientInfos",4),e.addUniform("vOpacityInfos",2),e.addUniform("vEmissiveInfos",2),e.addUniform("vLightmapInfos",2),e.addUniform("vReflectivityInfos",3),e.addUniform("vMicroSurfaceSamplerInfos",2),e.addUniform("vReflectionInfos",2),e.addUniform("vReflectionFilteringInfo",2),e.addUniform("vReflectionPosition",3),e.addUniform("vReflectionSize",3),e.addUniform("vBumpInfos",3),e.addUniform("albedoMatrix",16),e.addUniform("ambientMatrix",16),e.addUniform("opacityMatrix",16),e.addUniform("emissiveMatrix",16),e.addUniform("lightmapMatrix",16),e.addUniform("reflectivityMatrix",16),e.addUniform("microSurfaceSamplerMatrix",16),e.addUniform("bumpMatrix",16),e.addUniform("vTangentSpaceParams",2),e.addUniform("reflectionMatrix",16),e.addUniform("vReflectionColor",3),e.addUniform("vAlbedoColor",4),e.addUniform("vLightingIntensity",4),e.addUniform("vReflectionMicrosurfaceInfos",3),e.addUniform("pointSize",1),e.addUniform("vReflectivityColor",4),e.addUniform("vEmissiveColor",3),e.addUniform("visibility",1),e.addUniform("vMetallicReflectanceFactors",4),e.addUniform("vMetallicReflectanceInfos",2),e.addUniform("metallicReflectanceMatrix",16),Es.PrepareUniformBuffer(e),Ss.PrepareUniformBuffer(e),ol.PrepareUniformBuffer(e),al.PrepareUniformBuffer(e),_h.a.PrepareUniformBuffer(e),e.create()},t.prototype.unbind=function(){if(this._activeEffect){var e=!1;this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&(this._activeEffect.setTexture("reflection2DSampler",null),e=!0),this.subSurface.unbind(this._activeEffect)&&(e=!0),e&&this._markAllSubMeshesAsTexturesDirty()}i.prototype.unbind.call(this)},t.prototype.bindForSubMesh=function(e,n,r){var o=this.getScene(),u=r._materialDefines;if(u){var f=r.effect;if(f){this._activeEffect=f,u.INSTANCES&&!u.THIN_INSTANCES||this.bindOnlyWorldMatrix(e),this.prePassConfiguration.bindForSubMesh(this._activeEffect,o,n,e,this.isFrozen),u.OBJECTSPACE_NORMALMAP&&(e.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));var v=this._mustRebind(o,f,n.visibility);lt.a.BindBonesParameters(n,this._activeEffect,this.prePassConfiguration);var y=null,D=this._uniformBuffer;if(v){var w=o.getEngine();if(D.bindToEffect(f,"Material"),this.bindViewProjection(f),y=this._getReflectionTexture(),!D.useUbo||!this.isFrozen||!D.isSync){if(o.texturesEnabled){if(this._albedoTexture&&bt.a.DiffuseTextureEnabled&&(D.updateFloat2("vAlbedoInfos",this._albedoTexture.coordinatesIndex,this._albedoTexture.level),lt.a.BindTextureMatrix(this._albedoTexture,D,"albedo")),this._ambientTexture&&bt.a.AmbientTextureEnabled&&(D.updateFloat4("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level,this._ambientTextureStrength,this._ambientTextureImpactOnAnalyticalLights),lt.a.BindTextureMatrix(this._ambientTexture,D,"ambient")),this._opacityTexture&&bt.a.OpacityTextureEnabled&&(D.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),lt.a.BindTextureMatrix(this._opacityTexture,D,"opacity")),y&&bt.a.ReflectionTextureEnabled){if(D.updateMatrix("reflectionMatrix",y.getReflectionTextureMatrix()),D.updateFloat2("vReflectionInfos",y.level,0),y.boundingBoxSize){var F=y;D.updateVector3("vReflectionPosition",F.boundingBoxPosition),D.updateVector3("vReflectionSize",F.boundingBoxSize)}if(this.realTimeFiltering){var z=y.getSize().width;D.updateFloat2("vReflectionFilteringInfo",z,te.a.Log2(z))}if(!u.USEIRRADIANCEMAP){var k=y.sphericalPolynomial;if(u.USESPHERICALFROMREFLECTIONMAP&&k)if(u.SPHERICAL_HARMONICS){var K=k.preScaledHarmonics;this._activeEffect.setVector3("vSphericalL00",K.l00),this._activeEffect.setVector3("vSphericalL1_1",K.l1_1),this._activeEffect.setVector3("vSphericalL10",K.l10),this._activeEffect.setVector3("vSphericalL11",K.l11),this._activeEffect.setVector3("vSphericalL2_2",K.l2_2),this._activeEffect.setVector3("vSphericalL2_1",K.l2_1),this._activeEffect.setVector3("vSphericalL20",K.l20),this._activeEffect.setVector3("vSphericalL21",K.l21),this._activeEffect.setVector3("vSphericalL22",K.l22)}else this._activeEffect.setFloat3("vSphericalX",k.x.x,k.x.y,k.x.z),this._activeEffect.setFloat3("vSphericalY",k.y.x,k.y.y,k.y.z),this._activeEffect.setFloat3("vSphericalZ",k.z.x,k.z.y,k.z.z),this._activeEffect.setFloat3("vSphericalXX_ZZ",k.xx.x-k.zz.x,k.xx.y-k.zz.y,k.xx.z-k.zz.z),this._activeEffect.setFloat3("vSphericalYY_ZZ",k.yy.x-k.zz.x,k.yy.y-k.zz.y,k.yy.z-k.zz.z),this._activeEffect.setFloat3("vSphericalZZ",k.zz.x,k.zz.y,k.zz.z),this._activeEffect.setFloat3("vSphericalXY",k.xy.x,k.xy.y,k.xy.z),this._activeEffect.setFloat3("vSphericalYZ",k.yz.x,k.yz.y,k.yz.z),this._activeEffect.setFloat3("vSphericalZX",k.zx.x,k.zx.y,k.zx.z)}D.updateFloat3("vReflectionMicrosurfaceInfos",y.getSize().width,y.lodGenerationScale,y.lodGenerationOffset)}this._emissiveTexture&&bt.a.EmissiveTextureEnabled&&(D.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),lt.a.BindTextureMatrix(this._emissiveTexture,D,"emissive")),this._lightmapTexture&&bt.a.LightmapTextureEnabled&&(D.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),lt.a.BindTextureMatrix(this._lightmapTexture,D,"lightmap")),bt.a.SpecularTextureEnabled&&(this._metallicTexture?(D.updateFloat3("vReflectivityInfos",this._metallicTexture.coordinatesIndex,this._metallicTexture.level,this._ambientTextureStrength),lt.a.BindTextureMatrix(this._metallicTexture,D,"reflectivity")):this._reflectivityTexture&&(D.updateFloat3("vReflectivityInfos",this._reflectivityTexture.coordinatesIndex,this._reflectivityTexture.level,1),lt.a.BindTextureMatrix(this._reflectivityTexture,D,"reflectivity")),this._metallicReflectanceTexture&&(D.updateFloat2("vMetallicReflectanceInfos",this._metallicReflectanceTexture.coordinatesIndex,this._metallicReflectanceTexture.level),lt.a.BindTextureMatrix(this._metallicReflectanceTexture,D,"metallicReflectance")),this._microSurfaceTexture&&(D.updateFloat2("vMicroSurfaceSamplerInfos",this._microSurfaceTexture.coordinatesIndex,this._microSurfaceTexture.level),lt.a.BindTextureMatrix(this._microSurfaceTexture,D,"microSurfaceSampler"))),this._bumpTexture&&w.getCaps().standardDerivatives&&bt.a.BumpTextureEnabled&&!this._disableBumpMap&&(D.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level,this._parallaxScaleBias),lt.a.BindTextureMatrix(this._bumpTexture,D,"bump"),o._mirroredCameraPosition?D.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):D.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1))}if(this.pointsCloud&&D.updateFloat("pointSize",this.pointSize),u.METALLICWORKFLOW){M.c.Color3[0].r=this._metallic===void 0||this._metallic===null?1:this._metallic,M.c.Color3[0].g=this._roughness===void 0||this._roughness===null?1:this._roughness,D.updateColor4("vReflectivityColor",M.c.Color3[0],1);var oe=this.subSurface.indexOfRefraction,ae=Math.pow((oe-1)/(oe+1),2);this._metallicReflectanceColor.scaleToRef(ae*this._metallicF0Factor,M.c.Color3[0]);var ue=this._metallicF0Factor;D.updateColor4("vMetallicReflectanceFactors",M.c.Color3[0],ue)}else D.updateColor4("vReflectivityColor",this._reflectivityColor,this._microSurface);D.updateColor3("vEmissiveColor",bt.a.EmissiveTextureEnabled?this._emissiveColor:M.a.BlackReadOnly),D.updateColor3("vReflectionColor",this._reflectionColor),!u.SS_REFRACTION&&this.subSurface.linkRefractionWithTransparency?D.updateColor4("vAlbedoColor",this._albedoColor,1):D.updateColor4("vAlbedoColor",this._albedoColor,this.alpha),this._lightingInfos.x=this._directIntensity,this._lightingInfos.y=this._emissiveIntensity,this._lightingInfos.z=this._environmentIntensity*o.environmentIntensity,this._lightingInfos.w=this._specularIntensity,D.updateVector4("vLightingIntensity",this._lightingInfos)}D.updateFloat("visibility",n.visibility),o.texturesEnabled&&(this._albedoTexture&&bt.a.DiffuseTextureEnabled&&D.setTexture("albedoSampler",this._albedoTexture),this._ambientTexture&&bt.a.AmbientTextureEnabled&&D.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&bt.a.OpacityTextureEnabled&&D.setTexture("opacitySampler",this._opacityTexture),y&&bt.a.ReflectionTextureEnabled&&(u.LODBASEDMICROSFURACE?D.setTexture("reflectionSampler",y):(D.setTexture("reflectionSampler",y._lodTextureMid||y),D.setTexture("reflectionSamplerLow",y._lodTextureLow||y),D.setTexture("reflectionSamplerHigh",y._lodTextureHigh||y)),u.USEIRRADIANCEMAP&&D.setTexture("irradianceSampler",y.irradianceTexture)),u.ENVIRONMENTBRDF&&D.setTexture("environmentBrdfSampler",this._environmentBRDFTexture),this._emissiveTexture&&bt.a.EmissiveTextureEnabled&&D.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&bt.a.LightmapTextureEnabled&&D.setTexture("lightmapSampler",this._lightmapTexture),bt.a.SpecularTextureEnabled&&(this._metallicTexture?D.setTexture("reflectivitySampler",this._metallicTexture):this._reflectivityTexture&&D.setTexture("reflectivitySampler",this._reflectivityTexture),this._metallicReflectanceTexture&&D.setTexture("metallicReflectanceSampler",this._metallicReflectanceTexture),this._microSurfaceTexture&&D.setTexture("microSurfaceSampler",this._microSurfaceTexture)),this._bumpTexture&&w.getCaps().standardDerivatives&&bt.a.BumpTextureEnabled&&!this._disableBumpMap&&D.setTexture("bumpSampler",this._bumpTexture)),this.detailMap.bindForSubMesh(D,o,this.isFrozen),this.subSurface.bindForSubMesh(D,o,w,this.isFrozen,u.LODBASEDMICROSFURACE,this.realTimeFiltering),this.clearCoat.bindForSubMesh(D,o,w,this._disableBumpMap,this.isFrozen,this._invertNormalMapX,this._invertNormalMapY,r),this.anisotropy.bindForSubMesh(D,o,this.isFrozen),this.sheen.bindForSubMesh(D,o,this.isFrozen,r),lt.a.BindClipPlane(this._activeEffect,o),o.ambientColor.multiplyToRef(this._ambientColor,this._globalAmbientColor);var de=o._forcedViewPosition?o._forcedViewPosition:o._mirroredCameraPosition?o._mirroredCameraPosition:o.activeCamera.globalPosition,me=o.useRightHandedSystem===(o._mirroredCameraPosition!=null);f.setFloat4("vEyePosition",de.x,de.y,de.z,me?-1:1),f.setColor3("vAmbientColor",this._globalAmbientColor),f.setFloat2("vDebugMode",this.debugLimit,this.debugFactor)}!v&&this.isFrozen||(o.lightsEnabled&&!this._disableLighting&&lt.a.BindLights(o,n,this._activeEffect,u,this._maxSimultaneousLights,this._rebuildInParallel),(o.fogEnabled&&n.applyFog&&o.fogMode!==he.a.FOGMODE_NONE||y)&&this.bindView(f),lt.a.BindFogParameters(o,n,this._activeEffect,!0),u.NUM_MORPH_INFLUENCERS&&lt.a.BindMorphTargetParameters(n,this._activeEffect),this._imageProcessingConfiguration.bind(this._activeEffect),lt.a.BindLogDepth(u,this._activeEffect,o)),D.update(),this._afterBind(n,this._activeEffect)}}},t.prototype.getAnimatables=function(){var e=[];return this._albedoTexture&&this._albedoTexture.animations&&this._albedoTexture.animations.length>0&&e.push(this._albedoTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&e.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&e.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&e.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&e.push(this._emissiveTexture),this._metallicTexture&&this._metallicTexture.animations&&this._metallicTexture.animations.length>0?e.push(this._metallicTexture):this._reflectivityTexture&&this._reflectivityTexture.animations&&this._reflectivityTexture.animations.length>0&&e.push(this._reflectivityTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&e.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&e.push(this._lightmapTexture),this.detailMap.getAnimatables(e),this.subSurface.getAnimatables(e),this.clearCoat.getAnimatables(e),this.sheen.getAnimatables(e),this.anisotropy.getAnimatables(e),e},t.prototype._getReflectionTexture=function(){return this._reflectionTexture?this._reflectionTexture:this.getScene().environmentTexture},t.prototype.getActiveTextures=function(){var e=i.prototype.getActiveTextures.call(this);return this._albedoTexture&&e.push(this._albedoTexture),this._ambientTexture&&e.push(this._ambientTexture),this._opacityTexture&&e.push(this._opacityTexture),this._reflectionTexture&&e.push(this._reflectionTexture),this._emissiveTexture&&e.push(this._emissiveTexture),this._reflectivityTexture&&e.push(this._reflectivityTexture),this._metallicTexture&&e.push(this._metallicTexture),this._metallicReflectanceTexture&&e.push(this._metallicReflectanceTexture),this._microSurfaceTexture&&e.push(this._microSurfaceTexture),this._bumpTexture&&e.push(this._bumpTexture),this._lightmapTexture&&e.push(this._lightmapTexture),this.detailMap.getActiveTextures(e),this.subSurface.getActiveTextures(e),this.clearCoat.getActiveTextures(e),this.sheen.getActiveTextures(e),this.anisotropy.getActiveTextures(e),e},t.prototype.hasTexture=function(e){return!!i.prototype.hasTexture.call(this,e)||this._albedoTexture===e||this._ambientTexture===e||this._opacityTexture===e||this._reflectionTexture===e||this._reflectivityTexture===e||this._metallicTexture===e||this._metallicReflectanceTexture===e||this._microSurfaceTexture===e||this._bumpTexture===e||this._lightmapTexture===e||this.detailMap.hasTexture(e)||this.subSurface.hasTexture(e)||this.clearCoat.hasTexture(e)||this.sheen.hasTexture(e)||this.anisotropy.hasTexture(e)},t.prototype.setPrePassRenderer=function(e){if(this.subSurface.isScatteringEnabled){var n=this.getScene().enableSubSurfaceForPrePass();return n&&(n.enabled=!0),!0}return!1},t.prototype.dispose=function(e,n){var r,o,u,f,v,y,D,w,F,z,k;n&&(this._environmentBRDFTexture&&this.getScene().environmentBRDFTexture!==this._environmentBRDFTexture&&this._environmentBRDFTexture.dispose(),(r=this._albedoTexture)===null||r===void 0||r.dispose(),(o=this._ambientTexture)===null||o===void 0||o.dispose(),(u=this._opacityTexture)===null||u===void 0||u.dispose(),(f=this._reflectionTexture)===null||f===void 0||f.dispose(),(v=this._emissiveTexture)===null||v===void 0||v.dispose(),(y=this._metallicTexture)===null||y===void 0||y.dispose(),(D=this._reflectivityTexture)===null||D===void 0||D.dispose(),(w=this._bumpTexture)===null||w===void 0||w.dispose(),(F=this._lightmapTexture)===null||F===void 0||F.dispose(),(z=this._metallicReflectanceTexture)===null||z===void 0||z.dispose(),(k=this._microSurfaceTexture)===null||k===void 0||k.dispose()),this.detailMap.dispose(n),this.subSurface.dispose(n),this.clearCoat.dispose(n),this.sheen.dispose(n),this.anisotropy.dispose(n),this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),i.prototype.dispose.call(this,e,n)},t.PBRMATERIAL_OPAQUE=pn.a.MATERIAL_OPAQUE,t.PBRMATERIAL_ALPHATEST=pn.a.MATERIAL_ALPHATEST,t.PBRMATERIAL_ALPHABLEND=pn.a.MATERIAL_ALPHABLEND,t.PBRMATERIAL_ALPHATESTANDBLEND=pn.a.MATERIAL_ALPHATESTANDBLEND,t.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=0,t.LIGHTFALLOFF_PHYSICAL=0,t.LIGHTFALLOFF_GLTF=1,t.LIGHTFALLOFF_STANDARD=2,Object(p.c)([Object(B.i)()],t.prototype,"_imageProcessingConfiguration",void 0),Object(p.c)([Object(B.b)("_markAllSubMeshesAsMiscDirty")],t.prototype,"debugMode",void 0),Object(p.c)([Object(B.c)()],t.prototype,"useLogarithmicDepth",null),t}(ph.a),sl=function(i){function t(e,n){var r=i.call(this,e,n)||this;return r.directIntensity=1,r.emissiveIntensity=1,r.environmentIntensity=1,r.specularIntensity=1,r.disableBumpMap=!1,r.ambientTextureStrength=1,r.ambientTextureImpactOnAnalyticalLights=t.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,r.metallicF0Factor=1,r.metallicReflectanceColor=M.a.White(),r.ambientColor=new M.a(0,0,0),r.albedoColor=new M.a(1,1,1),r.reflectivityColor=new M.a(1,1,1),r.reflectionColor=new M.a(1,1,1),r.emissiveColor=new M.a(0,0,0),r.microSurface=1,r.useLightmapAsShadowmap=!1,r.useAlphaFromAlbedoTexture=!1,r.forceAlphaTest=!1,r.alphaCutOff=.4,r.useSpecularOverAlpha=!0,r.useMicroSurfaceFromReflectivityMapAlpha=!1,r.useRoughnessFromMetallicTextureAlpha=!0,r.useRoughnessFromMetallicTextureGreen=!1,r.useMetallnessFromMetallicTextureBlue=!1,r.useAmbientOcclusionFromMetallicTextureRed=!1,r.useAmbientInGrayScale=!1,r.useAutoMicroSurfaceFromReflectivityMap=!1,r.useRadianceOverAlpha=!0,r.useObjectSpaceNormalMap=!1,r.useParallax=!1,r.useParallaxOcclusion=!1,r.parallaxScaleBias=.05,r.disableLighting=!1,r.forceIrradianceInFragment=!1,r.maxSimultaneousLights=4,r.invertNormalMapX=!1,r.invertNormalMapY=!1,r.twoSidedLighting=!1,r.useAlphaFresnel=!1,r.useLinearAlphaFresnel=!1,r.environmentBRDFTexture=null,r.forceNormalForward=!1,r.enableSpecularAntiAliasing=!1,r.useHorizonOcclusion=!0,r.useRadianceOcclusion=!0,r.unlit=!1,r._environmentBRDFTexture=mh.GetEnvironmentBRDFTexture(n),r}return Object(p.d)(t,i),Object.defineProperty(t.prototype,"refractionTexture",{get:function(){return this.subSurface.refractionTexture},set:function(e){this.subSurface.refractionTexture=e,e?this.subSurface.isRefractionEnabled=!0:this.subSurface.linkRefractionWithTransparency||(this.subSurface.isRefractionEnabled=!1)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"indexOfRefraction",{get:function(){return this.subSurface.indexOfRefraction},set:function(e){this.subSurface.indexOfRefraction=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"invertRefractionY",{get:function(){return this.subSurface.invertRefractionY},set:function(e){this.subSurface.invertRefractionY=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"linkRefractionWithTransparency",{get:function(){return this.subSurface.linkRefractionWithTransparency},set:function(e){this.subSurface.linkRefractionWithTransparency=e,e&&(this.subSurface.isRefractionEnabled=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"usePhysicalLightFalloff",{get:function(){return this._lightFalloff===nr.LIGHTFALLOFF_PHYSICAL},set:function(e){e!==this.usePhysicalLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=e?nr.LIGHTFALLOFF_PHYSICAL:nr.LIGHTFALLOFF_STANDARD)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"useGLTFLightFalloff",{get:function(){return this._lightFalloff===nr.LIGHTFALLOFF_GLTF},set:function(e){e!==this.useGLTFLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=e?nr.LIGHTFALLOFF_GLTF:nr.LIGHTFALLOFF_STANDARD)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(e){this._attachImageProcessingConfiguration(e),this._markAllSubMeshesAsTexturesDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraColorCurvesEnabled",{get:function(){return this.imageProcessingConfiguration.colorCurvesEnabled},set:function(e){this.imageProcessingConfiguration.colorCurvesEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraColorGradingEnabled",{get:function(){return this.imageProcessingConfiguration.colorGradingEnabled},set:function(e){this.imageProcessingConfiguration.colorGradingEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraToneMappingEnabled",{get:function(){return this._imageProcessingConfiguration.toneMappingEnabled},set:function(e){this._imageProcessingConfiguration.toneMappingEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraExposure",{get:function(){return this._imageProcessingConfiguration.exposure},set:function(e){this._imageProcessingConfiguration.exposure=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraContrast",{get:function(){return this._imageProcessingConfiguration.contrast},set:function(e){this._imageProcessingConfiguration.contrast=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraColorGradingTexture",{get:function(){return this._imageProcessingConfiguration.colorGradingTexture},set:function(e){this._imageProcessingConfiguration.colorGradingTexture=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraColorCurves",{get:function(){return this._imageProcessingConfiguration.colorCurves},set:function(e){this._imageProcessingConfiguration.colorCurves=e},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"PBRMaterial"},t.prototype.clone=function(e){var n=this,r=B.a.Clone(function(){return new t(e,n.getScene())},this);return r.id=e,r.name=e,this.clearCoat.copyTo(r.clearCoat),this.anisotropy.copyTo(r.anisotropy),this.brdf.copyTo(r.brdf),this.sheen.copyTo(r.sheen),this.subSurface.copyTo(r.subSurface),r},t.prototype.serialize=function(){var e=B.a.Serialize(this);return e.customType="BABYLON.PBRMaterial",e.clearCoat=this.clearCoat.serialize(),e.anisotropy=this.anisotropy.serialize(),e.brdf=this.brdf.serialize(),e.sheen=this.sheen.serialize(),e.subSurface=this.subSurface.serialize(),e},t.Parse=function(e,n,r){var o=B.a.Parse(function(){return new t(e.name,n)},e,n,r);return e.clearCoat&&o.clearCoat.parse(e.clearCoat,n,r),e.anisotropy&&o.anisotropy.parse(e.anisotropy,n,r),e.brdf&&o.brdf.parse(e.brdf,n,r),e.sheen&&o.sheen.parse(e.sheen,n,r),e.subSurface&&o.subSurface.parse(e.subSurface,n,r),o},t.PBRMATERIAL_OPAQUE=nr.PBRMATERIAL_OPAQUE,t.PBRMATERIAL_ALPHATEST=nr.PBRMATERIAL_ALPHATEST,t.PBRMATERIAL_ALPHABLEND=nr.PBRMATERIAL_ALPHABLEND,t.PBRMATERIAL_ALPHATESTANDBLEND=nr.PBRMATERIAL_ALPHATESTANDBLEND,t.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=nr.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"directIntensity",void 0),Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"emissiveIntensity",void 0),Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"environmentIntensity",void 0),Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"specularIntensity",void 0),Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"disableBumpMap",void 0),Object(p.c)([Object(B.m)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"albedoTexture",void 0),Object(p.c)([Object(B.m)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"ambientTexture",void 0),Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"ambientTextureStrength",void 0),Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"ambientTextureImpactOnAnalyticalLights",void 0),Object(p.c)([Object(B.m)(),Object(B.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],t.prototype,"opacityTexture",void 0),Object(p.c)([Object(B.m)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectionTexture",void 0),Object(p.c)([Object(B.m)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"emissiveTexture",void 0),Object(p.c)([Object(B.m)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectivityTexture",void 0),Object(p.c)([Object(B.m)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"metallicTexture",void 0),Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"metallic",void 0),Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"roughness",void 0),Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"metallicF0Factor",void 0),Object(p.c)([Object(B.e)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"metallicReflectanceColor",void 0),Object(p.c)([Object(B.m)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"metallicReflectanceTexture",void 0),Object(p.c)([Object(B.m)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"microSurfaceTexture",void 0),Object(p.c)([Object(B.m)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"bumpTexture",void 0),Object(p.c)([Object(B.m)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty",null)],t.prototype,"lightmapTexture",void 0),Object(p.c)([Object(B.e)("ambient"),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"ambientColor",void 0),Object(p.c)([Object(B.e)("albedo"),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"albedoColor",void 0),Object(p.c)([Object(B.e)("reflectivity"),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectivityColor",void 0),Object(p.c)([Object(B.e)("reflection"),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectionColor",void 0),Object(p.c)([Object(B.e)("emissive"),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"emissiveColor",void 0),Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"microSurface",void 0),Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useLightmapAsShadowmap",void 0),Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],t.prototype,"useAlphaFromAlbedoTexture",void 0),Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],t.prototype,"forceAlphaTest",void 0),Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],t.prototype,"alphaCutOff",void 0),Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useSpecularOverAlpha",void 0),Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0),Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useRoughnessFromMetallicTextureAlpha",void 0),Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useRoughnessFromMetallicTextureGreen",void 0),Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useMetallnessFromMetallicTextureBlue",void 0),Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useAmbientOcclusionFromMetallicTextureRed",void 0),Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useAmbientInGrayScale",void 0),Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0),Object(p.c)([Object(B.c)()],t.prototype,"usePhysicalLightFalloff",null),Object(p.c)([Object(B.c)()],t.prototype,"useGLTFLightFalloff",null),Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useRadianceOverAlpha",void 0),Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useObjectSpaceNormalMap",void 0),Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useParallax",void 0),Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useParallaxOcclusion",void 0),Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"parallaxScaleBias",void 0),Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsLightsDirty")],t.prototype,"disableLighting",void 0),Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"forceIrradianceInFragment",void 0),Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsLightsDirty")],t.prototype,"maxSimultaneousLights",void 0),Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"invertNormalMapX",void 0),Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"invertNormalMapY",void 0),Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"twoSidedLighting",void 0),Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useAlphaFresnel",void 0),Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useLinearAlphaFresnel",void 0),Object(p.c)([Object(B.m)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"environmentBRDFTexture",void 0),Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"forceNormalForward",void 0),Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"enableSpecularAntiAliasing",void 0),Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useHorizonOcclusion",void 0),Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useRadianceOcclusion",void 0),Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsMiscDirty")],t.prototype,"unlit",void 0),t}(nr);C.a.RegisteredTypes["BABYLON.PBRMaterial"]=sl;function gh(i){return i.charCodeAt(0)+(i.charCodeAt(1)<<8)+(i.charCodeAt(2)<<16)+(i.charCodeAt(3)<<24)}var t0=gh("DXT1"),n0=gh("DXT3"),r0=gh("DXT5"),tm=gh("DX10"),Xo=function(){function i(){}return i.GetDDSInfo=function(t){var e=new Int32Array(t.buffer,t.byteOffset,31),n=new Int32Array(t.buffer,t.byteOffset,35),r=1;131072&e[2]&&(r=Math.max(1,e[7]));var o=e[21],u=o===tm?n[32]:0,f=g.a.TEXTURETYPE_UNSIGNED_INT;switch(o){case 113:f=g.a.TEXTURETYPE_HALF_FLOAT;break;case 116:f=g.a.TEXTURETYPE_FLOAT;break;case tm:if(u===10){f=g.a.TEXTURETYPE_HALF_FLOAT;break}if(u===2){f=g.a.TEXTURETYPE_FLOAT;break}}return{width:e[4],height:e[3],mipmapCount:r,isFourCC:(4&e[20])==4,isRGB:(64&e[20])==64,isLuminance:(131072&e[20])==131072,isCube:(512&e[28])==512,isCompressed:o===t0||o===n0||o===r0,dxgiFormat:u,textureType:f}},i._ToHalfFloat=function(t){i._FloatView||(i._FloatView=new Float32Array(1),i._Int32View=new Int32Array(i._FloatView.buffer)),i._FloatView[0]=t;var e=i._Int32View[0],n=e>>16&32768,r=e>>12&2047,o=e>>23&255;return o<103?n:o>142?(n|=31744,n|=(o==255?0:1)&&8388607&e):o<113?n|=((r|=2048)>>114-o)+(r>>113-o&1):(n|=o-112<<10|r>>1,n+=1&r)},i._FromHalfFloat=function(t){var e=(32768&t)>>15,n=(31744&t)>>10,r=1023&t;return n===0?(e?-1:1)*Math.pow(2,-14)*(r/Math.pow(2,10)):n==31?r?NaN:1/0*(e?-1:1):(e?-1:1)*Math.pow(2,n-15)*(1+r/Math.pow(2,10))},i._GetHalfFloatAsFloatRGBAArrayBuffer=function(t,e,n,r,o,u){for(var f=new Float32Array(r),v=new Uint16Array(o,n),y=0,D=0;D<e;D++)for(var w=0;w<t;w++){var F=4*(w+D*t);f[y]=i._FromHalfFloat(v[F]),f[y+1]=i._FromHalfFloat(v[F+1]),f[y+2]=i._FromHalfFloat(v[F+2]),i.StoreLODInAlphaChannel?f[y+3]=u:f[y+3]=i._FromHalfFloat(v[F+3]),y+=4}return f},i._GetHalfFloatRGBAArrayBuffer=function(t,e,n,r,o,u){if(i.StoreLODInAlphaChannel){for(var f=new Uint16Array(r),v=new Uint16Array(o,n),y=0,D=0;D<e;D++)for(var w=0;w<t;w++){var F=4*(w+D*t);f[y]=v[F],f[y+1]=v[F+1],f[y+2]=v[F+2],f[y+3]=i._ToHalfFloat(u),y+=4}return f}return new Uint16Array(o,n,r)},i._GetFloatRGBAArrayBuffer=function(t,e,n,r,o,u){if(i.StoreLODInAlphaChannel){for(var f=new Float32Array(r),v=new Float32Array(o,n),y=0,D=0;D<e;D++)for(var w=0;w<t;w++){var F=4*(w+D*t);f[y]=v[F],f[y+1]=v[F+1],f[y+2]=v[F+2],f[y+3]=u,y+=4}return f}return new Float32Array(o,n,r)},i._GetFloatAsUIntRGBAArrayBuffer=function(t,e,n,r,o,u){for(var f=new Uint8Array(r),v=new Float32Array(o,n),y=0,D=0;D<e;D++)for(var w=0;w<t;w++){var F=4*(w+D*t);f[y]=255*te.a.Clamp(v[F]),f[y+1]=255*te.a.Clamp(v[F+1]),f[y+2]=255*te.a.Clamp(v[F+2]),i.StoreLODInAlphaChannel?f[y+3]=u:f[y+3]=255*te.a.Clamp(v[F+3]),y+=4}return f},i._GetHalfFloatAsUIntRGBAArrayBuffer=function(t,e,n,r,o,u){for(var f=new Uint8Array(r),v=new Uint16Array(o,n),y=0,D=0;D<e;D++)for(var w=0;w<t;w++){var F=4*(w+D*t);f[y]=255*te.a.Clamp(i._FromHalfFloat(v[F])),f[y+1]=255*te.a.Clamp(i._FromHalfFloat(v[F+1])),f[y+2]=255*te.a.Clamp(i._FromHalfFloat(v[F+2])),i.StoreLODInAlphaChannel?f[y+3]=u:f[y+3]=255*te.a.Clamp(i._FromHalfFloat(v[F+3])),y+=4}return f},i._GetRGBAArrayBuffer=function(t,e,n,r,o,u,f,v,y){for(var D=new Uint8Array(r),w=new Uint8Array(o,n),F=0,z=0;z<e;z++)for(var k=0;k<t;k++){var K=4*(k+z*t);D[F]=w[K+u],D[F+1]=w[K+f],D[F+2]=w[K+v],D[F+3]=w[K+y],F+=4}return D},i._ExtractLongWordOrder=function(t){return t===0||t===255||t===-16777216?0:1+i._ExtractLongWordOrder(t>>8)},i._GetRGBArrayBuffer=function(t,e,n,r,o,u,f,v){for(var y=new Uint8Array(r),D=new Uint8Array(o,n),w=0,F=0;F<e;F++)for(var z=0;z<t;z++){var k=3*(z+F*t);y[w]=D[k+u],y[w+1]=D[k+f],y[w+2]=D[k+v],w+=3}return y},i._GetLuminanceArrayBuffer=function(t,e,n,r,o){for(var u=new Uint8Array(r),f=new Uint8Array(o,n),v=0,y=0;y<e;y++)for(var D=0;D<t;D++){var w=D+y*t;u[v]=f[w],v++}return u},i.UploadDDSLevels=function(t,e,n,r,o,u,f,v){f===void 0&&(f=-1);var y=null;r.sphericalPolynomial&&(y=new Array);var D,w,F,z,k,K,oe,ae=t.getCaps().s3tc,ue=new Int32Array(n.buffer,n.byteOffset,31),de=0,me=0,ye=1;if(ue[0]===542327876)if(r.isFourCC||r.isRGB||r.isLuminance)if(!r.isCompressed||ae){var Ee=ue[22];z=ue[1]+4;var Ae,Ie=!1;if(r.isFourCC)switch(D=ue[21]){case t0:ye=8,me=ae.COMPRESSED_RGBA_S3TC_DXT1_EXT;break;case n0:ye=16,me=ae.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case r0:ye=16,me=ae.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;case 113:case 116:Ie=!0;break;case tm:z+=20;var Re=!1;switch(r.dxgiFormat){case 10:case 2:Ie=!0,Re=!0;break;case 88:r.isRGB=!0,r.isFourCC=!1,Ee=32,Re=!0}if(Re)break;default:return void console.error("Unsupported FourCC code:",(Ae=D,String.fromCharCode(255&Ae,Ae>>8&255,Ae>>16&255,Ae>>24&255)))}var Pe=i._ExtractLongWordOrder(ue[23]),Ce=i._ExtractLongWordOrder(ue[24]),Be=i._ExtractLongWordOrder(ue[25]),Oe=i._ExtractLongWordOrder(ue[26]);Ie&&(me=t._getRGBABufferInternalSizedFormat(r.textureType)),K=1,131072&ue[2]&&o!==!1&&(K=Math.max(1,ue[7]));for(var Ve=v||0;Ve<u;Ve++){for(w=ue[4],F=ue[3],oe=0;oe<K;++oe){if(f===-1||f===oe){var Le=f===-1?oe:0;if(!r.isCompressed&&r.isFourCC){e.format=g.a.TEXTUREFORMAT_RGBA,de=w*F*4;var je=null;t._badOS||t._badDesktopOS||!t.getCaps().textureHalfFloat&&!t.getCaps().textureFloat?(Ee===128?(je=i._GetFloatAsUIntRGBAArrayBuffer(w,F,n.byteOffset+z,de,n.buffer,Le),y&&Le==0&&y.push(i._GetFloatRGBAArrayBuffer(w,F,n.byteOffset+z,de,n.buffer,Le))):Ee===64&&(je=i._GetHalfFloatAsUIntRGBAArrayBuffer(w,F,n.byteOffset+z,de,n.buffer,Le),y&&Le==0&&y.push(i._GetHalfFloatAsFloatRGBAArrayBuffer(w,F,n.byteOffset+z,de,n.buffer,Le))),e.type=g.a.TEXTURETYPE_UNSIGNED_INT):Ee===128?(e.type=g.a.TEXTURETYPE_FLOAT,je=i._GetFloatRGBAArrayBuffer(w,F,n.byteOffset+z,de,n.buffer,Le),y&&Le==0&&y.push(je)):Ee!==64||t.getCaps().textureHalfFloat?(e.type=g.a.TEXTURETYPE_HALF_FLOAT,je=i._GetHalfFloatRGBAArrayBuffer(w,F,n.byteOffset+z,de,n.buffer,Le),y&&Le==0&&y.push(i._GetHalfFloatAsFloatRGBAArrayBuffer(w,F,z,de,n.buffer,Le))):(e.type=g.a.TEXTURETYPE_FLOAT,je=i._GetHalfFloatAsFloatRGBAArrayBuffer(w,F,n.byteOffset+z,de,n.buffer,Le),y&&Le==0&&y.push(je)),je&&t._uploadDataToTextureDirectly(e,je,Ve,Le)}else if(r.isRGB)e.type=g.a.TEXTURETYPE_UNSIGNED_INT,Ee===24?(e.format=g.a.TEXTUREFORMAT_RGB,de=w*F*3,k=i._GetRGBArrayBuffer(w,F,n.byteOffset+z,de,n.buffer,Pe,Ce,Be),t._uploadDataToTextureDirectly(e,k,Ve,Le)):(e.format=g.a.TEXTUREFORMAT_RGBA,de=w*F*4,k=i._GetRGBAArrayBuffer(w,F,n.byteOffset+z,de,n.buffer,Pe,Ce,Be,Oe),t._uploadDataToTextureDirectly(e,k,Ve,Le));else if(r.isLuminance){var tt=t._getUnpackAlignement(),ut=w;de=Math.floor((w+tt-1)/tt)*tt*(F-1)+ut,k=i._GetLuminanceArrayBuffer(w,F,n.byteOffset+z,de,n.buffer),e.format=g.a.TEXTUREFORMAT_LUMINANCE,e.type=g.a.TEXTURETYPE_UNSIGNED_INT,t._uploadDataToTextureDirectly(e,k,Ve,Le)}else de=Math.max(4,w)/4*Math.max(4,F)/4*ye,k=new Uint8Array(n.buffer,n.byteOffset+z,de),e.type=g.a.TEXTURETYPE_UNSIGNED_INT,t._uploadCompressedDataToTextureDirectly(e,me,w,F,k,Ve,Le)}z+=Ee?w*F*(Ee/8):de,w*=.5,F*=.5,w=Math.max(1,w),F=Math.max(1,F)}if(v!==void 0)break}y&&y.length>0?r.sphericalPolynomial=ih.ConvertCubeMapToSphericalPolynomial({size:ue[4],right:y[0],left:y[1],up:y[2],down:y[3],front:y[4],back:y[5],format:g.a.TEXTUREFORMAT_RGBA,type:g.a.TEXTURETYPE_FLOAT,gammaSpace:!1}):r.sphericalPolynomial=void 0}else _.a.Error("Compressed textures are not supported on this platform.");else _.a.Error("Unsupported format, must contain a FourCC, RGB or LUMINANCE code");else _.a.Error("Invalid magic number in DDS header")},i.StoreLODInAlphaChannel=!1,i}();en.a.prototype.createPrefilteredCubeTexture=function(i,t,e,n,r,o,u,f,v){var y=this;return r===void 0&&(r=null),o===void 0&&(o=null),f===void 0&&(f=null),v===void 0&&(v=!0),this.createCubeTexture(i,t,null,!1,function(D){if(D){var w=D.texture;if(v?D.info.sphericalPolynomial&&(w._sphericalPolynomial=D.info.sphericalPolynomial):w._sphericalPolynomial=new tl,w._source=Nt.b.CubePrefiltered,y.getCaps().textureLOD)r&&r(w);else{var F=y._gl,z=D.width;if(z){for(var k=[],K=0;K<3;K++){var oe=1-K/2,ae=n,ue=te.a.Log2(z)*e+n,de=ae+(ue-ae)*oe,me=Math.round(Math.min(Math.max(de,0),ue)),ye=new Nt.a(y,Nt.b.Temp);if(ye.type=w.type,ye.format=w.format,ye.width=Math.pow(2,Math.max(te.a.Log2(z)-me,0)),ye.height=ye.width,ye.isCube=!0,y._bindTextureDirectly(F.TEXTURE_CUBE_MAP,ye,!0),ye.samplingMode=g.a.TEXTURE_LINEAR_LINEAR,F.texParameteri(F.TEXTURE_CUBE_MAP,F.TEXTURE_MAG_FILTER,F.LINEAR),F.texParameteri(F.TEXTURE_CUBE_MAP,F.TEXTURE_MIN_FILTER,F.LINEAR),F.texParameteri(F.TEXTURE_CUBE_MAP,F.TEXTURE_WRAP_S,F.CLAMP_TO_EDGE),F.texParameteri(F.TEXTURE_CUBE_MAP,F.TEXTURE_WRAP_T,F.CLAMP_TO_EDGE),D.isDDS){var Ee=D.info,Ae=D.data;y._unpackFlipY(Ee.isCompressed),Xo.UploadDDSLevels(y,ye,Ae,Ee,!0,6,me)}else _.a.Warn("DDS is the only prefiltered cube map supported so far.");y._bindTextureDirectly(F.TEXTURE_CUBE_MAP,null);var Ie=new $r.a(t);Ie.isCube=!0,Ie._texture=ye,ye.isReady=!0,k.push(Ie)}w._lodTextureHigh=k[2],w._lodTextureMid=k[1],w._lodTextureLow=k[0],r&&r(w)}}}else r&&r(null)},o,u,f,v,e,n)};var i0=function(){function i(){this.supportCascades=!0}return i.prototype.canLoad=function(t){return ui.a.EndsWith(t,".dds")},i.prototype.loadCubeData=function(t,e,n,r,o){var u,f=e.getEngine(),v=!1;if(Array.isArray(t))for(var y=0;y<t.length;y++){var D=t[y];u=Xo.GetDDSInfo(D),e.width=u.width,e.height=u.height,v=(u.isRGB||u.isLuminance||u.mipmapCount>1)&&e.generateMipMaps,f._unpackFlipY(u.isCompressed),Xo.UploadDDSLevels(f,e,D,u,v,6,-1,y),u.isFourCC||u.mipmapCount!==1||f.generateMipMapsForCubemap(e)}else{var w=t;u=Xo.GetDDSInfo(w),e.width=u.width,e.height=u.height,n&&(u.sphericalPolynomial=new tl),v=(u.isRGB||u.isLuminance||u.mipmapCount>1)&&e.generateMipMaps,f._unpackFlipY(u.isCompressed),Xo.UploadDDSLevels(f,e,w,u,v,6),u.isFourCC||u.mipmapCount!==1||f.generateMipMapsForCubemap(e,!1)}f._setCubeMapTextureParams(e,v),e.isReady=!0,e.onLoadedObservable.notifyObservers(e),e.onLoadedObservable.clear(),r&&r({isDDS:!0,width:e.width,info:u,data:t,texture:e})},i.prototype.loadData=function(t,e,n){var r=Xo.GetDDSInfo(t),o=(r.isRGB||r.isLuminance||r.mipmapCount>1)&&e.generateMipMaps&&r.width>>r.mipmapCount-1==1;n(r.width,r.height,o,r.isFourCC,function(){Xo.UploadDDSLevels(e.getEngine(),e,t,r,o,1)})},i}();Ge.a._TextureLoaders.push(new i0);var o0=function(){function i(){this.supportCascades=!1}return i.prototype.canLoad=function(t){return ui.a.EndsWith(t,".env")},i.prototype.loadCubeData=function(t,e,n,r,o){if(!Array.isArray(t)){var u=so.GetEnvInfo(t);u?(e.width=u.width,e.height=u.width,so.UploadEnvSpherical(e,u),so.UploadEnvLevelsAsync(e,t,u).then(function(){e.isReady=!0,e.onLoadedObservable.notifyObservers(e),e.onLoadedObservable.clear(),r&&r()})):o&&o("Can not parse the environment file",null)}},i.prototype.loadData=function(t,e,n){throw".env not supported in 2d."},i}();Ge.a._TextureLoaders.push(new o0);var vh=function(){function i(t,e,n,r){if(this.data=t,this.isInvalid=!1,!i.IsValid(t))return this.isInvalid=!0,void _.a.Error("texture missing KTX identifier");var o=Uint32Array.BYTES_PER_ELEMENT,u=new DataView(this.data.buffer,this.data.byteOffset+12,13*o),f=u.getUint32(0,!0)===67305985;this.glType=u.getUint32(1*o,f),this.glTypeSize=u.getUint32(2*o,f),this.glFormat=u.getUint32(3*o,f),this.glInternalFormat=u.getUint32(4*o,f),this.glBaseInternalFormat=u.getUint32(5*o,f),this.pixelWidth=u.getUint32(6*o,f),this.pixelHeight=u.getUint32(7*o,f),this.pixelDepth=u.getUint32(8*o,f),this.numberOfArrayElements=u.getUint32(9*o,f),this.numberOfFaces=u.getUint32(10*o,f),this.numberOfMipmapLevels=u.getUint32(11*o,f),this.bytesOfKeyValueData=u.getUint32(12*o,f),this.glType===0?(this.numberOfMipmapLevels=Math.max(1,this.numberOfMipmapLevels),this.pixelHeight!==0&&this.pixelDepth===0?this.numberOfArrayElements===0?this.numberOfFaces===e?this.loadType=i.COMPRESSED_2D:_.a.Error("number of faces expected"+e+", but found "+this.numberOfFaces):_.a.Error("texture arrays not currently supported"):_.a.Error("only 2D textures currently supported")):_.a.Error("only compressed formats currently supported")}return i.prototype.uploadLevels=function(t,e){switch(this.loadType){case i.COMPRESSED_2D:this._upload2DCompressedLevels(t,e);break}},i.prototype._upload2DCompressedLevels=function(t,e){for(var n=i.HEADER_LEN+this.bytesOfKeyValueData,r=this.pixelWidth,o=this.pixelHeight,u=e?this.numberOfMipmapLevels:1,f=0;f<u;f++){var v=new Int32Array(this.data.buffer,this.data.byteOffset+n,1)[0];n+=4;for(var y=0;y<this.numberOfFaces;y++){var D=new Uint8Array(this.data.buffer,this.data.byteOffset+n,v);t.getEngine()._uploadCompressedDataToTextureDirectly(t,this.glInternalFormat,r,o,D,y,f),n+=v,n+=3-(v+3)%4}r=Math.max(1,.5*r),o=Math.max(1,.5*o)}},i.IsValid=function(t){if(t.byteLength>=12){var e=new Uint8Array(t.buffer,t.byteOffset,12);if(e[0]===171&&e[1]===75&&e[2]===84&&e[3]===88&&e[4]===32&&e[5]===49&&e[6]===49&&e[7]===187&&e[8]===13&&e[9]===10&&e[10]===26&&e[11]===10)return!0}return!1},i.HEADER_LEN=64,i.COMPRESSED_2D=0,i.COMPRESSED_3D=1,i.TEX_2D=2,i.TEX_3D=3,i}(),nm=function(){function i(t){this._pendingActions=new Array,this._workerInfos=t.map(function(e){return{worker:e,active:!1}})}return i.prototype.dispose=function(){for(var t=0,e=this._workerInfos;t<e.length;t++)e[t].worker.terminate();this._workerInfos=[],this._pendingActions=[]},i.prototype.push=function(t){for(var e=0,n=this._workerInfos;e<n.length;e++){var r=n[e];if(!r.active)return void this._execute(r,t)}this._pendingActions.push(t)},i.prototype._execute=function(t,e){var n=this;t.active=!0,e(t.worker,function(){t.active=!1;var r=n._pendingActions.shift();r&&n._execute(t,r)})},i}(),rm=function(){function i(t,e){e===void 0&&(e=i.DefaultNumWorkers),this._engine=t,i._Initialized||i._CreateWorkerPool(e)}return i.GetDefaultNumWorkers=function(){return typeof navigator=="object"&&navigator.hardwareConcurrency?Math.min(Math.floor(.5*navigator.hardwareConcurrency),4):1},i._CreateWorkerPool=function(t){this._Initialized=!0,t&&typeof Worker=="function"?i._WorkerPoolPromise=new Promise(function(e){for(var n="("+FD+")()",r=URL.createObjectURL(new Blob([n],{type:"application/javascript"})),o=new Array(t),u=0;u<o.length;u++)o[u]=new Promise(function(f,v){var y=new Worker(r),D=function(F){y.removeEventListener("error",D),y.removeEventListener("message",w),v(F)},w=function(F){F.data.action==="init"&&(y.removeEventListener("error",D),y.removeEventListener("message",w),f(y))};y.addEventListener("error",D),y.addEventListener("message",w),y.postMessage({action:"init",urls:i.URLConfig})});Promise.all(o).then(function(f){e(new nm(f))})}):(KTX2DECODER.MSCTranscoder.UseFromWorkerThread=!1,KTX2DECODER.WASMMemoryManager.LoadBinariesFromCurrentThread=!0)},i.prototype.uploadAsync=function(t,e,n){var r=this,o=this._engine.getCaps(),u={astc:!!o.astc,bptc:!!o.bptc,s3tc:!!o.s3tc,pvrtc:!!o.pvrtc,etc2:!!o.etc2,etc1:!!o.etc1};return i._WorkerPoolPromise?i._WorkerPoolPromise.then(function(f){return new Promise(function(v,y){f.push(function(D,w){var F=function(k){D.removeEventListener("error",F),D.removeEventListener("message",z),y(k),w()},z=function(k){if(k.data.action==="decoded"){if(D.removeEventListener("error",F),D.removeEventListener("message",z),k.data.success)try{r._createTexture(k.data.decodedData,e,n),v()}catch(K){y({message:K})}else y({message:k.data.msg});w()}};D.addEventListener("error",F),D.addEventListener("message",z),D.postMessage({action:"decode",data:t,caps:u,options:n})})})}):new Promise(function(f,v){i._Ktx2Decoder||(i._Ktx2Decoder=new KTX2DECODER.KTX2Decoder),i._Ktx2Decoder.decode(t,o).then(function(y){r._createTexture(y,e),f()}).catch(function(y){v({message:y})})})},i.prototype.dispose=function(){i._WorkerPoolPromise&&i._WorkerPoolPromise.then(function(t){t.dispose()}),delete i._WorkerPoolPromise},i.prototype._createTexture=function(t,e,n){if(this._engine._bindTextureDirectly(this._engine._gl.TEXTURE_2D,e),n&&(n.transcodedFormat=t.transcodedFormat,n.isInGammaSpace=t.isInGammaSpace,n.transcoderName=t.transcoderName),t.transcodedFormat===32856?(e.type=g.a.TEXTURETYPE_UNSIGNED_BYTE,e.format=g.a.TEXTUREFORMAT_RGBA):e.format=t.transcodedFormat,e._gammaSpace=t.isInGammaSpace,t.errors)throw new Error("KTX2 container - could not transcode the data. "+t.errors);for(var r=0;r<t.mipmaps.length;++r){var o=t.mipmaps[r];if(!o||!o.data)throw new Error("KTX2 container - could not transcode one of the image");t.transcodedFormat===32856?(e.width=o.width,e.height=o.height,this._engine._uploadDataToTextureDirectly(e,o.data,0,r,void 0,!0)):this._engine._uploadCompressedDataToTextureDirectly(e,t.transcodedFormat,o.width,o.height,o.data,0,r)}e.width=t.mipmaps[0].width,e.height=t.mipmaps[0].height,e.generateMipMaps=t.mipmaps.length>1,e.isReady=!0,this._engine._bindTextureDirectly(this._engine._gl.TEXTURE_2D,null)},i.IsValid=function(t){if(t.byteLength>=12){var e=new Uint8Array(t.buffer,t.byteOffset,12);if(e[0]===171&&e[1]===75&&e[2]===84&&e[3]===88&&e[4]===32&&e[5]===50&&e[6]===48&&e[7]===187&&e[8]===13&&e[9]===10&&e[10]===26&&e[11]===10)return!0}return!1},i.URLConfig={jsDecoderModule:"https://preview.babylonjs.com/babylon.ktx2Decoder.js",wasmUASTCToASTC:null,wasmUASTCToBC7:null,wasmUASTCToRGBA_UNORM:null,wasmUASTCToRGBA_SRGB:null,jsMSCTranscoder:null,wasmMSCTranscoder:null},i.DefaultNumWorkers=i.GetDefaultNumWorkers(),i}();function FD(){var i;onmessage=function(t){switch(t.data.action){case"init":var e=t.data.urls;importScripts(e.jsDecoderModule),e.wasmUASTCToASTC!==null&&(KTX2DECODER.LiteTranscoder_UASTC_ASTC.WasmModuleURL=e.wasmUASTCToASTC),e.wasmUASTCToBC7!==null&&(KTX2DECODER.LiteTranscoder_UASTC_BC7.WasmModuleURL=e.wasmUASTCToBC7),e.wasmUASTCToRGBA_UNORM!==null&&(KTX2DECODER.LiteTranscoder_UASTC_RGBA_UNORM.WasmModuleURL=e.wasmUASTCToRGBA_UNORM),e.wasmUASTCToRGBA_SRGB!==null&&(KTX2DECODER.LiteTranscoder_UASTC_RGBA_SRGB.WasmModuleURL=e.wasmUASTCToRGBA_SRGB),e.jsMSCTranscoder!==null&&(KTX2DECODER.MSCTranscoder.JSModuleURL=e.jsMSCTranscoder),e.wasmMSCTranscoder!==null&&(KTX2DECODER.MSCTranscoder.WasmModuleURL=e.wasmMSCTranscoder),i=new KTX2DECODER.KTX2Decoder,postMessage({action:"init"});break;case"decode":i.decode(t.data.data,t.data.caps,t.data.options).then(function(n){for(var r=[],o=0;o<n.mipmaps.length;++o){var u=n.mipmaps[o];u&&u.data&&r.push(u.data.buffer)}postMessage({action:"decoded",success:!0,decodedData:n},r)}).catch(function(n){postMessage({action:"decoded",success:!1,msg:n})})}}}var a0=function(){function i(){this.supportCascades=!1}return i.prototype.canLoad=function(t,e){return ui.a.EndsWith(t,".ktx")||ui.a.EndsWith(t,".ktx2")||e==="image/ktx"||e==="image/ktx2"},i.prototype.loadCubeData=function(t,e,n,r,o){if(!Array.isArray(t)){e._invertVScale=!e.invertY;var u=e.getEngine(),f=new vh(t,6),v=f.numberOfMipmapLevels>1&&e.generateMipMaps;u._unpackFlipY(!0),f.uploadLevels(e,e.generateMipMaps),e.width=f.pixelWidth,e.height=f.pixelHeight,u._setCubeMapTextureParams(e,v),e.isReady=!0,e.onLoadedObservable.notifyObservers(e),e.onLoadedObservable.clear(),r&&r()}},i.prototype.loadData=function(t,e,n,r){if(vh.IsValid(t)){e._invertVScale=!e.invertY;var o=new vh(t,1);n(o.pixelWidth,o.pixelHeight,e.generateMipMaps,!0,function(){o.uploadLevels(e,e.generateMipMaps)},o.isInvalid)}else rm.IsValid(t)?new rm(e.getEngine()).uploadAsync(t,e,r).then(function(){n(e.width,e.height,e.generateMipMaps,!0,function(){},!1)},function(u){_.a.Warn("Failed to load KTX2 texture data: "+u.message),n(0,0,!1,!1,function(){},!0)}):(_.a.Error("texture missing KTX identifier"),n(0,0,!1,!1,function(){},!0))},i}();Ge.a._TextureLoaders.unshift(new a0);var s0=function(i){function t(e,n,r){var o=i.call(this,e,d.e.Zero(),n)||this;return o._xrSessionManager=r,o._firstFrame=!1,o._referenceQuaternion=d.b.Identity(),o._referencedPosition=new d.e,o._xrInvPositionCache=new d.e,o._xrInvQuaternionCache=d.b.Identity(),o._trackingState=Ma.NOT_TRACKING,o.onBeforeCameraTeleport=new S.c,o.onAfterCameraTeleport=new S.c,o.onTrackingStateChanged=new S.c,o.compensateOnFirstFrame=!0,o._rotate180=new d.b(0,1,0,0),o.minZ=.1,o.rotationQuaternion=new d.b,o.cameraRigMode=Pt.a.RIG_MODE_CUSTOM,o.updateUpVectorFromRotation=!0,o._updateNumberOfRigCameras(1),o.freezeProjectionMatrix(),o._xrSessionManager.onXRSessionInit.add(function(){o._referencedPosition.copyFromFloats(0,0,0),o._referenceQuaternion.copyFromFloats(0,0,0,1),o._firstFrame=o.compensateOnFirstFrame}),o._xrSessionManager.onXRFrameObservable.add(function(u){o._firstFrame&&o._updateFromXRSession(),o._updateReferenceSpace(),o._updateFromXRSession()},void 0,!0),o}return Object(p.d)(t,i),Object.defineProperty(t.prototype,"trackingState",{get:function(){return this._trackingState},enumerable:!1,configurable:!0}),t.prototype._setTrackingState=function(e){this._trackingState!==e&&(this._trackingState=e,this.onTrackingStateChanged.notifyObservers(e))},Object.defineProperty(t.prototype,"realWorldHeight",{get:function(){var e=this._xrSessionManager.currentFrame&&this._xrSessionManager.currentFrame.getViewerPose(this._xrSessionManager.baseReferenceSpace);return e&&e.transform?e.transform.position.y:0},enumerable:!1,configurable:!0}),t.prototype._updateForDualEyeDebugging=function(){this._updateNumberOfRigCameras(2),this.rigCameras[0].viewport=new li.a(0,0,.5,1),this.rigCameras[0].outputRenderTarget=null,this.rigCameras[1].viewport=new li.a(.5,0,.5,1),this.rigCameras[1].outputRenderTarget=null},t.prototype.setTransformationFromNonVRCamera=function(e,n){e===void 0&&(e=this.getScene().activeCamera),n===void 0&&(n=!0),e&&e!==this&&(e.computeWorldMatrix().decompose(void 0,this.rotationQuaternion,this.position),this.position.y=0,d.b.FromEulerAnglesToRef(0,this.rotationQuaternion.toEulerAngles().y,0,this.rotationQuaternion),this._firstFrame=!0,n&&this._xrSessionManager.resetReferenceSpace())},t.prototype.getClassName=function(){return"WebXRCamera"},t.prototype._updateFromXRSession=function(){var e=this,n=this._xrSessionManager.currentFrame&&this._xrSessionManager.currentFrame.getViewerPose(this._xrSessionManager.referenceSpace);if(n){var r=n.emulatedPosition?Ma.TRACKING_LOST:Ma.TRACKING;if(this._setTrackingState(r),n.transform){var o=n.transform.position;this._referencedPosition.set(o.x,o.y,o.z);var u=n.transform.orientation;this._referenceQuaternion.set(u.x,u.y,u.z,u.w),this._scene.useRightHandedSystem||(this._referencedPosition.z*=-1,this._referenceQuaternion.z*=-1,this._referenceQuaternion.w*=-1),this._firstFrame?(this._firstFrame=!1,this.position.y+=this._referencedPosition.y,this._referenceQuaternion.copyFromFloats(0,0,0,1)):(this.rotationQuaternion.copyFrom(this._referenceQuaternion),this.position.copyFrom(this._referencedPosition))}this.rigCameras.length!==n.views.length&&this._updateNumberOfRigCameras(n.views.length),n.views.forEach(function(f,v){var y=e.rigCameras[v];y.isLeftCamera||y.isRightCamera||(f.eye==="right"?y._isRightCamera=!0:f.eye==="left"&&(y._isLeftCamera=!0));var D=f.transform.position,w=f.transform.orientation;if(y.position.set(D.x,D.y,D.z),y.rotationQuaternion.set(w.x,w.y,w.z,w.w),e._scene.useRightHandedSystem?y.rotationQuaternion.multiplyInPlace(e._rotate180):(y.position.z*=-1,y.rotationQuaternion.z*=-1,y.rotationQuaternion.w*=-1),d.a.FromFloat32ArrayToRefScaled(f.projectionMatrix,0,1,y._projectionMatrix),e._scene.useRightHandedSystem||y._projectionMatrix.toggleProjectionMatrixHandInPlace(),v===0&&e._projectionMatrix.copyFrom(y._projectionMatrix),e._xrSessionManager.session.renderState.baseLayer){var F=e._xrSessionManager.session.renderState.baseLayer.getViewport(f),z=e._xrSessionManager.session.renderState.baseLayer.framebufferWidth,k=e._xrSessionManager.session.renderState.baseLayer.framebufferHeight;y.viewport.width=F.width/z,y.viewport.height=F.height/k,y.viewport.x=F.x/z,y.viewport.y=F.y/k}y.outputRenderTarget=e._xrSessionManager.getRenderTargetTextureForEye(f.eye)})}else this._setTrackingState(Ma.NOT_TRACKING)},t.prototype._updateNumberOfRigCameras=function(e){for(e===void 0&&(e=1);this.rigCameras.length<e;){var n=new ci("XR-RigCamera: "+this.rigCameras.length,d.e.Zero(),this.getScene());n.minZ=.1,n.rotationQuaternion=new d.b,n.updateUpVectorFromRotation=!0,n.isRigCamera=!0,n.rigParent=this,n.freezeProjectionMatrix(),this.rigCameras.push(n)}for(;this.rigCameras.length>e;){var r=this.rigCameras.pop();r&&r.dispose()}},t.prototype._updateReferenceSpace=function(){this.position.equals(this._referencedPosition)&&this.rotationQuaternion.equals(this._referenceQuaternion)||(this.position.subtractToRef(this._referencedPosition,this._referencedPosition),this._referenceQuaternion.conjugateInPlace(),this._referenceQuaternion.multiplyToRef(this.rotationQuaternion,this._referenceQuaternion),this._updateReferenceSpaceOffset(this._referencedPosition,this._referenceQuaternion.normalize()))},t.prototype._updateReferenceSpaceOffset=function(e,n,r){if(r===void 0&&(r=!1),this._xrSessionManager.referenceSpace&&this._xrSessionManager.currentFrame){this._xrInvPositionCache.copyFrom(e),n?this._xrInvQuaternionCache.copyFrom(n):this._xrInvQuaternionCache.copyFromFloats(0,0,0,1),this._scene.useRightHandedSystem||(this._xrInvPositionCache.z*=-1,this._xrInvQuaternionCache.z*=-1,this._xrInvQuaternionCache.w*=-1),this._xrInvPositionCache.negateInPlace(),this._xrInvQuaternionCache.conjugateInPlace(),this._xrInvPositionCache.rotateByQuaternionToRef(this._xrInvQuaternionCache,this._xrInvPositionCache),r&&(this._xrInvPositionCache.y=0);var o=new XRRigidTransform({x:this._xrInvPositionCache.x,y:this._xrInvPositionCache.y,z:this._xrInvPositionCache.z},{x:this._xrInvQuaternionCache.x,y:this._xrInvQuaternionCache.y,z:this._xrInvQuaternionCache.z,w:this._xrInvQuaternionCache.w}),u=this._xrSessionManager.referenceSpace.getOffsetReferenceSpace(o),f=this._xrSessionManager.currentFrame&&this._xrSessionManager.currentFrame.getViewerPose(u);if(f){var v=new d.e(f.transform.position.x,f.transform.position.y,f.transform.position.z);this._scene.useRightHandedSystem||(v.z*=-1),this.position.subtractToRef(v,v),this._scene.useRightHandedSystem||(v.z*=-1),v.negateInPlace();var y=new XRRigidTransform({x:v.x,y:v.y,z:v.z});this._xrSessionManager.referenceSpace=u.getOffsetReferenceSpace(y)}}},t}(Cr),Si=function(){function i(){}return i.ANCHOR_SYSTEM="xr-anchor-system",i.BACKGROUND_REMOVER="xr-background-remover",i.HIT_TEST="xr-hit-test",i.PHYSICS_CONTROLLERS="xr-physics-controller",i.PLANE_DETECTION="xr-plane-detection",i.POINTER_SELECTION="xr-controller-pointer-selection",i.TELEPORTATION="xr-controller-teleportation",i.FEATURE_POINTS="xr-feature-points",i.HAND_TRACKING="xr-hand-tracking",i}(),hi=function(){function i(t){var e=this;this._xrSessionManager=t,this._features={},this._xrSessionManager.onXRSessionInit.add(function(){e.getEnabledFeatures().forEach(function(n){var r=e._features[n];!r.enabled||r.featureImplementation.attached||r.featureImplementation.disableAutoAttach||e.attachFeature(n)})}),this._xrSessionManager.onXRSessionEnded.add(function(){e.getEnabledFeatures().forEach(function(n){var r=e._features[n];r.enabled&&r.featureImplementation.attached&&e.detachFeature(n)})})}return i.AddWebXRFeature=function(t,e,n,r){n===void 0&&(n=1),r===void 0&&(r=!1),this._AvailableFeatures[t]=this._AvailableFeatures[t]||{latest:n},n>this._AvailableFeatures[t].latest&&(this._AvailableFeatures[t].latest=n),r&&(this._AvailableFeatures[t].stable=n),this._AvailableFeatures[t][n]=e},i.ConstructFeature=function(t,e,n,r){e===void 0&&(e=1);var o=this._AvailableFeatures[t][e];if(!o)throw new Error("feature not found");return o(n,r)},i.GetAvailableFeatures=function(){return Object.keys(this._AvailableFeatures)},i.GetAvailableVersions=function(t){return Object.keys(this._AvailableFeatures[t])},i.GetLatestVersionOfFeature=function(t){return this._AvailableFeatures[t]&&this._AvailableFeatures[t].latest||-1},i.GetStableVersionOfFeature=function(t){return this._AvailableFeatures[t]&&this._AvailableFeatures[t].stable||-1},i.prototype.attachFeature=function(t){var e=this._features[t];e&&e.enabled&&!e.featureImplementation.attached&&e.featureImplementation.attach()},i.prototype.detachFeature=function(t){var e=this._features[t];e&&e.featureImplementation.attached&&e.featureImplementation.detach()},i.prototype.disableFeature=function(t){var e=typeof t=="string"?t:t.Name,n=this._features[e];return!(!n||!n.enabled)&&(n.enabled=!1,this.detachFeature(e),n.featureImplementation.dispose(),!0)},i.prototype.dispose=function(){var t=this;this.getEnabledFeatures().forEach(function(e){t.disableFeature(e),t._features[e].featureImplementation.dispose()})},i.prototype.enableFeature=function(t,e,n,r,o){var u=this;e===void 0&&(e="latest"),n===void 0&&(n={}),r===void 0&&(r=!0),o===void 0&&(o=!0);var f=typeof t=="string"?t:t.Name,v=0;if(typeof e=="string"){if(!e)throw new Error("Error in provided version - "+f+" ("+e+")");if((v=e==="stable"?i.GetStableVersionOfFeature(f):e==="latest"?i.GetLatestVersionOfFeature(f):+e)===-1||isNaN(v))throw new Error("feature not found - "+f+" ("+e+")")}else v=e;var y=this._features[f],D=i.ConstructFeature(f,v,this._xrSessionManager,n);if(!D)throw new Error("feature not found - "+f);y&&this.disableFeature(f);var w=D();if(w.dependsOn&&!w.dependsOn.every(function(F){return!!u._features[F]}))throw new Error("Dependant features missing. Make sure the following features are enabled - "+w.dependsOn.join(", "));if(w.isCompatible())return this._features[f]={featureImplementation:w,enabled:!0,version:v,required:o},r?this._xrSessionManager.session&&!this._features[f].featureImplementation.attached&&this.attachFeature(f):this._features[f].featureImplementation.disableAutoAttach=!0,this._features[f].featureImplementation;if(o)throw new Error("required feature not compatible");return et.b.Warn("Feature "+f+" not compatible with the current environment/browser and was not enabled."),w},i.prototype.getEnabledFeature=function(t){return this._features[t]&&this._features[t].featureImplementation},i.prototype.getEnabledFeatures=function(){return Object.keys(this._features)},i.prototype.extendXRSessionInitObject=function(t){var e=this;return this.getEnabledFeatures().forEach(function(n){var r=e._features[n],o=r.featureImplementation.xrNativeFeatureName;o&&(r.required?(t.requiredFeatures=t.requiredFeatures||[],t.requiredFeatures.indexOf(o)===-1&&t.requiredFeatures.push(o)):(t.optionalFeatures=t.optionalFeatures||[],t.optionalFeatures.indexOf(o)===-1&&t.optionalFeatures.push(o)))}),t},i._AvailableFeatures={},i}(),c0=function(){function i(t){var e=this;this.scene=t,this._nonVRCamera=null,this._originalSceneAutoClear=!0,this._supported=!1,this.onInitialXRPoseSetObservable=new S.c,this.onStateChangedObservable=new S.c,this.state=tr.NOT_IN_XR,this.sessionManager=new Lp(t),this.camera=new s0("",t,this.sessionManager),this.featuresManager=new hi(this.sessionManager),t.onDisposeObservable.add(function(){e.exitXRAsync()})}return i.CreateAsync=function(t){var e=new i(t);return e.sessionManager.initializeAsync().then(function(){return e._supported=!0,e}).catch(function(n){throw e._setState(tr.NOT_IN_XR),e.dispose(),n})},i.prototype.dispose=function(){this.camera.dispose(),this.onStateChangedObservable.clear(),this.onInitialXRPoseSetObservable.clear(),this.sessionManager.dispose(),this._nonVRCamera&&(this.scene.activeCamera=this._nonVRCamera)},i.prototype.enterXRAsync=function(t,e,n,r){var o=this;if(n===void 0&&(n=this.sessionManager.getWebXRRenderTarget()),r===void 0&&(r={}),!this._supported)throw"WebXR not supported in this browser or environment";return this._setState(tr.ENTERING_XR),e!=="viewer"&&e!=="local"&&(r.optionalFeatures=r.optionalFeatures||[],r.optionalFeatures.push(e)),this.featuresManager.extendXRSessionInitObject(r),t==="immersive-ar"&&e!=="unbounded"&&_.a.Warn("We recommend using 'unbounded' reference space type when using 'immersive-ar' session mode"),this.sessionManager.initializeSessionAsync(t,r).then(function(){return o.sessionManager.setReferenceSpaceTypeAsync(e)}).then(function(){return n.initializeXRLayerAsync(o.sessionManager.session)}).then(function(){return o.sessionManager.updateRenderStateAsync({depthFar:o.camera.maxZ,depthNear:o.camera.minZ,baseLayer:n.xrLayer})}).then(function(){return o.sessionManager.runXRRenderLoop(),o._originalSceneAutoClear=o.scene.autoClear,o._nonVRCamera=o.scene.activeCamera,o.scene.activeCamera=o.camera,t!=="immersive-ar"?o._nonXRToXRCamera():(o.scene.autoClear=!1,o.camera.compensateOnFirstFrame=!1),o.sessionManager.onXRSessionEnded.addOnce(function(){o.camera.rigCameras.forEach(function(u){u.outputRenderTarget=null}),o.scene.autoClear=o._originalSceneAutoClear,o.scene.activeCamera=o._nonVRCamera,t!=="immersive-ar"&&o.camera.compensateOnFirstFrame&&(o._nonVRCamera.setPosition?o._nonVRCamera.setPosition(o.camera.position):o._nonVRCamera.position.copyFrom(o.camera.position)),o._setState(tr.NOT_IN_XR)}),o.sessionManager.onXRFrameObservable.addOnce(function(){o._setState(tr.IN_XR)}),o.sessionManager}).catch(function(u){throw console.log(u),console.log(u.message),o._setState(tr.NOT_IN_XR),u})},i.prototype.exitXRAsync=function(){return this.state!==tr.IN_XR?Promise.resolve():(this._setState(tr.EXITING_XR),this.sessionManager.exitXRAsync())},i.prototype._nonXRToXRCamera=function(){this.camera.setTransformationFromNonVRCamera(this._nonVRCamera),this.onInitialXRPoseSetObservable.notifyObservers(this.camera)},i.prototype._setState=function(t){this.state!==t&&(this.state=t,this.onStateChangedObservable.notifyObservers(this.state))},i}(),As=function(){function i(t,e,n,r){n===void 0&&(n=-1),r===void 0&&(r=[]),this.id=t,this.type=e,this._buttonIndex=n,this._axesIndices=r,this._axes={x:0,y:0},this._changes={},this._currentValue=0,this._hasChanges=!1,this._pressed=!1,this._touched=!1,this.onAxisValueChangedObservable=new S.c,this.onButtonStateChangedObservable=new S.c}return Object.defineProperty(i.prototype,"axes",{get:function(){return this._axes},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"changes",{get:function(){return this._changes},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"hasChanges",{get:function(){return this._hasChanges},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"pressed",{get:function(){return this._pressed},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"touched",{get:function(){return this._touched},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"value",{get:function(){return this._currentValue},enumerable:!1,configurable:!0}),i.prototype.dispose=function(){this.onAxisValueChangedObservable.clear(),this.onButtonStateChangedObservable.clear()},i.prototype.isAxes=function(){return this._axesIndices.length!==0},i.prototype.isButton=function(){return this._buttonIndex!==-1},i.prototype.update=function(t){var e=!1,n=!1;if(this._hasChanges=!1,this._changes={},this.isButton()){var r=t.buttons[this._buttonIndex];if(!r)return;this._currentValue!==r.value&&(this.changes.value={current:r.value,previous:this._currentValue},e=!0,this._currentValue=r.value),this._touched!==r.touched&&(this.changes.touched={current:r.touched,previous:this._touched},e=!0,this._touched=r.touched),this._pressed!==r.pressed&&(this.changes.pressed={current:r.pressed,previous:this._pressed},e=!0,this._pressed=r.pressed)}this.isAxes()&&(this._axes.x!==t.axes[this._axesIndices[0]]&&(this.changes.axes={current:{x:t.axes[this._axesIndices[0]],y:this._axes.y},previous:{x:this._axes.x,y:this._axes.y}},this._axes.x=t.axes[this._axesIndices[0]],n=!0),this._axes.y!==t.axes[this._axesIndices[1]]&&(this.changes.axes?this.changes.axes.current.y=t.axes[this._axesIndices[1]]:this.changes.axes={current:{x:this._axes.x,y:t.axes[this._axesIndices[1]]},previous:{x:this._axes.x,y:this._axes.y}},this._axes.y=t.axes[this._axesIndices[1]],n=!0)),e&&(this._hasChanges=!0,this.onButtonStateChangedObservable.notifyObservers(this)),n&&(this._hasChanges=!0,this.onAxisValueChangedObservable.notifyObservers(this._axes))},i.BUTTON_TYPE="button",i.SQUEEZE_TYPE="squeeze",i.THUMBSTICK_TYPE="thumbstick",i.TOUCHPAD_TYPE="touchpad",i.TRIGGER_TYPE="trigger",i}(),Ps=function(){function i(t,e,n,r,o){var u=this;this.scene=t,this.layout=e,this.gamepadObject=n,this.handedness=r,this._initComponent=function(f){if(f){var v=u.layout.components[f],y=v.type,D=v.gamepadIndices.button,w=[];v.gamepadIndices.xAxis!==void 0&&v.gamepadIndices.yAxis!==void 0&&w.push(v.gamepadIndices.xAxis,v.gamepadIndices.yAxis),u.components[f]=new As(f,y,D,w)}},this._modelReady=!1,this.components={},this.disableAnimation=!1,this.onModelLoadedObservable=new S.c,e.components&&Object.keys(e.components).forEach(this._initComponent)}return i.prototype.dispose=function(){var t=this;this.getComponentIds().forEach(function(e){return t.getComponent(e).dispose()}),this.rootMesh&&this.rootMesh.dispose()},i.prototype.getAllComponentsOfType=function(t){var e=this;return this.getComponentIds().map(function(n){return e.components[n]}).filter(function(n){return n.type===t})},i.prototype.getComponent=function(t){return this.components[t]},i.prototype.getComponentIds=function(){return Object.keys(this.components)},i.prototype.getComponentOfType=function(t){return this.getAllComponentsOfType(t)[0]||null},i.prototype.getMainComponent=function(){return this.getComponent(this.layout.selectComponentId)},i.prototype.loadModel=function(){return Object(p.b)(this,void 0,void 0,function(){var t,e,n=this;return Object(p.e)(this,function(r){return t=!this._getModelLoadingConstraints(),e=this._getGenericFilenameAndPath(),t?_.a.Warn("Falling back to generic models"):e=this._getFilenameAndPath(),[2,new Promise(function(o,u){an.ImportMesh("",e.path,e.filename,n.scene,function(f){t?n._getGenericParentMesh(f):n._setRootMesh(f),n._processLoadedModel(f),n._modelReady=!0,n.onModelLoadedObservable.notifyObservers(n),o(!0)},null,function(f,v){_.a.Log(v),_.a.Warn("Failed to retrieve controller model of type "+n.profileId+" from the remote server: "+e.path+e.filename),u(v)})})]})})},i.prototype.updateFromXRFrame=function(t){var e=this;this.getComponentIds().forEach(function(n){return e.getComponent(n).update(e.gamepadObject)}),this.updateModel(t)},Object.defineProperty(i.prototype,"handness",{get:function(){return this.handedness},enumerable:!1,configurable:!0}),i.prototype.pulse=function(t,e,n){return n===void 0&&(n=0),this.gamepadObject.hapticActuators&&this.gamepadObject.hapticActuators[n]?this.gamepadObject.hapticActuators[n].pulse(t,e):Promise.resolve(!1)},i.prototype._getChildByName=function(t,e){return t.getChildren(function(n){return n.name===e},!1)[0]},i.prototype._getImmediateChildByName=function(t,e){return t.getChildren(function(n){return n.name==e},!0)[0]},i.prototype._lerpTransform=function(t,e,n){if(t.minMesh&&t.maxMesh&&t.valueMesh&&t.minMesh.rotationQuaternion&&t.maxMesh.rotationQuaternion&&t.valueMesh.rotationQuaternion){var r=n?.5*e+.5:e;d.b.SlerpToRef(t.minMesh.rotationQuaternion,t.maxMesh.rotationQuaternion,r,t.valueMesh.rotationQuaternion),d.e.LerpToRef(t.minMesh.position,t.maxMesh.position,r,t.valueMesh.position)}},i.prototype.updateModel=function(t){this._modelReady&&this._updateModel(t)},i.prototype._getGenericFilenameAndPath=function(){return{filename:"generic.babylon",path:"https://controllers.babylonjs.com/generic/"}},i.prototype._getGenericParentMesh=function(t){var e=this;this.rootMesh=new Ne.a(this.profileId+" "+this.handedness,this.scene),t.forEach(function(n){n.parent||(n.isPickable=!1,n.setParent(e.rootMesh))}),this.rootMesh.rotationQuaternion=d.b.FromEulerAngles(0,Math.PI,0)},i}(),im=function(i){function t(e,n,r){var o=i.call(this,e,BD[r],n,r)||this;return o.profileId=t.ProfileId,o}return Object(p.d)(t,i),t.prototype._getFilenameAndPath=function(){return{filename:"generic.babylon",path:"https://controllers.babylonjs.com/generic/"}},t.prototype._getModelLoadingConstraints=function(){return!0},t.prototype._processLoadedModel=function(e){},t.prototype._setRootMesh=function(e){var n=this;this.rootMesh=new Ne.a(this.profileId+" "+this.handedness,this.scene),e.forEach(function(r){r.isPickable=!1,r.parent||r.setParent(n.rootMesh)}),this.rootMesh.rotationQuaternion=d.b.FromEulerAngles(0,Math.PI,0)},t.prototype._updateModel=function(){},t.ProfileId="generic-trigger",t}(Ps),BD={left:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"generic-trigger-left",assetPath:"left.glb"},right:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"generic-trigger-right",assetPath:"right.glb"},none:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"generic-trigger-none",assetPath:"none.glb"}},l0=function(i){function t(e,n,r,o){var u=i.call(this,e,r.layouts[n.handedness||"none"],n.gamepad,n.handedness)||this;return u._repositoryUrl=o,u._buttonMeshMapping={},u._touchDots={},u.profileId=r.profileId,u}return Object(p.d)(t,i),t.prototype.dispose=function(){var e=this;i.prototype.dispose.call(this),Object.keys(this._touchDots).forEach(function(n){e._touchDots[n].dispose()})},t.prototype._getFilenameAndPath=function(){return{filename:this.layout.assetPath,path:this._repositoryUrl+"/profiles/"+this.profileId+"/"}},t.prototype._getModelLoadingConstraints=function(){var e=an.IsPluginForExtensionAvailable(".glb");return e||_.a.Warn("glTF / glb loaded was not registered, using generic controller instead"),e},t.prototype._processLoadedModel=function(e){var n=this;this.getComponentIds().forEach(function(r){var o=n.layout.components[r];n._buttonMeshMapping[r]={mainMesh:n._getChildByName(n.rootMesh,o.rootNodeName),states:{}},Object.keys(o.visualResponses).forEach(function(u){var f=o.visualResponses[u];if(f.valueNodeProperty==="transform")n._buttonMeshMapping[r].states[u]={valueMesh:n._getChildByName(n.rootMesh,f.valueNodeName),minMesh:n._getChildByName(n.rootMesh,f.minNodeName),maxMesh:n._getChildByName(n.rootMesh,f.maxNodeName)};else{var v=o.type===As.TOUCHPAD_TYPE&&o.touchPointNodeName?o.touchPointNodeName:f.valueNodeName;if(n._buttonMeshMapping[r].states[u]={valueMesh:n._getChildByName(n.rootMesh,v)},o.type===As.TOUCHPAD_TYPE&&!n._touchDots[u]){var y=zr.a.CreateSphere(u+"dot",{diameter:.0015,segments:8},n.scene);y.material=new on.a(u+"mat",n.scene),y.material.diffuseColor=M.a.Red(),y.parent=n._buttonMeshMapping[r].states[u].valueMesh||null,y.isVisible=!1,n._touchDots[u]=y}}})})},t.prototype._setRootMesh=function(e){var n;this.rootMesh=new Ne.a(this.profileId+"-"+this.handedness,this.scene),this.rootMesh.isPickable=!1;for(var r=0;r<e.length;r++){var o=e[r];o.isPickable=!1,o.parent||(n=o)}n&&n.setParent(this.rootMesh),this.scene.useRightHandedSystem||this.rootMesh.rotate(Se.a.Y,Math.PI,Se.c.WORLD)},t.prototype._updateModel=function(e){var n=this;this.disableAnimation||this.getComponentIds().forEach(function(r){var o=n.getComponent(r);if(o.hasChanges){var u=n._buttonMeshMapping[r],f=n.layout.components[r];Object.keys(f.visualResponses).forEach(function(v){var y=f.visualResponses[v],D=o.value;if(y.componentProperty==="xAxis"?D=o.axes.x:y.componentProperty==="yAxis"&&(D=o.axes.y),y.valueNodeProperty==="transform")n._lerpTransform(u.states[v],D,y.componentProperty!=="button");else{var w=u.states[v].valueMesh;w&&(w.isVisible=o.touched||o.pressed),n._touchDots[v]&&(n._touchDots[v].isVisible=o.touched||o.pressed)}})}})},t}(Ps),Gr=function(){function i(){}return i.ClearProfilesCache=function(){this._ProfilesList=null,this._ProfileLoadingPromises={}},i.DefaultFallbacks=function(){this.RegisterFallbacksForProfileId("google-daydream",["generic-touchpad"]),this.RegisterFallbacksForProfileId("htc-vive-focus",["generic-trigger-touchpad"]),this.RegisterFallbacksForProfileId("htc-vive",["generic-trigger-squeeze-touchpad"]),this.RegisterFallbacksForProfileId("magicleap-one",["generic-trigger-squeeze-touchpad"]),this.RegisterFallbacksForProfileId("windows-mixed-reality",["generic-trigger-squeeze-touchpad-thumbstick"]),this.RegisterFallbacksForProfileId("microsoft-mixed-reality",["windows-mixed-reality","generic-trigger-squeeze-touchpad-thumbstick"]),this.RegisterFallbacksForProfileId("oculus-go",["generic-trigger-touchpad"]),this.RegisterFallbacksForProfileId("oculus-touch-v2",["oculus-touch","generic-trigger-squeeze-thumbstick"]),this.RegisterFallbacksForProfileId("oculus-touch",["generic-trigger-squeeze-thumbstick"]),this.RegisterFallbacksForProfileId("samsung-gearvr",["windows-mixed-reality","generic-trigger-squeeze-touchpad-thumbstick"]),this.RegisterFallbacksForProfileId("samsung-odyssey",["generic-touchpad"]),this.RegisterFallbacksForProfileId("valve-index",["generic-trigger-squeeze-touchpad-thumbstick"])},i.FindFallbackWithProfileId=function(t){var e=this._Fallbacks[t]||[];return e.unshift(t),e},i.GetMotionControllerWithXRInput=function(t,e,n){var r=this,o=[];if(n&&o.push(n),o.push.apply(o,t.profiles||[]),o.length&&!o[0]&&o.pop(),t.gamepad&&t.gamepad.id)switch(t.gamepad.id){case(t.gamepad.id.match(/oculus touch/gi)?t.gamepad.id:void 0):o.push("oculus-touch-v2")}var u=o.indexOf("windows-mixed-reality");if(u!==-1&&o.splice(u,0,"microsoft-mixed-reality"),o.length||o.push("generic-trigger"),this.UseOnlineRepository){var f=this.PrioritizeOnlineRepository?this._LoadProfileFromRepository:this._LoadProfilesFromAvailableControllers,v=this.PrioritizeOnlineRepository?this._LoadProfilesFromAvailableControllers:this._LoadProfileFromRepository;return f.call(this,o,t,e).catch(function(){return v.call(r,o,t,e)})}return this._LoadProfilesFromAvailableControllers(o,t,e)},i.RegisterController=function(t,e){this._AvailableControllers[t]=e},i.RegisterFallbacksForProfileId=function(t,e){var n;this._Fallbacks[t]?(n=this._Fallbacks[t]).push.apply(n,e):this._Fallbacks[t]=e},i.UpdateProfilesList=function(){return this._ProfilesList=et.b.LoadFileAsync(this.BaseRepositoryUrl+"/profiles/profilesList.json",!1).then(function(t){return JSON.parse(t.toString())}),this._ProfilesList},i._LoadProfileFromRepository=function(t,e,n){var r=this;return Promise.resolve().then(function(){return r._ProfilesList?r._ProfilesList:r.UpdateProfilesList()}).then(function(o){for(var u=0;u<t.length;++u)if(t[u]&&o[t[u]])return t[u];throw new Error("neither controller "+t[0]+" nor all fallbacks were found in the repository,")}).then(function(o){return r._ProfileLoadingPromises[o]||(r._ProfileLoadingPromises[o]=et.b.LoadFileAsync(r.BaseRepositoryUrl+"/profiles/"+o+"/profile.json",!1).then(function(u){return JSON.parse(u)})),r._ProfileLoadingPromises[o]}).then(function(o){return new l0(n,e,o,r.BaseRepositoryUrl)})},i._LoadProfilesFromAvailableControllers=function(t,e,n){for(var r=0;r<t.length;++r)if(t[r])for(var o=this.FindFallbackWithProfileId(t[r]),u=0;u<o.length;++u){var f=this._AvailableControllers[o[u]];if(f)return Promise.resolve(f(e,n))}throw new Error("no controller requested was found in the available controllers list")},i._AvailableControllers={},i._Fallbacks={},i._ProfileLoadingPromises={},i.BaseRepositoryUrl="https://immersive-web.github.io/webxr-input-profiles/packages/viewer/dist",i.PrioritizeOnlineRepository=!0,i.UseOnlineRepository=!0,i}();Gr.RegisterController(im.ProfileId,function(i,t){return new im(t,i.gamepad,i.handedness)}),Gr.DefaultFallbacks();var UD=0,u0=function(){function i(t,e,n){var r=this;n===void 0&&(n={}),this._scene=t,this.inputSource=e,this._options=n,this._tmpVector=new d.e,this._disposed=!1,this.onDisposeObservable=new S.c,this.onMeshLoadedObservable=new S.c,this.onMotionControllerInitObservable=new S.c,this._uniqueId="controller-"+UD+++"-"+e.targetRayMode+"-"+e.handedness,this.pointer=new jt.a(this._uniqueId+"-pointer",t),this.pointer.rotationQuaternion=new d.b,this.inputSource.gripSpace&&(this.grip=new jt.a(this._uniqueId+"-grip",this._scene),this.grip.rotationQuaternion=new d.b),this._tmpVector.set(0,0,this._scene.useRightHandedSystem?-1:1),this.inputSource.gamepad&&Gr.GetMotionControllerWithXRInput(e,t,this._options.forceControllerProfile).then(function(o){r.motionController=o,r.onMotionControllerInitObservable.notifyObservers(o),r._options.doNotLoadControllerMesh||r.motionController.loadModel().then(function(u){var f;u&&r.motionController&&r.motionController.rootMesh&&(r._options.renderingGroupId&&(r.motionController.rootMesh.renderingGroupId=r._options.renderingGroupId,r.motionController.rootMesh.getChildMeshes(!1).forEach(function(v){return v.renderingGroupId=r._options.renderingGroupId})),r.onMeshLoadedObservable.notifyObservers(r.motionController.rootMesh),r.motionController.rootMesh.parent=r.grip||r.pointer,r.motionController.disableAnimation=!!r._options.disableMotionControllerAnimation),r._disposed&&((f=r.motionController)===null||f===void 0||f.dispose())})},function(){et.b.Warn("Could not find a matching motion controller for the registered input source")})}return Object.defineProperty(i.prototype,"uniqueId",{get:function(){return this._uniqueId},enumerable:!1,configurable:!0}),i.prototype.dispose=function(){this.grip&&this.grip.dispose(),this.motionController&&this.motionController.dispose(),this.pointer.dispose(),this.onMotionControllerInitObservable.clear(),this.onMeshLoadedObservable.clear(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this._disposed=!0},i.prototype.getWorldPointerRayToRef=function(t,e){e===void 0&&(e=!1);var n=e&&this.grip?this.grip:this.pointer;d.e.TransformNormalToRef(this._tmpVector,n.getWorldMatrix(),t.direction),t.direction.normalize(),t.origin.copyFrom(n.absolutePosition),t.length=1e3},i.prototype.updateFromXRFrame=function(t,e){var n=t.getPose(this.inputSource.targetRaySpace,e);if(n){var r=n.transform.position;this.pointer.position.set(r.x,r.y,r.z);var o=n.transform.orientation;this.pointer.rotationQuaternion.set(o.x,o.y,o.z,o.w),this._scene.useRightHandedSystem||(this.pointer.position.z*=-1,this.pointer.rotationQuaternion.z*=-1,this.pointer.rotationQuaternion.w*=-1)}if(this.inputSource.gripSpace&&this.grip){var u=t.getPose(this.inputSource.gripSpace,e);if(u){r=u.transform.position;var f=u.transform.orientation;this.grip.position.set(r.x,r.y,r.z),this.grip.rotationQuaternion.set(f.x,f.y,f.z,f.w),this._scene.useRightHandedSystem||(this.grip.position.z*=-1,this.grip.rotationQuaternion.z*=-1,this.grip.rotationQuaternion.w*=-1)}}this.motionController&&this.motionController.updateFromXRFrame(t)},i}(),h0=function(){function i(t,e,n){var r=this;if(n===void 0&&(n={}),this.xrSessionManager=t,this.xrCamera=e,this.options=n,this.controllers=[],this.onControllerAddedObservable=new S.c,this.onControllerRemovedObservable=new S.c,this._onInputSourcesChange=function(o){r._addAndRemoveControllers(o.added,o.removed)},this._sessionEndedObserver=this.xrSessionManager.onXRSessionEnded.add(function(){r._addAndRemoveControllers([],r.controllers.map(function(o){return o.inputSource}))}),this._sessionInitObserver=this.xrSessionManager.onXRSessionInit.add(function(o){o.addEventListener("inputsourceschange",r._onInputSourcesChange)}),this._frameObserver=this.xrSessionManager.onXRFrameObservable.add(function(o){r.controllers.forEach(function(u){u.updateFromXRFrame(o,r.xrSessionManager.referenceSpace)})}),this.options.customControllersRepositoryURL&&(Gr.BaseRepositoryUrl=this.options.customControllersRepositoryURL),Gr.UseOnlineRepository=!this.options.disableOnlineControllerRepository,Gr.UseOnlineRepository)try{Gr.UpdateProfilesList().catch(function(){Gr.UseOnlineRepository=!1})}catch(o){Gr.UseOnlineRepository=!1}}return i.prototype._addAndRemoveControllers=function(t,e){for(var n=this,r=this.controllers.map(function(w){return w.inputSource}),o=0,u=t;o<u.length;o++){var f=u[o];if(r.indexOf(f)===-1){var v=new u0(this.xrSessionManager.scene,f,Object(p.a)(Object(p.a)({},this.options.controllerOptions||{}),{forceControllerProfile:this.options.forceInputProfile,doNotLoadControllerMesh:this.options.doNotLoadControllerMeshes,disableMotionControllerAnimation:this.options.disableControllerAnimation}));this.controllers.push(v),this.onControllerAddedObservable.notifyObservers(v)}}var y=[],D=[];this.controllers.forEach(function(w){e.indexOf(w.inputSource)===-1?y.push(w):D.push(w)}),this.controllers=y,D.forEach(function(w){n.onControllerRemovedObservable.notifyObservers(w),w.dispose()})},i.prototype.dispose=function(){this.controllers.forEach(function(t){t.dispose()}),this.xrSessionManager.onXRFrameObservable.remove(this._frameObserver),this.xrSessionManager.onXRSessionInit.remove(this._sessionInitObserver),this.xrSessionManager.onXRSessionEnded.remove(this._sessionEndedObserver),this.onControllerAddedObservable.clear(),this.onControllerRemovedObservable.clear()},i}(),xi=function(){function i(t){this._xrSessionManager=t,this._attached=!1,this._removeOnDetach=[],this.isDisposed=!1,this.disableAutoAttach=!1,this.xrNativeFeatureName=""}return Object.defineProperty(i.prototype,"attached",{get:function(){return this._attached},enumerable:!1,configurable:!0}),i.prototype.attach=function(t){var e=this;if(this.isDisposed)return!1;if(t)this.attached&&this.detach();else if(this.attached)return!1;return this._attached=!0,this._addNewAttachObserver(this._xrSessionManager.onXRFrameObservable,function(n){return e._onXRFrame(n)}),!0},i.prototype.detach=function(){return this._attached?(this._attached=!1,this._removeOnDetach.forEach(function(t){t.observable.remove(t.observer)}),!0):(this.disableAutoAttach=!0,!1)},i.prototype.dispose=function(){this.detach(),this.isDisposed=!0},i.prototype.isCompatible=function(){return!0},i.prototype._addNewAttachObserver=function(t,e){this._removeOnDetach.push({observable:t,observer:t.add(e)})},i}(),cl=function(i){function t(e,n){var r=i.call(this,e)||this;return r._options=n,r._attachController=function(o){if(!r._controllers[o.uniqueId]){var u=r._generateNewMeshPair(o.pointer),f=u.laserPointer,v=u.selectionMesh;switch(r._controllers[o.uniqueId]={xrController:o,laserPointer:f,selectionMesh:v,meshUnderPointer:null,pick:null,tmpRay:new Qn.a(new d.e,new d.e),id:t._idCounter++},r._attachedController?!r._options.enablePointerSelectionOnAllControllers&&r._options.preferredHandedness&&o.inputSource.handedness===r._options.preferredHandedness&&(r._attachedController=o.uniqueId):r._options.enablePointerSelectionOnAllControllers||(r._attachedController=o.uniqueId),o.inputSource.targetRayMode){case"tracked-pointer":return r._attachTrackedPointerRayMode(o);case"gaze":return r._attachGazeMode(o);case"screen":return r._attachScreenRayMode(o)}}},r._controllers={},r._tmpVectorForPickCompare=new d.e,r.disablePointerLighting=!0,r.disableSelectionMeshLighting=!0,r.displayLaserPointer=!0,r.displaySelectionMesh=!0,r.laserPointerPickedColor=new M.a(.9,.9,.9),r.laserPointerDefaultColor=new M.a(.7,.7,.7),r.selectionMeshDefaultColor=new M.a(.8,.8,.8),r.selectionMeshPickedColor=new M.a(.3,.3,1),r._identityMatrix=d.a.Identity(),r._screenCoordinatesRef=d.e.Zero(),r._viewportRef=new li.a(0,0,0,0),r._scene=r._xrSessionManager.scene,r}return Object(p.d)(t,i),t.prototype.attach=function(){var e=this;if(!i.prototype.attach.call(this))return!1;if(this._options.xrInput.controllers.forEach(this._attachController),this._addNewAttachObserver(this._options.xrInput.onControllerAddedObservable,this._attachController),this._addNewAttachObserver(this._options.xrInput.onControllerRemovedObservable,function(f){e._detachController(f.uniqueId)}),this._scene.constantlyUpdateMeshUnderPointer=!0,this._options.gazeCamera){var n=this._options.gazeCamera,r=this._generateNewMeshPair(n),o=r.laserPointer,u=r.selectionMesh;this._controllers.camera={webXRCamera:n,laserPointer:o,selectionMesh:u,meshUnderPointer:null,pick:null,tmpRay:new Qn.a(new d.e,new d.e),id:t._idCounter++},this._attachGazeMode()}return!0},t.prototype.detach=function(){var e=this;return!!i.prototype.detach.call(this)&&(Object.keys(this._controllers).forEach(function(n){e._detachController(n)}),!0)},t.prototype.getMeshUnderPointer=function(e){return this._controllers[e]?this._controllers[e].meshUnderPointer:null},t.prototype.getXRControllerByPointerId=function(e){for(var n=Object.keys(this._controllers),r=0;r<n.length;++r)if(this._controllers[n[r]].id===e)return this._controllers[n[r]].xrController||null;return null},t.prototype._onXRFrame=function(e){var n=this;Object.keys(this._controllers).forEach(function(r){var o,u=n._controllers[r];if(!n._options.enablePointerSelectionOnAllControllers&&r!==n._attachedController)return u.selectionMesh.isVisible=!1,u.laserPointer.isVisible=!1,void(u.pick=null);if(u.laserPointer.isVisible=n.displayLaserPointer,u.xrController)o=u.xrController.pointer.position,u.xrController.getWorldPointerRayToRef(u.tmpRay);else{if(!u.webXRCamera)return;o=u.webXRCamera.position,u.webXRCamera.getForwardRayToRef(u.tmpRay)}if(n._options.maxPointerDistance&&(u.tmpRay.length=n._options.maxPointerDistance),!n._options.disableScenePointerVectorUpdate&&o){var f=n._xrSessionManager.scene,v=n._options.xrInput.xrCamera;v&&(v.viewport.toGlobalToRef(f.getEngine().getRenderWidth(),f.getEngine().getRenderHeight(),n._viewportRef),d.e.ProjectToRef(o,n._identityMatrix,f.getTransformMatrix(),n._viewportRef,n._screenCoordinatesRef),f.pointerX=n._screenCoordinatesRef.x,f.pointerY=n._screenCoordinatesRef.y)}u.pick=n._scene.pickWithRay(u.tmpRay,n._scene.pointerMovePredicate||n.raySelectionPredicate);var y=u.pick;if(y&&y.pickedPoint&&y.hit){n._updatePointerDistance(u.laserPointer,y.distance),u.selectionMesh.position.copyFrom(y.pickedPoint),u.selectionMesh.scaling.x=Math.sqrt(y.distance),u.selectionMesh.scaling.y=Math.sqrt(y.distance),u.selectionMesh.scaling.z=Math.sqrt(y.distance);var D=n._convertNormalToDirectionOfRay(y.getNormal(!0),u.tmpRay);if(u.selectionMesh.position.copyFrom(y.pickedPoint),D){var w=d.e.Cross(Se.a.Y,D),F=d.e.Cross(D,w);d.e.RotationFromAxisToRef(F,D,w,u.selectionMesh.rotation),u.selectionMesh.position.addInPlace(D.scale(.001))}u.selectionMesh.isVisible=n.displaySelectionMesh,u.meshUnderPointer=y.pickedMesh}else u.selectionMesh.isVisible=!1,n._updatePointerDistance(u.laserPointer,1),u.meshUnderPointer=null})},t.prototype._attachGazeMode=function(e){var n=this,r=this._controllers[e&&e.uniqueId||"camera"],o=this._options.timeToSelect||3e3,u=this._options.useUtilityLayer?this._options.customUtilityLayerScene||Ir.a.DefaultUtilityLayer.utilityLayerScene:this._scene,f=new Ia.a,v=ms.CreateTorus("selection",{diameter:.0525,thickness:.015,tessellation:20},u);v.isVisible=!1,v.isPickable=!1,v.parent=r.selectionMesh;var y=0,D=!1;r.onFrameObserver=this._xrSessionManager.onXRFrameObservable.add(function(){if(r.pick){if(r.laserPointer.material.alpha=0,v.isVisible=!1,r.pick.hit)if(n._pickingMoved(f,r.pick))D&&(n._options.disablePointerUpOnTouchOut||n._scene.simulatePointerUp(r.pick,{pointerId:r.id})),D=!1,y=0;else if(y>o/10&&(v.isVisible=!0),(y+=n._scene.getEngine().getDeltaTime())>=o)n._scene.simulatePointerDown(r.pick,{pointerId:r.id}),D=!0,n._options.disablePointerUpOnTouchOut&&n._scene.simulatePointerUp(r.pick,{pointerId:r.id}),v.isVisible=!1;else{var w=1-y/o;v.scaling.set(w,w,w)}else D=!1,y=0;n._scene.simulatePointerMove(r.pick,{pointerId:r.id}),f=r.pick}}),this._options.renderingGroupId!==void 0&&(v.renderingGroupId=this._options.renderingGroupId),e&&e.onDisposeObservable.addOnce(function(){r.pick&&!n._options.disablePointerUpOnTouchOut&&D&&n._scene.simulatePointerUp(r.pick,{pointerId:r.id}),v.dispose()})},t.prototype._attachScreenRayMode=function(e){var n=this,r=this._controllers[e.uniqueId],o=!1;r.onFrameObserver=this._xrSessionManager.onXRFrameObservable.add(function(){!r.pick||n._options.disablePointerUpOnTouchOut&&o||(o?n._scene.simulatePointerMove(r.pick,{pointerId:r.id}):(n._scene.simulatePointerDown(r.pick,{pointerId:r.id}),o=!0,n._options.disablePointerUpOnTouchOut&&n._scene.simulatePointerUp(r.pick,{pointerId:r.id})))}),e.onDisposeObservable.addOnce(function(){r.pick&&o&&!n._options.disablePointerUpOnTouchOut&&n._scene.simulatePointerUp(r.pick,{pointerId:r.id})})},t.prototype._attachTrackedPointerRayMode=function(e){var n=this,r=this._controllers[e.uniqueId];if(this._options.forceGazeMode)return this._attachGazeMode(e);if(r.onFrameObserver=this._xrSessionManager.onXRFrameObservable.add(function(){r.laserPointer.material.disableLighting=n.disablePointerLighting,r.selectionMesh.material.disableLighting=n.disableSelectionMeshLighting,r.pick&&n._scene.simulatePointerMove(r.pick,{pointerId:r.id})}),e.inputSource.gamepad){var o=function(v){n._options.overrideButtonId&&(r.selectionComponent=v.getComponent(n._options.overrideButtonId)),r.selectionComponent||(r.selectionComponent=v.getMainComponent()),r.onButtonChangedObserver=r.selectionComponent.onButtonStateChangedObservable.add(function(y){if(y.changes.pressed){var D=y.changes.pressed.current;r.pick?(n._options.enablePointerSelectionOnAllControllers||e.uniqueId===n._attachedController)&&(D?(n._scene.simulatePointerDown(r.pick,{pointerId:r.id}),r.selectionMesh.material.emissiveColor=n.selectionMeshPickedColor,r.laserPointer.material.emissiveColor=n.laserPointerPickedColor):(n._scene.simulatePointerUp(r.pick,{pointerId:r.id}),r.selectionMesh.material.emissiveColor=n.selectionMeshDefaultColor,r.laserPointer.material.emissiveColor=n.laserPointerDefaultColor)):!D||n._options.enablePointerSelectionOnAllControllers||n._options.disableSwitchOnClick||(n._attachedController=e.uniqueId)}})};e.motionController?o(e.motionController):e.onMotionControllerInitObservable.add(o)}else{var u=function(v){r.xrController&&v.inputSource===r.xrController.inputSource&&r.pick&&(n._scene.simulatePointerDown(r.pick,{pointerId:r.id}),r.selectionMesh.material.emissiveColor=n.selectionMeshPickedColor,r.laserPointer.material.emissiveColor=n.laserPointerPickedColor)},f=function(v){r.xrController&&v.inputSource===r.xrController.inputSource&&r.pick&&(n._scene.simulatePointerUp(r.pick,{pointerId:r.id}),r.selectionMesh.material.emissiveColor=n.selectionMeshDefaultColor,r.laserPointer.material.emissiveColor=n.laserPointerDefaultColor)};r.eventListeners={selectend:f,selectstart:u},this._xrSessionManager.session.addEventListener("selectstart",u),this._xrSessionManager.session.addEventListener("selectend",f)}},t.prototype._convertNormalToDirectionOfRay=function(e,n){return e&&Math.acos(d.e.Dot(e,n.direction))<Math.PI/2&&e.scaleInPlace(-1),e},t.prototype._detachController=function(e){var n=this,r=this._controllers[e];if(r&&(r.selectionComponent&&r.onButtonChangedObserver&&r.selectionComponent.onButtonStateChangedObservable.remove(r.onButtonChangedObserver),r.onFrameObserver&&this._xrSessionManager.onXRFrameObservable.remove(r.onFrameObserver),r.eventListeners&&Object.keys(r.eventListeners).forEach(function(u){var f=r.eventListeners&&r.eventListeners[u];f&&n._xrSessionManager.session.removeEventListener(u,f)}),r.selectionMesh.dispose(),r.laserPointer.dispose(),delete this._controllers[e],this._attachedController===e)){var o=Object.keys(this._controllers);o.length?this._attachedController=o[0]:this._attachedController=""}},t.prototype._generateNewMeshPair=function(e){var n=this._options.useUtilityLayer?this._options.customUtilityLayerScene||Ir.a.DefaultUtilityLayer.utilityLayerScene:this._scene,r=zi.a.CreateCylinder("laserPointer",{height:1,diameterTop:2e-4,diameterBottom:.004,tessellation:20,subdivisions:1},n);r.parent=e;var o=new on.a("laserPointerMat",n);o.emissiveColor=this.laserPointerDefaultColor,o.alpha=.7,r.material=o,r.rotation.x=Math.PI/2,this._updatePointerDistance(r,1),r.isPickable=!1;var u=ms.CreateTorus("gazeTracker",{diameter:.0105,thickness:.0075,tessellation:20},n);u.bakeCurrentTransformIntoVertices(),u.isPickable=!1,u.isVisible=!1;var f=new on.a("targetMat",n);return f.specularColor=M.a.Black(),f.emissiveColor=this.selectionMeshDefaultColor,f.backFaceCulling=!1,u.material=f,this._options.renderingGroupId!==void 0&&(r.renderingGroupId=this._options.renderingGroupId,u.renderingGroupId=this._options.renderingGroupId),{laserPointer:r,selectionMesh:u}},t.prototype._pickingMoved=function(e,n){var r;if(!e.hit||!n.hit||!(e.pickedMesh&&e.pickedPoint&&n.pickedMesh&&n.pickedPoint)||e.pickedMesh!==n.pickedMesh)return!0;(r=e.pickedPoint)===null||r===void 0||r.subtractToRef(n.pickedPoint,this._tmpVectorForPickCompare),this._tmpVectorForPickCompare.set(Math.abs(this._tmpVectorForPickCompare.x),Math.abs(this._tmpVectorForPickCompare.y),Math.abs(this._tmpVectorForPickCompare.z));var o=.01*(this._options.gazeModePointerMovedFactor||1)*n.distance;return this._tmpVectorForPickCompare.length()>o},t.prototype._updatePointerDistance=function(e,n){n===void 0&&(n=100),e.scaling.y=n,this._scene.useRightHandedSystem&&(n*=-1),e.position.z=n/2+.05},Object.defineProperty(t.prototype,"lasterPointerDefaultColor",{get:function(){return this.laserPointerDefaultColor},enumerable:!1,configurable:!0}),t._idCounter=200,t.Name=Si.POINTER_SELECTION,t.Version=1,t}(xi);hi.AddWebXRFeature(cl.Name,function(i,t){return function(){return new cl(i,t)}},cl.Version,!0);var Yo,d0=function(){function i(t,e,n){this.element=t,this.sessionMode=e,this.referenceSpaceType=n}return i.prototype.update=function(t){},i}(),VD=function(){},f0=function(){function i(t,e){var n=this;if(this.scene=t,this.options=e,this._activeButton=null,this._buttons=[],this.activeButtonChangedObservable=new S.c,this.overlay=document.createElement("div"),this.overlay.classList.add("xr-button-overlay"),this.overlay.style.cssText="z-index:11;position: absolute; right: 20px;bottom: 50px;",typeof window!="undefined"&&window.location&&window.location.protocol==="http:"&&et.b.Warn("WebXR can only be served over HTTPS"),e.customButtons)this._buttons=e.customButtons;else{var r=e.sessionMode||"immersive-vr",o=e.referenceSpaceType||"local-floor",u=".babylonVRicon { color: #868686; border-color: #868686; border-style: solid; margin-left: 10px; height: 50px; width: 80px; background-color: rgba(51,51,51,0.7); background-image: url("+(typeof SVGSVGElement=="undefined"?"https://cdn.babylonjs.com/Assets/vrButton.png":"data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%222048%22%20height%3D%221152%22%20viewBox%3D%220%200%202048%201152%22%20version%3D%221.1%22%3E%3Cpath%20transform%3D%22rotate%28180%201024%2C576.0000000000001%29%22%20d%3D%22m1109%2C896q17%2C0%2030%2C-12t13%2C-30t-12.5%2C-30.5t-30.5%2C-12.5l-170%2C0q-18%2C0%20-30.5%2C12.5t-12.5%2C30.5t13%2C30t30%2C12l170%2C0zm-85%2C256q59%2C0%20132.5%2C-1.5t154.5%2C-5.5t164.5%2C-11.5t163%2C-20t150%2C-30t124.5%2C-41.5q23%2C-11%2042%2C-24t38%2C-30q27%2C-25%2041%2C-61.5t14%2C-72.5l0%2C-257q0%2C-123%20-47%2C-232t-128%2C-190t-190%2C-128t-232%2C-47l-81%2C0q-37%2C0%20-68.5%2C14t-60.5%2C34.5t-55.5%2C45t-53%2C45t-53%2C34.5t-55.5%2C14t-55.5%2C-14t-53%2C-34.5t-53%2C-45t-55.5%2C-45t-60.5%2C-34.5t-68.5%2C-14l-81%2C0q-123%2C0%20-232%2C47t-190%2C128t-128%2C190t-47%2C232l0%2C257q0%2C68%2038%2C115t97%2C73q54%2C24%20124.5%2C41.5t150%2C30t163%2C20t164.5%2C11.5t154.5%2C5.5t132.5%2C1.5zm939%2C-298q0%2C39%20-24.5%2C67t-58.5%2C42q-54%2C23%20-122%2C39.5t-143.5%2C28t-155.5%2C19t-157%2C11t-148.5%2C5t-129.5%2C1.5q-59%2C0%20-130%2C-1.5t-148%2C-5t-157%2C-11t-155.5%2C-19t-143.5%2C-28t-122%2C-39.5q-34%2C-14%20-58.5%2C-42t-24.5%2C-67l0%2C-257q0%2C-106%2040.5%2C-199t110%2C-162.5t162.5%2C-109.5t199%2C-40l81%2C0q27%2C0%2052%2C14t50%2C34.5t51%2C44.5t55.5%2C44.5t63.5%2C34.5t74%2C14t74%2C-14t63.5%2C-34.5t55.5%2C-44.5t51%2C-44.5t50%2C-34.5t52%2C-14l14%2C0q37%2C0%2070%2C0.5t64.5%2C4.5t63.5%2C12t68%2C23q71%2C30%20128.5%2C78.5t98.5%2C110t63.5%2C133.5t22.5%2C149l0%2C257z%22%20fill%3D%22white%22%20/%3E%3C/svg%3E%0A")+"); background-size: 80%; background-repeat:no-repeat; background-position: center; border: none; outline: none; transition: transform 0.125s ease-out } .babylonVRicon:hover { transform: scale(1.05) } .babylonVRicon:active {background-color: rgba(51,51,51,1) } .babylonVRicon:focus {background-color: rgba(51,51,51,1) }";u+='.babylonVRicon.vrdisplaypresenting { background-image: none;} .vrdisplaypresenting::after { content: "EXIT"} .xr-error::after { content: "ERROR"}';var f=document.createElement("style");f.appendChild(document.createTextNode(u)),document.getElementsByTagName("head")[0].appendChild(f);var v=document.createElement("button");v.className="babylonVRicon",v.title=r+" - "+o,this._buttons.push(new d0(v,r,o)),this._buttons[this._buttons.length-1].update=function(D){this.element.style.display=D===null||D===this?"":"none",v.className="babylonVRicon"+(D===this?" vrdisplaypresenting":"")},this._updateButtons(null)}var y=t.getEngine().getInputElement();y&&y.parentNode&&(y.parentNode.appendChild(this.overlay),t.onDisposeObservable.addOnce(function(){n.dispose()}))}return i.CreateAsync=function(t,e,n){var r=this,o=new i(t,n),u=o._buttons.map(function(f){return e.sessionManager.isSessionSupportedAsync(f.sessionMode)});return e.onStateChangedObservable.add(function(f){f==tr.NOT_IN_XR&&o._updateButtons(null)}),Promise.all(u).then(function(f){return f.forEach(function(v,y){v?(o.overlay.appendChild(o._buttons[y].element),o._buttons[y].element.onclick=function(){return Object(p.b)(r,void 0,void 0,function(){var D,w,F;return Object(p.e)(this,function(z){switch(z.label){case 0:return e.state!=tr.IN_XR?[3,2]:[4,e.exitXRAsync()];case 1:return z.sent(),o._updateButtons(null),[3,6];case 2:if(e.state!=tr.NOT_IN_XR)return[3,6];if(!n.renderTarget)return[3,6];z.label=3;case 3:return z.trys.push([3,5,,6]),[4,e.enterXRAsync(o._buttons[y].sessionMode,o._buttons[y].referenceSpaceType,n.renderTarget,{optionalFeatures:n.optionalFeatures,requiredFeatures:n.requiredFeatures})];case 4:return z.sent(),o._updateButtons(o._buttons[y]),[3,6];case 5:return D=z.sent(),o._updateButtons(null),w=o._buttons[y].element,F=w.title,w.title="Error entering XR session : "+F,w.classList.add("xr-error"),n.onError&&n.onError(D),[3,6];case 6:return[2]}})})}):et.b.Warn('Session mode "'+o._buttons[y].sessionMode+'" not supported in browser')}),o})},i.prototype.dispose=function(){var t=this.scene.getEngine().getInputElement();t&&t.parentNode&&t.parentNode.contains(this.overlay)&&t.parentNode.removeChild(this.overlay),this.activeButtonChangedObservable.clear()},i.prototype._updateButtons=function(t){var e=this;this._activeButton=t,this._buttons.forEach(function(n){n.update(e._activeButton)}),this.activeButtonChangedObservable.notifyObservers(this._activeButton)},i}();function om(i){var t,e=0,n=Date.now();i.observableParameters=(t=i.observableParameters)!==null&&t!==void 0?t:{};var r=i.contextObservable.add(function(o){var u=Date.now(),f={startTime:n,currentTime:u,deltaTime:e=u-n,completeRate:e/i.timeout,payload:o};i.onTick&&i.onTick(f),i.breakCondition&&i.breakCondition()&&(i.contextObservable.remove(r),i.onAborted&&i.onAborted(f)),e>=i.timeout&&(i.contextObservable.remove(r),i.onEnded&&i.onEnded(f))},i.observableParameters.mask,i.observableParameters.insertFirst,i.observableParameters.scope);return r}(function(i){i[i.INIT=0]="INIT",i[i.STARTED=1]="STARTED",i[i.ENDED=2]="ENDED"})(Yo||(Yo={}));var kD=function(){function i(t){var e,n,r=this;this.onEachCountObservable=new S.c,this.onTimerAbortedObservable=new S.c,this.onTimerEndedObservable=new S.c,this.onStateChangedObservable=new S.c,this._observer=null,this._breakOnNextTick=!1,this._tick=function(o){var u=Date.now();r._timer=u-r._startTime;var f={startTime:r._startTime,currentTime:u,deltaTime:r._timer,completeRate:r._timer/r._timeToEnd,payload:o},v=r._breakOnNextTick||r._breakCondition(f);v||r._timer>=r._timeToEnd?r._stop(f,v):r.onEachCountObservable.notifyObservers(f)},this._setState(Yo.INIT),this._contextObservable=t.contextObservable,this._observableParameters=(e=t.observableParameters)!==null&&e!==void 0?e:{},this._breakCondition=(n=t.breakCondition)!==null&&n!==void 0?n:function(){return!1},t.onEnded&&this.onTimerEndedObservable.add(t.onEnded),t.onTick&&this.onEachCountObservable.add(t.onTick),t.onAborted&&this.onTimerAbortedObservable.add(t.onAborted)}return Object.defineProperty(i.prototype,"breakCondition",{set:function(t){this._breakCondition=t},enumerable:!1,configurable:!0}),i.prototype.clearObservables=function(){this.onEachCountObservable.clear(),this.onTimerAbortedObservable.clear(),this.onTimerEndedObservable.clear(),this.onStateChangedObservable.clear()},i.prototype.start=function(t){if(t===void 0&&(t=this._timeToEnd),this._state===Yo.STARTED)throw new Error("Timer already started. Please stop it before starting again");this._timeToEnd=t,this._startTime=Date.now(),this._timer=0,this._observer=this._contextObservable.add(this._tick,this._observableParameters.mask,this._observableParameters.insertFirst,this._observableParameters.scope),this._setState(Yo.STARTED)},i.prototype.stop=function(){this._state===Yo.STARTED&&(this._breakOnNextTick=!0)},i.prototype.dispose=function(){this._observer&&this._contextObservable.remove(this._observer),this.clearObservables()},i.prototype._setState=function(t){this._state=t,this.onStateChangedObservable.notifyObservers(this._state)},i.prototype._stop=function(t,e){e===void 0&&(e=!1),this._contextObservable.remove(this._observer),this._setState(Yo.ENDED),e?this.onTimerAbortedObservable.notifyObservers(t):this.onTimerEndedObservable.notifyObservers(t)},i}(),ll=function(i){function t(e,n){var r=i.call(this,e)||this;return r._options=n,r._controllers={},r._snappedToPoint=!1,r._tmpRay=new Qn.a(new d.e,new d.e),r._tmpVector=new d.e,r._tmpQuaternion=new d.b,r.backwardsMovementEnabled=!0,r.backwardsTeleportationDistance=.7,r.parabolicCheckRadius=5,r.parabolicRayEnabled=!0,r.straightRayEnabled=!0,r.rotationAngle=Math.PI/8,r._rotationEnabled=!0,r._attachController=function(o){if(!(r._controllers[o.uniqueId]||r._options.forceHandedness&&o.inputSource.handedness!==r._options.forceHandedness)){r._controllers[o.uniqueId]={xrController:o,teleportationState:{forward:!1,backwards:!1,rotating:!1,currentRotation:0,baseRotation:0}};var u=r._controllers[o.uniqueId];if(u.xrController.inputSource.targetRayMode==="tracked-pointer"&&u.xrController.inputSource.gamepad){var f=function(){if(o.motionController){var v=o.motionController.getComponentOfType(As.THUMBSTICK_TYPE)||o.motionController.getComponentOfType(As.TOUCHPAD_TYPE);if(!v||r._options.useMainComponentOnly){var y=o.motionController.getMainComponent();if(!y)return;u.teleportationComponent=y,u.onButtonChangedObserver=y.onButtonStateChangedObservable.add(function(){y.changes.pressed&&(y.changes.pressed.current?(u.teleportationState.forward=!0,r._currentTeleportationControllerId=u.xrController.uniqueId,u.teleportationState.baseRotation=r._options.xrInput.xrCamera.rotationQuaternion.toEulerAngles().y,u.teleportationState.currentRotation=0,om({timeout:r._options.timeToTeleport||3e3,contextObservable:r._xrSessionManager.onXRFrameObservable,breakCondition:function(){return!y.pressed},onEnded:function(){r._currentTeleportationControllerId===u.xrController.uniqueId&&u.teleportationState.forward&&r._teleportForward(o.uniqueId)}})):(u.teleportationState.forward=!1,r._currentTeleportationControllerId=""))})}else u.teleportationComponent=v,u.onAxisChangedObserver=v.onAxisValueChangedObservable.add(function(D){if(D.y<=.7&&u.teleportationState.backwards&&(u.teleportationState.backwards=!1),D.y>.7&&!u.teleportationState.forward&&r.backwardsMovementEnabled&&!r.snapPointsOnly&&!u.teleportationState.backwards){u.teleportationState.backwards=!0,r._tmpQuaternion.copyFrom(r._options.xrInput.xrCamera.rotationQuaternion),r._tmpQuaternion.toEulerAnglesToRef(r._tmpVector),r._tmpVector.x=0,r._tmpVector.z=0,d.b.FromEulerVectorToRef(r._tmpVector,r._tmpQuaternion),r._tmpVector.set(0,0,r.backwardsTeleportationDistance*(r._xrSessionManager.scene.useRightHandedSystem?1:-1)),r._tmpVector.rotateByQuaternionToRef(r._tmpQuaternion,r._tmpVector),r._tmpVector.addInPlace(r._options.xrInput.xrCamera.position),r._tmpRay.origin.copyFrom(r._tmpVector),r._tmpRay.length=r._options.xrInput.xrCamera.realWorldHeight+.1,r._tmpRay.direction.set(0,-1,0);var w=r._xrSessionManager.scene.pickWithRay(r._tmpRay,function(z){return r._floorMeshes.indexOf(z)!==-1});w&&w.pickedPoint&&(r._options.xrInput.xrCamera.position.x=w.pickedPoint.x,r._options.xrInput.xrCamera.position.z=w.pickedPoint.z)}if(D.y<-.7&&!r._currentTeleportationControllerId&&!u.teleportationState.rotating&&(u.teleportationState.forward=!0,r._currentTeleportationControllerId=u.xrController.uniqueId,u.teleportationState.baseRotation=r._options.xrInput.xrCamera.rotationQuaternion.toEulerAngles().y),D.x){if(u.teleportationState.forward)r._currentTeleportationControllerId===u.xrController.uniqueId&&(r.rotationEnabled?setTimeout(function(){u.teleportationState.currentRotation=Math.atan2(D.x,D.y*(r._xrSessionManager.scene.useRightHandedSystem?1:-1))}):u.teleportationState.currentRotation=0);else if(!u.teleportationState.rotating&&Math.abs(D.x)>.7){u.teleportationState.rotating=!0;var F=r.rotationAngle*(D.x>0?1:-1)*(r._xrSessionManager.scene.useRightHandedSystem?-1:1);r._options.xrInput.xrCamera.rotationQuaternion.multiplyInPlace(d.b.FromEulerAngles(0,F,0))}}else u.teleportationState.rotating=!1;D.x===0&&D.y===0&&u.teleportationState.forward&&r._teleportForward(o.uniqueId)})}};o.motionController?f():o.onMotionControllerInitObservable.addOnce(function(){f()})}else r._xrSessionManager.scene.onPointerObservable.add(function(v){v.type===Ot.a.POINTERDOWN?(u.teleportationState.forward=!0,r._currentTeleportationControllerId=u.xrController.uniqueId,u.teleportationState.baseRotation=r._options.xrInput.xrCamera.rotationQuaternion.toEulerAngles().y,u.teleportationState.currentRotation=0,om({timeout:r._options.timeToTeleport||3e3,contextObservable:r._xrSessionManager.onXRFrameObservable,onEnded:function(){r._currentTeleportationControllerId===u.xrController.uniqueId&&u.teleportationState.forward&&r._teleportForward(o.uniqueId)}})):v.type===Ot.a.POINTERUP&&(u.teleportationState.forward=!1,r._currentTeleportationControllerId="")})}},r._options.teleportationTargetMesh||r._createDefaultTargetMesh(),r._floorMeshes=r._options.floorMeshes||[],r._snapToPositions=r._options.snapPositions||[],r._setTargetMeshVisibility(!1),r}return Object(p.d)(t,i),Object.defineProperty(t.prototype,"rotationEnabled",{get:function(){return this._rotationEnabled},set:function(e){if(this._rotationEnabled=e,this._options.teleportationTargetMesh){var n=this._options.teleportationTargetMesh.getChildMeshes(!1,function(r){return r.name==="rotationCone"});n[0]&&n[0].setEnabled(e)}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"teleportationTargetMesh",{get:function(){return this._options.teleportationTargetMesh||null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"snapPointsOnly",{get:function(){return!!this._options.snapPointsOnly},set:function(e){this._options.snapPointsOnly=e},enumerable:!1,configurable:!0}),t.prototype.addFloorMesh=function(e){this._floorMeshes.push(e)},t.prototype.addSnapPoint=function(e){this._snapToPositions.push(e)},t.prototype.attach=function(){var e=this;return!!i.prototype.attach.call(this)&&(this._currentTeleportationControllerId="",this._options.xrInput.controllers.forEach(this._attachController),this._addNewAttachObserver(this._options.xrInput.onControllerAddedObservable,this._attachController),this._addNewAttachObserver(this._options.xrInput.onControllerRemovedObservable,function(n){e._detachController(n.uniqueId)}),!0)},t.prototype.detach=function(){var e=this;return!!i.prototype.detach.call(this)&&(Object.keys(this._controllers).forEach(function(n){e._detachController(n)}),this._setTargetMeshVisibility(!1),this._currentTeleportationControllerId="",this._controllers={},!0)},t.prototype.dispose=function(){i.prototype.dispose.call(this),this._options.teleportationTargetMesh&&this._options.teleportationTargetMesh.dispose(!1,!0)},t.prototype.removeFloorMesh=function(e){var n=this._floorMeshes.indexOf(e);n!==-1&&this._floorMeshes.splice(n,1)},t.prototype.removeFloorMeshByName=function(e){var n=this._xrSessionManager.scene.getMeshByName(e);n&&this.removeFloorMesh(n)},t.prototype.removeSnapPoint=function(e){var n=this._snapToPositions.indexOf(e);if(n===-1){for(var r=0;r<this._snapToPositions.length;++r)if(this._snapToPositions[r].equals(e)){n=r;break}}return n!==-1&&(this._snapToPositions.splice(n,1),!0)},t.prototype.setSelectionFeature=function(e){this._selectionFeature=e},t.prototype._onXRFrame=function(e){var n=this,r=this._xrSessionManager.currentFrame,o=this._xrSessionManager.scene;if(this.attach&&r){var u=this._options.teleportationTargetMesh;if(this._currentTeleportationControllerId){if(!u)return;u.rotationQuaternion=u.rotationQuaternion||new d.b;var f=this._controllers[this._currentTeleportationControllerId];if(f&&f.teleportationState.forward){d.b.RotationYawPitchRollToRef(f.teleportationState.currentRotation+f.teleportationState.baseRotation,0,0,u.rotationQuaternion);var v=!1;if(f.xrController.getWorldPointerRayToRef(this._tmpRay),this.straightRayEnabled){if((y=o.pickWithRay(this._tmpRay,function(z){if(n._options.pickBlockerMeshes&&n._options.pickBlockerMeshes.indexOf(z)!==-1)return!0;var k=n._floorMeshes.indexOf(z);return k!==-1&&n._floorMeshes[k].absolutePosition.y<n._options.xrInput.xrCamera.position.y}))&&y.pickedMesh&&this._options.pickBlockerMeshes&&this._options.pickBlockerMeshes.indexOf(y.pickedMesh)!==-1)return;y&&y.pickedPoint&&(v=!0,this._setTargetMeshPosition(y.pickedPoint),this._setTargetMeshVisibility(!0),this._showParabolicPath(y))}if(this.parabolicRayEnabled&&!v){var y,D=f.xrController.pointer.rotationQuaternion.toEulerAngles().x,w=Math.PI/2-Math.abs(D)+1,F=this.parabolicCheckRadius*w;if(this._tmpRay.origin.addToRef(this._tmpRay.direction.scale(2*F),this._tmpVector),this._tmpVector.y=this._tmpRay.origin.y,this._tmpRay.origin.addInPlace(this._tmpRay.direction.scale(F)),this._tmpVector.subtractToRef(this._tmpRay.origin,this._tmpRay.direction),this._tmpRay.direction.normalize(),(y=o.pickWithRay(this._tmpRay,function(z){return!(!n._options.pickBlockerMeshes||n._options.pickBlockerMeshes.indexOf(z)===-1)||n._floorMeshes.indexOf(z)!==-1}))&&y.pickedMesh&&this._options.pickBlockerMeshes&&this._options.pickBlockerMeshes.indexOf(y.pickedMesh)!==-1)return;y&&y.pickedPoint&&(v=!0,this._setTargetMeshPosition(y.pickedPoint),this._setTargetMeshVisibility(!0),this._showParabolicPath(y))}this._setTargetMeshVisibility(v)}else this._setTargetMeshVisibility(!1)}else this._setTargetMeshVisibility(!1)}},t.prototype._createDefaultTargetMesh=function(){this._options.defaultTargetMeshOptions=this._options.defaultTargetMeshOptions||{};var e=this._options.useUtilityLayer?this._options.customUtilityLayerScene||Ir.a.DefaultUtilityLayer.utilityLayerScene:this._xrSessionManager.scene,n=Go.CreateGround("teleportationTarget",{width:2,height:2,subdivisions:2},e);n.isPickable=!1;var r=new io.a("teleportationPlaneDynamicTexture",512,e,!0);r.hasAlpha=!0;var o=r.getContext();o.beginPath(),o.arc(256,256,200,0,2*Math.PI,!1),o.fillStyle=this._options.defaultTargetMeshOptions.teleportationFillColor||"#444444",o.fill(),o.lineWidth=10,o.strokeStyle=this._options.defaultTargetMeshOptions.teleportationBorderColor||"#FFFFFF",o.stroke(),o.closePath(),r.update();var u=new on.a("teleportationPlaneMaterial",e);u.diffuseTexture=r,n.material=u;var f=ms.CreateTorus("torusTeleportation",{diameter:.75,thickness:.1,tessellation:20},e);if(f.isPickable=!1,f.parent=n,!this._options.defaultTargetMeshOptions.disableAnimation){var v=new H("animationInnerCircle","position.y",30,H.ANIMATIONTYPE_FLOAT,H.ANIMATIONLOOPMODE_CYCLE),y=[];y.push({frame:0,value:0}),y.push({frame:30,value:.4}),y.push({frame:60,value:0}),v.setKeys(y);var D=new fn;D.setEasingMode(Ke.EASINGMODE_EASEINOUT),v.setEasingFunction(D),f.animations=[],f.animations.push(v),e.beginAnimation(f,0,60,!0)}var w=zi.a.CreateCylinder("rotationCone",{diameterTop:0,tessellation:4},e);if(w.isPickable=!1,w.scaling.set(.5,.12,.2),w.rotate(Se.a.X,Math.PI/2),w.position.z=.6,w.parent=f,this._options.defaultTargetMeshOptions.torusArrowMaterial)f.material=this._options.defaultTargetMeshOptions.torusArrowMaterial,w.material=this._options.defaultTargetMeshOptions.torusArrowMaterial;else{var F=new on.a("torusConsMat",e);F.disableLighting=!!this._options.defaultTargetMeshOptions.disableLighting,F.disableLighting?F.emissiveColor=new M.a(.3,.3,1):F.diffuseColor=new M.a(.3,.3,1),F.alpha=.9,f.material=F,w.material=F,this._teleportationRingMaterial=F}this._options.renderingGroupId!==void 0&&(n.renderingGroupId=this._options.renderingGroupId,f.renderingGroupId=this._options.renderingGroupId,w.renderingGroupId=this._options.renderingGroupId),this._options.teleportationTargetMesh=n},t.prototype._detachController=function(e){var n=this._controllers[e];n&&(n.teleportationComponent&&(n.onAxisChangedObserver&&n.teleportationComponent.onAxisValueChangedObservable.remove(n.onAxisChangedObserver),n.onButtonChangedObserver&&n.teleportationComponent.onButtonStateChangedObservable.remove(n.onButtonChangedObserver)),delete this._controllers[e])},t.prototype._findClosestSnapPointWithRadius=function(e,n){n===void 0&&(n=this._options.snapToPositionRadius||.8);var r=null,o=Number.MAX_VALUE;if(this._snapToPositions.length){var u=n*n;this._snapToPositions.forEach(function(f){var v=d.e.DistanceSquared(f,e);v<=u&&v<o&&(o=v,r=f)})}return r},t.prototype._setTargetMeshPosition=function(e){if(this._options.teleportationTargetMesh){var n=this._findClosestSnapPointWithRadius(e);this._snappedToPoint=!!n,this.snapPointsOnly&&!this._snappedToPoint&&this._teleportationRingMaterial?this._teleportationRingMaterial.diffuseColor.set(1,.3,.3):this.snapPointsOnly&&this._snappedToPoint&&this._teleportationRingMaterial&&this._teleportationRingMaterial.diffuseColor.set(.3,.3,1),this._options.teleportationTargetMesh.position.copyFrom(n||e),this._options.teleportationTargetMesh.position.y+=.01}},t.prototype._setTargetMeshVisibility=function(e){this._options.teleportationTargetMesh&&this._options.teleportationTargetMesh.isVisible!==e&&(this._options.teleportationTargetMesh.isVisible=e,this._options.teleportationTargetMesh.getChildren(void 0,!1).forEach(function(n){n.isVisible=e}),e?this._selectionFeature&&this._selectionFeature.detach():(this._quadraticBezierCurve&&(this._quadraticBezierCurve.dispose(),this._quadraticBezierCurve=null),this._selectionFeature&&this._selectionFeature.attach()))},t.prototype._showParabolicPath=function(e){if(e.pickedPoint){var n=this._controllers[this._currentTeleportationControllerId],r=nt.d.CreateQuadraticBezier(n.xrController.pointer.absolutePosition,e.ray.origin,e.pickedPoint,25);this._options.generateRayPathMesh?this._quadraticBezierCurve=this._options.generateRayPathMesh(r.getPoints()):this._quadraticBezierCurve=Jn.a.CreateLines("teleportation path line",{points:r.getPoints(),instance:this._quadraticBezierCurve,updatable:!0}),this._quadraticBezierCurve.isPickable=!1}},t.prototype._teleportForward=function(e){var n=this._controllers[e];if(n&&n.teleportationState.forward&&(n.teleportationState.forward=!1,this._currentTeleportationControllerId="",(!this.snapPointsOnly||this._snappedToPoint)&&this._options.teleportationTargetMesh&&this._options.teleportationTargetMesh.isVisible)){var r=this._options.xrInput.xrCamera.realWorldHeight;this._options.xrInput.xrCamera.onBeforeCameraTeleport.notifyObservers(this._options.xrInput.xrCamera.position),this._options.xrInput.xrCamera.position.copyFrom(this._options.teleportationTargetMesh.position),this._options.xrInput.xrCamera.position.y+=r,this._options.xrInput.xrCamera.rotationQuaternion.multiplyInPlace(d.b.FromEulerAngles(0,n.teleportationState.currentRotation-(this._xrSessionManager.scene.useRightHandedSystem?Math.PI:0),0)),this._options.xrInput.xrCamera.onAfterCameraTeleport.notifyObservers(this._options.xrInput.xrCamera.position)}},t.Name=Si.TELEPORTATION,t.Version=1,t}(xi);hi.AddWebXRFeature(ll.Name,function(i,t){return function(){return new ll(i,t)}},ll.Version,!0);var jD=function(){},p0=function(){function i(){}return i.CreateAsync=function(t,e){e===void 0&&(e={});var n=new i;return c0.CreateAsync(t).then(function(r){if(n.baseExperience=r,e.ignoreNativeCameraTransformation&&(n.baseExperience.camera.compensateOnFirstFrame=!1),n.input=new h0(r.sessionManager,r.camera,Object(p.a)({controllerOptions:{renderingGroupId:e.renderingGroupId}},e.inputOptions||{})),n.pointerSelection=n.baseExperience.featuresManager.enableFeature(cl.Name,e.useStablePlugins?"stable":"latest",{xrInput:n.input,renderingGroupId:e.renderingGroupId}),e.disableTeleportation||(n.teleportation=n.baseExperience.featuresManager.enableFeature(ll.Name,e.useStablePlugins?"stable":"latest",{floorMeshes:e.floorMeshes,xrInput:n.input,renderingGroupId:e.renderingGroupId}),n.teleportation.setSelectionFeature(n.pointerSelection)),n.renderTarget=n.baseExperience.sessionManager.getWebXRRenderTarget(e.outputCanvasOptions),!e.disableDefaultUI){var o=Object(p.a)({renderTarget:n.renderTarget},e.uiOptions||{});return e.optionalFeatures&&(typeof e.optionalFeatures=="boolean"?o.optionalFeatures=["hit-test","anchors","plane-detection","hand-tracking"]:o.optionalFeatures=e.optionalFeatures),f0.CreateAsync(t,n.baseExperience,o).then(function(u){n.enterExitUI=u})}}).then(function(){return n}).catch(function(r){return _.a.Error("Error initializing XR"),_.a.Error(r),n})},i.prototype.dispose=function(){this.baseExperience&&this.baseExperience.dispose(),this.input&&this.input.dispose(),this.enterExitUI&&this.enterExitUI.dispose(),this.renderTarget&&this.renderTarget.dispose()},i}(),zD=!0;he.a.prototype.createDefaultLight=function(i){if(i===void 0&&(i=!1),i&&this.lights)for(var t=0;t<this.lights.length;t++)this.lights[t].dispose();this.lights.length===0&&new eh.a("default light",d.e.Up(),this)},he.a.prototype.createDefaultCamera=function(i,t,e){if(i===void 0&&(i=!1),t===void 0&&(t=!1),e===void 0&&(e=!1),t&&this.activeCamera&&(this.activeCamera.dispose(),this.activeCamera=null),!this.activeCamera){var n,r=this.getWorldExtends(function(w){return w.isVisible&&w.isEnabled()}),o=r.max.subtract(r.min),u=r.min.add(o.scale(.5)),f=1.5*o.length();if(isFinite(f)||(f=1,u.copyFromFloats(0,0,0)),i){var v=new Vi("default camera",-Math.PI/2,Math.PI/2,f,u,this);v.lowerRadiusLimit=.01*f,v.wheelPrecision=100/f,n=v}else{var y=new Cr("default camera",new d.e(u.x,u.y,-f),this);y.setTarget(u),n=y}n.minZ=.01*f,n.maxZ=1e3*f,n.speed=.2*f,this.activeCamera=n;var D=this.getEngine().getInputElement();e&&D&&n.attachControl()}},he.a.prototype.createDefaultCameraOrLight=function(i,t,e){i===void 0&&(i=!1),t===void 0&&(t=!1),e===void 0&&(e=!1),this.createDefaultLight(t),this.createDefaultCamera(i,t,e)},he.a.prototype.createDefaultSkybox=function(i,t,e,n,r){if(t===void 0&&(t=!1),e===void 0&&(e=1e3),n===void 0&&(n=0),r===void 0&&(r=!0),!i)return _.a.Warn("Can not create default skybox without environment texture."),null;r&&i&&(this.environmentTexture=i);var o=Ne.a.CreateBox("hdrSkyBox",e,this);if(t){var u=new sl("skyBox",this);u.backFaceCulling=!1,u.reflectionTexture=i.clone(),u.reflectionTexture&&(u.reflectionTexture.coordinatesMode=ke.a.SKYBOX_MODE),u.microSurface=1-n,u.disableLighting=!0,u.twoSidedLighting=!0,o.infiniteDistance=!0,o.material=u}else{var f=new on.a("skyBox",this);f.backFaceCulling=!1,f.reflectionTexture=i.clone(),f.reflectionTexture&&(f.reflectionTexture.coordinatesMode=ke.a.SKYBOX_MODE),f.disableLighting=!0,o.infiniteDistance=!0,o.material=f}return o.isPickable=!1,o},he.a.prototype.createDefaultEnvironment=function(i){return $p?new $p(i,this):null},he.a.prototype.createDefaultVRExperience=function(i){return i===void 0&&(i={}),new Ny(this,i)},he.a.prototype.createDefaultXRExperienceAsync=function(i){return i===void 0&&(i={}),p0.CreateAsync(this,i).then(function(t){return t})};var m0=function(i){function t(e,n,r,o,u,f,v){o===void 0&&(o=!1),u===void 0&&(u=!1),f===void 0&&(f=ke.a.TRILINEAR_SAMPLINGMODE),v===void 0&&(v={autoPlay:!0,loop:!0,autoUpdateTexture:!0});var y=i.call(this,null,r,!o,u)||this;y._onUserActionRequestedObservable=null,y._stillImageCaptured=!1,y._displayingPosterTexture=!1,y._frameId=-1,y._currentSrc=null,y._createInternalTexture=function(){if(y._texture!=null){if(!y._displayingPosterTexture)return;y._texture.dispose(),y._displayingPosterTexture=!1}if(!y._getEngine().needPOTTextures||et.b.IsExponentOfTwo(y.video.videoWidth)&&et.b.IsExponentOfTwo(y.video.videoHeight)?(y.wrapU=ke.a.WRAP_ADDRESSMODE,y.wrapV=ke.a.WRAP_ADDRESSMODE):(y.wrapU=ke.a.CLAMP_ADDRESSMODE,y.wrapV=ke.a.CLAMP_ADDRESSMODE,y._generateMipMaps=!1),y._texture=y._getEngine().createDynamicTexture(y.video.videoWidth,y.video.videoHeight,y._generateMipMaps,y.samplingMode),y.video.autoplay||y._settings.poster)y._texture.isReady=!0,y._updateInternalTexture(),y.onLoadObservable.hasObservers()&&y.onLoadObservable.notifyObservers(y);else{var w=y.video.onplaying,F=!1,z=y.video.muted;y.video.muted=!0,y.video.onplaying=function(){y.video.muted=z,y.video.onplaying=w,y._texture.isReady=!0,y._updateInternalTexture(),F||y.video.pause(),y.onLoadObservable.hasObservers()&&y.onLoadObservable.notifyObservers(y)};var k=y.video.play();k?k.then(function(){}).catch(function(){F=!0,y._onUserActionRequestedObservable&&y._onUserActionRequestedObservable.hasObservers()&&y._onUserActionRequestedObservable.notifyObservers(y)}):(y.video.onplaying=w,y._texture.isReady=!0,y._updateInternalTexture(),y.onLoadObservable.hasObservers()&&y.onLoadObservable.notifyObservers(y))}},y.reset=function(){y._texture!=null&&(y._displayingPosterTexture||(y._texture.dispose(),y._texture=null))},y._updateInternalTexture=function(){if(y._texture!=null&&y._texture.isReady&&!(y.video.readyState<y.video.HAVE_CURRENT_DATA||y._displayingPosterTexture)){var w=y.getScene().getFrameId();y._frameId!==w&&(y._frameId=w,y._getEngine().updateVideoTexture(y._texture,y.video,y._invertY))}},y._generateMipMaps=o,y._initialSamplingMode=f,y.autoUpdateTexture=v.autoUpdateTexture,y._currentSrc=n,y.name=e||y._getName(n),y.video=y._getVideo(n),y._settings=v,v.poster&&(y.video.poster=v.poster),v.autoPlay!==void 0&&(y.video.autoplay=v.autoPlay),v.loop!==void 0&&(y.video.loop=v.loop),v.muted!==void 0&&(y.video.muted=v.muted),y.video.setAttribute("playsinline",""),y.video.addEventListener("paused",y._updateInternalTexture),y.video.addEventListener("seeked",y._updateInternalTexture),y.video.addEventListener("emptied",y.reset),y._createInternalTextureOnEvent=v.poster&&!v.autoPlay?"play":"canplay",y.video.addEventListener(y._createInternalTextureOnEvent,y._createInternalTexture),v.autoPlay&&y.video.play();var D=y.video.readyState>=y.video.HAVE_CURRENT_DATA;return!v.poster||v.autoPlay&&D?D&&y._createInternalTexture():(y._texture=y._getEngine().createTexture(v.poster,!1,!y.invertY,r),y._displayingPosterTexture=!0),y}return Object(p.d)(t,i),Object.defineProperty(t.prototype,"onUserActionRequestedObservable",{get:function(){return this._onUserActionRequestedObservable||(this._onUserActionRequestedObservable=new S.c),this._onUserActionRequestedObservable},enumerable:!1,configurable:!0}),t.prototype._getName=function(e){return e instanceof HTMLVideoElement?e.currentSrc:typeof e=="object"?e.toString():e},t.prototype._getVideo=function(e){if(e instanceof HTMLVideoElement)return et.b.SetCorsBehavior(e.currentSrc,e),e;var n=document.createElement("video");return typeof e=="string"?(et.b.SetCorsBehavior(e,n),n.src=e):(et.b.SetCorsBehavior(e[0],n),e.forEach(function(r){var o=document.createElement("source");o.src=r,n.appendChild(o)})),n},t.prototype._rebuild=function(){this.update()},t.prototype.update=function(){this.autoUpdateTexture&&this.updateTexture(!0)},t.prototype.updateTexture=function(e){e&&(this.video.paused&&this._stillImageCaptured||(this._stillImageCaptured=!0,this._updateInternalTexture()))},t.prototype.updateURL=function(e){this.video.src=e,this._currentSrc=e},t.prototype.clone=function(){return new t(this.name,this._currentSrc,this.getScene(),this._generateMipMaps,this.invertY,this.samplingMode,this._settings)},t.prototype.dispose=function(){i.prototype.dispose.call(this),this._currentSrc=null,this._onUserActionRequestedObservable&&(this._onUserActionRequestedObservable.clear(),this._onUserActionRequestedObservable=null),this.video.removeEventListener(this._createInternalTextureOnEvent,this._createInternalTexture),this.video.removeEventListener("paused",this._updateInternalTexture),this.video.removeEventListener("seeked",this._updateInternalTexture),this.video.removeEventListener("emptied",this.reset),this.video.pause()},t.CreateFromStreamAsync=function(e,n){var r=document.createElement("video");return e.getEngine()._badOS&&(document.body.appendChild(r),r.style.transform="scale(0.0001, 0.0001)",r.style.opacity="0",r.style.position="fixed",r.style.bottom="0px",r.style.right="0px"),r.setAttribute("autoplay",""),r.setAttribute("muted","true"),r.setAttribute("playsinline",""),r.muted=!0,r.mozSrcObject!==void 0?r.mozSrcObject=n:typeof r.srcObject=="object"?r.srcObject=n:(window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL,r.src=window.URL&&window.URL.createObjectURL(n)),new Promise(function(o){var u=function(){o(new t("video",r,e,!0,!0)),r.removeEventListener("playing",u)};r.addEventListener("playing",u),r.play()})},t.CreateFromWebCamAsync=function(e,n,r){var o,u=this;return r===void 0&&(r=!1),n&&n.deviceId&&(o={exact:n.deviceId}),navigator.mediaDevices?navigator.mediaDevices.getUserMedia({video:n,audio:r}).then(function(f){return u.CreateFromStreamAsync(e,f)}):(navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.getUserMedia&&navigator.getUserMedia({video:{deviceId:o,width:{min:n&&n.minWidth||256,max:n&&n.maxWidth||640},height:{min:n&&n.minHeight||256,max:n&&n.maxHeight||480}},audio:r},function(f){return u.CreateFromStreamAsync(e,f)},function(f){_.a.Error(f.name)}),Promise.reject("No support for userMedia on this device"))},t.CreateFromWebCam=function(e,n,r,o){o===void 0&&(o=!1),this.CreateFromWebCamAsync(e,r,o).then(function(u){n&&n(u)}).catch(function(u){_.a.Error(u.name)})},t}(ke.a),GD=function(i){function t(){return i!==null&&i.apply(this,arguments)||this}return Object(p.d)(t,i),Object.defineProperty(t.prototype,"videoTexture",{get:function(){return this._texture},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"videoMode",{get:function(){return this.textureMode},set:function(e){this.textureMode=e},enumerable:!1,configurable:!0}),t.prototype._initTexture=function(e,n,r){var o=this,u={loop:r.loop,autoPlay:r.autoPlay,autoUpdateTexture:!0,poster:r.poster},f=new m0((this.name||"videoDome")+"_texture",e,n,r.generateMipMaps,this._useDirectMapping,ke.a.TRILINEAR_SAMPLINGMODE,u);return r.clickToPlay&&(n.onPointerUp=function(){o._texture.video.play()}),f},t.MODE_MONOSCOPIC=Wo.MODE_MONOSCOPIC,t.MODE_TOPBOTTOM=Wo.MODE_TOPBOTTOM,t.MODE_SIDEBYSIDE=Wo.MODE_SIDEBYSIDE,t}(Wo),Jr=c(55),HD=function(){function i(t){this.engine=t,this._captureGPUFrameTime=!1,this._gpuFrameTime=new Jr.a,this._captureShaderCompilationTime=!1,this._shaderCompilationTime=new Jr.a,this._onBeginFrameObserver=null,this._onEndFrameObserver=null,this._onBeforeShaderCompilationObserver=null,this._onAfterShaderCompilationObserver=null}return Object.defineProperty(i.prototype,"gpuFrameTimeCounter",{get:function(){return this._gpuFrameTime},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"captureGPUFrameTime",{get:function(){return this._captureGPUFrameTime},set:function(t){var e=this;t!==this._captureGPUFrameTime&&(this._captureGPUFrameTime=t,t?(this._onBeginFrameObserver=this.engine.onBeginFrameObservable.add(function(){e._gpuFrameTimeToken||(e._gpuFrameTimeToken=e.engine.startTimeQuery())}),this._onEndFrameObserver=this.engine.onEndFrameObservable.add(function(){if(e._gpuFrameTimeToken){var n=e.engine.endTimeQuery(e._gpuFrameTimeToken);n>-1&&(e._gpuFrameTimeToken=null,e._gpuFrameTime.fetchNewFrame(),e._gpuFrameTime.addCount(n,!0))}})):(this.engine.onBeginFrameObservable.remove(this._onBeginFrameObserver),this._onBeginFrameObserver=null,this.engine.onEndFrameObservable.remove(this._onEndFrameObserver),this._onEndFrameObserver=null))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"shaderCompilationTimeCounter",{get:function(){return this._shaderCompilationTime},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"captureShaderCompilationTime",{get:function(){return this._captureShaderCompilationTime},set:function(t){var e=this;t!==this._captureShaderCompilationTime&&(this._captureShaderCompilationTime=t,t?(this._onBeforeShaderCompilationObserver=this.engine.onBeforeShaderCompilationObservable.add(function(){e._shaderCompilationTime.fetchNewFrame(),e._shaderCompilationTime.beginMonitoring()}),this._onAfterShaderCompilationObserver=this.engine.onAfterShaderCompilationObservable.add(function(){e._shaderCompilationTime.endMonitoring()})):(this.engine.onBeforeShaderCompilationObservable.remove(this._onBeforeShaderCompilationObserver),this._onBeforeShaderCompilationObserver=null,this.engine.onAfterShaderCompilationObservable.remove(this._onAfterShaderCompilationObserver),this._onAfterShaderCompilationObserver=null))},enumerable:!1,configurable:!0}),i.prototype.dispose=function(){this.engine.onBeginFrameObservable.remove(this._onBeginFrameObserver),this._onBeginFrameObserver=null,this.engine.onEndFrameObservable.remove(this._onEndFrameObserver),this._onEndFrameObserver=null,this.engine.onBeforeShaderCompilationObservable.remove(this._onBeforeShaderCompilationObserver),this._onBeforeShaderCompilationObserver=null,this.engine.onAfterShaderCompilationObservable.remove(this._onAfterShaderCompilationObserver),this._onAfterShaderCompilationObserver=null,this.engine=null},i}(),WD=function(){function i(t){var e=this;this.scene=t,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new Jr.a,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new Jr.a,this._captureFrameTime=!1,this._frameTime=new Jr.a,this._captureRenderTime=!1,this._renderTime=new Jr.a,this._captureInterFrameTime=!1,this._interFrameTime=new Jr.a,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new Jr.a,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new Jr.a,this._capturePhysicsTime=!1,this._physicsTime=new Jr.a,this._captureAnimationsTime=!1,this._animationsTime=new Jr.a,this._captureCameraRenderTime=!1,this._cameraRenderTime=new Jr.a,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._onBeforeAnimationsObserver=t.onBeforeAnimationsObservable.add(function(){e._captureActiveMeshesEvaluationTime&&e._activeMeshesEvaluationTime.fetchNewFrame(),e._captureRenderTargetsRenderTime&&e._renderTargetsRenderTime.fetchNewFrame(),e._captureFrameTime&&(et.b.StartPerformanceCounter("Scene rendering"),e._frameTime.beginMonitoring()),e._captureInterFrameTime&&e._interFrameTime.endMonitoring(),e._captureParticlesRenderTime&&e._particlesRenderTime.fetchNewFrame(),e._captureSpritesRenderTime&&e._spritesRenderTime.fetchNewFrame(),e._captureAnimationsTime&&e._animationsTime.beginMonitoring(),e.scene.getEngine()._drawCalls.fetchNewFrame()}),this._onAfterRenderObserver=t.onAfterRenderObservable.add(function(){e._captureFrameTime&&(et.b.EndPerformanceCounter("Scene rendering"),e._frameTime.endMonitoring()),e._captureRenderTime&&e._renderTime.endMonitoring(!1),e._captureInterFrameTime&&e._interFrameTime.beginMonitoring()})}return Object.defineProperty(i.prototype,"activeMeshesEvaluationTimeCounter",{get:function(){return this._activeMeshesEvaluationTime},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"captureActiveMeshesEvaluationTime",{get:function(){return this._captureActiveMeshesEvaluationTime},set:function(t){var e=this;t!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=t,t?(this._onBeforeActiveMeshesEvaluationObserver=this.scene.onBeforeActiveMeshesEvaluationObservable.add(function(){et.b.StartPerformanceCounter("Active meshes evaluation"),e._activeMeshesEvaluationTime.beginMonitoring()}),this._onAfterActiveMeshesEvaluationObserver=this.scene.onAfterActiveMeshesEvaluationObservable.add(function(){et.b.EndPerformanceCounter("Active meshes evaluation"),e._activeMeshesEvaluationTime.endMonitoring()})):(this.scene.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.scene.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"renderTargetsRenderTimeCounter",{get:function(){return this._renderTargetsRenderTime},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"captureRenderTargetsRenderTime",{get:function(){return this._captureRenderTargetsRenderTime},set:function(t){var e=this;t!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=t,t?(this._onBeforeRenderTargetsRenderObserver=this.scene.onBeforeRenderTargetsRenderObservable.add(function(){et.b.StartPerformanceCounter("Render targets rendering"),e._renderTargetsRenderTime.beginMonitoring()}),this._onAfterRenderTargetsRenderObserver=this.scene.onAfterRenderTargetsRenderObservable.add(function(){et.b.EndPerformanceCounter("Render targets rendering"),e._renderTargetsRenderTime.endMonitoring(!1)})):(this.scene.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.scene.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"particlesRenderTimeCounter",{get:function(){return this._particlesRenderTime},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"captureParticlesRenderTime",{get:function(){return this._captureParticlesRenderTime},set:function(t){var e=this;t!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=t,t?(this._onBeforeParticlesRenderingObserver=this.scene.onBeforeParticlesRenderingObservable.add(function(){et.b.StartPerformanceCounter("Particles"),e._particlesRenderTime.beginMonitoring()}),this._onAfterParticlesRenderingObserver=this.scene.onAfterParticlesRenderingObservable.add(function(){et.b.EndPerformanceCounter("Particles"),e._particlesRenderTime.endMonitoring(!1)})):(this.scene.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.scene.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"spritesRenderTimeCounter",{get:function(){return this._spritesRenderTime},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"captureSpritesRenderTime",{get:function(){return this._captureSpritesRenderTime},set:function(t){var e=this;t!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=t,this.scene.spriteManagers&&(t?(this._onBeforeSpritesRenderingObserver=this.scene.onBeforeSpritesRenderingObservable.add(function(){et.b.StartPerformanceCounter("Sprites"),e._spritesRenderTime.beginMonitoring()}),this._onAfterSpritesRenderingObserver=this.scene.onAfterSpritesRenderingObservable.add(function(){et.b.EndPerformanceCounter("Sprites"),e._spritesRenderTime.endMonitoring(!1)})):(this.scene.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.scene.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"physicsTimeCounter",{get:function(){return this._physicsTime},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"capturePhysicsTime",{get:function(){return this._capturePhysicsTime},set:function(t){var e=this;t!==this._capturePhysicsTime&&this.scene.onBeforePhysicsObservable&&(this._capturePhysicsTime=t,t?(this._onBeforePhysicsObserver=this.scene.onBeforePhysicsObservable.add(function(){et.b.StartPerformanceCounter("Physics"),e._physicsTime.beginMonitoring()}),this._onAfterPhysicsObserver=this.scene.onAfterPhysicsObservable.add(function(){et.b.EndPerformanceCounter("Physics"),e._physicsTime.endMonitoring()})):(this.scene.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.scene.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"animationsTimeCounter",{get:function(){return this._animationsTime},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"captureAnimationsTime",{get:function(){return this._captureAnimationsTime},set:function(t){var e=this;t!==this._captureAnimationsTime&&(this._captureAnimationsTime=t,t?this._onAfterAnimationsObserver=this.scene.onAfterAnimationsObservable.add(function(){e._animationsTime.endMonitoring()}):(this.scene.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"frameTimeCounter",{get:function(){return this._frameTime},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"captureFrameTime",{get:function(){return this._captureFrameTime},set:function(t){this._captureFrameTime=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"interFrameTimeCounter",{get:function(){return this._interFrameTime},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"captureInterFrameTime",{get:function(){return this._captureInterFrameTime},set:function(t){this._captureInterFrameTime=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"renderTimeCounter",{get:function(){return this._renderTime},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"captureRenderTime",{get:function(){return this._captureRenderTime},set:function(t){var e=this;t!==this._captureRenderTime&&(this._captureRenderTime=t,t?(this._onBeforeDrawPhaseObserver=this.scene.onBeforeDrawPhaseObservable.add(function(){e._renderTime.beginMonitoring(),et.b.StartPerformanceCounter("Main render")}),this._onAfterDrawPhaseObserver=this.scene.onAfterDrawPhaseObservable.add(function(){e._renderTime.endMonitoring(!1),et.b.EndPerformanceCounter("Main render")})):(this.scene.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.scene.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"cameraRenderTimeCounter",{get:function(){return this._cameraRenderTime},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"captureCameraRenderTime",{get:function(){return this._captureCameraRenderTime},set:function(t){var e=this;t!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=t,t?(this._onBeforeCameraRenderObserver=this.scene.onBeforeCameraRenderObservable.add(function(n){e._cameraRenderTime.beginMonitoring(),et.b.StartPerformanceCounter("Rendering camera "+n.name)}),this._onAfterCameraRenderObserver=this.scene.onAfterCameraRenderObservable.add(function(n){e._cameraRenderTime.endMonitoring(!1),et.b.EndPerformanceCounter("Rendering camera "+n.name)})):(this.scene.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.scene.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"drawCallsCounter",{get:function(){return this.scene.getEngine()._drawCalls},enumerable:!1,configurable:!0}),i.prototype.dispose=function(){this.scene.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.scene.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.scene.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.scene.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.scene.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.scene.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.scene.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.scene.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.scene.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.scene.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.scene.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.scene.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.scene.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.scene.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.scene.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.scene.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.scene.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.scene=null},i}(),XD=`#ifdef DIFFUSE
varying vec2 vUVDiffuse;
uniform sampler2D diffuseSampler;
#endif
#ifdef OPACITY
varying vec2 vUVOpacity;
uniform sampler2D opacitySampler;
uniform float opacityIntensity;
#endif
#ifdef EMISSIVE
varying vec2 vUVEmissive;
uniform sampler2D emissiveSampler;
#endif
#ifdef VERTEXALPHA
varying vec4 vColor;
#endif
uniform vec4 glowColor;
void main(void)
{
vec4 finalColor=glowColor;

#ifdef DIFFUSE
vec4 albedoTexture=texture2D(diffuseSampler,vUVDiffuse);
#ifdef GLOW

finalColor.a*=albedoTexture.a;
#endif
#ifdef HIGHLIGHT

finalColor.a=albedoTexture.a;
#endif
#endif
#ifdef OPACITY
vec4 opacityMap=texture2D(opacitySampler,vUVOpacity);
#ifdef OPACITYRGB
finalColor.a*=getLuminance(opacityMap.rgb);
#else
finalColor.a*=opacityMap.a;
#endif
finalColor.a*=opacityIntensity;
#endif
#ifdef VERTEXALPHA
finalColor.a*=vColor.a;
#endif
#ifdef ALPHATEST
if (finalColor.a<ALPHATESTVALUE)
discard;
#endif
#ifdef EMISSIVE
gl_FragColor=texture2D(emissiveSampler,vUVEmissive)*finalColor;
#else
gl_FragColor=finalColor;
#endif
#ifdef HIGHLIGHT

gl_FragColor.a=glowColor.a;
#endif
}`;Ye.a.ShadersStore.glowMapGenerationPixelShader=XD;var YD=`
attribute vec3 position;
#include<bonesDeclaration>
#include<morphTargetsVertexGlobalDeclaration>
#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]

#include<instancesDeclaration>
uniform mat4 viewProjection;
varying vec4 vPosition;
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#ifdef DIFFUSE
varying vec2 vUVDiffuse;
uniform mat4 diffuseMatrix;
#endif
#ifdef OPACITY
varying vec2 vUVOpacity;
uniform mat4 opacityMatrix;
#endif
#ifdef EMISSIVE
varying vec2 vUVEmissive;
uniform mat4 emissiveMatrix;
#endif
#ifdef VERTEXALPHA
attribute vec4 color;
varying vec4 vColor;
#endif
void main(void)
{
vec3 positionUpdated=position;
#ifdef UV1
vec2 uvUpdated=uv;
#endif
#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]
#include<instancesVertex>
#include<bonesVertex>
#ifdef CUBEMAP
vPosition=finalWorld*vec4(positionUpdated,1.0);
gl_Position=viewProjection*finalWorld*vec4(position,1.0);
#else
vPosition=viewProjection*finalWorld*vec4(positionUpdated,1.0);
gl_Position=vPosition;
#endif
#ifdef DIFFUSE
#ifdef DIFFUSEUV1
vUVDiffuse=vec2(diffuseMatrix*vec4(uvUpdated,1.0,0.0));
#endif
#ifdef DIFFUSEUV2
vUVDiffuse=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));
#endif
#endif
#ifdef OPACITY
#ifdef OPACITYUV1
vUVOpacity=vec2(opacityMatrix*vec4(uvUpdated,1.0,0.0));
#endif
#ifdef OPACITYUV2
vUVOpacity=vec2(opacityMatrix*vec4(uv2,1.0,0.0));
#endif
#endif
#ifdef EMISSIVE
#ifdef EMISSIVEUV1
vUVEmissive=vec2(emissiveMatrix*vec4(uvUpdated,1.0,0.0));
#endif
#ifdef EMISSIVEUV2
vUVEmissive=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));
#endif
#endif
#ifdef VERTEXALPHA
vColor=color;
#endif
}`;Ye.a.ShadersStore.glowMapGenerationVertexShader=YD;var ul=function(){function i(t,e){this._vertexBuffers={},this._maxSize=0,this._mainTextureDesiredSize={width:0,height:0},this._shouldRender=!0,this._postProcesses=[],this._textures=[],this._emissiveTextureAndColor={texture:null,color:new M.b},this.neutralColor=new M.b,this.isEnabled=!0,this.disableBoundingBoxesFromEffectLayer=!1,this.onDisposeObservable=new S.c,this.onBeforeRenderMainTextureObservable=new S.c,this.onBeforeComposeObservable=new S.c,this.onBeforeRenderMeshToEffect=new S.c,this.onAfterRenderMeshToEffect=new S.c,this.onAfterComposeObservable=new S.c,this.onSizeChangedObservable=new S.c,this.name=t,this._scene=e||ne.a.LastCreatedScene,i._SceneComponentInitialization(this._scene),this._engine=this._scene.getEngine(),this._maxSize=this._engine.getCaps().maxTextureSize,this._scene.effectLayers.push(this),this._generateIndexBuffer(),this._generateVertexBuffer()}return Object.defineProperty(i.prototype,"camera",{get:function(){return this._effectLayerOptions.camera},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"renderingGroupId",{get:function(){return this._effectLayerOptions.renderingGroupId},set:function(t){this._effectLayerOptions.renderingGroupId=t},enumerable:!1,configurable:!0}),i.prototype._init=function(t){this._effectLayerOptions=Object(p.a)({mainTextureRatio:.5,alphaBlendingMode:g.a.ALPHA_COMBINE,camera:null,renderingGroupId:-1},t),this._setMainTextureSize(),this._createMainTexture(),this._createTextureAndPostProcesses(),this._mergeEffect=this._createMergeEffect()},i.prototype._generateIndexBuffer=function(){var t=[];t.push(0),t.push(1),t.push(2),t.push(0),t.push(2),t.push(3),this._indexBuffer=this._engine.createIndexBuffer(t)},i.prototype._generateVertexBuffer=function(){var t=[];t.push(1,1),t.push(-1,1),t.push(-1,-1),t.push(1,-1);var e=new De.b(this._engine,t,De.b.PositionKind,!1,!1,2);this._vertexBuffers[De.b.PositionKind]=e},i.prototype._setMainTextureSize=function(){this._effectLayerOptions.mainTextureFixedSize?(this._mainTextureDesiredSize.width=this._effectLayerOptions.mainTextureFixedSize,this._mainTextureDesiredSize.height=this._effectLayerOptions.mainTextureFixedSize):(this._mainTextureDesiredSize.width=this._engine.getRenderWidth()*this._effectLayerOptions.mainTextureRatio,this._mainTextureDesiredSize.height=this._engine.getRenderHeight()*this._effectLayerOptions.mainTextureRatio,this._mainTextureDesiredSize.width=this._engine.needPOTTextures?Ge.a.GetExponentOfTwo(this._mainTextureDesiredSize.width,this._maxSize):this._mainTextureDesiredSize.width,this._mainTextureDesiredSize.height=this._engine.needPOTTextures?Ge.a.GetExponentOfTwo(this._mainTextureDesiredSize.height,this._maxSize):this._mainTextureDesiredSize.height),this._mainTextureDesiredSize.width=Math.floor(this._mainTextureDesiredSize.width),this._mainTextureDesiredSize.height=Math.floor(this._mainTextureDesiredSize.height)},i.prototype._createMainTexture=function(){var t=this;this._mainTexture=new qn("HighlightLayerMainRTT",{width:this._mainTextureDesiredSize.width,height:this._mainTextureDesiredSize.height},this._scene,!1,!0,g.a.TEXTURETYPE_UNSIGNED_INT),this._mainTexture.activeCamera=this._effectLayerOptions.camera,this._mainTexture.wrapU=ke.a.CLAMP_ADDRESSMODE,this._mainTexture.wrapV=ke.a.CLAMP_ADDRESSMODE,this._mainTexture.anisotropicFilteringLevel=1,this._mainTexture.updateSamplingMode(ke.a.BILINEAR_SAMPLINGMODE),this._mainTexture.renderParticles=!1,this._mainTexture.renderList=null,this._mainTexture.ignoreCameraViewport=!0,this._mainTexture.customRenderFunction=function(n,r,o,u){var f;t.onBeforeRenderMainTextureObservable.notifyObservers(t);var v=t._scene.getEngine();if(u.length){for(v.setColorWrite(!1),f=0;f<u.length;f++)t._renderSubMesh(u.data[f]);v.setColorWrite(!0)}for(f=0;f<n.length;f++)t._renderSubMesh(n.data[f]);for(f=0;f<r.length;f++)t._renderSubMesh(r.data[f]);var y=v.getAlphaMode();for(f=0;f<o.length;f++)t._renderSubMesh(o.data[f],!0);v.setAlphaMode(y)},this._mainTexture.onClearObservable.add(function(n){n.clear(t.neutralColor,!0,!0,!0)});var e=this._scene.getBoundingBoxRenderer().enabled;this._mainTexture.onBeforeBindObservable.add(function(){t._scene.getBoundingBoxRenderer().enabled=!t.disableBoundingBoxesFromEffectLayer&&e}),this._mainTexture.onAfterUnbindObservable.add(function(){t._scene.getBoundingBoxRenderer().enabled=e})},i.prototype._addCustomEffectDefines=function(t){},i.prototype._isReady=function(t,e,n){var r=t.getMaterial();if(!r||!r.isReadyForSubMesh(t.getMesh(),t,e))return!1;var o=[],u=[De.b.PositionKind],f=t.getMesh(),v=!1,y=!1;if(r){var D=r.needAlphaTesting(),w=r.getAlphaTestTexture(),F=w&&w.hasAlpha&&(r.useAlphaFromDiffuseTexture||r._useAlphaFromAlbedoTexture);w&&(D||F)&&(o.push("#define DIFFUSE"),f.isVerticesDataPresent(De.b.UV2Kind)&&w.coordinatesIndex===1?(o.push("#define DIFFUSEUV2"),y=!0):f.isVerticesDataPresent(De.b.UVKind)&&(o.push("#define DIFFUSEUV1"),v=!0),D&&(o.push("#define ALPHATEST"),o.push("#define ALPHATESTVALUE 0.4")));var z=r.opacityTexture;z&&(o.push("#define OPACITY"),f.isVerticesDataPresent(De.b.UV2Kind)&&z.coordinatesIndex===1?(o.push("#define OPACITYUV2"),y=!0):f.isVerticesDataPresent(De.b.UVKind)&&(o.push("#define OPACITYUV1"),v=!0))}n&&(o.push("#define EMISSIVE"),f.isVerticesDataPresent(De.b.UV2Kind)&&n.coordinatesIndex===1?(o.push("#define EMISSIVEUV2"),y=!0):f.isVerticesDataPresent(De.b.UVKind)&&(o.push("#define EMISSIVEUV1"),v=!0)),f.isVerticesDataPresent(De.b.ColorKind)&&f.hasVertexAlpha&&(u.push(De.b.ColorKind),o.push("#define VERTEXALPHA")),v&&(u.push(De.b.UVKind),o.push("#define UV1")),y&&(u.push(De.b.UV2Kind),o.push("#define UV2"));var k=new Ts.a;if(f.useBones&&f.computeBonesUsingShaders){u.push(De.b.MatricesIndicesKind),u.push(De.b.MatricesWeightsKind),f.numBoneInfluencers>4&&(u.push(De.b.MatricesIndicesExtraKind),u.push(De.b.MatricesWeightsExtraKind)),o.push("#define NUM_BONE_INFLUENCERS "+f.numBoneInfluencers);var K=f.skeleton;K&&K.isUsingTextureForMatrices?o.push("#define BONETEXTURE"):o.push("#define BonesPerMesh "+(K?K.bones.length+1:0)),f.numBoneInfluencers>0&&k.addCPUSkinningFallback(0,f)}else o.push("#define NUM_BONE_INFLUENCERS 0");var oe=f.morphTargetManager,ae=0;oe&&oe.numInfluencers>0&&(o.push("#define MORPHTARGETS"),ae=oe.numInfluencers,o.push("#define NUM_MORPH_INFLUENCERS "+ae),lt.a.PrepareAttributesForMorphTargetsInfluencers(u,f,ae)),e&&(o.push("#define INSTANCES"),lt.a.PushAttributesForInstances(u),t.getRenderingMesh().hasThinInstances&&o.push("#define THIN_INSTANCES")),this._addCustomEffectDefines(o);var ue=o.join(`
`);return this._cachedDefines!==ue&&(this._cachedDefines=ue,this._effectLayerMapGenerationEffect=this._scene.getEngine().createEffect("glowMapGeneration",u,["world","mBones","viewProjection","glowColor","morphTargetInfluences","boneTextureWidth","diffuseMatrix","emissiveMatrix","opacityMatrix","opacityIntensity"],["diffuseSampler","emissiveSampler","opacitySampler","boneSampler"],ue,k,void 0,void 0,{maxSimultaneousMorphTargets:ae})),this._effectLayerMapGenerationEffect.isReady()},i.prototype.render=function(){var t=this._mergeEffect;if(t.isReady()){for(var e=0;e<this._postProcesses.length;e++)if(!this._postProcesses[e].isReady())return;var n=this._scene.getEngine();this.onBeforeComposeObservable.notifyObservers(this),n.enableEffect(t),n.setState(!1),n.bindBuffers(this._vertexBuffers,this._indexBuffer,t);var r=n.getAlphaMode();n.setAlphaMode(this._effectLayerOptions.alphaBlendingMode),this._internalRender(t),n.setAlphaMode(r),this.onAfterComposeObservable.notifyObservers(this);var o=this._mainTexture.getSize();this._setMainTextureSize(),o.width===this._mainTextureDesiredSize.width&&o.height===this._mainTextureDesiredSize.height||(this.onSizeChangedObservable.notifyObservers(this),this._disposeTextureAndPostProcesses(),this._createMainTexture(),this._createTextureAndPostProcesses())}},i.prototype.hasMesh=function(t){return this.renderingGroupId===-1||t.renderingGroupId===this.renderingGroupId},i.prototype.shouldRender=function(){return this.isEnabled&&this._shouldRender},i.prototype._shouldRenderMesh=function(t){return!0},i.prototype._canRenderMesh=function(t,e){return!e.needAlphaBlendingForMesh(t)},i.prototype._shouldRenderEmissiveTextureForMesh=function(){return!0},i.prototype._renderSubMesh=function(t,e){var n,r=this;if(e===void 0&&(e=!1),this.shouldRender()){var o=t.getMaterial(),u=t.getMesh(),f=t.getReplacementMesh(),v=t.getRenderingMesh(),y=t.getEffectiveMesh(),D=this._scene,w=D.getEngine();if(y._internalAbstractMeshDataInfo._isActiveIntermediate=!1,o&&this._canRenderMesh(v,o)){var F=(n=v.overrideMaterialSideOrientation)!==null&&n!==void 0?n:o.sideOrientation;v._getWorldMatrixDeterminant()<0&&(F=F===pn.a.ClockWiseSideOrientation?pn.a.CounterClockWiseSideOrientation:pn.a.ClockWiseSideOrientation);var z=F===pn.a.ClockWiseSideOrientation;w.setState(o.backFaceCulling,o.zOffset,void 0,z);var k=v._getInstancesRenderList(t._id,!!f);if(!k.mustReturn&&this._shouldRenderMesh(v)){var K=k.hardwareInstancedRendering[t._id]||v.hasThinInstances;if(this._setEmissiveTextureAndColor(v,t,o),this.onBeforeRenderMeshToEffect.notifyObservers(u),this._useMeshMaterial(v))v.render(t,K,f||void 0);else if(this._isReady(t,K,this._emissiveTextureAndColor.texture)){w.enableEffect(this._effectLayerMapGenerationEffect),v._bind(t,this._effectLayerMapGenerationEffect,pn.a.TriangleFillMode),this._effectLayerMapGenerationEffect.setMatrix("viewProjection",D.getTransformMatrix()),this._effectLayerMapGenerationEffect.setMatrix("world",y.getWorldMatrix()),this._effectLayerMapGenerationEffect.setFloat4("glowColor",this._emissiveTextureAndColor.color.r,this._emissiveTextureAndColor.color.g,this._emissiveTextureAndColor.color.b,this._emissiveTextureAndColor.color.a);var oe=o.needAlphaTesting(),ae=o.getAlphaTestTexture(),ue=ae&&ae.hasAlpha&&(o.useAlphaFromDiffuseTexture||o._useAlphaFromAlbedoTexture);ae&&(oe||ue)&&(this._effectLayerMapGenerationEffect.setTexture("diffuseSampler",ae),(de=ae.getTextureMatrix())&&this._effectLayerMapGenerationEffect.setMatrix("diffuseMatrix",de));var de,me=o.opacityTexture;if(me&&(this._effectLayerMapGenerationEffect.setTexture("opacitySampler",me),this._effectLayerMapGenerationEffect.setFloat("opacityIntensity",me.level),(de=me.getTextureMatrix())&&this._effectLayerMapGenerationEffect.setMatrix("opacityMatrix",de)),this._emissiveTextureAndColor.texture&&(this._effectLayerMapGenerationEffect.setTexture("emissiveSampler",this._emissiveTextureAndColor.texture),this._effectLayerMapGenerationEffect.setMatrix("emissiveMatrix",this._emissiveTextureAndColor.texture.getTextureMatrix())),v.useBones&&v.computeBonesUsingShaders&&v.skeleton){var ye=v.skeleton;if(ye.isUsingTextureForMatrices){var Ee=ye.getTransformMatrixTexture(v);if(!Ee)return;this._effectLayerMapGenerationEffect.setTexture("boneSampler",Ee),this._effectLayerMapGenerationEffect.setFloat("boneTextureWidth",4*(ye.bones.length+1))}else this._effectLayerMapGenerationEffect.setMatrices("mBones",ye.getTransformMatrices(v))}lt.a.BindMorphTargetParameters(v,this._effectLayerMapGenerationEffect),e&&w.setAlphaMode(o.alphaMode),v._processRendering(y,t,this._effectLayerMapGenerationEffect,o.fillMode,k,K,function(Ae,Ie){return r._effectLayerMapGenerationEffect.setMatrix("world",Ie)})}else this._mainTexture.resetRefreshCounter();this.onAfterRenderMeshToEffect.notifyObservers(u)}}}},i.prototype._useMeshMaterial=function(t){return!1},i.prototype._rebuild=function(){var t=this._vertexBuffers[De.b.PositionKind];t&&t._rebuild(),this._generateIndexBuffer()},i.prototype._disposeTextureAndPostProcesses=function(){this._mainTexture.dispose();for(var t=0;t<this._postProcesses.length;t++)this._postProcesses[t]&&this._postProcesses[t].dispose();for(this._postProcesses=[],t=0;t<this._textures.length;t++)this._textures[t]&&this._textures[t].dispose();this._textures=[]},i.prototype.dispose=function(){var t=this._vertexBuffers[De.b.PositionKind];t&&(t.dispose(),this._vertexBuffers[De.b.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._disposeTextureAndPostProcesses();var e=this._scene.effectLayers.indexOf(this,0);e>-1&&this._scene.effectLayers.splice(e,1),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onBeforeRenderMainTextureObservable.clear(),this.onBeforeComposeObservable.clear(),this.onBeforeRenderMeshToEffect.clear(),this.onAfterRenderMeshToEffect.clear(),this.onAfterComposeObservable.clear(),this.onSizeChangedObservable.clear()},i.prototype.getClassName=function(){return"EffectLayer"},i.Parse=function(t,e,n){return et.b.Instantiate(t.customType).Parse(t,e,n)},i._SceneComponentInitialization=function(t){throw dr.a.WarnImport("EffectLayerSceneComponent")},Object(p.c)([Object(B.c)()],i.prototype,"name",void 0),Object(p.c)([Object(B.f)()],i.prototype,"neutralColor",void 0),Object(p.c)([Object(B.c)()],i.prototype,"isEnabled",void 0),Object(p.c)([Object(B.d)()],i.prototype,"camera",null),Object(p.c)([Object(B.c)()],i.prototype,"renderingGroupId",null),Object(p.c)([Object(B.c)()],i.prototype,"disableBoundingBoxesFromEffectLayer",void 0),i}();E.a.AddParser(dt.a.NAME_EFFECTLAYER,function(i,t,e,n){if(i.effectLayers){e.effectLayers||(e.effectLayers=new Array);for(var r=0;r<i.effectLayers.length;r++){var o=ul.Parse(i.effectLayers[r],t,n);e.effectLayers.push(o)}}}),E.a.prototype.removeEffectLayer=function(i){var t=this.effectLayers.indexOf(i);return t!==-1&&this.effectLayers.splice(t,1),t},E.a.prototype.addEffectLayer=function(i){this.effectLayers.push(i)};var _0=function(){function i(t){this.name=dt.a.NAME_EFFECTLAYER,this._renderEffects=!1,this._needStencil=!1,this._previousStencilState=!1,this.scene=t,this._engine=t.getEngine(),t.effectLayers=new Array}return i.prototype.register=function(){this.scene._isReadyForMeshStage.registerStep(dt.a.STEP_ISREADYFORMESH_EFFECTLAYER,this,this._isReadyForMesh),this.scene._cameraDrawRenderTargetStage.registerStep(dt.a.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER,this,this._renderMainTexture),this.scene._beforeCameraDrawStage.registerStep(dt.a.STEP_BEFORECAMERADRAW_EFFECTLAYER,this,this._setStencil),this.scene._afterRenderingGroupDrawStage.registerStep(dt.a.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW,this,this._drawRenderingGroup),this.scene._afterCameraDrawStage.registerStep(dt.a.STEP_AFTERCAMERADRAW_EFFECTLAYER,this,this._setStencilBack),this.scene._afterCameraDrawStage.registerStep(dt.a.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW,this,this._drawCamera)},i.prototype.rebuild=function(){for(var t=0,e=this.scene.effectLayers;t<e.length;t++)e[t]._rebuild()},i.prototype.serialize=function(t){t.effectLayers=[];for(var e=0,n=this.scene.effectLayers;e<n.length;e++){var r=n[e];r.serialize&&t.effectLayers.push(r.serialize())}},i.prototype.addFromContainer=function(t){var e=this;t.effectLayers&&t.effectLayers.forEach(function(n){e.scene.addEffectLayer(n)})},i.prototype.removeFromContainer=function(t,e){var n=this;t.effectLayers&&t.effectLayers.forEach(function(r){n.scene.removeEffectLayer(r),e&&r.dispose()})},i.prototype.dispose=function(){for(var t=this.scene.effectLayers;t.length;)t[0].dispose()},i.prototype._isReadyForMesh=function(t,e){for(var n=0,r=this.scene.effectLayers;n<r.length;n++){var o=r[n];if(o.hasMesh(t))for(var u=0,f=t.subMeshes;u<f.length;u++){var v=f[u];if(!o.isReady(v,e))return!1}}return!0},i.prototype._renderMainTexture=function(t){this._renderEffects=!1,this._needStencil=!1;var e=!1,n=this.scene.effectLayers;if(n&&n.length>0){this._previousStencilState=this._engine.getStencilBuffer();for(var r=0,o=n;r<o.length;r++){var u=o[r];if(u.shouldRender()&&(!u.camera||u.camera.cameraRigMode===Pt.a.RIG_MODE_NONE&&t===u.camera||u.camera.cameraRigMode!==Pt.a.RIG_MODE_NONE&&u.camera._rigCameras.indexOf(t)>-1)){this._renderEffects=!0,this._needStencil=this._needStencil||u.needStencil();var f=u._mainTexture;f._shouldRender()&&(this.scene.incrementRenderId(),f.render(!1,!1),e=!0)}}this.scene.incrementRenderId()}return e},i.prototype._setStencil=function(){this._needStencil&&this._engine.setStencilBuffer(!0)},i.prototype._setStencilBack=function(){this._needStencil&&this._engine.setStencilBuffer(this._previousStencilState)},i.prototype._draw=function(t){if(this._renderEffects){this._engine.setDepthBuffer(!1);for(var e=this.scene.effectLayers,n=0;n<e.length;n++){var r=e[n];r.renderingGroupId===t&&r.shouldRender()&&r.render()}this._engine.setDepthBuffer(!0)}},i.prototype._drawCamera=function(){this._renderEffects&&this._draw(-1)},i.prototype._drawRenderingGroup=function(t){!this.scene._isInIntermediateRendering()&&this._renderEffects&&this._draw(t)},i}();ul._SceneComponentInitialization=function(i){var t=i._getComponent(dt.a.NAME_EFFECTLAYER);t||(t=new _0(i),i._addComponent(t))};var KD=`
varying vec2 vUV;
uniform sampler2D textureSampler;
#ifdef EMISSIVE
uniform sampler2D textureSampler2;
#endif

uniform float offset;
void main(void) {
vec4 baseColor=texture2D(textureSampler,vUV);
#ifdef EMISSIVE
baseColor+=texture2D(textureSampler2,vUV);
baseColor*=offset;
#else
baseColor.a=abs(offset-baseColor.a);
#ifdef STROKE
float alpha=smoothstep(.0,.1,baseColor.a);
baseColor.a=alpha;
baseColor.rgb=baseColor.rgb*alpha;
#endif
#endif
gl_FragColor=baseColor;
}`;Ye.a.ShadersStore.glowMapMergePixelShader=KD;var QD=`
attribute vec2 position;

varying vec2 vUV;
const vec2 madd=vec2(0.5,0.5);
void main(void) {
vUV=position*madd+madd;
gl_Position=vec4(position,0.0,1.0);
}`;Ye.a.ShadersStore.glowMapMergeVertexShader=QD,E.a.prototype.getGlowLayerByName=function(i){for(var t=0;t<this.effectLayers.length;t++)if(this.effectLayers[t].name===i&&this.effectLayers[t].getEffectName()===bh.EffectName)return this.effectLayers[t];return null};var bh=function(i){function t(e,n,r){var o=i.call(this,e,n)||this;return o._intensity=1,o._includedOnlyMeshes=[],o._excludedMeshes=[],o._meshesUsingTheirOwnMaterials=[],o.neutralColor=new M.b(0,0,0,1),o._options=Object(p.a)({mainTextureRatio:t.DefaultTextureRatio,blurKernelSize:32,mainTextureFixedSize:void 0,camera:null,mainTextureSamples:1,renderingGroupId:-1},r),o._init({alphaBlendingMode:g.a.ALPHA_ADD,camera:o._options.camera,mainTextureFixedSize:o._options.mainTextureFixedSize,mainTextureRatio:o._options.mainTextureRatio,renderingGroupId:o._options.renderingGroupId}),o}return Object(p.d)(t,i),Object.defineProperty(t.prototype,"blurKernelSize",{get:function(){return this._horizontalBlurPostprocess1.kernel},set:function(e){this._horizontalBlurPostprocess1.kernel=e,this._verticalBlurPostprocess1.kernel=e,this._horizontalBlurPostprocess2.kernel=e,this._verticalBlurPostprocess2.kernel=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"intensity",{get:function(){return this._intensity},set:function(e){this._intensity=e},enumerable:!1,configurable:!0}),t.prototype.getEffectName=function(){return t.EffectName},t.prototype._createMergeEffect=function(){return this._engine.createEffect("glowMapMerge",[De.b.PositionKind],["offset"],["textureSampler","textureSampler2"],`#define EMISSIVE 
`)},t.prototype._createTextureAndPostProcesses=function(){var e=this,n=this._mainTextureDesiredSize.width,r=this._mainTextureDesiredSize.height;n=this._engine.needPOTTextures?Ge.a.GetExponentOfTwo(n,this._maxSize):n,r=this._engine.needPOTTextures?Ge.a.GetExponentOfTwo(r,this._maxSize):r;var o=0;o=this._engine.getCaps().textureHalfFloatRender?g.a.TEXTURETYPE_HALF_FLOAT:g.a.TEXTURETYPE_UNSIGNED_INT,this._blurTexture1=new qn("GlowLayerBlurRTT",{width:n,height:r},this._scene,!1,!0,o),this._blurTexture1.wrapU=ke.a.CLAMP_ADDRESSMODE,this._blurTexture1.wrapV=ke.a.CLAMP_ADDRESSMODE,this._blurTexture1.updateSamplingMode(ke.a.BILINEAR_SAMPLINGMODE),this._blurTexture1.renderParticles=!1,this._blurTexture1.ignoreCameraViewport=!0;var u=Math.floor(n/2),f=Math.floor(r/2);this._blurTexture2=new qn("GlowLayerBlurRTT2",{width:u,height:f},this._scene,!1,!0,o),this._blurTexture2.wrapU=ke.a.CLAMP_ADDRESSMODE,this._blurTexture2.wrapV=ke.a.CLAMP_ADDRESSMODE,this._blurTexture2.updateSamplingMode(ke.a.BILINEAR_SAMPLINGMODE),this._blurTexture2.renderParticles=!1,this._blurTexture2.ignoreCameraViewport=!0,this._textures=[this._blurTexture1,this._blurTexture2],this._horizontalBlurPostprocess1=new ar("GlowLayerHBP1",new d.d(1,0),this._options.blurKernelSize/2,{width:n,height:r},null,ke.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,o),this._horizontalBlurPostprocess1.width=n,this._horizontalBlurPostprocess1.height=r,this._horizontalBlurPostprocess1.onApplyObservable.add(function(v){v.setTexture("textureSampler",e._mainTexture)}),this._verticalBlurPostprocess1=new ar("GlowLayerVBP1",new d.d(0,1),this._options.blurKernelSize/2,{width:n,height:r},null,ke.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,o),this._horizontalBlurPostprocess2=new ar("GlowLayerHBP2",new d.d(1,0),this._options.blurKernelSize/2,{width:u,height:f},null,ke.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,o),this._horizontalBlurPostprocess2.width=u,this._horizontalBlurPostprocess2.height=f,this._horizontalBlurPostprocess2.onApplyObservable.add(function(v){v.setTexture("textureSampler",e._blurTexture1)}),this._verticalBlurPostprocess2=new ar("GlowLayerVBP2",new d.d(0,1),this._options.blurKernelSize/2,{width:u,height:f},null,ke.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,o),this._postProcesses=[this._horizontalBlurPostprocess1,this._verticalBlurPostprocess1,this._horizontalBlurPostprocess2,this._verticalBlurPostprocess2],this._postProcesses1=[this._horizontalBlurPostprocess1,this._verticalBlurPostprocess1],this._postProcesses2=[this._horizontalBlurPostprocess2,this._verticalBlurPostprocess2],this._mainTexture.samples=this._options.mainTextureSamples,this._mainTexture.onAfterUnbindObservable.add(function(){var v=e._blurTexture1.getInternalTexture();if(v){e._scene.postProcessManager.directRender(e._postProcesses1,v,!0);var y=e._blurTexture2.getInternalTexture();y&&e._scene.postProcessManager.directRender(e._postProcesses2,y,!0),e._engine.unBindFramebuffer(y??v,!0)}}),this._postProcesses.map(function(v){v.autoClear=!1})},t.prototype.isReady=function(e,n){var r=e.getMaterial(),o=e.getRenderingMesh();if(!r||!o)return!1;var u=r.emissiveTexture;return i.prototype._isReady.call(this,e,n,u)},t.prototype.needStencil=function(){return!1},t.prototype._canRenderMesh=function(e,n){return!0},t.prototype._internalRender=function(e){e.setTexture("textureSampler",this._blurTexture1),e.setTexture("textureSampler2",this._blurTexture2),e.setFloat("offset",this._intensity);var n=this._engine,r=n.getStencilBuffer();n.setStencilBuffer(!1),n.drawElementsType(pn.a.TriangleFillMode,0,6),n.setStencilBuffer(r)},t.prototype._setEmissiveTextureAndColor=function(e,n,r){var o=1;this.customEmissiveTextureSelector?this._emissiveTextureAndColor.texture=this.customEmissiveTextureSelector(e,n,r):r?(this._emissiveTextureAndColor.texture=r.emissiveTexture,this._emissiveTextureAndColor.texture&&(o=this._emissiveTextureAndColor.texture.level)):this._emissiveTextureAndColor.texture=null,this.customEmissiveColorSelector?this.customEmissiveColorSelector(e,n,r,this._emissiveTextureAndColor.color):r.emissiveColor?this._emissiveTextureAndColor.color.set(r.emissiveColor.r*o,r.emissiveColor.g*o,r.emissiveColor.b*o,r.alpha):this._emissiveTextureAndColor.color.set(this.neutralColor.r,this.neutralColor.g,this.neutralColor.b,this.neutralColor.a)},t.prototype._shouldRenderMesh=function(e){return this.hasMesh(e)},t.prototype._addCustomEffectDefines=function(e){e.push("#define GLOW")},t.prototype.addExcludedMesh=function(e){this._excludedMeshes.indexOf(e.uniqueId)===-1&&this._excludedMeshes.push(e.uniqueId)},t.prototype.removeExcludedMesh=function(e){var n=this._excludedMeshes.indexOf(e.uniqueId);n!==-1&&this._excludedMeshes.splice(n,1)},t.prototype.addIncludedOnlyMesh=function(e){this._includedOnlyMeshes.indexOf(e.uniqueId)===-1&&this._includedOnlyMeshes.push(e.uniqueId)},t.prototype.removeIncludedOnlyMesh=function(e){var n=this._includedOnlyMeshes.indexOf(e.uniqueId);n!==-1&&this._includedOnlyMeshes.splice(n,1)},t.prototype.hasMesh=function(e){return!!i.prototype.hasMesh.call(this,e)&&(this._includedOnlyMeshes.length?this._includedOnlyMeshes.indexOf(e.uniqueId)!==-1:!this._excludedMeshes.length||this._excludedMeshes.indexOf(e.uniqueId)===-1)},t.prototype._useMeshMaterial=function(e){return this._meshesUsingTheirOwnMaterials.length!=0&&this._meshesUsingTheirOwnMaterials.indexOf(e.uniqueId)>-1},t.prototype.referenceMeshToUseItsOwnMaterial=function(e){this._meshesUsingTheirOwnMaterials.push(e.uniqueId)},t.prototype.unReferenceMeshFromUsingItsOwnMaterial=function(e){for(var n=this._meshesUsingTheirOwnMaterials.indexOf(e.uniqueId);n>=0;)this._meshesUsingTheirOwnMaterials.splice(n,1),n=this._meshesUsingTheirOwnMaterials.indexOf(e.uniqueId)},t.prototype._disposeMesh=function(e){this.removeIncludedOnlyMesh(e),this.removeExcludedMesh(e)},t.prototype.getClassName=function(){return"GlowLayer"},t.prototype.serialize=function(){var e,n=B.a.Serialize(this);if(n.customType="BABYLON.GlowLayer",n.includedMeshes=[],this._includedOnlyMeshes.length)for(e=0;e<this._includedOnlyMeshes.length;e++)(r=this._scene.getMeshByUniqueID(this._includedOnlyMeshes[e]))&&n.includedMeshes.push(r.id);if(n.excludedMeshes=[],this._excludedMeshes.length)for(e=0;e<this._excludedMeshes.length;e++){var r;(r=this._scene.getMeshByUniqueID(this._excludedMeshes[e]))&&n.excludedMeshes.push(r.id)}return n},t.Parse=function(e,n,r){var o,u=B.a.Parse(function(){return new t(e.name,n,e.options)},e,n,r);for(o=0;o<e.excludedMeshes.length;o++)(f=n.getMeshByID(e.excludedMeshes[o]))&&u.addExcludedMesh(f);for(o=0;o<e.includedMeshes.length;o++){var f;(f=n.getMeshByID(e.includedMeshes[o]))&&u.addIncludedOnlyMesh(f)}return u},t.EffectName="GlowLayer",t.DefaultBlurKernelSize=32,t.DefaultTextureRatio=.5,Object(p.c)([Object(B.c)()],t.prototype,"blurKernelSize",null),Object(p.c)([Object(B.c)()],t.prototype,"intensity",null),Object(p.c)([Object(B.c)("options")],t.prototype,"_options",void 0),t}(ul);C.a.RegisteredTypes["BABYLON.GlowLayer"]=bh;var qD=`
varying vec2 vUV;
uniform sampler2D textureSampler;

uniform vec2 screenSize;
uniform vec2 direction;
uniform float blurWidth;

float getLuminance(vec3 color)
{
return dot(color,vec3(0.2126,0.7152,0.0722));
}
void main(void)
{
float weights[7];
weights[0]=0.05;
weights[1]=0.1;
weights[2]=0.2;
weights[3]=0.3;
weights[4]=0.2;
weights[5]=0.1;
weights[6]=0.05;
vec2 texelSize=vec2(1.0/screenSize.x,1.0/screenSize.y);
vec2 texelStep=texelSize*direction*blurWidth;
vec2 start=vUV-3.0*texelStep;
vec4 baseColor=vec4(0.,0.,0.,0.);
vec2 texelOffset=vec2(0.,0.);
for (int i=0; i<7; i++)
{

vec4 texel=texture2D(textureSampler,start+texelOffset);
baseColor.a+=texel.a*weights[i];

float luminance=getLuminance(baseColor.rgb);
float luminanceTexel=getLuminance(texel.rgb);
float choice=step(luminanceTexel,luminance);
baseColor.rgb=choice*baseColor.rgb+(1.0-choice)*texel.rgb;
texelOffset+=texelStep;
}
gl_FragColor=baseColor;
}`;Ye.a.ShadersStore.glowBlurPostProcessPixelShader=qD,E.a.prototype.getHighlightLayerByName=function(i){for(var t=0;t<this.effectLayers.length;t++)if(this.effectLayers[t].name===i&&this.effectLayers[t].getEffectName()===am.EffectName)return this.effectLayers[t];return null};var g0=function(i){function t(e,n,r,o,u,f,v,y){f===void 0&&(f=ke.a.BILINEAR_SAMPLINGMODE);var D=i.call(this,e,"glowBlurPostProcess",["screenSize","direction","blurWidth"],null,o,u,f,v,y)||this;return D.direction=n,D.kernel=r,D.onApplyObservable.add(function(w){w.setFloat2("screenSize",D.width,D.height),w.setVector2("direction",D.direction),w.setFloat("blurWidth",D.kernel)}),D}return Object(p.d)(t,i),t}(St),am=function(i){function t(e,n,r){var o=i.call(this,e,n)||this;return o.name=e,o.innerGlow=!0,o.outerGlow=!0,o.onBeforeBlurObservable=new S.c,o.onAfterBlurObservable=new S.c,o._instanceGlowingMeshStencilReference=t.GlowingMeshStencilReference++,o._meshes={},o._excludedMeshes={},o.neutralColor=t.NeutralColor,o._engine.isStencilEnable||_.a.Warn("Rendering the Highlight Layer requires the stencil to be active on the canvas. var engine = new Engine(canvas, antialias, { stencil: true }"),o._options=Object(p.a)({mainTextureRatio:.5,blurTextureSizeRatio:.5,blurHorizontalSize:1,blurVerticalSize:1,alphaBlendingMode:g.a.ALPHA_COMBINE,camera:null,renderingGroupId:-1},r),o._init({alphaBlendingMode:o._options.alphaBlendingMode,camera:o._options.camera,mainTextureFixedSize:o._options.mainTextureFixedSize,mainTextureRatio:o._options.mainTextureRatio,renderingGroupId:o._options.renderingGroupId}),o._shouldRender=!1,o}return Object(p.d)(t,i),Object.defineProperty(t.prototype,"blurHorizontalSize",{get:function(){return this._horizontalBlurPostprocess.kernel},set:function(e){this._horizontalBlurPostprocess.kernel=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"blurVerticalSize",{get:function(){return this._verticalBlurPostprocess.kernel},set:function(e){this._verticalBlurPostprocess.kernel=e},enumerable:!1,configurable:!0}),t.prototype.getEffectName=function(){return t.EffectName},t.prototype._createMergeEffect=function(){return this._engine.createEffect("glowMapMerge",[De.b.PositionKind],["offset"],["textureSampler"],this._options.isStroke?`#define STROKE 
`:void 0)},t.prototype._createTextureAndPostProcesses=function(){var e=this,n=this._mainTextureDesiredSize.width*this._options.blurTextureSizeRatio,r=this._mainTextureDesiredSize.height*this._options.blurTextureSizeRatio;n=this._engine.needPOTTextures?Ge.a.GetExponentOfTwo(n,this._maxSize):n,r=this._engine.needPOTTextures?Ge.a.GetExponentOfTwo(r,this._maxSize):r;var o=0;o=this._engine.getCaps().textureHalfFloatRender?g.a.TEXTURETYPE_HALF_FLOAT:g.a.TEXTURETYPE_UNSIGNED_INT,this._blurTexture=new qn("HighlightLayerBlurRTT",{width:n,height:r},this._scene,!1,!0,o),this._blurTexture.wrapU=ke.a.CLAMP_ADDRESSMODE,this._blurTexture.wrapV=ke.a.CLAMP_ADDRESSMODE,this._blurTexture.anisotropicFilteringLevel=16,this._blurTexture.updateSamplingMode(ke.a.TRILINEAR_SAMPLINGMODE),this._blurTexture.renderParticles=!1,this._blurTexture.ignoreCameraViewport=!0,this._textures=[this._blurTexture],this._options.alphaBlendingMode===g.a.ALPHA_COMBINE?(this._downSamplePostprocess=new jo("HighlightLayerPPP",this._options.blurTextureSizeRatio,null,ke.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine()),this._downSamplePostprocess.onApplyObservable.add(function(u){u.setTexture("textureSampler",e._mainTexture)}),this._horizontalBlurPostprocess=new g0("HighlightLayerHBP",new d.d(1,0),this._options.blurHorizontalSize,1,null,ke.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine()),this._horizontalBlurPostprocess.onApplyObservable.add(function(u){u.setFloat2("screenSize",n,r)}),this._verticalBlurPostprocess=new g0("HighlightLayerVBP",new d.d(0,1),this._options.blurVerticalSize,1,null,ke.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine()),this._verticalBlurPostprocess.onApplyObservable.add(function(u){u.setFloat2("screenSize",n,r)}),this._postProcesses=[this._downSamplePostprocess,this._horizontalBlurPostprocess,this._verticalBlurPostprocess]):(this._horizontalBlurPostprocess=new ar("HighlightLayerHBP",new d.d(1,0),this._options.blurHorizontalSize/2,{width:n,height:r},null,ke.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,o),this._horizontalBlurPostprocess.width=n,this._horizontalBlurPostprocess.height=r,this._horizontalBlurPostprocess.onApplyObservable.add(function(u){u.setTexture("textureSampler",e._mainTexture)}),this._verticalBlurPostprocess=new ar("HighlightLayerVBP",new d.d(0,1),this._options.blurVerticalSize/2,{width:n,height:r},null,ke.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,o),this._postProcesses=[this._horizontalBlurPostprocess,this._verticalBlurPostprocess]),this._mainTexture.onAfterUnbindObservable.add(function(){e.onBeforeBlurObservable.notifyObservers(e);var u=e._blurTexture.getInternalTexture();u&&(e._scene.postProcessManager.directRender(e._postProcesses,u,!0),e._engine.unBindFramebuffer(u,!0)),e.onAfterBlurObservable.notifyObservers(e)}),this._postProcesses.map(function(u){u.autoClear=!1})},t.prototype.needStencil=function(){return!0},t.prototype.isReady=function(e,n){var r=e.getMaterial(),o=e.getRenderingMesh();if(!r||!o||!this._meshes)return!1;var u=null,f=this._meshes[o.uniqueId];return f&&f.glowEmissiveOnly&&r&&(u=r.emissiveTexture),i.prototype._isReady.call(this,e,n,u)},t.prototype._internalRender=function(e){e.setTexture("textureSampler",this._blurTexture);var n=this._engine;n.cacheStencilState(),n.setStencilOperationPass(g.a.REPLACE),n.setStencilOperationFail(g.a.KEEP),n.setStencilOperationDepthFail(g.a.KEEP),n.setStencilMask(0),n.setStencilBuffer(!0),n.setStencilFunctionReference(this._instanceGlowingMeshStencilReference),this.outerGlow&&(e.setFloat("offset",0),n.setStencilFunction(g.a.NOTEQUAL),n.drawElementsType(pn.a.TriangleFillMode,0,6)),this.innerGlow&&(e.setFloat("offset",1),n.setStencilFunction(g.a.EQUAL),n.drawElementsType(pn.a.TriangleFillMode,0,6)),n.restoreStencilState()},t.prototype.shouldRender=function(){return!!i.prototype.shouldRender.call(this)&&!!this._meshes},t.prototype._shouldRenderMesh=function(e){return(!this._excludedMeshes||!this._excludedMeshes[e.uniqueId])&&!!i.prototype.hasMesh.call(this,e)},t.prototype._canRenderMesh=function(e,n){return!0},t.prototype._addCustomEffectDefines=function(e){e.push("#define HIGHLIGHT")},t.prototype._setEmissiveTextureAndColor=function(e,n,r){var o=this._meshes[e.uniqueId];o?this._emissiveTextureAndColor.color.set(o.color.r,o.color.g,o.color.b,1):this._emissiveTextureAndColor.color.set(this.neutralColor.r,this.neutralColor.g,this.neutralColor.b,this.neutralColor.a),o&&o.glowEmissiveOnly&&r?(this._emissiveTextureAndColor.texture=r.emissiveTexture,this._emissiveTextureAndColor.color.set(1,1,1,1)):this._emissiveTextureAndColor.texture=null},t.prototype.addExcludedMesh=function(e){this._excludedMeshes&&(this._excludedMeshes[e.uniqueId]||(this._excludedMeshes[e.uniqueId]={mesh:e,beforeBind:e.onBeforeBindObservable.add(function(n){n.getEngine().setStencilBuffer(!1)}),afterRender:e.onAfterRenderObservable.add(function(n){n.getEngine().setStencilBuffer(!0)})}))},t.prototype.removeExcludedMesh=function(e){if(this._excludedMeshes){var n=this._excludedMeshes[e.uniqueId];n&&(n.beforeBind&&e.onBeforeBindObservable.remove(n.beforeBind),n.afterRender&&e.onAfterRenderObservable.remove(n.afterRender)),this._excludedMeshes[e.uniqueId]=null}},t.prototype.hasMesh=function(e){return!!this._meshes&&!!i.prototype.hasMesh.call(this,e)&&this._meshes[e.uniqueId]!==void 0&&this._meshes[e.uniqueId]!==null},t.prototype.addMesh=function(e,n,r){var o=this;if(r===void 0&&(r=!1),this._meshes){var u=this._meshes[e.uniqueId];u?u.color=n:(this._meshes[e.uniqueId]={mesh:e,color:n,observerHighlight:e.onBeforeBindObservable.add(function(f){o.isEnabled&&(o._excludedMeshes&&o._excludedMeshes[f.uniqueId]?o._defaultStencilReference(f):f.getScene().getEngine().setStencilFunctionReference(o._instanceGlowingMeshStencilReference))}),observerDefault:e.onAfterRenderObservable.add(function(f){o.isEnabled&&o._defaultStencilReference(f)}),glowEmissiveOnly:r},e.onDisposeObservable.add(function(){o._disposeMesh(e)})),this._shouldRender=!0}},t.prototype.removeMesh=function(e){if(this._meshes){var n=this._meshes[e.uniqueId];for(var r in n&&(n.observerHighlight&&e.onBeforeBindObservable.remove(n.observerHighlight),n.observerDefault&&e.onAfterRenderObservable.remove(n.observerDefault),delete this._meshes[e.uniqueId]),this._shouldRender=!1,this._meshes)if(this._meshes[r]){this._shouldRender=!0;break}}},t.prototype.removeAllMeshes=function(){if(this._meshes){for(var e in this._meshes)if(this._meshes.hasOwnProperty(e)){var n=this._meshes[e];n&&this.removeMesh(n.mesh)}}},t.prototype._defaultStencilReference=function(e){e.getScene().getEngine().setStencilFunctionReference(t.NormalMeshStencilReference)},t.prototype._disposeMesh=function(e){this.removeMesh(e),this.removeExcludedMesh(e)},t.prototype.dispose=function(){if(this._meshes){for(var e in this._meshes)(n=this._meshes[e])&&n.mesh&&(n.observerHighlight&&n.mesh.onBeforeBindObservable.remove(n.observerHighlight),n.observerDefault&&n.mesh.onAfterRenderObservable.remove(n.observerDefault));this._meshes=null}if(this._excludedMeshes){for(var e in this._excludedMeshes){var n;(n=this._excludedMeshes[e])&&(n.beforeBind&&n.mesh.onBeforeBindObservable.remove(n.beforeBind),n.afterRender&&n.mesh.onAfterRenderObservable.remove(n.afterRender))}this._excludedMeshes=null}i.prototype.dispose.call(this)},t.prototype.getClassName=function(){return"HighlightLayer"},t.prototype.serialize=function(){var e=B.a.Serialize(this);if(e.customType="BABYLON.HighlightLayer",e.meshes=[],this._meshes)for(var n in this._meshes){var r=this._meshes[n];r&&e.meshes.push({glowEmissiveOnly:r.glowEmissiveOnly,color:r.color.asArray(),meshId:r.mesh.id})}if(e.excludedMeshes=[],this._excludedMeshes)for(var o in this._excludedMeshes){var u=this._excludedMeshes[o];u&&e.excludedMeshes.push(u.mesh.id)}return e},t.Parse=function(e,n,r){var o,u=B.a.Parse(function(){return new t(e.name,n,e.options)},e,n,r);for(o=0;o<e.excludedMeshes.length;o++)(f=n.getMeshByID(e.excludedMeshes[o]))&&u.addExcludedMesh(f);for(o=0;o<e.meshes.length;o++){var f,v=e.meshes[o];(f=n.getMeshByID(v.meshId))&&u.addMesh(f,M.a.FromArray(v.color),v.glowEmissiveOnly)}return u},t.EffectName="HighlightLayer",t.NeutralColor=new M.b(0,0,0,0),t.GlowingMeshStencilReference=2,t.NormalMeshStencilReference=1,Object(p.c)([Object(B.c)()],t.prototype,"innerGlow",void 0),Object(p.c)([Object(B.c)()],t.prototype,"outerGlow",void 0),Object(p.c)([Object(B.c)()],t.prototype,"blurHorizontalSize",null),Object(p.c)([Object(B.c)()],t.prototype,"blurVerticalSize",null),Object(p.c)([Object(B.c)("options")],t.prototype,"_options",void 0),t}(ul);C.a.RegisteredTypes["BABYLON.HighlightLayer"]=am;var v0=function(){function i(t){this.name=dt.a.NAME_LAYER,this.scene=t,this._engine=t.getEngine(),t.layers=new Array}return i.prototype.register=function(){this.scene._beforeCameraDrawStage.registerStep(dt.a.STEP_BEFORECAMERADRAW_LAYER,this,this._drawCameraBackground),this.scene._afterCameraDrawStage.registerStep(dt.a.STEP_AFTERCAMERADRAW_LAYER,this,this._drawCameraForeground),this.scene._beforeRenderTargetDrawStage.registerStep(dt.a.STEP_BEFORERENDERTARGETDRAW_LAYER,this,this._drawRenderTargetBackground),this.scene._afterRenderTargetDrawStage.registerStep(dt.a.STEP_AFTERRENDERTARGETDRAW_LAYER,this,this._drawRenderTargetForeground)},i.prototype.rebuild=function(){for(var t=0,e=this.scene.layers;t<e.length;t++)e[t]._rebuild()},i.prototype.dispose=function(){for(var t=this.scene.layers;t.length;)t[0].dispose()},i.prototype._draw=function(t){var e=this.scene.layers;if(e.length){this._engine.setDepthBuffer(!1);for(var n=0,r=e;n<r.length;n++){var o=r[n];t(o)&&o.render()}this._engine.setDepthBuffer(!0)}},i.prototype._drawCameraPredicate=function(t,e,n){return!t.renderOnlyInRenderTargetTextures&&t.isBackground===e&&(t.layerMask&n)!=0},i.prototype._drawCameraBackground=function(t){var e=this;this._draw(function(n){return e._drawCameraPredicate(n,!0,t.layerMask)})},i.prototype._drawCameraForeground=function(t){var e=this;this._draw(function(n){return e._drawCameraPredicate(n,!1,t.layerMask)})},i.prototype._drawRenderTargetPredicate=function(t,e,n,r){return t.renderTargetTextures.length>0&&t.isBackground===e&&t.renderTargetTextures.indexOf(r)>-1&&(t.layerMask&n)!=0},i.prototype._drawRenderTargetBackground=function(t){var e=this;this._draw(function(n){return e._drawRenderTargetPredicate(n,!0,e.scene.activeCamera.layerMask,t)})},i.prototype._drawRenderTargetForeground=function(t){var e=this;this._draw(function(n){return e._drawRenderTargetPredicate(n,!1,e.scene.activeCamera.layerMask,t)})},i.prototype.addFromContainer=function(t){var e=this;t.layers&&t.layers.forEach(function(n){e.scene.layers.push(n)})},i.prototype.removeFromContainer=function(t,e){var n=this;e===void 0&&(e=!1),t.layers&&t.layers.forEach(function(r){var o=n.scene.layers.indexOf(r);o!==-1&&n.scene.layers.splice(o,1),e&&r.dispose()})},i}(),ZD=`
varying vec2 vUV;
uniform sampler2D textureSampler;

uniform vec4 color;

#include<helperFunctions>
void main(void) {
vec4 baseColor=texture2D(textureSampler,vUV);
#ifdef LINEAR
baseColor.rgb=toGammaSpace(baseColor.rgb);
#endif
#ifdef ALPHATEST
if (baseColor.a<0.4)
discard;
#endif
gl_FragColor=baseColor*color;
}`;Ye.a.ShadersStore.layerPixelShader=ZD;var $D=`
attribute vec2 position;

uniform vec2 scale;
uniform vec2 offset;
uniform mat4 textureMatrix;

varying vec2 vUV;
const vec2 madd=vec2(0.5,0.5);
void main(void) {
vec2 shiftedPosition=position*scale+offset;
vUV=vec2(textureMatrix*vec4(shiftedPosition*madd+madd,1.0,0.0));
gl_Position=vec4(shiftedPosition,0.0,1.0);
}`;Ye.a.ShadersStore.layerVertexShader=$D;var JD=function(){function i(t,e,n,r,o){this.name=t,this.scale=new d.d(1,1),this.offset=new d.d(0,0),this.alphaBlendingMode=g.a.ALPHA_COMBINE,this.layerMask=268435455,this.renderTargetTextures=[],this.renderOnlyInRenderTargetTextures=!1,this._vertexBuffers={},this.onDisposeObservable=new S.c,this.onBeforeRenderObservable=new S.c,this.onAfterRenderObservable=new S.c,this.texture=e?new ke.a(e,n,!0):null,this.isBackground=r===void 0||r,this.color=o===void 0?new M.b(1,1,1,1):o,this._scene=n||ne.a.LastCreatedScene;var u=this._scene._getComponent(dt.a.NAME_LAYER);u||(u=new v0(this._scene),this._scene._addComponent(u)),this._scene.layers.push(this);var f=this._scene.getEngine(),v=[];v.push(1,1),v.push(-1,1),v.push(-1,-1),v.push(1,-1);var y=new De.b(f,v,De.b.PositionKind,!1,!1,2);this._vertexBuffers[De.b.PositionKind]=y,this._createIndexBuffer()}return Object.defineProperty(i.prototype,"onDispose",{set:function(t){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"onBeforeRender",{set:function(t){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"onAfterRender",{set:function(t){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(t)},enumerable:!1,configurable:!0}),i.prototype._createIndexBuffer=function(){var t=this._scene.getEngine(),e=[];e.push(0),e.push(1),e.push(2),e.push(0),e.push(2),e.push(3),this._indexBuffer=t.createIndexBuffer(e)},i.prototype._rebuild=function(){var t=this._vertexBuffers[De.b.PositionKind];t&&t._rebuild(),this._createIndexBuffer()},i.prototype.render=function(){var t=this._scene.getEngine(),e="";this.alphaTest&&(e="#define ALPHATEST"),this.texture&&!this.texture.gammaSpace&&(e+=`\r
#define LINEAR`),this._previousDefines!==e&&(this._previousDefines=e,this._effect=t.createEffect("layer",[De.b.PositionKind],["textureMatrix","color","scale","offset"],["textureSampler"],e));var n=this._effect;n&&n.isReady()&&this.texture&&this.texture.isReady()&&(t=this._scene.getEngine(),this.onBeforeRenderObservable.notifyObservers(this),t.enableEffect(n),t.setState(!1),n.setTexture("textureSampler",this.texture),n.setMatrix("textureMatrix",this.texture.getTextureMatrix()),n.setFloat4("color",this.color.r,this.color.g,this.color.b,this.color.a),n.setVector2("offset",this.offset),n.setVector2("scale",this.scale),t.bindBuffers(this._vertexBuffers,this._indexBuffer,n),this.alphaTest?t.drawElementsType(pn.a.TriangleFillMode,0,6):(t.setAlphaMode(this.alphaBlendingMode),t.drawElementsType(pn.a.TriangleFillMode,0,6),t.setAlphaMode(g.a.ALPHA_DISABLE)),this.onAfterRenderObservable.notifyObservers(this))},i.prototype.dispose=function(){var t=this._vertexBuffers[De.b.PositionKind];t&&(t.dispose(),this._vertexBuffers[De.b.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this.texture&&(this.texture.dispose(),this.texture=null),this.renderTargetTextures=[];var e=this._scene.layers.indexOf(this);this._scene.layers.splice(e,1),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderObservable.clear()},i}(),b0=function(){function i(t,e,n,r,o){this.size=t,this.position=e,this.alphaMode=g.a.ALPHA_ONEONE,this.color=n||new M.a(1,1,1),this.texture=r?new ke.a(r,o.getScene(),!0):null,this._system=o,o.lensFlares.push(this)}return i.AddFlare=function(t,e,n,r,o){return new i(t,e,n,r,o)},i.prototype.dispose=function(){this.texture&&this.texture.dispose();var t=this._system.lensFlares.indexOf(this);this._system.lensFlares.splice(t,1)},i}(),ew=`
varying vec2 vUV;
uniform sampler2D textureSampler;

uniform vec4 color;
void main(void) {
vec4 baseColor=texture2D(textureSampler,vUV);
gl_FragColor=baseColor*color;
}`;Ye.a.ShadersStore.lensFlarePixelShader=ew;var tw=`
attribute vec2 position;

uniform mat4 viewportMatrix;

varying vec2 vUV;
const vec2 madd=vec2(0.5,0.5);
void main(void) {
vUV=position*madd+madd;
gl_Position=viewportMatrix*vec4(position,0.0,1.0);
}`;Ye.a.ShadersStore.lensFlareVertexShader=tw;var sm=function(){function i(t,e,n){this.name=t,this.lensFlares=new Array,this.borderLimit=300,this.viewportBorder=0,this.layerMask=268435455,this._vertexBuffers={},this._isEnabled=!0,this._scene=n||ne.a.LastCreatedScene,i._SceneComponentInitialization(this._scene),this._emitter=e,this.id=t,n.lensFlareSystems.push(this),this.meshesSelectionPredicate=function(f){return n.activeCamera&&f.material&&f.isVisible&&f.isEnabled()&&f.isBlocker&&(f.layerMask&n.activeCamera.layerMask)!=0};var r=n.getEngine(),o=[];o.push(1,1),o.push(-1,1),o.push(-1,-1),o.push(1,-1),this._vertexBuffers[De.b.PositionKind]=new De.b(r,o,De.b.PositionKind,!1,!1,2);var u=[];u.push(0),u.push(1),u.push(2),u.push(0),u.push(2),u.push(3),this._indexBuffer=r.createIndexBuffer(u),this._effect=r.createEffect("lensFlare",[De.b.PositionKind],["color","viewportMatrix"],["textureSampler"],"")}return Object.defineProperty(i.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(t){this._isEnabled=t},enumerable:!1,configurable:!0}),i.prototype.getScene=function(){return this._scene},i.prototype.getEmitter=function(){return this._emitter},i.prototype.setEmitter=function(t){this._emitter=t},i.prototype.getEmitterPosition=function(){return this._emitter.getAbsolutePosition?this._emitter.getAbsolutePosition():this._emitter.position},i.prototype.computeEffectivePosition=function(t){var e=this.getEmitterPosition();return e=d.e.Project(e,d.a.Identity(),this._scene.getTransformMatrix(),t),this._positionX=e.x,this._positionY=e.y,e=d.e.TransformCoordinates(this.getEmitterPosition(),this._scene.getViewMatrix()),this.viewportBorder>0&&(t.x-=this.viewportBorder,t.y-=this.viewportBorder,t.width+=2*this.viewportBorder,t.height+=2*this.viewportBorder,e.x+=this.viewportBorder,e.y+=this.viewportBorder,this._positionX+=this.viewportBorder,this._positionY+=this.viewportBorder),e.z>0&&(this._positionX>t.x&&this._positionX<t.x+t.width&&this._positionY>t.y&&(this._positionY,t.y,t.height),!0)},i.prototype._isVisible=function(){if(!this._isEnabled||!this._scene.activeCamera)return!1;var t=this.getEmitterPosition().subtract(this._scene.activeCamera.globalPosition),e=t.length();t.normalize();var n=new Qn.a(this._scene.activeCamera.globalPosition,t),r=this._scene.pickWithRay(n,this.meshesSelectionPredicate,!0);return!r||!r.hit||r.distance>e},i.prototype.render=function(){if(!this._effect.isReady()||!this._scene.activeCamera)return!1;var t,e,n=this._scene.getEngine(),r=this._scene.activeCamera.viewport.toGlobal(n.getRenderWidth(!0),n.getRenderHeight(!0));if(!this.computeEffectivePosition(r)||!this._isVisible())return!1;var o=(t=this._positionX<this.borderLimit+r.x?this.borderLimit+r.x-this._positionX:this._positionX>r.x+r.width-this.borderLimit?this._positionX-r.x-r.width+this.borderLimit:0)>(e=this._positionY<this.borderLimit+r.y?this.borderLimit+r.y-this._positionY:this._positionY>r.y+r.height-this.borderLimit?this._positionY-r.y-r.height+this.borderLimit:0)?t:e;(o-=this.viewportBorder)>this.borderLimit&&(o=this.borderLimit);var u=1-te.a.Clamp(o/this.borderLimit,0,1);if(u<0)return!1;u>1&&(u=1),this.viewportBorder>0&&(r.x+=this.viewportBorder,r.y+=this.viewportBorder,r.width-=2*this.viewportBorder,r.height-=2*this.viewportBorder,this._positionX-=this.viewportBorder,this._positionY-=this.viewportBorder);var f=r.x+r.width/2,v=r.y+r.height/2,y=f-this._positionX,D=v-this._positionY;n.enableEffect(this._effect),n.setState(!1),n.setDepthBuffer(!1),n.bindBuffers(this._vertexBuffers,this._indexBuffer,this._effect);for(var w=0;w<this.lensFlares.length;w++){var F=this.lensFlares[w];if(!F.texture||F.texture.isReady()){n.setAlphaMode(F.alphaMode);var z=f-y*F.position,k=v-D*F.position,K=F.size,oe=F.size*n.getAspectRatio(this._scene.activeCamera,!0),ae=z/(r.width+2*r.x)*2-1,ue=1-k/(r.height+2*r.y)*2,de=d.a.FromValues(K/2,0,0,0,0,oe/2,0,0,0,0,1,0,ae,ue,0,1);this._effect.setMatrix("viewportMatrix",de),this._effect.setTexture("textureSampler",F.texture),this._effect.setFloat4("color",F.color.r*u,F.color.g*u,F.color.b*u,1),n.drawElementsType(pn.a.TriangleFillMode,0,6)}}return n.setDepthBuffer(!0),n.setAlphaMode(g.a.ALPHA_DISABLE),!0},i.prototype.dispose=function(){var t=this._vertexBuffers[De.b.PositionKind];for(t&&(t.dispose(),this._vertexBuffers[De.b.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null);this.lensFlares.length;)this.lensFlares[0].dispose();var e=this._scene.lensFlareSystems.indexOf(this);this._scene.lensFlareSystems.splice(e,1)},i.Parse=function(t,e,n){var r=e.getLastEntryByID(t.emitterId),o=t.name||"lensFlareSystem#"+t.emitterId,u=new i(o,r,e);u.id=t.id||o,u.borderLimit=t.borderLimit;for(var f=0;f<t.flares.length;f++){var v=t.flares[f];b0.AddFlare(v.size,v.position,M.a.FromArray(v.color),v.textureName?n+v.textureName:"",u)}return u},i.prototype.serialize=function(){var t={};t.id=this.id,t.name=this.name,t.emitterId=this.getEmitter().id,t.borderLimit=this.borderLimit,t.flares=[];for(var e=0;e<this.lensFlares.length;e++){var n=this.lensFlares[e];t.flares.push({size:n.size,position:n.position,color:n.color.asArray(),textureName:et.b.GetFilename(n.texture?n.texture.name:"")})}return t},i._SceneComponentInitialization=function(t){throw dr.a.WarnImport("LensFlareSystemSceneComponent")},i}();E.a.AddParser(dt.a.NAME_LENSFLARESYSTEM,function(i,t,e,n){if(i.lensFlareSystems!==void 0&&i.lensFlareSystems!==null){e.lensFlareSystems||(e.lensFlareSystems=new Array);for(var r=0,o=i.lensFlareSystems.length;r<o;r++){var u=i.lensFlareSystems[r],f=sm.Parse(u,t,n);e.lensFlareSystems.push(f)}}}),E.a.prototype.getLensFlareSystemByName=function(i){for(var t=0;t<this.lensFlareSystems.length;t++)if(this.lensFlareSystems[t].name===i)return this.lensFlareSystems[t];return null},E.a.prototype.getLensFlareSystemByID=function(i){for(var t=0;t<this.lensFlareSystems.length;t++)if(this.lensFlareSystems[t].id===i)return this.lensFlareSystems[t];return null},E.a.prototype.removeLensFlareSystem=function(i){var t=this.lensFlareSystems.indexOf(i);return t!==-1&&this.lensFlareSystems.splice(t,1),t},E.a.prototype.addLensFlareSystem=function(i){this.lensFlareSystems.push(i)};var y0=function(){function i(t){this.name=dt.a.NAME_LENSFLARESYSTEM,this.scene=t,t.lensFlareSystems=new Array}return i.prototype.register=function(){this.scene._afterCameraDrawStage.registerStep(dt.a.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM,this,this._draw)},i.prototype.rebuild=function(){},i.prototype.addFromContainer=function(t){var e=this;t.lensFlareSystems&&t.lensFlareSystems.forEach(function(n){e.scene.addLensFlareSystem(n)})},i.prototype.removeFromContainer=function(t,e){var n=this;t.lensFlareSystems&&t.lensFlareSystems.forEach(function(r){n.scene.removeLensFlareSystem(r),e&&r.dispose()})},i.prototype.serialize=function(t){t.lensFlareSystems=[];for(var e=0,n=this.scene.lensFlareSystems;e<n.length;e++){var r=n[e];t.lensFlareSystems.push(r.serialize())}},i.prototype.dispose=function(){for(var t=this.scene.lensFlareSystems;t.length;)t[0].dispose()},i.prototype._draw=function(t){if(this.scene.lensFlaresEnabled){var e=this.scene.lensFlareSystems;et.b.StartPerformanceCounter("Lens flares",e.length>0);for(var n=0,r=e;n<r.length;n++){var o=r[n];(t.layerMask&o.layerMask)!=0&&o.render()}et.b.EndPerformanceCounter("Lens flares",e.length>0)}},i}();sm._SceneComponentInitialization=function(i){var t=i._getComponent(dt.a.NAME_LENSFLARESYSTEM);t||(t=new y0(i),i._addComponent(t))};var nw=`




float bayerDither2(vec2 _P) {
return mod(2.0*_P.y+_P.x+1.0,4.0);
}


float bayerDither4(vec2 _P) {
vec2 P1=mod(_P,2.0);
vec2 P2=floor(0.5*mod(_P,4.0));
return 4.0*bayerDither2(P1)+bayerDither2(P2);
}

float bayerDither8(vec2 _P) {
vec2 P1=mod(_P,2.0);
vec2 P2=floor(0.5*mod(_P,4.0));
vec2 P4=floor(0.25*mod(_P,8.0));
return 4.0*(4.0*bayerDither2(P1)+bayerDither2(P2))+bayerDither2(P4);
}
`;Ye.a.IncludesShadersStore.bayerDitherFunctions=nw;var rw=`#if SM_FLOAT == 0
#include<packingFunctions>
#endif
#if SM_SOFTTRANSPARENTSHADOW == 1
#include<bayerDitherFunctions>
uniform float softTransparentShadowSM;
#endif
varying float vDepthMetricSM;
#if SM_USEDISTANCE == 1
uniform vec3 lightDataSM;
varying vec3 vPositionWSM;
#endif
uniform vec3 biasAndScaleSM;
uniform vec2 depthValuesSM;
#if defined(SM_DEPTHCLAMP) && SM_DEPTHCLAMP == 1
varying float zSM;
#endif
`;Ye.a.IncludesShadersStore.shadowMapFragmentDeclaration=rw;var iw=` float depthSM=vDepthMetricSM;
#if defined(SM_DEPTHCLAMP) && SM_DEPTHCLAMP == 1
#if SM_USEDISTANCE == 1
depthSM=clamp(((length(vPositionWSM-lightDataSM)+depthValuesSM.x)/(depthValuesSM.y))+biasAndScaleSM.x,0.0,1.0);
#else
depthSM=clamp(((zSM+depthValuesSM.x)/(depthValuesSM.y))+biasAndScaleSM.x,0.0,1.0);
#endif
gl_FragDepth=depthSM;
#elif SM_USEDISTANCE == 1
depthSM=(length(vPositionWSM-lightDataSM)+depthValuesSM.x)/(depthValuesSM.y)+biasAndScaleSM.x;
#endif
#if SM_ESM == 1
depthSM=clamp(exp(-min(87.,biasAndScaleSM.z*depthSM)),0.,1.);
#endif
#if SM_FLOAT == 1
gl_FragColor=vec4(depthSM,1.0,1.0,1.0);
#else
gl_FragColor=pack(depthSM);
#endif
return;`;Ye.a.IncludesShadersStore.shadowMapFragment=iw;var ow=`#include<shadowMapFragmentDeclaration>
#ifdef ALPHATEST
varying vec2 vUV;
uniform sampler2D diffuseSampler;
#endif
#include<clipPlaneFragmentDeclaration>
void main(void)
{
#include<clipPlaneFragment>
#ifdef ALPHATEST
float alphaFromAlphaTexture=texture2D(diffuseSampler,vUV).a;
if (alphaFromAlphaTexture<0.4)
discard;
#endif
#if SM_SOFTTRANSPARENTSHADOW == 1
#ifdef ALPHATEST
if ((bayerDither8(floor(mod(gl_FragCoord.xy,8.0))))/64.0>=softTransparentShadowSM*alphaFromAlphaTexture) discard;
#else
if ((bayerDither8(floor(mod(gl_FragCoord.xy,8.0))))/64.0>=softTransparentShadowSM) discard;
#endif
#endif
#include<shadowMapFragment>
}`;Ye.a.ShadersStore.shadowMapPixelShader=ow;var aw=`#if SM_NORMALBIAS == 1
uniform vec3 lightDataSM;
#endif
uniform vec3 biasAndScaleSM;
uniform vec2 depthValuesSM;
varying float vDepthMetricSM;
#if SM_USEDISTANCE == 1
varying vec3 vPositionWSM;
#endif
#if defined(SM_DEPTHCLAMP) && SM_DEPTHCLAMP == 1
varying float zSM;
#endif
`;Ye.a.IncludesShadersStore.shadowMapVertexDeclaration=aw;var sw=`
#if SM_NORMALBIAS == 1
#if SM_DIRECTIONINLIGHTDATA == 1
vec3 worldLightDirSM=normalize(-lightDataSM.xyz);
#else
vec3 directionToLightSM=lightDataSM.xyz-worldPos.xyz;
vec3 worldLightDirSM=normalize(directionToLightSM);
#endif
float ndlSM=dot(vNormalW,worldLightDirSM);
float sinNLSM=sqrt(1.0-ndlSM*ndlSM);
float normalBiasSM=biasAndScaleSM.y*sinNLSM;
worldPos.xyz-=vNormalW*normalBiasSM;
#endif
`;Ye.a.IncludesShadersStore.shadowMapVertexNormalBias=sw;var cw=`#if SM_USEDISTANCE == 1
vPositionWSM=worldPos.xyz;
#endif
#if SM_DEPTHTEXTURE == 1

gl_Position.z+=biasAndScaleSM.x*gl_Position.w;
#endif
#if defined(SM_DEPTHCLAMP) && SM_DEPTHCLAMP == 1
zSM=gl_Position.z;
gl_Position.z=0.0;
#elif SM_USEDISTANCE == 0

vDepthMetricSM=((gl_Position.z+depthValuesSM.x)/(depthValuesSM.y))+biasAndScaleSM.x;
#endif
`;Ye.a.IncludesShadersStore.shadowMapVertexMetric=cw;var lw=`
attribute vec3 position;
#ifdef NORMAL
attribute vec3 normal;
#endif
#include<bonesDeclaration>
#include<morphTargetsVertexGlobalDeclaration>
#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]

#include<instancesDeclaration>
#include<helperFunctions>
uniform mat4 viewProjection;
#ifdef ALPHATEST
varying vec2 vUV;
uniform mat4 diffuseMatrix;
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#endif
#include<shadowMapVertexDeclaration>
#include<clipPlaneVertexDeclaration>
void main(void)
{
vec3 positionUpdated=position;
#ifdef UV1
vec2 uvUpdated=uv;
#endif
#ifdef NORMAL
vec3 normalUpdated=normal;
#endif
#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]
#include<instancesVertex>
#include<bonesVertex>
vec4 worldPos=finalWorld*vec4(positionUpdated,1.0);
#ifdef NORMAL
mat3 normWorldSM=mat3(finalWorld);
#if defined(INSTANCES) && defined(THIN_INSTANCES)
vec3 vNormalW=normalUpdated/vec3(dot(normWorldSM[0],normWorldSM[0]),dot(normWorldSM[1],normWorldSM[1]),dot(normWorldSM[2],normWorldSM[2]));
vNormalW=normalize(normWorldSM*vNormalW);
#else
#ifdef NONUNIFORMSCALING
normWorldSM=transposeMat3(inverseMat3(normWorldSM));
#endif
vec3 vNormalW=normalize(normWorldSM*normalUpdated);
#endif
#endif
#include<shadowMapVertexNormalBias>

gl_Position=viewProjection*worldPos;
#include<shadowMapVertexMetric>
#ifdef ALPHATEST
#ifdef UV1
vUV=vec2(diffuseMatrix*vec4(uvUpdated,1.0,0.0));
#endif
#ifdef UV2
vUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));
#endif
#endif
#include<clipPlaneVertex>
}`;Ye.a.ShadersStore.shadowMapVertexShader=lw;var uw=`
varying vec2 vUV;
uniform sampler2D textureSampler;

uniform vec2 screenSize;
void main(void)
{
vec4 colorDepth=vec4(0.0);
for (int x=-OFFSET; x<=OFFSET; x++)
for (int y=-OFFSET; y<=OFFSET; y++)
colorDepth+=texture2D(textureSampler,vUV+vec2(x,y)/screenSize);
gl_FragColor=(colorDepth/float((OFFSET*2+1)*(OFFSET*2+1)));
}`;Ye.a.ShadersStore.depthBoxBlurPixelShader=uw;var hw=`#if SM_SOFTTRANSPARENTSHADOW == 1
if ((bayerDither8(floor(mod(gl_FragCoord.xy,8.0))))/64.0>=softTransparentShadowSM*alpha) discard;
#endif
`;Ye.a.IncludesShadersStore.shadowMapFragmentSoftTransparentShadow=hw;var T0=new d.a,E0=new d.a,Hr=function(){function i(t,e,n){this.onBeforeShadowMapRenderObservable=new S.c,this.onAfterShadowMapRenderObservable=new S.c,this.onBeforeShadowMapRenderMeshObservable=new S.c,this.onAfterShadowMapRenderMeshObservable=new S.c,this._bias=5e-5,this._normalBias=0,this._blurBoxOffset=1,this._blurScale=2,this._blurKernel=1,this._useKernelBlur=!1,this._filter=i.FILTER_NONE,this._filteringQuality=i.QUALITY_HIGH,this._contactHardeningLightSizeUVRatio=.1,this._darkness=0,this._transparencyShadow=!1,this.enableSoftTransparentShadow=!1,this.frustumEdgeFalloff=0,this.forceBackFacesOnly=!1,this._lightDirection=d.e.Zero(),this._viewMatrix=d.a.Zero(),this._projectionMatrix=d.a.Zero(),this._transformMatrix=d.a.Zero(),this._cachedPosition=new d.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cachedDirection=new d.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._currentFaceIndex=0,this._currentFaceIndexCache=0,this._defaultTextureMatrix=d.a.Identity(),this._mapSize=t,this._light=e,this._scene=e.getScene(),e._shadowGenerator=this,this.id=e.id,i._SceneComponentInitialization(this._scene);var r=this._scene.getEngine().getCaps();n?r.textureFloatRender&&r.textureFloatLinearFiltering?this._textureType=g.a.TEXTURETYPE_FLOAT:r.textureHalfFloatRender&&r.textureHalfFloatLinearFiltering?this._textureType=g.a.TEXTURETYPE_HALF_FLOAT:this._textureType=g.a.TEXTURETYPE_UNSIGNED_INT:r.textureHalfFloatRender&&r.textureHalfFloatLinearFiltering?this._textureType=g.a.TEXTURETYPE_HALF_FLOAT:r.textureFloatRender&&r.textureFloatLinearFiltering?this._textureType=g.a.TEXTURETYPE_FLOAT:this._textureType=g.a.TEXTURETYPE_UNSIGNED_INT,this._initializeGenerator(),this._applyFilterValues()}return Object.defineProperty(i.prototype,"bias",{get:function(){return this._bias},set:function(t){this._bias=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"normalBias",{get:function(){return this._normalBias},set:function(t){this._normalBias=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"blurBoxOffset",{get:function(){return this._blurBoxOffset},set:function(t){this._blurBoxOffset!==t&&(this._blurBoxOffset=t,this._disposeBlurPostProcesses())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"blurScale",{get:function(){return this._blurScale},set:function(t){this._blurScale!==t&&(this._blurScale=t,this._disposeBlurPostProcesses())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"blurKernel",{get:function(){return this._blurKernel},set:function(t){this._blurKernel!==t&&(this._blurKernel=t,this._disposeBlurPostProcesses())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"useKernelBlur",{get:function(){return this._useKernelBlur},set:function(t){this._useKernelBlur!==t&&(this._useKernelBlur=t,this._disposeBlurPostProcesses())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"depthScale",{get:function(){return this._depthScale!==void 0?this._depthScale:this._light.getDepthScale()},set:function(t){this._depthScale=t},enumerable:!1,configurable:!0}),i.prototype._validateFilter=function(t){return t},Object.defineProperty(i.prototype,"filter",{get:function(){return this._filter},set:function(t){if(t=this._validateFilter(t),this._light.needCube()){if(t===i.FILTER_BLUREXPONENTIALSHADOWMAP)return void(this.useExponentialShadowMap=!0);if(t===i.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP)return void(this.useCloseExponentialShadowMap=!0);if(t===i.FILTER_PCF||t===i.FILTER_PCSS)return void(this.usePoissonSampling=!0)}t!==i.FILTER_PCF&&t!==i.FILTER_PCSS||this._scene.getEngine().webGLVersion!==1?this._filter!==t&&(this._filter=t,this._disposeBlurPostProcesses(),this._applyFilterValues(),this._light._markMeshesAsLightDirty()):this.usePoissonSampling=!0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"usePoissonSampling",{get:function(){return this.filter===i.FILTER_POISSONSAMPLING},set:function(t){var e=this._validateFilter(i.FILTER_POISSONSAMPLING);(t||this.filter===i.FILTER_POISSONSAMPLING)&&(this.filter=t?e:i.FILTER_NONE)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"useExponentialShadowMap",{get:function(){return this.filter===i.FILTER_EXPONENTIALSHADOWMAP},set:function(t){var e=this._validateFilter(i.FILTER_EXPONENTIALSHADOWMAP);(t||this.filter===i.FILTER_EXPONENTIALSHADOWMAP)&&(this.filter=t?e:i.FILTER_NONE)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"useBlurExponentialShadowMap",{get:function(){return this.filter===i.FILTER_BLUREXPONENTIALSHADOWMAP},set:function(t){var e=this._validateFilter(i.FILTER_BLUREXPONENTIALSHADOWMAP);(t||this.filter===i.FILTER_BLUREXPONENTIALSHADOWMAP)&&(this.filter=t?e:i.FILTER_NONE)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"useCloseExponentialShadowMap",{get:function(){return this.filter===i.FILTER_CLOSEEXPONENTIALSHADOWMAP},set:function(t){var e=this._validateFilter(i.FILTER_CLOSEEXPONENTIALSHADOWMAP);(t||this.filter===i.FILTER_CLOSEEXPONENTIALSHADOWMAP)&&(this.filter=t?e:i.FILTER_NONE)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"useBlurCloseExponentialShadowMap",{get:function(){return this.filter===i.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP},set:function(t){var e=this._validateFilter(i.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP);(t||this.filter===i.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP)&&(this.filter=t?e:i.FILTER_NONE)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"usePercentageCloserFiltering",{get:function(){return this.filter===i.FILTER_PCF},set:function(t){var e=this._validateFilter(i.FILTER_PCF);(t||this.filter===i.FILTER_PCF)&&(this.filter=t?e:i.FILTER_NONE)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"filteringQuality",{get:function(){return this._filteringQuality},set:function(t){this._filteringQuality!==t&&(this._filteringQuality=t,this._disposeBlurPostProcesses(),this._applyFilterValues(),this._light._markMeshesAsLightDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"useContactHardeningShadow",{get:function(){return this.filter===i.FILTER_PCSS},set:function(t){var e=this._validateFilter(i.FILTER_PCSS);(t||this.filter===i.FILTER_PCSS)&&(this.filter=t?e:i.FILTER_NONE)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"contactHardeningLightSizeUVRatio",{get:function(){return this._contactHardeningLightSizeUVRatio},set:function(t){this._contactHardeningLightSizeUVRatio=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"darkness",{get:function(){return this._darkness},set:function(t){this.setDarkness(t)},enumerable:!1,configurable:!0}),i.prototype.getDarkness=function(){return this._darkness},i.prototype.setDarkness=function(t){return this._darkness=t>=1?1:t<=0?0:t,this},Object.defineProperty(i.prototype,"transparencyShadow",{get:function(){return this._transparencyShadow},set:function(t){this.setTransparencyShadow(t)},enumerable:!1,configurable:!0}),i.prototype.setTransparencyShadow=function(t){return this._transparencyShadow=t,this},i.prototype.getShadowMap=function(){return this._shadowMap},i.prototype.getShadowMapForRendering=function(){return this._shadowMap2?this._shadowMap2:this._shadowMap},i.prototype.getClassName=function(){return i.CLASSNAME},i.prototype.addShadowCaster=function(t,e){var n;return e===void 0&&(e=!0),this._shadowMap?(this._shadowMap.renderList||(this._shadowMap.renderList=[]),this._shadowMap.renderList.push(t),e&&(n=this._shadowMap.renderList).push.apply(n,t.getChildMeshes()),this):this},i.prototype.removeShadowCaster=function(t,e){if(e===void 0&&(e=!0),!this._shadowMap||!this._shadowMap.renderList)return this;var n=this._shadowMap.renderList.indexOf(t);if(n!==-1&&this._shadowMap.renderList.splice(n,1),e)for(var r=0,o=t.getChildren();r<o.length;r++){var u=o[r];this.removeShadowCaster(u)}return this},i.prototype.getLight=function(){return this._light},Object.defineProperty(i.prototype,"mapSize",{get:function(){return this._mapSize},set:function(t){this._mapSize=t,this._light._markMeshesAsLightDirty(),this.recreateShadowMap()},enumerable:!1,configurable:!0}),i.prototype._initializeGenerator=function(){this._light._markMeshesAsLightDirty(),this._initializeShadowMap()},i.prototype._createTargetRenderTexture=function(){this._scene.getEngine().webGLVersion>1?(this._shadowMap=new qn(this._light.name+"_shadowMap",this._mapSize,this._scene,!1,!0,this._textureType,this._light.needCube(),void 0,!1,!1),this._shadowMap.createDepthStencilTexture(g.a.LESS,!0)):this._shadowMap=new qn(this._light.name+"_shadowMap",this._mapSize,this._scene,!1,!0,this._textureType,this._light.needCube())},i.prototype._initializeShadowMap=function(){var t=this;if(this._createTargetRenderTexture(),this._shadowMap!==null){this._shadowMap.wrapU=ke.a.CLAMP_ADDRESSMODE,this._shadowMap.wrapV=ke.a.CLAMP_ADDRESSMODE,this._shadowMap.anisotropicFilteringLevel=1,this._shadowMap.updateSamplingMode(ke.a.BILINEAR_SAMPLINGMODE),this._shadowMap.renderParticles=!1,this._shadowMap.ignoreCameraViewport=!0,this._storedUniqueId&&(this._shadowMap.uniqueId=this._storedUniqueId),this._shadowMap.customRenderFunction=this._renderForShadowMap.bind(this),this._shadowMap.customIsReadyFunction=function(u,f){return!0};var e=this._scene.getEngine();this._shadowMap.onBeforeRenderObservable.add(function(u){if(t._currentFaceIndex=u,t._filter===i.FILTER_PCF&&e.setColorWrite(!1),t._scene.getSceneUniformBuffer().useUbo){var f=t._scene.getSceneUniformBuffer();f.updateMatrix("viewProjection",t.getTransformMatrix()),f.updateMatrix("view",t._viewMatrix),f.update()}}),this._shadowMap.onAfterUnbindObservable.add(function(){if(t._scene.getSceneUniformBuffer().useUbo){var u=t._scene.getSceneUniformBuffer();u.updateMatrix("viewProjection",t._scene.getTransformMatrix()),u.updateMatrix("view",t._scene.getViewMatrix()),u.update()}if(t._filter===i.FILTER_PCF&&e.setColorWrite(!0),t.useBlurExponentialShadowMap||t.useBlurCloseExponentialShadowMap){var f=t.getShadowMapForRendering();if(f){var v=f.getInternalTexture();t._scene.postProcessManager.directRender(t._blurPostProcesses,v,!0),e.unBindFramebuffer(v,!0)}}});var n=new M.b(0,0,0,0),r=new M.b(1,1,1,1);this._shadowMap.onClearObservable.add(function(u){t._filter===i.FILTER_PCF?u.clear(r,!1,!0,!1):t.useExponentialShadowMap||t.useBlurExponentialShadowMap?u.clear(n,!0,!0,!1):u.clear(r,!0,!0,!1)}),this._shadowMap.onResizeObservable.add(function(u){t._storedUniqueId=t._shadowMap.uniqueId,t._mapSize=u.getRenderSize(),t._light._markMeshesAsLightDirty(),t.recreateShadowMap()});for(var o=$c.b.MIN_RENDERINGGROUPS;o<$c.b.MAX_RENDERINGGROUPS;o++)this._shadowMap.setRenderingAutoClearDepthStencil(o,!1)}},i.prototype._initializeBlurRTTAndPostProcesses=function(){var t=this,e=this._scene.getEngine(),n=this._mapSize/this.blurScale;this.useKernelBlur&&this.blurScale===1||(this._shadowMap2=new qn(this._light.name+"_shadowMap2",n,this._scene,!1,!0,this._textureType),this._shadowMap2.wrapU=ke.a.CLAMP_ADDRESSMODE,this._shadowMap2.wrapV=ke.a.CLAMP_ADDRESSMODE,this._shadowMap2.updateSamplingMode(ke.a.BILINEAR_SAMPLINGMODE)),this.useKernelBlur?(this._kernelBlurXPostprocess=new ar(this._light.name+"KernelBlurX",new d.d(1,0),this.blurKernel,1,null,ke.a.BILINEAR_SAMPLINGMODE,e,!1,this._textureType),this._kernelBlurXPostprocess.width=n,this._kernelBlurXPostprocess.height=n,this._kernelBlurXPostprocess.onApplyObservable.add(function(r){r.setTexture("textureSampler",t._shadowMap)}),this._kernelBlurYPostprocess=new ar(this._light.name+"KernelBlurY",new d.d(0,1),this.blurKernel,1,null,ke.a.BILINEAR_SAMPLINGMODE,e,!1,this._textureType),this._kernelBlurXPostprocess.autoClear=!1,this._kernelBlurYPostprocess.autoClear=!1,this._textureType===g.a.TEXTURETYPE_UNSIGNED_INT&&(this._kernelBlurXPostprocess.packedFloat=!0,this._kernelBlurYPostprocess.packedFloat=!0),this._blurPostProcesses=[this._kernelBlurXPostprocess,this._kernelBlurYPostprocess]):(this._boxBlurPostprocess=new St(this._light.name+"DepthBoxBlur","depthBoxBlur",["screenSize","boxOffset"],[],1,null,ke.a.BILINEAR_SAMPLINGMODE,e,!1,"#define OFFSET "+this._blurBoxOffset,this._textureType),this._boxBlurPostprocess.onApplyObservable.add(function(r){r.setFloat2("screenSize",n,n),r.setTexture("textureSampler",t._shadowMap)}),this._boxBlurPostprocess.autoClear=!1,this._blurPostProcesses=[this._boxBlurPostprocess])},i.prototype._renderForShadowMap=function(t,e,n,r){var o,u=this._scene.getEngine(),f=u.getColorWrite();if(r.length){for(u.setColorWrite(!1),o=0;o<r.length;o++)this._renderSubMeshForShadowMap(r.data[o]);u.setColorWrite(f)}for(o=0;o<t.length;o++)this._renderSubMeshForShadowMap(t.data[o]);for(o=0;o<e.length;o++)this._renderSubMeshForShadowMap(e.data[o]);if(this._transparencyShadow)for(o=0;o<n.length;o++)this._renderSubMeshForShadowMap(n.data[o],!0);else for(o=0;o<n.length;o++)n.data[o].getEffectiveMesh()._internalAbstractMeshDataInfo._isActiveIntermediate=!1},i.prototype._bindCustomEffectForRenderSubMeshForShadowMap=function(t,e,n,r){var o,u,f,v,y,D;e.setMatrix((o=n==null?void 0:n.viewProjection)!==null&&o!==void 0?o:"viewProjection",this.getTransformMatrix()),e.setMatrix((u=n==null?void 0:n.view)!==null&&u!==void 0?u:"view",this._viewMatrix),e.setMatrix((f=n==null?void 0:n.projection)!==null&&f!==void 0?f:"projection",this._projectionMatrix);var w=r.getWorldMatrix();e.setMatrix((v=n==null?void 0:n.world)!==null&&v!==void 0?v:"world",w),w.multiplyToRef(this.getTransformMatrix(),T0),e.setMatrix((y=n==null?void 0:n.worldViewProjection)!==null&&y!==void 0?y:"worldViewProjection",T0),w.multiplyToRef(this._viewMatrix,E0),e.setMatrix((D=n==null?void 0:n.worldView)!==null&&D!==void 0?D:"worldView",E0)},i.prototype._renderSubMeshForShadowMap=function(t,e){var n,r;e===void 0&&(e=!1);var o=t.getRenderingMesh(),u=t.getEffectiveMesh(),f=this._scene,v=f.getEngine(),y=t.getMaterial();if(u._internalAbstractMeshDataInfo._isActiveIntermediate=!1,y&&t.verticesCount!==0&&t._renderId!==f.getRenderId()){v.setState(y.backFaceCulling);var D=o._getInstancesRenderList(t._id,!!t.getReplacementMesh());if(!D.mustReturn){var w=v.getCaps().instancedArrays&&(D.visibleInstances[t._id]!==null&&D.visibleInstances[t._id]!==void 0||o.hasThinInstances);if(!this.customAllowRendering||this.customAllowRendering(t))if(this.isReady(t,w,e)){t._renderId=f.getRenderId();var F=(n=o.material)===null||n===void 0?void 0:n.shadowDepthWrapper,z=(r=F==null?void 0:F.getEffect(t,this))!==null&&r!==void 0?r:this._effect;if(v.enableEffect(z),o._bind(t,z,y.fillMode),this.getTransformMatrix(),z.setFloat3("biasAndScaleSM",this.bias,this.normalBias,this.depthScale),this.getLight().getTypeID()===uo.a.LIGHTTYPEID_DIRECTIONALLIGHT?z.setVector3("lightDataSM",this._cachedDirection):z.setVector3("lightDataSM",this._cachedPosition),f.activeCamera&&z.setFloat2("depthValuesSM",this.getLight().getDepthMinZ(f.activeCamera),this.getLight().getDepthMinZ(f.activeCamera)+this.getLight().getDepthMaxZ(f.activeCamera)),e&&this.enableSoftTransparentShadow&&z.setFloat("softTransparentShadowSM",u.visibility),F)t._effectOverride=z,F.standalone?F.baseMaterial.bindForSubMesh(u.getWorldMatrix(),o,t):y.bindForSubMesh(u.getWorldMatrix(),o,t),t._effectOverride=null;else{if(z.setMatrix("viewProjection",this.getTransformMatrix()),y&&y.needAlphaTesting()){var k=y.getAlphaTestTexture();k&&(z.setTexture("diffuseSampler",k),z.setMatrix("diffuseMatrix",k.getTextureMatrix()||this._defaultTextureMatrix))}if(o.useBones&&o.computeBonesUsingShaders&&o.skeleton){var K=o.skeleton;if(K.isUsingTextureForMatrices){var oe=K.getTransformMatrixTexture(o);if(!oe)return;z.setTexture("boneSampler",oe),z.setFloat("boneTextureWidth",4*(K.bones.length+1))}else z.setMatrices("mBones",K.getTransformMatrices(o))}lt.a.BindMorphTargetParameters(o,z),lt.a.BindClipPlane(z,f)}this._bindCustomEffectForRenderSubMeshForShadowMap(t,z,F==null?void 0:F._matriceNames,u),this.forceBackFacesOnly&&v.setState(!0,0,!1,!0),this.onBeforeShadowMapRenderMeshObservable.notifyObservers(o),this.onBeforeShadowMapRenderObservable.notifyObservers(z),o._processRendering(u,t,z,y.fillMode,D,w,function(ae,ue){return z.setMatrix("world",ue)}),this.forceBackFacesOnly&&v.setState(!0,0,!1,!1),this.onAfterShadowMapRenderObservable.notifyObservers(z),this.onAfterShadowMapRenderMeshObservable.notifyObservers(o)}else this._shadowMap&&this._shadowMap.resetRefreshCounter()}}},i.prototype._applyFilterValues=function(){this._shadowMap&&(this.filter===i.FILTER_NONE||this.filter===i.FILTER_PCSS?this._shadowMap.updateSamplingMode(ke.a.NEAREST_SAMPLINGMODE):this._shadowMap.updateSamplingMode(ke.a.BILINEAR_SAMPLINGMODE))},i.prototype.forceCompilation=function(t,e){var n=this,r=Object(p.a)({useInstances:!1},e),o=this.getShadowMap();if(o){var u=o.renderList;if(u){for(var f=new Array,v=0,y=u;v<y.length;v++){var D=y[v];f.push.apply(f,D.subMeshes)}if(f.length!==0){var w=0,F=function(){var z,k;if(n._scene&&n._scene.getEngine()){for(;n.isReady(f[w],r.useInstances,(k=(z=f[w].getMaterial())===null||z===void 0?void 0:z.needAlphaBlendingForMesh(f[w].getMesh()))!==null&&k!==void 0&&k);)if(++w>=f.length)return void(t&&t(n));setTimeout(F,16)}};F()}else t&&t(this)}else t&&t(this)}else t&&t(this)},i.prototype.forceCompilationAsync=function(t){var e=this;return new Promise(function(n){e.forceCompilation(function(){n()},t)})},i.prototype._isReadyCustomDefines=function(t,e,n){},i.prototype._prepareShadowDefines=function(t,e,n,r){n.push("#define SM_FLOAT "+(this._textureType!==g.a.TEXTURETYPE_UNSIGNED_INT?"1":"0")),n.push("#define SM_ESM "+(this.useExponentialShadowMap||this.useBlurExponentialShadowMap?"1":"0")),n.push("#define SM_DEPTHTEXTURE "+(this.usePercentageCloserFiltering||this.useContactHardeningShadow?"1":"0"));var o=t.getMesh();return n.push("#define SM_NORMALBIAS "+(this.normalBias&&o.isVerticesDataPresent(De.b.NormalKind)?"1":"0")),n.push("#define SM_DIRECTIONINLIGHTDATA "+(this.getLight().getTypeID()===uo.a.LIGHTTYPEID_DIRECTIONALLIGHT?"1":"0")),n.push("#define SM_USEDISTANCE "+(this._light.needCube()?"1":"0")),n.push("#define SM_SOFTTRANSPARENTSHADOW "+(this.enableSoftTransparentShadow&&r?"1":"0")),this._isReadyCustomDefines(n,t,e),n},i.prototype.isReady=function(t,e,n){var r=t.getMaterial(),o=r==null?void 0:r.shadowDepthWrapper,u=[];if(this._prepareShadowDefines(t,e,u,n),o){if(!o.isReadyForSubMesh(t,u,this,e))return!1}else{var f=[De.b.PositionKind],v=t.getMesh();if(this.normalBias&&v.isVerticesDataPresent(De.b.NormalKind)&&(f.push(De.b.NormalKind),u.push("#define NORMAL"),v.nonUniformScaling&&u.push("#define NONUNIFORMSCALING")),r&&r.needAlphaTesting()){var y=r.getAlphaTestTexture();if(y){if(!y.isReady())return!1;u.push("#define ALPHATEST"),v.isVerticesDataPresent(De.b.UVKind)&&(f.push(De.b.UVKind),u.push("#define UV1")),v.isVerticesDataPresent(De.b.UV2Kind)&&y.coordinatesIndex===1&&(f.push(De.b.UV2Kind),u.push("#define UV2"))}}var D=new Ts.a;if(v.useBones&&v.computeBonesUsingShaders&&v.skeleton){f.push(De.b.MatricesIndicesKind),f.push(De.b.MatricesWeightsKind),v.numBoneInfluencers>4&&(f.push(De.b.MatricesIndicesExtraKind),f.push(De.b.MatricesWeightsExtraKind));var w=v.skeleton;u.push("#define NUM_BONE_INFLUENCERS "+v.numBoneInfluencers),v.numBoneInfluencers>0&&D.addCPUSkinningFallback(0,v),w.isUsingTextureForMatrices?u.push("#define BONETEXTURE"):u.push("#define BonesPerMesh "+(w.bones.length+1))}else u.push("#define NUM_BONE_INFLUENCERS 0");var F=v.morphTargetManager,z=0;F&&F.numInfluencers>0&&(u.push("#define MORPHTARGETS"),z=F.numInfluencers,u.push("#define NUM_MORPH_INFLUENCERS "+z),lt.a.PrepareAttributesForMorphTargetsInfluencers(f,v,z));var k=this._scene;if(k.clipPlane&&u.push("#define CLIPPLANE"),k.clipPlane2&&u.push("#define CLIPPLANE2"),k.clipPlane3&&u.push("#define CLIPPLANE3"),k.clipPlane4&&u.push("#define CLIPPLANE4"),k.clipPlane5&&u.push("#define CLIPPLANE5"),k.clipPlane6&&u.push("#define CLIPPLANE6"),e&&(u.push("#define INSTANCES"),lt.a.PushAttributesForInstances(f),t.getRenderingMesh().hasThinInstances&&u.push("#define THIN_INSTANCES")),this.customShaderOptions&&this.customShaderOptions.defines)for(var K=0,oe=this.customShaderOptions.defines;K<oe.length;K++){var ae=oe[K];u.indexOf(ae)===-1&&u.push(ae)}var ue=u.join(`
`);if(this._cachedDefines!==ue){this._cachedDefines=ue;var de="shadowMap",me=["world","mBones","viewProjection","diffuseMatrix","lightDataSM","depthValuesSM","biasAndScaleSM","morphTargetInfluences","boneTextureWidth","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","softTransparentShadowSM"],ye=["diffuseSampler","boneSampler"];if(this.customShaderOptions){if(de=this.customShaderOptions.shaderName,this.customShaderOptions.attributes)for(var Ee=0,Ae=this.customShaderOptions.attributes;Ee<Ae.length;Ee++){var Ie=Ae[Ee];f.indexOf(Ie)===-1&&f.push(Ie)}if(this.customShaderOptions.uniforms)for(var Re=0,Pe=this.customShaderOptions.uniforms;Re<Pe.length;Re++){var Ce=Pe[Re];me.indexOf(Ce)===-1&&me.push(Ce)}if(this.customShaderOptions.samplers)for(var Be=0,Oe=this.customShaderOptions.samplers;Be<Oe.length;Be++){var Ve=Oe[Be];ye.indexOf(Ve)===-1&&ye.push(Ve)}}this._effect=this._scene.getEngine().createEffect(de,f,me,ye,ue,D,void 0,void 0,{maxSimultaneousMorphTargets:z})}if(!this._effect.isReady())return!1}return(this.useBlurExponentialShadowMap||this.useBlurCloseExponentialShadowMap)&&(this._blurPostProcesses&&this._blurPostProcesses.length||this._initializeBlurRTTAndPostProcesses()),!(this._kernelBlurXPostprocess&&!this._kernelBlurXPostprocess.isReady())&&!(this._kernelBlurYPostprocess&&!this._kernelBlurYPostprocess.isReady())&&!(this._boxBlurPostprocess&&!this._boxBlurPostprocess.isReady())},i.prototype.prepareDefines=function(t,e){var n=this._scene,r=this._light;n.shadowsEnabled&&r.shadowEnabled&&(t["SHADOW"+e]=!0,this.useContactHardeningShadow?(t["SHADOWPCSS"+e]=!0,this._filteringQuality===i.QUALITY_LOW?t["SHADOWLOWQUALITY"+e]=!0:this._filteringQuality===i.QUALITY_MEDIUM&&(t["SHADOWMEDIUMQUALITY"+e]=!0)):this.usePercentageCloserFiltering?(t["SHADOWPCF"+e]=!0,this._filteringQuality===i.QUALITY_LOW?t["SHADOWLOWQUALITY"+e]=!0:this._filteringQuality===i.QUALITY_MEDIUM&&(t["SHADOWMEDIUMQUALITY"+e]=!0)):this.usePoissonSampling?t["SHADOWPOISSON"+e]=!0:this.useExponentialShadowMap||this.useBlurExponentialShadowMap?t["SHADOWESM"+e]=!0:(this.useCloseExponentialShadowMap||this.useBlurCloseExponentialShadowMap)&&(t["SHADOWCLOSEESM"+e]=!0),r.needCube()&&(t["SHADOWCUBE"+e]=!0))},i.prototype.bindShadowLight=function(t,e){var n=this._light,r=this._scene;if(r.shadowsEnabled&&n.shadowEnabled){var o=r.activeCamera;if(o){var u=this.getShadowMap();u&&(n.needCube()||e.setMatrix("lightMatrix"+t,this.getTransformMatrix()),this._filter===i.FILTER_PCF?(e.setDepthStencilTexture("shadowSampler"+t,this.getShadowMapForRendering()),n._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),u.getSize().width,1/u.getSize().width,this.frustumEdgeFalloff,t)):this._filter===i.FILTER_PCSS?(e.setDepthStencilTexture("shadowSampler"+t,this.getShadowMapForRendering()),e.setTexture("depthSampler"+t,this.getShadowMapForRendering()),n._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),1/u.getSize().width,this._contactHardeningLightSizeUVRatio*u.getSize().width,this.frustumEdgeFalloff,t)):(e.setTexture("shadowSampler"+t,this.getShadowMapForRendering()),n._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),this.blurScale/u.getSize().width,this.depthScale,this.frustumEdgeFalloff,t)),n._uniformBuffer.updateFloat2("depthValues",this.getLight().getDepthMinZ(o),this.getLight().getDepthMinZ(o)+this.getLight().getDepthMaxZ(o),t))}}},i.prototype.getTransformMatrix=function(){var t=this._scene;if(this._currentRenderID===t.getRenderId()&&this._currentFaceIndexCache===this._currentFaceIndex)return this._transformMatrix;this._currentRenderID=t.getRenderId(),this._currentFaceIndexCache=this._currentFaceIndex;var e=this._light.position;if(this._light.computeTransformedInformation()&&(e=this._light.transformedPosition),d.e.NormalizeToRef(this._light.getShadowDirection(this._currentFaceIndex),this._lightDirection),Math.abs(d.e.Dot(this._lightDirection,d.e.Up()))===1&&(this._lightDirection.z=1e-13),this._light.needProjectionMatrixCompute()||!this._cachedPosition||!this._cachedDirection||!e.equals(this._cachedPosition)||!this._lightDirection.equals(this._cachedDirection)){this._cachedPosition.copyFrom(e),this._cachedDirection.copyFrom(this._lightDirection),d.a.LookAtLHToRef(e,e.add(this._lightDirection),d.e.Up(),this._viewMatrix);var n=this.getShadowMap();if(n){var r=n.renderList;r&&this._light.setShadowProjectionMatrix(this._projectionMatrix,this._viewMatrix,r)}this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix)}return this._transformMatrix},i.prototype.recreateShadowMap=function(){var t=this._shadowMap;if(t){var e=t.renderList;this._disposeRTTandPostProcesses(),this._initializeGenerator(),this.filter=this.filter,this._applyFilterValues(),this._shadowMap.renderList=e}},i.prototype._disposeBlurPostProcesses=function(){this._shadowMap2&&(this._shadowMap2.dispose(),this._shadowMap2=null),this._boxBlurPostprocess&&(this._boxBlurPostprocess.dispose(),this._boxBlurPostprocess=null),this._kernelBlurXPostprocess&&(this._kernelBlurXPostprocess.dispose(),this._kernelBlurXPostprocess=null),this._kernelBlurYPostprocess&&(this._kernelBlurYPostprocess.dispose(),this._kernelBlurYPostprocess=null),this._blurPostProcesses=[]},i.prototype._disposeRTTandPostProcesses=function(){this._shadowMap&&(this._shadowMap.dispose(),this._shadowMap=null),this._disposeBlurPostProcesses()},i.prototype.dispose=function(){this._disposeRTTandPostProcesses(),this._light&&(this._light._shadowGenerator=null,this._light._markMeshesAsLightDirty()),this.onBeforeShadowMapRenderMeshObservable.clear(),this.onBeforeShadowMapRenderObservable.clear(),this.onAfterShadowMapRenderMeshObservable.clear(),this.onAfterShadowMapRenderObservable.clear()},i.prototype.serialize=function(){var t={},e=this.getShadowMap();if(!e)return t;if(t.className=this.getClassName(),t.lightId=this._light.id,t.id=this._light.id,t.mapSize=e.getRenderSize(),t.forceBackFacesOnly=this.forceBackFacesOnly,t.darkness=this.getDarkness(),t.transparencyShadow=this._transparencyShadow,t.frustumEdgeFalloff=this.frustumEdgeFalloff,t.bias=this.bias,t.normalBias=this.normalBias,t.usePercentageCloserFiltering=this.usePercentageCloserFiltering,t.useContactHardeningShadow=this.useContactHardeningShadow,t.contactHardeningLightSizeUVRatio=this.contactHardeningLightSizeUVRatio,t.filteringQuality=this.filteringQuality,t.useExponentialShadowMap=this.useExponentialShadowMap,t.useBlurExponentialShadowMap=this.useBlurExponentialShadowMap,t.useCloseExponentialShadowMap=this.useBlurExponentialShadowMap,t.useBlurCloseExponentialShadowMap=this.useBlurExponentialShadowMap,t.usePoissonSampling=this.usePoissonSampling,t.depthScale=this.depthScale,t.blurBoxOffset=this.blurBoxOffset,t.blurKernel=this.blurKernel,t.blurScale=this.blurScale,t.useKernelBlur=this.useKernelBlur,t.renderList=[],e.renderList)for(var n=0;n<e.renderList.length;n++){var r=e.renderList[n];t.renderList.push(r.id)}return t},i.Parse=function(t,e,n){for(var r=e.getLightByID(t.lightId),o=n?n(t.mapSize,r):new i(t.mapSize,r),u=o.getShadowMap(),f=0;f<t.renderList.length;f++)e.getMeshesByID(t.renderList[f]).forEach(function(v){u&&(u.renderList||(u.renderList=[]),u.renderList.push(v))});return t.id!==void 0&&(o.id=t.id),o.forceBackFacesOnly=!!t.forceBackFacesOnly,t.darkness!==void 0&&o.setDarkness(t.darkness),t.transparencyShadow&&o.setTransparencyShadow(!0),t.frustumEdgeFalloff!==void 0&&(o.frustumEdgeFalloff=t.frustumEdgeFalloff),t.bias!==void 0&&(o.bias=t.bias),t.normalBias!==void 0&&(o.normalBias=t.normalBias),t.usePercentageCloserFiltering?o.usePercentageCloserFiltering=!0:t.useContactHardeningShadow?o.useContactHardeningShadow=!0:t.usePoissonSampling?o.usePoissonSampling=!0:t.useExponentialShadowMap?o.useExponentialShadowMap=!0:t.useBlurExponentialShadowMap?o.useBlurExponentialShadowMap=!0:t.useCloseExponentialShadowMap?o.useCloseExponentialShadowMap=!0:t.useBlurCloseExponentialShadowMap?o.useBlurCloseExponentialShadowMap=!0:t.useVarianceShadowMap?o.useExponentialShadowMap=!0:t.useBlurVarianceShadowMap&&(o.useBlurExponentialShadowMap=!0),t.contactHardeningLightSizeUVRatio!==void 0&&(o.contactHardeningLightSizeUVRatio=t.contactHardeningLightSizeUVRatio),t.filteringQuality!==void 0&&(o.filteringQuality=t.filteringQuality),t.depthScale&&(o.depthScale=t.depthScale),t.blurScale&&(o.blurScale=t.blurScale),t.blurBoxOffset&&(o.blurBoxOffset=t.blurBoxOffset),t.useKernelBlur&&(o.useKernelBlur=t.useKernelBlur),t.blurKernel&&(o.blurKernel=t.blurKernel),o},i.CLASSNAME="ShadowGenerator",i.FILTER_NONE=0,i.FILTER_EXPONENTIALSHADOWMAP=1,i.FILTER_POISSONSAMPLING=2,i.FILTER_BLUREXPONENTIALSHADOWMAP=3,i.FILTER_CLOSEEXPONENTIALSHADOWMAP=4,i.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP=5,i.FILTER_PCF=6,i.FILTER_PCSS=7,i.QUALITY_HIGH=0,i.QUALITY_MEDIUM=1,i.QUALITY_LOW=2,i._SceneComponentInitialization=function(t){throw dr.a.WarnImport("ShadowGeneratorSceneComponent")},i}(),dw=`#ifdef ALPHATEST
varying vec2 vUV;
uniform sampler2D diffuseSampler;
#endif
varying float vDepthMetric;
#ifdef PACKED
#include<packingFunctions>
#endif
void main(void)
{
#ifdef ALPHATEST
if (texture2D(diffuseSampler,vUV).a<0.4)
discard;
#endif
#ifdef NONLINEARDEPTH
#ifdef PACKED
gl_FragColor=pack(gl_FragCoord.z);
#else
gl_FragColor=vec4(gl_FragCoord.z,0.0,0.0,0.0);
#endif
#else
#ifdef PACKED
gl_FragColor=pack(vDepthMetric);
#else
gl_FragColor=vec4(vDepthMetric,0.0,0.0,1.0);
#endif
#endif
}`;Ye.a.ShadersStore.depthPixelShader=dw;var fw=`
attribute vec3 position;
#include<bonesDeclaration>
#include<morphTargetsVertexGlobalDeclaration>
#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]

#include<instancesDeclaration>
uniform mat4 viewProjection;
uniform vec2 depthValues;
#if defined(ALPHATEST) || defined(NEED_UV)
varying vec2 vUV;
uniform mat4 diffuseMatrix;
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#endif
varying float vDepthMetric;
void main(void)
{
vec3 positionUpdated=position;
#ifdef UV1
vec2 uvUpdated=uv;
#endif
#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]
#include<instancesVertex>
#include<bonesVertex>
gl_Position=viewProjection*finalWorld*vec4(positionUpdated,1.0);
vDepthMetric=((gl_Position.z+depthValues.x)/(depthValues.y));
#if defined(ALPHATEST) || defined(BASIC_RENDER)
#ifdef UV1
vUV=vec2(diffuseMatrix*vec4(uvUpdated,1.0,0.0));
#endif
#ifdef UV2
vUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));
#endif
#endif
}
`;Ye.a.ShadersStore.depthVertexShader=fw;var yh=function(){function i(t,e,n,r){var o=this;e===void 0&&(e=g.a.TEXTURETYPE_FLOAT),n===void 0&&(n=null),r===void 0&&(r=!1),this.enabled=!0,this.useOnlyInActiveCamera=!1,this._scene=t,this._storeNonLinearDepth=r,this.isPacked=e===g.a.TEXTURETYPE_UNSIGNED_BYTE,this.isPacked?this._clearColor=new M.b(1,1,1,1):this._clearColor=new M.b(1,0,0,1),i._SceneComponentInitialization(this._scene),this._camera=n;var u=t.getEngine(),f=this.isPacked||u.webGLVersion===1?g.a.TEXTUREFORMAT_RGBA:g.a.TEXTUREFORMAT_R;this._depthMap=new qn("depthMap",{width:u.getRenderWidth(),height:u.getRenderHeight()},this._scene,!1,!0,e,!1,void 0,void 0,void 0,void 0,f),this._depthMap.wrapU=ke.a.CLAMP_ADDRESSMODE,this._depthMap.wrapV=ke.a.CLAMP_ADDRESSMODE,this._depthMap.refreshRate=1,this._depthMap.renderParticles=!1,this._depthMap.renderList=null,this._depthMap.activeCamera=this._camera,this._depthMap.ignoreCameraViewport=!0,this._depthMap.useCameraPostProcesses=!1,this._depthMap.onClearObservable.add(function(y){y.clear(o._clearColor,!0,!0,!0)});var v=function(y){var D=y.getRenderingMesh(),w=y.getEffectiveMesh(),F=o._scene,z=F.getEngine(),k=y.getMaterial();if(w._internalAbstractMeshDataInfo._isActiveIntermediate=!1,k&&y.verticesCount!==0&&y._renderId!==F.getRenderId()){z.setState(k.backFaceCulling,0,!1,F.useRightHandedSystem);var K=D._getInstancesRenderList(y._id,!!y.getReplacementMesh());if(!K.mustReturn){var oe=z.getCaps().instancedArrays&&(K.visibleInstances[y._id]!==null&&K.visibleInstances[y._id]!==void 0||D.hasThinInstances),ae=o._camera||F.activeCamera;if(o.isReady(y,oe)&&ae){if(y._renderId=F.getRenderId(),z.enableEffect(o._effect),D._bind(y,o._effect,k.fillMode),o._effect.setMatrix("viewProjection",F.getTransformMatrix()),o._effect.setFloat2("depthValues",ae.minZ,ae.minZ+ae.maxZ),k&&k.needAlphaTesting()){var ue=k.getAlphaTestTexture();ue&&(o._effect.setTexture("diffuseSampler",ue),o._effect.setMatrix("diffuseMatrix",ue.getTextureMatrix()))}D.useBones&&D.computeBonesUsingShaders&&D.skeleton&&o._effect.setMatrices("mBones",D.skeleton.getTransformMatrices(D)),lt.a.BindMorphTargetParameters(D,o._effect),D._processRendering(w,y,o._effect,k.fillMode,K,oe,function(de,me){return o._effect.setMatrix("world",me)})}}}};this._depthMap.customRenderFunction=function(y,D,w,F){var z;if(F.length){for(u.setColorWrite(!1),z=0;z<F.length;z++)v(F.data[z]);u.setColorWrite(!0)}for(z=0;z<y.length;z++)v(y.data[z]);for(z=0;z<D.length;z++)v(D.data[z])}}return i.prototype.isReady=function(t,e){var n=t.getMaterial();if(n.disableDepthWrite)return!1;var r=[],o=[De.b.PositionKind],u=t.getMesh();n&&n.needAlphaTesting()&&n.getAlphaTestTexture()&&(r.push("#define ALPHATEST"),u.isVerticesDataPresent(De.b.UVKind)&&(o.push(De.b.UVKind),r.push("#define UV1")),u.isVerticesDataPresent(De.b.UV2Kind)&&(o.push(De.b.UV2Kind),r.push("#define UV2"))),u.useBones&&u.computeBonesUsingShaders?(o.push(De.b.MatricesIndicesKind),o.push(De.b.MatricesWeightsKind),u.numBoneInfluencers>4&&(o.push(De.b.MatricesIndicesExtraKind),o.push(De.b.MatricesWeightsExtraKind)),r.push("#define NUM_BONE_INFLUENCERS "+u.numBoneInfluencers),r.push("#define BonesPerMesh "+(u.skeleton?u.skeleton.bones.length+1:0))):r.push("#define NUM_BONE_INFLUENCERS 0");var f=u.morphTargetManager,v=0;f&&f.numInfluencers>0&&(v=f.numInfluencers,r.push("#define MORPHTARGETS"),r.push("#define NUM_MORPH_INFLUENCERS "+v),lt.a.PrepareAttributesForMorphTargetsInfluencers(o,u,v)),e&&(r.push("#define INSTANCES"),lt.a.PushAttributesForInstances(o),t.getRenderingMesh().hasThinInstances&&r.push("#define THIN_INSTANCES")),this._storeNonLinearDepth&&r.push("#define NONLINEARDEPTH"),this.isPacked&&r.push("#define PACKED");var y=r.join(`
`);return this._cachedDefines!==y&&(this._cachedDefines=y,this._effect=this._scene.getEngine().createEffect("depth",o,["world","mBones","viewProjection","diffuseMatrix","depthValues","morphTargetInfluences"],["diffuseSampler"],y,void 0,void 0,void 0,{maxSimultaneousMorphTargets:v})),this._effect.isReady()},i.prototype.getDepthMap=function(){return this._depthMap},i.prototype.dispose=function(){this._depthMap.dispose()},i._SceneComponentInitialization=function(t){throw dr.a.WarnImport("DepthRendererSceneComponent")},i}(),pw=`attribute vec2 vUV;
uniform sampler2D textureSampler;
#if defined(INITIAL)
uniform sampler2D sourceTexture;
uniform vec2 texSize;
void main(void)
{
ivec2 coord=ivec2(vUV*(texSize-1.0));
float f1=texelFetch(sourceTexture,coord,0).r;
float f2=texelFetch(sourceTexture,coord+ivec2(1,0),0).r;
float f3=texelFetch(sourceTexture,coord+ivec2(1,1),0).r;
float f4=texelFetch(sourceTexture,coord+ivec2(0,1),0).r;
float minz=min(min(min(f1,f2),f3),f4);
#ifdef DEPTH_REDUX
float maxz=max(max(max(sign(1.0-f1)*f1,sign(1.0-f2)*f2),sign(1.0-f3)*f3),sign(1.0-f4)*f4);
#else
float maxz=max(max(max(f1,f2),f3),f4);
#endif
glFragColor=vec4(minz,maxz,0.,0.);
}
#elif defined(MAIN)
uniform vec2 texSize;
void main(void)
{
ivec2 coord=ivec2(vUV*(texSize-1.0));
vec2 f1=texelFetch(textureSampler,coord,0).rg;
vec2 f2=texelFetch(textureSampler,coord+ivec2(1,0),0).rg;
vec2 f3=texelFetch(textureSampler,coord+ivec2(1,1),0).rg;
vec2 f4=texelFetch(textureSampler,coord+ivec2(0,1),0).rg;
float minz=min(min(min(f1.x,f2.x),f3.x),f4.x);
float maxz=max(max(max(f1.y,f2.y),f3.y),f4.y);
glFragColor=vec4(minz,maxz,0.,0.);
}
#elif defined(ONEBEFORELAST)
uniform ivec2 texSize;
void main(void)
{
ivec2 coord=ivec2(vUV*vec2(texSize-1));
vec2 f1=texelFetch(textureSampler,coord % texSize,0).rg;
vec2 f2=texelFetch(textureSampler,(coord+ivec2(1,0)) % texSize,0).rg;
vec2 f3=texelFetch(textureSampler,(coord+ivec2(1,1)) % texSize,0).rg;
vec2 f4=texelFetch(textureSampler,(coord+ivec2(0,1)) % texSize,0).rg;
float minz=min(f1.x,f2.x);
float maxz=max(f1.y,f2.y);
glFragColor=vec4(minz,maxz,0.,0.);
}
#elif defined(LAST)
void main(void)
{
discard;
glFragColor=vec4(0.);
}
#endif
`;Ye.a.ShadersStore.minmaxReduxPixelShader=pw;var S0=function(){function i(t){this.onAfterReductionPerformed=new S.c,this._forceFullscreenViewport=!0,this._activated=!1,this._camera=t,this._postProcessManager=new Mp.a(t.getScene())}return Object.defineProperty(i.prototype,"sourceTexture",{get:function(){return this._sourceTexture},enumerable:!1,configurable:!0}),i.prototype.setSourceTexture=function(t,e,n,r){var o=this;if(n===void 0&&(n=g.a.TEXTURETYPE_HALF_FLOAT),r===void 0&&(r=!0),t!==this._sourceTexture){this.dispose(!1),this._sourceTexture=t,this._reductionSteps=[],this._forceFullscreenViewport=r;var u=this._camera.getScene(),f=new St("Initial reduction phase","minmaxRedux",["texSize"],["sourceTexture"],1,null,g.a.TEXTURE_NEAREST_NEAREST,u.getEngine(),!1,"#define INITIAL"+(e?`
#define DEPTH_REDUX`:""),n,void 0,void 0,void 0,g.a.TEXTUREFORMAT_RG);f.autoClear=!1,f.forceFullscreenViewport=r;var v=this._sourceTexture.getRenderWidth(),y=this._sourceTexture.getRenderHeight();f.onApply=function(F,z){return function(k){k.setTexture("sourceTexture",o._sourceTexture),k.setFloatArray2("texSize",new Float32Array([F,z]))}}(v,y),this._reductionSteps.push(f);for(var D=1;v>1||y>1;){v=Math.max(Math.round(v/2),1),y=Math.max(Math.round(y/2),1);var w=new St("Reduction phase "+D,"minmaxRedux",["texSize"],null,{width:v,height:y},null,g.a.TEXTURE_NEAREST_NEAREST,u.getEngine(),!1,"#define "+(v==1&&y==1?"LAST":v==1||y==1?"ONEBEFORELAST":"MAIN"),n,void 0,void 0,void 0,g.a.TEXTUREFORMAT_RG);w.autoClear=!1,w.forceFullscreenViewport=r,w.onApply=function(F,z){return function(k){F==1||z==1?k.setIntArray2("texSize",new Int32Array([F,z])):k.setFloatArray2("texSize",new Float32Array([F,z]))}}(v,y),this._reductionSteps.push(w),D++,v==1&&y==1&&w.onAfterRenderObservable.add(function(F,z,k){var K=new Float32Array(4*F*z),oe={min:0,max:0};return function(){u.getEngine()._readTexturePixels(k.inputTexture,F,z,-1,0,K),oe.min=K[0],oe.max=K[1],o.onAfterReductionPerformed.notifyObservers(oe)}}(v,y,w))}}},Object.defineProperty(i.prototype,"refreshRate",{get:function(){return this._sourceTexture?this._sourceTexture.refreshRate:-1},set:function(t){this._sourceTexture&&(this._sourceTexture.refreshRate=t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"activated",{get:function(){return this._activated},enumerable:!1,configurable:!0}),i.prototype.activate=function(){var t=this;!this._onAfterUnbindObserver&&this._sourceTexture&&(this._onAfterUnbindObserver=this._sourceTexture.onAfterUnbindObservable.add(function(){t._reductionSteps[0].activate(t._camera),t._postProcessManager.directRender(t._reductionSteps,t._reductionSteps[0].inputTexture,t._forceFullscreenViewport),t._camera.getScene().getEngine().unBindFramebuffer(t._reductionSteps[0].inputTexture,!1)}),this._activated=!0)},i.prototype.deactivate=function(){this._onAfterUnbindObserver&&this._sourceTexture&&(this._sourceTexture.onAfterUnbindObservable.remove(this._onAfterUnbindObserver),this._onAfterUnbindObserver=null,this._activated=!1)},i.prototype.dispose=function(t){if(t===void 0&&(t=!0),t&&this.onAfterReductionPerformed.clear(),this.deactivate(),this._reductionSteps){for(var e=0;e<this._reductionSteps.length;++e)this._reductionSteps[e].dispose();this._reductionSteps=null}this._postProcessManager&&t&&this._postProcessManager.dispose(),this._sourceTexture=null},i}(),x0=function(i){function t(e){return i.call(this,e)||this}return Object(p.d)(t,i),Object.defineProperty(t.prototype,"depthRenderer",{get:function(){return this._depthRenderer},enumerable:!1,configurable:!0}),t.prototype.setDepthRenderer=function(e,n,r){e===void 0&&(e=null),n===void 0&&(n=g.a.TEXTURETYPE_HALF_FLOAT),r===void 0&&(r=!0);var o=this._camera.getScene();this._depthRenderer&&(delete o._depthRenderer[this._depthRendererId],this._depthRenderer.dispose(),this._depthRenderer=null),e===null&&(o._depthRenderer||(o._depthRenderer={}),(e=this._depthRenderer=new yh(o,n,this._camera,!1)).enabled=!1,this._depthRendererId="minmax"+this._camera.id,o._depthRenderer[this._depthRendererId]=e),i.prototype.setSourceTexture.call(this,e.getDepthMap(),!0,n,r)},t.prototype.setSourceTexture=function(e,n,r,o){r===void 0&&(r=g.a.TEXTURETYPE_HALF_FLOAT),o===void 0&&(o=!0),i.prototype.setSourceTexture.call(this,e,n,r,o)},t.prototype.activate=function(){this._depthRenderer&&(this._depthRenderer.enabled=!0),i.prototype.activate.call(this)},t.prototype.deactivate=function(){i.prototype.deactivate.call(this),this._depthRenderer&&(this._depthRenderer.enabled=!1)},t.prototype.dispose=function(e){if(e===void 0&&(e=!0),i.prototype.dispose.call(this,e),this._depthRenderer&&e){var n=this._depthRenderer.getDepthMap().getScene();n&&delete n._depthRenderer[this._depthRendererId],this._depthRenderer.dispose(),this._depthRenderer=null}},t}(S0),A0=d.e.Up(),mw=d.e.Zero(),sr=new d.e,Cs=new d.e,Rs=new d.a,P0=new d.a,cm=function(i){function t(e,n,r){var o=this;if(t.IsSupported)return(o=i.call(this,e,n,r)||this).usePercentageCloserFiltering=!0,o;_.a.Error("CascadedShadowMap needs WebGL 2 support.")}return Object(p.d)(t,i),t.prototype._validateFilter=function(e){return e===Hr.FILTER_NONE||e===Hr.FILTER_PCF||e===Hr.FILTER_PCSS?e:(console.error('Unsupported filter "'+e+'"!'),Hr.FILTER_NONE)},Object.defineProperty(t.prototype,"numCascades",{get:function(){return this._numCascades},set:function(e){(e=Math.min(Math.max(e,t.MIN_CASCADES_COUNT),t.MAX_CASCADES_COUNT))!==this._numCascades&&(this._numCascades=e,this.recreateShadowMap())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"freezeShadowCastersBoundingInfo",{get:function(){return this._freezeShadowCastersBoundingInfo},set:function(e){this._freezeShadowCastersBoundingInfoObservable&&e&&(this._scene.onBeforeRenderObservable.remove(this._freezeShadowCastersBoundingInfoObservable),this._freezeShadowCastersBoundingInfoObservable=null),this._freezeShadowCastersBoundingInfoObservable||e||(this._freezeShadowCastersBoundingInfoObservable=this._scene.onBeforeRenderObservable.add(this._computeShadowCastersBoundingInfo.bind(this))),this._freezeShadowCastersBoundingInfo=e,e&&this._computeShadowCastersBoundingInfo()},enumerable:!1,configurable:!0}),t.prototype._computeShadowCastersBoundingInfo=function(){if(this._scbiMin.copyFromFloats(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._scbiMax.copyFromFloats(Number.MIN_VALUE,Number.MIN_VALUE,Number.MIN_VALUE),this._shadowMap&&this._shadowMap.renderList){for(var e=this._shadowMap.renderList,n=0;n<e.length;n++)if(u=e[n]){var r=u.getBoundingInfo().boundingBox;this._scbiMin.minimizeInPlace(r.minimumWorld),this._scbiMax.maximizeInPlace(r.maximumWorld)}var o=this._scene.meshes;for(n=0;n<o.length;n++){var u;(u=o[n])&&u.isVisible&&u.isEnabled&&u.receiveShadows&&(r=u.getBoundingInfo().boundingBox,this._scbiMin.minimizeInPlace(r.minimumWorld),this._scbiMax.maximizeInPlace(r.maximumWorld))}}this._shadowCastersBoundingInfo.reConstruct(this._scbiMin,this._scbiMax)},Object.defineProperty(t.prototype,"shadowCastersBoundingInfo",{get:function(){return this._shadowCastersBoundingInfo},set:function(e){this._shadowCastersBoundingInfo=e},enumerable:!1,configurable:!0}),t.prototype.setMinMaxDistance=function(e,n){this._minDistance===e&&this._maxDistance===n||(e>n&&(e=0,n=1),e<0&&(e=0),n>1&&(n=1),this._minDistance=e,this._maxDistance=n,this._breaksAreDirty=!0)},Object.defineProperty(t.prototype,"minDistance",{get:function(){return this._minDistance},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxDistance",{get:function(){return this._maxDistance},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return t.CLASSNAME},t.prototype.getCascadeMinExtents=function(e){return e>=0&&e<this._numCascades?this._cascadeMinExtents[e]:null},t.prototype.getCascadeMaxExtents=function(e){return e>=0&&e<this._numCascades?this._cascadeMaxExtents[e]:null},Object.defineProperty(t.prototype,"shadowMaxZ",{get:function(){return this._scene&&this._scene.activeCamera?this._shadowMaxZ:0},set:function(e){this._scene&&this._scene.activeCamera?this._shadowMaxZ===e||e<this._scene.activeCamera.minZ||e>this._scene.activeCamera.maxZ||(this._shadowMaxZ=e,this._light._markMeshesAsLightDirty(),this._breaksAreDirty=!0):this._shadowMaxZ=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"debug",{get:function(){return this._debug},set:function(e){this._debug=e,this._light._markMeshesAsLightDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"depthClamp",{get:function(){return this._depthClamp},set:function(e){this._depthClamp=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cascadeBlendPercentage",{get:function(){return this._cascadeBlendPercentage},set:function(e){this._cascadeBlendPercentage=e,this._light._markMeshesAsLightDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lambda",{get:function(){return this._lambda},set:function(e){var n=Math.min(Math.max(e,0),1);this._lambda!=n&&(this._lambda=n,this._breaksAreDirty=!0)},enumerable:!1,configurable:!0}),t.prototype.getCascadeViewMatrix=function(e){return e>=0&&e<this._numCascades?this._viewMatrices[e]:null},t.prototype.getCascadeProjectionMatrix=function(e){return e>=0&&e<this._numCascades?this._projectionMatrices[e]:null},t.prototype.getCascadeTransformMatrix=function(e){return e>=0&&e<this._numCascades?this._transformMatrices[e]:null},t.prototype.setDepthRenderer=function(e){this._depthRenderer=e,this._depthReducer&&this._depthReducer.setDepthRenderer(this._depthRenderer)},Object.defineProperty(t.prototype,"autoCalcDepthBounds",{get:function(){return this._autoCalcDepthBounds},set:function(e){var n=this,r=this._scene.activeCamera;if(r){if(this._autoCalcDepthBounds=e,!e)return this._depthReducer&&this._depthReducer.deactivate(),void this.setMinMaxDistance(0,1);this._depthReducer||(this._depthReducer=new x0(r),this._depthReducer.onAfterReductionPerformed.add(function(o){var u=o.min,f=o.max;u>=f&&(u=0,f=1),u==n._minDistance&&f==n._maxDistance||n.setMinMaxDistance(u,f)}),this._depthReducer.setDepthRenderer(this._depthRenderer)),this._depthReducer.activate()}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"autoCalcDepthBoundsRefreshRate",{get:function(){var e,n,r;return(r=(n=(e=this._depthReducer)===null||e===void 0?void 0:e.depthRenderer)===null||n===void 0?void 0:n.getDepthMap().refreshRate)!==null&&r!==void 0?r:-1},set:function(e){var n;((n=this._depthReducer)===null||n===void 0?void 0:n.depthRenderer)&&(this._depthReducer.depthRenderer.getDepthMap().refreshRate=e)},enumerable:!1,configurable:!0}),t.prototype.splitFrustum=function(){this._breaksAreDirty=!0},t.prototype._splitFrustum=function(){var e=this._scene.activeCamera;if(e){for(var n=e.minZ,r=e.maxZ,o=r-n,u=this._minDistance,f=n+u*o,v=n+(this._shadowMaxZ<r&&this._shadowMaxZ>=n?Math.min((this._shadowMaxZ-n)/(r-n),this._maxDistance):this._maxDistance)*o,y=v-f,D=v/f,w=0;w<this._cascades.length;++w){var F=(w+1)/this._numCascades,z=f*Math.pow(D,F),k=f+y*F,K=this._lambda*(z-k)+k;this._cascades[w].prevBreakDistance=w===0?u:this._cascades[w-1].breakDistance,this._cascades[w].breakDistance=(K-n)/o,this._viewSpaceFrustumsZ[w]=n+this._cascades[w].breakDistance*o,this._frustumLengths[w]=(this._cascades[w].breakDistance-this._cascades[w].prevBreakDistance)*o}this._breaksAreDirty=!1}},t.prototype._computeMatrices=function(){if(this._scene.activeCamera){d.e.NormalizeToRef(this._light.getShadowDirection(0),this._lightDirection),Math.abs(d.e.Dot(this._lightDirection,d.e.Up()))===1&&(this._lightDirection.z=1e-13),this._cachedDirection.copyFrom(this._lightDirection);for(var e=0;e<this._numCascades;++e){this._computeFrustumInWorldSpace(e),this._computeCascadeFrustum(e),this._cascadeMaxExtents[e].subtractToRef(this._cascadeMinExtents[e],sr),this._frustumCenter[e].addToRef(this._lightDirection.scale(this._cascadeMinExtents[e].z),this._shadowCameraPos[e]),d.a.LookAtLHToRef(this._shadowCameraPos[e],this._frustumCenter[e],A0,this._viewMatrices[e]);var n=0,r=sr.z,o=this._shadowCastersBoundingInfo;o.update(this._viewMatrices[e]),r=Math.min(r,o.boundingBox.maximumWorld.z),n=this._depthClamp&&this.filter!==Hr.FILTER_PCSS?Math.max(n,o.boundingBox.minimumWorld.z):Math.min(n,o.boundingBox.minimumWorld.z),d.a.OrthoOffCenterLHToRef(this._cascadeMinExtents[e].x,this._cascadeMaxExtents[e].x,this._cascadeMinExtents[e].y,this._cascadeMaxExtents[e].y,n,r,this._projectionMatrices[e]),this._cascadeMinExtents[e].z=n,this._cascadeMaxExtents[e].z=r,this._viewMatrices[e].multiplyToRef(this._projectionMatrices[e],this._transformMatrices[e]),d.e.TransformCoordinatesToRef(mw,this._transformMatrices[e],sr),sr.scaleInPlace(this._mapSize/2),Cs.copyFromFloats(Math.round(sr.x),Math.round(sr.y),Math.round(sr.z)),Cs.subtractInPlace(sr).scaleInPlace(2/this._mapSize),d.a.TranslationToRef(Cs.x,Cs.y,0,Rs),this._projectionMatrices[e].multiplyToRef(Rs,this._projectionMatrices[e]),this._viewMatrices[e].multiplyToRef(this._projectionMatrices[e],this._transformMatrices[e]),this._transformMatrices[e].copyToArray(this._transformMatricesAsArray,16*e)}}},t.prototype._computeFrustumInWorldSpace=function(e){if(this._scene.activeCamera){var n=this._cascades[e].prevBreakDistance,r=this._cascades[e].breakDistance;this._scene.activeCamera.getViewMatrix();for(var o=d.a.Invert(this._scene.activeCamera.getTransformationMatrix()),u=0;u<t.frustumCornersNDCSpace.length;++u)d.e.TransformCoordinatesToRef(t.frustumCornersNDCSpace[u],o,this._frustumCornersWorldSpace[e][u]);for(u=0;u<t.frustumCornersNDCSpace.length/2;++u)sr.copyFrom(this._frustumCornersWorldSpace[e][u+4]).subtractInPlace(this._frustumCornersWorldSpace[e][u]),Cs.copyFrom(sr).scaleInPlace(n),sr.scaleInPlace(r),sr.addInPlace(this._frustumCornersWorldSpace[e][u]),this._frustumCornersWorldSpace[e][u+4].copyFrom(sr),this._frustumCornersWorldSpace[e][u].addInPlace(Cs)}},t.prototype._computeCascadeFrustum=function(e){if(this._cascadeMinExtents[e].copyFromFloats(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cascadeMaxExtents[e].copyFromFloats(Number.MIN_VALUE,Number.MIN_VALUE,Number.MIN_VALUE),this._frustumCenter[e].copyFromFloats(0,0,0),this._scene.activeCamera){for(var n=0;n<this._frustumCornersWorldSpace[e].length;++n)this._frustumCenter[e].addInPlace(this._frustumCornersWorldSpace[e][n]);if(this._frustumCenter[e].scaleInPlace(1/this._frustumCornersWorldSpace[e].length),this.stabilizeCascades){var r=0;for(n=0;n<this._frustumCornersWorldSpace[e].length;++n){var o=this._frustumCornersWorldSpace[e][n].subtractToRef(this._frustumCenter[e],sr).length();r=Math.max(r,o)}r=Math.ceil(16*r)/16,this._cascadeMaxExtents[e].copyFromFloats(r,r,r),this._cascadeMinExtents[e].copyFromFloats(-r,-r,-r)}else{var u=this._frustumCenter[e];for(this._frustumCenter[e].addToRef(this._lightDirection,sr),d.a.LookAtLHToRef(u,sr,A0,Rs),n=0;n<this._frustumCornersWorldSpace[e].length;++n)d.e.TransformCoordinatesToRef(this._frustumCornersWorldSpace[e][n],Rs,sr),this._cascadeMinExtents[e].minimizeInPlace(sr),this._cascadeMaxExtents[e].maximizeInPlace(sr)}}},Object.defineProperty(t,"IsSupported",{get:function(){var e=ne.a.LastCreatedEngine;return!!e&&e.webGLVersion!=1},enumerable:!1,configurable:!0}),t.prototype._initializeGenerator=function(){var e,n,r,o,u,f,v,y,D,w,F,z,k,K,oe,ae,ue,de,me,ye;this.penumbraDarkness=(e=this.penumbraDarkness)!==null&&e!==void 0?e:1,this._numCascades=(n=this._numCascades)!==null&&n!==void 0?n:t.DEFAULT_CASCADES_COUNT,this.stabilizeCascades=(r=this.stabilizeCascades)!==null&&r!==void 0&&r,this._freezeShadowCastersBoundingInfoObservable=(o=this._freezeShadowCastersBoundingInfoObservable)!==null&&o!==void 0?o:null,this.freezeShadowCastersBoundingInfo=(u=this.freezeShadowCastersBoundingInfo)!==null&&u!==void 0&&u,this._scbiMin=(f=this._scbiMin)!==null&&f!==void 0?f:new d.e(0,0,0),this._scbiMax=(v=this._scbiMax)!==null&&v!==void 0?v:new d.e(0,0,0),this._shadowCastersBoundingInfo=(y=this._shadowCastersBoundingInfo)!==null&&y!==void 0?y:new Ho.a(new d.e(0,0,0),new d.e(0,0,0)),this._breaksAreDirty=(D=this._breaksAreDirty)===null||D===void 0||D,this._minDistance=(w=this._minDistance)!==null&&w!==void 0?w:0,this._maxDistance=(F=this._maxDistance)!==null&&F!==void 0?F:1,this._currentLayer=(z=this._currentLayer)!==null&&z!==void 0?z:0,this._shadowMaxZ=(oe=(k=this._shadowMaxZ)!==null&&k!==void 0?k:(K=this._scene.activeCamera)===null||K===void 0?void 0:K.maxZ)!==null&&oe!==void 0?oe:1e4,this._debug=(ae=this._debug)!==null&&ae!==void 0&&ae,this._depthClamp=(ue=this._depthClamp)===null||ue===void 0||ue,this._cascadeBlendPercentage=(de=this._cascadeBlendPercentage)!==null&&de!==void 0?de:.1,this._lambda=(me=this._lambda)!==null&&me!==void 0?me:.5,this._autoCalcDepthBounds=(ye=this._autoCalcDepthBounds)!==null&&ye!==void 0&&ye,i.prototype._initializeGenerator.call(this)},t.prototype._createTargetRenderTexture=function(){var e={width:this._mapSize,height:this._mapSize,layers:this.numCascades};this._shadowMap=new qn(this._light.name+"_shadowMap",e,this._scene,!1,!0,this._textureType,!1,void 0,!1,!1,void 0),this._shadowMap.createDepthStencilTexture(g.a.LESS,!0)},t.prototype._initializeShadowMap=function(){var e=this;if(i.prototype._initializeShadowMap.call(this),this._shadowMap!==null){this._transformMatricesAsArray=new Float32Array(16*this._numCascades),this._viewSpaceFrustumsZ=new Array(this._numCascades),this._frustumLengths=new Array(this._numCascades),this._lightSizeUVCorrection=new Array(2*this._numCascades),this._depthCorrection=new Array(this._numCascades),this._cascades=[],this._viewMatrices=[],this._projectionMatrices=[],this._transformMatrices=[],this._cascadeMinExtents=[],this._cascadeMaxExtents=[],this._frustumCenter=[],this._shadowCameraPos=[],this._frustumCornersWorldSpace=[];for(var n=0;n<this._numCascades;++n){this._cascades[n]={prevBreakDistance:0,breakDistance:0},this._viewMatrices[n]=d.a.Zero(),this._projectionMatrices[n]=d.a.Zero(),this._transformMatrices[n]=d.a.Zero(),this._cascadeMinExtents[n]=new d.e,this._cascadeMaxExtents[n]=new d.e,this._frustumCenter[n]=new d.e,this._shadowCameraPos[n]=new d.e,this._frustumCornersWorldSpace[n]=new Array(t.frustumCornersNDCSpace.length);for(var r=0;r<t.frustumCornersNDCSpace.length;++r)this._frustumCornersWorldSpace[n][r]=new d.e}this._shadowMap.onBeforeRenderObservable.add(function(o){if(e._currentLayer=o,e._scene.getSceneUniformBuffer().useUbo){var u=e._scene.getSceneUniformBuffer();u.updateMatrix("viewProjection",e.getCascadeTransformMatrix(o)),u.updateMatrix("view",e.getCascadeViewMatrix(o)),u.update()}}),this._shadowMap.onBeforeBindObservable.add(function(){e._breaksAreDirty&&e._splitFrustum(),e._computeMatrices()}),this._splitFrustum()}},t.prototype._bindCustomEffectForRenderSubMeshForShadowMap=function(e,n,r,o){var u,f,v,y,D,w;n.setMatrix((u=r==null?void 0:r.viewProjection)!==null&&u!==void 0?u:"viewProjection",this.getCascadeTransformMatrix(this._currentLayer)),n.setMatrix((f=r==null?void 0:r.view)!==null&&f!==void 0?f:"view",this.getCascadeViewMatrix(this._currentLayer)),n.setMatrix((v=r==null?void 0:r.projection)!==null&&v!==void 0?v:"projection",this.getCascadeProjectionMatrix(this._currentLayer));var F=o.getWorldMatrix();n.setMatrix((y=r==null?void 0:r.world)!==null&&y!==void 0?y:"world",F),F.multiplyToRef(this.getCascadeTransformMatrix(this._currentLayer),Rs),n.setMatrix((D=r==null?void 0:r.worldViewProjection)!==null&&D!==void 0?D:"worldViewProjection",Rs),F.multiplyToRef(this.getCascadeViewMatrix(this._currentLayer),P0),n.setMatrix((w=r==null?void 0:r.worldView)!==null&&w!==void 0?w:"worldView",P0)},t.prototype._isReadyCustomDefines=function(e,n,r){e.push("#define SM_DEPTHCLAMP "+(this._depthClamp&&this._filter!==Hr.FILTER_PCSS?"1":"0"))},t.prototype.prepareDefines=function(e,n){i.prototype.prepareDefines.call(this,e,n);var r=this._scene,o=this._light;if(r.shadowsEnabled&&o.shadowEnabled){e["SHADOWCSM"+n]=!0,e["SHADOWCSMDEBUG"+n]=this.debug,e["SHADOWCSMNUM_CASCADES"+n]=this.numCascades,e["SHADOWCSM_RIGHTHANDED"+n]=r.useRightHandedSystem;var u=r.activeCamera;u&&this._shadowMaxZ<u.maxZ&&(e["SHADOWCSMUSESHADOWMAXZ"+n]=!0),this.cascadeBlendPercentage===0&&(e["SHADOWCSMNOBLEND"+n]=!0)}},t.prototype.bindShadowLight=function(e,n){var r=this._light,o=this._scene;if(o.shadowsEnabled&&r.shadowEnabled){var u=o.activeCamera;if(u){var f=this.getShadowMap();if(f){var v=f.getSize().width;if(n.setMatrices("lightMatrix"+e,this._transformMatricesAsArray),n.setArray("viewFrustumZ"+e,this._viewSpaceFrustumsZ),n.setFloat("cascadeBlendFactor"+e,this.cascadeBlendPercentage===0?1e4:1/this.cascadeBlendPercentage),n.setArray("frustumLengths"+e,this._frustumLengths),this._filter===Hr.FILTER_PCF)n.setDepthStencilTexture("shadowSampler"+e,f),r._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),v,1/v,this.frustumEdgeFalloff,e);else if(this._filter===Hr.FILTER_PCSS){for(var y=0;y<this._numCascades;++y)this._lightSizeUVCorrection[2*y+0]=y===0?1:(this._cascadeMaxExtents[0].x-this._cascadeMinExtents[0].x)/(this._cascadeMaxExtents[y].x-this._cascadeMinExtents[y].x),this._lightSizeUVCorrection[2*y+1]=y===0?1:(this._cascadeMaxExtents[0].y-this._cascadeMinExtents[0].y)/(this._cascadeMaxExtents[y].y-this._cascadeMinExtents[y].y),this._depthCorrection[y]=y===0?1:(this._cascadeMaxExtents[y].z-this._cascadeMinExtents[y].z)/(this._cascadeMaxExtents[0].z-this._cascadeMinExtents[0].z);n.setDepthStencilTexture("shadowSampler"+e,f),n.setTexture("depthSampler"+e,f),n.setArray2("lightSizeUVCorrection"+e,this._lightSizeUVCorrection),n.setArray("depthCorrection"+e,this._depthCorrection),n.setFloat("penumbraDarkness"+e,this.penumbraDarkness),r._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),1/v,this._contactHardeningLightSizeUVRatio*v,this.frustumEdgeFalloff,e)}else n.setTexture("shadowSampler"+e,f),r._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),v,1/v,this.frustumEdgeFalloff,e);r._uniformBuffer.updateFloat2("depthValues",this.getLight().getDepthMinZ(u),this.getLight().getDepthMinZ(u)+this.getLight().getDepthMaxZ(u),e)}}}},t.prototype.getTransformMatrix=function(){return this.getCascadeTransformMatrix(0)},t.prototype.dispose=function(){i.prototype.dispose.call(this),this._freezeShadowCastersBoundingInfoObservable&&(this._scene.onBeforeRenderObservable.remove(this._freezeShadowCastersBoundingInfoObservable),this._freezeShadowCastersBoundingInfoObservable=null),this._depthReducer&&(this._depthReducer.dispose(),this._depthReducer=null)},t.prototype.serialize=function(){var e=i.prototype.serialize.call(this),n=this.getShadowMap();if(!n)return e;if(e.numCascades=this._numCascades,e.debug=this._debug,e.stabilizeCascades=this.stabilizeCascades,e.lambda=this._lambda,e.cascadeBlendPercentage=this.cascadeBlendPercentage,e.depthClamp=this._depthClamp,e.autoCalcDepthBounds=this.autoCalcDepthBounds,e.shadowMaxZ=this._shadowMaxZ,e.penumbraDarkness=this.penumbraDarkness,e.freezeShadowCastersBoundingInfo=this._freezeShadowCastersBoundingInfo,e.minDistance=this.minDistance,e.maxDistance=this.maxDistance,e.renderList=[],n.renderList)for(var r=0;r<n.renderList.length;r++){var o=n.renderList[r];e.renderList.push(o.id)}return e},t.Parse=function(e,n){var r=Hr.Parse(e,n,function(o,u){return new t(o,u)});return e.numCascades!==void 0&&(r.numCascades=e.numCascades),e.debug!==void 0&&(r.debug=e.debug),e.stabilizeCascades!==void 0&&(r.stabilizeCascades=e.stabilizeCascades),e.lambda!==void 0&&(r.lambda=e.lambda),e.cascadeBlendPercentage!==void 0&&(r.cascadeBlendPercentage=e.cascadeBlendPercentage),e.depthClamp!==void 0&&(r.depthClamp=e.depthClamp),e.autoCalcDepthBounds!==void 0&&(r.autoCalcDepthBounds=e.autoCalcDepthBounds),e.shadowMaxZ!==void 0&&(r.shadowMaxZ=e.shadowMaxZ),e.penumbraDarkness!==void 0&&(r.penumbraDarkness=e.penumbraDarkness),e.freezeShadowCastersBoundingInfo!==void 0&&(r.freezeShadowCastersBoundingInfo=e.freezeShadowCastersBoundingInfo),e.minDistance!==void 0&&e.maxDistance!==void 0&&r.setMinMaxDistance(e.minDistance,e.maxDistance),r},t.frustumCornersNDCSpace=[new d.e(-1,1,-1),new d.e(1,1,-1),new d.e(1,-1,-1),new d.e(-1,-1,-1),new d.e(-1,1,1),new d.e(1,1,1),new d.e(1,-1,1),new d.e(-1,-1,1)],t.CLASSNAME="CascadedShadowGenerator",t.DEFAULT_CASCADES_COUNT=4,t.MIN_CASCADES_COUNT=2,t.MAX_CASCADES_COUNT=4,t._SceneComponentInitialization=function(e){throw dr.a.WarnImport("ShadowGeneratorSceneComponent")},t}(Hr);E.a.AddParser(dt.a.NAME_SHADOWGENERATOR,function(i,t){if(i.shadowGenerators!==void 0&&i.shadowGenerators!==null)for(var e=0,n=i.shadowGenerators.length;e<n;e++){var r=i.shadowGenerators[e];r.className===cm.CLASSNAME?cm.Parse(r,t):Hr.Parse(r,t)}});var C0=function(){function i(t){this.name=dt.a.NAME_SHADOWGENERATOR,this.scene=t}return i.prototype.register=function(){this.scene._gatherRenderTargetsStage.registerStep(dt.a.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR,this,this._gatherRenderTargets)},i.prototype.rebuild=function(){},i.prototype.serialize=function(t){t.shadowGenerators=[];for(var e=0,n=this.scene.lights;e<n.length;e++){var r=n[e].getShadowGenerator();r&&t.shadowGenerators.push(r.serialize())}},i.prototype.addFromContainer=function(t){},i.prototype.removeFromContainer=function(t,e){},i.prototype.dispose=function(){},i.prototype._gatherRenderTargets=function(t){var e=this.scene;if(this.scene.shadowsEnabled)for(var n=0;n<e.lights.length;n++){var r=e.lights[n],o=r.getShadowGenerator();if(r.isEnabled()&&r.shadowEnabled&&o){var u=o.getShadowMap();e.textures.indexOf(u)!==-1&&t.push(u)}}},i}();Hr._SceneComponentInitialization=function(i){var t=i._getComponent(dt.a.NAME_SHADOWGENERATOR);t||(t=new C0(i),i._addComponent(t))},$.a.AddNodeConstructor("Light_Type_0",function(i,t){return function(){return new lm(i,d.e.Zero(),t)}});var lm=function(i){function t(e,n,r){var o=i.call(this,e,r)||this;return o._shadowAngle=Math.PI/2,o.position=n,o}return Object(p.d)(t,i),Object.defineProperty(t.prototype,"shadowAngle",{get:function(){return this._shadowAngle},set:function(e){this._shadowAngle=e,this.forceProjectionMatrixCompute()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"direction",{get:function(){return this._direction},set:function(e){var n=this.needCube();this._direction=e,this.needCube()!==n&&this._shadowGenerator&&this._shadowGenerator.recreateShadowMap()},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"PointLight"},t.prototype.getTypeID=function(){return uo.a.LIGHTTYPEID_POINTLIGHT},t.prototype.needCube=function(){return!this.direction},t.prototype.getShadowDirection=function(e){if(this.direction)return i.prototype.getShadowDirection.call(this,e);switch(e){case 0:return new d.e(1,0,0);case 1:return new d.e(-1,0,0);case 2:return new d.e(0,-1,0);case 3:return new d.e(0,1,0);case 4:return new d.e(0,0,1);case 5:return new d.e(0,0,-1)}return d.e.Zero()},t.prototype._setDefaultShadowProjectionMatrix=function(e,n,r){var o=this.getScene().activeCamera;o&&d.a.PerspectiveFovLHToRef(this.shadowAngle,1,this.getDepthMinZ(o),this.getDepthMaxZ(o),e)},t.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},t.prototype.transferToEffect=function(e,n){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,n):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,n),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,n),this},t.prototype.transferToNodeMaterialEffect=function(e,n){return this.computeTransformedInformation()?e.setFloat3(n,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):e.setFloat3(n,this.position.x,this.position.y,this.position.z),this},t.prototype.prepareLightSpecificDefines=function(e,n){e["POINTLIGHT"+n]=!0},Object(p.c)([Object(B.c)()],t.prototype,"shadowAngle",null),t}(hh),R0=function(){function i(t,e,n){var r=this;e===void 0&&(e=""),n===void 0&&(n="black"),this._renderingCanvas=t,this._loadingText=e,this._loadingDivBackgroundColor=n,this._resizeLoadingUI=function(){var o=r._renderingCanvas.getBoundingClientRect(),u=window.getComputedStyle(r._renderingCanvas).position;r._loadingDiv&&(r._loadingDiv.style.position=u==="fixed"?"fixed":"absolute",r._loadingDiv.style.left=o.left+"px",r._loadingDiv.style.top=o.top+"px",r._loadingDiv.style.width=o.width+"px",r._loadingDiv.style.height=o.height+"px")}}return i.prototype.displayLoadingUI=function(){if(!this._loadingDiv){this._loadingDiv=document.createElement("div"),this._loadingDiv.id="babylonjsLoadingDiv",this._loadingDiv.style.opacity="0",this._loadingDiv.style.transition="opacity 1.5s ease",this._loadingDiv.style.pointerEvents="none",this._loadingDiv.style.display="grid",this._loadingDiv.style.gridTemplateRows="100%",this._loadingDiv.style.gridTemplateColumns="100%",this._loadingDiv.style.justifyItems="center",this._loadingDiv.style.alignItems="center",this._loadingTextDiv=document.createElement("div"),this._loadingTextDiv.style.position="absolute",this._loadingTextDiv.style.left="0",this._loadingTextDiv.style.top="50%",this._loadingTextDiv.style.marginTop="80px",this._loadingTextDiv.style.width="100%",this._loadingTextDiv.style.height="20px",this._loadingTextDiv.style.fontFamily="Arial",this._loadingTextDiv.style.fontSize="14px",this._loadingTextDiv.style.color="white",this._loadingTextDiv.style.textAlign="center",this._loadingTextDiv.style.zIndex="1",this._loadingTextDiv.innerHTML="Loading",this._loadingDiv.appendChild(this._loadingTextDiv),this._loadingTextDiv.innerHTML=this._loadingText;var t=document.createElement("style");t.type="text/css",t.innerHTML=`@-webkit-keyframes spin1 {                    0% { -webkit-transform: rotate(0deg);}
                    100% { -webkit-transform: rotate(360deg);}
                }                @keyframes spin1 {                    0% { transform: rotate(0deg);}
                    100% { transform: rotate(360deg);}
                }`,document.getElementsByTagName("head")[0].appendChild(t);var e=!!window.SVGSVGElement,n=new Image;i.DefaultLogoUrl?n.src=i.DefaultLogoUrl:n.src=e?"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxODAuMTcgMjA4LjA0Ij48ZGVmcz48c3R5bGU+LmNscy0xe2ZpbGw6I2ZmZjt9LmNscy0ye2ZpbGw6I2UwNjg0Yjt9LmNscy0ze2ZpbGw6I2JiNDY0Yjt9LmNscy00e2ZpbGw6I2UwZGVkODt9LmNscy01e2ZpbGw6I2Q1ZDJjYTt9PC9zdHlsZT48L2RlZnM+PHRpdGxlPkJhYnlsb25Mb2dvPC90aXRsZT48ZyBpZD0iTGF5ZXJfMiIgZGF0YS1uYW1lPSJMYXllciAyIj48ZyBpZD0iUGFnZV9FbGVtZW50cyIgZGF0YS1uYW1lPSJQYWdlIEVsZW1lbnRzIj48cGF0aCBjbGFzcz0iY2xzLTEiIGQ9Ik05MC4wOSwwLDAsNTJWMTU2bDkwLjA5LDUyLDkwLjA4LTUyVjUyWiIvPjxwb2x5Z29uIGNsYXNzPSJjbHMtMiIgcG9pbnRzPSIxODAuMTcgNTIuMDEgMTUxLjk3IDM1LjczIDEyNC44NSA1MS4zOSAxNTMuMDUgNjcuNjcgMTgwLjE3IDUyLjAxIi8+PHBvbHlnb24gY2xhc3M9ImNscy0yIiBwb2ludHM9IjI3LjEyIDY3LjY3IDExNy4yMSAxNS42NiA5MC4wOCAwIDAgNTIuMDEgMjcuMTIgNjcuNjciLz48cG9seWdvbiBjbGFzcz0iY2xzLTIiIHBvaW50cz0iNjEuODkgMTIwLjMgOTAuMDggMTM2LjU4IDExOC4yOCAxMjAuMyA5MC4wOCAxMDQuMDIgNjEuODkgMTIwLjMiLz48cG9seWdvbiBjbGFzcz0iY2xzLTMiIHBvaW50cz0iMTUzLjA1IDY3LjY3IDE1My4wNSAxNDAuMzcgOTAuMDggMTc2LjcyIDI3LjEyIDE0MC4zNyAyNy4xMiA2Ny42NyAwIDUyLjAxIDAgMTU2LjAzIDkwLjA4IDIwOC4wNCAxODAuMTcgMTU2LjAzIDE4MC4xNyA1Mi4wMSAxNTMuMDUgNjcuNjciLz48cG9seWdvbiBjbGFzcz0iY2xzLTMiIHBvaW50cz0iOTAuMDggNzEuNDYgNjEuODkgODcuNzQgNjEuODkgMTIwLjMgOTAuMDggMTA0LjAyIDExOC4yOCAxMjAuMyAxMTguMjggODcuNzQgOTAuMDggNzEuNDYiLz48cG9seWdvbiBjbGFzcz0iY2xzLTQiIHBvaW50cz0iMTUzLjA1IDY3LjY3IDExOC4yOCA4Ny43NCAxMTguMjggMTIwLjMgOTAuMDggMTM2LjU4IDkwLjA4IDE3Ni43MiAxNTMuMDUgMTQwLjM3IDE1My4wNSA2Ny42NyIvPjxwb2x5Z29uIGNsYXNzPSJjbHMtNSIgcG9pbnRzPSIyNy4xMiA2Ny42NyA2MS44OSA4Ny43NCA2MS44OSAxMjAuMyA5MC4wOCAxMzYuNTggOTAuMDggMTc2LjcyIDI3LjEyIDE0MC4zNyAyNy4xMiA2Ny42NyIvPjwvZz48L2c+PC9zdmc+":"https://cdn.babylonjs.com/Assets/babylonLogo.png",n.style.width="150px",n.style.gridColumn="1",n.style.gridRow="1",n.style.top="50%",n.style.left="50%",n.style.transform="translate(-50%, -50%)",n.style.position="absolute";var r=document.createElement("div");r.style.width="300px",r.style.gridColumn="1",r.style.gridRow="1",r.style.top="50%",r.style.left="50%",r.style.transform="translate(-50%, -50%)",r.style.position="absolute";var o=new Image;if(i.DefaultSpinnerUrl?o.src=i.DefaultSpinnerUrl:o.src=e?"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzOTIgMzkyIj48ZGVmcz48c3R5bGU+LmNscy0xe2ZpbGw6I2UwNjg0Yjt9LmNscy0ye2ZpbGw6bm9uZTt9PC9zdHlsZT48L2RlZnM+PHRpdGxlPlNwaW5uZXJJY29uPC90aXRsZT48ZyBpZD0iTGF5ZXJfMiIgZGF0YS1uYW1lPSJMYXllciAyIj48ZyBpZD0iU3Bpbm5lciI+PHBhdGggY2xhc3M9ImNscy0xIiBkPSJNNDAuMjEsMTI2LjQzYzMuNy03LjMxLDcuNjctMTQuNDQsMTItMjEuMzJsMy4zNi01LjEsMy41Mi01YzEuMjMtMS42MywyLjQxLTMuMjksMy42NS00LjkxczIuNTMtMy4yMSwzLjgyLTQuNzlBMTg1LjIsMTg1LjIsMCwwLDEsODMuNCw2Ny40M2EyMDgsMjA4LDAsMCwxLDE5LTE1LjY2YzMuMzUtMi40MSw2Ljc0LTQuNzgsMTAuMjUtN3M3LjExLTQuMjgsMTAuNzUtNi4zMmM3LjI5LTQsMTQuNzMtOCwyMi41My0xMS40OSwzLjktMS43Miw3Ljg4LTMuMywxMi00LjY0YTEwNC4yMiwxMDQuMjIsMCwwLDEsMTIuNDQtMy4yMyw2Mi40NCw2Mi40NCwwLDAsMSwxMi43OC0xLjM5QTI1LjkyLDI1LjkyLDAsMCwxLDE5NiwyMS40NGE2LjU1LDYuNTUsMCwwLDEsMi4wNSw5LDYuNjYsNi42NiwwLDAsMS0xLjY0LDEuNzhsLS40MS4yOWEyMi4wNywyMi4wNywwLDAsMS01Ljc4LDMsMzAuNDIsMzAuNDIsMCwwLDEtNS42NywxLjYyLDM3LjgyLDM3LjgyLDAsMCwxLTUuNjkuNzFjLTEsMC0xLjkuMTgtMi44NS4yNmwtMi44NS4yNHEtNS43Mi41MS0xMS40OCwxLjFjLTMuODQuNC03LjcxLjgyLTExLjU4LDEuNGExMTIuMzQsMTEyLjM0LDAsMCwwLTIyLjk0LDUuNjFjLTMuNzIsMS4zNS03LjM0LDMtMTAuOTQsNC42NHMtNy4xNCwzLjUxLTEwLjYsNS41MUExNTEuNiwxNTEuNiwwLDAsMCw2OC41Niw4N0M2Ny4yMyw4OC40OCw2Niw5MCw2NC42NCw5MS41NnMtMi41MSwzLjE1LTMuNzUsNC43M2wtMy41NCw0LjljLTEuMTMsMS42Ni0yLjIzLDMuMzUtMy4zMyw1YTEyNywxMjcsMCwwLDAtMTAuOTMsMjEuNDksMS41OCwxLjU4LDAsMSwxLTMtMS4xNVM0MC4xOSwxMjYuNDcsNDAuMjEsMTI2LjQzWiIvPjxyZWN0IGNsYXNzPSJjbHMtMiIgd2lkdGg9IjM5MiIgaGVpZ2h0PSIzOTIiLz48L2c+PC9nPjwvc3ZnPg==":"https://cdn.babylonjs.com/Assets/loadingIcon.png",o.style.animation="spin1 0.75s infinite linear",o.style.webkitAnimation="spin1 0.75s infinite linear",o.style.transformOrigin="50% 50%",o.style.webkitTransformOrigin="50% 50%",!e){var u={w:16,h:18.5},f={w:30,h:30};n.style.width=u.w+"vh",n.style.height=u.h+"vh",n.style.left="calc(50% - "+u.w/2+"vh)",n.style.top="calc(50% - "+u.h/2+"vh)",o.style.width=f.w+"vh",o.style.height=f.h+"vh",o.style.left="calc(50% - "+f.w/2+"vh)",o.style.top="calc(50% - "+f.h/2+"vh)"}r.appendChild(o),this._loadingDiv.appendChild(n),this._loadingDiv.appendChild(r),this._resizeLoadingUI(),window.addEventListener("resize",this._resizeLoadingUI),this._loadingDiv.style.backgroundColor=this._loadingDivBackgroundColor,document.body.appendChild(this._loadingDiv),this._loadingDiv.style.opacity="1"}},i.prototype.hideLoadingUI=function(){var t=this;this._loadingDiv&&(this._loadingDiv.style.opacity="0",this._loadingDiv.addEventListener("transitionend",function(){t._loadingDiv&&(t._loadingDiv.parentElement&&t._loadingDiv.parentElement.removeChild(t._loadingDiv),window.removeEventListener("resize",t._resizeLoadingUI),t._loadingDiv=null)}))},Object.defineProperty(i.prototype,"loadingUIText",{get:function(){return this._loadingText},set:function(t){this._loadingText=t,this._loadingTextDiv&&(this._loadingTextDiv.innerHTML=this._loadingText)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"loadingUIBackgroundColor",{get:function(){return this._loadingDivBackgroundColor},set:function(t){this._loadingDivBackgroundColor=t,this._loadingDiv&&(this._loadingDiv.style.backgroundColor=this._loadingDivBackgroundColor)},enumerable:!1,configurable:!0}),i.DefaultLogoUrl="",i.DefaultSpinnerUrl="",i}();Ge.a.DefaultLoadingScreenFactory=function(i){return new R0(i)};var um=c(71),wa=c(68),hm=function(){function i(){}return i.ConvertPanoramaToCubemap=function(t,e,n,r){if(!t)throw"ConvertPanoramaToCubemap: input cannot be null";if(t.length!=e*n*3)throw"ConvertPanoramaToCubemap: input size is wrong";return{front:this.CreateCubemapTexture(r,this.FACE_FRONT,t,e,n),back:this.CreateCubemapTexture(r,this.FACE_BACK,t,e,n),left:this.CreateCubemapTexture(r,this.FACE_LEFT,t,e,n),right:this.CreateCubemapTexture(r,this.FACE_RIGHT,t,e,n),up:this.CreateCubemapTexture(r,this.FACE_UP,t,e,n),down:this.CreateCubemapTexture(r,this.FACE_DOWN,t,e,n),size:r,type:g.a.TEXTURETYPE_FLOAT,format:g.a.TEXTUREFORMAT_RGB,gammaSpace:!1}},i.CreateCubemapTexture=function(t,e,n,r,o){for(var u=new ArrayBuffer(t*t*4*3),f=new Float32Array(u),v=e[1].subtract(e[0]).scale(1/t),y=e[3].subtract(e[2]).scale(1/t),D=1/t,w=0,F=0;F<t;F++){for(var z=e[0],k=e[2],K=0;K<t;K++){var oe=k.subtract(z).scale(w).add(z);oe.normalize();var ae=this.CalcProjectionSpherical(oe,n,r,o);f[F*t*3+3*K+0]=ae.r,f[F*t*3+3*K+1]=ae.g,f[F*t*3+3*K+2]=ae.b,z=z.add(v),k=k.add(y)}w+=D}return f},i.CalcProjectionSpherical=function(t,e,n,r){for(var o=Math.atan2(t.z,t.x),u=Math.acos(t.y);o<-Math.PI;)o+=2*Math.PI;for(;o>Math.PI;)o-=2*Math.PI;var f=o/Math.PI,v=u/Math.PI;f=.5*f+.5;var y=Math.round(f*n);y<0?y=0:y>=n&&(y=n-1);var D=Math.round(v*r);D<0?D=0:D>=r&&(D=r-1);var w=r-D-1;return{r:e[w*n*3+3*y+0],g:e[w*n*3+3*y+1],b:e[w*n*3+3*y+2]}},i.FACE_LEFT=[new d.e(-1,-1,-1),new d.e(1,-1,-1),new d.e(-1,1,-1),new d.e(1,1,-1)],i.FACE_RIGHT=[new d.e(1,-1,1),new d.e(-1,-1,1),new d.e(1,1,1),new d.e(-1,1,1)],i.FACE_FRONT=[new d.e(1,-1,-1),new d.e(1,-1,1),new d.e(1,1,-1),new d.e(1,1,1)],i.FACE_BACK=[new d.e(-1,-1,1),new d.e(-1,-1,-1),new d.e(-1,1,1),new d.e(-1,1,-1)],i.FACE_DOWN=[new d.e(1,1,-1),new d.e(1,1,1),new d.e(-1,1,-1),new d.e(-1,1,1)],i.FACE_UP=[new d.e(-1,-1,-1),new d.e(-1,-1,1),new d.e(1,-1,-1),new d.e(1,-1,1)],i}(),O0=function(){function i(){}return i.Ldexp=function(t,e){return e>1023?t*Math.pow(2,1023)*Math.pow(2,e-1023):e<-1074?t*Math.pow(2,-1074)*Math.pow(2,e+1074):t*Math.pow(2,e)},i.Rgbe2float=function(t,e,n,r,o,u){o>0?(o=this.Ldexp(1,o-136),t[u+0]=e*o,t[u+1]=n*o,t[u+2]=r*o):(t[u+0]=0,t[u+1]=0,t[u+2]=0)},i.readStringLine=function(t,e){for(var n="",r="",o=e;o<t.length-e&&(r=String.fromCharCode(t[o]))!=`
`;o++)n+=r;return n},i.RGBE_ReadHeader=function(t){var e,n,r=this.readStringLine(t,0);if(r[0]!="#"||r[1]!="?")throw"Bad HDR Format.";var o=!1,u=!1,f=0;do f+=r.length+1,(r=this.readStringLine(t,f))=="FORMAT=32-bit_rle_rgbe"?u=!0:r.length==0&&(o=!0);while(!o);if(!u)throw"HDR Bad header format, unsupported FORMAT";f+=r.length+1,r=this.readStringLine(t,f);var v=/^\-Y (.*) \+X (.*)$/g.exec(r);if(!v||v.length<3)throw"HDR Bad header format, no size";if(n=parseInt(v[2]),e=parseInt(v[1]),n<8||n>32767)throw"HDR Bad header format, unsupported size";return{height:e,width:n,dataPosition:f+=r.length+1}},i.GetCubeMapTextureData=function(t,e){var n=new Uint8Array(t),r=this.RGBE_ReadHeader(n),o=this.RGBE_ReadPixels(n,r);return hm.ConvertPanoramaToCubemap(o,r.width,r.height,e)},i.RGBE_ReadPixels=function(t,e){return this.RGBE_ReadPixels_RLE(t,e)},i.RGBE_ReadPixels_RLE=function(t,e){for(var n,r,o,u,f,v=e.height,y=e.width,D=e.dataPosition,w=0,F=0,z=0,k=new ArrayBuffer(4*y),K=new Uint8Array(k),oe=new ArrayBuffer(e.width*e.height*4*3),ae=new Float32Array(oe);v>0;){if(n=t[D++],r=t[D++],o=t[D++],u=t[D++],n!=2||r!=2||128&o||e.width<8||e.width>32767)return this.RGBE_ReadPixels_NOT_RLE(t,e);if((o<<8|u)!=y)throw"HDR Bad header format, wrong scan line width";for(w=0,z=0;z<4;z++)for(F=(z+1)*y;w<F;)if(n=t[D++],r=t[D++],n>128){if((f=n-128)==0||f>F-w)throw"HDR Bad Format, bad scanline data (run)";for(;f-- >0;)K[w++]=r}else{if((f=n)==0||f>F-w)throw"HDR Bad Format, bad scanline data (non-run)";if(K[w++]=r,--f>0)for(var ue=0;ue<f;ue++)K[w++]=t[D++]}for(z=0;z<y;z++)n=K[z],r=K[z+y],o=K[z+2*y],u=K[z+3*y],this.Rgbe2float(ae,n,r,o,u,(e.height-v)*y*3+3*z);v--}return ae},i.RGBE_ReadPixels_NOT_RLE=function(t,e){for(var n,r,o,u,f,v=e.height,y=e.width,D=e.dataPosition,w=new ArrayBuffer(e.width*e.height*4*3),F=new Float32Array(w);v>0;){for(f=0;f<e.width;f++)n=t[D++],r=t[D++],o=t[D++],u=t[D++],this.Rgbe2float(F,n,r,o,u,(e.height-v)*y*3+3*f);v--}return F},i}(),M0=function(){function i(t,e){var n;e===void 0&&(e=i._DefaultOptions),this.engine=t,this._fullscreenViewport=new li.a(0,0,1,1),e=Object(p.a)(Object(p.a)({},i._DefaultOptions),e),this._vertexBuffers=((n={})[De.b.PositionKind]=new De.b(t,e.positions,De.b.PositionKind,!1,!1,2),n),this._indexBuffer=t.createIndexBuffer(e.indices)}return i.prototype.setViewport=function(t){t===void 0&&(t=this._fullscreenViewport),this.engine.setViewport(t)},i.prototype.bindBuffers=function(t){this.engine.bindBuffers(this._vertexBuffers,this._indexBuffer,t)},i.prototype.applyEffectWrapper=function(t){this.engine.depthCullingState.depthTest=!1,this.engine.stencilState.stencilTest=!1,this.engine.enableEffect(t.effect),this.bindBuffers(t.effect),t.onApplyObservable.notifyObservers({})},i.prototype.restoreStates=function(){this.engine.depthCullingState.depthTest=!0,this.engine.stencilState.stencilTest=!0},i.prototype.draw=function(){this.engine.drawElementsType(g.a.MATERIAL_TriangleFillMode,0,6)},i.prototype.isRenderTargetTexture=function(t){return t.renderList!==void 0},i.prototype.render=function(t,e){if(e===void 0&&(e=null),t.effect.isReady()){this.setViewport();var n=e===null?null:this.isRenderTargetTexture(e)?e.getInternalTexture():e;n&&this.engine.bindFramebuffer(n),this.applyEffectWrapper(t),this.draw(),n&&this.engine.unBindFramebuffer(n),this.restoreStates()}},i.prototype.dispose=function(){var t=this._vertexBuffers[De.b.PositionKind];t&&(t.dispose(),delete this._vertexBuffers[De.b.PositionKind]),this._indexBuffer&&this.engine._releaseBuffer(this._indexBuffer)},i._DefaultOptions={positions:[1,1,-1,1,-1,-1,1,-1],indices:[0,1,2,0,2,3]},i}(),I0=function(){function i(t){var e,n=this;this.onApplyObservable=new S.c;var r=t.uniformNames||[];t.vertexShader?e={fragmentSource:t.fragmentShader,vertexSource:t.vertexShader,spectorName:t.name||"effectWrapper"}:(r.push("scale"),e={fragmentSource:t.fragmentShader,vertex:"postprocess",spectorName:t.name||"effectWrapper"},this.onApplyObservable.add(function(){n.effect.setFloat2("scale",1,1)}));var o=t.defines?t.defines.join(`
`):"";t.useShaderStore?(e.fragment=e.fragmentSource,e.vertex||(e.vertex=e.vertexSource),delete e.fragmentSource,delete e.vertexSource,this.effect=t.engine.createEffect(e.spectorName,t.attributeNames||["position"],r,t.samplerNames,o,void 0,t.onCompiled)):this.effect=new Ye.a(e,t.attributeNames||["position"],r,t.samplerNames,t.engine,o,void 0,t.onCompiled)}return i.prototype.dispose=function(){this.effect.dispose()},i}(),_w=`
attribute vec2 position;

varying vec3 direction;

uniform vec3 up;
uniform vec3 right;
uniform vec3 front;
void main(void) {
mat3 view=mat3(up,right,front);
direction=view*vec3(position,1.0);
gl_Position=vec4(position,0.0,1.0);
}`;Ye.a.ShadersStore.hdrFilteringVertexShader=_w;var gw=`#include<helperFunctions>
#include<importanceSampling>
#include<pbrBRDFFunctions>
#include<hdrFilteringFunctions>
uniform float alphaG;
uniform samplerCube inputTexture;
uniform vec2 vFilteringInfo;
uniform float hdrScale;
varying vec3 direction;
void main() {
vec3 color=radiance(alphaG,inputTexture,direction,vFilteringInfo);
gl_FragColor=vec4(color*hdrScale,1.0);
}`;Ye.a.ShadersStore.hdrFilteringPixelShader=gw;var D0=function(){function i(t,e){e===void 0&&(e={}),this._lodGenerationOffset=0,this._lodGenerationScale=.8,this.quality=g.a.TEXTURE_FILTERING_QUALITY_OFFLINE,this.hdrScale=1,this._engine=t,this.hdrScale=e.hdrScale||this.hdrScale,this.quality=e.hdrScale||this.quality}return i.prototype._createRenderTarget=function(t){var e=g.a.TEXTURETYPE_UNSIGNED_BYTE;this._engine.getCaps().textureHalfFloatRender?e=g.a.TEXTURETYPE_HALF_FLOAT:this._engine.getCaps().textureFloatRender&&(e=g.a.TEXTURETYPE_FLOAT);var n=this._engine.createRenderTargetCubeTexture(t,{format:g.a.TEXTUREFORMAT_RGBA,type:e,generateMipMaps:!1,generateDepthBuffer:!1,generateStencilBuffer:!1,samplingMode:g.a.TEXTURE_NEAREST_SAMPLINGMODE});return this._engine.updateTextureWrappingMode(n,g.a.TEXTURE_CLAMP_ADDRESSMODE,g.a.TEXTURE_CLAMP_ADDRESSMODE,g.a.TEXTURE_CLAMP_ADDRESSMODE),this._engine.updateTextureSamplingMode(g.a.TEXTURE_TRILINEAR_SAMPLINGMODE,n,!0),n},i.prototype._prefilterInternal=function(t){var e=t.getSize().width,n=Math.round(te.a.Log2(e))+1,r=this._effectWrapper.effect,o=this._createRenderTarget(e);this._effectRenderer.setViewport();var u=t.getInternalTexture();u&&this._engine.updateTextureSamplingMode(g.a.TEXTURE_TRILINEAR_SAMPLINGMODE,u,!0),this._effectRenderer.applyEffectWrapper(this._effectWrapper);var f=[[new d.e(0,0,-1),new d.e(0,-1,0),new d.e(1,0,0)],[new d.e(0,0,1),new d.e(0,-1,0),new d.e(-1,0,0)],[new d.e(1,0,0),new d.e(0,0,1),new d.e(0,1,0)],[new d.e(1,0,0),new d.e(0,0,-1),new d.e(0,-1,0)],[new d.e(1,0,0),new d.e(0,-1,0),new d.e(0,0,1)],[new d.e(-1,0,0),new d.e(0,-1,0),new d.e(0,0,-1)]];r.setFloat("hdrScale",this.hdrScale),r.setFloat2("vFilteringInfo",t.getSize().width,n),r.setTexture("inputTexture",t);for(var v=0;v<6;v++){r.setVector3("up",f[v][0]),r.setVector3("right",f[v][1]),r.setVector3("front",f[v][2]);for(var y=0;y<n;y++){this._engine.bindFramebuffer(o,v,void 0,void 0,!0,y),this._effectRenderer.applyEffectWrapper(this._effectWrapper);var D=Math.pow(2,(y-this._lodGenerationOffset)/this._lodGenerationScale)/e;y===0&&(D=0),r.setFloat("alphaG",D),this._effectRenderer.draw()}}return this._effectRenderer.restoreStates(),this._engine.restoreDefaultFramebuffer(),this._engine._releaseFramebufferObjects(o),this._engine._releaseTexture(t._texture),o._swapAndDie(t._texture),t._prefiltered=!0,t},i.prototype._createEffect=function(t,e){var n=[];return t.gammaSpace&&n.push("#define GAMMA_INPUT"),n.push("#define NUM_SAMPLES "+this.quality+"u"),new I0({engine:this._engine,name:"hdrFiltering",vertexShader:"hdrFiltering",fragmentShader:"hdrFiltering",samplerNames:["inputTexture"],uniformNames:["vSampleDirections","vWeights","up","right","front","vFilteringInfo","hdrScale","alphaG"],useShaderStore:!0,defines:n,onCompiled:e})},i.prototype.isReady=function(t){return t.isReady()&&this._effectWrapper.effect.isReady()},i.prototype.prefilter=function(t,e){var n=this;if(e===void 0&&(e=null),this._engine.webGLVersion!==1)return new Promise(function(r){n._effectRenderer=new M0(n._engine),n._effectWrapper=n._createEffect(t),n._effectWrapper.effect.executeWhenCompiled(function(){n._prefilterInternal(t),n._effectRenderer.dispose(),n._effectWrapper.dispose(),r(),e&&e()})});_.a.Warn("HDR prefiltering is not available in WebGL 1., you can use real time filtering instead.")},i}(),Th=function(i){function t(e,n,r,o,u,f,v,y,D){var w;o===void 0&&(o=!1),u===void 0&&(u=!0),f===void 0&&(f=!1),v===void 0&&(v=!1),y===void 0&&(y=null),D===void 0&&(D=null);var F=i.call(this,n)||this;return F._generateHarmonics=!0,F._onLoad=null,F._onError=null,F._isBlocking=!0,F._rotationY=0,F.boundingBoxPosition=d.e.Zero(),e&&(F._coordinatesMode=ke.a.CUBIC_MODE,F.name=e,F.url=e,F.hasAlpha=!1,F.isCube=!0,F._textureMatrix=d.a.Identity(),F._prefilterOnLoad=v,F._onLoad=y,F._onError=D,F.gammaSpace=f,F._noMipmap=o,F._size=r,F._generateHarmonics=u,F._texture=F._getFromCache(e,F._noMipmap),F._texture?y&&(F._texture.isReady?et.b.SetImmediate(function(){return y()}):F._texture.onLoadedObservable.add(y)):((w=F.getScene())===null||w===void 0?void 0:w.useDelayedTextureLoading)?F.delayLoadState=g.a.DELAYLOADSTATE_NOTLOADED:F.loadTexture()),F}return Object(p.d)(t,i),Object.defineProperty(t.prototype,"isBlocking",{get:function(){return this._isBlocking},set:function(e){this._isBlocking=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rotationY",{get:function(){return this._rotationY},set:function(e){this._rotationY=e,this.setReflectionTextureMatrix(d.a.RotationY(this._rotationY))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"boundingBoxSize",{get:function(){return this._boundingBoxSize},set:function(e){if(!this._boundingBoxSize||!this._boundingBoxSize.equals(e)){this._boundingBoxSize=e;var n=this.getScene();n&&n.markAllMaterialsAsDirty(g.a.MATERIAL_TextureDirtyFlag)}},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"HDRCubeTexture"},t.prototype.loadTexture=function(){var e=this,n=this._getEngine();if(this._getEngine().webGLVersion>=2&&this._prefilterOnLoad){var r=this._onLoad,o=new D0(n);this._onLoad=function(){o.prefilter(e,r)}}this._texture=n.createRawCubeTextureFromUrl(this.url,this.getScene(),this._size,g.a.TEXTUREFORMAT_RGB,n.getCaps().textureFloat?g.a.TEXTURETYPE_FLOAT:g.a.TEXTURETYPE_UNSIGNED_INT,this._noMipmap,function(u){e.lodGenerationOffset=0,e.lodGenerationScale=.8;var f=O0.GetCubeMapTextureData(u,e._size);if(e._generateHarmonics){var v=ih.ConvertCubeMapToSphericalPolynomial(f);e.sphericalPolynomial=v}for(var y=[],D=null,w=0;w<6;w++){if(!n.getCaps().textureFloat){var F=new ArrayBuffer(e._size*e._size*3);D=new Uint8Array(F)}var z=f[t._facesMapping[w]];if(e.gammaSpace||D){for(var k=0;k<e._size*e._size;k++)if(e.gammaSpace&&(z[3*k+0]=Math.pow(z[3*k+0],Zt.b),z[3*k+1]=Math.pow(z[3*k+1],Zt.b),z[3*k+2]=Math.pow(z[3*k+2],Zt.b)),D){var K=Math.max(255*z[3*k+0],0),oe=Math.max(255*z[3*k+1],0),ae=Math.max(255*z[3*k+2],0),ue=Math.max(Math.max(K,oe),ae);if(ue>255){var de=255/ue;K*=de,oe*=de,ae*=de}D[3*k+0]=K,D[3*k+1]=oe,D[3*k+2]=ae}}D?y.push(D):y.push(z)}return y},null,this._onLoad,this._onError)},t.prototype.clone=function(){var e=new t(this.url,this.getScene()||this._getEngine(),this._size,this._noMipmap,this._generateHarmonics,this.gammaSpace);return e.level=this.level,e.wrapU=this.wrapU,e.wrapV=this.wrapV,e.coordinatesIndex=this.coordinatesIndex,e.coordinatesMode=this.coordinatesMode,e},t.prototype.delayLoad=function(){this.delayLoadState===g.a.DELAYLOADSTATE_NOTLOADED&&(this.delayLoadState=g.a.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,this._noMipmap),this._texture||this.loadTexture())},t.prototype.getReflectionTextureMatrix=function(){return this._textureMatrix},t.prototype.setReflectionTextureMatrix=function(e){var n,r=this;this._textureMatrix=e,e.updateFlag!==this._textureMatrix.updateFlag&&e.isIdentity()!==this._textureMatrix.isIdentity()&&((n=this.getScene())===null||n===void 0||n.markAllMaterialsAsDirty(g.a.MATERIAL_TextureDirtyFlag,function(o){return o.getActiveTextures().indexOf(r)!==-1}))},t.Parse=function(e,n,r){var o=null;return e.name&&!e.isRenderTarget&&((o=new t(r+e.name,n,e.size,e.noMipmap,e.generateHarmonics,e.useInGammaSpace)).name=e.name,o.hasAlpha=e.hasAlpha,o.level=e.level,o.coordinatesMode=e.coordinatesMode,o.isBlocking=e.isBlocking),o&&(e.boundingBoxPosition&&(o.boundingBoxPosition=d.e.FromArray(e.boundingBoxPosition)),e.boundingBoxSize&&(o.boundingBoxSize=d.e.FromArray(e.boundingBoxSize)),e.rotationY&&(o.rotationY=e.rotationY)),o},t.prototype.serialize=function(){if(!this.name)return null;var e={};return e.name=this.name,e.hasAlpha=this.hasAlpha,e.isCube=!0,e.level=this.level,e.size=this._size,e.coordinatesMode=this.coordinatesMode,e.useInGammaSpace=this.gammaSpace,e.generateHarmonics=this._generateHarmonics,e.customType="BABYLON.HDRCubeTexture",e.noMipmap=this._noMipmap,e.isBlocking=this._isBlocking,e.rotationY=this._rotationY,e},t._facesMapping=["right","left","up","down","front","back"],t}($r.a);C.a.RegisteredTypes["BABYLON.HDRCubeTexture"]=Th;var w0=function(){function i(t,e,n){e===void 0&&(e=0),n===void 0&&(n=null),this.name=t,this.animations=new Array,this._positions=null,this._normals=null,this._tangents=null,this._uvs=null,this._uniqueId=0,this.onInfluenceChanged=new S.c,this._onDataLayoutChanged=new S.c,this._animationPropertiesOverride=null,this._scene=n||ne.a.LastCreatedScene,this.influence=e,this._scene&&(this._uniqueId=this._scene.getUniqueId())}return Object.defineProperty(i.prototype,"influence",{get:function(){return this._influence},set:function(t){if(this._influence!==t){var e=this._influence;this._influence=t,this.onInfluenceChanged.hasObservers()&&this.onInfluenceChanged.notifyObservers(e===0||t===0)}},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"animationPropertiesOverride",{get:function(){return!this._animationPropertiesOverride&&this._scene?this._scene.animationPropertiesOverride:this._animationPropertiesOverride},set:function(t){this._animationPropertiesOverride=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"uniqueId",{get:function(){return this._uniqueId},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"hasPositions",{get:function(){return!!this._positions},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"hasNormals",{get:function(){return!!this._normals},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"hasTangents",{get:function(){return!!this._tangents},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"hasUVs",{get:function(){return!!this._uvs},enumerable:!1,configurable:!0}),i.prototype.setPositions=function(t){var e=this.hasPositions;this._positions=t,e!==this.hasPositions&&this._onDataLayoutChanged.notifyObservers(void 0)},i.prototype.getPositions=function(){return this._positions},i.prototype.setNormals=function(t){var e=this.hasNormals;this._normals=t,e!==this.hasNormals&&this._onDataLayoutChanged.notifyObservers(void 0)},i.prototype.getNormals=function(){return this._normals},i.prototype.setTangents=function(t){var e=this.hasTangents;this._tangents=t,e!==this.hasTangents&&this._onDataLayoutChanged.notifyObservers(void 0)},i.prototype.getTangents=function(){return this._tangents},i.prototype.setUVs=function(t){var e=this.hasUVs;this._uvs=t,e!==this.hasUVs&&this._onDataLayoutChanged.notifyObservers(void 0)},i.prototype.getUVs=function(){return this._uvs},i.prototype.clone=function(){var t=this,e=B.a.Clone(function(){return new i(t.name,t.influence,t._scene)},this);return e._positions=this._positions,e._normals=this._normals,e._tangents=this._tangents,e._uvs=this._uvs,e},i.prototype.serialize=function(){var t={};return t.name=this.name,t.influence=this.influence,t.positions=Array.prototype.slice.call(this.getPositions()),this.id!=null&&(t.id=this.id),this.hasNormals&&(t.normals=Array.prototype.slice.call(this.getNormals())),this.hasTangents&&(t.tangents=Array.prototype.slice.call(this.getTangents())),this.hasUVs&&(t.uvs=Array.prototype.slice.call(this.getUVs())),B.a.AppendSerializedAnimations(this,t),t},i.prototype.getClassName=function(){return"MorphTarget"},i.Parse=function(t){var e=new i(t.name,t.influence);if(e.setPositions(t.positions),t.id!=null&&(e.id=t.id),t.normals&&e.setNormals(t.normals),t.tangents&&e.setTangents(t.tangents),t.uvs&&e.setUVs(t.uvs),t.animations)for(var n=0;n<t.animations.length;n++){var r=t.animations[n],o=C.a.GetClass("BABYLON.Animation");o&&e.animations.push(o.Parse(r))}return e},i.FromMesh=function(t,e,n){e||(e=t.name);var r=new i(e,n,t.getScene());return r.setPositions(t.getVerticesData(De.b.PositionKind)),t.isVerticesDataPresent(De.b.NormalKind)&&r.setNormals(t.getVerticesData(De.b.NormalKind)),t.isVerticesDataPresent(De.b.TangentKind)&&r.setTangents(t.getVerticesData(De.b.TangentKind)),t.isVerticesDataPresent(De.b.UVKind)&&r.setUVs(t.getVerticesData(De.b.UVKind)),r},Object(p.c)([Object(B.c)()],i.prototype,"id",void 0),i}(),Eh=function(){function i(t){t===void 0&&(t=null),this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new Hn.a(16),this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,t||(t=ne.a.LastCreatedScene),this._scene=t,this._scene&&(this._scene.morphTargetManagers.push(this),this._uniqueId=this._scene.getUniqueId())}return Object.defineProperty(i.prototype,"uniqueId",{get:function(){return this._uniqueId},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"vertexCount",{get:function(){return this._vertexCount},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"supportsNormals",{get:function(){return this._supportsNormals&&this.enableNormalMorphing},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"supportsTangents",{get:function(){return this._supportsTangents&&this.enableTangentMorphing},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"supportsUVs",{get:function(){return this._supportsUVs&&this.enableUVMorphing},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"numTargets",{get:function(){return this._targets.length},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"numInfluencers",{get:function(){return this._activeTargets.length},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"influences",{get:function(){return this._influences},enumerable:!1,configurable:!0}),i.prototype.getActiveTarget=function(t){return this._activeTargets.data[t]},i.prototype.getTarget=function(t){return this._targets[t]},i.prototype.addTarget=function(t){var e=this;this._targets.push(t),this._targetInfluenceChangedObservers.push(t.onInfluenceChanged.add(function(n){e._syncActiveTargets(n)})),this._targetDataLayoutChangedObservers.push(t._onDataLayoutChanged.add(function(){e._syncActiveTargets(!0)})),this._syncActiveTargets(!0)},i.prototype.removeTarget=function(t){var e=this._targets.indexOf(t);e>=0&&(this._targets.splice(e,1),t.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(e,1)[0]),t._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(e,1)[0]),this._syncActiveTargets(!0))},i.prototype.clone=function(){for(var t=new i(this._scene),e=0,n=this._targets;e<n.length;e++){var r=n[e];t.addTarget(r.clone())}return t.enableNormalMorphing=this.enableNormalMorphing,t.enableTangentMorphing=this.enableTangentMorphing,t.enableUVMorphing=this.enableUVMorphing,t},i.prototype.serialize=function(){var t={};t.id=this.uniqueId,t.targets=[];for(var e=0,n=this._targets;e<n.length;e++){var r=n[e];t.targets.push(r.serialize())}return t},i.prototype._syncActiveTargets=function(t){var e=0;this._activeTargets.reset(),this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._vertexCount=0;for(var n=0,r=this._targets;n<r.length;n++){var o=r[n];if(o.influence!==0){this._activeTargets.push(o),this._tempInfluences[e++]=o.influence,this._supportsNormals=this._supportsNormals&&o.hasNormals,this._supportsTangents=this._supportsTangents&&o.hasTangents,this._supportsUVs=this._supportsUVs&&o.hasUVs;var u=o.getPositions();if(u){var f=u.length/3;if(this._vertexCount===0)this._vertexCount=f;else if(this._vertexCount!==f)return void _.a.Error("Incompatible target. Targets must all have the same vertices count.")}}}this._influences&&this._influences.length===e||(this._influences=new Float32Array(e));for(var v=0;v<e;v++)this._influences[v]=this._tempInfluences[v];t&&this.synchronize()},i.prototype.synchronize=function(){if(this._scene)for(var t=0,e=this._scene.meshes;t<e.length;t++){var n=e[t];n.morphTargetManager===this&&n._syncGeometryWithMorphTargetManager()}},i.Parse=function(t,e){var n=new i(e);n._uniqueId=t.id;for(var r=0,o=t.targets;r<o.length;r++){var u=o[r];n.addTarget(w0.Parse(u))}return n},i}(),Ut=c(32),Fn=c(50),Os=function(){function i(t,e){if(e===void 0&&(e=i.DefaultPluginFactory()),this._physicsPlugin=e,this._impostors=[],this._joints=[],this._subTimeStep=0,!this._physicsPlugin.isSupported())throw new Error("Physics Engine "+this._physicsPlugin.name+" cannot be found. Please make sure it is included.");t=t||new d.e(0,-9.807,0),this.setGravity(t),this.setTimeStep()}return i.DefaultPluginFactory=function(){throw dr.a.WarnImport("CannonJSPlugin")},i.prototype.setGravity=function(t){this.gravity=t,this._physicsPlugin.setGravity(this.gravity)},i.prototype.setTimeStep=function(t){t===void 0&&(t=1/60),this._physicsPlugin.setTimeStep(t)},i.prototype.getTimeStep=function(){return this._physicsPlugin.getTimeStep()},i.prototype.setSubTimeStep=function(t){t===void 0&&(t=0),this._subTimeStep=t},i.prototype.getSubTimeStep=function(){return this._subTimeStep},i.prototype.dispose=function(){this._impostors.forEach(function(t){t.dispose()}),this._physicsPlugin.dispose()},i.prototype.getPhysicsPluginName=function(){return this._physicsPlugin.name},i.prototype.addImpostor=function(t){t.uniqueId=this._impostors.push(t),t.parent||this._physicsPlugin.generatePhysicsBody(t)},i.prototype.removeImpostor=function(t){var e=this._impostors.indexOf(t);e>-1&&this._impostors.splice(e,1).length&&this.getPhysicsPlugin().removePhysicsBody(t)},i.prototype.addJoint=function(t,e,n){var r={mainImpostor:t,connectedImpostor:e,joint:n};n.physicsPlugin=this._physicsPlugin,this._joints.push(r),this._physicsPlugin.generateJoint(r)},i.prototype.removeJoint=function(t,e,n){var r=this._joints.filter(function(o){return o.connectedImpostor===e&&o.joint===n&&o.mainImpostor===t});r.length&&this._physicsPlugin.removeJoint(r[0])},i.prototype._step=function(t){var e=this;this._impostors.forEach(function(n){n.isBodyInitRequired()&&e._physicsPlugin.generatePhysicsBody(n)}),t>.1?t=.1:t<=0&&(t=1/60),this._physicsPlugin.executeStep(t,this._impostors)},i.prototype.getPhysicsPlugin=function(){return this._physicsPlugin},i.prototype.getImpostors=function(){return this._impostors},i.prototype.getImpostorForPhysicsObject=function(t){for(var e=0;e<this._impostors.length;++e)if(this._impostors[e].object===t)return this._impostors[e];return null},i.prototype.getImpostorWithPhysicsBody=function(t){for(var e=0;e<this._impostors.length;++e)if(this._impostors[e].physicsBody===t)return this._impostors[e];return null},i.prototype.raycast=function(t,e){return this._physicsPlugin.raycast(t,e)},i.Epsilon=.001,i}(),dm=function(){function i(){this._hasHit=!1,this._hitDistance=0,this._hitNormalWorld=d.e.Zero(),this._hitPointWorld=d.e.Zero(),this._rayFromWorld=d.e.Zero(),this._rayToWorld=d.e.Zero()}return Object.defineProperty(i.prototype,"hasHit",{get:function(){return this._hasHit},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"hitDistance",{get:function(){return this._hitDistance},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"hitNormalWorld",{get:function(){return this._hitNormalWorld},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"hitPointWorld",{get:function(){return this._hitPointWorld},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"rayFromWorld",{get:function(){return this._rayFromWorld},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"rayToWorld",{get:function(){return this._rayToWorld},enumerable:!1,configurable:!0}),i.prototype.setHitData=function(t,e){this._hasHit=!0,this._hitNormalWorld=new d.e(t.x,t.y,t.z),this._hitPointWorld=new d.e(e.x,e.y,e.z)},i.prototype.setHitDistance=function(t){this._hitDistance=t},i.prototype.calculateHitDistance=function(){this._hitDistance=d.e.Distance(this._rayFromWorld,this._hitPointWorld)},i.prototype.reset=function(t,e){t===void 0&&(t=d.e.Zero()),e===void 0&&(e=d.e.Zero()),this._rayFromWorld=t,this._rayToWorld=e,this._hasHit=!1,this._hitDistance=0,this._hitNormalWorld=d.e.Zero(),this._hitPointWorld=d.e.Zero()},i}(),fm=function(){function i(t,e,n){t===void 0&&(t=!0),e===void 0&&(e=10),n===void 0&&(n=CANNON),this._useDeltaForWorldStep=t,this.name="CannonJSPlugin",this._physicsMaterials=new Array,this._fixedTimeStep=1/60,this._physicsBodysToRemoveAfterStep=new Array,this._firstFrame=!0,this._minus90X=new d.b(-.7071067811865475,0,0,.7071067811865475),this._plus90X=new d.b(.7071067811865475,0,0,.7071067811865475),this._tmpPosition=d.e.Zero(),this._tmpDeltaPosition=d.e.Zero(),this._tmpUnityRotation=new d.b,this.BJSCANNON=n,this.isSupported()?(this._extendNamespace(),this.world=new this.BJSCANNON.World,this.world.broadphase=new this.BJSCANNON.NaiveBroadphase,this.world.solver.iterations=e,this._cannonRaycastResult=new this.BJSCANNON.RaycastResult,this._raycastResult=new dm):_.a.Error("CannonJS is not available. Please make sure you included the js file.")}return i.prototype.setGravity=function(t){var e=t;this.world.gravity.set(e.x,e.y,e.z)},i.prototype.setTimeStep=function(t){this._fixedTimeStep=t},i.prototype.getTimeStep=function(){return this._fixedTimeStep},i.prototype.executeStep=function(t,e){if(this._firstFrame){this._firstFrame=!1;for(var n=0,r=e;n<r.length;n++){var o=r[n];o.type!=Ut.a.HeightmapImpostor&&o.type!==Ut.a.PlaneImpostor&&o.beforeStep()}}this.world.step(this._useDeltaForWorldStep?t:this._fixedTimeStep),this._removeMarkedPhysicsBodiesFromWorld()},i.prototype._removeMarkedPhysicsBodiesFromWorld=function(){var t=this;this._physicsBodysToRemoveAfterStep.length>0&&(this._physicsBodysToRemoveAfterStep.forEach(function(e){t.world.remove(e)}),this._physicsBodysToRemoveAfterStep=[])},i.prototype.applyImpulse=function(t,e,n){var r=new this.BJSCANNON.Vec3(n.x,n.y,n.z),o=new this.BJSCANNON.Vec3(e.x,e.y,e.z);t.physicsBody.applyImpulse(o,r)},i.prototype.applyForce=function(t,e,n){var r=new this.BJSCANNON.Vec3(n.x,n.y,n.z),o=new this.BJSCANNON.Vec3(e.x,e.y,e.z);t.physicsBody.applyForce(o,r)},i.prototype.generatePhysicsBody=function(t){if(this._removeMarkedPhysicsBodiesFromWorld(),t.parent)t.physicsBody&&(this.removePhysicsBody(t),t.forceUpdate());else{if(t.isBodyInitRequired()){var e=this._createShape(t),n=t.physicsBody;n&&this.removePhysicsBody(t);var r=this._addMaterial("mat-"+t.uniqueId,t.getParam("friction"),t.getParam("restitution")),o={mass:t.getParam("mass"),material:r},u=t.getParam("nativeOptions");for(var f in u)u.hasOwnProperty(f)&&(o[f]=u[f]);t.physicsBody=new this.BJSCANNON.Body(o),t.physicsBody.addEventListener("collide",t.onCollide),this.world.addEventListener("preStep",t.beforeStep),this.world.addEventListener("postStep",t.afterStep),t.physicsBody.addShape(e),this.world.add(t.physicsBody),n&&["force","torque","velocity","angularVelocity"].forEach(function(v){var y=n[v];t.physicsBody[v].set(y.x,y.y,y.z)}),this._processChildMeshes(t)}this._updatePhysicsBodyTransformation(t)}},i.prototype._processChildMeshes=function(t){var e=this,n=t.object.getChildMeshes?t.object.getChildMeshes(!0):[],r=t.object.rotationQuaternion;if(n.length){var o=function(u){if(r&&u.rotationQuaternion){var f=u.getPhysicsImpostor();if(f&&f.parent!==t){var v=u.getAbsolutePosition().subtract(u.parent.getAbsolutePosition()),y=u.rotationQuaternion;f.physicsBody&&(e.removePhysicsBody(f),f.physicsBody=null),f.parent=t,f.resetUpdateFlags(),t.physicsBody.addShape(e._createShape(f),new e.BJSCANNON.Vec3(v.x,v.y,v.z),new e.BJSCANNON.Quaternion(y.x,y.y,y.z,y.w)),t.physicsBody.mass+=f.getParam("mass")}r.multiplyInPlace(u.rotationQuaternion),u.getChildMeshes(!0).filter(function(D){return!!D.physicsImpostor}).forEach(o)}};n.filter(function(u){return!!u.physicsImpostor}).forEach(o)}},i.prototype.removePhysicsBody=function(t){t.physicsBody.removeEventListener("collide",t.onCollide),this.world.removeEventListener("preStep",t.beforeStep),this.world.removeEventListener("postStep",t.afterStep),this._physicsBodysToRemoveAfterStep.indexOf(t.physicsBody)===-1&&this._physicsBodysToRemoveAfterStep.push(t.physicsBody)},i.prototype.generateJoint=function(t){var e=t.mainImpostor.physicsBody,n=t.connectedImpostor.physicsBody;if(e&&n){var r,o=t.joint.jointData,u={pivotA:o.mainPivot?new this.BJSCANNON.Vec3().set(o.mainPivot.x,o.mainPivot.y,o.mainPivot.z):null,pivotB:o.connectedPivot?new this.BJSCANNON.Vec3().set(o.connectedPivot.x,o.connectedPivot.y,o.connectedPivot.z):null,axisA:o.mainAxis?new this.BJSCANNON.Vec3().set(o.mainAxis.x,o.mainAxis.y,o.mainAxis.z):null,axisB:o.connectedAxis?new this.BJSCANNON.Vec3().set(o.connectedAxis.x,o.connectedAxis.y,o.connectedAxis.z):null,maxForce:o.nativeParams.maxForce,collideConnected:!!o.collision};switch(t.joint.type){case Fn.e.HingeJoint:case Fn.e.Hinge2Joint:r=new this.BJSCANNON.HingeConstraint(e,n,u);break;case Fn.e.DistanceJoint:r=new this.BJSCANNON.DistanceConstraint(e,n,o.maxDistance||2);break;case Fn.e.SpringJoint:var f=o;r=new this.BJSCANNON.Spring(e,n,{restLength:f.length,stiffness:f.stiffness,damping:f.damping,localAnchorA:u.pivotA,localAnchorB:u.pivotB});break;case Fn.e.LockJoint:r=new this.BJSCANNON.LockConstraint(e,n,u);break;case Fn.e.PointToPointJoint:case Fn.e.BallAndSocketJoint:default:r=new this.BJSCANNON.PointToPointConstraint(e,u.pivotA,n,u.pivotB,u.maxForce)}r.collideConnected=!!o.collision,t.joint.physicsJoint=r,t.joint.type!==Fn.e.SpringJoint?this.world.addConstraint(r):(t.joint.jointData.forceApplicationCallback=t.joint.jointData.forceApplicationCallback||function(){r.applyForce()},t.mainImpostor.registerAfterPhysicsStep(t.joint.jointData.forceApplicationCallback))}},i.prototype.removeJoint=function(t){t.joint.type!==Fn.e.SpringJoint?this.world.removeConstraint(t.joint.physicsJoint):t.mainImpostor.unregisterAfterPhysicsStep(t.joint.jointData.forceApplicationCallback)},i.prototype._addMaterial=function(t,e,n){var r,o;for(r=0;r<this._physicsMaterials.length;r++)if((o=this._physicsMaterials[r]).friction===e&&o.restitution===n)return o;var u=new this.BJSCANNON.Material(t);return u.friction=e,u.restitution=n,this._physicsMaterials.push(u),u},i.prototype._checkWithEpsilon=function(t){return t<Os.Epsilon?Os.Epsilon:t},i.prototype._createShape=function(t){var e,n=t.object,r=t.getObjectExtendSize();switch(t.type){case Ut.a.SphereImpostor:var o=r.x,u=r.y,f=r.z;e=new this.BJSCANNON.Sphere(Math.max(this._checkWithEpsilon(o),this._checkWithEpsilon(u),this._checkWithEpsilon(f))/2);break;case Ut.a.CylinderImpostor:var v=t.getParam("nativeOptions");v||(v={});var y=v.radiusTop!==void 0?v.radiusTop:this._checkWithEpsilon(r.x)/2,D=v.radiusBottom!==void 0?v.radiusBottom:this._checkWithEpsilon(r.x)/2,w=v.height!==void 0?v.height:this._checkWithEpsilon(r.y),F=v.numSegments!==void 0?v.numSegments:16;e=new this.BJSCANNON.Cylinder(y,D,w,F);var z=new this.BJSCANNON.Quaternion;z.setFromAxisAngle(new this.BJSCANNON.Vec3(1,0,0),-Math.PI/2);var k=new this.BJSCANNON.Vec3(0,0,0);e.transformAllPoints(k,z);break;case Ut.a.BoxImpostor:var K=r.scale(.5);e=new this.BJSCANNON.Box(new this.BJSCANNON.Vec3(this._checkWithEpsilon(K.x),this._checkWithEpsilon(K.y),this._checkWithEpsilon(K.z)));break;case Ut.a.PlaneImpostor:_.a.Warn("Attention, PlaneImposter might not behave as you expect. Consider using BoxImposter instead"),e=new this.BJSCANNON.Plane;break;case Ut.a.MeshImpostor:var oe=n.getVerticesData?n.getVerticesData(De.b.PositionKind):[],ae=n.getIndices?n.getIndices():[];if(!oe)return;var ue=n.position.clone(),de=n.rotation&&n.rotation.clone(),me=n.rotationQuaternion&&n.rotationQuaternion.clone();n.position.copyFromFloats(0,0,0),n.rotation&&n.rotation.copyFromFloats(0,0,0),n.rotationQuaternion&&n.rotationQuaternion.copyFrom(t.getParentsRotation()),n.rotationQuaternion&&n.parent&&n.rotationQuaternion.conjugateInPlace();var ye,Ee=n.computeWorldMatrix(!0),Ae=new Array;for(ye=0;ye<oe.length;ye+=3)d.e.TransformCoordinates(d.e.FromArray(oe,ye),Ee).toArray(Ae,ye);_.a.Warn("MeshImpostor only collides against spheres."),e=new this.BJSCANNON.Trimesh(Ae,ae),n.position.copyFrom(ue),de&&n.rotation&&n.rotation.copyFrom(de),me&&n.rotationQuaternion&&n.rotationQuaternion.copyFrom(me);break;case Ut.a.HeightmapImpostor:var Ie=n.position.clone(),Re=n.rotation&&n.rotation.clone(),Pe=n.rotationQuaternion&&n.rotationQuaternion.clone();n.position.copyFromFloats(0,0,0),n.rotation&&n.rotation.copyFromFloats(0,0,0),n.rotationQuaternion&&n.rotationQuaternion.copyFrom(t.getParentsRotation()),n.rotationQuaternion&&n.parent&&n.rotationQuaternion.conjugateInPlace(),n.rotationQuaternion&&n.rotationQuaternion.multiplyInPlace(this._minus90X),e=this._createHeightmap(n),n.position.copyFrom(Ie),Re&&n.rotation&&n.rotation.copyFrom(Re),Pe&&n.rotationQuaternion&&n.rotationQuaternion.copyFrom(Pe),n.computeWorldMatrix(!0);break;case Ut.a.ParticleImpostor:e=new this.BJSCANNON.Particle;break;case Ut.a.NoImpostor:e=new this.BJSCANNON.Box(new this.BJSCANNON.Vec3(0,0,0))}return e},i.prototype._createHeightmap=function(t,e){var n,r=t.getVerticesData(De.b.PositionKind),o=t.computeWorldMatrix(!0),u=new Array;for(n=0;n<r.length;n+=3)d.e.TransformCoordinates(d.e.FromArray(r,n),o).toArray(u,n);r=u;for(var f=new Array,v=e||~~(Math.sqrt(r.length/3)-1),y=t.getBoundingInfo(),D=Math.min(y.boundingBox.extendSizeWorld.x,y.boundingBox.extendSizeWorld.y),w=y.boundingBox.extendSizeWorld.z,F=2*D/v,z=0;z<r.length;z+=3){var k=Math.round(r[z+0]/F+v/2),K=Math.round(-1*(r[z+1]/F-v/2)),oe=-r[z+2]+w;f[k]||(f[k]=[]),f[k][K]||(f[k][K]=oe),f[k][K]=Math.max(oe,f[k][K])}for(k=0;k<=v;++k){if(!f[k]){for(var ae=1;!f[(k+ae)%v];)ae++;f[k]=f[(k+ae)%v].slice()}for(K=0;K<=v;++K)if(!f[k][K]){var ue;for(ae=1;ue===void 0;)ue=f[k][(K+ae++)%v];f[k][K]=ue}}var de=new this.BJSCANNON.Heightfield(f,{elementSize:F});return de.minY=w,de},i.prototype._updatePhysicsBodyTransformation=function(t){var e=t.object;if(e.computeWorldMatrix&&e.computeWorldMatrix(!0),e.getBoundingInfo()){var n=t.getObjectCenter();this._tmpDeltaPosition.copyFrom(e.getAbsolutePivotPoint().subtract(n)),this._tmpDeltaPosition.divideInPlace(t.object.scaling),this._tmpPosition.copyFrom(n);var r=e.rotationQuaternion;if(r){if(t.type!==Ut.a.PlaneImpostor&&t.type!==Ut.a.HeightmapImpostor||(r=r.multiply(this._minus90X),t.setDeltaRotation(this._plus90X)),t.type===Ut.a.HeightmapImpostor){var o=e,u=o.getBoundingInfo(),f=o.rotationQuaternion;o.rotationQuaternion=this._tmpUnityRotation,o.computeWorldMatrix(!0);var v=n.clone(),y=o.getPivotMatrix();y=y?y.clone():d.a.Identity();var D=d.a.Translation(u.boundingBox.extendSizeWorld.x,0,-u.boundingBox.extendSizeWorld.z);o.setPreTransformMatrix(D),o.computeWorldMatrix(!0);var w=u.boundingBox.centerWorld.subtract(n).subtract(o.position).negate();this._tmpPosition.copyFromFloats(w.x,w.y-u.boundingBox.extendSizeWorld.y,w.z),this._tmpDeltaPosition.copyFrom(u.boundingBox.centerWorld.subtract(v)),this._tmpDeltaPosition.y+=u.boundingBox.extendSizeWorld.y,o.rotationQuaternion=f,o.setPreTransformMatrix(y),o.computeWorldMatrix(!0)}else t.type===Ut.a.MeshImpostor&&this._tmpDeltaPosition.copyFromFloats(0,0,0);t.setDeltaPosition(this._tmpDeltaPosition),t.physicsBody.position.set(this._tmpPosition.x,this._tmpPosition.y,this._tmpPosition.z),t.physicsBody.quaternion.set(r.x,r.y,r.z,r.w)}}},i.prototype.setTransformationFromPhysicsBody=function(t){if(t.object.position.set(t.physicsBody.position.x,t.physicsBody.position.y,t.physicsBody.position.z),t.object.rotationQuaternion){var e=t.physicsBody.quaternion;t.object.rotationQuaternion.set(e.x,e.y,e.z,e.w)}},i.prototype.setPhysicsBodyTransformation=function(t,e,n){t.physicsBody.position.set(e.x,e.y,e.z),t.physicsBody.quaternion.set(n.x,n.y,n.z,n.w)},i.prototype.isSupported=function(){return this.BJSCANNON!==void 0},i.prototype.setLinearVelocity=function(t,e){t.physicsBody.velocity.set(e.x,e.y,e.z)},i.prototype.setAngularVelocity=function(t,e){t.physicsBody.angularVelocity.set(e.x,e.y,e.z)},i.prototype.getLinearVelocity=function(t){var e=t.physicsBody.velocity;return e?new d.e(e.x,e.y,e.z):null},i.prototype.getAngularVelocity=function(t){var e=t.physicsBody.angularVelocity;return e?new d.e(e.x,e.y,e.z):null},i.prototype.setBodyMass=function(t,e){t.physicsBody.mass=e,t.physicsBody.updateMassProperties()},i.prototype.getBodyMass=function(t){return t.physicsBody.mass},i.prototype.getBodyFriction=function(t){return t.physicsBody.material.friction},i.prototype.setBodyFriction=function(t,e){t.physicsBody.material.friction=e},i.prototype.getBodyRestitution=function(t){return t.physicsBody.material.restitution},i.prototype.setBodyRestitution=function(t,e){t.physicsBody.material.restitution=e},i.prototype.sleepBody=function(t){t.physicsBody.sleep()},i.prototype.wakeUpBody=function(t){t.physicsBody.wakeUp()},i.prototype.updateDistanceJoint=function(t,e){t.physicsJoint.distance=e},i.prototype.setMotor=function(t,e,n,r){r||(t.physicsJoint.enableMotor(),t.physicsJoint.setMotorSpeed(e),n&&this.setLimit(t,n))},i.prototype.setLimit=function(t,e,n){t.physicsJoint.motorEquation.maxForce=e,t.physicsJoint.motorEquation.minForce=n===void 0?-e:n},i.prototype.syncMeshWithImpostor=function(t,e){var n=e.physicsBody;t.position.x=n.position.x,t.position.y=n.position.y,t.position.z=n.position.z,t.rotationQuaternion&&(t.rotationQuaternion.x=n.quaternion.x,t.rotationQuaternion.y=n.quaternion.y,t.rotationQuaternion.z=n.quaternion.z,t.rotationQuaternion.w=n.quaternion.w)},i.prototype.getRadius=function(t){return t.physicsBody.shapes[0].boundingSphereRadius},i.prototype.getBoxSizeToRef=function(t,e){var n=t.physicsBody.shapes[0];e.x=2*n.halfExtents.x,e.y=2*n.halfExtents.y,e.z=2*n.halfExtents.z},i.prototype.dispose=function(){},i.prototype._extendNamespace=function(){var t=new this.BJSCANNON.Vec3,e=this.BJSCANNON;this.BJSCANNON.World.prototype.step=function(n,r,o){if(o=o||10,(r=r||0)===0)this.internalStep(n),this.time+=n;else{var u=Math.floor((this.time+r)/n)-Math.floor(this.time/n);u=Math.min(u,o)||1;for(var f=performance.now(),v=0;v!==u&&(this.internalStep(n),!(performance.now()-f>1e3*n));v++);this.time+=r;for(var y=this.time%n/n,D=t,w=this.bodies,F=0;F!==w.length;F++){var z=w[F];z.type!==e.Body.STATIC&&z.sleepState!==e.Body.SLEEPING?(z.position.vsub(z.previousPosition,D),D.scale(y,D),z.position.vadd(D,z.interpolatedPosition)):(z.interpolatedPosition.set(z.position.x,z.position.y,z.position.z),z.interpolatedQuaternion.set(z.quaternion.x,z.quaternion.y,z.quaternion.z,z.quaternion.w))}}}},i.prototype.raycast=function(t,e){return this._cannonRaycastResult.reset(),this.world.raycastClosest(t,e,{},this._cannonRaycastResult),this._raycastResult.reset(t,e),this._cannonRaycastResult.hasHit&&(this._raycastResult.setHitData({x:this._cannonRaycastResult.hitNormalWorld.x,y:this._cannonRaycastResult.hitNormalWorld.y,z:this._cannonRaycastResult.hitNormalWorld.z},{x:this._cannonRaycastResult.hitPointWorld.x,y:this._cannonRaycastResult.hitPointWorld.y,z:this._cannonRaycastResult.hitPointWorld.z}),this._raycastResult.setHitDistance(this._cannonRaycastResult.distance)),this._raycastResult},i}();Os.DefaultPluginFactory=function(){return new fm};var L0=function(){function i(t,e,n){t===void 0&&(t=!0),n===void 0&&(n=OIMO),this._useDeltaForWorldStep=t,this.name="OimoJSPlugin",this._fixedTimeStep=1/60,this._tmpImpostorsArray=[],this._tmpPositionVector=d.e.Zero(),this.BJSOIMO=n,this.world=new this.BJSOIMO.World({iterations:e}),this.world.clear(),this._raycastResult=new dm}return i.prototype.setGravity=function(t){this.world.gravity.set(t.x,t.y,t.z)},i.prototype.setTimeStep=function(t){this.world.timeStep=t},i.prototype.getTimeStep=function(){return this.world.timeStep},i.prototype.executeStep=function(t,e){var n=this;e.forEach(function(f){f.beforeStep()}),this.world.timeStep=this._useDeltaForWorldStep?t:this._fixedTimeStep,this.world.step(),e.forEach(function(f){f.afterStep(),n._tmpImpostorsArray[f.uniqueId]=f});for(var r=this.world.contacts;r!==null;)if(!r.touching||r.body1.sleeping||r.body2.sleeping){var o=this._tmpImpostorsArray[+r.body1.name],u=this._tmpImpostorsArray[+r.body2.name];o&&u&&(o.onCollide({body:u.physicsBody,point:null}),u.onCollide({body:o.physicsBody,point:null})),r=r.next}else r=r.next},i.prototype.applyImpulse=function(t,e,n){var r=t.physicsBody.mass;t.physicsBody.applyImpulse(n.scale(this.world.invScale),e.scale(this.world.invScale*r))},i.prototype.applyForce=function(t,e,n){_.a.Warn("Oimo doesn't support applying force. Using impule instead."),this.applyImpulse(t,e,n)},i.prototype.generatePhysicsBody=function(t){var e=this;if(t.parent)t.physicsBody&&(this.removePhysicsBody(t),t.forceUpdate());else{if(t.isBodyInitRequired()){var n={name:t.uniqueId,config:[t.getParam("mass")||.001,t.getParam("friction"),t.getParam("restitution")],size:[],type:[],pos:[],posShape:[],rot:[],rotShape:[],move:t.getParam("mass")!==0,density:t.getParam("mass"),friction:t.getParam("friction"),restitution:t.getParam("restitution"),world:this.world},r=[t];(f=t.object).getChildMeshes&&f.getChildMeshes().forEach(function(v){v.physicsImpostor&&r.push(v.physicsImpostor)});var o=function(v){return Math.max(v,Os.Epsilon)},u=new d.b;r.forEach(function(v){if(v.object.rotationQuaternion){var y=v.object.rotationQuaternion;u.copyFrom(y),v.object.rotationQuaternion.set(0,0,0,1),v.object.computeWorldMatrix(!0);var D=u.toEulerAngles(),w=v.getObjectExtendSize();if(v===t){var F=t.getObjectCenter();t.object.getAbsolutePivotPoint().subtractToRef(F,e._tmpPositionVector),e._tmpPositionVector.divideInPlace(t.object.scaling),n.pos.push(F.x),n.pos.push(F.y),n.pos.push(F.z),n.posShape.push(0,0,0),n.rotShape.push(0,0,0)}else{var z=v.object.position.clone();n.posShape.push(z.x),n.posShape.push(z.y),n.posShape.push(z.z),n.rotShape.push(57.29577951308232*D.x,57.29577951308232*D.y,57.29577951308232*D.z)}switch(v.object.rotationQuaternion.copyFrom(u),v.type){case Ut.a.ParticleImpostor:_.a.Warn("No Particle support in OIMO.js. using SphereImpostor instead");case Ut.a.SphereImpostor:var k=w.x,K=w.y,oe=w.z,ae=Math.max(o(k),o(K),o(oe))/2;n.type.push("sphere"),n.size.push(ae),n.size.push(ae),n.size.push(ae);break;case Ut.a.CylinderImpostor:var ue=o(w.x)/2,de=o(w.y);n.type.push("cylinder"),n.size.push(ue),n.size.push(de),n.size.push(de);break;case Ut.a.PlaneImpostor:case Ut.a.BoxImpostor:default:ue=o(w.x),de=o(w.y);var me=o(w.z);n.type.push("box"),n.size.push(ue),n.size.push(de),n.size.push(me)}v.object.rotationQuaternion=y}}),t.physicsBody=this.world.add(n),t.physicsBody.resetQuaternion(u),t.physicsBody.updatePosition(0)}else this._tmpPositionVector.copyFromFloats(0,0,0);var f;t.setDeltaPosition(this._tmpPositionVector)}},i.prototype.removePhysicsBody=function(t){this.world.removeRigidBody(t.physicsBody)},i.prototype.generateJoint=function(t){var e=t.mainImpostor.physicsBody,n=t.connectedImpostor.physicsBody;if(e&&n){var r,o=t.joint.jointData,u=o.nativeParams||{},f={body1:e,body2:n,axe1:u.axe1||(o.mainAxis?o.mainAxis.asArray():null),axe2:u.axe2||(o.connectedAxis?o.connectedAxis.asArray():null),pos1:u.pos1||(o.mainPivot?o.mainPivot.asArray():null),pos2:u.pos2||(o.connectedPivot?o.connectedPivot.asArray():null),min:u.min,max:u.max,collision:u.collision||o.collision,spring:u.spring,world:this.world};switch(t.joint.type){case Fn.e.BallAndSocketJoint:r="jointBall";break;case Fn.e.SpringJoint:_.a.Warn("OIMO.js doesn't support Spring Constraint. Simulating using DistanceJoint instead");var v=o;f.min=v.length||f.min,f.max=Math.max(f.min,f.max);case Fn.e.DistanceJoint:r="jointDistance",f.max=o.maxDistance;break;case Fn.e.PrismaticJoint:r="jointPrisme";break;case Fn.e.SliderJoint:r="jointSlide";break;case Fn.e.WheelJoint:r="jointWheel";break;case Fn.e.HingeJoint:default:r="jointHinge"}f.type=r,t.joint.physicsJoint=this.world.add(f)}},i.prototype.removeJoint=function(t){try{this.world.removeJoint(t.joint.physicsJoint)}catch(e){_.a.Warn(e)}},i.prototype.isSupported=function(){return this.BJSOIMO!==void 0},i.prototype.setTransformationFromPhysicsBody=function(t){if(!t.physicsBody.sleeping){if(t.physicsBody.shapes.next){for(var e=t.physicsBody.shapes;e.next;)e=e.next;t.object.position.set(e.position.x,e.position.y,e.position.z)}else{var n=t.physicsBody.getPosition();t.object.position.set(n.x,n.y,n.z)}if(t.object.rotationQuaternion){var r=t.physicsBody.getQuaternion();t.object.rotationQuaternion.set(r.x,r.y,r.z,r.w)}}},i.prototype.setPhysicsBodyTransformation=function(t,e,n){var r=t.physicsBody;t.physicsBody.shapes.next||(r.position.set(e.x,e.y,e.z),r.orientation.set(n.x,n.y,n.z,n.w),r.syncShapes(),r.awake())},i.prototype.setLinearVelocity=function(t,e){t.physicsBody.linearVelocity.set(e.x,e.y,e.z)},i.prototype.setAngularVelocity=function(t,e){t.physicsBody.angularVelocity.set(e.x,e.y,e.z)},i.prototype.getLinearVelocity=function(t){var e=t.physicsBody.linearVelocity;return e?new d.e(e.x,e.y,e.z):null},i.prototype.getAngularVelocity=function(t){var e=t.physicsBody.angularVelocity;return e?new d.e(e.x,e.y,e.z):null},i.prototype.setBodyMass=function(t,e){var n=e===0;t.physicsBody.shapes.density=n?1:e,t.physicsBody.setupMass(n?2:1)},i.prototype.getBodyMass=function(t){return t.physicsBody.shapes.density},i.prototype.getBodyFriction=function(t){return t.physicsBody.shapes.friction},i.prototype.setBodyFriction=function(t,e){t.physicsBody.shapes.friction=e},i.prototype.getBodyRestitution=function(t){return t.physicsBody.shapes.restitution},i.prototype.setBodyRestitution=function(t,e){t.physicsBody.shapes.restitution=e},i.prototype.sleepBody=function(t){t.physicsBody.sleep()},i.prototype.wakeUpBody=function(t){t.physicsBody.awake()},i.prototype.updateDistanceJoint=function(t,e,n){t.physicsJoint.limitMotor.upperLimit=e,n!==void 0&&(t.physicsJoint.limitMotor.lowerLimit=n)},i.prototype.setMotor=function(t,e,n,r){n!==void 0?_.a.Warn("OimoJS plugin currently has unexpected behavior when using setMotor with force parameter"):n=1e6,e*=-1;var o=r?t.physicsJoint.rotationalLimitMotor2:t.physicsJoint.rotationalLimitMotor1||t.physicsJoint.rotationalLimitMotor||t.physicsJoint.limitMotor;o&&o.setMotor(e,n)},i.prototype.setLimit=function(t,e,n,r){var o=r?t.physicsJoint.rotationalLimitMotor2:t.physicsJoint.rotationalLimitMotor1||t.physicsJoint.rotationalLimitMotor||t.physicsJoint.limitMotor;o&&o.setLimit(e,n===void 0?-e:n)},i.prototype.syncMeshWithImpostor=function(t,e){var n=e.physicsBody;t.position.x=n.position.x,t.position.y=n.position.y,t.position.z=n.position.z,t.rotationQuaternion&&(t.rotationQuaternion.x=n.orientation.x,t.rotationQuaternion.y=n.orientation.y,t.rotationQuaternion.z=n.orientation.z,t.rotationQuaternion.w=n.orientation.s)},i.prototype.getRadius=function(t){return t.physicsBody.shapes.radius},i.prototype.getBoxSizeToRef=function(t,e){var n=t.physicsBody.shapes;e.x=2*n.halfWidth,e.y=2*n.halfHeight,e.z=2*n.halfDepth},i.prototype.dispose=function(){this.world.clear()},i.prototype.raycast=function(t,e){return _.a.Warn("raycast is not currently supported by the Oimo physics plugin"),this._raycastResult.reset(t,e),this._raycastResult},i}(),Sh=c(97),N0=function(){function i(t,e,n){var r=this;t===void 0&&(t=!0),e===void 0&&(e=Ammo),n===void 0&&(n=null),this._useDeltaForWorldStep=t,this.bjsAMMO={},this.name="AmmoJSPlugin",this._timeStep=1/60,this._fixedTimeStep=1/60,this._maxSteps=5,this._tmpQuaternion=new d.b,this._tmpContactCallbackResult=!1,this._tmpContactPoint=new d.e,this._tmpMatrix=new d.a,typeof e=="function"?e(this.bjsAMMO):this.bjsAMMO=e,this.isSupported()?(this._collisionConfiguration=new this.bjsAMMO.btSoftBodyRigidBodyCollisionConfiguration,this._dispatcher=new this.bjsAMMO.btCollisionDispatcher(this._collisionConfiguration),this._overlappingPairCache=n||new this.bjsAMMO.btDbvtBroadphase,this._solver=new this.bjsAMMO.btSequentialImpulseConstraintSolver,this._softBodySolver=new this.bjsAMMO.btDefaultSoftBodySolver,this.world=new this.bjsAMMO.btSoftRigidDynamicsWorld(this._dispatcher,this._overlappingPairCache,this._solver,this._collisionConfiguration,this._softBodySolver),this._tmpAmmoConcreteContactResultCallback=new this.bjsAMMO.ConcreteContactResultCallback,this._tmpAmmoConcreteContactResultCallback.addSingleResult=function(o,u,f,v){var y=(o=r.bjsAMMO.wrapPointer(o,Ammo.btManifoldPoint)).getPositionWorldOnA();r._tmpContactPoint.x=y.x(),r._tmpContactPoint.y=y.y(),r._tmpContactPoint.z=y.z(),r._tmpContactCallbackResult=!0},this._raycastResult=new dm,this._tmpAmmoTransform=new this.bjsAMMO.btTransform,this._tmpAmmoTransform.setIdentity(),this._tmpAmmoQuaternion=new this.bjsAMMO.btQuaternion(0,0,0,1),this._tmpAmmoVectorA=new this.bjsAMMO.btVector3(0,0,0),this._tmpAmmoVectorB=new this.bjsAMMO.btVector3(0,0,0),this._tmpAmmoVectorC=new this.bjsAMMO.btVector3(0,0,0),this._tmpAmmoVectorD=new this.bjsAMMO.btVector3(0,0,0)):_.a.Error("AmmoJS is not available. Please make sure you included the js file.")}return i.prototype.setGravity=function(t){this._tmpAmmoVectorA.setValue(t.x,t.y,t.z),this.world.setGravity(this._tmpAmmoVectorA),this.world.getWorldInfo().set_m_gravity(this._tmpAmmoVectorA)},i.prototype.setTimeStep=function(t){this._timeStep=t},i.prototype.setFixedTimeStep=function(t){this._fixedTimeStep=t},i.prototype.setMaxSteps=function(t){this._maxSteps=t},i.prototype.getTimeStep=function(){return this._timeStep},i.prototype._isImpostorInContact=function(t){return this._tmpContactCallbackResult=!1,this.world.contactTest(t.physicsBody,this._tmpAmmoConcreteContactResultCallback),this._tmpContactCallbackResult},i.prototype._isImpostorPairInContact=function(t,e){return this._tmpContactCallbackResult=!1,this.world.contactPairTest(t.physicsBody,e.physicsBody,this._tmpAmmoConcreteContactResultCallback),this._tmpContactCallbackResult},i.prototype._stepSimulation=function(t,e,n){if(t===void 0&&(t=1/60),e===void 0&&(e=10),n===void 0&&(n=1/60),e==0)this.world.stepSimulation(t,0);else for(;e>0&&t>0;)t-n<n?(this.world.stepSimulation(t,0),t=0):(t-=n,this.world.stepSimulation(n,0)),e--},i.prototype.executeStep=function(t,e){for(var n=0,r=e;n<r.length;n++){var o=r[n];o.soft||o.beforeStep()}this._stepSimulation(this._useDeltaForWorldStep?t:this._timeStep,this._maxSteps,this._fixedTimeStep);for(var u=0,f=e;u<f.length;u++){var v=f[u];if(v.soft?this._afterSoftStep(v):v.afterStep(),v._onPhysicsCollideCallbacks.length>0&&this._isImpostorInContact(v))for(var y=0,D=v._onPhysicsCollideCallbacks;y<D.length;y++)for(var w=0,F=D[y].otherImpostors;w<F.length;w++){var z=F[w];(v.physicsBody.isActive()||z.physicsBody.isActive())&&this._isImpostorPairInContact(v,z)&&(v.onCollide({body:z.physicsBody,point:this._tmpContactPoint}),z.onCollide({body:v.physicsBody,point:this._tmpContactPoint}))}}},i.prototype._afterSoftStep=function(t){t.type===Ut.a.RopeImpostor?this._ropeStep(t):this._softbodyOrClothStep(t)},i.prototype._ropeStep=function(t){for(var e,n,r,o,u=t.physicsBody.get_m_nodes(),f=u.size(),v=new Array,y=0;y<f;y++)n=(e=u.at(y).get_m_x()).x(),r=e.y(),o=e.z(),v.push(new d.e(n,r,o));var D=t.object,w=t.getParam("shape");t._isFromLine?t.object=Jn.a.CreateLines("lines",{points:v,instance:D}):t.object=Sh.a.ExtrudeShape("ext",{shape:w,path:v,instance:D})},i.prototype._softbodyOrClothStep=function(t){var e=t.type===Ut.a.ClothImpostor?1:-1,n=t.object,r=n.getVerticesData(De.b.PositionKind);r||(r=[]);var o=n.getVerticesData(De.b.NormalKind);o||(o=[]);for(var u,f,v,y,D,w,F,z,k=r.length/3,K=t.physicsBody.get_m_nodes(),oe=0;oe<k;oe++){var ae;v=(f=(u=K.at(oe)).get_m_x()).x(),y=f.y(),D=f.z()*e,w=(ae=u.get_m_n()).x(),F=ae.y(),z=ae.z()*e,r[3*oe]=v,r[3*oe+1]=y,r[3*oe+2]=D,o[3*oe]=w,o[3*oe+1]=F,o[3*oe+2]=z}var ue=new Tt.a;ue.positions=r,ue.normals=o,ue.uvs=n.getVerticesData(De.b.UVKind),ue.colors=n.getVerticesData(De.b.ColorKind),n&&n.getIndices&&(ue.indices=n.getIndices()),ue.applyToMesh(n)},i.prototype.applyImpulse=function(t,e,n){if(t.soft)_.a.Warn("Cannot be applied to a soft body");else{t.physicsBody.activate();var r=this._tmpAmmoVectorA,o=this._tmpAmmoVectorB;t.object&&t.object.getWorldMatrix&&n.subtractInPlace(t.object.getWorldMatrix().getTranslation()),r.setValue(n.x,n.y,n.z),o.setValue(e.x,e.y,e.z),t.physicsBody.applyImpulse(o,r)}},i.prototype.applyForce=function(t,e,n){if(t.soft)_.a.Warn("Cannot be applied to a soft body");else{t.physicsBody.activate();var r=this._tmpAmmoVectorA,o=this._tmpAmmoVectorB;t.object&&t.object.getWorldMatrix&&n.subtractInPlace(t.object.getWorldMatrix().getTranslation()),r.setValue(n.x,n.y,n.z),o.setValue(e.x,e.y,e.z),t.physicsBody.applyForce(o,r)}},i.prototype.generatePhysicsBody=function(t){if(t._pluginData.toDispose=[],t.parent)t.physicsBody&&(this.removePhysicsBody(t),t.forceUpdate());else if(t.isBodyInitRequired()){var e=this._createShape(t),n=t.getParam("mass");if(t._pluginData.mass=n,t.soft)e.get_m_cfg().set_collisions(17),e.get_m_cfg().set_kDP(t.getParam("damping")),this.bjsAMMO.castObject(e,this.bjsAMMO.btCollisionObject).getCollisionShape().setMargin(t.getParam("margin")),e.setActivationState(i.DISABLE_DEACTIVATION_FLAG),this.world.addSoftBody(e,1,-1),t.physicsBody=e,t._pluginData.toDispose.push(e),this.setBodyPressure(t,0),t.type===Ut.a.SoftbodyImpostor&&this.setBodyPressure(t,t.getParam("pressure")),this.setBodyStiffness(t,t.getParam("stiffness")),this.setBodyVelocityIterations(t,t.getParam("velocityIterations")),this.setBodyPositionIterations(t,t.getParam("positionIterations"));else{var r=new this.bjsAMMO.btVector3(0,0,0),o=new this.bjsAMMO.btTransform;o.setIdentity(),n!==0&&e.calculateLocalInertia(n,r),this._tmpAmmoVectorA.setValue(t.object.position.x,t.object.position.y,t.object.position.z),this._tmpAmmoQuaternion.setValue(t.object.rotationQuaternion.x,t.object.rotationQuaternion.y,t.object.rotationQuaternion.z,t.object.rotationQuaternion.w),o.setOrigin(this._tmpAmmoVectorA),o.setRotation(this._tmpAmmoQuaternion);var u=new this.bjsAMMO.btDefaultMotionState(o),f=new this.bjsAMMO.btRigidBodyConstructionInfo(n,u,e,r),v=new this.bjsAMMO.btRigidBody(f);n===0&&(v.setCollisionFlags(v.getCollisionFlags()|i.KINEMATIC_FLAG),v.setActivationState(i.DISABLE_DEACTIVATION_FLAG)),t.type!=Ut.a.NoImpostor||e.getChildShape||v.setCollisionFlags(v.getCollisionFlags()|i.DISABLE_COLLISION_FLAG);var y=t.getParam("group"),D=t.getParam("mask");y&&D?this.world.addRigidBody(v,y,D):this.world.addRigidBody(v),t.physicsBody=v,t._pluginData.toDispose=t._pluginData.toDispose.concat([v,f,u,o,r,e])}this.setBodyRestitution(t,t.getParam("restitution")),this.setBodyFriction(t,t.getParam("friction"))}},i.prototype.removePhysicsBody=function(t){var e=this;this.world&&(t.soft?this.world.removeSoftBody(t.physicsBody):this.world.removeRigidBody(t.physicsBody),t._pluginData&&(t._pluginData.toDispose.forEach(function(n){e.bjsAMMO.destroy(n)}),t._pluginData.toDispose=[]))},i.prototype.generateJoint=function(t){var e=t.mainImpostor.physicsBody,n=t.connectedImpostor.physicsBody;if(e&&n){var r,o=t.joint.jointData;switch(o.mainPivot||(o.mainPivot=new d.e(0,0,0)),o.connectedPivot||(o.connectedPivot=new d.e(0,0,0)),t.joint.type){case Fn.e.DistanceJoint:var u=o.maxDistance;u&&(o.mainPivot=new d.e(0,-u/2,0),o.connectedPivot=new d.e(0,u/2,0)),r=new this.bjsAMMO.btPoint2PointConstraint(e,n,new this.bjsAMMO.btVector3(o.mainPivot.x,o.mainPivot.y,o.mainPivot.z),new this.bjsAMMO.btVector3(o.connectedPivot.x,o.connectedPivot.y,o.connectedPivot.z));break;case Fn.e.HingeJoint:o.mainAxis||(o.mainAxis=new d.e(0,0,0)),o.connectedAxis||(o.connectedAxis=new d.e(0,0,0));var f=new this.bjsAMMO.btVector3(o.mainAxis.x,o.mainAxis.y,o.mainAxis.z),v=new this.bjsAMMO.btVector3(o.connectedAxis.x,o.connectedAxis.y,o.connectedAxis.z);r=new this.bjsAMMO.btHingeConstraint(e,n,new this.bjsAMMO.btVector3(o.mainPivot.x,o.mainPivot.y,o.mainPivot.z),new this.bjsAMMO.btVector3(o.connectedPivot.x,o.connectedPivot.y,o.connectedPivot.z),f,v);break;case Fn.e.BallAndSocketJoint:r=new this.bjsAMMO.btPoint2PointConstraint(e,n,new this.bjsAMMO.btVector3(o.mainPivot.x,o.mainPivot.y,o.mainPivot.z),new this.bjsAMMO.btVector3(o.connectedPivot.x,o.connectedPivot.y,o.connectedPivot.z));break;default:_.a.Warn("JointType not currently supported by the Ammo plugin, falling back to PhysicsJoint.BallAndSocketJoint"),r=new this.bjsAMMO.btPoint2PointConstraint(e,n,new this.bjsAMMO.btVector3(o.mainPivot.x,o.mainPivot.y,o.mainPivot.z),new this.bjsAMMO.btVector3(o.connectedPivot.x,o.connectedPivot.y,o.connectedPivot.z))}this.world.addConstraint(r,!t.joint.jointData.collision),t.joint.physicsJoint=r}},i.prototype.removeJoint=function(t){this.world&&this.world.removeConstraint(t.joint.physicsJoint)},i.prototype._addMeshVerts=function(t,e,n){var r=this,o=0;if(n&&n.getIndices&&n.getWorldMatrix&&n.getChildMeshes){var u=n.getIndices();u||(u=[]);var f=n.getVerticesData(De.b.PositionKind);f||(f=[]),n.computeWorldMatrix(!1);for(var v=u.length/3,y=0;y<v;y++){for(var D=[],w=0;w<3;w++){var F,z=new d.e(f[3*u[3*y+w]+0],f[3*u[3*y+w]+1],f[3*u[3*y+w]+2]);d.a.ScalingToRef(n.scaling.x,n.scaling.y,n.scaling.z,this._tmpMatrix),z=d.e.TransformCoordinates(z,this._tmpMatrix),(F=w==0?this._tmpAmmoVectorA:w==1?this._tmpAmmoVectorB:this._tmpAmmoVectorC).setValue(z.x,z.y,z.z),D.push(F)}t.addTriangle(D[0],D[1],D[2]),o++}n.getChildMeshes().forEach(function(k){o+=r._addMeshVerts(t,e,k)})}return o},i.prototype._softVertexData=function(t){var e=t.object;if(e&&e.getIndices&&e.getWorldMatrix&&e.getChildMeshes){e.getIndices();var n=e.getVerticesData(De.b.PositionKind);n||(n=[]);var r=e.getVerticesData(De.b.NormalKind);r||(r=[]),e.computeWorldMatrix(!1);for(var o=[],u=[],f=0;f<n.length;f+=3){var v=new d.e(n[f],n[f+1],n[f+2]),y=new d.e(r[f],r[f+1],r[f+2]);v=d.e.TransformCoordinates(v,e.getWorldMatrix()),y=d.e.TransformNormal(y,e.getWorldMatrix()),o.push(v.x,v.y,v.z),u.push(y.x,y.y,y.z)}var D=new Tt.a;return D.positions=o,D.normals=u,D.uvs=e.getVerticesData(De.b.UVKind),D.colors=e.getVerticesData(De.b.ColorKind),e&&e.getIndices&&(D.indices=e.getIndices()),D.applyToMesh(e),e.position=d.e.Zero(),e.rotationQuaternion=null,e.rotation=d.e.Zero(),e.computeWorldMatrix(!0),D}return Tt.a.ExtractFromMesh(e)},i.prototype._createSoftbody=function(t){var e=t.object;if(e&&e.getIndices){var n=e.getIndices();n||(n=[]);var r=this._softVertexData(t),o=r.positions,u=r.normals;if(o===null||u===null)return new this.bjsAMMO.btCompoundShape;for(var f=[],v=[],y=0;y<o.length;y+=3){var D=new d.e(o[y],o[y+1],o[y+2]),w=new d.e(u[y],u[y+1],u[y+2]);f.push(D.x,D.y,-D.z),v.push(w.x,w.y,-w.z)}var F=new this.bjsAMMO.btSoftBodyHelpers().CreateFromTriMesh(this.world.getWorldInfo(),f,e.getIndices(),n.length/3,!0),z=o.length/3,k=F.get_m_nodes();for(y=0;y<z;y++){var K;(K=k.at(y).get_m_n()).setX(v[3*y]),K.setY(v[3*y+1]),K.setZ(v[3*y+2])}return F}},i.prototype._createCloth=function(t){var e=t.object;if(e&&e.getIndices){e.getIndices();var n=this._softVertexData(t),r=n.positions,o=n.normals;if(r===null||o===null)return new this.bjsAMMO.btCompoundShape;var u=r.length,f=Math.sqrt(u/3);t.segments=f;var v=f-1;return this._tmpAmmoVectorA.setValue(r[0],r[1],r[2]),this._tmpAmmoVectorB.setValue(r[3*v],r[3*v+1],r[3*v+2]),this._tmpAmmoVectorD.setValue(r[u-3],r[u-2],r[u-1]),this._tmpAmmoVectorC.setValue(r[u-3-3*v],r[u-2-3*v],r[u-1-3*v]),new this.bjsAMMO.btSoftBodyHelpers().CreatePatch(this.world.getWorldInfo(),this._tmpAmmoVectorA,this._tmpAmmoVectorB,this._tmpAmmoVectorC,this._tmpAmmoVectorD,f,f,t.getParam("fixedPoints"),!0)}},i.prototype._createRope=function(t){var e,n,r=this._softVertexData(t),o=r.positions,u=r.normals;if(o===null||u===null)return new this.bjsAMMO.btCompoundShape;if(r.applyToMesh(t.object,!0),t._isFromLine=!0,u.map(function(D){return D*D}).reduce(function(D,w){return D+w})===0)n=(e=o.length)/3-1,this._tmpAmmoVectorA.setValue(o[0],o[1],o[2]),this._tmpAmmoVectorB.setValue(o[e-3],o[e-2],o[e-1]);else{t._isFromLine=!1;var f=t.getParam("path");if(t.getParam("shape")===null)return _.a.Warn("No shape available for extruded mesh"),new this.bjsAMMO.btCompoundShape;if(o.length%(3*f.length)!=0)return _.a.Warn("Path does not match extrusion"),new this.bjsAMMO.btCompoundShape;n=(e=f.length)-1,this._tmpAmmoVectorA.setValue(f[0].x,f[0].y,f[0].z),this._tmpAmmoVectorB.setValue(f[e-1].x,f[e-1].y,f[e-1].z)}t.segments=n;var v=t.getParam("fixedPoints");v=v>3?3:v;var y=new this.bjsAMMO.btSoftBodyHelpers().CreateRope(this.world.getWorldInfo(),this._tmpAmmoVectorA,this._tmpAmmoVectorB,n-1,v);return y.get_m_cfg().set_collisions(17),y},i.prototype._createCustom=function(t){var e=null;return this.onCreateCustomShape&&(e=this.onCreateCustomShape(t)),e==null&&(e=new this.bjsAMMO.btCompoundShape),e},i.prototype._addHullVerts=function(t,e,n){var r=this,o=0;if(n&&n.getIndices&&n.getWorldMatrix&&n.getChildMeshes){var u=n.getIndices();u||(u=[]);var f=n.getVerticesData(De.b.PositionKind);f||(f=[]),n.computeWorldMatrix(!1);for(var v=u.length/3,y=0;y<v;y++){for(var D=[],w=0;w<3;w++){var F,z=new d.e(f[3*u[3*y+w]+0],f[3*u[3*y+w]+1],f[3*u[3*y+w]+2]);d.a.ScalingToRef(n.scaling.x,n.scaling.y,n.scaling.z,this._tmpMatrix),z=d.e.TransformCoordinates(z,this._tmpMatrix),(F=w==0?this._tmpAmmoVectorA:w==1?this._tmpAmmoVectorB:this._tmpAmmoVectorC).setValue(z.x,z.y,z.z),D.push(F)}t.addPoint(D[0],!0),t.addPoint(D[1],!0),t.addPoint(D[2],!0),o++}n.getChildMeshes().forEach(function(k){o+=r._addHullVerts(t,e,k)})}return o},i.prototype._createShape=function(t,e){var n=this;e===void 0&&(e=!1);var r,o=t.object,u=t.getObjectExtendSize();if(!e){var f=t.object.getChildMeshes?t.object.getChildMeshes(!0):[];r=new this.bjsAMMO.btCompoundShape;var v=0;if(f.forEach(function(k){var K=k.getPhysicsImpostor();if(K){if(K.type==Ut.a.MeshImpostor)throw"A child MeshImpostor is not supported. Only primitive impostors are supported as children (eg. box or sphere)";var oe=n._createShape(K),ae=k.parent.getWorldMatrix().clone(),ue=new d.e;ae.decompose(ue),n._tmpAmmoTransform.getOrigin().setValue(k.position.x*ue.x,k.position.y*ue.y,k.position.z*ue.z),n._tmpAmmoQuaternion.setValue(k.rotationQuaternion.x,k.rotationQuaternion.y,k.rotationQuaternion.z,k.rotationQuaternion.w),n._tmpAmmoTransform.setRotation(n._tmpAmmoQuaternion),r.addChildShape(n._tmpAmmoTransform,oe),K.dispose(),v++}}),v>0){if(t.type!=Ut.a.NoImpostor){var y=this._createShape(t,!0);y&&(this._tmpAmmoTransform.getOrigin().setValue(0,0,0),this._tmpAmmoQuaternion.setValue(0,0,0,1),this._tmpAmmoTransform.setRotation(this._tmpAmmoQuaternion),r.addChildShape(this._tmpAmmoTransform,y))}return r}this.bjsAMMO.destroy(r),r=null}switch(t.type){case Ut.a.SphereImpostor:if(te.a.WithinEpsilon(u.x,u.y,1e-4)&&te.a.WithinEpsilon(u.x,u.z,1e-4))r=new this.bjsAMMO.btSphereShape(u.x/2);else{var D=[new this.bjsAMMO.btVector3(0,0,0)];(r=new this.bjsAMMO.btMultiSphereShape(D,[1],1)).setLocalScaling(new this.bjsAMMO.btVector3(u.x/2,u.y/2,u.z/2))}break;case Ut.a.CapsuleImpostor:r=new this.bjsAMMO.btCapsuleShape(u.x/2,u.y/2);break;case Ut.a.CylinderImpostor:this._tmpAmmoVectorA.setValue(u.x/2,u.y/2,u.z/2),r=new this.bjsAMMO.btCylinderShape(this._tmpAmmoVectorA);break;case Ut.a.PlaneImpostor:case Ut.a.BoxImpostor:this._tmpAmmoVectorA.setValue(u.x/2,u.y/2,u.z/2),r=new this.bjsAMMO.btBoxShape(this._tmpAmmoVectorA);break;case Ut.a.MeshImpostor:if(t.getParam("mass")==0){var w=new this.bjsAMMO.btTriangleMesh;t._pluginData.toDispose.push(w);var F=this._addMeshVerts(w,o,o);r=F==0?new this.bjsAMMO.btCompoundShape:new this.bjsAMMO.btBvhTriangleMeshShape(w);break}case Ut.a.ConvexHullImpostor:var z=new this.bjsAMMO.btConvexHullShape;(F=this._addHullVerts(z,o,o))==0?(t._pluginData.toDispose.push(z),r=new this.bjsAMMO.btCompoundShape):r=z;break;case Ut.a.NoImpostor:r=new this.bjsAMMO.btSphereShape(u.x/2);break;case Ut.a.CustomImpostor:r=this._createCustom(t);break;case Ut.a.SoftbodyImpostor:r=this._createSoftbody(t);break;case Ut.a.ClothImpostor:r=this._createCloth(t);break;case Ut.a.RopeImpostor:r=this._createRope(t);break;default:_.a.Warn("The impostor type is not currently supported by the ammo plugin.")}return r},i.prototype.setTransformationFromPhysicsBody=function(t){t.physicsBody.getMotionState().getWorldTransform(this._tmpAmmoTransform),t.object.position.set(this._tmpAmmoTransform.getOrigin().x(),this._tmpAmmoTransform.getOrigin().y(),this._tmpAmmoTransform.getOrigin().z()),t.object.rotationQuaternion?t.object.rotationQuaternion.set(this._tmpAmmoTransform.getRotation().x(),this._tmpAmmoTransform.getRotation().y(),this._tmpAmmoTransform.getRotation().z(),this._tmpAmmoTransform.getRotation().w()):t.object.rotation&&(this._tmpQuaternion.set(this._tmpAmmoTransform.getRotation().x(),this._tmpAmmoTransform.getRotation().y(),this._tmpAmmoTransform.getRotation().z(),this._tmpAmmoTransform.getRotation().w()),this._tmpQuaternion.toEulerAnglesToRef(t.object.rotation))},i.prototype.setPhysicsBodyTransformation=function(t,e,n){var r=t.physicsBody.getWorldTransform();if(Math.abs(r.getOrigin().x()-e.x)>Zt.a||Math.abs(r.getOrigin().y()-e.y)>Zt.a||Math.abs(r.getOrigin().z()-e.z)>Zt.a||Math.abs(r.getRotation().x()-n.x)>Zt.a||Math.abs(r.getRotation().y()-n.y)>Zt.a||Math.abs(r.getRotation().z()-n.z)>Zt.a||Math.abs(r.getRotation().w()-n.w)>Zt.a)if(this._tmpAmmoVectorA.setValue(e.x,e.y,e.z),r.setOrigin(this._tmpAmmoVectorA),this._tmpAmmoQuaternion.setValue(n.x,n.y,n.z,n.w),r.setRotation(this._tmpAmmoQuaternion),t.physicsBody.setWorldTransform(r),t.mass==0){var o=t.physicsBody.getMotionState();o&&o.setWorldTransform(r)}else t.physicsBody.activate()},i.prototype.isSupported=function(){return this.bjsAMMO!==void 0},i.prototype.setLinearVelocity=function(t,e){this._tmpAmmoVectorA.setValue(e.x,e.y,e.z),t.soft?t.physicsBody.linearVelocity(this._tmpAmmoVectorA):t.physicsBody.setLinearVelocity(this._tmpAmmoVectorA)},i.prototype.setAngularVelocity=function(t,e){this._tmpAmmoVectorA.setValue(e.x,e.y,e.z),t.soft?t.physicsBody.angularVelocity(this._tmpAmmoVectorA):t.physicsBody.setAngularVelocity(this._tmpAmmoVectorA)},i.prototype.getLinearVelocity=function(t){if(t.soft)var e=t.physicsBody.linearVelocity();else e=t.physicsBody.getLinearVelocity();if(!e)return null;var n=new d.e(e.x(),e.y(),e.z());return this.bjsAMMO.destroy(e),n},i.prototype.getAngularVelocity=function(t){if(t.soft)var e=t.physicsBody.angularVelocity();else e=t.physicsBody.getAngularVelocity();if(!e)return null;var n=new d.e(e.x(),e.y(),e.z());return this.bjsAMMO.destroy(e),n},i.prototype.setBodyMass=function(t,e){t.soft?t.physicsBody.setTotalMass(e,!1):t.physicsBody.setMassProps(e),t._pluginData.mass=e},i.prototype.getBodyMass=function(t){return t._pluginData.mass||0},i.prototype.getBodyFriction=function(t){return t._pluginData.friction||0},i.prototype.setBodyFriction=function(t,e){t.soft?t.physicsBody.get_m_cfg().set_kDF(e):t.physicsBody.setFriction(e),t._pluginData.friction=e},i.prototype.getBodyRestitution=function(t){return t._pluginData.restitution||0},i.prototype.setBodyRestitution=function(t,e){t.physicsBody.setRestitution(e),t._pluginData.restitution=e},i.prototype.getBodyPressure=function(t){return t.soft?t._pluginData.pressure||0:(_.a.Warn("Pressure is not a property of a rigid body"),0)},i.prototype.setBodyPressure=function(t,e){t.soft?t.type===Ut.a.SoftbodyImpostor?(t.physicsBody.get_m_cfg().set_kPR(e),t._pluginData.pressure=e):(t.physicsBody.get_m_cfg().set_kPR(0),t._pluginData.pressure=0):_.a.Warn("Pressure can only be applied to a softbody")},i.prototype.getBodyStiffness=function(t){return t.soft?t._pluginData.stiffness||0:(_.a.Warn("Stiffness is not a property of a rigid body"),0)},i.prototype.setBodyStiffness=function(t,e){t.soft?(e=(e=e<0?0:e)>1?1:e,t.physicsBody.get_m_materials().at(0).set_m_kLST(e),t._pluginData.stiffness=e):_.a.Warn("Stiffness cannot be applied to a rigid body")},i.prototype.getBodyVelocityIterations=function(t){return t.soft?t._pluginData.velocityIterations||0:(_.a.Warn("Velocity iterations is not a property of a rigid body"),0)},i.prototype.setBodyVelocityIterations=function(t,e){t.soft?(e=e<0?0:e,t.physicsBody.get_m_cfg().set_viterations(e),t._pluginData.velocityIterations=e):_.a.Warn("Velocity iterations cannot be applied to a rigid body")},i.prototype.getBodyPositionIterations=function(t){return t.soft?t._pluginData.positionIterations||0:(_.a.Warn("Position iterations is not a property of a rigid body"),0)},i.prototype.setBodyPositionIterations=function(t,e){t.soft?(e=e<0?0:e,t.physicsBody.get_m_cfg().set_piterations(e),t._pluginData.positionIterations=e):_.a.Warn("Position iterations cannot be applied to a rigid body")},i.prototype.appendAnchor=function(t,e,n,r,o,u){o===void 0&&(o=1),u===void 0&&(u=!1);var f=t.segments,v=Math.round((f-1)*n)+f*(f-1-Math.round((f-1)*r));t.physicsBody.appendAnchor(v,e.physicsBody,u,o)},i.prototype.appendHook=function(t,e,n,r,o){r===void 0&&(r=1),o===void 0&&(o=!1);var u=Math.round(t.segments*n);t.physicsBody.appendAnchor(u,e.physicsBody,o,r)},i.prototype.sleepBody=function(t){_.a.Warn("sleepBody is not currently supported by the Ammo physics plugin")},i.prototype.wakeUpBody=function(t){t.physicsBody.activate()},i.prototype.updateDistanceJoint=function(t,e,n){_.a.Warn("updateDistanceJoint is not currently supported by the Ammo physics plugin")},i.prototype.setMotor=function(t,e,n,r){t.physicsJoint.enableAngularMotor(!0,e,n)},i.prototype.setLimit=function(t,e,n){_.a.Warn("setLimit is not currently supported by the Ammo physics plugin")},i.prototype.syncMeshWithImpostor=function(t,e){e.physicsBody.getMotionState().getWorldTransform(this._tmpAmmoTransform),t.position.x=this._tmpAmmoTransform.getOrigin().x(),t.position.y=this._tmpAmmoTransform.getOrigin().y(),t.position.z=this._tmpAmmoTransform.getOrigin().z(),t.rotationQuaternion&&(t.rotationQuaternion.x=this._tmpAmmoTransform.getRotation().x(),t.rotationQuaternion.y=this._tmpAmmoTransform.getRotation().y(),t.rotationQuaternion.z=this._tmpAmmoTransform.getRotation().z(),t.rotationQuaternion.w=this._tmpAmmoTransform.getRotation().w())},i.prototype.getRadius=function(t){return t.getObjectExtendSize().x/2},i.prototype.getBoxSizeToRef=function(t,e){var n=t.getObjectExtendSize();e.x=n.x,e.y=n.y,e.z=n.z},i.prototype.dispose=function(){this.bjsAMMO.destroy(this.world),this.bjsAMMO.destroy(this._solver),this.bjsAMMO.destroy(this._overlappingPairCache),this.bjsAMMO.destroy(this._dispatcher),this.bjsAMMO.destroy(this._collisionConfiguration),this.bjsAMMO.destroy(this._tmpAmmoVectorA),this.bjsAMMO.destroy(this._tmpAmmoVectorB),this.bjsAMMO.destroy(this._tmpAmmoVectorC),this.bjsAMMO.destroy(this._tmpAmmoTransform),this.bjsAMMO.destroy(this._tmpAmmoQuaternion),this.bjsAMMO.destroy(this._tmpAmmoConcreteContactResultCallback),this.world=null},i.prototype.raycast=function(t,e){this._tmpAmmoVectorRCA=new this.bjsAMMO.btVector3(t.x,t.y,t.z),this._tmpAmmoVectorRCB=new this.bjsAMMO.btVector3(e.x,e.y,e.z);var n=new this.bjsAMMO.ClosestRayResultCallback(this._tmpAmmoVectorRCA,this._tmpAmmoVectorRCB);return this.world.rayTest(this._tmpAmmoVectorRCA,this._tmpAmmoVectorRCB,n),this._raycastResult.reset(t,e),n.hasHit()&&(this._raycastResult.setHitData({x:n.get_m_hitNormalWorld().x(),y:n.get_m_hitNormalWorld().y(),z:n.get_m_hitNormalWorld().z()},{x:n.get_m_hitPointWorld().x(),y:n.get_m_hitPointWorld().y(),z:n.get_m_hitPointWorld().z()}),this._raycastResult.calculateHitDistance()),this.bjsAMMO.destroy(n),this.bjsAMMO.destroy(this._tmpAmmoVectorRCA),this.bjsAMMO.destroy(this._tmpAmmoVectorRCB),this._raycastResult},i.DISABLE_COLLISION_FLAG=4,i.KINEMATIC_FLAG=2,i.DISABLE_DEACTIVATION_FLAG=4,i}();E.a.prototype.removeReflectionProbe=function(i){if(!this.reflectionProbes)return-1;var t=this.reflectionProbes.indexOf(i);return t!==-1&&this.reflectionProbes.splice(t,1),t},E.a.prototype.addReflectionProbe=function(i){this.reflectionProbes||(this.reflectionProbes=[]),this.reflectionProbes.push(i)};var F0=function(){function i(t,e,n,r,o){var u=this;r===void 0&&(r=!0),o===void 0&&(o=!1),this.name=t,this._viewMatrix=d.a.Identity(),this._target=d.e.Zero(),this._add=d.e.Zero(),this._invertYAxis=!1,this.position=d.e.Zero(),this._scene=n,this._scene.reflectionProbes||(this._scene.reflectionProbes=new Array),this._scene.reflectionProbes.push(this);var f=g.a.TEXTURETYPE_UNSIGNED_BYTE;if(o){var v=this._scene.getEngine().getCaps();v.textureHalfFloatRender?f=g.a.TEXTURETYPE_HALF_FLOAT:v.textureFloatRender&&(f=g.a.TEXTURETYPE_FLOAT)}this._renderTargetTexture=new qn(t,e,n,r,!0,f,!0),this._renderTargetTexture.onBeforeRenderObservable.add(function(y){switch(y){case 0:u._add.copyFromFloats(1,0,0);break;case 1:u._add.copyFromFloats(-1,0,0);break;case 2:u._add.copyFromFloats(0,u._invertYAxis?1:-1,0);break;case 3:u._add.copyFromFloats(0,u._invertYAxis?-1:1,0);break;case 4:u._add.copyFromFloats(0,0,1);break;case 5:u._add.copyFromFloats(0,0,-1)}u._attachedMesh&&u.position.copyFrom(u._attachedMesh.getAbsolutePosition()),u.position.addToRef(u._add,u._target),d.a.LookAtLHToRef(u.position,u._target,d.e.Up(),u._viewMatrix),n.activeCamera&&(u._projectionMatrix=d.a.PerspectiveFovLH(Math.PI/2,1,n.activeCamera.minZ,n.activeCamera.maxZ),n.setTransformMatrix(u._viewMatrix,u._projectionMatrix)),n._forcedViewPosition=u.position}),this._renderTargetTexture.onAfterUnbindObservable.add(function(){n._forcedViewPosition=null,n.updateTransformMatrix(!0)})}return Object.defineProperty(i.prototype,"samples",{get:function(){return this._renderTargetTexture.samples},set:function(t){this._renderTargetTexture.samples=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"refreshRate",{get:function(){return this._renderTargetTexture.refreshRate},set:function(t){this._renderTargetTexture.refreshRate=t},enumerable:!1,configurable:!0}),i.prototype.getScene=function(){return this._scene},Object.defineProperty(i.prototype,"cubeTexture",{get:function(){return this._renderTargetTexture},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"renderList",{get:function(){return this._renderTargetTexture.renderList},enumerable:!1,configurable:!0}),i.prototype.attachToMesh=function(t){this._attachedMesh=t},i.prototype.setRenderingAutoClearDepthStencil=function(t,e){this._renderTargetTexture.setRenderingAutoClearDepthStencil(t,e)},i.prototype.dispose=function(){var t=this._scene.reflectionProbes.indexOf(this);t!==-1&&this._scene.reflectionProbes.splice(t,1),this._renderTargetTexture&&(this._renderTargetTexture.dispose(),this._renderTargetTexture=null)},i.prototype.toString=function(t){var e="Name: "+this.name;return t&&(e+=", position: "+this.position.toString(),this._attachedMesh&&(e+=", attached mesh: "+this._attachedMesh.name)),e},i.prototype.getClassName=function(){return"ReflectionProbe"},i.prototype.serialize=function(){var t=B.a.Serialize(this,this._renderTargetTexture.serialize());return t.isReflectionProbe=!0,t},i.Parse=function(t,e,n){var r=null;if(e.reflectionProbes)for(var o=0;o<e.reflectionProbes.length;o++){var u=e.reflectionProbes[o];if(u.name===t.name){r=u;break}}return(r=B.a.Parse(function(){return r||new i(t.name,t.renderTargetSize,e,t._generateMipMaps)},t,e,n)).cubeTexture._waitingRenderList=t.renderList,t._attachedMesh&&r.attachToMesh(e.getMeshByID(t._attachedMesh)),r},Object(p.c)([Object(B.k)()],i.prototype,"_attachedMesh",void 0),Object(p.c)([Object(B.o)()],i.prototype,"position",void 0),i}(),vw=!0,xh=function(){function i(){}return i.LoaderInjectedPhysicsEngine=void 0,i}(),B0=function(i,t,e,n){for(var r=0,o=t.materials.length;r<o;r++){var u=t.materials[r];if(u.id===i)return pn.a.Parse(u,e,n)}return null},bw=function(i,t,e){for(var n in t)if(i.name===t[n])return e.push(i.id),!0;return!(!i.parentId||e.indexOf(i.parentId)===-1)&&(e.push(i.id),!0)},Ms=function(i,t){return i+" of "+(t?t.file+" from "+t.name+" version: "+t.version+", exporter version: "+t.exporter_version:"unknown")},U0=function(i,t){var e=t;if(t._waitingData.lods){if(t._waitingData.lods.ids&&t._waitingData.lods.ids.length>0){var n=t._waitingData.lods.ids,r=e.isEnabled(!1);if(t._waitingData.lods.distances){var o=t._waitingData.lods.distances;if(o.length>=n.length){var u=o.length>n.length?o[o.length-1]:0;e.setEnabled(!1);for(var f=0;f<n.length;f++){var v=n[f],y=i.getMeshByID(v);y!=null&&e.addLODLevel(o[f],y)}u>0&&e.addLODLevel(u,null),r===!0&&e.setEnabled(!0)}else et.b.Warn("Invalid level of detail distances for "+t.name)}}t._waitingData.lods=null}},V0=function(i,t,e,n,r){r===void 0&&(r=!1);var o=new $n(i),u="importScene has failed JSON parse";try{var f=JSON.parse(t);u="";var v,y,D=an.loggingLevel===an.DETAILED_LOGGING;if(f.environmentTexture!==void 0&&f.environmentTexture!==null){var w=f.isPBR===void 0||f.isPBR;if(f.environmentTextureType&&f.environmentTextureType==="BABYLON.HDRCubeTexture"){var F=f.environmentTextureSize?f.environmentTextureSize:128,z=new Th((f.environmentTexture.match(/https?:\/\//g)?"":e)+f.environmentTexture,i,F,!0,!w);f.environmentTextureRotationY&&(z.rotationY=f.environmentTextureRotationY),i.environmentTexture=z}else if(ui.a.EndsWith(f.environmentTexture,".env")){var k=new Ei((f.environmentTexture.match(/https?:\/\//g)?"":e)+f.environmentTexture,i);f.environmentTextureRotationY&&(k.rotationY=f.environmentTextureRotationY),i.environmentTexture=k}else{var K=Ei.CreateFromPrefilteredData((f.environmentTexture.match(/https?:\/\//g)?"":e)+f.environmentTexture,i);f.environmentTextureRotationY&&(K.rotationY=f.environmentTextureRotationY),i.environmentTexture=K}if(f.createDefaultSkybox===!0){var oe=i.activeCamera!==void 0&&i.activeCamera!==null?(i.activeCamera.maxZ-i.activeCamera.minZ)/2:1e3,ae=f.skyboxBlurLevel||0;i.createDefaultSkybox(i.environmentTexture,w,oe,ae)}o.environmentTexture=i.environmentTexture}if(f.environmentIntensity!==void 0&&f.environmentIntensity!==null&&(i.environmentIntensity=f.environmentIntensity),f.lights!==void 0&&f.lights!==null)for(v=0,y=f.lights.length;v<y;v++){var ue=f.lights[v],de=uo.a.Parse(ue,i);de&&(o.lights.push(de),u+=v===0?`
	Lights:`:"",u+=`
		`+de.toString(D))}if(f.reflectionProbes!==void 0&&f.reflectionProbes!==null)for(v=0,y=f.reflectionProbes.length;v<y;v++){var me=f.reflectionProbes[v],ye=F0.Parse(me,i,e);ye&&(o.reflectionProbes.push(ye),u+=v===0?`
	Reflection Probes:`:"",u+=`
		`+ye.toString(D))}if(f.animations!==void 0&&f.animations!==null)for(v=0,y=f.animations.length;v<y;v++){var Ee=f.animations[v],Ae=C.a.GetClass("BABYLON.Animation");if(Ae){var Ie=Ae.Parse(Ee);i.animations.push(Ie),o.animations.push(Ie),u+=v===0?`
	Animations:`:"",u+=`
		`+Ie.toString(D)}}if(f.materials!==void 0&&f.materials!==null)for(v=0,y=f.materials.length;v<y;v++){var Re=f.materials[v],Pe=pn.a.Parse(Re,i,e);Pe&&(o.materials.push(Pe),u+=v===0?`
	Materials:`:"",u+=`
		`+Pe.toString(D),Pe.getActiveTextures().forEach(function(xn){o.textures.indexOf(xn)==-1&&o.textures.push(xn)}))}if(f.multiMaterials!==void 0&&f.multiMaterials!==null)for(v=0,y=f.multiMaterials.length;v<y;v++){var Ce=f.multiMaterials[v],Be=wa.a.ParseMultiMaterial(Ce,i);o.multiMaterials.push(Be),u+=v===0?`
	MultiMaterials:`:"",u+=`
		`+Be.toString(D),Be.getActiveTextures().forEach(function(xn){o.textures.indexOf(xn)==-1&&o.textures.push(xn)})}if(f.morphTargetManagers!==void 0&&f.morphTargetManagers!==null)for(var Oe=0,Ve=f.morphTargetManagers;Oe<Ve.length;Oe++){var Le=Ve[Oe];o.morphTargetManagers.push(Eh.Parse(Le,i))}if(f.skeletons!==void 0&&f.skeletons!==null)for(v=0,y=f.skeletons.length;v<y;v++){var je=f.skeletons[v],tt=xa.Parse(je,i);o.skeletons.push(tt),u+=v===0?`
	Skeletons:`:"",u+=`
		`+tt.toString(D)}var ut=f.geometries;if(ut!=null){var ft=new Array,vt=ut.vertexData;if(vt!=null)for(v=0,y=vt.length;v<y;v++){var rt=vt[v];ft.push(um.a.Parse(rt,i,e))}ft.forEach(function(xn){xn&&o.geometries.push(xn)})}if(f.transformNodes!==void 0&&f.transformNodes!==null)for(v=0,y=f.transformNodes.length;v<y;v++){var mt=f.transformNodes[v],pt=ys.a.Parse(mt,i,e);o.transformNodes.push(pt)}if(f.meshes!==void 0&&f.meshes!==null)for(v=0,y=f.meshes.length;v<y;v++){var it=f.meshes[v],yt=Ne.a.Parse(it,i,e);if(o.meshes.push(yt),yt.hasInstances)for(var He=0,at=yt.instances;He<at.length;He++){var It=at[He];o.meshes.push(It)}u+=v===0?`
	Meshes:`:"",u+=`
		`+yt.toString(D)}if(f.cameras!==void 0&&f.cameras!==null)for(v=0,y=f.cameras.length;v<y;v++){var vn=f.cameras[v],Jt=Pt.a.Parse(vn,i);o.cameras.push(Jt),u+=v===0?`
	Cameras:`:"",u+=`
		`+Jt.toString(D)}if(f.postProcesses!==void 0&&f.postProcesses!==null)for(v=0,y=f.postProcesses.length;v<y;v++){var Sn=f.postProcesses[v],Rt=St.Parse(Sn,i,e);Rt&&(o.postProcesses.push(Rt),u+=v===0?`
Postprocesses:`:"",u+=`
		`+Rt.toString())}if(f.animationGroups!==void 0&&f.animationGroups!==null)for(v=0,y=f.animationGroups.length;v<y;v++){var Rn=f.animationGroups[v],bn=Qe.Parse(Rn,i);o.animationGroups.push(bn),u+=v===0?`
	AnimationGroups:`:"",u+=`
		`+bn.toString(D)}for(v=0,y=i.cameras.length;v<y;v++)(Jt=i.cameras[v])._waitingParentId&&(Jt.parent=i.getLastEntryByID(Jt._waitingParentId),Jt._waitingParentId=null);for(v=0,y=i.lights.length;v<y;v++){var hn=i.lights[v];hn&&hn._waitingParentId&&(hn.parent=i.getLastEntryByID(hn._waitingParentId),hn._waitingParentId=null)}for(v=0,y=i.transformNodes.length;v<y;v++){var yn=i.transformNodes[v];yn._waitingParentId&&(yn.parent=i.getLastEntryByID(yn._waitingParentId),yn._waitingParentId=null)}for(v=0,y=i.meshes.length;v<y;v++)(yt=i.meshes[v])._waitingParentId&&(yt.parent=i.getLastEntryByID(yt._waitingParentId),yt._waitingParentId=null),yt._waitingData.lods&&U0(i,yt);for(v=0,y=i.skeletons.length;v<y;v++)(tt=i.skeletons[v])._hasWaitingData&&(tt.bones!=null&&tt.bones.forEach(function(xn){if(xn._waitingTransformNodeId){var Ci=i.getLastEntryByID(xn._waitingTransformNodeId);Ci&&xn.linkTransformNode(Ci),xn._waitingTransformNodeId=null}}),tt._waitingOverrideMeshId&&(tt.overrideMesh=i.getMeshByID(tt._waitingOverrideMeshId),tt._waitingOverrideMeshId=null),tt._hasWaitingData=null);for(v=0,y=i.meshes.length;v<y;v++){var Lt=i.meshes[v];Lt._waitingData.freezeWorldMatrix?(Lt.freezeWorldMatrix(),Lt._waitingData.freezeWorldMatrix=null):Lt.computeWorldMatrix(!0)}for(v=0,y=i.lights.length;v<y;v++){var Kt=i.lights[v];if(Kt._excludedMeshesIds.length>0){for(var In=0;In<Kt._excludedMeshesIds.length;In++){var Lr=i.getMeshByID(Kt._excludedMeshesIds[In]);Lr&&Kt.excludedMeshes.push(Lr)}Kt._excludedMeshesIds=[]}if(Kt._includedOnlyMeshesIds.length>0){for(var Wr=0;Wr<Kt._includedOnlyMeshesIds.length;Wr++){var pi=i.getMeshByID(Kt._includedOnlyMeshesIds[Wr]);pi&&Kt.includedOnlyMeshes.push(pi)}Kt._includedOnlyMeshesIds=[]}}for(E.a.Parse(f,i,o,e),v=0,y=i.meshes.length;v<y;v++)(yt=i.meshes[v])._waitingData.actions&&(_e.Parse(yt._waitingData.actions,yt,i),yt._waitingData.actions=null);f.actions!==void 0&&f.actions!==null&&_e.Parse(f.actions,null,i)}catch(xn){var Nr=Ms("loadAssets",f?f.producer:"Unknown")+u;if(!n)throw _.a.Log(Nr),xn;n(Nr,xn)}finally{r||o.removeAllFromScene(),u!==null&&an.loggingLevel!==an.NO_LOGGING&&_.a.Log(Ms("loadAssets",f?f.producer:"Unknown")+(an.loggingLevel!==an.MINIMAL_LOGGING?u:""))}return o};an.RegisterPlugin({name:"babylon.js",extensions:".babylon",canDirectLoad:function(i){return i.indexOf("babylon")!==-1},importMesh:function(i,t,e,n,r,o,u,f){var v="importMesh has failed JSON parse";try{var y=JSON.parse(e);v="";var D=an.loggingLevel===an.DETAILED_LOGGING;i?Array.isArray(i)||(i=[i]):i=null;var w=new Array;if(y.meshes!==void 0&&y.meshes!==null){var F,z,k,K=[],oe=[];for(F=0,z=y.meshes.length;F<z;F++){var ae=y.meshes[F];if(i===null||bw(ae,i,w)){if(i!==null&&delete i[i.indexOf(ae.name)],ae.geometryId!==void 0&&ae.geometryId!==null&&y.geometries!==void 0&&y.geometries!==null){var ue=!1;["boxes","spheres","cylinders","toruses","grounds","planes","torusKnots","vertexData"].forEach(function(pt){ue!==!0&&y.geometries[pt]&&Array.isArray(y.geometries[pt])&&y.geometries[pt].forEach(function(it){if(it.id===ae.geometryId){switch(pt){case"vertexData":um.a.Parse(it,t,n)}ue=!0}})}),ue===!1&&_.a.Warn("Geometry not found for mesh "+ae.id)}if(ae.materialId){var de=oe.indexOf(ae.materialId)!==-1;if(de===!1&&y.multiMaterials!==void 0&&y.multiMaterials!==null)for(var me=0,ye=y.multiMaterials.length;me<ye;me++){var Ee=y.multiMaterials[me];if(Ee.id===ae.materialId){for(var Ae=0,Ie=Ee.materials.length;Ae<Ie;Ae++){var Re,Pe=Ee.materials[Ae];oe.push(Pe),(Re=B0(Pe,y,t,n))&&(v+=`
	Material `+Re.toString(D))}oe.push(Ee.id);var Ce=wa.a.ParseMultiMaterial(Ee,t);Ce&&(de=!0,v+=`
	Multi-Material `+Ce.toString(D));break}}de===!1&&(oe.push(ae.materialId),(Re=B0(ae.materialId,y,t,n))?v+=`
	Material `+Re.toString(D):_.a.Warn("Material not found for mesh "+ae.id))}if(ae.skeletonId>-1&&y.skeletons!==void 0&&y.skeletons!==null&&!(K.indexOf(ae.skeletonId)>-1))for(var Be=0,Oe=y.skeletons.length;Be<Oe;Be++){var Ve=y.skeletons[Be];if(Ve.id===ae.skeletonId){var Le=xa.Parse(Ve,t);u.push(Le),K.push(Ve.id),v+=`
	Skeleton `+Le.toString(D)}}if(y.morphTargetManagers!==void 0&&y.morphTargetManagers!==null)for(var je=0,tt=y.morphTargetManagers;je<tt.length;je++){var ut=tt[je];Eh.Parse(ut,t)}var ft=Ne.a.Parse(ae,t,n);r.push(ft),v+=`
	Mesh `+ft.toString(D)}}for(F=0,z=t.meshes.length;F<z;F++)(k=t.meshes[F])._waitingParentId&&(k.parent=t.getLastEntryByID(k._waitingParentId),k._waitingParentId=null),k._waitingData.lods&&U0(t,k);for(F=0,z=t.skeletons.length;F<z;F++)(Le=t.skeletons[F])._hasWaitingData&&(Le.bones!=null&&Le.bones.forEach(function(pt){if(pt._waitingTransformNodeId){var it=t.getLastEntryByID(pt._waitingTransformNodeId);it&&pt.linkTransformNode(it),pt._waitingTransformNodeId=null}}),Le._waitingOverrideMeshId&&(Le.overrideMesh=t.getMeshByID(Le._waitingOverrideMeshId),Le._waitingOverrideMeshId=null),Le._hasWaitingData=null);for(F=0,z=t.meshes.length;F<z;F++)(k=t.meshes[F])._waitingData.freezeWorldMatrix?(k.freezeWorldMatrix(),k._waitingData.freezeWorldMatrix=null):k.computeWorldMatrix(!0)}if(y.particleSystems!==void 0&&y.particleSystems!==null){var vt=E.a.GetIndividualParser(dt.a.NAME_PARTICLESYSTEM);if(vt)for(F=0,z=y.particleSystems.length;F<z;F++){var rt=y.particleSystems[F];w.indexOf(rt.emitterId)!==-1&&o.push(vt(rt,t,n))}}return!0}catch(pt){var mt=Ms("importMesh",y?y.producer:"Unknown")+v;if(!f)throw _.a.Log(mt),pt;f(mt,pt)}finally{v!==null&&an.loggingLevel!==an.NO_LOGGING&&_.a.Log(Ms("importMesh",y?y.producer:"Unknown")+(an.loggingLevel!==an.MINIMAL_LOGGING?v:""))}return!1},load:function(i,t,e,n){var r="importScene has failed JSON parse";try{var o=JSON.parse(t);if(r="",o.useDelayedTextureLoading!==void 0&&o.useDelayedTextureLoading!==null&&(i.useDelayedTextureLoading=o.useDelayedTextureLoading&&!an.ForceFullSceneLoadingForIncremental),o.autoClear!==void 0&&o.autoClear!==null&&(i.autoClear=o.autoClear),o.clearColor!==void 0&&o.clearColor!==null&&(i.clearColor=M.b.FromArray(o.clearColor)),o.ambientColor!==void 0&&o.ambientColor!==null&&(i.ambientColor=M.a.FromArray(o.ambientColor)),o.gravity!==void 0&&o.gravity!==null&&(i.gravity=d.e.FromArray(o.gravity)),o.fogMode&&o.fogMode!==0)switch(i.fogMode=o.fogMode,i.fogColor=M.a.FromArray(o.fogColor),i.fogStart=o.fogStart,i.fogEnd=o.fogEnd,i.fogDensity=o.fogDensity,r+="	Fog mode for scene:  ",i.fogMode){case 1:r+=`exp
`;break;case 2:r+=`exp2
`;break;case 3:r+=`linear
`}if(o.physicsEnabled){var u;o.physicsEngine==="cannon"?u=new fm(void 0,void 0,xh.LoaderInjectedPhysicsEngine):o.physicsEngine==="oimo"?u=new L0(void 0,xh.LoaderInjectedPhysicsEngine):o.physicsEngine==="ammo"&&(u=new N0(void 0,xh.LoaderInjectedPhysicsEngine,void 0)),r="	Physics engine "+(o.physicsEngine?o.physicsEngine:"oimo")+` enabled
`;var f=o.physicsGravity?d.e.FromArray(o.physicsGravity):null;i.enablePhysics(f,u)}return o.metadata!==void 0&&o.metadata!==null&&(i.metadata=o.metadata),o.collisionsEnabled!==void 0&&o.collisionsEnabled!==null&&(i.collisionsEnabled=o.collisionsEnabled),!!V0(i,t,e,n,!0)&&(o.autoAnimate&&i.beginAnimation(i,o.autoAnimateFrom,o.autoAnimateTo,o.autoAnimateLoop,o.autoAnimateSpeed||1),o.activeCameraID!==void 0&&o.activeCameraID!==null&&i.setActiveCameraByID(o.activeCameraID),!0)}catch(y){var v=Ms("importScene",o?o.producer:"Unknown")+r;if(!n)throw _.a.Log(v),y;n(v,y)}finally{r!==null&&an.loggingLevel!==an.NO_LOGGING&&_.a.Log(Ms("importScene",o?o.producer:"Unknown")+(an.loggingLevel!==an.MINIMAL_LOGGING?r:""))}return!1},loadAssetContainer:function(i,t,e,n){return V0(i,t,e,n)}});var yw=c(121),k0=function(){function i(t){t===void 0&&(t={}),this._isEnabled=!0,this.bias=t.bias===void 0?0:t.bias,this.power=t.power===void 0?1:t.power,this.leftColor=t.leftColor||M.a.White(),this.rightColor=t.rightColor||M.a.Black(),t.isEnabled===!1&&(this.isEnabled=!1)}return Object.defineProperty(i.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(t){this._isEnabled!==t&&(this._isEnabled=t,Ge.a.MarkAllMaterialsAsDirty(g.a.MATERIAL_FresnelDirtyFlag|g.a.MATERIAL_MiscDirtyFlag))},enumerable:!1,configurable:!0}),i.prototype.clone=function(){var t=new i;return ge.a.DeepCopy(this,t),t},i.prototype.equals=function(t){return t&&this.bias===t.bias&&this.power===t.power&&this.leftColor.equals(t.leftColor)&&this.rightColor.equals(t.rightColor)&&this.isEnabled===t.isEnabled},i.prototype.serialize=function(){return{isEnabled:this.isEnabled,leftColor:this.leftColor.asArray(),rightColor:this.rightColor.asArray(),bias:this.bias,power:this.power}},i.Parse=function(t){return new i({isEnabled:t.isEnabled,leftColor:M.a.FromArray(t.leftColor),rightColor:M.a.FromArray(t.rightColor),bias:t.bias,power:t.power||1})},i}();B.a._FresnelParametersParser=k0.Parse;var j0=c(119),pm=function(i){function t(e,n){var r=i.call(this,e,n)||this;return r.maxSimultaneousLights=4,r.disableLighting=!1,r.invertNormalMapX=!1,r.invertNormalMapY=!1,r.emissiveColor=new M.a(0,0,0),r.occlusionStrength=1,r.useLightmapAsShadowmap=!1,r._useAlphaFromAlbedoTexture=!0,r._useAmbientInGrayScale=!0,r}return Object(p.d)(t,i),Object.defineProperty(t.prototype,"doubleSided",{get:function(){return this._twoSidedLighting},set:function(e){this._twoSidedLighting!==e&&(this._twoSidedLighting=e,this.backFaceCulling=!e,this._markAllSubMeshesAsTexturesDirty())},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"PBRBaseSimpleMaterial"},Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsLightsDirty")],t.prototype,"maxSimultaneousLights",void 0),Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsLightsDirty")],t.prototype,"disableLighting",void 0),Object(p.c)([Object(B.m)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty","_reflectionTexture")],t.prototype,"environmentTexture",void 0),Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"invertNormalMapX",void 0),Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"invertNormalMapY",void 0),Object(p.c)([Object(B.m)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty","_bumpTexture")],t.prototype,"normalTexture",void 0),Object(p.c)([Object(B.e)("emissive"),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"emissiveColor",void 0),Object(p.c)([Object(B.m)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"emissiveTexture",void 0),Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty","_ambientTextureStrength")],t.prototype,"occlusionStrength",void 0),Object(p.c)([Object(B.m)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty","_ambientTexture")],t.prototype,"occlusionTexture",void 0),Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty","_alphaCutOff")],t.prototype,"alphaCutOff",void 0),Object(p.c)([Object(B.c)()],t.prototype,"doubleSided",null),Object(p.c)([Object(B.m)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty",null)],t.prototype,"lightmapTexture",void 0),Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useLightmapAsShadowmap",void 0),t}(nr),z0=function(i){function t(e,n){var r=i.call(this,e,n)||this;return r._useRoughnessFromMetallicTextureAlpha=!1,r._useRoughnessFromMetallicTextureGreen=!0,r._useMetallnessFromMetallicTextureBlue=!0,r.metallic=1,r.roughness=1,r}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"PBRMetallicRoughnessMaterial"},t.prototype.clone=function(e){var n=this,r=B.a.Clone(function(){return new t(e,n.getScene())},this);return r.id=e,r.name=e,this.clearCoat.copyTo(r.clearCoat),this.anisotropy.copyTo(r.anisotropy),this.brdf.copyTo(r.brdf),this.sheen.copyTo(r.sheen),this.subSurface.copyTo(r.subSurface),r},t.prototype.serialize=function(){var e=B.a.Serialize(this);return e.customType="BABYLON.PBRMetallicRoughnessMaterial",e.clearCoat=this.clearCoat.serialize(),e.anisotropy=this.anisotropy.serialize(),e.brdf=this.brdf.serialize(),e.sheen=this.sheen.serialize(),e.subSurface=this.subSurface.serialize(),e},t.Parse=function(e,n,r){var o=B.a.Parse(function(){return new t(e.name,n)},e,n,r);return e.clearCoat&&o.clearCoat.parse(e.clearCoat,n,r),e.anisotropy&&o.anisotropy.parse(e.anisotropy,n,r),e.brdf&&o.brdf.parse(e.brdf,n,r),e.sheen&&o.sheen.parse(e.sheen,n,r),e.subSurface&&o.subSurface.parse(e.subSurface,n,r),o},Object(p.c)([Object(B.e)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty","_albedoColor")],t.prototype,"baseColor",void 0),Object(p.c)([Object(B.m)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty","_albedoTexture")],t.prototype,"baseTexture",void 0),Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"metallic",void 0),Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"roughness",void 0),Object(p.c)([Object(B.m)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty","_metallicTexture")],t.prototype,"metallicRoughnessTexture",void 0),t}(pm);C.a.RegisteredTypes["BABYLON.PBRMetallicRoughnessMaterial"]=z0;var G0=function(i){function t(e,n){var r=i.call(this,e,n)||this;return r._useMicroSurfaceFromReflectivityMapAlpha=!0,r}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"PBRSpecularGlossinessMaterial"},t.prototype.clone=function(e){var n=this,r=B.a.Clone(function(){return new t(e,n.getScene())},this);return r.id=e,r.name=e,this.clearCoat.copyTo(r.clearCoat),this.anisotropy.copyTo(r.anisotropy),this.brdf.copyTo(r.brdf),this.sheen.copyTo(r.sheen),this.subSurface.copyTo(r.subSurface),r},t.prototype.serialize=function(){var e=B.a.Serialize(this);return e.customType="BABYLON.PBRSpecularGlossinessMaterial",e.clearCoat=this.clearCoat.serialize(),e.anisotropy=this.anisotropy.serialize(),e.brdf=this.brdf.serialize(),e.sheen=this.sheen.serialize(),e.subSurface=this.subSurface.serialize(),e},t.Parse=function(e,n,r){var o=B.a.Parse(function(){return new t(e.name,n)},e,n,r);return e.clearCoat&&o.clearCoat.parse(e.clearCoat,n,r),e.anisotropy&&o.anisotropy.parse(e.anisotropy,n,r),e.brdf&&o.brdf.parse(e.brdf,n,r),e.sheen&&o.sheen.parse(e.sheen,n,r),e.subSurface&&o.subSurface.parse(e.subSurface,n,r),o},Object(p.c)([Object(B.e)("diffuse"),Object(B.b)("_markAllSubMeshesAsTexturesDirty","_albedoColor")],t.prototype,"diffuseColor",void 0),Object(p.c)([Object(B.m)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty","_albedoTexture")],t.prototype,"diffuseTexture",void 0),Object(p.c)([Object(B.e)("specular"),Object(B.b)("_markAllSubMeshesAsTexturesDirty","_reflectivityColor")],t.prototype,"specularColor",void 0),Object(p.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty","_microSurface")],t.prototype,"glossiness",void 0),Object(p.c)([Object(B.m)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty","_reflectivityTexture")],t.prototype,"specularGlossinessTexture",void 0),t}(pm);C.a.RegisteredTypes["BABYLON.PBRSpecularGlossinessMaterial"]=G0;var Ah=c(73),H0=function(i){function t(e,n,r){r===void 0&&(r=null);var o=i.call(this,n)||this;if(!e)return o;if(o._textureMatrix=d.a.Identity(),o.name=e,o.url=e,o._onLoad=r,o._texture=o._getFromCache(e,!0),o._texture)o._triggerOnLoad();else{var u=o.getScene();u&&u.useDelayedTextureLoading?o.delayLoadState=g.a.DELAYLOADSTATE_NOTLOADED:o.loadTexture()}return o}return Object(p.d)(t,i),t.prototype._triggerOnLoad=function(){this._onLoad&&this._onLoad()},t.prototype.getTextureMatrix=function(){return this._textureMatrix},t.prototype.load3dlTexture=function(){var e,n=this,r=this._getEngine();e=r.webGLVersion===1?r.createRawTexture(null,1,1,g.a.TEXTUREFORMAT_RGBA,!1,!1,g.a.TEXTURE_BILINEAR_SAMPLINGMODE,null,g.a.TEXTURETYPE_UNSIGNED_INT):r.createRawTexture3D(null,1,1,1,g.a.TEXTUREFORMAT_RGBA,!1,!1,g.a.TEXTURE_BILINEAR_SAMPLINGMODE,null,g.a.TEXTURETYPE_UNSIGNED_INT),this._texture=e,this._texture.isReady=!1,this.isCube=!1,this.is3D=r.webGLVersion>1,this.wrapU=g.a.TEXTURE_CLAMP_ADDRESSMODE,this.wrapV=g.a.TEXTURE_CLAMP_ADDRESSMODE,this.wrapR=g.a.TEXTURE_CLAMP_ADDRESSMODE,this.anisotropicFilteringLevel=1;var o=function(f){if(typeof f=="string"){for(var v,y=null,D=null,w=f.split(`
`),F=0,z=0,k=0,K=0,oe=0,ae=0;ae<w.length;ae++)if(v=w[ae],t._noneEmptyLineRegex.test(v)&&v.indexOf("#")!==0){var ue=v.split(" ");if(F!==0){if(F!=0){var de=Math.max(parseInt(ue[0]),0),me=Math.max(parseInt(ue[1]),0),ye=Math.max(parseInt(ue[2]),0);oe=Math.max(de,oe),oe=Math.max(me,oe),oe=Math.max(ye,oe);var Ee=4*(z+K*F+k*F*F);D&&(D[Ee+0]=de,D[Ee+1]=me,D[Ee+2]=ye),++k%F==0&&(k=0,++K%F==0&&(z++,K=0))}}else F=ue.length,y=new Uint8Array(F*F*F*4),D=new Float32Array(F*F*F*4)}if(D&&y)for(ae=0;ae<D.length;ae++)if(ae>0&&(ae+1)%4==0)y[ae]=255;else{var Ae=D[ae];y[ae]=Ae/oe*255}e.is3D?(e.updateSize(F,F,F),r.updateRawTexture3D(e,y,g.a.TEXTUREFORMAT_RGBA,!1)):(e.updateSize(F*F,F),r.updateRawTexture(e,y,g.a.TEXTUREFORMAT_RGBA,!1)),e.isReady=!0,n._triggerOnLoad()}},u=this.getScene();return u?u._loadFile(this.url,o):r._loadFile(this.url,o),this._texture},t.prototype.loadTexture=function(){this.url&&this.url.toLocaleLowerCase().indexOf(".3dl")==this.url.length-4&&this.load3dlTexture()},t.prototype.clone=function(){var e=new t(this.url,this.getScene()||this._getEngine());return e.level=this.level,e},t.prototype.delayLoad=function(){this.delayLoadState===g.a.DELAYLOADSTATE_NOTLOADED&&(this.delayLoadState=g.a.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,!0),this._texture||this.loadTexture())},t.Parse=function(e,n){var r=null;return e.name&&!e.isRenderTarget&&((r=new t(e.name,n)).name=e.name,r.level=e.level),r},t.prototype.serialize=function(){if(!this.name)return null;var e={};return e.name=this.name,e.level=this.level,e.customType="BABYLON.ColorGradingTexture",e},t._noneEmptyLineRegex=/\S+/,t}($r.a);C.a.RegisteredTypes["BABYLON.ColorGradingTexture"]=H0;var W0=function(i){function t(e,n,r,o,u,f,v){o===void 0&&(o=!1),u===void 0&&(u=!0),f===void 0&&(f=null),v===void 0&&(v=null);var y=i.call(this,n)||this;if(y._onLoad=null,y._onError=null,!e)throw new Error("Image url is not set");return y._coordinatesMode=ke.a.CUBIC_MODE,y.name=e,y.url=e,y._size=r,y._noMipmap=o,y.gammaSpace=u,y._onLoad=f,y._onError=v,y.hasAlpha=!1,y.isCube=!0,y._texture=y._getFromCache(e,y._noMipmap),y._texture?f&&(y._texture.isReady?et.b.SetImmediate(function(){return f()}):y._texture.onLoadedObservable.add(f)):n.useDelayedTextureLoading?y.delayLoadState=g.a.DELAYLOADSTATE_NOTLOADED:y.loadImage(y.loadTexture.bind(y),y._onError),y}return Object(p.d)(t,i),t.prototype.loadImage=function(e,n){var r=this,o=document.createElement("canvas"),u=new Image;u.addEventListener("load",function(){r._width=u.width,r._height=u.height,o.width=r._width,o.height=r._height;var f=o.getContext("2d");f.drawImage(u,0,0);var v=f.getImageData(0,0,u.width,u.height);r._buffer=v.data.buffer,o.remove(),e()}),u.addEventListener("error",function(f){n&&n(r.getClassName()+" could not be loaded",f)}),u.src=this.url},t.prototype.loadTexture=function(){var e=this,n=this.getScene();n&&(this._texture=n.getEngine().createRawCubeTextureFromUrl(this.url,n,this._size,g.a.TEXTUREFORMAT_RGB,n.getEngine().getCaps().textureFloat?g.a.TEXTURETYPE_FLOAT:g.a.TEXTURETYPE_UNSIGNED_INTEGER,this._noMipmap,function(){for(var r=e.getFloat32ArrayFromArrayBuffer(e._buffer),o=hm.ConvertPanoramaToCubemap(r,e._width,e._height,e._size),u=[],f=0;f<6;f++){var v=o[t._FacesMapping[f]];u.push(v)}return u},null,this._onLoad,this._onError))},t.prototype.getFloat32ArrayFromArrayBuffer=function(e){for(var n=new DataView(e),r=new Float32Array(3*e.byteLength/4),o=0,u=0;u<e.byteLength;u++)(u+1)%4!=0&&(r[o++]=n.getUint8(u)/255);return r},t.prototype.getClassName=function(){return"EquiRectangularCubeTexture"},t.prototype.clone=function(){var e=this.getScene();if(!e)return this;var n=new t(this.url,e,this._size,this._noMipmap,this.gammaSpace);return n.level=this.level,n.wrapU=this.wrapU,n.wrapV=this.wrapV,n.coordinatesIndex=this.coordinatesIndex,n.coordinatesMode=this.coordinatesMode,n},t._FacesMapping=["right","left","up","down","front","back"],t}($r.a),Tw=function(i){function t(e,n,r){var o=i.call(this,r.scene||r.engine)||this;return n&&(r.engine||r.scene)&&(r=Object(p.a)(Object(p.a)({},t.DefaultOptions),r),o._generateMipMaps=r.generateMipMaps,o._samplingMode=r.samplingMode,o._textureMatrix=d.a.Identity(),o.name=e,o.element=n,o._isVideo=n instanceof HTMLVideoElement,o.anisotropicFilteringLevel=1,o._createInternalTexture()),o}return Object(p.d)(t,i),t.prototype._createInternalTexture=function(){var e=0,n=0;this._isVideo?(e=this.element.videoWidth,n=this.element.videoHeight):(e=this.element.width,n=this.element.height);var r=this._getEngine();r&&(this._texture=r.createDynamicTexture(e,n,this._generateMipMaps,this._samplingMode)),this.update()},t.prototype.getTextureMatrix=function(){return this._textureMatrix},t.prototype.update=function(e){e===void 0&&(e=null);var n=this._getEngine();if(this._texture!=null&&n!=null)if(this._isVideo){var r=this.element;if(r.readyState<r.HAVE_CURRENT_DATA)return;n.updateVideoTexture(this._texture,r,e===null||e)}else{var o=this.element;n.updateDynamicTexture(this._texture,o,e===null||e,!1)}},t.DefaultOptions={generateMipMaps:!1,samplingMode:g.a.TEXTURE_BILINEAR_SAMPLINGMODE,engine:null,scene:null},t}($r.a),Ph=function(){function i(){}return i.GetTGAHeader=function(t){var e=0;return{id_length:t[e++],colormap_type:t[e++],image_type:t[e++],colormap_index:t[e++]|t[e++]<<8,colormap_length:t[e++]|t[e++]<<8,colormap_size:t[e++],origin:[t[e++]|t[e++]<<8,t[e++]|t[e++]<<8],width:t[e++]|t[e++]<<8,height:t[e++]|t[e++]<<8,pixel_size:t[e++],flags:t[e++]}},i.UploadContent=function(t,e){if(e.length<19)_.a.Error("Unable to load TGA file - Not enough data to contain header");else{var n=18,r=i.GetTGAHeader(e);if(r.id_length+n>e.length)_.a.Error("Unable to load TGA file - Not enough data");else{n+=r.id_length;var o,u=!1,f=!1,v=!1;switch(r.image_type){case i._TYPE_RLE_INDEXED:u=!0;case i._TYPE_INDEXED:f=!0;break;case i._TYPE_RLE_RGB:u=!0;case i._TYPE_RGB:break;case i._TYPE_RLE_GREY:u=!0;case i._TYPE_GREY:v=!0}var y,D,w,F,z,k,K,oe=r.pixel_size>>3,ae=r.width*r.height*oe;if(f&&(y=e.subarray(n,n+=r.colormap_length*(r.colormap_size>>3))),u){var ue,de,me;o=new Uint8Array(ae);for(var ye=0,Ee=new Uint8Array(oe);n<ae&&ye<ae;)if(de=1+(127&(ue=e[n++])),128&ue){for(me=0;me<oe;++me)Ee[me]=e[n++];for(me=0;me<de;++me)o.set(Ee,ye+me*oe);ye+=oe*de}else{for(de*=oe,me=0;me<de;++me)o[ye+me]=e[n++];ye+=de}}else o=e.subarray(n,n+=f?r.width*r.height:ae);switch((r.flags&i._ORIGIN_MASK)>>i._ORIGIN_SHIFT){default:case i._ORIGIN_UL:D=0,F=1,K=r.width,w=0,z=1,k=r.height;break;case i._ORIGIN_BL:D=0,F=1,K=r.width,w=r.height-1,z=-1,k=-1;break;case i._ORIGIN_UR:D=r.width-1,F=-1,K=-1,w=0,z=1,k=r.height;break;case i._ORIGIN_BR:D=r.width-1,F=-1,K=-1,w=r.height-1,z=-1,k=-1}var Ae=i["_getImageData"+(v?"Grey":"")+r.pixel_size+"bits"](r,y,o,w,z,k,D,F,K);t.getEngine()._uploadDataToTextureDirectly(t,Ae)}}},i._getImageData8bits=function(t,e,n,r,o,u,f,v,y){var D,w,F,z=n,k=e,K=t.width,oe=t.height,ae=0,ue=new Uint8Array(K*oe*4);for(F=r;F!==u;F+=o)for(w=f;w!==y;w+=v,ae++)D=z[ae],ue[4*(w+K*F)+3]=255,ue[4*(w+K*F)+2]=k[3*D+0],ue[4*(w+K*F)+1]=k[3*D+1],ue[4*(w+K*F)+0]=k[3*D+2];return ue},i._getImageData16bits=function(t,e,n,r,o,u,f,v,y){var D,w,F,z=n,k=t.width,K=t.height,oe=0,ae=new Uint8Array(k*K*4);for(F=r;F!==u;F+=o)for(w=f;w!==y;w+=v,oe+=2){var ue=255*((31744&(D=z[oe+0]+(z[oe+1]<<8)))>>10)/31|0,de=255*((992&D)>>5)/31|0,me=255*(31&D)/31|0;ae[4*(w+k*F)+0]=ue,ae[4*(w+k*F)+1]=de,ae[4*(w+k*F)+2]=me,ae[4*(w+k*F)+3]=32768&D?0:255}return ae},i._getImageData24bits=function(t,e,n,r,o,u,f,v,y){var D,w,F=n,z=t.width,k=t.height,K=0,oe=new Uint8Array(z*k*4);for(w=r;w!==u;w+=o)for(D=f;D!==y;D+=v,K+=3)oe[4*(D+z*w)+3]=255,oe[4*(D+z*w)+2]=F[K+0],oe[4*(D+z*w)+1]=F[K+1],oe[4*(D+z*w)+0]=F[K+2];return oe},i._getImageData32bits=function(t,e,n,r,o,u,f,v,y){var D,w,F=n,z=t.width,k=t.height,K=0,oe=new Uint8Array(z*k*4);for(w=r;w!==u;w+=o)for(D=f;D!==y;D+=v,K+=4)oe[4*(D+z*w)+2]=F[K+0],oe[4*(D+z*w)+1]=F[K+1],oe[4*(D+z*w)+0]=F[K+2],oe[4*(D+z*w)+3]=F[K+3];return oe},i._getImageDataGrey8bits=function(t,e,n,r,o,u,f,v,y){var D,w,F,z=n,k=t.width,K=t.height,oe=0,ae=new Uint8Array(k*K*4);for(F=r;F!==u;F+=o)for(w=f;w!==y;w+=v,oe++)D=z[oe],ae[4*(w+k*F)+0]=D,ae[4*(w+k*F)+1]=D,ae[4*(w+k*F)+2]=D,ae[4*(w+k*F)+3]=255;return ae},i._getImageDataGrey16bits=function(t,e,n,r,o,u,f,v,y){var D,w,F=n,z=t.width,k=t.height,K=0,oe=new Uint8Array(z*k*4);for(w=r;w!==u;w+=o)for(D=f;D!==y;D+=v,K+=2)oe[4*(D+z*w)+0]=F[K+0],oe[4*(D+z*w)+1]=F[K+0],oe[4*(D+z*w)+2]=F[K+0],oe[4*(D+z*w)+3]=F[K+1];return oe},i._TYPE_INDEXED=1,i._TYPE_RGB=2,i._TYPE_GREY=3,i._TYPE_RLE_INDEXED=9,i._TYPE_RLE_RGB=10,i._TYPE_RLE_GREY=11,i._ORIGIN_MASK=48,i._ORIGIN_SHIFT=4,i._ORIGIN_BL=0,i._ORIGIN_BR=1,i._ORIGIN_UL=2,i._ORIGIN_UR=3,i}(),X0=function(){function i(){this.supportCascades=!1}return i.prototype.canLoad=function(t){return ui.a.EndsWith(t,".tga")},i.prototype.loadCubeData=function(t,e,n,r,o){throw".env not supported in Cube."},i.prototype.loadData=function(t,e,n){var r=new Uint8Array(t.buffer,t.byteOffset,t.byteLength),o=Ph.GetTGAHeader(r);n(o.width,o.height,e.generateMipMaps,!1,function(){Ph.UploadContent(e,r)})},i}();Ge.a._TextureLoaders.push(new X0);var hl,Ew=function(){};(function(i){i[i.cTFETC1=0]="cTFETC1",i[i.cTFBC1=1]="cTFBC1",i[i.cTFBC4=2]="cTFBC4",i[i.cTFPVRTC1_4_OPAQUE_ONLY=3]="cTFPVRTC1_4_OPAQUE_ONLY",i[i.cTFBC7_M6_OPAQUE_ONLY=4]="cTFBC7_M6_OPAQUE_ONLY",i[i.cTFETC2=5]="cTFETC2",i[i.cTFBC3=6]="cTFBC3",i[i.cTFBC5=7]="cTFBC5"})(hl||(hl={}));var dl=function(){function i(){}return i.GetInternalFormatFromBasisFormat=function(t){if(t===hl.cTFETC1)return 36196;if(t===hl.cTFBC1)return 33776;if(t===hl.cTFBC3)return 33779;throw"The chosen Basis transcoder format is not currently supported"},i._CreateWorkerAsync=function(){var t=this;return this._WorkerPromise||(this._WorkerPromise=new Promise(function(e){t._Worker?e(t._Worker):et.b.LoadFileAsync(i.WasmModuleURL).then(function(n){var r=URL.createObjectURL(new Blob(["("+Sw+")()"],{type:"application/javascript"}));t._Worker=new Worker(r);var o=function(u){u.data.action==="init"&&(t._Worker.removeEventListener("message",o),e(t._Worker))};t._Worker.addEventListener("message",o),t._Worker.postMessage({action:"init",url:i.JSModuleURL,wasmBinary:n})})})),this._WorkerPromise},i.TranscodeAsync=function(t,e){var n=this,r=t instanceof ArrayBuffer?new Uint8Array(t):t;return new Promise(function(o,u){n._CreateWorkerAsync().then(function(){var f=n._actionId++,v=function(D){D.data.action==="transcode"&&D.data.id===f&&(n._Worker.removeEventListener("message",v),D.data.success?o(D.data):u("Transcode is not supported on this device"))};n._Worker.addEventListener("message",v);var y=new Uint8Array(r.byteLength);y.set(new Uint8Array(r.buffer,r.byteOffset,r.byteLength)),n._Worker.postMessage({action:"transcode",id:f,imageData:y,config:e,ignoreSupportedFormats:n._IgnoreSupportedFormats},[y.buffer])})})},i.LoadTextureFromTranscodeResult=function(t,e){for(var n,r=t.getEngine(),o=function(){if(n=e.fileInfo.images[u].levels[0],t._invertVScale=t.invertY,e.format===-1)if(t.type=g.a.TEXTURETYPE_UNSIGNED_SHORT_5_6_5,t.format=g.a.TEXTUREFORMAT_RGB,r.webGLVersion<2&&(te.a.Log2(n.width)%1!=0||te.a.Log2(n.height)%1!=0)){var f=new Nt.a(r,Nt.b.Temp);t._invertVScale=t.invertY,f.type=g.a.TEXTURETYPE_UNSIGNED_SHORT_5_6_5,f.format=g.a.TEXTUREFORMAT_RGB,f.width=n.width+3&-4,f.height=n.height+3&-4,r._bindTextureDirectly(r._gl.TEXTURE_2D,f,!0),r._uploadDataToTextureDirectly(f,n.transcodedPixels,u,0,g.a.TEXTUREFORMAT_RGB,!0),r._rescaleTexture(f,t,r.scenes[0],r._getInternalFormat(g.a.TEXTUREFORMAT_RGB),function(){r._releaseTexture(f),r._bindTextureDirectly(r._gl.TEXTURE_2D,t,!0)})}else t._invertVScale=!t.invertY,t.width=n.width+3&-4,t.height=n.height+3&-4,r._uploadDataToTextureDirectly(t,n.transcodedPixels,u,0,g.a.TEXTUREFORMAT_RGB,!0);else t.width=n.width,t.height=n.height,e.fileInfo.images[u].levels.forEach(function(v,y){r._uploadCompressedDataToTextureDirectly(t,i.GetInternalFormatFromBasisFormat(e.format),v.width,v.height,v.transcodedPixels,u,y)}),r.webGLVersion<2&&(te.a.Log2(t.width)%1!=0||te.a.Log2(t.height)%1!=0)&&(et.b.Warn("Loaded .basis texture width and height are not a power of two. Texture wrapping will be set to Texture.CLAMP_ADDRESSMODE as other modes are not supported with non power of two dimensions in webGL 1."),t._cachedWrapU=ke.a.CLAMP_ADDRESSMODE,t._cachedWrapV=ke.a.CLAMP_ADDRESSMODE)},u=0;u<e.fileInfo.images.length;u++)o()},i._IgnoreSupportedFormats=!1,i.JSModuleURL="https://preview.babylonjs.com/basisTranscoder/basis_transcoder.js",i.WasmModuleURL="https://preview.babylonjs.com/basisTranscoder/basis_transcoder.wasm",i._WorkerPromise=null,i._Worker=null,i._actionId=0,i}();function Sw(){var i=0,t=1,e=5,n=6,r=null;function o(u,f,v,y,D){var w=u.getImageTranscodedSizeInBytes(f,v,y),F=new Uint8Array(w);return u.transcodeImage(F,f,v,y,1,0)?(D&&(F=function(z,k,K,oe){for(var ae=new Uint16Array(4),ue=new Uint16Array(K*oe),de=K/4,me=oe/4,ye=0;ye<me;ye++)for(var Ee=0;Ee<de;Ee++){var Ae=k+8*(ye*de+Ee);ae[0]=z[Ae]|z[Ae+1]<<8,ae[1]=z[Ae+2]|z[Ae+3]<<8,ae[2]=(2*(31&ae[0])+1*(31&ae[1]))/3|(2*(2016&ae[0])+1*(2016&ae[1]))/3&2016|(2*(63488&ae[0])+1*(63488&ae[1]))/3&63488,ae[3]=(2*(31&ae[1])+1*(31&ae[0]))/3|(2*(2016&ae[1])+1*(2016&ae[0]))/3&2016|(2*(63488&ae[1])+1*(63488&ae[0]))/3&63488;for(var Ie=0;Ie<4;Ie++){var Re=z[Ae+4+Ie],Pe=(4*ye+Ie)*K+4*Ee;ue[Pe++]=ae[3&Re],ue[Pe++]=ae[Re>>2&3],ue[Pe++]=ae[Re>>4&3],ue[Pe++]=ae[Re>>6&3]}}return ue}(F,0,u.getImageWidth(f,v)+3&-4,u.getImageHeight(f,v)+3&-4)),F):null}onmessage=function(u){if(u.data.action==="init")r||(Module={wasmBinary:u.data.wasmBinary},importScripts(u.data.url),r=new Promise(function(ye){Module.onRuntimeInitialized=function(){Module.initializeBasis(),ye()}})),r.then(function(){postMessage({action:"init"})});else if(u.data.action==="transcode"){var f=u.data.config,v=u.data.imageData,y=new Module.BasisFile(v),D=function(ye){for(var Ee=ye.getHasAlpha(),Ae=ye.getNumImages(),Ie=[],Re=0;Re<Ae;Re++){for(var Pe={levels:[]},Ce=ye.getNumLevels(Re),Be=0;Be<Ce;Be++){var Oe={width:ye.getImageWidth(Re,Be),height:ye.getImageHeight(Re,Be)};Pe.levels.push(Oe)}Ie.push(Pe)}return{hasAlpha:Ee,images:Ie}}(y),w=u.data.ignoreSupportedFormats?null:function(ye,Ee){var Ae=null;return ye.supportedCompressionFormats&&(ye.supportedCompressionFormats.etc1?Ae=i:ye.supportedCompressionFormats.s3tc?Ae=Ee.hasAlpha?n:t:ye.supportedCompressionFormats.pvrtc||ye.supportedCompressionFormats.etc2&&(Ae=e)),Ae}(u.data.config,D),F=!1;w===null&&(F=!0,w=D.hasAlpha?n:t);var z=!0;y.startTranscoding()||(z=!1);for(var k=[],K=0;K<D.images.length&&z;K++){var oe=D.images[K];if(f.loadSingleImage===void 0||f.loadSingleImage===K){var ae=oe.levels.length;f.loadMipmapLevels===!1&&(ae=1);for(var ue=0;ue<ae;ue++){var de=oe.levels[ue],me=o(y,K,ue,w,F);if(!me){z=!1;break}de.transcodedPixels=me,k.push(de.transcodedPixels.buffer)}}}y.close(),y.delete(),F&&(w=-1),z?postMessage({action:"transcode",success:z,id:u.data.id,fileInfo:D,format:w},k):postMessage({action:"transcode",success:z,id:u.data.id})}}}var Y0=function(){function i(){this.supportCascades=!1}return i.prototype.canLoad=function(t){return ui.a.EndsWith(t,".basis")},i.prototype.loadCubeData=function(t,e,n,r,o){if(!Array.isArray(t)){var u=e.getEngine().getCaps(),f={supportedCompressionFormats:{etc1:!!u.etc1,s3tc:!!u.s3tc,pvrtc:!!u.pvrtc,etc2:!!u.etc2}};dl.TranscodeAsync(t,f).then(function(v){var y=v.fileInfo.images[0].levels.length>1&&e.generateMipMaps;dl.LoadTextureFromTranscodeResult(e,v),e.getEngine()._setCubeMapTextureParams(e,y),e.isReady=!0,e.onLoadedObservable.notifyObservers(e),e.onLoadedObservable.clear(),r&&r()}).catch(function(v){et.b.Warn("Failed to transcode Basis file, transcoding may not be supported on this device"),e.isReady=!0})}},i.prototype.loadData=function(t,e,n){var r=e.getEngine().getCaps(),o={supportedCompressionFormats:{etc1:!!r.etc1,s3tc:!!r.s3tc,pvrtc:!!r.pvrtc,etc2:!!r.etc2}};dl.TranscodeAsync(t,o).then(function(u){var f=u.fileInfo.images[0].levels[0],v=u.fileInfo.images[0].levels.length>1&&e.generateMipMaps;n(f.width,f.height,v,u.format!==-1,function(){dl.LoadTextureFromTranscodeResult(e,u)})}).catch(function(u){et.b.Warn("Failed to transcode Basis file, transcoding may not be supported on this device"),n(0,0,!1,!1,function(){})})},i}();Ge.a._TextureLoaders.push(new Y0);var mm=function(i){function t(e,n,r,o,u){var f=this,v=!(!u||!u.generateMipMaps)&&u.generateMipMaps,y=!(!u||!u.generateDepthTexture)&&u.generateDepthTexture,D=!u||u.doNotChangeAspectRatio===void 0||u.doNotChangeAspectRatio;if((f=i.call(this,e,n,o,v,D)||this).isSupported){var w=[],F=[];f._initTypes(r,w,F,u);var z=!u||u.generateDepthBuffer===void 0||u.generateDepthBuffer,k=!(!u||u.generateStencilBuffer===void 0)&&u.generateStencilBuffer;return f._size=n,f._multiRenderTargetOptions={samplingModes:F,generateMipMaps:v,generateDepthBuffer:z,generateStencilBuffer:k,generateDepthTexture:y,types:w,textureCount:r},f._count=r,f._createInternalTextures(),f._createTextures(),f}f.dispose()}return Object(p.d)(t,i),Object.defineProperty(t.prototype,"isSupported",{get:function(){return this._getEngine().webGLVersion>1||this._getEngine().getCaps().drawBuffersExtension},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"textures",{get:function(){return this._textures},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"count",{get:function(){return this._count},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"depthTexture",{get:function(){return this._textures[this._textures.length-1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wrapU",{set:function(e){if(this._textures)for(var n=0;n<this._textures.length;n++)this._textures[n].wrapU=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wrapV",{set:function(e){if(this._textures)for(var n=0;n<this._textures.length;n++)this._textures[n].wrapV=e},enumerable:!1,configurable:!0}),t.prototype._initTypes=function(e,n,r,o){for(var u=0;u<e;u++)o&&o.types&&o.types[u]!==void 0?n.push(o.types[u]):n.push(o&&o.defaultType?o.defaultType:g.a.TEXTURETYPE_UNSIGNED_INT),o&&o.samplingModes&&o.samplingModes[u]!==void 0?r.push(o.samplingModes[u]):r.push(ke.a.BILINEAR_SAMPLINGMODE)},t.prototype._rebuild=function(e){e===void 0&&(e=!1),this.releaseInternalTextures(),this._createInternalTextures(),e&&this._createTextures();for(var n=0;n<this._internalTextures.length;n++)this._textures[n]._texture=this._internalTextures[n];this._texture=this._internalTextures[0],this.samples!==1&&this._getEngine().updateMultipleRenderTargetTextureSampleCount(this._internalTextures,this.samples)},t.prototype._createInternalTextures=function(){this._internalTextures=this._getEngine().createMultipleRenderTarget(this._size,this._multiRenderTargetOptions)},t.prototype._createTextures=function(){this._textures=[];for(var e=0;e<this._internalTextures.length;e++){var n=new ke.a(null,this.getScene());n._texture=this._internalTextures[e],this._textures.push(n)}this._texture=this._internalTextures[0]},t.prototype.replaceTexture=function(e,n){e._texture&&(this._textures[n]=e,this._internalTextures[n]=e._texture)},Object.defineProperty(t.prototype,"samples",{get:function(){return this._samples},set:function(e){this._samples!==e&&(this._samples=this._getEngine().updateMultipleRenderTargetTextureSampleCount(this._internalTextures,e))},enumerable:!1,configurable:!0}),t.prototype.resize=function(e){this._size=e,this._rebuild()},t.prototype.updateCount=function(e,n){this._multiRenderTargetOptions.textureCount=e,this._count=e;var r=[],o=[];this._initTypes(e,r,o,n),this._multiRenderTargetOptions.types=r,this._multiRenderTargetOptions.samplingModes=o,this._rebuild(!0)},t.prototype.unbindFrameBuffer=function(e,n){var r=this;e.unBindMultiColorAttachmentFramebuffer(this._internalTextures,this.isCube,function(){r.onAfterRenderObservable.notifyObservers(n)})},t.prototype.dispose=function(){this.releaseInternalTextures(),i.prototype.dispose.call(this)},t.prototype.releaseInternalTextures=function(){if(this._internalTextures)for(var e=this._internalTextures.length-1;e>=0;e--)this._internalTextures[e]!==void 0&&(this._internalTextures[e].dispose(),this._internalTextures.splice(e,1))},t}(qn),_m=function(i,t,e){this.id=i,this.scale=t,this.offset=e},xw=function(){function i(t,e,n,r){var o,u,f,v,y,D,w,F,z,k,K,oe,ae;return this.name=t,this.meshes=e,this.scene=r,this.options=n,this.options.map=(o=this.options.map)!==null&&o!==void 0?o:["ambientTexture","bumpTexture","diffuseTexture","emissiveTexture","lightmapTexture","opacityTexture","reflectionTexture","refractionTexture","specularTexture"],this.options.uvsIn=(u=this.options.uvsIn)!==null&&u!==void 0?u:De.b.UVKind,this.options.uvsOut=(f=this.options.uvsOut)!==null&&f!==void 0?f:De.b.UVKind,this.options.layout=(v=this.options.layout)!==null&&v!==void 0?v:i.LAYOUT_STRIP,this.options.layout===i.LAYOUT_COLNUM&&(this.options.colnum=(y=this.options.colnum)!==null&&y!==void 0?y:8),this.options.updateInputMeshes=(D=this.options.updateInputMeshes)===null||D===void 0||D,this.options.disposeSources=(w=this.options.disposeSources)===null||w===void 0||w,this._expecting=0,this.options.fillBlanks=(F=this.options.fillBlanks)===null||F===void 0||F,this.options.fillBlanks===!0&&(this.options.customFillColor=(z=this.options.customFillColor)!==null&&z!==void 0?z:"black"),this.options.frameSize=(k=this.options.frameSize)!==null&&k!==void 0?k:256,this.options.paddingRatio=(K=this.options.paddingRatio)!==null&&K!==void 0?K:.0115,this._paddingValue=Math.ceil(this.options.frameSize*this.options.paddingRatio),this._paddingValue%2!=0&&this._paddingValue++,this.options.paddingMode=(oe=this.options.paddingMode)!==null&&oe!==void 0?oe:i.SUBUV_WRAP,this.options.paddingMode===i.SUBUV_COLOR&&(this.options.paddingColor=(ae=this.options.paddingColor)!==null&&ae!==void 0?ae:new M.b(0,0,0,1)),this.sets={},this.frames=[],this}return i.prototype._createFrames=function(t){for(var e=this,n=this._calculateSize(),r=new d.d(1,1).divide(n),o=0,u=this._expecting,f=this.meshes.length,v=Object.keys(this.sets),y=0;y<v.length;y++){var D=v[y],w=new io.a(this.name+".TexturePack."+D+"Set",{width:n.x,height:n.y},this.scene,!0,ke.a.TRILINEAR_SAMPLINGMODE,Ge.a.TEXTUREFORMAT_RGBA),F=w.getContext();F.fillStyle="rgba(0,0,0,0)",F.fillRect(0,0,n.x,n.y),w.update(!1),this.sets[D]=w}var z=this.options.frameSize||256,k=this._paddingValue,K=z+2*k;for(y=0;y<f;y++)for(var oe=this.meshes[y].material,ae=function(me){var ye=new io.a("temp",K,ue.scene,!0),Ee=ye.getContext(),Ae=ue._getFrameOffset(y),Ie=function(){o++,ye.update(!1);var Be=Ee.getImageData(0,0,K,K),Oe=e.sets[Re];if(Oe.getContext().putImageData(Be,n.x*Ae.x,n.y*Ae.y),ye.dispose(),Oe.update(!1),o==u)return e._calculateMeshUVFrames(z,k,n,r,e.options.updateInputMeshes||!1),void t()},Re=v[me]||"_blank";if(oe&&oe[Re]!==null){var Pe=oe[Re],Ce=new Image;Pe instanceof io.a?Ce.src=Pe.getContext().canvas.toDataURL("image/png"):Ce.src=Pe.url,et.b.SetCorsBehavior(Ce.src,Ce),Ce.onload=function(){Ee.fillStyle="rgba(0,0,0,0)",Ee.fillRect(0,0,K,K),ye.update(!1),Ee.setTransform(1,0,0,-1,0,0);var Be=[0,0,1,0,1,1,0,1,-1,1,-1,0,-2,0,-1,1,-1];switch(e.options.paddingMode){case 0:for(var Oe=0;Oe<9;Oe++)Ee.drawImage(Ce,0,0,Ce.width,Ce.height,k+z*Be[Oe],k+z*Be[Oe+1]-K,z,z);break;case 1:for(var Ve=0;Ve<k;Ve++)Ee.drawImage(Ce,0,0,Ce.width,Ce.height,Ve+z*Be[0],k-K,z,z),Ee.drawImage(Ce,0,0,Ce.width,Ce.height,2*k-Ve,k-K,z,z),Ee.drawImage(Ce,0,0,Ce.width,Ce.height,k,Ve-K,z,z),Ee.drawImage(Ce,0,0,Ce.width,Ce.height,k,2*k-Ve-K,z,z);Ee.drawImage(Ce,0,0,Ce.width,Ce.height,k+z*Be[0],k+z*Be[1]-K,z,z);break;case 2:Ee.fillStyle=(e.options.paddingColor||M.a.Black()).toHexString(),Ee.fillRect(0,0,K,-K),Ee.clearRect(k,k,z,z),Ee.drawImage(Ce,0,0,Ce.width,Ce.height,k+z*Be[0],k+z*Be[1]-K,z,z)}Ee.setTransform(1,0,0,1,0,0),Ie()}}else Ee.fillStyle="rgba(0,0,0,0)",ue.options.fillBlanks&&(Ee.fillStyle=ue.options.customFillColor),Ee.fillRect(0,0,K,K),Ie()},ue=this,de=0;de<v.length;de++)ae(de)},i.prototype._calculateSize=function(){var t=this.meshes.length||0,e=this.options.frameSize||0,n=this._paddingValue||0;switch(this.options.layout){case 0:return new d.d(e*t+2*n*t,e+2*n);case 1:var r=Math.max(2,Math.ceil(Math.sqrt(t))),o=e*r+2*n*r;return new d.d(o,o);case 2:var u=this.options.colnum||1,f=Math.max(1,Math.ceil(t/u));return new d.d(e*u+2*n*u,e*f+2*n*f)}return d.d.Zero()},i.prototype._calculateMeshUVFrames=function(t,e,n,r,o){for(var u=this.meshes.length,f=0;f<u;f++){var v=this.meshes[f],y=new d.d(t/n.x,t/n.y),D=r.clone().scale(e),w=this._getFrameOffset(f).add(D),F=new _m(f,y,w);this.frames.push(F),o&&(this._updateMeshUV(v,f),this._updateTextureReferences(v))}},i.prototype._getFrameOffset=function(t){var e,n,r,o=this.meshes.length;switch(this.options.layout){case 0:return e=1/o,new d.d(t*e,0);case 1:var u=Math.max(2,Math.ceil(Math.sqrt(o)));return r=t-(n=Math.floor(t/u))*u,e=1/u,new d.d(r*e,n*e);case 2:var f=this.options.colnum||1,v=Math.max(1,Math.ceil(o/f));return n=t-(r=Math.floor(t/v))*v,e=new d.d(1/f,1/v),new d.d(r*e.x,n*e.y)}return d.d.Zero()},i.prototype._updateMeshUV=function(t,e){var n=this.frames[e],r=t.getVerticesData(this.options.uvsIn||De.b.UVKind),o=[],u=0;r.length&&(u=r.length||0);for(var f=0;f<u;f+=2)o.push(r[f]*n.scale.x+n.offset.x,r[f+1]*n.scale.y+n.offset.y);t.setVerticesData(this.options.uvsOut||De.b.UVKind,o)},i.prototype._updateTextureReferences=function(t,e){e===void 0&&(e=!1);for(var n=t.material,r=Object.keys(this.sets),o=function(v){v.dispose&&v.dispose()},u=0;u<r.length;u++){var f=r[u];if(e)n[f]!==null&&o(n[f]),n[f]=this.sets[f];else{if(!n)return;n[f]!==null&&(o(n[f]),n[f]=this.sets[f])}}},i.prototype.setMeshToFrame=function(t,e,n){n===void 0&&(n=!1),this._updateMeshUV(t,e),n&&this._updateTextureReferences(t,!0)},i.prototype.processAsync=function(){var t=this;return new Promise(function(e,n){try{if(t.meshes.length===0)return void e();for(var r=0,o=function(v){var y=t.meshes[v],D=y.material;if(!D)return++r===t.meshes.length?{value:t._createFrames(e)}:"continue";D.forceCompilationAsync(y).then(function(){(function(w){if(r++,t.options.map){for(var F=0;F<t.options.map.length;F++)w[t.options.map[F]]!==null&&(t.sets[t.options.map[F]]||(t.sets[t.options.map[F]]=!0),t._expecting++);r===t.meshes.length&&t._createFrames(e)}})(D)})},u=0;u<t.meshes.length;u++){var f=o(u);if(typeof f=="object")return f.value}}catch(v){return n(v)}})},i.prototype.dispose=function(){for(var t=Object.keys(this.sets),e=0;e<t.length;e++){var n=t[e];this.sets[n].dispose()}},i.prototype.download=function(t,e){var n=this;t===void 0&&(t="png"),e===void 0&&(e=1),setTimeout(function(){var r={name:n.name,sets:{},options:{},frames:[]},o=Object.keys(n.sets),u=Object.keys(n.options);try{for(var f=0;f<o.length;f++){var v=o[f],y=n.sets[v];r.sets[v]=y.getContext().canvas.toDataURL("image/"+t,e)}for(f=0;f<u.length;f++){var D=u[f];r.options[D]=n.options[D]}for(f=0;f<n.frames.length;f++){var w=n.frames[f];r.frames.push(w.scale.x,w.scale.y,w.offset.x,w.offset.y)}}catch(k){return void _.a.Warn("Unable to download: "+k)}var F="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(r,null,4)),z=document.createElement("a");z.setAttribute("href",F),z.setAttribute("download",n.name+"_texurePackage.json"),document.body.appendChild(z),z.click(),z.remove()},0)},i.prototype.updateFromJSON=function(t){try{var e=JSON.parse(t);this.name=e.name;for(var n=Object.keys(e.options),r=0;r<n.length;r++)this.options[n[r]]=e.options[n[r]];for(r=0;r<e.frames.length;r+=4){var o=new _m(r/4,new d.d(e.frames[r],e.frames[r+1]),new d.d(e.frames[r+2],e.frames[r+3]));this.frames.push(o)}var u=Object.keys(e.sets);for(r=0;r<u.length;r++){var f=new ke.a(e.sets[u[r]],this.scene,!1,!1);this.sets[u[r]]=f}}catch(v){_.a.Warn("Unable to update from JSON: "+v)}},i.LAYOUT_STRIP=0,i.LAYOUT_POWER2=1,i.LAYOUT_COLNUM=2,i.SUBUV_WRAP=0,i.SUBUV_EXTEND=1,i.SUBUV_COLOR=2,i}(),K0=function(){function i(t){this.name=dt.a.NAME_PROCEDURALTEXTURE,this.scene=t,this.scene.proceduralTextures=new Array}return i.prototype.register=function(){this.scene._beforeClearStage.registerStep(dt.a.STEP_BEFORECLEAR_PROCEDURALTEXTURE,this,this._beforeClear)},i.prototype.rebuild=function(){},i.prototype.dispose=function(){},i.prototype._beforeClear=function(){if(this.scene.proceduralTexturesEnabled){et.b.StartPerformanceCounter("Procedural textures",this.scene.proceduralTextures.length>0);for(var t=0;t<this.scene.proceduralTextures.length;t++){var e=this.scene.proceduralTextures[t];e._shouldRender()&&e.render()}et.b.EndPerformanceCounter("Procedural textures",this.scene.proceduralTextures.length>0)}},i}(),Aw=`
attribute vec2 position;

varying vec2 vPosition;
varying vec2 vUV;
const vec2 madd=vec2(0.5,0.5);
void main(void) {
vPosition=position;
vUV=position*madd+madd;
gl_Position=vec4(position,0.0,1.0);
}`;Ye.a.ShadersStore.proceduralVertexShader=Aw;var fl=function(i){function t(e,n,r,o,u,f,v,y){u===void 0&&(u=null),f===void 0&&(f=!0),v===void 0&&(v=!1),y===void 0&&(y=g.a.TEXTURETYPE_UNSIGNED_INT);var D=i.call(this,null,o,!f)||this;D.isEnabled=!0,D.autoClear=!0,D.onGeneratedObservable=new S.c,D.onBeforeGenerationObservable=new S.c,D.nodeMaterialSource=null,D._textures={},D._currentRefreshId=-1,D._frameId=-1,D._refreshRate=1,D._vertexBuffers={},D._uniforms=new Array,D._samplers=new Array,D._floats={},D._ints={},D._floatsArrays={},D._colors3={},D._colors4={},D._vectors2={},D._vectors3={},D._matrices={},D._fallbackTextureUsed=!1,D._cachedDefines="",D._contentUpdateId=-1;var w=(o=D.getScene()||ne.a.LastCreatedScene)._getComponent(dt.a.NAME_PROCEDURALTEXTURE);w||(w=new K0(o),o._addComponent(w)),o.proceduralTextures.push(D),D._fullEngine=o.getEngine(),D.name=e,D.isRenderTarget=!0,D._size=n,D._generateMipMaps=f,D.setFragment(r),D._fallbackTexture=u,v?(D._texture=D._fullEngine.createRenderTargetCubeTexture(n,{generateMipMaps:f,generateDepthBuffer:!1,generateStencilBuffer:!1,type:y}),D.setFloat("face",0)):D._texture=D._fullEngine.createRenderTargetTexture(n,{generateMipMaps:f,generateDepthBuffer:!1,generateStencilBuffer:!1,type:y});var F=[];return F.push(1,1),F.push(-1,1),F.push(-1,-1),F.push(1,-1),D._vertexBuffers[De.b.PositionKind]=new De.b(D._fullEngine,F,De.b.PositionKind,!1,!1,2),D._createIndexBuffer(),D}return Object(p.d)(t,i),t.prototype.getEffect=function(){return this._effect},t.prototype.getContent=function(){return this._contentData&&this._frameId===this._contentUpdateId||(this._contentData=this.readPixels(0,0,this._contentData),this._contentUpdateId=this._frameId),this._contentData},t.prototype._createIndexBuffer=function(){var e=this._fullEngine,n=[];n.push(0),n.push(1),n.push(2),n.push(0),n.push(2),n.push(3),this._indexBuffer=e.createIndexBuffer(n)},t.prototype._rebuild=function(){var e=this._vertexBuffers[De.b.PositionKind];e&&e._rebuild(),this._createIndexBuffer(),this.refreshRate===qn.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=qn.REFRESHRATE_RENDER_ONCE)},t.prototype.reset=function(){this._effect!==void 0&&this._effect.dispose()},t.prototype._getDefines=function(){return""},t.prototype.isReady=function(){var e,n=this,r=this._fullEngine;if(this.nodeMaterialSource)return this._effect.isReady();if(!this._fragment)return!1;if(this._fallbackTextureUsed)return!0;var o=this._getDefines();return!(!this._effect||o!==this._cachedDefines||!this._effect.isReady())||(e=this._fragment.fragmentElement!==void 0?{vertex:"procedural",fragmentElement:this._fragment.fragmentElement}:{vertex:"procedural",fragment:this._fragment},this._cachedDefines=o,this._effect=r.createEffect(e,[De.b.PositionKind],this._uniforms,this._samplers,o,void 0,void 0,function(){n.releaseInternalTexture(),n._fallbackTexture&&(n._texture=n._fallbackTexture._texture,n._texture&&n._texture.incrementReferences()),n._fallbackTextureUsed=!0}),this._effect.isReady())},t.prototype.resetRefreshCounter=function(){this._currentRefreshId=-1},t.prototype.setFragment=function(e){this._fragment=e},Object.defineProperty(t.prototype,"refreshRate",{get:function(){return this._refreshRate},set:function(e){this._refreshRate=e,this.resetRefreshCounter()},enumerable:!1,configurable:!0}),t.prototype._shouldRender=function(){return this.isEnabled&&this.isReady()&&this._texture?!this._fallbackTextureUsed&&(this._currentRefreshId===-1||this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,this._frameId++,!0):(this._currentRefreshId++,!1)):(this._texture&&(this._texture.isReady=!1),!1)},t.prototype.getRenderSize=function(){return this._size},t.prototype.resize=function(e,n){this._fallbackTextureUsed||(this.releaseInternalTexture(),this._texture=this._fullEngine.createRenderTargetTexture(e,n),this._size=e,this._generateMipMaps=n)},t.prototype._checkUniform=function(e){this._uniforms.indexOf(e)===-1&&this._uniforms.push(e)},t.prototype.setTexture=function(e,n){return this._samplers.indexOf(e)===-1&&this._samplers.push(e),this._textures[e]=n,this},t.prototype.setFloat=function(e,n){return this._checkUniform(e),this._floats[e]=n,this},t.prototype.setInt=function(e,n){return this._checkUniform(e),this._ints[e]=n,this},t.prototype.setFloats=function(e,n){return this._checkUniform(e),this._floatsArrays[e]=n,this},t.prototype.setColor3=function(e,n){return this._checkUniform(e),this._colors3[e]=n,this},t.prototype.setColor4=function(e,n){return this._checkUniform(e),this._colors4[e]=n,this},t.prototype.setVector2=function(e,n){return this._checkUniform(e),this._vectors2[e]=n,this},t.prototype.setVector3=function(e,n){return this._checkUniform(e),this._vectors3[e]=n,this},t.prototype.setMatrix=function(e,n){return this._checkUniform(e),this._matrices[e]=n,this},t.prototype.render=function(e){var n=this.getScene();if(n){var r=this._fullEngine;if(r.enableEffect(this._effect),this.onBeforeGenerationObservable.notifyObservers(this),r.setState(!1),!this.nodeMaterialSource){for(var o in this._textures)this._effect.setTexture(o,this._textures[o]);for(o in this._ints)this._effect.setInt(o,this._ints[o]);for(o in this._floats)this._effect.setFloat(o,this._floats[o]);for(o in this._floatsArrays)this._effect.setArray(o,this._floatsArrays[o]);for(o in this._colors3)this._effect.setColor3(o,this._colors3[o]);for(o in this._colors4){var u=this._colors4[o];this._effect.setFloat4(o,u.r,u.g,u.b,u.a)}for(o in this._vectors2)this._effect.setVector2(o,this._vectors2[o]);for(o in this._vectors3)this._effect.setVector3(o,this._vectors3[o]);for(o in this._matrices)this._effect.setMatrix(o,this._matrices[o])}if(this._texture){if(this.isCube)for(var f=0;f<6;f++)r.bindFramebuffer(this._texture,f,void 0,void 0,!0),r.bindBuffers(this._vertexBuffers,this._indexBuffer,this._effect),this._effect.setFloat("face",f),this.autoClear&&r.clear(n.clearColor,!0,!1,!1),r.drawElementsType(pn.a.TriangleFillMode,0,6),f===5&&r.generateMipMapsForCubemap(this._texture);else r.bindFramebuffer(this._texture,0,void 0,void 0,!0),r.bindBuffers(this._vertexBuffers,this._indexBuffer,this._effect),this.autoClear&&r.clear(n.clearColor,!0,!1,!1),r.drawElementsType(pn.a.TriangleFillMode,0,6);r.unBindFramebuffer(this._texture,this.isCube),this.onGenerated&&this.onGenerated(),this.onGeneratedObservable.notifyObservers(this)}}},t.prototype.clone=function(){var e=this.getSize(),n=new t(this.name,e.width,this._fragment,this.getScene(),this._fallbackTexture,this._generateMipMaps);return n.hasAlpha=this.hasAlpha,n.level=this.level,n.coordinatesMode=this.coordinatesMode,n},t.prototype.dispose=function(){var e=this.getScene();if(e){var n=e.proceduralTextures.indexOf(this);n>=0&&e.proceduralTextures.splice(n,1);var r=this._vertexBuffers[De.b.PositionKind];r&&(r.dispose(),this._vertexBuffers[De.b.PositionKind]=null),this._indexBuffer&&this._fullEngine._releaseBuffer(this._indexBuffer)&&(this._indexBuffer=null),this.onGeneratedObservable.clear(),this.onBeforeGenerationObservable.clear(),i.prototype.dispose.call(this)}},Object(p.c)([Object(B.c)()],t.prototype,"isEnabled",void 0),Object(p.c)([Object(B.c)()],t.prototype,"autoClear",void 0),Object(p.c)([Object(B.c)()],t.prototype,"_generateMipMaps",void 0),Object(p.c)([Object(B.c)()],t.prototype,"_size",void 0),Object(p.c)([Object(B.c)()],t.prototype,"refreshRate",null),t}(ke.a);C.a.RegisteredTypes["BABYLON.ProceduralTexture"]=fl;var Pw=function(i){function t(e,n,r,o,u,f){var v=i.call(this,e,r,null,o,u,f)||this;return v._animate=!0,v._time=0,v._texturePath=n,v._loadJson(n),v.refreshRate=1,v}return Object(p.d)(t,i),t.prototype._loadJson=function(e){var n=this,r=function(){try{n.setFragment(n._texturePath)}catch(f){_.a.Error("No json or ShaderStore or DOM element found for CustomProceduralTexture")}},o=e+"/config.json",u=new se.a;u.open("GET",o),u.addEventListener("load",function(){if(u.status===200||u.responseText&&u.responseText.length>0)try{n._config=JSON.parse(u.response),n.updateShaderUniforms(),n.updateTextures(),n.setFragment(n._texturePath+"/custom"),n._animate=n._config.animate,n.refreshRate=n._config.refreshrate}catch(f){r()}else r()},!1),u.addEventListener("error",function(){r()},!1);try{u.send()}catch(f){_.a.Error("CustomProceduralTexture: Error on XHR send request.")}},t.prototype.isReady=function(){if(!i.prototype.isReady.call(this))return!1;for(var e in this._textures)if(!this._textures[e].isReady())return!1;return!0},t.prototype.render=function(e){var n=this.getScene();this._animate&&n&&(this._time+=.03*n.getAnimationRatio(),this.updateShaderUniforms()),i.prototype.render.call(this,e)},t.prototype.updateTextures=function(){for(var e=0;e<this._config.sampler2Ds.length;e++)this.setTexture(this._config.sampler2Ds[e].sample2Dname,new ke.a(this._texturePath+"/"+this._config.sampler2Ds[e].textureRelativeUrl,this.getScene()))},t.prototype.updateShaderUniforms=function(){if(this._config)for(var e=0;e<this._config.uniforms.length;e++){var n=this._config.uniforms[e];switch(n.type){case"float":this.setFloat(n.name,n.value);break;case"color3":this.setColor3(n.name,new M.a(n.r,n.g,n.b));break;case"color4":this.setColor4(n.name,new M.b(n.r,n.g,n.b,n.a));break;case"vector2":this.setVector2(n.name,new d.d(n.x,n.y));break;case"vector3":this.setVector3(n.name,new d.e(n.x,n.y,n.z))}}this.setFloat("time",this._time)},Object.defineProperty(t.prototype,"animate",{get:function(){return this._animate},set:function(e){this._animate=e},enumerable:!1,configurable:!0}),t}(fl),Cw=`

uniform float brightness;
uniform float persistence;
uniform float timeScale;

varying vec2 vUV;

vec2 hash22(vec2 p)
{
p=p*mat2(127.1,311.7,269.5,183.3);
p=-1.0+2.0*fract(sin(p)*43758.5453123);
return sin(p*6.283+timeScale);
}
float interpolationNoise(vec2 p)
{
vec2 pi=floor(p);
vec2 pf=p-pi;
vec2 w=pf*pf*(3.-2.*pf);
float f00=dot(hash22(pi+vec2(.0,.0)),pf-vec2(.0,.0));
float f01=dot(hash22(pi+vec2(.0,1.)),pf-vec2(.0,1.));
float f10=dot(hash22(pi+vec2(1.0,0.)),pf-vec2(1.0,0.));
float f11=dot(hash22(pi+vec2(1.0,1.)),pf-vec2(1.0,1.));
float xm1=mix(f00,f10,w.x);
float xm2=mix(f01,f11,w.x);
float ym=mix(xm1,xm2,w.y);
return ym;
}
float perlinNoise2D(float x,float y)
{
float sum=0.0;
float frequency=0.0;
float amplitude=0.0;
for(int i=0; i<OCTAVES; i++)
{
frequency=pow(2.0,float(i));
amplitude=pow(persistence,float(i));
sum=sum+interpolationNoise(vec2(x*frequency,y*frequency))*amplitude;
}
return sum;
}

void main(void)
{
float x=abs(vUV.x);
float y=abs(vUV.y);
float noise=brightness+(1.0-brightness)*perlinNoise2D(x,y);
gl_FragColor=vec4(noise,noise,noise,1.0);
}
`;Ye.a.ShadersStore.noisePixelShader=Cw;var Q0=function(i){function t(e,n,r,o,u){n===void 0&&(n=256),r===void 0&&(r=ne.a.LastCreatedScene);var f=i.call(this,e,n,"noise",r,o,u)||this;return f.time=0,f.brightness=.2,f.octaves=3,f.persistence=.8,f.animationSpeedFactor=1,f.autoClear=!1,f._updateShaderUniforms(),f}return Object(p.d)(t,i),t.prototype._updateShaderUniforms=function(){var e=this.getScene();e&&(this.time+=e.getAnimationRatio()*this.animationSpeedFactor*.01,this.setFloat("brightness",this.brightness),this.setFloat("persistence",this.persistence),this.setFloat("timeScale",this.time))},t.prototype._getDefines=function(){return"#define OCTAVES "+(0|this.octaves)},t.prototype.render=function(e){this._updateShaderUniforms(),i.prototype.render.call(this,e)},t.prototype.serialize=function(){var e={customType:"BABYLON.NoiseProceduralTexture"};return e.brightness=this.brightness,e.octaves=this.octaves,e.persistence=this.persistence,e.animationSpeedFactor=this.animationSpeedFactor,e.size=this.getSize().width,e.generateMipMaps=this._generateMipMaps,e.time=this.time,e},t.prototype.clone=function(){var e=this.getSize(),n=new t(this.name,e.width,this.getScene(),this._fallbackTexture?this._fallbackTexture:void 0,this._generateMipMaps);return n.hasAlpha=this.hasAlpha,n.level=this.level,n.coordinatesMode=this.coordinatesMode,n.brightness=this.brightness,n.octaves=this.octaves,n.persistence=this.persistence,n.animationSpeedFactor=this.animationSpeedFactor,n.time=this.time,n},t.Parse=function(e,n){var r,o=new t(e.name,e.size,n,void 0,e.generateMipMaps);return o.brightness=e.brightness,o.octaves=e.octaves,o.persistence=e.persistence,o.animationSpeedFactor=e.animationSpeedFactor,o.time=(r=e.time)!==null&&r!==void 0?r:0,o},t}(fl);C.a.RegisteredTypes["BABYLON.NoiseProceduralTexture"]=Q0;var Me,fe,cr,Mt,Dr,Ai,yr,Rw=function(i){function t(e,n,r,o,u,f,v,y,D){o===void 0&&(o=g.a.TEXTUREFORMAT_RGBA),u===void 0&&(u=g.a.TEXTURETYPE_UNSIGNED_INT),f===void 0&&(f=!1),v===void 0&&(v=!1),y===void 0&&(y=g.a.TEXTURE_TRILINEAR_SAMPLINGMODE),D===void 0&&(D=null);var w=i.call(this,"",e)||this;return w._texture=e.getEngine().createRawCubeTexture(n,r,o,u,f,v,y,D),w}return Object(p.d)(t,i),t.prototype.update=function(e,n,r,o,u){u===void 0&&(u=null),this._texture.getEngine().updateRawCubeTexture(this._texture,e,n,r,o,u)},t.prototype.updateRGBDAsync=function(e,n,r,o){return n===void 0&&(n=null),r===void 0&&(r=.8),o===void 0&&(o=0),t._UpdateRGBDAsync(this._texture,e,n,r,o)},t.prototype.clone=function(){var e=this;return B.a.Clone(function(){var n=e.getScene(),r=e._texture,o=new t(n,r._bufferViewArray,r.width,r.format,r.type,r.generateMipMaps,r.invertY,r.samplingMode,r._compression);return r.source===Nt.b.CubeRawRGBD&&o.updateRGBDAsync(r._bufferViewArrayArray,r._sphericalPolynomial,r._lodGenerationScale,r._lodGenerationOffset),o},this)},t._UpdateRGBDAsync=function(e,n,r,o,u){return e._source=Nt.b.CubeRawRGBD,e._bufferViewArrayArray=n,e._lodGenerationScale=o,e._lodGenerationOffset=u,e._sphericalPolynomial=r,so.UploadLevelsAsync(e,n).then(function(){e.isReady=!0})},t}(Ei),Ow=function(i){function t(e,n,r,o,u,f,v,y,D,w){v===void 0&&(v=!0),y===void 0&&(y=!1),D===void 0&&(D=ke.a.TRILINEAR_SAMPLINGMODE),w===void 0&&(w=g.a.TEXTURETYPE_UNSIGNED_INT);var F=i.call(this,null,f,!v,y)||this;return F.format=u,F._texture=f.getEngine().createRawTexture2DArray(e,n,r,o,u,v,y,D,null,w),F.is2DArray=!0,F}return Object(p.d)(t,i),t.prototype.update=function(e){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,e,this._texture.format,this._texture.invertY,null,this._texture.type)},t}(ke.a),Mw=function(i){function t(e,n,r,o,u,f,v,y,D,w){v===void 0&&(v=!0),y===void 0&&(y=!1),D===void 0&&(D=ke.a.TRILINEAR_SAMPLINGMODE),w===void 0&&(w=g.a.TEXTURETYPE_UNSIGNED_INT);var F=i.call(this,null,f,!v,y)||this;return F.format=u,F._texture=f.getEngine().createRawTexture3D(e,n,r,o,u,v,y,D,null,w),F.is3D=!0,F}return Object(p.d)(t,i),t.prototype.update=function(e){this._texture&&this._getEngine().updateRawTexture3D(this._texture,e,this._texture.format,this._texture.invertY,null,this._texture.type)},t}(ke.a),Iw=function(i){function t(e,n,r,o){var u=i.call(this,e,n,r,o,!0)||this;return u.refractionPlane=new _s.a(0,1,0,1),u.depth=2,u.onBeforeRenderObservable.add(function(){r.clipPlane=u.refractionPlane}),u.onAfterRenderObservable.add(function(){r.clipPlane=null}),u}return Object(p.d)(t,i),t.prototype.clone=function(){var e=this.getScene();if(!e)return this;var n=this.getSize(),r=new t(this.name,n.width,e,this._generateMipMaps);return r.hasAlpha=this.hasAlpha,r.level=this.level,r.refractionPlane=this.refractionPlane.clone(),this.renderList&&(r.renderList=this.renderList.slice(0)),r.depth=this.depth,r},t.prototype.serialize=function(){if(!this.name)return null;var e=i.prototype.serialize.call(this);return e.mirrorPlane=this.refractionPlane.asArray(),e.depth=this.depth,e},t}(qn);(function(i){i[i.Vertex=1]="Vertex",i[i.Fragment=2]="Fragment",i[i.Neutral=4]="Neutral",i[i.VertexAndFragment=3]="VertexAndFragment"})(Me||(Me={})),function(i){i[i.Float=1]="Float",i[i.Int=2]="Int",i[i.Vector2=4]="Vector2",i[i.Vector3=8]="Vector3",i[i.Vector4=16]="Vector4",i[i.Color3=32]="Color3",i[i.Color4=64]="Color4",i[i.Matrix=128]="Matrix",i[i.Object=256]="Object",i[i.AutoDetect=1024]="AutoDetect",i[i.BasedOnInput=2048]="BasedOnInput"}(fe||(fe={})),function(i){i[i.Uniform=0]="Uniform",i[i.Attribute=1]="Attribute",i[i.Varying=2]="Varying",i[i.Undefined=3]="Undefined"}(cr||(cr={})),function(i){i[i.World=1]="World",i[i.View=2]="View",i[i.Projection=3]="Projection",i[i.ViewProjection=4]="ViewProjection",i[i.WorldView=5]="WorldView",i[i.WorldViewProjection=6]="WorldViewProjection",i[i.CameraPosition=7]="CameraPosition",i[i.FogColor=8]="FogColor",i[i.DeltaTime=9]="DeltaTime"}(Mt||(Mt={})),function(i){i[i.Material=0]="Material",i[i.PostProcess=1]="PostProcess",i[i.Particle=2]="Particle",i[i.ProceduralTexture=3]="ProceduralTexture"}(Dr||(Dr={})),function(i){i[i.Compatible=0]="Compatible",i[i.TypeIncompatible=1]="TypeIncompatible",i[i.TargetIncompatible=2]="TargetIncompatible"}(Ai||(Ai={})),function(i){i[i.Input=0]="Input",i[i.Output=1]="Output"}(yr||(yr={}));var Ch=function(){function i(t,e,n){this._connectedPoint=null,this._endpoints=new Array,this._typeConnectionSource=null,this._linkedConnectionSource=null,this._acceptedConnectionPointType=null,this._type=fe.Float,this._enforceAssociatedVariableName=!1,this.needDualDirectionValidation=!1,this.acceptedConnectionPointTypes=new Array,this.excludedConnectionPointTypes=new Array,this.onConnectionObservable=new S.c,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this._prioritizeVertex=!1,this._target=Me.VertexAndFragment,this._ownerBlock=e,this.name=t,this._direction=n}return i.AreEquivalentTypes=function(t,e){switch(t){case fe.Vector3:if(e===fe.Color3)return!0;break;case fe.Vector4:if(e===fe.Color4)return!0;break;case fe.Color3:if(e===fe.Vector3)return!0;break;case fe.Color4:if(e===fe.Vector4)return!0}return!1},Object.defineProperty(i.prototype,"direction",{get:function(){return this._direction},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"associatedVariableName",{get:function(){return this._ownerBlock.isInput?this._ownerBlock.associatedVariableName:this._enforceAssociatedVariableName&&this._associatedVariableName||!this._connectedPoint?this._associatedVariableName:this._connectedPoint.associatedVariableName},set:function(t){this._associatedVariableName=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"innerType",{get:function(){return this._linkedConnectionSource&&this._linkedConnectionSource.isConnected?this.type:this._type},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"type",{get:function(){if(this._type===fe.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource&&this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type}return this._type===fe.BasedOnInput&&this._typeConnectionSource?this._typeConnectionSource.type:this._type},set:function(t){this._type=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"target",{get:function(){return this._prioritizeVertex&&this._ownerBlock?this._target!==Me.VertexAndFragment?this._target:this._ownerBlock.target===Me.Fragment?Me.Fragment:Me.Vertex:this._target},set:function(t){this._target=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isConnected",{get:function(){return this.connectedPoint!==null||this.hasEndpoints},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isConnectedToInputBlock",{get:function(){return this.connectedPoint!==null&&this.connectedPoint.ownerBlock.isInput},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"connectInputBlock",{get:function(){return this.isConnectedToInputBlock?this.connectedPoint.ownerBlock:null},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"connectedPoint",{get:function(){return this._connectedPoint},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"ownerBlock",{get:function(){return this._ownerBlock},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"sourceBlock",{get:function(){return this._connectedPoint?this._connectedPoint.ownerBlock:null},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"connectedBlocks",{get:function(){return this._endpoints.length===0?[]:this._endpoints.map(function(t){return t.ownerBlock})},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"endpoints",{get:function(){return this._endpoints},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"hasEndpoints",{get:function(){return this._endpoints&&this._endpoints.length>0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isConnectedInVertexShader",{get:function(){if(this.target===Me.Vertex)return!0;if(!this.hasEndpoints)return!1;for(var t=0,e=this._endpoints;t<e.length;t++){var n=e[t];if(n.ownerBlock.target===Me.Vertex||n.target===Me.Vertex||(n.ownerBlock.target===Me.Neutral||n.ownerBlock.target===Me.VertexAndFragment)&&n.ownerBlock.outputs.some(function(r){return r.isConnectedInVertexShader}))return!0}return!1},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isConnectedInFragmentShader",{get:function(){if(this.target===Me.Fragment)return!0;if(!this.hasEndpoints)return!1;for(var t=0,e=this._endpoints;t<e.length;t++){var n=e[t];if(n.ownerBlock.target===Me.Fragment||(n.ownerBlock.target===Me.Neutral||n.ownerBlock.target===Me.VertexAndFragment)&&n.ownerBlock.outputs.some(function(r){return r.isConnectedInFragmentShader}))return!0}return!1},enumerable:!1,configurable:!0}),i.prototype.createCustomInputBlock=function(){return null},i.prototype.getClassName=function(){return"NodeMaterialConnectionPoint"},i.prototype.canConnectTo=function(t){return this.checkCompatibilityState(t)===Ai.Compatible},i.prototype.checkCompatibilityState=function(t){if(this._ownerBlock.target===Me.Fragment){var e=t.ownerBlock;if(e.target===Me.Vertex)return Ai.TargetIncompatible;for(var n=0,r=e.outputs;n<r.length;n++)if(r[n].isConnectedInVertexShader)return Ai.TargetIncompatible}return this.type!==t.type&&t.innerType!==fe.AutoDetect?i.AreEquivalentTypes(this.type,t.type)||t.acceptedConnectionPointTypes&&t.acceptedConnectionPointTypes.indexOf(this.type)!==-1||t._acceptedConnectionPointType&&i.AreEquivalentTypes(t._acceptedConnectionPointType.type,this.type)?Ai.Compatible:Ai.TypeIncompatible:t.excludedConnectionPointTypes&&t.excludedConnectionPointTypes.indexOf(this.type)!==-1?1:Ai.Compatible},i.prototype.connectTo=function(t,e){if(e===void 0&&(e=!1),!e&&!this.canConnectTo(t))throw"Cannot connect these two connectors.";return this._endpoints.push(t),t._connectedPoint=this,this._enforceAssociatedVariableName=!1,this.onConnectionObservable.notifyObservers(t),t.onConnectionObservable.notifyObservers(this),this},i.prototype.disconnectFrom=function(t){var e=this._endpoints.indexOf(t);return e===-1||(this._endpoints.splice(e,1),t._connectedPoint=null,this._enforceAssociatedVariableName=!1,t._enforceAssociatedVariableName=!1),this},i.prototype.serialize=function(t){t===void 0&&(t=!0);var e={};return e.name=this.name,e.displayName=this.displayName,t&&this.connectedPoint&&(e.inputName=this.name,e.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,e.targetConnectionName=this.connectedPoint.name,e.isExposedOnFrame=!0,e.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(e.isExposedOnFrame=!0,e.exposedPortPosition=this.exposedPortPosition),e},i.prototype.dispose=function(){this.onConnectionObservable.clear()},i}(),Dw=c(152),Et=function(){function i(t,e,n,r){e===void 0&&(e=Me.Vertex),n===void 0&&(n=!1),r===void 0&&(r=!1),this._isFinalMerger=!1,this._isInput=!1,this._name="",this._isUnique=!1,this.inputsAreExclusive=!1,this._codeVariableName="",this._inputs=new Array,this._outputs=new Array,this.comments="",this.visibleInInspector=!1,this._target=e,this._isFinalMerger=n,this._isInput=r,this._name=t,this.uniqueId=Dw.a.UniqueId}return Object.defineProperty(i.prototype,"name",{get:function(){return this._name},set:function(t){this.validateBlockName(t)&&(this._name=t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isUnique",{get:function(){return this._isUnique},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isFinalMerger",{get:function(){return this._isFinalMerger},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isInput",{get:function(){return this._isInput},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"buildId",{get:function(){return this._buildId},set:function(t){this._buildId=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"target",{get:function(){return this._target},set:function(t){(this._target&t)==0&&(this._target=t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"inputs",{get:function(){return this._inputs},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"outputs",{get:function(){return this._outputs},enumerable:!1,configurable:!0}),i.prototype.getInputByName=function(t){var e=this._inputs.filter(function(n){return n.name===t});return e.length?e[0]:null},i.prototype.getOutputByName=function(t){var e=this._outputs.filter(function(n){return n.name===t});return e.length?e[0]:null},i.prototype.initialize=function(t){},i.prototype.bind=function(t,e,n,r){},i.prototype._declareOutput=function(t,e){return e._getGLType(t.type)+" "+t.associatedVariableName},i.prototype._writeVariable=function(t){return t.connectedPoint?""+t.associatedVariableName:"0."},i.prototype._writeFloat=function(t){var e=t.toString();return e.indexOf(".")===-1&&(e+=".0"),""+e},i.prototype.getClassName=function(){return"NodeMaterialBlock"},i.prototype.registerInput=function(t,e,n,r,o){return n===void 0&&(n=!1),(o=o??new Ch(t,this,yr.Input)).type=e,o.isOptional=n,r&&(o.target=r),this._inputs.push(o),this},i.prototype.registerOutput=function(t,e,n,r){return(r=r??new Ch(t,this,yr.Output)).type=e,n&&(r.target=n),this._outputs.push(r),this},i.prototype.getFirstAvailableInput=function(t){t===void 0&&(t=null);for(var e=0,n=this._inputs;e<n.length;e++){var r=n[e];if(!(r.connectedPoint||t&&t.type!==r.type&&r.type!==fe.AutoDetect))return r}return null},i.prototype.getFirstAvailableOutput=function(t){t===void 0&&(t=null);for(var e=0,n=this._outputs;e<n.length;e++){var r=n[e];if(!t||!t.target||t.target===Me.Neutral||(t.target&r.target)!=0)return r}return null},i.prototype.getSiblingOutput=function(t){var e=this._outputs.indexOf(t);return e===-1||e>=this._outputs.length?null:this._outputs[e+1]},i.prototype.connectTo=function(t,e){if(this._outputs.length!==0){for(var n=e&&e.output?this.getOutputByName(e.output):this.getFirstAvailableOutput(t),r=!0;r;){var o=e&&e.input?t.getInputByName(e.input):t.getFirstAvailableInput(n);if(n&&o&&n.canConnectTo(o))n.connectTo(o),r=!1;else{if(!n)throw"Unable to find a compatible match";n=this.getSiblingOutput(n)}}return this}},i.prototype._buildBlock=function(t){},i.prototype.updateUniformsAndSamples=function(t,e,n,r){},i.prototype.provideFallbacks=function(t,e){},i.prototype.initializeDefines=function(t,e,n,r){},i.prototype.prepareDefines=function(t,e,n,r,o){},i.prototype.autoConfigure=function(t){},i.prototype.replaceRepeatableContent=function(t,e,n,r){},i.prototype.isReady=function(t,e,n,r){return!0},i.prototype._linkConnectionTypes=function(t,e,n){n===void 0&&(n=!1),n?this._inputs[e]._acceptedConnectionPointType=this._inputs[t]:this._inputs[t]._linkedConnectionSource=this._inputs[e],this._inputs[e]._linkedConnectionSource=this._inputs[t]},i.prototype._processBuild=function(t,e,n,r){t.build(e,r);var o=e._vertexState!=null,u=t._buildTarget===Me.Vertex&&t.target!==Me.VertexAndFragment;if(o&&((t.target&t._buildTarget)==0||(t.target&n.target)==0||this.target!==Me.VertexAndFragment&&u)&&(!t.isInput&&e.target!==t._buildTarget||t.isInput&&t.isAttribute&&!t._noContextSwitch)){var f=n.connectedPoint;e._vertexState._emitVaryingFromString("v_"+f.associatedVariableName,e._getGLType(f.type))&&(e._vertexState.compilationString+="v_"+f.associatedVariableName+" = "+f.associatedVariableName+`;\r
`),n.associatedVariableName="v_"+f.associatedVariableName,n._enforceAssociatedVariableName=!0}},i.prototype.validateBlockName=function(t){for(var e=0,n=["position","normal","tangent","particle_positionw","uv","uv2","position2d","particle_uv","matricesIndices","matricesWeights","world0","world1","world2","world3","particle_color","particle_texturemask"];e<n.length;e++)if(t===n[e])return!1;return!0},i.prototype.build=function(t,e){if(this._buildId===t.sharedData.buildId)return!0;if(!this.isInput)for(var n=0,r=this._outputs;n<r.length;n++)(D=r[n]).associatedVariableName||(D.associatedVariableName=t._getFreeVariableName(D.name));for(var o=0,u=this._inputs;o<u.length;o++){var f=u[o];if(f.connectedPoint){if(this.target!==Me.Neutral&&((f.target&this.target)==0||(f.target&t.target)==0))continue;(z=f.connectedPoint.ownerBlock)&&z!==this&&this._processBuild(z,t,f,e)}else f.isOptional||t.sharedData.checks.notConnectedNonOptionalInputs.push(f)}if(this._buildId===t.sharedData.buildId)return!0;if(t.sharedData.verbose&&console.log((t.target===Me.Vertex?"Vertex shader":"Fragment shader")+": Building "+this.name+" ["+this.getClassName()+"]"),this.isFinalMerger)switch(t.target){case Me.Vertex:t.sharedData.checks.emitVertex=!0;break;case Me.Fragment:t.sharedData.checks.emitFragment=!0}!this.isInput&&t.sharedData.emitComments&&(t.compilationString+=`\r
//`+this.name+`\r
`),this._buildBlock(t),this._buildId=t.sharedData.buildId,this._buildTarget=t.target;for(var v=0,y=this._outputs;v<y.length;v++){var D;if(((D=y[v]).target&t.target)!=0)for(var w=0,F=D.endpoints;w<F.length;w++){var z,k=F[w];(z=k.ownerBlock)&&(z.target&t.target)!=0&&e.indexOf(z)!==-1&&this._processBuild(z,t,k,e)}}return!1},i.prototype._inputRename=function(t){return t},i.prototype._outputRename=function(t){return t},i.prototype._dumpPropertiesCode=function(){return this._codeVariableName+".visibleInInspector = "+this.visibleInInspector+`;\r
`},i.prototype._dumpCode=function(t,e){var n;e.push(this);var r=this.name.replace(/[^A-Za-z_]+/g,"");if(this._codeVariableName=r||this.getClassName()+"_"+this.uniqueId,t.indexOf(this._codeVariableName)!==-1){var o=0;do o++,this._codeVariableName=r+o;while(t.indexOf(this._codeVariableName)!==-1)}t.push(this._codeVariableName),n=`\r
// `+this.getClassName()+`\r
`,this.comments&&(n+="// "+this.comments+`\r
`),n+="var "+this._codeVariableName+" = new BABYLON."+this.getClassName()+'("'+this.name+`");\r
`,n+=this._dumpPropertiesCode();for(var u=0,f=this.inputs;u<f.length;u++){var v=f[u];if(v.isConnected){var y=v.connectedPoint.ownerBlock;e.indexOf(y)===-1&&(n+=y._dumpCode(t,e))}}for(var D=0,w=this.outputs;D<w.length;D++){var F=w[D];if(F.hasEndpoints)for(var z=0,k=F.endpoints;z<k.length;z++)(y=k[z].ownerBlock)&&e.indexOf(y)===-1&&(n+=y._dumpCode(t,e))}return n},i.prototype._dumpCodeForOutputConnections=function(t){var e="";if(t.indexOf(this)!==-1)return e;t.push(this);for(var n=0,r=this.inputs;n<r.length;n++){var o=r[n];if(o.isConnected){var u=o.connectedPoint,f=u.ownerBlock;e+=f._dumpCodeForOutputConnections(t),e+=f._codeVariableName+"."+f._outputRename(u.name)+".connectTo("+this._codeVariableName+"."+this._inputRename(o.name)+`);\r
`}}return e},i.prototype.clone=function(t,e){e===void 0&&(e="");var n=this.serialize(),r=C.a.GetClass(n.customType);if(r){var o=new r;return o._deserialize(n,t,e),o}return null},i.prototype.serialize=function(){var t={};t.customType="BABYLON."+this.getClassName(),t.id=this.uniqueId,t.name=this.name,t.comments=this.comments,t.visibleInInspector=this.visibleInInspector,t.inputs=[],t.outputs=[];for(var e=0,n=this.inputs;e<n.length;e++){var r=n[e];t.inputs.push(r.serialize())}for(var o=0,u=this.outputs;o<u.length;o++){var f=u[o];t.outputs.push(f.serialize(!1))}return t},i.prototype._deserialize=function(t,e,n){this.name=t.name,this.comments=t.comments,this.visibleInInspector=!!t.visibleInInspector,this._deserializePortDisplayNamesAndExposedOnFrame(t)},i.prototype._deserializePortDisplayNamesAndExposedOnFrame=function(t){var e=this,n=t.inputs,r=t.outputs;n&&n.forEach(function(o,u){o.displayName&&(e.inputs[u].displayName=o.displayName),o.isExposedOnFrame&&(e.inputs[u].isExposedOnFrame=o.isExposedOnFrame,e.inputs[u].exposedPortPosition=o.exposedPortPosition)}),r&&r.forEach(function(o,u){o.displayName&&(e.outputs[u].displayName=o.displayName),o.isExposedOnFrame&&(e.outputs[u].isExposedOnFrame=o.isExposedOnFrame,e.outputs[u].exposedPortPosition=o.exposedPortPosition)})},i.prototype.dispose=function(){for(var t=0,e=this.inputs;t<e.length;t++)e[t].dispose();for(var n=0,r=this.outputs;n<r.length;n++)r[n].dispose()},i}(),q0=function(){function i(){this.supportUniformBuffers=!1,this.attributes=new Array,this.uniforms=new Array,this.constants=new Array,this.samplers=new Array,this.functions={},this.extensions={},this.counters={},this._attributeDeclaration="",this._uniformDeclaration="",this._constantDeclaration="",this._samplerDeclaration="",this._varyingTransfer="",this._injectAtEnd="",this._repeatableContentAnchorIndex=0,this._builtCompilationString="",this.compilationString=""}return i.prototype.finalize=function(t){var e=t.sharedData.emitComments,n=this.target===Me.Fragment;this.compilationString=`\r
`+(e?`//Entry point\r
`:"")+`void main(void) {\r
`+this.compilationString,this._constantDeclaration&&(this.compilationString=`\r
`+(e?`//Constants\r
`:"")+this._constantDeclaration+`\r
`+this.compilationString);var r="";for(var o in this.functions)r+=this.functions[o]+`\r
`;for(var u in this.compilationString=`\r
`+r+`\r
`+this.compilationString,!n&&this._varyingTransfer&&(this.compilationString=this.compilationString+`\r
`+this._varyingTransfer),this._injectAtEnd&&(this.compilationString=this.compilationString+`\r
`+this._injectAtEnd),this.compilationString=this.compilationString+`\r
}`,this.sharedData.varyingDeclaration&&(this.compilationString=`\r
`+(e?`//Varyings\r
`:"")+this.sharedData.varyingDeclaration+`\r
`+this.compilationString),this._samplerDeclaration&&(this.compilationString=`\r
`+(e?`//Samplers\r
`:"")+this._samplerDeclaration+`\r
`+this.compilationString),this._uniformDeclaration&&(this.compilationString=`\r
`+(e?`//Uniforms\r
`:"")+this._uniformDeclaration+`\r
`+this.compilationString),this._attributeDeclaration&&!n&&(this.compilationString=`\r
`+(e?`//Attributes\r
`:"")+this._attributeDeclaration+`\r
`+this.compilationString),this.compilationString=`precision highp float;\r
`+this.compilationString,this.extensions){var f=this.extensions[u];this.compilationString=`\r
`+f+`\r
`+this.compilationString}this._builtCompilationString=this.compilationString},Object.defineProperty(i.prototype,"_repeatableContentAnchor",{get:function(){return"###___ANCHOR"+this._repeatableContentAnchorIndex+++"___###"},enumerable:!1,configurable:!0}),i.prototype._getFreeVariableName=function(t){return t=t.replace(/[^a-zA-Z_]+/g,""),this.sharedData.variableNames[t]===void 0?(this.sharedData.variableNames[t]=0,t==="output"||t==="texture"?t+this.sharedData.variableNames[t]:t):(this.sharedData.variableNames[t]++,t+this.sharedData.variableNames[t])},i.prototype._getFreeDefineName=function(t){return this.sharedData.defineNames[t]===void 0?this.sharedData.defineNames[t]=0:this.sharedData.defineNames[t]++,t+this.sharedData.defineNames[t]},i.prototype._excludeVariableName=function(t){this.sharedData.variableNames[t]=0},i.prototype._emit2DSampler=function(t){this.samplers.indexOf(t)<0&&(this._samplerDeclaration+="uniform sampler2D "+t+`;\r
`,this.samplers.push(t))},i.prototype._getGLType=function(t){switch(t){case fe.Float:return"float";case fe.Int:return"int";case fe.Vector2:return"vec2";case fe.Color3:case fe.Vector3:return"vec3";case fe.Color4:case fe.Vector4:return"vec4";case fe.Matrix:return"mat4"}return""},i.prototype._emitExtension=function(t,e,n){n===void 0&&(n=""),this.extensions[t]||(n&&(e="#if "+n+`\r
`+e+`\r
#endif`),this.extensions[t]=e)},i.prototype._emitFunction=function(t,e,n){this.functions[t]||(this.sharedData.emitComments&&(e=n+`\r
`+e),this.functions[t]=e)},i.prototype._emitCodeFromInclude=function(t,e,n){if(n&&n.repeatKey)return"#include<"+t+">[0.."+n.repeatKey+`]\r
`;var r=Ye.a.IncludesShadersStore[t]+`\r
`;if(this.sharedData.emitComments&&(r=e+`\r
`+r),!n)return r;if(n.replaceStrings)for(var o=0;o<n.replaceStrings.length;o++){var u=n.replaceStrings[o];r=r.replace(u.search,u.replace)}return r},i.prototype._emitFunctionFromInclude=function(t,e,n,r){r===void 0&&(r="");var o=t+r;if(!this.functions[o]){if(!(n&&(n.removeAttributes||n.removeUniforms||n.removeVaryings||n.removeIfDef||n.replaceStrings)))return n&&n.repeatKey?this.functions[o]="#include<"+t+">[0.."+n.repeatKey+`]\r
`:this.functions[o]="#include<"+t+`>\r
`,void(this.sharedData.emitComments&&(this.functions[o]=e+`\r
`+this.functions[o]));if(this.functions[o]=Ye.a.IncludesShadersStore[t],this.sharedData.emitComments&&(this.functions[o]=e+`\r
`+this.functions[o]),n.removeIfDef&&(this.functions[o]=this.functions[o].replace(/^\s*?#ifdef.+$/gm,""),this.functions[o]=this.functions[o].replace(/^\s*?#endif.*$/gm,""),this.functions[o]=this.functions[o].replace(/^\s*?#else.*$/gm,""),this.functions[o]=this.functions[o].replace(/^\s*?#elif.*$/gm,"")),n.removeAttributes&&(this.functions[o]=this.functions[o].replace(/^\s*?attribute.+$/gm,"")),n.removeUniforms&&(this.functions[o]=this.functions[o].replace(/^\s*?uniform.+$/gm,"")),n.removeVaryings&&(this.functions[o]=this.functions[o].replace(/^\s*?varying.+$/gm,"")),n.replaceStrings)for(var u=0;u<n.replaceStrings.length;u++){var f=n.replaceStrings[u];this.functions[o]=this.functions[o].replace(f.search,f.replace)}}},i.prototype._registerTempVariable=function(t){return this.sharedData.temps.indexOf(t)===-1&&(this.sharedData.temps.push(t),!0)},i.prototype._emitVaryingFromString=function(t,e,n,r){return n===void 0&&(n=""),r===void 0&&(r=!1),this.sharedData.varyings.indexOf(t)===-1&&(this.sharedData.varyings.push(t),n&&(ui.a.StartsWith(n,"defined(")?this.sharedData.varyingDeclaration+="#if "+n+`\r
`:this.sharedData.varyingDeclaration+=(r?"#ifndef":"#ifdef")+" "+n+`\r
`),this.sharedData.varyingDeclaration+="varying "+e+" "+t+`;\r
`,n&&(this.sharedData.varyingDeclaration+=`#endif\r
`),!0)},i.prototype._emitUniformFromString=function(t,e,n,r){n===void 0&&(n=""),r===void 0&&(r=!1),this.uniforms.indexOf(t)===-1&&(this.uniforms.push(t),n&&(ui.a.StartsWith(n,"defined(")?this._uniformDeclaration+="#if "+n+`\r
`:this._uniformDeclaration+=(r?"#ifndef":"#ifdef")+" "+n+`\r
`),this._uniformDeclaration+="uniform "+e+" "+t+`;\r
`,n&&(this._uniformDeclaration+=`#endif\r
`))},i.prototype._emitFloat=function(t){return t.toString()===t.toFixed(0)?t+".0":t.toString()},i}(),ww=function(){function i(){this.temps=new Array,this.varyings=new Array,this.varyingDeclaration="",this.inputBlocks=new Array,this.textureBlocks=new Array,this.bindableBlocks=new Array,this.blocksWithFallbacks=new Array,this.blocksWithDefines=new Array,this.repeatableContentBlocks=new Array,this.dynamicUniformBlocks=new Array,this.blockingBlocks=new Array,this.animatedInputs=new Array,this.variableNames={},this.defineNames={},this.hints={needWorldViewMatrix:!1,needWorldViewProjectionMatrix:!1,needAlphaBlending:!1,needAlphaTesting:!1},this.checks={emitVertex:!1,emitFragment:!1,notConnectedNonOptionalInputs:new Array},this.allowEmptyVertexProgram=!1,this.variableNames.position=0,this.variableNames.normal=0,this.variableNames.tangent=0,this.variableNames.uv=0,this.variableNames.uv2=0,this.variableNames.uv3=0,this.variableNames.uv4=0,this.variableNames.uv4=0,this.variableNames.uv5=0,this.variableNames.uv6=0,this.variableNames.color=0,this.variableNames.matricesIndices=0,this.variableNames.matricesWeights=0,this.variableNames.matricesIndicesExtra=0,this.variableNames.matricesWeightsExtra=0,this.variableNames.diffuseBase=0,this.variableNames.specularBase=0,this.variableNames.worldPos=0,this.variableNames.shadow=0,this.variableNames.view=0,this.variableNames.vTBN=0,this.defineNames.MAINUV0=0,this.defineNames.MAINUV1=0,this.defineNames.MAINUV2=0,this.defineNames.MAINUV3=0,this.defineNames.MAINUV4=0,this.defineNames.MAINUV5=0,this.defineNames.MAINUV6=0,this.defineNames.MAINUV7=0}return i.prototype.emitErrors=function(){var t="";this.checks.emitVertex||this.allowEmptyVertexProgram||(t+=`NodeMaterial does not have a vertex output. You need to at least add a block that generates a glPosition value.\r
`),this.checks.emitFragment||(t+=`NodeMaterial does not have a fragment output. You need to at least add a block that generates a glFragColor value.\r
`);for(var e=0,n=this.checks.notConnectedNonOptionalInputs;e<n.length;e++){var r=n[e];t+="input "+r.name+" from block "+r.ownerBlock.name+"["+r.ownerBlock.getClassName()+`] is not connected and is not optional.\r
`}if(t)throw`Build of NodeMaterial failed:\r
`+t},i}(),Rh=function(i){function t(e){var n=i.call(this,e,Me.Vertex)||this;return n.complementW=1,n.complementZ=0,n.registerInput("vector",fe.AutoDetect),n.registerInput("transform",fe.Matrix),n.registerOutput("output",fe.Vector4),n.registerOutput("xyz",fe.Vector3),n._inputs[0].onConnectionObservable.add(function(r){if(r.ownerBlock.isInput){var o=r.ownerBlock;o.name!=="normal"&&o.name!=="tangent"||(n.complementW=0)}}),n}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"TransformBlock"},Object.defineProperty(t.prototype,"vector",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"xyz",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"transform",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this.vector,r=this.transform;if(n.connectedPoint){if(this.complementW===0){var o="//"+this.name;e._emitFunctionFromInclude("helperFunctions",o),e.sharedData.blocksWithDefines.push(this);var u=e._getFreeVariableName(r.associatedVariableName+"_NUS");switch(e.compilationString+="mat3 "+u+" = mat3("+r.associatedVariableName+`);\r
`,e.compilationString+=`#ifdef NONUNIFORMSCALING\r
`,e.compilationString+=u+" = transposeMat3(inverseMat3("+u+`));\r
`,e.compilationString+=`#endif\r
`,n.connectedPoint.type){case fe.Vector2:e.compilationString+=this._declareOutput(this.output,e)+" = vec4("+u+" * vec3("+n.associatedVariableName+", "+this._writeFloat(this.complementZ)+"), "+this._writeFloat(this.complementW)+`);\r
`;break;case fe.Vector3:case fe.Color3:e.compilationString+=this._declareOutput(this.output,e)+" = vec4("+u+" * "+n.associatedVariableName+", "+this._writeFloat(this.complementW)+`);\r
`;break;default:e.compilationString+=this._declareOutput(this.output,e)+" = vec4("+u+" * "+n.associatedVariableName+".xyz, "+this._writeFloat(this.complementW)+`);\r
`}}else switch(u=r.associatedVariableName,n.connectedPoint.type){case fe.Vector2:e.compilationString+=this._declareOutput(this.output,e)+" = "+u+" * vec4("+n.associatedVariableName+", "+this._writeFloat(this.complementZ)+", "+this._writeFloat(this.complementW)+`);\r
`;break;case fe.Vector3:case fe.Color3:e.compilationString+=this._declareOutput(this.output,e)+" = "+u+" * vec4("+n.associatedVariableName+", "+this._writeFloat(this.complementW)+`);\r
`;break;default:e.compilationString+=this._declareOutput(this.output,e)+" = "+u+" * "+n.associatedVariableName+`;\r
`}this.xyz.hasEndpoints&&(e.compilationString+=this._declareOutput(this.xyz,e)+" = "+this.output.associatedVariableName+`.xyz;\r
`)}return this},t.prototype.prepareDefines=function(e,n,r,o,u){e.nonUniformScaling&&r.setValue("NONUNIFORMSCALING",!0)},t.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return e.complementZ=this.complementZ,e.complementW=this.complementW,e},t.prototype._deserialize=function(e,n,r){i.prototype._deserialize.call(this,e,n,r),this.complementZ=e.complementZ!==void 0?e.complementZ:0,this.complementW=e.complementW!==void 0?e.complementW:1},t.prototype._dumpPropertiesCode=function(){var e=this._codeVariableName+".complementZ = "+this.complementZ+`;\r
`;return e+=this._codeVariableName+".complementW = "+this.complementW+`;\r
`},t}(Et);C.a.RegisteredTypes["BABYLON.TransformBlock"]=Rh;var pl=function(i){function t(e){var n=i.call(this,e,Me.Vertex,!0)||this;return n.registerInput("vector",fe.Vector4),n}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"VertexOutputBlock"},Object.defineProperty(t.prototype,"vector",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this.vector;return e.compilationString+="gl_Position = "+n.associatedVariableName+`;\r
`,this},t}(Et);C.a.RegisteredTypes["BABYLON.VertexOutputBlock"]=pl;var Ko,Is=function(i){function t(e){var n=i.call(this,e,Me.Fragment,!0)||this;return n.registerInput("rgba",fe.Color4,!0),n.registerInput("rgb",fe.Color3,!0),n.registerInput("a",fe.Float,!0),n.rgb.acceptedConnectionPointTypes.push(fe.Float),n}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"FragmentOutputBlock"},Object.defineProperty(t.prototype,"rgba",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rgb",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"a",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this.rgba,r=this.rgb,o=this.a;if(e.sharedData.hints.needAlphaBlending=n.isConnected||o.isConnected,n.connectedPoint)o.isConnected?e.compilationString+="gl_FragColor = vec4("+n.associatedVariableName+".rgb, "+o.associatedVariableName+`);\r
`:e.compilationString+="gl_FragColor = "+n.associatedVariableName+`;\r
`;else if(r.connectedPoint){var u="1.0";o.connectedPoint&&(u=o.associatedVariableName),r.connectedPoint.type===fe.Float?e.compilationString+="gl_FragColor = vec4("+r.associatedVariableName+", "+r.associatedVariableName+", "+r.associatedVariableName+", "+u+`);\r
`:e.compilationString+="gl_FragColor = vec4("+r.associatedVariableName+", "+u+`);\r
`}else e.sharedData.checks.notConnectedNonOptionalInputs.push(n);return this},t}(Et);C.a.RegisteredTypes["BABYLON.FragmentOutputBlock"]=Is,function(i){i[i.None=0]="None",i[i.Time=1]="Time"}(Ko||(Ko={}));var Lw={position2d:"position",particle_uv:"vUV",particle_color:"vColor",particle_texturemask:"textureMask",particle_positionw:"vPositionW"},gm={particle_uv:!0,particle_color:!0,particle_texturemask:!0,particle_positionw:!0},Z0={particle_texturemask:!0},Bt=function(i){function t(e,n,r){n===void 0&&(n=Me.Vertex),r===void 0&&(r=fe.AutoDetect);var o=i.call(this,e,n,!1,!0)||this;return o._mode=cr.Undefined,o._animationType=Ko.None,o.min=0,o.max=0,o.isBoolean=!1,o.matrixMode=0,o._systemValue=null,o.isConstant=!1,o.groupInInspector="",o.onValueChangedObservable=new S.c,o.convertToGammaSpace=!1,o.convertToLinearSpace=!1,o._type=r,o.setDefaultValue(),o.registerOutput("output",r),o}return Object(p.d)(t,i),Object.defineProperty(t.prototype,"type",{get:function(){if(this._type===fe.AutoDetect){if(this.isUniform&&this.value!=null){if(!isNaN(this.value))return this._type=fe.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=fe.Vector2,this._type;case"Vector3":return this._type=fe.Vector3,this._type;case"Vector4":return this._type=fe.Vector4,this._type;case"Color3":return this._type=fe.Color3,this._type;case"Color4":return this._type=fe.Color4,this._type;case"Matrix":return this._type=fe.Matrix,this._type}}if(this.isAttribute)switch(this.name){case"position":case"normal":case"tangent":case"particle_positionw":return this._type=fe.Vector3,this._type;case"uv":case"uv2":case"position2d":case"particle_uv":return this._type=fe.Vector2,this._type;case"matricesIndices":case"matricesWeights":case"world0":case"world1":case"world2":case"world3":return this._type=fe.Vector4,this._type;case"color":case"particle_color":case"particle_texturemask":return this._type=fe.Color4,this._type}if(this.isSystemValue)switch(this._systemValue){case Mt.World:case Mt.WorldView:case Mt.WorldViewProjection:case Mt.View:case Mt.ViewProjection:case Mt.Projection:return this._type=fe.Matrix,this._type;case Mt.CameraPosition:return this._type=fe.Vector3,this._type;case Mt.FogColor:return this._type=fe.Color3,this._type;case Mt.DeltaTime:return this._type=fe.Float,this._type}}return this._type},enumerable:!1,configurable:!0}),t.prototype.validateBlockName=function(e){return!!this.isAttribute||i.prototype.validateBlockName.call(this,e)},Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype.setAsAttribute=function(e){return this._mode=cr.Attribute,e&&(this.name=e),this},t.prototype.setAsSystemValue=function(e){return this.systemValue=e,this},Object.defineProperty(t.prototype,"value",{get:function(){return this._storedValue},set:function(e){this.type===fe.Float&&(this.isBoolean?e=e?1:0:this.min!==this.max&&(e=Math.max(this.min,e),e=Math.min(this.max,e))),this._storedValue=e,this._mode=cr.Uniform,this.onValueChangedObservable.notifyObservers(this)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"valueCallback",{get:function(){return this._valueCallback},set:function(e){this._valueCallback=e,this._mode=cr.Uniform},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"associatedVariableName",{get:function(){return this._associatedVariableName},set:function(e){this._associatedVariableName=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"animationType",{get:function(){return this._animationType},set:function(e){this._animationType=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isUndefined",{get:function(){return this._mode===cr.Undefined},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isUniform",{get:function(){return this._mode===cr.Uniform},set:function(e){this._mode=e?cr.Uniform:cr.Undefined,this.associatedVariableName=""},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isAttribute",{get:function(){return this._mode===cr.Attribute},set:function(e){this._mode=e?cr.Attribute:cr.Undefined,this.associatedVariableName=""},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isVarying",{get:function(){return this._mode===cr.Varying},set:function(e){this._mode=e?cr.Varying:cr.Undefined,this.associatedVariableName=""},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isSystemValue",{get:function(){return this._systemValue!=null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"systemValue",{get:function(){return this._systemValue},set:function(e){this._mode=cr.Uniform,this.associatedVariableName="",this._systemValue=e},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"InputBlock"},t.prototype.animate=function(e){switch(this._animationType){case Ko.Time:this.type===fe.Float&&(this.value+=.01*e.getAnimationRatio())}},t.prototype._emitDefine=function(e){return e[0]==="!"?"#ifndef "+e.substring(1)+`\r
`:"#ifdef "+e+`\r
`},t.prototype.initialize=function(e){this.associatedVariableName=""},t.prototype.setDefaultValue=function(){switch(this.type){case fe.Float:this.value=0;break;case fe.Vector2:this.value=d.d.Zero();break;case fe.Vector3:this.value=d.e.Zero();break;case fe.Vector4:this.value=d.f.Zero();break;case fe.Color3:this.value=M.a.White();break;case fe.Color4:this.value=new M.b(1,1,1,1);break;case fe.Matrix:this.value=d.a.Identity()}},t.prototype._emitConstant=function(e){switch(this.type){case fe.Float:return""+e._emitFloat(this.value);case fe.Vector2:return"vec2("+this.value.x+", "+this.value.y+")";case fe.Vector3:return"vec3("+this.value.x+", "+this.value.y+", "+this.value.z+")";case fe.Vector4:return"vec4("+this.value.x+", "+this.value.y+", "+this.value.z+", "+this.value.w+")";case fe.Color3:return M.c.Color3[0].set(this.value.r,this.value.g,this.value.b),this.convertToGammaSpace&&M.c.Color3[0].toGammaSpaceToRef(M.c.Color3[0]),this.convertToLinearSpace&&M.c.Color3[0].toLinearSpaceToRef(M.c.Color3[0]),"vec3("+M.c.Color3[0].r+", "+M.c.Color3[0].g+", "+M.c.Color3[0].b+")";case fe.Color4:return M.c.Color4[0].set(this.value.r,this.value.g,this.value.b,this.value.a),this.convertToGammaSpace&&M.c.Color4[0].toGammaSpaceToRef(M.c.Color4[0]),this.convertToLinearSpace&&M.c.Color4[0].toLinearSpaceToRef(M.c.Color4[0]),"vec4("+M.c.Color4[0].r+", "+M.c.Color4[0].g+", "+M.c.Color4[0].b+", "+M.c.Color4[0].a+")"}return""},Object.defineProperty(t.prototype,"_noContextSwitch",{get:function(){return gm[this.name]},enumerable:!1,configurable:!0}),t.prototype._emit=function(e,n){var r;if(this.isUniform){if(this.associatedVariableName||(this.associatedVariableName=e._getFreeVariableName("u_"+this.name)),this.isConstant)return e.constants.indexOf(this.associatedVariableName)!==-1?void 0:(e.constants.push(this.associatedVariableName),void(e._constantDeclaration+=this._declareOutput(this.output,e)+" = "+this._emitConstant(e)+`;\r
`));if(e.uniforms.indexOf(this.associatedVariableName)!==-1)return;e.uniforms.push(this.associatedVariableName),n&&(e._uniformDeclaration+=this._emitDefine(n)),e._uniformDeclaration+="uniform "+e._getGLType(this.type)+" "+this.associatedVariableName+`;\r
`,n&&(e._uniformDeclaration+=`#endif\r
`);var o=e.sharedData.hints;if(this._systemValue!==null&&this._systemValue!==void 0)switch(this._systemValue){case Mt.WorldView:o.needWorldViewMatrix=!0;break;case Mt.WorldViewProjection:o.needWorldViewProjectionMatrix=!0}else this._animationType!==Ko.None&&e.sharedData.animatedInputs.push(this)}else if(this.isAttribute){if(this.associatedVariableName=(r=Lw[this.name])!==null&&r!==void 0?r:this.name,this.target===Me.Vertex&&e._vertexState)return void(gm[this.name]?Z0[this.name]?e._emitUniformFromString(this.associatedVariableName,e._getGLType(this.type),n):e._emitVaryingFromString(this.associatedVariableName,e._getGLType(this.type),n):this._emit(e._vertexState,n));if(e.attributes.indexOf(this.associatedVariableName)!==-1)return;e.attributes.push(this.associatedVariableName),gm[this.name]?Z0[this.name]?e._emitUniformFromString(this.associatedVariableName,e._getGLType(this.type),n):e._emitVaryingFromString(this.associatedVariableName,e._getGLType(this.type),n):(n&&(e._attributeDeclaration+=this._emitDefine(n)),e._attributeDeclaration+="attribute "+e._getGLType(this.type)+" "+this.associatedVariableName+`;\r
`,n&&(e._attributeDeclaration+=`#endif\r
`))}},t.prototype._transmitWorld=function(e,n,r,o){if(this._systemValue){var u=this.associatedVariableName;switch(this._systemValue){case Mt.World:e.setMatrix(u,n);break;case Mt.WorldView:e.setMatrix(u,r);break;case Mt.WorldViewProjection:e.setMatrix(u,o)}}},t.prototype._transmit=function(e,n){if(!this.isAttribute){var r=this.associatedVariableName;if(this._systemValue)switch(this._systemValue){case Mt.World:case Mt.WorldView:case Mt.WorldViewProjection:return;case Mt.View:e.setMatrix(r,n.getViewMatrix());break;case Mt.Projection:e.setMatrix(r,n.getProjectionMatrix());break;case Mt.ViewProjection:e.setMatrix(r,n.getTransformMatrix());break;case Mt.CameraPosition:lt.a.BindEyePosition(e,n,r);break;case Mt.FogColor:e.setColor3(r,n.fogColor);break;case Mt.DeltaTime:e.setFloat(r,n.deltaTime/1e3)}else{var o=this._valueCallback?this._valueCallback():this._storedValue;if(o!==null)switch(this.type){case fe.Float:e.setFloat(r,o);break;case fe.Int:e.setInt(r,o);break;case fe.Color3:M.c.Color3[0].set(this.value.r,this.value.g,this.value.b),this.convertToGammaSpace&&M.c.Color3[0].toGammaSpaceToRef(M.c.Color3[0]),this.convertToLinearSpace&&M.c.Color3[0].toLinearSpaceToRef(M.c.Color3[0]),e.setColor3(r,M.c.Color3[0]);break;case fe.Color4:M.c.Color4[0].set(this.value.r,this.value.g,this.value.b,this.value.a),this.convertToGammaSpace&&M.c.Color4[0].toGammaSpaceToRef(M.c.Color4[0]),this.convertToLinearSpace&&M.c.Color4[0].toLinearSpaceToRef(M.c.Color4[0]),e.setDirectColor4(r,M.c.Color4[0]);break;case fe.Vector2:e.setVector2(r,o);break;case fe.Vector3:e.setVector3(r,o);break;case fe.Vector4:e.setVector4(r,o);break;case fe.Matrix:e.setMatrix(r,o)}}}},t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e),(this.isUniform||this.isSystemValue)&&e.sharedData.inputBlocks.push(this),this._emit(e)},t.prototype._dumpPropertiesCode=function(){var e=this._codeVariableName;if(this.isAttribute)return e+'.setAsAttribute("'+this.name+`");\r
`;if(this.isSystemValue)return e+".setAsSystemValue(BABYLON.NodeMaterialSystemValues."+Mt[this._systemValue]+`);\r
`;if(this.isUniform){var n=[],r="";switch(this.type){case fe.Float:r=""+this.value;break;case fe.Vector2:r="new BABYLON.Vector2("+this.value.x+", "+this.value.y+")";break;case fe.Vector3:r="new BABYLON.Vector3("+this.value.x+", "+this.value.y+", "+this.value.z+")";break;case fe.Vector4:r="new BABYLON.Vector4("+this.value.x+", "+this.value.y+", "+this.value.z+", "+this.value.w+")";break;case fe.Color3:r="new BABYLON.Color3("+this.value.r+", "+this.value.g+", "+this.value.b+")",this.convertToGammaSpace&&(r+=".toGammaSpace()"),this.convertToLinearSpace&&(r+=".toLinearSpace()");break;case fe.Color4:r="new BABYLON.Color4("+this.value.r+", "+this.value.g+", "+this.value.b+", "+this.value.a+")",this.convertToGammaSpace&&(r+=".toGammaSpace()"),this.convertToLinearSpace&&(r+=".toLinearSpace()");break;case fe.Matrix:r="BABYLON.Matrix.FromArray(["+this.value.m+"])"}return n.push(e+".value = "+r),this.type===fe.Float&&n.push(e+".min = "+this.min,e+".max = "+this.max,e+".isBoolean = "+this.isBoolean,e+".matrixMode = "+this.matrixMode,e+".animationType = BABYLON.AnimatedInputBlockTypes."+Ko[this.animationType]),n.push(e+".isConstant = "+this.isConstant),n.push(""),n.join(`;\r
`)}return""},t.prototype.dispose=function(){this.onValueChangedObservable.clear(),i.prototype.dispose.call(this)},t.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return e.type=this.type,e.mode=this._mode,e.systemValue=this._systemValue,e.animationType=this._animationType,e.min=this.min,e.max=this.max,e.isBoolean=this.isBoolean,e.matrixMode=this.matrixMode,e.isConstant=this.isConstant,e.groupInInspector=this.groupInInspector,e.convertToGammaSpace=this.convertToGammaSpace,e.convertToLinearSpace=this.convertToLinearSpace,this._storedValue!=null&&this._mode===cr.Uniform&&(this._storedValue.asArray?(e.valueType="BABYLON."+this._storedValue.getClassName(),e.value=this._storedValue.asArray()):(e.valueType="number",e.value=this._storedValue)),e},t.prototype._deserialize=function(e,n,r){if(this._mode=e.mode,i.prototype._deserialize.call(this,e,n,r),this._type=e.type,this._systemValue=e.systemValue||e.wellKnownValue,this._animationType=e.animationType,this.min=e.min||0,this.max=e.max||0,this.isBoolean=!!e.isBoolean,this.matrixMode=e.matrixMode||0,this.isConstant=!!e.isConstant,this.groupInInspector=e.groupInInspector||"",this.convertToGammaSpace=!!e.convertToGammaSpace,this.convertToLinearSpace=!!e.convertToLinearSpace,e.valueType)if(e.valueType==="number")this._storedValue=e.value;else{var o=C.a.GetClass(e.valueType);o&&(this._storedValue=o.FromArray(e.value))}},t}(Et);C.a.RegisteredTypes["BABYLON.InputBlock"]=Bt;var vm=function(i){function t(e){var n=i.call(this,e,Me.VertexAndFragment)||this;return n._samplerName="textureSampler",n.convertToGammaSpace=!1,n.convertToLinearSpace=!1,n._isUnique=!1,n.registerInput("uv",fe.Vector2,!1,Me.VertexAndFragment),n.registerOutput("rgba",fe.Color4,Me.Neutral),n.registerOutput("rgb",fe.Color3,Me.Neutral),n.registerOutput("r",fe.Float,Me.Neutral),n.registerOutput("g",fe.Float,Me.Neutral),n.registerOutput("b",fe.Float,Me.Neutral),n.registerOutput("a",fe.Float,Me.Neutral),n._inputs[0].acceptedConnectionPointTypes.push(fe.Vector3),n._inputs[0].acceptedConnectionPointTypes.push(fe.Vector4),n._inputs[0]._prioritizeVertex=!1,n}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"CurrentScreenBlock"},Object.defineProperty(t.prototype,"uv",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rgba",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rgb",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"r",{get:function(){return this._outputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"g",{get:function(){return this._outputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"b",{get:function(){return this._outputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"a",{get:function(){return this._outputs[5]},enumerable:!1,configurable:!0}),t.prototype.initialize=function(e){e._excludeVariableName("textureSampler")},Object.defineProperty(t.prototype,"target",{get:function(){return this.uv.isConnected?this.uv.sourceBlock.isInput?Me.VertexAndFragment:Me.Fragment:Me.VertexAndFragment},enumerable:!1,configurable:!0}),t.prototype.prepareDefines=function(e,n,r){r.setValue(this._linearDefineName,this.convertToGammaSpace,!0),r.setValue(this._gammaDefineName,this.convertToLinearSpace,!0)},t.prototype.isReady=function(){return!(this.texture&&!this.texture.isReadyOrNotBlocking())},t.prototype._injectVertexCode=function(e){var n=this.uv;if(n.connectedPoint.ownerBlock.isInput&&(n.connectedPoint.ownerBlock.isAttribute||e._emitUniformFromString(n.associatedVariableName,"vec2")),this._mainUVName="vMain"+n.associatedVariableName,e._emitVaryingFromString(this._mainUVName,"vec2"),e.compilationString+=this._mainUVName+" = "+n.associatedVariableName+`.xy;\r
`,this._outputs.some(function(f){return f.isConnectedInVertexShader})){this._writeTextureRead(e,!0);for(var r=0,o=this._outputs;r<o.length;r++){var u=o[r];u.hasEndpoints&&this._writeOutput(e,u,u.name,!0)}}},t.prototype._writeTextureRead=function(e,n){n===void 0&&(n=!1);var r=this.uv;if(n){if(e.target===Me.Fragment)return;e.compilationString+="vec4 "+this._tempTextureRead+" = texture2D("+this._samplerName+", "+r.associatedVariableName+`);\r
`}else this.uv.ownerBlock.target!==Me.Fragment?e.compilationString+="vec4 "+this._tempTextureRead+" = texture2D("+this._samplerName+", "+this._mainUVName+`);\r
`:e.compilationString+="vec4 "+this._tempTextureRead+" = texture2D("+this._samplerName+", "+r.associatedVariableName+`);\r
`},t.prototype._writeOutput=function(e,n,r,o){if(o===void 0&&(o=!1),o){if(e.target===Me.Fragment)return;e.compilationString+=this._declareOutput(n,e)+" = "+this._tempTextureRead+"."+r+`;\r
`}else this.uv.ownerBlock.target!==Me.Fragment?(e.compilationString+=this._declareOutput(n,e)+" = "+this._tempTextureRead+"."+r+`;\r
`,e.compilationString+="#ifdef "+this._linearDefineName+`\r
`,e.compilationString+=n.associatedVariableName+" = toGammaSpace("+n.associatedVariableName+`);\r
`,e.compilationString+=`#endif\r
`,e.compilationString+="#ifdef "+this._gammaDefineName+`\r
`,e.compilationString+=n.associatedVariableName+" = toLinearSpace("+n.associatedVariableName+`);\r
`,e.compilationString+=`#endif\r
`):e.compilationString+=this._declareOutput(n,e)+" = "+this._tempTextureRead+"."+r+`;\r
`},t.prototype._buildBlock=function(e){if(i.prototype._buildBlock.call(this,e),this._tempTextureRead=e._getFreeVariableName("tempTextureRead"),e.sharedData.blockingBlocks.indexOf(this)<0&&e.sharedData.blockingBlocks.push(this),e.sharedData.textureBlocks.indexOf(this)<0&&e.sharedData.textureBlocks.push(this),e.sharedData.blocksWithDefines.indexOf(this)<0&&e.sharedData.blocksWithDefines.push(this),e.target!==Me.Fragment)return e._emit2DSampler(this._samplerName),void this._injectVertexCode(e);if(this._outputs.some(function(f){return f.isConnectedInFragmentShader})){e._emit2DSampler(this._samplerName),this._linearDefineName=e._getFreeDefineName("ISLINEAR"),this._gammaDefineName=e._getFreeDefineName("ISGAMMA");var n="//"+this.name;e._emitFunctionFromInclude("helperFunctions",n),this._writeTextureRead(e);for(var r=0,o=this._outputs;r<o.length;r++){var u=o[r];u.hasEndpoints&&this._writeOutput(e,u,u.name)}return this}},t.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return e.convertToGammaSpace=this.convertToGammaSpace,e.convertToLinearSpace=this.convertToLinearSpace,this.texture&&(e.texture=this.texture.serialize()),e},t.prototype._deserialize=function(e,n,r){i.prototype._deserialize.call(this,e,n,r),this.convertToGammaSpace=e.convertToGammaSpace,this.convertToLinearSpace=!!e.convertToLinearSpace,e.texture&&(r=e.texture.url.indexOf("data:")===0?"":r,this.texture=ke.a.Parse(e.texture,n,r))},t}(Et);C.a.RegisteredTypes["BABYLON.CurrentScreenBlock"]=vm;var bm=function(i){function t(e){var n=i.call(this,e,Me.Fragment)||this;return n._samplerName="diffuseSampler",n.convertToGammaSpace=!1,n.convertToLinearSpace=!1,n._isUnique=!1,n.registerInput("uv",fe.Vector2,!1,Me.VertexAndFragment),n.registerOutput("rgba",fe.Color4,Me.Neutral),n.registerOutput("rgb",fe.Color3,Me.Neutral),n.registerOutput("r",fe.Float,Me.Neutral),n.registerOutput("g",fe.Float,Me.Neutral),n.registerOutput("b",fe.Float,Me.Neutral),n.registerOutput("a",fe.Float,Me.Neutral),n._inputs[0].acceptedConnectionPointTypes.push(fe.Vector3),n._inputs[0].acceptedConnectionPointTypes.push(fe.Vector4),n}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"ParticleTextureBlock"},Object.defineProperty(t.prototype,"uv",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rgba",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rgb",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"r",{get:function(){return this._outputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"g",{get:function(){return this._outputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"b",{get:function(){return this._outputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"a",{get:function(){return this._outputs[5]},enumerable:!1,configurable:!0}),t.prototype.initialize=function(e){e._excludeVariableName("diffuseSampler")},t.prototype.autoConfigure=function(e){if(!this.uv.isConnected){var n=e.getInputBlockByPredicate(function(r){return r.isAttribute&&r.name==="particle_uv"});n||(n=new Bt("uv")).setAsAttribute("particle_uv"),n.output.connectTo(this.uv)}},t.prototype.prepareDefines=function(e,n,r){r.setValue(this._linearDefineName,this.convertToGammaSpace,!0),r.setValue(this._gammaDefineName,this.convertToLinearSpace,!0)},t.prototype.isReady=function(){return!(this.texture&&!this.texture.isReadyOrNotBlocking())},t.prototype._writeOutput=function(e,n,r){e.compilationString+=this._declareOutput(n,e)+" = "+this._tempTextureRead+"."+r+`;\r
`,e.compilationString+="#ifdef "+this._linearDefineName+`\r
`,e.compilationString+=n.associatedVariableName+" = toGammaSpace("+n.associatedVariableName+`);\r
`,e.compilationString+=`#endif\r
`,e.compilationString+="#ifdef "+this._gammaDefineName+`\r
`,e.compilationString+=n.associatedVariableName+" = toLinearSpace("+n.associatedVariableName+`);\r
`,e.compilationString+=`#endif\r
`},t.prototype._buildBlock=function(e){if(i.prototype._buildBlock.call(this,e),e.target!==Me.Vertex){this._tempTextureRead=e._getFreeVariableName("tempTextureRead"),e._emit2DSampler(this._samplerName),e.sharedData.blockingBlocks.push(this),e.sharedData.textureBlocks.push(this),e.sharedData.blocksWithDefines.push(this),this._linearDefineName=e._getFreeDefineName("ISLINEAR"),this._gammaDefineName=e._getFreeDefineName("ISGAMMA");var n="//"+this.name;e._emitFunctionFromInclude("helperFunctions",n),e.compilationString+="vec4 "+this._tempTextureRead+" = texture2D("+this._samplerName+", "+this.uv.associatedVariableName+`);\r
`;for(var r=0,o=this._outputs;r<o.length;r++){var u=o[r];u.hasEndpoints&&this._writeOutput(e,u,u.name)}return this}},t.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return e.convertToGammaSpace=this.convertToGammaSpace,e.convertToLinearSpace=this.convertToLinearSpace,this.texture&&(e.texture=this.texture.serialize()),e},t.prototype._deserialize=function(e,n,r){i.prototype._deserialize.call(this,e,n,r),this.convertToGammaSpace=e.convertToGammaSpace,this.convertToLinearSpace=!!e.convertToLinearSpace,e.texture&&(r=e.texture.url.indexOf("data:")===0?"":r,this.texture=ke.a.Parse(e.texture,n,r))},t}(Et);C.a.RegisteredTypes["BABYLON.ParticleTextureBlock"]=bm;var ym=function(i){function t(e){var n=i.call(this,e,Me.Fragment)||this;return n._isUnique=!0,n.registerInput("color",fe.Color4,!1,Me.Fragment),n.registerOutput("rampColor",fe.Color4,Me.Fragment),n}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"ParticleRampGradientBlock"},Object.defineProperty(t.prototype,"color",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rampColor",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype.initialize=function(e){e._excludeVariableName("remapRanges"),e._excludeVariableName("rampSampler"),e._excludeVariableName("baseColor"),e._excludeVariableName("alpha"),e._excludeVariableName("remappedColorIndex"),e._excludeVariableName("rampColor"),e._excludeVariableName("finalAlpha")},t.prototype._buildBlock=function(e){if(i.prototype._buildBlock.call(this,e),e.target!==Me.Vertex)return e._emit2DSampler("rampSampler"),e._emitVaryingFromString("remapRanges","vec4","RAMPGRADIENT"),e.compilationString+=`
            #ifdef RAMPGRADIENT
                vec4 baseColor = `+this.color.associatedVariableName+`;
                float alpha = `+this.color.associatedVariableName+`.a;

                float remappedColorIndex = clamp((alpha - remapRanges.x) / remapRanges.y, 0.0, 1.0);

                vec4 rampColor = texture2D(rampSampler, vec2(1.0 - remappedColorIndex, 0.));
                baseColor.rgb *= rampColor.rgb;

                // Remapped alpha
                float finalAlpha = baseColor.a;
                baseColor.a = clamp((alpha * rampColor.a - remapRanges.z) / remapRanges.w, 0.0, 1.0);

                `+this._declareOutput(this.rampColor,e)+` = baseColor;
            #else
                `+this._declareOutput(this.rampColor,e)+" = "+this.color.associatedVariableName+`;
            #endif
        `,this},t}(Et);C.a.RegisteredTypes["BABYLON.ParticleRampGradientBlock"]=ym;var Tm=function(i){function t(e){var n=i.call(this,e,Me.Fragment)||this;return n._isUnique=!0,n.registerInput("color",fe.Color4,!1,Me.Fragment),n.registerInput("alphaTexture",fe.Float,!1,Me.Fragment),n.registerInput("alphaColor",fe.Float,!1,Me.Fragment),n.registerOutput("blendColor",fe.Color4,Me.Fragment),n}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"ParticleBlendMultiplyBlock"},Object.defineProperty(t.prototype,"color",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"alphaTexture",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"alphaColor",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"blendColor",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype.initialize=function(e){e._excludeVariableName("sourceAlpha")},t.prototype._buildBlock=function(e){if(i.prototype._buildBlock.call(this,e),e.target!==Me.Vertex)return e.compilationString+=`
            #ifdef BLENDMULTIPLYMODE
                `+this._declareOutput(this.blendColor,e)+`;
                float sourceAlpha = `+this.alphaColor.associatedVariableName+" * "+this.alphaTexture.associatedVariableName+`;
                `+this.blendColor.associatedVariableName+".rgb = "+this.color.associatedVariableName+`.rgb * sourceAlpha + vec3(1.0) * (1.0 - sourceAlpha);
                `+this.blendColor.associatedVariableName+".a = "+this.color.associatedVariableName+`.a;
            #else
                `+this._declareOutput(this.blendColor,e)+" = "+this.color.associatedVariableName+`;
            #endif
        `,this},t}(Et);C.a.RegisteredTypes["BABYLON.ParticleBlendMultiplyBlock"]=Tm;var $t,ml=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("xyz ",fe.Vector3,!0),n.registerInput("xy ",fe.Vector2,!0),n.registerInput("x",fe.Float,!0),n.registerInput("y",fe.Float,!0),n.registerInput("z",fe.Float,!0),n.registerInput("w",fe.Float,!0),n.registerOutput("xyzw",fe.Vector4),n.registerOutput("xyz",fe.Vector3),n.registerOutput("xy",fe.Vector2),n}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"VectorMergerBlock"},Object.defineProperty(t.prototype,"xyzIn",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"xyIn",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"x",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"z",{get:function(){return this._inputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"w",{get:function(){return this._inputs[5]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"xyzw",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"xyzOut",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"xyOut",{get:function(){return this._outputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"xy",{get:function(){return this.xyOut},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"xyz",{get:function(){return this.xyzOut},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this.x,r=this.y,o=this.z,u=this.w,f=this.xyIn,v=this.xyzIn,y=this._outputs[0],D=this._outputs[1],w=this._outputs[2];return v.isConnected?y.hasEndpoints?e.compilationString+=this._declareOutput(y,e)+" = vec4("+v.associatedVariableName+", "+(u.isConnected?this._writeVariable(u):"0.0")+`);\r
`:D.hasEndpoints?e.compilationString+=this._declareOutput(D,e)+" = "+v.associatedVariableName+`;\r
`:w.hasEndpoints&&(e.compilationString+=this._declareOutput(w,e)+" = "+v.associatedVariableName+`.xy;\r
`):f.isConnected?y.hasEndpoints?e.compilationString+=this._declareOutput(y,e)+" = vec4("+f.associatedVariableName+", "+(o.isConnected?this._writeVariable(o):"0.0")+", "+(u.isConnected?this._writeVariable(u):"0.0")+`);\r
`:D.hasEndpoints?e.compilationString+=this._declareOutput(D,e)+" = vec3("+f.associatedVariableName+", "+(o.isConnected?this._writeVariable(o):"0.0")+`);\r
`:w.hasEndpoints&&(e.compilationString+=this._declareOutput(w,e)+" = "+f.associatedVariableName+`;\r
`):y.hasEndpoints?e.compilationString+=this._declareOutput(y,e)+" = vec4("+(n.isConnected?this._writeVariable(n):"0.0")+", "+(r.isConnected?this._writeVariable(r):"0.0")+", "+(o.isConnected?this._writeVariable(o):"0.0")+", "+(u.isConnected?this._writeVariable(u):"0.0")+`);\r
`:D.hasEndpoints?e.compilationString+=this._declareOutput(D,e)+" = vec3("+(n.isConnected?this._writeVariable(n):"0.0")+", "+(r.isConnected?this._writeVariable(r):"0.0")+", "+(o.isConnected?this._writeVariable(o):"0.0")+`);\r
`:w.hasEndpoints&&(e.compilationString+=this._declareOutput(w,e)+" = vec2("+(n.isConnected?this._writeVariable(n):"0.0")+", "+(r.isConnected?this._writeVariable(r):"0.0")+`);\r
`),this},t}(Et);function sn(i,t,e,n){return t===void 0&&(t=$t.Boolean),e===void 0&&(e="PROPERTIES"),function(r,o){var u=r._propStore;u||(u=[],r._propStore=u),u.push({propertyName:o,displayName:i,type:t,groupName:e,options:n??{}})}}C.a.RegisteredTypes["BABYLON.VectorMergerBlock"]=ml,function(i){i[i.Boolean=0]="Boolean",i[i.Float=1]="Float",i[i.Vector2=2]="Vector2",i[i.List=3]="List"}($t||($t={}));var Em=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.sourceRange=new d.d(-1,1),n.targetRange=new d.d(0,1),n.registerInput("input",fe.AutoDetect),n.registerInput("sourceMin",fe.Float,!0),n.registerInput("sourceMax",fe.Float,!0),n.registerInput("targetMin",fe.Float,!0),n.registerInput("targetMax",fe.Float,!0),n.registerOutput("output",fe.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"RemapBlock"},Object.defineProperty(t.prototype,"input",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sourceMin",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sourceMax",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"targetMin",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"targetMax",{get:function(){return this._inputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0],r=this.sourceMin.isConnected?this.sourceMin.associatedVariableName:this._writeFloat(this.sourceRange.x),o=this.sourceMax.isConnected?this.sourceMax.associatedVariableName:this._writeFloat(this.sourceRange.y),u=this.targetMin.isConnected?this.targetMin.associatedVariableName:this._writeFloat(this.targetRange.x),f=this.targetMax.isConnected?this.targetMax.associatedVariableName:this._writeFloat(this.targetRange.y);return e.compilationString+=this._declareOutput(n,e)+" = "+u+" + ("+this._inputs[0].associatedVariableName+" - "+r+") * ("+f+" - "+u+") / ("+o+" - "+r+`);\r
`,this},t.prototype._dumpPropertiesCode=function(){var e=this._codeVariableName+".sourceRange = new BABYLON.Vector2("+this.sourceRange.x+", "+this.sourceRange.y+`);\r
`;return e+=this._codeVariableName+".targetRange = new BABYLON.Vector2("+this.targetRange.x+", "+this.targetRange.y+`);\r
`},t.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return e.sourceRange=this.sourceRange.asArray(),e.targetRange=this.targetRange.asArray(),e},t.prototype._deserialize=function(e,n,r){i.prototype._deserialize.call(this,e,n,r),this.sourceRange=d.d.FromArray(e.sourceRange),this.targetRange=d.d.FromArray(e.targetRange)},Object(p.c)([sn("From",$t.Vector2)],t.prototype,"sourceRange",void 0),Object(p.c)([sn("To",$t.Vector2)],t.prototype,"targetRange",void 0),t}(Et);C.a.RegisteredTypes["BABYLON.RemapBlock"]=Em;var Oh=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("left",fe.AutoDetect),n.registerInput("right",fe.AutoDetect),n.registerOutput("output",fe.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n._linkConnectionTypes(0,1),n}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"MultiplyBlock"},Object.defineProperty(t.prototype,"left",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = "+this.left.associatedVariableName+" * "+this.right.associatedVariableName+`;\r
`,this},t}(Et);C.a.RegisteredTypes["BABYLON.MultiplyBlock"]=Oh;var Ds=function(){function i(){this.direction1=new d.e(0,1,0),this.direction2=new d.e(0,1,0),this.minEmitBox=new d.e(-.5,-.5,-.5),this.maxEmitBox=new d.e(.5,.5,.5)}return i.prototype.startDirectionFunction=function(t,e,n,r){var o=te.a.RandomRange(this.direction1.x,this.direction2.x),u=te.a.RandomRange(this.direction1.y,this.direction2.y),f=te.a.RandomRange(this.direction1.z,this.direction2.z);if(r)return e.x=o,e.y=u,void(e.z=f);d.e.TransformNormalFromFloatsToRef(o,u,f,t,e)},i.prototype.startPositionFunction=function(t,e,n,r){var o=te.a.RandomRange(this.minEmitBox.x,this.maxEmitBox.x),u=te.a.RandomRange(this.minEmitBox.y,this.maxEmitBox.y),f=te.a.RandomRange(this.minEmitBox.z,this.maxEmitBox.z);if(r)return e.x=o,e.y=u,void(e.z=f);d.e.TransformCoordinatesFromFloatsToRef(o,u,f,t,e)},i.prototype.clone=function(){var t=new i;return ge.a.DeepCopy(this,t),t},i.prototype.applyToShader=function(t){t.setVector3("direction1",this.direction1),t.setVector3("direction2",this.direction2),t.setVector3("minEmitBox",this.minEmitBox),t.setVector3("maxEmitBox",this.maxEmitBox)},i.prototype.getEffectDefines=function(){return"#define BOXEMITTER"},i.prototype.getClassName=function(){return"BoxParticleEmitter"},i.prototype.serialize=function(){var t={};return t.type=this.getClassName(),t.direction1=this.direction1.asArray(),t.direction2=this.direction2.asArray(),t.minEmitBox=this.minEmitBox.asArray(),t.maxEmitBox=this.maxEmitBox.asArray(),t},i.prototype.parse=function(t){d.e.FromArrayToRef(t.direction1,0,this.direction1),d.e.FromArrayToRef(t.direction2,0,this.direction2),d.e.FromArrayToRef(t.minEmitBox,0,this.minEmitBox),d.e.FromArrayToRef(t.maxEmitBox,0,this.maxEmitBox)},i}(),Sm=function(){function i(t,e,n){t===void 0&&(t=1),e===void 0&&(e=Math.PI),n===void 0&&(n=0),this.directionRandomizer=n,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=e,this.radius=t}return Object.defineProperty(i.prototype,"radius",{get:function(){return this._radius},set:function(t){this._radius=t,this._buildHeight()},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"angle",{get:function(){return this._angle},set:function(t){this._angle=t,this._buildHeight()},enumerable:!1,configurable:!0}),i.prototype._buildHeight=function(){this._angle!==0?this._height=this._radius/Math.tan(this._angle/2):this._height=1},i.prototype.startDirectionFunction=function(t,e,n,r){r?d.c.Vector3[0].copyFrom(n._localPosition).normalize():n.position.subtractToRef(t.getTranslation(),d.c.Vector3[0]).normalize();var o=te.a.RandomRange(0,this.directionRandomizer),u=te.a.RandomRange(0,this.directionRandomizer),f=te.a.RandomRange(0,this.directionRandomizer);e.x=d.c.Vector3[0].x+o,e.y=d.c.Vector3[0].y+u,e.z=d.c.Vector3[0].z+f,e.normalize()},i.prototype.startPositionFunction=function(t,e,n,r){var o,u=te.a.RandomRange(0,2*Math.PI);o=this.emitFromSpawnPointOnly?1e-4:1-(o=te.a.RandomRange(0,this.heightRange))*o;var f=this._radius-te.a.RandomRange(0,this._radius*this.radiusRange),v=(f*=o)*Math.sin(u),y=f*Math.cos(u),D=o*this._height;if(r)return e.x=v,e.y=D,void(e.z=y);d.e.TransformCoordinatesFromFloatsToRef(v,D,y,t,e)},i.prototype.clone=function(){var t=new i(this._radius,this._angle,this.directionRandomizer);return ge.a.DeepCopy(this,t),t},i.prototype.applyToShader=function(t){t.setFloat2("radius",this._radius,this.radiusRange),t.setFloat("coneAngle",this._angle),t.setFloat2("height",this._height,this.heightRange),t.setFloat("directionRandomizer",this.directionRandomizer)},i.prototype.getEffectDefines=function(){var t="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(t+=`
#define CONEEMITTERSPAWNPOINT`),t},i.prototype.getClassName=function(){return"ConeParticleEmitter"},i.prototype.serialize=function(){var t={};return t.type=this.getClassName(),t.radius=this._radius,t.angle=this._angle,t.directionRandomizer=this.directionRandomizer,t.radiusRange=this.radiusRange,t.heightRange=this.heightRange,t.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,t},i.prototype.parse=function(t){this.radius=t.radius,this.angle=t.angle,this.directionRandomizer=t.directionRandomizer,this.radiusRange=t.radiusRange!==void 0?t.radiusRange:1,this.heightRange=t.radiusRange!==void 0?t.heightRange:1,this.emitFromSpawnPointOnly=t.emitFromSpawnPointOnly!==void 0&&t.emitFromSpawnPointOnly},i}(),Mh=function(){function i(t,e,n,r){t===void 0&&(t=1),e===void 0&&(e=1),n===void 0&&(n=1),r===void 0&&(r=0),this.radius=t,this.height=e,this.radiusRange=n,this.directionRandomizer=r}return i.prototype.startDirectionFunction=function(t,e,n,r){var o=n.position.subtract(t.getTranslation()).normalize(),u=te.a.RandomRange(-this.directionRandomizer/2,this.directionRandomizer/2),f=Math.atan2(o.x,o.z);f+=te.a.RandomRange(-Math.PI/2,Math.PI/2)*this.directionRandomizer,o.y=u,o.x=Math.sin(f),o.z=Math.cos(f),o.normalize(),r?e.copyFrom(o):d.e.TransformNormalFromFloatsToRef(o.x,o.y,o.z,t,e)},i.prototype.startPositionFunction=function(t,e,n,r){var o=te.a.RandomRange(-this.height/2,this.height/2),u=te.a.RandomRange(0,2*Math.PI),f=te.a.RandomRange((1-this.radiusRange)*(1-this.radiusRange),1),v=Math.sqrt(f)*this.radius,y=v*Math.cos(u),D=v*Math.sin(u);r?e.copyFromFloats(y,o,D):d.e.TransformCoordinatesFromFloatsToRef(y,o,D,t,e)},i.prototype.clone=function(){var t=new i(this.radius,this.directionRandomizer);return ge.a.DeepCopy(this,t),t},i.prototype.applyToShader=function(t){t.setFloat("radius",this.radius),t.setFloat("height",this.height),t.setFloat("radiusRange",this.radiusRange),t.setFloat("directionRandomizer",this.directionRandomizer)},i.prototype.getEffectDefines=function(){return"#define CYLINDEREMITTER"},i.prototype.getClassName=function(){return"CylinderParticleEmitter"},i.prototype.serialize=function(){var t={};return t.type=this.getClassName(),t.radius=this.radius,t.height=this.height,t.radiusRange=this.radiusRange,t.directionRandomizer=this.directionRandomizer,t},i.prototype.parse=function(t){this.radius=t.radius,this.height=t.height,this.radiusRange=t.radiusRange,this.directionRandomizer=t.directionRandomizer},i}(),xm=function(i){function t(e,n,r,o,u){e===void 0&&(e=1),n===void 0&&(n=1),r===void 0&&(r=1),o===void 0&&(o=new d.e(0,1,0)),u===void 0&&(u=new d.e(0,1,0));var f=i.call(this,e,n,r)||this;return f.direction1=o,f.direction2=u,f}return Object(p.d)(t,i),t.prototype.startDirectionFunction=function(e,n,r){var o=te.a.RandomRange(this.direction1.x,this.direction2.x),u=te.a.RandomRange(this.direction1.y,this.direction2.y),f=te.a.RandomRange(this.direction1.z,this.direction2.z);d.e.TransformNormalFromFloatsToRef(o,u,f,e,n)},t.prototype.clone=function(){var e=new t(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return ge.a.DeepCopy(this,e),e},t.prototype.applyToShader=function(e){e.setFloat("radius",this.radius),e.setFloat("height",this.height),e.setFloat("radiusRange",this.radiusRange),e.setVector3("direction1",this.direction1),e.setVector3("direction2",this.direction2)},t.prototype.getEffectDefines=function(){return`#define CYLINDEREMITTER
#define DIRECTEDCYLINDEREMITTER`},t.prototype.getClassName=function(){return"CylinderDirectedParticleEmitter"},t.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return e.direction1=this.direction1.asArray(),e.direction2=this.direction2.asArray(),e},t.prototype.parse=function(e){i.prototype.parse.call(this,e),this.direction1.copyFrom(e.direction1),this.direction2.copyFrom(e.direction2)},t}(Mh),Am=function(){function i(t,e,n){t===void 0&&(t=1),e===void 0&&(e=1),n===void 0&&(n=0),this.radius=t,this.radiusRange=e,this.directionRandomizer=n}return i.prototype.startDirectionFunction=function(t,e,n,r){var o=n.position.subtract(t.getTranslation()).normalize(),u=te.a.RandomRange(0,this.directionRandomizer),f=te.a.RandomRange(0,this.directionRandomizer),v=te.a.RandomRange(0,this.directionRandomizer);o.x+=u,o.y+=f,o.z+=v,o.normalize(),r?e.copyFrom(o):d.e.TransformNormalFromFloatsToRef(o.x,o.y,o.z,t,e)},i.prototype.startPositionFunction=function(t,e,n,r){var o=this.radius-te.a.RandomRange(0,this.radius*this.radiusRange),u=te.a.RandomRange(0,1),f=te.a.RandomRange(0,2*Math.PI),v=Math.acos(2*u-1),y=o*Math.cos(f)*Math.sin(v),D=o*Math.cos(v),w=o*Math.sin(f)*Math.sin(v);r?e.copyFromFloats(y,Math.abs(D),w):d.e.TransformCoordinatesFromFloatsToRef(y,Math.abs(D),w,t,e)},i.prototype.clone=function(){var t=new i(this.radius,this.directionRandomizer);return ge.a.DeepCopy(this,t),t},i.prototype.applyToShader=function(t){t.setFloat("radius",this.radius),t.setFloat("radiusRange",this.radiusRange),t.setFloat("directionRandomizer",this.directionRandomizer)},i.prototype.getEffectDefines=function(){return"#define HEMISPHERICEMITTER"},i.prototype.getClassName=function(){return"HemisphericParticleEmitter"},i.prototype.serialize=function(){var t={};return t.type=this.getClassName(),t.radius=this.radius,t.radiusRange=this.radiusRange,t.directionRandomizer=this.directionRandomizer,t},i.prototype.parse=function(t){this.radius=t.radius,this.radiusRange=t.radiusRange,this.directionRandomizer=t.directionRandomizer},i}(),Pm=function(){function i(){this.direction1=new d.e(0,1,0),this.direction2=new d.e(0,1,0)}return i.prototype.startDirectionFunction=function(t,e,n,r){var o=te.a.RandomRange(this.direction1.x,this.direction2.x),u=te.a.RandomRange(this.direction1.y,this.direction2.y),f=te.a.RandomRange(this.direction1.z,this.direction2.z);r?e.copyFromFloats(o,u,f):d.e.TransformNormalFromFloatsToRef(o,u,f,t,e)},i.prototype.startPositionFunction=function(t,e,n,r){r?e.copyFromFloats(0,0,0):d.e.TransformCoordinatesFromFloatsToRef(0,0,0,t,e)},i.prototype.clone=function(){var t=new i;return ge.a.DeepCopy(this,t),t},i.prototype.applyToShader=function(t){t.setVector3("direction1",this.direction1),t.setVector3("direction2",this.direction2)},i.prototype.getEffectDefines=function(){return"#define POINTEMITTER"},i.prototype.getClassName=function(){return"PointParticleEmitter"},i.prototype.serialize=function(){var t={};return t.type=this.getClassName(),t.direction1=this.direction1.asArray(),t.direction2=this.direction2.asArray(),t},i.prototype.parse=function(t){d.e.FromArrayToRef(t.direction1,0,this.direction1),d.e.FromArrayToRef(t.direction2,0,this.direction2)},i}(),Ih=function(){function i(t,e,n){t===void 0&&(t=1),e===void 0&&(e=1),n===void 0&&(n=0),this.radius=t,this.radiusRange=e,this.directionRandomizer=n}return i.prototype.startDirectionFunction=function(t,e,n,r){var o=n.position.subtract(t.getTranslation()).normalize(),u=te.a.RandomRange(0,this.directionRandomizer),f=te.a.RandomRange(0,this.directionRandomizer),v=te.a.RandomRange(0,this.directionRandomizer);o.x+=u,o.y+=f,o.z+=v,o.normalize(),r?e.copyFrom(o):d.e.TransformNormalFromFloatsToRef(o.x,o.y,o.z,t,e)},i.prototype.startPositionFunction=function(t,e,n,r){var o=this.radius-te.a.RandomRange(0,this.radius*this.radiusRange),u=te.a.RandomRange(0,1),f=te.a.RandomRange(0,2*Math.PI),v=Math.acos(2*u-1),y=o*Math.cos(f)*Math.sin(v),D=o*Math.cos(v),w=o*Math.sin(f)*Math.sin(v);r?e.copyFromFloats(y,D,w):d.e.TransformCoordinatesFromFloatsToRef(y,D,w,t,e)},i.prototype.clone=function(){var t=new i(this.radius,this.directionRandomizer);return ge.a.DeepCopy(this,t),t},i.prototype.applyToShader=function(t){t.setFloat("radius",this.radius),t.setFloat("radiusRange",this.radiusRange),t.setFloat("directionRandomizer",this.directionRandomizer)},i.prototype.getEffectDefines=function(){return"#define SPHEREEMITTER"},i.prototype.getClassName=function(){return"SphereParticleEmitter"},i.prototype.serialize=function(){var t={};return t.type=this.getClassName(),t.radius=this.radius,t.radiusRange=this.radiusRange,t.directionRandomizer=this.directionRandomizer,t},i.prototype.parse=function(t){this.radius=t.radius,this.radiusRange=t.radiusRange,this.directionRandomizer=t.directionRandomizer},i}(),Cm=function(i){function t(e,n,r){e===void 0&&(e=1),n===void 0&&(n=new d.e(0,1,0)),r===void 0&&(r=new d.e(0,1,0));var o=i.call(this,e)||this;return o.direction1=n,o.direction2=r,o}return Object(p.d)(t,i),t.prototype.startDirectionFunction=function(e,n,r){var o=te.a.RandomRange(this.direction1.x,this.direction2.x),u=te.a.RandomRange(this.direction1.y,this.direction2.y),f=te.a.RandomRange(this.direction1.z,this.direction2.z);d.e.TransformNormalFromFloatsToRef(o,u,f,e,n)},t.prototype.clone=function(){var e=new t(this.radius,this.direction1,this.direction2);return ge.a.DeepCopy(this,e),e},t.prototype.applyToShader=function(e){e.setFloat("radius",this.radius),e.setFloat("radiusRange",this.radiusRange),e.setVector3("direction1",this.direction1),e.setVector3("direction2",this.direction2)},t.prototype.getEffectDefines=function(){return`#define SPHEREEMITTER
#define DIRECTEDSPHEREEMITTER`},t.prototype.getClassName=function(){return"SphereDirectedParticleEmitter"},t.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return e.direction1=this.direction1.asArray(),e.direction2=this.direction2.asArray(),e},t.prototype.parse=function(e){i.prototype.parse.call(this,e),this.direction1.copyFrom(e.direction1),this.direction2.copyFrom(e.direction2)},t}(Ih),ws=function(){function i(){this.particlePositionGenerator=function(){},this.particleDestinationGenerator=function(){}}return i.prototype.startDirectionFunction=function(t,e,n,r){var o=d.c.Vector3[0];if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,n,o);var u=d.c.Vector3[1];o.subtractToRef(n.position,u),u.scaleToRef(1/n.lifeTime,o)}else o.set(0,0,0);r?e.copyFrom(o):d.e.TransformNormalToRef(o,t,e)},i.prototype.startPositionFunction=function(t,e,n,r){var o=d.c.Vector3[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,n,o):o.set(0,0,0),r?e.copyFrom(o):d.e.TransformCoordinatesToRef(o,t,e)},i.prototype.clone=function(){var t=new i;return ge.a.DeepCopy(this,t),t},i.prototype.applyToShader=function(t){},i.prototype.getEffectDefines=function(){return"#define CUSTOMEMITTER"},i.prototype.getClassName=function(){return"CustomParticleEmitter"},i.prototype.serialize=function(){var t={};return t.type=this.getClassName(),t},i.prototype.parse=function(t){},i}(),$0=function(){function i(t){t===void 0&&(t=null),this._indices=null,this._positions=null,this._normals=null,this._storedNormal=d.e.Zero(),this._mesh=null,this.direction1=new d.e(0,1,0),this.direction2=new d.e(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=t}return Object.defineProperty(i.prototype,"mesh",{get:function(){return this._mesh},set:function(t){this._mesh!==t&&(this._mesh=t,t?(this._indices=t.getIndices(),this._positions=t.getVerticesData(De.b.PositionKind),this._normals=t.getVerticesData(De.b.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))},enumerable:!1,configurable:!0}),i.prototype.startDirectionFunction=function(t,e,n,r){if(this.useMeshNormalsForDirection&&this._normals)d.e.TransformNormalToRef(this._storedNormal,t,e);else{var o=te.a.RandomRange(this.direction1.x,this.direction2.x),u=te.a.RandomRange(this.direction1.y,this.direction2.y),f=te.a.RandomRange(this.direction1.z,this.direction2.z);r?e.copyFromFloats(o,u,f):d.e.TransformNormalFromFloatsToRef(o,u,f,t,e)}},i.prototype.startPositionFunction=function(t,e,n,r){if(this._indices&&this._positions){var o=3*Math.random()*(this._indices.length/3)|0,u=Math.random(),f=Math.random()*(1-u),v=1-u-f,y=this._indices[o],D=this._indices[o+1],w=this._indices[o+2],F=d.c.Vector3[0],z=d.c.Vector3[1],k=d.c.Vector3[2],K=d.c.Vector3[3];d.e.FromArrayToRef(this._positions,3*y,F),d.e.FromArrayToRef(this._positions,3*D,z),d.e.FromArrayToRef(this._positions,3*w,k),K.x=u*F.x+f*z.x+v*k.x,K.y=u*F.y+f*z.y+v*k.y,K.z=u*F.z+f*z.z+v*k.z,r?e.copyFromFloats(K.x,K.y,K.z):d.e.TransformCoordinatesFromFloatsToRef(K.x,K.y,K.z,t,e),this.useMeshNormalsForDirection&&this._normals&&(d.e.FromArrayToRef(this._normals,3*y,F),d.e.FromArrayToRef(this._normals,3*D,z),d.e.FromArrayToRef(this._normals,3*w,k),this._storedNormal.x=u*F.x+f*z.x+v*k.x,this._storedNormal.y=u*F.y+f*z.y+v*k.y,this._storedNormal.z=u*F.z+f*z.z+v*k.z)}},i.prototype.clone=function(){var t=new i(this.mesh);return ge.a.DeepCopy(this,t),t},i.prototype.applyToShader=function(t){t.setVector3("direction1",this.direction1),t.setVector3("direction2",this.direction2)},i.prototype.getEffectDefines=function(){return""},i.prototype.getClassName=function(){return"MeshParticleEmitter"},i.prototype.serialize=function(){var t,e={};return e.type=this.getClassName(),e.direction1=this.direction1.asArray(),e.direction2=this.direction2.asArray(),e.meshId=(t=this.mesh)===null||t===void 0?void 0:t.id,e.useMeshNormalsForDirection=this.useMeshNormalsForDirection,e},i.prototype.parse=function(t,e){d.e.FromArrayToRef(t.direction1,0,this.direction1),d.e.FromArrayToRef(t.direction2,0,this.direction2),t.meshId&&e&&(this.mesh=e.getLastMeshByID(t.meshId)),this.useMeshNormalsForDirection=t.useMeshNormalsForDirection},i}(),_l=function(){function i(t){this.animations=[],this.renderingGroupId=0,this.emitter=d.e.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this.targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.noiseStrength=new d.e(10,10,10),this.onAnimationEnd=null,this.blendMode=i.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteRandomStartCell=!1,this.translationPivot=new d.d(0,0),this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.worldOffset=new d.e(0,0,0),this.gravity=d.e.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new M.b(1,1,1,1),this.color2=new M.b(1,1,1,1),this.colorDead=new M.b(0,0,0,1),this.textureMask=new M.b(1,1,1,1),this._isSubEmitter=!1,this.billboardMode=g.a.PARTICLES_BILLBOARDMODE_ALL,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new fr.b,this.id=t,this.name=t}return Object.defineProperty(i.prototype,"noiseTexture",{get:function(){return this._noiseTexture},set:function(t){this._noiseTexture!==t&&(this._noiseTexture=t,this._reset())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isAnimationSheetEnabled",{get:function(){return this._isAnimationSheetEnabled},set:function(t){this._isAnimationSheetEnabled!=t&&(this._isAnimationSheetEnabled=t,this._reset())},enumerable:!1,configurable:!0}),i.prototype.getScene=function(){return this._scene},i.prototype._hasTargetStopDurationDependantGradient=function(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0},i.prototype.getDragGradients=function(){return this._dragGradients},i.prototype.getLimitVelocityGradients=function(){return this._limitVelocityGradients},i.prototype.getColorGradients=function(){return this._colorGradients},i.prototype.getSizeGradients=function(){return this._sizeGradients},i.prototype.getColorRemapGradients=function(){return this._colorRemapGradients},i.prototype.getAlphaRemapGradients=function(){return this._alphaRemapGradients},i.prototype.getLifeTimeGradients=function(){return this._lifeTimeGradients},i.prototype.getAngularSpeedGradients=function(){return this._angularSpeedGradients},i.prototype.getVelocityGradients=function(){return this._velocityGradients},i.prototype.getStartSizeGradients=function(){return this._startSizeGradients},i.prototype.getEmitRateGradients=function(){return this._emitRateGradients},Object.defineProperty(i.prototype,"direction1",{get:function(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:d.e.Zero()},set:function(t){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"direction2",{get:function(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:d.e.Zero()},set:function(t){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"minEmitBox",{get:function(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:d.e.Zero()},set:function(t){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"maxEmitBox",{get:function(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:d.e.Zero()},set:function(t){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isBillboardBased",{get:function(){return this._isBillboardBased},set:function(t){this._isBillboardBased!==t&&(this._isBillboardBased=t,this._reset())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(t){this._attachImageProcessingConfiguration(t)},enumerable:!1,configurable:!0}),i.prototype._attachImageProcessingConfiguration=function(t){t!==this._imageProcessingConfiguration&&(!t&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=t)},i.prototype._reset=function(){},i.prototype._removeGradientAndTexture=function(t,e,n){if(!e)return this;for(var r=0,o=0,u=e;o<u.length;o++){if(u[o].gradient===t){e.splice(r,1);break}r++}return n&&n.dispose(),this},i.prototype.createPointEmitter=function(t,e){var n=new Pm;return n.direction1=t,n.direction2=e,this.particleEmitterType=n,n},i.prototype.createHemisphericEmitter=function(t,e){t===void 0&&(t=1),e===void 0&&(e=1);var n=new Am(t,e);return this.particleEmitterType=n,n},i.prototype.createSphereEmitter=function(t,e){t===void 0&&(t=1),e===void 0&&(e=1);var n=new Ih(t,e);return this.particleEmitterType=n,n},i.prototype.createDirectedSphereEmitter=function(t,e,n){t===void 0&&(t=1),e===void 0&&(e=new d.e(0,1,0)),n===void 0&&(n=new d.e(0,1,0));var r=new Cm(t,e,n);return this.particleEmitterType=r,r},i.prototype.createCylinderEmitter=function(t,e,n,r){t===void 0&&(t=1),e===void 0&&(e=1),n===void 0&&(n=1),r===void 0&&(r=0);var o=new Mh(t,e,n,r);return this.particleEmitterType=o,o},i.prototype.createDirectedCylinderEmitter=function(t,e,n,r,o){t===void 0&&(t=1),e===void 0&&(e=1),n===void 0&&(n=1),r===void 0&&(r=new d.e(0,1,0)),o===void 0&&(o=new d.e(0,1,0));var u=new xm(t,e,n,r,o);return this.particleEmitterType=u,u},i.prototype.createConeEmitter=function(t,e){t===void 0&&(t=1),e===void 0&&(e=Math.PI/4);var n=new Sm(t,e);return this.particleEmitterType=n,n},i.prototype.createBoxEmitter=function(t,e,n,r){var o=new Ds;return this.particleEmitterType=o,this.direction1=t,this.direction2=e,this.minEmitBox=n,this.maxEmitBox=r,o},i.BLENDMODE_ONEONE=0,i.BLENDMODE_STANDARD=1,i.BLENDMODE_ADD=2,i.BLENDMODE_MULTIPLY=3,i.BLENDMODE_MULTIPLYADD=4,i}(),Rm=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("rgba",fe.Color4,!0),n.registerInput("rgb ",fe.Color3,!0),n.registerOutput("rgb",fe.Color3),n.registerOutput("r",fe.Float),n.registerOutput("g",fe.Float),n.registerOutput("b",fe.Float),n.registerOutput("a",fe.Float),n.inputsAreExclusive=!0,n}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"ColorSplitterBlock"},Object.defineProperty(t.prototype,"rgba",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rgbIn",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rgbOut",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"r",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"g",{get:function(){return this._outputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"b",{get:function(){return this._outputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"a",{get:function(){return this._outputs[4]},enumerable:!1,configurable:!0}),t.prototype._inputRename=function(e){return e==="rgb "?"rgbIn":e},t.prototype._outputRename=function(e){return e==="rgb"?"rgbOut":e},t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this.rgba.isConnected?this.rgba:this.rgbIn;if(n.isConnected){var r=this._outputs[0],o=this._outputs[1],u=this._outputs[2],f=this._outputs[3],v=this._outputs[4];return r.hasEndpoints&&(e.compilationString+=this._declareOutput(r,e)+" = "+n.associatedVariableName+`.rgb;\r
`),o.hasEndpoints&&(e.compilationString+=this._declareOutput(o,e)+" = "+n.associatedVariableName+`.r;\r
`),u.hasEndpoints&&(e.compilationString+=this._declareOutput(u,e)+" = "+n.associatedVariableName+`.g;\r
`),f.hasEndpoints&&(e.compilationString+=this._declareOutput(f,e)+" = "+n.associatedVariableName+`.b;\r
`),v.hasEndpoints&&(e.compilationString+=this._declareOutput(v,e)+" = "+n.associatedVariableName+`.a;\r
`),this}},t}(Et);C.a.RegisteredTypes["BABYLON.ColorSplitterBlock"]=Rm;var Un,J0=c(104);(function(i){i[i.Cos=0]="Cos",i[i.Sin=1]="Sin",i[i.Abs=2]="Abs",i[i.Exp=3]="Exp",i[i.Exp2=4]="Exp2",i[i.Round=5]="Round",i[i.Floor=6]="Floor",i[i.Ceiling=7]="Ceiling",i[i.Sqrt=8]="Sqrt",i[i.Log=9]="Log",i[i.Tan=10]="Tan",i[i.ArcTan=11]="ArcTan",i[i.ArcCos=12]="ArcCos",i[i.ArcSin=13]="ArcSin",i[i.Fract=14]="Fract",i[i.Sign=15]="Sign",i[i.Radians=16]="Radians",i[i.Degrees=17]="Degrees"})(Un||(Un={}));var Om=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.operation=Un.Cos,n.registerInput("input",fe.AutoDetect),n.registerOutput("output",fe.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"TrigonometryBlock"},Object.defineProperty(t.prototype,"input",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0],r="";switch(this.operation){case Un.Cos:r="cos";break;case Un.Sin:r="sin";break;case Un.Abs:r="abs";break;case Un.Exp:r="exp";break;case Un.Exp2:r="exp2";break;case Un.Round:r="round";break;case Un.Floor:r="floor";break;case Un.Ceiling:r="ceil";break;case Un.Sqrt:r="sqrt";break;case Un.Log:r="log";break;case Un.Tan:r="tan";break;case Un.ArcTan:r="atan";break;case Un.ArcCos:r="acos";break;case Un.ArcSin:r="asin";break;case Un.Fract:r="fract";break;case Un.Sign:r="sign";break;case Un.Radians:r="radians";break;case Un.Degrees:r="degrees"}return e.compilationString+=this._declareOutput(n,e)+" = "+r+"("+this.input.associatedVariableName+`);\r
`,this},t.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return e.operation=this.operation,e},t.prototype._deserialize=function(e,n,r){i.prototype._deserialize.call(this,e,n,r),this.operation=e.operation},t.prototype._dumpPropertiesCode=function(){return this._codeVariableName+".operation = BABYLON.TrigonometryBlockOperations."+Un[this.operation]+`;\r
`},t}(Et);C.a.RegisteredTypes["BABYLON.TrigonometryBlock"]=Om;var Mm={effect:null,subMesh:null},gl=function(i){function t(){var e=i.call(this)||this;return e.NORMAL=!1,e.TANGENT=!1,e.UV1=!1,e.NUM_BONE_INFLUENCERS=0,e.BonesPerMesh=0,e.BONETEXTURE=!1,e.MORPHTARGETS=!1,e.MORPHTARGETS_NORMAL=!1,e.MORPHTARGETS_TANGENT=!1,e.MORPHTARGETS_UV=!1,e.NUM_MORPH_INFLUENCERS=0,e.IMAGEPROCESSING=!1,e.VIGNETTE=!1,e.VIGNETTEBLENDMODEMULTIPLY=!1,e.VIGNETTEBLENDMODEOPAQUE=!1,e.TONEMAPPING=!1,e.TONEMAPPING_ACES=!1,e.CONTRAST=!1,e.EXPOSURE=!1,e.COLORCURVES=!1,e.COLORGRADING=!1,e.COLORGRADING3D=!1,e.SAMPLER3DGREENDEPTH=!1,e.SAMPLER3DBGRMAP=!1,e.IMAGEPROCESSINGPOSTPROCESS=!1,e.BUMPDIRECTUV=0,e.rebuild(),e}return Object(p.d)(t,i),t.prototype.setValue=function(e,n,r){r===void 0&&(r=!1),this[e]===void 0&&this._keys.push(e),r&&this[e]!==n&&this.markAsUnprocessed(),this[e]=n},t}(fh.a),Dh=function(i){function t(e,n,r){r===void 0&&(r={});var o=i.call(this,e,n||Ge.a.LastCreatedScene)||this;return o._buildId=t._BuildIdGenerator++,o._buildWasSuccessful=!1,o._cachedWorldViewMatrix=new d.a,o._cachedWorldViewProjectionMatrix=new d.a,o._optimizers=new Array,o._animationFrame=-1,o.BJSNODEMATERIALEDITOR=o._getGlobalNodeMaterialEditor(),o.editorData=null,o.ignoreAlpha=!1,o.maxSimultaneousLights=4,o.onBuildObservable=new S.c,o._vertexOutputNodes=new Array,o._fragmentOutputNodes=new Array,o.attachedBlocks=new Array,o._mode=Dr.Material,o._options=Object(p.a)({emitComments:!1},r),o._attachImageProcessingConfiguration(null),o}return Object(p.d)(t,i),t.prototype._getGlobalNodeMaterialEditor=function(){return typeof NODEEDITOR!="undefined"?NODEEDITOR:typeof BABYLON!="undefined"&&BABYLON.NodeEditor!==void 0?BABYLON:void 0},Object.defineProperty(t.prototype,"options",{get:function(){return this._options},set:function(e){this._options=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(e){this._attachImageProcessingConfiguration(e),this._markAllSubMeshesAsTexturesDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mode",{get:function(){return this._mode},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"NodeMaterial"},t.prototype._attachImageProcessingConfiguration=function(e){var n=this;e!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=e||this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add(function(){n._markAllSubMeshesAsImageProcessingDirty()})))},t.prototype.getBlockByName=function(e){for(var n=null,r=0,o=this.attachedBlocks;r<o.length;r++){var u=o[r];if(u.name===e){if(n)return et.b.Warn("More than one block was found with the name `"+e+"`"),n;n=u}}return n},t.prototype.getBlockByPredicate=function(e){for(var n=0,r=this.attachedBlocks;n<r.length;n++){var o=r[n];if(e(o))return o}return null},t.prototype.getInputBlockByPredicate=function(e){for(var n=0,r=this.attachedBlocks;n<r.length;n++){var o=r[n];if(o.isInput&&e(o))return o}return null},t.prototype.getInputBlocks=function(){for(var e=[],n=0,r=this.attachedBlocks;n<r.length;n++){var o=r[n];o.isInput&&e.push(o)}return e},t.prototype.registerOptimizer=function(e){if(!(this._optimizers.indexOf(e)>-1))return this._optimizers.push(e),this},t.prototype.unregisterOptimizer=function(e){var n=this._optimizers.indexOf(e);if(n!==-1)return this._optimizers.splice(n,1),this},t.prototype.addOutputNode=function(e){if(e.target===null)throw"This node is not meant to be an output node. You may want to explicitly set its target value.";return(e.target&Me.Vertex)!=0&&this._addVertexOutputNode(e),(e.target&Me.Fragment)!=0&&this._addFragmentOutputNode(e),this},t.prototype.removeOutputNode=function(e){return e.target===null||((e.target&Me.Vertex)!=0&&this._removeVertexOutputNode(e),(e.target&Me.Fragment)!=0&&this._removeFragmentOutputNode(e)),this},t.prototype._addVertexOutputNode=function(e){if(this._vertexOutputNodes.indexOf(e)===-1)return e.target=Me.Vertex,this._vertexOutputNodes.push(e),this},t.prototype._removeVertexOutputNode=function(e){var n=this._vertexOutputNodes.indexOf(e);if(n!==-1)return this._vertexOutputNodes.splice(n,1),this},t.prototype._addFragmentOutputNode=function(e){if(this._fragmentOutputNodes.indexOf(e)===-1)return e.target=Me.Fragment,this._fragmentOutputNodes.push(e),this},t.prototype._removeFragmentOutputNode=function(e){var n=this._fragmentOutputNodes.indexOf(e);if(n!==-1)return this._fragmentOutputNodes.splice(n,1),this},t.prototype.needAlphaBlending=function(){return!this.ignoreAlpha&&(this.alpha<1||this._sharedData&&this._sharedData.hints.needAlphaBlending)},t.prototype.needAlphaTesting=function(){return this._sharedData&&this._sharedData.hints.needAlphaTesting},t.prototype._initializeBlock=function(e,n,r){if(e.initialize(n),e.autoConfigure(this),e._preparationId=this._buildId,this.attachedBlocks.indexOf(e)===-1){if(e.isUnique){for(var o=e.getClassName(),u=0,f=this.attachedBlocks;u<f.length;u++)if(f[u].getClassName()===o)throw"Cannot have multiple blocks of type "+o+" in the same NodeMaterial"}this.attachedBlocks.push(e)}for(var v=0,y=e.inputs;v<y.length;v++){var D=y[v];D.associatedVariableName="";var w=D.connectedPoint;if(w){var F=w.ownerBlock;F!==e&&((F.target===Me.VertexAndFragment||n.target===Me.Fragment&&F.target===Me.Vertex&&F._preparationId!==this._buildId)&&r.push(F),this._initializeBlock(F,n,r))}}for(var z=0,k=e.outputs;z<k.length;z++)k[z].associatedVariableName=""},t.prototype._resetDualBlocks=function(e,n){e.target===Me.VertexAndFragment&&(e.buildId=n);for(var r=0,o=e.inputs;r<o.length;r++){var u=o[r].connectedPoint;if(u){var f=u.ownerBlock;f!==e&&this._resetDualBlocks(f,n)}}},t.prototype.removeBlock=function(e){var n=this.attachedBlocks.indexOf(e);n>-1&&this.attachedBlocks.splice(n,1),e.isFinalMerger&&this.removeOutputNode(e)},t.prototype.build=function(e){e===void 0&&(e=!1),this._buildWasSuccessful=!1;var n=this.getScene().getEngine(),r=this._mode===Dr.Particle;if(this._vertexOutputNodes.length===0&&!r)throw"You must define at least one vertexOutputNode";if(this._fragmentOutputNodes.length===0)throw"You must define at least one fragmentOutputNode";this._vertexCompilationState=new q0,this._vertexCompilationState.supportUniformBuffers=n.supportsUniformBuffers,this._vertexCompilationState.target=Me.Vertex,this._fragmentCompilationState=new q0,this._fragmentCompilationState.supportUniformBuffers=n.supportsUniformBuffers,this._fragmentCompilationState.target=Me.Fragment,this._sharedData=new ww,this._vertexCompilationState.sharedData=this._sharedData,this._fragmentCompilationState.sharedData=this._sharedData,this._sharedData.buildId=this._buildId,this._sharedData.emitComments=this._options.emitComments,this._sharedData.verbose=e,this._sharedData.scene=this.getScene(),this._sharedData.allowEmptyVertexProgram=r;for(var o=[],u=[],f=0,v=this._vertexOutputNodes;f<v.length;f++){var y=v[f];o.push(y),this._initializeBlock(y,this._vertexCompilationState,u)}for(var D=0,w=this._fragmentOutputNodes;D<w.length;D++){var F=w[D];u.push(F),this._initializeBlock(F,this._fragmentCompilationState,o)}this.optimize();for(var z=0,k=o;z<k.length;z++)(y=k[z]).build(this._vertexCompilationState,o);this._fragmentCompilationState.uniforms=this._vertexCompilationState.uniforms.slice(0),this._fragmentCompilationState._uniformDeclaration=this._vertexCompilationState._uniformDeclaration,this._fragmentCompilationState._constantDeclaration=this._vertexCompilationState._constantDeclaration,this._fragmentCompilationState._vertexState=this._vertexCompilationState;for(var K=0,oe=u;K<oe.length;K++)F=oe[K],this._resetDualBlocks(F,this._buildId-1);for(var ae=0,ue=u;ae<ue.length;ae++)(F=ue[ae]).build(this._fragmentCompilationState,u);this._vertexCompilationState.finalize(this._vertexCompilationState),this._fragmentCompilationState.finalize(this._fragmentCompilationState),this._buildId=t._BuildIdGenerator++,this._sharedData.emitErrors(),e&&(console.log("Vertex shader:"),console.log(this._vertexCompilationState.compilationString),console.log("Fragment shader:"),console.log(this._fragmentCompilationState.compilationString)),this._buildWasSuccessful=!0,this.onBuildObservable.notifyObservers(this);for(var de=0,me=this.getScene().meshes;de<me.length;de++){var ye=me[de];if(ye.subMeshes)for(var Ee=0,Ae=ye.subMeshes;Ee<Ae.length;Ee++){var Ie=Ae[Ee];if(Ie.getMaterial()===this&&Ie._materialDefines){var Re=Ie._materialDefines;Re.markAllAsDirty(),Re.reset()}}}},t.prototype.optimize=function(){for(var e=0,n=this._optimizers;e<n.length;e++)n[e].optimize(this._vertexOutputNodes,this._fragmentOutputNodes)},t.prototype._prepareDefinesForAttributes=function(e,n){var r=n.NORMAL,o=n.TANGENT,u=n.UV1;n.NORMAL=e.isVerticesDataPresent(De.b.NormalKind),n.TANGENT=e.isVerticesDataPresent(De.b.TangentKind),n.UV1=e.isVerticesDataPresent(De.b.UVKind),r===n.NORMAL&&o===n.TANGENT&&u===n.UV1||n.markAsAttributesDirty()},t.prototype.createPostProcess=function(e,n,r,o,u,f,v){return n===void 0&&(n=1),r===void 0&&(r=g.a.TEXTURE_NEAREST_SAMPLINGMODE),f===void 0&&(f=g.a.TEXTURETYPE_UNSIGNED_INT),v===void 0&&(v=g.a.TEXTUREFORMAT_RGBA),this.mode!==Dr.PostProcess?(console.log("Incompatible material mode"),null):this._createEffectForPostProcess(null,e,n,r,o,u,f,v)},t.prototype.createEffectForPostProcess=function(e){this._createEffectForPostProcess(e)},t.prototype._createEffectForPostProcess=function(e,n,r,o,u,f,v,y){var D=this;r===void 0&&(r=1),o===void 0&&(o=g.a.TEXTURE_NEAREST_SAMPLINGMODE),v===void 0&&(v=g.a.TEXTURETYPE_UNSIGNED_INT),y===void 0&&(y=g.a.TEXTUREFORMAT_RGBA);var w=this.name+this._buildId,F=new gl,z=new jt.a(w+"PostProcess",this.getScene()),k=this._buildId;return this._processDefines(z,F),Ye.a.RegisterShader(w,this._fragmentCompilationState._builtCompilationString,this._vertexCompilationState._builtCompilationString),e?e.updateEffect(F.toString(),this._fragmentCompilationState.uniforms,this._fragmentCompilationState.samplers,{maxSimultaneousLights:this.maxSimultaneousLights},void 0,void 0,w,w):e=new St(this.name+"PostProcess",w,this._fragmentCompilationState.uniforms,this._fragmentCompilationState.samplers,r,n,o,u,f,F.toString(),v,w,{maxSimultaneousLights:this.maxSimultaneousLights},!1,y),e.nodeMaterialSource=this,e.onApplyObservable.add(function(K){k!==D._buildId&&(delete Ye.a.ShadersStore[w+"VertexShader"],delete Ye.a.ShadersStore[w+"PixelShader"],w=D.name+D._buildId,F.markAsUnprocessed(),k=D._buildId),D._processDefines(z,F)&&(Ye.a.RegisterShader(w,D._fragmentCompilationState._builtCompilationString,D._vertexCompilationState._builtCompilationString),J0.a.SetImmediate(function(){return e.updateEffect(F.toString(),D._fragmentCompilationState.uniforms,D._fragmentCompilationState.samplers,{maxSimultaneousLights:D.maxSimultaneousLights},void 0,void 0,w,w)})),D._checkInternals(K)}),e},t.prototype.createProceduralTexture=function(e,n){var r=this;if(this.mode!==Dr.ProceduralTexture)return console.log("Incompatible material mode"),null;var o=this.name+this._buildId,u=new fl(o,e,null,n),f=new jt.a(o+"Procedural",this.getScene());f.reservedDataStore={hidden:!0};var v=new gl,y=this._processDefines(f,v);Ye.a.RegisterShader(o,this._fragmentCompilationState._builtCompilationString,this._vertexCompilationState._builtCompilationString);var D=this.getScene().getEngine().createEffect({vertexElement:o,fragmentElement:o},[De.b.PositionKind],this._fragmentCompilationState.uniforms,this._fragmentCompilationState.samplers,v.toString(),y==null?void 0:y.fallbacks,void 0);u.nodeMaterialSource=this,u._effect=D;var w=this._buildId;return u.onBeforeGenerationObservable.add(function(){w!==r._buildId&&(delete Ye.a.ShadersStore[o+"VertexShader"],delete Ye.a.ShadersStore[o+"PixelShader"],o=r.name+r._buildId,v.markAsUnprocessed(),w=r._buildId);var F=r._processDefines(f,v);F&&(Ye.a.RegisterShader(o,r._fragmentCompilationState._builtCompilationString,r._vertexCompilationState._builtCompilationString),J0.a.SetImmediate(function(){D=r.getScene().getEngine().createEffect({vertexElement:o,fragmentElement:o},[De.b.PositionKind],r._fragmentCompilationState.uniforms,r._fragmentCompilationState.samplers,v.toString(),F==null?void 0:F.fallbacks,void 0),u._effect=D})),r._checkInternals(D)}),u},t.prototype._createEffectForParticles=function(e,n,r,o,u,f,v,y){var D=this;y===void 0&&(y="");var w=this.name+this._buildId+"_"+n;f||(f=new gl),v||(v=this.getScene().getMeshByName(this.name+"Particle"))||((v=new jt.a(this.name+"Particle",this.getScene())).reservedDataStore={hidden:!0});var F=this._buildId,z=[],k=y;if(!u){var K=this._processDefines(v,f);Ye.a.RegisterShader(w,this._fragmentCompilationState._builtCompilationString),e.fillDefines(z,n),k=z.join(`
`),u=this.getScene().getEngine().createEffectForParticles(w,this._fragmentCompilationState.uniforms,this._fragmentCompilationState.samplers,f.toString()+`
`+k,K==null?void 0:K.fallbacks,r,o,e),e.setCustomEffect(u,n)}u.onBindObservable.add(function(oe){F!==D._buildId&&(delete Ye.a.ShadersStore[w+"PixelShader"],w=D.name+D._buildId+"_"+n,f.markAsUnprocessed(),F=D._buildId),z.length=0,e.fillDefines(z,n);var ae=z.join(`
`);ae!==k&&(f.markAsUnprocessed(),k=ae);var ue=D._processDefines(v,f);if(ue)return Ye.a.RegisterShader(w,D._fragmentCompilationState._builtCompilationString),oe=D.getScene().getEngine().createEffectForParticles(w,D._fragmentCompilationState.uniforms,D._fragmentCompilationState.samplers,f.toString()+`
`+k,ue==null?void 0:ue.fallbacks,r,o,e),e.setCustomEffect(oe,n),void D._createEffectForParticles(e,n,r,o,oe,f,v,k);D._checkInternals(oe)})},t.prototype._checkInternals=function(e){if(this._sharedData.animatedInputs){var n=this.getScene(),r=n.getFrameId();if(this._animationFrame!==r){for(var o=0,u=this._sharedData.animatedInputs;o<u.length;o++)u[o].animate(n);this._animationFrame=r}}for(var f=0,v=this._sharedData.bindableBlocks;f<v.length;f++)v[f].bind(e,this);for(var y=0,D=this._sharedData.inputBlocks;y<D.length;y++)D[y]._transmit(e,this.getScene())},t.prototype.createEffectForParticles=function(e,n,r){this.mode===Dr.Particle?(this._createEffectForParticles(e,_l.BLENDMODE_ONEONE,n,r),this._createEffectForParticles(e,_l.BLENDMODE_MULTIPLY,n,r)):console.log("Incompatible material mode")},t.prototype._processDefines=function(e,n,r,o){var u=this;r===void 0&&(r=!1);var f=null;if(this._sharedData.blocksWithDefines.forEach(function(z){z.initializeDefines(e,u,n,r)}),this._sharedData.blocksWithDefines.forEach(function(z){z.prepareDefines(e,u,n,r,o)}),n.isDirty){var v=n._areLightsDisposed;n.markAsProcessed(),this._vertexCompilationState.compilationString=this._vertexCompilationState._builtCompilationString,this._fragmentCompilationState.compilationString=this._fragmentCompilationState._builtCompilationString,this._sharedData.repeatableContentBlocks.forEach(function(z){z.replaceRepeatableContent(u._vertexCompilationState,u._fragmentCompilationState,e,n)});var y=[];this._sharedData.dynamicUniformBlocks.forEach(function(z){z.updateUniformsAndSamples(u._vertexCompilationState,u,n,y)});var D=this._vertexCompilationState.uniforms;this._fragmentCompilationState.uniforms.forEach(function(z){D.indexOf(z)===-1&&D.push(z)});var w=this._vertexCompilationState.samplers;this._fragmentCompilationState.samplers.forEach(function(z){w.indexOf(z)===-1&&w.push(z)});var F=new Ts.a;this._sharedData.blocksWithFallbacks.forEach(function(z){z.provideFallbacks(e,F)}),f={lightDisposed:v,uniformBuffers:y,mergedUniforms:D,mergedSamplers:w,fallbacks:F}}return f},t.prototype.isReadyForSubMesh=function(e,n,r){var o=this;if(r===void 0&&(r=!1),!this._buildWasSuccessful)return!1;var u=this.getScene();if(this._sharedData.animatedInputs){var f=u.getFrameId();if(this._animationFrame!==f){for(var v=0,y=this._sharedData.animatedInputs;v<y.length;v++)y[v].animate(u);this._animationFrame=f}}if(n.effect&&this.isFrozen&&n.effect._wasPreviouslyReady)return!0;n._materialDefines||(n._materialDefines=new gl);var D=n._materialDefines;if(this._isReadyForSubMesh(n))return!0;var w=u.getEngine();if(this._prepareDefinesForAttributes(e,D),this._sharedData.blockingBlocks.some(function(oe){return!oe.isReady(e,o,D,r)}))return!1;var F=this._processDefines(e,D,r,n);if(F){var z=n.effect,k=D.toString(),K=w.createEffect({vertex:"nodeMaterial"+this._buildId,fragment:"nodeMaterial"+this._buildId,vertexSource:this._vertexCompilationState.compilationString,fragmentSource:this._fragmentCompilationState.compilationString},{attributes:this._vertexCompilationState.attributes,uniformsNames:F.mergedUniforms,uniformBuffersNames:F.uniformBuffers,samplers:F.mergedSamplers,defines:k,fallbacks:F.fallbacks,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this.maxSimultaneousLights,maxSimultaneousMorphTargets:D.NUM_MORPH_INFLUENCERS}},w);if(K)if(this._onEffectCreatedObservable&&(Mm.effect=K,Mm.subMesh=n,this._onEffectCreatedObservable.notifyObservers(Mm)),this.allowShaderHotSwapping&&z&&!K.isReady()){if(K=z,D.markAsUnprocessed(),F.lightDisposed)return D._areLightsDisposed=!0,!1}else u.resetCachedMaterial(),n.setEffect(K,D)}return!(!n.effect||!n.effect.isReady())&&(D._renderId=u.getRenderId(),n.effect._wasPreviouslyReady=!0,!0)},Object.defineProperty(t.prototype,"compiledShaders",{get:function(){return`// Vertex shader\r
`+this._vertexCompilationState.compilationString+`\r
\r
// Fragment shader\r
`+this._fragmentCompilationState.compilationString},enumerable:!1,configurable:!0}),t.prototype.bindOnlyWorldMatrix=function(e){var n=this.getScene();if(this._activeEffect){var r=this._sharedData.hints;r.needWorldViewMatrix&&e.multiplyToRef(n.getViewMatrix(),this._cachedWorldViewMatrix),r.needWorldViewProjectionMatrix&&e.multiplyToRef(n.getTransformMatrix(),this._cachedWorldViewProjectionMatrix);for(var o=0,u=this._sharedData.inputBlocks;o<u.length;o++)u[o]._transmitWorld(this._activeEffect,e,this._cachedWorldViewMatrix,this._cachedWorldViewProjectionMatrix)}},t.prototype.bindForSubMesh=function(e,n,r){var o=this.getScene(),u=r.effect;if(u){if(this._activeEffect=u,this.bindOnlyWorldMatrix(e),this._mustRebind(o,u,n.visibility)){var f=this._sharedData;if(u&&o.getCachedEffect()!==u){for(var v=0,y=f.bindableBlocks;v<y.length;v++)y[v].bind(u,this,n,r);for(var D=0,w=f.inputBlocks;D<w.length;D++)w[D]._transmit(u,o)}}this._afterBind(n,this._activeEffect)}},t.prototype.getActiveTextures=function(){var e=i.prototype.getActiveTextures.call(this);return this._sharedData&&e.push.apply(e,this._sharedData.textureBlocks.filter(function(n){return n.texture}).map(function(n){return n.texture})),e},t.prototype.getTextureBlocks=function(){return this._sharedData?this._sharedData.textureBlocks:[]},t.prototype.hasTexture=function(e){if(i.prototype.hasTexture.call(this,e))return!0;if(!this._sharedData)return!1;for(var n=0,r=this._sharedData.textureBlocks;n<r.length;n++)if(r[n].texture===e)return!0;return!1},t.prototype.dispose=function(e,n,r){if(n)for(var o=0,u=this._sharedData.textureBlocks.filter(function(y){return y.texture}).map(function(y){return y.texture});o<u.length;o++)u[o].dispose();for(var f=0,v=this.attachedBlocks;f<v.length;f++)v[f].dispose();this.onBuildObservable.clear(),i.prototype.dispose.call(this,e,n,r)},t.prototype._createNodeEditor=function(){this.BJSNODEMATERIALEDITOR=this.BJSNODEMATERIALEDITOR||this._getGlobalNodeMaterialEditor(),this.BJSNODEMATERIALEDITOR.NodeEditor.Show({nodeMaterial:this})},t.prototype.edit=function(e){var n=this;return new Promise(function(r,o){if(n.BJSNODEMATERIALEDITOR===void 0){var u=e&&e.editorURL?e.editorURL:t.EditorURL;et.b.LoadScript(u,function(){n._createNodeEditor(),r()})}else n._createNodeEditor(),r()})},t.prototype.clear=function(){this._vertexOutputNodes=[],this._fragmentOutputNodes=[],this.attachedBlocks=[]},t.prototype.setToDefault=function(){this.clear(),this.editorData=null;var e=new Bt("Position");e.setAsAttribute("position");var n=new Bt("World");n.setAsSystemValue(BABYLON.NodeMaterialSystemValues.World);var r=new Rh("WorldPos");e.connectTo(r),n.connectTo(r);var o=new Bt("ViewProjection");o.setAsSystemValue(BABYLON.NodeMaterialSystemValues.ViewProjection);var u=new Rh("WorldPos * ViewProjectionTransform");r.connectTo(u),o.connectTo(u);var f=new pl("VertexOutput");u.connectTo(f);var v=new Bt("color");v.value=new M.b(.8,.8,.8,1);var y=new Is("FragmentOutput");v.connectTo(y),this.addOutputNode(f),this.addOutputNode(y),this._mode=Dr.Material},t.prototype.setToDefaultPostProcess=function(){this.clear(),this.editorData=null;var e=new Bt("Position");e.setAsAttribute("position2d");var n=new Bt("Constant1");n.isConstant=!0,n.value=1;var r=new ml("Position3D");e.connectTo(r),n.connectTo(r,{input:"w"});var o=new pl("VertexOutput");r.connectTo(o);var u=new Bt("Scale");u.visibleInInspector=!0,u.value=new d.d(1,1);var f=new Em("uv0");e.connectTo(f);var v=new Oh("UV scale");f.connectTo(v),u.connectTo(v);var y=new vm("CurrentScreen");v.connectTo(y),y.texture=new ke.a("https://assets.babylonjs.com/nme/currentScreenPostProcess.png",this.getScene());var D=new Is("FragmentOutput");y.connectTo(D,{output:"rgba"}),this.addOutputNode(o),this.addOutputNode(D),this._mode=Dr.PostProcess},t.prototype.setToDefaultProceduralTexture=function(){this.clear(),this.editorData=null;var e=new Bt("Position");e.setAsAttribute("position2d");var n=new Bt("Constant1");n.isConstant=!0,n.value=1;var r=new ml("Position3D");e.connectTo(r),n.connectTo(r,{input:"w"});var o=new pl("VertexOutput");r.connectTo(o);var u=new Bt("Time");u.value=0,u.min=0,u.max=0,u.isBoolean=!1,u.matrixMode=0,u.animationType=Ko.Time,u.isConstant=!1;var f=new Bt("Color3");f.value=new M.a(1,1,1),f.isConstant=!1;var v=new Is("FragmentOutput"),y=new ml("VectorMerger");y.visibleInInspector=!1;var D=new Om("Cos");D.operation=Un.Cos,e.connectTo(y),u.output.connectTo(D.input),D.output.connectTo(y.z),y.xyzOut.connectTo(v.rgb),this.addOutputNode(o),this.addOutputNode(v),this._mode=Dr.ProceduralTexture},t.prototype.setToDefaultParticle=function(){this.clear(),this.editorData=null;var e=new Bt("uv");e.setAsAttribute("particle_uv");var n=new bm("ParticleTexture");e.connectTo(n);var r=new Bt("Color");r.setAsAttribute("particle_color");var o=new Oh("Texture * Color");n.connectTo(o),r.connectTo(o);var u=new ym("ParticleRampGradient");o.connectTo(u);var f=new Rm("ColorSplitter");r.connectTo(f);var v=new Tm("ParticleBlendMultiply");u.connectTo(v),n.connectTo(v,{output:"a"}),f.connectTo(v,{output:"a"});var y=new Is("FragmentOutput");v.connectTo(y),this.addOutputNode(y),this._mode=Dr.Particle},t.prototype.loadAsync=function(e){var n=this;return this.getScene()._loadFileAsync(e).then(function(r){var o=JSON.parse(r);n.loadFromSerialization(o,"")})},t.prototype._gatherBlocks=function(e,n){if(n.indexOf(e)===-1){n.push(e);for(var r=0,o=e.inputs;r<o.length;r++){var u=o[r].connectedPoint;if(u){var f=u.ownerBlock;f!==e&&this._gatherBlocks(f,n)}}}},t.prototype.generateCode=function(){for(var e=[],n=[],r=[],o=0,u=this._vertexOutputNodes;o<u.length;o++){var f=u[o];this._gatherBlocks(f,n)}for(var v=[],y=0,D=this._fragmentOutputNodes;y<D.length;y++)f=D[y],this._gatherBlocks(f,v);for(var w='var nodeMaterial = new BABYLON.NodeMaterial("'+(this.name||"node material")+`");\r
`,F=0,z=n;F<z.length;F++)(Ie=z[F]).isInput&&e.indexOf(Ie)===-1&&(w+=Ie._dumpCode(r,e));for(var k=0,K=v;k<K.length;k++)(Ie=K[k]).isInput&&e.indexOf(Ie)===-1&&(w+=Ie._dumpCode(r,e));e=[],w+=`\r
// Connections\r
`;for(var oe=0,ae=this._vertexOutputNodes;oe<ae.length;oe++)w+=(Ie=ae[oe])._dumpCodeForOutputConnections(e);for(var ue=0,de=this._fragmentOutputNodes;ue<de.length;ue++)w+=(Ie=de[ue])._dumpCodeForOutputConnections(e);w+=`\r
// Output nodes\r
`;for(var me=0,ye=this._vertexOutputNodes;me<ye.length;me++)w+="nodeMaterial.addOutputNode("+(Ie=ye[me])._codeVariableName+`);\r
`;for(var Ee=0,Ae=this._fragmentOutputNodes;Ee<Ae.length;Ee++){var Ie;w+="nodeMaterial.addOutputNode("+(Ie=Ae[Ee])._codeVariableName+`);\r
`}return w+=`nodeMaterial.build();\r
`},t.prototype.serialize=function(e){var n=e?{}:B.a.Serialize(this);n.editorData=JSON.parse(JSON.stringify(this.editorData));var r=[];if(e)r=e;else{n.customType="BABYLON.NodeMaterial",n.outputNodes=[];for(var o=0,u=this._vertexOutputNodes;o<u.length;o++){var f=u[o];this._gatherBlocks(f,r),n.outputNodes.push(f.uniqueId)}for(var v=0,y=this._fragmentOutputNodes;v<y.length;v++)f=y[v],this._gatherBlocks(f,r),n.outputNodes.indexOf(f.uniqueId)===-1&&n.outputNodes.push(f.uniqueId)}n.blocks=[];for(var D=0,w=r;D<w.length;D++){var F=w[D];n.blocks.push(F.serialize())}if(!e)for(var z=0,k=this.attachedBlocks;z<k.length;z++)F=k[z],r.indexOf(F)===-1&&n.blocks.push(F.serialize());return n},t.prototype._restoreConnections=function(e,n,r){for(var o=0,u=e.outputs;o<u.length;o++)for(var f=u[o],v=0,y=n.blocks;v<y.length;v++){var D=y[v],w=r[D.id];if(w)for(var F=0,z=D.inputs;F<z.length;F++){var k=z[F];if(!(r[k.targetBlockId]!==e||k.targetConnectionName!==f.name)){var K=w.getInputByName(k.inputName);if(!K||K.isConnected)continue;f.connectTo(K,!0),this._restoreConnections(w,n,r)}}}},t.prototype.loadFromSerialization=function(e,n,r){var o;n===void 0&&(n=""),r===void 0&&(r=!1),r||this.clear();for(var u={},f=0,v=e.blocks;f<v.length;f++){var y=v[f],D=C.a.GetClass(y.customType);D&&((F=new D)._deserialize(y,this.getScene(),n),u[y.id]=F,this.attachedBlocks.push(F))}for(var w=0;w<e.blocks.length;w++){var F;(F=u[e.blocks[w].id])&&(F.inputs.length&&!r||this._restoreConnections(F,e,u))}if(e.outputNodes)for(var z=0,k=e.outputNodes;z<k.length;z++){var K=k[z];this.addOutputNode(u[K])}if(e.locations||e.editorData&&e.editorData.locations){for(var oe=e.locations||e.editorData.locations,ae=0,ue=oe;ae<ue.length;ae++){var de=ue[ae];u[de.blockId]&&(de.blockId=u[de.blockId].uniqueId)}r&&this.editorData&&this.editorData.locations&&oe.concat(this.editorData.locations),e.locations?this.editorData={locations:oe}:(this.editorData=e.editorData,this.editorData.locations=oe);var me=[];for(var ye in u)me[ye]=u[ye].uniqueId;this.editorData.map=me}this.comment=e.comment,r||(this._mode=(o=e.mode)!==null&&o!==void 0?o:Dr.Material)},t.prototype.clone=function(e){var n=this,r=this.serialize(),o=B.a.Clone(function(){return new t(e,n.getScene(),n.options)},this);return o.id=e,o.name=e,o.loadFromSerialization(r),o.build(),o},t.Parse=function(e,n,r){r===void 0&&(r="");var o=B.a.Parse(function(){return new t(e.name,n)},e,n,r);return o.loadFromSerialization(e,r),o.build(),o},t.ParseFromFileAsync=function(e,n,r){var o=new t(e,r);return new Promise(function(u,f){return o.loadAsync(n).then(function(){o.build(),u(o)}).catch(f)})},t.ParseFromSnippetAsync=function(e,n,r,o){var u=this;return r===void 0&&(r=""),e==="_BLANK"?Promise.resolve(this.CreateDefault("blank",n)):new Promise(function(f,v){var y=new se.a;y.addEventListener("readystatechange",function(){if(y.readyState==4)if(y.status==200){var D=JSON.parse(JSON.parse(y.responseText).jsonPayload),w=JSON.parse(D.nodeMaterial);o||((o=B.a.Parse(function(){return new t(e,n)},w,n,r)).uniqueId=n.getUniqueId()),o.loadFromSerialization(w),o.snippetId=e;try{o.build(),f(o)}catch(F){v(F)}}else v("Unable to load the snippet "+e)}),y.open("GET",u.SnippetUrl+"/"+e.replace(/#/g,"/")),y.send()})},t.CreateDefault=function(e,n){var r=new t(e,n);return r.setToDefault(),r.build(),r},t._BuildIdGenerator=0,t.EditorURL="https://unpkg.com/babylonjs-node-editor@"+Ge.a.Version+"/babylon.nodeEditor.js",t.SnippetUrl="https://snippet.babylonjs.com",t.IgnoreTexturesAtLoadTime=!1,Object(p.c)([Object(B.c)("mode")],t.prototype,"_mode",void 0),Object(p.c)([Object(B.c)("comment")],t.prototype,"comment",void 0),t}(ph.a);C.a.RegisteredTypes["BABYLON.NodeMaterial"]=Dh;var eT=function(i){function t(e){var n=i.call(this,e,Me.Vertex)||this;return n.registerInput("matricesIndices",fe.Vector4),n.registerInput("matricesWeights",fe.Vector4),n.registerInput("matricesIndicesExtra",fe.Vector4,!0),n.registerInput("matricesWeightsExtra",fe.Vector4,!0),n.registerInput("world",fe.Matrix),n.registerOutput("output",fe.Matrix),n}return Object(p.d)(t,i),t.prototype.initialize=function(e){e._excludeVariableName("boneSampler"),e._excludeVariableName("boneTextureWidth"),e._excludeVariableName("mBones"),e._excludeVariableName("BonesPerMesh")},t.prototype.getClassName=function(){return"BonesBlock"},Object.defineProperty(t.prototype,"matricesIndices",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"matricesWeights",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"matricesIndicesExtra",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"matricesWeightsExtra",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"world",{get:function(){return this._inputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype.autoConfigure=function(e){if(!this.matricesIndices.isConnected){var n=e.getInputBlockByPredicate(function(u){return u.isAttribute&&u.name==="matricesIndices"});n||(n=new Bt("matricesIndices")).setAsAttribute("matricesIndices"),n.output.connectTo(this.matricesIndices)}if(!this.matricesWeights.isConnected){var r=e.getInputBlockByPredicate(function(u){return u.isAttribute&&u.name==="matricesWeights"});r||(r=new Bt("matricesWeights")).setAsAttribute("matricesWeights"),r.output.connectTo(this.matricesWeights)}if(!this.world.isConnected){var o=e.getInputBlockByPredicate(function(u){return u.systemValue===Mt.World});o||(o=new Bt("world")).setAsSystemValue(Mt.World),o.output.connectTo(this.world)}},t.prototype.provideFallbacks=function(e,n){e&&e.useBones&&e.computeBonesUsingShaders&&e.skeleton&&n.addCPUSkinningFallback(0,e)},t.prototype.bind=function(e,n,r){lt.a.BindBonesParameters(r,e)},t.prototype.prepareDefines=function(e,n,r){r._areAttributesDirty&&lt.a.PrepareDefinesForBones(e,r)},t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e),e.sharedData.blocksWithFallbacks.push(this),e.sharedData.bindableBlocks.push(this),e.sharedData.blocksWithDefines.push(this),e.uniforms.push("boneTextureWidth"),e.uniforms.push("mBones"),e.samplers.push("boneSampler");var n="//"+this.name;e._emitFunctionFromInclude("bonesDeclaration",n,{removeAttributes:!0,removeUniforms:!1,removeVaryings:!0,removeIfDef:!1});var r=e._getFreeVariableName("influence");e.compilationString+=e._emitCodeFromInclude("bonesVertex",n,{replaceStrings:[{search:/finalWorld=finalWorld\*influence;/,replace:""},{search:/influence/gm,replace:r}]});var o=this._outputs[0],u=this.world;return e.compilationString+=`#if NUM_BONE_INFLUENCERS>0\r
`,e.compilationString+=this._declareOutput(o,e)+" = "+u.associatedVariableName+" * "+r+`;\r
`,e.compilationString+=`#else\r
`,e.compilationString+=this._declareOutput(o,e)+" = "+u.associatedVariableName+`;\r
`,e.compilationString+=`#endif\r
`,this},t}(Et);C.a.RegisteredTypes["BABYLON.BonesBlock"]=eT;var tT=function(i){function t(e){var n=i.call(this,e,Me.Vertex)||this;return n.registerInput("world0",fe.Vector4),n.registerInput("world1",fe.Vector4),n.registerInput("world2",fe.Vector4),n.registerInput("world3",fe.Vector4),n.registerInput("world",fe.Matrix,!0),n.registerOutput("output",fe.Matrix),n.registerOutput("instanceID",fe.Float),n}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"InstancesBlock"},Object.defineProperty(t.prototype,"world0",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"world1",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"world2",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"world3",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"world",{get:function(){return this._inputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"instanceID",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),t.prototype.autoConfigure=function(e){if(!this.world0.connectedPoint){var n=e.getInputBlockByPredicate(function(v){return v.isAttribute&&v.name==="world0"});n||(n=new Bt("world0")).setAsAttribute("world0"),n.output.connectTo(this.world0)}if(!this.world1.connectedPoint){var r=e.getInputBlockByPredicate(function(v){return v.isAttribute&&v.name==="world1"});r||(r=new Bt("world1")).setAsAttribute("world1"),r.output.connectTo(this.world1)}if(!this.world2.connectedPoint){var o=e.getInputBlockByPredicate(function(v){return v.isAttribute&&v.name==="world2"});o||(o=new Bt("world2")).setAsAttribute("world2"),o.output.connectTo(this.world2)}if(!this.world3.connectedPoint){var u=e.getInputBlockByPredicate(function(v){return v.isAttribute&&v.name==="world3"});u||(u=new Bt("world3")).setAsAttribute("world3"),u.output.connectTo(this.world3)}if(!this.world.connectedPoint){var f=e.getInputBlockByPredicate(function(v){return v.isAttribute&&v.name==="world"});f||(f=new Bt("world")).setAsSystemValue(Mt.World),f.output.connectTo(this.world)}this.world.define="!INSTANCES || THIN_INSTANCES"},t.prototype.prepareDefines=function(e,n,r,o,u){o===void 0&&(o=!1);var f=!1;r.INSTANCES!==o&&(r.setValue("INSTANCES",o),f=!0),u&&r.THIN_INSTANCES!==!!(u==null?void 0:u.getRenderingMesh().hasThinInstances)&&(r.setValue("THIN_INSTANCES",!!(u==null?void 0:u.getRenderingMesh().hasThinInstances)),f=!0),f&&r.markAsUnprocessed()},t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e),e.sharedData.blocksWithDefines.push(this);var n=this._outputs[0],r=this._outputs[1],o=this.world0,u=this.world1,f=this.world2,v=this.world3;return e.compilationString+=`#ifdef INSTANCES\r
`,e.compilationString+=this._declareOutput(n,e)+" = mat4("+o.associatedVariableName+", "+u.associatedVariableName+", "+f.associatedVariableName+", "+v.associatedVariableName+`);\r
`,e.compilationString+=`#ifdef THIN_INSTANCES\r
`,e.compilationString+=n.associatedVariableName+" = "+this.world.associatedVariableName+" * "+n.associatedVariableName+`;\r
`,e.compilationString+=`#endif\r
`,e.compilationString+=this._declareOutput(r,e)+` = float(gl_InstanceID);\r
`,e.compilationString+=`#else\r
`,e.compilationString+=this._declareOutput(n,e)+" = "+this.world.associatedVariableName+`;\r
`,e.compilationString+=this._declareOutput(r,e)+` = 0.0;\r
`,e.compilationString+=`#endif\r
`,this},t}(Et);C.a.RegisteredTypes["BABYLON.InstancesBlock"]=tT;var nT=function(i){function t(e){var n=i.call(this,e,Me.Vertex)||this;return n.registerInput("position",fe.Vector3),n.registerInput("normal",fe.Vector3),n.registerInput("tangent",fe.Vector3),n.registerInput("uv",fe.Vector2),n.registerOutput("positionOutput",fe.Vector3),n.registerOutput("normalOutput",fe.Vector3),n.registerOutput("tangentOutput",fe.Vector3),n.registerOutput("uvOutput",fe.Vector2),n}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"MorphTargetsBlock"},Object.defineProperty(t.prototype,"position",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"normal",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tangent",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"uv",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"positionOutput",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"normalOutput",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tangentOutput",{get:function(){return this._outputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"uvOutput",{get:function(){return this._outputs[3]},enumerable:!1,configurable:!0}),t.prototype.initialize=function(e){e._excludeVariableName("morphTargetInfluences")},t.prototype.autoConfigure=function(e){if(!this.position.isConnected){var n=e.getInputBlockByPredicate(function(f){return f.isAttribute&&f.name==="position"});n||(n=new Bt("position")).setAsAttribute(),n.output.connectTo(this.position)}if(!this.normal.isConnected){var r=e.getInputBlockByPredicate(function(f){return f.isAttribute&&f.name==="normal"});r||(r=new Bt("normal")).setAsAttribute("normal"),r.output.connectTo(this.normal)}if(!this.tangent.isConnected){var o=e.getInputBlockByPredicate(function(f){return f.isAttribute&&f.name==="tangent"});o||(o=new Bt("tangent")).setAsAttribute("tangent"),o.output.connectTo(this.tangent)}if(!this.uv.isConnected){var u=e.getInputBlockByPredicate(function(f){return f.isAttribute&&f.name==="uv"});u||(u=new Bt("uv")).setAsAttribute("uv"),u.output.connectTo(this.uv)}},t.prototype.prepareDefines=function(e,n,r){r._areAttributesDirty&&lt.a.PrepareDefinesForMorphTargets(e,r)},t.prototype.bind=function(e,n,r){r&&r.morphTargetManager&&r.morphTargetManager.numInfluencers>0&&lt.a.BindMorphTargetParameters(r,e)},t.prototype.replaceRepeatableContent=function(e,n,r,o){for(var u=this.position,f=this.normal,v=this.tangent,y=this.uv,D=this.positionOutput,w=this.normalOutput,F=this.tangentOutput,z=this.uvOutput,k=e,K=o.NUM_MORPH_INFLUENCERS,oe=r.morphTargetManager,ae=oe&&oe.supportsNormals&&o.NORMAL,ue=oe&&oe.supportsTangents&&o.TANGENT,de=oe&&oe.supportsUVs&&o.UV1,me="",ye=0;ye<K;ye++)me+=`#ifdef MORPHTARGETS\r
`,me+=D.associatedVariableName+" += (position"+ye+" - "+u.associatedVariableName+") * morphTargetInfluences["+ye+`];\r
`,ae&&(me+=`#ifdef MORPHTARGETS_NORMAL\r
`,me+=w.associatedVariableName+" += (normal"+ye+" - "+f.associatedVariableName+") * morphTargetInfluences["+ye+`];\r
`,me+=`#endif\r
`),ue&&(me+=`#ifdef MORPHTARGETS_TANGENT\r
`,me+=F.associatedVariableName+".xyz += (tangent"+ye+" - "+v.associatedVariableName+".xyz) * morphTargetInfluences["+ye+`];\r
`,me+=`#endif\r
`),de&&(me+=`#ifdef MORPHTARGETS_UV\r
`,me+=z.associatedVariableName+".xy += (uv_"+ye+" - "+y.associatedVariableName+".xy) * morphTargetInfluences["+ye+`];\r
`,me+=`#endif\r
`),me+=`#endif\r
`;if(k.compilationString=k.compilationString.replace(this._repeatableContentAnchor,me),K>0)for(ye=0;ye<K;ye++)k.attributes.push(De.b.PositionKind+ye),ae&&k.attributes.push(De.b.NormalKind+ye),ue&&k.attributes.push(De.b.TangentKind+ye),de&&k.attributes.push(De.b.UVKind+"_"+ye)},t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e),e.sharedData.blocksWithDefines.push(this),e.sharedData.bindableBlocks.push(this),e.sharedData.repeatableContentBlocks.push(this);var n=this.position,r=this.normal,o=this.tangent,u=this.uv,f=this.positionOutput,v=this.normalOutput,y=this.tangentOutput,D=this.uvOutput,w="//"+this.name;return e.uniforms.push("morphTargetInfluences"),e._emitFunctionFromInclude("morphTargetsVertexGlobalDeclaration",w),e._emitFunctionFromInclude("morphTargetsVertexDeclaration",w,{repeatKey:"maxSimultaneousMorphTargets"}),e.compilationString+=this._declareOutput(f,e)+" = "+n.associatedVariableName+`;\r
`,e.compilationString+=`#ifdef NORMAL\r
`,e.compilationString+=this._declareOutput(v,e)+" = "+r.associatedVariableName+`;\r
`,e.compilationString+=`#else\r
`,e.compilationString+=this._declareOutput(v,e)+` = vec3(0., 0., 0.);\r
`,e.compilationString+=`#endif\r
`,e.compilationString+=`#ifdef TANGENT\r
`,e.compilationString+=this._declareOutput(y,e)+" = "+o.associatedVariableName+`;\r
`,e.compilationString+=`#else\r
`,e.compilationString+=this._declareOutput(y,e)+` = vec3(0., 0., 0.);\r
`,e.compilationString+=`#endif\r
`,e.compilationString+=`#ifdef UV1\r
`,e.compilationString+=this._declareOutput(D,e)+" = "+u.associatedVariableName+`;\r
`,e.compilationString+=`#else\r
`,e.compilationString+=this._declareOutput(D,e)+` = vec2(0., 0.);\r
`,e.compilationString+=`#endif\r
`,this._repeatableContentAnchor=e._repeatableContentAnchor,e.compilationString+=this._repeatableContentAnchor,this},t}(Et);C.a.RegisteredTypes["BABYLON.MorphTargetsBlock"]=nT;var rT=function(i){function t(e){var n=i.call(this,e,Me.Vertex)||this;return n.registerInput("worldPosition",fe.Vector4,!1,Me.Vertex),n.registerOutput("direction",fe.Vector3),n.registerOutput("color",fe.Color3),n.registerOutput("intensity",fe.Float),n}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"LightInformationBlock"},Object.defineProperty(t.prototype,"worldPosition",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"direction",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"intensity",{get:function(){return this._outputs[2]},enumerable:!1,configurable:!0}),t.prototype.bind=function(e,n,r){if(r){this.light&&this.light.isDisposed&&(this.light=null);var o=this.light,u=n.getScene();if(!o&&u.lights.length&&(o=u.lights[0]),!o||!o.isEnabled)return e.setFloat3(this._lightDataUniformName,0,0,0),void e.setFloat4(this._lightColorUniformName,0,0,0,0);o.transferToNodeMaterialEffect(e,this._lightDataUniformName),e.setColor4(this._lightColorUniformName,o.diffuse,o.intensity)}},t.prototype.prepareDefines=function(e,n,r){if(r._areLightsDirty){var o=this.light;r.setValue(this._lightTypeDefineName,!!(o&&o instanceof lm))}},t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e),e.sharedData.bindableBlocks.push(this),e.sharedData.blocksWithDefines.push(this);var n=this.direction,r=this.color,o=this.intensity;return this._lightDataUniformName=e._getFreeVariableName("lightData"),this._lightColorUniformName=e._getFreeVariableName("lightColor"),this._lightTypeDefineName=e._getFreeDefineName("LIGHTPOINTTYPE"),e._emitUniformFromString(this._lightDataUniformName,"vec3"),e._emitUniformFromString(this._lightColorUniformName,"vec4"),e.compilationString+="#ifdef "+this._lightTypeDefineName+`\r
`,e.compilationString+=this._declareOutput(n,e)+" = normalize("+this.worldPosition.associatedVariableName+".xyz - "+this._lightDataUniformName+`);\r
`,e.compilationString+=`#else\r
`,e.compilationString+=this._declareOutput(n,e)+" = "+this._lightDataUniformName+`;\r
`,e.compilationString+=`#endif\r
`,e.compilationString+=this._declareOutput(r,e)+" = "+this._lightColorUniformName+`.rgb;\r
`,e.compilationString+=this._declareOutput(o,e)+" = "+this._lightColorUniformName+`.a;\r
`,this},t.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return this.light&&(e.lightId=this.light.id),e},t.prototype._deserialize=function(e,n,r){i.prototype._deserialize.call(this,e,n,r),e.lightId&&(this.light=n.getLightByID(e.lightId))},t}(Et);C.a.RegisteredTypes["BABYLON.LightInformationBlock"]=rT;var iT=function(i){function t(e){var n=i.call(this,e,Me.Fragment)||this;return n.registerInput("color",fe.Color4),n.registerOutput("output",fe.Color4),n._inputs[0].acceptedConnectionPointTypes.push(fe.Color3),n}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"ImageProcessingBlock"},Object.defineProperty(t.prototype,"color",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype.initialize=function(e){e._excludeVariableName("exposureLinear"),e._excludeVariableName("contrast"),e._excludeVariableName("vInverseScreenSize"),e._excludeVariableName("vignetteSettings1"),e._excludeVariableName("vignetteSettings2"),e._excludeVariableName("vCameraColorCurveNegative"),e._excludeVariableName("vCameraColorCurveNeutral"),e._excludeVariableName("vCameraColorCurvePositive"),e._excludeVariableName("txColorTransform"),e._excludeVariableName("colorTransformSettings")},t.prototype.isReady=function(e,n,r){return!(r._areImageProcessingDirty&&n.imageProcessingConfiguration&&!n.imageProcessingConfiguration.isReady())},t.prototype.prepareDefines=function(e,n,r){r._areImageProcessingDirty&&n.imageProcessingConfiguration&&n.imageProcessingConfiguration.prepareDefines(r)},t.prototype.bind=function(e,n,r){r&&n.imageProcessingConfiguration&&n.imageProcessingConfiguration.bind(e)},t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e),e.sharedData.blocksWithDefines.push(this),e.sharedData.blockingBlocks.push(this),e.sharedData.bindableBlocks.push(this),e.uniforms.push("exposureLinear"),e.uniforms.push("contrast"),e.uniforms.push("vInverseScreenSize"),e.uniforms.push("vignetteSettings1"),e.uniforms.push("vignetteSettings2"),e.uniforms.push("vCameraColorCurveNegative"),e.uniforms.push("vCameraColorCurveNeutral"),e.uniforms.push("vCameraColorCurvePositive"),e.uniforms.push("txColorTransform"),e.uniforms.push("colorTransformSettings");var n=this.color,r=this._outputs[0],o="//"+this.name;return e._emitFunctionFromInclude("helperFunctions",o),e._emitFunctionFromInclude("imageProcessingDeclaration",o),e._emitFunctionFromInclude("imageProcessingFunctions",o),n.connectedPoint.type===fe.Color4||n.connectedPoint.type===fe.Vector4?e.compilationString+=this._declareOutput(r,e)+" = "+n.associatedVariableName+`;\r
`:e.compilationString+=this._declareOutput(r,e)+" = vec4("+n.associatedVariableName+`, 1.0);\r
`,e.compilationString+=`#ifdef IMAGEPROCESSINGPOSTPROCESS\r
`,e.compilationString+=r.associatedVariableName+".rgb = toLinearSpace("+n.associatedVariableName+`.rgb);\r
`,e.compilationString+=`#else\r
`,e.compilationString+=`#ifdef IMAGEPROCESSING\r
`,e.compilationString+=r.associatedVariableName+".rgb = toLinearSpace("+n.associatedVariableName+`.rgb);\r
`,e.compilationString+=r.associatedVariableName+" = applyImageProcessing("+r.associatedVariableName+`);\r
`,e.compilationString+=`#endif\r
`,e.compilationString+=`#endif\r
`,this},t}(Et);C.a.RegisteredTypes["BABYLON.ImageProcessingBlock"]=iT;var oT=function(i){function t(e){var n=i.call(this,e,Me.Fragment)||this;return n._tangentSpaceParameterName="",n.invertX=!1,n.invertY=!1,n.registerInput("worldPosition",fe.Vector4,!1),n.registerInput("worldNormal",fe.Vector4,!1),n.registerInput("worldTangent",fe.Vector4,!0),n.registerInput("uv",fe.Vector2,!1),n.registerInput("normalMapColor",fe.Color3,!1),n.registerInput("strength",fe.Float,!1),n.registerOutput("output",fe.Vector4),n}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"PerturbNormalBlock"},Object.defineProperty(t.prototype,"worldPosition",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"worldNormal",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"worldTangent",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"uv",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"normalMapColor",{get:function(){return this._inputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"strength",{get:function(){return this._inputs[5]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype.prepareDefines=function(e,n,r){r.setValue("BUMP",!0)},t.prototype.bind=function(e,n,r){n.getScene()._mirroredCameraPosition?e.setFloat2(this._tangentSpaceParameterName,this.invertX?1:-1,this.invertY?1:-1):e.setFloat2(this._tangentSpaceParameterName,this.invertX?-1:1,this.invertY?-1:1)},t.prototype.autoConfigure=function(e){if(!this.uv.isConnected){var n=e.getInputBlockByPredicate(function(o){return o.isAttribute&&o.name==="uv"});n||(n=new Bt("uv")).setAsAttribute(),n.output.connectTo(this.uv)}if(!this.strength.isConnected){var r=new Bt("strength");r.value=1,r.output.connectTo(this.strength)}},t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n="//"+this.name,r=this.uv,o=this.worldPosition,u=this.worldNormal,f=this.worldTangent;e.sharedData.blocksWithDefines.push(this),e.sharedData.bindableBlocks.push(this),this._tangentSpaceParameterName=e._getFreeDefineName("tangentSpaceParameter"),e._emitUniformFromString(this._tangentSpaceParameterName,"vec2");var v=this.strength.isConnectedToInputBlock&&this.strength.connectInputBlock.isConstant?""+e._emitFloat(1/this.strength.connectInputBlock.value):"1.0 / "+this.strength.associatedVariableName;e._emitExtension("derivatives","#extension GL_OES_standard_derivatives : enable");var y={search:/defined\(TANGENT\)/g,replace:f.isConnected?"defined(TANGENT)":"defined(IGNORE)"};return f.isConnected&&(e.compilationString+="vec3 tbnNormal = normalize("+u.associatedVariableName+`.xyz);\r
`,e.compilationString+="vec3 tbnTangent = normalize("+f.associatedVariableName+`.xyz);\r
`,e.compilationString+=`vec3 tbnBitangent = cross(tbnNormal, tbnTangent);\r
`,e.compilationString+=`mat3 vTBN = mat3(tbnTangent, tbnBitangent, tbnNormal);\r
`),e._emitFunctionFromInclude("bumpFragmentMainFunctions",n,{replaceStrings:[y]}),e._emitFunctionFromInclude("bumpFragmentFunctions",n,{replaceStrings:[{search:/vBumpInfos.y/g,replace:v},{search:/vTangentSpaceParams/g,replace:this._tangentSpaceParameterName},{search:/vPositionW/g,replace:o.associatedVariableName+".xyz"}]}),e.compilationString+=this._declareOutput(this.output,e)+` = vec4(0.);\r
`,e.compilationString+=e._emitCodeFromInclude("bumpFragment",n,{replaceStrings:[{search:/perturbNormal\(TBN,vBumpUV\+uvOffset\)/g,replace:"perturbNormal(TBN, "+this.normalMapColor.associatedVariableName+")"},{search:/vBumpInfos.y/g,replace:v},{search:/vBumpUV/g,replace:r.associatedVariableName},{search:/vPositionW/g,replace:o.associatedVariableName+".xyz"},{search:/normalW=/g,replace:this.output.associatedVariableName+".xyz = "},{search:/mat3\(normalMatrix\)\*normalW/g,replace:"mat3(normalMatrix) * "+this.output.associatedVariableName+".xyz"},{search:/normalW/g,replace:u.associatedVariableName+".xyz"},y]}),this},t.prototype._dumpPropertiesCode=function(){var e=this._codeVariableName+".invertX = "+this.invertX+`;\r
`;return e+=this._codeVariableName+".invertY = "+this.invertY+`;\r
`},t.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return e.invertX=this.invertX,e.invertY=this.invertY,e},t.prototype._deserialize=function(e,n,r){i.prototype._deserialize.call(this,e,n,r),this.invertX=e.invertX,this.invertY=e.invertY},Object(p.c)([sn("Invert X axis",$t.Boolean,"PROPERTIES",{notifiers:{update:!1}})],t.prototype,"invertX",void 0),Object(p.c)([sn("Invert Y axis",$t.Boolean,"PROPERTIES",{notifiers:{update:!1}})],t.prototype,"invertY",void 0),t}(Et);C.a.RegisteredTypes["BABYLON.PerturbNormalBlock"]=oT;var aT=function(i){function t(e){var n=i.call(this,e,Me.Fragment,!0)||this;return n.registerInput("value",fe.Float,!0),n.registerInput("cutoff",fe.Float,!0),n}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"DiscardBlock"},Object.defineProperty(t.prototype,"value",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cutoff",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){if(i.prototype._buildBlock.call(this,e),e.sharedData.hints.needAlphaTesting=!0,this.cutoff.isConnected&&this.value.isConnected)return e.compilationString+="if ("+this.value.associatedVariableName+" < "+this.cutoff.associatedVariableName+`) discard;\r
`,this},t}(Et);C.a.RegisteredTypes["BABYLON.DiscardBlock"]=aT;var sT=function(i){function t(e){var n=i.call(this,e,Me.Fragment)||this;return n.registerOutput("output",fe.Float,Me.Fragment),n}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"FrontFacingBlock"},Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){if(i.prototype._buildBlock.call(this,e),e.target===Me.Vertex)throw"FrontFacingBlock must only be used in a fragment shader";var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+` = gl_FrontFacing ? 1.0 : 0.0;\r
`,this},t}(Et);C.a.RegisteredTypes["BABYLON.FrontFacingBlock"]=sT;var cT=function(i){function t(e){var n=i.call(this,e,Me.Fragment)||this;return n.registerInput("input",fe.AutoDetect,!1),n.registerOutput("dx",fe.BasedOnInput),n.registerOutput("dy",fe.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n._outputs[1]._typeConnectionSource=n._inputs[0],n}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"DerivativeBlock"},Object.defineProperty(t.prototype,"input",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dx",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dy",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0],r=this._outputs[1];return e._emitExtension("derivatives","#extension GL_OES_standard_derivatives : enable"),n.hasEndpoints&&(e.compilationString+=this._declareOutput(n,e)+" = dFdx("+this.input.associatedVariableName+`);\r
`),r.hasEndpoints&&(e.compilationString+=this._declareOutput(r,e)+" = dFdy("+this.input.associatedVariableName+`);\r
`),this},t}(Et);C.a.RegisteredTypes["BABYLON.DerivativeBlock"]=cT;var lT=function(i){function t(e){var n=i.call(this,e,Me.Fragment)||this;return n.registerOutput("xy",fe.Vector2,Me.Fragment),n.registerOutput("xyz",fe.Vector3,Me.Fragment),n.registerOutput("xyzw",fe.Vector4,Me.Fragment),n.registerOutput("x",fe.Float,Me.Fragment),n.registerOutput("y",fe.Float,Me.Fragment),n.registerOutput("z",fe.Float,Me.Fragment),n.registerOutput("w",fe.Float,Me.Fragment),n}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"FragCoordBlock"},Object.defineProperty(t.prototype,"xy",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"xyz",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"xyzw",{get:function(){return this._outputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"x",{get:function(){return this._outputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._outputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"z",{get:function(){return this._outputs[5]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[6]},enumerable:!1,configurable:!0}),t.prototype.writeOutputs=function(e){for(var n="",r=0,o=this._outputs;r<o.length;r++){var u=o[r];u.hasEndpoints&&(n+=this._declareOutput(u,e)+" = gl_FragCoord."+u.name+`;\r
`)}return n},t.prototype._buildBlock=function(e){if(i.prototype._buildBlock.call(this,e),e.target===Me.Vertex)throw"FragCoordBlock must only be used in a fragment shader";return e.compilationString+=this.writeOutputs(e),this},t}(Et);C.a.RegisteredTypes["BABYLON.FragCoordBlock"]=lT;var uT=function(i){function t(e){var n=i.call(this,e,Me.Fragment)||this;return n.registerOutput("xy",fe.Vector2,Me.Fragment),n.registerOutput("x",fe.Float,Me.Fragment),n.registerOutput("y",fe.Float,Me.Fragment),n}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"ScreenSizeBlock"},Object.defineProperty(t.prototype,"xy",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"x",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._outputs[2]},enumerable:!1,configurable:!0}),t.prototype.bind=function(e,n,r){var o=this._scene.getEngine();e.setFloat2(this._varName,o.getRenderWidth(),o.getRenderWidth())},t.prototype.writeOutputs=function(e,n){for(var r="",o=0,u=this._outputs;o<u.length;o++){var f=u[o];f.hasEndpoints&&(r+=this._declareOutput(f,e)+" = "+n+"."+f.name+`;\r
`)}return r},t.prototype._buildBlock=function(e){if(i.prototype._buildBlock.call(this,e),this._scene=e.sharedData.scene,e.target===Me.Vertex)throw"ScreenSizeBlock must only be used in a fragment shader";return e.sharedData.bindableBlocks.push(this),this._varName=e._getFreeVariableName("screenSize"),e._emitUniformFromString(this._varName,"vec2"),e.compilationString+=this.writeOutputs(e,this._varName),this},t}(Et);C.a.RegisteredTypes["BABYLON.ScreenSizeBlock"]=uT;var hT=function(i){function t(e){var n=i.call(this,e,Me.VertexAndFragment,!0)||this;return n.registerInput("worldPosition",fe.Vector4,!1,Me.Vertex),n.registerInput("view",fe.Matrix,!1,Me.Vertex),n.registerInput("input",fe.Color3,!1,Me.Fragment),n.registerInput("fogColor",fe.Color3,!1,Me.Fragment),n.registerOutput("output",fe.Color3,Me.Fragment),n.input.acceptedConnectionPointTypes.push(fe.Color4),n.fogColor.acceptedConnectionPointTypes.push(fe.Color4),n}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"FogBlock"},Object.defineProperty(t.prototype,"worldPosition",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"view",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"input",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fogColor",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype.autoConfigure=function(e){if(!this.view.isConnected){var n=e.getInputBlockByPredicate(function(o){return o.systemValue===Mt.View});n||(n=new Bt("view")).setAsSystemValue(Mt.View),n.output.connectTo(this.view)}if(!this.fogColor.isConnected){var r=e.getInputBlockByPredicate(function(o){return o.systemValue===Mt.FogColor});r||(r=new Bt("fogColor",void 0,fe.Color3)).setAsSystemValue(Mt.FogColor),r.output.connectTo(this.fogColor)}},t.prototype.prepareDefines=function(e,n,r){var o=e.getScene();r.setValue("FOG",n.fogEnabled&&lt.a.GetFogState(e,o))},t.prototype.bind=function(e,n,r){if(r){var o=r.getScene();e.setFloat4(this._fogParameters,o.fogMode,o.fogStart,o.fogEnd,o.fogDensity)}},t.prototype._buildBlock=function(e){if(i.prototype._buildBlock.call(this,e),e.target===Me.Fragment){e.sharedData.blocksWithDefines.push(this),e.sharedData.bindableBlocks.push(this),e._emitFunctionFromInclude("fogFragmentDeclaration","//"+this.name,{removeUniforms:!0,removeVaryings:!0,removeIfDef:!1,replaceStrings:[{search:/float CalcFogFactor\(\)/,replace:"float CalcFogFactor(vec3 vFogDistance, vec4 vFogInfos)"}]});var n=e._getFreeVariableName("fog"),r=this.input,o=this.fogColor;this._fogParameters=e._getFreeVariableName("fogParameters");var u=this._outputs[0];e._emitUniformFromString(this._fogParameters,"vec4"),e.compilationString+=`#ifdef FOG\r
`,e.compilationString+="float "+n+" = CalcFogFactor("+this._fogDistanceName+", "+this._fogParameters+`);\r
`,e.compilationString+=this._declareOutput(u,e)+" = "+n+" * "+r.associatedVariableName+".rgb + (1.0 - "+n+") * "+o.associatedVariableName+`.rgb;\r
`,e.compilationString+=`#else\r
`+this._declareOutput(u,e)+" =  "+r.associatedVariableName+`.rgb;\r
`,e.compilationString+=`#endif\r
`}else{var f=this.worldPosition,v=this.view;this._fogDistanceName=e._getFreeVariableName("vFogDistance"),e._emitVaryingFromString(this._fogDistanceName,"vec3"),e.compilationString+=this._fogDistanceName+" = ("+v.associatedVariableName+" * "+f.associatedVariableName+`).xyz;\r
`}return this},t}(Et);C.a.RegisteredTypes["BABYLON.FogBlock"]=hT;var dT=function(i){function t(e){var n=i.call(this,e,Me.VertexAndFragment)||this;return n._isUnique=!0,n.registerInput("worldPosition",fe.Vector4,!1,Me.Vertex),n.registerInput("worldNormal",fe.Vector4,!1,Me.Fragment),n.registerInput("cameraPosition",fe.Vector3,!1,Me.Fragment),n.registerInput("glossiness",fe.Float,!0,Me.Fragment),n.registerInput("glossPower",fe.Float,!0,Me.Fragment),n.registerInput("diffuseColor",fe.Color3,!0,Me.Fragment),n.registerInput("specularColor",fe.Color3,!0,Me.Fragment),n.registerInput("view",fe.Matrix,!0),n.registerOutput("diffuseOutput",fe.Color3,Me.Fragment),n.registerOutput("specularOutput",fe.Color3,Me.Fragment),n.registerOutput("shadow",fe.Float,Me.Fragment),n}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"LightBlock"},Object.defineProperty(t.prototype,"worldPosition",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"worldNormal",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraPosition",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"glossiness",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"glossPower",{get:function(){return this._inputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"diffuseColor",{get:function(){return this._inputs[5]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"specularColor",{get:function(){return this._inputs[6]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"view",{get:function(){return this._inputs[7]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"diffuseOutput",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"specularOutput",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"shadow",{get:function(){return this._outputs[2]},enumerable:!1,configurable:!0}),t.prototype.autoConfigure=function(e){if(!this.cameraPosition.isConnected){var n=e.getInputBlockByPredicate(function(r){return r.systemValue===Mt.CameraPosition});n||(n=new Bt("cameraPosition")).setAsSystemValue(Mt.CameraPosition),n.output.connectTo(this.cameraPosition)}},t.prototype.prepareDefines=function(e,n,r){if(r._areLightsDirty){var o=e.getScene();if(this.light){var u={needNormals:!1,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};lt.a.PrepareDefinesForLight(o,e,this.light,this._lightId,r,!0,u),u.needRebuild&&r.rebuild()}else lt.a.PrepareDefinesForLights(o,e,r,!0,n.maxSimultaneousLights)}},t.prototype.updateUniformsAndSamples=function(e,n,r,o){for(var u=0;u<n.maxSimultaneousLights&&r["LIGHT"+u];u++){var f=e.uniforms.indexOf("vLightData"+u)>=0;lt.a.PrepareUniformsAndSamplersForLight(u,e.uniforms,e.samplers,r["PROJECTEDLIGHTTEXTURE"+u],o,f)}},t.prototype.bind=function(e,n,r){if(r){var o=r.getScene();this.light?lt.a.BindLight(this.light,this._lightId,o,e,!0):lt.a.BindLights(o,r,e,!0,n.maxSimultaneousLights)}},t.prototype._injectVertexCode=function(e){var n=this.worldPosition,r="//"+this.name;this.light?(this._lightId=(e.counters.lightCounter!==void 0?e.counters.lightCounter:-1)+1,e.counters.lightCounter=this._lightId,e._emitFunctionFromInclude(e.supportUniformBuffers?"lightUboDeclaration":"lightFragmentDeclaration",r,{replaceStrings:[{search:/{X}/g,replace:this._lightId.toString()}]},this._lightId.toString())):(e._emitFunctionFromInclude(e.supportUniformBuffers?"lightUboDeclaration":"lightFragmentDeclaration",r,{repeatKey:"maxSimultaneousLights"}),this._lightId=0,e.sharedData.dynamicUniformBlocks.push(this));var o="v_"+n.associatedVariableName;e._emitVaryingFromString(o,"vec4")&&(e.compilationString+=o+" = "+n.associatedVariableName+`;\r
`),this.light?e.compilationString+=e._emitCodeFromInclude("shadowsVertex",r,{replaceStrings:[{search:/{X}/g,replace:this._lightId.toString()},{search:/worldPos/g,replace:n.associatedVariableName}]}):(e.compilationString+="vec4 worldPos = "+n.associatedVariableName+`;\r
`,this.view.isConnected&&(e.compilationString+="mat4 view = "+this.view.associatedVariableName+`;\r
`),e.compilationString+=e._emitCodeFromInclude("shadowsVertex",r,{repeatKey:"maxSimultaneousLights"}))},t.prototype._buildBlock=function(e){if(i.prototype._buildBlock.call(this,e),e.target===Me.Fragment){e.sharedData.bindableBlocks.push(this),e.sharedData.blocksWithDefines.push(this);var n="//"+this.name,r=this.worldPosition;e._emitFunctionFromInclude("helperFunctions",n),e._emitFunctionFromInclude("lightsFragmentFunctions",n,{replaceStrings:[{search:/vPositionW/g,replace:"v_"+r.associatedVariableName+".xyz"}]}),e._emitFunctionFromInclude("shadowsFragmentFunctions",n,{replaceStrings:[{search:/vPositionW/g,replace:"v_"+r.associatedVariableName+".xyz"}]}),this.light?e._emitFunctionFromInclude(e.supportUniformBuffers?"lightUboDeclaration":"lightFragmentDeclaration",n,{replaceStrings:[{search:/{X}/g,replace:this._lightId.toString()}]},this._lightId.toString()):e._emitFunctionFromInclude(e.supportUniformBuffers?"lightUboDeclaration":"lightFragmentDeclaration",n,{repeatKey:"maxSimultaneousLights"}),this._lightId===0&&(e._registerTempVariable("viewDirectionW")&&(e.compilationString+="vec3 viewDirectionW = normalize("+this.cameraPosition.associatedVariableName+" - v_"+r.associatedVariableName+`.xyz);\r
`),e.compilationString+=`lightingInfo info;\r
`,e.compilationString+=`float shadow = 1.;\r
`,e.compilationString+="float glossiness = "+(this.glossiness.isConnected?this.glossiness.associatedVariableName:"1.0")+" * "+(this.glossPower.isConnected?this.glossPower.associatedVariableName:"1024.0")+`;\r
`,e.compilationString+=`vec3 diffuseBase = vec3(0., 0., 0.);\r
`,e.compilationString+=`vec3 specularBase = vec3(0., 0., 0.);\r
`,e.compilationString+="vec3 normalW = "+this.worldNormal.associatedVariableName+`.xyz;\r
`),this.light?e.compilationString+=e._emitCodeFromInclude("lightFragment",n,{replaceStrings:[{search:/{X}/g,replace:this._lightId.toString()}]}):e.compilationString+=e._emitCodeFromInclude("lightFragment",n,{repeatKey:"maxSimultaneousLights"});var o=this.diffuseOutput,u=this.specularOutput;return e.compilationString+=this._declareOutput(o,e)+" = diffuseBase"+(this.diffuseColor.isConnected?" * "+this.diffuseColor.associatedVariableName:"")+`;\r
`,u.hasEndpoints&&(e.compilationString+=this._declareOutput(u,e)+" = specularBase"+(this.specularColor.isConnected?" * "+this.specularColor.associatedVariableName:"")+`;\r
`),this.shadow.hasEndpoints&&(e.compilationString+=this._declareOutput(this.shadow,e)+` = shadow;\r
`),this}this._injectVertexCode(e)},t.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return this.light&&(e.lightId=this.light.id),e},t.prototype._deserialize=function(e,n,r){i.prototype._deserialize.call(this,e,n,r),e.lightId&&(this.light=n.getLightByID(e.lightId))},t}(Et);C.a.RegisteredTypes["BABYLON.LightBlock"]=dT;var fT=function(i){function t(e,n){n===void 0&&(n=!1);var r=i.call(this,e,n?Me.Fragment:Me.VertexAndFragment)||this;return r.convertToGammaSpace=!1,r.convertToLinearSpace=!1,r._fragmentOnly=n,r.registerInput("uv",fe.Vector2,!1,Me.VertexAndFragment),r.registerOutput("rgba",fe.Color4,Me.Neutral),r.registerOutput("rgb",fe.Color3,Me.Neutral),r.registerOutput("r",fe.Float,Me.Neutral),r.registerOutput("g",fe.Float,Me.Neutral),r.registerOutput("b",fe.Float,Me.Neutral),r.registerOutput("a",fe.Float,Me.Neutral),r._inputs[0].acceptedConnectionPointTypes.push(fe.Vector3),r._inputs[0].acceptedConnectionPointTypes.push(fe.Vector4),r._inputs[0]._prioritizeVertex=!n,r}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"TextureBlock"},Object.defineProperty(t.prototype,"uv",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rgba",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rgb",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"r",{get:function(){return this._outputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"g",{get:function(){return this._outputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"b",{get:function(){return this._outputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"a",{get:function(){return this._outputs[5]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"target",{get:function(){if(this._fragmentOnly)return Me.Fragment;if(!this.uv.isConnected||this.uv.sourceBlock.isInput)return Me.VertexAndFragment;for(var e=this.uv.connectedPoint;e;){if(e.target===Me.Fragment)return Me.Fragment;if(e.target===Me.Vertex)return Me.VertexAndFragment;if(e.target===Me.Neutral||e.target===Me.VertexAndFragment){var n=e.ownerBlock;e=null;for(var r=0,o=n.inputs;r<o.length;r++){var u=o[r];if(u.connectedPoint){e=u.connectedPoint;break}}}}return Me.VertexAndFragment},enumerable:!1,configurable:!0}),t.prototype.autoConfigure=function(e){if(!this.uv.isConnected)if(e.mode===Dr.PostProcess)(n=e.getBlockByPredicate(function(o){return o.name==="uv"}))&&n.connectTo(this);else{var n,r=e.mode===Dr.Particle?"particle_uv":"uv";(n=e.getInputBlockByPredicate(function(o){return o.isAttribute&&o.name===r}))||(n=new Bt("uv")).setAsAttribute(r),n.output.connectTo(this.uv)}},t.prototype.initializeDefines=function(e,n,r,o){r._areTexturesDirty&&r.setValue(this._mainUVDefineName,!1)},t.prototype.prepareDefines=function(e,n,r){if(r._areTexturesDirty){if(!this.texture||!this.texture.getTextureMatrix)return r.setValue(this._defineName,!1),void r.setValue(this._mainUVDefineName,!0);r.setValue(this._linearDefineName,this.convertToGammaSpace),r.setValue(this._gammaDefineName,this.convertToLinearSpace),this._isMixed&&(this.texture.getTextureMatrix().isIdentityAs3x2()?(r.setValue(this._defineName,!1),r.setValue(this._mainUVDefineName,!0)):r.setValue(this._defineName,!0))}},t.prototype.isReady=function(){return!(this.texture&&!this.texture.isReadyOrNotBlocking())},t.prototype.bind=function(e,n,r){this.texture&&(this._isMixed&&(e.setFloat(this._textureInfoName,this.texture.level),e.setMatrix(this._textureTransformName,this.texture.getTextureMatrix())),e.setTexture(this._samplerName,this.texture))},Object.defineProperty(t.prototype,"_isMixed",{get:function(){return this.target!==Me.Fragment},enumerable:!1,configurable:!0}),t.prototype._injectVertexCode=function(e){var n=this.uv;if(this._defineName=e._getFreeDefineName("UVTRANSFORM"),this._mainUVDefineName="VMAIN"+n.associatedVariableName.toUpperCase(),n.connectedPoint.ownerBlock.isInput&&(n.connectedPoint.ownerBlock.isAttribute||e._emitUniformFromString(n.associatedVariableName,"vec2")),this._mainUVName="vMain"+n.associatedVariableName,this._transformedUVName=e._getFreeVariableName("transformedUV"),this._textureTransformName=e._getFreeVariableName("textureTransform"),this._textureInfoName=e._getFreeVariableName("textureInfoName"),e._emitVaryingFromString(this._transformedUVName,"vec2",this._defineName),e._emitVaryingFromString(this._mainUVName,"vec2",this._mainUVDefineName),e._emitUniformFromString(this._textureTransformName,"mat4",this._defineName),e.compilationString+="#ifdef "+this._defineName+`\r
`,e.compilationString+=this._transformedUVName+" = vec2("+this._textureTransformName+" * vec4("+n.associatedVariableName+`.xy, 1.0, 0.0));\r
`,e.compilationString+="#elif defined("+this._mainUVDefineName+`)\r
`,e.compilationString+=this._mainUVName+" = "+n.associatedVariableName+`.xy;\r
`,e.compilationString+=`#endif\r
`,this._outputs.some(function(f){return f.isConnectedInVertexShader})){this._writeTextureRead(e,!0);for(var r=0,o=this._outputs;r<o.length;r++){var u=o[r];u.hasEndpoints&&this._writeOutput(e,u,u.name,!0)}}},t.prototype._writeTextureRead=function(e,n){n===void 0&&(n=!1);var r=this.uv;if(n){if(e.target===Me.Fragment)return;e.compilationString+="vec4 "+this._tempTextureRead+" = texture2D("+this._samplerName+", "+r.associatedVariableName+`);\r
`}else this.uv.ownerBlock.target!==Me.Fragment?(e.compilationString+="#ifdef "+this._defineName+`\r
`,e.compilationString+="vec4 "+this._tempTextureRead+" = texture2D("+this._samplerName+", "+this._transformedUVName+`);\r
`,e.compilationString+="#elif defined("+this._mainUVDefineName+`)\r
`,e.compilationString+="vec4 "+this._tempTextureRead+" = texture2D("+this._samplerName+", "+this._mainUVName+`);\r
`,e.compilationString+=`#endif\r
`):e.compilationString+="vec4 "+this._tempTextureRead+" = texture2D("+this._samplerName+", "+r.associatedVariableName+`);\r
`},t.prototype._writeOutput=function(e,n,r,o){if(o===void 0&&(o=!1),o){if(e.target===Me.Fragment)return;e.compilationString+=this._declareOutput(n,e)+" = "+this._tempTextureRead+"."+r+`;\r
`}else if(this.uv.ownerBlock.target!==Me.Fragment){var u=" * "+this._textureInfoName;e.compilationString+=this._declareOutput(n,e)+" = "+this._tempTextureRead+"."+r+u+`;\r
`,r!=="a"&&(e.compilationString+="#ifdef "+this._linearDefineName+`\r
`,e.compilationString+=n.associatedVariableName+" = toGammaSpace("+n.associatedVariableName+`);\r
`,e.compilationString+=`#endif\r
`,e.compilationString+="#ifdef "+this._gammaDefineName+`\r
`,e.compilationString+=n.associatedVariableName+" = toLinearSpace("+n.associatedVariableName+`);\r
`,e.compilationString+=`#endif\r
`)}else e.compilationString+=this._declareOutput(n,e)+" = "+this._tempTextureRead+"."+r+`;\r
`},t.prototype._buildBlock=function(e){if(i.prototype._buildBlock.call(this,e),(e.target===Me.Vertex||this._fragmentOnly)&&(this._tempTextureRead=e._getFreeVariableName("tempTextureRead")),(!this._isMixed&&e.target===Me.Fragment||this._isMixed&&e.target===Me.Vertex)&&(this._samplerName=e._getFreeVariableName(this.name+"Sampler"),e._emit2DSampler(this._samplerName),e.sharedData.blockingBlocks.push(this),e.sharedData.textureBlocks.push(this),e.sharedData.blocksWithDefines.push(this),e.sharedData.bindableBlocks.push(this)),e.target===Me.Fragment){if(this._outputs.some(function(f){return f.isConnectedInFragmentShader})){this._isMixed&&e._emit2DSampler(this._samplerName),this._linearDefineName=e._getFreeDefineName("ISLINEAR"),this._gammaDefineName=e._getFreeDefineName("ISGAMMA");var n="//"+this.name;e._emitFunctionFromInclude("helperFunctions",n),this._isMixed&&e._emitUniformFromString(this._textureInfoName,"float"),this._writeTextureRead(e);for(var r=0,o=this._outputs;r<o.length;r++){var u=o[r];u.hasEndpoints&&this._writeOutput(e,u,u.name)}return this}}else this._injectVertexCode(e)},t.prototype._dumpPropertiesCode=function(){if(!this.texture)return"";var e=this._codeVariableName+'.texture = new BABYLON.Texture("'+this.texture.name+`", null);\r
`;return e+=this._codeVariableName+".texture.wrapU = "+this.texture.wrapU+`;\r
`,e+=this._codeVariableName+".texture.wrapV = "+this.texture.wrapV+`;\r
`,e+=this._codeVariableName+".texture.uAng = "+this.texture.uAng+`;\r
`,e+=this._codeVariableName+".texture.vAng = "+this.texture.vAng+`;\r
`,e+=this._codeVariableName+".texture.wAng = "+this.texture.wAng+`;\r
`,e+=this._codeVariableName+".texture.uOffset = "+this.texture.uOffset+`;\r
`,e+=this._codeVariableName+".texture.vOffset = "+this.texture.vOffset+`;\r
`,e+=this._codeVariableName+".texture.uScale = "+this.texture.uScale+`;\r
`,e+=this._codeVariableName+".texture.vScale = "+this.texture.vScale+`;\r
`,e+=this._codeVariableName+".convertToGammaSpace = "+this.convertToGammaSpace+`;\r
`,e+=this._codeVariableName+".convertToLinearSpace = "+this.convertToLinearSpace+`;\r
`},t.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return e.convertToGammaSpace=this.convertToGammaSpace,e.convertToLinearSpace=this.convertToLinearSpace,e.fragmentOnly=this._fragmentOnly,this.texture&&!this.texture.isRenderTarget&&(e.texture=this.texture.serialize()),e},t.prototype._deserialize=function(e,n,r){i.prototype._deserialize.call(this,e,n,r),this.convertToGammaSpace=e.convertToGammaSpace,this.convertToLinearSpace=!!e.convertToLinearSpace,this._fragmentOnly=!!e.fragmentOnly,e.texture&&!Dh.IgnoreTexturesAtLoadTime&&(r=e.texture.url.indexOf("data:")===0?"":r,this.texture=ke.a.Parse(e.texture,n,r))},t}(Et);C.a.RegisteredTypes["BABYLON.TextureBlock"]=fT;var Im=function(i){function t(e){return i.call(this,e,Me.VertexAndFragment)||this}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"ReflectionTextureBaseBlock"},t.prototype._getTexture=function(){return this.texture},t.prototype.autoConfigure=function(e){if(!this.position.isConnected){var n=e.getInputBlockByPredicate(function(u){return u.isAttribute&&u.name==="position"});n||(n=new Bt("position")).setAsAttribute(),n.output.connectTo(this.position)}if(!this.world.isConnected){var r=e.getInputBlockByPredicate(function(u){return u.systemValue===Mt.World});r||(r=new Bt("world")).setAsSystemValue(Mt.World),r.output.connectTo(this.world)}if(this.view&&!this.view.isConnected){var o=e.getInputBlockByPredicate(function(u){return u.systemValue===Mt.View});o||(o=new Bt("view")).setAsSystemValue(Mt.View),o.output.connectTo(this.view)}},t.prototype.prepareDefines=function(e,n,r){if(r._areTexturesDirty){var o=this._getTexture();o&&o.getTextureMatrix&&(r.setValue(this._define3DName,o.isCube,!0),r.setValue(this._defineLocalCubicName,!!o.boundingBoxSize,!0),r.setValue(this._defineExplicitName,o.coordinatesMode===g.a.TEXTURE_EXPLICIT_MODE,!0),r.setValue(this._defineSkyboxName,o.coordinatesMode===g.a.TEXTURE_SKYBOX_MODE,!0),r.setValue(this._defineCubicName,o.coordinatesMode===g.a.TEXTURE_CUBIC_MODE||o.coordinatesMode===g.a.TEXTURE_INVCUBIC_MODE,!0),r.setValue("INVERTCUBICMAP",o.coordinatesMode===g.a.TEXTURE_INVCUBIC_MODE,!0),r.setValue(this._defineSphericalName,o.coordinatesMode===g.a.TEXTURE_SPHERICAL_MODE,!0),r.setValue(this._definePlanarName,o.coordinatesMode===g.a.TEXTURE_PLANAR_MODE,!0),r.setValue(this._defineProjectionName,o.coordinatesMode===g.a.TEXTURE_PROJECTION_MODE,!0),r.setValue(this._defineEquirectangularName,o.coordinatesMode===g.a.TEXTURE_EQUIRECTANGULAR_MODE,!0),r.setValue(this._defineEquirectangularFixedName,o.coordinatesMode===g.a.TEXTURE_FIXED_EQUIRECTANGULAR_MODE,!0),r.setValue(this._defineMirroredEquirectangularFixedName,o.coordinatesMode===g.a.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE,!0))}},t.prototype.isReady=function(){var e=this._getTexture();return!(e&&!e.isReadyOrNotBlocking())},t.prototype.bind=function(e,n,r){var o=this._getTexture();r&&o&&(e.setMatrix(this._reflectionMatrixName,o.getReflectionTextureMatrix()),o.isCube?e.setTexture(this._cubeSamplerName,o):e.setTexture(this._2DSamplerName,o))},t.prototype.handleVertexSide=function(e){this._define3DName=e._getFreeDefineName("REFLECTIONMAP_3D"),this._defineCubicName=e._getFreeDefineName("REFLECTIONMAP_CUBIC"),this._defineSphericalName=e._getFreeDefineName("REFLECTIONMAP_SPHERICAL"),this._definePlanarName=e._getFreeDefineName("REFLECTIONMAP_PLANAR"),this._defineProjectionName=e._getFreeDefineName("REFLECTIONMAP_PROJECTION"),this._defineExplicitName=e._getFreeDefineName("REFLECTIONMAP_EXPLICIT"),this._defineEquirectangularName=e._getFreeDefineName("REFLECTIONMAP_EQUIRECTANGULAR"),this._defineLocalCubicName=e._getFreeDefineName("USE_LOCAL_REFLECTIONMAP_CUBIC"),this._defineMirroredEquirectangularFixedName=e._getFreeDefineName("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"),this._defineEquirectangularFixedName=e._getFreeDefineName("REFLECTIONMAP_EQUIRECTANGULAR_FIXED"),this._defineSkyboxName=e._getFreeDefineName("REFLECTIONMAP_SKYBOX"),this._defineOppositeZ=e._getFreeDefineName("REFLECTIONMAP_OPPOSITEZ"),this._reflectionMatrixName=e._getFreeVariableName("reflectionMatrix"),e._emitUniformFromString(this._reflectionMatrixName,"mat4");var n="",r="v_"+this.worldPosition.associatedVariableName;return e._emitVaryingFromString(r,"vec4")&&(n+=r+" = "+this.worldPosition.associatedVariableName+`;\r
`),this._positionUVWName=e._getFreeVariableName("positionUVW"),this._directionWName=e._getFreeVariableName("directionW"),e._emitVaryingFromString(this._positionUVWName,"vec3",this._defineSkyboxName)&&(n+="#ifdef "+this._defineSkyboxName+`\r
`,n+=this._positionUVWName+" = "+this.position.associatedVariableName+`.xyz;\r
`,n+=`#endif\r
`),e._emitVaryingFromString(this._directionWName,"vec3","defined("+this._defineEquirectangularFixedName+") || defined("+this._defineMirroredEquirectangularFixedName+")")&&(n+="#if defined("+this._defineEquirectangularFixedName+") || defined("+this._defineMirroredEquirectangularFixedName+`)\r
`,n+=this._directionWName+" = normalize(vec3("+this.world.associatedVariableName+" * vec4("+this.position.associatedVariableName+`.xyz, 0.0)));\r
`,n+=`#endif\r
`),n},t.prototype.handleFragmentSideInits=function(e){e.sharedData.blockingBlocks.push(this),e.sharedData.textureBlocks.push(this),this._cubeSamplerName=e._getFreeVariableName(this.name+"CubeSampler"),e.samplers.push(this._cubeSamplerName),this._2DSamplerName=e._getFreeVariableName(this.name+"2DSampler"),e.samplers.push(this._2DSamplerName),e._samplerDeclaration+="#ifdef "+this._define3DName+`\r
`,e._samplerDeclaration+="uniform samplerCube "+this._cubeSamplerName+`;\r
`,e._samplerDeclaration+=`#else\r
`,e._samplerDeclaration+="uniform sampler2D "+this._2DSamplerName+`;\r
`,e._samplerDeclaration+=`#endif\r
`,e.sharedData.blocksWithDefines.push(this),e.sharedData.bindableBlocks.push(this);var n="//"+this.name;e._emitFunction("ReciprocalPI","#define RECIPROCAL_PI2 0.15915494",""),e._emitFunctionFromInclude("reflectionFunction",n,{replaceStrings:[{search:/vec3 computeReflectionCoords/g,replace:"void DUMMYFUNC"}]}),this._reflectionColorName=e._getFreeVariableName("reflectionColor"),this._reflectionVectorName=e._getFreeVariableName("reflectionUVW"),this._reflectionCoordsName=e._getFreeVariableName("reflectionCoords")},t.prototype.handleFragmentSideCodeReflectionCoords=function(e,n,r){r===void 0&&(r=!1),n||(n="v_"+this.worldPosition.associatedVariableName);var o=this._reflectionMatrixName,u="normalize("+this._directionWName+")",f=""+this._positionUVWName,v=""+this.cameraPosition.associatedVariableName,y=""+this.view.associatedVariableName;e+=".xyz";var D=`
            #ifdef `+this._defineMirroredEquirectangularFixedName+`
                vec3 `+this._reflectionVectorName+" = computeMirroredFixedEquirectangularCoords("+n+", "+e+", "+u+`);
            #endif

            #ifdef `+this._defineEquirectangularFixedName+`
                vec3 `+this._reflectionVectorName+" = computeFixedEquirectangularCoords("+n+", "+e+", "+u+`);
            #endif

            #ifdef `+this._defineEquirectangularName+`
                vec3 `+this._reflectionVectorName+" = computeEquirectangularCoords("+n+", "+e+", "+v+".xyz, "+o+`);
            #endif

            #ifdef `+this._defineSphericalName+`
                vec3 `+this._reflectionVectorName+" = computeSphericalCoords("+n+", "+e+", "+y+", "+o+`);
            #endif

            #ifdef `+this._definePlanarName+`
                vec3 `+this._reflectionVectorName+" = computePlanarCoords("+n+", "+e+", "+v+".xyz, "+o+`);
            #endif

            #ifdef `+this._defineCubicName+`
                #ifdef `+this._defineLocalCubicName+`
                    vec3 `+this._reflectionVectorName+" = computeCubicLocalCoords("+n+", "+e+", "+v+".xyz, "+o+`, vReflectionSize, vReflectionPosition);
                #else
                vec3 `+this._reflectionVectorName+" = computeCubicCoords("+n+", "+e+", "+v+".xyz, "+o+`);
                #endif
            #endif

            #ifdef `+this._defineProjectionName+`
                vec3 `+this._reflectionVectorName+" = computeProjectionCoords("+n+", "+y+", "+o+`);
            #endif

            #ifdef `+this._defineSkyboxName+`
                vec3 `+this._reflectionVectorName+" = computeSkyBoxCoords("+f+", "+o+`);
            #endif

            #ifdef `+this._defineExplicitName+`
                vec3 `+this._reflectionVectorName+` = vec3(0, 0, 0);
            #endif

            #ifdef `+this._defineOppositeZ+`
                `+this._reflectionVectorName+`.z *= -1.0;
            #endif\r
`;return r||(D+=`
                #ifdef `+this._define3DName+`
                    vec3 `+this._reflectionCoordsName+" = "+this._reflectionVectorName+`;
                #else
                    vec2 `+this._reflectionCoordsName+" = "+this._reflectionVectorName+`.xy;
                    #ifdef `+this._defineProjectionName+`
                        `+this._reflectionCoordsName+" /= "+this._reflectionVectorName+`.z;
                    #endif
                    `+this._reflectionCoordsName+".y = 1.0 - "+this._reflectionCoordsName+`.y;
                #endif\r
`),D},t.prototype.handleFragmentSideCodeReflectionColor=function(e,n){n===void 0&&(n=".rgb");var r="vec"+(n.length===0?"4":n.length-1)+" "+this._reflectionColorName+`;
            #ifdef `+this._define3DName+`\r
`;return r+=e?this._reflectionColorName+" = textureCubeLodEXT("+this._cubeSamplerName+", "+this._reflectionVectorName+", "+e+")"+n+`;\r
`:this._reflectionColorName+" = textureCube("+this._cubeSamplerName+", "+this._reflectionVectorName+")"+n+`;\r
`,r+=`
            #else\r
`,r+=e?this._reflectionColorName+" = texture2DLodEXT("+this._2DSamplerName+", "+this._reflectionCoordsName+", "+e+")"+n+`;\r
`:this._reflectionColorName+" = texture2D("+this._2DSamplerName+", "+this._reflectionCoordsName+")"+n+`;\r
`,r+=`#endif\r
`},t.prototype.writeOutputs=function(e,n){var r="";if(e.target===Me.Fragment)for(var o=0,u=this._outputs;o<u.length;o++){var f=u[o];f.hasEndpoints&&(r+=this._declareOutput(f,e)+" = "+n+"."+f.name+`;\r
`)}return r},t.prototype._buildBlock=function(e){return i.prototype._buildBlock.call(this,e),this},t.prototype._dumpPropertiesCode=function(){return this.texture?(e=this.texture.isCube?this._codeVariableName+'.texture = new BABYLON.CubeTexture("'+this.texture.name+`");\r
`:this._codeVariableName+'.texture = new BABYLON.Texture("'+this.texture.name+`");\r
`,e+=this._codeVariableName+".texture.coordinatesMode = "+this.texture.coordinatesMode+`;\r
`):"";var e},t.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return this.texture&&(e.texture=this.texture.serialize()),e},t.prototype._deserialize=function(e,n,r){i.prototype._deserialize.call(this,e,n,r),e.texture&&(r=e.texture.url.indexOf("data:")===0?"":r,e.texture.isCube?this.texture=Ei.Parse(e.texture,n,r):this.texture=ke.a.Parse(e.texture,n,r))},t}(Et);C.a.RegisteredTypes["BABYLON.ReflectionTextureBaseBlock"]=Im;var pT=function(i){function t(e){var n=i.call(this,e)||this;return n.registerInput("position",fe.Vector3,!1,Me.Vertex),n.registerInput("worldPosition",fe.Vector4,!1,Me.Vertex),n.registerInput("worldNormal",fe.Vector4,!1,Me.Fragment),n.registerInput("world",fe.Matrix,!1,Me.Vertex),n.registerInput("cameraPosition",fe.Vector3,!1,Me.Fragment),n.registerInput("view",fe.Matrix,!1,Me.Fragment),n.registerOutput("rgb",fe.Color3,Me.Fragment),n.registerOutput("rgba",fe.Color4,Me.Fragment),n.registerOutput("r",fe.Float,Me.Fragment),n.registerOutput("g",fe.Float,Me.Fragment),n.registerOutput("b",fe.Float,Me.Fragment),n.registerOutput("a",fe.Float,Me.Fragment),n._inputs[0].acceptedConnectionPointTypes.push(fe.Vector4),n}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"ReflectionTextureBlock"},Object.defineProperty(t.prototype,"position",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"worldPosition",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"worldNormal",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"world",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraPosition",{get:function(){return this._inputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"view",{get:function(){return this._inputs[5]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rgb",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rgba",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"r",{get:function(){return this._outputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"g",{get:function(){return this._outputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"b",{get:function(){return this._outputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"a",{get:function(){return this._outputs[5]},enumerable:!1,configurable:!0}),t.prototype.autoConfigure=function(e){if(i.prototype.autoConfigure.call(this,e),!this.cameraPosition.isConnected){var n=e.getInputBlockByPredicate(function(r){return r.systemValue===Mt.CameraPosition});n||(n=new Bt("cameraPosition")).setAsSystemValue(Mt.CameraPosition),n.output.connectTo(this.cameraPosition)}},t.prototype._buildBlock=function(e){if(i.prototype._buildBlock.call(this,e),!this.texture)return e.compilationString+=this.writeOutputs(e,"vec3(0.)"),this;if(e.target!==Me.Fragment)return e.compilationString+=this.handleVertexSide(e),this;this.handleFragmentSideInits(e);var n=e._getFreeVariableName("normalWUnit");return e.compilationString+="vec4 "+n+" = normalize("+this.worldNormal.associatedVariableName+`);\r
`,e.compilationString+=this.handleFragmentSideCodeReflectionCoords(n),e.compilationString+=this.handleFragmentSideCodeReflectionColor(void 0,""),e.compilationString+=this.writeOutputs(e,this._reflectionColorName),this},t}(Im);C.a.RegisteredTypes["BABYLON.ReflectionTextureBlock"]=pT;var mT=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("left",fe.AutoDetect),n.registerInput("right",fe.AutoDetect),n.registerOutput("output",fe.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n._linkConnectionTypes(0,1),n}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"AddBlock"},Object.defineProperty(t.prototype,"left",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = "+this.left.associatedVariableName+" + "+this.right.associatedVariableName+`;\r
`,this},t}(Et);C.a.RegisteredTypes["BABYLON.AddBlock"]=mT;var _T=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("input",fe.AutoDetect),n.registerInput("factor",fe.Float),n.registerOutput("output",fe.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"ScaleBlock"},Object.defineProperty(t.prototype,"input",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"factor",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = "+this.input.associatedVariableName+" * "+this.factor.associatedVariableName+`;\r
`,this},t}(Et);C.a.RegisteredTypes["BABYLON.ScaleBlock"]=_T;var gT=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.minimum=0,n.maximum=1,n.registerInput("value",fe.AutoDetect),n.registerOutput("output",fe.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"ClampBlock"},Object.defineProperty(t.prototype,"value",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = clamp("+this.value.associatedVariableName+", "+this._writeFloat(this.minimum)+", "+this._writeFloat(this.maximum)+`);\r
`,this},t.prototype._dumpPropertiesCode=function(){var e=this._codeVariableName+".minimum = "+this.minimum+`;\r
`;return e+=this._codeVariableName+".maximum = "+this.maximum+`;\r
`},t.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return e.minimum=this.minimum,e.maximum=this.maximum,e},t.prototype._deserialize=function(e,n,r){i.prototype._deserialize.call(this,e,n,r),this.minimum=e.minimum,this.maximum=e.maximum},Object(p.c)([sn("Minimum",$t.Float)],t.prototype,"minimum",void 0),Object(p.c)([sn("Maximum",$t.Float)],t.prototype,"maximum",void 0),t}(Et);C.a.RegisteredTypes["BABYLON.ClampBlock"]=gT;var vT=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("left",fe.AutoDetect),n.registerInput("right",fe.AutoDetect),n.registerOutput("output",fe.Vector3),n._linkConnectionTypes(0,1),n._inputs[0].excludedConnectionPointTypes.push(fe.Float),n._inputs[0].excludedConnectionPointTypes.push(fe.Matrix),n._inputs[0].excludedConnectionPointTypes.push(fe.Vector2),n._inputs[1].excludedConnectionPointTypes.push(fe.Float),n._inputs[1].excludedConnectionPointTypes.push(fe.Matrix),n._inputs[1].excludedConnectionPointTypes.push(fe.Vector2),n}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"CrossBlock"},Object.defineProperty(t.prototype,"left",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = cross("+this.left.associatedVariableName+".xyz, "+this.right.associatedVariableName+`.xyz);\r
`,this},t}(Et);C.a.RegisteredTypes["BABYLON.CrossBlock"]=vT;var bT=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("left",fe.AutoDetect),n.registerInput("right",fe.AutoDetect),n.registerOutput("output",fe.Float),n._linkConnectionTypes(0,1),n._inputs[0].excludedConnectionPointTypes.push(fe.Float),n._inputs[0].excludedConnectionPointTypes.push(fe.Matrix),n._inputs[1].excludedConnectionPointTypes.push(fe.Float),n._inputs[1].excludedConnectionPointTypes.push(fe.Matrix),n}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"DotBlock"},Object.defineProperty(t.prototype,"left",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = dot("+this.left.associatedVariableName+", "+this.right.associatedVariableName+`);\r
`,this},t}(Et);C.a.RegisteredTypes["BABYLON.DotBlock"]=bT;var yT=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("input",fe.AutoDetect),n.registerOutput("output",fe.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n._inputs[0].excludedConnectionPointTypes.push(fe.Float),n._inputs[0].excludedConnectionPointTypes.push(fe.Matrix),n}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"NormalizeBlock"},Object.defineProperty(t.prototype,"input",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0],r=this._inputs[0];return e.compilationString+=this._declareOutput(n,e)+" = normalize("+r.associatedVariableName+`);\r
`,this},t}(Et);C.a.RegisteredTypes["BABYLON.NormalizeBlock"]=yT;var TT=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("rgb ",fe.Color3,!0),n.registerInput("r",fe.Float,!0),n.registerInput("g",fe.Float,!0),n.registerInput("b",fe.Float,!0),n.registerInput("a",fe.Float,!0),n.registerOutput("rgba",fe.Color4),n.registerOutput("rgb",fe.Color3),n}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"ColorMergerBlock"},Object.defineProperty(t.prototype,"rgbIn",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"r",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"g",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"b",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"a",{get:function(){return this._inputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rgba",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rgbOut",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rgb",{get:function(){return this.rgbOut},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this.r,r=this.g,o=this.b,u=this.a,f=this.rgbIn,v=this._outputs[0],y=this._outputs[1];return f.isConnected?v.hasEndpoints?e.compilationString+=this._declareOutput(v,e)+" = vec4("+f.associatedVariableName+", "+(u.isConnected?this._writeVariable(u):"0.0")+`);\r
`:y.hasEndpoints&&(e.compilationString+=this._declareOutput(y,e)+" = "+f.associatedVariableName+`;\r
`):v.hasEndpoints?e.compilationString+=this._declareOutput(v,e)+" = vec4("+(n.isConnected?this._writeVariable(n):"0.0")+", "+(r.isConnected?this._writeVariable(r):"0.0")+", "+(o.isConnected?this._writeVariable(o):"0.0")+", "+(u.isConnected?this._writeVariable(u):"0.0")+`);\r
`:y.hasEndpoints&&(e.compilationString+=this._declareOutput(y,e)+" = vec3("+(n.isConnected?this._writeVariable(n):"0.0")+", "+(r.isConnected?this._writeVariable(r):"0.0")+", "+(o.isConnected?this._writeVariable(o):"0.0")+`);\r
`),this},t}(Et);C.a.RegisteredTypes["BABYLON.ColorMergerBlock"]=TT;var ET=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("xyzw",fe.Vector4,!0),n.registerInput("xyz ",fe.Vector3,!0),n.registerInput("xy ",fe.Vector2,!0),n.registerOutput("xyz",fe.Vector3),n.registerOutput("xy",fe.Vector2),n.registerOutput("x",fe.Float),n.registerOutput("y",fe.Float),n.registerOutput("z",fe.Float),n.registerOutput("w",fe.Float),n.inputsAreExclusive=!0,n}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"VectorSplitterBlock"},Object.defineProperty(t.prototype,"xyzw",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"xyzIn",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"xyIn",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"xyzOut",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"xyOut",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"x",{get:function(){return this._outputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._outputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"z",{get:function(){return this._outputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"w",{get:function(){return this._outputs[5]},enumerable:!1,configurable:!0}),t.prototype._inputRename=function(e){switch(e){case"xy ":return"xyIn";case"xyz ":return"xyzIn";default:return e}},t.prototype._outputRename=function(e){switch(e){case"xy":return"xyOut";case"xyz":return"xyzOut";default:return e}},t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this.xyzw.isConnected?this.xyzw:this.xyzIn.isConnected?this.xyzIn:this.xyIn,r=this._outputs[0],o=this._outputs[1],u=this._outputs[2],f=this._outputs[3],v=this._outputs[4],y=this._outputs[5];return r.hasEndpoints&&(n===this.xyIn?e.compilationString+=this._declareOutput(r,e)+" = vec3("+n.associatedVariableName+`, 0.0);\r
`:e.compilationString+=this._declareOutput(r,e)+" = "+n.associatedVariableName+`.xyz;\r
`),o.hasEndpoints&&(e.compilationString+=this._declareOutput(o,e)+" = "+n.associatedVariableName+`.xy;\r
`),u.hasEndpoints&&(e.compilationString+=this._declareOutput(u,e)+" = "+n.associatedVariableName+`.x;\r
`),f.hasEndpoints&&(e.compilationString+=this._declareOutput(f,e)+" = "+n.associatedVariableName+`.y;\r
`),v.hasEndpoints&&(e.compilationString+=this._declareOutput(v,e)+" = "+n.associatedVariableName+`.z;\r
`),y.hasEndpoints&&(e.compilationString+=this._declareOutput(y,e)+" = "+n.associatedVariableName+`.w;\r
`),this},t}(Et);C.a.RegisteredTypes["BABYLON.VectorSplitterBlock"]=ET;var ST=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("left",fe.AutoDetect),n.registerInput("right",fe.AutoDetect),n.registerInput("gradient",fe.AutoDetect),n.registerOutput("output",fe.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n._linkConnectionTypes(0,1),n._linkConnectionTypes(1,2,!0),n._inputs[2].acceptedConnectionPointTypes.push(fe.Float),n}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"LerpBlock"},Object.defineProperty(t.prototype,"left",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"gradient",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = mix("+this.left.associatedVariableName+" , "+this.right.associatedVariableName+", "+this.gradient.associatedVariableName+`);\r
`,this},t}(Et);C.a.RegisteredTypes["BABYLON.LerpBlock"]=ST;var xT=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("left",fe.AutoDetect),n.registerInput("right",fe.AutoDetect),n.registerOutput("output",fe.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n._linkConnectionTypes(0,1),n}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"DivideBlock"},Object.defineProperty(t.prototype,"left",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = "+this.left.associatedVariableName+" / "+this.right.associatedVariableName+`;\r
`,this},t}(Et);C.a.RegisteredTypes["BABYLON.DivideBlock"]=xT;var AT=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("left",fe.AutoDetect),n.registerInput("right",fe.AutoDetect),n.registerOutput("output",fe.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n._linkConnectionTypes(0,1),n}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"SubtractBlock"},Object.defineProperty(t.prototype,"left",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = "+this.left.associatedVariableName+" - "+this.right.associatedVariableName+`;\r
`,this},t}(Et);C.a.RegisteredTypes["BABYLON.SubtractBlock"]=AT;var PT=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("value",fe.Float),n.registerInput("edge",fe.Float),n.registerOutput("output",fe.Float),n}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"StepBlock"},Object.defineProperty(t.prototype,"value",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"edge",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = step("+this.edge.associatedVariableName+", "+this.value.associatedVariableName+`);\r
`,this},t}(Et);C.a.RegisteredTypes["BABYLON.StepBlock"]=PT;var Dm=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("input",fe.AutoDetect),n.registerOutput("output",fe.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n._outputs[0].excludedConnectionPointTypes.push(fe.Matrix),n}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"OneMinusBlock"},Object.defineProperty(t.prototype,"input",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = 1. - "+this.input.associatedVariableName+`;\r
`,this},t}(Et);C.a.RegisteredTypes["BABYLON.OneMinusBlock"]=Dm,C.a.RegisteredTypes["BABYLON.OppositeBlock"]=Dm;var wm=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("worldPosition",fe.Vector4),n.registerInput("cameraPosition",fe.Vector3),n.registerOutput("output",fe.Vector3),n}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"ViewDirectionBlock"},Object.defineProperty(t.prototype,"worldPosition",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraPosition",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype.autoConfigure=function(e){if(!this.cameraPosition.isConnected){var n=e.getInputBlockByPredicate(function(r){return r.systemValue===Mt.CameraPosition});n||(n=new Bt("cameraPosition")).setAsSystemValue(Mt.CameraPosition),n.output.connectTo(this.cameraPosition)}},t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = normalize("+this.cameraPosition.associatedVariableName+" - "+this.worldPosition.associatedVariableName+`.xyz);\r
`,this},t}(Et);C.a.RegisteredTypes["BABYLON.ViewDirectionBlock"]=wm,c(161);var CT=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("worldNormal",fe.Vector4),n.registerInput("viewDirection",fe.Vector3),n.registerInput("bias",fe.Float),n.registerInput("power",fe.Float),n.registerOutput("fresnel",fe.Float),n}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"FresnelBlock"},Object.defineProperty(t.prototype,"worldNormal",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"viewDirection",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bias",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"power",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fresnel",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype.autoConfigure=function(e){if(!this.viewDirection.isConnected){var n=new wm("View direction");n.output.connectTo(this.viewDirection),n.autoConfigure(e)}if(!this.bias.isConnected){var r=new Bt("bias");r.value=0,r.output.connectTo(this.bias)}if(!this.power.isConnected){var o=new Bt("power");o.value=1,o.output.connectTo(this.power)}},t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n="//"+this.name;return e._emitFunctionFromInclude("fresnelFunction",n,{removeIfDef:!0}),e.compilationString+=this._declareOutput(this.fresnel,e)+" = computeFresnelTerm("+this.viewDirection.associatedVariableName+".xyz, "+this.worldNormal.associatedVariableName+".xyz, "+this.bias.associatedVariableName+", "+this.power.associatedVariableName+`);\r
`,this},t}(Et);C.a.RegisteredTypes["BABYLON.FresnelBlock"]=CT;var RT=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("left",fe.AutoDetect),n.registerInput("right",fe.AutoDetect),n.registerOutput("output",fe.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n._linkConnectionTypes(0,1),n}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"MaxBlock"},Object.defineProperty(t.prototype,"left",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = max("+this.left.associatedVariableName+", "+this.right.associatedVariableName+`);\r
`,this},t}(Et);C.a.RegisteredTypes["BABYLON.MaxBlock"]=RT;var OT=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("left",fe.AutoDetect),n.registerInput("right",fe.AutoDetect),n.registerOutput("output",fe.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n._linkConnectionTypes(0,1),n}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"MinBlock"},Object.defineProperty(t.prototype,"left",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = min("+this.left.associatedVariableName+", "+this.right.associatedVariableName+`);\r
`,this},t}(Et);C.a.RegisteredTypes["BABYLON.MinBlock"]=OT;var MT=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("left",fe.AutoDetect),n.registerInput("right",fe.AutoDetect),n.registerOutput("output",fe.Float),n._linkConnectionTypes(0,1),n._inputs[0].excludedConnectionPointTypes.push(fe.Float),n._inputs[0].excludedConnectionPointTypes.push(fe.Matrix),n._inputs[1].excludedConnectionPointTypes.push(fe.Float),n._inputs[1].excludedConnectionPointTypes.push(fe.Matrix),n}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"DistanceBlock"},Object.defineProperty(t.prototype,"left",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = length("+this.left.associatedVariableName+" - "+this.right.associatedVariableName+`);\r
`,this},t}(Et);C.a.RegisteredTypes["BABYLON.DistanceBlock"]=MT;var IT=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("value",fe.AutoDetect),n.registerOutput("output",fe.Float),n._inputs[0].excludedConnectionPointTypes.push(fe.Float),n._inputs[0].excludedConnectionPointTypes.push(fe.Matrix),n}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"LengthBlock"},Object.defineProperty(t.prototype,"value",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = length("+this.value.associatedVariableName+`);\r
`,this},t}(Et);C.a.RegisteredTypes["BABYLON.LengthBlock"]=IT;var DT=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("value",fe.AutoDetect),n.registerOutput("output",fe.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"NegateBlock"},Object.defineProperty(t.prototype,"value",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = -1.0 * "+this.value.associatedVariableName+`;\r
`,this},t}(Et);C.a.RegisteredTypes["BABYLON.NegateBlock"]=DT;var wT=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("value",fe.AutoDetect),n.registerInput("power",fe.AutoDetect),n.registerOutput("output",fe.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n._linkConnectionTypes(0,1),n}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"PowBlock"},Object.defineProperty(t.prototype,"value",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"power",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = pow("+this.value.associatedVariableName+", "+this.power.associatedVariableName+`);\r
`,this},t}(Et);C.a.RegisteredTypes["BABYLON.PowBlock"]=wT;var LT=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("seed",fe.Vector2),n.registerOutput("output",fe.Float),n._inputs[0].acceptedConnectionPointTypes.push(fe.Vector3),n._inputs[0].acceptedConnectionPointTypes.push(fe.Vector4),n._inputs[0].acceptedConnectionPointTypes.push(fe.Color3),n._inputs[0].acceptedConnectionPointTypes.push(fe.Color4),n}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"RandomNumberBlock"},Object.defineProperty(t.prototype,"seed",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0],r="//"+this.name;return e._emitFunctionFromInclude("helperFunctions",r),e.compilationString+=this._declareOutput(n,e)+" = getRand("+this.seed.associatedVariableName+`.xy);\r
`,this},t}(Et);C.a.RegisteredTypes["BABYLON.RandomNumberBlock"]=LT;var NT=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("x",fe.Float),n.registerInput("y",fe.Float),n.registerOutput("output",fe.Float),n}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"ArcTan2Block"},Object.defineProperty(t.prototype,"x",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = atan("+this.x.associatedVariableName+", "+this.y.associatedVariableName+`);\r
`,this},t}(Et);C.a.RegisteredTypes["BABYLON.ArcTan2Block"]=NT;var FT=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("value",fe.AutoDetect),n.registerInput("edge0",fe.Float),n.registerInput("edge1",fe.Float),n.registerOutput("output",fe.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"SmoothStepBlock"},Object.defineProperty(t.prototype,"value",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"edge0",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"edge1",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = smoothstep("+this.edge0.associatedVariableName+", "+this.edge1.associatedVariableName+", "+this.value.associatedVariableName+`);\r
`,this},t}(Et);C.a.RegisteredTypes["BABYLON.SmoothStepBlock"]=FT;var BT=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("input",fe.AutoDetect),n.registerOutput("output",fe.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n._outputs[0].excludedConnectionPointTypes.push(fe.Matrix),n}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"ReciprocalBlock"},Object.defineProperty(t.prototype,"input",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = 1. / "+this.input.associatedVariableName+`;\r
`,this},t}(Et);C.a.RegisteredTypes["BABYLON.ReciprocalBlock"]=BT;var UT=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("value",fe.AutoDetect),n.registerInput("reference",fe.AutoDetect),n.registerInput("distance",fe.Float),n.registerInput("replacement",fe.AutoDetect),n.registerOutput("output",fe.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n._linkConnectionTypes(0,1),n._linkConnectionTypes(0,3),n._inputs[0].excludedConnectionPointTypes.push(fe.Float),n._inputs[0].excludedConnectionPointTypes.push(fe.Matrix),n._inputs[1].excludedConnectionPointTypes.push(fe.Float),n._inputs[1].excludedConnectionPointTypes.push(fe.Matrix),n._inputs[3].excludedConnectionPointTypes.push(fe.Float),n._inputs[3].excludedConnectionPointTypes.push(fe.Matrix),n}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"ReplaceColorBlock"},Object.defineProperty(t.prototype,"value",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"reference",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"distance",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"replacement",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+`;\r
`,e.compilationString+="if (length("+this.value.associatedVariableName+" - "+this.reference.associatedVariableName+") < "+this.distance.associatedVariableName+`) {\r
`,e.compilationString+=n.associatedVariableName+" = "+this.replacement.associatedVariableName+`;\r
`,e.compilationString+=`} else {\r
`,e.compilationString+=n.associatedVariableName+" = "+this.value.associatedVariableName+`;\r
`,e.compilationString+=`}\r
`,this},t}(Et);C.a.RegisteredTypes["BABYLON.ReplaceColorBlock"]=UT;var La,VT=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("value",fe.AutoDetect),n.registerInput("steps",fe.AutoDetect),n.registerOutput("output",fe.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n._linkConnectionTypes(0,1),n._inputs[0].excludedConnectionPointTypes.push(fe.Matrix),n._inputs[1].excludedConnectionPointTypes.push(fe.Matrix),n}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"PosterizeBlock"},Object.defineProperty(t.prototype,"value",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"steps",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = floor("+this.value.associatedVariableName+" / (1.0 / "+this.steps.associatedVariableName+")) * (1.0 / "+this.steps.associatedVariableName+`);\r
`,this},t}(Et);C.a.RegisteredTypes["BABYLON.PosterizeBlock"]=VT,function(i){i[i.SawTooth=0]="SawTooth",i[i.Square=1]="Square",i[i.Triangle=2]="Triangle"}(La||(La={}));var kT=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.kind=La.SawTooth,n.registerInput("input",fe.AutoDetect),n.registerOutput("output",fe.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n._inputs[0].excludedConnectionPointTypes.push(fe.Matrix),n}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"WaveBlock"},Object.defineProperty(t.prototype,"input",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];switch(this.kind){case La.SawTooth:e.compilationString+=this._declareOutput(n,e)+" = "+this.input.associatedVariableName+" - floor(0.5 + "+this.input.associatedVariableName+`);\r
`;break;case La.Square:e.compilationString+=this._declareOutput(n,e)+" = 1.0 - 2.0 * round(fract("+this.input.associatedVariableName+`));\r
`;break;case La.Triangle:e.compilationString+=this._declareOutput(n,e)+" = 2.0 * abs(2.0 * ("+this.input.associatedVariableName+" - floor(0.5 + "+this.input.associatedVariableName+`))) - 1.0;\r
`}return this},t.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return e.kind=this.kind,e},t.prototype._deserialize=function(e,n,r){i.prototype._deserialize.call(this,e,n,r),this.kind=e.kind},t}(Et);C.a.RegisteredTypes["BABYLON.WaveBlock"]=kT;var wh=function(){function i(t,e){this.step=t,this.color=e}return Object.defineProperty(i.prototype,"step",{get:function(){return this._step},set:function(t){this._step=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"color",{get:function(){return this._color},set:function(t){this._color=t},enumerable:!1,configurable:!0}),i}(),jT=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.colorSteps=[new wh(0,M.a.Black()),new wh(1,M.a.White())],n.onValueChangedObservable=new S.c,n.registerInput("gradient",fe.Float),n.registerOutput("output",fe.Color3),n._inputs[0].acceptedConnectionPointTypes.push(fe.Vector2),n._inputs[0].acceptedConnectionPointTypes.push(fe.Vector3),n._inputs[0].acceptedConnectionPointTypes.push(fe.Vector4),n._inputs[0].acceptedConnectionPointTypes.push(fe.Color3),n._inputs[0].acceptedConnectionPointTypes.push(fe.Color4),n}return Object(p.d)(t,i),t.prototype.colorStepsUpdated=function(){this.onValueChangedObservable.notifyObservers(this)},t.prototype.getClassName=function(){return"GradientBlock"},Object.defineProperty(t.prototype,"gradient",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._writeColorConstant=function(e){var n=this.colorSteps[e];return"vec3("+n.color.r+", "+n.color.g+", "+n.color.b+")"},t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];if(this.colorSteps.length&&this.gradient.connectedPoint){var r=e._getFreeVariableName("gradientTempColor"),o=e._getFreeVariableName("gradientTempPosition");e.compilationString+="vec3 "+r+" = "+this._writeColorConstant(0)+`;\r
`,e.compilationString+="float "+o+`;\r
`;var u=this.gradient.associatedVariableName;this.gradient.connectedPoint.type!==fe.Float&&(u+=".x");for(var f=1;f<this.colorSteps.length;f++){var v=this.colorSteps[f],y=this.colorSteps[f-1];e.compilationString+=o+" = clamp(("+u+" - "+e._emitFloat(y.step)+") / ("+e._emitFloat(v.step)+" -  "+e._emitFloat(y.step)+"), 0.0, 1.0) * step("+e._emitFloat(f)+", "+e._emitFloat(this.colorSteps.length-1)+`);\r
`,e.compilationString+=r+" = mix("+r+", "+this._writeColorConstant(f)+", "+o+`);\r
`}return e.compilationString+=this._declareOutput(n,e)+" = "+r+`;\r
`,this}e.compilationString+=this._declareOutput(n,e)+` = vec3(0., 0., 0.);\r
`},t.prototype.serialize=function(){var e=i.prototype.serialize.call(this);e.colorSteps=[];for(var n=0,r=this.colorSteps;n<r.length;n++){var o=r[n];e.colorSteps.push({step:o.step,color:{r:o.color.r,g:o.color.g,b:o.color.b}})}return e},t.prototype._deserialize=function(e,n,r){i.prototype._deserialize.call(this,e,n,r),this.colorSteps=[];for(var o=0,u=e.colorSteps;o<u.length;o++){var f=u[o];this.colorSteps.push(new wh(f.step,new M.a(f.color.r,f.color.g,f.color.b)))}},t.prototype._dumpPropertiesCode=function(){for(var e="",n=0,r=this.colorSteps;n<r.length;n++){var o=r[n];e+=this._codeVariableName+".colorSteps.push(new BABYLON.GradientBlockColorStep("+o.step+", new BABYLON.Color3("+o.color.r+", "+o.color.g+", "+o.color.b+`)));\r
`}return e},t}(Et);C.a.RegisteredTypes["BABYLON.GradientBlock"]=jT;var zT=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("left",fe.AutoDetect),n.registerInput("right",fe.AutoDetect),n.registerInput("gradient",fe.AutoDetect),n.registerOutput("output",fe.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n._linkConnectionTypes(0,1),n._linkConnectionTypes(1,2,!0),n._inputs[2].acceptedConnectionPointTypes.push(fe.Float),n}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"NLerpBlock"},Object.defineProperty(t.prototype,"left",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"gradient",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = normalize(mix("+this.left.associatedVariableName+" , "+this.right.associatedVariableName+", "+this.gradient.associatedVariableName+`));\r
`,this},t}(Et);C.a.RegisteredTypes["BABYLON.NLerpBlock"]=zT;var GT=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.manhattanDistance=!1,n.registerInput("seed",fe.Vector3),n.registerInput("jitter",fe.Float),n.registerOutput("output",fe.Vector2),n}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"WorleyNoise3DBlock"},Object.defineProperty(t.prototype,"seed",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"jitter",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){if(i.prototype._buildBlock.call(this,e),this.seed.isConnected&&this._outputs[0].hasEndpoints)return e._emitFunction("worley3D",`vec3 permute(vec3 x){\r
    return mod((34.0 * x + 1.0) * x, 289.0);\r
}\r
\r
vec3 dist(vec3 x, vec3 y, vec3 z,  bool manhattanDistance){\r
    return manhattanDistance ?  abs(x) + abs(y) + abs(z) :  (x * x + y * y + z * z);\r
}\r
\r
vec2 worley(vec3 P, float jitter, bool manhattanDistance){\r
    float K = 0.142857142857; // 1/7\r
    float Ko = 0.428571428571; // 1/2-K/2\r
    float  K2 = 0.020408163265306; // 1/(7*7)\r
    float Kz = 0.166666666667; // 1/6\r
    float Kzo = 0.416666666667; // 1/2-1/6*2\r
\r
    vec3 Pi = mod(floor(P), 289.0);\r
    vec3 Pf = fract(P) - 0.5;\r
\r
    vec3 Pfx = Pf.x + vec3(1.0, 0.0, -1.0);\r
    vec3 Pfy = Pf.y + vec3(1.0, 0.0, -1.0);\r
    vec3 Pfz = Pf.z + vec3(1.0, 0.0, -1.0);\r
\r
    vec3 p = permute(Pi.x + vec3(-1.0, 0.0, 1.0));\r
    vec3 p1 = permute(p + Pi.y - 1.0);\r
    vec3 p2 = permute(p + Pi.y);\r
    vec3 p3 = permute(p + Pi.y + 1.0);\r
\r
    vec3 p11 = permute(p1 + Pi.z - 1.0);\r
    vec3 p12 = permute(p1 + Pi.z);\r
    vec3 p13 = permute(p1 + Pi.z + 1.0);\r
\r
    vec3 p21 = permute(p2 + Pi.z - 1.0);\r
    vec3 p22 = permute(p2 + Pi.z);\r
    vec3 p23 = permute(p2 + Pi.z + 1.0);\r
\r
    vec3 p31 = permute(p3 + Pi.z - 1.0);\r
    vec3 p32 = permute(p3 + Pi.z);\r
    vec3 p33 = permute(p3 + Pi.z + 1.0);\r
\r
    vec3 ox11 = fract(p11*K) - Ko;\r
    vec3 oy11 = mod(floor(p11*K), 7.0)*K - Ko;\r
    vec3 oz11 = floor(p11*K2)*Kz - Kzo; // p11 < 289 guaranteed\r
\r
    vec3 ox12 = fract(p12*K) - Ko;\r
    vec3 oy12 = mod(floor(p12*K), 7.0)*K - Ko;\r
    vec3 oz12 = floor(p12*K2)*Kz - Kzo;\r
\r
    vec3 ox13 = fract(p13*K) - Ko;\r
    vec3 oy13 = mod(floor(p13*K), 7.0)*K - Ko;\r
    vec3 oz13 = floor(p13*K2)*Kz - Kzo;\r
\r
    vec3 ox21 = fract(p21*K) - Ko;\r
    vec3 oy21 = mod(floor(p21*K), 7.0)*K - Ko;\r
    vec3 oz21 = floor(p21*K2)*Kz - Kzo;\r
\r
    vec3 ox22 = fract(p22*K) - Ko;\r
    vec3 oy22 = mod(floor(p22*K), 7.0)*K - Ko;\r
    vec3 oz22 = floor(p22*K2)*Kz - Kzo;\r
\r
    vec3 ox23 = fract(p23*K) - Ko;\r
    vec3 oy23 = mod(floor(p23*K), 7.0)*K - Ko;\r
    vec3 oz23 = floor(p23*K2)*Kz - Kzo;\r
\r
    vec3 ox31 = fract(p31*K) - Ko;\r
    vec3 oy31 = mod(floor(p31*K), 7.0)*K - Ko;\r
    vec3 oz31 = floor(p31*K2)*Kz - Kzo;\r
\r
    vec3 ox32 = fract(p32*K) - Ko;\r
    vec3 oy32 = mod(floor(p32*K), 7.0)*K - Ko;\r
    vec3 oz32 = floor(p32*K2)*Kz - Kzo;\r
\r
    vec3 ox33 = fract(p33*K) - Ko;\r
    vec3 oy33 = mod(floor(p33*K), 7.0)*K - Ko;\r
    vec3 oz33 = floor(p33*K2)*Kz - Kzo;\r
\r
    vec3 dx11 = Pfx + jitter*ox11;\r
    vec3 dy11 = Pfy.x + jitter*oy11;\r
    vec3 dz11 = Pfz.x + jitter*oz11;\r
\r
    vec3 dx12 = Pfx + jitter*ox12;\r
    vec3 dy12 = Pfy.x + jitter*oy12;\r
    vec3 dz12 = Pfz.y + jitter*oz12;\r
\r
    vec3 dx13 = Pfx + jitter*ox13;\r
    vec3 dy13 = Pfy.x + jitter*oy13;\r
    vec3 dz13 = Pfz.z + jitter*oz13;\r
\r
    vec3 dx21 = Pfx + jitter*ox21;\r
    vec3 dy21 = Pfy.y + jitter*oy21;\r
    vec3 dz21 = Pfz.x + jitter*oz21;\r
\r
    vec3 dx22 = Pfx + jitter*ox22;\r
    vec3 dy22 = Pfy.y + jitter*oy22;\r
    vec3 dz22 = Pfz.y + jitter*oz22;\r
\r
    vec3 dx23 = Pfx + jitter*ox23;\r
    vec3 dy23 = Pfy.y + jitter*oy23;\r
    vec3 dz23 = Pfz.z + jitter*oz23;\r
\r
    vec3 dx31 = Pfx + jitter*ox31;\r
    vec3 dy31 = Pfy.z + jitter*oy31;\r
    vec3 dz31 = Pfz.x + jitter*oz31;\r
\r
    vec3 dx32 = Pfx + jitter*ox32;\r
    vec3 dy32 = Pfy.z + jitter*oy32;\r
    vec3 dz32 = Pfz.y + jitter*oz32;\r
\r
    vec3 dx33 = Pfx + jitter*ox33;\r
    vec3 dy33 = Pfy.z + jitter*oy33;\r
    vec3 dz33 = Pfz.z + jitter*oz33;\r
\r
    vec3 d11 = dist(dx11, dy11, dz11, manhattanDistance);\r
    vec3 d12 =dist(dx12, dy12, dz12, manhattanDistance);\r
    vec3 d13 = dist(dx13, dy13, dz13, manhattanDistance);\r
    vec3 d21 = dist(dx21, dy21, dz21, manhattanDistance);\r
    vec3 d22 = dist(dx22, dy22, dz22, manhattanDistance);\r
    vec3 d23 = dist(dx23, dy23, dz23, manhattanDistance);\r
    vec3 d31 = dist(dx31, dy31, dz31, manhattanDistance);\r
    vec3 d32 = dist(dx32, dy32, dz32, manhattanDistance);\r
    vec3 d33 = dist(dx33, dy33, dz33, manhattanDistance);\r
\r
    vec3 d1a = min(d11, d12);\r
    d12 = max(d11, d12);\r
    d11 = min(d1a, d13); // Smallest now not in d12 or d13\r
    d13 = max(d1a, d13);\r
    d12 = min(d12, d13); // 2nd smallest now not in d13\r
    vec3 d2a = min(d21, d22);\r
    d22 = max(d21, d22);\r
    d21 = min(d2a, d23); // Smallest now not in d22 or d23\r
    d23 = max(d2a, d23);\r
    d22 = min(d22, d23); // 2nd smallest now not in d23\r
    vec3 d3a = min(d31, d32);\r
    d32 = max(d31, d32);\r
    d31 = min(d3a, d33); // Smallest now not in d32 or d33\r
    d33 = max(d3a, d33);\r
    d32 = min(d32, d33); // 2nd smallest now not in d33\r
    vec3 da = min(d11, d21);\r
    d21 = max(d11, d21);\r
    d11 = min(da, d31); // Smallest now in d11\r
    d31 = max(da, d31); // 2nd smallest now not in d31\r
    d11.xy = (d11.x < d11.y) ? d11.xy : d11.yx;\r
    d11.xz = (d11.x < d11.z) ? d11.xz : d11.zx; // d11.x now smallest\r
    d12 = min(d12, d21); // 2nd smallest now not in d21\r
    d12 = min(d12, d22); // nor in d22\r
    d12 = min(d12, d31); // nor in d31\r
    d12 = min(d12, d32); // nor in d32\r
    d11.yz = min(d11.yz,d12.xy); // nor in d12.yz\r
    d11.y = min(d11.y,d12.z); // Only two more to go\r
    d11.y = min(d11.y,d11.z); // Done! (Phew!)\r
    return sqrt(d11.xy); // F1, F2\r
}\r
\r
`,"// Worley3D"),e.compilationString+=this._declareOutput(this._outputs[0],e)+" = worley("+this.seed.associatedVariableName+", "+this.jitter.associatedVariableName+", "+this.manhattanDistance+`);\r
`,this},t.prototype._dumpPropertiesCode=function(){return this._codeVariableName+".manhattanDistance = "+this.manhattanDistance+`;\r
`},t.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return e.manhattanDistance=this.manhattanDistance,e},t.prototype._deserialize=function(e,n,r){i.prototype._deserialize.call(this,e,n,r),this.manhattanDistance=e.manhattanDistance},Object(p.c)([sn("Use Manhattan Distance",$t.Boolean,"PROPERTIES",{notifiers:{update:!1}})],t.prototype,"manhattanDistance",void 0),t}(Et);C.a.RegisteredTypes["BABYLON.WorleyNoise3DBlock"]=GT;var HT=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("seed",fe.Vector3),n.registerOutput("output",fe.Float),n}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"SimplexPerlin3DBlock"},Object.defineProperty(t.prototype,"seed",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){if(i.prototype._buildBlock.call(this,e),this.seed.isConnected&&this._outputs[0].hasEndpoints)return e._emitFunction("SimplexPerlin3D",`const float SKEWFACTOR = 1.0/3.0;\r
const float UNSKEWFACTOR = 1.0/6.0;\r
const float SIMPLEX_CORNER_POS = 0.5;\r
const float SIMPLEX_TETRAHADRON_HEIGHT = 0.70710678118654752440084436210485;\r
float SimplexPerlin3D( vec3 P ){\r
    P *= SIMPLEX_TETRAHADRON_HEIGHT;\r
    vec3 Pi = floor( P + dot( P, vec3( SKEWFACTOR) ) );    vec3 x0 = P - Pi + dot(Pi, vec3( UNSKEWFACTOR ) );\r
    vec3 g = step(x0.yzx, x0.xyz);\r
    vec3 l = 1.0 - g;\r
    vec3 Pi_1 = min( g.xyz, l.zxy );\r
    vec3 Pi_2 = max( g.xyz, l.zxy );\r
    vec3 x1 = x0 - Pi_1 + UNSKEWFACTOR;\r
    vec3 x2 = x0 - Pi_2 + SKEWFACTOR;\r
    vec3 x3 = x0 - SIMPLEX_CORNER_POS;\r
    vec4 v1234_x = vec4( x0.x, x1.x, x2.x, x3.x );\r
    vec4 v1234_y = vec4( x0.y, x1.y, x2.y, x3.y );\r
    vec4 v1234_z = vec4( x0.z, x1.z, x2.z, x3.z );\r
    Pi.xyz = Pi.xyz - floor(Pi.xyz * ( 1.0 / 69.0 )) * 69.0;\r
    vec3 Pi_inc1 = step( Pi, vec3( 69.0 - 1.5 ) ) * ( Pi + 1.0 );\r
    vec4 Pt = vec4( Pi.xy, Pi_inc1.xy ) + vec2( 50.0, 161.0 ).xyxy;\r
    Pt *= Pt;\r
    vec4 V1xy_V2xy = mix( Pt.xyxy, Pt.zwzw, vec4( Pi_1.xy, Pi_2.xy ) );\r
    Pt = vec4( Pt.x, V1xy_V2xy.xz, Pt.z ) * vec4( Pt.y, V1xy_V2xy.yw, Pt.w );\r
    const vec3 SOMELARGEFLOATS = vec3( 635.298681, 682.357502, 668.926525 );\r
    const vec3 ZINC = vec3( 48.500388, 65.294118, 63.934599 );\r
    vec3 lowz_mods = vec3( 1.0 / ( SOMELARGEFLOATS.xyz + Pi.zzz * ZINC.xyz ) );\r
    vec3 highz_mods = vec3( 1.0 / ( SOMELARGEFLOATS.xyz + Pi_inc1.zzz * ZINC.xyz ) );\r
    Pi_1 = ( Pi_1.z < 0.5 ) ? lowz_mods : highz_mods;\r
    Pi_2 = ( Pi_2.z < 0.5 ) ? lowz_mods : highz_mods;\r
    vec4 hash_0 = fract( Pt * vec4( lowz_mods.x, Pi_1.x, Pi_2.x, highz_mods.x ) ) - 0.49999;\r
    vec4 hash_1 = fract( Pt * vec4( lowz_mods.y, Pi_1.y, Pi_2.y, highz_mods.y ) ) - 0.49999;\r
    vec4 hash_2 = fract( Pt * vec4( lowz_mods.z, Pi_1.z, Pi_2.z, highz_mods.z ) ) - 0.49999;\r
    vec4 grad_results = inversesqrt( hash_0 * hash_0 + hash_1 * hash_1 + hash_2 * hash_2 ) * ( hash_0 * v1234_x + hash_1 * v1234_y + hash_2 * v1234_z );\r
    const float FINAL_NORMALIZATION = 37.837227241611314102871574478976;\r
    vec4 kernel_weights = v1234_x * v1234_x + v1234_y * v1234_y + v1234_z * v1234_z;\r
    kernel_weights = max(0.5 - kernel_weights, 0.0);\r
    kernel_weights = kernel_weights*kernel_weights*kernel_weights;\r
    return dot( kernel_weights, grad_results ) * FINAL_NORMALIZATION;\r
}\r
`,"// SimplexPerlin3D"),e.compilationString+=this._declareOutput(this._outputs[0],e)+" = SimplexPerlin3D("+this.seed.associatedVariableName+`);\r
`,this},t}(Et);C.a.RegisteredTypes["BABYLON.SimplexPerlin3DBlock"]=HT;var WT=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("normalMap0",fe.Vector3),n.registerInput("normalMap1",fe.Vector3),n.registerOutput("output",fe.Vector3),n._inputs[0].acceptedConnectionPointTypes.push(fe.Color3),n._inputs[0].acceptedConnectionPointTypes.push(fe.Color4),n._inputs[0].acceptedConnectionPointTypes.push(fe.Vector4),n._inputs[1].acceptedConnectionPointTypes.push(fe.Color3),n._inputs[1].acceptedConnectionPointTypes.push(fe.Color4),n._inputs[1].acceptedConnectionPointTypes.push(fe.Vector4),n}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"NormalBlendBlock"},Object.defineProperty(t.prototype,"normalMap0",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"normalMap1",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0],r=this._inputs[0],o=this._inputs[1],u=e._getFreeVariableName("stepR"),f=e._getFreeVariableName("stepG");return e.compilationString+="float "+u+" = step(0.5, "+r.associatedVariableName+`.r);\r
`,e.compilationString+="float "+f+" = step(0.5, "+r.associatedVariableName+`.g);\r
`,e.compilationString+=this._declareOutput(n,e)+`;\r
`,e.compilationString+=n.associatedVariableName+".r = (1.0 - "+u+") * "+r.associatedVariableName+".r * "+o.associatedVariableName+".r * 2.0 + "+u+" * (1.0 - "+r.associatedVariableName+".r) * (1.0 - "+o.associatedVariableName+`.r) * 2.0;\r
`,e.compilationString+=n.associatedVariableName+".g = (1.0 - "+f+") * "+r.associatedVariableName+".g * "+o.associatedVariableName+".g * 2.0 + "+f+" * (1.0 - "+r.associatedVariableName+".g) * (1.0 - "+o.associatedVariableName+`.g) * 2.0;\r
`,e.compilationString+=n.associatedVariableName+".b = "+r.associatedVariableName+".b * "+o.associatedVariableName+`.b;\r
`,this},t}(Et);C.a.RegisteredTypes["BABYLON.NormalBlendBlock"]=WT;var XT=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("input",fe.Vector2),n.registerInput("angle",fe.Float),n.registerOutput("output",fe.Vector2),n}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"Rotate2dBlock"},Object.defineProperty(t.prototype,"input",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"angle",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype.autoConfigure=function(e){if(!this.angle.isConnected){var n=new Bt("angle");n.value=0,n.output.connectTo(this.angle)}},t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0],r=this.angle,o=this.input;return e.compilationString+=this._declareOutput(n,e)+" = vec2(cos("+r.associatedVariableName+") * "+o.associatedVariableName+".x - sin("+r.associatedVariableName+") * "+o.associatedVariableName+".y, sin("+r.associatedVariableName+") * "+o.associatedVariableName+".x + cos("+r.associatedVariableName+") * "+o.associatedVariableName+`.y);\r
`,this},t}(Et);C.a.RegisteredTypes["BABYLON.Rotate2dBlock"]=XT;var YT=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("incident",fe.Vector3),n.registerInput("normal",fe.Vector3),n.registerOutput("output",fe.Vector3),n._inputs[0].acceptedConnectionPointTypes.push(fe.Vector4),n._inputs[0].acceptedConnectionPointTypes.push(fe.Color3),n._inputs[0].acceptedConnectionPointTypes.push(fe.Color4),n._inputs[1].acceptedConnectionPointTypes.push(fe.Vector4),n._inputs[1].acceptedConnectionPointTypes.push(fe.Color3),n._inputs[1].acceptedConnectionPointTypes.push(fe.Color4),n}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"ReflectBlock"},Object.defineProperty(t.prototype,"incident",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"normal",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = reflect("+this.incident.associatedVariableName+".xyz, "+this.normal.associatedVariableName+`.xyz);\r
`,this},t}(Et);C.a.RegisteredTypes["BABYLON.ReflectBlock"]=YT;var KT=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("incident",fe.Vector3),n.registerInput("normal",fe.Vector3),n.registerInput("ior",fe.Float),n.registerOutput("output",fe.Vector3),n._inputs[0].acceptedConnectionPointTypes.push(fe.Vector4),n._inputs[0].acceptedConnectionPointTypes.push(fe.Color3),n._inputs[0].acceptedConnectionPointTypes.push(fe.Color4),n._inputs[1].acceptedConnectionPointTypes.push(fe.Vector4),n._inputs[1].acceptedConnectionPointTypes.push(fe.Color3),n._inputs[1].acceptedConnectionPointTypes.push(fe.Color4),n}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"RefractBlock"},Object.defineProperty(t.prototype,"incident",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"normal",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ior",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = refract("+this.incident.associatedVariableName+".xyz, "+this.normal.associatedVariableName+".xyz, "+this.ior.associatedVariableName+`);\r
`,this},t}(Et);C.a.RegisteredTypes["BABYLON.RefractBlock"]=KT;var QT=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("color",fe.Color3),n.registerInput("level",fe.Float),n.registerOutput("output",fe.Color3),n}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"DesaturateBlock"},Object.defineProperty(t.prototype,"color",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"level",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0],r=this.color.associatedVariableName,o=e._getFreeVariableName("colorMin"),u=e._getFreeVariableName("colorMax"),f=e._getFreeVariableName("colorMerge");return e.compilationString+="float "+o+" = min(min("+r+".x, "+r+".y), "+r+`.z);\r
`,e.compilationString+="float "+u+" = max(max("+r+".x, "+r+".y), "+r+`.z);\r
`,e.compilationString+="float "+f+" = 0.5 * ("+o+" + "+u+`);\r
`,e.compilationString+=this._declareOutput(n,e)+" = mix("+r+", vec3("+f+", "+f+", "+f+"), "+this.level.associatedVariableName+`);\r
`,this},t}(Et);C.a.RegisteredTypes["BABYLON.DesaturateBlock"]=QT;var di=function(i){function t(e,n,r,o,u,f){var v=i.call(this,e,n,r)||this;return v._blockType=o,v._blockName=u,v._nameForCheking=f,v._nameForCheking||(v._nameForCheking=e),v.needDualDirectionValidation=!0,v}return Object(p.d)(t,i),t.prototype.checkCompatibilityState=function(e){return e instanceof t&&e.name===this._nameForCheking?Ai.Compatible:Ai.TypeIncompatible},t.prototype.createCustomInputBlock=function(){return[new this._blockType(this._blockName),this.name]},t}(Ch),Lm=function(i){function t(e){var n=i.call(this,e,Me.Fragment)||this;return n.albedoScaling=!1,n.linkSheenWithAlbedo=!1,n._isUnique=!0,n.registerInput("intensity",fe.Float,!0,Me.Fragment),n.registerInput("color",fe.Color3,!0,Me.Fragment),n.registerInput("roughness",fe.Float,!0,Me.Fragment),n.registerOutput("sheen",fe.Object,Me.Fragment,new di("sheen",n,yr.Output,t,"SheenBlock")),n}return Object(p.d)(t,i),t.prototype.initialize=function(e){e._excludeVariableName("sheenOut"),e._excludeVariableName("sheenMapData"),e._excludeVariableName("vSheenColor"),e._excludeVariableName("vSheenRoughness")},t.prototype.getClassName=function(){return"SheenBlock"},Object.defineProperty(t.prototype,"intensity",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"roughness",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sheen",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype.prepareDefines=function(e,n,r){i.prototype.prepareDefines.call(this,e,n,r),r.setValue("SHEEN",!0),r.setValue("SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE",!0,!0),r.setValue("SHEEN_LINKWITHALBEDO",this.linkSheenWithAlbedo,!0),r.setValue("SHEEN_ROUGHNESS",this.roughness.isConnected,!0),r.setValue("SHEEN_ALBEDOSCALING",this.albedoScaling,!0)},t.prototype.getCode=function(e){return`#ifdef SHEEN
            sheenOutParams sheenOut;

            vec4 vSheenColor = vec4(`+(this.color.isConnected?this.color.associatedVariableName:"vec3(1.)")+", "+(this.intensity.isConnected?this.intensity.associatedVariableName:"1.")+`);

            sheenBlock(
                vSheenColor,
            #ifdef SHEEN_ROUGHNESS
                `+(this.roughness.isConnected?this.roughness.associatedVariableName:"0.")+`,
            #endif
                roughness,
            #ifdef SHEEN_TEXTURE
                vec4(0.),
            #endif
                reflectance,
            #ifdef SHEEN_LINKWITHALBEDO
                baseColor,
                surfaceAlbedo,
            #endif
            #ifdef ENVIRONMENTBRDF
                NdotV,
                environmentBrdf,
            #endif
            #if defined(REFLECTION) && defined(ENVIRONMENTBRDF)
                AARoughnessFactors,
                `+(e==null?void 0:e._vReflectionMicrosurfaceInfosName)+`,
                `+(e==null?void 0:e._vReflectionInfosName)+`,
                `+(e==null?void 0:e.reflectionColor)+`,
                vLightingIntensity,
                #ifdef `+(e==null?void 0:e._define3DName)+`
                    `+(e==null?void 0:e._cubeSamplerName)+`,
                #else
                    `+(e==null?void 0:e._2DSamplerName)+`,
                #endif
                reflectionOut.reflectionCoords,
                NdotVUnclamped,
                #ifndef LODBASEDMICROSFURACE
                    #ifdef `+(e==null?void 0:e._define3DName)+`
                        `+(e==null?void 0:e._cubeSamplerName)+`,
                        `+(e==null?void 0:e._cubeSamplerName)+`,
                    #else
                        `+(e==null?void 0:e._2DSamplerName)+`,
                        `+(e==null?void 0:e._2DSamplerName)+`,
                    #endif
                #endif
                #if !defined(`+(e==null?void 0:e._defineSkyboxName)+`) && defined(RADIANCEOCCLUSION)
                    seo,
                #endif
                #if !defined(`+(e==null?void 0:e._defineSkyboxName)+") && defined(HORIZONOCCLUSION) && defined(BUMP) && defined("+(e==null?void 0:e._define3DName)+`)
                    eho,
                #endif
            #endif
                sheenOut
            );

            #ifdef SHEEN_LINKWITHALBEDO
                surfaceAlbedo = sheenOut.surfaceAlbedo;
            #endif
        #endif\r
`},t.prototype._buildBlock=function(e){return e.target===Me.Fragment&&e.sharedData.blocksWithDefines.push(this),this},t.prototype._dumpPropertiesCode=function(){var e=i.prototype._dumpPropertiesCode.call(this);return e+=this._codeVariableName+".albedoScaling = "+this.albedoScaling+`;\r
`,e+=this._codeVariableName+".linkSheenWithAlbedo = "+this.linkSheenWithAlbedo+`;\r
`},t.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return e.albedoScaling=this.albedoScaling,e.linkSheenWithAlbedo=this.linkSheenWithAlbedo,e},t.prototype._deserialize=function(e,n,r){i.prototype._deserialize.call(this,e,n,r),this.albedoScaling=e.albedoScaling,this.linkSheenWithAlbedo=e.linkSheenWithAlbedo},Object(p.c)([sn("Albedo scaling",$t.Boolean,"PROPERTIES",{notifiers:{update:!0}})],t.prototype,"albedoScaling",void 0),Object(p.c)([sn("Link sheen with albedo",$t.Boolean,"PROPERTIES",{notifiers:{update:!0}})],t.prototype,"linkSheenWithAlbedo",void 0),t}(Et);C.a.RegisteredTypes["BABYLON.SheenBlock"]=Lm;var Nm=function(i){function t(e){var n=i.call(this,e,Me.Fragment)||this;return n._isUnique=!0,n.registerInput("intensity",fe.Float,!0,Me.Fragment),n.registerInput("direction",fe.Vector2,!0,Me.Fragment),n.registerInput("uv",fe.Vector2,!0),n.registerInput("worldTangent",fe.Vector4,!0),n.registerOutput("anisotropy",fe.Object,Me.Fragment,new di("anisotropy",n,yr.Output,t,"AnisotropyBlock")),n}return Object(p.d)(t,i),t.prototype.initialize=function(e){e._excludeVariableName("anisotropicOut"),e._excludeVariableName("TBN")},t.prototype.getClassName=function(){return"AnisotropyBlock"},Object.defineProperty(t.prototype,"intensity",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"direction",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"uv",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"worldTangent",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"anisotropy",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._generateTBNSpace=function(e){var n="",r="//"+this.name,o=this.uv,u=this.worldPositionConnectionPoint,f=this.worldNormalConnectionPoint,v=this.worldTangent;o.isConnected||console.error("You must connect the 'uv' input of the Anisotropy block!"),e._emitExtension("derivatives","#extension GL_OES_standard_derivatives : enable");var y={search:/defined\(TANGENT\)/g,replace:v.isConnected?"defined(TANGENT)":"defined(IGNORE)"};return v.isConnected&&(n+="vec3 tbnNormal = normalize("+f.associatedVariableName+`.xyz);\r
`,n+="vec3 tbnTangent = normalize("+v.associatedVariableName+`.xyz);\r
`,n+=`vec3 tbnBitangent = cross(tbnNormal, tbnTangent);\r
`,n+=`mat3 vTBN = mat3(tbnTangent, tbnBitangent, tbnNormal);\r
`),n+=`
            #if defined(`+(v.isConnected?"TANGENT":"IGNORE")+`) && defined(NORMAL)
                mat3 TBN = vTBN;
            #else
                mat3 TBN = cotangent_frame(`+f.associatedVariableName+".xyz, v_"+u.associatedVariableName+".xyz, "+(o.isConnected?o.associatedVariableName:"vec2(0.)")+`, vec2(1., 1.));
            #endif\r
`,e._emitFunctionFromInclude("bumpFragmentMainFunctions",r,{replaceStrings:[y]}),n},t.prototype.getCode=function(e,n){n===void 0&&(n=!1);var r="";n&&(r+=this._generateTBNSpace(e));var o=this.intensity.isConnected?this.intensity.associatedVariableName:"1.0";return r+=`anisotropicOutParams anisotropicOut;
            anisotropicBlock(
                vec3(`+(this.direction.isConnected?this.direction.associatedVariableName:"vec2(1., 0.)")+", "+o+`),
            #ifdef ANISOTROPIC_TEXTURE
                vec3(0.),
            #endif
                TBN,
                normalW,
                viewDirectionW,
                anisotropicOut
            );\r
`},t.prototype.prepareDefines=function(e,n,r){i.prototype.prepareDefines.call(this,e,n,r),r.setValue("ANISOTROPIC",!0),r.setValue("ANISOTROPIC_TEXTURE",!1,!0)},t.prototype._buildBlock=function(e){return e.target===Me.Fragment&&e.sharedData.blocksWithDefines.push(this),this},t}(Et);C.a.RegisteredTypes["BABYLON.AnisotropyBlock"]=Nm;var Fm=function(i){function t(e){var n=i.call(this,e)||this;return n.useSphericalHarmonics=!0,n.forceIrradianceInFragment=!1,n._isUnique=!0,n.registerInput("position",fe.Vector3,!1,Me.Vertex),n.registerInput("world",fe.Matrix,!1,Me.Vertex),n.registerInput("color",fe.Color3,!0,Me.Fragment),n.registerOutput("reflection",fe.Object,Me.Fragment,new di("reflection",n,yr.Output,t,"ReflectionBlock")),n}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"ReflectionBlock"},Object.defineProperty(t.prototype,"position",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"worldPosition",{get:function(){return this.worldPositionConnectionPoint},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"worldNormal",{get:function(){return this.worldNormalConnectionPoint},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"world",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraPosition",{get:function(){return this.cameraPositionConnectionPoint},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"view",{get:function(){return this.viewConnectionPoint},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"reflection",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasTexture",{get:function(){return!!this._getTexture()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"reflectionColor",{get:function(){return this.color.isConnected?this.color.associatedVariableName:"vec3(1., 1., 1.)"},enumerable:!1,configurable:!0}),t.prototype._getTexture=function(){return this.texture?this.texture:this._scene.environmentTexture},t.prototype.prepareDefines=function(e,n,r){i.prototype.prepareDefines.call(this,e,n,r);var o=this._getTexture(),u=o&&o.getTextureMatrix;r.setValue("REFLECTION",u,!0),u&&(r.setValue(this._defineLODReflectionAlpha,o.lodLevelInAlpha,!0),r.setValue(this._defineLinearSpecularReflection,o.linearSpecularLOD,!0),r.setValue(this._defineOppositeZ,this._scene.useRightHandedSystem?!o.invertZ:o.invertZ,!0),r.setValue("SPHERICAL_HARMONICS",this.useSphericalHarmonics,!0),r.setValue("GAMMAREFLECTION",o.gammaSpace,!0),r.setValue("RGBDREFLECTION",o.isRGBD,!0),o&&o.coordinatesMode!==ke.a.SKYBOX_MODE&&o.isCube&&(r.setValue("USESPHERICALFROMREFLECTIONMAP",!0),r.setValue("USEIRRADIANCEMAP",!1),this.forceIrradianceInFragment||this._scene.getEngine().getCaps().maxVaryingVectors<=8?r.setValue("USESPHERICALINVERTEX",!1):r.setValue("USESPHERICALINVERTEX",!0)))},t.prototype.bind=function(e,n,r,o){i.prototype.bind.call(this,e,n,r);var u=this._getTexture();if(u&&o){u.isCube?e.setTexture(this._cubeSamplerName,u):e.setTexture(this._2DSamplerName,u);var f=u.getSize().width;e.setFloat3(this._vReflectionMicrosurfaceInfosName,f,u.lodGenerationScale,u.lodGenerationOffset),e.setFloat2(this._vReflectionFilteringInfoName,f,te.a.Log2(f));var v=o._materialDefines,y=u.sphericalPolynomial;if(v.USESPHERICALFROMREFLECTIONMAP&&y)if(v.SPHERICAL_HARMONICS){var D=y.preScaledHarmonics;e.setVector3("vSphericalL00",D.l00),e.setVector3("vSphericalL1_1",D.l1_1),e.setVector3("vSphericalL10",D.l10),e.setVector3("vSphericalL11",D.l11),e.setVector3("vSphericalL2_2",D.l2_2),e.setVector3("vSphericalL2_1",D.l2_1),e.setVector3("vSphericalL20",D.l20),e.setVector3("vSphericalL21",D.l21),e.setVector3("vSphericalL22",D.l22)}else e.setFloat3("vSphericalX",y.x.x,y.x.y,y.x.z),e.setFloat3("vSphericalY",y.y.x,y.y.y,y.y.z),e.setFloat3("vSphericalZ",y.z.x,y.z.y,y.z.z),e.setFloat3("vSphericalXX_ZZ",y.xx.x-y.zz.x,y.xx.y-y.zz.y,y.xx.z-y.zz.z),e.setFloat3("vSphericalYY_ZZ",y.yy.x-y.zz.x,y.yy.y-y.zz.y,y.yy.z-y.zz.z),e.setFloat3("vSphericalZZ",y.zz.x,y.zz.y,y.zz.z),e.setFloat3("vSphericalXY",y.xy.x,y.xy.y,y.xy.z),e.setFloat3("vSphericalYZ",y.yz.x,y.yz.y,y.yz.z),e.setFloat3("vSphericalZX",y.zx.x,y.zx.y,y.zx.z)}},t.prototype.handleVertexSide=function(e){var n=i.prototype.handleVertexSide.call(this,e);e._emitFunctionFromInclude("harmonicsFunctions","//"+this.name,{replaceStrings:[{search:/uniform vec3 vSphericalL00;[\s\S]*?uniform vec3 vSphericalL22;/g,replace:""},{search:/uniform vec3 vSphericalX;[\s\S]*?uniform vec3 vSphericalZX;/g,replace:""}]});var r=e._getFreeVariableName("reflectionVector");return this._vEnvironmentIrradianceName=e._getFreeVariableName("vEnvironmentIrradiance"),e._emitVaryingFromString(this._vEnvironmentIrradianceName,"vec3","defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)"),e._emitUniformFromString("vSphericalL00","vec3","SPHERICAL_HARMONICS"),e._emitUniformFromString("vSphericalL1_1","vec3","SPHERICAL_HARMONICS"),e._emitUniformFromString("vSphericalL10","vec3","SPHERICAL_HARMONICS"),e._emitUniformFromString("vSphericalL11","vec3","SPHERICAL_HARMONICS"),e._emitUniformFromString("vSphericalL2_2","vec3","SPHERICAL_HARMONICS"),e._emitUniformFromString("vSphericalL2_1","vec3","SPHERICAL_HARMONICS"),e._emitUniformFromString("vSphericalL20","vec3","SPHERICAL_HARMONICS"),e._emitUniformFromString("vSphericalL21","vec3","SPHERICAL_HARMONICS"),e._emitUniformFromString("vSphericalL22","vec3","SPHERICAL_HARMONICS"),e._emitUniformFromString("vSphericalX","vec3","SPHERICAL_HARMONICS",!0),e._emitUniformFromString("vSphericalY","vec3","SPHERICAL_HARMONICS",!0),e._emitUniformFromString("vSphericalZ","vec3","SPHERICAL_HARMONICS",!0),e._emitUniformFromString("vSphericalXX_ZZ","vec3","SPHERICAL_HARMONICS",!0),e._emitUniformFromString("vSphericalYY_ZZ","vec3","SPHERICAL_HARMONICS",!0),e._emitUniformFromString("vSphericalZZ","vec3","SPHERICAL_HARMONICS",!0),e._emitUniformFromString("vSphericalXY","vec3","SPHERICAL_HARMONICS",!0),e._emitUniformFromString("vSphericalYZ","vec3","SPHERICAL_HARMONICS",!0),e._emitUniformFromString("vSphericalZX","vec3","SPHERICAL_HARMONICS",!0),n+=`#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)
                vec3 `+r+" = vec3("+this._reflectionMatrixName+" * vec4(normalize("+this.worldNormal.associatedVariableName+`).xyz, 0)).xyz;
                #ifdef `+this._defineOppositeZ+`
                    `+r+`.z *= -1.0;
                #endif
                `+this._vEnvironmentIrradianceName+" = computeEnvironmentIrradiance("+r+`);
            #endif\r
`},t.prototype.getCode=function(e,n){var r="";this.handleFragmentSideInits(e),e._emitFunctionFromInclude("harmonicsFunctions","//"+this.name,{replaceStrings:[{search:/uniform vec3 vSphericalL00;[\s\S]*?uniform vec3 vSphericalL22;/g,replace:""},{search:/uniform vec3 vSphericalX;[\s\S]*?uniform vec3 vSphericalZX;/g,replace:""}]}),e._emitFunction("sampleReflection",`
            #ifdef `+this._define3DName+`
                #define sampleReflection(s, c) textureCube(s, c)
            #else
                #define sampleReflection(s, c) texture2D(s, c)
            #endif\r
`,"//"+this.name),e._emitFunction("sampleReflectionLod",`
            #ifdef `+this._define3DName+`
                #define sampleReflectionLod(s, c, l) textureCubeLodEXT(s, c, l)
            #else
                #define sampleReflectionLod(s, c, l) texture2DLodEXT(s, c, l)
            #endif\r
`,"//"+this.name);var o=`
            vec3 computeReflectionCoordsPBR(vec4 worldPos, vec3 worldNormal) {
                `+this.handleFragmentSideCodeReflectionCoords("worldNormal","worldPos",!0)+`
                return `+this._reflectionVectorName+`;
            }\r
`;return e._emitFunction("computeReflectionCoordsPBR",o,"//"+this.name),this._vReflectionMicrosurfaceInfosName=e._getFreeVariableName("vReflectionMicrosurfaceInfos"),e._emitUniformFromString(this._vReflectionMicrosurfaceInfosName,"vec3"),this._vReflectionInfosName=e._getFreeVariableName("vReflectionInfos"),this._vReflectionFilteringInfoName=e._getFreeVariableName("vReflectionFilteringInfo"),e._emitUniformFromString(this._vReflectionFilteringInfoName,"vec2"),r+=`#ifdef REFLECTION
            vec2 `+this._vReflectionInfosName+` = vec2(1., 0.);

            reflectionOutParams reflectionOut;

            reflectionBlock(
                v_`+this.worldPosition.associatedVariableName+`.xyz,
                `+n+`,
                alphaG,
                `+this._vReflectionMicrosurfaceInfosName+`,
                `+this._vReflectionInfosName+`,
                `+this.reflectionColor+`,
            #ifdef ANISOTROPIC
                anisotropicOut,
            #endif
            #if defined(`+this._defineLODReflectionAlpha+") && !defined("+this._defineSkyboxName+`)
                NdotVUnclamped,
            #endif
            #ifdef `+this._defineLinearSpecularReflection+`
                roughness,
            #endif
            #ifdef `+this._define3DName+`
                `+this._cubeSamplerName+`,
            #else
                `+this._2DSamplerName+`,
            #endif
            #if defined(NORMAL) && defined(USESPHERICALINVERTEX)
                `+this._vEnvironmentIrradianceName+`,
            #endif
            #ifdef USESPHERICALFROMREFLECTIONMAP
                #if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)
                    `+this._reflectionMatrixName+`,
                #endif
            #endif
            #ifdef USEIRRADIANCEMAP
                irradianceSampler, // ** not handled **
            #endif
            #ifndef LODBASEDMICROSFURACE
                #ifdef `+this._define3DName+`
                    `+this._cubeSamplerName+`,
                    `+this._cubeSamplerName+`,
                #else
                    `+this._2DSamplerName+`,
                    `+this._2DSamplerName+`,
                #endif
            #endif
            #ifdef REALTIME_FILTERING
                `+this._vReflectionFilteringInfoName+`,
            #endif
                reflectionOut
            );
        #endif\r
`},t.prototype._buildBlock=function(e){return this._scene=e.sharedData.scene,e.target!==Me.Fragment&&(this._defineLODReflectionAlpha=e._getFreeDefineName("LODINREFLECTIONALPHA"),this._defineLinearSpecularReflection=e._getFreeDefineName("LINEARSPECULARREFLECTION")),this},t.prototype._dumpPropertiesCode=function(){var e=i.prototype._dumpPropertiesCode.call(this);return this.texture&&(e+=this._codeVariableName+".texture.gammaSpace = "+this.texture.gammaSpace+`);\r
`),e+=this._codeVariableName+".useSphericalHarmonics = "+this.useSphericalHarmonics+`;\r
`,e+=this._codeVariableName+".forceIrradianceInFragment = "+this.forceIrradianceInFragment+`;\r
`},t.prototype.serialize=function(){var e,n,r=i.prototype.serialize.call(this);return r.useSphericalHarmonics=this.useSphericalHarmonics,r.forceIrradianceInFragment=this.forceIrradianceInFragment,r.gammaSpace=(n=(e=this.texture)===null||e===void 0?void 0:e.gammaSpace)===null||n===void 0||n,r},t.prototype._deserialize=function(e,n,r){i.prototype._deserialize.call(this,e,n,r),this.useSphericalHarmonics=e.useSphericalHarmonics,this.forceIrradianceInFragment=e.forceIrradianceInFragment,this.texture&&(this.texture.gammaSpace=e.gammaSpace)},Object(p.c)([sn("Spherical Harmonics",$t.Boolean,"ADVANCED",{notifiers:{update:!0}})],t.prototype,"useSphericalHarmonics",void 0),Object(p.c)([sn("Force irradiance in fragment",$t.Boolean,"ADVANCED",{notifiers:{update:!0}})],t.prototype,"forceIrradianceInFragment",void 0),t}(Im);C.a.RegisteredTypes["BABYLON.ReflectionBlock"]=Fm;var Lh=function(i){function t(e){var n=i.call(this,e,Me.Fragment)||this;return n.remapF0OnInterfaceChange=!0,n._isUnique=!0,n.registerInput("intensity",fe.Float,!1,Me.Fragment),n.registerInput("roughness",fe.Float,!0,Me.Fragment),n.registerInput("indexOfRefraction",fe.Float,!0,Me.Fragment),n.registerInput("normalMapColor",fe.Color3,!0,Me.Fragment),n.registerInput("uv",fe.Vector2,!0,Me.Fragment),n.registerInput("tintColor",fe.Color3,!0,Me.Fragment),n.registerInput("tintAtDistance",fe.Float,!0,Me.Fragment),n.registerInput("tintThickness",fe.Float,!0,Me.Fragment),n.registerInput("worldTangent",fe.Vector4,!0),n.registerOutput("clearcoat",fe.Object,Me.Fragment,new di("clearcoat",n,yr.Output,t,"ClearCoatBlock")),n}return Object(p.d)(t,i),t.prototype.initialize=function(e){e._excludeVariableName("clearcoatOut"),e._excludeVariableName("vClearCoatParams"),e._excludeVariableName("vClearCoatTintParams"),e._excludeVariableName("vClearCoatRefractionParams"),e._excludeVariableName("vClearCoatTangentSpaceParams")},t.prototype.getClassName=function(){return"ClearCoatBlock"},Object.defineProperty(t.prototype,"intensity",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"roughness",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"indexOfRefraction",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"normalMapColor",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"uv",{get:function(){return this._inputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tintColor",{get:function(){return this._inputs[5]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tintAtDistance",{get:function(){return this._inputs[6]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tintThickness",{get:function(){return this._inputs[7]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"worldTangent",{get:function(){return this._inputs[8]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"clearcoat",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype.autoConfigure=function(e){if(!this.intensity.isConnected){var n=new Bt("ClearCoat intensity",Me.Fragment,fe.Float);n.value=1,n.output.connectTo(this.intensity)}},t.prototype.prepareDefines=function(e,n,r){i.prototype.prepareDefines.call(this,e,n,r),r.setValue("CLEARCOAT",!0),r.setValue("CLEARCOAT_TEXTURE",!1,!0),r.setValue("CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE",!0,!0),r.setValue("CLEARCOAT_TINT",this.tintColor.isConnected||this.tintThickness.isConnected||this.tintAtDistance.isConnected,!0),r.setValue("CLEARCOAT_BUMP",this.normalMapColor.isConnected,!0),r.setValue("CLEARCOAT_DEFAULTIOR",!this.indexOfRefraction.isConnected||this.indexOfRefraction.connectInputBlock.value===Es._DefaultIndexOfRefraction,!0),r.setValue("CLEARCOAT_REMAP_F0",this.remapF0OnInterfaceChange,!0)},t.prototype.bind=function(e,n,r,o){var u,f;i.prototype.bind.call(this,e,n,r);var v=(f=(u=this.indexOfRefraction.connectInputBlock)===null||u===void 0?void 0:u.value)!==null&&f!==void 0?f:Es._DefaultIndexOfRefraction,y=1-v,D=1+v,w=Math.pow(-y/D,2),F=1/v;e.setFloat4("vClearCoatRefractionParams",w,F,y,D);var z=this.clearcoat.hasEndpoints?this.clearcoat.endpoints[0].ownerBlock:null,k=(z==null?void 0:z.perturbedNormal.isConnected)?z.perturbedNormal.connectedPoint.ownerBlock:null;this._scene._mirroredCameraPosition?e.setFloat2("vClearCoatTangentSpaceParams",(k==null?void 0:k.invertX)?1:-1,(k==null?void 0:k.invertY)?1:-1):e.setFloat2("vClearCoatTangentSpaceParams",(k==null?void 0:k.invertX)?-1:1,(k==null?void 0:k.invertY)?-1:1)},t.prototype._generateTBNSpace=function(e,n,r){var o="",u="//"+this.name,f=this.worldTangent;e._emitExtension("derivatives","#extension GL_OES_standard_derivatives : enable");var v={search:/defined\(TANGENT\)/g,replace:f.isConnected?"defined(TANGENT)":"defined(IGNORE)"};return f.isConnected&&(o+="vec3 tbnNormal = normalize("+r+`.xyz);\r
`,o+="vec3 tbnTangent = normalize("+f.associatedVariableName+`.xyz);\r
`,o+=`vec3 tbnBitangent = cross(tbnNormal, tbnTangent);\r
`,o+=`mat3 vTBN = mat3(tbnTangent, tbnBitangent, tbnNormal);\r
`),e._emitFunctionFromInclude("bumpFragmentMainFunctions",u,{replaceStrings:[v]}),o},t.GetCode=function(e,n,r,o,u,f,v){var y="",D=(n==null?void 0:n.intensity.isConnected)?n.intensity.associatedVariableName:"1.",w=(n==null?void 0:n.roughness.isConnected)?n.roughness.associatedVariableName:"0.",F=(n==null?void 0:n.normalMapColor.isConnected)?n.normalMapColor.associatedVariableName:"vec3(0.)",z=(n==null?void 0:n.uv.isConnected)?n.uv.associatedVariableName:"vec2(0.)",k=(n==null?void 0:n.tintColor.isConnected)?n.tintColor.associatedVariableName:"vec3(1.)",K=(n==null?void 0:n.tintThickness.isConnected)?n.tintThickness.associatedVariableName:"1.",oe=(n==null?void 0:n.tintAtDistance.isConnected)?n.tintAtDistance.associatedVariableName:"1.";return n&&(e._emitUniformFromString("vClearCoatRefractionParams","vec4"),e._emitUniformFromString("vClearCoatTangentSpaceParams","vec2")),u&&n&&(y+=n._generateTBNSpace(e,o,v),f=n.worldTangent.isConnected),y+=`clearcoatOutParams clearcoatOut;

        #ifdef CLEARCOAT
            vec2 vClearCoatParams = vec2(`+D+", "+w+`);
            vec4 vClearCoatTintParams = vec4(`+k+", "+K+`);

            clearcoatBlock(
                `+o+`.xyz,
                geometricNormalW,
                viewDirectionW,
                vClearCoatParams,
                specularEnvironmentR0,
            #ifdef CLEARCOAT_TEXTURE
                vec2(0.),
            #endif
            #ifdef CLEARCOAT_TINT
                vClearCoatTintParams,
                `+oe+`,
                vClearCoatRefractionParams,
                #ifdef CLEARCOAT_TINT_TEXTURE
                    vec4(0.),
                #endif
            #endif
            #ifdef CLEARCOAT_BUMP
                vec2(0., 1.),
                vec4(`+F+`, 0.),
                `+z+`,
                #if defined(`+(f?"TANGENT":"IGNORE")+`) && defined(NORMAL)
                    vTBN,
                #else
                    vClearCoatTangentSpaceParams,
                #endif
                #ifdef OBJECTSPACE_NORMALMAP
                    normalMatrix,
                #endif
            #endif
            #if defined(FORCENORMALFORWARD) && defined(NORMAL)
                faceNormal,
            #endif
            #ifdef REFLECTION
                `+(r==null?void 0:r._vReflectionMicrosurfaceInfosName)+`,
                `+(r==null?void 0:r._vReflectionInfosName)+`,
                `+(r==null?void 0:r.reflectionColor)+`,
                vLightingIntensity,
                #ifdef `+(r==null?void 0:r._define3DName)+`
                    `+(r==null?void 0:r._cubeSamplerName)+`,
                #else
                    `+(r==null?void 0:r._2DSamplerName)+`,
                #endif
                #ifndef LODBASEDMICROSFURACE
                    #ifdef `+(r==null?void 0:r._define3DName)+`
                        `+(r==null?void 0:r._cubeSamplerName)+`,
                        `+(r==null?void 0:r._cubeSamplerName)+`,
                    #else
                        `+(r==null?void 0:r._2DSamplerName)+`,
                        `+(r==null?void 0:r._2DSamplerName)+`,
                    #endif
                #endif
            #endif
            #if defined(ENVIRONMENTBRDF) && !defined(`+(r==null?void 0:r._defineSkyboxName)+`)
                #ifdef RADIANCEOCCLUSION
                    ambientMonochrome,
                #endif
            #endif
                clearcoatOut
            );
        #else
            clearcoatOut.specularEnvironmentR0 = specularEnvironmentR0;
        #endif\r
`},t.prototype._buildBlock=function(e){return this._scene=e.sharedData.scene,e.target===Me.Fragment&&(e.sharedData.bindableBlocks.push(this),e.sharedData.blocksWithDefines.push(this)),this},t.prototype._dumpPropertiesCode=function(){var e="";return e+=this._codeVariableName+".remapF0OnInterfaceChange = "+this.remapF0OnInterfaceChange+`;\r
`},t.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return e.remapF0OnInterfaceChange=this.remapF0OnInterfaceChange,e},t.prototype._deserialize=function(e,n,r){var o;i.prototype._deserialize.call(this,e,n,r),this.remapF0OnInterfaceChange=(o=e.remapF0OnInterfaceChange)===null||o===void 0||o},Object(p.c)([sn("Remap F0 on interface change",$t.Boolean,"ADVANCED")],t.prototype,"remapF0OnInterfaceChange",void 0),t}(Et);C.a.RegisteredTypes["BABYLON.ClearCoatBlock"]=Lh;var Bm=function(i){function t(e){var n=i.call(this,e,Me.Fragment)||this;return n.linkRefractionWithTransparency=!1,n.invertRefractionY=!1,n._isUnique=!0,n.registerInput("intensity",fe.Float,!1,Me.Fragment),n.registerInput("tintAtDistance",fe.Float,!0,Me.Fragment),n.registerOutput("refraction",fe.Object,Me.Fragment,new di("refraction",n,yr.Output,t,"RefractionBlock")),n}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"RefractionBlock"},Object.defineProperty(t.prototype,"intensity",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tintAtDistance",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"view",{get:function(){return this.viewConnectionPoint},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"refraction",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasTexture",{get:function(){return!!this._getTexture()},enumerable:!1,configurable:!0}),t.prototype._getTexture=function(){return this.texture?this.texture:this._scene.environmentTexture},t.prototype.autoConfigure=function(e){if(!this.intensity.isConnected){var n=new Bt("Refraction intensity",Me.Fragment,fe.Float);n.value=1,n.output.connectTo(this.intensity)}if(this.view&&!this.view.isConnected){var r=e.getInputBlockByPredicate(function(o){return o.systemValue===Mt.View});r||(r=new Bt("view")).setAsSystemValue(Mt.View),r.output.connectTo(this.view)}},t.prototype.prepareDefines=function(e,n,r){i.prototype.prepareDefines.call(this,e,n,r);var o=this._getTexture(),u=o&&o.getTextureMatrix;r.setValue("SS_REFRACTION",u,!0),u&&(r.setValue(this._define3DName,o.isCube,!0),r.setValue(this._defineLODRefractionAlpha,o.lodLevelInAlpha,!0),r.setValue(this._defineLinearSpecularRefraction,o.linearSpecularLOD,!0),r.setValue(this._defineOppositeZ,this._scene.useRightHandedSystem?!o.invertZ:o.invertZ,!0),r.setValue("SS_LINKREFRACTIONTOTRANSPARENCY",this.linkRefractionWithTransparency,!0),r.setValue("SS_GAMMAREFRACTION",o.gammaSpace,!0),r.setValue("SS_RGBDREFRACTION",o.isRGBD,!0))},t.prototype.isReady=function(){var e=this._getTexture();return!(e&&!e.isReadyOrNotBlocking())},t.prototype.bind=function(e,n,r,o){var u,f;i.prototype.bind.call(this,e,n,r);var v=this._getTexture();if(v){v.isCube?e.setTexture(this._cubeSamplerName,v):e.setTexture(this._2DSamplerName,v),e.setMatrix(this._refractionMatrixName,v.getReflectionTextureMatrix());var y=1;v.isCube||v.depth&&(y=v.depth);var D=(f=(u=this.indexOfRefractionConnectionPoint.connectInputBlock)===null||u===void 0?void 0:u.value)!==null&&f!==void 0?f:1.5;e.setFloat4(this._vRefractionInfosName,v.level,1/D,y,this.invertRefractionY?-1:1),e.setFloat3(this._vRefractionMicrosurfaceInfosName,v.getSize().width,v.lodGenerationScale,v.lodGenerationOffset);var w=v.getSize().width;e.setFloat2(this._vRefractionFilteringInfoName,w,te.a.Log2(w))}},t.prototype.getCode=function(e){return e.sharedData.blockingBlocks.push(this),e.sharedData.textureBlocks.push(this),this._cubeSamplerName=e._getFreeVariableName(this.name+"CubeSampler"),e.samplers.push(this._cubeSamplerName),this._2DSamplerName=e._getFreeVariableName(this.name+"2DSampler"),e.samplers.push(this._2DSamplerName),this._define3DName=e._getFreeDefineName("SS_REFRACTIONMAP_3D"),e._samplerDeclaration+="#ifdef "+this._define3DName+`\r
`,e._samplerDeclaration+="uniform samplerCube "+this._cubeSamplerName+`;\r
`,e._samplerDeclaration+=`#else\r
`,e._samplerDeclaration+="uniform sampler2D "+this._2DSamplerName+`;\r
`,e._samplerDeclaration+=`#endif\r
`,e.sharedData.blocksWithDefines.push(this),e.sharedData.bindableBlocks.push(this),this._defineLODRefractionAlpha=e._getFreeDefineName("SS_LODINREFRACTIONALPHA"),this._defineLinearSpecularRefraction=e._getFreeDefineName("SS_LINEARSPECULARREFRACTION"),this._defineOppositeZ=e._getFreeDefineName("SS_REFRACTIONMAP_OPPOSITEZ"),this._refractionMatrixName=e._getFreeVariableName("refractionMatrix"),e._emitUniformFromString(this._refractionMatrixName,"mat4"),e._emitFunction("sampleRefraction",`
            #ifdef `+this._define3DName+`
                #define sampleRefraction(s, c) textureCube(s, c)
            #else
                #define sampleRefraction(s, c) texture2D(s, c)
            #endif\r
`,"//"+this.name),e._emitFunction("sampleRefractionLod",`
            #ifdef `+this._define3DName+`
                #define sampleRefractionLod(s, c, l) textureCubeLodEXT(s, c, l)
            #else
                #define sampleRefractionLod(s, c, l) texture2DLodEXT(s, c, l)
            #endif\r
`,"//"+this.name),this._vRefractionMicrosurfaceInfosName=e._getFreeVariableName("vRefractionMicrosurfaceInfos"),e._emitUniformFromString(this._vRefractionMicrosurfaceInfosName,"vec3"),this._vRefractionInfosName=e._getFreeVariableName("vRefractionInfos"),e._emitUniformFromString(this._vRefractionInfosName,"vec4"),this._vRefractionFilteringInfoName=e._getFreeVariableName("vRefractionFilteringInfo"),e._emitUniformFromString(this._vRefractionFilteringInfoName,"vec2"),""},t.prototype._buildBlock=function(e){return this._scene=e.sharedData.scene,this},t.prototype._dumpPropertiesCode=function(){var e=i.prototype._dumpPropertiesCode.call(this);return this.texture&&(e=this.texture.isCube?this._codeVariableName+'.texture = new BABYLON.CubeTexture("'+this.texture.name+`");\r
`:this._codeVariableName+'.texture = new BABYLON.Texture("'+this.texture.name+`");\r
`,e+=this._codeVariableName+".texture.coordinatesMode = "+this.texture.coordinatesMode+`;\r
`),e+=this._codeVariableName+".linkRefractionWithTransparency = "+this.linkRefractionWithTransparency+`;\r
`,e+=this._codeVariableName+".invertRefractionY = "+this.invertRefractionY+`;\r
`},t.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return this.texture&&(e.texture=this.texture.serialize()),e.linkRefractionWithTransparency=this.linkRefractionWithTransparency,e.invertRefractionY=this.invertRefractionY,e},t.prototype._deserialize=function(e,n,r){i.prototype._deserialize.call(this,e,n,r),e.texture&&(r=e.texture.url.indexOf("data:")===0?"":r,e.texture.isCube?this.texture=Ei.Parse(e.texture,n,r):this.texture=ke.a.Parse(e.texture,n,r)),this.linkRefractionWithTransparency=e.linkRefractionWithTransparency,this.invertRefractionY=e.invertRefractionY},Object(p.c)([sn("Link refraction to transparency",$t.Boolean,"ADVANCED",{notifiers:{update:!0}})],t.prototype,"linkRefractionWithTransparency",void 0),Object(p.c)([sn("Invert refraction Y",$t.Boolean,"ADVANCED",{notifiers:{update:!0}})],t.prototype,"invertRefractionY",void 0),t}(Et);C.a.RegisteredTypes["BABYLON.RefractionBlock"]=Bm;var Nh=function(i){function t(e){var n=i.call(this,e,Me.Fragment)||this;return n._isUnique=!0,n.registerInput("thickness",fe.Float,!1,Me.Fragment),n.registerInput("tintColor",fe.Color3,!0,Me.Fragment),n.registerInput("translucencyIntensity",fe.Float,!0,Me.Fragment),n.registerInput("translucencyDiffusionDist",fe.Color3,!0,Me.Fragment),n.registerInput("refraction",fe.Object,!0,Me.Fragment,new di("refraction",n,yr.Input,Bm,"RefractionBlock")),n.registerOutput("subsurface",fe.Object,Me.Fragment,new di("subsurface",n,yr.Output,t,"SubSurfaceBlock")),n}return Object(p.d)(t,i),t.prototype.initialize=function(e){e._excludeVariableName("subSurfaceOut"),e._excludeVariableName("vThicknessParam"),e._excludeVariableName("vTintColor"),e._excludeVariableName("vSubSurfaceIntensity")},t.prototype.getClassName=function(){return"SubSurfaceBlock"},Object.defineProperty(t.prototype,"thickness",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tintColor",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"translucencyIntensity",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"translucencyDiffusionDist",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"refraction",{get:function(){return this._inputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"subsurface",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype.autoConfigure=function(e){if(!this.thickness.isConnected){var n=new Bt("SubSurface thickness",Me.Fragment,fe.Float);n.value=0,n.output.connectTo(this.thickness)}},t.prototype.prepareDefines=function(e,n,r){i.prototype.prepareDefines.call(this,e,n,r);var o=this.translucencyDiffusionDist.isConnected||this.translucencyIntensity.isConnected;r.setValue("SUBSURFACE",o||this.refraction.isConnected,!0),r.setValue("SS_TRANSLUCENCY",o,!0),r.setValue("SS_THICKNESSANDMASK_TEXTURE",!1,!0),r.setValue("SS_MASK_FROM_THICKNESS_TEXTURE",!1,!0),r.setValue("SS_MASK_FROM_THICKNESS_TEXTURE_GLTF",!1,!0)},t.GetCode=function(e,n,r,o){var u,f,v,y,D,w,F,z,k,K,oe,ae,ue,de,me,ye,Ee="",Ae=(n==null?void 0:n.thickness.isConnected)?n.thickness.associatedVariableName:"0.",Ie=(n==null?void 0:n.tintColor.isConnected)?n.tintColor.associatedVariableName:"vec3(1.)",Re=(n==null?void 0:n.translucencyIntensity.isConnected)?n==null?void 0:n.translucencyIntensity.associatedVariableName:"1.",Pe=(n==null?void 0:n.translucencyDiffusionDist.isConnected)?n==null?void 0:n.translucencyDiffusionDist.associatedVariableName:"vec3(1.)",Ce=(n==null?void 0:n.refraction.isConnected)?(u=n==null?void 0:n.refraction.connectedPoint)===null||u===void 0?void 0:u.ownerBlock:null,Be=(Ce==null?void 0:Ce.tintAtDistance.isConnected)?Ce.tintAtDistance.associatedVariableName:"1.",Oe=(Ce==null?void 0:Ce.intensity.isConnected)?Ce.intensity.associatedVariableName:"1.",Ve=(Ce==null?void 0:Ce.view.isConnected)?Ce.view.associatedVariableName:"";return Ee+=(f=Ce==null?void 0:Ce.getCode(e))!==null&&f!==void 0?f:"",Ee+=`subSurfaceOutParams subSurfaceOut;

        #ifdef SUBSURFACE
            vec2 vThicknessParam = vec2(0., `+Ae+`);
            vec4 vTintColor = vec4(`+Ie+", "+Be+`);
            vec3 vSubSurfaceIntensity = vec3(`+Oe+", "+Re+`, 0.);

            subSurfaceBlock(
                vSubSurfaceIntensity,
                vThicknessParam,
                vTintColor,
                normalW,
                specularEnvironmentReflectance,
            #ifdef SS_THICKNESSANDMASK_TEXTURE
                vec4(0.),
            #endif
            #ifdef REFLECTION
                #ifdef SS_TRANSLUCENCY
                    `+(r==null?void 0:r._reflectionMatrixName)+`,
                    #ifdef USESPHERICALFROMREFLECTIONMAP
                        #if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)
                            reflectionOut.irradianceVector,
                        #endif
                        #if defined(REALTIME_FILTERING)
                            `+(r==null?void 0:r._cubeSamplerName)+`,
                            `+(r==null?void 0:r._vReflectionFilteringInfoName)+`,
                        #endif
                        #endif
                    #ifdef USEIRRADIANCEMAP
                        irradianceSampler,
                    #endif
                #endif
            #endif
            #ifdef SS_REFRACTION
                `+o+`.xyz,
                viewDirectionW,
                `+Ve+`,
                surfaceAlbedo,
                `+((v=Ce==null?void 0:Ce._vRefractionInfosName)!==null&&v!==void 0?v:"")+`,
                `+((y=Ce==null?void 0:Ce._refractionMatrixName)!==null&&y!==void 0?y:"")+`,
                `+((D=Ce==null?void 0:Ce._vRefractionMicrosurfaceInfosName)!==null&&D!==void 0?D:"")+`,
                vLightingIntensity,
                #ifdef SS_LINKREFRACTIONTOTRANSPARENCY
                    alpha,
                #endif
                #ifdef `+((w=Ce==null?void 0:Ce._defineLODRefractionAlpha)!==null&&w!==void 0?w:"IGNORE")+`
                    NdotVUnclamped,
                #endif
                #ifdef `+((F=Ce==null?void 0:Ce._defineLinearSpecularRefraction)!==null&&F!==void 0?F:"IGNORE")+`
                    roughness,
                #else
                    alphaG,
                #endif
                #ifdef `+((z=Ce==null?void 0:Ce._define3DName)!==null&&z!==void 0?z:"IGNORE")+`
                    `+((k=Ce==null?void 0:Ce._cubeSamplerName)!==null&&k!==void 0?k:"")+`,
                #else
                    `+((K=Ce==null?void 0:Ce._2DSamplerName)!==null&&K!==void 0?K:"")+`,
                #endif
                #ifndef LODBASEDMICROSFURACE
                    #ifdef `+((oe=Ce==null?void 0:Ce._define3DName)!==null&&oe!==void 0?oe:"IGNORE")+`
                        `+((ae=Ce==null?void 0:Ce._cubeSamplerName)!==null&&ae!==void 0?ae:"")+`,
                        `+((ue=Ce==null?void 0:Ce._cubeSamplerName)!==null&&ue!==void 0?ue:"")+`,
                    #else
                        `+((de=Ce==null?void 0:Ce._2DSamplerName)!==null&&de!==void 0?de:"")+`,
                        `+((me=Ce==null?void 0:Ce._2DSamplerName)!==null&&me!==void 0?me:"")+`,
                    #endif
                #endif
                #ifdef ANISOTROPIC
                    anisotropicOut,
                #endif
                #ifdef REALTIME_FILTERING
                    `+((ye=Ce==null?void 0:Ce._vRefractionFilteringInfoName)!==null&&ye!==void 0?ye:"")+`,
                #endif
            #endif
            #ifdef SS_TRANSLUCENCY
                `+Pe+`,
            #endif
                subSurfaceOut
            );

            #ifdef SS_REFRACTION
                surfaceAlbedo = subSurfaceOut.surfaceAlbedo;
                #ifdef SS_LINKREFRACTIONTOTRANSPARENCY
                    alpha = subSurfaceOut.alpha;
                #endif
            #endif
        #else
            subSurfaceOut.specularEnvironmentReflectance = specularEnvironmentReflectance;
        #endif\r
`},t.prototype._buildBlock=function(e){return e.target===Me.Fragment&&e.sharedData.blocksWithDefines.push(this),this},t}(Et);C.a.RegisteredTypes["BABYLON.SubSurfaceBlock"]=Nh;var Nw={ambientClr:["finalAmbient",""],diffuseDir:["finalDiffuse",""],specularDir:["finalSpecularScaled","!defined(UNLIT) && defined(SPECULARTERM)"],clearcoatDir:["finalClearCoatScaled","!defined(UNLIT) && defined(CLEARCOAT)"],sheenDir:["finalSheenScaled","!defined(UNLIT) && defined(SHEEN)"],diffuseInd:["finalIrradiance","!defined(UNLIT) && defined(REFLECTION)"],specularInd:["finalRadianceScaled","!defined(UNLIT) && defined(REFLECTION)"],clearcoatInd:["clearcoatOut.finalClearCoatRadianceScaled","!defined(UNLIT) && defined(REFLECTION) && defined(CLEARCOAT)"],sheenInd:["sheenOut.finalSheenRadianceScaled","!defined(UNLIT) && defined(REFLECTION) && defined(SHEEN) && defined(ENVIRONMENTBRDF)"],refraction:["subSurfaceOut.finalRefraction","!defined(UNLIT) && defined(SS_REFRACTION)"],lighting:["finalColor.rgb",""],shadow:["shadow",""],alpha:["alpha",""]},qT=function(i){function t(e){var n=i.call(this,e,Me.VertexAndFragment)||this;return n._environmentBRDFTexture=null,n._metallicReflectanceColor=M.a.White(),n._metallicF0Factor=1,n.directIntensity=1,n.environmentIntensity=1,n.specularIntensity=1,n.lightFalloff=0,n.useAlphaTest=!1,n.alphaTestCutoff=.5,n.useAlphaBlending=!1,n.useRadianceOverAlpha=!0,n.useSpecularOverAlpha=!0,n.enableSpecularAntiAliasing=!1,n.realTimeFiltering=!1,n.realTimeFilteringQuality=g.a.TEXTURE_FILTERING_QUALITY_LOW,n.useEnergyConservation=!0,n.useRadianceOcclusion=!0,n.useHorizonOcclusion=!0,n.unlit=!1,n.forceNormalForward=!1,n.debugMode=0,n.debugLimit=0,n.debugFactor=1,n._isUnique=!0,n.registerInput("worldPosition",fe.Vector4,!1,Me.Vertex),n.registerInput("worldNormal",fe.Vector4,!1,Me.Fragment),n.registerInput("view",fe.Matrix,!1),n.registerInput("cameraPosition",fe.Vector3,!1,Me.Fragment),n.registerInput("perturbedNormal",fe.Vector4,!0,Me.Fragment),n.registerInput("baseColor",fe.Color3,!0,Me.Fragment),n.registerInput("metallic",fe.Float,!1,Me.Fragment),n.registerInput("roughness",fe.Float,!1,Me.Fragment),n.registerInput("ambientOcc",fe.Float,!0,Me.Fragment),n.registerInput("opacity",fe.Float,!0,Me.Fragment),n.registerInput("indexOfRefraction",fe.Float,!0,Me.Fragment),n.registerInput("ambientColor",fe.Color3,!0,Me.Fragment),n.registerInput("reflection",fe.Object,!0,Me.Fragment,new di("reflection",n,yr.Input,Fm,"ReflectionBlock")),n.registerInput("clearcoat",fe.Object,!0,Me.Fragment,new di("clearcoat",n,yr.Input,Lh,"ClearCoatBlock")),n.registerInput("sheen",fe.Object,!0,Me.Fragment,new di("sheen",n,yr.Input,Lm,"SheenBlock")),n.registerInput("subsurface",fe.Object,!0,Me.Fragment,new di("subsurface",n,yr.Input,Nh,"SubSurfaceBlock")),n.registerInput("anisotropy",fe.Object,!0,Me.Fragment,new di("anisotropy",n,yr.Input,Nm,"AnisotropyBlock")),n.registerOutput("ambientClr",fe.Color3,Me.Fragment),n.registerOutput("diffuseDir",fe.Color3,Me.Fragment),n.registerOutput("specularDir",fe.Color3,Me.Fragment),n.registerOutput("clearcoatDir",fe.Color3,Me.Fragment),n.registerOutput("sheenDir",fe.Color3,Me.Fragment),n.registerOutput("diffuseInd",fe.Color3,Me.Fragment),n.registerOutput("specularInd",fe.Color3,Me.Fragment),n.registerOutput("clearcoatInd",fe.Color3,Me.Fragment),n.registerOutput("sheenInd",fe.Color3,Me.Fragment),n.registerOutput("refraction",fe.Color3,Me.Fragment),n.registerOutput("lighting",fe.Color3,Me.Fragment),n.registerOutput("shadow",fe.Float,Me.Fragment),n.registerOutput("alpha",fe.Float,Me.Fragment),n}return Object(p.d)(t,i),t.prototype.initialize=function(e){e._excludeVariableName("vLightingIntensity"),e._excludeVariableName("geometricNormalW"),e._excludeVariableName("normalW"),e._excludeVariableName("faceNormal"),e._excludeVariableName("albedoOpacityOut"),e._excludeVariableName("surfaceAlbedo"),e._excludeVariableName("alpha"),e._excludeVariableName("aoOut"),e._excludeVariableName("baseColor"),e._excludeVariableName("reflectivityOut"),e._excludeVariableName("microSurface"),e._excludeVariableName("roughness"),e._excludeVariableName("NdotVUnclamped"),e._excludeVariableName("NdotV"),e._excludeVariableName("alphaG"),e._excludeVariableName("AARoughnessFactors"),e._excludeVariableName("environmentBrdf"),e._excludeVariableName("ambientMonochrome"),e._excludeVariableName("seo"),e._excludeVariableName("eho"),e._excludeVariableName("environmentRadiance"),e._excludeVariableName("irradianceVector"),e._excludeVariableName("environmentIrradiance"),e._excludeVariableName("diffuseBase"),e._excludeVariableName("specularBase"),e._excludeVariableName("preInfo"),e._excludeVariableName("info"),e._excludeVariableName("shadow"),e._excludeVariableName("finalDiffuse"),e._excludeVariableName("finalAmbient"),e._excludeVariableName("ambientOcclusionForDirectDiffuse"),e._excludeVariableName("finalColor"),e._excludeVariableName("vClipSpacePosition"),e._excludeVariableName("vDebugMode")},t.prototype.getClassName=function(){return"PBRMetallicRoughnessBlock"},Object.defineProperty(t.prototype,"worldPosition",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"worldNormal",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"view",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraPosition",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"perturbedNormal",{get:function(){return this._inputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"baseColor",{get:function(){return this._inputs[5]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metallic",{get:function(){return this._inputs[6]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"roughness",{get:function(){return this._inputs[7]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ambientOcc",{get:function(){return this._inputs[8]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"opacity",{get:function(){return this._inputs[9]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"indexOfRefraction",{get:function(){return this._inputs[10]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ambientColor",{get:function(){return this._inputs[11]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"reflection",{get:function(){return this._inputs[12]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"clearcoat",{get:function(){return this._inputs[13]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sheen",{get:function(){return this._inputs[14]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"subsurface",{get:function(){return this._inputs[15]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"anisotropy",{get:function(){return this._inputs[16]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ambientClr",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"diffuseDir",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"specularDir",{get:function(){return this._outputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"clearcoatDir",{get:function(){return this._outputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sheenDir",{get:function(){return this._outputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"diffuseIndirect",{get:function(){return this._outputs[5]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"specularIndirect",{get:function(){return this._outputs[6]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"clearcoatIndirect",{get:function(){return this._outputs[7]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sheenIndirect",{get:function(){return this._outputs[8]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"refraction",{get:function(){return this._outputs[9]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lighting",{get:function(){return this._outputs[10]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"shadow",{get:function(){return this._outputs[11]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"alpha",{get:function(){return this._outputs[12]},enumerable:!1,configurable:!0}),t.prototype.autoConfigure=function(e){if(!this.cameraPosition.isConnected){var n=e.getInputBlockByPredicate(function(o){return o.systemValue===Mt.CameraPosition});n||(n=new Bt("cameraPosition")).setAsSystemValue(Mt.CameraPosition),n.output.connectTo(this.cameraPosition)}if(!this.view.isConnected){var r=e.getInputBlockByPredicate(function(o){return o.systemValue===Mt.View});r||(r=new Bt("view")).setAsSystemValue(Mt.View),r.output.connectTo(this.view)}},t.prototype.prepareDefines=function(e,n,r){r.setValue("PBR",!0),r.setValue("METALLICWORKFLOW",!0),r.setValue("DEBUGMODE",this.debugMode,!0),r.setValue("NORMALXYSCALE",!0),r.setValue("BUMP",this.perturbedNormal.isConnected,!0),r.setValue("LODBASEDMICROSFURACE",this._scene.getEngine().getCaps().textureLOD),r.setValue("ALBEDO",!1,!0),r.setValue("OPACITY",this.opacity.isConnected,!0),r.setValue("AMBIENT",!0,!0),r.setValue("AMBIENTINGRAYSCALE",!1,!0),r.setValue("REFLECTIVITY",!1,!0),r.setValue("AOSTOREINMETALMAPRED",!1,!0),r.setValue("METALLNESSSTOREINMETALMAPBLUE",!1,!0),r.setValue("ROUGHNESSSTOREINMETALMAPALPHA",!1,!0),r.setValue("ROUGHNESSSTOREINMETALMAPGREEN",!1,!0),this.lightFalloff===nr.LIGHTFALLOFF_STANDARD?(r.setValue("USEPHYSICALLIGHTFALLOFF",!1),r.setValue("USEGLTFLIGHTFALLOFF",!1)):this.lightFalloff===nr.LIGHTFALLOFF_GLTF?(r.setValue("USEPHYSICALLIGHTFALLOFF",!1),r.setValue("USEGLTFLIGHTFALLOFF",!0)):(r.setValue("USEPHYSICALLIGHTFALLOFF",!0),r.setValue("USEGLTFLIGHTFALLOFF",!1));var o=this.alphaTestCutoff.toString();if(r.setValue("ALPHABLEND",this.useAlphaBlending,!0),r.setValue("ALPHAFROMALBEDO",!1,!0),r.setValue("ALPHATEST",this.useAlphaTest,!0),r.setValue("ALPHATESTVALUE",o.indexOf(".")<0?o+".":o,!0),r.setValue("OPACITYRGB",!1,!0),r.setValue("RADIANCEOVERALPHA",this.useRadianceOverAlpha,!0),r.setValue("SPECULAROVERALPHA",this.useSpecularOverAlpha,!0),r.setValue("SPECULARAA",this._scene.getEngine().getCaps().standardDerivatives&&this.enableSpecularAntiAliasing,!0),r.setValue("REALTIME_FILTERING",this.realTimeFiltering,!0),this._scene.getEngine().webGLVersion>1?r.setValue("NUM_SAMPLES",this.realTimeFilteringQuality+"u",!0):r.setValue("NUM_SAMPLES",""+this.realTimeFilteringQuality,!0),r.setValue("BRDF_V_HEIGHT_CORRELATED",!0),r.setValue("MS_BRDF_ENERGY_CONSERVATION",this.useEnergyConservation,!0),r.setValue("RADIANCEOCCLUSION",this.useRadianceOcclusion,!0),r.setValue("HORIZONOCCLUSION",this.useHorizonOcclusion,!0),r.setValue("UNLIT",this.unlit,!0),r.setValue("FORCENORMALFORWARD",this.forceNormalForward,!0),this._environmentBRDFTexture&&bt.a.ReflectionTextureEnabled?(r.setValue("ENVIRONMENTBRDF",!0),r.setValue("ENVIRONMENTBRDF_RGBD",this._environmentBRDFTexture.isRGBD,!0)):(r.setValue("ENVIRONMENTBRDF",!1),r.setValue("ENVIRONMENTBRDF_RGBD",!1)),r._areLightsDirty){var u=e.getScene();if(this.light){var f={needNormals:!1,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};lt.a.PrepareDefinesForLight(u,e,this.light,this._lightId,r,!0,f),f.needRebuild&&r.rebuild()}else lt.a.PrepareDefinesForLights(u,e,r,!0,n.maxSimultaneousLights),r._needNormals=!0,lt.a.PrepareDefinesForMultiview(u,r)}},t.prototype.updateUniformsAndSamples=function(e,n,r,o){for(var u=0;u<n.maxSimultaneousLights&&r["LIGHT"+u];u++){var f=e.uniforms.indexOf("vLightData"+u)>=0;lt.a.PrepareUniformsAndSamplersForLight(u,e.uniforms,e.samplers,r["PROJECTEDLIGHTTEXTURE"+u],o,f)}},t.prototype.bind=function(e,n,r){var o,u;if(r){var f=r.getScene();this.light?lt.a.BindLight(this.light,this._lightId,f,e,!0):lt.a.BindLights(f,r,e,!0,n.maxSimultaneousLights),e.setTexture(this._environmentBrdfSamplerName,this._environmentBRDFTexture),e.setFloat2("vDebugMode",this.debugLimit,this.debugFactor);var v=this._scene.ambientColor;v&&e.setColor3("ambientFromScene",v);var y=f.useRightHandedSystem===(f._mirroredCameraPosition!=null);e.setFloat(this._invertNormalName,y?-1:1),e.setFloat4("vLightingIntensity",this.directIntensity,1,this.environmentIntensity*this._scene.environmentIntensity,this.specularIntensity);var D=(u=(o=this.indexOfRefraction.connectInputBlock)===null||o===void 0?void 0:o.value)!==null&&u!==void 0?u:1.5,w=Math.pow((D-1)/(D+1),2);this._metallicReflectanceColor.scaleToRef(w*this._metallicF0Factor,M.c.Color3[0]);var F=this._metallicF0Factor;e.setColor4(this._vMetallicReflectanceFactorsName,M.c.Color3[0],F)}},t.prototype._injectVertexCode=function(e){var n,r,o=this.worldPosition,u="//"+this.name;this.light?(this._lightId=(e.counters.lightCounter!==void 0?e.counters.lightCounter:-1)+1,e.counters.lightCounter=this._lightId,e._emitFunctionFromInclude(e.supportUniformBuffers?"lightUboDeclaration":"lightFragmentDeclaration",u,{replaceStrings:[{search:/{X}/g,replace:this._lightId.toString()}]},this._lightId.toString())):(e._emitFunctionFromInclude(e.supportUniformBuffers?"lightUboDeclaration":"lightFragmentDeclaration",u,{repeatKey:"maxSimultaneousLights"}),this._lightId=0,e.sharedData.dynamicUniformBlocks.push(this));var f="v_"+o.associatedVariableName;e._emitVaryingFromString(f,"vec4")&&(e.compilationString+=f+" = "+o.associatedVariableName+`;\r
`);var v=this.reflection.isConnected?(n=this.reflection.connectedPoint)===null||n===void 0?void 0:n.ownerBlock:null;v&&(v.viewConnectionPoint=this.view),e.compilationString+=(r=v==null?void 0:v.handleVertexSide(e))!==null&&r!==void 0?r:"",e._emitUniformFromString("vDebugMode","vec2","defined(IGNORE) || DEBUGMODE > 0"),e._emitUniformFromString("ambientFromScene","vec3"),e._emitVaryingFromString("vClipSpacePosition","vec4","defined(IGNORE) || DEBUGMODE > 0")&&(e._injectAtEnd+=`#if DEBUGMODE > 0\r
`,e._injectAtEnd+=`vClipSpacePosition = gl_Position;\r
`,e._injectAtEnd+=`#endif\r
`),this.light?e.compilationString+=e._emitCodeFromInclude("shadowsVertex",u,{replaceStrings:[{search:/{X}/g,replace:this._lightId.toString()},{search:/worldPos/g,replace:o.associatedVariableName}]}):(e.compilationString+="vec4 worldPos = "+o.associatedVariableName+`;\r
`,this.view.isConnected&&(e.compilationString+="mat4 view = "+this.view.associatedVariableName+`;\r
`),e.compilationString+=e._emitCodeFromInclude("shadowsVertex",u,{repeatKey:"maxSimultaneousLights"}))},t.prototype._getAlbedoOpacityCode=function(){var e=`albedoOpacityOutParams albedoOpacityOut;\r
`;return e+=`albedoOpacityBlock(
                vec4(`+(this.baseColor.isConnected?this.baseColor.associatedVariableName:"vec3(1.)")+`, 1.),
            #ifdef ALBEDO
                vec4(1.),
                vec2(1., 1.),
            #endif
            #ifdef OPACITY
                vec4(`+(this.opacity.isConnected?this.opacity.associatedVariableName:"1.")+`),
                vec2(1., 1.),
            #endif
                albedoOpacityOut
            );

            vec3 surfaceAlbedo = albedoOpacityOut.surfaceAlbedo;
            float alpha = albedoOpacityOut.alpha;\r
`},t.prototype._getAmbientOcclusionCode=function(){var e=`ambientOcclusionOutParams aoOut;\r
`;return e+=`ambientOcclusionBlock(
            #ifdef AMBIENT
                vec3(`+(this.ambientOcc.isConnected?this.ambientOcc.associatedVariableName:"1.")+`),
                vec4(0., 1.0, 1.0, 0.),
            #endif
                aoOut
            );\r
`},t.prototype._getReflectivityCode=function(e){var n=`reflectivityOutParams reflectivityOut;\r
`;return this._vMetallicReflectanceFactorsName=e._getFreeVariableName("vMetallicReflectanceFactors"),e._emitUniformFromString(this._vMetallicReflectanceFactorsName,"vec4"),n+=`vec3 baseColor = surfaceAlbedo;

            reflectivityBlock(
                vec4(`+this.metallic.associatedVariableName+", "+this.roughness.associatedVariableName+`, 0., 0.),
            #ifdef METALLICWORKFLOW
                surfaceAlbedo,
                `+this._vMetallicReflectanceFactorsName+`,
            #endif
            #ifdef REFLECTIVITY
                vec3(0., 0., 1.),
                vec4(1.),
            #endif
            #if defined(METALLICWORKFLOW) && defined(REFLECTIVITY)  && defined(AOSTOREINMETALMAPRED)
                aoOut.ambientOcclusionColor,
            #endif
            #ifdef MICROSURFACEMAP
                microSurfaceTexel, <== not handled!
            #endif
                reflectivityOut
            );

            float microSurface = reflectivityOut.microSurface;
            float roughness = reflectivityOut.roughness;

            #ifdef METALLICWORKFLOW
                surfaceAlbedo = reflectivityOut.surfaceAlbedo;
            #endif
            #if defined(METALLICWORKFLOW) && defined(REFLECTIVITY) && defined(AOSTOREINMETALMAPRED)
                aoOut.ambientOcclusionColor = reflectivityOut.ambientOcclusionColor;
            #endif\r
`},t.prototype._buildBlock=function(e){var n,r,o,u,f,v,y,D,w,F,z,k,K,oe,ae,ue,de,me,ye,Ee,Ae,Ie,Re,Pe,Ce,Be,Oe,Ve,Le,je,tt,ut,ft,vt,rt,mt,pt,it,yt;i.prototype._buildBlock.call(this,e),this._scene=e.sharedData.scene,this._environmentBRDFTexture||(this._environmentBRDFTexture=mh.GetEnvironmentBRDFTexture(this._scene));var He=this.reflection.isConnected?(n=this.reflection.connectedPoint)===null||n===void 0?void 0:n.ownerBlock:null;if(He&&(He.worldPositionConnectionPoint=this.worldPosition,He.cameraPositionConnectionPoint=this.cameraPosition,He.worldNormalConnectionPoint=this.worldNormal),e.target!==Me.Fragment)return this._injectVertexCode(e),this;e.sharedData.bindableBlocks.push(this),e.sharedData.blocksWithDefines.push(this);var at="//"+this.name,It="v_"+this.worldPosition.associatedVariableName,vn=this.perturbedNormal;this._environmentBrdfSamplerName=e._getFreeVariableName("environmentBrdfSampler"),e._emit2DSampler(this._environmentBrdfSamplerName),e.sharedData.hints.needAlphaBlending=e.sharedData.hints.needAlphaBlending||this.useAlphaBlending,e.sharedData.hints.needAlphaTesting=e.sharedData.hints.needAlphaTesting||this.useAlphaTest,e._emitExtension("lod","#extension GL_EXT_shader_texture_lod : enable","defined(LODBASEDMICROSFURACE)"),e._emitExtension("derivatives","#extension GL_OES_standard_derivatives : enable"),this.light?e._emitFunctionFromInclude(e.supportUniformBuffers?"lightUboDeclaration":"lightFragmentDeclaration",at,{replaceStrings:[{search:/{X}/g,replace:this._lightId.toString()}]},this._lightId.toString()):e._emitFunctionFromInclude(e.supportUniformBuffers?"lightUboDeclaration":"lightFragmentDeclaration",at,{repeatKey:"maxSimultaneousLights"}),e._emitFunctionFromInclude("helperFunctions",at),e._emitFunctionFromInclude("importanceSampling",at),e._emitFunctionFromInclude("pbrHelperFunctions",at),e._emitFunctionFromInclude("imageProcessingFunctions",at),e._emitFunctionFromInclude("shadowsFragmentFunctions",at,{replaceStrings:[{search:/vPositionW/g,replace:It+".xyz"}]}),e._emitFunctionFromInclude("pbrDirectLightingSetupFunctions",at,{replaceStrings:[{search:/vPositionW/g,replace:It+".xyz"}]}),e._emitFunctionFromInclude("pbrDirectLightingFalloffFunctions",at),e._emitFunctionFromInclude("pbrBRDFFunctions",at,{replaceStrings:[{search:/REFLECTIONMAP_SKYBOX/g,replace:(r=He==null?void 0:He._defineSkyboxName)!==null&&r!==void 0?r:"REFLECTIONMAP_SKYBOX"}]}),e._emitFunctionFromInclude("hdrFilteringFunctions",at),e._emitFunctionFromInclude("pbrDirectLightingFunctions",at,{replaceStrings:[{search:/vPositionW/g,replace:It+".xyz"}]}),e._emitFunctionFromInclude("pbrIBLFunctions",at),e._emitFunctionFromInclude("pbrBlockAlbedoOpacity",at),e._emitFunctionFromInclude("pbrBlockReflectivity",at),e._emitFunctionFromInclude("pbrBlockAmbientOcclusion",at),e._emitFunctionFromInclude("pbrBlockAlphaFresnel",at),e._emitFunctionFromInclude("pbrBlockAnisotropic",at),e._emitUniformFromString("vLightingIntensity","vec4"),this._vNormalWName=e._getFreeVariableName("vNormalW"),e.compilationString+="vec4 "+this._vNormalWName+" = normalize("+this.worldNormal.associatedVariableName+`);\r
`,e._registerTempVariable("viewDirectionW")&&(e.compilationString+="vec3 viewDirectionW = normalize("+this.cameraPosition.associatedVariableName+" - "+It+`.xyz);\r
`),e.compilationString+="vec3 geometricNormalW = "+this._vNormalWName+`.xyz;\r
`,e.compilationString+="vec3 normalW = "+(vn.isConnected?"normalize("+vn.associatedVariableName+".xyz)":"geometricNormalW")+`;\r
`,this._invertNormalName=e._getFreeVariableName("invertNormal"),e._emitUniformFromString(this._invertNormalName,"float"),e.compilationString+=e._emitCodeFromInclude("pbrBlockNormalFinal",at,{replaceStrings:[{search:/vPositionW/g,replace:It+".xyz"},{search:/vEyePosition.w/g,replace:this._invertNormalName}]}),e.compilationString+=this._getAlbedoOpacityCode(),e.compilationString+=e._emitCodeFromInclude("depthPrePass",at),e.compilationString+=this._getAmbientOcclusionCode(),e.compilationString+=e._emitCodeFromInclude("pbrBlockLightmapInit",at),e.compilationString+=`#ifdef UNLIT
                vec3 diffuseBase = vec3(1., 1., 1.);
            #else\r
`,e.compilationString+=this._getReflectivityCode(e),e.compilationString+=e._emitCodeFromInclude("pbrBlockGeometryInfo",at,{replaceStrings:[{search:/REFLECTIONMAP_SKYBOX/g,replace:(o=He==null?void 0:He._defineSkyboxName)!==null&&o!==void 0?o:"REFLECTIONMAP_SKYBOX"},{search:/REFLECTIONMAP_3D/g,replace:(u=He==null?void 0:He._define3DName)!==null&&u!==void 0?u:"REFLECTIONMAP_3D"}]});var Jt=this.anisotropy.isConnected?(f=this.anisotropy.connectedPoint)===null||f===void 0?void 0:f.ownerBlock:null;Jt&&(Jt.worldPositionConnectionPoint=this.worldPosition,Jt.worldNormalConnectionPoint=this.worldNormal,e.compilationString+=Jt.getCode(e,!this.perturbedNormal.isConnected)),He&&He.hasTexture&&(e.compilationString+=He.getCode(e,Jt?"anisotropicOut.anisotropicNormal":"normalW")),e._emitFunctionFromInclude("pbrBlockReflection",at,{replaceStrings:[{search:/computeReflectionCoords/g,replace:"computeReflectionCoordsPBR"},{search:/REFLECTIONMAP_3D/g,replace:(v=He==null?void 0:He._define3DName)!==null&&v!==void 0?v:"REFLECTIONMAP_3D"},{search:/REFLECTIONMAP_OPPOSITEZ/g,replace:(y=He==null?void 0:He._defineOppositeZ)!==null&&y!==void 0?y:"REFLECTIONMAP_OPPOSITEZ"},{search:/REFLECTIONMAP_PROJECTION/g,replace:(D=He==null?void 0:He._defineProjectionName)!==null&&D!==void 0?D:"REFLECTIONMAP_PROJECTION"},{search:/REFLECTIONMAP_SKYBOX/g,replace:(w=He==null?void 0:He._defineSkyboxName)!==null&&w!==void 0?w:"REFLECTIONMAP_SKYBOX"},{search:/LODINREFLECTIONALPHA/g,replace:(F=He==null?void 0:He._defineLODReflectionAlpha)!==null&&F!==void 0?F:"LODINREFLECTIONALPHA"},{search:/LINEARSPECULARREFLECTION/g,replace:(z=He==null?void 0:He._defineLinearSpecularReflection)!==null&&z!==void 0?z:"LINEARSPECULARREFLECTION"},{search:/vReflectionFilteringInfo/g,replace:(k=He==null?void 0:He._vReflectionFilteringInfoName)!==null&&k!==void 0?k:"vReflectionFilteringInfo"}]}),e.compilationString+=e._emitCodeFromInclude("pbrBlockReflectance0",at,{replaceStrings:[{search:/metallicReflectanceFactors/g,replace:this._vMetallicReflectanceFactorsName}]});var Sn=this.sheen.isConnected?(K=this.sheen.connectedPoint)===null||K===void 0?void 0:K.ownerBlock:null;Sn&&(e.compilationString+=Sn.getCode(He)),e._emitFunctionFromInclude("pbrBlockSheen",at,{replaceStrings:[{search:/REFLECTIONMAP_3D/g,replace:(oe=He==null?void 0:He._define3DName)!==null&&oe!==void 0?oe:"REFLECTIONMAP_3D"},{search:/REFLECTIONMAP_SKYBOX/g,replace:(ae=He==null?void 0:He._defineSkyboxName)!==null&&ae!==void 0?ae:"REFLECTIONMAP_SKYBOX"},{search:/LODINREFLECTIONALPHA/g,replace:(ue=He==null?void 0:He._defineLODReflectionAlpha)!==null&&ue!==void 0?ue:"LODINREFLECTIONALPHA"},{search:/LINEARSPECULARREFLECTION/g,replace:(de=He==null?void 0:He._defineLinearSpecularReflection)!==null&&de!==void 0?de:"LINEARSPECULARREFLECTION"}]});var Rt=this.clearcoat.isConnected?(me=this.clearcoat.connectedPoint)===null||me===void 0?void 0:me.ownerBlock:null,Rn=!this.perturbedNormal.isConnected&&!this.anisotropy.isConnected,bn=this.perturbedNormal.isConnected&&((ye=this.perturbedNormal.connectedPoint)===null||ye===void 0?void 0:ye.ownerBlock).worldTangent.isConnected,hn=this.anisotropy.isConnected&&((Ee=this.anisotropy.connectedPoint)===null||Ee===void 0?void 0:Ee.ownerBlock).worldTangent.isConnected,yn=bn||!this.perturbedNormal.isConnected&&hn;e.compilationString+=Lh.GetCode(e,Rt,He,It,Rn,yn,this.worldNormal.associatedVariableName),Rn&&(yn=(Ae=Rt==null?void 0:Rt.worldTangent.isConnected)!==null&&Ae!==void 0&&Ae),e._emitFunctionFromInclude("pbrBlockClearcoat",at,{replaceStrings:[{search:/computeReflectionCoords/g,replace:"computeReflectionCoordsPBR"},{search:/REFLECTIONMAP_3D/g,replace:(Ie=He==null?void 0:He._define3DName)!==null&&Ie!==void 0?Ie:"REFLECTIONMAP_3D"},{search:/REFLECTIONMAP_OPPOSITEZ/g,replace:(Re=He==null?void 0:He._defineOppositeZ)!==null&&Re!==void 0?Re:"REFLECTIONMAP_OPPOSITEZ"},{search:/REFLECTIONMAP_PROJECTION/g,replace:(Pe=He==null?void 0:He._defineProjectionName)!==null&&Pe!==void 0?Pe:"REFLECTIONMAP_PROJECTION"},{search:/REFLECTIONMAP_SKYBOX/g,replace:(Ce=He==null?void 0:He._defineSkyboxName)!==null&&Ce!==void 0?Ce:"REFLECTIONMAP_SKYBOX"},{search:/LODINREFLECTIONALPHA/g,replace:(Be=He==null?void 0:He._defineLODReflectionAlpha)!==null&&Be!==void 0?Be:"LODINREFLECTIONALPHA"},{search:/LINEARSPECULARREFLECTION/g,replace:(Oe=He==null?void 0:He._defineLinearSpecularReflection)!==null&&Oe!==void 0?Oe:"LINEARSPECULARREFLECTION"},{search:/defined\(TANGENT\)/g,replace:yn?"defined(TANGENT)":"defined(IGNORE)"}]}),e.compilationString+=e._emitCodeFromInclude("pbrBlockReflectance",at,{replaceStrings:[{search:/REFLECTIONMAP_SKYBOX/g,replace:(Ve=He==null?void 0:He._defineSkyboxName)!==null&&Ve!==void 0?Ve:"REFLECTIONMAP_SKYBOX"},{search:/REFLECTIONMAP_3D/g,replace:(Le=He==null?void 0:He._define3DName)!==null&&Le!==void 0?Le:"REFLECTIONMAP_3D"}]});var Lt=this.subsurface.isConnected?(je=this.subsurface.connectedPoint)===null||je===void 0?void 0:je.ownerBlock:null,Kt=this.subsurface.isConnected?(ut=((tt=this.subsurface.connectedPoint)===null||tt===void 0?void 0:tt.ownerBlock).refraction.connectedPoint)===null||ut===void 0?void 0:ut.ownerBlock:null;Kt&&(Kt.viewConnectionPoint=this.view,Kt.indexOfRefractionConnectionPoint=this.indexOfRefraction),e.compilationString+=Nh.GetCode(e,Lt,He,It),e._emitFunctionFromInclude("pbrBlockSubSurface",at,{replaceStrings:[{search:/REFLECTIONMAP_3D/g,replace:(ft=He==null?void 0:He._define3DName)!==null&&ft!==void 0?ft:"REFLECTIONMAP_3D"},{search:/REFLECTIONMAP_OPPOSITEZ/g,replace:(vt=He==null?void 0:He._defineOppositeZ)!==null&&vt!==void 0?vt:"REFLECTIONMAP_OPPOSITEZ"},{search:/REFLECTIONMAP_PROJECTION/g,replace:(rt=He==null?void 0:He._defineProjectionName)!==null&&rt!==void 0?rt:"REFLECTIONMAP_PROJECTION"},{search:/SS_REFRACTIONMAP_3D/g,replace:(mt=Kt==null?void 0:Kt._define3DName)!==null&&mt!==void 0?mt:"SS_REFRACTIONMAP_3D"},{search:/SS_LODINREFRACTIONALPHA/g,replace:(pt=Kt==null?void 0:Kt._defineLODRefractionAlpha)!==null&&pt!==void 0?pt:"SS_LODINREFRACTIONALPHA"},{search:/SS_LINEARSPECULARREFRACTION/g,replace:(it=Kt==null?void 0:Kt._defineLinearSpecularRefraction)!==null&&it!==void 0?it:"SS_LINEARSPECULARREFRACTION"},{search:/SS_REFRACTIONMAP_OPPOSITEZ/g,replace:(yt=Kt==null?void 0:Kt._defineOppositeZ)!==null&&yt!==void 0?yt:"SS_REFRACTIONMAP_OPPOSITEZ"}]}),e.compilationString+=e._emitCodeFromInclude("pbrBlockDirectLighting",at),this.light?e.compilationString+=e._emitCodeFromInclude("lightFragment",at,{replaceStrings:[{search:/{X}/g,replace:this._lightId.toString()}]}):e.compilationString+=e._emitCodeFromInclude("lightFragment",at,{repeatKey:"maxSimultaneousLights"}),e.compilationString+=e._emitCodeFromInclude("pbrBlockFinalLitComponents",at),e.compilationString+=`#endif\r
`;var In=this.ambientColor.isConnected?this.ambientColor.associatedVariableName:"vec3(0., 0., 0.)",Lr=nr.DEFAULT_AO_ON_ANALYTICAL_LIGHTS.toString();Lr.indexOf(".")===-1&&(Lr+="."),e.compilationString+=e._emitCodeFromInclude("pbrBlockFinalUnlitComponents",at,{replaceStrings:[{search:/vec3 finalEmissive[\s\S]*?finalEmissive\*=vLightingIntensity\.y;/g,replace:""},{search:/vAmbientColor/g,replace:In+" * ambientFromScene"},{search:/vAmbientInfos\.w/g,replace:Lr}]}),e.compilationString+=e._emitCodeFromInclude("pbrBlockFinalColorComposition",at,{replaceStrings:[{search:/finalEmissive/g,replace:"vec3(0.)"}]}),e.compilationString+=e._emitCodeFromInclude("pbrBlockImageProcessing",at,{replaceStrings:[{search:/visibility/g,replace:"1."}]}),e.compilationString+=e._emitCodeFromInclude("pbrDebug",at,{replaceStrings:[{search:/vNormalW/g,replace:this._vNormalWName},{search:/vPositionW/g,replace:It},{search:/albedoTexture\.rgb;/g,replace:`vec3(1.);\r
gl_FragColor.rgb = toGammaSpace(gl_FragColor.rgb);\r
`}]});for(var Wr=0,pi=this._outputs;Wr<pi.length;Wr++){var Nr=pi[Wr];if(Nr.hasEndpoints){var xn=Nw[Nr.name];if(xn){var Ci=xn[0],ho=xn[1];ho&&(e.compilationString+="#if "+ho+`\r
`),e.compilationString+=this._declareOutput(Nr,e)+" = "+Ci+`;\r
`,ho&&(e.compilationString+=`#else\r
`,e.compilationString+=this._declareOutput(Nr,e)+` = vec3(0.);\r
`,e.compilationString+=`#endif\r
`)}else console.error("There's no remapping for the "+Nr.name+" end point! No code generated")}}return this},t.prototype._dumpPropertiesCode=function(){var e="";return e+=this._codeVariableName+".lightFalloff = "+this.lightFalloff+`;\r
`,e+=this._codeVariableName+".useAlphaTest = "+this.useAlphaTest+`;\r
`,e+=this._codeVariableName+".alphaTestCutoff = "+this.alphaTestCutoff+`;\r
`,e+=this._codeVariableName+".useAlphaBlending = "+this.useAlphaBlending+`;\r
`,e+=this._codeVariableName+".useRadianceOverAlpha = "+this.useRadianceOverAlpha+`;\r
`,e+=this._codeVariableName+".useSpecularOverAlpha = "+this.useSpecularOverAlpha+`;\r
`,e+=this._codeVariableName+".enableSpecularAntiAliasing = "+this.enableSpecularAntiAliasing+`;\r
`,e+=this._codeVariableName+".realTimeFiltering = "+this.realTimeFiltering+`;\r
`,e+=this._codeVariableName+".realTimeFilteringQuality = "+this.realTimeFilteringQuality+`;\r
`,e+=this._codeVariableName+".useEnergyConservation = "+this.useEnergyConservation+`;\r
`,e+=this._codeVariableName+".useRadianceOcclusion = "+this.useRadianceOcclusion+`;\r
`,e+=this._codeVariableName+".useHorizonOcclusion = "+this.useHorizonOcclusion+`;\r
`,e+=this._codeVariableName+".unlit = "+this.unlit+`;\r
`,e+=this._codeVariableName+".forceNormalForward = "+this.forceNormalForward+`;\r
`,e+=this._codeVariableName+".debugMode = "+this.debugMode+`;\r
`,e+=this._codeVariableName+".debugLimit = "+this.debugLimit+`;\r
`,e+=this._codeVariableName+".debugFactor = "+this.debugFactor+`;\r
`},t.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return this.light&&(e.lightId=this.light.id),e.lightFalloff=this.lightFalloff,e.useAlphaTest=this.useAlphaTest,e.alphaTestCutoff=this.alphaTestCutoff,e.useAlphaBlending=this.useAlphaBlending,e.useRadianceOverAlpha=this.useRadianceOverAlpha,e.useSpecularOverAlpha=this.useSpecularOverAlpha,e.enableSpecularAntiAliasing=this.enableSpecularAntiAliasing,e.realTimeFiltering=this.realTimeFiltering,e.realTimeFilteringQuality=this.realTimeFilteringQuality,e.useEnergyConservation=this.useEnergyConservation,e.useRadianceOcclusion=this.useRadianceOcclusion,e.useHorizonOcclusion=this.useHorizonOcclusion,e.unlit=this.unlit,e.forceNormalForward=this.forceNormalForward,e.debugMode=this.debugMode,e.debugLimit=this.debugLimit,e.debugFactor=this.debugFactor,e},t.prototype._deserialize=function(e,n,r){var o,u;i.prototype._deserialize.call(this,e,n,r),e.lightId&&(this.light=n.getLightByID(e.lightId)),this.lightFalloff=(o=e.lightFalloff)!==null&&o!==void 0?o:0,this.useAlphaTest=e.useAlphaTest,this.alphaTestCutoff=e.alphaTestCutoff,this.useAlphaBlending=e.useAlphaBlending,this.useRadianceOverAlpha=e.useRadianceOverAlpha,this.useSpecularOverAlpha=e.useSpecularOverAlpha,this.enableSpecularAntiAliasing=e.enableSpecularAntiAliasing,this.realTimeFiltering=!!e.realTimeFiltering,this.realTimeFilteringQuality=(u=e.realTimeFilteringQuality)!==null&&u!==void 0?u:g.a.TEXTURE_FILTERING_QUALITY_LOW,this.useEnergyConservation=e.useEnergyConservation,this.useRadianceOcclusion=e.useRadianceOcclusion,this.useHorizonOcclusion=e.useHorizonOcclusion,this.unlit=e.unlit,this.forceNormalForward=!!e.forceNormalForward,this.debugMode=e.debugMode,this.debugLimit=e.debugLimit,this.debugFactor=e.debugFactor},Object(p.c)([sn("Direct lights",$t.Float,"INTENSITY",{min:0,max:1,notifiers:{update:!0}})],t.prototype,"directIntensity",void 0),Object(p.c)([sn("Environment lights",$t.Float,"INTENSITY",{min:0,max:1,notifiers:{update:!0}})],t.prototype,"environmentIntensity",void 0),Object(p.c)([sn("Specular highlights",$t.Float,"INTENSITY",{min:0,max:1,notifiers:{update:!0}})],t.prototype,"specularIntensity",void 0),Object(p.c)([sn("Light falloff",$t.List,"LIGHTING & COLORS",{notifiers:{update:!0},options:[{label:"Physical",value:nr.LIGHTFALLOFF_PHYSICAL},{label:"GLTF",value:nr.LIGHTFALLOFF_GLTF},{label:"Standard",value:nr.LIGHTFALLOFF_STANDARD}]})],t.prototype,"lightFalloff",void 0),Object(p.c)([sn("Alpha Testing",$t.Boolean,"OPACITY")],t.prototype,"useAlphaTest",void 0),Object(p.c)([sn("Alpha CutOff",$t.Float,"OPACITY",{min:0,max:1,notifiers:{update:!0}})],t.prototype,"alphaTestCutoff",void 0),Object(p.c)([sn("Alpha blending",$t.Boolean,"OPACITY")],t.prototype,"useAlphaBlending",void 0),Object(p.c)([sn("Radiance over alpha",$t.Boolean,"RENDERING",{notifiers:{update:!0}})],t.prototype,"useRadianceOverAlpha",void 0),Object(p.c)([sn("Specular over alpha",$t.Boolean,"RENDERING",{notifiers:{update:!0}})],t.prototype,"useSpecularOverAlpha",void 0),Object(p.c)([sn("Specular anti-aliasing",$t.Boolean,"RENDERING",{notifiers:{update:!0}})],t.prototype,"enableSpecularAntiAliasing",void 0),Object(p.c)([sn("Realtime filtering",$t.Boolean,"RENDERING",{notifiers:{update:!0}})],t.prototype,"realTimeFiltering",void 0),Object(p.c)([sn("Realtime filtering quality",$t.List,"RENDERING",{notifiers:{update:!0},options:[{label:"Low",value:g.a.TEXTURE_FILTERING_QUALITY_LOW},{label:"Medium",value:g.a.TEXTURE_FILTERING_QUALITY_MEDIUM},{label:"High",value:g.a.TEXTURE_FILTERING_QUALITY_HIGH}]})],t.prototype,"realTimeFilteringQuality",void 0),Object(p.c)([sn("Energy Conservation",$t.Boolean,"ADVANCED",{notifiers:{update:!0}})],t.prototype,"useEnergyConservation",void 0),Object(p.c)([sn("Radiance occlusion",$t.Boolean,"ADVANCED",{notifiers:{update:!0}})],t.prototype,"useRadianceOcclusion",void 0),Object(p.c)([sn("Horizon occlusion",$t.Boolean,"ADVANCED",{notifiers:{update:!0}})],t.prototype,"useHorizonOcclusion",void 0),Object(p.c)([sn("Unlit",$t.Boolean,"ADVANCED",{notifiers:{update:!0}})],t.prototype,"unlit",void 0),Object(p.c)([sn("Force normal forward",$t.Boolean,"ADVANCED",{notifiers:{update:!0}})],t.prototype,"forceNormalForward",void 0),Object(p.c)([sn("Debug mode",$t.List,"DEBUG",{notifiers:{update:!0},options:[{label:"None",value:0},{label:"Normalized position",value:1},{label:"Normals",value:2},{label:"Tangents",value:3},{label:"Bitangents",value:4},{label:"Bump Normals",value:5},{label:"ClearCoat Normals",value:8},{label:"ClearCoat Tangents",value:9},{label:"ClearCoat Bitangents",value:10},{label:"Anisotropic Normals",value:11},{label:"Anisotropic Tangents",value:12},{label:"Anisotropic Bitangents",value:13},{label:"Env Refraction",value:40},{label:"Env Reflection",value:41},{label:"Env Clear Coat",value:42},{label:"Direct Diffuse",value:50},{label:"Direct Specular",value:51},{label:"Direct Clear Coat",value:52},{label:"Direct Sheen",value:53},{label:"Env Irradiance",value:54},{label:"Surface Albedo",value:60},{label:"Reflectance 0",value:61},{label:"Metallic",value:62},{label:"Metallic F0",value:71},{label:"Roughness",value:63},{label:"AlphaG",value:64},{label:"NdotV",value:65},{label:"ClearCoat Color",value:66},{label:"ClearCoat Roughness",value:67},{label:"ClearCoat NdotV",value:68},{label:"Transmittance",value:69},{label:"Refraction Transmittance",value:70},{label:"SEO",value:80},{label:"EHO",value:81},{label:"Energy Factor",value:82},{label:"Specular Reflectance",value:83},{label:"Clear Coat Reflectance",value:84},{label:"Sheen Reflectance",value:85},{label:"Luminance Over Alpha",value:86},{label:"Alpha",value:87}]})],t.prototype,"debugMode",void 0),Object(p.c)([sn("Split position",$t.Float,"DEBUG",{min:-1,max:1,notifiers:{update:!0}})],t.prototype,"debugLimit",void 0),Object(p.c)([sn("Output factor",$t.Float,"DEBUG",{min:0,max:5,notifiers:{update:!0}})],t.prototype,"debugFactor",void 0),t}(Et);C.a.RegisteredTypes["BABYLON.PBRMetallicRoughnessBlock"]=qT;var ZT=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("left",fe.AutoDetect),n.registerInput("right",fe.AutoDetect),n.registerOutput("output",fe.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n._linkConnectionTypes(0,1),n}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"ModBlock"},Object.defineProperty(t.prototype,"left",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = mod("+this.left.associatedVariableName+", "+this.right.associatedVariableName+`);\r
`,this},t}(Et);C.a.RegisteredTypes["BABYLON.ModBlock"]=ZT;var Fw=function(){function i(){}return i.prototype.optimize=function(t,e){},i}(),Bw=c(120),Uw=function(){function i(){this.mm=new Map}return i.prototype.get=function(t,e){var n=this.mm.get(t);if(n!==void 0)return n.get(e)},i.prototype.set=function(t,e,n){var r=this.mm.get(t);r===void 0&&this.mm.set(t,r=new Map),r.set(e,n)},i}(),Vw=function(){function i(t,e,n){var r=this;this._baseMaterial=t,this._scene=e,this._options=n,this._subMeshToEffect=new Map,this._subMeshToDepthEffect=new Uw,this._meshes=new Map;var o=t.getClassName()==="NodeMaterial"?"u_":"";if(o){this._matriceNames={world:o+"World",view:o+"View",projection:o+"Projection",viewProjection:o+"ViewProjection",worldView:o+"WorldxView",worldViewProjection:o+"WorldxViewxProjection"};for(var u=t.getInputBlocks(),f=0;f<u.length;++f)switch(u[f]._systemValue){case Mt.World:this._matriceNames.world=u[f].associatedVariableName;break;case Mt.View:this._matriceNames.view=u[f].associatedVariableName;break;case Mt.Projection:this._matriceNames.projection=u[f].associatedVariableName;break;case Mt.ViewProjection:this._matriceNames.viewProjection=u[f].associatedVariableName;break;case Mt.WorldView:this._matriceNames.worldView=u[f].associatedVariableName;break;case Mt.WorldViewProjection:this._matriceNames.worldViewProjection=u[f].associatedVariableName}}else this._matriceNames={world:o+"world",view:o+"view",projection:o+"projection",viewProjection:o+"viewProjection",worldView:o+"worldView",worldViewProjection:o+"worldViewProjection"};this._onEffectCreatedObserver=this._baseMaterial.onEffectCreatedObservable.add(function(v){var y,D=(y=v.subMesh)===null||y===void 0?void 0:y.getMesh();D&&!r._meshes.has(D)&&r._meshes.set(D,D.onDisposeObservable.add(function(w){for(var F=r._subMeshToEffect.keys(),z=F.next();z.done!==!0;z=F.next()){var k=z.value;(k==null?void 0:k.getMesh())===w&&(r._subMeshToEffect.delete(k),r._subMeshToDepthEffect.mm.delete(k))}})),r._subMeshToEffect.set(v.subMesh,v.effect),r._subMeshToDepthEffect.mm.delete(v.subMesh)})}return Object.defineProperty(i.prototype,"standalone",{get:function(){var t,e;return(e=(t=this._options)===null||t===void 0?void 0:t.standalone)!==null&&e!==void 0&&e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"baseMaterial",{get:function(){return this._baseMaterial},enumerable:!1,configurable:!0}),i.prototype.getEffect=function(t,e){var n,r,o,u,f,v;return(v=(o=(r=(n=this._subMeshToDepthEffect.mm.get(t))===null||n===void 0?void 0:n.get(e))===null||r===void 0?void 0:r.depthEffect)!==null&&o!==void 0?o:(f=(u=this._subMeshToDepthEffect.mm.get(null))===null||u===void 0?void 0:u.get(e))===null||f===void 0?void 0:f.depthEffect)!==null&&v!==void 0?v:null},i.prototype.isReadyForSubMesh=function(t,e,n,r){var o,u;return this.standalone&&this._baseMaterial.isReadyForSubMesh(t.getMesh(),t,r),(u=(o=this._makeEffect(t,e,n))===null||o===void 0?void 0:o.isReady())!==null&&u!==void 0&&u},i.prototype.dispose=function(){this._baseMaterial.onEffectCreatedObservable.remove(this._onEffectCreatedObserver),this._onEffectCreatedObserver=null;for(var t=this._meshes.entries(),e=t.next();e.done!==!0;e=t.next()){var n=e.value,r=n[0],o=n[1];r.onDisposeObservable.remove(o)}},i.prototype._makeEffect=function(t,e,n){var r,o=(r=this._subMeshToEffect.get(t))!==null&&r!==void 0?r:this._subMeshToEffect.get(null);if(!o)return null;var u=this._subMeshToDepthEffect.get(t,n);u||(u={depthEffect:null,depthDefines:"",token:Bw.a.RandomId()},this._subMeshToDepthEffect.set(t,n,u));var f=e.join(`
`);if(u.depthEffect&&f===u.depthDefines)return u.depthEffect;u.depthDefines=f;var v=o.rawVertexSourceCode,y=o.rawFragmentSourceCode,D=this._options&&this._options.remappedVariables?"#include<shadowMapVertexNormalBias>("+this._options.remappedVariables.join(",")+")":Ye.a.IncludesShadersStore.shadowMapVertexNormalBias,w=this._options&&this._options.remappedVariables?"#include<shadowMapVertexMetric>("+this._options.remappedVariables.join(",")+")":Ye.a.IncludesShadersStore.shadowMapVertexMetric,F=this._options&&this._options.remappedVariables?"#include<shadowMapFragmentSoftTransparentShadow>("+this._options.remappedVariables.join(",")+")":Ye.a.IncludesShadersStore.shadowMapFragmentSoftTransparentShadow,z=Ye.a.IncludesShadersStore.shadowMapFragment;v=(v=(v=(v=v.replace(/void\s+?main/g,Ye.a.IncludesShadersStore.shadowMapVertexDeclaration+`\r
void main`)).replace(/#define SHADOWDEPTH_NORMALBIAS|#define CUSTOM_VERTEX_UPDATE_WORLDPOS/g,D)).indexOf("#define SHADOWDEPTH_METRIC")!==-1?v.replace(/#define SHADOWDEPTH_METRIC/g,w):v.replace(/}\s*$/g,w+`\r
}`)).replace(/#define SHADER_NAME.*?\n|out vec4 glFragColor;\n/g,"");var k=y.indexOf("#define SHADOWDEPTH_SOFTTRANSPARENTSHADOW")>=0||y.indexOf("#define CUSTOM_FRAGMENT_BEFORE_FOG")>=0,K=y.indexOf("#define SHADOWDEPTH_FRAGMENT")!==-1,oe="";k?y=y.replace(/#define SHADOWDEPTH_SOFTTRANSPARENTSHADOW|#define CUSTOM_FRAGMENT_BEFORE_FOG/g,F):oe=F+`\r
`,y=y.replace(/void\s+?main/g,Ye.a.IncludesShadersStore.shadowMapFragmentDeclaration+`\r
void main`),K?y=y.replace(/#define SHADOWDEPTH_FRAGMENT/g,z):oe+=z+`\r
`,oe&&(y=y.replace(/}\s*$/g,oe+"}")),y=y.replace(/#define SHADER_NAME.*?\n|out vec4 glFragColor;\n/g,"");var ae=o.getUniformNames().slice();return ae.push("biasAndScaleSM","depthValuesSM","lightDataSM","softTransparentShadowSM"),u.depthEffect=this._scene.getEngine().createEffect({vertexSource:v,fragmentSource:y,vertexToken:u.token,fragmentToken:u.token},{attributes:o.getAttributesNames(),uniformsNames:ae,uniformBuffersNames:o.getUniformBuffersNames(),samplers:o.getSamplers(),defines:f+`
`+o.defines.replace("#define SHADOWS","").replace(/#define SHADOW\d/g,""),indexParameters:o.getIndexParameters()},this._scene.getEngine()),u.depthEffect},i}(),$T=c(101);function Um(i,t,e,n,r){var o=new i.DecoderBuffer;o.Init(t,t.byteLength);var u,f,v=new i.Decoder;try{var y=v.GetEncodedGeometryType(o);switch(y){case i.TRIANGULAR_MESH:u=new i.Mesh,f=v.DecodeBufferToMesh(o,u);break;case i.POINT_CLOUD:u=new i.PointCloud,f=v.DecodeBufferToPointCloud(o,u);break;default:throw new Error("Invalid geometry type "+y)}if(!f.ok()||!u.ptr)throw new Error(f.error_msg());if(y===i.TRIANGULAR_MESH){var D=3*u.num_faces(),w=4*D,F=i._malloc(w);try{v.GetTrianglesUInt32Array(u,w,F);var z=new Uint32Array(D);z.set(new Uint32Array(i.HEAPF32.buffer,F,D)),n(z)}finally{i._free(F)}}var k=function(ue,de){var me=de.num_components(),ye=u.num_points(),Ee=ye*me,Ae=Ee*Float32Array.BYTES_PER_ELEMENT,Ie=i._malloc(Ae);try{v.GetAttributeDataArrayForAllPoints(u,de,i.DT_FLOAT32,Ae,Ie);var Re=new Float32Array(i.HEAPF32.buffer,Ie,Ee);if(ue==="color"&&me===3){for(var Pe=new Float32Array(4*ye),Ce=0,Be=0;Ce<Pe.length;Ce+=4,Be+=me)Pe[Ce+0]=Re[Be+0],Pe[Ce+1]=Re[Be+1],Pe[Ce+2]=Re[Be+2],Pe[Ce+3]=1;r(ue,Pe)}else(Pe=new Float32Array(Ee)).set(new Float32Array(i.HEAPF32.buffer,Ie,Ee)),r(ue,Pe)}finally{i._free(Ie)}};if(e)for(var K in e){var oe=e[K];k(K,v.GetAttributeByUniqueId(u,oe))}else{var ae={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"};for(var K in ae)(oe=v.GetAttributeId(u,i[ae[K]]))!==-1&&k(K,v.GetAttribute(u,oe))}}finally{u&&i.destroy(u),i.destroy(v),i.destroy(o)}}function kw(){var i;onmessage=function(t){var e=t.data;switch(e.id){case"init":var n=e.decoder;n.url&&(importScripts(n.url),i=DracoDecoderModule({wasmBinary:n.wasmBinary})),postMessage("done");break;case"decodeMesh":if(!i)throw new Error("Draco decoder module is not available");i.then(function(r){Um(r,e.dataView,e.attributes,function(o){postMessage({id:"indices",value:o},[o.buffer])},function(o,u){postMessage({id:o,value:u},[u.buffer])}),postMessage("done")})}}}function JT(i){return typeof document!="object"||typeof i!="string"?i:et.b.GetAbsoluteUrl(i)}var jw=function(){function i(t){t===void 0&&(t=i.DefaultNumWorkers);var e=i.Configuration.decoder,n=e.wasmUrl&&e.wasmBinaryUrl&&typeof WebAssembly=="object"?{url:e.wasmUrl,wasmBinaryPromise:et.b.LoadFileAsync(JT(e.wasmBinaryUrl))}:{url:e.fallbackUrl,wasmBinaryPromise:Promise.resolve(void 0)};t&&typeof Worker=="function"?this._workerPoolPromise=n.wasmBinaryPromise.then(function(r){for(var o=Um+"("+kw+")()",u=URL.createObjectURL(new Blob([o],{type:"application/javascript"})),f=new Array(t),v=0;v<f.length;v++)f[v]=new Promise(function(y,D){var w=new Worker(u),F=function(k){w.removeEventListener("error",F),w.removeEventListener("message",z),D(k)},z=function(k){k.data==="done"&&(w.removeEventListener("error",F),w.removeEventListener("message",z),y(w))};w.addEventListener("error",F),w.addEventListener("message",z),w.postMessage({id:"init",decoder:{url:JT(n.url),wasmBinary:r}})});return Promise.all(f).then(function(y){return new nm(y)})}):this._decoderModulePromise=n.wasmBinaryPromise.then(function(r){if(!n.url)throw new Error("Draco decoder module is not available");return et.b.LoadScriptAsync(n.url).then(function(){return o=r,new Promise(function(u){DracoDecoderModule({wasmBinary:o}).then(function(f){u({module:f})})});var o})})}return Object.defineProperty(i,"DecoderAvailable",{get:function(){var t=i.Configuration.decoder;return!!(t.wasmUrl&&t.wasmBinaryUrl&&typeof WebAssembly=="object"||t.fallbackUrl)},enumerable:!1,configurable:!0}),i.GetDefaultNumWorkers=function(){return typeof navigator=="object"&&navigator.hardwareConcurrency?Math.min(Math.floor(.5*navigator.hardwareConcurrency),4):1},Object.defineProperty(i,"Default",{get:function(){return i._Default||(i._Default=new i),i._Default},enumerable:!1,configurable:!0}),i.prototype.dispose=function(){this._workerPoolPromise&&this._workerPoolPromise.then(function(t){t.dispose()}),delete this._workerPoolPromise,delete this._decoderModulePromise},i.prototype.whenReadyAsync=function(){return this._workerPoolPromise?this._workerPoolPromise.then(function(){}):this._decoderModulePromise?this._decoderModulePromise.then(function(){}):Promise.resolve()},i.prototype.decodeMeshAsync=function(t,e){var n=t instanceof ArrayBuffer?new Uint8Array(t):t;if(this._workerPoolPromise)return this._workerPoolPromise.then(function(r){return new Promise(function(o,u){r.push(function(f,v){var y=new Tt.a,D=function(z){f.removeEventListener("error",D),f.removeEventListener("message",w),u(z),v()},w=function(z){z.data==="done"?(f.removeEventListener("error",D),f.removeEventListener("message",w),o(y),v()):z.data.id==="indices"?y.indices=z.data.value:y.set(z.data.value,z.data.id)};f.addEventListener("error",D),f.addEventListener("message",w);var F=new Uint8Array(n.byteLength);F.set(new Uint8Array(n.buffer,n.byteOffset,n.byteLength)),f.postMessage({id:"decodeMesh",dataView:F,attributes:e},[F.buffer])})})});if(this._decoderModulePromise)return this._decoderModulePromise.then(function(r){var o=new Tt.a;return Um(r.module,n,e,function(u){o.indices=u},function(u,f){o.set(f,u)}),o});throw new Error("Draco decoder module is not available")},i.Configuration={decoder:{wasmUrl:"https://preview.babylonjs.com/draco_wasm_wrapper_gltf.js",wasmBinaryUrl:"https://preview.babylonjs.com/draco_decoder_gltf.wasm",fallbackUrl:"https://preview.babylonjs.com/draco_decoder_gltf.js"}},i.DefaultNumWorkers=i.GetDefaultNumWorkers(),i._Default=null,i}(),vl=c(61),eE=0,zw=function(){function i(t,e,n,r){this.pos=t,this.normal=e,this.uv=n,this.vertColor=r}return i.prototype.clone=function(){var t,e;return new i(this.pos.clone(),this.normal.clone(),(t=this.uv)===null||t===void 0?void 0:t.clone(),(e=this.vertColor)===null||e===void 0?void 0:e.clone())},i.prototype.flip=function(){this.normal=this.normal.scale(-1)},i.prototype.interpolate=function(t,e){return new i(d.e.Lerp(this.pos,t.pos,e),d.e.Lerp(this.normal,t.normal,e),this.uv&&t.uv?d.d.Lerp(this.uv,t.uv,e):void 0,this.vertColor&&t.vertColor?M.b.Lerp(this.vertColor,t.vertColor,e):void 0)},i}(),Gw=function(){function i(t,e){this.normal=t,this.w=e}return i.FromPoints=function(t,e,n){var r=n.subtract(t),o=e.subtract(t);if(r.lengthSquared()===0||o.lengthSquared()===0)return null;var u=d.e.Normalize(d.e.Cross(r,o));return new i(u,d.e.Dot(u,t))},i.prototype.clone=function(){return new i(this.normal.clone(),this.w)},i.prototype.flip=function(){this.normal.scaleInPlace(-1),this.w=-this.w},i.prototype.splitPolygon=function(t,e,n,r,o){var u,f,v=0,y=[];for(u=0;u<t.vertices.length;u++){var D=(f=d.e.Dot(this.normal,t.vertices[u].pos)-this.w)<-i.EPSILON?2:f>i.EPSILON?1:0;v|=D,y.push(D)}switch(v){case 0:(d.e.Dot(this.normal,t.plane.normal)>0?e:n).push(t);break;case 1:r.push(t);break;case 2:o.push(t);break;case 3:var w,F=[],z=[];for(u=0;u<t.vertices.length;u++){var k=(u+1)%t.vertices.length,K=y[u],oe=y[k],ae=t.vertices[u],ue=t.vertices[k];if(K!==2&&F.push(ae),K!==1&&z.push(K!==2?ae.clone():ae),(K|oe)==3){f=(this.w-d.e.Dot(this.normal,ae.pos))/d.e.Dot(this.normal,ue.pos.subtract(ae.pos));var de=ae.interpolate(ue,f);F.push(de),z.push(de.clone())}}F.length>=3&&(w=new Vm(F,t.shared)).plane&&r.push(w),z.length>=3&&(w=new Vm(z,t.shared)).plane&&o.push(w)}},i.EPSILON=1e-5,i}(),Vm=function(){function i(t,e){this.vertices=t,this.shared=e,this.plane=Gw.FromPoints(t[0].pos,t[1].pos,t[2].pos)}return i.prototype.clone=function(){return new i(this.vertices.map(function(t){return t.clone()}),this.shared)},i.prototype.flip=function(){this.vertices.reverse().map(function(t){t.flip()}),this.plane.flip()},i}(),fi=function(){function i(t){this.plane=null,this.front=null,this.back=null,this.polygons=new Array,t&&this.build(t)}return i.prototype.clone=function(){var t=new i;return t.plane=this.plane&&this.plane.clone(),t.front=this.front&&this.front.clone(),t.back=this.back&&this.back.clone(),t.polygons=this.polygons.map(function(e){return e.clone()}),t},i.prototype.invert=function(){for(var t=0;t<this.polygons.length;t++)this.polygons[t].flip();this.plane&&this.plane.flip(),this.front&&this.front.invert(),this.back&&this.back.invert();var e=this.front;this.front=this.back,this.back=e},i.prototype.clipPolygons=function(t){if(!this.plane)return t.slice();for(var e=new Array,n=new Array,r=0;r<t.length;r++)this.plane.splitPolygon(t[r],e,n,e,n);return this.front&&(e=this.front.clipPolygons(e)),n=this.back?this.back.clipPolygons(n):[],e.concat(n)},i.prototype.clipTo=function(t){this.polygons=t.clipPolygons(this.polygons),this.front&&this.front.clipTo(t),this.back&&this.back.clipTo(t)},i.prototype.allPolygons=function(){var t=this.polygons.slice();return this.front&&(t=t.concat(this.front.allPolygons())),this.back&&(t=t.concat(this.back.allPolygons())),t},i.prototype.build=function(t){if(t.length){this.plane||(this.plane=t[0].plane.clone());for(var e=new Array,n=new Array,r=0;r<t.length;r++)this.plane.splitPolygon(t[r],this.polygons,this.polygons,e,n);e.length&&(this.front||(this.front=new i),this.front.build(e)),n.length&&(this.back||(this.back=new i),this.back.build(n))}},i}(),Hw=function(){function i(){this.polygons=new Array}return i.FromMesh=function(t){var e,n,r,o,u,f,v,y,D,w=void 0,F=void 0,z=new Array,k=null;if(!(t instanceof Ne.a))throw"BABYLON.CSG: Wrong Mesh type, must be BABYLON.Mesh";t.computeWorldMatrix(!0),f=t.getWorldMatrix(),v=t.position.clone(),y=t.rotation.clone(),t.rotationQuaternion&&(k=t.rotationQuaternion.clone()),D=t.scaling.clone();for(var K=t.getIndices(),oe=t.getVerticesData(De.b.PositionKind),ae=t.getVerticesData(De.b.NormalKind),ue=t.getVerticesData(De.b.UVKind),de=t.getVerticesData(De.b.ColorKind),me=t.subMeshes,ye=0,Ee=me.length;ye<Ee;ye++)for(var Ae=me[ye].indexStart,Ie=me[ye].indexCount+me[ye].indexStart;Ae<Ie;Ae+=3){u=[];for(var Re=0;Re<3;Re++){var Pe=new d.e(ae[3*K[Ae+Re]],ae[3*K[Ae+Re]+1],ae[3*K[Ae+Re]+2]);ue&&(w=new d.d(ue[2*K[Ae+Re]],ue[2*K[Ae+Re]+1])),de&&(F=new M.b(de[4*K[Ae+Re]],de[4*K[Ae+Re]+1],de[4*K[Ae+Re]+2],de[4*K[Ae+Re]+3]));var Ce=new d.e(oe[3*K[Ae+Re]],oe[3*K[Ae+Re]+1],oe[3*K[Ae+Re]+2]);r=d.e.TransformCoordinates(Ce,f),n=d.e.TransformNormal(Pe,f),e=new zw(r,n,w,F),u.push(e)}(o=new Vm(u,{subMeshId:ye,meshId:eE,materialIndex:me[ye].materialIndex})).plane&&z.push(o)}var Be=i.FromPolygons(z);return Be.matrix=f,Be.position=v,Be.rotation=y,Be.scaling=D,Be.rotationQuaternion=k,eE++,Be},i.FromPolygons=function(t){var e=new i;return e.polygons=t,e},i.prototype.clone=function(){var t=new i;return t.polygons=this.polygons.map(function(e){return e.clone()}),t.copyTransformAttributes(this),t},i.prototype.union=function(t){var e=new fi(this.clone().polygons),n=new fi(t.clone().polygons);return e.clipTo(n),n.clipTo(e),n.invert(),n.clipTo(e),n.invert(),e.build(n.allPolygons()),i.FromPolygons(e.allPolygons()).copyTransformAttributes(this)},i.prototype.unionInPlace=function(t){var e=new fi(this.polygons),n=new fi(t.polygons);e.clipTo(n),n.clipTo(e),n.invert(),n.clipTo(e),n.invert(),e.build(n.allPolygons()),this.polygons=e.allPolygons()},i.prototype.subtract=function(t){var e=new fi(this.clone().polygons),n=new fi(t.clone().polygons);return e.invert(),e.clipTo(n),n.clipTo(e),n.invert(),n.clipTo(e),n.invert(),e.build(n.allPolygons()),e.invert(),i.FromPolygons(e.allPolygons()).copyTransformAttributes(this)},i.prototype.subtractInPlace=function(t){var e=new fi(this.polygons),n=new fi(t.polygons);e.invert(),e.clipTo(n),n.clipTo(e),n.invert(),n.clipTo(e),n.invert(),e.build(n.allPolygons()),e.invert(),this.polygons=e.allPolygons()},i.prototype.intersect=function(t){var e=new fi(this.clone().polygons),n=new fi(t.clone().polygons);return e.invert(),n.clipTo(e),n.invert(),e.clipTo(n),n.clipTo(e),e.build(n.allPolygons()),e.invert(),i.FromPolygons(e.allPolygons()).copyTransformAttributes(this)},i.prototype.intersectInPlace=function(t){var e=new fi(this.polygons),n=new fi(t.polygons);e.invert(),n.clipTo(e),n.invert(),e.clipTo(n),n.clipTo(e),e.build(n.allPolygons()),e.invert(),this.polygons=e.allPolygons()},i.prototype.inverse=function(){var t=this.clone();return t.inverseInPlace(),t},i.prototype.inverseInPlace=function(){this.polygons.map(function(t){t.flip()})},i.prototype.copyTransformAttributes=function(t){return this.matrix=t.matrix,this.position=t.position,this.rotation=t.rotation,this.scaling=t.scaling,this.rotationQuaternion=t.rotationQuaternion,this},i.prototype.buildMeshGeometry=function(t,e,n){var r=this.matrix.clone();r.invert();var o,u,f,v=new Ne.a(t,e),y=[],D=[],w=[],F=null,z=null,k=d.e.Zero(),K=d.e.Zero(),oe=d.d.Zero(),ae=new M.b(0,0,0,0),ue=this.polygons,de=[0,0,0],me={},ye=0,Ee={};n&&ue.sort(function(vt,rt){return vt.shared.meshId===rt.shared.meshId?vt.shared.subMeshId-rt.shared.subMeshId:vt.shared.meshId-rt.shared.meshId});for(var Ae=0,Ie=ue.length;Ae<Ie;Ae++){Ee[(o=ue[Ae]).shared.meshId]||(Ee[o.shared.meshId]={}),Ee[o.shared.meshId][o.shared.subMeshId]||(Ee[o.shared.meshId][o.shared.subMeshId]={indexStart:1/0,indexEnd:-1/0,materialIndex:o.shared.materialIndex}),f=Ee[o.shared.meshId][o.shared.subMeshId];for(var Re=2,Pe=o.vertices.length;Re<Pe;Re++){de[0]=0,de[1]=Re-1,de[2]=Re;for(var Ce=0;Ce<3;Ce++){k.copyFrom(o.vertices[de[Ce]].pos),K.copyFrom(o.vertices[de[Ce]].normal),o.vertices[de[Ce]].uv&&(F||(F=[]),oe.copyFrom(o.vertices[de[Ce]].uv)),o.vertices[de[Ce]].vertColor&&(z||(z=[]),ae.copyFrom(o.vertices[de[Ce]].vertColor));var Be=d.e.TransformCoordinates(k,r),Oe=d.e.TransformNormal(K,r);u=me[Be.x+","+Be.y+","+Be.z];var Ve=!1;F&&F[2*u]!==oe.x&&F[2*u+1]!==oe.y&&(Ve=!0);var Le=!1;z&&z[4*u]!==ae.r&&z[4*u+1]!==ae.g&&z[4*u+2]!==ae.b&&z[4*u+3]!==ae.a&&(Le=!0),(u===void 0||w[3*u]!==Oe.x||w[3*u+1]!==Oe.y||w[3*u+2]!==Oe.z||Ve||Le)&&(y.push(Be.x,Be.y,Be.z),F&&F.push(oe.x,oe.y),w.push(K.x,K.y,K.z),z&&z.push(ae.r,ae.g,ae.b,ae.a),u=me[Be.x+","+Be.y+","+Be.z]=y.length/3-1),D.push(u),f.indexStart=Math.min(ye,f.indexStart),f.indexEnd=Math.max(ye,f.indexEnd),ye++}}}if(v.setVerticesData(De.b.PositionKind,y),v.setVerticesData(De.b.NormalKind,w),F&&v.setVerticesData(De.b.UVKind,F),z&&v.setVerticesData(De.b.ColorKind,z),v.setIndices(D,null),n){var je,tt=0;for(var ut in v.subMeshes=new Array,Ee){for(var ft in je=-1,Ee[ut])f=Ee[ut][ft],vl.a.CreateFromIndices(f.materialIndex+tt,f.indexStart,f.indexEnd-f.indexStart+1,v),je=Math.max(f.materialIndex,je);tt+=++je}}return v},i.prototype.toMesh=function(t,e,n,r){e===void 0&&(e=null);var o=this.buildMeshGeometry(t,n,r);return o.material=e,o.position.copyFrom(this.position),o.rotation.copyFrom(this.rotation),this.rotationQuaternion&&(o.rotationQuaternion=this.rotationQuaternion.clone()),o.scaling.copyFrom(this.scaling),o.computeWorldMatrix(!0),o},i}(),Ww=function(i){function t(e,n,r,o,u,f){o===void 0&&(o=1),u===void 0&&(u=60),f===void 0&&(f=!0);var v=i.call(this,e,r)||this;v._sectionPolygonPointsCount=4,v._running=!1,v._autoStart=f,v._generator=n,v._diameter=o,v._length=u,v._sectionVectors=[],v._sectionNormalVectors=[];for(var y=0;y<v._sectionPolygonPointsCount;y++)v._sectionVectors[y]=d.e.Zero(),v._sectionNormalVectors[y]=d.e.Zero();return v._createMesh(),v}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"TrailMesh"},t.prototype._createMesh=function(){var e=new Tt.a,n=[],r=[],o=[],u=d.e.Zero();u=this._generator instanceof jt.a&&this._generator._boundingInfo?this._generator._boundingInfo.boundingBox.centerWorld:this._generator.position;for(var f=2*Math.PI/this._sectionPolygonPointsCount,v=0;v<this._sectionPolygonPointsCount;v++)n.push(u.x+Math.cos(v*f)*this._diameter,u.y+Math.sin(v*f)*this._diameter,u.z);for(v=1;v<=this._length;v++){for(var y=0;y<this._sectionPolygonPointsCount;y++)n.push(u.x+Math.cos(y*f)*this._diameter,u.y+Math.sin(y*f)*this._diameter,u.z);var D=n.length/3-2*this._sectionPolygonPointsCount;for(y=0;y<this._sectionPolygonPointsCount-1;y++)o.push(D+y,D+y+this._sectionPolygonPointsCount,D+y+this._sectionPolygonPointsCount+1),o.push(D+y,D+y+this._sectionPolygonPointsCount+1,D+y+1);o.push(D+this._sectionPolygonPointsCount-1,D+this._sectionPolygonPointsCount-1+this._sectionPolygonPointsCount,D+this._sectionPolygonPointsCount),o.push(D+this._sectionPolygonPointsCount-1,D+this._sectionPolygonPointsCount,D)}Tt.a.ComputeNormals(n,o,r),e.positions=n,e.normals=r,e.indices=o,e.applyToMesh(this,!0),this._autoStart&&this.start()},t.prototype.start=function(){var e=this;this._running||(this._running=!0,this._beforeRenderObserver=this.getScene().onBeforeRenderObservable.add(function(){e.update()}))},t.prototype.stop=function(){this._beforeRenderObserver&&this._running&&(this._running=!1,this.getScene().onBeforeRenderObservable.remove(this._beforeRenderObserver))},t.prototype.update=function(){var e=this.getVerticesData(De.b.PositionKind),n=this.getVerticesData(De.b.NormalKind),r=this._generator.getWorldMatrix();if(e&&n){for(var o=3*this._sectionPolygonPointsCount;o<e.length;o++)e[o-3*this._sectionPolygonPointsCount]=e[o]-n[o]/this._length*this._diameter;for(o=3*this._sectionPolygonPointsCount;o<n.length;o++)n[o-3*this._sectionPolygonPointsCount]=n[o];var u=e.length-3*this._sectionPolygonPointsCount,f=2*Math.PI/this._sectionPolygonPointsCount;for(o=0;o<this._sectionPolygonPointsCount;o++)this._sectionVectors[o].copyFromFloats(Math.cos(o*f)*this._diameter,Math.sin(o*f)*this._diameter,0),this._sectionNormalVectors[o].copyFromFloats(Math.cos(o*f),Math.sin(o*f),0),d.e.TransformCoordinatesToRef(this._sectionVectors[o],r,this._sectionVectors[o]),d.e.TransformNormalToRef(this._sectionNormalVectors[o],r,this._sectionNormalVectors[o]);for(o=0;o<this._sectionPolygonPointsCount;o++)e[u+3*o]=this._sectionVectors[o].x,e[u+3*o+1]=this._sectionVectors[o].y,e[u+3*o+2]=this._sectionVectors[o].z,n[u+3*o]=this._sectionNormalVectors[o].x,n[u+3*o+1]=this._sectionNormalVectors[o].y,n[u+3*o+2]=this._sectionNormalVectors[o].z;this.updateVerticesData(De.b.PositionKind,e,!0,!1),this.updateVerticesData(De.b.NormalKind,n,!0,!1)}},t.prototype.clone=function(e,n){return e===void 0&&(e=""),new t(e,n===void 0?this._generator:n,this.getScene(),this._diameter,this._length,this._autoStart)},t.prototype.serialize=function(e){i.prototype.serialize.call(this,e)},t.Parse=function(e,n){return new t(e.name,e._generator,n,e._diameter,e._length,e._autoStart)},t}(Ne.a),Xw=c(151),bl=c(98),yl=c(82);Tt.a.CreateDisc=function(i){var t=new Array,e=new Array,n=new Array,r=new Array,o=i.radius||.5,u=i.tessellation||64,f=i.arc&&(i.arc<=0||i.arc>1)?1:i.arc||1,v=i.sideOrientation===0?0:i.sideOrientation||Tt.a.DEFAULTSIDE;t.push(0,0,0),r.push(.5,.5);for(var y=2*Math.PI*f,D=f===1?y/u:y/(u-1),w=0,F=0;F<u;F++){var z=Math.cos(w),k=Math.sin(w),K=(z+1)/2,oe=(1-k)/2;t.push(o*z,o*k,0),r.push(K,oe),w+=D}f===1&&(t.push(t[3],t[4],t[5]),r.push(r[2],r[3]));for(var ae=t.length/3,ue=1;ue<ae-1;ue++)e.push(ue+1,0,ue);Tt.a.ComputeNormals(t,e,n),Tt.a._ComputeSides(v,t,e,n,r,i.frontUVs,i.backUVs);var de=new Tt.a;return de.indices=e,de.positions=t,de.normals=n,de.uvs=r,de},Ne.a.CreateDisc=function(i,t,e,n,r,o){n===void 0&&(n=null);var u={radius:t,tessellation:e,sideOrientation:o,updatable:r};return Fh.CreateDisc(i,u,n)};var Fh=function(){function i(){}return i.CreateDisc=function(t,e,n){n===void 0&&(n=null);var r=new Ne.a(t,n);return e.sideOrientation=Ne.a._GetDefaultSideOrientation(e.sideOrientation),r._originalBuilderSideOrientation=e.sideOrientation,Tt.a.CreateDisc(e).applyToMesh(r,e.updatable),r},i}();Tt.a.CreateTiledBox=function(i){for(var t=i.faceUV||new Array(6),e=i.faceColors,n=i.pattern||Ne.a.NO_FLIP,r=i.width||i.size||1,o=i.height||i.size||1,u=i.depth||i.size||1,f=i.tileWidth||i.tileSize||1,v=i.tileHeight||i.tileSize||1,y=i.alignHorizontal||0,D=i.alignVertical||0,w=i.sideOrientation===0?0:i.sideOrientation||Tt.a.DEFAULTSIDE,F=0;F<6;F++)t[F]===void 0&&(t[F]=new d.f(0,0,1,1)),e&&e[F]===void 0&&(e[F]=new M.b(1,1,1,1));var z=r/2,k=o/2,K=u/2,oe=[];for(F=0;F<2;F++)oe[F]=Tt.a.CreateTiledPlane({pattern:n,tileWidth:f,tileHeight:v,width:r,height:o,alignVertical:D,alignHorizontal:y,sideOrientation:w});for(F=2;F<4;F++)oe[F]=Tt.a.CreateTiledPlane({pattern:n,tileWidth:f,tileHeight:v,width:u,height:o,alignVertical:D,alignHorizontal:y,sideOrientation:w});var ae=D;for(D===Ne.a.BOTTOM?ae=Ne.a.TOP:D===Ne.a.TOP&&(ae=Ne.a.BOTTOM),F=4;F<6;F++)oe[F]=Tt.a.CreateTiledPlane({pattern:n,tileWidth:f,tileHeight:v,width:r,height:u,alignVertical:ae,alignHorizontal:y,sideOrientation:w});var ue=[],de=[],me=[],ye=[],Ee=[],Ae=[],Ie=[],Re=[],Pe=0,Ce=0,Be=0;for(F=0;F<6;F++){Pe=oe[F].positions.length,Ae[F]=[],Ie[F]=[];for(var Oe=0;Oe<Pe/3;Oe++)Ae[F].push(new d.e(oe[F].positions[3*Oe],oe[F].positions[3*Oe+1],oe[F].positions[3*Oe+2])),Ie[F].push(new d.e(oe[F].normals[3*Oe],oe[F].normals[3*Oe+1],oe[F].normals[3*Oe+2]));Ce=oe[F].uvs.length,Re[F]=[];for(var Ve=0;Ve<Ce;Ve+=2)Re[F][Ve]=t[F].x+(t[F].z-t[F].x)*oe[F].uvs[Ve],Re[F][Ve+1]=t[F].y+(t[F].w-t[F].y)*oe[F].uvs[Ve+1];if(me=me.concat(Re[F]),ye=ye.concat(oe[F].indices.map(function(He){return He+Be})),Be+=Ae[F].length,e)for(var Le=0;Le<4;Le++)Ee.push(e[F].r,e[F].g,e[F].b,e[F].a)}var je=new d.e(0,0,K),tt=d.a.RotationY(Math.PI);ue=Ae[0].map(function(He){return d.e.TransformNormal(He,tt).add(je)}).map(function(He){return[He.x,He.y,He.z]}).reduce(function(He,at){return He.concat(at)},[]),de=Ie[0].map(function(He){return d.e.TransformNormal(He,tt)}).map(function(He){return[He.x,He.y,He.z]}).reduce(function(He,at){return He.concat(at)},[]),ue=ue.concat(Ae[1].map(function(He){return He.subtract(je)}).map(function(He){return[He.x,He.y,He.z]}).reduce(function(He,at){return He.concat(at)},[])),de=de.concat(Ie[1].map(function(He){return[He.x,He.y,He.z]}).reduce(function(He,at){return He.concat(at)},[]));var ut=new d.e(z,0,0),ft=d.a.RotationY(-Math.PI/2);ue=ue.concat(Ae[2].map(function(He){return d.e.TransformNormal(He,ft).add(ut)}).map(function(He){return[He.x,He.y,He.z]}).reduce(function(He,at){return He.concat(at)},[])),de=de.concat(Ie[2].map(function(He){return d.e.TransformNormal(He,ft)}).map(function(He){return[He.x,He.y,He.z]}).reduce(function(He,at){return He.concat(at)},[]));var vt=d.a.RotationY(Math.PI/2);ue=ue.concat(Ae[3].map(function(He){return d.e.TransformNormal(He,vt).subtract(ut)}).map(function(He){return[He.x,He.y,He.z]}).reduce(function(He,at){return He.concat(at)},[])),de=de.concat(Ie[3].map(function(He){return d.e.TransformNormal(He,vt)}).map(function(He){return[He.x,He.y,He.z]}).reduce(function(He,at){return He.concat(at)},[]));var rt=new d.e(0,k,0),mt=d.a.RotationX(Math.PI/2);ue=ue.concat(Ae[4].map(function(He){return d.e.TransformNormal(He,mt).add(rt)}).map(function(He){return[He.x,He.y,He.z]}).reduce(function(He,at){return He.concat(at)},[])),de=de.concat(Ie[4].map(function(He){return d.e.TransformNormal(He,mt)}).map(function(He){return[He.x,He.y,He.z]}).reduce(function(He,at){return He.concat(at)},[]));var pt=d.a.RotationX(-Math.PI/2);ue=ue.concat(Ae[5].map(function(He){return d.e.TransformNormal(He,pt).subtract(rt)}).map(function(He){return[He.x,He.y,He.z]}).reduce(function(He,at){return He.concat(at)},[])),de=de.concat(Ie[5].map(function(He){return d.e.TransformNormal(He,pt)}).map(function(He){return[He.x,He.y,He.z]}).reduce(function(He,at){return He.concat(at)},[])),Tt.a._ComputeSides(w,ue,ye,de,me);var it=new Tt.a;if(it.indices=ye,it.positions=ue,it.normals=de,it.uvs=me,e){var yt=w===Tt.a.DOUBLESIDE?Ee.concat(Ee):Ee;it.colors=yt}return it};var tE=function(){function i(){}return i.CreateTiledBox=function(t,e,n){n===void 0&&(n=null);var r=new Ne.a(t,n);return e.sideOrientation=Ne.a._GetDefaultSideOrientation(e.sideOrientation),r._originalBuilderSideOrientation=e.sideOrientation,Tt.a.CreateTiledBox(e).applyToMesh(r,e.updatable),r},i}();Tt.a.CreateTorusKnot=function(i){var t,e,n=new Array,r=new Array,o=new Array,u=new Array,f=i.radius||2,v=i.tube||.5,y=i.radialSegments||32,D=i.tubularSegments||32,w=i.p||2,F=i.q||3,z=i.sideOrientation===0?0:i.sideOrientation||Tt.a.DEFAULTSIDE,k=function(Ve){var Le=Math.cos(Ve),je=Math.sin(Ve),tt=F/w*Ve,ut=Math.cos(tt),ft=f*(2+ut)*.5*Le,vt=f*(2+ut)*je*.5,rt=f*Math.sin(tt)*.5;return new d.e(ft,vt,rt)};for(t=0;t<=y;t++){var K=t%y/y*2*w*Math.PI,oe=k(K),ae=k(K+.01),ue=ae.subtract(oe),de=ae.add(oe),me=d.e.Cross(ue,de);for(de=d.e.Cross(me,ue),me.normalize(),de.normalize(),e=0;e<D;e++){var ye=e%D/D*2*Math.PI,Ee=-v*Math.cos(ye),Ae=v*Math.sin(ye);r.push(oe.x+Ee*de.x+Ae*me.x),r.push(oe.y+Ee*de.y+Ae*me.y),r.push(oe.z+Ee*de.z+Ae*me.z),u.push(t/y),u.push(e/D)}}for(t=0;t<y;t++)for(e=0;e<D;e++){var Ie=(e+1)%D,Re=t*D+e,Pe=(t+1)*D+e,Ce=(t+1)*D+Ie,Be=t*D+Ie;n.push(Be),n.push(Pe),n.push(Re),n.push(Be),n.push(Ce),n.push(Pe)}Tt.a.ComputeNormals(r,n,o),Tt.a._ComputeSides(z,r,n,o,u,i.frontUVs,i.backUVs);var Oe=new Tt.a;return Oe.indices=n,Oe.positions=r,Oe.normals=o,Oe.uvs=u,Oe},Ne.a.CreateTorusKnot=function(i,t,e,n,r,o,u,f,v,y){var D={radius:t,tube:e,radialSegments:n,tubularSegments:r,p:o,q:u,sideOrientation:y,updatable:v};return km.CreateTorusKnot(i,D,f)};var km=function(){function i(){}return i.CreateTorusKnot=function(t,e,n){var r=new Ne.a(t,n);return e.sideOrientation=Ne.a._GetDefaultSideOrientation(e.sideOrientation),r._originalBuilderSideOrientation=e.sideOrientation,Tt.a.CreateTorusKnot(e).applyToMesh(r,e.updatable),r},i}(),Yw=function(i){function t(e,n){var r=i.call(this,e.x,e.y)||this;return r.index=n,r}return Object(p.d)(t,i),t}(d.d),jm=function(){function i(){this.elements=new Array}return i.prototype.add=function(t){var e=this,n=new Array;return t.forEach(function(r){var o=new Yw(r,e.elements.length);n.push(o),e.elements.push(o)}),n},i.prototype.computeBounds=function(){var t=new d.d(this.elements[0].x,this.elements[0].y),e=new d.d(this.elements[0].x,this.elements[0].y);return this.elements.forEach(function(n){n.x<t.x?t.x=n.x:n.x>e.x&&(e.x=n.x),n.y<t.y?t.y=n.y:n.y>e.y&&(e.y=n.y)}),{min:t,max:e,width:e.x-t.x,height:e.y-t.y}},i}(),Kw=function(){function i(){}return i.Rectangle=function(t,e,n,r){return[new d.d(t,e),new d.d(n,e),new d.d(n,r),new d.d(t,r)]},i.Circle=function(t,e,n,r){e===void 0&&(e=0),n===void 0&&(n=0),r===void 0&&(r=32);for(var o=new Array,u=0,f=2*Math.PI/r,v=0;v<r;v++)o.push(new d.d(e+Math.cos(u)*t,n+Math.sin(u)*t)),u-=f;return o},i.Parse=function(t){var e,n=t.split(/[^-+eE\.\d]+/).map(parseFloat).filter(function(o){return!isNaN(o)}),r=[];for(e=0;e<(2147483646&n.length);e+=2)r.push(new d.d(n[e],n[e+1]));return r},i.StartingAt=function(t,e){return nt.f.StartingAt(t,e)},i}(),nE=function(){function i(t,e,n,r){var o;r===void 0&&(r=earcut),this._points=new jm,this._outlinepoints=new jm,this._holes=new Array,this._epoints=new Array,this._eholes=new Array,this.bjsEarcut=r,this._name=t,this._scene=n||Ge.a.LastCreatedScene,o=e instanceof nt.f?e.getPoints():e,this._addToepoint(o),this._points.add(o),this._outlinepoints.add(o),this.bjsEarcut===void 0&&_.a.Warn("Earcut was not found, the polygon will not be built.")}return i.prototype._addToepoint=function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];this._epoints.push(r.x,r.y)}},i.prototype.addHole=function(t){this._points.add(t);var e=new jm;return e.add(t),this._holes.push(e),this._eholes.push(this._epoints.length/2),this._addToepoint(t),this},i.prototype.build=function(t,e){t===void 0&&(t=!1),e===void 0&&(e=0);var n=new Ne.a(this._name,this._scene),r=this.buildVertexData(e);return n.setVerticesData(De.b.PositionKind,r.positions,t),n.setVerticesData(De.b.NormalKind,r.normals,t),n.setVerticesData(De.b.UVKind,r.uvs,t),n.setIndices(r.indices),n},i.prototype.buildVertexData=function(t){var e=this;t===void 0&&(t=0);var n=new Tt.a,r=new Array,o=new Array,u=new Array,f=this._points.computeBounds();this._points.elements.forEach(function(oe){r.push(0,1,0),o.push(oe.x,0,oe.y),u.push((oe.x-f.min.x)/f.width,(oe.y-f.min.y)/f.height)});for(var v=new Array,y=this.bjsEarcut(this._epoints,this._eholes,2),D=0;D<y.length;D++)v.push(y[D]);if(t>0){var w=o.length/3;this._points.elements.forEach(function(oe){r.push(0,-1,0),o.push(oe.x,-t,oe.y),u.push(1-(oe.x-f.min.x)/f.width,1-(oe.y-f.min.y)/f.height)});var F=v.length;for(D=0;D<F;D+=3){var z=v[D+0],k=v[D+1],K=v[D+2];v.push(K+w),v.push(k+w),v.push(z+w)}this.addSide(o,r,u,v,f,this._outlinepoints,t,!1),this._holes.forEach(function(oe){e.addSide(o,r,u,v,f,oe,t,!0)})}return n.indices=v,n.positions=o,n.normals=r,n.uvs=u,n},i.prototype.addSide=function(t,e,n,r,o,u,f,v){for(var y=t.length/3,D=0,w=0;w<u.elements.length;w++){var F,z=u.elements[w];F=w+1>u.elements.length-1?u.elements[0]:u.elements[w+1],t.push(z.x,0,z.y),t.push(z.x,-f,z.y),t.push(F.x,0,F.y),t.push(F.x,-f,F.y);var k=new d.e(z.x,0,z.y),K=new d.e(F.x,0,F.y).subtract(k),oe=new d.e(0,1,0),ae=d.e.Cross(K,oe);ae=ae.normalize(),n.push(D/o.width,0),n.push(D/o.width,1),D+=K.length(),n.push(D/o.width,0),n.push(D/o.width,1),v?(e.push(ae.x,ae.y,ae.z),e.push(ae.x,ae.y,ae.z),e.push(ae.x,ae.y,ae.z),e.push(ae.x,ae.y,ae.z),r.push(y),r.push(y+2),r.push(y+1),r.push(y+1),r.push(y+2),r.push(y+3)):(e.push(-ae.x,-ae.y,-ae.z),e.push(-ae.x,-ae.y,-ae.z),e.push(-ae.x,-ae.y,-ae.z),e.push(-ae.x,-ae.y,-ae.z),r.push(y),r.push(y+1),r.push(y+2),r.push(y+1),r.push(y+3),r.push(y+2)),y+=4}},i}();Tt.a.CreatePolygon=function(i,t,e,n,r,o,u){for(var f=e||new Array(3),v=n,y=[],D=u||!1,w=0;w<3;w++)f[w]===void 0&&(f[w]=new d.f(0,0,1,1)),v&&v[w]===void 0&&(v[w]=new M.b(1,1,1,1));var F=i.getVerticesData(De.b.PositionKind),z=i.getVerticesData(De.b.NormalKind),k=i.getVerticesData(De.b.UVKind),K=i.getIndices(),oe=F.length/9,ae=0,ue=0,de=0,me=0,ye=[0];if(D)for(var Ee=oe;Ee<F.length/3;Ee+=4)ue=F[3*(Ee+2)]-F[3*Ee],de=F[3*(Ee+2)+2]-F[3*Ee+2],me+=Math.sqrt(ue*ue+de*de),ye.push(me);Ee=0;for(var Ae=0,Ie=0;Ie<z.length;Ie+=3)Math.abs(z[Ie+1])<.001&&(Ae=1),Math.abs(z[Ie+1]-1)<.001&&(Ae=0),Math.abs(z[Ie+1]+1)<.001&&(Ae=2),Ee=Ie/3,Ae===1?(ae=Ee-oe,k[2*Ee]=ae%4<1.5?D?f[Ae].x+(f[Ae].z-f[Ae].x)*ye[Math.floor(ae/4)]/me:f[Ae].x:D?f[Ae].x+(f[Ae].z-f[Ae].x)*ye[Math.floor(ae/4)+1]/me:f[Ae].z,k[2*Ee+1]=ae%2==0?f[Ae].w:f[Ae].y):(k[2*Ee]=(1-k[2*Ee])*f[Ae].x+k[2*Ee]*f[Ae].z,k[2*Ee+1]=(1-k[2*Ee+1])*f[Ae].y+k[2*Ee+1]*f[Ae].w),v&&y.push(v[Ae].r,v[Ae].g,v[Ae].b,v[Ae].a);Tt.a._ComputeSides(t,F,K,z,k,r,o);var Re=new Tt.a;if(Re.indices=K,Re.positions=F,Re.normals=z,Re.uvs=k,v){var Pe=t===Tt.a.DOUBLESIDE?y.concat(y):y;Re.colors=Pe}return Re},Ne.a.CreatePolygon=function(i,t,e,n,r,o,u){u===void 0&&(u=earcut);var f={shape:t,holes:n,updatable:r,sideOrientation:o};return Tl.CreatePolygon(i,f,e,u)},Ne.a.ExtrudePolygon=function(i,t,e,n,r,o,u,f){f===void 0&&(f=earcut);var v={shape:t,holes:r,depth:e,updatable:o,sideOrientation:u};return Tl.ExtrudePolygon(i,v,n,f)};var Tl=function(){function i(){}return i.CreatePolygon=function(t,e,n,r){n===void 0&&(n=null),r===void 0&&(r=earcut),e.sideOrientation=Ne.a._GetDefaultSideOrientation(e.sideOrientation);for(var o=e.shape,u=e.holes||[],f=e.depth||0,v=[],y=[],D=0;D<o.length;D++)v[D]=new d.d(o[D].x,o[D].z);v[0].equalsWithEpsilon(v[v.length-1],1e-8)&&v.pop();for(var w=new nE(t,v,n||ne.a.LastCreatedScene,r),F=0;F<u.length;F++){y=[];for(var z=0;z<u[F].length;z++)y.push(new d.d(u[F][z].x,u[F][z].z));w.addHole(y)}var k=w.build(e.updatable,f);return k._originalBuilderSideOrientation=e.sideOrientation,Tt.a.CreatePolygon(k,e.sideOrientation,e.faceUV,e.faceColors,e.frontUVs,e.backUVs,e.wrap).applyToMesh(k,e.updatable),k},i.ExtrudePolygon=function(t,e,n,r){return n===void 0&&(n=null),r===void 0&&(r=earcut),i.CreatePolygon(t,e,n,r)},i}();Ne.a.CreateLathe=function(i,t,e,n,r,o,u){var f={shape:t,radius:e,tessellation:n,sideOrientation:u,updatable:o};return zm.CreateLathe(i,f,r)};var zm=function(){function i(){}return i.CreateLathe=function(t,e,n){n===void 0&&(n=null);var r,o=e.arc?e.arc<=0||e.arc>1?1:e.arc:1,u=e.closed===void 0||e.closed,f=e.shape,v=e.radius||1,y=e.tessellation||64,D=e.clip||0,w=e.updatable,F=Ne.a._GetDefaultSideOrientation(e.sideOrientation),z=e.cap||Ne.a.NO_CAP,k=2*Math.PI,K=new Array,oe=e.invertUV||!1,ae=0,ue=0,de=k/y*o,me=new Array;for(ae=0;ae<=y-D;ae++){for(me=[],z!=Ne.a.CAP_START&&z!=Ne.a.CAP_ALL||(me.push(new d.e(0,f[0].y,0)),me.push(new d.e(Math.cos(ae*de)*f[0].x*v,f[0].y,Math.sin(ae*de)*f[0].x*v))),ue=0;ue<f.length;ue++)r=new d.e(Math.cos(ae*de)*f[ue].x*v,f[ue].y,Math.sin(ae*de)*f[ue].x*v),me.push(r);z!=Ne.a.CAP_END&&z!=Ne.a.CAP_ALL||(me.push(new d.e(Math.cos(ae*de)*f[f.length-1].x*v,f[f.length-1].y,Math.sin(ae*de)*f[f.length-1].x*v)),me.push(new d.e(0,f[f.length-1].y,0))),K.push(me)}return yl.a.CreateRibbon(t,{pathArray:K,closeArray:u,sideOrientation:F,updatable:w,invertUV:oe,frontUVs:e.frontUVs,backUVs:e.backUVs},n)},i}();Tt.a.CreateTiledPlane=function(i){var t=i.pattern||Ne.a.NO_FLIP,e=i.tileWidth||i.tileSize||1,n=i.tileHeight||i.tileSize||1,r=i.alignHorizontal||0,o=i.alignVertical||0,u=i.width||i.size||1,f=Math.floor(u/e),v=u-f*e,y=i.height||i.size||1,D=Math.floor(y/n),w=y-D*n,F=e*f/2,z=n*D/2,k=0,K=0,oe=0,ae=0,ue=0,de=0;if(v>0||w>0){switch(oe=-F,ae=-z,ue=F,de=z,r){case Ne.a.CENTER:oe-=v/=2,ue+=v;break;case Ne.a.LEFT:ue+=v,k=-v/2;break;case Ne.a.RIGHT:oe-=v,k=v/2}switch(o){case Ne.a.CENTER:ae-=w/=2,de+=w;break;case Ne.a.BOTTOM:de+=w,K=-w/2;break;case Ne.a.TOP:ae-=w,K=w/2}}var me=[],ye=[],Ee=[];Ee[0]=[0,0,1,0,1,1,0,1],Ee[1]=[0,0,1,0,1,1,0,1],t!==Ne.a.ROTATE_TILE&&t!==Ne.a.ROTATE_ROW||(Ee[1]=[1,1,0,1,0,0,1,0]),t!==Ne.a.FLIP_TILE&&t!==Ne.a.FLIP_ROW||(Ee[1]=[1,0,0,0,0,1,1,1]),t!==Ne.a.FLIP_N_ROTATE_TILE&&t!==Ne.a.FLIP_N_ROTATE_ROW||(Ee[1]=[0,1,1,1,1,0,0,0]);for(var Ae=[],Ie=[],Re=[],Pe=0,Ce=0;Ce<D;Ce++)for(var Be=0;Be<f;Be++)me.push(Be*e-F+k,Ce*n-z+K,0),me.push((Be+1)*e-F+k,Ce*n-z+K,0),me.push((Be+1)*e-F+k,(Ce+1)*n-z+K,0),me.push(Be*e-F+k,(Ce+1)*n-z+K,0),Re.push(Pe,Pe+1,Pe+3,Pe+1,Pe+2,Pe+3),Ae=t===Ne.a.FLIP_TILE||t===Ne.a.ROTATE_TILE||t===Ne.a.FLIP_N_ROTATE_TILE?Ae.concat(Ee[(Be%2+Ce%2)%2]):t===Ne.a.FLIP_ROW||t===Ne.a.ROTATE_ROW||t===Ne.a.FLIP_N_ROTATE_ROW?Ae.concat(Ee[Ce%2]):Ae.concat(Ee[0]),Ie.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),ye.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),Pe+=4;if(v>0||w>0){var Oe,Ve,Le,je,tt=w>0&&(o===Ne.a.CENTER||o===Ne.a.TOP),ut=w>0&&(o===Ne.a.CENTER||o===Ne.a.BOTTOM),ft=v>0&&(r===Ne.a.CENTER||r===Ne.a.RIGHT),vt=v>0&&(r===Ne.a.CENTER||r===Ne.a.LEFT),rt=[];if(tt&&ft&&(me.push(oe+k,ae+K,0),me.push(-F+k,ae+K,0),me.push(-F+k,ae+w+K,0),me.push(oe+k,ae+w+K,0),Re.push(Pe,Pe+1,Pe+3,Pe+1,Pe+2,Pe+3),Pe+=4,rt=[Oe=1-v/e,Ve=1-w/n,Le=1,Ve,Le,je=1,Oe,je],t===Ne.a.ROTATE_ROW&&(rt=[1-Oe,1-Ve,1-Le,1-Ve,1-Le,1-je,1-Oe,1-je]),t===Ne.a.FLIP_ROW&&(rt=[1-Oe,Ve,1-Le,Ve,1-Le,je,1-Oe,je]),t===Ne.a.FLIP_N_ROTATE_ROW&&(rt=[Oe,1-Ve,Le,1-Ve,Le,1-je,Oe,1-je]),Ae=Ae.concat(rt),Ie.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),ye.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),tt&&vt&&(me.push(F+k,ae+K,0),me.push(ue+k,ae+K,0),me.push(ue+k,ae+w+K,0),me.push(F+k,ae+w+K,0),Re.push(Pe,Pe+1,Pe+3,Pe+1,Pe+2,Pe+3),Pe+=4,rt=[Oe=0,Ve=1-w/n,Le=v/e,Ve,Le,je=1,Oe,je],(t===Ne.a.ROTATE_ROW||t===Ne.a.ROTATE_TILE&&f%2==0)&&(rt=[1-Oe,1-Ve,1-Le,1-Ve,1-Le,1-je,1-Oe,1-je]),(t===Ne.a.FLIP_ROW||t===Ne.a.FLIP_TILE&&f%2==0)&&(rt=[1-Oe,Ve,1-Le,Ve,1-Le,je,1-Oe,je]),(t===Ne.a.FLIP_N_ROTATE_ROW||t===Ne.a.FLIP_N_ROTATE_TILE&&f%2==0)&&(rt=[Oe,1-Ve,Le,1-Ve,Le,1-je,Oe,1-je]),Ae=Ae.concat(rt),Ie.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),ye.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),ut&&ft&&(me.push(oe+k,z+K,0),me.push(-F+k,z+K,0),me.push(-F+k,de+K,0),me.push(oe+k,de+K,0),Re.push(Pe,Pe+1,Pe+3,Pe+1,Pe+2,Pe+3),Pe+=4,rt=[Oe=1-v/e,Ve=0,Le=1,Ve,Le,je=w/n,Oe,je],(t===Ne.a.ROTATE_ROW&&D%2==1||t===Ne.a.ROTATE_TILE&&D%1==0)&&(rt=[1-Oe,1-Ve,1-Le,1-Ve,1-Le,1-je,1-Oe,1-je]),(t===Ne.a.FLIP_ROW&&D%2==1||t===Ne.a.FLIP_TILE&&D%2==0)&&(rt=[1-Oe,Ve,1-Le,Ve,1-Le,je,1-Oe,je]),(t===Ne.a.FLIP_N_ROTATE_ROW&&D%2==1||t===Ne.a.FLIP_N_ROTATE_TILE&&D%2==0)&&(rt=[Oe,1-Ve,Le,1-Ve,Le,1-je,Oe,1-je]),Ae=Ae.concat(rt),Ie.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),ye.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),ut&&vt&&(me.push(F+k,z+K,0),me.push(ue+k,z+K,0),me.push(ue+k,de+K,0),me.push(F+k,de+K,0),Re.push(Pe,Pe+1,Pe+3,Pe+1,Pe+2,Pe+3),Pe+=4,rt=[Oe=0,Ve=0,Le=v/e,Ve,Le,je=w/n,Oe,je],(t===Ne.a.ROTATE_ROW&&D%2==1||t===Ne.a.ROTATE_TILE&&(D+f)%2==1)&&(rt=[1-Oe,1-Ve,1-Le,1-Ve,1-Le,1-je,1-Oe,1-je]),(t===Ne.a.FLIP_ROW&&D%2==1||t===Ne.a.FLIP_TILE&&(D+f)%2==1)&&(rt=[1-Oe,Ve,1-Le,Ve,1-Le,je,1-Oe,je]),(t===Ne.a.FLIP_N_ROTATE_ROW&&D%2==1||t===Ne.a.FLIP_N_ROTATE_TILE&&(D+f)%2==1)&&(rt=[Oe,1-Ve,Le,1-Ve,Le,1-je,Oe,1-je]),Ae=Ae.concat(rt),Ie.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),ye.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),tt){var mt=[];for(Oe=0,Ve=1-w/n,Le=1,je=1,mt[0]=[Oe,Ve,Le,Ve,Le,je,Oe,je],mt[1]=[Oe,Ve,Le,Ve,Le,je,Oe,je],t!==Ne.a.ROTATE_TILE&&t!==Ne.a.ROTATE_ROW||(mt[1]=[1-Oe,1-Ve,1-Le,1-Ve,1-Le,1-je,1-Oe,1-je]),t!==Ne.a.FLIP_TILE&&t!==Ne.a.FLIP_ROW||(mt[1]=[1-Oe,Ve,1-Le,Ve,1-Le,je,1-Oe,je]),t!==Ne.a.FLIP_N_ROTATE_TILE&&t!==Ne.a.FLIP_N_ROTATE_ROW||(mt[1]=[Oe,1-Ve,Le,1-Ve,Le,1-je,Oe,1-je]),Be=0;Be<f;Be++)me.push(Be*e-F+k,ae+K,0),me.push((Be+1)*e-F+k,ae+K,0),me.push((Be+1)*e-F+k,ae+w+K,0),me.push(Be*e-F+k,ae+w+K,0),Re.push(Pe,Pe+1,Pe+3,Pe+1,Pe+2,Pe+3),Pe+=4,Ae=t===Ne.a.FLIP_TILE||t===Ne.a.ROTATE_TILE||t===Ne.a.FLIP_N_ROTATE_TILE?Ae.concat(mt[(Be+1)%2]):t===Ne.a.FLIP_ROW||t===Ne.a.ROTATE_ROW||t===Ne.a.FLIP_N_ROTATE_ROW?Ae.concat(mt[1]):Ae.concat(mt[0]),Ie.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),ye.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(ut){var pt=[];for(Oe=0,Ve=0,Le=1,je=w/n,pt[0]=[Oe,Ve,Le,Ve,Le,je,Oe,je],pt[1]=[Oe,Ve,Le,Ve,Le,je,Oe,je],t!==Ne.a.ROTATE_TILE&&t!==Ne.a.ROTATE_ROW||(pt[1]=[1-Oe,1-Ve,1-Le,1-Ve,1-Le,1-je,1-Oe,1-je]),t!==Ne.a.FLIP_TILE&&t!==Ne.a.FLIP_ROW||(pt[1]=[1-Oe,Ve,1-Le,Ve,1-Le,je,1-Oe,je]),t!==Ne.a.FLIP_N_ROTATE_TILE&&t!==Ne.a.FLIP_N_ROTATE_ROW||(pt[1]=[Oe,1-Ve,Le,1-Ve,Le,1-je,Oe,1-je]),Be=0;Be<f;Be++)me.push(Be*e-F+k,de-w+K,0),me.push((Be+1)*e-F+k,de-w+K,0),me.push((Be+1)*e-F+k,de+K,0),me.push(Be*e-F+k,de+K,0),Re.push(Pe,Pe+1,Pe+3,Pe+1,Pe+2,Pe+3),Pe+=4,Ae=t===Ne.a.FLIP_TILE||t===Ne.a.ROTATE_TILE||t===Ne.a.FLIP_N_ROTATE_TILE?Ae.concat(pt[(Be+D)%2]):t===Ne.a.FLIP_ROW||t===Ne.a.ROTATE_ROW||t===Ne.a.FLIP_N_ROTATE_ROW?Ae.concat(pt[D%2]):Ae.concat(pt[0]),Ie.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),ye.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(ft){var it=[];for(Oe=1-v/e,Ve=0,Le=1,je=1,it[0]=[Oe,Ve,Le,Ve,Le,je,Oe,je],it[1]=[Oe,Ve,Le,Ve,Le,je,Oe,je],t!==Ne.a.ROTATE_TILE&&t!==Ne.a.ROTATE_ROW||(it[1]=[1-Oe,1-Ve,1-Le,1-Ve,1-Le,1-je,1-Oe,1-je]),t!==Ne.a.FLIP_TILE&&t!==Ne.a.FLIP_ROW||(it[1]=[1-Oe,Ve,1-Le,Ve,1-Le,je,1-Oe,je]),t!==Ne.a.FLIP_N_ROTATE_TILE&&t!==Ne.a.FLIP_N_ROTATE_ROW||(it[1]=[Oe,1-Ve,Le,1-Ve,Le,1-je,Oe,1-je]),Ce=0;Ce<D;Ce++)me.push(oe+k,Ce*n-z+K,0),me.push(oe+v+k,Ce*n-z+K,0),me.push(oe+v+k,(Ce+1)*n-z+K,0),me.push(oe+k,(Ce+1)*n-z+K,0),Re.push(Pe,Pe+1,Pe+3,Pe+1,Pe+2,Pe+3),Pe+=4,Ae=t===Ne.a.FLIP_TILE||t===Ne.a.ROTATE_TILE||t===Ne.a.FLIP_N_ROTATE_TILE?Ae.concat(it[(Ce+1)%2]):t===Ne.a.FLIP_ROW||t===Ne.a.ROTATE_ROW||t===Ne.a.FLIP_N_ROTATE_ROW?Ae.concat(it[Ce%2]):Ae.concat(it[0]),Ie.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),ye.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(vt){var yt=[];for(Oe=0,Ve=0,Le=v/n,je=1,yt[0]=[Oe,Ve,Le,Ve,Le,je,Oe,je],yt[1]=[Oe,Ve,Le,Ve,Le,je,Oe,je],t!==Ne.a.ROTATE_TILE&&t!==Ne.a.ROTATE_ROW||(yt[1]=[1-Oe,1-Ve,1-Le,1-Ve,1-Le,1-je,1-Oe,1-je]),t!==Ne.a.FLIP_TILE&&t!==Ne.a.FLIP_ROW||(yt[1]=[1-Oe,Ve,1-Le,Ve,1-Le,je,1-Oe,je]),t!==Ne.a.FLIP_N_ROTATE_TILE&&t!==Ne.a.FLIP_N_ROTATE_ROW||(yt[1]=[Oe,1-Ve,Le,1-Ve,Le,1-je,Oe,1-je]),Ce=0;Ce<D;Ce++)me.push(ue-v+k,Ce*n-z+K,0),me.push(ue+k,Ce*n-z+K,0),me.push(ue+k,(Ce+1)*n-z+K,0),me.push(ue-v+k,(Ce+1)*n-z+K,0),Re.push(Pe,Pe+1,Pe+3,Pe+1,Pe+2,Pe+3),Pe+=4,Ae=t===Ne.a.FLIP_TILE||t===Ne.a.ROTATE_TILE||t===Ne.a.FLIP_N_ROTATE_TILE?Ae.concat(yt[(Ce+f)%2]):t===Ne.a.FLIP_ROW||t===Ne.a.ROTATE_ROW||t===Ne.a.FLIP_N_ROTATE_ROW?Ae.concat(yt[Ce%2]):Ae.concat(yt[0]),Ie.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),ye.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}var He=i.sideOrientation===0?0:i.sideOrientation||Tt.a.DEFAULTSIDE;Tt.a._ComputeSides(He,me,Re,ye,Ae,i.frontUVs,i.backUVs);var at=new Tt.a;at.indices=Re,at.positions=me,at.normals=ye,at.uvs=Ae;var It=He===Tt.a.DOUBLESIDE?Ie.concat(Ie):Ie;return at.colors=It,at};var rE=function(){function i(){}return i.CreateTiledPlane=function(t,e,n){n===void 0&&(n=null);var r=new Ne.a(t,n);return e.sideOrientation=Ne.a._GetDefaultSideOrientation(e.sideOrientation),r._originalBuilderSideOrientation=e.sideOrientation,Tt.a.CreateTiledPlane(e).applyToMesh(r,e.updatable),r},i}();Ne.a.CreateTube=function(i,t,e,n,r,o,u,f,v,y){var D={path:t,radius:e,tessellation:n,radiusFunction:r,arc:1,cap:o,updatable:f,sideOrientation:v,instance:y};return Gm.CreateTube(i,D,u)};var Gm=function(){function i(){}return i.CreateTube=function(t,e,n){n===void 0&&(n=null);var r=e.path,o=e.instance,u=1;e.radius!==void 0?u=e.radius:o&&(u=o._creationDataStorage.radius);var f=e.tessellation||64,v=e.radiusFunction||null,y=e.cap||Ne.a.NO_CAP,D=e.invertUV||!1,w=e.updatable,F=Ne.a._GetDefaultSideOrientation(e.sideOrientation);e.arc=e.arc&&(e.arc<=0||e.arc>1)?1:e.arc||1;var z,k,K=function(de,me,ye,Ee,Ae,Ie,Re,Pe){for(var Ce,Be,Oe,Ve,Le=me.getTangents(),je=me.getNormals(),tt=me.getDistances(),ut=2*Math.PI/Ae*Pe,ft=Ie||function(){return Ee},vt=d.c.Matrix[0],rt=Re===Ne.a.NO_CAP||Re===Ne.a.CAP_END?0:2,mt=0;mt<de.length;mt++){Be=ft(mt,tt[mt]),Ce=Array(),Oe=je[mt];for(var pt=0;pt<Ae;pt++)d.a.RotationAxisToRef(Le[mt],ut*pt,vt),Ve=Ce[pt]?Ce[pt]:d.e.Zero(),d.e.TransformCoordinatesToRef(Oe,vt,Ve),Ve.scaleInPlace(Be).addInPlace(de[mt]),Ce[pt]=Ve;ye[rt]=Ce,rt++}var it=function(yt,He){for(var at=Array(),It=0;It<yt;It++)at.push(de[He]);return at};switch(Re){case Ne.a.NO_CAP:break;case Ne.a.CAP_START:ye[0]=it(Ae,0),ye[1]=ye[2].slice(0);break;case Ne.a.CAP_END:ye[rt]=ye[rt-1].slice(0),ye[rt+1]=it(Ae,de.length-1);break;case Ne.a.CAP_ALL:ye[0]=it(Ae,0),ye[1]=ye[2].slice(0),ye[rt]=ye[rt-1].slice(0),ye[rt+1]=it(Ae,de.length-1)}return ye};if(o){var oe=o._creationDataStorage,ae=e.arc||oe.arc;return k=K(r,z=oe.path3D.update(r),oe.pathArray,u,oe.tessellation,v,oe.cap,ae),o=yl.a.CreateRibbon("",{pathArray:k,instance:o}),oe.path3D=z,oe.pathArray=k,oe.arc=ae,oe.radius=u,o}k=K(r,z=new nt.g(r),new Array,u,f,v,y=y<0||y>3?0:y,e.arc);var ue=yl.a.CreateRibbon(t,{pathArray:k,closePath:!0,closeArray:!1,updatable:w,sideOrientation:F,invertUV:D,frontUVs:e.frontUVs,backUVs:e.backUVs},n);return ue._creationDataStorage.pathArray=k,ue._creationDataStorage.path3D=z,ue._creationDataStorage.tessellation=f,ue._creationDataStorage.cap=y,ue._creationDataStorage.arc=e.arc,ue._creationDataStorage.radius=u,ue},i}();Tt.a.CreateIcoSphere=function(i){var t,e=i.sideOrientation||Tt.a.DEFAULTSIDE,n=i.radius||1,r=i.flat===void 0||i.flat,o=i.subdivisions||4,u=i.radiusX||n,f=i.radiusY||n,v=i.radiusZ||n,y=(1+Math.sqrt(5))/2,D=[-1,y,-0,1,y,0,-1,-y,0,1,-y,0,0,-1,-y,0,1,-y,0,-1,y,0,1,y,y,0,1,y,0,-1,-y,0,1,-y,0,-1],w=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],F=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],z=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],k=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],K=new Array,oe=new Array,ae=new Array,ue=new Array,de=0,me=new Array(3),ye=new Array(3);for(t=0;t<3;t++)me[t]=d.e.Zero(),ye[t]=d.d.Zero();for(var Ee=0;Ee<20;Ee++){for(t=0;t<3;t++){var Ae=w[3*Ee+t];me[t].copyFromFloats(D[3*F[Ae]],D[3*F[Ae]+1],D[3*F[Ae]+2]),me[t].normalize().scaleInPlace(n),ye[t].copyFromFloats(z[2*Ae]*(138/1024)+60/1024+k[Ee]*(-40/1024),z[2*Ae+1]*(239/1024)+26/1024+k[Ee]*(20/1024))}for(var Ie=function(Be,Oe,Ve,Le){var je,tt=d.e.Lerp(me[0],me[2],Oe/o),ut=d.e.Lerp(me[1],me[2],Oe/o),ft=o===Oe?me[2]:d.e.Lerp(tt,ut,Be/(o-Oe));if(ft.normalize(),r){var vt=d.e.Lerp(me[0],me[2],Le/o),rt=d.e.Lerp(me[1],me[2],Le/o);je=d.e.Lerp(vt,rt,Ve/(o-Le))}else je=new d.e(ft.x,ft.y,ft.z);je.x/=u,je.y/=f,je.z/=v,je.normalize();var mt=d.d.Lerp(ye[0],ye[2],Oe/o),pt=d.d.Lerp(ye[1],ye[2],Oe/o),it=o===Oe?ye[2]:d.d.Lerp(mt,pt,Be/(o-Oe));oe.push(ft.x*u,ft.y*f,ft.z*v),ae.push(je.x,je.y,je.z),ue.push(it.x,it.y),K.push(de),de++},Re=0;Re<o;Re++)for(var Pe=0;Pe+Re<o;Pe++)Ie(Pe,Re,Pe+1/3,Re+1/3),Ie(Pe+1,Re,Pe+1/3,Re+1/3),Ie(Pe,Re+1,Pe+1/3,Re+1/3),Pe+Re+1<o&&(Ie(Pe+1,Re,Pe+2/3,Re+2/3),Ie(Pe+1,Re+1,Pe+2/3,Re+2/3),Ie(Pe,Re+1,Pe+2/3,Re+2/3))}Tt.a._ComputeSides(e,oe,K,ae,ue,i.frontUVs,i.backUVs);var Ce=new Tt.a;return Ce.indices=K,Ce.positions=oe,Ce.normals=ae,Ce.uvs=ue,Ce},Ne.a.CreateIcoSphere=function(i,t,e){return Hm.CreateIcoSphere(i,t,e)};var Hm=function(){function i(){}return i.CreateIcoSphere=function(t,e,n){n===void 0&&(n=null);var r=new Ne.a(t,n);return e.sideOrientation=Ne.a._GetDefaultSideOrientation(e.sideOrientation),r._originalBuilderSideOrientation=e.sideOrientation,Tt.a.CreateIcoSphere(e).applyToMesh(r,e.updatable),r},i}();Ne.a.CreateDecal=function(i,t,e,n,r,o){var u={position:e,normal:n,size:r,angle:o};return Wm.CreateDecal(i,t,u)};var Wm=function(){function i(){}return i.CreateDecal=function(t,e,n){var r=e.getIndices(),o=e.getVerticesData(De.b.PositionKind),u=e.getVerticesData(De.b.NormalKind),f=n.position||d.e.Zero(),v=n.normal||d.e.Up(),y=n.size||d.e.One(),D=n.angle||0;if(!v){var w=new d.e(0,0,1),F=e.getScene().activeCamera,z=d.e.TransformCoordinates(w,F.getWorldMatrix());v=F.globalPosition.subtract(z)}var k=-Math.atan2(v.z,v.x)-Math.PI/2,K=Math.sqrt(v.x*v.x+v.z*v.z),oe=Math.atan2(v.y,K),ae=d.a.RotationYawPitchRoll(k,oe,D).multiply(d.a.Translation(f.x,f.y,f.z)),ue=d.a.Invert(ae),de=e.getWorldMatrix().multiply(ue),me=new Tt.a;me.indices=[],me.positions=[],me.normals=[],me.uvs=[];for(var ye=0,Ee=function(Oe){var Ve=new qp;if(!r||!o||!u)return Ve;var Le=r[Oe];return Ve.position=new d.e(o[3*Le],o[3*Le+1],o[3*Le+2]),Ve.position=d.e.TransformCoordinates(Ve.position,de),Ve.normal=new d.e(u[3*Le],u[3*Le+1],u[3*Le+2]),Ve.normal=d.e.TransformNormal(Ve.normal,de),Ve},Ae=function(Oe,Ve){if(Oe.length===0)return Oe;for(var Le=.5*Math.abs(d.e.Dot(y,Ve)),je=function(He,at){var It=d.e.GetClipFactor(He.position,at.position,Ve,Le);return new qp(d.e.Lerp(He.position,at.position,It),d.e.Lerp(He.normal,at.normal,It))},tt=new Array,ut=0;ut<Oe.length;ut+=3){var ft,vt,rt,mt=null,pt=null,it=null,yt=null;switch(((ft=d.e.Dot(Oe[ut].position,Ve)-Le>0)?1:0)+((vt=d.e.Dot(Oe[ut+1].position,Ve)-Le>0)?1:0)+((rt=d.e.Dot(Oe[ut+2].position,Ve)-Le>0)?1:0)){case 0:tt.push(Oe[ut]),tt.push(Oe[ut+1]),tt.push(Oe[ut+2]);break;case 1:if(ft&&(mt=Oe[ut+1],pt=Oe[ut+2],it=je(Oe[ut],mt),yt=je(Oe[ut],pt)),vt){mt=Oe[ut],pt=Oe[ut+2],it=je(Oe[ut+1],mt),yt=je(Oe[ut+1],pt),tt.push(it),tt.push(pt.clone()),tt.push(mt.clone()),tt.push(pt.clone()),tt.push(it.clone()),tt.push(yt);break}rt&&(mt=Oe[ut],pt=Oe[ut+1],it=je(Oe[ut+2],mt),yt=je(Oe[ut+2],pt)),mt&&pt&&it&&yt&&(tt.push(mt.clone()),tt.push(pt.clone()),tt.push(it),tt.push(yt),tt.push(it.clone()),tt.push(pt.clone()));break;case 2:ft||(pt=je(mt=Oe[ut].clone(),Oe[ut+1]),it=je(mt,Oe[ut+2]),tt.push(mt),tt.push(pt),tt.push(it)),vt||(pt=je(mt=Oe[ut+1].clone(),Oe[ut+2]),it=je(mt,Oe[ut]),tt.push(mt),tt.push(pt),tt.push(it)),rt||(pt=je(mt=Oe[ut+2].clone(),Oe[ut]),it=je(mt,Oe[ut+1]),tt.push(mt),tt.push(pt),tt.push(it))}}return tt},Ie=0;Ie<r.length;Ie+=3){var Re=new Array;if(Re.push(Ee(Ie)),Re.push(Ee(Ie+1)),Re.push(Ee(Ie+2)),Re=Ae(Re,new d.e(1,0,0)),Re=Ae(Re,new d.e(-1,0,0)),Re=Ae(Re,new d.e(0,1,0)),Re=Ae(Re,new d.e(0,-1,0)),Re=Ae(Re,new d.e(0,0,1)),(Re=Ae(Re,new d.e(0,0,-1))).length!==0)for(var Pe=0;Pe<Re.length;Pe++){var Ce=Re[Pe];me.indices.push(ye),Ce.position.toArray(me.positions,3*ye),Ce.normal.toArray(me.normals,3*ye),me.uvs.push(.5+Ce.position.x/y.x),me.uvs.push(.5+Ce.position.y/y.y),ye++}}var Be=new Ne.a(t,e.getScene());return me.applyToMesh(Be),Be.position=f.clone(),Be.rotation=new d.e(oe,k,D),Be},i}();Tt.a.CreateCapsule=function(i){i===void 0&&(i={subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6});var t,e,n=Math.max(i.subdivisions?i.subdivisions:2,1),r=Math.max(i.tessellation?i.tessellation:16,3),o=Math.max(i.height?i.height:1,0),u=Math.max(i.radius?i.radius:.25,0),f=Math.max(i.capSubdivisions?i.capSubdivisions:6,1),v=r,y=n,D=Math.max(i.radiusTop?i.radiusTop:u,0),w=Math.max(i.radiusBottom?i.radiusBottom:u,0),F=o-(D+w),z=2*Math.PI,k=Math.max(i.topCapSubdivisions?i.topCapSubdivisions:f,1),K=Math.max(i.bottomCapSubdivisions?i.bottomCapSubdivisions:f,1),oe=Math.acos((w-D)/o),ae=[],ue=[],de=[],me=[],ye=0,Ee=[],Ae=.5*F,Ie=.5*Math.PI,Re=d.e.Zero(),Pe=d.e.Zero(),Ce=Math.cos(oe),Be=Math.sin(oe),Oe=new d.d(D*Be,Ae+D*Ce).subtract(new d.d(w*Be,w*Ce-Ae)).length(),Ve=D*oe+Oe+w*(Ie-oe),Le=0;for(e=0;e<=k;e++){var je=[],tt=Ie-oe*(e/k);Le+=D*oe/k;var ut=Math.cos(tt),ft=Math.sin(tt),vt=ut*D;for(t=0;t<=v;t++){var rt=(He=t/v)*z+0,mt=Math.sin(rt),pt=Math.cos(rt);Pe.x=vt*mt,Pe.y=Ae+ft*D,Pe.z=vt*pt,ue.push(Pe.x,Pe.y,Pe.z),Re.set(ut*mt,ft,ut*pt),de.push(Re.x,Re.y,Re.z),me.push(He,1-Le/Ve),je.push(ye),ye++}Ee.push(je)}var it=o-D-w+Ce*D-Ce*w,yt=Be*(w-D)/it;for(e=1;e<=y;e++){for(je=[],Le+=Oe/y,vt=Be*(e*(w-D)/y+D),t=0;t<=v;t++)rt=(He=t/v)*z+0,mt=Math.sin(rt),pt=Math.cos(rt),Pe.x=vt*mt,Pe.y=Ae+Ce*D-e*it/y,Pe.z=vt*pt,ue.push(Pe.x,Pe.y,Pe.z),Re.set(mt,yt,pt).normalize(),de.push(Re.x,Re.y,Re.z),me.push(He,1-Le/Ve),je.push(ye),ye++;Ee.push(je)}for(e=1;e<=K;e++){for(je=[],tt=Ie-oe-(Math.PI-oe)*(e/K),Le+=w*oe/K,ut=Math.cos(tt),ft=Math.sin(tt),vt=ut*w,t=0;t<=v;t++){var He;rt=(He=t/v)*z+0,mt=Math.sin(rt),pt=Math.cos(rt),Pe.x=vt*mt,Pe.y=ft*w-Ae,Pe.z=vt*pt,ue.push(Pe.x,Pe.y,Pe.z),Re.set(ut*mt,ft,ut*pt),de.push(Re.x,Re.y,Re.z),me.push(He,1-Le/Ve),je.push(ye),ye++}Ee.push(je)}for(t=0;t<v;t++)for(e=0;e<k+y+K;e++){var at=Ee[e][t],It=Ee[e+1][t],vn=Ee[e+1][t+1],Jt=Ee[e][t+1];ae.push(at),ae.push(It),ae.push(Jt),ae.push(It),ae.push(vn),ae.push(Jt)}if(ae=ae.reverse(),i.orientation&&!i.orientation.equals(d.e.Up())){var Sn=new d.a;i.orientation.clone().scale(.5*Math.PI).cross(d.e.Up()).toQuaternion().toRotationMatrix(Sn);for(var Rt=d.e.Zero(),Rn=0;Rn<ue.length;Rn+=3)Rt.set(ue[Rn],ue[Rn+1],ue[Rn+2]),d.e.TransformCoordinatesToRef(Rt.clone(),Sn,Rt),ue[Rn]=Rt.x,ue[Rn+1]=Rt.y,ue[Rn+2]=Rt.z}var bn=new Tt.a;return bn.positions=ue,bn.normals=de,bn.uvs=me,bn.indices=ae,bn},Ne.a.CreateCapsule=function(i,t,e){return Xm.CreateCapsule(i,t,e)};var El,Xm=function(){function i(){}return i.CreateCapsule=function(t,e,n){e===void 0&&(e={orientation:d.e.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6});var r=new Ne.a(t,n);return Tt.a.CreateCapsule(e).applyToMesh(r),r},i}(),Qw=function(){function i(){}return i.CreateBox=function(t,e,n){return n===void 0&&(n=null),bs.a.CreateBox(t,e,n)},i.CreateTiledBox=function(t,e,n){return n===void 0&&(n=null),tE.CreateTiledBox(t,e,n)},i.CreateSphere=function(t,e,n){return n===void 0&&(n=null),zr.a.CreateSphere(t,e,n)},i.CreateDisc=function(t,e,n){return n===void 0&&(n=null),Fh.CreateDisc(t,e,n)},i.CreateIcoSphere=function(t,e,n){return n===void 0&&(n=null),Hm.CreateIcoSphere(t,e,n)},i.CreateRibbon=function(t,e,n){return n===void 0&&(n=null),yl.a.CreateRibbon(t,e,n)},i.CreateCylinder=function(t,e,n){return n===void 0&&(n=null),zi.a.CreateCylinder(t,e,n)},i.CreateTorus=function(t,e,n){return n===void 0&&(n=null),ms.CreateTorus(t,e,n)},i.CreateTorusKnot=function(t,e,n){return n===void 0&&(n=null),km.CreateTorusKnot(t,e,n)},i.CreateLineSystem=function(t,e,n){return Jn.a.CreateLineSystem(t,e,n)},i.CreateLines=function(t,e,n){return n===void 0&&(n=null),Jn.a.CreateLines(t,e,n)},i.CreateDashedLines=function(t,e,n){return n===void 0&&(n=null),Jn.a.CreateDashedLines(t,e,n)},i.ExtrudeShape=function(t,e,n){return n===void 0&&(n=null),Sh.a.ExtrudeShape(t,e,n)},i.ExtrudeShapeCustom=function(t,e,n){return n===void 0&&(n=null),Sh.a.ExtrudeShapeCustom(t,e,n)},i.CreateLathe=function(t,e,n){return n===void 0&&(n=null),zm.CreateLathe(t,e,n)},i.CreateTiledPlane=function(t,e,n){return n===void 0&&(n=null),rE.CreateTiledPlane(t,e,n)},i.CreatePlane=function(t,e,n){return n===void 0&&(n=null),Yp.a.CreatePlane(t,e,n)},i.CreateGround=function(t,e,n){return n===void 0&&(n=null),Go.CreateGround(t,e,n)},i.CreateTiledGround=function(t,e,n){return n===void 0&&(n=null),Go.CreateTiledGround(t,e,n)},i.CreateGroundFromHeightMap=function(t,e,n,r){return r===void 0&&(r=null),Go.CreateGroundFromHeightMap(t,e,n,r)},i.CreatePolygon=function(t,e,n,r){return n===void 0&&(n=null),r===void 0&&(r=earcut),Tl.CreatePolygon(t,e,n,r)},i.ExtrudePolygon=function(t,e,n,r){return n===void 0&&(n=null),r===void 0&&(r=earcut),Tl.ExtrudePolygon(t,e,n,r)},i.CreateTube=function(t,e,n){return n===void 0&&(n=null),Gm.CreateTube(t,e,n)},i.CreatePolyhedron=function(t,e,n){return n===void 0&&(n=null),rl.CreatePolyhedron(t,e,n)},i.CreateDecal=function(t,e,n){return Wm.CreateDecal(t,e,n)},i.CreateCapsule=function(t,e,n){return e===void 0&&(e={orientation:d.e.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6}),n===void 0&&(n=null),Xm.CreateCapsule(t,e,n)},i}(),qw=function(i,t,e){this.quality=i,this.distance=t,this.optimizeMesh=e},iE=function(){function i(){this.running=!1,this._simplificationArray=[]}return i.prototype.addTask=function(t){this._simplificationArray.push(t)},i.prototype.executeNext=function(){var t=this._simplificationArray.pop();t?(this.running=!0,this.runSimplification(t)):this.running=!1},i.prototype.runSimplification=function(t){var e=this;if(t.parallelProcessing)t.settings.forEach(function(r){e.getSimplifier(t).simplify(r,function(o){r.distance!==void 0&&t.mesh.addLODLevel(r.distance,o),o.isVisible=!0,r.quality===t.settings[t.settings.length-1].quality&&t.successCallback&&t.successCallback(),e.executeNext()})});else{var n=this.getSimplifier(t);et.a.Run(t.settings.length,function(r){var o,u;o=t.settings[r.index],u=function(){r.executeNext()},n.simplify(o,function(f){o.distance!==void 0&&t.mesh.addLODLevel(o.distance,f),f.isVisible=!0,u()})},function(){t.successCallback&&t.successCallback(),e.executeNext()})}},i.prototype.getSimplifier=function(t){switch(t.simplificationType){case El.QUADRATIC:default:return new aE(t.mesh)}},i}();(function(i){i[i.QUADRATIC=0]="QUADRATIC"})(El||(El={}));var Zw=function(i){this.vertices=i,this.error=new Array(4),this.deleted=!1,this.isDirty=!1,this.deletePending=!1,this.borderFactor=0},$w=function(){function i(t,e){this.position=t,this.id=e,this.isBorder=!0,this.q=new oE,this.triangleCount=0,this.triangleStart=0,this.originalOffsets=[]}return i.prototype.updatePosition=function(t){this.position.copyFrom(t)},i}(),oE=function(){function i(t){this.data=new Array(10);for(var e=0;e<10;++e)t&&t[e]?this.data[e]=t[e]:this.data[e]=0}return i.prototype.det=function(t,e,n,r,o,u,f,v,y){return this.data[t]*this.data[o]*this.data[y]+this.data[n]*this.data[r]*this.data[v]+this.data[e]*this.data[u]*this.data[f]-this.data[n]*this.data[o]*this.data[f]-this.data[t]*this.data[u]*this.data[v]-this.data[e]*this.data[r]*this.data[y]},i.prototype.addInPlace=function(t){for(var e=0;e<10;++e)this.data[e]+=t.data[e]},i.prototype.addArrayInPlace=function(t){for(var e=0;e<10;++e)this.data[e]+=t[e]},i.prototype.add=function(t){for(var e=new i,n=0;n<10;++n)e.data[n]=this.data[n]+t.data[n];return e},i.FromData=function(t,e,n,r){return new i(i.DataFromNumbers(t,e,n,r))},i.DataFromNumbers=function(t,e,n,r){return[t*t,t*e,t*n,t*r,e*e,e*n,e*r,n*n,n*r,r*r]},i}(),Jw=function(i,t){this.vertexId=i,this.triangleId=t},aE=function(){function i(t){this._mesh=t,this.syncIterations=5e3,this.aggressiveness=7,this.decimationIterations=100,this.boundingBoxEpsilon=Zt.a}return i.prototype.simplify=function(t,e){var n=this;this.initDecimatedMesh(),et.a.Run(this._mesh.subMeshes.length,function(r){n.initWithMesh(r.index,function(){n.runDecimation(t,r.index,function(){r.executeNext()})},t.optimizeMesh)},function(){setTimeout(function(){e(n._reconstructedMesh)},0)})},i.prototype.runDecimation=function(t,e,n){var r=this,o=~~(this.triangles.length*t.quality),u=0,f=this.triangles.length;et.a.Run(this.decimationIterations,function(v){var y,D;f-u<=o?v.breakLoop():(y=v.index,D=function(){v.executeNext()},setTimeout(function(){y%5==0&&r.updateMesh(y===0);for(var w=0;w<r.triangles.length;++w)r.triangles[w].isDirty=!1;var F=1e-9*Math.pow(y+3,r.aggressiveness);et.a.SyncAsyncForLoop(r.triangles.length,r.syncIterations,function(z){var k=~~((r.triangles.length/2+z)%r.triangles.length),K=r.triangles[k];if(K&&!(K.error[3]>F||K.deleted||K.isDirty)){for(var oe=0;oe<3;++oe)if(K.error[oe]<F){var ae=[],ue=[],de=K.vertices[oe],me=K.vertices[(oe+1)%3];if(de.isBorder||me.isBorder)continue;var ye=d.e.Zero();r.calculateError(de,me,ye);var Ee=new Array;if(r.isFlipped(de,me,ye,ae,Ee)||r.isFlipped(me,de,ye,ue,Ee)||ae.indexOf(!0)<0||ue.indexOf(!0)<0)continue;var Ae=new Array;if(Ee.forEach(function(Ce){Ae.indexOf(Ce)===-1&&(Ce.deletePending=!0,Ae.push(Ce))}),Ae.length%2!=0)continue;de.q=me.q.add(de.q),de.updatePosition(ye);var Ie=r.references.length;u=r.updateTriangles(de,de,ae,u),u=r.updateTriangles(de,me,ue,u);var Re=r.references.length-Ie;if(Re<=de.triangleCount){if(Re)for(var Pe=0;Pe<Re;Pe++)r.references[de.triangleStart+Pe]=r.references[Ie+Pe]}else de.triangleStart=Ie;de.triangleCount=Re;break}}},D,function(){return f-u<=o})},0))},function(){setTimeout(function(){r.reconstructMesh(e),n()},0)})},i.prototype.initWithMesh=function(t,e,n){var r=this;this.vertices=[],this.triangles=[];var o=this._mesh.getVerticesData(De.b.PositionKind),u=this._mesh.getIndices(),f=this._mesh.subMeshes[t],v=[],y=f.verticesCount;et.a.SyncAsyncForLoop(y,this.syncIterations/4>>0,function(D){if(o){var w=D+f.verticesStart,F=d.e.FromArray(o,3*w),z=function(k){if(n){for(var K=0;K<r.vertices.length;++K)if(r.vertices[K].position.equalsWithEpsilon(k,1e-4))return r.vertices[K]}return null}(F)||new $w(F,r.vertices.length);z.originalOffsets.push(w),z.id===r.vertices.length&&r.vertices.push(z),v.push(z.id)}},function(){et.a.SyncAsyncForLoop(f.indexCount/3,r.syncIterations,function(D){if(u){var w=3*(f.indexStart/3+D),F=u[w+0],z=u[w+1],k=u[w+2],K=r.vertices[v[F-f.verticesStart]],oe=r.vertices[v[z-f.verticesStart]],ae=r.vertices[v[k-f.verticesStart]],ue=new Zw([K,oe,ae]);ue.originalOffset=w,r.triangles.push(ue)}},function(){r.init(e)})})},i.prototype.init=function(t){var e=this;et.a.SyncAsyncForLoop(this.triangles.length,this.syncIterations,function(n){var r=e.triangles[n];r.normal=d.e.Cross(r.vertices[1].position.subtract(r.vertices[0].position),r.vertices[2].position.subtract(r.vertices[0].position)).normalize();for(var o=0;o<3;o++)r.vertices[o].q.addArrayInPlace(oE.DataFromNumbers(r.normal.x,r.normal.y,r.normal.z,-d.e.Dot(r.normal,r.vertices[0].position)))},function(){et.a.SyncAsyncForLoop(e.triangles.length,e.syncIterations,function(n){for(var r=e.triangles[n],o=0;o<3;++o)r.error[o]=e.calculateError(r.vertices[o],r.vertices[(o+1)%3]);r.error[3]=Math.min(r.error[0],r.error[1],r.error[2])},function(){t()})})},i.prototype.reconstructMesh=function(t){var e,n,r,o=[];for(e=0;e<this.vertices.length;++e)this.vertices[e].triangleCount=0;for(e=0;e<this.triangles.length;++e)if(!this.triangles[e].deleted){for(n=this.triangles[e],r=0;r<3;++r)n.vertices[r].triangleCount=1;o.push(n)}var u=this._reconstructedMesh.getVerticesData(De.b.PositionKind)||[],f=this._reconstructedMesh.getVerticesData(De.b.NormalKind)||[],v=this._reconstructedMesh.getVerticesData(De.b.UVKind)||[],y=this._reconstructedMesh.getVerticesData(De.b.ColorKind)||[],D=this._mesh.getVerticesData(De.b.NormalKind),w=this._mesh.getVerticesData(De.b.UVKind),F=this._mesh.getVerticesData(De.b.ColorKind),z=0;for(e=0;e<this.vertices.length;++e){var k=this.vertices[e];k.id=z,k.triangleCount&&k.originalOffsets.forEach(function(ye){u.push(k.position.x),u.push(k.position.y),u.push(k.position.z),D&&D.length&&(f.push(D[3*ye]),f.push(D[3*ye+1]),f.push(D[3*ye+2])),w&&w.length&&(v.push(w[2*ye]),v.push(w[2*ye+1])),F&&F.length&&(y.push(F[4*ye]),y.push(F[4*ye+1]),y.push(F[4*ye+2]),y.push(F[4*ye+3])),++z})}var K=this._reconstructedMesh.getTotalIndices(),oe=this._reconstructedMesh.getTotalVertices(),ae=this._reconstructedMesh.subMeshes;this._reconstructedMesh.subMeshes=[];var ue=this._reconstructedMesh.getIndices(),de=this._mesh.getIndices();for(e=0;e<o.length;++e)n=o[e],[0,1,2].forEach(function(ye){var Ee=de[n.originalOffset+ye],Ae=n.vertices[ye].originalOffsets.indexOf(Ee);Ae<0&&(Ae=0),ue.push(n.vertices[ye].id+Ae+oe)});this._reconstructedMesh.setIndices(ue),this._reconstructedMesh.setVerticesData(De.b.PositionKind,u),f.length>0&&this._reconstructedMesh.setVerticesData(De.b.NormalKind,f),v.length>0&&this._reconstructedMesh.setVerticesData(De.b.UVKind,v),y.length>0&&this._reconstructedMesh.setVerticesData(De.b.ColorKind,y);var me=this._mesh.subMeshes[t];t>0&&(this._reconstructedMesh.subMeshes=[],ae.forEach(function(ye){vl.a.AddToMesh(ye.materialIndex,ye.verticesStart,ye.verticesCount,ye.indexStart,ye.indexCount,ye.getMesh())}),vl.a.AddToMesh(me.materialIndex,oe,z,K,3*o.length,this._reconstructedMesh))},i.prototype.initDecimatedMesh=function(){this._reconstructedMesh=new Ne.a(this._mesh.name+"Decimated",this._mesh.getScene()),this._reconstructedMesh.material=this._mesh.material,this._reconstructedMesh.parent=this._mesh.parent,this._reconstructedMesh.isVisible=!1,this._reconstructedMesh.renderingGroupId=this._mesh.renderingGroupId},i.prototype.isFlipped=function(t,e,n,r,o){for(var u=0;u<t.triangleCount;++u){var f=this.triangles[this.references[t.triangleStart+u].triangleId];if(!f.deleted){var v=this.references[t.triangleStart+u].vertexId,y=f.vertices[(v+1)%3],D=f.vertices[(v+2)%3];if(y!==e&&D!==e){var w=y.position.subtract(n);w=w.normalize();var F=D.position.subtract(n);if(F=F.normalize(),Math.abs(d.e.Dot(w,F))>.999)return!0;var z=d.e.Cross(w,F).normalize();if(r[u]=!1,d.e.Dot(z,f.normal)<.2)return!0}else r[u]=!0,o.push(f)}}return!1},i.prototype.updateTriangles=function(t,e,n,r){for(var o=r,u=0;u<e.triangleCount;++u){var f=this.references[e.triangleStart+u],v=this.triangles[f.triangleId];v.deleted||(n[u]&&v.deletePending?(v.deleted=!0,o++):(v.vertices[f.vertexId]=t,v.isDirty=!0,v.error[0]=this.calculateError(v.vertices[0],v.vertices[1])+v.borderFactor/2,v.error[1]=this.calculateError(v.vertices[1],v.vertices[2])+v.borderFactor/2,v.error[2]=this.calculateError(v.vertices[2],v.vertices[0])+v.borderFactor/2,v.error[3]=Math.min(v.error[0],v.error[1],v.error[2]),this.references.push(f)))}return o},i.prototype.identifyBorder=function(){for(var t=0;t<this.vertices.length;++t){var e,n=[],r=[],o=this.vertices[t];for(e=0;e<o.triangleCount;++e)for(var u=this.triangles[this.references[o.triangleStart+e].triangleId],f=0;f<3;f++){for(var v=0,y=u.vertices[f];v<n.length&&r[v]!==y.id;)++v;v===n.length?(n.push(1),r.push(y.id)):n[v]++}for(e=0;e<n.length;++e)n[e]===1?this.vertices[r[e]].isBorder=!0:this.vertices[r[e]].isBorder=!1}},i.prototype.updateMesh=function(t){var e,n,r,o;if(t===void 0&&(t=!1),!t){var u=[];for(e=0;e<this.triangles.length;++e)this.triangles[e].deleted||u.push(this.triangles[e]);this.triangles=u}for(e=0;e<this.vertices.length;++e)this.vertices[e].triangleCount=0,this.vertices[e].triangleStart=0;for(e=0;e<this.triangles.length;++e)for(n=this.triangles[e],r=0;r<3;++r)(o=n.vertices[r]).triangleCount++;var f=0;for(e=0;e<this.vertices.length;++e)this.vertices[e].triangleStart=f,f+=this.vertices[e].triangleCount,this.vertices[e].triangleCount=0;var v=new Array(3*this.triangles.length);for(e=0;e<this.triangles.length;++e)for(n=this.triangles[e],r=0;r<3;++r)v[(o=n.vertices[r]).triangleStart+o.triangleCount]=new Jw(r,e),o.triangleCount++;this.references=v,t&&this.identifyBorder()},i.prototype.vertexError=function(t,e){var n=e.x,r=e.y,o=e.z;return t.data[0]*n*n+2*t.data[1]*n*r+2*t.data[2]*n*o+2*t.data[3]*n+t.data[4]*r*r+2*t.data[5]*r*o+2*t.data[6]*r+t.data[7]*o*o+2*t.data[8]*o+t.data[9]},i.prototype.calculateError=function(t,e,n){var r=t.q.add(e.q),o=t.isBorder&&e.isBorder,u=0,f=r.det(0,1,2,1,4,5,2,5,7);if(f===0||o){var v=t.position.add(e.position).divide(new d.e(2,2,2)),y=this.vertexError(r,t.position),D=this.vertexError(r,e.position),w=this.vertexError(r,v);(u=Math.min(y,D,w))===y?n&&n.copyFrom(t.position):u===D?n&&n.copyFrom(e.position):n&&n.copyFrom(v)}else n||(n=d.e.Zero()),n.x=-1/f*r.det(1,2,3,4,5,6,5,7,8),n.y=1/f*r.det(0,2,3,1,5,6,2,7,8),n.z=-1/f*r.det(0,1,3,1,4,6,2,5,8),u=this.vertexError(r,n);return u},i}();Object.defineProperty(he.a.prototype,"simplificationQueue",{get:function(){if(!this._simplificationQueue){this._simplificationQueue=new iE;var i=this._getComponent(dt.a.NAME_SIMPLIFICATIONQUEUE);i||(i=new sE(this),this._addComponent(i))}return this._simplificationQueue},set:function(i){this._simplificationQueue=i},enumerable:!0,configurable:!0}),Ne.a.prototype.simplify=function(i,t,e,n){return t===void 0&&(t=!0),e===void 0&&(e=El.QUADRATIC),this.getScene().simplificationQueue.addTask({settings:i,parallelProcessing:t,mesh:this,simplificationType:e,successCallback:n}),this};var sE=function(){function i(t){this.name=dt.a.NAME_SIMPLIFICATIONQUEUE,this.scene=t}return i.prototype.register=function(){this.scene._beforeCameraUpdateStage.registerStep(dt.a.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE,this,this._beforeCameraUpdate)},i.prototype.rebuild=function(){},i.prototype.dispose=function(){},i.prototype._beforeCameraUpdate=function(){this.scene._simplificationQueue&&!this.scene._simplificationQueue.running&&this.scene._simplificationQueue.executeNext()},i}(),eL=c(149),tL=c(88);Ne.a.prototype.thinInstanceAdd=function(i,t){t===void 0&&(t=!0),this._thinInstanceUpdateBufferSize("matrix",Array.isArray(i)?i.length:1);var e=this._thinInstanceDataStorage.instancesCount;if(Array.isArray(i))for(var n=0;n<i.length;++n)this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,i[n],n===i.length-1&&t);else this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,i,t);return e},Ne.a.prototype.thinInstanceAddSelf=function(i){return i===void 0&&(i=!0),this.thinInstanceAdd(d.a.IdentityReadOnly,i)},Ne.a.prototype.thinInstanceRegisterAttribute=function(i,t){this.removeVerticesData(i),this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.strides[i]=t,this._userThinInstanceBuffersStorage.sizes[i]=t*Math.max(32,this._thinInstanceDataStorage.instancesCount),this._userThinInstanceBuffersStorage.data[i]=new Float32Array(this._userThinInstanceBuffersStorage.sizes[i]),this._userThinInstanceBuffersStorage.vertexBuffers[i]=new De.b(this.getEngine(),this._userThinInstanceBuffersStorage.data[i],i,!0,!1,t,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[i])},Ne.a.prototype.thinInstanceSetMatrixAt=function(i,t,e){if(e===void 0&&(e=!0),!this._thinInstanceDataStorage.matrixData||i>=this._thinInstanceDataStorage.instancesCount)return!1;var n=this._thinInstanceDataStorage.matrixData;return t.copyToArray(n,16*i),this._thinInstanceDataStorage.worldMatrices&&(this._thinInstanceDataStorage.worldMatrices[i]=t),e&&(this.thinInstanceBufferUpdated("matrix"),this.doNotSyncBoundingInfo||this.thinInstanceRefreshBoundingInfo(!1)),!0},Ne.a.prototype.thinInstanceSetAttributeAt=function(i,t,e,n){return n===void 0&&(n=!0),!(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.data[i]||t>=this._thinInstanceDataStorage.instancesCount)&&(this._thinInstanceUpdateBufferSize(i,0),this._userThinInstanceBuffersStorage.data[i].set(e,t*this._userThinInstanceBuffersStorage.strides[i]),n&&this.thinInstanceBufferUpdated(i),!0)},Object.defineProperty(Ne.a.prototype,"thinInstanceCount",{get:function(){return this._thinInstanceDataStorage.instancesCount},set:function(i){var t,e;i<=((e=(t=this._thinInstanceDataStorage.matrixData)===null||t===void 0?void 0:t.length)!==null&&e!==void 0?e:0)/16&&(this._thinInstanceDataStorage.instancesCount=i)},enumerable:!0,configurable:!0}),Ne.a.prototype.thinInstanceSetBuffer=function(i,t,e,n){var r,o;if(e===void 0&&(e=0),n===void 0&&(n=!1),e=e||16,i==="matrix")if((r=this._thinInstanceDataStorage.matrixBuffer)===null||r===void 0||r.dispose(),this._thinInstanceDataStorage.matrixBuffer=null,this._thinInstanceDataStorage.matrixBufferSize=t?t.length:32*e,this._thinInstanceDataStorage.matrixData=t,this._thinInstanceDataStorage.worldMatrices=null,t!==null){this._thinInstanceDataStorage.instancesCount=t.length/e;var u=new De.a(this.getEngine(),t,!n,e,!1,!0);this._thinInstanceDataStorage.matrixBuffer=u,this.setVerticesBuffer(u.createVertexBuffer("world0",0,4)),this.setVerticesBuffer(u.createVertexBuffer("world1",4,4)),this.setVerticesBuffer(u.createVertexBuffer("world2",8,4)),this.setVerticesBuffer(u.createVertexBuffer("world3",12,4)),this.doNotSyncBoundingInfo||this.thinInstanceRefreshBoundingInfo(!1)}else this._thinInstanceDataStorage.instancesCount=0,this.doNotSyncBoundingInfo||this.refreshBoundingInfo(!0);else t===null?((o=this._userThinInstanceBuffersStorage)===null||o===void 0?void 0:o.data[i])&&(this.removeVerticesData(i),delete this._userThinInstanceBuffersStorage.data[i],delete this._userThinInstanceBuffersStorage.strides[i],delete this._userThinInstanceBuffersStorage.sizes[i],delete this._userThinInstanceBuffersStorage.vertexBuffers[i]):(this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.data[i]=t,this._userThinInstanceBuffersStorage.strides[i]=e,this._userThinInstanceBuffersStorage.sizes[i]=t.length,this._userThinInstanceBuffersStorage.vertexBuffers[i]=new De.b(this.getEngine(),t,i,!n,!1,e,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[i]))},Ne.a.prototype.thinInstanceBufferUpdated=function(i){var t;i==="matrix"?this._thinInstanceDataStorage.matrixBuffer&&this._thinInstanceDataStorage.matrixBuffer.updateDirectly(this._thinInstanceDataStorage.matrixData,0,this._thinInstanceDataStorage.instancesCount):((t=this._userThinInstanceBuffersStorage)===null||t===void 0?void 0:t.vertexBuffers[i])&&this._userThinInstanceBuffersStorage.vertexBuffers[i].updateDirectly(this._userThinInstanceBuffersStorage.data[i],0)},Ne.a.prototype.thinInstancePartialBufferUpdate=function(i,t,e){var n;i==="matrix"?this._thinInstanceDataStorage.matrixBuffer&&this._thinInstanceDataStorage.matrixBuffer.updateDirectly(t,e):((n=this._userThinInstanceBuffersStorage)===null||n===void 0?void 0:n.vertexBuffers[i])&&this._userThinInstanceBuffersStorage.vertexBuffers[i].updateDirectly(t,e)},Ne.a.prototype.thinInstanceGetWorldMatrices=function(){if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return[];var i=this._thinInstanceDataStorage.matrixData;if(!this._thinInstanceDataStorage.worldMatrices){this._thinInstanceDataStorage.worldMatrices=new Array;for(var t=0;t<this._thinInstanceDataStorage.instancesCount;++t)this._thinInstanceDataStorage.worldMatrices[t]=d.a.FromArray(i,16*t)}return this._thinInstanceDataStorage.worldMatrices},Ne.a.prototype.thinInstanceRefreshBoundingInfo=function(i){if(i===void 0&&(i=!1),this._thinInstanceDataStorage.matrixData&&this._thinInstanceDataStorage.matrixBuffer){var t=this._thinInstanceDataStorage.boundingVectors;i&&(t.length=0,this.refreshBoundingInfo(!0));var e=this.getBoundingInfo(),n=this._thinInstanceDataStorage.matrixData;if(t.length===0)for(var r=0;r<e.boundingBox.vectors.length;++r)t.push(e.boundingBox.vectors[r].clone());d.c.Vector3[0].setAll(Number.POSITIVE_INFINITY),d.c.Vector3[1].setAll(Number.NEGATIVE_INFINITY);for(var o=0;o<this._thinInstanceDataStorage.instancesCount;++o)for(d.a.FromArrayToRef(n,16*o,d.c.Matrix[0]),r=0;r<t.length;++r)d.e.TransformCoordinatesToRef(t[r],d.c.Matrix[0],d.c.Vector3[2]),d.c.Vector3[0].minimizeInPlace(d.c.Vector3[2]),d.c.Vector3[1].maximizeInPlace(d.c.Vector3[2]);e.reConstruct(d.c.Vector3[0],d.c.Vector3[1]),this._updateBoundingInfo()}},Ne.a.prototype._thinInstanceUpdateBufferSize=function(i,t){var e,n;t===void 0&&(t=1);var r=i==="matrix";if(r||this._userThinInstanceBuffersStorage&&this._userThinInstanceBuffersStorage.strides[i]){for(var o=r?16:this._userThinInstanceBuffersStorage.strides[i],u=r?this._thinInstanceDataStorage.matrixBufferSize:this._userThinInstanceBuffersStorage.sizes[i],f=r?this._thinInstanceDataStorage.matrixData:this._userThinInstanceBuffersStorage.data[i],v=(this._thinInstanceDataStorage.instancesCount+t)*o,y=u;y<v;)y*=2;if(!f||u!=y){if(f){var D=new Float32Array(y);D.set(f,0),f=D}else f=new Float32Array(y);if(r){(e=this._thinInstanceDataStorage.matrixBuffer)===null||e===void 0||e.dispose();var w=new De.a(this.getEngine(),f,!0,o,!1,!0);this._thinInstanceDataStorage.matrixBuffer=w,this._thinInstanceDataStorage.matrixData=f,this._thinInstanceDataStorage.matrixBufferSize=y,this.setVerticesBuffer(w.createVertexBuffer("world0",0,4)),this.setVerticesBuffer(w.createVertexBuffer("world1",4,4)),this.setVerticesBuffer(w.createVertexBuffer("world2",8,4)),this.setVerticesBuffer(w.createVertexBuffer("world3",12,4))}else(n=this._userThinInstanceBuffersStorage.vertexBuffers[i])===null||n===void 0||n.dispose(),this._userThinInstanceBuffersStorage.data[i]=f,this._userThinInstanceBuffersStorage.sizes[i]=y,this._userThinInstanceBuffersStorage.vertexBuffers[i]=new De.b(this.getEngine(),f,i,!0,!1,o,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[i])}}},Ne.a.prototype._thinInstanceInitializeUserStorage=function(){this._userThinInstanceBuffersStorage||(this._userThinInstanceBuffersStorage={data:{},sizes:{},vertexBuffers:{},strides:{}})},Ne.a.prototype._disposeThinInstanceSpecificData=function(){var i;((i=this._thinInstanceDataStorage)===null||i===void 0?void 0:i.matrixBuffer)&&(this._thinInstanceDataStorage.matrixBuffer.dispose(),this._thinInstanceDataStorage.matrixBuffer=null)};var nL=function(){function i(t){t===void 0&&(t=Recast),this.bjsRECAST={},this.name="RecastJSPlugin",this._maximumSubStepCount=10,this._timeStep=1/60,typeof t=="function"?t(this.bjsRECAST):this.bjsRECAST=t,this.isSupported()?this.setTimeStep():_.a.Error("RecastJS is not available. Please make sure you included the js file.")}return i.prototype.setTimeStep=function(t){t===void 0&&(t=1/60),this._timeStep=t},i.prototype.getTimeStep=function(){return this._timeStep},i.prototype.setMaximumSubStepCount=function(t){t===void 0&&(t=10),this._maximumSubStepCount=t},i.prototype.getMaximumSubStepCount=function(){return this._maximumSubStepCount},i.prototype.createNavMesh=function(t,e){var n,r,o,u=new this.bjsRECAST.rcConfig;u.cs=e.cs,u.ch=e.ch,u.borderSize=0,u.tileSize=0,u.walkableSlopeAngle=e.walkableSlopeAngle,u.walkableHeight=e.walkableHeight,u.walkableClimb=e.walkableClimb,u.walkableRadius=e.walkableRadius,u.maxEdgeLen=e.maxEdgeLen,u.maxSimplificationError=e.maxSimplificationError,u.minRegionArea=e.minRegionArea,u.mergeRegionArea=e.mergeRegionArea,u.maxVertsPerPoly=e.maxVertsPerPoly,u.detailSampleDist=e.detailSampleDist,u.detailSampleMaxError=e.detailSampleMaxError,this.navMesh=new this.bjsRECAST.NavMesh;var f=[],v=[],y=0;for(n=0;n<t.length;n++)if(t[n]){var D=t[n],w=D.getIndices();if(!w)continue;var F=D.getVerticesData(De.b.PositionKind,!1,!1);if(!F)continue;var z=D.computeWorldMatrix(!0);for(r=0;r<w.length;r++)f.push(w[r]+y);var k=d.e.Zero(),K=d.e.Zero();for(o=0;o<F.length;o+=3)d.e.FromArrayToRef(F,o,K),d.e.TransformCoordinatesToRef(K,z,k),v.push(k.x,k.y,k.z);y+=F.length/3}this.navMesh.build(v,y,f,f.length,u)},i.prototype.createDebugNavMesh=function(t){var e,n,r=this.navMesh.getDebugNavMesh(),o=r.getTriangleCount(),u=[],f=[];for(e=0;e<3*o;e++)u.push(e);for(e=0;e<o;e++)for(n=0;n<3;n++){var v=r.getTriangle(e).getPoint(n);f.push(v.x,v.y,v.z)}var y=new Ne.a("NavMeshDebug",t),D=new Tt.a;return D.indices=u,D.positions=f,D.applyToMesh(y,!1),y},i.prototype.getClosestPoint=function(t){var e=new this.bjsRECAST.Vec3(t.x,t.y,t.z),n=this.navMesh.getClosestPoint(e);return new d.e(n.x,n.y,n.z)},i.prototype.getClosestPointToRef=function(t,e){var n=new this.bjsRECAST.Vec3(t.x,t.y,t.z),r=this.navMesh.getClosestPoint(n);e.set(r.x,r.y,r.z)},i.prototype.getRandomPointAround=function(t,e){var n=new this.bjsRECAST.Vec3(t.x,t.y,t.z),r=this.navMesh.getRandomPointAround(n,e);return new d.e(r.x,r.y,r.z)},i.prototype.getRandomPointAroundToRef=function(t,e,n){var r=new this.bjsRECAST.Vec3(t.x,t.y,t.z),o=this.navMesh.getRandomPointAround(r,e);n.set(o.x,o.y,o.z)},i.prototype.moveAlong=function(t,e){var n=new this.bjsRECAST.Vec3(t.x,t.y,t.z),r=new this.bjsRECAST.Vec3(e.x,e.y,e.z),o=this.navMesh.moveAlong(n,r);return new d.e(o.x,o.y,o.z)},i.prototype.moveAlongToRef=function(t,e,n){var r=new this.bjsRECAST.Vec3(t.x,t.y,t.z),o=new this.bjsRECAST.Vec3(e.x,e.y,e.z),u=this.navMesh.moveAlong(r,o);n.set(u.x,u.y,u.z)},i.prototype.computePath=function(t,e){var n,r=new this.bjsRECAST.Vec3(t.x,t.y,t.z),o=new this.bjsRECAST.Vec3(e.x,e.y,e.z),u=this.navMesh.computePath(r,o),f=u.getPointCount(),v=[];for(n=0;n<f;n++){var y=u.getPoint(n);v.push(new d.e(y.x,y.y,y.z))}return v},i.prototype.createCrowd=function(t,e,n){return new cE(this,t,e,n)},i.prototype.setDefaultQueryExtent=function(t){var e=new this.bjsRECAST.Vec3(t.x,t.y,t.z);this.navMesh.setDefaultQueryExtent(e)},i.prototype.getDefaultQueryExtent=function(){var t=this.navMesh.getDefaultQueryExtent();return new d.e(t.x,t.y,t.z)},i.prototype.buildFromNavmeshData=function(t){var e=t.length*t.BYTES_PER_ELEMENT,n=this.bjsRECAST._malloc(e),r=new Uint8Array(this.bjsRECAST.HEAPU8.buffer,n,e);r.set(t);var o=new this.bjsRECAST.NavmeshData;o.dataPointer=r.byteOffset,o.size=t.length,this.navMesh=new this.bjsRECAST.NavMesh,this.navMesh.buildFromNavmeshData(o),this.bjsRECAST._free(r.byteOffset)},i.prototype.getNavmeshData=function(){var t=this.navMesh.getNavmeshData(),e=new Uint8Array(this.bjsRECAST.HEAPU8.buffer,t.dataPointer,t.size),n=new Uint8Array(t.size);return n.set(e),this.navMesh.freeNavmeshData(t),n},i.prototype.getDefaultQueryExtentToRef=function(t){var e=this.navMesh.getDefaultQueryExtent();t.set(e.x,e.y,e.z)},i.prototype.dispose=function(){},i.prototype.isSupported=function(){return this.bjsRECAST!==void 0},i}(),cE=function(){function i(t,e,n,r){var o=this;this.recastCrowd={},this.transforms=new Array,this.agents=new Array,this._onBeforeAnimationsObserver=null,this.bjsRECASTPlugin=t,this.recastCrowd=new this.bjsRECASTPlugin.bjsRECAST.Crowd(e,n,this.bjsRECASTPlugin.navMesh.getNavMesh()),this._scene=r,this._onBeforeAnimationsObserver=r.onBeforeAnimationsObservable.add(function(){o.update(.001*r.getEngine().getDeltaTime())})}return i.prototype.addAgent=function(t,e,n){var r=new this.bjsRECASTPlugin.bjsRECAST.dtCrowdAgentParams;r.radius=e.radius,r.height=e.height,r.maxAcceleration=e.maxAcceleration,r.maxSpeed=e.maxSpeed,r.collisionQueryRange=e.collisionQueryRange,r.pathOptimizationRange=e.pathOptimizationRange,r.separationWeight=e.separationWeight,r.updateFlags=7,r.obstacleAvoidanceType=0,r.queryFilterType=0,r.userData=0;var o=this.recastCrowd.addAgent(new this.bjsRECASTPlugin.bjsRECAST.Vec3(t.x,t.y,t.z),r);return this.transforms.push(n),this.agents.push(o),o},i.prototype.getAgentPosition=function(t){var e=this.recastCrowd.getAgentPosition(t);return new d.e(e.x,e.y,e.z)},i.prototype.getAgentPositionToRef=function(t,e){var n=this.recastCrowd.getAgentPosition(t);e.set(n.x,n.y,n.z)},i.prototype.getAgentVelocity=function(t){var e=this.recastCrowd.getAgentVelocity(t);return new d.e(e.x,e.y,e.z)},i.prototype.getAgentVelocityToRef=function(t,e){var n=this.recastCrowd.getAgentVelocity(t);e.set(n.x,n.y,n.z)},i.prototype.getAgentNextTargetPath=function(t){var e=this.recastCrowd.getAgentNextTargetPath(t);return new d.e(e.x,e.y,e.z)},i.prototype.getAgentNextTargetPathToRef=function(t,e){var n=this.recastCrowd.getAgentNextTargetPath(t);e.set(n.x,n.y,n.z)},i.prototype.getAgentState=function(t){return this.recastCrowd.getAgentState(t)},i.prototype.overOffmeshConnection=function(t){return this.recastCrowd.overOffmeshConnection(t)},i.prototype.agentGoto=function(t,e){this.recastCrowd.agentGoto(t,new this.bjsRECASTPlugin.bjsRECAST.Vec3(e.x,e.y,e.z))},i.prototype.agentTeleport=function(t,e){this.recastCrowd.agentTeleport(t,new this.bjsRECASTPlugin.bjsRECAST.Vec3(e.x,e.y,e.z))},i.prototype.updateAgentParameters=function(t,e){var n=this.recastCrowd.getAgentParameters(t);e.radius!==void 0&&(n.radius=e.radius),e.height!==void 0&&(n.height=e.height),e.maxAcceleration!==void 0&&(n.maxAcceleration=e.maxAcceleration),e.maxSpeed!==void 0&&(n.maxSpeed=e.maxSpeed),e.collisionQueryRange!==void 0&&(n.collisionQueryRange=e.collisionQueryRange),e.pathOptimizationRange!==void 0&&(n.pathOptimizationRange=e.pathOptimizationRange),e.separationWeight!==void 0&&(n.separationWeight=e.separationWeight),this.recastCrowd.setAgentParameters(t,n)},i.prototype.removeAgent=function(t){this.recastCrowd.removeAgent(t);var e=this.agents.indexOf(t);e>-1&&(this.agents.splice(e,1),this.transforms.splice(e,1))},i.prototype.getAgents=function(){return this.agents},i.prototype.update=function(t){var e=this.bjsRECASTPlugin.getTimeStep(),n=this.bjsRECASTPlugin.getMaximumSubStepCount();if(e<=Zt.a)this.recastCrowd.update(t);else{var r=t/e;n&&r>n&&(r=n),r<1&&(r=1);for(var o=0;o<r;o++)this.recastCrowd.update(e)}for(var u=0;u<this.agents.length;u++)this.transforms[u].position=this.getAgentPosition(this.agents[u])},i.prototype.setDefaultQueryExtent=function(t){var e=new this.bjsRECASTPlugin.bjsRECAST.Vec3(t.x,t.y,t.z);this.recastCrowd.setDefaultQueryExtent(e)},i.prototype.getDefaultQueryExtent=function(){var t=this.recastCrowd.getDefaultQueryExtent();return new d.e(t.x,t.y,t.z)},i.prototype.getDefaultQueryExtentToRef=function(t){var e=this.recastCrowd.getDefaultQueryExtent();t.set(e.x,e.y,e.z)},i.prototype.dispose=function(){this.recastCrowd.destroy(),this._scene.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null},i}();Ge.a.OfflineProviderFactory=function(i,t,e){return e===void 0&&(e=!1),new lE(i,t,e)};var Ls,lE=function(){function i(t,e,n){var r=this;n===void 0&&(n=!1),this._idbFactory=typeof window!="undefined"?window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB:indexedDB,this._callbackManifestChecked=e,this._currentSceneUrl=i._ReturnFullUrlLocation(t),this._db=null,this._enableSceneOffline=!1,this._enableTexturesOffline=!1,this._manifestVersionFound=0,this._mustUpdateRessources=!1,this._hasReachedQuota=!1,i.IDBStorageEnabled?n?(this._enableSceneOffline=!0,this._enableTexturesOffline=!0,this._manifestVersionFound=1,et.b.SetImmediate(function(){r._callbackManifestChecked(!0)})):this._checkManifestFile():this._callbackManifestChecked(!0)}return Object.defineProperty(i.prototype,"enableSceneOffline",{get:function(){return this._enableSceneOffline},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"enableTexturesOffline",{get:function(){return this._enableTexturesOffline},enumerable:!1,configurable:!0}),i.prototype._checkManifestFile=function(){var t=this,e=function(){t._enableSceneOffline=!1,t._enableTexturesOffline=!1,t._callbackManifestChecked(!1)},n=!1,r=this._currentSceneUrl+".manifest",o=new se.a;navigator.onLine&&(n=!0,r=r+(r.match(/\?/)==null?"?":"&")+Date.now()),o.open("GET",r),o.addEventListener("load",function(){if(o.status===200||i._ValidateXHRData(o,1))try{var u=JSON.parse(o.response);t._enableSceneOffline=u.enableSceneOffline,t._enableTexturesOffline=u.enableTexturesOffline&&i.IsUASupportingBlobStorage,u.version&&!isNaN(parseInt(u.version))&&(t._manifestVersionFound=u.version),t._callbackManifestChecked&&t._callbackManifestChecked(!0)}catch(f){e()}else e()},!1),o.addEventListener("error",function(){if(n){n=!1;var u=t._currentSceneUrl+".manifest";o.open("GET",u),o.send()}else e()},!1);try{o.send()}catch(u){_.a.Error("Error on XHR send request."),this._callbackManifestChecked(!1)}},i.prototype.open=function(t,e){var n=this,r=function(){n._isSupported=!1,e&&e()};if(this._idbFactory&&(this._enableSceneOffline||this._enableTexturesOffline))if(this._db)t&&t();else{this._hasReachedQuota=!1,this._isSupported=!0;var o=this._idbFactory.open("babylonjs",1);o.onerror=function(){r()},o.onblocked=function(){_.a.Error("IDB request blocked. Please reload the page."),r()},o.onsuccess=function(){n._db=o.result,t()},o.onupgradeneeded=function(u){if(n._db=u.target.result,n._db)try{n._db.createObjectStore("scenes",{keyPath:"sceneUrl"}),n._db.createObjectStore("versions",{keyPath:"sceneUrl"}),n._db.createObjectStore("textures",{keyPath:"textureUrl"})}catch(f){_.a.Error("Error while creating object stores. Exception: "+f.message),r()}}}else this._isSupported=!1,e&&e()},i.prototype.loadImage=function(t,e){var n=this,r=i._ReturnFullUrlLocation(t),o=function(){n._hasReachedQuota||n._db===null?e.src=t:n._saveImageIntoDBAsync(r,e)};this._mustUpdateRessources?o():this._loadImageFromDBAsync(r,e,o)},i.prototype._loadImageFromDBAsync=function(t,e,n){if(this._isSupported&&this._db!==null){var r,o=this._db.transaction(["textures"]);o.onabort=function(){e.src=t},o.oncomplete=function(){var f;if(r){var v=window.URL||window.webkitURL;f=v.createObjectURL(r.data),e.onerror=function(){_.a.Error("Error loading image from blob URL: "+f+" switching back to web url: "+t),e.src=t},e.src=f}else n()};var u=o.objectStore("textures").get(t);u.onsuccess=function(f){r=f.target.result},u.onerror=function(){_.a.Error("Error loading texture "+t+" from DB."),e.src=t}}else _.a.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),e.src=t},i.prototype._saveImageIntoDBAsync=function(t,e){var n=this;if(this._isSupported){var r=function(){var f;if(o){var v=window.URL||window.webkitURL;try{f=v.createObjectURL(o)}catch(y){f=v.createObjectURL(o)}}f&&(e.src=f)};if(i.IsUASupportingBlobStorage){var o,u=new se.a;u.open("GET",t),u.responseType="blob",u.addEventListener("load",function(){if(u.status===200&&n._db){o=u.response;var f=n._db.transaction(["textures"],"readwrite");f.onabort=function(D){try{var w=(D.srcElement||D.target).error;w&&w.name==="QuotaExceededError"&&(n._hasReachedQuota=!0)}catch(F){}r()},f.oncomplete=function(){r()};var v={textureUrl:t,data:o};try{var y=f.objectStore("textures").put(v);y.onsuccess=function(){},y.onerror=function(){r()}}catch(D){D.code===25&&(i.IsUASupportingBlobStorage=!1,n._enableTexturesOffline=!1),e.src=t}}else e.src=t},!1),u.addEventListener("error",function(){_.a.Error("Error in XHR request in BABYLON.Database."),e.src=t},!1),u.send()}else e.src=t}else _.a.Error("Error: IndexedDB not supported by your browser or Babylon.js database is not open."),e.src=t},i.prototype._checkVersionFromDB=function(t,e){var n=this;this._loadVersionFromDBAsync(t,e,function(){n._saveVersionIntoDBAsync(t,e)})},i.prototype._loadVersionFromDBAsync=function(t,e,n){var r,o=this;if(this._isSupported&&this._db)try{var u=this._db.transaction(["versions"]);u.oncomplete=function(){r?o._manifestVersionFound!==r.data?(o._mustUpdateRessources=!0,n()):e(r.data):(o._mustUpdateRessources=!0,n())},u.onabort=function(){e(-1)};var f=u.objectStore("versions").get(t);f.onsuccess=function(v){r=v.target.result},f.onerror=function(){_.a.Error("Error loading version for scene "+t+" from DB."),e(-1)}}catch(v){_.a.Error("Error while accessing 'versions' object store (READ OP). Exception: "+v.message),e(-1)}else _.a.Error("Error: IndexedDB not supported by your browser or Babylon.js database is not open."),e(-1)},i.prototype._saveVersionIntoDBAsync=function(t,e){var n=this;if(this._isSupported&&!this._hasReachedQuota&&this._db)try{var r=this._db.transaction(["versions"],"readwrite");r.onabort=function(f){try{var v=f.srcElement.error;v&&v.name==="QuotaExceededError"&&(n._hasReachedQuota=!0)}catch(y){}e(-1)},r.oncomplete=function(){e(n._manifestVersionFound)};var o={sceneUrl:t,data:this._manifestVersionFound},u=r.objectStore("versions").put(o);u.onsuccess=function(){},u.onerror=function(){_.a.Error("Error in DB add version request in BABYLON.Database.")}}catch(f){_.a.Error("Error while accessing 'versions' object store (WRITE OP). Exception: "+f.message),e(-1)}else e(-1)},i.prototype.loadFile=function(t,e,n,r,o){var u=this,f=i._ReturnFullUrlLocation(t),v=function(){u._saveFileAsync(f,e,n,o,r)};this._checkVersionFromDB(f,function(y){y!==-1?u._mustUpdateRessources?u._saveFileAsync(f,e,n,o,r):u._loadFileAsync(f,e,v):r&&r()})},i.prototype._loadFileAsync=function(t,e,n){if(this._isSupported&&this._db){var r,o;r=t.indexOf(".babylon")!==-1?"scenes":"textures";var u=this._db.transaction([r]);u.oncomplete=function(){o?e(o.data):n()},u.onabort=function(){n()};var f=u.objectStore(r).get(t);f.onsuccess=function(v){o=v.target.result},f.onerror=function(){_.a.Error("Error loading file "+t+" from DB."),n()}}else _.a.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),e()},i.prototype._saveFileAsync=function(t,e,n,r,o){var u=this;if(this._isSupported){var f;f=t.indexOf(".babylon")!==-1?"scenes":"textures";var v,y=new se.a;y.open("GET",t+"?"+Date.now()),r&&(y.responseType="arraybuffer"),n&&(y.onprogress=n),y.addEventListener("load",function(){if(y.status===200||y.status<400&&i._ValidateXHRData(y,r?6:1))if(v=r?y.response:y.responseText,!u._hasReachedQuota&&u._db){var D,w=u._db.transaction([f],"readwrite");w.onabort=function(z){try{var k=z.srcElement.error;k&&k.name==="QuotaExceededError"&&(u._hasReachedQuota=!0)}catch(K){}e(v)},w.oncomplete=function(){e(v)},D=f==="scenes"?{sceneUrl:t,data:v,version:u._manifestVersionFound}:{textureUrl:t,data:v};try{var F=w.objectStore(f).put(D);F.onsuccess=function(){},F.onerror=function(){_.a.Error("Error in DB add file request in BABYLON.Database.")}}catch(z){e(v)}}else e(v);else y.status>=400&&o?o(y):e()},!1),y.addEventListener("error",function(){_.a.Error("error on XHR request."),e()},!1),y.send()}else _.a.Error("Error: IndexedDB not supported by your browser or Babylon.js database is not open."),e()},i._ValidateXHRData=function(t,e){e===void 0&&(e=7);try{if(1&e){if(t.responseText&&t.responseText.length>0)return!0;if(e===1)return!1}if(2&e){var n=Ph.GetTGAHeader(t.response);if(n.width&&n.height&&n.width>0&&n.height>0)return!0;if(e===2)return!1}if(4&e){var r=new Uint8Array(t.response,0,3);return r[0]===68&&r[1]===68&&r[2]===83}}catch(o){}return!1},i.IsUASupportingBlobStorage=!0,i.IDBStorageEnabled=!1,i._ParseURL=function(t){document.createElement("a").href=t;var e=t.substring(0,t.lastIndexOf("#")),n=t.substring(e.lastIndexOf("/")+1,t.length);return t.substring(0,t.indexOf(n,0))},i._ReturnFullUrlLocation=function(t){return t.indexOf("http:/")===-1&&t.indexOf("https:/")===-1&&typeof window!="undefined"?i._ParseURL(window.location.href)+t:t},i}(),Ym=function(){function i(t,e,n){this.gradient=t,this.color1=e,this.color2=n}return i.prototype.getColorToRef=function(t){this.color2?M.b.LerpToRef(this.color1,this.color2,Math.random(),t):t.copyFrom(this.color1)},i}(),uE=function(i,t){this.gradient=i,this.color=t},Km=function(){function i(t,e,n){this.gradient=t,this.factor1=e,this.factor2=n}return i.prototype.getFactor=function(){return this.factor2===void 0||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()},i}(),wr=function(){function i(){}return i.GetCurrentGradient=function(t,e,n){if(e[0].gradient>t)n(e[0],e[0],1);else{for(var r=0;r<e.length-1;r++){var o=e[r],u=e[r+1];if(t>=o.gradient&&t<=u.gradient)return void n(o,u,(t-o.gradient)/(u.gradient-o.gradient))}var f=e.length-1;n(e[f],e[f],1)}},i}(),hE=function(){function i(t){this.particleSystem=t,this.position=d.e.Zero(),this.direction=d.e.Zero(),this.color=new M.b(0,0,0,0),this.colorStep=new M.b(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new d.d(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new M.b(0,0,0,0),this._currentColor2=new M.b(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=i._Count++,this.particleSystem.isAnimationSheetEnabled&&this.updateCellInfoFromSystem()}return i.prototype.updateCellInfoFromSystem=function(){this.cellIndex=this.particleSystem.startSpriteCellID},i.prototype.updateCellIndex=function(){var t=this.age,e=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(this._randomCellOffset===void 0&&(this._randomCellOffset=Math.random()*this.lifeTime),e===0?(e=1,t=this._randomCellOffset):t+=this._randomCellOffset);var n=this._initialEndSpriteCellID-this._initialStartSpriteCellID,r=te.a.Clamp(t*e%this.lifeTime/this.lifeTime);this.cellIndex=this._initialStartSpriteCellID+r*n|0},i.prototype._inheritParticleInfoToSubEmitter=function(t){if(t.particleSystem.emitter.position){var e=t.particleSystem.emitter;if(e.position.copyFrom(this.position),t.inheritDirection){var n=d.c.Vector3[0];this.direction.normalizeToRef(n),e.setDirection(n,0,Math.PI/2)}}else t.particleSystem.emitter.copyFrom(this.position);this.direction.scaleToRef(t.inheritedVelocityAmount/2,d.c.Vector3[0]),t.particleSystem._inheritedVelocityOffset.copyFrom(d.c.Vector3[0])},i.prototype._inheritParticleInfoToSubEmitters=function(){var t=this;this._attachedSubEmitters&&this._attachedSubEmitters.length>0&&this._attachedSubEmitters.forEach(function(e){t._inheritParticleInfoToSubEmitter(e)})},i.prototype._reset=function(){this.age=0,this.id=i._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0},i.prototype.copyTo=function(t){t.position.copyFrom(this.position),this._initialDirection?t._initialDirection?t._initialDirection.copyFrom(this._initialDirection):t._initialDirection=this._initialDirection.clone():t._initialDirection=null,t.direction.copyFrom(this.direction),this._localPosition&&(t._localPosition?t._localPosition.copyFrom(this._localPosition):t._localPosition=this._localPosition.clone()),t.color.copyFrom(this.color),t.colorStep.copyFrom(this.colorStep),t.lifeTime=this.lifeTime,t.age=this.age,t._randomCellOffset=this._randomCellOffset,t.size=this.size,t.scale.copyFrom(this.scale),t.angle=this.angle,t.angularSpeed=this.angularSpeed,t.particleSystem=this.particleSystem,t.cellIndex=this.cellIndex,t.id=this.id,t._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(t._currentColorGradient=this._currentColorGradient,t._currentColor1.copyFrom(this._currentColor1),t._currentColor2.copyFrom(this._currentColor2)),this._currentSizeGradient&&(t._currentSizeGradient=this._currentSizeGradient,t._currentSize1=this._currentSize1,t._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(t._currentAngularSpeedGradient=this._currentAngularSpeedGradient,t._currentAngularSpeed1=this._currentAngularSpeed1,t._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(t._currentVelocityGradient=this._currentVelocityGradient,t._currentVelocity1=this._currentVelocity1,t._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(t._currentLimitVelocityGradient=this._currentLimitVelocityGradient,t._currentLimitVelocity1=this._currentLimitVelocity1,t._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(t._currentDragGradient=this._currentDragGradient,t._currentDrag1=this._currentDrag1,t._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(t._initialStartSpriteCellID=this._initialStartSpriteCellID,t._initialEndSpriteCellID=this._initialEndSpriteCellID),this.particleSystem.useRampGradients&&(t.remapData&&this.remapData?t.remapData.copyFrom(this.remapData):t.remapData=new d.f(0,0,0,0)),this._randomNoiseCoordinates1&&(t._randomNoiseCoordinates1?(t._randomNoiseCoordinates1.copyFrom(this._randomNoiseCoordinates1),t._randomNoiseCoordinates2.copyFrom(this._randomNoiseCoordinates2)):(t._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),t._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))},i._Count=0,i}();(function(i){i[i.ATTACHED=0]="ATTACHED",i[i.END=1]="END"})(Ls||(Ls={}));var Sl=function(){function i(t){if(this.particleSystem=t,this.type=Ls.END,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!t.emitter||!t.emitter.dispose){var e=C.a.GetClass("BABYLON.AbstractMesh");t.emitter=new e("SubemitterSystemEmitter",t.getScene())}t.onDisposeObservable.add(function(){t.emitter&&t.emitter.dispose&&t.emitter.dispose()})}return i.prototype.clone=function(){var t=this.particleSystem.emitter;t?t instanceof d.e?t=t.clone():t.getClassName().indexOf("Mesh")!==-1&&((t=new(C.a.GetClass("BABYLON.Mesh"))("",t.getScene())).isVisible=!1):t=new d.e;var e=new i(this.particleSystem.clone("",t));return e.particleSystem.name+="Clone",e.type=this.type,e.inheritDirection=this.inheritDirection,e.inheritedVelocityAmount=this.inheritedVelocityAmount,e.particleSystem._disposeEmitterOnDispose=!0,e.particleSystem.disposeOnStop=!0,e},i.prototype.serialize=function(){var t={};return t.type=this.type,t.inheritDirection=this.inheritDirection,t.inheritedVelocityAmount=this.inheritedVelocityAmount,t.particleSystem=this.particleSystem.serialize(),t},i._ParseParticleSystem=function(t,e,n){throw dr.a.WarnImport("ParseParticle")},i.Parse=function(t,e,n){var r=t.particleSystem,o=new i(i._ParseParticleSystem(r,e,n));return o.type=t.type,o.inheritDirection=t.inheritDirection,o.inheritedVelocityAmount=t.inheritedVelocityAmount,o.particleSystem._isSubEmitter=!0,o},i.prototype.dispose=function(){this.particleSystem.dispose()},i}(),rL=`
varying vec2 vUV;
varying vec4 vColor;
uniform vec4 textureMask;
uniform sampler2D diffuseSampler;
#include<clipPlaneFragmentDeclaration>
#include<imageProcessingDeclaration>
#include<helperFunctions>
#include<imageProcessingFunctions>
#ifdef RAMPGRADIENT
varying vec4 remapRanges;
uniform sampler2D rampSampler;
#endif
void main(void) {
#include<clipPlaneFragment>
vec4 textureColor=texture2D(diffuseSampler,vUV);
vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;
#ifdef RAMPGRADIENT
float alpha=baseColor.a;
float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);
vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));
baseColor.rgb*=rampColor.rgb;

float finalAlpha=baseColor.a;
baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);
#endif
#ifdef BLENDMULTIPLYMODE
float sourceAlpha=vColor.a*textureColor.a;
baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);
#endif


#ifdef IMAGEPROCESSINGPOSTPROCESS
baseColor.rgb=toLinearSpace(baseColor.rgb);
#else
#ifdef IMAGEPROCESSING
baseColor.rgb=toLinearSpace(baseColor.rgb);
baseColor=applyImageProcessing(baseColor);
#endif
#endif
gl_FragColor=baseColor;
}`;Ye.a.ShadersStore.particlesPixelShader=rL;var iL=`
attribute vec3 position;
attribute vec4 color;
attribute float angle;
attribute vec2 size;
#ifdef ANIMATESHEET
attribute float cellIndex;
#endif
#ifndef BILLBOARD
attribute vec3 direction;
#endif
#ifdef BILLBOARDSTRETCHED
attribute vec3 direction;
#endif
#ifdef RAMPGRADIENT
attribute vec4 remapData;
#endif
attribute vec2 offset;

uniform mat4 view;
uniform mat4 projection;
uniform vec2 translationPivot;
#ifdef ANIMATESHEET
uniform vec3 particlesInfos;
#endif

varying vec2 vUV;
varying vec4 vColor;
varying vec3 vPositionW;
#ifdef RAMPGRADIENT
varying vec4 remapRanges;
#endif
#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)
uniform mat4 invView;
#endif
#include<clipPlaneVertexDeclaration>
#ifdef BILLBOARD
uniform vec3 eyePosition;
#endif
vec3 rotate(vec3 yaxis,vec3 rotatedCorner) {
vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));
vec3 zaxis=normalize(cross(yaxis,xaxis));
vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);
vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);
vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);
mat3 rotMatrix=mat3(row0,row1,row2);
vec3 alignedCorner=rotMatrix*rotatedCorner;
return position+alignedCorner;
}
#ifdef BILLBOARDSTRETCHED
vec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {
vec3 normalizedToCamera=normalize(toCamera);
vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));
vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));
vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);
vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);
vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);
mat3 rotMatrix=mat3(row0,row1,row2);
vec3 alignedCorner=rotMatrix*rotatedCorner;
return position+alignedCorner;
}
#endif
void main(void) {
vec2 cornerPos;
cornerPos=(vec2(offset.x-0.5,offset.y-0.5)-translationPivot)*size+translationPivot;
#ifdef BILLBOARD

vec3 rotatedCorner;
#ifdef BILLBOARDY
rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);
rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);
rotatedCorner.y=0.;
vec3 yaxis=position-eyePosition;
yaxis.y=0.;
vPositionW=rotate(normalize(yaxis),rotatedCorner);
vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;
#elif defined(BILLBOARDSTRETCHED)
rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);
rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);
rotatedCorner.z=0.;
vec3 toCamera=position-eyePosition;
vPositionW=rotateAlign(toCamera,rotatedCorner);
vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;
#else
rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);
rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);
rotatedCorner.z=0.;
vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;
vPositionW=(invView*vec4(viewPos,1)).xyz;
#endif
#ifdef RAMPGRADIENT
remapRanges=remapData;
#endif

gl_Position=projection*vec4(viewPos,1.0);
#else

vec3 rotatedCorner;
rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);
rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);
rotatedCorner.y=0.;
vec3 yaxis=normalize(direction);
vPositionW=rotate(yaxis,rotatedCorner);
gl_Position=projection*view*vec4(vPositionW,1.0);
#endif
vColor=color;
#ifdef ANIMATESHEET
float rowOffset=floor(cellIndex*particlesInfos.z);
float columnOffset=cellIndex-rowOffset/particlesInfos.z;
vec2 uvScale=particlesInfos.xy;
vec2 uvOffset=vec2(offset.x ,1.0-offset.y);
vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;
#else
vUV=offset;
#endif

#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)
vec4 worldPos=vec4(vPositionW,1.0);
#endif
#include<clipPlaneVertex>
}`;Ye.a.ShadersStore.particlesVertexShader=iL;var er=function(i){function t(e,n,r,o,u,f){o===void 0&&(o=null),u===void 0&&(u=!1),f===void 0&&(f=.01);var v=i.call(this,e)||this;return v._inheritedVelocityOffset=new d.e,v.onDisposeObservable=new S.c,v.onStoppedObservable=new S.c,v._particles=new Array,v._stockParticles=new Array,v._newPartsExcess=0,v._vertexBuffers={},v._scaledColorStep=new M.b(0,0,0,0),v._colorDiff=new M.b(0,0,0,0),v._scaledDirection=d.e.Zero(),v._scaledGravity=d.e.Zero(),v._currentRenderId=-1,v._useInstancing=!1,v._started=!1,v._stopped=!1,v._actualFrame=0,v._currentEmitRate1=0,v._currentEmitRate2=0,v._currentStartSize1=0,v._currentStartSize2=0,v._rawTextureWidth=256,v._useRampGradients=!1,v._disposeEmitterOnDispose=!1,v.isLocal=!1,v._onBeforeDrawParticlesObservable=null,v.recycleParticle=function(y){var D=v._particles.pop();D!==y&&D.copyTo(y),v._stockParticles.push(D)},v._createParticle=function(){var y;if(v._stockParticles.length!==0?(y=v._stockParticles.pop())._reset():y=new hE(v),v._subEmitters&&v._subEmitters.length>0){var D=v._subEmitters[Math.floor(Math.random()*v._subEmitters.length)];y._attachedSubEmitters=[],D.forEach(function(w){if(w.type===Ls.ATTACHED){var F=w.clone();y._attachedSubEmitters.push(F),F.particleSystem.start()}})}return y},v._emitFromParticle=function(y){if(v._subEmitters&&v._subEmitters.length!==0){var D=Math.floor(Math.random()*v._subEmitters.length);v._subEmitters[D].forEach(function(w){if(w.type===Ls.END){var F=w.clone();y._inheritParticleInfoToSubEmitter(F),F.particleSystem._rootParticleSystem=v,v.activeSubSystems.push(F.particleSystem),F.particleSystem.start()}})}},v._capacity=n,v._epsilon=f,v._isAnimationSheetEnabled=u,r&&r.getClassName()!=="Scene"?(v._engine=r,v.defaultProjectionMatrix=d.a.PerspectiveFovLH(.8,1,.1,100)):(v._scene=r||ne.a.LastCreatedScene,v._engine=v._scene.getEngine(),v.uniqueId=v._scene.getUniqueId(),v._scene.particleSystems.push(v)),v._engine.getCaps().vertexArrayObject&&(v._vertexArrayObject=null),v._attachImageProcessingConfiguration(null),v._customEffect={0:o},v._useInstancing=v._engine.getCaps().instancedArrays,v._createIndexBuffer(),v._createVertexBuffers(),v.particleEmitterType=new Ds,v.updateFunction=function(y){var D=null,w=null;v.noiseTexture&&(D=v.noiseTexture.getSize(),w=v.noiseTexture.getContent());for(var F,z=function(){F=y[k];var K=v._scaledUpdateSpeed,oe=F.age;if(F.age+=K,F.age>F.lifeTime){var ae=F.age-oe;K=(F.lifeTime-oe)*K/ae,F.age=F.lifeTime}var ue=F.age/F.lifeTime;v._colorGradients&&v._colorGradients.length>0?wr.GetCurrentGradient(ue,v._colorGradients,function(Re,Pe,Ce){Re!==F._currentColorGradient&&(F._currentColor1.copyFrom(F._currentColor2),Pe.getColorToRef(F._currentColor2),F._currentColorGradient=Re),M.b.LerpToRef(F._currentColor1,F._currentColor2,Ce,F.color)}):(F.colorStep.scaleToRef(K,v._scaledColorStep),F.color.addInPlace(v._scaledColorStep),F.color.a<0&&(F.color.a=0)),v._angularSpeedGradients&&v._angularSpeedGradients.length>0&&wr.GetCurrentGradient(ue,v._angularSpeedGradients,function(Re,Pe,Ce){Re!==F._currentAngularSpeedGradient&&(F._currentAngularSpeed1=F._currentAngularSpeed2,F._currentAngularSpeed2=Pe.getFactor(),F._currentAngularSpeedGradient=Re),F.angularSpeed=te.a.Lerp(F._currentAngularSpeed1,F._currentAngularSpeed2,Ce)}),F.angle+=F.angularSpeed*K;var de=K;if(v._velocityGradients&&v._velocityGradients.length>0&&wr.GetCurrentGradient(ue,v._velocityGradients,function(Re,Pe,Ce){Re!==F._currentVelocityGradient&&(F._currentVelocity1=F._currentVelocity2,F._currentVelocity2=Pe.getFactor(),F._currentVelocityGradient=Re),de*=te.a.Lerp(F._currentVelocity1,F._currentVelocity2,Ce)}),F.direction.scaleToRef(de,v._scaledDirection),v._limitVelocityGradients&&v._limitVelocityGradients.length>0&&wr.GetCurrentGradient(ue,v._limitVelocityGradients,function(Re,Pe,Ce){Re!==F._currentLimitVelocityGradient&&(F._currentLimitVelocity1=F._currentLimitVelocity2,F._currentLimitVelocity2=Pe.getFactor(),F._currentLimitVelocityGradient=Re);var Be=te.a.Lerp(F._currentLimitVelocity1,F._currentLimitVelocity2,Ce);F.direction.length()>Be&&F.direction.scaleInPlace(v.limitVelocityDamping)}),v._dragGradients&&v._dragGradients.length>0&&wr.GetCurrentGradient(ue,v._dragGradients,function(Re,Pe,Ce){Re!==F._currentDragGradient&&(F._currentDrag1=F._currentDrag2,F._currentDrag2=Pe.getFactor(),F._currentDragGradient=Re);var Be=te.a.Lerp(F._currentDrag1,F._currentDrag2,Ce);v._scaledDirection.scaleInPlace(1-Be)}),v.isLocal&&F._localPosition?(F._localPosition.addInPlace(v._scaledDirection),d.e.TransformCoordinatesToRef(F._localPosition,v._emitterWorldMatrix,F.position)):F.position.addInPlace(v._scaledDirection),w&&D&&F._randomNoiseCoordinates1){var me=v._fetchR(F._randomNoiseCoordinates1.x,F._randomNoiseCoordinates1.y,D.width,D.height,w),ye=v._fetchR(F._randomNoiseCoordinates1.z,F._randomNoiseCoordinates2.x,D.width,D.height,w),Ee=v._fetchR(F._randomNoiseCoordinates2.y,F._randomNoiseCoordinates2.z,D.width,D.height,w),Ae=d.c.Vector3[0],Ie=d.c.Vector3[1];Ae.copyFromFloats((2*me-1)*v.noiseStrength.x,(2*ye-1)*v.noiseStrength.y,(2*Ee-1)*v.noiseStrength.z),Ae.scaleToRef(K,Ie),F.direction.addInPlace(Ie)}if(v.gravity.scaleToRef(K,v._scaledGravity),F.direction.addInPlace(v._scaledGravity),v._sizeGradients&&v._sizeGradients.length>0&&wr.GetCurrentGradient(ue,v._sizeGradients,function(Re,Pe,Ce){Re!==F._currentSizeGradient&&(F._currentSize1=F._currentSize2,F._currentSize2=Pe.getFactor(),F._currentSizeGradient=Re),F.size=te.a.Lerp(F._currentSize1,F._currentSize2,Ce)}),v._useRampGradients&&(v._colorRemapGradients&&v._colorRemapGradients.length>0&&wr.GetCurrentGradient(ue,v._colorRemapGradients,function(Re,Pe,Ce){var Be=te.a.Lerp(Re.factor1,Pe.factor1,Ce),Oe=te.a.Lerp(Re.factor2,Pe.factor2,Ce);F.remapData.x=Be,F.remapData.y=Oe-Be}),v._alphaRemapGradients&&v._alphaRemapGradients.length>0&&wr.GetCurrentGradient(ue,v._alphaRemapGradients,function(Re,Pe,Ce){var Be=te.a.Lerp(Re.factor1,Pe.factor1,Ce),Oe=te.a.Lerp(Re.factor2,Pe.factor2,Ce);F.remapData.z=Be,F.remapData.w=Oe-Be})),v._isAnimationSheetEnabled&&F.updateCellIndex(),F._inheritParticleInfoToSubEmitters(),F.age>=F.lifeTime)return v._emitFromParticle(F),F._attachedSubEmitters&&(F._attachedSubEmitters.forEach(function(Re){Re.particleSystem.disposeOnStop=!0,Re.particleSystem.stop()}),F._attachedSubEmitters=null),v.recycleParticle(F),k--,"continue"},k=0;k<y.length;k++)z()},v}return Object(p.d)(t,i),Object.defineProperty(t.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"useRampGradients",{get:function(){return this._useRampGradients},set:function(e){this._useRampGradients!==e&&(this._useRampGradients=e,this._resetEffect())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"particles",{get:function(){return this._particles},enumerable:!1,configurable:!0}),t.prototype.getActiveCount=function(){return this._particles.length},t.prototype.getClassName=function(){return"ParticleSystem"},t.prototype.isStopping=function(){return this._stopped&&this.isAlive()},t.prototype.getCustomEffect=function(e){var n;return e===void 0&&(e=0),(n=this._customEffect[e])!==null&&n!==void 0?n:this._customEffect[0]},t.prototype.setCustomEffect=function(e,n){n===void 0&&(n=0),this._customEffect[n]=e},Object.defineProperty(t.prototype,"onBeforeDrawParticlesObservable",{get:function(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new S.c),this._onBeforeDrawParticlesObservable},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"vertexShaderName",{get:function(){return"particles"},enumerable:!1,configurable:!0}),t.prototype._addFactorGradient=function(e,n,r,o){var u=new Km(n,r,o);e.push(u),e.sort(function(f,v){return f.gradient<v.gradient?-1:f.gradient>v.gradient?1:0})},t.prototype._removeFactorGradient=function(e,n){if(e)for(var r=0,o=0,u=e;o<u.length;o++){if(u[o].gradient===n){e.splice(r,1);break}r++}},t.prototype.addLifeTimeGradient=function(e,n,r){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,e,n,r),this},t.prototype.removeLifeTimeGradient=function(e){return this._removeFactorGradient(this._lifeTimeGradients,e),this},t.prototype.addSizeGradient=function(e,n,r){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,e,n,r),this},t.prototype.removeSizeGradient=function(e){return this._removeFactorGradient(this._sizeGradients,e),this},t.prototype.addColorRemapGradient=function(e,n,r){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,e,n,r),this},t.prototype.removeColorRemapGradient=function(e){return this._removeFactorGradient(this._colorRemapGradients,e),this},t.prototype.addAlphaRemapGradient=function(e,n,r){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,e,n,r),this},t.prototype.removeAlphaRemapGradient=function(e){return this._removeFactorGradient(this._alphaRemapGradients,e),this},t.prototype.addAngularSpeedGradient=function(e,n,r){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,e,n,r),this},t.prototype.removeAngularSpeedGradient=function(e){return this._removeFactorGradient(this._angularSpeedGradients,e),this},t.prototype.addVelocityGradient=function(e,n,r){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,e,n,r),this},t.prototype.removeVelocityGradient=function(e){return this._removeFactorGradient(this._velocityGradients,e),this},t.prototype.addLimitVelocityGradient=function(e,n,r){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,e,n,r),this},t.prototype.removeLimitVelocityGradient=function(e){return this._removeFactorGradient(this._limitVelocityGradients,e),this},t.prototype.addDragGradient=function(e,n,r){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,e,n,r),this},t.prototype.removeDragGradient=function(e){return this._removeFactorGradient(this._dragGradients,e),this},t.prototype.addEmitRateGradient=function(e,n,r){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,e,n,r),this},t.prototype.removeEmitRateGradient=function(e){return this._removeFactorGradient(this._emitRateGradients,e),this},t.prototype.addStartSizeGradient=function(e,n,r){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,e,n,r),this},t.prototype.removeStartSizeGradient=function(e){return this._removeFactorGradient(this._startSizeGradients,e),this},t.prototype._createRampGradientTexture=function(){if(this._rampGradients&&this._rampGradients.length&&!this._rampGradientsTexture&&this._scene){for(var e=new Uint8Array(4*this._rawTextureWidth),n=M.c.Color3[0],r=0;r<this._rawTextureWidth;r++){var o=r/this._rawTextureWidth;wr.GetCurrentGradient(o,this._rampGradients,function(u,f,v){M.a.LerpToRef(u.color,f.color,v,n),e[4*r]=255*n.r,e[4*r+1]=255*n.g,e[4*r+2]=255*n.b,e[4*r+3]=255})}this._rampGradientsTexture=Pr.CreateRGBATexture(e,this._rawTextureWidth,1,this._scene,!1,!1,g.a.TEXTURE_NEAREST_SAMPLINGMODE)}},t.prototype.getRampGradients=function(){return this._rampGradients},t.prototype.forceRefreshGradients=function(){this._syncRampGradientTexture()},t.prototype._syncRampGradientTexture=function(){this._rampGradients&&(this._rampGradients.sort(function(e,n){return e.gradient<n.gradient?-1:e.gradient>n.gradient?1:0}),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())},t.prototype.addRampGradient=function(e,n){this._rampGradients||(this._rampGradients=[]);var r=new uE(e,n);return this._rampGradients.push(r),this._syncRampGradientTexture(),this},t.prototype.removeRampGradient=function(e){return this._removeGradientAndTexture(e,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this},t.prototype.addColorGradient=function(e,n,r){this._colorGradients||(this._colorGradients=[]);var o=new Ym(e,n,r);return this._colorGradients.push(o),this._colorGradients.sort(function(u,f){return u.gradient<f.gradient?-1:u.gradient>f.gradient?1:0}),this},t.prototype.removeColorGradient=function(e){if(!this._colorGradients)return this;for(var n=0,r=0,o=this._colorGradients;r<o.length;r++){if(o[r].gradient===e){this._colorGradients.splice(n,1);break}n++}return this},t.prototype._fetchR=function(e,n,r,o,u){return u[4*(((e=.5*Math.abs(e)+.5)*r%r|0)+((n=.5*Math.abs(n)+.5)*o%o|0)*r)]/255},t.prototype._reset=function(){this._resetEffect()},t.prototype._resetEffect=function(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()},t.prototype._createVertexBuffers=function(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&this.billboardMode!==t.BILLBOARDMODE_STRETCHED||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);var e=this._engine;this._vertexData=new Float32Array(this._capacity*this._vertexBufferSize*(this._useInstancing?1:4)),this._vertexBuffer=new De.a(e,this._vertexData,!0,this._vertexBufferSize);var n=0,r=this._vertexBuffer.createVertexBuffer(De.b.PositionKind,n,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[De.b.PositionKind]=r,n+=3;var o=this._vertexBuffer.createVertexBuffer(De.b.ColorKind,n,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[De.b.ColorKind]=o,n+=4;var u=this._vertexBuffer.createVertexBuffer("angle",n,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=u,n+=1;var f,v=this._vertexBuffer.createVertexBuffer("size",n,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=v,n+=2,this._isAnimationSheetEnabled){var y=this._vertexBuffer.createVertexBuffer("cellIndex",n,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=y,n+=1}if(!this._isBillboardBased||this.billboardMode===t.BILLBOARDMODE_STRETCHED){var D=this._vertexBuffer.createVertexBuffer("direction",n,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=D,n+=3}if(this._useRampGradients){var w=this._vertexBuffer.createVertexBuffer("remapData",n,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=w,n+=4}if(this._useInstancing){var F=new Float32Array([0,0,1,0,1,1,0,1]);this._spriteBuffer=new De.a(e,F,!1,2),f=this._spriteBuffer.createVertexBuffer("offset",0,2)}else f=this._vertexBuffer.createVertexBuffer("offset",n,2,this._vertexBufferSize,this._useInstancing),n+=2;this._vertexBuffers.offset=f},t.prototype._createIndexBuffer=function(){if(!this._useInstancing){for(var e=[],n=0,r=0;r<this._capacity;r++)e.push(n),e.push(n+1),e.push(n+2),e.push(n),e.push(n+2),e.push(n+3),n+=4;this._indexBuffer=this._engine.createIndexBuffer(e)}},t.prototype.getCapacity=function(){return this._capacity},t.prototype.isAlive=function(){return this._alive},t.prototype.isStarted=function(){return this._started},t.prototype._prepareSubEmitterInternalArray=function(){var e=this;this._subEmitters=new Array,this.subEmitters&&this.subEmitters.forEach(function(n){n instanceof t?e._subEmitters.push([new Sl(n)]):n instanceof Sl?e._subEmitters.push([n]):n instanceof Array&&e._subEmitters.push(n)})},t.prototype.start=function(e){var n,r=this;if(e===void 0&&(e=this.startDelay),!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(e)setTimeout(function(){r.start(0)},e);else{if(this._prepareSubEmitterInternalArray(),this._started=!0,this._stopped=!1,this._actualFrame=0,this._subEmitters&&this._subEmitters.length!=0&&(this.activeSubSystems=new Array),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){((n=this.emitter)===null||n===void 0?void 0:n.getClassName().indexOf("Mesh"))!==-1&&this.emitter.computeWorldMatrix(!0);var o=this.noiseTexture;if(o&&o.onGeneratedObservable)o.onGeneratedObservable.addOnce(function(){setTimeout(function(){for(var f=0;f<r.preWarmCycles;f++)r.animate(!0),o.render()})});else for(var u=0;u<this.preWarmCycles;u++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop)}},t.prototype.stop=function(e){e===void 0&&(e=!0),this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,e&&this._stopSubEmitters())},t.prototype.reset=function(){this._stockParticles=[],this._particles=[]},t.prototype._appendParticleVertex=function(e,n,r,o){var u=e*this._vertexBufferSize;if(this._vertexData[u++]=n.position.x+this.worldOffset.x,this._vertexData[u++]=n.position.y+this.worldOffset.y,this._vertexData[u++]=n.position.z+this.worldOffset.z,this._vertexData[u++]=n.color.r,this._vertexData[u++]=n.color.g,this._vertexData[u++]=n.color.b,this._vertexData[u++]=n.color.a,this._vertexData[u++]=n.angle,this._vertexData[u++]=n.scale.x*n.size,this._vertexData[u++]=n.scale.y*n.size,this._isAnimationSheetEnabled&&(this._vertexData[u++]=n.cellIndex),this._isBillboardBased)this.billboardMode===t.BILLBOARDMODE_STRETCHED&&(this._vertexData[u++]=n.direction.x,this._vertexData[u++]=n.direction.y,this._vertexData[u++]=n.direction.z);else if(n._initialDirection){var f=n._initialDirection;this.isLocal&&(d.e.TransformNormalToRef(f,this._emitterWorldMatrix,d.c.Vector3[0]),f=d.c.Vector3[0]),f.x===0&&f.z===0&&(f.x=.001),this._vertexData[u++]=f.x,this._vertexData[u++]=f.y,this._vertexData[u++]=f.z}else{var v=n.direction;this.isLocal&&(d.e.TransformNormalToRef(v,this._emitterWorldMatrix,d.c.Vector3[0]),v=d.c.Vector3[0]),v.x===0&&v.z===0&&(v.x=.001),this._vertexData[u++]=v.x,this._vertexData[u++]=v.y,this._vertexData[u++]=v.z}this._useRampGradients&&n.remapData&&(this._vertexData[u++]=n.remapData.x,this._vertexData[u++]=n.remapData.y,this._vertexData[u++]=n.remapData.z,this._vertexData[u++]=n.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(r===0?r=this._epsilon:r===1&&(r=1-this._epsilon),o===0?o=this._epsilon:o===1&&(o=1-this._epsilon)),this._vertexData[u++]=r,this._vertexData[u++]=o)},t.prototype._stopSubEmitters=function(){this.activeSubSystems&&(this.activeSubSystems.forEach(function(e){e.stop(!0)}),this.activeSubSystems=new Array)},t.prototype._removeFromRoot=function(){if(this._rootParticleSystem){var e=this._rootParticleSystem.activeSubSystems.indexOf(this);e!==-1&&this._rootParticleSystem.activeSubSystems.splice(e,1),this._rootParticleSystem=null}},t.prototype._update=function(e){var n,r=this;if(this._alive=this._particles.length>0,this.emitter.position){var o=this.emitter;this._emitterWorldMatrix=o.getWorldMatrix()}else{var u=this.emitter;this._emitterWorldMatrix=d.a.Translation(u.x,u.y,u.z)}this.updateFunction(this._particles);for(var f,v=function(){if(y._particles.length===y._capacity)return"break";if(n=y._createParticle(),y._particles.push(n),y.targetStopDuration&&y._lifeTimeGradients&&y._lifeTimeGradients.length>0){var w=te.a.Clamp(y._actualFrame/y.targetStopDuration);wr.GetCurrentGradient(w,y._lifeTimeGradients,function(k,K){var oe=k,ae=K,ue=oe.getFactor(),de=ae.getFactor(),me=(w-oe.gradient)/(ae.gradient-oe.gradient);n.lifeTime=te.a.Lerp(ue,de,me)})}else n.lifeTime=te.a.RandomRange(y.minLifeTime,y.maxLifeTime);var F=te.a.RandomRange(y.minEmitPower,y.maxEmitPower);if(y.startPositionFunction?y.startPositionFunction(y._emitterWorldMatrix,n.position,n,y.isLocal):y.particleEmitterType.startPositionFunction(y._emitterWorldMatrix,n.position,n,y.isLocal),y.isLocal&&(n._localPosition?n._localPosition.copyFrom(n.position):n._localPosition=n.position.clone(),d.e.TransformCoordinatesToRef(n._localPosition,y._emitterWorldMatrix,n.position)),y.startDirectionFunction?y.startDirectionFunction(y._emitterWorldMatrix,n.direction,n,y.isLocal):y.particleEmitterType.startDirectionFunction(y._emitterWorldMatrix,n.direction,n,y.isLocal),F===0?n._initialDirection?n._initialDirection.copyFrom(n.direction):n._initialDirection=n.direction.clone():n._initialDirection=null,n.direction.scaleInPlace(F),y._sizeGradients&&y._sizeGradients.length!==0?(n._currentSizeGradient=y._sizeGradients[0],n._currentSize1=n._currentSizeGradient.getFactor(),n.size=n._currentSize1,y._sizeGradients.length>1?n._currentSize2=y._sizeGradients[1].getFactor():n._currentSize2=n._currentSize1):n.size=te.a.RandomRange(y.minSize,y.maxSize),n.scale.copyFromFloats(te.a.RandomRange(y.minScaleX,y.maxScaleX),te.a.RandomRange(y.minScaleY,y.maxScaleY)),y._startSizeGradients&&y._startSizeGradients[0]&&y.targetStopDuration){var z=y._actualFrame/y.targetStopDuration;wr.GetCurrentGradient(z,y._startSizeGradients,function(k,K,oe){k!==r._currentStartSizeGradient&&(r._currentStartSize1=r._currentStartSize2,r._currentStartSize2=K.getFactor(),r._currentStartSizeGradient=k);var ae=te.a.Lerp(r._currentStartSize1,r._currentStartSize2,oe);n.scale.scaleInPlace(ae)})}y._angularSpeedGradients&&y._angularSpeedGradients.length!==0?(n._currentAngularSpeedGradient=y._angularSpeedGradients[0],n.angularSpeed=n._currentAngularSpeedGradient.getFactor(),n._currentAngularSpeed1=n.angularSpeed,y._angularSpeedGradients.length>1?n._currentAngularSpeed2=y._angularSpeedGradients[1].getFactor():n._currentAngularSpeed2=n._currentAngularSpeed1):n.angularSpeed=te.a.RandomRange(y.minAngularSpeed,y.maxAngularSpeed),n.angle=te.a.RandomRange(y.minInitialRotation,y.maxInitialRotation),y._velocityGradients&&y._velocityGradients.length>0&&(n._currentVelocityGradient=y._velocityGradients[0],n._currentVelocity1=n._currentVelocityGradient.getFactor(),y._velocityGradients.length>1?n._currentVelocity2=y._velocityGradients[1].getFactor():n._currentVelocity2=n._currentVelocity1),y._limitVelocityGradients&&y._limitVelocityGradients.length>0&&(n._currentLimitVelocityGradient=y._limitVelocityGradients[0],n._currentLimitVelocity1=n._currentLimitVelocityGradient.getFactor(),y._limitVelocityGradients.length>1?n._currentLimitVelocity2=y._limitVelocityGradients[1].getFactor():n._currentLimitVelocity2=n._currentLimitVelocity1),y._dragGradients&&y._dragGradients.length>0&&(n._currentDragGradient=y._dragGradients[0],n._currentDrag1=n._currentDragGradient.getFactor(),y._dragGradients.length>1?n._currentDrag2=y._dragGradients[1].getFactor():n._currentDrag2=n._currentDrag1),y._colorGradients&&y._colorGradients.length!==0?(n._currentColorGradient=y._colorGradients[0],n._currentColorGradient.getColorToRef(n.color),n._currentColor1.copyFrom(n.color),y._colorGradients.length>1?y._colorGradients[1].getColorToRef(n._currentColor2):n._currentColor2.copyFrom(n.color)):(f=te.a.RandomRange(0,1),M.b.LerpToRef(y.color1,y.color2,f,n.color),y.colorDead.subtractToRef(n.color,y._colorDiff),y._colorDiff.scaleToRef(1/n.lifeTime,n.colorStep)),y._isAnimationSheetEnabled&&(n._initialStartSpriteCellID=y.startSpriteCellID,n._initialEndSpriteCellID=y.endSpriteCellID),n.direction.addInPlace(y._inheritedVelocityOffset),y._useRampGradients&&(n.remapData=new d.f(0,1,0,1)),y.noiseTexture&&(n._randomNoiseCoordinates1?(n._randomNoiseCoordinates1.copyFromFloats(Math.random(),Math.random(),Math.random()),n._randomNoiseCoordinates2.copyFromFloats(Math.random(),Math.random(),Math.random())):(n._randomNoiseCoordinates1=new d.e(Math.random(),Math.random(),Math.random()),n._randomNoiseCoordinates2=new d.e(Math.random(),Math.random(),Math.random()))),n._inheritParticleInfoToSubEmitters()},y=this,D=0;D<e&&v()!=="break";D++);},t._GetAttributeNamesOrOptions=function(e,n,r){e===void 0&&(e=!1),n===void 0&&(n=!1),r===void 0&&(r=!1);var o=[De.b.PositionKind,De.b.ColorKind,"angle","offset","size"];return e&&o.push("cellIndex"),n||o.push("direction"),r&&o.push("remapData"),o},t._GetEffectCreationOptions=function(e){e===void 0&&(e=!1);var n=["invView","view","projection","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","textureMask","translationPivot","eyePosition"];return e&&n.push("particlesInfos"),n},t.prototype.fillDefines=function(e,n){if(this._scene&&(this._scene.clipPlane&&e.push("#define CLIPPLANE"),this._scene.clipPlane2&&e.push("#define CLIPPLANE2"),this._scene.clipPlane3&&e.push("#define CLIPPLANE3"),this._scene.clipPlane4&&e.push("#define CLIPPLANE4"),this._scene.clipPlane5&&e.push("#define CLIPPLANE5"),this._scene.clipPlane6&&e.push("#define CLIPPLANE6")),this._isAnimationSheetEnabled&&e.push("#define ANIMATESHEET"),n===t.BLENDMODE_MULTIPLY&&e.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&e.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(e.push("#define BILLBOARD"),this.billboardMode){case t.BILLBOARDMODE_Y:e.push("#define BILLBOARDY");break;case t.BILLBOARDMODE_STRETCHED:e.push("#define BILLBOARDSTRETCHED");break;case t.BILLBOARDMODE_ALL:e.push("#define BILLBOARDMODE_ALL")}this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),e.push(this._imageProcessingConfigurationDefines.toString()))},t.prototype.fillUniformsAttributesAndSamplerNames=function(e,n,r){n.push.apply(n,t._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&this.billboardMode!==t.BILLBOARDMODE_STRETCHED,this._useRampGradients)),e.push.apply(e,t._GetEffectCreationOptions(this._isAnimationSheetEnabled)),r.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&(fr.a.PrepareUniforms(e,this._imageProcessingConfigurationDefines),fr.a.PrepareSamplers(r,this._imageProcessingConfigurationDefines))},t.prototype._getEffect=function(e){var n=this.getCustomEffect(e);if(n)return n;var r=[];this.fillDefines(r,e);var o=r.join(`
`);if(this._cachedDefines!==o){this._cachedDefines=o;var u=[],f=[],v=[];this.fillUniformsAttributesAndSamplerNames(f,u,v),this._effect=this._engine.createEffect("particles",u,f,v,o)}return this._effect},t.prototype.animate=function(e){var n,r=this;if(e===void 0&&(e=!1),this._started){if(!e&&this._scene){if(!this.isReady()||this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}var o;if(this._scaledUpdateSpeed=this.updateSpeed*(e?this.preWarmStepOffset:((n=this._scene)===null||n===void 0?void 0:n.getAnimationRatio())||1),this.manualEmitCount>-1)o=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{var u=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){var f=this._actualFrame/this.targetStopDuration;wr.GetCurrentGradient(f,this._emitRateGradients,function(w,F,z){w!==r._currentEmitRateGradient&&(r._currentEmitRate1=r._currentEmitRate2,r._currentEmitRate2=F.getFactor(),r._currentEmitRateGradient=w),u=te.a.Lerp(r._currentEmitRate1,r._currentEmitRate2,z)})}o=u*this._scaledUpdateSpeed>>0,this._newPartsExcess+=u*this._scaledUpdateSpeed-o}if(this._newPartsExcess>1&&(o+=this._newPartsExcess>>0,this._newPartsExcess-=this._newPartsExcess>>0),this._alive=!1,this._stopped?o=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(o),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!e){for(var v=0,y=0;y<this._particles.length;y++){var D=this._particles[y];this._appendParticleVertices(v,D),v+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.update(this._vertexData)}this.manualEmitCount===0&&this.disposeOnStop&&this.stop()}},t.prototype._appendParticleVertices=function(e,n){this._appendParticleVertex(e++,n,0,0),this._useInstancing||(this._appendParticleVertex(e++,n,1,0),this._appendParticleVertex(e++,n,1,1),this._appendParticleVertex(e++,n,0,1))},t.prototype.rebuild=function(){for(var e in this._createIndexBuffer(),this._vertexBuffer&&this._vertexBuffer._rebuild(),this._vertexBuffers)this._vertexBuffers[e]._rebuild()},t.prototype.isReady=function(){if(!this.emitter||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==t.BLENDMODE_MULTIPLYADD){if(!this._getEffect(this.blendMode).isReady())return!1}else if(!this._getEffect(t.BLENDMODE_MULTIPLY).isReady()||!this._getEffect(t.BLENDMODE_ADD).isReady())return!1;return!0},t.prototype._render=function(e){var n,r,o=this._getEffect(e),u=this._engine;u.enableEffect(o);var f=(n=this.defaultViewMatrix)!==null&&n!==void 0?n:this._scene.getViewMatrix();if(o.setTexture("diffuseSampler",this.particleTexture),o.setMatrix("view",f),o.setMatrix("projection",(r=this.defaultProjectionMatrix)!==null&&r!==void 0?r:this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){var v=this.particleTexture.getBaseSize();o.setFloat3("particlesInfos",this.spriteCellWidth/v.width,this.spriteCellHeight/v.height,this.spriteCellWidth/v.width)}if(o.setVector2("translationPivot",this.translationPivot),o.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){var y=this._scene.activeCamera;o.setVector3("eyePosition",y.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),o.setTexture("rampSampler",this._rampGradientsTexture));var D=o.defines;switch(this._scene&&(this._scene.clipPlane||this._scene.clipPlane2||this._scene.clipPlane3||this._scene.clipPlane4||this._scene.clipPlane5||this._scene.clipPlane6)&&j0.a.BindClipPlane(o,this._scene),D.indexOf("#define BILLBOARDMODE_ALL")>=0&&(f.invertToRef(d.c.Matrix[0]),o.setMatrix("invView",d.c.Matrix[0])),this._vertexArrayObject!==void 0?(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,this._indexBuffer,o)),this._engine.bindVertexArrayObject(this._vertexArrayObject,this._indexBuffer)):u.bindBuffers(this._vertexBuffers,this._indexBuffer,o),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(o),e){case t.BLENDMODE_ADD:u.setAlphaMode(g.a.ALPHA_ADD);break;case t.BLENDMODE_ONEONE:u.setAlphaMode(g.a.ALPHA_ONEONE);break;case t.BLENDMODE_STANDARD:u.setAlphaMode(g.a.ALPHA_COMBINE);break;case t.BLENDMODE_MULTIPLY:u.setAlphaMode(g.a.ALPHA_MULTIPLY)}return this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(o),this._useInstancing?u.drawArraysType(g.a.MATERIAL_TriangleFanDrawMode,0,4,this._particles.length):u.drawElementsType(g.a.MATERIAL_TriangleFillMode,0,6*this._particles.length),this._particles.length},t.prototype.render=function(){if(!this.isReady()||!this._particles.length)return 0;var e=this._engine;e.setState&&(e.setState(!1),this.forceDepthWrite&&e.setDepthWrite(!0));var n=0;return n=this.blendMode===t.BLENDMODE_MULTIPLYADD?this._render(t.BLENDMODE_MULTIPLY)+this._render(t.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(g.a.ALPHA_DISABLE),n},t.prototype.dispose=function(e){if(e===void 0&&(e=!0),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),e&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),e&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._removeFromRoot(),this._subEmitters&&this._subEmitters.length){for(var n=0;n<this._subEmitters.length;n++)for(var r=0,o=this._subEmitters[n];r<o.length;r++)o[r].dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.emitter&&this.emitter.dispose&&this.emitter.dispose(!0),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene&&((n=this._scene.particleSystems.indexOf(this))>-1&&this._scene.particleSystems.splice(n,1),this._scene._activeParticleSystems.dispose()),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onStoppedObservable.clear(),this.reset()},t.prototype.clone=function(e,n){var r=Object(p.a)({},this._customEffect),o=null,u=this._engine;if(u.createEffectForParticles&&this.customShader!=null){var f=(o=this.customShader).shaderOptions.defines.length>0?o.shaderOptions.defines.join(`
`):"";r[0]=u.createEffectForParticles(o.shaderPath.fragmentElement,o.shaderOptions.uniforms,o.shaderOptions.samplers,f)}var v=this.serialize(),y=t.Parse(v,this._scene||this._engine,"");return y.name=e,y.customShader=o,y._customEffect=r,n===void 0&&(n=this.emitter),this.noiseTexture&&(y.noiseTexture=this.noiseTexture.clone()),y.emitter=n,this.preventAutoStart||y.start(),y},t.prototype.serialize=function(e){e===void 0&&(e=!1);var n={};if(t._Serialize(n,this,e),n.textureMask=this.textureMask.asArray(),n.customShader=this.customShader,n.preventAutoStart=this.preventAutoStart,this.subEmitters){n.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(var r=0,o=this._subEmitters;r<o.length;r++){for(var u=[],f=0,v=o[r];f<v.length;f++){var y=v[f];u.push(y.serialize())}n.subEmitters.push(u)}}return n},t._Serialize=function(e,n,r){if(e.name=n.name,e.id=n.id,e.capacity=n.getCapacity(),n.emitter.position){var o=n.emitter;e.emitterId=o.id}else{var u=n.emitter;e.emitter=u.asArray()}n.particleEmitterType&&(e.particleEmitterType=n.particleEmitterType.serialize()),n.particleTexture&&(r?e.texture=n.particleTexture.serialize():(e.textureName=n.particleTexture.name,e.invertY=!!n.particleTexture._invertY)),e.isLocal=n.isLocal,B.a.AppendSerializedAnimations(n,e),e.beginAnimationOnStart=n.beginAnimationOnStart,e.beginAnimationFrom=n.beginAnimationFrom,e.beginAnimationTo=n.beginAnimationTo,e.beginAnimationLoop=n.beginAnimationLoop,e.startDelay=n.startDelay,e.renderingGroupId=n.renderingGroupId,e.isBillboardBased=n.isBillboardBased,e.billboardMode=n.billboardMode,e.minAngularSpeed=n.minAngularSpeed,e.maxAngularSpeed=n.maxAngularSpeed,e.minSize=n.minSize,e.maxSize=n.maxSize,e.minScaleX=n.minScaleX,e.maxScaleX=n.maxScaleX,e.minScaleY=n.minScaleY,e.maxScaleY=n.maxScaleY,e.minEmitPower=n.minEmitPower,e.maxEmitPower=n.maxEmitPower,e.minLifeTime=n.minLifeTime,e.maxLifeTime=n.maxLifeTime,e.emitRate=n.emitRate,e.gravity=n.gravity.asArray(),e.noiseStrength=n.noiseStrength.asArray(),e.color1=n.color1.asArray(),e.color2=n.color2.asArray(),e.colorDead=n.colorDead.asArray(),e.updateSpeed=n.updateSpeed,e.targetStopDuration=n.targetStopDuration,e.blendMode=n.blendMode,e.preWarmCycles=n.preWarmCycles,e.preWarmStepOffset=n.preWarmStepOffset,e.minInitialRotation=n.minInitialRotation,e.maxInitialRotation=n.maxInitialRotation,e.startSpriteCellID=n.startSpriteCellID,e.endSpriteCellID=n.endSpriteCellID,e.spriteCellChangeSpeed=n.spriteCellChangeSpeed,e.spriteCellWidth=n.spriteCellWidth,e.spriteCellHeight=n.spriteCellHeight,e.spriteRandomStartCell=n.spriteRandomStartCell,e.isAnimationSheetEnabled=n.isAnimationSheetEnabled;var f=n.getColorGradients();if(f){e.colorGradients=[];for(var v=0,y=f;v<y.length;v++){var D=y[v],w={gradient:D.gradient,color1:D.color1.asArray()};D.color2?w.color2=D.color2.asArray():w.color2=D.color1.asArray(),e.colorGradients.push(w)}}var F=n.getRampGradients();if(F){e.rampGradients=[];for(var z=0,k=F;z<k.length;z++){var K=k[z];w={gradient:K.gradient,color:K.color.asArray()},e.rampGradients.push(w)}e.useRampGradients=n.useRampGradients}var oe=n.getColorRemapGradients();if(oe){e.colorRemapGradients=[];for(var ae=0,ue=oe;ae<ue.length;ae++){var de=ue[ae];w={gradient:de.gradient,factor1:de.factor1},de.factor2!==void 0?w.factor2=de.factor2:w.factor2=de.factor1,e.colorRemapGradients.push(w)}}var me=n.getAlphaRemapGradients();if(me){e.alphaRemapGradients=[];for(var ye=0,Ee=me;ye<Ee.length;ye++){var Ae=Ee[ye];w={gradient:Ae.gradient,factor1:Ae.factor1},Ae.factor2!==void 0?w.factor2=Ae.factor2:w.factor2=Ae.factor1,e.alphaRemapGradients.push(w)}}var Ie=n.getSizeGradients();if(Ie){e.sizeGradients=[];for(var Re=0,Pe=Ie;Re<Pe.length;Re++){var Ce=Pe[Re];w={gradient:Ce.gradient,factor1:Ce.factor1},Ce.factor2!==void 0?w.factor2=Ce.factor2:w.factor2=Ce.factor1,e.sizeGradients.push(w)}}var Be=n.getAngularSpeedGradients();if(Be){e.angularSpeedGradients=[];for(var Oe=0,Ve=Be;Oe<Ve.length;Oe++){var Le=Ve[Oe];w={gradient:Le.gradient,factor1:Le.factor1},Le.factor2!==void 0?w.factor2=Le.factor2:w.factor2=Le.factor1,e.angularSpeedGradients.push(w)}}var je=n.getVelocityGradients();if(je){e.velocityGradients=[];for(var tt=0,ut=je;tt<ut.length;tt++){var ft=ut[tt];w={gradient:ft.gradient,factor1:ft.factor1},ft.factor2!==void 0?w.factor2=ft.factor2:w.factor2=ft.factor1,e.velocityGradients.push(w)}}var vt=n.getDragGradients();if(vt){e.dragGradients=[];for(var rt=0,mt=vt;rt<mt.length;rt++){var pt=mt[rt];w={gradient:pt.gradient,factor1:pt.factor1},pt.factor2!==void 0?w.factor2=pt.factor2:w.factor2=pt.factor1,e.dragGradients.push(w)}}var it=n.getEmitRateGradients();if(it){e.emitRateGradients=[];for(var yt=0,He=it;yt<He.length;yt++){var at=He[yt];w={gradient:at.gradient,factor1:at.factor1},at.factor2!==void 0?w.factor2=at.factor2:w.factor2=at.factor1,e.emitRateGradients.push(w)}}var It=n.getStartSizeGradients();if(It){e.startSizeGradients=[];for(var vn=0,Jt=It;vn<Jt.length;vn++){var Sn=Jt[vn];w={gradient:Sn.gradient,factor1:Sn.factor1},Sn.factor2!==void 0?w.factor2=Sn.factor2:w.factor2=Sn.factor1,e.startSizeGradients.push(w)}}var Rt=n.getLifeTimeGradients();if(Rt){e.lifeTimeGradients=[];for(var Rn=0,bn=Rt;Rn<bn.length;Rn++){var hn=bn[Rn];w={gradient:hn.gradient,factor1:hn.factor1},hn.factor2!==void 0?w.factor2=hn.factor2:w.factor2=hn.factor1,e.lifeTimeGradients.push(w)}}var yn=n.getLimitVelocityGradients();if(yn){e.limitVelocityGradients=[];for(var Lt=0,Kt=yn;Lt<Kt.length;Lt++){var In=Kt[Lt];w={gradient:In.gradient,factor1:In.factor1},In.factor2!==void 0?w.factor2=In.factor2:w.factor2=In.factor1,e.limitVelocityGradients.push(w)}e.limitVelocityDamping=n.limitVelocityDamping}n.noiseTexture&&(e.noiseTexture=n.noiseTexture.serialize())},t._Parse=function(e,n,r,o){var u;u=r instanceof en.a?null:r;var f,v=C.a.GetClass("BABYLON.Texture");if(v&&u&&(e.texture?n.particleTexture=v.Parse(e.texture,u,o):e.textureName&&(n.particleTexture=new v(o+e.textureName,u,!1,e.invertY===void 0||e.invertY),n.particleTexture.name=e.textureName)),e.emitterId||e.emitterId===0||e.emitter!==void 0?e.emitterId&&u?n.emitter=u.getLastMeshByID(e.emitterId):n.emitter=d.e.FromArray(e.emitter):n.emitter=d.e.Zero(),n.isLocal=!!e.isLocal,e.renderingGroupId!==void 0&&(n.renderingGroupId=e.renderingGroupId),e.isBillboardBased!==void 0&&(n.isBillboardBased=e.isBillboardBased),e.billboardMode!==void 0&&(n.billboardMode=e.billboardMode),e.animations){for(var y=0;y<e.animations.length;y++){var D=e.animations[y],w=C.a.GetClass("BABYLON.Animation");w&&n.animations.push(w.Parse(D))}n.beginAnimationOnStart=e.beginAnimationOnStart,n.beginAnimationFrom=e.beginAnimationFrom,n.beginAnimationTo=e.beginAnimationTo,n.beginAnimationLoop=e.beginAnimationLoop}if(e.autoAnimate&&u&&u.beginAnimation(n,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1),n.startDelay=0|e.startDelay,n.minAngularSpeed=e.minAngularSpeed,n.maxAngularSpeed=e.maxAngularSpeed,n.minSize=e.minSize,n.maxSize=e.maxSize,e.minScaleX&&(n.minScaleX=e.minScaleX,n.maxScaleX=e.maxScaleX,n.minScaleY=e.minScaleY,n.maxScaleY=e.maxScaleY),e.preWarmCycles!==void 0&&(n.preWarmCycles=e.preWarmCycles,n.preWarmStepOffset=e.preWarmStepOffset),e.minInitialRotation!==void 0&&(n.minInitialRotation=e.minInitialRotation,n.maxInitialRotation=e.maxInitialRotation),n.minLifeTime=e.minLifeTime,n.maxLifeTime=e.maxLifeTime,n.minEmitPower=e.minEmitPower,n.maxEmitPower=e.maxEmitPower,n.emitRate=e.emitRate,n.gravity=d.e.FromArray(e.gravity),e.noiseStrength&&(n.noiseStrength=d.e.FromArray(e.noiseStrength)),n.color1=M.b.FromArray(e.color1),n.color2=M.b.FromArray(e.color2),n.colorDead=M.b.FromArray(e.colorDead),n.updateSpeed=e.updateSpeed,n.targetStopDuration=e.targetStopDuration,n.blendMode=e.blendMode,e.colorGradients)for(var F=0,z=e.colorGradients;F<z.length;F++){var k=z[F];n.addColorGradient(k.gradient,M.b.FromArray(k.color1),k.color2?M.b.FromArray(k.color2):void 0)}if(e.rampGradients){for(var K=0,oe=e.rampGradients;K<oe.length;K++){var ae=oe[K];n.addRampGradient(ae.gradient,M.a.FromArray(ae.color))}n.useRampGradients=e.useRampGradients}if(e.colorRemapGradients)for(var ue=0,de=e.colorRemapGradients;ue<de.length;ue++){var me=de[ue];n.addColorRemapGradient(me.gradient,me.factor1!==void 0?me.factor1:me.factor,me.factor2)}if(e.alphaRemapGradients)for(var ye=0,Ee=e.alphaRemapGradients;ye<Ee.length;ye++){var Ae=Ee[ye];n.addAlphaRemapGradient(Ae.gradient,Ae.factor1!==void 0?Ae.factor1:Ae.factor,Ae.factor2)}if(e.sizeGradients)for(var Ie=0,Re=e.sizeGradients;Ie<Re.length;Ie++){var Pe=Re[Ie];n.addSizeGradient(Pe.gradient,Pe.factor1!==void 0?Pe.factor1:Pe.factor,Pe.factor2)}if(e.angularSpeedGradients)for(var Ce=0,Be=e.angularSpeedGradients;Ce<Be.length;Ce++){var Oe=Be[Ce];n.addAngularSpeedGradient(Oe.gradient,Oe.factor1!==void 0?Oe.factor1:Oe.factor,Oe.factor2)}if(e.velocityGradients)for(var Ve=0,Le=e.velocityGradients;Ve<Le.length;Ve++){var je=Le[Ve];n.addVelocityGradient(je.gradient,je.factor1!==void 0?je.factor1:je.factor,je.factor2)}if(e.dragGradients)for(var tt=0,ut=e.dragGradients;tt<ut.length;tt++){var ft=ut[tt];n.addDragGradient(ft.gradient,ft.factor1!==void 0?ft.factor1:ft.factor,ft.factor2)}if(e.emitRateGradients)for(var vt=0,rt=e.emitRateGradients;vt<rt.length;vt++){var mt=rt[vt];n.addEmitRateGradient(mt.gradient,mt.factor1!==void 0?mt.factor1:mt.factor,mt.factor2)}if(e.startSizeGradients)for(var pt=0,it=e.startSizeGradients;pt<it.length;pt++){var yt=it[pt];n.addStartSizeGradient(yt.gradient,yt.factor1!==void 0?yt.factor1:yt.factor,yt.factor2)}if(e.lifeTimeGradients)for(var He=0,at=e.lifeTimeGradients;He<at.length;He++){var It=at[He];n.addLifeTimeGradient(It.gradient,It.factor1!==void 0?It.factor1:It.factor,It.factor2)}if(e.limitVelocityGradients){for(var vn=0,Jt=e.limitVelocityGradients;vn<Jt.length;vn++){var Sn=Jt[vn];n.addLimitVelocityGradient(Sn.gradient,Sn.factor1!==void 0?Sn.factor1:Sn.factor,Sn.factor2)}n.limitVelocityDamping=e.limitVelocityDamping}if(e.noiseTexture&&u){var Rt=C.a.GetClass("BABYLON.ProceduralTexture");n.noiseTexture=Rt.Parse(e.noiseTexture,u,o)}if(e.particleEmitterType){switch(e.particleEmitterType.type){case"SphereParticleEmitter":f=new Ih;break;case"SphereDirectedParticleEmitter":f=new Cm;break;case"ConeEmitter":case"ConeParticleEmitter":f=new Sm;break;case"CylinderParticleEmitter":f=new Mh;break;case"CylinderDirectedParticleEmitter":f=new xm;break;case"HemisphericParticleEmitter":f=new Am;break;case"PointParticleEmitter":f=new Pm;break;case"MeshParticleEmitter":f=new $0;break;case"BoxEmitter":case"BoxParticleEmitter":default:f=new Ds}f.parse(e.particleEmitterType,u)}else(f=new Ds).parse(e,u);n.particleEmitterType=f,n.startSpriteCellID=e.startSpriteCellID,n.endSpriteCellID=e.endSpriteCellID,n.spriteCellWidth=e.spriteCellWidth,n.spriteCellHeight=e.spriteCellHeight,n.spriteCellChangeSpeed=e.spriteCellChangeSpeed,n.spriteRandomStartCell=e.spriteRandomStartCell},t.Parse=function(e,n,r,o){o===void 0&&(o=!1);var u,f=e.name,v=null,y=null;if(u=n instanceof en.a?n:n.getEngine(),e.customShader&&u.createEffectForParticles){var D=(y=e.customShader).shaderOptions.defines.length>0?y.shaderOptions.defines.join(`
`):"";v=u.createEffectForParticles(y.shaderPath.fragmentElement,y.shaderOptions.uniforms,y.shaderOptions.samplers,D)}var w=new t(f,e.capacity,n,v,e.isAnimationSheetEnabled);if(w.customShader=y,e.id&&(w.id=e.id),e.subEmitters){w.subEmitters=[];for(var F=0,z=e.subEmitters;F<z.length;F++){for(var k=[],K=0,oe=z[F];K<oe.length;K++){var ae=oe[K];k.push(Sl.Parse(ae,n,r))}w.subEmitters.push(k)}}return t._Parse(e,w,n,r),e.textureMask&&(w.textureMask=M.b.FromArray(e.textureMask)),e.preventAutoStart&&(w.preventAutoStart=e.preventAutoStart),o||w.preventAutoStart||w.start(),w},t.BILLBOARDMODE_Y=g.a.PARTICLES_BILLBOARDMODE_Y,t.BILLBOARDMODE_ALL=g.a.PARTICLES_BILLBOARDMODE_ALL,t.BILLBOARDMODE_STRETCHED=g.a.PARTICLES_BILLBOARDMODE_STRETCHED,t}(_l);Sl._ParseParticleSystem=er.Parse,Ye.a.ShadersStore.gpuUpdateParticlesPixelShader=`#version 300 es
void main() {
discard;
}
`;var oL=`#version 300 es
#define PI 3.14159
uniform float currentCount;
uniform float timeDelta;
uniform float stopFactor;
#ifndef LOCAL
uniform mat4 emitterWM;
#endif
uniform vec2 lifeTime;
uniform vec2 emitPower;
uniform vec2 sizeRange;
uniform vec4 scaleRange;
#ifndef COLORGRADIENTS
uniform vec4 color1;
uniform vec4 color2;
#endif
uniform vec3 gravity;
uniform sampler2D randomSampler;
uniform sampler2D randomSampler2;
uniform vec4 angleRange;
#ifdef BOXEMITTER
uniform vec3 direction1;
uniform vec3 direction2;
uniform vec3 minEmitBox;
uniform vec3 maxEmitBox;
#endif
#ifdef POINTEMITTER
uniform vec3 direction1;
uniform vec3 direction2;
#endif
#ifdef HEMISPHERICEMITTER
uniform float radius;
uniform float radiusRange;
uniform float directionRandomizer;
#endif
#ifdef SPHEREEMITTER
uniform float radius;
uniform float radiusRange;
#ifdef DIRECTEDSPHEREEMITTER
uniform vec3 direction1;
uniform vec3 direction2;
#else
uniform float directionRandomizer;
#endif
#endif
#ifdef CYLINDEREMITTER
uniform float radius;
uniform float height;
uniform float radiusRange;
#ifdef DIRECTEDCYLINDEREMITTER
uniform vec3 direction1;
uniform vec3 direction2;
#else
uniform float directionRandomizer;
#endif
#endif
#ifdef CONEEMITTER
uniform vec2 radius;
uniform float coneAngle;
uniform vec2 height;
uniform float directionRandomizer;
#endif

in vec3 position;
#ifdef CUSTOMEMITTER
in vec3 initialPosition;
#endif
in float age;
in float life;
in vec4 seed;
in vec3 size;
#ifndef COLORGRADIENTS
in vec4 color;
#endif
in vec3 direction;
#ifndef BILLBOARD
in vec3 initialDirection;
#endif
#ifdef ANGULARSPEEDGRADIENTS
in float angle;
#else
in vec2 angle;
#endif
#ifdef ANIMATESHEET
in float cellIndex;
#ifdef ANIMATESHEETRANDOMSTART
in float cellStartOffset;
#endif
#endif
#ifdef NOISE
in vec3 noiseCoordinates1;
in vec3 noiseCoordinates2;
#endif

out vec3 outPosition;
#ifdef CUSTOMEMITTER
out vec3 outInitialPosition;
#endif
out float outAge;
out float outLife;
out vec4 outSeed;
out vec3 outSize;
#ifndef COLORGRADIENTS
out vec4 outColor;
#endif
out vec3 outDirection;
#ifndef BILLBOARD
out vec3 outInitialDirection;
#endif
#ifdef ANGULARSPEEDGRADIENTS
out float outAngle;
#else
out vec2 outAngle;
#endif
#ifdef ANIMATESHEET
out float outCellIndex;
#ifdef ANIMATESHEETRANDOMSTART
out float outCellStartOffset;
#endif
#endif
#ifdef NOISE
out vec3 outNoiseCoordinates1;
out vec3 outNoiseCoordinates2;
#endif
#ifdef SIZEGRADIENTS
uniform sampler2D sizeGradientSampler;
#endif
#ifdef ANGULARSPEEDGRADIENTS
uniform sampler2D angularSpeedGradientSampler;
#endif
#ifdef VELOCITYGRADIENTS
uniform sampler2D velocityGradientSampler;
#endif
#ifdef LIMITVELOCITYGRADIENTS
uniform sampler2D limitVelocityGradientSampler;
uniform float limitVelocityDamping;
#endif
#ifdef DRAGGRADIENTS
uniform sampler2D dragGradientSampler;
#endif
#ifdef NOISE
uniform vec3 noiseStrength;
uniform sampler2D noiseSampler;
#endif
#ifdef ANIMATESHEET
uniform vec3 cellInfos;
#endif
vec3 getRandomVec3(float offset) {
return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;
}
vec4 getRandomVec4(float offset) {
return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));
}
void main() {
float newAge=age+timeDelta;

if (newAge>=life && stopFactor != 0.) {
vec3 newPosition;
vec3 newDirection;

vec4 randoms=getRandomVec4(seed.x);

outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;
outAge=newAge-life;

outSeed=seed;

#ifdef SIZEGRADIENTS
outSize.x=texture(sizeGradientSampler,vec2(0,0)).r;
#else
outSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;
#endif
outSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;
outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a;
#ifndef COLORGRADIENTS

outColor=color1+(color2-color1)*randoms.b;
#endif

#ifndef ANGULARSPEEDGRADIENTS
outAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;
outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;
#else
outAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;
#endif

#ifdef POINTEMITTER
vec3 randoms2=getRandomVec3(seed.y);
vec3 randoms3=getRandomVec3(seed.z);
newPosition=vec3(0,0,0);
newDirection=direction1+(direction2-direction1)*randoms3;
#elif defined(BOXEMITTER)
vec3 randoms2=getRandomVec3(seed.y);
vec3 randoms3=getRandomVec3(seed.z);
newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;
newDirection=direction1+(direction2-direction1)*randoms3;
#elif defined(HEMISPHERICEMITTER)
vec3 randoms2=getRandomVec3(seed.y);
vec3 randoms3=getRandomVec3(seed.z);

float phi=2.0*PI*randoms2.x;
float theta=acos(2.0*randoms2.y-1.0);
float randX=cos(phi)*sin(theta);
float randY=cos(theta);
float randZ=sin(phi)*sin(theta);
newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);
newDirection=newPosition+directionRandomizer*randoms3;
#elif defined(SPHEREEMITTER)
vec3 randoms2=getRandomVec3(seed.y);
vec3 randoms3=getRandomVec3(seed.z);

float phi=2.0*PI*randoms2.x;
float theta=acos(2.0*randoms2.y-1.0);
float randX=cos(phi)*sin(theta);
float randY=cos(theta);
float randZ=sin(phi)*sin(theta);
newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);
#ifdef DIRECTEDSPHEREEMITTER
newDirection=direction1+(direction2-direction1)*randoms3;
#else

newDirection=newPosition+directionRandomizer*randoms3;
#endif
#elif defined(CYLINDEREMITTER)
vec3 randoms2=getRandomVec3(seed.y);
vec3 randoms3=getRandomVec3(seed.z);

float yPos=(randoms2.x-0.5)*height;
float angle=randoms2.y*PI*2.;
float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));
float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));
float xPos=positionRadius*cos(angle);
float zPos=positionRadius*sin(angle);
newPosition=vec3(xPos,yPos,zPos);
#ifdef DIRECTEDCYLINDEREMITTER
newDirection=direction1+(direction2-direction1)*randoms3;
#else

angle=angle+((randoms3.x-0.5)*PI);
newDirection=vec3(cos(angle),randoms3.y-0.5,sin(angle));
newDirection=normalize(newDirection);
#endif
#elif defined(CONEEMITTER)
vec3 randoms2=getRandomVec3(seed.y);
float s=2.0*PI*randoms2.x;
#ifdef CONEEMITTERSPAWNPOINT
float h=0.0001;
#else
float h=randoms2.y*height.y;

h=1.-h*h;
#endif
float lRadius=radius.x-radius.x*randoms2.z*radius.y;
lRadius=lRadius*h;
float randX=lRadius*sin(s);
float randZ=lRadius*cos(s);
float randY=h*height.x;
newPosition=vec3(randX,randY,randZ);

if (abs(cos(coneAngle)) == 1.0) {
newDirection=vec3(0.,1.0,0.);
} else {
vec3 randoms3=getRandomVec3(seed.z);
newDirection=normalize(newPosition+directionRandomizer*randoms3);
}
#elif defined(CUSTOMEMITTER)
newPosition=initialPosition;
outInitialPosition=initialPosition;
#else

newPosition=vec3(0.,0.,0.);

newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));
#endif
float power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;
#ifdef LOCAL
outPosition=newPosition;
#else
outPosition=(emitterWM*vec4(newPosition,1.)).xyz;
#endif
#ifdef CUSTOMEMITTER
outDirection=direction;
#ifndef BILLBOARD
outInitialDirection=direction;
#endif
#else
#ifdef LOCAL
vec3 initial=newDirection;
#else
vec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;
#endif
outDirection=initial*power;
#ifndef BILLBOARD
outInitialDirection=initial;
#endif
#endif
#ifdef ANIMATESHEET
outCellIndex=cellInfos.x;
#ifdef ANIMATESHEETRANDOMSTART
outCellStartOffset=randoms.a*outLife;
#endif
#endif
#ifdef NOISE
outNoiseCoordinates1=noiseCoordinates1;
outNoiseCoordinates2=noiseCoordinates2;
#endif
} else {
float directionScale=timeDelta;
outAge=newAge;
float ageGradient=newAge/life;
#ifdef VELOCITYGRADIENTS
directionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;
#endif
#ifdef DRAGGRADIENTS
directionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;
#endif
#if defined(CUSTOMEMITTER)
outPosition=position+(direction-position)*ageGradient;
outInitialPosition=initialPosition;
#else
outPosition=position+direction*directionScale;
#endif
outLife=life;
outSeed=seed;
#ifndef COLORGRADIENTS
outColor=color;
#endif
#ifdef SIZEGRADIENTS
outSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;
outSize.yz=size.yz;
#else
outSize=size;
#endif
#ifndef BILLBOARD
outInitialDirection=initialDirection;
#endif
#ifdef CUSTOMEMITTER
outDirection=direction;
#else
vec3 updatedDirection=direction+gravity*timeDelta;
#ifdef LIMITVELOCITYGRADIENTS
float limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;
float currentVelocity=length(updatedDirection);
if (currentVelocity>limitVelocity) {
updatedDirection=updatedDirection*limitVelocityDamping;
}
#endif
outDirection=updatedDirection;
#ifdef NOISE
float fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;
float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;
float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;
vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;
outDirection=outDirection+force*timeDelta;
outNoiseCoordinates1=noiseCoordinates1;
outNoiseCoordinates2=noiseCoordinates2;
#endif
#endif
#ifdef ANGULARSPEEDGRADIENTS
float angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;
outAngle=angle+angularSpeed*timeDelta;
#else
outAngle=vec2(angle.x+angle.y*timeDelta,angle.y);
#endif
#ifdef ANIMATESHEET
float offsetAge=outAge;
float dist=cellInfos.y-cellInfos.x;
#ifdef ANIMATESHEETRANDOMSTART
outCellStartOffset=cellStartOffset;
offsetAge+=cellStartOffset;
#else
float cellStartOffset=0.;
#endif
float ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);
outCellIndex=float(int(cellInfos.x+ratio*dist));
#endif
}
}`;Ye.a.ShadersStore.gpuUpdateParticlesVertexShader=oL;var aL=`#ifdef CLIPPLANE
in float fClipDistance;
#endif
#ifdef CLIPPLANE2
in float fClipDistance2;
#endif
#ifdef CLIPPLANE3
in float fClipDistance3;
#endif
#ifdef CLIPPLANE4
in float fClipDistance4;
#endif
#ifdef CLIPPLANE5
in float fClipDistance5;
#endif
#ifdef CLIPPLANE6
in float fClipDistance6;
#endif`;Ye.a.IncludesShadersStore.clipPlaneFragmentDeclaration2=aL;var sL=`#version 300 es
uniform sampler2D diffuseSampler;
in vec2 vUV;
in vec4 vColor;
out vec4 outFragColor;
#include<clipPlaneFragmentDeclaration2>
#include<imageProcessingDeclaration>
#include<helperFunctions>
#include<imageProcessingFunctions>
void main() {
#include<clipPlaneFragment>
vec4 textureColor=texture(diffuseSampler,vUV);
outFragColor=textureColor*vColor;
#ifdef BLENDMULTIPLYMODE
float alpha=vColor.a*textureColor.a;
outFragColor.rgb=outFragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);
#endif


#ifdef IMAGEPROCESSINGPOSTPROCESS
outFragColor.rgb=toLinearSpace(outFragColor.rgb);
#else
#ifdef IMAGEPROCESSING
outFragColor.rgb=toLinearSpace(outFragColor.rgb);
outFragColor=applyImageProcessing(outFragColor);
#endif
#endif
}
`;Ye.a.ShadersStore.gpuRenderParticlesPixelShader=sL;var cL=`#ifdef CLIPPLANE
uniform vec4 vClipPlane;
out float fClipDistance;
#endif
#ifdef CLIPPLANE2
uniform vec4 vClipPlane2;
out float fClipDistance2;
#endif
#ifdef CLIPPLANE3
uniform vec4 vClipPlane3;
out float fClipDistance3;
#endif
#ifdef CLIPPLANE4
uniform vec4 vClipPlane4;
out float fClipDistance4;
#endif
#ifdef CLIPPLANE5
uniform vec4 vClipPlane5;
out float fClipDistance5;
#endif
#ifdef CLIPPLANE6
uniform vec4 vClipPlane6;
out float fClipDistance6;
#endif`;Ye.a.IncludesShadersStore.clipPlaneVertexDeclaration2=cL;var lL=`#version 300 es
uniform mat4 view;
uniform mat4 projection;
uniform vec2 translationPivot;
uniform vec3 worldOffset;
#ifdef LOCAL
uniform mat4 emitterWM;
#endif

in vec3 position;
in float age;
in float life;
in vec3 size;
#ifndef BILLBOARD
in vec3 initialDirection;
#endif
#ifdef BILLBOARDSTRETCHED
in vec3 direction;
#endif
in float angle;
#ifdef ANIMATESHEET
in float cellIndex;
#endif
in vec2 offset;
in vec2 uv;
out vec2 vUV;
out vec4 vColor;
out vec3 vPositionW;
#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)
uniform mat4 invView;
#endif
#include<clipPlaneVertexDeclaration2>
#ifdef COLORGRADIENTS
uniform sampler2D colorGradientSampler;
#else
uniform vec4 colorDead;
in vec4 color;
#endif
#ifdef ANIMATESHEET
uniform vec3 sheetInfos;
#endif
#ifdef BILLBOARD
uniform vec3 eyePosition;
#endif
vec3 rotate(vec3 yaxis,vec3 rotatedCorner) {
vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));
vec3 zaxis=normalize(cross(yaxis,xaxis));
vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);
vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);
vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);
mat3 rotMatrix=mat3(row0,row1,row2);
vec3 alignedCorner=rotMatrix*rotatedCorner;
#ifdef LOCAL
return ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;
#else
return (position+worldOffset)+alignedCorner;
#endif
}
#ifdef BILLBOARDSTRETCHED
vec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {
vec3 normalizedToCamera=normalize(toCamera);
vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));
vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));
vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);
vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);
vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);
mat3 rotMatrix=mat3(row0,row1,row2);
vec3 alignedCorner=rotMatrix*rotatedCorner;
#ifdef LOCAL
return ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;
#else
return (position+worldOffset)+alignedCorner;
#endif
}
#endif
void main() {
#ifdef ANIMATESHEET
float rowOffset=floor(cellIndex/sheetInfos.z);
float columnOffset=cellIndex-rowOffset*sheetInfos.z;
vec2 uvScale=sheetInfos.xy;
vec2 uvOffset=vec2(uv.x ,1.0-uv.y);
vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;
#else
vUV=uv;
#endif
float ratio=age/life;
#ifdef COLORGRADIENTS
vColor=texture(colorGradientSampler,vec2(ratio,0));
#else
vColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);
#endif
vec2 cornerPos=(offset-translationPivot)*size.yz*size.x+translationPivot;
#ifdef BILLBOARD
vec4 rotatedCorner;
rotatedCorner.w=0.;
#ifdef BILLBOARDY
rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);
rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);
rotatedCorner.y=0.;
vec3 yaxis=(position+worldOffset)-eyePosition;
yaxis.y=0.;
vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);
vec4 viewPosition=(view*vec4(vPositionW,1.0));
#elif defined(BILLBOARDSTRETCHED)
rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);
rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);
rotatedCorner.z=0.;
vec3 toCamera=(position+worldOffset)-eyePosition;
vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);
vec4 viewPosition=(view*vec4(vPositionW,1.0));
#else

rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);
rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);
rotatedCorner.z=0.;

#ifdef LOCAL
vec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;
#else
vec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;
#endif
vPositionW=(invView*viewPosition).xyz;
#endif
#else

vec3 rotatedCorner;
rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);
rotatedCorner.y=0.;
rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);
vec3 yaxis=normalize(initialDirection);
vPositionW=rotate(yaxis,rotatedCorner);

vec4 viewPosition=view*vec4(vPositionW,1.0);
#endif
gl_Position=projection*viewPosition;

#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)
vec4 worldPos=vec4(vPositionW,1.0);
#endif
#include<clipPlaneVertex>
}`;Ye.a.ShadersStore.gpuRenderParticlesVertexShader=lL;var Na=function(i){function t(e,n,r,o,u){o===void 0&&(o=!1),u===void 0&&(u=null);var f=i.call(this,e)||this;f.layerMask=268435455,f._accumulatedCount=0,f._targetIndex=0,f._currentRenderId=-1,f._started=!1,f._stopped=!1,f._timeDelta=0,f._actualFrame=0,f._rawTextureWidth=256,f.onDisposeObservable=new S.c,f.onStoppedObservable=new S.c,f.forceDepthWrite=!1,f._preWarmDone=!1,f.isLocal=!1,f._onBeforeDrawParticlesObservable=null,r&&r.getClassName()!=="Scene"?(f._engine=r,f.defaultProjectionMatrix=d.a.PerspectiveFovLH(.8,1,.1,100)):(f._scene=r||ne.a.LastCreatedScene,f._engine=f._scene.getEngine(),f.uniqueId=f._scene.getUniqueId(),f._scene.particleSystems.push(f)),f._customEffect={0:u},f._attachImageProcessingConfiguration(null),n.randomTextureSize||delete n.randomTextureSize;var v=Object(p.a)({capacity:5e4,randomTextureSize:f._engine.getCaps().maxTextureSize},n),y=n;isFinite(y)&&(v.capacity=y),f._capacity=v.capacity,f._activeCount=v.capacity,f._currentActiveCount=0,f._isAnimationSheetEnabled=o,f._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]},f.particleEmitterType=new Ds;for(var D=Math.min(f._engine.getCaps().maxTextureSize,v.randomTextureSize),w=[],F=0;F<D;++F)w.push(Math.random()),w.push(Math.random()),w.push(Math.random()),w.push(Math.random());for(f._randomTexture=new Pr(new Float32Array(w),D,1,g.a.TEXTUREFORMAT_RGBA,r,!1,!1,g.a.TEXTURE_NEAREST_SAMPLINGMODE,g.a.TEXTURETYPE_FLOAT),f._randomTexture.wrapU=g.a.TEXTURE_WRAP_ADDRESSMODE,f._randomTexture.wrapV=g.a.TEXTURE_WRAP_ADDRESSMODE,w=[],F=0;F<D;++F)w.push(Math.random()),w.push(Math.random()),w.push(Math.random()),w.push(Math.random());return f._randomTexture2=new Pr(new Float32Array(w),D,1,g.a.TEXTUREFORMAT_RGBA,r,!1,!1,g.a.TEXTURE_NEAREST_SAMPLINGMODE,g.a.TEXTURETYPE_FLOAT),f._randomTexture2.wrapU=g.a.TEXTURE_WRAP_ADDRESSMODE,f._randomTexture2.wrapV=g.a.TEXTURE_WRAP_ADDRESSMODE,f._randomTextureSize=D,f}return Object(p.d)(t,i),Object.defineProperty(t,"IsSupported",{get:function(){return!!ne.a.LastCreatedEngine&&ne.a.LastCreatedEngine.webGLVersion>1},enumerable:!1,configurable:!0}),t.prototype.getCapacity=function(){return this._capacity},Object.defineProperty(t.prototype,"activeParticleCount",{get:function(){return this._activeCount},set:function(e){this._activeCount=Math.min(e,this._capacity)},enumerable:!1,configurable:!0}),t.prototype.isReady=function(){return this._updateEffect?!!(this.emitter&&this._updateEffect.isReady()&&(!this._imageProcessingConfiguration||this._imageProcessingConfiguration.isReady())&&this._getEffect().isReady()&&this.particleTexture&&this.particleTexture.isReady()):(this._recreateUpdateEffect(),this._recreateRenderEffect(),!1)},t.prototype.isStarted=function(){return this._started},t.prototype.isStopped=function(){return this._stopped},t.prototype.isStopping=function(){return!1},t.prototype.getActiveCount=function(){return this._currentActiveCount},t.prototype.start=function(e){var n=this;if(e===void 0&&(e=this.startDelay),!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";e?setTimeout(function(){n.start(0)},e):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))},t.prototype.stop=function(){this._stopped||(this._stopped=!0)},t.prototype.reset=function(){this._releaseBuffers(),this._releaseVAOs(),this._currentActiveCount=0,this._targetIndex=0},t.prototype.getClassName=function(){return"GPUParticleSystem"},t.prototype.getCustomEffect=function(e){var n;return e===void 0&&(e=0),(n=this._customEffect[e])!==null&&n!==void 0?n:this._customEffect[0]},t.prototype.setCustomEffect=function(e,n){n===void 0&&(n=0),this._customEffect[n]=e},Object.defineProperty(t.prototype,"onBeforeDrawParticlesObservable",{get:function(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new S.c),this._onBeforeDrawParticlesObservable},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"vertexShaderName",{get:function(){return"gpuRenderParticles"},enumerable:!1,configurable:!0}),t.prototype._removeGradientAndTexture=function(e,n,r){return i.prototype._removeGradientAndTexture.call(this,e,n,r),this._releaseBuffers(),this},t.prototype.addColorGradient=function(e,n,r){this._colorGradients||(this._colorGradients=[]);var o=new Ym(e,n);return this._colorGradients.push(o),this._refreshColorGradient(!0),this._releaseBuffers(),this},t.prototype._refreshColorGradient=function(e){e===void 0&&(e=!1),this._colorGradients&&(e&&this._colorGradients.sort(function(n,r){return n.gradient<r.gradient?-1:n.gradient>r.gradient?1:0}),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))},t.prototype.forceRefreshGradients=function(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()},t.prototype.removeColorGradient=function(e){return this._removeGradientAndTexture(e,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this},t.prototype._addFactorGradient=function(e,n,r){var o=new Km(n,r);e.push(o),this._releaseBuffers()},t.prototype.addSizeGradient=function(e,n){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,e,n),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this},t.prototype.removeSizeGradient=function(e){return this._removeGradientAndTexture(e,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this},t.prototype._refreshFactorGradient=function(e,n,r){r===void 0&&(r=!1),e&&(r&&e.sort(function(o,u){return o.gradient<u.gradient?-1:o.gradient>u.gradient?1:0}),this[n]&&(this[n].dispose(),this[n]=null))},t.prototype.addAngularSpeedGradient=function(e,n){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,e,n),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this},t.prototype.removeAngularSpeedGradient=function(e){return this._removeGradientAndTexture(e,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this},t.prototype.addVelocityGradient=function(e,n){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,e,n),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this},t.prototype.removeVelocityGradient=function(e){return this._removeGradientAndTexture(e,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this},t.prototype.addLimitVelocityGradient=function(e,n){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,e,n),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this},t.prototype.removeLimitVelocityGradient=function(e){return this._removeGradientAndTexture(e,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this},t.prototype.addDragGradient=function(e,n){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,e,n),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this},t.prototype.removeDragGradient=function(e){return this._removeGradientAndTexture(e,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this},t.prototype.addEmitRateGradient=function(e,n,r){return this},t.prototype.removeEmitRateGradient=function(e){return this},t.prototype.addStartSizeGradient=function(e,n,r){return this},t.prototype.removeStartSizeGradient=function(e){return this},t.prototype.addColorRemapGradient=function(e,n,r){return this},t.prototype.removeColorRemapGradient=function(){return this},t.prototype.addAlphaRemapGradient=function(e,n,r){return this},t.prototype.removeAlphaRemapGradient=function(){return this},t.prototype.addRampGradient=function(e,n){return this},t.prototype.removeRampGradient=function(){return this},t.prototype.getRampGradients=function(){return null},Object.defineProperty(t.prototype,"useRampGradients",{get:function(){return!1},set:function(e){},enumerable:!1,configurable:!0}),t.prototype.addLifeTimeGradient=function(e,n,r){return this},t.prototype.removeLifeTimeGradient=function(e){return this},t.prototype._reset=function(){this._releaseBuffers()},t.prototype._createUpdateVAO=function(e){var n={};n.position=e.createVertexBuffer("position",0,3);var r=3;this.particleEmitterType instanceof ws&&(n.initialPosition=e.createVertexBuffer("initialPosition",r,3),r+=3),n.age=e.createVertexBuffer("age",r,1),r+=1,n.life=e.createVertexBuffer("life",r,1),r+=1,n.seed=e.createVertexBuffer("seed",r,4),r+=4,n.size=e.createVertexBuffer("size",r,3),r+=3,this._colorGradientsTexture||(n.color=e.createVertexBuffer("color",r,4),r+=4),n.direction=e.createVertexBuffer("direction",r,3),r+=3,this._isBillboardBased||(n.initialDirection=e.createVertexBuffer("initialDirection",r,3),r+=3),this._angularSpeedGradientsTexture?(n.angle=e.createVertexBuffer("angle",r,1),r+=1):(n.angle=e.createVertexBuffer("angle",r,2),r+=2),this._isAnimationSheetEnabled&&(n.cellIndex=e.createVertexBuffer("cellIndex",r,1),r+=1,this.spriteRandomStartCell&&(n.cellStartOffset=e.createVertexBuffer("cellStartOffset",r,1),r+=1)),this.noiseTexture&&(n.noiseCoordinates1=e.createVertexBuffer("noiseCoordinates1",r,3),r+=3,n.noiseCoordinates2=e.createVertexBuffer("noiseCoordinates2",r,3),r+=3);var o=this._engine.recordVertexArrayObject(n,null,this._updateEffect);return this._engine.bindArrayBuffer(null),o},t.prototype._createRenderVAO=function(e,n){var r={};r.position=e.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);var o=3;this.particleEmitterType instanceof ws&&(o+=3),r.age=e.createVertexBuffer("age",o,1,this._attributesStrideSize,!0),o+=1,r.life=e.createVertexBuffer("life",o,1,this._attributesStrideSize,!0),o+=5,r.size=e.createVertexBuffer("size",o,3,this._attributesStrideSize,!0),o+=3,this._colorGradientsTexture||(r.color=e.createVertexBuffer("color",o,4,this._attributesStrideSize,!0),o+=4),this.billboardMode===er.BILLBOARDMODE_STRETCHED&&(r.direction=e.createVertexBuffer("direction",o,3,this._attributesStrideSize,!0)),o+=3,this._isBillboardBased||(r.initialDirection=e.createVertexBuffer("initialDirection",o,3,this._attributesStrideSize,!0),o+=3),r.angle=e.createVertexBuffer("angle",o,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?o++:o+=2,this._isAnimationSheetEnabled&&(r.cellIndex=e.createVertexBuffer("cellIndex",o,1,this._attributesStrideSize,!0),o+=1,this.spriteRandomStartCell&&(r.cellStartOffset=e.createVertexBuffer("cellStartOffset",o,1,this._attributesStrideSize,!0),o+=1)),this.noiseTexture&&(r.noiseCoordinates1=e.createVertexBuffer("noiseCoordinates1",o,3,this._attributesStrideSize,!0),o+=3,r.noiseCoordinates2=e.createVertexBuffer("noiseCoordinates2",o,3,this._attributesStrideSize,!0),o+=3),r.offset=n.createVertexBuffer("offset",0,2),r.uv=n.createVertexBuffer("uv",2,2);var u=this._engine.recordVertexArrayObject(r,null,this._getEffect());return this._engine.bindArrayBuffer(null),u},t.prototype._initialize=function(e){if(e===void 0&&(e=!1),!this._buffer0||e){var n=this._engine,r=new Array;this._attributesStrideSize=21,this._targetIndex=0,this.particleEmitterType instanceof ws&&(this._attributesStrideSize+=3),this.isBillboardBased||(this._attributesStrideSize+=3),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6);for(var o=this.particleEmitterType instanceof ws,u=d.c.Vector3[0],f=0;f<this._capacity;f++)r.push(0),r.push(0),r.push(0),o&&(this.particleEmitterType.particlePositionGenerator(f,null,u),r.push(u.x),r.push(u.y),r.push(u.z)),r.push(0),r.push(0),r.push(Math.random()),r.push(Math.random()),r.push(Math.random()),r.push(Math.random()),r.push(0),r.push(0),r.push(0),this._colorGradientsTexture||(r.push(0),r.push(0),r.push(0),r.push(0)),o?(this.particleEmitterType.particleDestinationGenerator(f,null,u),r.push(u.x),r.push(u.y),r.push(u.z)):(r.push(0),r.push(0),r.push(0)),this.isBillboardBased||(r.push(0),r.push(0),r.push(0)),r.push(0),this._angularSpeedGradientsTexture||r.push(0),this._isAnimationSheetEnabled&&(r.push(0),this.spriteRandomStartCell&&r.push(0)),this.noiseTexture&&(r.push(Math.random()),r.push(Math.random()),r.push(Math.random()),r.push(Math.random()),r.push(Math.random()),r.push(Math.random()));var v=new Float32Array([.5,.5,1,1,-.5,.5,0,1,-.5,-.5,0,0,.5,-.5,1,0]);this._buffer0=new De.a(n,r,!1,this._attributesStrideSize),this._buffer1=new De.a(n,r,!1,this._attributesStrideSize),this._spriteBuffer=new De.a(n,v,!1,4),this._updateVAO=[],this._updateVAO.push(this._createUpdateVAO(this._buffer0)),this._updateVAO.push(this._createUpdateVAO(this._buffer1)),this._renderVAO=[],this._renderVAO.push(this._createRenderVAO(this._buffer1,this._spriteBuffer)),this._renderVAO.push(this._createRenderVAO(this._buffer0,this._spriteBuffer)),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}},t.prototype._recreateUpdateEffect=function(){var e=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";this._isBillboardBased&&(e+=`
#define BILLBOARD`),this._colorGradientsTexture&&(e+=`
#define COLORGRADIENTS`),this._sizeGradientsTexture&&(e+=`
#define SIZEGRADIENTS`),this._angularSpeedGradientsTexture&&(e+=`
#define ANGULARSPEEDGRADIENTS`),this._velocityGradientsTexture&&(e+=`
#define VELOCITYGRADIENTS`),this._limitVelocityGradientsTexture&&(e+=`
#define LIMITVELOCITYGRADIENTS`),this._dragGradientsTexture&&(e+=`
#define DRAGGRADIENTS`),this.isAnimationSheetEnabled&&(e+=`
#define ANIMATESHEET`,this.spriteRandomStartCell&&(e+=`
#define ANIMATESHEETRANDOMSTART`)),this.noiseTexture&&(e+=`
#define NOISE`),this.isLocal&&(e+=`
#define LOCAL`),this._updateEffect&&this._updateEffectOptions.defines===e||(this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this.particleEmitterType instanceof ws&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.defines=e,this._updateEffect=new Ye.a("gpuUpdateParticles",this._updateEffectOptions,this._engine))},t.prototype._getEffect=function(){var e;return(e=this.getCustomEffect())!==null&&e!==void 0?e:this._renderEffect},t.prototype.fillDefines=function(e,n){if(this._scene&&(this._scene.clipPlane&&e.push("#define CLIPPLANE"),this._scene.clipPlane2&&e.push("#define CLIPPLANE2"),this._scene.clipPlane3&&e.push("#define CLIPPLANE3"),this._scene.clipPlane4&&e.push("#define CLIPPLANE4"),this._scene.clipPlane5&&e.push("#define CLIPPLANE5"),this._scene.clipPlane6&&e.push("#define CLIPPLANE6")),this.blendMode===er.BLENDMODE_MULTIPLY&&e.push("#define BLENDMULTIPLYMODE"),this.isLocal&&e.push("#define LOCAL"),this._isBillboardBased)switch(e.push("#define BILLBOARD"),this.billboardMode){case er.BILLBOARDMODE_Y:e.push("#define BILLBOARDY");break;case er.BILLBOARDMODE_STRETCHED:e.push("#define BILLBOARDSTRETCHED");break;case er.BILLBOARDMODE_ALL:e.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&e.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&e.push("#define ANIMATESHEET"),this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),e.push(""+this._imageProcessingConfigurationDefines.toString()))},t.prototype.fillUniformsAttributesAndSamplerNames=function(e,n,r){n.push("position","age","life","size","color","offset","uv","direction","initialDirection","angle","cellIndex"),e.push("emitterWM","worldOffset","view","projection","colorDead","invView","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","sheetInfos","translationPivot","eyePosition"),r.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(fr.a.PrepareUniforms(e,this._imageProcessingConfigurationDefines),fr.a.PrepareSamplers(r,this._imageProcessingConfigurationDefines))},t.prototype._recreateRenderEffect=function(){var e=this.getCustomEffect();if(e)return e;var n=[];this.fillDefines(n);var r=n.join(`
`);if(this._renderEffect&&this._renderEffect.defines===r)return this._renderEffect;var o=[],u=[],f=[];return this.fillUniformsAttributesAndSamplerNames(u,o,f),this._renderEffect=new Ye.a("gpuRenderParticles",o,u,f,this._engine,r),this._renderEffect},t.prototype.animate=function(e){var n;e===void 0&&(e=!1),this._timeDelta=this.updateSpeed*(e?this.preWarmStepOffset:((n=this._scene)===null||n===void 0?void 0:n.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()},t.prototype._createFactorGradientTexture=function(e,n){var r=this[n];if(e&&e.length&&!r){for(var o=new Float32Array(this._rawTextureWidth),u=0;u<this._rawTextureWidth;u++){var f=u/this._rawTextureWidth;wr.GetCurrentGradient(f,e,function(v,y,D){o[u]=te.a.Lerp(v.factor1,y.factor1,D)})}this[n]=Pr.CreateRTexture(o,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,g.a.TEXTURE_NEAREST_SAMPLINGMODE)}},t.prototype._createSizeGradientTexture=function(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")},t.prototype._createAngularSpeedGradientTexture=function(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")},t.prototype._createVelocityGradientTexture=function(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")},t.prototype._createLimitVelocityGradientTexture=function(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")},t.prototype._createDragGradientTexture=function(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")},t.prototype._createColorGradientTexture=function(){if(this._colorGradients&&this._colorGradients.length&&!this._colorGradientsTexture){for(var e=new Uint8Array(4*this._rawTextureWidth),n=M.c.Color4[0],r=0;r<this._rawTextureWidth;r++){var o=r/this._rawTextureWidth;wr.GetCurrentGradient(o,this._colorGradients,function(u,f,v){M.b.LerpToRef(u.color1,f.color1,v,n),e[4*r]=255*n.r,e[4*r+1]=255*n.g,e[4*r+2]=255*n.b,e[4*r+3]=255*n.a})}this._colorGradientsTexture=Pr.CreateRGBATexture(e,this._rawTextureWidth,1,this._scene,!1,!1,g.a.TEXTURE_NEAREST_SAMPLINGMODE)}},t.prototype.render=function(e){var n,r;if(e===void 0&&(e=!1),!this._started||(this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture(),this._recreateUpdateEffect(),this._recreateRenderEffect(),!this.isReady()))return 0;if(!e&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(var o=0;o<this.preWarmCycles;o++)this.animate(!0),this.render(!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getFrameId())return 0;this._currentRenderId=this._scene.getFrameId()}if(this._initialize(),this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>1){var u=0|this._accumulatedCount;this._accumulatedCount-=u,this._currentActiveCount=Math.min(this._activeCount,this._currentActiveCount+u)}if(!this._currentActiveCount)return 0;this._engine.enableEffect(this._updateEffect);var f,v=this._engine;if(!v.setState)throw new Error("GPU particles cannot work with a full Engine. ThinEngine is not supported");if(this._updateEffect.setFloat("currentCount",this._currentActiveCount),this._updateEffect.setFloat("timeDelta",this._timeDelta),this._updateEffect.setFloat("stopFactor",this._stopped?0:1),this._updateEffect.setTexture("randomSampler",this._randomTexture),this._updateEffect.setTexture("randomSampler2",this._randomTexture2),this._updateEffect.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateEffect.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateEffect.setDirectColor4("color1",this.color1),this._updateEffect.setDirectColor4("color2",this.color2)),this._updateEffect.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateEffect.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateEffect.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateEffect.setVector3("gravity",this.gravity),this._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._sizeGradientsTexture),this._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._angularSpeedGradientsTexture),this._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._velocityGradientsTexture),this._limitVelocityGradientsTexture&&(this._updateEffect.setTexture("limitVelocityGradientSampler",this._limitVelocityGradientsTexture),this._updateEffect.setFloat("limitVelocityDamping",this.limitVelocityDamping)),this._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._dragGradientsTexture),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateEffect),this._isAnimationSheetEnabled&&this._updateEffect.setFloat3("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed),this.noiseTexture&&(this._updateEffect.setTexture("noiseSampler",this.noiseTexture),this._updateEffect.setVector3("noiseStrength",this.noiseStrength)),this.emitter.position)f=this.emitter.getWorldMatrix();else{var y=this.emitter;f=d.a.Translation(y.x,y.y,y.z)}if(this.isLocal||this._updateEffect.setMatrix("emitterWM",f),this._engine.bindVertexArrayObject(this._updateVAO[this._targetIndex],null),v.bindTransformFeedbackBuffer(this._targetBuffer.getBuffer()),v.setRasterizerState(!1),v.beginTransformFeedback(!0),v.drawArraysType(g.a.MATERIAL_PointListDrawMode,0,this._currentActiveCount),v.endTransformFeedback(),v.setRasterizerState(!0),v.bindTransformFeedbackBuffer(null),!e){var D=this._getEffect();this._engine.enableEffect(D);var w=((n=this._scene)===null||n===void 0?void 0:n.getViewMatrix())||d.a.IdentityReadOnly;if(D.setMatrix("view",w),D.setMatrix("projection",(r=this.defaultProjectionMatrix)!==null&&r!==void 0?r:this._scene.getProjectionMatrix()),D.setTexture("diffuseSampler",this.particleTexture),D.setVector2("translationPivot",this.translationPivot),D.setVector3("worldOffset",this.worldOffset),this.isLocal&&D.setMatrix("emitterWM",f),this._colorGradientsTexture?D.setTexture("colorGradientSampler",this._colorGradientsTexture):D.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){var F=this.particleTexture.getBaseSize();D.setFloat3("sheetInfos",this.spriteCellWidth/F.width,this.spriteCellHeight/F.height,F.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){var z=this._scene.activeCamera;D.setVector3("eyePosition",z.globalPosition)}var k=D.defines;if(this._scene&&(this._scene.clipPlane||this._scene.clipPlane2||this._scene.clipPlane3||this._scene.clipPlane4||this._scene.clipPlane5||this._scene.clipPlane6)&&lt.a.BindClipPlane(D,this._scene),k.indexOf("#define BILLBOARDMODE_ALL")>=0){var K=w.clone();K.invert(),D.setMatrix("invView",K)}switch(this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(D),this.blendMode){case er.BLENDMODE_ADD:this._engine.setAlphaMode(g.a.ALPHA_ADD);break;case er.BLENDMODE_ONEONE:this._engine.setAlphaMode(g.a.ALPHA_ONEONE);break;case er.BLENDMODE_STANDARD:this._engine.setAlphaMode(g.a.ALPHA_COMBINE);break;case er.BLENDMODE_MULTIPLY:this._engine.setAlphaMode(g.a.ALPHA_MULTIPLY)}this.forceDepthWrite&&v.setDepthWrite(!0),this._engine.bindVertexArrayObject(this._renderVAO[this._targetIndex],null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(D),this._engine.drawArraysType(g.a.MATERIAL_TriangleFanDrawMode,0,4,this._currentActiveCount),this._engine.setAlphaMode(g.a.ALPHA_DISABLE)}this._targetIndex++,this._targetIndex===2&&(this._targetIndex=0);var oe=this._sourceBuffer;return this._sourceBuffer=this._targetBuffer,this._targetBuffer=oe,this._currentActiveCount},t.prototype.rebuild=function(){this._initialize(!0)},t.prototype._releaseBuffers=function(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null)},t.prototype._releaseVAOs=function(){if(this._updateVAO){for(var e=0;e<this._updateVAO.length;e++)this._engine.releaseVertexArrayObject(this._updateVAO[e]);for(this._updateVAO=[],e=0;e<this._renderVAO.length;e++)this._engine.releaseVertexArrayObject(this._renderVAO[e]);this._renderVAO=[]}},t.prototype.dispose=function(e){if(e===void 0&&(e=!0),this._scene){var n=this._scene.particleSystems.indexOf(this);n>-1&&this._scene.particleSystems.splice(n,1)}this._releaseBuffers(),this._releaseVAOs(),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),e&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),e&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear()},t.prototype.clone=function(e,n){var r=this.serialize(),o=t.Parse(r,this._scene||this._engine,""),u=Object(p.a)({},this._customEffect);return o.name=e,o._customEffect=u,n===void 0&&(n=this.emitter),o.emitter=n,o.noiseTexture=this.noiseTexture,o},t.prototype.serialize=function(e){e===void 0&&(e=!1);var n={};return er._Serialize(n,this,e),n.activeParticleCount=this.activeParticleCount,n.randomTextureSize=this._randomTextureSize,n},t.Parse=function(e,n,r,o){o===void 0&&(o=!1);var u=new t(e.name,{capacity:e.capacity,randomTextureSize:e.randomTextureSize},n);return e.activeParticleCount&&(u.activeParticleCount=e.activeParticleCount),er._Parse(e,u,n,r),e.preventAutoStart&&(u.preventAutoStart=e.preventAutoStart),o||u.preventAutoStart||u.start(),u},t}(_l),Bh=function(){function i(){this.systems=new Array}return Object.defineProperty(i.prototype,"emitterNode",{get:function(){return this._emitterNode},enumerable:!1,configurable:!0}),i.prototype.setEmitterAsSphere=function(t,e,n){this._emitterNode&&this._emitterNode.dispose(),this._emitterCreationOptions={kind:"Sphere",options:t,renderingGroupId:e};var r=zr.a.CreateSphere("emitterSphere",{diameter:t.diameter,segments:t.segments},n);r.renderingGroupId=e;var o=new on.a("emitterSphereMaterial",n);o.emissiveColor=t.color,r.material=o;for(var u=0,f=this.systems;u<f.length;u++)f[u].emitter=r;this._emitterNode=r},i.prototype.start=function(t){for(var e=0,n=this.systems;e<n.length;e++){var r=n[e];t&&(r.emitter=t),r.start()}},i.prototype.dispose=function(){for(var t=0,e=this.systems;t<e.length;t++)e[t].dispose();this.systems=[],this._emitterNode&&(this._emitterNode.dispose(),this._emitterNode=null)},i.prototype.serialize=function(t){t===void 0&&(t=!1);for(var e={systems:[]},n=0,r=this.systems;n<r.length;n++){var o=r[n];e.systems.push(o.serialize(t))}return this._emitterNode&&(e.emitter=this._emitterCreationOptions),e},i.Parse=function(t,e,n){n===void 0&&(n=!1);var r=new i,o=this.BaseAssetsUrl+"/textures/";e=e||ne.a.LastCreatedScene;for(var u=0,f=t.systems;u<f.length;u++){var v=f[u];r.systems.push(n?Na.Parse(v,e,o,!0):er.Parse(v,e,o,!0))}if(t.emitter){var y=t.emitter.options;switch(t.emitter.kind){case"Sphere":r.setEmitterAsSphere({diameter:y.diameter,segments:y.segments,color:M.a.FromArray(y.color)},t.emitter.renderingGroupId,e)}}return r},i.BaseAssetsUrl="https://assets.babylonjs.com/particles",i}(),uL=function(){function i(){}return i.CreateDefault=function(t,e,n,r){var o;return e===void 0&&(e=500),r===void 0&&(r=!1),(o=r?new Na("default system",{capacity:e},n):new er("default system",e,n)).emitter=t,o.particleTexture=new ke.a("https://www.babylonjs.com/assets/Flare.png",o.getScene()),o.createConeEmitter(.1,Math.PI/4),o.color1=new M.b(1,1,1,1),o.color2=new M.b(1,1,1,1),o.colorDead=new M.b(1,1,1,0),o.minSize=.1,o.maxSize=.1,o.minEmitPower=2,o.maxEmitPower=2,o.updateSpeed=1/60,o.emitRate=30,o},i.CreateAsync=function(t,e,n){n===void 0&&(n=!1),e||(e=ne.a.LastCreatedScene);var r={};return e._addPendingData(r),new Promise(function(o,u){if(n&&!Na.IsSupported)return e._removePendingData(r),u("Particle system with GPU is not supported.");et.b.LoadFile(i.BaseAssetsUrl+"/systems/"+t+".json",function(f){e._removePendingData(r);var v=JSON.parse(f.toString());return o(Bh.Parse(v,e,n))},void 0,void 0,void 0,function(){return e._removePendingData(r),u("An error occured while the creation of your particle system. Check if your type '"+t+"' exists.")})})},i.ExportSet=function(t){for(var e=new Bh,n=0,r=t;n<r.length;n++){var o=r[n];e.systems.push(o)}return e},i.ParseFromFileAsync=function(t,e,n,r,o){return r===void 0&&(r=!1),o===void 0&&(o=""),new Promise(function(u,f){var v=new se.a;v.addEventListener("readystatechange",function(){if(v.readyState==4)if(v.status==200){var y=JSON.parse(v.responseText),D=void 0;D=r?Na.Parse(y,n,o):er.Parse(y,n,o),t&&(D.name=t),u(D)}else f("Unable to load the particle system")}),v.open("GET",e),v.send()})},i.CreateFromSnippetAsync=function(t,e,n,r){var o=this;if(n===void 0&&(n=!1),r===void 0&&(r=""),t==="_BLANK"){var u=this.CreateDefault(null);return u.start(),Promise.resolve(u)}return new Promise(function(f,v){var y=new se.a;y.addEventListener("readystatechange",function(){if(y.readyState==4)if(y.status==200){var D=JSON.parse(JSON.parse(y.responseText).jsonPayload),w=JSON.parse(D.particleSystem),F=void 0;(F=n?Na.Parse(w,e,r):er.Parse(w,e,r)).snippetId=t,f(F)}else v("Unable to load the snippet "+t)}),y.open("GET",o.SnippetUrl+"/"+t.replace(/#/g,"/")),y.send()})},i.BaseAssetsUrl=Bh.BaseAssetsUrl,i.SnippetUrl="https://snippet.babylonjs.com",i}();E.a.AddParser(dt.a.NAME_PARTICLESYSTEM,function(i,t,e,n){var r=E.a.GetIndividualParser(dt.a.NAME_PARTICLESYSTEM);if(r&&i.particleSystems!==void 0&&i.particleSystems!==null)for(var o=0,u=i.particleSystems.length;o<u;o++){var f=i.particleSystems[o];e.particleSystems.push(r(f,t,n))}}),E.a.AddIndividualParser(dt.a.NAME_PARTICLESYSTEM,function(i,t,e){return i.activeParticleCount?Na.Parse(i,t,e):er.Parse(i,t,e)}),Ge.a.prototype.createEffectForParticles=function(i,t,e,n,r,o,u,f){var v;t===void 0&&(t=[]),e===void 0&&(e=[]),n===void 0&&(n="");var y=[],D=[],w=[];return f?f.fillUniformsAttributesAndSamplerNames(D,y,w):(y=er._GetAttributeNamesOrOptions(),D=er._GetEffectCreationOptions()),n.indexOf(" BILLBOARD")===-1&&(n+=`
#define BILLBOARD
`),e.indexOf("diffuseSampler")===-1&&e.push("diffuseSampler"),this.createEffect({vertex:(v=f==null?void 0:f.vertexShaderName)!==null&&v!==void 0?v:"particles",fragmentElement:i},y,D.concat(t),w.concat(e),n,r,o,u)},Ne.a.prototype.getEmittedParticleSystems=function(){for(var i=new Array,t=0;t<this.getScene().particleSystems.length;t++){var e=this.getScene().particleSystems[t];e.emitter===this&&i.push(e)}return i},Ne.a.prototype.getHierarchyEmittedParticleSystems=function(){var i=new Array,t=this.getDescendants();t.push(this);for(var e=0;e<this.getScene().particleSystems.length;e++){var n=this.getScene().particleSystems[e],r=n.emitter;r.position&&t.indexOf(r)!==-1&&i.push(n)}return i};var Tr,Qm=function(){function i(t,e,n,r,o,u,f,v,y,D){y===void 0&&(y=null),D===void 0&&(D=null),this.idx=0,this.id=0,this.color=new M.b(1,1,1,1),this.position=d.e.Zero(),this.rotation=d.e.Zero(),this.scaling=d.e.One(),this.uvs=new d.f(0,0,1,1),this.velocity=d.e.Zero(),this.pivot=d.e.Zero(),this.translateFromPivot=!1,this.alive=!0,this.isVisible=!0,this._pos=0,this._ind=0,this.shapeId=0,this.idxInShape=0,this._stillInvisible=!1,this._rotationMatrix=[1,0,0,0,1,0,0,0,1],this.parentId=null,this.materialIndex=null,this.props=null,this.cullingStrategy=jt.a.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY,this._globalPosition=d.e.Zero(),this.idx=t,this.id=e,this._pos=n,this._ind=r,this._model=o,this.shapeId=u,this.idxInShape=f,this._sps=v,y&&(this._modelBoundingInfo=y,this._boundingInfo=new Ho.a(y.minimum,y.maximum)),D!==null&&(this.materialIndex=D)}return i.prototype.copyToRef=function(t){return t.position.copyFrom(this.position),t.rotation.copyFrom(this.rotation),this.rotationQuaternion&&(t.rotationQuaternion?t.rotationQuaternion.copyFrom(this.rotationQuaternion):t.rotationQuaternion=this.rotationQuaternion.clone()),t.scaling.copyFrom(this.scaling),this.color&&(t.color?t.color.copyFrom(this.color):t.color=this.color.clone()),t.uvs.copyFrom(this.uvs),t.velocity.copyFrom(this.velocity),t.pivot.copyFrom(this.pivot),t.translateFromPivot=this.translateFromPivot,t.alive=this.alive,t.isVisible=this.isVisible,t.parentId=this.parentId,t.cullingStrategy=this.cullingStrategy,this.materialIndex!==null&&(t.materialIndex=this.materialIndex),this},Object.defineProperty(i.prototype,"scale",{get:function(){return this.scaling},set:function(t){this.scaling=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"quaternion",{get:function(){return this.rotationQuaternion},set:function(t){this.rotationQuaternion=t},enumerable:!1,configurable:!0}),i.prototype.intersectsMesh=function(t){return!(!this._boundingInfo||!t._boundingInfo)&&(this._sps._bSphereOnly?Uy.a.Intersects(this._boundingInfo.boundingSphere,t._boundingInfo.boundingSphere):this._boundingInfo.intersects(t._boundingInfo,!1))},i.prototype.isInFrustum=function(t){return this._boundingInfo!==null&&this._boundingInfo.isInFrustum(t,this.cullingStrategy)},i.prototype.getRotationMatrix=function(t){var e;if(this.rotationQuaternion)e=this.rotationQuaternion;else{e=d.c.Quaternion[0];var n=this.rotation;d.b.RotationYawPitchRollToRef(n.y,n.x,n.z,e)}e.toRotationMatrix(t)},i}(),qm=function(i,t,e,n,r,o,u,f,v){this._indicesLength=0,this.shapeID=i,this._shape=t,this._indices=e,this._indicesLength=e.length,this._shapeUV=o,this._shapeColors=r,this._normals=n,this._positionFunction=u,this._vertexFunction=f,this._material=v},dE=function(i,t,e,n){this.idx=0,this.ind=0,this.indicesLength=0,this.sqDistance=0,this.materialIndex=0,this.idx=i,this.ind=t,this.indicesLength=e,this.materialIndex=n},fE=function(){function i(){this.position=d.e.Zero(),this.color=new M.b(1,1,1,1),this.uv=d.d.Zero()}return Object.defineProperty(i.prototype,"x",{get:function(){return this.position.x},set:function(t){this.position.x=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"y",{get:function(){return this.position.y},set:function(t){this.position.y=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"z",{get:function(){return this.position.z},set:function(t){this.position.z=t},enumerable:!1,configurable:!0}),i}(),hL=function(){function i(t,e,n){this.particles=new Array,this.nbParticles=0,this.billboard=!1,this.recomputeNormals=!1,this.counter=0,this.vars={},this._bSphereOnly=!1,this._bSphereRadiusFactor=1,this._positions=new Array,this._indices=new Array,this._normals=new Array,this._colors=new Array,this._uvs=new Array,this._index=0,this._updatable=!0,this._pickable=!1,this._isVisibilityBoxLocked=!1,this._alwaysVisible=!1,this._depthSort=!1,this._expandable=!1,this._shapeCounter=0,this._copy=new Qm(0,0,0,0,null,0,0,this),this._color=new M.b(0,0,0,0),this._computeParticleColor=!0,this._computeParticleTexture=!0,this._computeParticleRotation=!0,this._computeParticleVertex=!1,this._computeBoundingBox=!1,this._depthSortParticles=!0,this._mustUnrotateFixedNormals=!1,this._particlesIntersect=!1,this._needs32Bits=!1,this._isNotBuilt=!0,this._lastParticleId=0,this._idxOfId=[],this._multimaterialEnabled=!1,this._useModelMaterial=!1,this._depthSortFunction=function(r,o){return o.sqDistance-r.sqDistance},this._materialSortFunction=function(r,o){return r.materialIndex-o.materialIndex},this._autoUpdateSubMeshes=!1,this.name=t,this._scene=e||ne.a.LastCreatedScene,this._camera=e.activeCamera,this._pickable=!!n&&n.isPickable,this._depthSort=!!n&&n.enableDepthSort,this._multimaterialEnabled=!!n&&n.enableMultiMaterial,this._useModelMaterial=!!n&&n.useModelMaterial,this._multimaterialEnabled=!!this._useModelMaterial||this._multimaterialEnabled,this._expandable=!!n&&n.expandable,this._particlesIntersect=!!n&&n.particleIntersection,this._bSphereOnly=!!n&&n.boundingSphereOnly,this._bSphereRadiusFactor=n&&n.bSphereRadiusFactor?n.bSphereRadiusFactor:1,n&&n.updatable!==void 0?this._updatable=n.updatable:this._updatable=!0,this._pickable&&(this.pickedBySubMesh=[[]],this.pickedParticles=this.pickedBySubMesh[0]),(this._depthSort||this._multimaterialEnabled)&&(this.depthSortedParticles=[]),this._multimaterialEnabled&&(this._multimaterial=new wa.a(this.name+"MultiMaterial",this._scene),this._materials=[],this._materialIndexesById={}),this._tmpVertex=new fE}return i.prototype.buildMesh=function(){if(!this._isNotBuilt&&this.mesh)return this.mesh;if(this.nbParticles===0&&!this.mesh){var t=Fh.CreateDisc("",{radius:1,tessellation:3},this._scene);this.addShape(t,1),t.dispose()}if(this._indices32=this._needs32Bits?new Uint32Array(this._indices):new Uint16Array(this._indices),this._positions32=new Float32Array(this._positions),this._uvs32=new Float32Array(this._uvs),this._colors32=new Float32Array(this._colors),!this.mesh){var e=new Ne.a(this.name,this._scene);this.mesh=e}!this._updatable&&this._multimaterialEnabled&&this._sortParticlesByMaterial(),this.recomputeNormals&&Tt.a.ComputeNormals(this._positions32,this._indices32,this._normals),this._normals32=new Float32Array(this._normals),this._fixedNormal32=new Float32Array(this._normals),this._mustUnrotateFixedNormals&&this._unrotateFixedNormals();var n=new Tt.a;if(n.indices=this._depthSort?this._indices:this._indices32,n.set(this._positions32,De.b.PositionKind),n.set(this._normals32,De.b.NormalKind),this._uvs32.length>0&&n.set(this._uvs32,De.b.UVKind),this._colors32.length>0&&n.set(this._colors32,De.b.ColorKind),n.applyToMesh(this.mesh,this._updatable),this.mesh.isPickable=this._pickable,this._pickable){for(var r=0,o=0;o<this.nbParticles;o++)for(var u=this.particles[o],f=u._model._indicesLength,v=0;v<f;v++)if(v%3==0){var y={idx:u.idx,faceId:r};this.pickedParticles[r]=y,r++}}return this._multimaterialEnabled&&this.setMultiMaterial(this._materials),this._expandable||(this._depthSort||this._multimaterialEnabled||(this._indices=null),this._positions=null,this._normals=null,this._uvs=null,this._colors=null,this._updatable||(this.particles.length=0)),this._isNotBuilt=!1,this.recomputeNormals=!1,this.mesh},i.prototype.digest=function(t,e){var n=e&&e.facetNb||1,r=e&&e.number||0,o=e&&e.delta||0,u=t.getVerticesData(De.b.PositionKind),f=t.getIndices(),v=t.getVerticesData(De.b.UVKind),y=t.getVerticesData(De.b.ColorKind),D=t.getVerticesData(De.b.NormalKind),w=e&&e.storage?e.storage:null,F=0,z=f.length/3;r?(r=r>z?z:r,n=Math.round(z/r),o=0):n=n>z?z:n;for(var k=[],K=[],oe=[],ae=[],ue=[],de=d.e.Zero(),me=n;F<z;){F>z-(n=me+Math.floor((1+o)*Math.random()))&&(n=z-F),k.length=0,K.length=0,oe.length=0,ae.length=0,ue.length=0;for(var ye=0,Ee=3*F;Ee<3*(F+n);Ee++){oe.push(ye);var Ae=f[Ee],Ie=3*Ae;if(k.push(u[Ie],u[Ie+1],u[Ie+2]),K.push(D[Ie],D[Ie+1],D[Ie+2]),v){var Re=2*Ae;ae.push(v[Re],v[Re+1])}if(y){var Pe=4*Ae;ue.push(y[Pe],y[Pe+1],y[Pe+2],y[Pe+3])}ye++}var Ce,Be=this.nbParticles,Oe=this._posToShape(k),Ve=this._uvsToShapeUV(ae),Le=et.b.Slice(oe),je=et.b.Slice(ue),tt=et.b.Slice(K);for(de.copyFromFloats(0,0,0),Ce=0;Ce<Oe.length;Ce++)de.addInPlace(Oe[Ce]);de.scaleInPlace(1/Oe.length);var ut,ft=new d.e(1/0,1/0,1/0),vt=new d.e(-1/0,-1/0,-1/0);for(Ce=0;Ce<Oe.length;Ce++)Oe[Ce].subtractInPlace(de),ft.minimizeInPlaceFromFloats(Oe[Ce].x,Oe[Ce].y,Oe[Ce].z),vt.maximizeInPlaceFromFloats(Oe[Ce].x,Oe[Ce].y,Oe[Ce].z);this._particlesIntersect&&(ut=new Ho.a(ft,vt));var rt=null;this._useModelMaterial&&(rt=t.material?t.material:this._setDefaultMaterial());var mt=new qm(this._shapeCounter,Oe,Le,tt,je,Ve,null,null,rt),pt=this._positions.length,it=this._indices.length;this._meshBuilder(this._index,it,Oe,this._positions,Le,this._indices,ae,this._uvs,je,this._colors,tt,this._normals,Be,0,null,mt),this._addParticle(Be,this._lastParticleId,pt,it,mt,this._shapeCounter,0,ut,w),this.particles[this.nbParticles].position.addInPlace(de),w||(this._index+=Oe.length,Be++,this.nbParticles++,this._lastParticleId++),this._shapeCounter++,F+=n}return this._isNotBuilt=!0,this},i.prototype._unrotateFixedNormals=function(){for(var t=0,e=0,n=d.c.Vector3[0],r=d.c.Quaternion[0],o=d.c.Matrix[0],u=0;u<this.particles.length;u++){var f=this.particles[u],v=f._model._shape;if(f.rotationQuaternion)f.rotationQuaternion.conjugateToRef(r);else{var y=f.rotation;d.b.RotationYawPitchRollToRef(y.y,y.x,y.z,r),r.conjugateInPlace()}r.toRotationMatrix(o);for(var D=0;D<v.length;D++)e=t+3*D,d.e.TransformNormalFromFloatsToRef(this._normals32[e],this._normals32[e+1],this._normals32[e+2],o,n),n.toArray(this._fixedNormal32,e);t=e+3}},i.prototype._resetCopy=function(){var t=this._copy;t.position.setAll(0),t.rotation.setAll(0),t.rotationQuaternion=null,t.scaling.setAll(1),t.uvs.copyFromFloats(0,0,1,1),t.color=null,t.translateFromPivot=!1,t.shapeId=0,t.materialIndex=null},i.prototype._meshBuilder=function(t,e,n,r,o,u,f,v,y,D,w,F,z,k,K,oe){var ae,ue=0,de=0,me=0;this._resetCopy();var ye=this._copy,Ee=!(!K||!K.storage);if(ye.idx=z,ye.idxInShape=k,ye.shapeId=oe.shapeID,this._useModelMaterial){var Ae=oe._material.uniqueId,Ie=this._materialIndexesById;Ie.hasOwnProperty(Ae)||(Ie[Ae]=this._materials.length,this._materials.push(oe._material));var Re=Ie[Ae];ye.materialIndex=Re}if(K&&K.positionFunction&&(K.positionFunction(ye,z,k),this._mustUnrotateFixedNormals=!0),Ee)return ye;var Pe=d.c.Matrix[0],Ce=this._tmpVertex,Be=Ce.position,Oe=Ce.color,Ve=Ce.uv,Le=d.c.Vector3[1],je=d.c.Vector3[2],tt=d.c.Vector3[3];d.a.IdentityToRef(Pe),ye.getRotationMatrix(Pe),ye.pivot.multiplyToRef(ye.scaling,tt),ye.translateFromPivot?je.setAll(0):je.copyFrom(tt);var ut=K&&K.vertexFunction;for(ae=0;ae<n.length;ae++){if(Be.copyFrom(n[ae]),ye.color&&Oe.copyFrom(ye.color),f&&Ve.copyFromFloats(f[ue],f[ue+1]),ut&&K.vertexFunction(ye,Ce,ae),Be.multiplyInPlace(ye.scaling).subtractInPlace(tt),d.e.TransformCoordinatesToRef(Be,Pe,Le),Le.addInPlace(je).addInPlace(ye.position),r.push(Le.x,Le.y,Le.z),f){var ft=ye.uvs;v.push((ft.z-ft.x)*Ve.x+ft.x,(ft.w-ft.y)*Ve.y+ft.y),ue+=2}if(ye.color)this._color.copyFrom(Oe);else{var vt=this._color;y&&y[de]!==void 0?(vt.r=y[de],vt.g=y[de+1],vt.b=y[de+2],vt.a=y[de+3]):(vt.r=1,vt.g=1,vt.b=1,vt.a=1)}D.push(this._color.r,this._color.g,this._color.b,this._color.a),de+=4,!this.recomputeNormals&&w&&(d.e.TransformNormalFromFloatsToRef(w[me],w[me+1],w[me+2],Pe,Be),F.push(Be.x,Be.y,Be.z),me+=3)}for(ae=0;ae<o.length;ae++){var rt=t+o[ae];u.push(rt),rt>65535&&(this._needs32Bits=!0)}if(this._depthSort||this._multimaterialEnabled){var mt=ye.materialIndex!==null?ye.materialIndex:0;this.depthSortedParticles.push(new dE(z,e,o.length,mt))}return ye},i.prototype._posToShape=function(t){for(var e=[],n=0;n<t.length;n+=3)e.push(d.e.FromArray(t,n));return e},i.prototype._uvsToShapeUV=function(t){var e=[];if(t)for(var n=0;n<t.length;n++)e.push(t[n]);return e},i.prototype._addParticle=function(t,e,n,r,o,u,f,v,y){v===void 0&&(v=null),y===void 0&&(y=null);var D=new Qm(t,e,n,r,o,u,f,this,v);return(y||this.particles).push(D),D},i.prototype.addShape=function(t,e,n){var r=t.getVerticesData(De.b.PositionKind),o=t.getIndices(),u=t.getVerticesData(De.b.UVKind),f=t.getVerticesData(De.b.ColorKind),v=t.getVerticesData(De.b.NormalKind);this.recomputeNormals=!v;var y=et.b.SliceToArray(o),D=et.b.SliceToArray(v),w=f?et.b.SliceToArray(f):[],F=n&&n.storage?n.storage:null,z=null;this._particlesIntersect&&(z=t.getBoundingInfo());var k=this._posToShape(r),K=this._uvsToShapeUV(u),oe=n?n.positionFunction:null,ae=n?n.vertexFunction:null,ue=null;this._useModelMaterial&&(ue=t.material?t.material:this._setDefaultMaterial());for(var de=new qm(this._shapeCounter,k,y,D,w,K,oe,ae,ue),me=0;me<e;me++)this._insertNewParticle(this.nbParticles,me,de,k,o,u,f,v,z,F,n);return this._shapeCounter++,this._isNotBuilt=!0,this._shapeCounter-1},i.prototype._rebuildParticle=function(t,e){e===void 0&&(e=!1),this._resetCopy();var n=this._copy;t._model._positionFunction&&t._model._positionFunction(n,t.idx,t.idxInShape);var r=d.c.Matrix[0],o=d.c.Vector3[0],u=d.c.Vector3[1],f=d.c.Vector3[2],v=d.c.Vector3[3];n.getRotationMatrix(r),t.pivot.multiplyToRef(t.scaling,v),n.translateFromPivot?f.copyFromFloats(0,0,0):f.copyFrom(v);for(var y=t._model._shape,D=0;D<y.length;D++)o.copyFrom(y[D]),t._model._vertexFunction&&t._model._vertexFunction(n,o,D),o.multiplyInPlace(n.scaling).subtractInPlace(v),d.e.TransformCoordinatesToRef(o,r,u),u.addInPlace(f).addInPlace(n.position).toArray(this._positions32,t._pos+3*D);e&&(t.position.setAll(0),t.rotation.setAll(0),t.rotationQuaternion=null,t.scaling.setAll(1),t.uvs.setAll(0),t.pivot.setAll(0),t.translateFromPivot=!1,t.parentId=null)},i.prototype.rebuildMesh=function(t){t===void 0&&(t=!1);for(var e=0;e<this.particles.length;e++)this._rebuildParticle(this.particles[e],t);return this.mesh.updateVerticesData(De.b.PositionKind,this._positions32,!1,!1),this},i.prototype.removeParticles=function(t,e){var n=e-t+1;if(!this._expandable||n<=0||n>=this.nbParticles||!this._updatable)return[];var r=this.particles,o=this.nbParticles;if(e<o-1)for(var u=e+1,f=r[u]._pos-r[t]._pos,v=r[u]._ind-r[t]._ind,y=u;y<o;y++){var D=r[y];D._pos-=f,D._ind-=v}var w=r.splice(t,n);this._positions.length=0,this._indices.length=0,this._colors.length=0,this._uvs.length=0,this._normals.length=0,this._index=0,this._idxOfId.length=0,(this._depthSort||this._multimaterialEnabled)&&(this.depthSortedParticles=[]);for(var F=0,z=r.length,k=0;k<z;k++){var K=r[k],oe=K._model,ae=oe._shape,ue=oe._indices,de=oe._normals,me=oe._shapeColors,ye=oe._shapeUV;K.idx=k,this._idxOfId[K.id]=k,this._meshBuilder(this._index,F,ae,this._positions,ue,this._indices,ye,this._uvs,me,this._colors,de,this._normals,K.idx,K.idxInShape,null,oe),this._index+=ae.length,F+=ue.length}return this.nbParticles-=n,this._isNotBuilt=!0,w},i.prototype.insertParticlesFromArray=function(t){if(!this._expandable)return this;for(var e=0,n=t[0].shapeId,r=t.length,o=0;o<r;o++){var u=t[o],f=u._model,v=f._shape,y=f._indices,D=f._shapeUV,w=f._shapeColors,F=f._normals,z=!F;this.recomputeNormals=z||this.recomputeNormals;var k=u._boundingInfo,K=this._insertNewParticle(this.nbParticles,e,f,v,y,D,w,F,k,null,null);u.copyToRef(K),e++,n!=u.shapeId&&(n=u.shapeId,e=0)}return this._isNotBuilt=!0,this},i.prototype._insertNewParticle=function(t,e,n,r,o,u,f,v,y,D,w){var F=this._positions.length,z=this._indices.length,k=this._meshBuilder(this._index,z,r,this._positions,o,this._indices,u,this._uvs,f,this._colors,v,this._normals,t,e,w,n),K=null;return this._updatable&&((K=this._addParticle(this.nbParticles,this._lastParticleId,F,z,n,this._shapeCounter,e,y,D)).position.copyFrom(k.position),K.rotation.copyFrom(k.rotation),k.rotationQuaternion&&(K.rotationQuaternion?K.rotationQuaternion.copyFrom(k.rotationQuaternion):K.rotationQuaternion=k.rotationQuaternion.clone()),k.color&&(K.color?K.color.copyFrom(k.color):K.color=k.color.clone()),K.scaling.copyFrom(k.scaling),K.uvs.copyFrom(k.uvs),k.materialIndex!==null&&(K.materialIndex=k.materialIndex),this.expandable&&(this._idxOfId[K.id]=K.idx)),D||(this._index+=r.length,this.nbParticles++,this._lastParticleId++),K},i.prototype.setParticles=function(t,e,n){if(t===void 0&&(t=0),e===void 0&&(e=this.nbParticles-1),n===void 0&&(n=!0),!this._updatable||this._isNotBuilt)return this;this.beforeUpdateParticles(t,e,n);var r=d.c.Matrix[0],o=d.c.Matrix[1],u=this.mesh,f=this._colors32,v=this._positions32,y=this._normals32,D=this._uvs32,w=this._indices32,F=this._indices,z=this._fixedNormal32,k=d.c.Vector3,K=k[5].copyFromFloats(1,0,0),oe=k[6].copyFromFloats(0,1,0),ae=k[7].copyFromFloats(0,0,1),ue=k[8].setAll(Number.MAX_VALUE),de=k[9].setAll(-Number.MAX_VALUE),me=k[10].setAll(0),ye=this._tmpVertex,Ee=ye.position,Ae=ye.color,Ie=ye.uv;if((this.billboard||this._depthSort)&&(this.mesh.computeWorldMatrix(!0),this.mesh._worldMatrix.invertToRef(o)),this.billboard){var Re=k[0];this._camera.getDirectionToRef(Se.a.Z,Re),d.e.TransformNormalToRef(Re,o,ae),ae.normalize();var Pe=this._camera.getViewMatrix(!0);d.e.TransformNormalFromFloatsToRef(Pe.m[1],Pe.m[5],Pe.m[9],o,oe),d.e.CrossToRef(oe,ae,K),oe.normalize(),K.normalize()}this._depthSort&&d.e.TransformCoordinatesToRef(this._camera.globalPosition,o,me),d.a.IdentityToRef(r);var Ce=0,Be=0,Oe=0,Ve=0,Le=0,je=0,tt=0;if(this.mesh.isFacetDataEnabled&&(this._computeBoundingBox=!0),e=e>=this.nbParticles?this.nbParticles-1:e,this._computeBoundingBox&&(t!=0||e!=this.nbParticles-1)){var ut=this.mesh._boundingInfo;ut&&(ue.copyFrom(ut.minimum),de.copyFrom(ut.maximum))}var ft=(Be=this.particles[t]._pos)/3|0;Ve=4*ft,je=2*ft;for(var vt=t;vt<=e;vt++){var rt=this.particles[vt];this.updateParticle(rt);var mt=rt._model._shape,pt=rt._model._shapeUV,it=rt._rotationMatrix,yt=rt.position,He=rt.rotation,at=rt.scaling,It=rt._globalPosition;if(this._depthSort&&this._depthSortParticles){var vn=this.depthSortedParticles[vt];vn.idx=rt.idx,vn.ind=rt._ind,vn.indicesLength=rt._model._indicesLength,vn.sqDistance=d.e.DistanceSquared(rt.position,me)}if(!rt.alive||rt._stillInvisible&&!rt.isVisible)Be+=3*(tt=mt.length),Ve+=4*tt,je+=2*tt;else{if(rt.isVisible){rt._stillInvisible=!1;var Jt=k[12];if(rt.pivot.multiplyToRef(at,Jt),this.billboard&&(He.x=0,He.y=0),(this._computeParticleRotation||this.billboard)&&rt.getRotationMatrix(r),rt.parentId!==null){var Sn=this.getParticleById(rt.parentId);if(Sn){var Rt=Sn._rotationMatrix,Rn=Sn._globalPosition,bn=yt.x*Rt[1]+yt.y*Rt[4]+yt.z*Rt[7],hn=yt.x*Rt[0]+yt.y*Rt[3]+yt.z*Rt[6],yn=yt.x*Rt[2]+yt.y*Rt[5]+yt.z*Rt[8];if(It.x=Rn.x+hn,It.y=Rn.y+bn,It.z=Rn.z+yn,this._computeParticleRotation||this.billboard){var Lt=r.m;it[0]=Lt[0]*Rt[0]+Lt[1]*Rt[3]+Lt[2]*Rt[6],it[1]=Lt[0]*Rt[1]+Lt[1]*Rt[4]+Lt[2]*Rt[7],it[2]=Lt[0]*Rt[2]+Lt[1]*Rt[5]+Lt[2]*Rt[8],it[3]=Lt[4]*Rt[0]+Lt[5]*Rt[3]+Lt[6]*Rt[6],it[4]=Lt[4]*Rt[1]+Lt[5]*Rt[4]+Lt[6]*Rt[7],it[5]=Lt[4]*Rt[2]+Lt[5]*Rt[5]+Lt[6]*Rt[8],it[6]=Lt[8]*Rt[0]+Lt[9]*Rt[3]+Lt[10]*Rt[6],it[7]=Lt[8]*Rt[1]+Lt[9]*Rt[4]+Lt[10]*Rt[7],it[8]=Lt[8]*Rt[2]+Lt[9]*Rt[5]+Lt[10]*Rt[8]}}else rt.parentId=null}else It.x=yt.x,It.y=yt.y,It.z=yt.z,(this._computeParticleRotation||this.billboard)&&(Lt=r.m,it[0]=Lt[0],it[1]=Lt[1],it[2]=Lt[2],it[3]=Lt[4],it[4]=Lt[5],it[5]=Lt[6],it[6]=Lt[8],it[7]=Lt[9],it[8]=Lt[10]);var Kt=k[11];for(rt.translateFromPivot?Kt.setAll(0):Kt.copyFrom(Jt),tt=0;tt<mt.length;tt++){Ce=Be+3*tt,Oe=Ve+4*tt,Le=je+2*tt;var In=2*tt,Lr=In+1;Ee.copyFrom(mt[tt]),this._computeParticleColor&&rt.color&&Ae.copyFrom(rt.color),this._computeParticleTexture&&Ie.copyFromFloats(pt[In],pt[Lr]),this._computeParticleVertex&&this.updateParticleVertex(rt,ye,tt);var Wr=Ee.x*at.x-Jt.x,pi=Ee.y*at.y-Jt.y,Nr=Ee.z*at.z-Jt.z;hn=Wr*it[0]+pi*it[3]+Nr*it[6],bn=Wr*it[1]+pi*it[4]+Nr*it[7],yn=Wr*it[2]+pi*it[5]+Nr*it[8],hn+=Kt.x,bn+=Kt.y,yn+=Kt.z;var xn=v[Ce]=It.x+K.x*hn+oe.x*bn+ae.x*yn,Ci=v[Ce+1]=It.y+K.y*hn+oe.y*bn+ae.y*yn,ho=v[Ce+2]=It.z+K.z*hn+oe.z*bn+ae.z*yn;if(this._computeBoundingBox&&(ue.minimizeInPlaceFromFloats(xn,Ci,ho),de.maximizeInPlaceFromFloats(xn,Ci,ho)),!this._computeParticleVertex){var Vs=z[Ce],ks=z[Ce+1],Ri=z[Ce+2],Qo=Vs*it[0]+ks*it[3]+Ri*it[6],js=Vs*it[1]+ks*it[4]+Ri*it[7],dn=Vs*it[2]+ks*it[5]+Ri*it[8];y[Ce]=K.x*Qo+oe.x*js+ae.x*dn,y[Ce+1]=K.y*Qo+oe.y*js+ae.y*dn,y[Ce+2]=K.z*Qo+oe.z*js+ae.z*dn}if(this._computeParticleColor&&rt.color){var qo=this._colors32;qo[Oe]=Ae.r,qo[Oe+1]=Ae.g,qo[Oe+2]=Ae.b,qo[Oe+3]=Ae.a}if(this._computeParticleTexture){var Er=rt.uvs;D[Le]=Ie.x*(Er.z-Er.x)+Er.x,D[Le+1]=Ie.y*(Er.w-Er.y)+Er.y}}}else for(rt._stillInvisible=!0,tt=0;tt<mt.length;tt++){if(Oe=Ve+4*tt,Le=je+2*tt,v[Ce=Be+3*tt]=v[Ce+1]=v[Ce+2]=0,y[Ce]=y[Ce+1]=y[Ce+2]=0,this._computeParticleColor&&rt.color){var Ua=rt.color;f[Oe]=Ua.r,f[Oe+1]=Ua.g,f[Oe+2]=Ua.b,f[Oe+3]=Ua.a}this._computeParticleTexture&&(Er=rt.uvs,D[Le]=pt[2*tt]*(Er.z-Er.x)+Er.x,D[Le+1]=pt[2*tt+1]*(Er.w-Er.y)+Er.y)}if(this._particlesIntersect){var fo=rt._boundingInfo,td=fo.boundingBox,nd=fo.boundingSphere,zs=rt._modelBoundingInfo;if(!this._bSphereOnly){var Zo=zs.boundingBox.vectors,$o=k[1],Va=k[2];$o.setAll(Number.MAX_VALUE),Va.setAll(-Number.MAX_VALUE);for(var Jo=0;Jo<8;Jo++){var Gs=Zo[Jo].x*at.x,Hs=Zo[Jo].y*at.y,Ws=Zo[Jo].z*at.z,ea=(hn=Gs*it[0]+Hs*it[3]+Ws*it[6],bn=Gs*it[1]+Hs*it[4]+Ws*it[7],yn=Gs*it[2]+Hs*it[5]+Ws*it[8],yt.x+K.x*hn+oe.x*bn+ae.x*yn),ta=yt.y+K.y*hn+oe.y*bn+ae.y*yn,Xs=yt.z+K.z*hn+oe.z*bn+ae.z*yn;$o.minimizeInPlaceFromFloats(ea,ta,Xs),Va.maximizeInPlaceFromFloats(ea,ta,Xs)}td.reConstruct($o,Va,u._worldMatrix)}var po=zs.minimum.multiplyToRef(at,k[1]),Fr=zs.maximum.multiplyToRef(at,k[2]),Cl=Fr.addToRef(po,k[3]).scaleInPlace(.5).addInPlace(It),ka=Fr.subtractToRef(po,k[4]).scaleInPlace(.5*this._bSphereRadiusFactor),Rl=Cl.subtractToRef(ka,k[1]),YN=Cl.addToRef(ka,k[2]);nd.reConstruct(Rl,YN,u._worldMatrix)}Be=Ce+3,Ve=Oe+4,je=Le+2}}if(n){if(this._computeParticleColor&&u.updateVerticesData(De.b.ColorKind,f,!1,!1),this._computeParticleTexture&&u.updateVerticesData(De.b.UVKind,D,!1,!1),u.updateVerticesData(De.b.PositionKind,v,!1,!1),!u.areNormalsFrozen||u.isFacetDataEnabled){if(this._computeParticleVertex||u.isFacetDataEnabled){var KN=u.isFacetDataEnabled?u.getFacetDataParameters():null;Tt.a.ComputeNormals(v,w,y,KN);for(var mo=0;mo<y.length;mo++)z[mo]=y[mo]}u.areNormalsFrozen||u.updateVerticesData(De.b.NormalKind,y,!1,!1)}if(this._depthSort&&this._depthSortParticles){var b_=this.depthSortedParticles;b_.sort(this._depthSortFunction);for(var QN=b_.length,aS=0,y_=0,T_=0;T_<QN;T_++){var E_=b_[T_],qN=E_.indicesLength,ZN=E_.ind;for(mo=0;mo<qN;mo++)if(w[aS]=F[ZN+mo],aS++,this._pickable&&mo%3==0){var sS=this.pickedParticles[y_];sS.idx=E_.idx,sS.faceId=y_,y_++}}u.updateIndices(w)}}return this._computeBoundingBox&&(u._boundingInfo?u._boundingInfo.reConstruct(ue,de,u._worldMatrix):u._boundingInfo=new Ho.a(ue,de,u._worldMatrix)),this._autoUpdateSubMeshes&&this.computeSubMeshes(),this.afterUpdateParticles(t,e,n),this},i.prototype.dispose=function(){this.mesh.dispose(),this.vars=null,this._positions=null,this._indices=null,this._normals=null,this._uvs=null,this._colors=null,this._indices32=null,this._positions32=null,this._normals32=null,this._fixedNormal32=null,this._uvs32=null,this._colors32=null,this.pickedParticles=null,this.pickedBySubMesh=null,this._materials=null,this._materialIndexes=null,this._indicesByMaterial=null,this._idxOfId=null},i.prototype.pickedParticle=function(t){if(t.hit){var e=t.subMeshId,n=t.faceId,r=this.pickedBySubMesh;if(r[e]&&r[e][n])return r[e][n]}return null},i.prototype.getParticleById=function(t){var e=this.particles[t];if(e&&e.id==t)return e;var n=this.particles,r=this._idxOfId[t];if(r!==void 0)return n[r];for(var o=0,u=this.nbParticles;o<u;){var f=n[o];if(f.id==t)return f;o++}return null},i.prototype.getParticlesByShapeId=function(t){var e=[];return this.getParticlesByShapeIdToRef(t,e),e},i.prototype.getParticlesByShapeIdToRef=function(t,e){e.length=0;for(var n=0;n<this.nbParticles;n++){var r=this.particles[n];r.shapeId==t&&e.push(r)}return this},i.prototype.computeSubMeshes=function(){if(!this.mesh||!this._multimaterialEnabled)return this;var t=this.depthSortedParticles;if(this.particles.length>0)for(var e=0;e<this.particles.length;e++){var n=this.particles[e];n.materialIndex||(n.materialIndex=0);var r=t[e];r.materialIndex=n.materialIndex,r.ind=n._ind,r.indicesLength=n._model._indicesLength,r.idx=n.idx}this._sortParticlesByMaterial();var o=this._indicesByMaterial,u=this._materialIndexes,f=this.mesh;f.subMeshes=[];for(var v=f.getTotalVertices(),y=0;y<u.length;y++){var D=o[y],w=o[y+1]-D,F=u[y];new vl.a(F,0,v,D,w,f)}return this},i.prototype._sortParticlesByMaterial=function(){var t=[0];this._indicesByMaterial=t;var e=[];this._materialIndexes=e;var n=this.depthSortedParticles;n.sort(this._materialSortFunction);var r=n.length,o=this._indices32,u=this._indices,f=0,v=0,y=0,D=n[0].materialIndex;e.push(D),this._pickable&&(this.pickedBySubMesh=[[]],this.pickedParticles=this.pickedBySubMesh[0]);for(var w=0;w<r;w++){var F=n[w],z=F.indicesLength,k=F.ind;F.materialIndex!==D&&(D=F.materialIndex,t.push(y),e.push(D),this._pickable&&(f++,this.pickedBySubMesh[f]=[],v=0));for(var K=0,oe=0;oe<z;oe++){if(o[y]=u[k+oe],this._pickable&&oe%3==0){var ae=this.pickedBySubMesh[f][v];ae?(ae.idx=F.idx,ae.faceId=K):this.pickedBySubMesh[f][v]={idx:F.idx,faceId:K},v++,K++}y++}}return t.push(o.length),this._updatable&&this.mesh.updateIndices(o),this},i.prototype._setMaterialIndexesById=function(){this._materialIndexesById={};for(var t=0;t<this._materials.length;t++){var e=this._materials[t].uniqueId;this._materialIndexesById[e]=t}},i.prototype._filterUniqueMaterialId=function(t){return t.filter(function(e,n,r){return r.indexOf(e)===n})},i.prototype._setDefaultMaterial=function(){return this._defaultMaterial||(this._defaultMaterial=new on.a(this.name+"DefaultMaterial",this._scene)),this._defaultMaterial},i.prototype.refreshVisibleSize=function(){return this._isVisibilityBoxLocked||this.mesh.refreshBoundingInfo(),this},i.prototype.setVisibilityBox=function(t){var e=t/2;this.mesh._boundingInfo=new Ho.a(new d.e(-e,-e,-e),new d.e(e,e,e))},Object.defineProperty(i.prototype,"isAlwaysVisible",{get:function(){return this._alwaysVisible},set:function(t){this._alwaysVisible=t,this.mesh.alwaysSelectAsActiveMesh=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isVisibilityBoxLocked",{get:function(){return this._isVisibilityBoxLocked},set:function(t){this._isVisibilityBoxLocked=t,this.mesh.getBoundingInfo().isLocked=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"computeParticleRotation",{get:function(){return this._computeParticleRotation},set:function(t){this._computeParticleRotation=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"computeParticleColor",{get:function(){return this._computeParticleColor},set:function(t){this._computeParticleColor=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"computeParticleTexture",{get:function(){return this._computeParticleTexture},set:function(t){this._computeParticleTexture=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"computeParticleVertex",{get:function(){return this._computeParticleVertex},set:function(t){this._computeParticleVertex=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"computeBoundingBox",{get:function(){return this._computeBoundingBox},set:function(t){this._computeBoundingBox=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"depthSortParticles",{get:function(){return this._depthSortParticles},set:function(t){this._depthSortParticles=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"expandable",{get:function(){return this._expandable},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"multimaterialEnabled",{get:function(){return this._multimaterialEnabled},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"useModelMaterial",{get:function(){return this._useModelMaterial},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"materials",{get:function(){return this._materials},enumerable:!1,configurable:!0}),i.prototype.setMultiMaterial=function(t){this._materials=this._filterUniqueMaterialId(t),this._setMaterialIndexesById(),this._multimaterial&&this._multimaterial.dispose(),this._multimaterial=new wa.a(this.name+"MultiMaterial",this._scene);for(var e=0;e<this._materials.length;e++)this._multimaterial.subMaterials.push(this._materials[e]);this.computeSubMeshes(),this.mesh.material=this._multimaterial},Object.defineProperty(i.prototype,"multimaterial",{get:function(){return this._multimaterial},set:function(t){this._multimaterial=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"autoUpdateSubMeshes",{get:function(){return this._autoUpdateSubMeshes},set:function(t){this._autoUpdateSubMeshes=t},enumerable:!1,configurable:!0}),i.prototype.initParticles=function(){},i.prototype.recycleParticle=function(t){return t},i.prototype.updateParticle=function(t){return t},i.prototype.updateParticleVertex=function(t,e,n){return this},i.prototype.beforeUpdateParticles=function(t,e,n){},i.prototype.afterUpdateParticles=function(t,e,n){},i}(),pE=function(){function i(t,e,n,r,o){this.idx=0,this.color=new M.b(1,1,1,1),this.position=d.e.Zero(),this.rotation=d.e.Zero(),this.uv=new d.d(0,0),this.velocity=d.e.Zero(),this.pivot=d.e.Zero(),this.translateFromPivot=!1,this._pos=0,this._ind=0,this.groupId=0,this.idxInGroup=0,this._stillInvisible=!1,this._rotationMatrix=[1,0,0,0,1,0,0,0,1],this.parentId=null,this._globalPosition=d.e.Zero(),this.idx=t,this._group=e,this.groupId=n,this.idxInGroup=r,this._pcs=o}return Object.defineProperty(i.prototype,"size",{get:function(){return this.size},set:function(t){this.size=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"quaternion",{get:function(){return this.rotationQuaternion},set:function(t){this.rotationQuaternion=t},enumerable:!1,configurable:!0}),i.prototype.intersectsMesh=function(t,e){if(!t._boundingInfo)return!1;if(e=e||!1)return t.getBoundingInfo().boundingSphere.intersectsPoint(this.position.add(this._pcs.mesh.position));var n,r,o,u,f,v;n=t.getBoundingInfo().boundingBox.maximumWorld.x,r=t.getBoundingInfo().boundingBox.minimumWorld.x,o=t.getBoundingInfo().boundingBox.maximumWorld.y,u=t.getBoundingInfo().boundingBox.minimumWorld.y,f=t.getBoundingInfo().boundingBox.maximumWorld.z,v=t.getBoundingInfo().boundingBox.minimumWorld.z;var y=this.position.x+this._pcs.mesh.position.x,D=this.position.y+this._pcs.mesh.position.y,w=this.position.z+this._pcs.mesh.position.z;return r<=y&&y<=n&&u<=D&&D<=o&&v<=w&&w<=f},i.prototype.getRotationMatrix=function(t){var e;if(this.rotationQuaternion)e=this.rotationQuaternion;else{e=d.c.Quaternion[0];var n=this.rotation;d.b.RotationYawPitchRollToRef(n.y,n.x,n.z,e)}e.toRotationMatrix(t)},i}(),Uh=function(i,t){this.groupID=i,this._positionFunction=t};(function(i){i[i.Color=2]="Color",i[i.UV=1]="UV",i[i.Random=0]="Random",i[i.Stated=3]="Stated"})(Tr||(Tr={}));var dL=function(){function i(t,e,n,r){this.particles=new Array,this.nbParticles=0,this.counter=0,this.vars={},this._promises=[],this._positions=new Array,this._indices=new Array,this._normals=new Array,this._colors=new Array,this._uvs=new Array,this._updatable=!0,this._isVisibilityBoxLocked=!1,this._alwaysVisible=!1,this._groups=new Array,this._groupCounter=0,this._computeParticleColor=!0,this._computeParticleTexture=!0,this._computeParticleRotation=!0,this._computeBoundingBox=!1,this._isReady=!1,this.name=t,this._size=e,this._scene=n||ne.a.LastCreatedScene,r&&r.updatable!==void 0?this._updatable=r.updatable:this._updatable=!0}return i.prototype.buildMeshAsync=function(){var t=this;return Promise.all(this._promises).then(function(){return t._isReady=!0,t._buildMesh()})},i.prototype._buildMesh=function(){this.nbParticles===0&&this.addPoints(1),this._positions32=new Float32Array(this._positions),this._uvs32=new Float32Array(this._uvs),this._colors32=new Float32Array(this._colors);var t=new Tt.a;t.set(this._positions32,De.b.PositionKind),this._uvs32.length>0&&t.set(this._uvs32,De.b.UVKind);var e=0;this._colors32.length>0&&(e=1,t.set(this._colors32,De.b.ColorKind));var n=new Ne.a(this.name,this._scene);t.applyToMesh(n,this._updatable),this.mesh=n,this._positions=null,this._uvs=null,this._colors=null,this._updatable||(this.particles.length=0);var r=new on.a("point cloud material",this._scene);return r.emissiveColor=new M.a(e,e,e),r.disableLighting=!0,r.pointsCloud=!0,r.pointSize=this._size,n.material=r,new Promise(function(o){return o(n)})},i.prototype._addParticle=function(t,e,n,r){var o=new pE(t,e,n,r,this);return this.particles.push(o),o},i.prototype._randomUnitVector=function(t){t.position=new d.e(Math.random(),Math.random(),Math.random()),t.color=new M.b(1,1,1,1)},i.prototype._getColorIndicesForCoord=function(t,e,n,r){var o=t._groupImageData,u=n*(4*r)+4*e,f=[u,u+1,u+2,u+3],v=f[1],y=f[2],D=f[3],w=o[f[0]],F=o[v],z=o[y],k=o[D];return new M.b(w/255,F/255,z/255,k)},i.prototype._setPointsColorOrUV=function(t,e,n,r,o,u,f){n&&t.updateFacetData();var v=2*t.getBoundingInfo().boundingSphere.radius,y=t.getVerticesData(De.b.PositionKind),D=t.getIndices(),w=t.getVerticesData(De.b.UVKind),F=t.getVerticesData(De.b.ColorKind),z=d.e.Zero();t.computeWorldMatrix();var k=t.getWorldMatrix();if(!k.isIdentity())for(var K=0;K<y.length/3;K++)d.e.TransformCoordinatesFromFloatsToRef(y[3*K],y[3*K+1],y[3*K+2],k,z),y[3*K]=z.x,y[3*K+1]=z.y,y[3*K+2]=z.z;var oe,ae,ue=0,de=0,me=0,ye=0,Ee=0,Ae=0,Ie=0,Re=0,Pe=0,Ce=0,Be=0,Oe=0,Ve=0,Le=0,je=d.e.Zero(),tt=d.e.Zero(),ut=d.e.Zero(),ft=d.e.Zero(),vt=d.e.Zero(),rt=0,mt=0,pt=0,it=0,yt=0,He=0,at=d.d.Zero(),It=d.d.Zero(),vn=d.d.Zero(),Jt=d.d.Zero(),Sn=d.d.Zero(),Rt=0,Rn=0,bn=0,hn=0,yn=0,Lt=0,Kt=0,In=0,Lr=0,Wr=0,pi=0,Nr=0,xn=d.f.Zero(),Ci=d.f.Zero(),ho=d.f.Zero(),Vs=d.f.Zero(),ks=d.f.Zero(),Ri=0,Qo=0;f=f||0;var js,dn=new d.f(0,0,0,0),qo=d.e.Zero(),Er=d.e.Zero(),Ua=d.e.Zero(),fo=0,td=d.e.Zero(),nd=0,zs=0,Zo=new Qn.a(d.e.Zero(),new d.e(1,0,0)),$o=d.e.Zero();for(de=0;de<D.length/3;de++){var Va,Jo,Gs,Hs,Ws,ea,ta,Xs;me=D[3*de],ye=D[3*de+1],Ee=D[3*de+2],Ae=y[3*me],Ie=y[3*me+1],Re=y[3*me+2],Pe=y[3*ye],Ce=y[3*ye+1],Be=y[3*ye+2],Oe=y[3*Ee],Ve=y[3*Ee+1],Le=y[3*Ee+2],je.set(Ae,Ie,Re),tt.set(Pe,Ce,Be),ut.set(Oe,Ve,Le),tt.subtractToRef(je,ft),ut.subtractToRef(tt,vt),w&&(rt=w[2*me],mt=w[2*me+1],pt=w[2*ye],it=w[2*ye+1],yt=w[2*Ee],He=w[2*Ee+1],at.set(rt,mt),It.set(pt,it),vn.set(yt,He),It.subtractToRef(at,Jt),vn.subtractToRef(It,Sn)),F&&r&&(Rt=F[4*me],Rn=F[4*me+1],bn=F[4*me+2],hn=F[4*me+3],yn=F[4*ye],Lt=F[4*ye+1],Kt=F[4*ye+2],In=F[4*ye+3],Lr=F[4*Ee],Wr=F[4*Ee+1],pi=F[4*Ee+2],Nr=F[4*Ee+3],xn.set(Rt,Rn,bn,hn),Ci.set(yn,Lt,Kt,In),ho.set(Lr,Wr,pi,Nr),Ci.subtractToRef(xn,Vs),ho.subtractToRef(Ci,ks));for(var po,Fr,Cl=new M.a(0,0,0),ka=new M.a(0,0,0),Rl=0;Rl<e._groupDensity[de];Rl++)ue=this.particles.length,this._addParticle(ue,e,this._groupCounter,de+Rl),Fr=this.particles[ue],Ri=te.a.RandomRange(0,1),Qo=te.a.RandomRange(0,1),oe=je.add(ft.scale(Ri)).add(vt.scale(Ri*Qo)),n&&(qo=t.getFacetNormal(de).normalize().scale(-1),Er=ft.clone().normalize(),Ua=d.e.Cross(qo,Er),fo=te.a.RandomRange(0,2*Math.PI),td=Er.scale(Math.cos(fo)).add(Ua.scale(Math.sin(fo))),fo=te.a.RandomRange(.1,Math.PI/2),$o=td.scale(Math.cos(fo)).add(qo.scale(Math.sin(fo))),Zo.origin=oe.add($o.scale(1e-5)),Zo.direction=$o,Zo.length=v,(js=Zo.intersectsMesh(t)).hit&&(zs=js.pickedPoint.subtract(oe).length(),nd=te.a.RandomRange(0,1)*zs,oe.addInPlace($o.scale(nd)))),Fr.position=oe.clone(),this._positions.push(Fr.position.x,Fr.position.y,Fr.position.z),r!==void 0?w&&(ae=at.add(Jt.scale(Ri)).add(Sn.scale(Ri*Qo)),r?o&&e._groupImageData!==null?(Va=e._groupImgWidth,Jo=e._groupImgHeight,po=this._getColorIndicesForCoord(e,Math.round(ae.x*Va),Math.round(ae.y*Jo),Va),Fr.color=po,this._colors.push(po.r,po.g,po.b,po.a)):F?(dn=xn.add(Vs.scale(Ri)).add(ks.scale(Ri*Qo)),Fr.color=new M.b(dn.x,dn.y,dn.z,dn.w),this._colors.push(dn.x,dn.y,dn.z,dn.w)):(dn=xn.set(Math.random(),Math.random(),Math.random(),1),Fr.color=new M.b(dn.x,dn.y,dn.z,dn.w),this._colors.push(dn.x,dn.y,dn.z,dn.w)):(Fr.uv=ae.clone(),this._uvs.push(Fr.uv.x,Fr.uv.y))):(u?(Cl.set(u.r,u.g,u.b),Gs=te.a.RandomRange(-f,f),Hs=te.a.RandomRange(-f,f),Ws=(Xs=Cl.toHSV()).r,(ea=Xs.g+Gs)<0&&(ea=0),ea>1&&(ea=1),(ta=Xs.b+Hs)<0&&(ta=0),ta>1&&(ta=1),M.a.HSVtoRGBToRef(Ws,ea,ta,ka),dn.set(ka.r,ka.g,ka.b,1)):dn=xn.set(Math.random(),Math.random(),Math.random(),1),Fr.color=new M.b(dn.x,dn.y,dn.z,dn.w),this._colors.push(dn.x,dn.y,dn.z,dn.w))}},i.prototype._colorFromTexture=function(t,e,n){var r=this;if(t.material===null)return _.a.Warn(t.name+"has no material."),e._groupImageData=null,void this._setPointsColorOrUV(t,e,n,!0,!1);var o=t.material.getActiveTextures();if(o.length===0)return _.a.Warn(t.name+"has no useable texture."),e._groupImageData=null,void this._setPointsColorOrUV(t,e,n,!0,!1);var u=t.clone();u.setEnabled(!1),this._promises.push(new Promise(function(f){$r.a.WhenAllReady(o,function(){var v=e._textureNb;return v<0&&(v=0),v>o.length-1&&(v=o.length-1),e._groupImageData=o[v].readPixels(),e._groupImgWidth=o[v].getSize().width,e._groupImgHeight=o[v].getSize().height,r._setPointsColorOrUV(u,e,n,!0,!0),u.dispose(),f()})}))},i.prototype._calculateDensity=function(t,e,n){for(var r,o,u,f,v,y,D,w,F,z,k,K,oe,ae,ue,de,me,ye=new Array,Ee=d.e.Zero(),Ae=d.e.Zero(),Ie=d.e.Zero(),Re=d.e.Zero(),Pe=d.e.Zero(),Ce=d.e.Zero(),Be=new Array,Oe=0,Ve=n.length/3,Le=0;Le<Ve;Le++)r=n[3*Le],o=n[3*Le+1],u=n[3*Le+2],f=e[3*r],v=e[3*r+1],y=e[3*r+2],D=e[3*o],w=e[3*o+1],F=e[3*o+2],z=e[3*u],k=e[3*u+1],K=e[3*u+2],Ee.set(f,v,y),Ae.set(D,w,F),Ie.set(z,k,K),Ae.subtractToRef(Ee,Re),Ie.subtractToRef(Ae,Pe),Ie.subtractToRef(Ee,Ce),de=((oe=Re.length())+(ae=Pe.length())+(ue=Ce.length()))/2,Oe+=me=Math.sqrt(de*(de-oe)*(de-ae)*(de-ue)),Be[Le]=me;var je=0;for(Le=0;Le<Ve;Le++)ye[Le]=Math.floor(t*Be[Le]/Oe),je+=ye[Le];var tt=t-je,ut=Math.floor(tt/Ve),ft=tt%Ve;for(ut>0&&(ye=ye.map(function(vt){return vt+ut})),Le=0;Le<ft;Le++)ye[Le]+=1;return ye},i.prototype.addPoints=function(t,e){e===void 0&&(e=this._randomUnitVector);for(var n,r=new Uh(this._groupCounter,e),o=this.nbParticles,u=0;u<t;u++)n=this._addParticle(o,r,this._groupCounter,u),r&&r._positionFunction&&r._positionFunction(n,o,u),this._positions.push(n.position.x,n.position.y,n.position.z),n.color&&this._colors.push(n.color.r,n.color.g,n.color.b,n.color.a),n.uv&&this._uvs.push(n.uv.x,n.uv.y),o++;return this.nbParticles+=t,this._groupCounter++,this._groupCounter},i.prototype.addSurfacePoints=function(t,e,n,r,o){var u=n||Tr.Random;(isNaN(u)||u<0||u>3)&&(u=Tr.Random);var f=t.getVerticesData(De.b.PositionKind),v=t.getIndices();this._groups.push(this._groupCounter);var y=new Uh(this._groupCounter,null);switch(y._groupDensity=this._calculateDensity(e,f,v),u===Tr.Color?y._textureNb=r||0:r=r||new M.b(1,1,1,1),u){case Tr.Color:this._colorFromTexture(t,y,!1);break;case Tr.UV:this._setPointsColorOrUV(t,y,!1,!1,!1);break;case Tr.Random:this._setPointsColorOrUV(t,y,!1);break;case Tr.Stated:this._setPointsColorOrUV(t,y,!1,void 0,void 0,r,o)}return this.nbParticles+=e,this._groupCounter++,this._groupCounter-1},i.prototype.addVolumePoints=function(t,e,n,r,o){var u=n||Tr.Random;(isNaN(u)||u<0||u>3)&&(u=Tr.Random);var f=t.getVerticesData(De.b.PositionKind),v=t.getIndices();this._groups.push(this._groupCounter);var y=new Uh(this._groupCounter,null);switch(y._groupDensity=this._calculateDensity(e,f,v),u===Tr.Color?y._textureNb=r||0:r=r||new M.b(1,1,1,1),u){case Tr.Color:this._colorFromTexture(t,y,!0);break;case Tr.UV:this._setPointsColorOrUV(t,y,!0,!1,!1);break;case Tr.Random:this._setPointsColorOrUV(t,y,!0);break;case Tr.Stated:this._setPointsColorOrUV(t,y,!0,void 0,void 0,r,o)}return this.nbParticles+=e,this._groupCounter++,this._groupCounter-1},i.prototype.setParticles=function(t,e,n){if(t===void 0&&(t=0),e===void 0&&(e=this.nbParticles-1),n===void 0&&(n=!0),!this._updatable||!this._isReady)return this;this.beforeUpdateParticles(t,e,n);var r=d.c.Matrix[0],o=this.mesh,u=this._colors32,f=this._positions32,v=this._uvs32,y=d.c.Vector3,D=y[5].copyFromFloats(1,0,0),w=y[6].copyFromFloats(0,1,0),F=y[7].copyFromFloats(0,0,1),z=y[8].setAll(Number.MAX_VALUE),k=y[9].setAll(-Number.MAX_VALUE);d.a.IdentityToRef(r);var K=0;if(this.mesh.isFacetDataEnabled&&(this._computeBoundingBox=!0),e=e>=this.nbParticles?this.nbParticles-1:e,this._computeBoundingBox&&(t!=0||e!=this.nbParticles-1)){var oe=this.mesh._boundingInfo;oe&&(z.copyFrom(oe.minimum),k.copyFrom(oe.maximum))}K=0;for(var ae=0,ue=0,de=0,me=t;me<=e;me++){var ye=this.particles[me];ae=3*(K=ye.idx),ue=4*K,de=2*K,this.updateParticle(ye);var Ee=ye._rotationMatrix,Ae=ye.position,Ie=ye._globalPosition;if(this._computeParticleRotation&&ye.getRotationMatrix(r),ye.parentId!==null){var Re=this.particles[ye.parentId],Pe=Re._rotationMatrix,Ce=Re._globalPosition,Be=Ae.x*Pe[1]+Ae.y*Pe[4]+Ae.z*Pe[7],Oe=Ae.x*Pe[0]+Ae.y*Pe[3]+Ae.z*Pe[6],Ve=Ae.x*Pe[2]+Ae.y*Pe[5]+Ae.z*Pe[8];if(Ie.x=Ce.x+Oe,Ie.y=Ce.y+Be,Ie.z=Ce.z+Ve,this._computeParticleRotation){var Le=r.m;Ee[0]=Le[0]*Pe[0]+Le[1]*Pe[3]+Le[2]*Pe[6],Ee[1]=Le[0]*Pe[1]+Le[1]*Pe[4]+Le[2]*Pe[7],Ee[2]=Le[0]*Pe[2]+Le[1]*Pe[5]+Le[2]*Pe[8],Ee[3]=Le[4]*Pe[0]+Le[5]*Pe[3]+Le[6]*Pe[6],Ee[4]=Le[4]*Pe[1]+Le[5]*Pe[4]+Le[6]*Pe[7],Ee[5]=Le[4]*Pe[2]+Le[5]*Pe[5]+Le[6]*Pe[8],Ee[6]=Le[8]*Pe[0]+Le[9]*Pe[3]+Le[10]*Pe[6],Ee[7]=Le[8]*Pe[1]+Le[9]*Pe[4]+Le[10]*Pe[7],Ee[8]=Le[8]*Pe[2]+Le[9]*Pe[5]+Le[10]*Pe[8]}}else Ie.x=0,Ie.y=0,Ie.z=0,this._computeParticleRotation&&(Le=r.m,Ee[0]=Le[0],Ee[1]=Le[1],Ee[2]=Le[2],Ee[3]=Le[4],Ee[4]=Le[5],Ee[5]=Le[6],Ee[6]=Le[8],Ee[7]=Le[9],Ee[8]=Le[10]);var je=y[11];ye.translateFromPivot?je.setAll(0):je.copyFrom(ye.pivot);var tt=y[0];tt.copyFrom(ye.position);var ut=tt.x-ye.pivot.x,ft=tt.y-ye.pivot.y,vt=tt.z-ye.pivot.z,rt=ut*Ee[0]+ft*Ee[3]+vt*Ee[6],mt=ut*Ee[1]+ft*Ee[4]+vt*Ee[7],pt=ut*Ee[2]+ft*Ee[5]+vt*Ee[8];rt+=je.x,mt+=je.y,pt+=je.z;var it=f[ae]=Ie.x+D.x*rt+w.x*mt+F.x*pt,yt=f[ae+1]=Ie.y+D.y*rt+w.y*mt+F.y*pt,He=f[ae+2]=Ie.z+D.z*rt+w.z*mt+F.z*pt;if(this._computeBoundingBox&&(z.minimizeInPlaceFromFloats(it,yt,He),k.maximizeInPlaceFromFloats(it,yt,He)),this._computeParticleColor&&ye.color){var at=ye.color,It=this._colors32;It[ue]=at.r,It[ue+1]=at.g,It[ue+2]=at.b,It[ue+3]=at.a}if(this._computeParticleTexture&&ye.uv){var vn=ye.uv,Jt=this._uvs32;Jt[de]=vn.x,Jt[de+1]=vn.y}}return n&&(this._computeParticleColor&&o.updateVerticesData(De.b.ColorKind,u,!1,!1),this._computeParticleTexture&&o.updateVerticesData(De.b.UVKind,v,!1,!1),o.updateVerticesData(De.b.PositionKind,f,!1,!1)),this._computeBoundingBox&&(o._boundingInfo?o._boundingInfo.reConstruct(z,k,o._worldMatrix):o._boundingInfo=new Ho.a(z,k,o._worldMatrix)),this.afterUpdateParticles(t,e,n),this},i.prototype.dispose=function(){this.mesh.dispose(),this.vars=null,this._positions=null,this._indices=null,this._normals=null,this._uvs=null,this._colors=null,this._indices32=null,this._positions32=null,this._uvs32=null,this._colors32=null},i.prototype.refreshVisibleSize=function(){return this._isVisibilityBoxLocked||this.mesh.refreshBoundingInfo(),this},i.prototype.setVisibilityBox=function(t){var e=t/2;this.mesh._boundingInfo=new Ho.a(new d.e(-e,-e,-e),new d.e(e,e,e))},Object.defineProperty(i.prototype,"isAlwaysVisible",{get:function(){return this._alwaysVisible},set:function(t){this._alwaysVisible=t,this.mesh.alwaysSelectAsActiveMesh=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"computeParticleRotation",{set:function(t){this._computeParticleRotation=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"computeParticleColor",{get:function(){return this._computeParticleColor},set:function(t){this._computeParticleColor=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"computeParticleTexture",{get:function(){return this._computeParticleTexture},set:function(t){this._computeParticleTexture=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"computeBoundingBox",{get:function(){return this._computeBoundingBox},set:function(t){this._computeBoundingBox=t},enumerable:!1,configurable:!0}),i.prototype.initParticles=function(){},i.prototype.recycleParticle=function(t){return t},i.prototype.updateParticle=function(t){return t},i.prototype.beforeUpdateParticles=function(t,e,n){},i.prototype.afterUpdateParticles=function(t,e,n){},i}();he.a.prototype.getPhysicsEngine=function(){return this._physicsEngine},he.a.prototype.enablePhysics=function(i,t){if(i===void 0&&(i=null),this._physicsEngine)return!0;var e=this._getComponent(dt.a.NAME_PHYSICSENGINE);e||(e=new mE(this),this._addComponent(e));try{return this._physicsEngine=new Os(i,t),this._physicsTimeAccumulator=0,!0}catch(n){return _.a.Error(n.message),!1}},he.a.prototype.disablePhysicsEngine=function(){this._physicsEngine&&(this._physicsEngine.dispose(),this._physicsEngine=null)},he.a.prototype.isPhysicsEnabled=function(){return this._physicsEngine!==void 0},he.a.prototype.deleteCompoundImpostor=function(i){var t=i.parts[0].mesh;t.physicsImpostor&&(t.physicsImpostor.dispose(),t.physicsImpostor=null)},he.a.prototype._advancePhysicsEngineStep=function(i){if(this._physicsEngine){var t=this._physicsEngine.getSubTimeStep();if(t>0)for(this._physicsTimeAccumulator+=i;this._physicsTimeAccumulator>t;)this.onBeforePhysicsObservable.notifyObservers(this),this._physicsEngine._step(t/1e3),this.onAfterPhysicsObservable.notifyObservers(this),this._physicsTimeAccumulator-=t;else this.onBeforePhysicsObservable.notifyObservers(this),this._physicsEngine._step(i/1e3),this.onAfterPhysicsObservable.notifyObservers(this)}},Object.defineProperty(jt.a.prototype,"physicsImpostor",{get:function(){return this._physicsImpostor},set:function(i){var t=this;this._physicsImpostor!==i&&(this._disposePhysicsObserver&&this.onDisposeObservable.remove(this._disposePhysicsObserver),this._physicsImpostor=i,i&&(this._disposePhysicsObserver=this.onDisposeObservable.add(function(){t.physicsImpostor&&(t.physicsImpostor.dispose(),t.physicsImpostor=null)})))},enumerable:!0,configurable:!0}),jt.a.prototype.getPhysicsImpostor=function(){return this.physicsImpostor},jt.a.prototype.applyImpulse=function(i,t){return this.physicsImpostor?(this.physicsImpostor.applyImpulse(i,t),this):this},jt.a.prototype.setPhysicsLinkWith=function(i,t,e,n){return this.physicsImpostor&&i.physicsImpostor?(this.physicsImpostor.createJoint(i.physicsImpostor,Fn.e.HingeJoint,{mainPivot:t,connectedPivot:e,nativeParams:n}),this):this};var xl,Ns,mE=function(){function i(t){var e=this;this.name=dt.a.NAME_PHYSICSENGINE,this.scene=t,this.scene.onBeforePhysicsObservable=new S.c,this.scene.onAfterPhysicsObservable=new S.c,this.scene.getDeterministicFrameTime=function(){return e.scene._physicsEngine?1e3*e.scene._physicsEngine.getTimeStep():1e3/60}}return i.prototype.register=function(){},i.prototype.rebuild=function(){},i.prototype.dispose=function(){this.scene.onBeforePhysicsObservable.clear(),this.scene.onAfterPhysicsObservable.clear(),this.scene._physicsEngine&&this.scene.disablePhysicsEngine()},i}(),fL=function(){function i(t){this._scene=t,this._physicsEngine=this._scene.getPhysicsEngine(),this._physicsEngine||_.a.Warn("Physics engine not enabled. Please enable the physics before you can use the methods.")}return i.prototype.applyRadialExplosionImpulse=function(t,e,n,r){if(!this._physicsEngine)return _.a.Warn("Physics engine not enabled. Please enable the physics before you call this method."),null;var o=this._physicsEngine.getImpostors();if(o.length===0)return null;typeof e=="number"&&((e=new Fs).radius=e,e.strength=n||e.strength,e.falloff=r||e.falloff);var u=new _E(this._scene,e),f=Array();return o.forEach(function(v){var y=u.getImpostorHitData(v,t);y&&(v.applyImpulse(y.force,y.contactPoint),f.push({impostor:v,hitData:y}))}),u.triggerAffectedImpostorsCallback(f),u.dispose(!1),u},i.prototype.applyRadialExplosionForce=function(t,e,n,r){if(!this._physicsEngine)return _.a.Warn("Physics engine not enabled. Please enable the physics before you call the PhysicsHelper."),null;var o=this._physicsEngine.getImpostors();if(o.length===0)return null;typeof e=="number"&&((e=new Fs).radius=e,e.strength=n||e.strength,e.falloff=r||e.falloff);var u=new _E(this._scene,e),f=Array();return o.forEach(function(v){var y=u.getImpostorHitData(v,t);y&&(v.applyForce(y.force,y.contactPoint),f.push({impostor:v,hitData:y}))}),u.triggerAffectedImpostorsCallback(f),u.dispose(!1),u},i.prototype.gravitationalField=function(t,e,n,r){if(!this._physicsEngine)return _.a.Warn("Physics engine not enabled. Please enable the physics before you call the PhysicsHelper."),null;if(this._physicsEngine.getImpostors().length===0)return null;typeof e=="number"&&((e=new Fs).radius=e,e.strength=n||e.strength,e.falloff=r||e.falloff);var o=new pL(this,this._scene,t,e);return o.dispose(!1),o},i.prototype.updraft=function(t,e,n,r,o){if(!this._physicsEngine)return _.a.Warn("Physics engine not enabled. Please enable the physics before you call the PhysicsHelper."),null;if(this._physicsEngine.getImpostors().length===0)return null;typeof e=="number"&&((e=new Zm).radius=e,e.strength=n||e.strength,e.height=r||e.height,e.updraftMode=o||e.updraftMode);var u=new mL(this._scene,t,e);return u.dispose(!1),u},i.prototype.vortex=function(t,e,n,r){if(!this._physicsEngine)return _.a.Warn("Physics engine not enabled. Please enable the physics before you call the PhysicsHelper."),null;if(this._physicsEngine.getImpostors().length===0)return null;typeof e=="number"&&((e=new $m).radius=e,e.strength=n||e.strength,e.height=r||e.height);var o=new _L(this._scene,t,e);return o.dispose(!1),o},i}(),_E=function(){function i(t,e){this._scene=t,this._options=e,this._dataFetched=!1,this._options=Object(p.a)(Object(p.a)({},new Fs),this._options)}return i.prototype.getData=function(){return this._dataFetched=!0,{sphere:this._sphere}},i.prototype.getImpostorHitData=function(t,e){if(t.mass===0||!this._intersectsWithSphere(t,e,this._options.radius)||t.object.getClassName()!=="Mesh"&&t.object.getClassName()!=="InstancedMesh")return null;var n=t.getObjectCenter().subtract(e),r=new Qn.a(e,n,this._options.radius).intersectsMesh(t.object).pickedPoint;if(!r)return null;var o=d.e.Distance(e,r);if(o>this._options.radius)return null;var u=this._options.falloff===xl.Constant?this._options.strength:this._options.strength*(1-o/this._options.radius);return{force:n.multiplyByFloats(u,u,u),contactPoint:r,distanceFromOrigin:o}},i.prototype.triggerAffectedImpostorsCallback=function(t){this._options.affectedImpostorsCallback&&this._options.affectedImpostorsCallback(t)},i.prototype.dispose=function(t){var e=this;t===void 0&&(t=!0),t?this._sphere.dispose():setTimeout(function(){e._dataFetched||e._sphere.dispose()},0)},i.prototype._prepareSphere=function(){this._sphere||(this._sphere=zr.a.CreateSphere("radialExplosionEventSphere",this._options.sphere,this._scene),this._sphere.isVisible=!1)},i.prototype._intersectsWithSphere=function(t,e,n){var r=t.object;return this._prepareSphere(),this._sphere.position=e,this._sphere.scaling=new d.e(2*n,2*n,2*n),this._sphere._updateBoundingInfo(),this._sphere.computeWorldMatrix(!0),this._sphere.intersectsMesh(r,!0)},i}(),pL=function(){function i(t,e,n,r){this._physicsHelper=t,this._scene=e,this._origin=n,this._options=r,this._dataFetched=!1,this._options=Object(p.a)(Object(p.a)({},new Fs),this._options),this._tickCallback=this._tick.bind(this),this._options.strength=-1*this._options.strength}return i.prototype.getData=function(){return this._dataFetched=!0,{sphere:this._sphere}},i.prototype.enable=function(){this._tickCallback.call(this),this._scene.registerBeforeRender(this._tickCallback)},i.prototype.disable=function(){this._scene.unregisterBeforeRender(this._tickCallback)},i.prototype.dispose=function(t){var e=this;t===void 0&&(t=!0),t?this._sphere.dispose():setTimeout(function(){e._dataFetched||e._sphere.dispose()},0)},i.prototype._tick=function(){if(this._sphere)this._physicsHelper.applyRadialExplosionForce(this._origin,this._options);else{var t=this._physicsHelper.applyRadialExplosionForce(this._origin,this._options);t&&(this._sphere=t.getData().sphere.clone("radialExplosionEventSphereClone"))}},i}(),mL=function(){function i(t,e,n){this._scene=t,this._origin=e,this._options=n,this._originTop=d.e.Zero(),this._originDirection=d.e.Zero(),this._cylinderPosition=d.e.Zero(),this._dataFetched=!1,this._physicsEngine=this._scene.getPhysicsEngine(),this._options=Object(p.a)(Object(p.a)({},new Zm),this._options),this._origin.addToRef(new d.e(0,this._options.height/2,0),this._cylinderPosition),this._origin.addToRef(new d.e(0,this._options.height,0),this._originTop),this._options.updraftMode===Ns.Perpendicular&&(this._originDirection=this._origin.subtract(this._originTop).normalize()),this._tickCallback=this._tick.bind(this),this._prepareCylinder()}return i.prototype.getData=function(){return this._dataFetched=!0,{cylinder:this._cylinder}},i.prototype.enable=function(){this._tickCallback.call(this),this._scene.registerBeforeRender(this._tickCallback)},i.prototype.disable=function(){this._scene.unregisterBeforeRender(this._tickCallback)},i.prototype.dispose=function(t){var e=this;t===void 0&&(t=!0),this._cylinder&&(t?this._cylinder.dispose():setTimeout(function(){e._dataFetched||e._cylinder.dispose()},0))},i.prototype.getImpostorHitData=function(t){if(t.mass===0||!this._intersectsWithCylinder(t))return null;var e=t.getObjectCenter();if(this._options.updraftMode===Ns.Perpendicular)var n=this._originDirection;else n=e.subtract(this._originTop);var r=d.e.Distance(this._origin,e),o=-1*this._options.strength;return{force:n.multiplyByFloats(o,o,o),contactPoint:e,distanceFromOrigin:r}},i.prototype._tick=function(){var t=this;this._physicsEngine.getImpostors().forEach(function(e){var n=t.getImpostorHitData(e);n&&e.applyForce(n.force,n.contactPoint)})},i.prototype._prepareCylinder=function(){this._cylinder||(this._cylinder=zi.a.CreateCylinder("updraftEventCylinder",{height:this._options.height,diameter:2*this._options.radius},this._scene),this._cylinder.isVisible=!1)},i.prototype._intersectsWithCylinder=function(t){var e=t.object;return this._cylinder.position=this._cylinderPosition,this._cylinder.intersectsMesh(e,!0)},i}(),_L=function(){function i(t,e,n){this._scene=t,this._origin=e,this._options=n,this._originTop=d.e.Zero(),this._cylinderPosition=d.e.Zero(),this._dataFetched=!1,this._physicsEngine=this._scene.getPhysicsEngine(),this._options=Object(p.a)(Object(p.a)({},new $m),this._options),this._origin.addToRef(new d.e(0,this._options.height/2,0),this._cylinderPosition),this._origin.addToRef(new d.e(0,this._options.height,0),this._originTop),this._tickCallback=this._tick.bind(this),this._prepareCylinder()}return i.prototype.getData=function(){return this._dataFetched=!0,{cylinder:this._cylinder}},i.prototype.enable=function(){this._tickCallback.call(this),this._scene.registerBeforeRender(this._tickCallback)},i.prototype.disable=function(){this._scene.unregisterBeforeRender(this._tickCallback)},i.prototype.dispose=function(t){var e=this;t===void 0&&(t=!0),t?this._cylinder.dispose():setTimeout(function(){e._dataFetched||e._cylinder.dispose()},0)},i.prototype.getImpostorHitData=function(t){if(t.mass===0||!this._intersectsWithCylinder(t)||t.object.getClassName()!=="Mesh"&&t.object.getClassName()!=="InstancedMesh")return null;var e=t.getObjectCenter(),n=new d.e(this._origin.x,e.y,this._origin.z),r=e.subtract(n),o=new Qn.a(n,r,this._options.radius).intersectsMesh(t.object),u=o.pickedPoint;if(!u)return null;var f=o.distance/this._options.radius,v=u.normalize();if(f>this._options.centripetalForceThreshold&&(v=v.negate()),f>this._options.centripetalForceThreshold)var y=v.x*this._options.centripetalForceMultiplier,D=v.y*this._options.updraftForceMultiplier,w=v.z*this._options.centripetalForceMultiplier;else{var F=d.e.Cross(n,e).normalize();y=(F.x+v.x)*this._options.centrifugalForceMultiplier,D=this._originTop.y*this._options.updraftForceMultiplier,w=(F.z+v.z)*this._options.centrifugalForceMultiplier}var z=new d.e(y,D,w);return{force:z=z.multiplyByFloats(this._options.strength,this._options.strength,this._options.strength),contactPoint:e,distanceFromOrigin:f}},i.prototype._tick=function(){var t=this;this._physicsEngine.getImpostors().forEach(function(e){var n=t.getImpostorHitData(e);n&&e.applyForce(n.force,n.contactPoint)})},i.prototype._prepareCylinder=function(){this._cylinder||(this._cylinder=zi.a.CreateCylinder("vortexEventCylinder",{height:this._options.height,diameter:2*this._options.radius},this._scene),this._cylinder.isVisible=!1)},i.prototype._intersectsWithCylinder=function(t){var e=t.object;return this._cylinder.position=this._cylinderPosition,this._cylinder.intersectsMesh(e,!0)},i}(),Fs=function(){this.radius=5,this.strength=10,this.falloff=xl.Constant,this.sphere={segments:32,diameter:1}},Zm=function(){this.radius=5,this.strength=10,this.height=10,this.updraftMode=Ns.Center},$m=function(){this.radius=5,this.strength=10,this.height=10,this.centripetalForceThreshold=.7,this.centripetalForceMultiplier=5,this.centrifugalForceMultiplier=.5,this.updraftForceMultiplier=.02};(function(i){i[i.Constant=0]="Constant",i[i.Linear=1]="Linear"})(xl||(xl={})),function(i){i[i.Center=0]="Center",i[i.Perpendicular=1]="Perpendicular"}(Ns||(Ns={}));var gL=`
varying vec2 vUV;
uniform sampler2D textureSampler;
uniform float degree;
void main(void)
{
vec3 color=texture2D(textureSampler,vUV).rgb;
float luminance=dot(color,vec3(0.3,0.59,0.11));
vec3 blackAndWhite=vec3(luminance,luminance,luminance);
gl_FragColor=vec4(color-((color-blackAndWhite)*degree),1.0);
}`;Ye.a.ShadersStore.blackAndWhitePixelShader=gL;var gE=function(i){function t(e,n,r,o,u,f){var v=i.call(this,e,"blackAndWhite",["degree"],null,n,r,o,u,f)||this;return v.degree=1,v.onApplyObservable.add(function(y){y.setFloat("degree",v.degree)}),v}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"BlackAndWhitePostProcess"},t._Parse=function(e,n,r,o){return B.a.Parse(function(){return new t(e.name,e.options,n,e.renderTargetSamplingMode,r.getEngine(),e.reusable)},e,r,o)},Object(p.c)([Object(B.c)()],t.prototype,"degree",void 0),t}(St);C.a.RegisteredTypes["BABYLON.BlackAndWhitePostProcess"]=gE;var Yt=function(){function i(t,e,n,r){this._name=e,this._singleInstance=r||!0,this._getPostProcesses=n,this._cameras={},this._indicesForCamera={},this._postProcesses={}}return Object.defineProperty(i.prototype,"isSupported",{get:function(){for(var t in this._postProcesses)if(this._postProcesses.hasOwnProperty(t)){for(var e=this._postProcesses[t],n=0;n<e.length;n++)if(!e[n].isSupported)return!1}return!0},enumerable:!1,configurable:!0}),i.prototype._update=function(){},i.prototype._attachCameras=function(t){var e,n=this,r=et.b.MakeArray(t||this._cameras);if(r)for(var o=0;o<r.length;o++){var u=r[o];if(u){var f=u.name;if(e=this._singleInstance?0:f,!this._postProcesses[e]){var v=this._getPostProcesses();v&&(this._postProcesses[e]=Array.isArray(v)?v:[v])}this._indicesForCamera[f]||(this._indicesForCamera[f]=[]),this._postProcesses[e].forEach(function(y){var D=u.attachPostProcess(y);n._indicesForCamera[f].push(D)}),this._cameras[f]||(this._cameras[f]=u)}}},i.prototype._detachCameras=function(t){var e=et.b.MakeArray(t||this._cameras);if(e)for(var n=0;n<e.length;n++){var r=e[n],o=r.name,u=this._postProcesses[this._singleInstance?0:o];u&&u.forEach(function(f){r.detachPostProcess(f)}),this._cameras[o]&&(this._cameras[o]=null)}},i.prototype._enable=function(t){var e=this,n=et.b.MakeArray(t||this._cameras);if(n)for(var r=0;r<n.length;r++)for(var o=n[r],u=o.name,f=0;f<this._indicesForCamera[u].length;f++)o._postProcesses[this._indicesForCamera[u][f]]!==void 0&&o._postProcesses[this._indicesForCamera[u][f]]!==null||this._postProcesses[this._singleInstance?0:u].forEach(function(v){n[r].attachPostProcess(v,e._indicesForCamera[u][f])})},i.prototype._disable=function(t){var e=et.b.MakeArray(t||this._cameras);if(e)for(var n=0;n<e.length;n++){var r=e[n],o=r.name;this._postProcesses[this._singleInstance?0:o].forEach(function(u){r.detachPostProcess(u)})}},i.prototype.getPostProcesses=function(t){return this._singleInstance?this._postProcesses[0]:t?this._postProcesses[t.name]:null},i}(),vL=`#include<helperFunctions>

varying vec2 vUV;
uniform sampler2D textureSampler;
uniform float threshold;
uniform float exposure;
void main(void)
{
gl_FragColor=texture2D(textureSampler,vUV);
float luma=getLuminance(gl_FragColor.rgb*exposure);
gl_FragColor.rgb=step(threshold,luma)*gl_FragColor.rgb;
}`;Ye.a.ShadersStore.extractHighlightsPixelShader=vL;var Jm=function(i){function t(e,n,r,o,u,f,v,y){v===void 0&&(v=g.a.TEXTURETYPE_UNSIGNED_INT),y===void 0&&(y=!1);var D=i.call(this,e,"extractHighlights",["threshold","exposure"],null,n,r,o,u,f,null,v,void 0,null,y)||this;return D.threshold=.9,D._exposure=1,D._inputPostProcess=null,D.onApplyObservable.add(function(w){D._inputPostProcess&&w.setTextureFromPostProcess("textureSampler",D._inputPostProcess),w.setFloat("threshold",Math.pow(D.threshold,Zt.b)),w.setFloat("exposure",D._exposure)}),D}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"ExtractHighlightsPostProcess"},Object(p.c)([Object(B.c)()],t.prototype,"threshold",void 0),t}(St);C.a.RegisteredTypes["BABYLON.ExtractHighlightsPostProcess"]=Jm;var bL=`uniform sampler2D textureSampler;
uniform sampler2D bloomBlur;
varying vec2 vUV;
uniform float bloomWeight;
void main(void)
{
gl_FragColor=texture2D(textureSampler,vUV);
vec3 blurred=texture2D(bloomBlur,vUV).rgb;
gl_FragColor.rgb=gl_FragColor.rgb+(blurred.rgb*bloomWeight);
}
`;Ye.a.ShadersStore.bloomMergePixelShader=bL;var e_=function(i){function t(e,n,r,o,u,f,v,y,D,w,F){w===void 0&&(w=g.a.TEXTURETYPE_UNSIGNED_INT),F===void 0&&(F=!1);var z=i.call(this,e,"bloomMerge",["bloomWeight"],["circleOfConfusionSampler","blurStep0","blurStep1","blurStep2","bloomBlur"],u,f,v,y,D,null,w,void 0,null,!0)||this;return z.weight=1,z.weight=o,z.onApplyObservable.add(function(k){k.setTextureFromPostProcess("textureSampler",n),k.setTextureFromPostProcessOutput("bloomBlur",r),k.setFloat("bloomWeight",z.weight)}),F||z.updateEffect(),z}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"BloomMergePostProcess"},Object(p.c)([Object(B.c)()],t.prototype,"weight",void 0),t}(St);C.a.RegisteredTypes["BABYLON.BloomMergePostProcess"]=e_;var t_=function(i){function t(e,n,r,o,u,f){u===void 0&&(u=0),f===void 0&&(f=!1);var v=i.call(this,e.getEngine(),"bloom",function(){return v._effects},!0)||this;return v.bloomScale=n,v._effects=[],v._downscale=new Jm("highlights",1,null,ke.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,u,f),v._blurX=new ar("horizontal blur",new d.d(1,0),10,n,null,ke.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,u,void 0,f),v._blurX.alwaysForcePOT=!0,v._blurX.autoClear=!1,v._blurY=new ar("vertical blur",new d.d(0,1),10,n,null,ke.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,u,void 0,f),v._blurY.alwaysForcePOT=!0,v._blurY.autoClear=!1,v.kernel=o,v._effects=[v._downscale,v._blurX,v._blurY],v._merge=new e_("bloomMerge",v._downscale,v._blurY,r,n,null,ke.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,u,f),v._merge.autoClear=!1,v._effects.push(v._merge),v}return Object(p.d)(t,i),Object.defineProperty(t.prototype,"threshold",{get:function(){return this._downscale.threshold},set:function(e){this._downscale.threshold=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"weight",{get:function(){return this._merge.weight},set:function(e){this._merge.weight=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"kernel",{get:function(){return this._blurX.kernel/this.bloomScale},set:function(e){this._blurX.kernel=e*this.bloomScale,this._blurY.kernel=e*this.bloomScale},enumerable:!1,configurable:!0}),t.prototype.disposeEffects=function(e){for(var n=0;n<this._effects.length;n++)this._effects[n].dispose(e)},t.prototype._updateEffects=function(){for(var e=0;e<this._effects.length;e++)this._effects[e].updateEffect()},t.prototype._isReady=function(){for(var e=0;e<this._effects.length;e++)if(!this._effects[e].isReady())return!1;return!0},t}(Yt),yL=`
uniform sampler2D textureSampler;

uniform float chromatic_aberration;
uniform float radialIntensity;
uniform vec2 direction;
uniform vec2 centerPosition;
uniform float screen_width;
uniform float screen_height;

varying vec2 vUV;
void main(void)
{
vec2 centered_screen_pos=vec2(vUV.x-centerPosition.x,vUV.y-centerPosition.y);
vec2 directionOfEffect=direction;
if(directionOfEffect.x == 0. && directionOfEffect.y == 0.){
directionOfEffect=normalize(centered_screen_pos);
}
float radius2=centered_screen_pos.x*centered_screen_pos.x
+centered_screen_pos.y*centered_screen_pos.y;
float radius=sqrt(radius2);
vec4 original=texture2D(textureSampler,vUV);

vec3 ref_indices=vec3(-0.3,0.0,0.3);
float ref_shiftX=chromatic_aberration*pow(radius,radialIntensity)*directionOfEffect.x/screen_width;
float ref_shiftY=chromatic_aberration*pow(radius,radialIntensity)*directionOfEffect.y/screen_height;

vec2 ref_coords_r=vec2(vUV.x+ref_indices.r*ref_shiftX,vUV.y+ref_indices.r*ref_shiftY*0.5);
vec2 ref_coords_g=vec2(vUV.x+ref_indices.g*ref_shiftX,vUV.y+ref_indices.g*ref_shiftY*0.5);
vec2 ref_coords_b=vec2(vUV.x+ref_indices.b*ref_shiftX,vUV.y+ref_indices.b*ref_shiftY*0.5);
original.r=texture2D(textureSampler,ref_coords_r).r;
original.g=texture2D(textureSampler,ref_coords_g).g;
original.b=texture2D(textureSampler,ref_coords_b).b;
original.a=clamp(texture2D(textureSampler,ref_coords_r).a+texture2D(textureSampler,ref_coords_g).a+texture2D(textureSampler,ref_coords_b).a,0.,1.);
gl_FragColor=original;
}`;Ye.a.ShadersStore.chromaticAberrationPixelShader=yL;var n_=function(i){function t(e,n,r,o,u,f,v,y,D,w){D===void 0&&(D=g.a.TEXTURETYPE_UNSIGNED_INT),w===void 0&&(w=!1);var F=i.call(this,e,"chromaticAberration",["chromatic_aberration","screen_width","screen_height","direction","radialIntensity","centerPosition"],[],o,u,f,v,y,null,D,void 0,null,w)||this;return F.aberrationAmount=30,F.radialIntensity=0,F.direction=new d.d(.707,.707),F.centerPosition=new d.d(.5,.5),F.screenWidth=n,F.screenHeight=r,F.onApplyObservable.add(function(z){z.setFloat("chromatic_aberration",F.aberrationAmount),z.setFloat("screen_width",n),z.setFloat("screen_height",r),z.setFloat("radialIntensity",F.radialIntensity),z.setFloat2("direction",F.direction.x,F.direction.y),z.setFloat2("centerPosition",F.centerPosition.x,F.centerPosition.y)}),F}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"ChromaticAberrationPostProcess"},t._Parse=function(e,n,r,o){return B.a.Parse(function(){return new t(e.name,e.screenWidth,e.screenHeight,e.options,n,e.renderTargetSamplingMode,r.getEngine(),e.reusable,e.textureType,!1)},e,r,o)},Object(p.c)([Object(B.c)()],t.prototype,"aberrationAmount",void 0),Object(p.c)([Object(B.c)()],t.prototype,"radialIntensity",void 0),Object(p.c)([Object(B.c)()],t.prototype,"direction",void 0),Object(p.c)([Object(B.c)()],t.prototype,"centerPosition",void 0),Object(p.c)([Object(B.c)()],t.prototype,"screenWidth",void 0),Object(p.c)([Object(B.c)()],t.prototype,"screenHeight",void 0),t}(St);C.a.RegisteredTypes["BABYLON.ChromaticAberrationPostProcess"]=n_;var TL=`
uniform sampler2D depthSampler;

varying vec2 vUV;

uniform vec2 cameraMinMaxZ;

uniform float focusDistance;
uniform float cocPrecalculation;
void main(void)
{
float depth=texture2D(depthSampler,vUV).r;
float pixelDistance=(cameraMinMaxZ.x+(cameraMinMaxZ.y-cameraMinMaxZ.x)*depth)*1000.0;
float coc=abs(cocPrecalculation* ((focusDistance-pixelDistance)/pixelDistance));
coc=clamp(coc,0.0,1.0);
gl_FragColor=vec4(coc,depth,coc,1.0);
}
`;Ye.a.ShadersStore.circleOfConfusionPixelShader=TL;var r_=function(i){function t(e,n,r,o,u,f,v,y,D){y===void 0&&(y=g.a.TEXTURETYPE_UNSIGNED_INT),D===void 0&&(D=!1);var w=i.call(this,e,"circleOfConfusion",["cameraMinMaxZ","focusDistance","cocPrecalculation"],["depthSampler"],r,o,u,f,v,null,y,void 0,null,D)||this;return w.lensSize=50,w.fStop=1.4,w.focusDistance=2e3,w.focalLength=50,w._depthTexture=null,w._depthTexture=n,w.onApplyObservable.add(function(F){if(w._depthTexture){F.setTexture("depthSampler",w._depthTexture);var z=w.lensSize/w.fStop*w.focalLength/(w.focusDistance-w.focalLength);F.setFloat("focusDistance",w.focusDistance),F.setFloat("cocPrecalculation",z),F.setFloat2("cameraMinMaxZ",w._depthTexture.activeCamera.minZ,w._depthTexture.activeCamera.maxZ)}else _.a.Warn("No depth texture set on CircleOfConfusionPostProcess")}),w}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"CircleOfConfusionPostProcess"},Object.defineProperty(t.prototype,"depthTexture",{set:function(e){this._depthTexture=e},enumerable:!1,configurable:!0}),Object(p.c)([Object(B.c)()],t.prototype,"lensSize",void 0),Object(p.c)([Object(B.c)()],t.prototype,"fStop",void 0),Object(p.c)([Object(B.c)()],t.prototype,"focusDistance",void 0),Object(p.c)([Object(B.c)()],t.prototype,"focalLength",void 0),t}(St);C.a.RegisteredTypes["BABYLON.CircleOfConfusionPostProcess"]=r_;var EL=`
uniform sampler2D textureSampler;
uniform sampler2D colorTable;

varying vec2 vUV;

const float SLICE_COUNT=16.0;

vec4 sampleAs3DTexture(sampler2D textureSampler,vec3 uv,float width) {
float sliceSize=1.0/width;
float slicePixelSize=sliceSize/width;
float sliceInnerSize=slicePixelSize*(width-1.0);
float zSlice0=min(floor(uv.z*width),width-1.0);
float zSlice1=min(zSlice0+1.0,width-1.0);
float xOffset=slicePixelSize*0.5+uv.x*sliceInnerSize;
float s0=xOffset+(zSlice0*sliceSize);
float s1=xOffset+(zSlice1*sliceSize);
vec4 slice0Color=texture2D(textureSampler,vec2(s0,uv.y));
vec4 slice1Color=texture2D(textureSampler,vec2(s1,uv.y));
float zOffset=mod(uv.z*width,1.0);
vec4 result=mix(slice0Color,slice1Color,zOffset);
return result;
}
void main(void)
{
vec4 screen_color=texture2D(textureSampler,vUV);
gl_FragColor=sampleAs3DTexture(colorTable,screen_color.rgb,SLICE_COUNT);
}`;Ye.a.ShadersStore.colorCorrectionPixelShader=EL;var vE=function(i){function t(e,n,r,o,u,f,v){var y=i.call(this,e,"colorCorrection",null,["colorTable"],r,o,u,f,v)||this;return y._colorTableTexture=new ke.a(n,o.getScene(),!0,!1,ke.a.TRILINEAR_SAMPLINGMODE),y._colorTableTexture.anisotropicFilteringLevel=1,y._colorTableTexture.wrapU=ke.a.CLAMP_ADDRESSMODE,y._colorTableTexture.wrapV=ke.a.CLAMP_ADDRESSMODE,y.colorTableUrl=n,y.onApply=function(D){D.setTexture("colorTable",y._colorTableTexture)},y}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"ColorCorrectionPostProcess"},t._Parse=function(e,n,r,o){return B.a.Parse(function(){return new t(e.name,e.colorTableUrl,e.options,n,e.renderTargetSamplingMode,r.getEngine(),e.reusable)},e,r,o)},Object(p.c)([Object(B.c)()],t.prototype,"colorTableUrl",void 0),t}(St);C.a.RegisteredTypes["BABYLON.ColorCorrectionPostProcess"]=vE;var SL=`
varying vec2 vUV;
uniform sampler2D textureSampler;
uniform vec2 screenSize;
uniform float kernel[9];
void main(void)
{
vec2 onePixel=vec2(1.0,1.0)/screenSize;
vec4 colorSum =
texture2D(textureSampler,vUV+onePixel*vec2(-1,-1))*kernel[0] +
texture2D(textureSampler,vUV+onePixel*vec2(0,-1))*kernel[1] +
texture2D(textureSampler,vUV+onePixel*vec2(1,-1))*kernel[2] +
texture2D(textureSampler,vUV+onePixel*vec2(-1,0))*kernel[3] +
texture2D(textureSampler,vUV+onePixel*vec2(0,0))*kernel[4] +
texture2D(textureSampler,vUV+onePixel*vec2(1,0))*kernel[5] +
texture2D(textureSampler,vUV+onePixel*vec2(-1,1))*kernel[6] +
texture2D(textureSampler,vUV+onePixel*vec2(0,1))*kernel[7] +
texture2D(textureSampler,vUV+onePixel*vec2(1,1))*kernel[8];
float kernelWeight =
kernel[0] +
kernel[1] +
kernel[2] +
kernel[3] +
kernel[4] +
kernel[5] +
kernel[6] +
kernel[7] +
kernel[8];
if (kernelWeight<=0.0) {
kernelWeight=1.0;
}
gl_FragColor=vec4((colorSum/kernelWeight).rgb,1);
}`;Ye.a.ShadersStore.convolutionPixelShader=SL;var bE=function(i){function t(e,n,r,o,u,f,v,y){y===void 0&&(y=g.a.TEXTURETYPE_UNSIGNED_INT);var D=i.call(this,e,"convolution",["kernel","screenSize"],null,r,o,u,f,v,null,y)||this;return D.kernel=n,D.onApply=function(w){w.setFloat2("screenSize",D.width,D.height),w.setArray("kernel",D.kernel)},D}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"ConvolutionPostProcess"},t._Parse=function(e,n,r,o){return B.a.Parse(function(){return new t(e.name,e.kernel,e.options,n,e.renderTargetSamplingMode,r.getEngine(),e.reusable,e.textureType)},e,r,o)},t.EdgeDetect0Kernel=[1,0,-1,0,0,0,-1,0,1],t.EdgeDetect1Kernel=[0,1,0,1,-4,1,0,1,0],t.EdgeDetect2Kernel=[-1,-1,-1,-1,8,-1,-1,-1,-1],t.SharpenKernel=[0,-1,0,-1,5,-1,0,-1,0],t.EmbossKernel=[-2,-1,0,-1,1,1,0,1,2],t.GaussianKernel=[0,1,0,1,1,1,0,1,0],Object(p.c)([Object(B.c)()],t.prototype,"kernel",void 0),t}(St);C.a.RegisteredTypes["BABYLON.ConvolutionPostProcess"]=bE;var Vh=function(i){function t(e,n,r,o,u,f,v,y,D,w,F,z,k){y===void 0&&(y=null),D===void 0&&(D=ke.a.BILINEAR_SAMPLINGMODE),z===void 0&&(z=g.a.TEXTURETYPE_UNSIGNED_INT),k===void 0&&(k=!1);var K=i.call(this,e,r,o,u,f,D=g.a.TEXTURE_BILINEAR_SAMPLINGMODE,w,F,z=g.a.TEXTURETYPE_UNSIGNED_INT,`#define DOF 1\r
`,k)||this;return K.direction=r,K.onApplyObservable.add(function(oe){y!=null&&oe.setTextureFromPostProcess("textureSampler",y),oe.setTextureFromPostProcessOutput("circleOfConfusionSampler",v),n.activeCamera&&oe.setFloat2("cameraMinMaxZ",n.activeCamera.minZ,n.activeCamera.maxZ)}),K}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"DepthOfFieldBlurPostProcess"},Object(p.c)([Object(B.c)()],t.prototype,"direction",void 0),t}(ar);C.a.RegisteredTypes["BABYLON.DepthOfFieldBlurPostProcess"]=Vh;var xL=`uniform sampler2D textureSampler;
varying vec2 vUV;
uniform sampler2D circleOfConfusionSampler;
uniform sampler2D blurStep0;
#if BLUR_LEVEL>0
uniform sampler2D blurStep1;
#endif
#if BLUR_LEVEL>1
uniform sampler2D blurStep2;
#endif
void main(void)
{
float coc=texture2D(circleOfConfusionSampler,vUV).r;
#if BLUR_LEVEL == 0
vec4 original=texture2D(textureSampler,vUV);
vec4 blurred0=texture2D(blurStep0,vUV);
gl_FragColor=mix(original,blurred0,coc);
#endif
#if BLUR_LEVEL == 1
if(coc<0.5){
vec4 original=texture2D(textureSampler,vUV);
vec4 blurred1=texture2D(blurStep1,vUV);
gl_FragColor=mix(original,blurred1,coc/0.5);
}else{
vec4 blurred0=texture2D(blurStep0,vUV);
vec4 blurred1=texture2D(blurStep1,vUV);
gl_FragColor=mix(blurred1,blurred0,(coc-0.5)/0.5);
}
#endif
#if BLUR_LEVEL == 2
if(coc<0.33){
vec4 original=texture2D(textureSampler,vUV);
vec4 blurred2=texture2D(blurStep2,vUV);
gl_FragColor=mix(original,blurred2,coc/0.33);
}else if(coc<0.66){
vec4 blurred1=texture2D(blurStep1,vUV);
vec4 blurred2=texture2D(blurStep2,vUV);
gl_FragColor=mix(blurred2,blurred1,(coc-0.33)/0.33);
}else{
vec4 blurred0=texture2D(blurStep0,vUV);
vec4 blurred1=texture2D(blurStep1,vUV);
gl_FragColor=mix(blurred1,blurred0,(coc-0.66)/0.34);
}
#endif
}
`;Ye.a.ShadersStore.depthOfFieldMergePixelShader=xL;var Fa,AL=function(){},yE=function(i){function t(e,n,r,o,u,f,v,y,D,w,F){w===void 0&&(w=g.a.TEXTURETYPE_UNSIGNED_INT),F===void 0&&(F=!1);var z=i.call(this,e,"depthOfFieldMerge",[],["circleOfConfusionSampler","blurStep0","blurStep1","blurStep2"],u,f,v,y,D,null,w,void 0,null,!0)||this;return z.blurSteps=o,z.onApplyObservable.add(function(k){k.setTextureFromPostProcess("textureSampler",n),k.setTextureFromPostProcessOutput("circleOfConfusionSampler",r),o.forEach(function(K,oe){k.setTextureFromPostProcessOutput("blurStep"+(o.length-oe-1),K)})}),F||z.updateEffect(),z}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"DepthOfFieldMergePostProcess"},t.prototype.updateEffect=function(e,n,r,o,u,f){e===void 0&&(e=null),n===void 0&&(n=null),r===void 0&&(r=null),e||(e="",e+="#define BLUR_LEVEL "+(this.blurSteps.length-1)+`
`),i.prototype.updateEffect.call(this,e,n,r,o,u,f)},t}(St);(function(i){i[i.Low=0]="Low",i[i.Medium=1]="Medium",i[i.High=2]="High"})(Fa||(Fa={}));var i_=function(i){function t(e,n,r,o,u){r===void 0&&(r=Fa.Low),o===void 0&&(o=0),u===void 0&&(u=!1);var f=i.call(this,e.getEngine(),"depth of field",function(){return f._effects},!0)||this;f._effects=[],f._circleOfConfusion=new r_("circleOfConfusion",n,1,null,ke.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,o,u),f._depthOfFieldBlurY=[],f._depthOfFieldBlurX=[];var v=1,y=15;switch(r){case Fa.High:v=3,y=51;break;case Fa.Medium:v=2,y=31;break;default:y=15,v=1}for(var D=y/Math.pow(2,v-1),w=1,F=0;F<v;F++){var z=new Vh("verticle blur",e,new d.d(0,1),D,w,null,f._circleOfConfusion,F==0?f._circleOfConfusion:null,ke.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,o,u);z.autoClear=!1,w=.75/Math.pow(2,F);var k=new Vh("horizontal blur",e,new d.d(1,0),D,w,null,f._circleOfConfusion,null,ke.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,o,u);k.autoClear=!1,f._depthOfFieldBlurY.push(z),f._depthOfFieldBlurX.push(k)}for(f._effects=[f._circleOfConfusion],F=0;F<f._depthOfFieldBlurX.length;F++)f._effects.push(f._depthOfFieldBlurY[F]),f._effects.push(f._depthOfFieldBlurX[F]);return f._dofMerge=new yE("dofMerge",f._circleOfConfusion,f._circleOfConfusion,f._depthOfFieldBlurX,w,null,ke.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,o,u),f._dofMerge.autoClear=!1,f._effects.push(f._dofMerge),f}return Object(p.d)(t,i),Object.defineProperty(t.prototype,"focalLength",{get:function(){return this._circleOfConfusion.focalLength},set:function(e){this._circleOfConfusion.focalLength=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fStop",{get:function(){return this._circleOfConfusion.fStop},set:function(e){this._circleOfConfusion.fStop=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"focusDistance",{get:function(){return this._circleOfConfusion.focusDistance},set:function(e){this._circleOfConfusion.focusDistance=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lensSize",{get:function(){return this._circleOfConfusion.lensSize},set:function(e){this._circleOfConfusion.lensSize=e},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"DepthOfFieldEffect"},Object.defineProperty(t.prototype,"depthTexture",{set:function(e){this._circleOfConfusion.depthTexture=e},enumerable:!1,configurable:!0}),t.prototype.disposeEffects=function(e){for(var n=0;n<this._effects.length;n++)this._effects[n].dispose(e)},t.prototype._updateEffects=function(){for(var e=0;e<this._effects.length;e++)this._effects[e].updateEffect()},t.prototype._isReady=function(){for(var e=0;e<this._effects.length;e++)if(!this._effects[e].isReady())return!1;return!0},t}(Yt),PL=`
varying vec2 vUV;
uniform sampler2D textureSampler;
uniform sampler2D passSampler;
void main(void)
{
gl_FragColor=texture2D(passSampler,vUV);
}`;Ye.a.ShadersStore.displayPassPixelShader=PL;var TE=function(i){function t(e,n,r,o,u,f){return i.call(this,e,"displayPass",["passSampler"],["passSampler"],n,r,o,u,f)||this}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"DisplayPassPostProcess"},t._Parse=function(e,n,r,o){return B.a.Parse(function(){return new t(e.name,e.options,n,e.renderTargetSamplingMode,r.getEngine(),e.reusable)},e,r,o)},t}(St);C.a.RegisteredTypes["BABYLON.DisplayPassPostProcess"]=TE;var CL=`
varying vec2 vUV;
uniform sampler2D textureSampler;
uniform mat4 kernelMatrix;
void main(void)
{
vec3 baseColor=texture2D(textureSampler,vUV).rgb;
vec3 updatedColor=(kernelMatrix*vec4(baseColor,1.0)).rgb;
gl_FragColor=vec4(updatedColor,1.0);
}`;Ye.a.ShadersStore.filterPixelShader=CL;var EE=function(i){function t(e,n,r,o,u,f,v){var y=i.call(this,e,"filter",["kernelMatrix"],null,r,o,u,f,v)||this;return y.kernelMatrix=n,y.onApply=function(D){D.setMatrix("kernelMatrix",y.kernelMatrix)},y}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"FilterPostProcess"},t._Parse=function(e,n,r,o){return B.a.Parse(function(){return new t(e.name,e.kernelMatrix,e.options,n,e.renderTargetSamplingMode,r.getEngine(),e.reusable)},e,r,o)},Object(p.c)([Object(B.j)()],t.prototype,"kernelMatrix",void 0),t}(St);C.a.RegisteredTypes["BABYLON.FilterPostProcess"]=EE;var RL=`uniform sampler2D textureSampler;
uniform vec2 texelSize;
varying vec2 vUV;
varying vec2 sampleCoordS;
varying vec2 sampleCoordE;
varying vec2 sampleCoordN;
varying vec2 sampleCoordW;
varying vec2 sampleCoordNW;
varying vec2 sampleCoordSE;
varying vec2 sampleCoordNE;
varying vec2 sampleCoordSW;
const float fxaaQualitySubpix=1.0;
const float fxaaQualityEdgeThreshold=0.166;
const float fxaaQualityEdgeThresholdMin=0.0833;
const vec3 kLumaCoefficients=vec3(0.2126,0.7152,0.0722);
#define FxaaLuma(rgba) dot(rgba.rgb,kLumaCoefficients)
void main(){
vec2 posM;
posM.x=vUV.x;
posM.y=vUV.y;
vec4 rgbyM=texture2D(textureSampler,vUV,0.0);
float lumaM=FxaaLuma(rgbyM);
float lumaS=FxaaLuma(texture2D(textureSampler,sampleCoordS,0.0));
float lumaE=FxaaLuma(texture2D(textureSampler,sampleCoordE,0.0));
float lumaN=FxaaLuma(texture2D(textureSampler,sampleCoordN,0.0));
float lumaW=FxaaLuma(texture2D(textureSampler,sampleCoordW,0.0));
float maxSM=max(lumaS,lumaM);
float minSM=min(lumaS,lumaM);
float maxESM=max(lumaE,maxSM);
float minESM=min(lumaE,minSM);
float maxWN=max(lumaN,lumaW);
float minWN=min(lumaN,lumaW);
float rangeMax=max(maxWN,maxESM);
float rangeMin=min(minWN,minESM);
float rangeMaxScaled=rangeMax*fxaaQualityEdgeThreshold;
float range=rangeMax-rangeMin;
float rangeMaxClamped=max(fxaaQualityEdgeThresholdMin,rangeMaxScaled);
#ifndef MALI
if(range<rangeMaxClamped)
{
gl_FragColor=rgbyM;
return;
}
#endif
float lumaNW=FxaaLuma(texture2D(textureSampler,sampleCoordNW,0.0));
float lumaSE=FxaaLuma(texture2D(textureSampler,sampleCoordSE,0.0));
float lumaNE=FxaaLuma(texture2D(textureSampler,sampleCoordNE,0.0));
float lumaSW=FxaaLuma(texture2D(textureSampler,sampleCoordSW,0.0));
float lumaNS=lumaN+lumaS;
float lumaWE=lumaW+lumaE;
float subpixRcpRange=1.0/range;
float subpixNSWE=lumaNS+lumaWE;
float edgeHorz1=(-2.0*lumaM)+lumaNS;
float edgeVert1=(-2.0*lumaM)+lumaWE;
float lumaNESE=lumaNE+lumaSE;
float lumaNWNE=lumaNW+lumaNE;
float edgeHorz2=(-2.0*lumaE)+lumaNESE;
float edgeVert2=(-2.0*lumaN)+lumaNWNE;
float lumaNWSW=lumaNW+lumaSW;
float lumaSWSE=lumaSW+lumaSE;
float edgeHorz4=(abs(edgeHorz1)*2.0)+abs(edgeHorz2);
float edgeVert4=(abs(edgeVert1)*2.0)+abs(edgeVert2);
float edgeHorz3=(-2.0*lumaW)+lumaNWSW;
float edgeVert3=(-2.0*lumaS)+lumaSWSE;
float edgeHorz=abs(edgeHorz3)+edgeHorz4;
float edgeVert=abs(edgeVert3)+edgeVert4;
float subpixNWSWNESE=lumaNWSW+lumaNESE;
float lengthSign=texelSize.x;
bool horzSpan=edgeHorz>=edgeVert;
float subpixA=subpixNSWE*2.0+subpixNWSWNESE;
if (!horzSpan)
{
lumaN=lumaW;
}
if (!horzSpan)
{
lumaS=lumaE;
}
if (horzSpan)
{
lengthSign=texelSize.y;
}
float subpixB=(subpixA*(1.0/12.0))-lumaM;
float gradientN=lumaN-lumaM;
float gradientS=lumaS-lumaM;
float lumaNN=lumaN+lumaM;
float lumaSS=lumaS+lumaM;
bool pairN=abs(gradientN)>=abs(gradientS);
float gradient=max(abs(gradientN),abs(gradientS));
if (pairN)
{
lengthSign=-lengthSign;
}
float subpixC=clamp(abs(subpixB)*subpixRcpRange,0.0,1.0);
vec2 posB;
posB.x=posM.x;
posB.y=posM.y;
vec2 offNP;
offNP.x=(!horzSpan) ? 0.0 : texelSize.x;
offNP.y=(horzSpan) ? 0.0 : texelSize.y;
if (!horzSpan)
{
posB.x+=lengthSign*0.5;
}
if (horzSpan)
{
posB.y+=lengthSign*0.5;
}
vec2 posN;
posN.x=posB.x-offNP.x*1.5;
posN.y=posB.y-offNP.y*1.5;
vec2 posP;
posP.x=posB.x+offNP.x*1.5;
posP.y=posB.y+offNP.y*1.5;
float subpixD=((-2.0)*subpixC)+3.0;
float lumaEndN=FxaaLuma(texture2D(textureSampler,posN,0.0));
float subpixE=subpixC*subpixC;
float lumaEndP=FxaaLuma(texture2D(textureSampler,posP,0.0));
if (!pairN)
{
lumaNN=lumaSS;
}
float gradientScaled=gradient*1.0/4.0;
float lumaMM=lumaM-lumaNN*0.5;
float subpixF=subpixD*subpixE;
bool lumaMLTZero=lumaMM<0.0;
lumaEndN-=lumaNN*0.5;
lumaEndP-=lumaNN*0.5;
bool doneN=abs(lumaEndN)>=gradientScaled;
bool doneP=abs(lumaEndP)>=gradientScaled;
if (!doneN)
{
posN.x-=offNP.x*3.0;
}
if (!doneN)
{
posN.y-=offNP.y*3.0;
}
bool doneNP=(!doneN) || (!doneP);
if (!doneP)
{
posP.x+=offNP.x*3.0;
}
if (!doneP)
{
posP.y+=offNP.y*3.0;
}
if (doneNP)
{
if (!doneN) lumaEndN=FxaaLuma(texture2D(textureSampler,posN.xy,0.0));
if (!doneP) lumaEndP=FxaaLuma(texture2D(textureSampler,posP.xy,0.0));
if (!doneN) lumaEndN=lumaEndN-lumaNN*0.5;
if (!doneP) lumaEndP=lumaEndP-lumaNN*0.5;
doneN=abs(lumaEndN)>=gradientScaled;
doneP=abs(lumaEndP)>=gradientScaled;
if (!doneN) posN.x-=offNP.x*12.0;
if (!doneN) posN.y-=offNP.y*12.0;
doneNP=(!doneN) || (!doneP);
if (!doneP) posP.x+=offNP.x*12.0;
if (!doneP) posP.y+=offNP.y*12.0;
}
float dstN=posM.x-posN.x;
float dstP=posP.x-posM.x;
if (!horzSpan)
{
dstN=posM.y-posN.y;
}
if (!horzSpan)
{
dstP=posP.y-posM.y;
}
bool goodSpanN=(lumaEndN<0.0) != lumaMLTZero;
float spanLength=(dstP+dstN);
bool goodSpanP=(lumaEndP<0.0) != lumaMLTZero;
float spanLengthRcp=1.0/spanLength;
bool directionN=dstN<dstP;
float dst=min(dstN,dstP);
bool goodSpan=directionN ? goodSpanN : goodSpanP;
float subpixG=subpixF*subpixF;
float pixelOffset=(dst*(-spanLengthRcp))+0.5;
float subpixH=subpixG*fxaaQualitySubpix;
float pixelOffsetGood=goodSpan ? pixelOffset : 0.0;
float pixelOffsetSubpix=max(pixelOffsetGood,subpixH);
if (!horzSpan)
{
posM.x+=pixelOffsetSubpix*lengthSign;
}
if (horzSpan)
{
posM.y+=pixelOffsetSubpix*lengthSign;
}
#ifdef MALI
if(range<rangeMaxClamped)
{
gl_FragColor=rgbyM;
}
else
{
gl_FragColor=texture2D(textureSampler,posM,0.0);
}
#else
gl_FragColor=texture2D(textureSampler,posM,0.0);
#endif
}`;Ye.a.ShadersStore.fxaaPixelShader=RL;var OL=`
attribute vec2 position;
uniform vec2 texelSize;

varying vec2 vUV;
varying vec2 sampleCoordS;
varying vec2 sampleCoordE;
varying vec2 sampleCoordN;
varying vec2 sampleCoordW;
varying vec2 sampleCoordNW;
varying vec2 sampleCoordSE;
varying vec2 sampleCoordNE;
varying vec2 sampleCoordSW;
const vec2 madd=vec2(0.5,0.5);
void main(void) {
vUV=(position*madd+madd);
sampleCoordS=vUV+vec2( 0.0,1.0)*texelSize;
sampleCoordE=vUV+vec2( 1.0,0.0)*texelSize;
sampleCoordN=vUV+vec2( 0.0,-1.0)*texelSize;
sampleCoordW=vUV+vec2(-1.0,0.0)*texelSize;
sampleCoordNW=vUV+vec2(-1.0,-1.0)*texelSize;
sampleCoordSE=vUV+vec2( 1.0,1.0)*texelSize;
sampleCoordNE=vUV+vec2( 1.0,-1.0)*texelSize;
sampleCoordSW=vUV+vec2(-1.0,1.0)*texelSize;
gl_Position=vec4(position,0.0,1.0);
}`;Ye.a.ShadersStore.fxaaVertexShader=OL;var Al=function(i){function t(e,n,r,o,u,f,v){r===void 0&&(r=null),v===void 0&&(v=g.a.TEXTURETYPE_UNSIGNED_INT);var y=i.call(this,e,"fxaa",["texelSize"],null,n,r,o||ke.a.BILINEAR_SAMPLINGMODE,u,f,null,v,"fxaa",void 0,!0)||this,D=y._getDefines();return y.updateEffect(D),y.onApplyObservable.add(function(w){var F=y.texelSize;w.setFloat2("texelSize",F.x,F.y)}),y}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"FxaaPostProcess"},t.prototype._getDefines=function(){var e=this.getEngine();if(!e)return null;var n=e.getGlInfo();return n&&n.renderer&&n.renderer.toLowerCase().indexOf("mali")>-1?`#define MALI 1
`:null},t._Parse=function(e,n,r,o){return B.a.Parse(function(){return new t(e.name,e.options,n,e.renderTargetSamplingMode,r.getEngine(),e.reusable)},e,r,o)},t}(St);C.a.RegisteredTypes["BABYLON.FxaaPostProcess"]=Al;var ML=`#include<helperFunctions>

uniform sampler2D textureSampler;

uniform float intensity;
uniform float animatedSeed;

varying vec2 vUV;
void main(void)
{
gl_FragColor=texture2D(textureSampler,vUV);
vec2 seed=vUV*(animatedSeed);
float grain=dither(seed,intensity);

float lum=getLuminance(gl_FragColor.rgb);
float grainAmount=(cos(-PI+(lum*PI*2.))+1.)/2.;
gl_FragColor.rgb+=grain*grainAmount;
gl_FragColor.rgb=max(gl_FragColor.rgb,0.0);
}`;Ye.a.ShadersStore.grainPixelShader=ML;var o_=function(i){function t(e,n,r,o,u,f,v,y){v===void 0&&(v=g.a.TEXTURETYPE_UNSIGNED_INT),y===void 0&&(y=!1);var D=i.call(this,e,"grain",["intensity","animatedSeed"],[],n,r,o,u,f,null,v,void 0,null,y)||this;return D.intensity=30,D.animated=!1,D.onApplyObservable.add(function(w){w.setFloat("intensity",D.intensity),w.setFloat("animatedSeed",D.animated?Math.random()+1:1)}),D}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"GrainPostProcess"},t._Parse=function(e,n,r,o){return B.a.Parse(function(){return new t(e.name,e.options,n,e.renderTargetSamplingMode,r.getEngine(),e.reusable)},e,r,o)},Object(p.c)([Object(B.c)()],t.prototype,"intensity",void 0),Object(p.c)([Object(B.c)()],t.prototype,"animated",void 0),t}(St);C.a.RegisteredTypes["BABYLON.GrainPostProcess"]=o_;var IL=`
varying vec2 vUV;
uniform sampler2D textureSampler;
const vec3 RGBLuminanceCoefficients=vec3(0.2126,0.7152,0.0722);
void main(void)
{
vec4 tex=texture2D(textureSampler,vUV);
vec3 c=tex.rgb;
float luma=dot(c.rgb,RGBLuminanceCoefficients);


gl_FragColor=vec4(pow(c,vec3(25.0-luma*15.0)),tex.a);
}`;Ye.a.ShadersStore.highlightsPixelShader=IL;var DL=function(i){function t(e,n,r,o,u,f,v){return v===void 0&&(v=g.a.TEXTURETYPE_UNSIGNED_INT),i.call(this,e,"highlights",null,null,n,r,o,u,f,null,v)||this}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"HighlightsPostProcess"},t}(St);Ye.a.IncludesShadersStore.mrtFragmentDeclaration=`#if __VERSION__>=200
layout(location=0) out vec4 glFragData[{X}];
#endif
`;var wL=`#extension GL_EXT_draw_buffers : require
#if defined(BUMP) || !defined(NORMAL)
#extension GL_OES_standard_derivatives : enable
#endif
precision highp float;
precision highp int;
#ifdef BUMP
varying mat4 vWorldView;
varying vec3 vNormalW;
#else
varying vec3 vNormalV;
#endif
varying vec4 vViewPos;
#if defined(POSITION) || defined(BUMP)
varying vec3 vPositionW;
#endif
#ifdef VELOCITY
varying vec4 vCurrentPosition;
varying vec4 vPreviousPosition;
#endif
#ifdef NEED_UV
varying vec2 vUV;
#endif
#ifdef BUMP
uniform vec3 vBumpInfos;
uniform vec2 vTangentSpaceParams;
#endif
#ifdef REFLECTIVITY
varying vec2 vReflectivityUV;
uniform sampler2D reflectivitySampler;
#endif
#ifdef ALPHATEST
uniform sampler2D diffuseSampler;
#endif
#include<mrtFragmentDeclaration>[RENDER_TARGET_COUNT]
#include<bumpFragmentMainFunctions>
#include<bumpFragmentFunctions>
void main() {
#ifdef ALPHATEST
if (texture2D(diffuseSampler,vUV).a<0.4)
discard;
#endif
vec3 normalOutput;
#ifdef BUMP
vec3 normalW=normalize(vNormalW);
#include<bumpFragment>
normalOutput=normalize(vec3(vWorldView*vec4(normalW,0.0)));
#else
normalOutput=normalize(vNormalV);
#endif
#ifdef PREPASS
#ifdef PREPASS_DEPTHNORMAL
gl_FragData[DEPTHNORMAL_INDEX]=vec4(vViewPos.z/vViewPos.w,normalOutput);
#endif
#else
gl_FragData[0]=vec4(vViewPos.z/vViewPos.w,0.0,0.0,1.0);
gl_FragData[1]=vec4(normalOutput,1.0);
#endif
#ifdef POSITION
gl_FragData[POSITION_INDEX]=vec4(vPositionW,1.0);
#endif
#ifdef VELOCITY
vec2 a=(vCurrentPosition.xy/vCurrentPosition.w)*0.5+0.5;
vec2 b=(vPreviousPosition.xy/vPreviousPosition.w)*0.5+0.5;
vec2 velocity=abs(a-b);
velocity=vec2(pow(velocity.x,1.0/3.0),pow(velocity.y,1.0/3.0))*sign(a-b)*0.5+0.5;
gl_FragData[VELOCITY_INDEX]=vec4(velocity,0.0,1.0);
#endif
#ifdef REFLECTIVITY
#ifdef HAS_SPECULAR

vec4 reflectivity=texture2D(reflectivitySampler,vReflectivityUV);
#elif HAS_REFLECTIVITY

vec4 reflectivity=vec4(texture2D(reflectivitySampler,vReflectivityUV).rgb,1.0);
#else
vec4 reflectivity=vec4(0.0,0.0,0.0,1.0);
#endif
gl_FragData[REFLECTIVITY_INDEX]=reflectivity;
#endif
}`;Ye.a.ShadersStore.geometryPixelShader=wL;var LL=`precision highp float;
precision highp int;
#include<bonesDeclaration>
#include<morphTargetsVertexGlobalDeclaration>
#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]
#include<instancesDeclaration>
attribute vec3 position;
attribute vec3 normal;
#ifdef NEED_UV
varying vec2 vUV;
#ifdef ALPHATEST
uniform mat4 diffuseMatrix;
#endif
#ifdef BUMP
uniform mat4 bumpMatrix;
varying vec2 vBumpUV;
#endif
#ifdef REFLECTIVITY
uniform mat4 reflectivityMatrix;
varying vec2 vReflectivityUV;
#endif
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#endif

uniform mat4 viewProjection;
uniform mat4 view;
#ifdef BUMP
varying mat4 vWorldView;
#endif
#ifdef BUMP
varying vec3 vNormalW;
#else
varying vec3 vNormalV;
#endif
varying vec4 vViewPos;
#if defined(POSITION) || defined(BUMP)
varying vec3 vPositionW;
#endif
#ifdef VELOCITY
uniform mat4 previousWorld;
uniform mat4 previousViewProjection;
#ifdef BONES_VELOCITY_ENABLED
#if NUM_BONE_INFLUENCERS>0
uniform mat4 mPreviousBones[BonesPerMesh];
#endif
#endif
varying vec4 vCurrentPosition;
varying vec4 vPreviousPosition;
#endif
void main(void)
{
vec3 positionUpdated=position;
vec3 normalUpdated=normal;
#ifdef UV1
vec2 uvUpdated=uv;
#endif
#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]
#include<instancesVertex>
#if defined(VELOCITY) && !defined(BONES_VELOCITY_ENABLED)

vCurrentPosition=viewProjection*finalWorld*vec4(positionUpdated,1.0);
vPreviousPosition=previousViewProjection*previousWorld*vec4(positionUpdated,1.0);
#endif
#include<bonesVertex>
vec4 pos=vec4(finalWorld*vec4(positionUpdated,1.0));
#ifdef BUMP
vWorldView=view*finalWorld;
vNormalW=normalUpdated;
#else
vNormalV=normalize(vec3((view*finalWorld)*vec4(normalUpdated,0.0)));
#endif
vViewPos=view*pos;
#if defined(VELOCITY) && defined(BONES_VELOCITY_ENABLED)
vCurrentPosition=viewProjection*finalWorld*vec4(positionUpdated,1.0);
#if NUM_BONE_INFLUENCERS>0
mat4 previousInfluence;
previousInfluence=mPreviousBones[int(matricesIndices[0])]*matricesWeights[0];
#if NUM_BONE_INFLUENCERS>1
previousInfluence+=mPreviousBones[int(matricesIndices[1])]*matricesWeights[1];
#endif
#if NUM_BONE_INFLUENCERS>2
previousInfluence+=mPreviousBones[int(matricesIndices[2])]*matricesWeights[2];
#endif
#if NUM_BONE_INFLUENCERS>3
previousInfluence+=mPreviousBones[int(matricesIndices[3])]*matricesWeights[3];
#endif
#if NUM_BONE_INFLUENCERS>4
previousInfluence+=mPreviousBones[int(matricesIndicesExtra[0])]*matricesWeightsExtra[0];
#endif
#if NUM_BONE_INFLUENCERS>5
previousInfluence+=mPreviousBones[int(matricesIndicesExtra[1])]*matricesWeightsExtra[1];
#endif
#if NUM_BONE_INFLUENCERS>6
previousInfluence+=mPreviousBones[int(matricesIndicesExtra[2])]*matricesWeightsExtra[2];
#endif
#if NUM_BONE_INFLUENCERS>7
previousInfluence+=mPreviousBones[int(matricesIndicesExtra[3])]*matricesWeightsExtra[3];
#endif
vPreviousPosition=previousViewProjection*previousWorld*previousInfluence*vec4(positionUpdated,1.0);
#else
vPreviousPosition=previousViewProjection*previousWorld*vec4(positionUpdated,1.0);
#endif
#endif
#if defined(POSITION) || defined(BUMP)
vPositionW=pos.xyz/pos.w;
#endif
gl_Position=viewProjection*finalWorld*vec4(positionUpdated,1.0);
#ifdef NEED_UV
#ifdef UV1
#ifdef ALPHATEST
vUV=vec2(diffuseMatrix*vec4(uvUpdated,1.0,0.0));
#else
vUV=uv;
#endif
#ifdef BUMP
vBumpUV=vec2(bumpMatrix*vec4(uvUpdated,1.0,0.0));
#endif
#ifdef REFLECTIVITY
vReflectivityUV=vec2(reflectivityMatrix*vec4(uvUpdated,1.0,0.0));
#endif
#endif
#ifdef UV2
#ifdef ALPHATEST
vUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));
#else
vUV=uv2;
#endif
#ifdef BUMP
vBumpUV=vec2(bumpMatrix*vec4(uv2,1.0,0.0));
#endif
#ifdef REFLECTIVITY
vReflectivityUV=vec2(reflectivityMatrix*vec4(uv2,1.0,0.0));
#endif
#endif
#endif
#include<bumpVertex>
}
`;Ye.a.ShadersStore.geometryVertexShader=LL;var Pi=function(){function i(t,e){e===void 0&&(e=1),this._previousTransformationMatrices={},this._previousBonesTransformationMatrices={},this.excludedSkinnedMeshesFromVelocity=[],this.renderTransparentMeshes=!0,this._resizeObserver=null,this._enablePosition=!1,this._enableVelocity=!1,this._enableReflectivity=!1,this._positionIndex=-1,this._velocityIndex=-1,this._reflectivityIndex=-1,this._depthNormalIndex=-1,this._linkedWithPrePass=!1,this._scene=t,this._ratio=e,i._SceneComponentInitialization(this._scene),this._createRenderTargets()}return i.prototype._linkPrePassRenderer=function(t){this._linkedWithPrePass=!0,this._prePassRenderer=t,this._multiRenderTarget&&(this._multiRenderTarget.onClearObservable.clear(),this._multiRenderTarget.onClearObservable.add(function(e){}))},i.prototype._unlinkPrePassRenderer=function(){this._linkedWithPrePass=!1,this._createRenderTargets()},i.prototype._resetLayout=function(){this._enablePosition=!1,this._enableReflectivity=!1,this._enableVelocity=!1,this._attachments=[]},i.prototype._forceTextureType=function(t,e){t===i.POSITION_TEXTURE_TYPE?(this._positionIndex=e,this._enablePosition=!0):t===i.VELOCITY_TEXTURE_TYPE?(this._velocityIndex=e,this._enableVelocity=!0):t===i.REFLECTIVITY_TEXTURE_TYPE?(this._reflectivityIndex=e,this._enableReflectivity=!0):t===i.DEPTHNORMAL_TEXTURE_TYPE&&(this._depthNormalIndex=e)},i.prototype._setAttachments=function(t){this._attachments=t},i.prototype._linkInternalTexture=function(t){this._multiRenderTarget._texture=t},Object.defineProperty(i.prototype,"renderList",{get:function(){return this._multiRenderTarget.renderList},set:function(t){this._multiRenderTarget.renderList=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isSupported",{get:function(){return this._multiRenderTarget.isSupported},enumerable:!1,configurable:!0}),i.prototype.getTextureIndex=function(t){switch(t){case i.POSITION_TEXTURE_TYPE:return this._positionIndex;case i.VELOCITY_TEXTURE_TYPE:return this._velocityIndex;case i.REFLECTIVITY_TEXTURE_TYPE:return this._reflectivityIndex;default:return-1}},Object.defineProperty(i.prototype,"enablePosition",{get:function(){return this._enablePosition},set:function(t){this._enablePosition=t,this._linkedWithPrePass||(this.dispose(),this._createRenderTargets())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"enableVelocity",{get:function(){return this._enableVelocity},set:function(t){this._enableVelocity=t,t||(this._previousTransformationMatrices={}),this._linkedWithPrePass||(this.dispose(),this._createRenderTargets())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"enableReflectivity",{get:function(){return this._enableReflectivity},set:function(t){this._enableReflectivity=t,this._linkedWithPrePass||(this.dispose(),this._createRenderTargets())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"scene",{get:function(){return this._scene},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"ratio",{get:function(){return this._ratio},enumerable:!1,configurable:!0}),i.prototype.isReady=function(t,e){var n=t.getMaterial();if(n&&n.disableDepthWrite)return!1;var r=[],o=[De.b.PositionKind,De.b.NormalKind],u=t.getMesh();if(n){var f=!1;n.needAlphaTesting()&&(r.push("#define ALPHATEST"),f=!0),n.bumpTexture&&on.a.BumpTextureEnabled&&(r.push("#define BUMP"),r.push("#define BUMPDIRECTUV 0"),f=!0),this._enableReflectivity&&(n instanceof on.a&&n.specularTexture?(r.push("#define HAS_SPECULAR"),f=!0):n instanceof sl&&n.reflectivityTexture&&(r.push("#define HAS_REFLECTIVITY"),f=!0)),f&&(r.push("#define NEED_UV"),u.isVerticesDataPresent(De.b.UVKind)&&(o.push(De.b.UVKind),r.push("#define UV1")),u.isVerticesDataPresent(De.b.UV2Kind)&&(o.push(De.b.UV2Kind),r.push("#define UV2")))}this._linkedWithPrePass&&(r.push("#define PREPASS"),this._depthNormalIndex!==-1&&(r.push("#define DEPTHNORMAL_INDEX "+this._depthNormalIndex),r.push("#define PREPASS_DEPTHNORMAL"))),this._enablePosition&&(r.push("#define POSITION"),r.push("#define POSITION_INDEX "+this._positionIndex)),this._enableVelocity&&(r.push("#define VELOCITY"),r.push("#define VELOCITY_INDEX "+this._velocityIndex),this.excludedSkinnedMeshesFromVelocity.indexOf(u)===-1&&r.push("#define BONES_VELOCITY_ENABLED")),this._enableReflectivity&&(r.push("#define REFLECTIVITY"),r.push("#define REFLECTIVITY_INDEX "+this._reflectivityIndex)),u.useBones&&u.computeBonesUsingShaders?(o.push(De.b.MatricesIndicesKind),o.push(De.b.MatricesWeightsKind),u.numBoneInfluencers>4&&(o.push(De.b.MatricesIndicesExtraKind),o.push(De.b.MatricesWeightsExtraKind)),r.push("#define NUM_BONE_INFLUENCERS "+u.numBoneInfluencers),r.push("#define BonesPerMesh "+(u.skeleton?u.skeleton.bones.length+1:0))):r.push("#define NUM_BONE_INFLUENCERS 0");var v=u.morphTargetManager,y=0;v&&v.numInfluencers>0&&(y=v.numInfluencers,r.push("#define MORPHTARGETS"),r.push("#define NUM_MORPH_INFLUENCERS "+y),lt.a.PrepareAttributesForMorphTargetsInfluencers(o,u,y)),e&&(r.push("#define INSTANCES"),lt.a.PushAttributesForInstances(o),t.getRenderingMesh().hasThinInstances&&r.push("#define THIN_INSTANCES")),this._linkedWithPrePass?r.push("#define RENDER_TARGET_COUNT "+this._attachments.length):r.push("#define RENDER_TARGET_COUNT "+this._multiRenderTarget.textures.length);var D=r.join(`
`);return this._cachedDefines!==D&&(this._cachedDefines=D,this._effect=this._scene.getEngine().createEffect("geometry",o,["world","mBones","viewProjection","diffuseMatrix","view","previousWorld","previousViewProjection","mPreviousBones","morphTargetInfluences","bumpMatrix","reflectivityMatrix","vTangentSpaceParams","vBumpInfos"],["diffuseSampler","bumpSampler","reflectivitySampler"],D,void 0,void 0,void 0,{buffersCount:this._multiRenderTarget.textures.length-1,maxSimultaneousMorphTargets:y})),this._effect.isReady()},i.prototype.getGBuffer=function(){return this._multiRenderTarget},Object.defineProperty(i.prototype,"samples",{get:function(){return this._multiRenderTarget.samples},set:function(t){this._multiRenderTarget.samples=t},enumerable:!1,configurable:!0}),i.prototype.dispose=function(){this._resizeObserver&&(this._scene.getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null),this.getGBuffer().dispose()},i.prototype._assignRenderTargetIndices=function(){var t=2;return this._enablePosition&&(this._positionIndex=t,t++),this._enableVelocity&&(this._velocityIndex=t,t++),this._enableReflectivity&&(this._reflectivityIndex=t,t++),t},i.prototype._createRenderTargets=function(){var t=this,e=this._scene.getEngine(),n=this._assignRenderTargetIndices();if(this._multiRenderTarget=new mm("gBuffer",{width:e.getRenderWidth()*this._ratio,height:e.getRenderHeight()*this._ratio},n,this._scene,{generateMipMaps:!1,generateDepthTexture:!0,defaultType:g.a.TEXTURETYPE_FLOAT}),this.isSupported){this._multiRenderTarget.wrapU=ke.a.CLAMP_ADDRESSMODE,this._multiRenderTarget.wrapV=ke.a.CLAMP_ADDRESSMODE,this._multiRenderTarget.refreshRate=1,this._multiRenderTarget.renderParticles=!1,this._multiRenderTarget.renderList=null,this._multiRenderTarget.onClearObservable.add(function(o){o.clear(new M.b(0,0,0,1),!0,!0,!0)}),this._resizeObserver=e.onResizeObservable.add(function(){t._multiRenderTarget&&t._multiRenderTarget.resize({width:e.getRenderWidth()*t._ratio,height:e.getRenderHeight()*t._ratio})});var r=function(o){var u=o.getRenderingMesh(),f=o.getEffectiveMesh(),v=t._scene,y=v.getEngine(),D=o.getMaterial();if(D){if(f._internalAbstractMeshDataInfo._isActiveIntermediate=!1,t._enableVelocity&&!t._previousTransformationMatrices[f.uniqueId]&&(t._previousTransformationMatrices[f.uniqueId]={world:d.a.Identity(),viewProjection:v.getTransformMatrix()},u.skeleton)){var w=u.skeleton.getTransformMatrices(u);t._previousBonesTransformationMatrices[u.uniqueId]=t._copyBonesTransformationMatrices(w,new Float32Array(w.length))}var F=u._getInstancesRenderList(o._id,!!o.getReplacementMesh());if(!F.mustReturn){var z=y.getCaps().instancedArrays&&(F.visibleInstances[o._id]!==null||u.hasThinInstances),k=f.getWorldMatrix();if(t.isReady(o,z)){if(y.enableEffect(t._effect),u._bind(o,t._effect,D.fillMode),t._effect.setMatrix("viewProjection",v.getTransformMatrix()),t._effect.setMatrix("view",v.getViewMatrix()),D){var K,oe=f._instanceDataStorage;if(oe.isFrozen||!D.backFaceCulling&&D.overrideMaterialSideOrientation===null)K=oe.sideOrientation;else{var ae=f._getWorldMatrixDeterminant();(K=D.overrideMaterialSideOrientation)==null&&(K=D.sideOrientation),ae<0&&(K=K===pn.a.ClockWiseSideOrientation?pn.a.CounterClockWiseSideOrientation:pn.a.ClockWiseSideOrientation)}if(D._preBind(t._effect,K),D.needAlphaTesting()){var ue=D.getAlphaTestTexture();ue&&(t._effect.setTexture("diffuseSampler",ue),t._effect.setMatrix("diffuseMatrix",ue.getTextureMatrix()))}D.bumpTexture&&v.getEngine().getCaps().standardDerivatives&&on.a.BumpTextureEnabled&&(t._effect.setFloat3("vBumpInfos",D.bumpTexture.coordinatesIndex,1/D.bumpTexture.level,D.parallaxScaleBias),t._effect.setMatrix("bumpMatrix",D.bumpTexture.getTextureMatrix()),t._effect.setTexture("bumpSampler",D.bumpTexture),t._effect.setFloat2("vTangentSpaceParams",D.invertNormalMapX?-1:1,D.invertNormalMapY?-1:1)),t._enableReflectivity&&(D instanceof on.a&&D.specularTexture?(t._effect.setMatrix("reflectivityMatrix",D.specularTexture.getTextureMatrix()),t._effect.setTexture("reflectivitySampler",D.specularTexture)):D instanceof sl&&D.reflectivityTexture&&(t._effect.setMatrix("reflectivityMatrix",D.reflectivityTexture.getTextureMatrix()),t._effect.setTexture("reflectivitySampler",D.reflectivityTexture)))}u.useBones&&u.computeBonesUsingShaders&&u.skeleton&&(t._effect.setMatrices("mBones",u.skeleton.getTransformMatrices(u)),t._enableVelocity&&t._effect.setMatrices("mPreviousBones",t._previousBonesTransformationMatrices[u.uniqueId])),lt.a.BindMorphTargetParameters(u,t._effect),t._enableVelocity&&(t._effect.setMatrix("previousWorld",t._previousTransformationMatrices[f.uniqueId].world),t._effect.setMatrix("previousViewProjection",t._previousTransformationMatrices[f.uniqueId].viewProjection)),u._processRendering(f,o,t._effect,D.fillMode,F,z,function(de,me){return t._effect.setMatrix("world",me)})}t._enableVelocity&&(t._previousTransformationMatrices[f.uniqueId].world=k.clone(),t._previousTransformationMatrices[f.uniqueId].viewProjection=t._scene.getTransformMatrix().clone(),u.skeleton&&t._copyBonesTransformationMatrices(u.skeleton.getTransformMatrices(u),t._previousBonesTransformationMatrices[f.uniqueId]))}}};this._multiRenderTarget.customRenderFunction=function(o,u,f,v){var y;if(t._linkedWithPrePass){if(!t._prePassRenderer.enabled)return;t._scene.getEngine().bindAttachments(t._attachments)}if(v.length){for(e.setColorWrite(!1),y=0;y<v.length;y++)r(v.data[y]);e.setColorWrite(!0)}for(y=0;y<o.length;y++)r(o.data[y]);for(y=0;y<u.length;y++)r(u.data[y]);if(t.renderTransparentMeshes)for(y=0;y<f.length;y++)r(f.data[y])}}},i.prototype._copyBonesTransformationMatrices=function(t,e){for(var n=0;n<t.length;n++)e[n]=t[n];return e},i.DEPTHNORMAL_TEXTURE_TYPE=0,i.POSITION_TEXTURE_TYPE=1,i.VELOCITY_TEXTURE_TYPE=2,i.REFLECTIVITY_TEXTURE_TYPE=3,i._SceneComponentInitialization=function(t){throw dr.a.WarnImport("GeometryBufferRendererSceneComponent")},i}(),NL=function(){this.enabled=!1,this.name="motionBlur",this.texturesRequired=[g.a.PREPASS_VELOCITY_TEXTURE_TYPE]};Object.defineProperty(he.a.prototype,"geometryBufferRenderer",{get:function(){this._geometryBufferRenderer},set:function(i){i&&i.isSupported&&(this._geometryBufferRenderer=i)},enumerable:!0,configurable:!0}),he.a.prototype.enableGeometryBufferRenderer=function(i){return i===void 0&&(i=1),this._geometryBufferRenderer||(this._geometryBufferRenderer=new Pi(this,i),this._geometryBufferRenderer.isSupported||(this._geometryBufferRenderer=null)),this._geometryBufferRenderer},he.a.prototype.disableGeometryBufferRenderer=function(){this._geometryBufferRenderer&&(this._geometryBufferRenderer.dispose(),this._geometryBufferRenderer=null)};var SE=function(){function i(t){this.name=dt.a.NAME_GEOMETRYBUFFERRENDERER,this.scene=t}return i.prototype.register=function(){this.scene._gatherRenderTargetsStage.registerStep(dt.a.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER,this,this._gatherRenderTargets)},i.prototype.rebuild=function(){},i.prototype.dispose=function(){},i.prototype._gatherRenderTargets=function(t){this.scene._geometryBufferRenderer&&t.push(this.scene._geometryBufferRenderer.getGBuffer())},i}();Pi._SceneComponentInitialization=function(i){var t=i._getComponent(dt.a.NAME_GEOMETRYBUFFERRENDERER);t||(t=new SE(i),i._addComponent(t))};var FL=`
varying vec2 vUV;
uniform sampler2D textureSampler;
uniform float motionStrength;
uniform float motionScale;
uniform vec2 screenSize;
#ifdef OBJECT_BASED
uniform sampler2D velocitySampler;
#else
uniform sampler2D depthSampler;
uniform mat4 inverseViewProjection;
uniform mat4 prevViewProjection;
#endif
void main(void)
{
#ifdef GEOMETRY_SUPPORTED
#ifdef OBJECT_BASED
vec2 texelSize=1.0/screenSize;
vec2 velocityColor=texture2D(velocitySampler,vUV).rg*2.0-1.0;
vec2 velocity=vec2(pow(velocityColor.r,3.0),pow(velocityColor.g,3.0));
velocity*=motionScale*motionStrength;
float speed=length(velocity/texelSize);
int samplesCount=int(clamp(speed,1.0,SAMPLES));
velocity=normalize(velocity)*texelSize;
float hlim=float(-samplesCount)*0.5+0.5;
vec4 result=texture2D(textureSampler,vUV);
for (int i=1; i<int(SAMPLES); ++i)
{
if (i>=samplesCount)
break;
vec2 offset=vUV+velocity*(hlim+float(i));
result+=texture2D(textureSampler,offset);
}
gl_FragColor=result/float(samplesCount);
gl_FragColor.a=1.0;
#else
vec2 texelSize=1.0/screenSize;
float depth=texture2D(depthSampler,vUV).r;
vec4 cpos=vec4(vUV*2.0-1.0,depth,1.0);
cpos=cpos*inverseViewProjection;
vec4 ppos=cpos*prevViewProjection;
ppos.xyz/=ppos.w;
ppos.xy=ppos.xy*0.5+0.5;
vec2 velocity=(ppos.xy-vUV)*motionScale*motionStrength;
float speed=length(velocity/texelSize);
int nSamples=int(clamp(speed,1.0,SAMPLES));
vec4 result=texture2D(textureSampler,vUV);
for (int i=1; i<int(SAMPLES); ++i) {
if (i>=nSamples)
break;
vec2 offset1=vUV+velocity*(float(i)/float(nSamples-1)-0.5);
result+=texture2D(textureSampler,offset1);
}
gl_FragColor=result/float(nSamples);
#endif
#else
gl_FragColor=texture2D(textureSampler,vUV);
#endif
}
`;Ye.a.ShadersStore.motionBlurPixelShader=FL;var a_=function(i){function t(e,n,r,o,u,f,v,y,D,w){y===void 0&&(y=g.a.TEXTURETYPE_UNSIGNED_INT),D===void 0&&(D=!1),w===void 0&&(w=!0);var F=i.call(this,e,"motionBlur",["motionStrength","motionScale","screenSize","inverseViewProjection","prevViewProjection"],["velocitySampler"],r,o,u,f,v,`#define GEOMETRY_SUPPORTED
#define SAMPLES 64.0
#define OBJECT_BASED`,y,void 0,null,D)||this;return F.motionStrength=1,F._motionBlurSamples=32,F._isObjectBased=!0,F._forceGeometryBuffer=!1,F._geometryBufferRenderer=null,F._prePassRenderer=null,F._invViewProjection=null,F._previousViewProjection=null,F._forceGeometryBuffer=w,F._forceGeometryBuffer?(F._geometryBufferRenderer=n.enableGeometryBufferRenderer(),F._geometryBufferRenderer&&(F._geometryBufferRenderer.enableVelocity=!0)):(F._prePassRenderer=n.enablePrePassRenderer(),F._prePassRenderer&&(F._prePassRenderer.markAsDirty(),F._prePassEffectConfiguration=new NL)),F._applyMode(),F}return Object(p.d)(t,i),Object.defineProperty(t.prototype,"motionBlurSamples",{get:function(){return this._motionBlurSamples},set:function(e){this._motionBlurSamples=e,this._updateEffect()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isObjectBased",{get:function(){return this._isObjectBased},set:function(e){this._isObjectBased!==e&&(this._isObjectBased=e,this._applyMode())},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"MotionBlurPostProcess"},t.prototype.excludeSkinnedMesh=function(e){if(e.skeleton){var n=void 0;if(this._geometryBufferRenderer)n=this._geometryBufferRenderer.excludedSkinnedMeshesFromVelocity;else{if(!this._prePassRenderer)return;n=this._prePassRenderer.excludedSkinnedMesh}n.push(e)}},t.prototype.removeExcludedSkinnedMesh=function(e){if(e.skeleton){var n=void 0;if(this._geometryBufferRenderer)n=this._geometryBufferRenderer.excludedSkinnedMeshesFromVelocity;else{if(!this._prePassRenderer)return;n=this._prePassRenderer.excludedSkinnedMesh}var r=n.indexOf(e);r!==-1&&n.splice(r,1)}},t.prototype.dispose=function(e){this._geometryBufferRenderer&&(this._geometryBufferRenderer._previousTransformationMatrices={},this._geometryBufferRenderer._previousBonesTransformationMatrices={},this._geometryBufferRenderer.excludedSkinnedMeshesFromVelocity=[]),i.prototype.dispose.call(this,e)},t.prototype._applyMode=function(){var e=this;if(!this._geometryBufferRenderer&&!this._prePassRenderer)return _.a.Warn("Multiple Render Target support needed to compute object based motion blur"),this.updateEffect();this._updateEffect(),this._invViewProjection=null,this._previousViewProjection=null,this.isObjectBased?(this._prePassRenderer&&this._prePassEffectConfiguration&&(this._prePassEffectConfiguration.texturesRequired[0]=g.a.PREPASS_VELOCITY_TEXTURE_TYPE),this.onApply=function(n){return e._onApplyObjectBased(n)}):(this._invViewProjection=d.a.Identity(),this._previousViewProjection=d.a.Identity(),this._prePassRenderer&&this._prePassEffectConfiguration&&(this._prePassEffectConfiguration.texturesRequired[0]=g.a.PREPASS_DEPTHNORMAL_TEXTURE_TYPE),this.onApply=function(n){return e._onApplyScreenBased(n)})},t.prototype._onApplyObjectBased=function(e){if(e.setVector2("screenSize",new d.d(this.width,this.height)),e.setFloat("motionScale",this._scene.getAnimationRatio()),e.setFloat("motionStrength",this.motionStrength),this._geometryBufferRenderer){var n=this._geometryBufferRenderer.getTextureIndex(Pi.VELOCITY_TEXTURE_TYPE);e.setTexture("velocitySampler",this._geometryBufferRenderer.getGBuffer().textures[n])}else this._prePassRenderer&&(n=this._prePassRenderer.getIndex(g.a.PREPASS_VELOCITY_TEXTURE_TYPE),e.setTexture("velocitySampler",this._prePassRenderer.prePassRT.textures[n]))},t.prototype._onApplyScreenBased=function(e){var n=this._scene.getProjectionMatrix().multiply(this._scene.getViewMatrix());if(n.invertToRef(this._invViewProjection),e.setMatrix("inverseViewProjection",this._invViewProjection),e.setMatrix("prevViewProjection",this._previousViewProjection),this._previousViewProjection=n,e.setVector2("screenSize",new d.d(this.width,this.height)),e.setFloat("motionScale",this._scene.getAnimationRatio()),e.setFloat("motionStrength",this.motionStrength),this._geometryBufferRenderer){var r=this._geometryBufferRenderer.getTextureIndex(Pi.DEPTHNORMAL_TEXTURE_TYPE);e.setTexture("depthSampler",this._geometryBufferRenderer.getGBuffer().textures[r])}else this._prePassRenderer&&(r=this._prePassRenderer.getIndex(g.a.PREPASS_DEPTHNORMAL_TEXTURE_TYPE),e.setTexture("depthSampler",this._prePassRenderer.prePassRT.textures[r]))},t.prototype._updateEffect=function(){if(this._geometryBufferRenderer||this._prePassRenderer){var e=["#define GEOMETRY_SUPPORTED","#define SAMPLES "+this._motionBlurSamples.toFixed(1),this._isObjectBased?"#define OBJECT_BASED":"#define SCREEN_BASED"];this.updateEffect(e.join(`
`))}},t._Parse=function(e,n,r,o){return B.a.Parse(function(){return new t(e.name,r,e.options,n,e.renderTargetSamplingMode,r.getEngine(),e.reusable,e.textureType,!1)},e,r,o)},Object(p.c)([Object(B.c)()],t.prototype,"motionStrength",void 0),Object(p.c)([Object(B.c)()],t.prototype,"motionBlurSamples",null),Object(p.c)([Object(B.c)()],t.prototype,"isObjectBased",null),t}(St);C.a.RegisteredTypes["BABYLON.MotionBlurPostProcess"]=a_;var BL=`
varying vec2 vUV;
uniform sampler2D textureSampler;
uniform sampler2D refractionSampler;

uniform vec3 baseColor;
uniform float depth;
uniform float colorLevel;
void main() {
float ref=1.0-texture2D(refractionSampler,vUV).r;
vec2 uv=vUV-vec2(0.5);
vec2 offset=uv*depth*ref;
vec3 sourceColor=texture2D(textureSampler,vUV-offset).rgb;
gl_FragColor=vec4(sourceColor+sourceColor*ref*colorLevel,1.0);
}`;Ye.a.ShadersStore.refractionPixelShader=BL;var xE=function(i){function t(e,n,r,o,u,f,v,y,D,w){var F=i.call(this,e,"refraction",["baseColor","depth","colorLevel"],["refractionSampler"],f,v,y,D,w)||this;return F._ownRefractionTexture=!0,F.color=r,F.depth=o,F.colorLevel=u,F.refractionTextureUrl=n,F.onActivateObservable.add(function(z){F._refTexture=F._refTexture||new ke.a(n,z.getScene())}),F.onApplyObservable.add(function(z){z.setColor3("baseColor",F.color),z.setFloat("depth",F.depth),z.setFloat("colorLevel",F.colorLevel),z.setTexture("refractionSampler",F._refTexture)}),F}return Object(p.d)(t,i),Object.defineProperty(t.prototype,"refractionTexture",{get:function(){return this._refTexture},set:function(e){this._refTexture&&this._ownRefractionTexture&&this._refTexture.dispose(),this._refTexture=e,this._ownRefractionTexture=!1},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"RefractionPostProcess"},t.prototype.dispose=function(e){this._refTexture&&this._ownRefractionTexture&&(this._refTexture.dispose(),this._refTexture=null),i.prototype.dispose.call(this,e)},t._Parse=function(e,n,r,o){return B.a.Parse(function(){return new t(e.name,e.refractionTextureUrl,e.color,e.depth,e.colorLevel,e.options,n,e.renderTargetSamplingMode,r.getEngine(),e.reusable)},e,r,o)},Object(p.c)([Object(B.c)()],t.prototype,"color",void 0),Object(p.c)([Object(B.c)()],t.prototype,"depth",void 0),Object(p.c)([Object(B.c)()],t.prototype,"colorLevel",void 0),Object(p.c)([Object(B.c)()],t.prototype,"refractionTextureUrl",void 0),t}(St);C.a.RegisteredTypes["BABYLON.RefractionPostProcess"]=xE;var UL=`
varying vec2 vUV;
uniform sampler2D textureSampler;
uniform vec2 screenSize;
uniform vec2 sharpnessAmounts;
void main(void)
{
vec2 onePixel=vec2(1.0,1.0)/screenSize;
vec4 color=texture2D(textureSampler,vUV);
vec4 edgeDetection=texture2D(textureSampler,vUV+onePixel*vec2(0,-1)) +
texture2D(textureSampler,vUV+onePixel*vec2(-1,0)) +
texture2D(textureSampler,vUV+onePixel*vec2(1,0)) +
texture2D(textureSampler,vUV+onePixel*vec2(0,1)) -
color*4.0;
gl_FragColor=max(vec4(color.rgb*sharpnessAmounts.y,color.a)-(sharpnessAmounts.x*vec4(edgeDetection.rgb,0)),0.);
}`;Ye.a.ShadersStore.sharpenPixelShader=UL;var s_=function(i){function t(e,n,r,o,u,f,v,y){v===void 0&&(v=g.a.TEXTURETYPE_UNSIGNED_INT),y===void 0&&(y=!1);var D=i.call(this,e,"sharpen",["sharpnessAmounts","screenSize"],null,n,r,o,u,f,null,v,void 0,null,y)||this;return D.colorAmount=1,D.edgeAmount=.3,D.onApply=function(w){w.setFloat2("screenSize",D.width,D.height),w.setFloat2("sharpnessAmounts",D.edgeAmount,D.colorAmount)},D}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"SharpenPostProcess"},t._Parse=function(e,n,r,o){return B.a.Parse(function(){return new t(e.name,e.options,n,e.renderTargetSamplingMode,r.getEngine(),e.textureType,e.reusable)},e,r,o)},Object(p.c)([Object(B.c)()],t.prototype,"colorAmount",void 0),Object(p.c)([Object(B.c)()],t.prototype,"edgeAmount",void 0),t}(St);C.a.RegisteredTypes["BABYLON.SharpenPostProcess"]=s_;var Bs=function(){function i(t,e){this.engine=t,this._name=e,this._renderEffects={},this._renderEffectsForIsolatedPass=new Array,this._cameras=[]}return Object.defineProperty(i.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"cameras",{get:function(){return this._cameras},enumerable:!1,configurable:!0}),i.prototype.getClassName=function(){return"PostProcessRenderPipeline"},Object.defineProperty(i.prototype,"isSupported",{get:function(){for(var t in this._renderEffects)if(this._renderEffects.hasOwnProperty(t)&&!this._renderEffects[t].isSupported)return!1;return!0},enumerable:!1,configurable:!0}),i.prototype.addEffect=function(t){this._renderEffects[t._name]=t},i.prototype._rebuild=function(){},i.prototype._enableEffect=function(t,e){var n=this._renderEffects[t];n&&n._enable(et.b.MakeArray(e||this._cameras))},i.prototype._disableEffect=function(t,e){var n=this._renderEffects[t];n&&n._disable(et.b.MakeArray(e||this._cameras))},i.prototype._attachCameras=function(t,e){var n=et.b.MakeArray(t||this._cameras);if(n){var r,o=[];for(r=0;r<n.length;r++){var u=n[r];if(u){var f=u.name;this._cameras.indexOf(u)===-1?this._cameras[f]=u:e&&o.push(r)}}for(r=0;r<o.length;r++)t.splice(o[r],1);for(var v in this._renderEffects)this._renderEffects.hasOwnProperty(v)&&this._renderEffects[v]._attachCameras(n)}},i.prototype._detachCameras=function(t){var e=et.b.MakeArray(t||this._cameras);if(e){for(var n in this._renderEffects)this._renderEffects.hasOwnProperty(n)&&this._renderEffects[n]._detachCameras(e);for(var r=0;r<e.length;r++)this._cameras.splice(this._cameras.indexOf(e[r]),1)}},i.prototype._update=function(){for(var t in this._renderEffects)this._renderEffects.hasOwnProperty(t)&&this._renderEffects[t]._update();for(var e=0;e<this._cameras.length;e++)if(this._cameras[e]){var n=this._cameras[e].name;this._renderEffectsForIsolatedPass[n]&&this._renderEffectsForIsolatedPass[n]._update()}},i.prototype._reset=function(){this._renderEffects={},this._renderEffectsForIsolatedPass=new Array},i.prototype._enableMSAAOnFirstPostProcess=function(t){if(this.engine.webGLVersion===1)return!1;var e=Object.keys(this._renderEffects);if(e.length>0){var n=this._renderEffects[e[0]].getPostProcesses();n&&(n[0].samples=t)}return!0},i.prototype.setPrePassRenderer=function(t){return!1},i.prototype.dispose=function(){},Object(p.c)([Object(B.c)()],i.prototype,"_name",void 0),i}(),AE=function(){function i(){this._renderPipelines={}}return Object.defineProperty(i.prototype,"supportedPipelines",{get:function(){var t=[];for(var e in this._renderPipelines)if(this._renderPipelines.hasOwnProperty(e)){var n=this._renderPipelines[e];n.isSupported&&t.push(n)}return t},enumerable:!1,configurable:!0}),i.prototype.addPipeline=function(t){this._renderPipelines[t._name]=t},i.prototype.attachCamerasToRenderPipeline=function(t,e,n){n===void 0&&(n=!1);var r=this._renderPipelines[t];r&&r._attachCameras(e,n)},i.prototype.detachCamerasFromRenderPipeline=function(t,e){var n=this._renderPipelines[t];n&&n._detachCameras(e)},i.prototype.enableEffectInPipeline=function(t,e,n){var r=this._renderPipelines[t];r&&r._enableEffect(e,n)},i.prototype.disableEffectInPipeline=function(t,e,n){var r=this._renderPipelines[t];r&&r._disableEffect(e,n)},i.prototype.update=function(){for(var t in this._renderPipelines)if(this._renderPipelines.hasOwnProperty(t)){var e=this._renderPipelines[t];e.isSupported?e._update():(e.dispose(),delete this._renderPipelines[t])}},i.prototype._rebuild=function(){for(var t in this._renderPipelines)this._renderPipelines.hasOwnProperty(t)&&this._renderPipelines[t]._rebuild()},i.prototype.dispose=function(){for(var t in this._renderPipelines)this._renderPipelines.hasOwnProperty(t)&&this._renderPipelines[t].dispose()},i}();Object.defineProperty(he.a.prototype,"postProcessRenderPipelineManager",{get:function(){if(!this._postProcessRenderPipelineManager){var i=this._getComponent(dt.a.NAME_POSTPROCESSRENDERPIPELINEMANAGER);i||(i=new PE(this),this._addComponent(i)),this._postProcessRenderPipelineManager=new AE}return this._postProcessRenderPipelineManager},enumerable:!0,configurable:!0});var PE=function(){function i(t){this.name=dt.a.NAME_POSTPROCESSRENDERPIPELINEMANAGER,this.scene=t}return i.prototype.register=function(){this.scene._gatherRenderTargetsStage.registerStep(dt.a.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER,this,this._gatherRenderTargets)},i.prototype.rebuild=function(){this.scene._postProcessRenderPipelineManager&&this.scene._postProcessRenderPipelineManager._rebuild()},i.prototype.dispose=function(){this.scene._postProcessRenderPipelineManager&&this.scene._postProcessRenderPipelineManager.dispose()},i.prototype._gatherRenderTargets=function(){this.scene._postProcessRenderPipelineManager&&this.scene._postProcessRenderPipelineManager.update()},i}(),CE=function(i){function t(e,n,r,o,u){e===void 0&&(e=""),n===void 0&&(n=!0),r===void 0&&(r=ne.a.LastCreatedScene),u===void 0&&(u=!0);var f=i.call(this,r.getEngine(),e)||this;f._camerasToBeAttached=[],f.SharpenPostProcessId="SharpenPostProcessEffect",f.ImageProcessingPostProcessId="ImageProcessingPostProcessEffect",f.FxaaPostProcessId="FxaaPostProcessEffect",f.ChromaticAberrationPostProcessId="ChromaticAberrationPostProcessEffect",f.GrainPostProcessId="GrainPostProcessEffect",f._glowLayer=null,f.animations=[],f._imageProcessingConfigurationObserver=null,f._sharpenEnabled=!1,f._bloomEnabled=!1,f._depthOfFieldEnabled=!1,f._depthOfFieldBlurLevel=Fa.Low,f._fxaaEnabled=!1,f._imageProcessingEnabled=!0,f._bloomScale=.5,f._chromaticAberrationEnabled=!1,f._grainEnabled=!1,f._buildAllowed=!0,f.onBuildObservable=new S.c,f._resizeObserver=null,f._hardwareScaleLevel=1,f._bloomKernel=64,f._bloomWeight=.15,f._bloomThreshold=.9,f._samples=1,f._hasCleared=!1,f._prevPostProcess=null,f._prevPrevPostProcess=null,f._depthOfFieldSceneObserver=null,f._cameras=o||r.cameras,f._cameras=f._cameras.slice(),f._camerasToBeAttached=f._cameras.slice(),f._buildAllowed=u,f._scene=r;var v=f._scene.getEngine().getCaps();f._hdr=n&&(v.textureHalfFloatRender||v.textureFloatRender),f._hdr?v.textureHalfFloatRender?f._defaultPipelineTextureType=g.a.TEXTURETYPE_HALF_FLOAT:v.textureFloatRender&&(f._defaultPipelineTextureType=g.a.TEXTURETYPE_FLOAT):f._defaultPipelineTextureType=g.a.TEXTURETYPE_UNSIGNED_INT,r.postProcessRenderPipelineManager.addPipeline(f);var y=f._scene.getEngine();return f.sharpen=new s_("sharpen",1,null,ke.a.BILINEAR_SAMPLINGMODE,y,!1,f._defaultPipelineTextureType,!0),f._sharpenEffect=new Yt(y,f.SharpenPostProcessId,function(){return f.sharpen},!0),f.depthOfField=new i_(f._scene,null,f._depthOfFieldBlurLevel,f._defaultPipelineTextureType,!0),f.bloom=new t_(f._scene,f._bloomScale,f._bloomWeight,f.bloomKernel,f._defaultPipelineTextureType,!0),f.chromaticAberration=new n_("ChromaticAberration",y.getRenderWidth(),y.getRenderHeight(),1,null,ke.a.BILINEAR_SAMPLINGMODE,y,!1,f._defaultPipelineTextureType,!0),f._chromaticAberrationEffect=new Yt(y,f.ChromaticAberrationPostProcessId,function(){return f.chromaticAberration},!0),f.grain=new o_("Grain",1,null,ke.a.BILINEAR_SAMPLINGMODE,y,!1,f._defaultPipelineTextureType,!0),f._grainEffect=new Yt(y,f.GrainPostProcessId,function(){return f.grain},!0),f._resizeObserver=y.onResizeObservable.add(function(){f._hardwareScaleLevel=y.getHardwareScalingLevel(),f.bloomKernel=f.bloomKernel}),f._imageProcessingConfigurationObserver=f._scene.imageProcessingConfiguration.onUpdateParameters.add(function(){f.bloom._downscale._exposure=f._scene.imageProcessingConfiguration.exposure,f.imageProcessingEnabled!==f._scene.imageProcessingConfiguration.isEnabled&&(f._imageProcessingEnabled=f._scene.imageProcessingConfiguration.isEnabled,f._buildPipeline())}),f._buildPipeline(),f}return Object(p.d)(t,i),Object.defineProperty(t.prototype,"scene",{get:function(){return this._scene},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sharpenEnabled",{get:function(){return this._sharpenEnabled},set:function(e){this._sharpenEnabled!==e&&(this._sharpenEnabled=e,this._buildPipeline())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bloomKernel",{get:function(){return this._bloomKernel},set:function(e){this._bloomKernel=e,this.bloom.kernel=e/this._hardwareScaleLevel},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bloomWeight",{get:function(){return this._bloomWeight},set:function(e){this._bloomWeight!==e&&(this.bloom.weight=e,this._bloomWeight=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bloomThreshold",{get:function(){return this._bloomThreshold},set:function(e){this._bloomThreshold!==e&&(this.bloom.threshold=e,this._bloomThreshold=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bloomScale",{get:function(){return this._bloomScale},set:function(e){this._bloomScale!==e&&(this._bloomScale=e,this._rebuildBloom(),this._buildPipeline())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bloomEnabled",{get:function(){return this._bloomEnabled},set:function(e){this._bloomEnabled!==e&&(this._bloomEnabled=e,this._buildPipeline())},enumerable:!1,configurable:!0}),t.prototype._rebuildBloom=function(){var e=this.bloom;this.bloom=new t_(this._scene,this.bloomScale,this._bloomWeight,this.bloomKernel,this._defaultPipelineTextureType,!1),this.bloom.threshold=e.threshold;for(var n=0;n<this._cameras.length;n++)e.disposeEffects(this._cameras[n])},Object.defineProperty(t.prototype,"depthOfFieldEnabled",{get:function(){return this._depthOfFieldEnabled},set:function(e){this._depthOfFieldEnabled!==e&&(this._depthOfFieldEnabled=e,this._buildPipeline())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"depthOfFieldBlurLevel",{get:function(){return this._depthOfFieldBlurLevel},set:function(e){if(this._depthOfFieldBlurLevel!==e){this._depthOfFieldBlurLevel=e;var n=this.depthOfField;this.depthOfField=new i_(this._scene,null,this._depthOfFieldBlurLevel,this._defaultPipelineTextureType,!1),this.depthOfField.focalLength=n.focalLength,this.depthOfField.focusDistance=n.focusDistance,this.depthOfField.fStop=n.fStop,this.depthOfField.lensSize=n.lensSize;for(var r=0;r<this._cameras.length;r++)n.disposeEffects(this._cameras[r]);this._buildPipeline()}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fxaaEnabled",{get:function(){return this._fxaaEnabled},set:function(e){this._fxaaEnabled!==e&&(this._fxaaEnabled=e,this._buildPipeline())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"samples",{get:function(){return this._samples},set:function(e){this._samples!==e&&(this._samples=e,this._buildPipeline())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"imageProcessingEnabled",{get:function(){return this._imageProcessingEnabled},set:function(e){this._imageProcessingEnabled!==e&&(this._scene.imageProcessingConfiguration.isEnabled=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"glowLayerEnabled",{get:function(){return this._glowLayer!=null},set:function(e){e&&!this._glowLayer?this._glowLayer=new bh("",this._scene):!e&&this._glowLayer&&(this._glowLayer.dispose(),this._glowLayer=null)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"glowLayer",{get:function(){return this._glowLayer},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"chromaticAberrationEnabled",{get:function(){return this._chromaticAberrationEnabled},set:function(e){this._chromaticAberrationEnabled!==e&&(this._chromaticAberrationEnabled=e,this._buildPipeline())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"grainEnabled",{get:function(){return this._grainEnabled},set:function(e){this._grainEnabled!==e&&(this._grainEnabled=e,this._buildPipeline())},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"DefaultRenderingPipeline"},t.prototype.prepare=function(){var e=this._buildAllowed;this._buildAllowed=!0,this._buildPipeline(),this._buildAllowed=e},t.prototype._setAutoClearAndTextureSharing=function(e,n){n===void 0&&(n=!1),this._hasCleared?e.autoClear=!1:(e.autoClear=!0,this._scene.autoClear=!1,this._hasCleared=!0),n||(this._prevPrevPostProcess?e.shareOutputWith(this._prevPrevPostProcess):e.useOwnOutput(),this._prevPostProcess&&(this._prevPrevPostProcess=this._prevPostProcess),this._prevPostProcess=e)},t.prototype._buildPipeline=function(){var e=this;if(this._buildAllowed){this._scene.autoClear=!0;var n=this._scene.getEngine();if(this._disposePostProcesses(),this._cameras!==null&&(this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._cameras),this._cameras=this._camerasToBeAttached.slice()),this._reset(),this._prevPostProcess=null,this._prevPrevPostProcess=null,this._hasCleared=!1,this.depthOfFieldEnabled){if(this._cameras.length>1){for(var r=0,o=this._cameras;r<o.length;r++){var u=o[r];(f=this._scene.enableDepthRenderer(u)).useOnlyInActiveCamera=!0}this._depthOfFieldSceneObserver=this._scene.onAfterRenderTargetsRenderObservable.add(function(v){e._cameras.indexOf(v.activeCamera)>-1&&(e.depthOfField.depthTexture=v.enableDepthRenderer(v.activeCamera).getDepthMap())})}else{this._scene.onAfterRenderTargetsRenderObservable.remove(this._depthOfFieldSceneObserver);var f=this._scene.enableDepthRenderer(this._cameras[0]);this.depthOfField.depthTexture=f.getDepthMap()}this.depthOfField._isReady()||this.depthOfField._updateEffects(),this.addEffect(this.depthOfField),this._setAutoClearAndTextureSharing(this.depthOfField._effects[0],!0)}else this._scene.onAfterRenderTargetsRenderObservable.remove(this._depthOfFieldSceneObserver);this.bloomEnabled&&(this.bloom._isReady()||this.bloom._updateEffects(),this.addEffect(this.bloom),this._setAutoClearAndTextureSharing(this.bloom._effects[0],!0)),this._imageProcessingEnabled&&(this.imageProcessing=new nh("imageProcessing",1,null,ke.a.BILINEAR_SAMPLINGMODE,n,!1,this._defaultPipelineTextureType),this._hdr?(this.addEffect(new Yt(n,this.ImageProcessingPostProcessId,function(){return e.imageProcessing},!0)),this._setAutoClearAndTextureSharing(this.imageProcessing)):this._scene.imageProcessingConfiguration.applyByPostProcess=!1,this.cameras&&this.cameras.length!==0||(this._scene.imageProcessingConfiguration.applyByPostProcess=!1),this.imageProcessing.getEffect()||this.imageProcessing._updateParameters()),this.sharpenEnabled&&(this.sharpen.isReady()||this.sharpen.updateEffect(),this.addEffect(this._sharpenEffect),this._setAutoClearAndTextureSharing(this.sharpen)),this.grainEnabled&&(this.grain.isReady()||this.grain.updateEffect(),this.addEffect(this._grainEffect),this._setAutoClearAndTextureSharing(this.grain)),this.chromaticAberrationEnabled&&(this.chromaticAberration.isReady()||this.chromaticAberration.updateEffect(),this.addEffect(this._chromaticAberrationEffect),this._setAutoClearAndTextureSharing(this.chromaticAberration)),this.fxaaEnabled&&(this.fxaa=new Al("fxaa",1,null,ke.a.BILINEAR_SAMPLINGMODE,n,!1,this._defaultPipelineTextureType),this.addEffect(new Yt(n,this.FxaaPostProcessId,function(){return e.fxaa},!0)),this._setAutoClearAndTextureSharing(this.fxaa,!0)),this._cameras!==null&&this._scene.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(this._name,this._cameras),this._scene.activeCameras&&this._scene.activeCameras.length>1&&(this._scene.autoClear=!0),!this._enableMSAAOnFirstPostProcess(this.samples)&&this.samples>1&&_.a.Warn("MSAA failed to enable, MSAA is only supported in browsers that support webGL >= 2.0"),this.onBuildObservable.notifyObservers(this)}},t.prototype._disposePostProcesses=function(e){e===void 0&&(e=!1);for(var n=0;n<this._cameras.length;n++){var r=this._cameras[n];this.imageProcessing&&this.imageProcessing.dispose(r),this.fxaa&&this.fxaa.dispose(r),e&&(this.sharpen&&this.sharpen.dispose(r),this.depthOfField&&(this._scene.onAfterRenderTargetsRenderObservable.remove(this._depthOfFieldSceneObserver),this.depthOfField.disposeEffects(r)),this.bloom&&this.bloom.disposeEffects(r),this.chromaticAberration&&this.chromaticAberration.dispose(r),this.grain&&this.grain.dispose(r),this._glowLayer&&this._glowLayer.dispose())}this.imageProcessing=null,this.fxaa=null,e&&(this.sharpen=null,this._sharpenEffect=null,this.depthOfField=null,this.bloom=null,this.chromaticAberration=null,this._chromaticAberrationEffect=null,this.grain=null,this._grainEffect=null,this._glowLayer=null)},t.prototype.addCamera=function(e){this._camerasToBeAttached.push(e),this._buildPipeline()},t.prototype.removeCamera=function(e){var n=this._camerasToBeAttached.indexOf(e);this._camerasToBeAttached.splice(n,1),this._buildPipeline()},t.prototype.dispose=function(){this.onBuildObservable.clear(),this._disposePostProcesses(!0),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._cameras),this._scene.autoClear=!0,this._resizeObserver&&(this._scene.getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null),this._scene.imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingConfigurationObserver),i.prototype.dispose.call(this)},t.prototype.serialize=function(){var e=B.a.Serialize(this);return e.customType="DefaultRenderingPipeline",e},t.Parse=function(e,n,r){return B.a.Parse(function(){return new t(e._name,e._name._hdr,n)},e,n,r)},Object(p.c)([Object(B.c)()],t.prototype,"sharpenEnabled",null),Object(p.c)([Object(B.c)()],t.prototype,"bloomKernel",null),Object(p.c)([Object(B.c)()],t.prototype,"_bloomWeight",void 0),Object(p.c)([Object(B.c)()],t.prototype,"_bloomThreshold",void 0),Object(p.c)([Object(B.c)()],t.prototype,"_hdr",void 0),Object(p.c)([Object(B.c)()],t.prototype,"bloomWeight",null),Object(p.c)([Object(B.c)()],t.prototype,"bloomThreshold",null),Object(p.c)([Object(B.c)()],t.prototype,"bloomScale",null),Object(p.c)([Object(B.c)()],t.prototype,"bloomEnabled",null),Object(p.c)([Object(B.c)()],t.prototype,"depthOfFieldEnabled",null),Object(p.c)([Object(B.c)()],t.prototype,"depthOfFieldBlurLevel",null),Object(p.c)([Object(B.c)()],t.prototype,"fxaaEnabled",null),Object(p.c)([Object(B.c)()],t.prototype,"samples",null),Object(p.c)([Object(B.c)()],t.prototype,"imageProcessingEnabled",null),Object(p.c)([Object(B.c)()],t.prototype,"glowLayerEnabled",null),Object(p.c)([Object(B.c)()],t.prototype,"chromaticAberrationEnabled",null),Object(p.c)([Object(B.c)()],t.prototype,"grainEnabled",null),t}(Bs);C.a.RegisteredTypes["BABYLON.DefaultRenderingPipeline"]=CE;var VL=`
uniform sampler2D textureSampler;

uniform float gain;
uniform float threshold;
uniform float screen_width;
uniform float screen_height;

varying vec2 vUV;

vec4 highlightColor(vec4 color) {
vec4 highlight=color;
float luminance=dot(highlight.rgb,vec3(0.2125,0.7154,0.0721));
float lum_threshold;
if (threshold>1.0) { lum_threshold=0.94+0.01*threshold; }
else { lum_threshold=0.5+0.44*threshold; }
luminance=clamp((luminance-lum_threshold)*(1.0/(1.0-lum_threshold)),0.0,1.0);
highlight*=luminance*gain;
highlight.a=1.0;
return highlight;
}
void main(void)
{
vec4 original=texture2D(textureSampler,vUV);

if (gain == -1.0) {
gl_FragColor=vec4(0.0,0.0,0.0,1.0);
return;
}
float w=2.0/screen_width;
float h=2.0/screen_height;
float weight=1.0;

vec4 blurred=vec4(0.0,0.0,0.0,0.0);
#ifdef PENTAGON
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.84*w,0.43*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.48*w,-1.29*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.61*w,1.51*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.55*w,-0.74*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.71*w,-0.52*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.94*w,1.59*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.40*w,-1.87*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.62*w,1.16*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.09*w,0.25*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.46*w,-1.71*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.08*w,2.42*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.85*w,-1.89*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.89*w,0.16*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.29*w,1.88*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.40*w,-2.81*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.54*w,2.26*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.60*w,-0.61*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.31*w,-1.30*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.83*w,2.53*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.12*w,-2.48*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.60*w,1.11*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.82*w,0.99*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.50*w,-2.81*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.85*w,3.33*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.94*w,-1.92*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.27*w,-0.53*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.95*w,2.48*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.23*w,-3.04*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.17*w,2.05*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.97*w,-0.04*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.25*w,-2.00*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.31*w,3.08*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.94*w,-2.59*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.37*w,0.64*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-3.13*w,1.93*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.03*w,-3.65*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.60*w,3.17*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-3.14*w,-1.19*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.00*w,-1.19*h)));
#else
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.85*w,0.36*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.52*w,-1.14*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.46*w,1.42*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.46*w,-0.83*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.79*w,-0.42*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.11*w,1.62*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.29*w,-2.07*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.69*w,1.39*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.28*w,0.12*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.65*w,-1.69*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.08*w,2.44*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.63*w,-1.90*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.55*w,0.31*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.13*w,1.52*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.56*w,-2.61*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.38*w,2.34*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.64*w,-0.81*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.53*w,-1.21*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.06*w,2.63*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.00*w,-2.69*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.59*w,1.32*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.82*w,0.78*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.57*w,-2.50*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.54*w,2.93*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.39*w,-1.81*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.01*w,-0.28*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.04*w,2.25*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.02*w,-3.05*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.09*w,2.25*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-3.07*w,-0.25*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.44*w,-1.90*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.52*w,3.05*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.68*w,-2.61*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.01*w,0.79*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.76*w,1.46*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.05*w,-2.94*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.21*w,2.88*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.84*w,-1.30*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.98*w,-0.96*h)));
#endif
blurred/=39.0;
gl_FragColor=blurred;

}`;Ye.a.ShadersStore.lensHighlightsPixelShader=VL;var kL=`




uniform sampler2D textureSampler;
uniform sampler2D highlightsSampler;
uniform sampler2D depthSampler;
uniform sampler2D grainSampler;

uniform float grain_amount;
uniform bool blur_noise;
uniform float screen_width;
uniform float screen_height;
uniform float distortion;
uniform bool dof_enabled;

uniform float screen_distance;
uniform float aperture;
uniform float darken;
uniform float edge_blur;
uniform bool highlights;

uniform float near;
uniform float far;

varying vec2 vUV;

#define PI 3.14159265
#define TWOPI 6.28318530
#define inverse_focal_length 0.1

vec2 centered_screen_pos;
vec2 distorted_coords;
float radius2;
float radius;

vec2 rand(vec2 co)
{
float noise1=(fract(sin(dot(co,vec2(12.9898,78.233)))*43758.5453));
float noise2=(fract(sin(dot(co,vec2(12.9898,78.233)*2.0))*43758.5453));
return clamp(vec2(noise1,noise2),0.0,1.0);
}

vec2 getDistortedCoords(vec2 coords) {
if (distortion == 0.0) { return coords; }
vec2 direction=1.0*normalize(centered_screen_pos);
vec2 dist_coords=vec2(0.5,0.5);
dist_coords.x=0.5+direction.x*radius2*1.0;
dist_coords.y=0.5+direction.y*radius2*1.0;
float dist_amount=clamp(distortion*0.23,0.0,1.0);
dist_coords=mix(coords,dist_coords,dist_amount);
return dist_coords;
}

float sampleScreen(inout vec4 color,const in vec2 offset,const in float weight) {

vec2 coords=distorted_coords;
float angle=rand(coords*100.0).x*TWOPI;
coords+=vec2(offset.x*cos(angle)-offset.y*sin(angle),offset.x*sin(angle)+offset.y*cos(angle));
color+=texture2D(textureSampler,coords)*weight;
return weight;
}

float getBlurLevel(float size) {
return min(3.0,ceil(size/1.0));
}

vec4 getBlurColor(float size) {
vec4 col=texture2D(textureSampler,distorted_coords);
if (size == 0.0) { return col; }


float blur_level=getBlurLevel(size);
float w=(size/screen_width);
float h=(size/screen_height);
float total_weight=1.0;
vec2 sample_coords;
total_weight+=sampleScreen(col,vec2(-0.50*w,0.24*h),0.93);
total_weight+=sampleScreen(col,vec2(0.30*w,-0.75*h),0.90);
total_weight+=sampleScreen(col,vec2(0.36*w,0.96*h),0.87);
total_weight+=sampleScreen(col,vec2(-1.08*w,-0.55*h),0.85);
total_weight+=sampleScreen(col,vec2(1.33*w,-0.37*h),0.83);
total_weight+=sampleScreen(col,vec2(-0.82*w,1.31*h),0.80);
total_weight+=sampleScreen(col,vec2(-0.31*w,-1.67*h),0.78);
total_weight+=sampleScreen(col,vec2(1.47*w,1.11*h),0.76);
total_weight+=sampleScreen(col,vec2(-1.97*w,0.19*h),0.74);
total_weight+=sampleScreen(col,vec2(1.42*w,-1.57*h),0.72);
if (blur_level>1.0) {
total_weight+=sampleScreen(col,vec2(0.01*w,2.25*h),0.70);
total_weight+=sampleScreen(col,vec2(-1.62*w,-1.74*h),0.67);
total_weight+=sampleScreen(col,vec2(2.49*w,0.20*h),0.65);
total_weight+=sampleScreen(col,vec2(-2.07*w,1.61*h),0.63);
total_weight+=sampleScreen(col,vec2(0.46*w,-2.70*h),0.61);
total_weight+=sampleScreen(col,vec2(1.55*w,2.40*h),0.59);
total_weight+=sampleScreen(col,vec2(-2.88*w,-0.75*h),0.56);
total_weight+=sampleScreen(col,vec2(2.73*w,-1.44*h),0.54);
total_weight+=sampleScreen(col,vec2(-1.08*w,3.02*h),0.52);
total_weight+=sampleScreen(col,vec2(-1.28*w,-3.05*h),0.49);
}
if (blur_level>2.0) {
total_weight+=sampleScreen(col,vec2(3.11*w,1.43*h),0.46);
total_weight+=sampleScreen(col,vec2(-3.36*w,1.08*h),0.44);
total_weight+=sampleScreen(col,vec2(1.80*w,-3.16*h),0.41);
total_weight+=sampleScreen(col,vec2(0.83*w,3.65*h),0.38);
total_weight+=sampleScreen(col,vec2(-3.16*w,-2.19*h),0.34);
total_weight+=sampleScreen(col,vec2(3.92*w,-0.53*h),0.31);
total_weight+=sampleScreen(col,vec2(-2.59*w,3.12*h),0.26);
total_weight+=sampleScreen(col,vec2(-0.20*w,-4.15*h),0.22);
total_weight+=sampleScreen(col,vec2(3.02*w,3.00*h),0.15);
}
col/=total_weight;

if (darken>0.0) {
col.rgb*=clamp(0.3,1.0,1.05-size*0.5*darken);
}




return col;
}
void main(void)
{

centered_screen_pos=vec2(vUV.x-0.5,vUV.y-0.5);
radius2=centered_screen_pos.x*centered_screen_pos.x+centered_screen_pos.y*centered_screen_pos.y;
radius=sqrt(radius2);
distorted_coords=getDistortedCoords(vUV);
vec2 texels_coords=vec2(vUV.x*screen_width,vUV.y*screen_height);
float depth=texture2D(depthSampler,distorted_coords).r;
float distance=near+(far-near)*depth;
vec4 color=texture2D(textureSampler,vUV);


float coc=abs(aperture*(screen_distance*(inverse_focal_length-1.0/distance)-1.0));

if (dof_enabled == false || coc<0.07) { coc=0.0; }

float edge_blur_amount=0.0;
if (edge_blur>0.0) {
edge_blur_amount=clamp((radius*2.0-1.0+0.15*edge_blur)*1.5,0.0,1.0)*1.3;
}

float blur_amount=max(edge_blur_amount,coc);

if (blur_amount == 0.0) {
gl_FragColor=texture2D(textureSampler,distorted_coords);
}
else {

gl_FragColor=getBlurColor(blur_amount*1.7);

if (highlights) {
gl_FragColor.rgb+=clamp(coc,0.0,1.0)*texture2D(highlightsSampler,distorted_coords).rgb;
}
if (blur_noise) {

vec2 noise=rand(distorted_coords)*0.01*blur_amount;
vec2 blurred_coord=vec2(distorted_coords.x+noise.x,distorted_coords.y+noise.y);
gl_FragColor=0.04*texture2D(textureSampler,blurred_coord)+0.96*gl_FragColor;
}
}

if (grain_amount>0.0) {
vec4 grain_color=texture2D(grainSampler,texels_coords*0.003);
gl_FragColor.rgb+=(-0.5+grain_color.rgb)*0.30*grain_amount;
}
}
`;Ye.a.ShadersStore.depthOfFieldPixelShader=kL;var jL=function(i){function t(e,n,r,o,u){o===void 0&&(o=1);var f=i.call(this,r.getEngine(),e)||this;return f.LensChromaticAberrationEffect="LensChromaticAberrationEffect",f.HighlightsEnhancingEffect="HighlightsEnhancingEffect",f.LensDepthOfFieldEffect="LensDepthOfFieldEffect",f._pentagonBokehIsEnabled=!1,f._scene=r,f._depthTexture=r.enableDepthRenderer().getDepthMap(),n.grain_texture?f._grainTexture=n.grain_texture:f._createGrainTexture(),f._edgeBlur=n.edge_blur?n.edge_blur:0,f._grainAmount=n.grain_amount?n.grain_amount:0,f._chromaticAberration=n.chromatic_aberration?n.chromatic_aberration:0,f._distortion=n.distortion?n.distortion:0,f._highlightsGain=n.dof_gain!==void 0?n.dof_gain:-1,f._highlightsThreshold=n.dof_threshold?n.dof_threshold:1,f._dofDistance=n.dof_focus_distance!==void 0?n.dof_focus_distance:-1,f._dofAperture=n.dof_aperture?n.dof_aperture:1,f._dofDarken=n.dof_darken?n.dof_darken:0,f._dofPentagon=n.dof_pentagon===void 0||n.dof_pentagon,f._blurNoise=n.blur_noise===void 0||n.blur_noise,f._createChromaticAberrationPostProcess(o),f._createHighlightsPostProcess(o),f._createDepthOfFieldPostProcess(o/4),f.addEffect(new Yt(r.getEngine(),f.LensChromaticAberrationEffect,function(){return f._chromaticAberrationPostProcess},!0)),f.addEffect(new Yt(r.getEngine(),f.HighlightsEnhancingEffect,function(){return f._highlightsPostProcess},!0)),f.addEffect(new Yt(r.getEngine(),f.LensDepthOfFieldEffect,function(){return f._depthOfFieldPostProcess},!0)),f._highlightsGain===-1&&f._disableEffect(f.HighlightsEnhancingEffect,null),r.postProcessRenderPipelineManager.addPipeline(f),u&&r.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(e,u),f}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"LensRenderingPipeline"},Object.defineProperty(t.prototype,"scene",{get:function(){return this._scene},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"edgeBlur",{get:function(){return this._edgeBlur},set:function(e){this.setEdgeBlur(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"grainAmount",{get:function(){return this._grainAmount},set:function(e){this.setGrainAmount(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"chromaticAberration",{get:function(){return this._chromaticAberration},set:function(e){this.setChromaticAberration(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dofAperture",{get:function(){return this._dofAperture},set:function(e){this.setAperture(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"edgeDistortion",{get:function(){return this._distortion},set:function(e){this.setEdgeDistortion(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dofDistortion",{get:function(){return this._dofDistance},set:function(e){this.setFocusDistance(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"darkenOutOfFocus",{get:function(){return this._dofDarken},set:function(e){this.setDarkenOutOfFocus(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"blurNoise",{get:function(){return this._blurNoise},set:function(e){this._blurNoise=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pentagonBokeh",{get:function(){return this._pentagonBokehIsEnabled},set:function(e){e?this.enablePentagonBokeh():this.disablePentagonBokeh()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"highlightsGain",{get:function(){return this._highlightsGain},set:function(e){this.setHighlightsGain(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"highlightsThreshold",{get:function(){return this._highlightsThreshold},set:function(e){this.setHighlightsThreshold(e)},enumerable:!1,configurable:!0}),t.prototype.setEdgeBlur=function(e){this._edgeBlur=e},t.prototype.disableEdgeBlur=function(){this._edgeBlur=0},t.prototype.setGrainAmount=function(e){this._grainAmount=e},t.prototype.disableGrain=function(){this._grainAmount=0},t.prototype.setChromaticAberration=function(e){this._chromaticAberration=e},t.prototype.disableChromaticAberration=function(){this._chromaticAberration=0},t.prototype.setEdgeDistortion=function(e){this._distortion=e},t.prototype.disableEdgeDistortion=function(){this._distortion=0},t.prototype.setFocusDistance=function(e){this._dofDistance=e},t.prototype.disableDepthOfField=function(){this._dofDistance=-1},t.prototype.setAperture=function(e){this._dofAperture=e},t.prototype.setDarkenOutOfFocus=function(e){this._dofDarken=e},t.prototype.enablePentagonBokeh=function(){this._highlightsPostProcess.updateEffect(`#define PENTAGON
`),this._pentagonBokehIsEnabled=!0},t.prototype.disablePentagonBokeh=function(){this._pentagonBokehIsEnabled=!1,this._highlightsPostProcess.updateEffect()},t.prototype.enableNoiseBlur=function(){this._blurNoise=!0},t.prototype.disableNoiseBlur=function(){this._blurNoise=!1},t.prototype.setHighlightsGain=function(e){this._highlightsGain=e},t.prototype.setHighlightsThreshold=function(e){this._highlightsGain===-1&&(this._highlightsGain=1),this._highlightsThreshold=e},t.prototype.disableHighlights=function(){this._highlightsGain=-1},t.prototype.dispose=function(e){e===void 0&&(e=!1),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._scene.cameras),this._chromaticAberrationPostProcess=null,this._highlightsPostProcess=null,this._depthOfFieldPostProcess=null,this._grainTexture.dispose(),e&&this._scene.disableDepthRenderer()},t.prototype._createChromaticAberrationPostProcess=function(e){var n=this;this._chromaticAberrationPostProcess=new St("LensChromaticAberration","chromaticAberration",["chromatic_aberration","screen_width","screen_height","direction","radialIntensity","centerPosition"],[],e,null,ke.a.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._chromaticAberrationPostProcess.onApply=function(r){r.setFloat("chromatic_aberration",n._chromaticAberration),r.setFloat("screen_width",n._scene.getEngine().getRenderWidth()),r.setFloat("screen_height",n._scene.getEngine().getRenderHeight()),r.setFloat("radialIntensity",1),r.setFloat2("direction",17,17),r.setFloat2("centerPosition",.5,.5)}},t.prototype._createHighlightsPostProcess=function(e){var n=this;this._highlightsPostProcess=new St("LensHighlights","lensHighlights",["gain","threshold","screen_width","screen_height"],[],e,null,ke.a.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,this._dofPentagon?`#define PENTAGON
`:""),this._highlightsPostProcess.onApply=function(r){r.setFloat("gain",n._highlightsGain),r.setFloat("threshold",n._highlightsThreshold),r.setTextureFromPostProcess("textureSampler",n._chromaticAberrationPostProcess),r.setFloat("screen_width",n._scene.getEngine().getRenderWidth()),r.setFloat("screen_height",n._scene.getEngine().getRenderHeight())}},t.prototype._createDepthOfFieldPostProcess=function(e){var n=this;this._depthOfFieldPostProcess=new St("LensDepthOfField","depthOfField",["grain_amount","blur_noise","screen_width","screen_height","distortion","dof_enabled","screen_distance","aperture","darken","edge_blur","highlights","near","far"],["depthSampler","grainSampler","highlightsSampler"],e,null,ke.a.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._depthOfFieldPostProcess.onApply=function(r){r.setTexture("depthSampler",n._depthTexture),r.setTexture("grainSampler",n._grainTexture),r.setTextureFromPostProcess("textureSampler",n._highlightsPostProcess),r.setTextureFromPostProcess("highlightsSampler",n._depthOfFieldPostProcess),r.setFloat("grain_amount",n._grainAmount),r.setBool("blur_noise",n._blurNoise),r.setFloat("screen_width",n._scene.getEngine().getRenderWidth()),r.setFloat("screen_height",n._scene.getEngine().getRenderHeight()),r.setFloat("distortion",n._distortion),r.setBool("dof_enabled",n._dofDistance!==-1),r.setFloat("screen_distance",1/(.1-1/n._dofDistance)),r.setFloat("aperture",n._dofAperture),r.setFloat("darken",n._dofDarken),r.setFloat("edge_blur",n._edgeBlur),r.setBool("highlights",n._highlightsGain!==-1),n._scene.activeCamera&&(r.setFloat("near",n._scene.activeCamera.minZ),r.setFloat("far",n._scene.activeCamera.maxZ))}},t.prototype._createGrainTexture=function(){this._grainTexture=new io.a("LensNoiseTexture",512,this._scene,!1,ke.a.BILINEAR_SAMPLINGMODE),this._grainTexture.wrapU=ke.a.WRAP_ADDRESSMODE,this._grainTexture.wrapV=ke.a.WRAP_ADDRESSMODE;for(var e,n,r,o=this._grainTexture.getContext(),u=0;u<512;u++)for(var f=0;f<512;f++)e=Math.floor(255*(n=.42,r=.58,Math.random()*(r-n)+n)),o.fillStyle="rgb("+e+", "+e+", "+e+")",o.fillRect(u,f,1,1);this._grainTexture.update(!1)},t}(Bs),zL=function(){this.enabled=!1,this.name="ssao2",this.texturesRequired=[g.a.PREPASS_DEPTHNORMAL_TEXTURE_TYPE]},GL=`
precision highp float;
uniform sampler2D textureSampler;
uniform float near;
uniform float far;
uniform float radius;
float scales[16]=float[16](
0.1,
0.11406250000000001,
0.131640625,
0.15625,
0.187890625,
0.2265625,
0.272265625,
0.325,
0.384765625,
0.4515625,
0.525390625,
0.60625,
0.694140625,
0.7890625,
0.891015625,
1.0
);
varying vec2 vUV;
float perspectiveDepthToViewZ( const in float invClipZ,const in float near,const in float far ) {
return ( near*far )/( ( far-near )*invClipZ-far );
}
float viewZToPerspectiveDepth( const in float viewZ,const in float near,const in float far ) {
return ( near*far/viewZ+far)/( far-near );
}
float viewZToOrthographicDepth( const in float viewZ,const in float near,const in float far ) {
return ( viewZ+near )/( near-far );
}
#ifdef SSAO
uniform sampler2D randomSampler;
#ifndef GEOMETRYBUFFER
uniform sampler2D depthNormalSampler;
#else
uniform sampler2D depthSampler;
uniform sampler2D normalSampler;
#endif
uniform float randTextureTiles;
uniform float samplesFactor;
uniform vec3 sampleSphere[SAMPLES];
uniform float totalStrength;
uniform float base;
uniform float xViewport;
uniform float yViewport;
uniform float maxZ;
uniform float minZAspect;
uniform vec2 texelSize;
uniform mat4 projection;
void main()
{
vec3 random=texture2D(randomSampler,vUV*randTextureTiles).rgb;
#ifndef GEOMETRYBUFFER
float depth=texture2D(depthNormalSampler,vUV).r;
#else
float depth=texture2D(depthSampler,vUV).r;
#endif
float depthSign=depth/abs(depth);
depth=depth*depthSign;
#ifndef GEOMETRYBUFFER
vec3 normal=texture2D(depthNormalSampler,vUV).gba;
#else
vec3 normal=texture2D(normalSampler,vUV).rgb;
#endif
float occlusion=0.0;
float correctedRadius=min(radius,minZAspect*depth/near);
vec3 vViewRay=vec3((vUV.x*2.0-1.0)*xViewport,(vUV.y*2.0-1.0)*yViewport,depthSign);
vec3 origin=vViewRay*depth;
vec3 rvec=random*2.0-1.0;
rvec.z=0.0;

float dotProduct=dot(rvec,normal);
rvec=1.0-abs(dotProduct)>1e-2 ? rvec : vec3(-rvec.y,0.0,rvec.x);
vec3 tangent=normalize(rvec-normal*dot(rvec,normal));
vec3 bitangent=cross(normal,tangent);
mat3 tbn=mat3(tangent,bitangent,normal);
float difference;
for (int i=0; i<SAMPLES; ++i) {

vec3 samplePosition=scales[(i+int(random.x*16.0)) % 16]*tbn*sampleSphere[(i+int(random.y*16.0)) % 16];
samplePosition=samplePosition*correctedRadius+origin;

vec4 offset=vec4(samplePosition,1.0);
offset=projection*offset;
offset.xyz/=offset.w;
offset.xy=offset.xy*0.5+0.5;
if (offset.x<0.0 || offset.y<0.0 || offset.x>1.0 || offset.y>1.0) {
continue;
}

#ifndef GEOMETRYBUFFER
float sampleDepth=abs(texture2D(depthNormalSampler,offset.xy).r);
#else
float sampleDepth=abs(texture2D(depthSampler,offset.xy).r);
#endif

difference=depthSign*samplePosition.z-sampleDepth;
float rangeCheck=1.0-smoothstep(correctedRadius*0.5,correctedRadius,difference);
occlusion+=(difference>=0.0 ? 1.0 : 0.0)*rangeCheck;
}
occlusion=occlusion*(1.0-smoothstep(maxZ*0.75,maxZ,depth));
float ao=1.0-totalStrength*occlusion*samplesFactor;
float result=clamp(ao+base,0.0,1.0);
gl_FragColor=vec4(vec3(result),1.0);
}
#endif
#ifdef BILATERAL_BLUR
uniform sampler2D depthNormalSampler;
uniform float outSize;
uniform float samplerOffsets[SAMPLES];
vec4 blur9(sampler2D image,vec2 uv,float resolution,vec2 direction) {
vec4 color=vec4(0.0);
vec2 off1=vec2(1.3846153846)*direction;
vec2 off2=vec2(3.2307692308)*direction;
color+=texture2D(image,uv)*0.2270270270;
color+=texture2D(image,uv+(off1/resolution))*0.3162162162;
color+=texture2D(image,uv-(off1/resolution))*0.3162162162;
color+=texture2D(image,uv+(off2/resolution))*0.0702702703;
color+=texture2D(image,uv-(off2/resolution))*0.0702702703;
return color;
}
vec4 blur13(sampler2D image,vec2 uv,float resolution,vec2 direction) {
vec4 color=vec4(0.0);
vec2 off1=vec2(1.411764705882353)*direction;
vec2 off2=vec2(3.2941176470588234)*direction;
vec2 off3=vec2(5.176470588235294)*direction;
color+=texture2D(image,uv)*0.1964825501511404;
color+=texture2D(image,uv+(off1/resolution))*0.2969069646728344;
color+=texture2D(image,uv-(off1/resolution))*0.2969069646728344;
color+=texture2D(image,uv+(off2/resolution))*0.09447039785044732;
color+=texture2D(image,uv-(off2/resolution))*0.09447039785044732;
color+=texture2D(image,uv+(off3/resolution))*0.010381362401148057;
color+=texture2D(image,uv-(off3/resolution))*0.010381362401148057;
return color;
}
vec4 blur13Bilateral(sampler2D image,vec2 uv,float resolution,vec2 direction) {
vec4 color=vec4(0.0);
vec2 off1=vec2(1.411764705882353)*direction;
vec2 off2=vec2(3.2941176470588234)*direction;
vec2 off3=vec2(5.176470588235294)*direction;
float compareDepth=abs(texture2D(depthNormalSampler,uv).r);
float sampleDepth;
float weight;
float weightSum=30.0;
color+=texture2D(image,uv)*30.0;
sampleDepth=abs(texture2D(depthNormalSampler,uv+(off1/resolution)).r);
weight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);
weightSum+=weight;
color+=texture2D(image,uv+(off1/resolution))*weight;
sampleDepth=abs(texture2D(depthNormalSampler,uv-(off1/resolution)).r);
weight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);
weightSum+=weight;
color+=texture2D(image,uv-(off1/resolution))*weight;
sampleDepth=abs(texture2D(depthNormalSampler,uv+(off2/resolution)).r);
weight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);
weightSum+=weight;
color+=texture2D(image,uv+(off2/resolution))*weight;
sampleDepth=abs(texture2D(depthNormalSampler,uv-(off2/resolution)).r);
weight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);
weightSum+=weight;
color+=texture2D(image,uv-(off2/resolution))*weight;
sampleDepth=abs(texture2D(depthNormalSampler,uv+(off3/resolution)).r);
weight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);
weightSum+=weight;
color+=texture2D(image,uv+(off3/resolution))*weight;
sampleDepth=abs(texture2D(depthNormalSampler,uv-(off3/resolution)).r);
weight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);
weightSum+=weight;
color+=texture2D(image,uv-(off3/resolution))*weight;
return color/weightSum;
}
void main()
{
#if EXPENSIVE
float compareDepth=abs(texture2D(depthNormalSampler,vUV).r);
float texelsize=1.0/outSize;
float result=0.0;
float weightSum=0.0;
for (int i=0; i<SAMPLES; ++i)
{
#ifdef BILATERAL_BLUR_H
vec2 direction=vec2(1.0,0.0);
vec2 sampleOffset=vec2(texelsize*samplerOffsets[i],0.0);
#else
vec2 direction=vec2(0.0,1.0);
vec2 sampleOffset=vec2(0.0,texelsize*samplerOffsets[i]);
#endif
vec2 samplePos=vUV+sampleOffset;
float sampleDepth=abs(texture2D(depthNormalSampler,samplePos).r);
float weight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30000.0);
result+=texture2D(textureSampler,samplePos).r*weight;
weightSum+=weight;
}
result/=weightSum;
gl_FragColor.rgb=vec3(result);
gl_FragColor.a=1.0;
#else
vec4 color;
#ifdef BILATERAL_BLUR_H
vec2 direction=vec2(1.0,0.0);
color=blur13Bilateral(textureSampler,vUV,outSize,direction);
#else
vec2 direction=vec2(0.0,1.0);
color=blur13Bilateral(textureSampler,vUV,outSize,direction);
#endif
gl_FragColor.rgb=vec3(color.r);
gl_FragColor.a=1.0;
#endif
}
#endif
`;Ye.a.ShadersStore.ssao2PixelShader=GL;var HL=`uniform sampler2D textureSampler;
uniform sampler2D originalColor;
uniform vec4 viewport;
varying vec2 vUV;
void main(void) {
vec4 ssaoColor=texture2D(textureSampler,viewport.xy+vUV*viewport.zw);
vec4 sceneColor=texture2D(originalColor,vUV);
gl_FragColor=sceneColor*ssaoColor;
}
`;Ye.a.ShadersStore.ssaoCombinePixelShader=HL;var RE=function(i){function t(e,n,r,o,u){u===void 0&&(u=!0);var f=i.call(this,n.getEngine(),e)||this;if(f.SSAOOriginalSceneColorEffect="SSAOOriginalSceneColorEffect",f.SSAORenderEffect="SSAORenderEffect",f.SSAOBlurHRenderEffect="SSAOBlurHRenderEffect",f.SSAOBlurVRenderEffect="SSAOBlurVRenderEffect",f.SSAOCombineRenderEffect="SSAOCombineRenderEffect",f.totalStrength=1,f.maxZ=100,f.minZAspect=.2,f._samples=8,f._textureSamples=1,f._forceGeometryBuffer=!1,f._expensiveBlur=!0,f.radius=2,f.base=0,f._bits=new Uint32Array(1),f._scene=n,f._ratio=r,f._forceGeometryBuffer=u,!f.isSupported)return _.a.Error("SSAO 2 needs WebGL 2 support."),f;var v=f._ratio.ssaoRatio||r,y=f._ratio.blurRatio||r;return f._forceGeometryBuffer?n.enableGeometryBufferRenderer():f._prePassRenderer=n.enablePrePassRenderer(),f._createRandomTexture(),f._originalColorPostProcess=new jo("SSAOOriginalSceneColor",1,null,ke.a.BILINEAR_SAMPLINGMODE,n.getEngine(),!1),f._originalColorPostProcess.samples=f.textureSamples,f._createSSAOPostProcess(1),f._createBlurPostProcess(v,y),f._createSSAOCombinePostProcess(y),f.addEffect(new Yt(n.getEngine(),f.SSAOOriginalSceneColorEffect,function(){return f._originalColorPostProcess},!0)),f.addEffect(new Yt(n.getEngine(),f.SSAORenderEffect,function(){return f._ssaoPostProcess},!0)),f.addEffect(new Yt(n.getEngine(),f.SSAOBlurHRenderEffect,function(){return f._blurHPostProcess},!0)),f.addEffect(new Yt(n.getEngine(),f.SSAOBlurVRenderEffect,function(){return f._blurVPostProcess},!0)),f.addEffect(new Yt(n.getEngine(),f.SSAOCombineRenderEffect,function(){return f._ssaoCombinePostProcess},!0)),n.postProcessRenderPipelineManager.addPipeline(f),o&&n.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(e,o),f}return Object(p.d)(t,i),Object.defineProperty(t.prototype,"samples",{get:function(){return this._samples},set:function(e){this._samples=e,this._ssaoPostProcess.updateEffect(this._getDefinesForSSAO()),this._sampleSphere=this._generateHemisphere()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"textureSamples",{get:function(){return this._textureSamples},set:function(e){this._textureSamples=e,this._originalColorPostProcess.samples=e,this._blurHPostProcess.samples=e,this._blurVPostProcess.samples=e,this._ssaoPostProcess.samples=e,this._ssaoCombinePostProcess.samples=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"expensiveBlur",{get:function(){return this._expensiveBlur},set:function(e){this._blurHPostProcess.updateEffect(`#define BILATERAL_BLUR
#define BILATERAL_BLUR_H
#define SAMPLES 16
#define EXPENSIVE `+(e?"1":"0")+`
`,null,["textureSampler","depthNormalSampler"]),this._blurVPostProcess.updateEffect(`#define BILATERAL_BLUR
#define SAMPLES 16
#define EXPENSIVE `+(e?"1":"0")+`
`,null,["textureSampler","depthNormalSampler"]),this._expensiveBlur=e},enumerable:!1,configurable:!0}),Object.defineProperty(t,"IsSupported",{get:function(){var e=ne.a.LastCreatedEngine;return!!e&&e.webGLVersion>=2},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scene",{get:function(){return this._scene},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"SSAO2RenderingPipeline"},t.prototype.dispose=function(e){e===void 0&&(e=!1);for(var n=0;n<this._scene.cameras.length;n++){var r=this._scene.cameras[n];this._originalColorPostProcess.dispose(r),this._ssaoPostProcess.dispose(r),this._blurHPostProcess.dispose(r),this._blurVPostProcess.dispose(r),this._ssaoCombinePostProcess.dispose(r)}this._randomTexture.dispose(),e&&this._scene.disableGeometryBufferRenderer(),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._scene.cameras),i.prototype.dispose.call(this)},t.prototype._createBlurPostProcess=function(e,n){var r=this;this._samplerOffsets=[];for(var o=this.expensiveBlur,u=-8;u<8;u++)this._samplerOffsets.push(2*u+.5);this._blurHPostProcess=new St("BlurH","ssao2",["outSize","samplerOffsets","near","far","radius"],["depthNormalSampler"],e,null,ke.a.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,`#define BILATERAL_BLUR
#define BILATERAL_BLUR_H
#define SAMPLES 16
#define EXPENSIVE `+(o?"1":"0")+`
`),this._blurHPostProcess.onApply=function(f){r._scene.activeCamera&&(f.setFloat("outSize",r._ssaoCombinePostProcess.width>0?r._ssaoCombinePostProcess.width:r._originalColorPostProcess.width),f.setFloat("near",r._scene.activeCamera.minZ),f.setFloat("far",r._scene.activeCamera.maxZ),f.setFloat("radius",r.radius),r._forceGeometryBuffer?f.setTexture("depthNormalSampler",r._scene.enableGeometryBufferRenderer().getGBuffer().textures[0]):f.setTexture("depthNormalSampler",r._prePassRenderer.prePassRT.textures[r._prePassRenderer.getIndex(g.a.PREPASS_DEPTHNORMAL_TEXTURE_TYPE)]),f.setArray("samplerOffsets",r._samplerOffsets))},this._blurVPostProcess=new St("BlurV","ssao2",["outSize","samplerOffsets","near","far","radius"],["depthNormalSampler"],n,null,ke.a.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,`#define BILATERAL_BLUR
#define BILATERAL_BLUR_V
#define SAMPLES 16
#define EXPENSIVE `+(o?"1":"0")+`
`),this._blurVPostProcess.onApply=function(f){r._scene.activeCamera&&(f.setFloat("outSize",r._ssaoCombinePostProcess.height>0?r._ssaoCombinePostProcess.height:r._originalColorPostProcess.height),f.setFloat("near",r._scene.activeCamera.minZ),f.setFloat("far",r._scene.activeCamera.maxZ),f.setFloat("radius",r.radius),r._forceGeometryBuffer?f.setTexture("depthNormalSampler",r._scene.enableGeometryBufferRenderer().getGBuffer().textures[0]):f.setTexture("depthNormalSampler",r._prePassRenderer.prePassRT.textures[r._prePassRenderer.getIndex(g.a.PREPASS_DEPTHNORMAL_TEXTURE_TYPE)]),f.setArray("samplerOffsets",r._samplerOffsets))},this._blurHPostProcess.samples=this.textureSamples,this._blurVPostProcess.samples=this.textureSamples},t.prototype._rebuild=function(){i.prototype._rebuild.call(this)},t.prototype._radicalInverse_VdC=function(e){return this._bits[0]=e,this._bits[0]=(this._bits[0]<<16|this._bits[0]>>16)>>>0,this._bits[0]=(1431655765&this._bits[0])<<1|(2863311530&this._bits[0])>>>1>>>0,this._bits[0]=(858993459&this._bits[0])<<2|(3435973836&this._bits[0])>>>2>>>0,this._bits[0]=(252645135&this._bits[0])<<4|(4042322160&this._bits[0])>>>4>>>0,this._bits[0]=(16711935&this._bits[0])<<8|(4278255360&this._bits[0])>>>8>>>0,23283064365386963e-26*this._bits[0]},t.prototype._hammersley=function(e,n){return[e/n,this._radicalInverse_VdC(e)]},t.prototype._hemisphereSample_uniform=function(e,n){var r=2*n*Math.PI,o=1-(.85*e+.15),u=Math.sqrt(1-o*o);return new d.e(Math.cos(r)*u,Math.sin(r)*u,o)},t.prototype._generateHemisphere=function(){for(var e,n=this.samples,r=[],o=0;o<n;){if(n<16)e=this._hemisphereSample_uniform(Math.random(),Math.random());else{var u=this._hammersley(o,n);e=this._hemisphereSample_uniform(u[0],u[1])}r.push(e.x,e.y,e.z),o++}return r},t.prototype._getDefinesForSSAO=function(){var e="#define SAMPLES "+this.samples+`
#define SSAO`;return this._forceGeometryBuffer&&(e+=`
#define GEOMETRYBUFFER`),e},t.prototype._createSSAOPostProcess=function(e){var n=this;this._sampleSphere=this._generateHemisphere();var r,o=this._getDefinesForSSAO();r=this._forceGeometryBuffer?["randomSampler","depthSampler","normalSampler"]:["randomSampler","depthNormalSampler"],this._ssaoPostProcess=new St("ssao2","ssao2",["sampleSphere","samplesFactor","randTextureTiles","totalStrength","radius","base","range","projection","near","far","texelSize","xViewport","yViewport","maxZ","minZAspect"],r,e,null,ke.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,o),this._ssaoPostProcess.onApply=function(u){n._scene.activeCamera&&(u.setArray3("sampleSphere",n._sampleSphere),u.setFloat("randTextureTiles",32),u.setFloat("samplesFactor",1/n.samples),u.setFloat("totalStrength",n.totalStrength),u.setFloat2("texelSize",1/n._ssaoPostProcess.width,1/n._ssaoPostProcess.height),u.setFloat("radius",n.radius),u.setFloat("maxZ",n.maxZ),u.setFloat("minZAspect",n.minZAspect),u.setFloat("base",n.base),u.setFloat("near",n._scene.activeCamera.minZ),u.setFloat("far",n._scene.activeCamera.maxZ),u.setFloat("xViewport",Math.tan(n._scene.activeCamera.fov/2)*n._scene.getEngine().getAspectRatio(n._scene.activeCamera,!0)),u.setFloat("yViewport",Math.tan(n._scene.activeCamera.fov/2)),u.setMatrix("projection",n._scene.getProjectionMatrix()),n._forceGeometryBuffer?(u.setTexture("depthSampler",n._scene.enableGeometryBufferRenderer().getGBuffer().textures[0]),u.setTexture("normalSampler",n._scene.enableGeometryBufferRenderer().getGBuffer().textures[1])):u.setTexture("depthNormalSampler",n._prePassRenderer.prePassRT.textures[n._prePassRenderer.getIndex(g.a.PREPASS_DEPTHNORMAL_TEXTURE_TYPE)]),u.setTexture("randomSampler",n._randomTexture))},this._ssaoPostProcess.samples=this.textureSamples},t.prototype._createSSAOCombinePostProcess=function(e){var n=this;this._ssaoCombinePostProcess=new St("ssaoCombine","ssaoCombine",[],["originalColor","viewport"],e,null,ke.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._ssaoCombinePostProcess.onApply=function(r){var o=n._scene.activeCamera.viewport;r.setVector4("viewport",d.c.Vector4[0].copyFromFloats(o.x,o.y,o.width,o.height)),r.setTextureFromPostProcessOutput("originalColor",n._originalColorPostProcess)},this._ssaoCombinePostProcess.samples=this.textureSamples,this._forceGeometryBuffer||(this._ssaoCombinePostProcess._prePassEffectConfiguration=new zL)},t.prototype._createRandomTexture=function(){this._randomTexture=new io.a("SSAORandomTexture",128,this._scene,!1,ke.a.TRILINEAR_SAMPLINGMODE),this._randomTexture.wrapU=ke.a.WRAP_ADDRESSMODE,this._randomTexture.wrapV=ke.a.WRAP_ADDRESSMODE;for(var e=this._randomTexture.getContext(),n=function(f,v){return Math.random()*(v-f)+f},r=d.e.Zero(),o=0;o<128;o++)for(var u=0;u<128;u++)r.x=n(0,1),r.y=n(0,1),r.z=0,r.normalize(),r.scaleInPlace(255),r.x=Math.floor(r.x),r.y=Math.floor(r.y),e.fillStyle="rgb("+r.x+", "+r.y+", "+r.z+")",e.fillRect(o,u,1,1);this._randomTexture.update(!1)},t.prototype.serialize=function(){var e=B.a.Serialize(this);return e.customType="SSAO2RenderingPipeline",e},t.Parse=function(e,n,r){return B.a.Parse(function(){return new t(e._name,n,e._ratio)},e,n,r)},Object(p.c)([Object(B.c)()],t.prototype,"totalStrength",void 0),Object(p.c)([Object(B.c)()],t.prototype,"maxZ",void 0),Object(p.c)([Object(B.c)()],t.prototype,"minZAspect",void 0),Object(p.c)([Object(B.c)("samples")],t.prototype,"_samples",void 0),Object(p.c)([Object(B.c)("textureSamples")],t.prototype,"_textureSamples",void 0),Object(p.c)([Object(B.c)()],t.prototype,"_ratio",void 0),Object(p.c)([Object(B.c)("expensiveBlur")],t.prototype,"_expensiveBlur",void 0),Object(p.c)([Object(B.c)()],t.prototype,"radius",void 0),Object(p.c)([Object(B.c)()],t.prototype,"base",void 0),t}(Bs);C.a.RegisteredTypes["BABYLON.SSAO2RenderingPipeline"]=RE;var WL=`
uniform sampler2D textureSampler;
varying vec2 vUV;
#ifdef SSAO
uniform sampler2D randomSampler;
uniform float randTextureTiles;
uniform float samplesFactor;
uniform vec3 sampleSphere[SAMPLES];
uniform float totalStrength;
uniform float radius;
uniform float area;
uniform float fallOff;
uniform float base;
vec3 normalFromDepth(float depth,vec2 coords)
{
vec2 offset1=vec2(0.0,radius);
vec2 offset2=vec2(radius,0.0);
float depth1=texture2D(textureSampler,coords+offset1).r;
float depth2=texture2D(textureSampler,coords+offset2).r;
vec3 p1=vec3(offset1,depth1-depth);
vec3 p2=vec3(offset2,depth2-depth);
vec3 normal=cross(p1,p2);
normal.z=-normal.z;
return normalize(normal);
}
void main()
{
vec3 random=normalize(texture2D(randomSampler,vUV*randTextureTiles).rgb);
float depth=texture2D(textureSampler,vUV).r;
vec3 position=vec3(vUV,depth);
vec3 normal=normalFromDepth(depth,vUV);
float radiusDepth=radius/depth;
float occlusion=0.0;
vec3 ray;
vec3 hemiRay;
float occlusionDepth;
float difference;
for (int i=0; i<SAMPLES; i++)
{
ray=radiusDepth*reflect(sampleSphere[i],random);
hemiRay=position+sign(dot(ray,normal))*ray;
occlusionDepth=texture2D(textureSampler,clamp(hemiRay.xy,vec2(0.001,0.001),vec2(0.999,0.999))).r;
difference=depth-occlusionDepth;
occlusion+=step(fallOff,difference)*(1.0-smoothstep(fallOff,area,difference));
}
float ao=1.0-totalStrength*occlusion*samplesFactor;
float result=clamp(ao+base,0.0,1.0);
gl_FragColor.r=result;
gl_FragColor.g=result;
gl_FragColor.b=result;
gl_FragColor.a=1.0;
}
#endif
`;Ye.a.ShadersStore.ssaoPixelShader=WL;var XL=function(i){function t(e,n,r,o){var u=i.call(this,n.getEngine(),e)||this;u.SSAOOriginalSceneColorEffect="SSAOOriginalSceneColorEffect",u.SSAORenderEffect="SSAORenderEffect",u.SSAOBlurHRenderEffect="SSAOBlurHRenderEffect",u.SSAOBlurVRenderEffect="SSAOBlurVRenderEffect",u.SSAOCombineRenderEffect="SSAOCombineRenderEffect",u.totalStrength=1,u.radius=1e-4,u.area=.0075,u.fallOff=1e-6,u.base=.5,u._firstUpdate=!0,u._scene=n,u._createRandomTexture(),u._depthTexture=n.enableDepthRenderer().getDepthMap();var f=r.ssaoRatio||r,v=r.combineRatio||r;return u._originalColorPostProcess=new jo("SSAOOriginalSceneColor",v,null,ke.a.BILINEAR_SAMPLINGMODE,n.getEngine(),!1),u._createSSAOPostProcess(f),u._createBlurPostProcess(f),u._createSSAOCombinePostProcess(v),u.addEffect(new Yt(n.getEngine(),u.SSAOOriginalSceneColorEffect,function(){return u._originalColorPostProcess},!0)),u.addEffect(new Yt(n.getEngine(),u.SSAORenderEffect,function(){return u._ssaoPostProcess},!0)),u.addEffect(new Yt(n.getEngine(),u.SSAOBlurHRenderEffect,function(){return u._blurHPostProcess},!0)),u.addEffect(new Yt(n.getEngine(),u.SSAOBlurVRenderEffect,function(){return u._blurVPostProcess},!0)),u.addEffect(new Yt(n.getEngine(),u.SSAOCombineRenderEffect,function(){return u._ssaoCombinePostProcess},!0)),n.postProcessRenderPipelineManager.addPipeline(u),o&&n.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(e,o),u}return Object(p.d)(t,i),Object.defineProperty(t.prototype,"scene",{get:function(){return this._scene},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"SSAORenderingPipeline"},t.prototype.dispose=function(e){e===void 0&&(e=!1);for(var n=0;n<this._scene.cameras.length;n++){var r=this._scene.cameras[n];this._originalColorPostProcess.dispose(r),this._ssaoPostProcess.dispose(r),this._blurHPostProcess.dispose(r),this._blurVPostProcess.dispose(r),this._ssaoCombinePostProcess.dispose(r)}this._randomTexture.dispose(),e&&this._scene.disableDepthRenderer(),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._scene.cameras),i.prototype.dispose.call(this)},t.prototype._createBlurPostProcess=function(e){var n=this;this._blurHPostProcess=new ar("BlurH",new d.d(1,0),16,e,null,ke.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,g.a.TEXTURETYPE_UNSIGNED_INT),this._blurVPostProcess=new ar("BlurV",new d.d(0,1),16,e,null,ke.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,g.a.TEXTURETYPE_UNSIGNED_INT),this._blurHPostProcess.onActivateObservable.add(function(){var r=n._blurHPostProcess.width/n._scene.getEngine().getRenderWidth();n._blurHPostProcess.kernel=16*r}),this._blurVPostProcess.onActivateObservable.add(function(){var r=n._blurVPostProcess.height/n._scene.getEngine().getRenderHeight();n._blurVPostProcess.kernel=16*r})},t.prototype._rebuild=function(){this._firstUpdate=!0,i.prototype._rebuild.call(this)},t.prototype._createSSAOPostProcess=function(e){var n=this,r=[.5381,.1856,-.4319,.1379,.2486,.443,.3371,.5679,-.0057,-.6999,-.0451,-.0019,.0689,-.1598,-.8547,.056,.0069,-.1843,-.0146,.1402,.0762,.01,-.1924,-.0344,-.3577,-.5301,-.4358,-.3169,.1063,.0158,.0103,-.5869,.0046,-.0897,-.494,.3287,.7119,-.0154,-.0918,-.0533,.0596,-.5411,.0352,-.0631,.546,-.4776,.2847,-.0271];this._ssaoPostProcess=new St("ssao","ssao",["sampleSphere","samplesFactor","randTextureTiles","totalStrength","radius","area","fallOff","base","range","viewport"],["randomSampler"],e,null,ke.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,`#define SAMPLES 16
#define SSAO`),this._ssaoPostProcess.onApply=function(o){n._firstUpdate&&(o.setArray3("sampleSphere",r),o.setFloat("samplesFactor",1/16),o.setFloat("randTextureTiles",4)),o.setFloat("totalStrength",n.totalStrength),o.setFloat("radius",n.radius),o.setFloat("area",n.area),o.setFloat("fallOff",n.fallOff),o.setFloat("base",n.base),o.setTexture("textureSampler",n._depthTexture),o.setTexture("randomSampler",n._randomTexture)}},t.prototype._createSSAOCombinePostProcess=function(e){var n=this;this._ssaoCombinePostProcess=new St("ssaoCombine","ssaoCombine",[],["originalColor","viewport"],e,null,ke.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._ssaoCombinePostProcess.onApply=function(r){r.setVector4("viewport",d.c.Vector4[0].copyFromFloats(0,0,1,1)),r.setTextureFromPostProcess("originalColor",n._originalColorPostProcess)}},t.prototype._createRandomTexture=function(){this._randomTexture=new io.a("SSAORandomTexture",512,this._scene,!1,ke.a.TRILINEAR_SAMPLINGMODE),this._randomTexture.wrapU=ke.a.WRAP_ADDRESSMODE,this._randomTexture.wrapV=ke.a.WRAP_ADDRESSMODE;for(var e=this._randomTexture.getContext(),n=function(f,v){return Math.random()*(v-f)+f},r=d.e.Zero(),o=0;o<512;o++)for(var u=0;u<512;u++)r.x=Math.floor(255*n(-1,1)),r.y=Math.floor(255*n(-1,1)),r.z=Math.floor(255*n(-1,1)),e.fillStyle="rgb("+r.x+", "+r.y+", "+r.z+")",e.fillRect(o,u,1,1);this._randomTexture.update(!1)},Object(p.c)([Object(B.c)()],t.prototype,"totalStrength",void 0),Object(p.c)([Object(B.c)()],t.prototype,"radius",void 0),Object(p.c)([Object(B.c)()],t.prototype,"area",void 0),Object(p.c)([Object(B.c)()],t.prototype,"fallOff",void 0),Object(p.c)([Object(B.c)()],t.prototype,"base",void 0),t}(Bs),YL=function(){this.enabled=!1,this.name="screenSpaceReflections",this.texturesRequired=[g.a.PREPASS_DEPTHNORMAL_TEXTURE_TYPE,g.a.PREPASS_REFLECTIVITY_TEXTURE_TYPE,g.a.PREPASS_POSITION_TEXTURE_TYPE]},KL=`

uniform sampler2D textureSampler;
uniform sampler2D normalSampler;
uniform sampler2D positionSampler;
uniform sampler2D reflectivitySampler;
uniform mat4 view;
uniform mat4 projection;
uniform float step;
uniform float strength;
uniform float threshold;
uniform float roughnessFactor;
uniform float reflectionSpecularFalloffExponent;

varying vec2 vUV;

struct ReflectionInfo {
vec3 color;
vec4 coords;
};

vec3 fresnelSchlick(float cosTheta,vec3 F0)
{
return F0+(1.0-F0)*pow(1.0-cosTheta,5.0);
}

ReflectionInfo smoothReflectionInfo(vec3 dir,vec3 hitCoord)
{
ReflectionInfo info;
info.color=vec3(0.0);
vec4 projectedCoord;
float sampledDepth;
for(int i=0; i<SMOOTH_STEPS; i++)
{
projectedCoord=projection*vec4(hitCoord,1.0);
projectedCoord.xy/=projectedCoord.w;
projectedCoord.xy=0.5*projectedCoord.xy+vec2(0.5);
sampledDepth=(view*texture2D(positionSampler,projectedCoord.xy)).z;
float depth=sampledDepth-hitCoord.z;
dir*=0.5;
if(depth>0.0)
hitCoord-=dir;
else
hitCoord+=dir;
info.color+=texture2D(textureSampler,projectedCoord.xy).rgb;
}
projectedCoord=projection*vec4(hitCoord,1.0);
projectedCoord.xy/=projectedCoord.w;
projectedCoord.xy=0.5*projectedCoord.xy+vec2(0.5);

info.coords=vec4(projectedCoord.xy,sampledDepth,1.0);
info.color+=texture2D(textureSampler,projectedCoord.xy).rgb;
info.color/=float(SMOOTH_STEPS+1);
return info;
}

ReflectionInfo getReflectionInfo(vec3 dir,vec3 hitCoord)
{
ReflectionInfo info;
vec4 projectedCoord;
float sampledDepth;
dir*=step;
for(int i=0; i<REFLECTION_SAMPLES; i++)
{
hitCoord+=dir;
projectedCoord=projection*vec4(hitCoord,1.0);
projectedCoord.xy/=projectedCoord.w;
projectedCoord.xy=0.5*projectedCoord.xy+vec2(0.5);
sampledDepth=(view*texture2D(positionSampler,projectedCoord.xy)).z;
float depth=sampledDepth-hitCoord.z;
if(((depth-dir.z)<threshold) && depth<=0.0)
{
#ifdef ENABLE_SMOOTH_REFLECTIONS
return smoothReflectionInfo(dir,hitCoord);
#else
info.color=texture2D(textureSampler,projectedCoord.xy).rgb;
info.coords=vec4(projectedCoord.xy,sampledDepth,0.0);
return info;
#endif
}
}
info.color=texture2D(textureSampler,projectedCoord.xy).rgb;
info.coords=vec4(projectedCoord.xy,sampledDepth,0.0);
return info;
}
vec3 hash(vec3 a)
{
a=fract(a*0.8);
a+=dot(a,a.yxz+19.19);
return fract((a.xxy+a.yxx)*a.zyx);
}
void main()
{
#ifdef SSR_SUPPORTED

vec4 albedoFull=texture2D(textureSampler,vUV);
vec3 albedo=albedoFull.rgb;
float spec=texture2D(reflectivitySampler,vUV).r;
if (spec == 0.0) {
gl_FragColor=albedoFull;
return;
}

#ifdef PREPASS_LAYOUT
vec3 normal=(texture2D(normalSampler,vUV)).gba;
#else
vec3 normal=(texture2D(normalSampler,vUV)).xyz;
#endif
vec3 position=(view*texture2D(positionSampler,vUV)).xyz;
vec3 reflected=normalize(reflect(normalize(position),normalize(normal)));
float roughness=1.0-texture2D(reflectivitySampler,vUV).a;
vec3 jitt=mix(vec3(0.0),hash(position),roughness)*roughnessFactor;
ReflectionInfo info=getReflectionInfo(jitt+reflected,position);

vec2 dCoords=smoothstep(0.2,0.6,abs(vec2(0.5,0.5)-info.coords.xy));
float screenEdgefactor=clamp(1.0-(dCoords.x+dCoords.y),0.0,1.0);

vec3 F0=vec3(0.04);
F0=mix(F0,albedo,spec);
vec3 fresnel=fresnelSchlick(max(dot(normalize(normal),normalize(position)),0.0),F0);

float reflectionMultiplier=clamp(pow(spec*strength,reflectionSpecularFalloffExponent)*screenEdgefactor*reflected.z,0.0,0.9);
float albedoMultiplier=1.0-reflectionMultiplier;
vec3 SSR=info.color*fresnel;
gl_FragColor=vec4((albedo*albedoMultiplier)+(SSR*reflectionMultiplier),albedoFull.a);
#else
gl_FragColor=texture2D(textureSampler,vUV);
#endif
}
`;Ye.a.ShadersStore.screenSpaceReflectionPixelShader=KL;var c_=function(i){function t(e,n,r,o,u,f,v,y,D,w){y===void 0&&(y=g.a.TEXTURETYPE_UNSIGNED_INT),D===void 0&&(D=!1),w===void 0&&(w=!0);var F=i.call(this,e,"screenSpaceReflection",["projection","view","threshold","reflectionSpecularFalloffExponent","strength","step","roughnessFactor"],["textureSampler","normalSampler","positionSampler","reflectivitySampler"],r,o,u,f,v,`#define SSR_SUPPORTED
#define REFLECTION_SAMPLES 64
#define SMOOTH_STEPS 5
`,y,void 0,null,D)||this;if(F.threshold=1.2,F.strength=1,F.reflectionSpecularFalloffExponent=3,F.step=1,F.roughnessFactor=.2,F._forceGeometryBuffer=!1,F._enableSmoothReflections=!1,F._reflectionSamples=64,F._smoothSteps=5,F._forceGeometryBuffer=w,F._forceGeometryBuffer){var z=n.enableGeometryBufferRenderer();z&&z.isSupported&&(z.enablePosition=!0,z.enableReflectivity=!0,F._geometryBufferRenderer=z)}else F._prePassRenderer=n.enablePrePassRenderer(),F._prePassRenderer.markAsDirty(),F._prePassEffectConfiguration=new YL;return F._updateEffectDefines(),F.onApply=function(k){var K=F._geometryBufferRenderer,oe=F._prePassRenderer;if(oe||K){if(K){var ae=K.getTextureIndex(Pi.POSITION_TEXTURE_TYPE),ue=K.getTextureIndex(Pi.REFLECTIVITY_TEXTURE_TYPE);k.setTexture("normalSampler",K.getGBuffer().textures[1]),k.setTexture("positionSampler",K.getGBuffer().textures[ae]),k.setTexture("reflectivitySampler",K.getGBuffer().textures[ue])}else{ae=oe.getIndex(g.a.PREPASS_POSITION_TEXTURE_TYPE),ue=oe.getIndex(g.a.PREPASS_REFLECTIVITY_TEXTURE_TYPE);var de=oe.getIndex(g.a.PREPASS_DEPTHNORMAL_TEXTURE_TYPE);k.setTexture("normalSampler",oe.prePassRT.textures[de]),k.setTexture("positionSampler",oe.prePassRT.textures[ae]),k.setTexture("reflectivitySampler",oe.prePassRT.textures[ue])}var me=n.activeCamera;if(me){var ye=me.getViewMatrix(),Ee=me.getProjectionMatrix();k.setMatrix("projection",Ee),k.setMatrix("view",ye),k.setFloat("threshold",F.threshold),k.setFloat("reflectionSpecularFalloffExponent",F.reflectionSpecularFalloffExponent),k.setFloat("strength",F.strength),k.setFloat("step",F.step),k.setFloat("roughnessFactor",F.roughnessFactor)}}},F}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"ScreenSpaceReflectionPostProcess"},Object.defineProperty(t.prototype,"enableSmoothReflections",{get:function(){return this._enableSmoothReflections},set:function(e){e!==this._enableSmoothReflections&&(this._enableSmoothReflections=e,this._updateEffectDefines())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"reflectionSamples",{get:function(){return this._reflectionSamples},set:function(e){e!==this._reflectionSamples&&(this._reflectionSamples=e,this._updateEffectDefines())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"smoothSteps",{get:function(){return this._smoothSteps},set:function(e){e!==this._smoothSteps&&(this._smoothSteps=e,this._updateEffectDefines())},enumerable:!1,configurable:!0}),t.prototype._updateEffectDefines=function(){var e=[];(this._geometryBufferRenderer||this._prePassRenderer)&&(e.push("#define SSR_SUPPORTED"),this._prePassRenderer&&e.push("#define PREPASS_LAYOUT")),this._enableSmoothReflections&&e.push("#define ENABLE_SMOOTH_REFLECTIONS"),e.push("#define REFLECTION_SAMPLES "+(this._reflectionSamples>>0)),e.push("#define SMOOTH_STEPS "+(this._smoothSteps>>0)),this.updateEffect(e.join(`
`))},t._Parse=function(e,n,r,o){return B.a.Parse(function(){return new t(e.name,r,e.options,n,e.renderTargetSamplingMode,r.getEngine(),e.textureType,e.reusable)},e,r,o)},Object(p.c)([Object(B.c)()],t.prototype,"threshold",void 0),Object(p.c)([Object(B.c)()],t.prototype,"strength",void 0),Object(p.c)([Object(B.c)()],t.prototype,"reflectionSpecularFalloffExponent",void 0),Object(p.c)([Object(B.c)()],t.prototype,"step",void 0),Object(p.c)([Object(B.c)()],t.prototype,"roughnessFactor",void 0),Object(p.c)([Object(B.c)()],t.prototype,"enableSmoothReflections",null),Object(p.c)([Object(B.c)()],t.prototype,"reflectionSamples",null),Object(p.c)([Object(B.c)()],t.prototype,"smoothSteps",null),t}(St);C.a.RegisteredTypes["BABYLON.ScreenSpaceReflectionPostProcess"]=c_;var QL=`uniform sampler2D textureSampler;
varying vec2 vUV;
#if defined(PASS_POST_PROCESS)
void main(void)
{
vec4 color=texture2D(textureSampler,vUV);
gl_FragColor=color;
}
#endif
#if defined(DOWN_SAMPLE_X4)
uniform vec2 dsOffsets[16];
void main(void)
{
vec4 average=vec4(0.0,0.0,0.0,0.0);
average=texture2D(textureSampler,vUV+dsOffsets[0]);
average+=texture2D(textureSampler,vUV+dsOffsets[1]);
average+=texture2D(textureSampler,vUV+dsOffsets[2]);
average+=texture2D(textureSampler,vUV+dsOffsets[3]);
average+=texture2D(textureSampler,vUV+dsOffsets[4]);
average+=texture2D(textureSampler,vUV+dsOffsets[5]);
average+=texture2D(textureSampler,vUV+dsOffsets[6]);
average+=texture2D(textureSampler,vUV+dsOffsets[7]);
average+=texture2D(textureSampler,vUV+dsOffsets[8]);
average+=texture2D(textureSampler,vUV+dsOffsets[9]);
average+=texture2D(textureSampler,vUV+dsOffsets[10]);
average+=texture2D(textureSampler,vUV+dsOffsets[11]);
average+=texture2D(textureSampler,vUV+dsOffsets[12]);
average+=texture2D(textureSampler,vUV+dsOffsets[13]);
average+=texture2D(textureSampler,vUV+dsOffsets[14]);
average+=texture2D(textureSampler,vUV+dsOffsets[15]);
average/=16.0;
gl_FragColor=average;
}
#endif
#if defined(BRIGHT_PASS)
uniform vec2 dsOffsets[4];
uniform float brightThreshold;
void main(void)
{
vec4 average=vec4(0.0,0.0,0.0,0.0);
average=texture2D(textureSampler,vUV+vec2(dsOffsets[0].x,dsOffsets[0].y));
average+=texture2D(textureSampler,vUV+vec2(dsOffsets[1].x,dsOffsets[1].y));
average+=texture2D(textureSampler,vUV+vec2(dsOffsets[2].x,dsOffsets[2].y));
average+=texture2D(textureSampler,vUV+vec2(dsOffsets[3].x,dsOffsets[3].y));
average*=0.25;
float luminance=length(average.rgb);
if (luminance<brightThreshold) {
average=vec4(0.0,0.0,0.0,1.0);
}
gl_FragColor=average;
}
#endif
#if defined(TEXTURE_ADDER)
uniform sampler2D otherSampler;
uniform sampler2D lensSampler;
uniform float exposure;
void main(void)
{
vec3 colour=texture2D(textureSampler,vUV).rgb;
colour*=exposure;
vec3 X=max(vec3(0.0,0.0,0.0),colour-0.004);
vec3 retColor=(X*(6.2*X+0.5))/(X*(6.2*X+1.7)+0.06);
colour=retColor*retColor;
colour+=colour*texture2D(lensSampler,vUV).rgb;
vec4 finalColor=vec4(colour.rgb,1.0)+texture2D(otherSampler,vUV);
gl_FragColor=finalColor;
}
#endif
#if defined(VLS)
#define PI 3.1415926535897932384626433832795
uniform mat4 shadowViewProjection;
uniform mat4 lightWorld;
uniform vec3 cameraPosition;
uniform vec3 sunDirection;
uniform vec3 sunColor;
uniform vec2 depthValues;
uniform float scatteringCoefficient;
uniform float scatteringPower;
uniform sampler2D shadowMapSampler;
uniform sampler2D positionSampler;
float computeScattering(float lightDotView)
{
float result=1.0-scatteringCoefficient*scatteringCoefficient;
result/=(4.0*PI*pow(1.0+scatteringCoefficient*scatteringCoefficient-(2.0*scatteringCoefficient)*lightDotView,1.5));
return result;
}
void main(void)
{

vec3 worldPos=texture2D(positionSampler,vUV).rgb;
vec3 startPosition=cameraPosition;
vec3 rayVector=worldPos-startPosition;
float rayLength=length(rayVector);
vec3 rayDirection=rayVector/rayLength;
float stepLength=rayLength/NB_STEPS;
vec3 stepL=rayDirection*stepLength;
vec3 currentPosition=startPosition;
vec3 accumFog=vec3(0.0);
for (int i=0; i<int(NB_STEPS); i++)
{
vec4 worldInShadowCameraSpace=shadowViewProjection*vec4(currentPosition,1.0);
float depthMetric=(worldInShadowCameraSpace.z+depthValues.x)/(depthValues.y);
float shadowPixelDepth=clamp(depthMetric,0.0,1.0);
worldInShadowCameraSpace.xyz/=worldInShadowCameraSpace.w;
worldInShadowCameraSpace.xyz=0.5*worldInShadowCameraSpace.xyz+vec3(0.5);
float shadowMapValue=texture2D(shadowMapSampler,worldInShadowCameraSpace.xy).r;
if (shadowMapValue>shadowPixelDepth)
accumFog+=sunColor*computeScattering(dot(rayDirection,sunDirection));
currentPosition+=stepL;
}
accumFog/=NB_STEPS;
vec3 color=accumFog*scatteringPower;
gl_FragColor=vec4(color*exp(color) ,1.0);
}
#endif
#if defined(VLSMERGE)
uniform sampler2D originalSampler;
void main(void)
{
gl_FragColor=texture2D(originalSampler,vUV)+texture2D(textureSampler,vUV);
}
#endif
#if defined(LUMINANCE)
uniform vec2 lumOffsets[4];
void main()
{
float average=0.0;
vec4 color=vec4(0.0);
float maximum=-1e20;
vec3 weight=vec3(0.299,0.587,0.114);
for (int i=0; i<4; i++)
{
color=texture2D(textureSampler,vUV+ lumOffsets[i]);

float GreyValue=dot(color.rgb,vec3(0.33,0.33,0.33));

#ifdef WEIGHTED_AVERAGE
float GreyValue=dot(color.rgb,weight);
#endif
#ifdef BRIGHTNESS
float GreyValue=max(color.r,max(color.g,color.b));
#endif
#ifdef HSL_COMPONENT
float GreyValue=0.5*(max(color.r,max(color.g,color.b))+min(color.r,min(color.g,color.b)));
#endif
#ifdef MAGNITUDE
float GreyValue=length(color.rgb);
#endif
maximum=max(maximum,GreyValue);
average+=(0.25*log(1e-5+GreyValue));
}
average=exp(average);
gl_FragColor=vec4(average,maximum,0.0,1.0);
}
#endif
#if defined(LUMINANCE_DOWN_SAMPLE)
uniform vec2 dsOffsets[9];
uniform float halfDestPixelSize;
#ifdef FINAL_DOWN_SAMPLER
#include<packingFunctions>
#endif
void main()
{
vec4 color=vec4(0.0);
float average=0.0;
for (int i=0; i<9; i++)
{
color=texture2D(textureSampler,vUV+vec2(halfDestPixelSize,halfDestPixelSize)+dsOffsets[i]);
average+=color.r;
}
average/=9.0;
#ifdef FINAL_DOWN_SAMPLER
gl_FragColor=pack(average);
#else
gl_FragColor=vec4(average,average,0.0,1.0);
#endif
}
#endif
#if defined(HDR)
uniform sampler2D textureAdderSampler;
uniform float averageLuminance;
void main()
{
vec4 color=texture2D(textureAdderSampler,vUV);
#ifndef AUTO_EXPOSURE
vec4 adjustedColor=color/averageLuminance;
color=adjustedColor;
color.a=1.0;
#endif
gl_FragColor=color;
}
#endif
#if defined(LENS_FLARE)
#define GHOSTS 3
uniform sampler2D lensColorSampler;
uniform float strength;
uniform float ghostDispersal;
uniform float haloWidth;
uniform vec2 resolution;
uniform float distortionStrength;
float hash(vec2 p)
{
float h=dot(p,vec2(127.1,311.7));
return -1.0+2.0*fract(sin(h)*43758.5453123);
}
float noise(in vec2 p)
{
vec2 i=floor(p);
vec2 f=fract(p);
vec2 u=f*f*(3.0-2.0*f);
return mix(mix(hash(i+vec2(0.0,0.0)),
hash(i+vec2(1.0,0.0)),u.x),
mix(hash(i+vec2(0.0,1.0)),
hash(i+vec2(1.0,1.0)),u.x),u.y);
}
float fbm(vec2 p)
{
float f=0.0;
f+=0.5000*noise(p); p*=2.02;
f+=0.2500*noise(p); p*=2.03;
f+=0.1250*noise(p); p*=2.01;
f+=0.0625*noise(p); p*=2.04;
f/=0.9375;
return f;
}
vec3 pattern(vec2 uv)
{
vec2 p=-1.0+2.0*uv;
float p2=dot(p,p);
float f=fbm(vec2(15.0*p2))/2.0;
float r=0.2+0.6*sin(12.5*length(uv-vec2(0.5)));
float g=0.2+0.6*sin(20.5*length(uv-vec2(0.5)));
float b=0.2+0.6*sin(17.2*length(uv-vec2(0.5)));
return (1.0-f)*vec3(r,g,b);
}
float luminance(vec3 color)
{
return dot(color.rgb,vec3(0.2126,0.7152,0.0722));
}
vec4 textureDistorted(sampler2D tex,vec2 texcoord,vec2 direction,vec3 distortion)
{
return vec4(
texture2D(tex,texcoord+direction*distortion.r).r,
texture2D(tex,texcoord+direction*distortion.g).g,
texture2D(tex,texcoord+direction*distortion.b).b,
1.0
);
}
void main(void)
{
vec2 uv=-vUV+vec2(1.0);
vec2 ghostDir=(vec2(0.5)-uv)*ghostDispersal;
vec2 texelSize=1.0/resolution;
vec3 distortion=vec3(-texelSize.x*distortionStrength,0.0,texelSize.x*distortionStrength);
vec4 result=vec4(0.0);
float ghostIndice=1.0;
for (int i=0; i<GHOSTS; ++i)
{
vec2 offset=fract(uv+ghostDir*ghostIndice);
float weight=length(vec2(0.5)-offset)/length(vec2(0.5));
weight=pow(1.0-weight,10.0);
result+=textureDistorted(textureSampler,offset,normalize(ghostDir),distortion)*weight*strength;
ghostIndice+=1.0;
}
vec2 haloVec=normalize(ghostDir)*haloWidth;
float weight=length(vec2(0.5)-fract(uv+haloVec))/length(vec2(0.5));
weight=pow(1.0-weight,10.0);
result+=textureDistorted(textureSampler,fract(uv+haloVec),normalize(ghostDir),distortion)*weight*strength;
result*=texture2D(lensColorSampler,vec2(length(vec2(0.5)-uv)/length(vec2(0.5))));
gl_FragColor=result;
}
#endif
#if defined(LENS_FLARE_COMPOSE)
uniform sampler2D otherSampler;
uniform sampler2D lensDirtSampler;
uniform sampler2D lensStarSampler;
uniform mat4 lensStarMatrix;
void main(void)
{
vec2 lensFlareCoords=(lensStarMatrix*vec4(vUV,1.0,1.0)).xy;
vec4 lensMod=texture2D(lensDirtSampler,vUV);
lensMod+=texture2D(lensStarSampler,vUV);
vec4 result=texture2D(textureSampler,vUV)*lensMod;
gl_FragColor=texture2D(otherSampler,vUV)+result;
}
#endif
#if defined(DEPTH_OF_FIELD)
uniform sampler2D otherSampler;
uniform sampler2D depthSampler;
uniform float distance;
void main(void)
{
vec4 sharp=texture2D(otherSampler,vUV);
vec4 blur=texture2D(textureSampler,vUV);
float dist=clamp(texture2D(depthSampler,vUV).r*distance,0.0,1.0);
float factor=0.0;
if (dist<0.05)
factor=1.0;
else if (dist<0.1)
factor=20.0*(0.1-dist);
else if (dist<0.5)
factor=0.0;
else
factor=2.0*(dist-0.5);
factor=clamp(factor,0.0,0.90);
gl_FragColor=mix(sharp,blur,factor);
}
#endif
#if defined(MOTION_BLUR)
uniform mat4 inverseViewProjection;
uniform mat4 prevViewProjection;
uniform vec2 screenSize;
uniform float motionScale;
uniform float motionStrength;
uniform sampler2D depthSampler;
void main(void)
{
vec2 texelSize=1.0/screenSize;
float depth=texture2D(depthSampler,vUV).r;
vec4 cpos=vec4(vUV*2.0-1.0,depth,1.0);
cpos=cpos*inverseViewProjection;
vec4 ppos=cpos*prevViewProjection;
ppos.xyz/=ppos.w;
ppos.xy=ppos.xy*0.5+0.5;
vec2 velocity=(ppos.xy-vUV)*motionScale*motionStrength;
float speed=length(velocity/texelSize);
int nSamples=int(clamp(speed,1.0,MAX_MOTION_SAMPLES));
vec4 result=texture2D(textureSampler,vUV);
for (int i=1; i<int(MAX_MOTION_SAMPLES); ++i) {
if (i>=nSamples)
break;
vec2 offset1=vUV+velocity*(float(i)/float(nSamples-1)-0.5);
result+=texture2D(textureSampler,offset1);
}
gl_FragColor=result/float(nSamples);
}
#endif
`;Ye.a.ShadersStore.standardPixelShader=QL;var OE=function(i){function t(e,n,r,o,u){o===void 0&&(o=null);var f=i.call(this,n.getEngine(),e)||this;return f.downSampleX4PostProcess=null,f.brightPassPostProcess=null,f.blurHPostProcesses=[],f.blurVPostProcesses=[],f.textureAdderPostProcess=null,f.volumetricLightPostProcess=null,f.volumetricLightSmoothXPostProcess=null,f.volumetricLightSmoothYPostProcess=null,f.volumetricLightMergePostProces=null,f.volumetricLightFinalPostProcess=null,f.luminancePostProcess=null,f.luminanceDownSamplePostProcesses=[],f.hdrPostProcess=null,f.textureAdderFinalPostProcess=null,f.lensFlareFinalPostProcess=null,f.hdrFinalPostProcess=null,f.lensFlarePostProcess=null,f.lensFlareComposePostProcess=null,f.motionBlurPostProcess=null,f.depthOfFieldPostProcess=null,f.fxaaPostProcess=null,f.screenSpaceReflectionPostProcess=null,f.brightThreshold=1,f.blurWidth=512,f.horizontalBlur=!1,f.lensTexture=null,f.volumetricLightCoefficient=.2,f.volumetricLightPower=4,f.volumetricLightBlurScale=64,f.sourceLight=null,f.hdrMinimumLuminance=1,f.hdrDecreaseRate=.5,f.hdrIncreaseRate=.5,f.lensColorTexture=null,f.lensFlareStrength=20,f.lensFlareGhostDispersal=1.4,f.lensFlareHaloWidth=.7,f.lensFlareDistortionStrength=16,f.lensFlareBlurWidth=512,f.lensStarTexture=null,f.lensFlareDirtTexture=null,f.depthOfFieldDistance=10,f.depthOfFieldBlurWidth=64,f.animations=[],f._currentDepthOfFieldSource=null,f._fixedExposure=1,f._currentExposure=1,f._hdrAutoExposure=!1,f._hdrCurrentLuminance=1,f._motionStrength=1,f._isObjectBasedMotionBlur=!1,f._camerasToBeAttached=[],f._bloomEnabled=!1,f._depthOfFieldEnabled=!1,f._vlsEnabled=!1,f._lensFlareEnabled=!1,f._hdrEnabled=!1,f._motionBlurEnabled=!1,f._fxaaEnabled=!1,f._screenSpaceReflectionsEnabled=!1,f._motionBlurSamples=64,f._volumetricLightStepsCount=50,f._samples=1,f._cameras=u||n.cameras,f._cameras=f._cameras.slice(),f._camerasToBeAttached=f._cameras.slice(),f._scene=n,f._basePostProcess=o,f._ratio=r,f._floatTextureType=n.getEngine().getCaps().textureFloatRender?g.a.TEXTURETYPE_FLOAT:g.a.TEXTURETYPE_HALF_FLOAT,n.postProcessRenderPipelineManager.addPipeline(f),f._buildPipeline(),f}return Object(p.d)(t,i),Object.defineProperty(t.prototype,"exposure",{get:function(){return this._fixedExposure},set:function(e){this._fixedExposure=e,this._currentExposure=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hdrAutoExposure",{get:function(){return this._hdrAutoExposure},set:function(e){if(this._hdrAutoExposure=e,this.hdrPostProcess){var n=["#define HDR"];e&&n.push("#define AUTO_EXPOSURE"),this.hdrPostProcess.updateEffect(n.join(`
`))}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"motionStrength",{get:function(){return this._motionStrength},set:function(e){this._motionStrength=e,this._isObjectBasedMotionBlur&&this.motionBlurPostProcess&&(this.motionBlurPostProcess.motionStrength=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"objectBasedMotionBlur",{get:function(){return this._isObjectBasedMotionBlur},set:function(e){var n=this._isObjectBasedMotionBlur!==e;this._isObjectBasedMotionBlur=e,n&&this._buildPipeline()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"BloomEnabled",{get:function(){return this._bloomEnabled},set:function(e){this._bloomEnabled!==e&&(this._bloomEnabled=e,this._buildPipeline())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"DepthOfFieldEnabled",{get:function(){return this._depthOfFieldEnabled},set:function(e){this._depthOfFieldEnabled!==e&&(this._depthOfFieldEnabled=e,this._buildPipeline())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"LensFlareEnabled",{get:function(){return this._lensFlareEnabled},set:function(e){this._lensFlareEnabled!==e&&(this._lensFlareEnabled=e,this._buildPipeline())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"HDREnabled",{get:function(){return this._hdrEnabled},set:function(e){this._hdrEnabled!==e&&(this._hdrEnabled=e,this._buildPipeline())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"VLSEnabled",{get:function(){return this._vlsEnabled},set:function(e){if(this._vlsEnabled!==e){if(e&&!this._scene.enableGeometryBufferRenderer())return void _.a.Warn("Geometry renderer is not supported, cannot create volumetric lights in Standard Rendering Pipeline");this._vlsEnabled=e,this._buildPipeline()}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"MotionBlurEnabled",{get:function(){return this._motionBlurEnabled},set:function(e){this._motionBlurEnabled!==e&&(this._motionBlurEnabled=e,this._buildPipeline())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fxaaEnabled",{get:function(){return this._fxaaEnabled},set:function(e){this._fxaaEnabled!==e&&(this._fxaaEnabled=e,this._buildPipeline())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"screenSpaceReflectionsEnabled",{get:function(){return this._screenSpaceReflectionsEnabled},set:function(e){this._screenSpaceReflectionsEnabled!==e&&(this._screenSpaceReflectionsEnabled=e,this._buildPipeline())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"volumetricLightStepsCount",{get:function(){return this._volumetricLightStepsCount},set:function(e){this.volumetricLightPostProcess&&this.volumetricLightPostProcess.updateEffect(`#define VLS
#define NB_STEPS `+e.toFixed(1)),this._volumetricLightStepsCount=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"motionBlurSamples",{get:function(){return this._motionBlurSamples},set:function(e){this.motionBlurPostProcess&&(this._isObjectBasedMotionBlur?this.motionBlurPostProcess.motionBlurSamples=e:this.motionBlurPostProcess.updateEffect(`#define MOTION_BLUR
#define MAX_MOTION_SAMPLES `+e.toFixed(1))),this._motionBlurSamples=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"samples",{get:function(){return this._samples},set:function(e){this._samples!==e&&(this._samples=e,this._buildPipeline())},enumerable:!1,configurable:!0}),t.prototype._buildPipeline=function(){var e=this,n=this._ratio,r=this._scene;this._disposePostProcesses(),this._cameras!==null&&(this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._cameras),this._cameras=this._camerasToBeAttached.slice()),this._reset(),this._screenSpaceReflectionsEnabled&&(this.screenSpaceReflectionPostProcess=new c_("HDRPass",r,n,null,ke.a.BILINEAR_SAMPLINGMODE,r.getEngine(),!1,this._floatTextureType),this.screenSpaceReflectionPostProcess.onApplyObservable.add(function(){e._currentDepthOfFieldSource=e.screenSpaceReflectionPostProcess}),this.addEffect(new Yt(r.getEngine(),"HDRScreenSpaceReflections",function(){return e.screenSpaceReflectionPostProcess},!0))),this._basePostProcess?this.originalPostProcess=this._basePostProcess:this.originalPostProcess=new St("HDRPass","standard",[],[],n,null,ke.a.BILINEAR_SAMPLINGMODE,r.getEngine(),!1,"#define PASS_POST_PROCESS",this._floatTextureType),this.originalPostProcess.autoClear=!this.screenSpaceReflectionPostProcess,this.originalPostProcess.onApplyObservable.add(function(){e._currentDepthOfFieldSource=e.originalPostProcess}),this.addEffect(new Yt(r.getEngine(),"HDRPassPostProcess",function(){return e.originalPostProcess},!0)),this._bloomEnabled&&(this._createDownSampleX4PostProcess(r,n/4),this._createBrightPassPostProcess(r,n/4),this._createBlurPostProcesses(r,n/4,1),this._createTextureAdderPostProcess(r,n),this.textureAdderFinalPostProcess=new St("HDRDepthOfFieldSource","standard",[],[],n,null,ke.a.BILINEAR_SAMPLINGMODE,r.getEngine(),!1,"#define PASS_POST_PROCESS",g.a.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new Yt(r.getEngine(),"HDRBaseDepthOfFieldSource",function(){return e.textureAdderFinalPostProcess},!0))),this._vlsEnabled&&(this._createVolumetricLightPostProcess(r,n),this.volumetricLightFinalPostProcess=new St("HDRVLSFinal","standard",[],[],n,null,ke.a.BILINEAR_SAMPLINGMODE,r.getEngine(),!1,"#define PASS_POST_PROCESS",g.a.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new Yt(r.getEngine(),"HDRVLSFinal",function(){return e.volumetricLightFinalPostProcess},!0))),this._lensFlareEnabled&&(this._createLensFlarePostProcess(r,n),this.lensFlareFinalPostProcess=new St("HDRPostLensFlareDepthOfFieldSource","standard",[],[],n,null,ke.a.BILINEAR_SAMPLINGMODE,r.getEngine(),!1,"#define PASS_POST_PROCESS",g.a.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new Yt(r.getEngine(),"HDRPostLensFlareDepthOfFieldSource",function(){return e.lensFlareFinalPostProcess},!0))),this._hdrEnabled&&(this._createLuminancePostProcesses(r,this._floatTextureType),this._createHdrPostProcess(r,n),this.hdrFinalPostProcess=new St("HDRPostHDReDepthOfFieldSource","standard",[],[],n,null,ke.a.BILINEAR_SAMPLINGMODE,r.getEngine(),!1,"#define PASS_POST_PROCESS",g.a.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new Yt(r.getEngine(),"HDRPostHDReDepthOfFieldSource",function(){return e.hdrFinalPostProcess},!0))),this._depthOfFieldEnabled&&(this._createBlurPostProcesses(r,n/2,3,"depthOfFieldBlurWidth"),this._createDepthOfFieldPostProcess(r,n)),this._motionBlurEnabled&&this._createMotionBlurPostProcess(r,n),this._fxaaEnabled&&(this.fxaaPostProcess=new Al("fxaa",1,null,ke.a.BILINEAR_SAMPLINGMODE,r.getEngine(),!1,g.a.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new Yt(r.getEngine(),"HDRFxaa",function(){return e.fxaaPostProcess},!0))),this._cameras!==null&&this._scene.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(this._name,this._cameras),!this._enableMSAAOnFirstPostProcess(this._samples)&&this._samples>1&&_.a.Warn("MSAA failed to enable, MSAA is only supported in browsers that support webGL >= 2.0")},t.prototype._createDownSampleX4PostProcess=function(e,n){var r=this,o=new Array(32);this.downSampleX4PostProcess=new St("HDRDownSampleX4","standard",["dsOffsets"],[],n,null,ke.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,"#define DOWN_SAMPLE_X4",this._floatTextureType),this.downSampleX4PostProcess.onApply=function(u){for(var f=0,v=r.downSampleX4PostProcess.width,y=r.downSampleX4PostProcess.height,D=-2;D<2;D++)for(var w=-2;w<2;w++)o[f]=(D+.5)*(1/v),o[f+1]=(w+.5)*(1/y),f+=2;u.setArray2("dsOffsets",o)},this.addEffect(new Yt(e.getEngine(),"HDRDownSampleX4",function(){return r.downSampleX4PostProcess},!0))},t.prototype._createBrightPassPostProcess=function(e,n){var r=this,o=new Array(8);this.brightPassPostProcess=new St("HDRBrightPass","standard",["dsOffsets","brightThreshold"],[],n,null,ke.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,"#define BRIGHT_PASS",this._floatTextureType),this.brightPassPostProcess.onApply=function(u){var f=1/r.brightPassPostProcess.width,v=1/r.brightPassPostProcess.height;o[0]=-.5*f,o[1]=.5*v,o[2]=.5*f,o[3]=.5*v,o[4]=-.5*f,o[5]=-.5*v,o[6]=.5*f,o[7]=-.5*v,u.setArray2("dsOffsets",o),u.setFloat("brightThreshold",r.brightThreshold)},this.addEffect(new Yt(e.getEngine(),"HDRBrightPass",function(){return r.brightPassPostProcess},!0))},t.prototype._createBlurPostProcesses=function(e,n,r,o){var u=this;o===void 0&&(o="blurWidth");var f=e.getEngine(),v=new ar("HDRBlurH_"+r,new d.d(1,0),this[o],n,null,ke.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,this._floatTextureType),y=new ar("HDRBlurV_"+r,new d.d(0,1),this[o],n,null,ke.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,this._floatTextureType);v.onActivateObservable.add(function(){var D=v.width/f.getRenderWidth();v.kernel=u[o]*D}),y.onActivateObservable.add(function(){var D=y.height/f.getRenderHeight();y.kernel=u.horizontalBlur?64*D:u[o]*D}),this.addEffect(new Yt(e.getEngine(),"HDRBlurH"+r,function(){return v},!0)),this.addEffect(new Yt(e.getEngine(),"HDRBlurV"+r,function(){return y},!0)),this.blurHPostProcesses.push(v),this.blurVPostProcesses.push(y)},t.prototype._createTextureAdderPostProcess=function(e,n){var r=this;this.textureAdderPostProcess=new St("HDRTextureAdder","standard",["exposure"],["otherSampler","lensSampler"],n,null,ke.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,"#define TEXTURE_ADDER",this._floatTextureType),this.textureAdderPostProcess.onApply=function(o){o.setTextureFromPostProcess("otherSampler",r._vlsEnabled?r._currentDepthOfFieldSource:r.originalPostProcess),o.setTexture("lensSampler",r.lensTexture),o.setFloat("exposure",r._currentExposure),r._currentDepthOfFieldSource=r.textureAdderFinalPostProcess},this.addEffect(new Yt(e.getEngine(),"HDRTextureAdder",function(){return r.textureAdderPostProcess},!0))},t.prototype._createVolumetricLightPostProcess=function(e,n){var r=this,o=e.enableGeometryBufferRenderer();o.enablePosition=!0;var u=o.getGBuffer();this.volumetricLightPostProcess=new St("HDRVLS","standard",["shadowViewProjection","cameraPosition","sunDirection","sunColor","scatteringCoefficient","scatteringPower","depthValues"],["shadowMapSampler","positionSampler"],n/8,null,ke.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,`#define VLS
#define NB_STEPS `+this._volumetricLightStepsCount.toFixed(1));var f=d.d.Zero();this.volumetricLightPostProcess.onApply=function(v){if(r.sourceLight&&r.sourceLight.getShadowGenerator()&&r._scene.activeCamera){var y=r.sourceLight.getShadowGenerator();v.setTexture("shadowMapSampler",y.getShadowMap()),v.setTexture("positionSampler",u.textures[2]),v.setColor3("sunColor",r.sourceLight.diffuse),v.setVector3("sunDirection",r.sourceLight.getShadowDirection()),v.setVector3("cameraPosition",r._scene.activeCamera.globalPosition),v.setMatrix("shadowViewProjection",y.getTransformMatrix()),v.setFloat("scatteringCoefficient",r.volumetricLightCoefficient),v.setFloat("scatteringPower",r.volumetricLightPower),f.x=r.sourceLight.getDepthMinZ(r._scene.activeCamera),f.y=r.sourceLight.getDepthMaxZ(r._scene.activeCamera),v.setVector2("depthValues",f)}},this.addEffect(new Yt(e.getEngine(),"HDRVLS",function(){return r.volumetricLightPostProcess},!0)),this._createBlurPostProcesses(e,n/4,0,"volumetricLightBlurScale"),this.volumetricLightMergePostProces=new St("HDRVLSMerge","standard",[],["originalSampler"],n,null,ke.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,"#define VLSMERGE"),this.volumetricLightMergePostProces.onApply=function(v){v.setTextureFromPostProcess("originalSampler",r._bloomEnabled?r.textureAdderFinalPostProcess:r.originalPostProcess),r._currentDepthOfFieldSource=r.volumetricLightFinalPostProcess},this.addEffect(new Yt(e.getEngine(),"HDRVLSMerge",function(){return r.volumetricLightMergePostProces},!0))},t.prototype._createLuminancePostProcesses=function(e,n){var r=this,o=Math.pow(3,t.LuminanceSteps);this.luminancePostProcess=new St("HDRLuminance","standard",["lumOffsets"],[],{width:o,height:o},null,ke.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,"#define LUMINANCE",n);var u=[];this.luminancePostProcess.onApply=function(w){var F=1/r.luminancePostProcess.width,z=1/r.luminancePostProcess.height;u[0]=-.5*F,u[1]=.5*z,u[2]=.5*F,u[3]=.5*z,u[4]=-.5*F,u[5]=-.5*z,u[6]=.5*F,u[7]=-.5*z,w.setArray2("lumOffsets",u)},this.addEffect(new Yt(e.getEngine(),"HDRLuminance",function(){return r.luminancePostProcess},!0));for(var f=t.LuminanceSteps-1;f>=0;f--){o=Math.pow(3,f);var v=`#define LUMINANCE_DOWN_SAMPLE
`;f===0&&(v+="#define FINAL_DOWN_SAMPLER");var y=new St("HDRLuminanceDownSample"+f,"standard",["dsOffsets","halfDestPixelSize"],[],{width:o,height:o},null,ke.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,v,n);this.luminanceDownSamplePostProcesses.push(y)}var D=this.luminancePostProcess;this.luminanceDownSamplePostProcesses.forEach(function(w,F){var z=new Array(18);w.onApply=function(k){if(D){for(var K=0,oe=-1;oe<2;oe++)for(var ae=-1;ae<2;ae++)z[K]=oe/D.width,z[K+1]=ae/D.height,K+=2;k.setArray2("dsOffsets",z),k.setFloat("halfDestPixelSize",.5/D.width),D=F===r.luminanceDownSamplePostProcesses.length-1?r.luminancePostProcess:w}},F===r.luminanceDownSamplePostProcesses.length-1&&(w.onAfterRender=function(){var k=e.getEngine().readPixels(0,0,1,1),K=new d.f(1/16581375,1/65025,1/255,1);r._hdrCurrentLuminance=(k[0]*K.x+k[1]*K.y+k[2]*K.z+k[3]*K.w)/100}),r.addEffect(new Yt(e.getEngine(),"HDRLuminanceDownSample"+F,function(){return w},!0))})},t.prototype._createHdrPostProcess=function(e,n){var r=this,o=["#define HDR"];this._hdrAutoExposure&&o.push("#define AUTO_EXPOSURE"),this.hdrPostProcess=new St("HDR","standard",["averageLuminance"],["textureAdderSampler"],n,null,ke.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,o.join(`
`),g.a.TEXTURETYPE_UNSIGNED_INT);var u=1,f=0,v=0;this.hdrPostProcess.onApply=function(y){if(y.setTextureFromPostProcess("textureAdderSampler",r._currentDepthOfFieldSource),f+=e.getEngine().getDeltaTime(),u<0)u=r._hdrCurrentLuminance;else{var D=(v-f)/1e3;r._hdrCurrentLuminance<u+r.hdrDecreaseRate*D?u+=r.hdrDecreaseRate*D:r._hdrCurrentLuminance>u-r.hdrIncreaseRate*D?u-=r.hdrIncreaseRate*D:u=r._hdrCurrentLuminance}r.hdrAutoExposure?r._currentExposure=r._fixedExposure/u:(u=te.a.Clamp(u,r.hdrMinimumLuminance,1e20),y.setFloat("averageLuminance",u)),v=f,r._currentDepthOfFieldSource=r.hdrFinalPostProcess},this.addEffect(new Yt(e.getEngine(),"HDR",function(){return r.hdrPostProcess},!0))},t.prototype._createLensFlarePostProcess=function(e,n){var r=this;this.lensFlarePostProcess=new St("HDRLensFlare","standard",["strength","ghostDispersal","haloWidth","resolution","distortionStrength"],["lensColorSampler"],n/2,null,ke.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,"#define LENS_FLARE",g.a.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new Yt(e.getEngine(),"HDRLensFlare",function(){return r.lensFlarePostProcess},!0)),this._createBlurPostProcesses(e,n/4,2,"lensFlareBlurWidth"),this.lensFlareComposePostProcess=new St("HDRLensFlareCompose","standard",["lensStarMatrix"],["otherSampler","lensDirtSampler","lensStarSampler"],n,null,ke.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,"#define LENS_FLARE_COMPOSE",g.a.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new Yt(e.getEngine(),"HDRLensFlareCompose",function(){return r.lensFlareComposePostProcess},!0));var o=new d.d(0,0);this.lensFlarePostProcess.onApply=function(v){v.setTextureFromPostProcess("textureSampler",r._bloomEnabled?r.blurHPostProcesses[0]:r.originalPostProcess),v.setTexture("lensColorSampler",r.lensColorTexture),v.setFloat("strength",r.lensFlareStrength),v.setFloat("ghostDispersal",r.lensFlareGhostDispersal),v.setFloat("haloWidth",r.lensFlareHaloWidth),o.x=r.lensFlarePostProcess.width,o.y=r.lensFlarePostProcess.height,v.setVector2("resolution",o),v.setFloat("distortionStrength",r.lensFlareDistortionStrength)};var u=d.a.FromValues(2,0,-1,0,0,2,-1,0,0,0,1,0,0,0,0,1),f=d.a.FromValues(.5,0,.5,0,0,.5,.5,0,0,0,1,0,0,0,0,1);this.lensFlareComposePostProcess.onApply=function(v){if(r._scene.activeCamera){v.setTextureFromPostProcess("otherSampler",r.lensFlarePostProcess),v.setTexture("lensDirtSampler",r.lensFlareDirtTexture),v.setTexture("lensStarSampler",r.lensStarTexture);var y=r._scene.activeCamera.getViewMatrix().getRow(0),D=r._scene.activeCamera.getViewMatrix().getRow(2),w=d.e.Dot(y.toVector3(),new d.e(1,0,0))+d.e.Dot(D.toVector3(),new d.e(0,0,1));w*=4;var F=d.a.FromValues(.5*Math.cos(w),-Math.sin(w),0,0,Math.sin(w),.5*Math.cos(w),0,0,0,0,1,0,0,0,0,1),z=f.multiply(F).multiply(u);v.setMatrix("lensStarMatrix",z),r._currentDepthOfFieldSource=r.lensFlareFinalPostProcess}}},t.prototype._createDepthOfFieldPostProcess=function(e,n){var r=this;this.depthOfFieldPostProcess=new St("HDRDepthOfField","standard",["distance"],["otherSampler","depthSampler"],n,null,ke.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,"#define DEPTH_OF_FIELD",g.a.TEXTURETYPE_UNSIGNED_INT),this.depthOfFieldPostProcess.onApply=function(o){o.setTextureFromPostProcess("otherSampler",r._currentDepthOfFieldSource),o.setTexture("depthSampler",r._getDepthTexture()),o.setFloat("distance",r.depthOfFieldDistance)},this.addEffect(new Yt(e.getEngine(),"HDRDepthOfField",function(){return r.depthOfFieldPostProcess},!0))},t.prototype._createMotionBlurPostProcess=function(e,n){var r=this;if(this._isObjectBasedMotionBlur){var o=new a_("HDRMotionBlur",e,n,null,ke.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,g.a.TEXTURETYPE_UNSIGNED_INT);o.motionStrength=this.motionStrength,o.motionBlurSamples=this.motionBlurSamples,this.motionBlurPostProcess=o}else{this.motionBlurPostProcess=new St("HDRMotionBlur","standard",["inverseViewProjection","prevViewProjection","screenSize","motionScale","motionStrength"],["depthSampler"],n,null,ke.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,`#define MOTION_BLUR
#define MAX_MOTION_SAMPLES `+this.motionBlurSamples.toFixed(1),g.a.TEXTURETYPE_UNSIGNED_INT);var u=0,f=d.a.Identity(),v=d.a.Identity(),y=d.a.Identity(),D=d.d.Zero();this.motionBlurPostProcess.onApply=function(w){(y=e.getProjectionMatrix().multiply(e.getViewMatrix())).invertToRef(v),w.setMatrix("inverseViewProjection",v),w.setMatrix("prevViewProjection",f),f=y,D.x=r.motionBlurPostProcess.width,D.y=r.motionBlurPostProcess.height,w.setVector2("screenSize",D),u=e.getEngine().getFps()/60,w.setFloat("motionScale",u),w.setFloat("motionStrength",r.motionStrength),w.setTexture("depthSampler",r._getDepthTexture())}}this.addEffect(new Yt(e.getEngine(),"HDRMotionBlur",function(){return r.motionBlurPostProcess},!0))},t.prototype._getDepthTexture=function(){return this._scene.getEngine().getCaps().drawBuffersExtension?this._scene.enableGeometryBufferRenderer().getGBuffer().textures[0]:this._scene.enableDepthRenderer().getDepthMap()},t.prototype._disposePostProcesses=function(){for(var e=0;e<this._cameras.length;e++){var n=this._cameras[e];this.originalPostProcess&&this.originalPostProcess.dispose(n),this.screenSpaceReflectionPostProcess&&this.screenSpaceReflectionPostProcess.dispose(n),this.downSampleX4PostProcess&&this.downSampleX4PostProcess.dispose(n),this.brightPassPostProcess&&this.brightPassPostProcess.dispose(n),this.textureAdderPostProcess&&this.textureAdderPostProcess.dispose(n),this.volumetricLightPostProcess&&this.volumetricLightPostProcess.dispose(n),this.volumetricLightSmoothXPostProcess&&this.volumetricLightSmoothXPostProcess.dispose(n),this.volumetricLightSmoothYPostProcess&&this.volumetricLightSmoothYPostProcess.dispose(n),this.volumetricLightMergePostProces&&this.volumetricLightMergePostProces.dispose(n),this.volumetricLightFinalPostProcess&&this.volumetricLightFinalPostProcess.dispose(n),this.lensFlarePostProcess&&this.lensFlarePostProcess.dispose(n),this.lensFlareComposePostProcess&&this.lensFlareComposePostProcess.dispose(n);for(var r=0;r<this.luminanceDownSamplePostProcesses.length;r++)this.luminanceDownSamplePostProcesses[r].dispose(n);for(this.luminancePostProcess&&this.luminancePostProcess.dispose(n),this.hdrPostProcess&&this.hdrPostProcess.dispose(n),this.hdrFinalPostProcess&&this.hdrFinalPostProcess.dispose(n),this.depthOfFieldPostProcess&&this.depthOfFieldPostProcess.dispose(n),this.motionBlurPostProcess&&this.motionBlurPostProcess.dispose(n),this.fxaaPostProcess&&this.fxaaPostProcess.dispose(n),r=0;r<this.blurHPostProcesses.length;r++)this.blurHPostProcesses[r].dispose(n);for(r=0;r<this.blurVPostProcesses.length;r++)this.blurVPostProcesses[r].dispose(n)}this.originalPostProcess=null,this.downSampleX4PostProcess=null,this.brightPassPostProcess=null,this.textureAdderPostProcess=null,this.textureAdderFinalPostProcess=null,this.volumetricLightPostProcess=null,this.volumetricLightSmoothXPostProcess=null,this.volumetricLightSmoothYPostProcess=null,this.volumetricLightMergePostProces=null,this.volumetricLightFinalPostProcess=null,this.lensFlarePostProcess=null,this.lensFlareComposePostProcess=null,this.luminancePostProcess=null,this.hdrPostProcess=null,this.hdrFinalPostProcess=null,this.depthOfFieldPostProcess=null,this.motionBlurPostProcess=null,this.fxaaPostProcess=null,this.screenSpaceReflectionPostProcess=null,this.luminanceDownSamplePostProcesses=[],this.blurHPostProcesses=[],this.blurVPostProcesses=[]},t.prototype.dispose=function(){this._disposePostProcesses(),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._cameras),i.prototype.dispose.call(this)},t.prototype.serialize=function(){var e=B.a.Serialize(this);return this.sourceLight&&(e.sourceLightId=this.sourceLight.id),this.screenSpaceReflectionPostProcess&&(e.screenSpaceReflectionPostProcess=B.a.Serialize(this.screenSpaceReflectionPostProcess)),e.customType="StandardRenderingPipeline",e},t.Parse=function(e,n,r){var o=B.a.Parse(function(){return new t(e._name,n,e._ratio)},e,n,r);return e.sourceLightId&&(o.sourceLight=n.getLightByID(e.sourceLightId)),e.screenSpaceReflectionPostProcess&&B.a.Parse(function(){return o.screenSpaceReflectionPostProcess},e.screenSpaceReflectionPostProcess,n,r),o},t.LuminanceSteps=6,Object(p.c)([Object(B.c)()],t.prototype,"brightThreshold",void 0),Object(p.c)([Object(B.c)()],t.prototype,"blurWidth",void 0),Object(p.c)([Object(B.c)()],t.prototype,"horizontalBlur",void 0),Object(p.c)([Object(B.c)()],t.prototype,"exposure",null),Object(p.c)([Object(B.m)("lensTexture")],t.prototype,"lensTexture",void 0),Object(p.c)([Object(B.c)()],t.prototype,"volumetricLightCoefficient",void 0),Object(p.c)([Object(B.c)()],t.prototype,"volumetricLightPower",void 0),Object(p.c)([Object(B.c)()],t.prototype,"volumetricLightBlurScale",void 0),Object(p.c)([Object(B.c)()],t.prototype,"hdrMinimumLuminance",void 0),Object(p.c)([Object(B.c)()],t.prototype,"hdrDecreaseRate",void 0),Object(p.c)([Object(B.c)()],t.prototype,"hdrIncreaseRate",void 0),Object(p.c)([Object(B.c)()],t.prototype,"hdrAutoExposure",null),Object(p.c)([Object(B.m)("lensColorTexture")],t.prototype,"lensColorTexture",void 0),Object(p.c)([Object(B.c)()],t.prototype,"lensFlareStrength",void 0),Object(p.c)([Object(B.c)()],t.prototype,"lensFlareGhostDispersal",void 0),Object(p.c)([Object(B.c)()],t.prototype,"lensFlareHaloWidth",void 0),Object(p.c)([Object(B.c)()],t.prototype,"lensFlareDistortionStrength",void 0),Object(p.c)([Object(B.c)()],t.prototype,"lensFlareBlurWidth",void 0),Object(p.c)([Object(B.m)("lensStarTexture")],t.prototype,"lensStarTexture",void 0),Object(p.c)([Object(B.m)("lensFlareDirtTexture")],t.prototype,"lensFlareDirtTexture",void 0),Object(p.c)([Object(B.c)()],t.prototype,"depthOfFieldDistance",void 0),Object(p.c)([Object(B.c)()],t.prototype,"depthOfFieldBlurWidth",void 0),Object(p.c)([Object(B.c)()],t.prototype,"motionStrength",null),Object(p.c)([Object(B.c)()],t.prototype,"objectBasedMotionBlur",null),Object(p.c)([Object(B.c)()],t.prototype,"_ratio",void 0),Object(p.c)([Object(B.c)()],t.prototype,"BloomEnabled",null),Object(p.c)([Object(B.c)()],t.prototype,"DepthOfFieldEnabled",null),Object(p.c)([Object(B.c)()],t.prototype,"LensFlareEnabled",null),Object(p.c)([Object(B.c)()],t.prototype,"HDREnabled",null),Object(p.c)([Object(B.c)()],t.prototype,"VLSEnabled",null),Object(p.c)([Object(B.c)()],t.prototype,"MotionBlurEnabled",null),Object(p.c)([Object(B.c)()],t.prototype,"fxaaEnabled",null),Object(p.c)([Object(B.c)()],t.prototype,"screenSpaceReflectionsEnabled",null),Object(p.c)([Object(B.c)()],t.prototype,"volumetricLightStepsCount",null),Object(p.c)([Object(B.c)()],t.prototype,"motionBlurSamples",null),Object(p.c)([Object(B.c)()],t.prototype,"samples",null),t}(Bs);C.a.RegisteredTypes["BABYLON.StandardRenderingPipeline"]=OE;var qL=`const vec3 TWO=vec3(2.0,2.0,2.0);
varying vec2 vUV;
uniform sampler2D camASampler;
uniform sampler2D textureSampler;
uniform vec2 stepSize;
void main(void)
{
bool useCamA;
bool useCamB;
vec2 texCoord1;
vec2 texCoord2;
vec3 frag1;
vec3 frag2;
#ifdef IS_STEREOSCOPIC_HORIZ
useCamB=vUV.x>0.5;
useCamA=!useCamB;
texCoord1=vec2(useCamB ? (vUV.x-0.5)*2.0 : vUV.x*2.0,vUV.y);
texCoord2=vec2(texCoord1.x+stepSize.x,vUV.y);
#else
#ifdef IS_STEREOSCOPIC_INTERLACED
float rowNum=floor(vUV.y/stepSize.y);
useCamA=mod(rowNum,2.0) == 1.0;
useCamB=mod(rowNum,2.0) == 0.0;
texCoord1=vec2(vUV.x,vUV.y);
texCoord2=vec2(vUV.x,vUV.y);
#else
useCamB=vUV.y>0.5;
useCamA=!useCamB;
texCoord1=vec2(vUV.x,useCamB ? (vUV.y-0.5)*2.0 : vUV.y*2.0);
texCoord2=vec2(vUV.x,texCoord1.y+stepSize.y);
#endif
#endif

if (useCamB){
frag1=texture2D(textureSampler,texCoord1).rgb;
frag2=texture2D(textureSampler,texCoord2).rgb;
}else if (useCamA){
frag1=texture2D(camASampler ,texCoord1).rgb;
frag2=texture2D(camASampler ,texCoord2).rgb;
}else {
discard;
}
gl_FragColor=vec4((frag1+frag2)/TWO,1.0);
}
`;Ye.a.ShadersStore.stereoscopicInterlacePixelShader=qL;var ZL=function(i){function t(e,n,r,o,u,f,v){var y=i.call(this,e,"stereoscopicInterlace",["stepSize"],["camASampler"],1,n[1],u,f,v,o?"#define IS_STEREOSCOPIC_INTERLACED 1":r?"#define IS_STEREOSCOPIC_HORIZ 1":void 0)||this;return y._passedProcess=n[0]._rigPostProcess,y._stepSize=new d.d(1/y.width,1/y.height),y.onSizeChangedObservable.add(function(){y._stepSize=new d.d(1/y.width,1/y.height)}),y.onApplyObservable.add(function(D){D.setTextureFromPostProcess("camASampler",y._passedProcess),D.setFloat2("stepSize",y._stepSize.x,y._stepSize.y)}),y}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"StereoscopicInterlacePostProcessI"},t}(St),$L=function(i){function t(e,n,r,o,u,f){var v=i.call(this,e,"stereoscopicInterlace",["stepSize"],["camASampler"],1,n[1],o,u,f,r?"#define IS_STEREOSCOPIC_HORIZ 1":void 0)||this;return v._passedProcess=n[0]._rigPostProcess,v._stepSize=new d.d(1/v.width,1/v.height),v.onSizeChangedObservable.add(function(){v._stepSize=new d.d(1/v.width,1/v.height)}),v.onApplyObservable.add(function(y){y.setTextureFromPostProcess("camASampler",v._passedProcess),y.setFloat2("stepSize",v._stepSize.x,v._stepSize.y)}),v}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"StereoscopicInterlacePostProcess"},t}(St),JL=`
varying vec2 vUV;
uniform sampler2D textureSampler;

uniform float _ExposureAdjustment;
#if defined(HABLE_TONEMAPPING)
const float A=0.15;
const float B=0.50;
const float C=0.10;
const float D=0.20;
const float E=0.02;
const float F=0.30;
const float W=11.2;
#endif
float Luminance(vec3 c)
{
return dot(c,vec3(0.22,0.707,0.071));
}
void main(void)
{
vec3 colour=texture2D(textureSampler,vUV).rgb;
#if defined(REINHARD_TONEMAPPING)
float lum=Luminance(colour.rgb);
float lumTm=lum*_ExposureAdjustment;
float scale=lumTm/(1.0+lumTm);
colour*=scale/lum;
#elif defined(HABLE_TONEMAPPING)
colour*=_ExposureAdjustment;
const float ExposureBias=2.0;
vec3 x=ExposureBias*colour;
vec3 curr=((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;
x=vec3(W,W,W);
vec3 whiteScale=1.0/(((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F);
colour=curr*whiteScale;
#elif defined(OPTIMIZED_HEJIDAWSON_TONEMAPPING)
colour*=_ExposureAdjustment;
vec3 X=max(vec3(0.0,0.0,0.0),colour-0.004);
vec3 retColor=(X*(6.2*X+0.5))/(X*(6.2*X+1.7)+0.06);
colour=retColor*retColor;
#elif defined(PHOTOGRAPHIC_TONEMAPPING)
colour=vec3(1.0,1.0,1.0)-exp2(-_ExposureAdjustment*colour);
#endif
gl_FragColor=vec4(colour.rgb,1.0);
}`;Ye.a.ShadersStore.tonemapPixelShader=JL;var Ba;(function(i){i[i.Hable=0]="Hable",i[i.Reinhard=1]="Reinhard",i[i.HejiDawson=2]="HejiDawson",i[i.Photographic=3]="Photographic"})(Ba||(Ba={}));var eN=function(i){function t(e,n,r,o,u,f,v){u===void 0&&(u=g.a.TEXTURE_BILINEAR_SAMPLINGMODE),v===void 0&&(v=g.a.TEXTURETYPE_UNSIGNED_INT);var y=i.call(this,e,"tonemap",["_ExposureAdjustment"],null,1,o,u,f,!0,null,v)||this;y._operator=n,y.exposureAdjustment=r;var D="#define ";return y._operator===Ba.Hable?D+="HABLE_TONEMAPPING":y._operator===Ba.Reinhard?D+="REINHARD_TONEMAPPING":y._operator===Ba.HejiDawson?D+="OPTIMIZED_HEJIDAWSON_TONEMAPPING":y._operator===Ba.Photographic&&(D+="PHOTOGRAPHIC_TONEMAPPING"),y.updateEffect(D),y.onApply=function(w){w.setFloat("_ExposureAdjustment",y.exposureAdjustment)},y}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"TonemapPostProcess"},t}(St),tN=`uniform sampler2D textureSampler;
uniform sampler2D lightScatteringSampler;
uniform float decay;
uniform float exposure;
uniform float weight;
uniform float density;
uniform vec2 meshPositionOnScreen;
varying vec2 vUV;
void main(void) {
vec2 tc=vUV;
vec2 deltaTexCoord=(tc-meshPositionOnScreen.xy);
deltaTexCoord*=1.0/float(NUM_SAMPLES)*density;
float illuminationDecay=1.0;
vec4 color=texture2D(lightScatteringSampler,tc)*0.4;
for(int i=0; i<NUM_SAMPLES; i++) {
tc-=deltaTexCoord;
vec4 dataSample=texture2D(lightScatteringSampler,tc)*0.4;
dataSample*=illuminationDecay*weight;
color+=dataSample;
illuminationDecay*=decay;
}
vec4 realColor=texture2D(textureSampler,vUV);
gl_FragColor=((vec4((vec3(color.r,color.g,color.b)*exposure),1))+(realColor*(1.5-0.4)));
}
`;Ye.a.ShadersStore.volumetricLightScatteringPixelShader=tN;var nN=`
attribute vec3 position;
#include<bonesDeclaration>
#include<morphTargetsVertexGlobalDeclaration>
#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]

#include<instancesDeclaration>
uniform mat4 viewProjection;
uniform vec2 depthValues;
#if defined(ALPHATEST) || defined(NEED_UV)
varying vec2 vUV;
uniform mat4 diffuseMatrix;
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#endif
void main(void)
{
vec3 positionUpdated=position;
#if (defined(ALPHATEST) || defined(NEED_UV)) && defined(UV1)
vec2 uvUpdated=uv;
#endif
#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]
#include<instancesVertex>
#include<bonesVertex>
gl_Position=viewProjection*finalWorld*vec4(positionUpdated,1.0);
#if defined(ALPHATEST) || defined(BASIC_RENDER)
#ifdef UV1
vUV=vec2(diffuseMatrix*vec4(uvUpdated,1.0,0.0));
#endif
#ifdef UV2
vUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));
#endif
#endif
}
`;Ye.a.ShadersStore.volumetricLightScatteringPassVertexShader=nN;var rN=`#if defined(ALPHATEST) || defined(NEED_UV)
varying vec2 vUV;
#endif
#if defined(ALPHATEST)
uniform sampler2D diffuseSampler;
#endif
void main(void)
{
#if defined(ALPHATEST)
vec4 diffuseColor=texture2D(diffuseSampler,vUV);
if (diffuseColor.a<0.4)
discard;
#endif
gl_FragColor=vec4(0.0,0.0,0.0,1.0);
}
`;Ye.a.ShadersStore.volumetricLightScatteringPassPixelShader=rN;var ME=function(i){function t(e,n,r,o,u,f,v,y,D){u===void 0&&(u=100),f===void 0&&(f=ke.a.BILINEAR_SAMPLINGMODE);var w=i.call(this,e,"volumetricLightScattering",["decay","exposure","weight","meshPositionOnScreen","density"],["lightScatteringSampler"],n.postProcessRatio||n,r,f,v,y,"#define NUM_SAMPLES "+u)||this;return w._screenCoordinates=d.d.Zero(),w.customMeshPosition=d.e.Zero(),w.useCustomMeshPosition=!1,w.invert=!0,w.excludedMeshes=new Array,w.exposure=.3,w.decay=.96815,w.weight=.58767,w.density=.926,v=(D=r===null?D:r.getScene()).getEngine(),w._viewPort=new li.a(0,0,1,1).toGlobal(v.getRenderWidth(),v.getRenderHeight()),w.mesh=o!==null?o:t.CreateDefaultMesh("VolumetricLightScatteringMesh",D),w._createPass(D,n.passRatio||n),w.onActivate=function(F){w.isSupported||w.dispose(F),w.onActivate=null},w.onApplyObservable.add(function(F){w._updateMeshScreenCoordinates(D),F.setTexture("lightScatteringSampler",w._volumetricLightScatteringRTT),F.setFloat("exposure",w.exposure),F.setFloat("decay",w.decay),F.setFloat("weight",w.weight),F.setFloat("density",w.density),F.setVector2("meshPositionOnScreen",w._screenCoordinates)}),w}return Object(p.d)(t,i),Object.defineProperty(t.prototype,"useDiffuseColor",{get:function(){return _.a.Warn("VolumetricLightScatteringPostProcess.useDiffuseColor is no longer used, use the mesh material directly instead"),!1},set:function(e){_.a.Warn("VolumetricLightScatteringPostProcess.useDiffuseColor is no longer used, use the mesh material directly instead")},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"VolumetricLightScatteringPostProcess"},t.prototype._isReady=function(e,n){var r=e.getMesh();if(r===this.mesh&&r.material)return r.material.isReady(r);var o=[],u=[De.b.PositionKind],f=e.getMaterial();f&&(f.needAlphaTesting()&&o.push("#define ALPHATEST"),r.isVerticesDataPresent(De.b.UVKind)&&(u.push(De.b.UVKind),o.push("#define UV1")),r.isVerticesDataPresent(De.b.UV2Kind)&&(u.push(De.b.UV2Kind),o.push("#define UV2"))),r.useBones&&r.computeBonesUsingShaders?(u.push(De.b.MatricesIndicesKind),u.push(De.b.MatricesWeightsKind),o.push("#define NUM_BONE_INFLUENCERS "+r.numBoneInfluencers),o.push("#define BonesPerMesh "+(r.skeleton?r.skeleton.bones.length+1:0))):o.push("#define NUM_BONE_INFLUENCERS 0"),n&&(o.push("#define INSTANCES"),lt.a.PushAttributesForInstances(u),e.getRenderingMesh().hasThinInstances&&o.push("#define THIN_INSTANCES"));var v=o.join(`
`);return this._cachedDefines!==v&&(this._cachedDefines=v,this._volumetricLightScatteringPass=r.getScene().getEngine().createEffect("volumetricLightScatteringPass",u,["world","mBones","viewProjection","diffuseMatrix"],["diffuseSampler"],v,void 0,void 0,void 0,{maxSimultaneousMorphTargets:r.numBoneInfluencers})),this._volumetricLightScatteringPass.isReady()},t.prototype.setCustomMeshPosition=function(e){this.customMeshPosition=e},t.prototype.getCustomMeshPosition=function(){return this.customMeshPosition},t.prototype.dispose=function(e){var n=e.getScene().customRenderTargets.indexOf(this._volumetricLightScatteringRTT);n!==-1&&e.getScene().customRenderTargets.splice(n,1),this._volumetricLightScatteringRTT.dispose(),i.prototype.dispose.call(this,e)},t.prototype.getPass=function(){return this._volumetricLightScatteringRTT},t.prototype._meshExcluded=function(e){return this.excludedMeshes.length>0&&this.excludedMeshes.indexOf(e)!==-1},t.prototype._createPass=function(e,n){var r=this,o=e.getEngine();this._volumetricLightScatteringRTT=new qn("volumetricLightScatteringMap",{width:o.getRenderWidth()*n,height:o.getRenderHeight()*n},e,!1,!0,g.a.TEXTURETYPE_UNSIGNED_INT),this._volumetricLightScatteringRTT.wrapU=ke.a.CLAMP_ADDRESSMODE,this._volumetricLightScatteringRTT.wrapV=ke.a.CLAMP_ADDRESSMODE,this._volumetricLightScatteringRTT.renderList=null,this._volumetricLightScatteringRTT.renderParticles=!1,this._volumetricLightScatteringRTT.ignoreCameraViewport=!0;var u=this.getCamera();u?u.customRenderTargets.push(this._volumetricLightScatteringRTT):e.customRenderTargets.push(this._volumetricLightScatteringRTT);var f,v=function(D){var w=D.getRenderingMesh(),F=D.getEffectiveMesh();if(!r._meshExcluded(w)){F._internalAbstractMeshDataInfo._isActiveIntermediate=!1;var z=D.getMaterial();if(z){var k=w.getScene(),K=k.getEngine();K.setState(z.backFaceCulling);var oe=w._getInstancesRenderList(D._id,!!D.getReplacementMesh());if(!oe.mustReturn){var ae=K.getCaps().instancedArrays&&(oe.visibleInstances[D._id]!==null||w.hasThinInstances);if(r._isReady(D,ae)){var ue=r._volumetricLightScatteringPass;if(w===r.mesh&&(ue=D.effect?D.effect:z.getEffect()),K.enableEffect(ue),w._bind(D,ue,z.fillMode),w===r.mesh)z.bind(F.getWorldMatrix(),w);else{if(r._volumetricLightScatteringPass.setMatrix("viewProjection",k.getTransformMatrix()),z&&z.needAlphaTesting()){var de=z.getAlphaTestTexture();r._volumetricLightScatteringPass.setTexture("diffuseSampler",de),de&&r._volumetricLightScatteringPass.setMatrix("diffuseMatrix",de.getTextureMatrix())}w.useBones&&w.computeBonesUsingShaders&&w.skeleton&&r._volumetricLightScatteringPass.setMatrices("mBones",w.skeleton.getTransformMatrices(w))}w._processRendering(F,D,r._volumetricLightScatteringPass,pn.a.TriangleFillMode,oe,ae,function(me,ye){return ue.setMatrix("world",ye)})}}}}},y=new M.b(0,0,0,1);this._volumetricLightScatteringRTT.onBeforeRenderObservable.add(function(){f=e.clearColor,e.clearColor=y}),this._volumetricLightScatteringRTT.onAfterRenderObservable.add(function(){e.clearColor=f}),this._volumetricLightScatteringRTT.customRenderFunction=function(D,w,F,z){var k,K=e.getEngine();if(z.length){for(K.setColorWrite(!1),k=0;k<z.length;k++)v(z.data[k]);K.setColorWrite(!0)}for(k=0;k<D.length;k++)v(D.data[k]);for(k=0;k<w.length;k++)v(w.data[k]);if(F.length){for(k=0;k<F.length;k++){var oe=F.data[k],ae=oe.getBoundingInfo();ae&&e.activeCamera&&(oe._alphaIndex=oe.getMesh().alphaIndex,oe._distanceToCamera=ae.boundingSphere.centerWorld.subtract(e.activeCamera.position).length())}var ue=F.data.slice(0,F.length);for(ue.sort(function(de,me){return de._alphaIndex>me._alphaIndex?1:de._alphaIndex<me._alphaIndex?-1:de._distanceToCamera<me._distanceToCamera?1:de._distanceToCamera>me._distanceToCamera?-1:0}),K.setAlphaMode(g.a.ALPHA_COMBINE),k=0;k<ue.length;k++)v(ue[k]);K.setAlphaMode(g.a.ALPHA_DISABLE)}}},t.prototype._updateMeshScreenCoordinates=function(e){var n,r=e.getTransformMatrix();n=this.useCustomMeshPosition?this.customMeshPosition:this.attachedNode?this.attachedNode.position:this.mesh.parent?this.mesh.getAbsolutePosition():this.mesh.position;var o=d.e.Project(n,d.a.Identity(),r,this._viewPort);this._screenCoordinates.x=o.x/this._viewPort.width,this._screenCoordinates.y=o.y/this._viewPort.height,this.invert&&(this._screenCoordinates.y=1-this._screenCoordinates.y)},t.CreateDefaultMesh=function(e,n){var r=Ne.a.CreatePlane(e,1,n);r.billboardMode=jt.a.BILLBOARDMODE_ALL;var o=new on.a(e+"Material",n);return o.emissiveColor=new M.a(1,1,1),r.material=o,r},Object(p.c)([Object(B.o)()],t.prototype,"customMeshPosition",void 0),Object(p.c)([Object(B.c)()],t.prototype,"useCustomMeshPosition",void 0),Object(p.c)([Object(B.c)()],t.prototype,"invert",void 0),Object(p.c)([Object(B.k)()],t.prototype,"mesh",void 0),Object(p.c)([Object(B.c)()],t.prototype,"excludedMeshes",void 0),Object(p.c)([Object(B.c)()],t.prototype,"exposure",void 0),Object(p.c)([Object(B.c)()],t.prototype,"decay",void 0),Object(p.c)([Object(B.c)()],t.prototype,"weight",void 0),Object(p.c)([Object(B.c)()],t.prototype,"density",void 0),t}(St);C.a.RegisteredTypes["BABYLON.VolumetricLightScatteringPostProcess"]=ME;var iN=`

precision highp float;

varying vec2 vUV;
uniform sampler2D textureSampler;
uniform sampler2D normalSampler;
uniform float curvature_ridge;
uniform float curvature_valley;
#ifndef CURVATURE_OFFSET
#define CURVATURE_OFFSET 1
#endif
float curvature_soft_clamp(float curvature,float control)
{
if (curvature<0.5/control)
return curvature*(1.0-curvature*control);
return 0.25/control;
}
float calculate_curvature(ivec2 texel,float ridge,float valley)
{
vec2 normal_up=texelFetchOffset(normalSampler,texel,0,ivec2(0,CURVATURE_OFFSET)).rb;
vec2 normal_down=texelFetchOffset(normalSampler,texel,0,ivec2(0,-CURVATURE_OFFSET)).rb;
vec2 normal_left=texelFetchOffset(normalSampler,texel,0,ivec2(-CURVATURE_OFFSET,0)).rb;
vec2 normal_right=texelFetchOffset(normalSampler,texel,0,ivec2( CURVATURE_OFFSET,0)).rb;
float normal_diff=((normal_up.g-normal_down.g)+(normal_right.r-normal_left.r));
if (normal_diff<0.0)
return -2.0*curvature_soft_clamp(-normal_diff,valley);
return 2.0*curvature_soft_clamp(normal_diff,ridge);
}
void main(void)
{
ivec2 texel=ivec2(gl_FragCoord.xy);
vec4 baseColor=texture2D(textureSampler,vUV);
float curvature=calculate_curvature(texel,curvature_ridge,curvature_valley);
baseColor.rgb*=curvature+1.0;
gl_FragColor=baseColor;
}`;Ye.a.ShadersStore.screenSpaceCurvaturePixelShader=iN;var IE=function(i){function t(e,n,r,o,u,f,v,y,D){y===void 0&&(y=g.a.TEXTURETYPE_UNSIGNED_INT),D===void 0&&(D=!1);var w=i.call(this,e,"screenSpaceCurvature",["curvature_ridge","curvature_valley"],["textureSampler","normalSampler"],r,o,u,f,v,void 0,y,void 0,null,D)||this;return w.ridge=1,w.valley=1,w._geometryBufferRenderer=n.enableGeometryBufferRenderer(),w._geometryBufferRenderer?w.onApply=function(F){F.setFloat("curvature_ridge",.5/Math.max(w.ridge*w.ridge,1e-4)),F.setFloat("curvature_valley",.7/Math.max(w.valley*w.valley,1e-4));var z=w._geometryBufferRenderer.getGBuffer().textures[1];F.setTexture("normalSampler",z)}:_.a.Error("Multiple Render Target support needed for screen space curvature post process. Please use IsSupported test first."),w}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"ScreenSpaceCurvaturePostProcess"},Object.defineProperty(t,"IsSupported",{get:function(){var e=ne.a.LastCreatedEngine;return!!e&&(e.webGLVersion>1||e.getCaps().drawBuffersExtension)},enumerable:!1,configurable:!0}),t._Parse=function(e,n,r,o){return B.a.Parse(function(){return new t(e.name,r,e.options,n,e.renderTargetSamplingMode,r.getEngine(),e.textureType,e.reusable)},e,r,o)},Object(p.c)([Object(B.c)()],t.prototype,"ridge",void 0),Object(p.c)([Object(B.c)()],t.prototype,"valley",void 0),t}(St);C.a.RegisteredTypes["BABYLON.ScreenSpaceCurvaturePostProcess"]=IE,c(166),c(167),Object.defineProperty(he.a.prototype,"forceShowBoundingBoxes",{get:function(){return this._forceShowBoundingBoxes||!1},set:function(i){this._forceShowBoundingBoxes=i,i&&this.getBoundingBoxRenderer()},enumerable:!0,configurable:!0}),he.a.prototype.getBoundingBoxRenderer=function(){return this._boundingBoxRenderer||(this._boundingBoxRenderer=new DE(this)),this._boundingBoxRenderer},Object.defineProperty(jt.a.prototype,"showBoundingBox",{get:function(){return this._showBoundingBox||!1},set:function(i){this._showBoundingBox=i,i&&this.getScene().getBoundingBoxRenderer()},enumerable:!0,configurable:!0});var DE=function(){function i(t){this.name=dt.a.NAME_BOUNDINGBOXRENDERER,this.frontColor=new M.a(1,1,1),this.backColor=new M.a(.1,.1,.1),this.showBackLines=!0,this.onBeforeBoxRenderingObservable=new S.c,this.onAfterBoxRenderingObservable=new S.c,this.onResourcesReadyObservable=new S.c,this.enabled=!0,this.renderList=new Hn.a(32),this._vertexBuffers={},this._fillIndexBuffer=null,this._fillIndexData=null,this.scene=t,t._addComponent(this)}return i.prototype.register=function(){this.scene._beforeEvaluateActiveMeshStage.registerStep(dt.a.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER,this,this.reset),this.scene._preActiveMeshStage.registerStep(dt.a.STEP_PREACTIVEMESH_BOUNDINGBOXRENDERER,this,this._preActiveMesh),this.scene._evaluateSubMeshStage.registerStep(dt.a.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER,this,this._evaluateSubMesh),this.scene._afterRenderingGroupDrawStage.registerStep(dt.a.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER,this,this.render)},i.prototype._evaluateSubMesh=function(t,e){if(t.showSubMeshesBoundingBox){var n=e.getBoundingInfo();n!=null&&(n.boundingBox._tag=t.renderingGroupId,this.renderList.push(n.boundingBox))}},i.prototype._preActiveMesh=function(t){if(t.showBoundingBox||this.scene.forceShowBoundingBoxes){var e=t.getBoundingInfo();e.boundingBox._tag=t.renderingGroupId,this.renderList.push(e.boundingBox)}},i.prototype._prepareResources=function(){if(!this._colorShader){this._colorShader=new Ah.a("colorShader",this.scene,"color",{attributes:[De.b.PositionKind],uniforms:["world","viewProjection","color"]}),this._colorShader.reservedDataStore={hidden:!0};var t=this.scene.getEngine(),e=Tt.a.CreateBox({size:1});this._vertexBuffers[De.b.PositionKind]=new De.b(t,e.positions,De.b.PositionKind,!1),this._createIndexBuffer(),this._fillIndexData=e.indices,this.onResourcesReadyObservable.notifyObservers(this)}},i.prototype._createIndexBuffer=function(){var t=this.scene.getEngine();this._indexBuffer=t.createIndexBuffer([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,7,1,6,2,5,3,4])},i.prototype.rebuild=function(){var t=this._vertexBuffers[De.b.PositionKind];t&&t._rebuild(),this._createIndexBuffer()},i.prototype.reset=function(){this.renderList.reset()},i.prototype.render=function(t){if(this.renderList.length!==0&&this.enabled&&(this._prepareResources(),this._colorShader.isReady())){var e=this.scene.getEngine();e.setDepthWrite(!1),this._colorShader._preBind();for(var n=0;n<this.renderList.length;n++){var r=this.renderList.data[n];if(r._tag===t){this.onBeforeBoxRenderingObservable.notifyObservers(r);var o=r.minimum,u=r.maximum.subtract(o),f=o.add(u.scale(.5)),v=d.a.Scaling(u.x,u.y,u.z).multiply(d.a.Translation(f.x,f.y,f.z)).multiply(r.getWorldMatrix());e.bindBuffers(this._vertexBuffers,this._indexBuffer,this._colorShader.getEffect()),this.showBackLines&&(e.setDepthFunctionToGreaterOrEqual(),this.scene.resetCachedMaterial(),this._colorShader.setColor4("color",this.backColor.toColor4()),this._colorShader.bind(v),e.drawElementsType(pn.a.LineListDrawMode,0,24)),e.setDepthFunctionToLess(),this.scene.resetCachedMaterial(),this._colorShader.setColor4("color",this.frontColor.toColor4()),this._colorShader.bind(v),e.drawElementsType(pn.a.LineListDrawMode,0,24),this.onAfterBoxRenderingObservable.notifyObservers(r)}}this._colorShader.unbind(),e.setDepthFunctionToLessOrEqual(),e.setDepthWrite(!0)}},i.prototype.renderOcclusionBoundingBox=function(t){if(this._prepareResources(),this._colorShader.isReady()&&t._boundingInfo){var e=this.scene.getEngine();this._fillIndexBuffer||(this._fillIndexBuffer=e.createIndexBuffer(this._fillIndexData)),e.setDepthWrite(!1),e.setColorWrite(!1),this._colorShader._preBind();var n=t._boundingInfo.boundingBox,r=n.minimum,o=n.maximum.subtract(r),u=r.add(o.scale(.5)),f=d.a.Scaling(o.x,o.y,o.z).multiply(d.a.Translation(u.x,u.y,u.z)).multiply(n.getWorldMatrix());e.bindBuffers(this._vertexBuffers,this._fillIndexBuffer,this._colorShader.getEffect()),e.setDepthFunctionToLess(),this.scene.resetCachedMaterial(),this._colorShader.bind(f),e.drawElementsType(pn.a.TriangleFillMode,0,36),this._colorShader.unbind(),e.setDepthFunctionToLessOrEqual(),e.setDepthWrite(!0),e.setColorWrite(!0)}},i.prototype.dispose=function(){if(this._colorShader){this.onBeforeBoxRenderingObservable.clear(),this.onAfterBoxRenderingObservable.clear(),this.onResourcesReadyObservable.clear(),this.renderList.dispose(),this._colorShader.dispose();var t=this._vertexBuffers[De.b.PositionKind];t&&(t.dispose(),this._vertexBuffers[De.b.PositionKind]=null),this.scene.getEngine()._releaseBuffer(this._indexBuffer),this._fillIndexBuffer&&(this.scene.getEngine()._releaseBuffer(this._fillIndexBuffer),this._fillIndexBuffer=null)}},i}();he.a.prototype.enableDepthRenderer=function(i,t,e){if(t===void 0&&(t=!1),e===void 0&&(e=!1),!(i=i||this.activeCamera))throw"No camera available to enable depth renderer";if(this._depthRenderer||(this._depthRenderer={}),!this._depthRenderer[i.id]){var n=!!this.getEngine().getCaps().textureFloatRender,r=0;r=!this.getEngine().getCaps().textureHalfFloatRender||e&&n?n?g.a.TEXTURETYPE_FLOAT:g.a.TEXTURETYPE_UNSIGNED_BYTE:g.a.TEXTURETYPE_HALF_FLOAT,this._depthRenderer[i.id]=new yh(this,r,i,t)}return this._depthRenderer[i.id]},he.a.prototype.disableDepthRenderer=function(i){(i=i||this.activeCamera)&&this._depthRenderer&&this._depthRenderer[i.id]&&(this._depthRenderer[i.id].dispose(),delete this._depthRenderer[i.id])};var wE=function(){function i(t){this.name=dt.a.NAME_DEPTHRENDERER,this.scene=t}return i.prototype.register=function(){this.scene._gatherRenderTargetsStage.registerStep(dt.a.STEP_GATHERRENDERTARGETS_DEPTHRENDERER,this,this._gatherRenderTargets),this.scene._gatherActiveCameraRenderTargetsStage.registerStep(dt.a.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER,this,this._gatherActiveCameraRenderTargets)},i.prototype.rebuild=function(){},i.prototype.dispose=function(){for(var t in this.scene._depthRenderer)this.scene._depthRenderer[t].dispose()},i.prototype._gatherRenderTargets=function(t){if(this.scene._depthRenderer)for(var e in this.scene._depthRenderer){var n=this.scene._depthRenderer[e];n.enabled&&!n.useOnlyInActiveCamera&&t.push(n.getDepthMap())}},i.prototype._gatherActiveCameraRenderTargets=function(t){if(this.scene._depthRenderer)for(var e in this.scene._depthRenderer){var n=this.scene._depthRenderer[e];n.enabled&&n.useOnlyInActiveCamera&&this.scene.activeCamera.id===e&&t.push(n.getDepthMap())}},i}();yh._SceneComponentInitialization=function(i){var t=i._getComponent(dt.a.NAME_DEPTHRENDERER);t||(t=new wE(i),i._addComponent(t))},Ye.a.ShadersStore.linePixelShader=`uniform vec4 color;
void main(void) {
gl_FragColor=color;
}`;var oN=`#include<instancesDeclaration>

attribute vec3 position;
attribute vec4 normal;

uniform mat4 viewProjection;
uniform float width;
uniform float aspectRatio;
void main(void) {
#include<instancesVertex>
mat4 worldViewProjection=viewProjection*finalWorld;
vec4 viewPosition=worldViewProjection*vec4(position,1.0);
vec4 viewPositionNext=worldViewProjection*vec4(normal.xyz,1.0);
vec2 currentScreen=viewPosition.xy/viewPosition.w;
vec2 nextScreen=viewPositionNext.xy/viewPositionNext.w;
currentScreen.x*=aspectRatio;
nextScreen.x*=aspectRatio;
vec2 dir=normalize(nextScreen-currentScreen);
vec2 normalDir=vec2(-dir.y,dir.x);
normalDir*=width/2.0;
normalDir.x/=aspectRatio;
vec4 offset=vec4(normalDir*normal.w,0.0,0.0);
gl_Position=viewPosition+offset;
}`;Ye.a.ShadersStore.lineVertexShader=oN,jt.a.prototype.disableEdgesRendering=function(){return this._edgesRenderer&&(this._edgesRenderer.dispose(),this._edgesRenderer=null),this},jt.a.prototype.enableEdgesRendering=function(i,t,e){return i===void 0&&(i=.95),t===void 0&&(t=!1),this.disableEdgesRendering(),this._edgesRenderer=new l_(this,i,t,!0,e),this},Object.defineProperty(jt.a.prototype,"edgesRenderer",{get:function(){return this._edgesRenderer},enumerable:!0,configurable:!0}),bl.b.prototype.enableEdgesRendering=function(i,t){return i===void 0&&(i=.95),t===void 0&&(t=!1),this.disableEdgesRendering(),this._edgesRenderer=new LE(this,i,t),this},bl.a.prototype.enableEdgesRendering=function(i,t){return i===void 0&&(i=.95),t===void 0&&(t=!1),bl.b.prototype.enableEdgesRendering.apply(this,arguments),this};var aN=function(){this.edges=new Array,this.edgesConnectedCount=0},l_=function(){function i(t,e,n,r,o){var u,f=this;e===void 0&&(e=.95),n===void 0&&(n=!1),r===void 0&&(r=!0),this.edgesWidthScalerForOrthographic=1e3,this.edgesWidthScalerForPerspective=50,this._linesPositions=new Array,this._linesNormals=new Array,this._linesIndices=new Array,this._buffers={},this._buffersForInstances={},this._checkVerticesInsteadOfIndices=!1,this.isEnabled=!0,this.customInstances=new Hn.a(32),this._source=t,this._checkVerticesInsteadOfIndices=n,this._options=o??null,this._epsilon=e,this._prepareRessources(),r&&((u=o==null?void 0:o.useAlternateEdgeFinder)===null||u===void 0||u?this._generateEdgesLinesAlternate():this._generateEdgesLines()),this._meshRebuildObserver=this._source.onRebuildObservable.add(function(){f._rebuild()}),this._meshDisposeObserver=this._source.onDisposeObservable.add(function(){f.dispose()})}return Object.defineProperty(i.prototype,"linesPositions",{get:function(){return this._linesPositions},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"linesNormals",{get:function(){return this._linesNormals},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"linesIndices",{get:function(){return this._linesIndices},enumerable:!1,configurable:!0}),i.GetShader=function(t){if(!t._edgeRenderLineShader){var e=new Ah.a("lineShader",t,"line",{attributes:["position","normal"],uniforms:["world","viewProjection","color","width","aspectRatio"]});e.disableDepthWrite=!0,e.backFaceCulling=!1,t._edgeRenderLineShader=e}return t._edgeRenderLineShader},i.prototype._prepareRessources=function(){this._lineShader||(this._lineShader=i.GetShader(this._source.getScene()))},i.prototype._rebuild=function(){var t=this._buffers[De.b.PositionKind];t&&t._rebuild(),(t=this._buffers[De.b.NormalKind])&&t._rebuild();var e=this._source.getScene().getEngine();this._ib=e.createIndexBuffer(this._linesIndices)},i.prototype.dispose=function(){this._source.onRebuildObservable.remove(this._meshRebuildObserver),this._source.onDisposeObservable.remove(this._meshDisposeObserver);var t=this._buffers[De.b.PositionKind];t&&(t.dispose(),this._buffers[De.b.PositionKind]=null),(t=this._buffers[De.b.NormalKind])&&(t.dispose(),this._buffers[De.b.NormalKind]=null),this._ib&&this._source.getScene().getEngine()._releaseBuffer(this._ib),this._lineShader.dispose()},i.prototype._processEdgeForAdjacencies=function(t,e,n,r,o){return t===n&&e===r||t===r&&e===n?0:t===r&&e===o||t===o&&e===r?1:t===o&&e===n||t===n&&e===o?2:-1},i.prototype._processEdgeForAdjacenciesWithVertices=function(t,e,n,r,o){var u=1e-10;return t.equalsWithEpsilon(n,u)&&e.equalsWithEpsilon(r,u)||t.equalsWithEpsilon(r,u)&&e.equalsWithEpsilon(n,u)?0:t.equalsWithEpsilon(r,u)&&e.equalsWithEpsilon(o,u)||t.equalsWithEpsilon(o,u)&&e.equalsWithEpsilon(r,u)?1:t.equalsWithEpsilon(o,u)&&e.equalsWithEpsilon(n,u)||t.equalsWithEpsilon(n,u)&&e.equalsWithEpsilon(o,u)?2:-1},i.prototype._checkEdge=function(t,e,n,r,o){var u;e===void 0?u=!0:u=d.e.Dot(n[t],n[e])<this._epsilon,u&&this.createLine(r,o,this._linesPositions.length/3)},i.prototype.createLine=function(t,e,n){this._linesPositions.push(t.x,t.y,t.z,t.x,t.y,t.z,e.x,e.y,e.z,e.x,e.y,e.z),this._linesNormals.push(e.x,e.y,e.z,-1,e.x,e.y,e.z,1,t.x,t.y,t.z,-1,t.x,t.y,t.z,1),this._linesIndices.push(n,n+1,n+2,n,n+2,n+3)},i.prototype._tessellateTriangle=function(t,e,n,r){var o=function(Re,Pe,Ce){Ce>=0&&Pe.push(Ce);for(var Be=0;Be<Re.length;++Be)Pe.push(Re[Be][0])},u=0;t[1].length>=t[0].length&&t[1].length>=t[2].length?u=1:t[2].length>=t[0].length&&t[2].length>=t[1].length&&(u=2);for(var f=0;f<3;++f)f===u?t[f].sort(function(Re,Pe){return Re[1]<Pe[1]?-1:Re[1]>Pe[1]?1:0}):t[f].sort(function(Re,Pe){return Re[1]>Pe[1]?-1:Re[1]<Pe[1]?1:0});var v=[],y=[];o(t[u],v,-1);for(var D=v.length,w=u+2;w>=u+1;--w)o(t[w%3],y,w!==u+2?r[n[e+(w+1)%3]]:-1);var F=y.length;n.push(r[n[e+u]],v[0],y[0]),n.push(r[n[e+(u+1)%3]],y[F-1],v[D-1]);for(var z=D<=F,k=z?D:F,K=z?F:D,oe=z?D-1:F-1,ae=z?0:1,ue=D+F-2,de=0,me=0,ye=z?v:y,Ee=z?y:v,Ae=0;ue-- >0;){ae?n.push(ye[de],Ee[me]):n.push(Ee[me],ye[de]);var Ie=void 0;(Ae+=k)>=K&&de<oe?(Ie=ye[++de],Ae-=K):Ie=Ee[++me],n.push(Ie)}n[e+0]=n[n.length-3],n[e+1]=n[n.length-2],n[e+2]=n[n.length-1],n.length=n.length-3},i.prototype._generateEdgesLinesAlternate=function(){var t,e,n,r,o,u,f,v,y,D=this._source.getVerticesData(De.b.PositionKind),w=this._source.getIndices();if(w&&D){Array.isArray(w)||(w=et.b.SliceToArray(w));var F=(e=(t=this._options)===null||t===void 0?void 0:t.useFastVertexMerger)===null||e===void 0||e,z=F?Math.round(-Math.log((r=(n=this._options)===null||n===void 0?void 0:n.epsilonVertexMerge)!==null&&r!==void 0?r:1e-6)/Math.log(10)):(u=(o=this._options)===null||o===void 0?void 0:o.epsilonVertexMerge)!==null&&u!==void 0?u:1e-6,k=[],K=[];if(F)for(var oe={},ae=0;ae<D.length;ae+=3){var ue=D[ae+0],de=D[ae+1],me=D[ae+2];if(oe[Kt=ue.toFixed(z)+"|"+de.toFixed(z)+"|"+me.toFixed(z)]!==void 0)k.push(oe[Kt]);else{var ye=ae/3;oe[Kt]=ye,k.push(ye),K.push(ye)}}else for(ae=0;ae<D.length;ae+=3){ue=D[ae+0],de=D[ae+1],me=D[ae+2];for(var Ee=!1,Ae=0;Ae<ae&&!Ee;Ae+=3){var Ie=D[Ae+0],Re=D[Ae+1],Pe=D[Ae+2];if(Math.abs(ue-Ie)<z&&Math.abs(de-Re)<z&&Math.abs(me-Pe)<z){k.push(Ae/3),Ee=!0;break}}Ee||(k.push(ae/3),K.push(ae/3))}if((f=this._options)===null||f===void 0?void 0:f.applyTessellation){for(var Ce=(y=(v=this._options)===null||v===void 0?void 0:v.epsilonVertexAligned)!==null&&y!==void 0?y:1e-6,Be=[],Oe=0;Oe<w.length;Oe+=3)for(var Ve=void 0,Le=0;Le<3;++Le){var je=k[w[Oe+Le]],tt=k[w[Oe+(Le+1)%3]],ut=k[w[Oe+(Le+2)%3]];if(je!==tt)for(var ft=D[3*je+0],vt=D[3*je+1],rt=D[3*je+2],mt=D[3*tt+0],pt=D[3*tt+1],it=D[3*tt+2],yt=Math.sqrt((mt-ft)*(mt-ft)+(pt-vt)*(pt-vt)+(it-rt)*(it-rt)),He=0;He<K.length-1;He++){var at=K[He];if(at!==je&&at!==tt&&at!==ut){var It=D[3*at+0],vn=D[3*at+1],Jt=D[3*at+2],Sn=Math.sqrt((It-ft)*(It-ft)+(vn-vt)*(vn-vt)+(Jt-rt)*(Jt-rt)),Rt=Math.sqrt((It-mt)*(It-mt)+(vn-pt)*(vn-pt)+(Jt-it)*(Jt-it));Math.abs(Sn+Rt-yt)<Ce&&(Ve||(Ve={index:Oe,edgesPoints:[[],[],[]]},Be.push(Ve)),Ve.edgesPoints[Le].push([at,Sn]))}}}for(var Rn=0;Rn<Be.length;++Rn){var bn=Be[Rn];this._tessellateTriangle(bn.edgesPoints,bn.index,w,k)}Be=null}var hn={};for(Oe=0;Oe<w.length;Oe+=3){var yn=void 0;for(Le=0;Le<3;++Le)if(je=k[w[Oe+Le]],tt=k[w[Oe+(Le+1)%3]],ut=k[w[Oe+(Le+2)%3]],je!==tt){if(d.c.Vector3[0].copyFromFloats(D[3*je+0],D[3*je+1],D[3*je+2]),d.c.Vector3[1].copyFromFloats(D[3*tt+0],D[3*tt+1],D[3*tt+2]),d.c.Vector3[2].copyFromFloats(D[3*ut+0],D[3*ut+1],D[3*ut+2]),yn||(d.c.Vector3[1].subtractToRef(d.c.Vector3[0],d.c.Vector3[3]),d.c.Vector3[2].subtractToRef(d.c.Vector3[1],d.c.Vector3[4]),(yn=d.e.Cross(d.c.Vector3[3],d.c.Vector3[4])).normalize()),je>tt){var Lt=je;je=tt,tt=Lt}(In=hn[Kt=je+"_"+tt])?In.done||(d.e.Dot(yn,In.normal)<this._epsilon&&this.createLine(d.c.Vector3[0],d.c.Vector3[1],this._linesPositions.length/3),In.done=!0):hn[Kt]={normal:yn,done:!1,index:Oe,i:Le}}}for(var Kt in hn){var In;(In=hn[Kt]).done||(je=k[w[In.index+In.i]],tt=k[w[In.index+(In.i+1)%3]],d.c.Vector3[0].copyFromFloats(D[3*je+0],D[3*je+1],D[3*je+2]),d.c.Vector3[1].copyFromFloats(D[3*tt+0],D[3*tt+1],D[3*tt+2]),this.createLine(d.c.Vector3[0],d.c.Vector3[1],this._linesPositions.length/3))}var Lr=this._source.getScene().getEngine();this._buffers[De.b.PositionKind]=new De.b(Lr,this._linesPositions,De.b.PositionKind,!1),this._buffers[De.b.NormalKind]=new De.b(Lr,this._linesNormals,De.b.NormalKind,!1,!1,4),this._buffersForInstances[De.b.PositionKind]=this._buffers[De.b.PositionKind],this._buffersForInstances[De.b.NormalKind]=this._buffers[De.b.NormalKind],this._ib=Lr.createIndexBuffer(this._linesIndices),this._indicesCount=this._linesIndices.length}},i.prototype._generateEdgesLines=function(){var t=this._source.getVerticesData(De.b.PositionKind),e=this._source.getIndices();if(e&&t){var n,r,o=new Array,u=new Array;for(n=0;n<e.length;n+=3){r=new aN;var f=e[n],v=e[n+1],y=e[n+2];r.p0=new d.e(t[3*f],t[3*f+1],t[3*f+2]),r.p1=new d.e(t[3*v],t[3*v+1],t[3*v+2]),r.p2=new d.e(t[3*y],t[3*y+1],t[3*y+2]);var D=d.e.Cross(r.p1.subtract(r.p0),r.p2.subtract(r.p1));D.normalize(),u.push(D),o.push(r)}for(n=0;n<o.length;n++){r=o[n];for(var w=n+1;w<o.length;w++){var F=o[w];if(r.edgesConnectedCount===3)break;if(F.edgesConnectedCount!==3)for(var z=e[3*w],k=e[3*w+1],K=e[3*w+2],oe=0;oe<3;oe++){var ae=0;if(r.edges[oe]===void 0){switch(oe){case 0:ae=this._checkVerticesInsteadOfIndices?this._processEdgeForAdjacenciesWithVertices(r.p0,r.p1,F.p0,F.p1,F.p2):this._processEdgeForAdjacencies(e[3*n],e[3*n+1],z,k,K);break;case 1:ae=this._checkVerticesInsteadOfIndices?this._processEdgeForAdjacenciesWithVertices(r.p1,r.p2,F.p0,F.p1,F.p2):this._processEdgeForAdjacencies(e[3*n+1],e[3*n+2],z,k,K);break;case 2:ae=this._checkVerticesInsteadOfIndices?this._processEdgeForAdjacenciesWithVertices(r.p2,r.p0,F.p0,F.p1,F.p2):this._processEdgeForAdjacencies(e[3*n+2],e[3*n],z,k,K)}if(ae!==-1&&(r.edges[oe]=w,F.edges[ae]=n,r.edgesConnectedCount++,F.edgesConnectedCount++,r.edgesConnectedCount===3))break}}}}for(n=0;n<o.length;n++){var ue=o[n];this._checkEdge(n,ue.edges[0],u,ue.p0,ue.p1),this._checkEdge(n,ue.edges[1],u,ue.p1,ue.p2),this._checkEdge(n,ue.edges[2],u,ue.p2,ue.p0)}var de=this._source.getScene().getEngine();this._buffers[De.b.PositionKind]=new De.b(de,this._linesPositions,De.b.PositionKind,!1),this._buffers[De.b.NormalKind]=new De.b(de,this._linesNormals,De.b.NormalKind,!1,!1,4),this._buffersForInstances[De.b.PositionKind]=this._buffers[De.b.PositionKind],this._buffersForInstances[De.b.NormalKind]=this._buffers[De.b.NormalKind],this._ib=de.createIndexBuffer(this._linesIndices),this._indicesCount=this._linesIndices.length}},i.prototype.isReady=function(){return this._lineShader.isReady(this._source,this._source.hasInstances&&this.customInstances.length>0||this._source.hasThinInstances)},i.prototype.render=function(){var t=this._source.getScene();if(this.isReady()&&t.activeCamera){var e=t.getEngine();this._lineShader._preBind(),this._source.edgesColor.a!==1?e.setAlphaMode(g.a.ALPHA_COMBINE):e.setAlphaMode(g.a.ALPHA_DISABLE);var n=this._source.hasInstances&&this.customInstances.length>0,r=n||this._source.hasThinInstances,o=0;if(r)if(this._buffersForInstances.world0=this._source.getVertexBuffer("world0"),this._buffersForInstances.world1=this._source.getVertexBuffer("world1"),this._buffersForInstances.world2=this._source.getVertexBuffer("world2"),this._buffersForInstances.world3=this._source.getVertexBuffer("world3"),n){var u=this._source._instanceDataStorage;if(o=this.customInstances.length,!u.isFrozen){for(var f=0,v=0;v<o;++v)this.customInstances.data[v].copyToArray(u.instancesData,f),f+=16;u.instancesBuffer.updateDirectly(u.instancesData,0,o)}}else o=this._source.thinInstanceCount;e.bindBuffers(r?this._buffersForInstances:this._buffers,this._ib,this._lineShader.getEffect()),t.resetCachedMaterial(),this._lineShader.setColor4("color",this._source.edgesColor),t.activeCamera.mode===Pt.a.ORTHOGRAPHIC_CAMERA?this._lineShader.setFloat("width",this._source.edgesWidth/this.edgesWidthScalerForOrthographic):this._lineShader.setFloat("width",this._source.edgesWidth/this.edgesWidthScalerForPerspective),this._lineShader.setFloat("aspectRatio",e.getAspectRatio(t.activeCamera)),this._lineShader.bind(this._source.getWorldMatrix()),e.drawElementsType(pn.a.TriangleFillMode,0,this._indicesCount,o),this._lineShader.unbind(),r&&e.unbindInstanceAttributes(),this._source.getScene()._activeMeshesFrozen||this.customInstances.reset()}},i}(),LE=function(i){function t(e,n,r){n===void 0&&(n=.95),r===void 0&&(r=!1);var o=i.call(this,e,n,r,!1)||this;return o._generateEdgesLines(),o}return Object(p.d)(t,i),t.prototype._generateEdgesLines=function(){var e=this._source.getVerticesData(De.b.PositionKind),n=this._source.getIndices();if(n&&e){for(var r=d.c.Vector3[0],o=d.c.Vector3[1],u=n.length-1,f=0,v=0;f<u;f+=2,v+=4)d.e.FromArrayToRef(e,3*n[f],r),d.e.FromArrayToRef(e,3*n[f+1],o),this.createLine(r,o,v);var y=this._source.getScene().getEngine();this._buffers[De.b.PositionKind]=new De.b(y,this._linesPositions,De.b.PositionKind,!1),this._buffers[De.b.NormalKind]=new De.b(y,this._linesNormals,De.b.NormalKind,!1,!1,4),this._ib=y.createIndexBuffer(this._linesIndices),this._indicesCount=this._linesIndices.length}},t}(l_),u_=function(){function i(t){this._textureFormats=[{type:g.a.PREPASS_IRRADIANCE_TEXTURE_TYPE,format:g.a.TEXTURETYPE_HALF_FLOAT},{type:g.a.PREPASS_POSITION_TEXTURE_TYPE,format:g.a.TEXTURETYPE_HALF_FLOAT},{type:g.a.PREPASS_VELOCITY_TEXTURE_TYPE,format:g.a.TEXTURETYPE_HALF_FLOAT},{type:g.a.PREPASS_REFLECTIVITY_TEXTURE_TYPE,format:g.a.TEXTURETYPE_UNSIGNED_INT},{type:g.a.PREPASS_COLOR_TEXTURE_TYPE,format:g.a.TEXTURETYPE_HALF_FLOAT},{type:g.a.PREPASS_DEPTHNORMAL_TEXTURE_TYPE,format:g.a.TEXTURETYPE_HALF_FLOAT},{type:g.a.PREPASS_ALBEDO_TEXTURE_TYPE,format:g.a.TEXTURETYPE_UNSIGNED_INT}],this.excludedSkinnedMesh=[],this.excludedMaterials=[],this._textureIndices=[],this._isDirty=!1,this.mrtCount=0,this._postProcesses=[],this._clearColor=new M.b(0,0,0,0),this._effectConfigurations=[],this._mrtFormats=[],this._enabled=!1,this._useGeometryBufferFallback=!1,this.disableGammaTransform=!1,this._scene=t,this._engine=t.getEngine(),i._SceneComponentInitialization(this._scene),this._resetLayout()}return Object.defineProperty(i.prototype,"enabled",{get:function(){return this._enabled},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"samples",{get:function(){return this.prePassRT.samples},set:function(t){this.imageProcessingPostProcess||this._createCompositionEffect(),this.prePassRT.samples=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"useGeometryBufferFallback",{get:function(){return this._useGeometryBufferFallback},set:function(t){if(this._useGeometryBufferFallback=t,t){if(this._geometryBuffer=this._scene.enableGeometryBufferRenderer(),!this._geometryBuffer)return void(this._useGeometryBufferFallback=!1);this._geometryBuffer.renderList=[],this._geometryBuffer._linkPrePassRenderer(this),this._updateGeometryBufferLayout()}else this._geometryBuffer&&this._geometryBuffer._unlinkPrePassRenderer(),this._geometryBuffer=null,this._scene.disableGeometryBufferRenderer()},enumerable:!1,configurable:!0}),i.prototype._initializeAttachments=function(){for(var t=[],e=[!1],n=[!0],r=0;r<this.mrtCount;r++)t.push(!0),r>0&&(e.push(!0),n.push(!1));this._multiRenderAttachments=this._engine.buildTextureLayout(t),this._clearAttachments=this._engine.buildTextureLayout(e),this._defaultAttachments=this._engine.buildTextureLayout(n)},i.prototype._createCompositionEffect=function(){this.prePassRT=new mm("sceneprePassRT",{width:this._engine.getRenderWidth(),height:this._engine.getRenderHeight()},this.mrtCount,this._scene,{generateMipMaps:!1,generateDepthTexture:!0,defaultType:g.a.TEXTURETYPE_UNSIGNED_INT,types:this._mrtFormats}),this.prePassRT.samples=1,this._initializeAttachments(),this._useGeometryBufferFallback&&!this._geometryBuffer&&(this.useGeometryBufferFallback=!0),this.imageProcessingPostProcess=new nh("sceneCompositionPass",1,null,void 0,this._engine),this.imageProcessingPostProcess.autoClear=!1},Object.defineProperty(i.prototype,"isSupported",{get:function(){return this._engine.webGLVersion>1||this._scene.getEngine().getCaps().drawBuffersExtension},enumerable:!1,configurable:!0}),i.prototype.bindAttachmentsForEffect=function(t,e){if(this.enabled){if(t._multiTarget)this._engine.bindAttachments(this._multiRenderAttachments);else if(this._engine.bindAttachments(this._defaultAttachments),this._geometryBuffer){var n=e.getMaterial();n&&this.excludedMaterials.indexOf(n)===-1&&this._geometryBuffer.renderList.push(e.getRenderingMesh())}}},i.prototype.restoreAttachments=function(){this.enabled&&this._defaultAttachments&&this._engine.bindAttachments(this._defaultAttachments)},i.prototype._beforeCameraDraw=function(){this._isDirty&&this._update(),this._geometryBuffer&&(this._geometryBuffer.renderList.length=0),this._bindFrameBuffer()},i.prototype._afterCameraDraw=function(){if(this._enabled){var t=this._scene.activeCamera&&this._scene.activeCamera._getFirstPostProcess();t&&this._postProcesses.length&&this._scene.postProcessManager._prepareFrame(),this._scene.postProcessManager.directRender(this._postProcesses,t?t.inputTexture:null)}},i.prototype._checkRTSize=function(){var t=this._engine.getRenderWidth(!0),e=this._engine.getRenderHeight(!0),n=this.prePassRT.getRenderWidth(),r=this.prePassRT.getRenderHeight();n===t&&r===e||(this.prePassRT.resize({width:t,height:e}),this._updateGeometryBufferLayout(),this._bindPostProcessChain())},i.prototype._bindFrameBuffer=function(){if(this._enabled){this._checkRTSize();var t=this.prePassRT.getInternalTexture();t&&this._engine.bindFramebuffer(t)}},i.prototype.clear=function(){this._enabled&&(this._bindFrameBuffer(),this._engine.clear(this._scene.clearColor,this._scene.autoClear||this._scene.forceWireframe||this._scene.forcePointsCloud,this._scene.autoClearDepthAndStencil,this._scene.autoClearDepthAndStencil),this._engine.bindAttachments(this._clearAttachments),this._engine.clear(this._clearColor,!0,!1,!1),this._engine.bindAttachments(this._defaultAttachments))},i.prototype._setState=function(t){this._enabled=t,this._scene.prePass=t,this.imageProcessingPostProcess&&(this.imageProcessingPostProcess.imageProcessingConfiguration.applyByPostProcess=t)},i.prototype._updateGeometryBufferLayout=function(){if(this._geometryBuffer){this._geometryBuffer._resetLayout();for(var t=[],e=0;e<this._mrtLayout.length;e++)t.push(!1);this._geometryBuffer._linkInternalTexture(this.prePassRT.getInternalTexture());var n=[{prePassConstant:g.a.PREPASS_DEPTHNORMAL_TEXTURE_TYPE,geometryBufferConstant:Pi.DEPTHNORMAL_TEXTURE_TYPE},{prePassConstant:g.a.PREPASS_POSITION_TEXTURE_TYPE,geometryBufferConstant:Pi.POSITION_TEXTURE_TYPE},{prePassConstant:g.a.PREPASS_REFLECTIVITY_TEXTURE_TYPE,geometryBufferConstant:Pi.REFLECTIVITY_TEXTURE_TYPE},{prePassConstant:g.a.PREPASS_VELOCITY_TEXTURE_TYPE,geometryBufferConstant:Pi.VELOCITY_TEXTURE_TYPE}];for(e=0;e<n.length;e++){var r=this._mrtLayout.indexOf(n[e].prePassConstant);r!==-1&&(this._geometryBuffer._forceTextureType(n[e].geometryBufferConstant,r),t[r]=!0)}this._geometryBuffer._setAttachments(this._engine.buildTextureLayout(t))}},i.prototype.addEffectConfiguration=function(t){for(var e=0;e<this._effectConfigurations.length;e++)if(this._effectConfigurations[e].name===t.name)return this._effectConfigurations[e];return this._effectConfigurations.push(t),t},i.prototype.getIndex=function(t){return this._textureIndices[t]},i.prototype._enable=function(){for(var t,e,n=this.mrtCount,r=0;r<this._effectConfigurations.length;r++)this._effectConfigurations[r].enabled&&this._enableTextures(this._effectConfigurations[r].texturesRequired);for(this.prePassRT&&this.mrtCount!==n&&this.prePassRT.updateCount(this.mrtCount,{types:this._mrtFormats}),this._updateGeometryBufferLayout(),this._resetPostProcessChain(),r=0;r<this._effectConfigurations.length;r++)this._effectConfigurations[r].enabled&&(!this._effectConfigurations[r].postProcess&&this._effectConfigurations[r].createPostProcess&&this._effectConfigurations[r].createPostProcess(),this._effectConfigurations[r].postProcess&&this._postProcesses.push(this._effectConfigurations[r].postProcess));this._initializeAttachments(),this.imageProcessingPostProcess||this._createCompositionEffect();var o=!1;if((t=this._scene.activeCamera)===null||t===void 0?void 0:t._postProcesses)for(r=0;r<this._scene.activeCamera._postProcesses.length;r++)((e=this._scene.activeCamera._postProcesses[r])===null||e===void 0?void 0:e.getClassName())==="ImageProcessingPostProcess"&&(o=!0);o||this.disableGammaTransform||this._postProcesses.push(this.imageProcessingPostProcess),this._bindPostProcessChain(),this._setState(!0)},i.prototype._disable=function(){this._setState(!1),this._resetLayout();for(var t=0;t<this._effectConfigurations.length;t++)this._effectConfigurations[t].enabled=!1},i.prototype._resetLayout=function(){for(var t=0;t<this._textureFormats.length;t++)this._textureIndices[this._textureFormats[t].type]=-1;this._textureIndices[g.a.PREPASS_COLOR_TEXTURE_TYPE]=0,this._mrtLayout=[g.a.PREPASS_COLOR_TEXTURE_TYPE],this._mrtFormats=[g.a.TEXTURETYPE_HALF_FLOAT],this.mrtCount=1},i.prototype._resetPostProcessChain=function(){this._postProcesses=[],this.imageProcessingPostProcess&&this.imageProcessingPostProcess.restoreDefaultInputTexture();for(var t=0;t<this._effectConfigurations.length;t++)this._effectConfigurations[t].postProcess&&this._effectConfigurations[t].postProcess.restoreDefaultInputTexture()},i.prototype._bindPostProcessChain=function(){var t;if(this._postProcesses.length)this._postProcesses[0].inputTexture=this.prePassRT.getInternalTexture();else{var e=(t=this._scene.activeCamera)===null||t===void 0?void 0:t._getFirstPostProcess();e&&(e.inputTexture=this.prePassRT.getInternalTexture())}},i.prototype.markAsDirty=function(){this._isDirty=!0},i.prototype._enableTextures=function(t){for(var e=0;e<t.length;e++){var n=t[e];this._textureIndices[n]===-1&&(this._textureIndices[n]=this._mrtLayout.length,this._mrtLayout.push(n),this._mrtFormats.push(this._textureFormats[n].format),this.mrtCount++)}},i.prototype._update=function(){this._disable();for(var t=!1,e=0;e<this._scene.materials.length;e++)this._scene.materials[e].setPrePassRenderer(this)&&(t=!0);var n=this._scene.activeCamera;if(n){var r=n._postProcesses.filter(function(o){return o!=null});if(r)for(e=0;e<r.length;e++)r[e].setPrePassRenderer(this)&&(t=!0);this._markAllMaterialsAsPrePassDirty(),this._isDirty=!1,t&&this._enable(),this.enabled||(this._engine.restoreDefaultFramebuffer(),this._engine.restoreSingleAttachment())}},i.prototype._markAllMaterialsAsPrePassDirty=function(){for(var t=this._scene.materials,e=0;e<t.length;e++)t[e].markAsDirty(pn.a.PrePassDirtyFlag)},i.prototype.dispose=function(){for(var t=0;t<this._effectConfigurations.length;t++)this._effectConfigurations[t].dispose&&this._effectConfigurations[t].dispose();this.imageProcessingPostProcess.dispose(),this.prePassRT.dispose()},i._SceneComponentInitialization=function(t){throw dr.a.WarnImport("PrePassRendererSceneComponent")},i}();Object.defineProperty(he.a.prototype,"prePassRenderer",{get:function(){return this._prePassRenderer},set:function(i){i&&i.isSupported&&(this._prePassRenderer=i)},enumerable:!0,configurable:!0}),he.a.prototype.enablePrePassRenderer=function(){return this._prePassRenderer||(this._prePassRenderer=new u_(this),this._prePassRenderer.isSupported||(this._prePassRenderer=null,_.a.Error(`PrePassRenderer needs WebGL 2 support.
Maybe you tried to use the following features that need the PrePassRenderer :
 + Subsurface Scattering`))),this._prePassRenderer},he.a.prototype.disablePrePassRenderer=function(){this._prePassRenderer&&(this._prePassRenderer.dispose(),this._prePassRenderer=null)};var NE=function(){function i(t){this.name=dt.a.NAME_PREPASSRENDERER,this.scene=t}return i.prototype.register=function(){this.scene._beforeCameraDrawStage.registerStep(dt.a.STEP_BEFORECAMERADRAW_PREPASS,this,this._beforeCameraDraw),this.scene._afterCameraDrawStage.registerStep(dt.a.STEP_AFTERCAMERADRAW_PREPASS,this,this._afterCameraDraw),this.scene._beforeClearStage.registerStep(dt.a.STEP_BEFORECLEARSTAGE_PREPASS,this,this._beforeClearStage),this.scene._beforeRenderingMeshStage.registerStep(dt.a.STEP_BEFORERENDERINGMESH_PREPASS,this,this._beforeRenderingMeshStage),this.scene._afterRenderingMeshStage.registerStep(dt.a.STEP_AFTERRENDERINGMESH_PREPASS,this,this._afterRenderingMeshStage)},i.prototype._beforeCameraDraw=function(){this.scene.prePassRenderer&&this.scene.prePassRenderer._beforeCameraDraw()},i.prototype._afterCameraDraw=function(){this.scene.prePassRenderer&&this.scene.prePassRenderer._afterCameraDraw()},i.prototype._beforeClearStage=function(){this.scene.prePassRenderer&&this.scene.prePassRenderer.clear()},i.prototype._beforeRenderingMeshStage=function(t,e,n,r){if(r){var o=t.getScene();o.prePassRenderer&&o.prePassRenderer.bindAttachmentsForEffect(r,e)}},i.prototype._afterRenderingMeshStage=function(t){var e=t.getScene();e.prePassRenderer&&e.prePassRenderer.restoreAttachments()},i.prototype.rebuild=function(){},i.prototype.dispose=function(){},i}();u_._SceneComponentInitialization=function(i){var t=i._getComponent(dt.a.NAME_PREPASSRENDERER);t||(t=new NE(i),i._addComponent(t))};var sN=`#define rcp(x) 1./x
#define GOLDEN_RATIO 1.618033988749895
#define TWO_PI 6.2831855


vec2 Golden2dSeq(int i,float n)
{


return vec2(float(i)/n+(0.5/n),fract(float(i)*rcp(GOLDEN_RATIO)));
}
vec2 SampleDiskGolden(int i,int sampleCount)
{
vec2 f=Golden2dSeq(i,float(sampleCount));
return vec2(sqrt(f.x),TWO_PI*f.y);
}`;Ye.a.IncludesShadersStore.fibonacci=sN;var cN=`uniform vec3 diffusionS[5];
uniform float diffusionD[5];
uniform float filterRadii[5];`;Ye.a.IncludesShadersStore.diffusionProfile=cN;var lN=`
#include<fibonacci>
#include<helperFunctions>
#include<subSurfaceScatteringFunctions>
#include<diffusionProfile>
varying vec2 vUV;
uniform vec2 texelSize;
uniform sampler2D textureSampler;
uniform sampler2D irradianceSampler;
uniform sampler2D depthSampler;
uniform sampler2D albedoSampler;
uniform vec2 viewportSize;
uniform float metersPerUnit;
const float LOG2_E=1.4426950408889634;
const float SSS_PIXELS_PER_SAMPLE=4.;
const int _SssSampleBudget=40;
#define rcp(x) 1./x
#define Sq(x) x*x
#define SSS_BILATERAL_FILTER true


vec3 EvalBurleyDiffusionProfile(float r,vec3 S)
{
vec3 exp_13=exp2(((LOG2_E*(-1.0/3.0))*r)*S);
vec3 expSum=exp_13*(1.+exp_13*exp_13);
return (S*rcp(8.*PI))*expSum;
}






vec2 SampleBurleyDiffusionProfile(float u,float rcpS)
{
u=1.-u;
float g=1.+(4.*u)*(2.*u+sqrt(1.+(4.*u)*u));
float n=exp2(log2(g)*(-1.0/3.0));
float p=(g*n)*n;
float c=1.+p+n;
float d=(3./LOG2_E*2.)+(3./LOG2_E)*log2(u);
float x=(3./LOG2_E)*log2(c)-d;






float rcpExp=((c*c)*c)*rcp((4.*u)*((c*c)+(4.*u)*(4.*u)));
float r=x*rcpS;
float rcpPdf=(8.*PI*rcpS)*rcpExp;
return vec2(r,rcpPdf);
}


vec3 ComputeBilateralWeight(float xy2,float z,float mmPerUnit,vec3 S,float rcpPdf)
{
#ifndef SSS_BILATERAL_FILTER
z=0.;
#endif



float r=sqrt(xy2+(z*mmPerUnit)*(z*mmPerUnit));
float area=rcpPdf;
#if SSS_CLAMP_ARTIFACT
return clamp(EvalBurleyDiffusionProfile(r,S)*area,0.0,1.0);
#else
return EvalBurleyDiffusionProfile(r,S)*area;
#endif
}
void EvaluateSample(int i,int n,vec3 S,float d,vec3 centerPosVS,float mmPerUnit,float pixelsPerMm,
float phase,inout vec3 totalIrradiance,inout vec3 totalWeight)
{

float scale=rcp(float(n));
float offset=rcp(float(n))*0.5;

float sinPhase,cosPhase;
sinPhase=sin(phase);
cosPhase=cos(phase);
vec2 bdp=SampleBurleyDiffusionProfile(float(i)*scale+offset,d);
float r=bdp.x;
float rcpPdf=bdp.y;
float phi=SampleDiskGolden(i,n).y;
float sinPhi,cosPhi;
sinPhi=sin(phi);
cosPhi=cos(phi);
float sinPsi=cosPhase*sinPhi+sinPhase*cosPhi;
float cosPsi=cosPhase*cosPhi-sinPhase*sinPhi;
vec2 vec=r*vec2(cosPsi,sinPsi);

vec2 position;
float xy2;
position=vUV+round((pixelsPerMm*r)*vec2(cosPsi,sinPsi))*texelSize;
xy2=r*r;
vec4 textureSample=texture2D(irradianceSampler,position);
float viewZ=texture2D(depthSampler,position).r;
vec3 irradiance=textureSample.rgb;
if (testLightingForSSS(textureSample.a))
{

float relZ=viewZ-centerPosVS.z;
vec3 weight=ComputeBilateralWeight(xy2,relZ,mmPerUnit,S,rcpPdf);
totalIrradiance+=weight*irradiance;
totalWeight+=weight;
}
else
{






}
}
void main(void)
{
vec4 irradianceAndDiffusionProfile=texture2D(irradianceSampler,vUV);
vec3 centerIrradiance=irradianceAndDiffusionProfile.rgb;
int diffusionProfileIndex=int(round(irradianceAndDiffusionProfile.a*255.));
float centerDepth=0.;
vec4 inputColor=texture2D(textureSampler,vUV);
bool passedStencilTest=testLightingForSSS(irradianceAndDiffusionProfile.a);
if (passedStencilTest)
{
centerDepth=texture2D(depthSampler,vUV).r;
}
if (!passedStencilTest) {
gl_FragColor=inputColor;
return;
}
float distScale=1.;
vec3 S=diffusionS[diffusionProfileIndex];
float d=diffusionD[diffusionProfileIndex];
float filterRadius=filterRadii[diffusionProfileIndex];

vec2 centerPosNDC=vUV;
vec2 cornerPosNDC=vUV+0.5*texelSize;
vec3 centerPosVS=vec3(centerPosNDC*viewportSize,1.0)*centerDepth;
vec3 cornerPosVS=vec3(cornerPosNDC*viewportSize,1.0)*centerDepth;

float mmPerUnit=1000.*(metersPerUnit*rcp(distScale));
float unitsPerMm=rcp(mmPerUnit);


float unitsPerPixel=2.*abs(cornerPosVS.x-centerPosVS.x);
float pixelsPerMm=rcp(unitsPerPixel)*unitsPerMm;

float filterArea=PI*Sq(filterRadius*pixelsPerMm);
int sampleCount=int(filterArea*rcp(SSS_PIXELS_PER_SAMPLE));
int sampleBudget=_SssSampleBudget;
int texturingMode=0;
vec3 albedo=texture2D(albedoSampler,vUV).rgb;
if (distScale == 0. || sampleCount<1)
{
#ifdef DEBUG_SSS_SAMPLES
vec3 green=vec3(0.,1.,0.);
gl_FragColor=vec4(green,1.0);
return;
#endif
gl_FragColor=vec4(inputColor.rgb+albedo*centerIrradiance,1.0);
return;
}
#ifdef DEBUG_SSS_SAMPLES
vec3 red=vec3(1.,0.,0.);
vec3 blue=vec3(0.,0.,1.);
gl_FragColor=vec4(mix(blue,red,clamp(float(sampleCount)/float(sampleBudget),0.0,1.0)),1.0);
return;
#endif

float phase=0.;
int n=min(sampleCount,sampleBudget);

vec3 centerWeight=vec3(0.);
vec3 totalIrradiance=vec3(0.);
vec3 totalWeight=vec3(0.);
for (int i=0; i<n; i++)
{

EvaluateSample(i,n,S,d,centerPosVS,mmPerUnit,pixelsPerMm,
phase,totalIrradiance,totalWeight);
}

totalWeight=max(totalWeight,HALF_MIN);
gl_FragColor=vec4(inputColor.rgb+albedo*max(totalIrradiance/totalWeight,vec3(0.0)),1.);
}`;Ye.a.ShadersStore.subSurfaceScatteringPixelShader=lN;var uN=function(i){function t(e,n,r,o,u,f,v,y){o===void 0&&(o=null),y===void 0&&(y=g.a.TEXTURETYPE_UNSIGNED_INT);var D=i.call(this,e,"subSurfaceScattering",["texelSize","viewportSize","metersPerUnit"],["diffusionS","diffusionD","filterRadii","irradianceSampler","depthSampler","albedoSampler"],r,o,u||ke.a.BILINEAR_SAMPLINGMODE,f,v,null,y,"postprocess",void 0,!0)||this;return D._scene=n,D.updateEffect(),D.onApplyObservable.add(function(w){if(n.prePassRenderer&&n.subSurfaceConfiguration){var F=D.texelSize;w.setFloat("metersPerUnit",n.subSurfaceConfiguration.metersPerUnit),w.setFloat2("texelSize",F.x,F.y),w.setTexture("irradianceSampler",n.prePassRenderer.prePassRT.textures[n.prePassRenderer.getIndex(g.a.PREPASS_IRRADIANCE_TEXTURE_TYPE)]),w.setTexture("depthSampler",n.prePassRenderer.prePassRT.textures[n.prePassRenderer.getIndex(g.a.PREPASS_DEPTHNORMAL_TEXTURE_TYPE)]),w.setTexture("albedoSampler",n.prePassRenderer.prePassRT.textures[n.prePassRenderer.getIndex(g.a.PREPASS_ALBEDO_TEXTURE_TYPE)]),w.setFloat2("viewportSize",Math.tan(n.activeCamera.fov/2)*n.getEngine().getAspectRatio(n.activeCamera,!0),Math.tan(n.activeCamera.fov/2)),w.setArray3("diffusionS",n.subSurfaceConfiguration.ssDiffusionS),w.setArray("diffusionD",n.subSurfaceConfiguration.ssDiffusionD),w.setArray("filterRadii",n.subSurfaceConfiguration.ssFilterRadii)}else _.a.Error("PrePass and subsurface configuration needs to be enabled for subsurface scattering.")}),D}return Object(p.d)(t,i),t.prototype.getClassName=function(){return"SubSurfaceScatteringPostProcess"},t}(St),FE=function(){function i(t){this._ssDiffusionS=[],this._ssFilterRadii=[],this._ssDiffusionD=[],this.enabled=!1,this.name=dt.a.NAME_SUBSURFACE,this.ssDiffusionProfileColors=[],this.metersPerUnit=1,this.texturesRequired=[g.a.PREPASS_DEPTHNORMAL_TEXTURE_TYPE,g.a.PREPASS_ALBEDO_TEXTURE_TYPE,g.a.PREPASS_COLOR_TEXTURE_TYPE,g.a.PREPASS_IRRADIANCE_TEXTURE_TYPE],this.addDiffusionProfile(new M.a(1,1,1)),this._scene=t,i._SceneComponentInitialization(this._scene)}return Object.defineProperty(i.prototype,"ssDiffusionS",{get:function(){return this._ssDiffusionS},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"ssDiffusionD",{get:function(){return this._ssDiffusionD},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"ssFilterRadii",{get:function(){return this._ssFilterRadii},enumerable:!1,configurable:!0}),i.prototype.addDiffusionProfile=function(t){if(this.ssDiffusionD.length>=5)return _.a.Error("You already reached the maximum number of diffusion profiles."),0;for(var e=0;e<this._ssDiffusionS.length/3;e++)if(this._ssDiffusionS[3*e]===t.r&&this._ssDiffusionS[3*e+1]===t.g&&this._ssDiffusionS[3*e+2]===t.b)return e;return this._ssDiffusionS.push(t.r,t.b,t.g),this._ssDiffusionD.push(Math.max(Math.max(t.r,t.b),t.g)),this._ssFilterRadii.push(this.getDiffusionProfileParameters(t)),this.ssDiffusionProfileColors.push(t),this._ssDiffusionD.length-1},i.prototype.createPostProcess=function(){return this.postProcess=new uN("subSurfaceScattering",this._scene,1,null,void 0,this._scene.getEngine()),this.postProcess.autoClear=!1,this.postProcess},i.prototype.clearAllDiffusionProfiles=function(){this._ssDiffusionD=[],this._ssDiffusionS=[],this._ssFilterRadii=[],this.ssDiffusionProfileColors=[]},i.prototype.dispose=function(){this.clearAllDiffusionProfiles(),this.postProcess.dispose()},i.prototype.getDiffusionProfileParameters=function(t){var e=Math.max(t.r,t.g,t.b);return this._sampleBurleyDiffusionProfile(.997,e)},i.prototype._sampleBurleyDiffusionProfile=function(t,e){var n=1+4*(t=1-t)*(2*t+Math.sqrt(1+4*t*t)),r=Math.pow(n,-1/3),o=1+n*r*r+r;return 3*Math.log(o/(4*t))*e},i._SceneComponentInitialization=function(t){throw dr.a.WarnImport("PrePassRendererSceneComponent")},i}();E.a.AddParser(dt.a.NAME_SUBSURFACE,function(i,t){if(i.ssDiffusionProfileColors!==void 0&&i.ssDiffusionProfileColors!==null&&(t.enableSubSurfaceForPrePass(),t.subSurfaceConfiguration))for(var e=0,n=i.ssDiffusionProfileColors.length;e<n;e++){var r=i.ssDiffusionProfileColors[e];t.subSurfaceConfiguration.addDiffusionProfile(new M.a(r.r,r.g,r.b))}}),Object.defineProperty(he.a.prototype,"subSurfaceConfiguration",{get:function(){return this._subSurfaceConfiguration},set:function(i){i&&this.enablePrePassRenderer()&&(this._subSurfaceConfiguration=i)},enumerable:!0,configurable:!0}),he.a.prototype.enableSubSurfaceForPrePass=function(){if(this._subSurfaceConfiguration)return this._subSurfaceConfiguration;var i=this.enablePrePassRenderer();return i?(this._subSurfaceConfiguration=new FE(this),i.addEffectConfiguration(this._subSurfaceConfiguration),this._subSurfaceConfiguration):null},he.a.prototype.disableSubSurfaceForPrePass=function(){this._subSurfaceConfiguration&&(this._subSurfaceConfiguration.dispose(),this._subSurfaceConfiguration=null)};var BE=function(){function i(t){this.name=dt.a.NAME_PREPASSRENDERER,this.scene=t}return i.prototype.register=function(){},i.prototype.serialize=function(t){if(this.scene.subSurfaceConfiguration){var e=this.scene.subSurfaceConfiguration.ssDiffusionProfileColors;t.ssDiffusionProfileColors=[];for(var n=0;n<e.length;n++)t.ssDiffusionProfileColors.push({r:e[n].r,g:e[n].g,b:e[n].b})}},i.prototype.addFromContainer=function(t){},i.prototype.removeFromContainer=function(t,e){this.scene.prePassRenderer&&this.scene.subSurfaceConfiguration&&this.scene.subSurfaceConfiguration.clearAllDiffusionProfiles()},i.prototype.rebuild=function(){},i.prototype.dispose=function(){},i}();FE._SceneComponentInitialization=function(i){var t=i._getComponent(dt.a.NAME_SUBSURFACE);t||(t=new BE(i),i._addComponent(t))};var hN=`#ifdef LOGARITHMICDEPTH
#extension GL_EXT_frag_depth : enable
#endif
uniform vec4 color;
#ifdef ALPHATEST
varying vec2 vUV;
uniform sampler2D diffuseSampler;
#endif
#include<logDepthDeclaration>
void main(void) {
#ifdef ALPHATEST
if (texture2D(diffuseSampler,vUV).a<0.4)
discard;
#endif
#include<logDepthFragment>
gl_FragColor=color;
}`;Ye.a.ShadersStore.outlinePixelShader=hN;var dN=`
attribute vec3 position;
attribute vec3 normal;
#include<bonesDeclaration>
#include<morphTargetsVertexGlobalDeclaration>
#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]

uniform float offset;
#include<instancesDeclaration>
uniform mat4 viewProjection;
#ifdef ALPHATEST
varying vec2 vUV;
uniform mat4 diffuseMatrix;
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#endif
#include<logDepthDeclaration>
void main(void)
{
vec3 positionUpdated=position;
vec3 normalUpdated=normal;
#ifdef UV1
vec2 uvUpdated=uv;
#endif
#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]
vec3 offsetPosition=positionUpdated+(normalUpdated*offset);
#include<instancesVertex>
#include<bonesVertex>
gl_Position=viewProjection*finalWorld*vec4(offsetPosition,1.0);
#ifdef ALPHATEST
#ifdef UV1
vUV=vec2(diffuseMatrix*vec4(uvUpdated,1.0,0.0));
#endif
#ifdef UV2
vUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));
#endif
#endif
#include<logDepthVertex>
}
`;Ye.a.ShadersStore.outlineVertexShader=dN,he.a.prototype.getOutlineRenderer=function(){return this._outlineRenderer||(this._outlineRenderer=new UE(this)),this._outlineRenderer},Object.defineProperty(Ne.a.prototype,"renderOutline",{get:function(){return this._renderOutline},set:function(i){i&&this.getScene().getOutlineRenderer(),this._renderOutline=i},enumerable:!0,configurable:!0}),Object.defineProperty(Ne.a.prototype,"renderOverlay",{get:function(){return this._renderOverlay},set:function(i){i&&this.getScene().getOutlineRenderer(),this._renderOverlay=i},enumerable:!0,configurable:!0});var UE=function(){function i(t){this.name=dt.a.NAME_OUTLINERENDERER,this.zOffset=1,this.scene=t,this._engine=t.getEngine(),this.scene._addComponent(this)}return i.prototype.register=function(){this.scene._beforeRenderingMeshStage.registerStep(dt.a.STEP_BEFORERENDERINGMESH_OUTLINE,this,this._beforeRenderingMesh),this.scene._afterRenderingMeshStage.registerStep(dt.a.STEP_AFTERRENDERINGMESH_OUTLINE,this,this._afterRenderingMesh)},i.prototype.rebuild=function(){},i.prototype.dispose=function(){},i.prototype.render=function(t,e,n){var r=this;n===void 0&&(n=!1);var o=this.scene,u=o.getEngine(),f=u.getCaps().instancedArrays&&(e.visibleInstances[t._id]!==null&&e.visibleInstances[t._id]!==void 0||t.getRenderingMesh().hasThinInstances);if(this.isReady(t,f)){var v=t.getMesh(),y=v._internalAbstractMeshDataInfo._actAsRegularMesh?v:null,D=t.getRenderingMesh(),w=y||D,F=t.getMaterial();if(F&&o.activeCamera){if(u.enableEffect(this._effect),F.useLogarithmicDepth&&this._effect.setFloat("logarithmicDepthConstant",2/(Math.log(o.activeCamera.maxZ+1)/Math.LN2)),this._effect.setFloat("offset",n?0:D.outlineWidth),this._effect.setColor4("color",n?D.overlayColor:D.outlineColor,n?D.overlayAlpha:F.alpha),this._effect.setMatrix("viewProjection",o.getTransformMatrix()),this._effect.setMatrix("world",w.getWorldMatrix()),D.useBones&&D.computeBonesUsingShaders&&D.skeleton&&this._effect.setMatrices("mBones",D.skeleton.getTransformMatrices(D)),lt.a.BindMorphTargetParameters(D,this._effect),D._bind(t,this._effect,F.fillMode),F&&F.needAlphaTesting()){var z=F.getAlphaTestTexture();z&&(this._effect.setTexture("diffuseSampler",z),this._effect.setMatrix("diffuseMatrix",z.getTextureMatrix()))}u.setZOffset(-this.zOffset),D._processRendering(w,t,this._effect,F.fillMode,e,f,function(k,K){r._effect.setMatrix("world",K)}),u.setZOffset(0)}}},i.prototype.isReady=function(t,e){var n=[],r=[De.b.PositionKind,De.b.NormalKind],o=t.getMesh(),u=t.getMaterial();u&&(u.needAlphaTesting()&&(n.push("#define ALPHATEST"),o.isVerticesDataPresent(De.b.UVKind)&&(r.push(De.b.UVKind),n.push("#define UV1")),o.isVerticesDataPresent(De.b.UV2Kind)&&(r.push(De.b.UV2Kind),n.push("#define UV2"))),u.useLogarithmicDepth&&n.push("#define LOGARITHMICDEPTH")),o.useBones&&o.computeBonesUsingShaders?(r.push(De.b.MatricesIndicesKind),r.push(De.b.MatricesWeightsKind),o.numBoneInfluencers>4&&(r.push(De.b.MatricesIndicesExtraKind),r.push(De.b.MatricesWeightsExtraKind)),n.push("#define NUM_BONE_INFLUENCERS "+o.numBoneInfluencers),n.push("#define BonesPerMesh "+(o.skeleton?o.skeleton.bones.length+1:0))):n.push("#define NUM_BONE_INFLUENCERS 0");var f=o.morphTargetManager,v=0;f&&f.numInfluencers>0&&(v=f.numInfluencers,n.push("#define MORPHTARGETS"),n.push("#define NUM_MORPH_INFLUENCERS "+v),lt.a.PrepareAttributesForMorphTargetsInfluencers(r,o,v)),e&&(n.push("#define INSTANCES"),lt.a.PushAttributesForInstances(r),t.getRenderingMesh().hasThinInstances&&n.push("#define THIN_INSTANCES"));var y=n.join(`
`);return this._cachedDefines!==y&&(this._cachedDefines=y,this._effect=this.scene.getEngine().createEffect("outline",r,["world","mBones","viewProjection","diffuseMatrix","offset","color","logarithmicDepthConstant","morphTargetInfluences"],["diffuseSampler"],y,void 0,void 0,void 0,{maxSimultaneousMorphTargets:v})),this._effect.isReady()},i.prototype._beforeRenderingMesh=function(t,e,n){if(this._savedDepthWrite=this._engine.getDepthWrite(),t.renderOutline){var r=e.getMaterial();r&&r.needAlphaBlendingForMesh(t)&&(this._engine.cacheStencilState(),this._engine.setDepthWrite(!1),this._engine.setColorWrite(!1),this._engine.setStencilBuffer(!0),this._engine.setStencilOperationPass(g.a.REPLACE),this._engine.setStencilFunction(g.a.ALWAYS),this._engine.setStencilMask(i._StencilReference),this._engine.setStencilFunctionReference(i._StencilReference),this.render(e,n,!0),this._engine.setColorWrite(!0),this._engine.setStencilFunction(g.a.NOTEQUAL)),this._engine.setDepthWrite(!1),this.render(e,n),this._engine.setDepthWrite(this._savedDepthWrite),r&&r.needAlphaBlendingForMesh(t)&&this._engine.restoreStencilState()}},i.prototype._afterRenderingMesh=function(t,e,n){if(t.renderOverlay){var r=this._engine.getAlphaMode(),o=this._engine.alphaState.alphaBlend;this._engine.setAlphaMode(g.a.ALPHA_COMBINE),this.render(e,n,!0),this._engine.setAlphaMode(r),this._engine.setDepthWrite(this._savedDepthWrite),this._engine.alphaState.alphaBlend=o}t.renderOutline&&this._savedDepthWrite&&(this._engine.setDepthWrite(!0),this._engine.setColorWrite(!1),this.render(e,n),this._engine.setColorWrite(!0))},i._StencilReference=4,i}(),fN=c(148),VE=function(i){function t(e,n){var r=i.call(this)||this;return r.name=e,r.animations=new Array,r.isPickable=!1,r.useAlphaForPicking=!1,r.onDisposeObservable=new S.c,r._onAnimationEnd=null,r._endAnimation=function(){r._onAnimationEnd&&r._onAnimationEnd(),r.disposeWhenFinishedAnimating&&r.dispose()},r.color=new M.b(1,1,1,1),r.position=d.e.Zero(),r._manager=n,r._manager.sprites.push(r),r.uniqueId=r._manager.scene.getUniqueId(),r}return Object(p.d)(t,i),Object.defineProperty(t.prototype,"size",{get:function(){return this.width},set:function(e){this.width=e,this.height=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"manager",{get:function(){return this._manager},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"Sprite"},Object.defineProperty(t.prototype,"fromIndex",{get:function(){return this._fromIndex},set:function(e){this.playAnimation(e,this._toIndex,this._loopAnimation,this._delay,this._onAnimationEnd)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"toIndex",{get:function(){return this._toIndex},set:function(e){this.playAnimation(this._fromIndex,e,this._loopAnimation,this._delay,this._onAnimationEnd)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"loopAnimation",{get:function(){return this._loopAnimation},set:function(e){this.playAnimation(this._fromIndex,this._toIndex,e,this._delay,this._onAnimationEnd)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"delay",{get:function(){return Math.max(this._delay,1)},set:function(e){this.playAnimation(this._fromIndex,this._toIndex,this._loopAnimation,e,this._onAnimationEnd)},enumerable:!1,configurable:!0}),t.prototype.playAnimation=function(e,n,r,o,u){u===void 0&&(u=null),this._onAnimationEnd=u,i.prototype.playAnimation.call(this,e,n,r,o,this._endAnimation)},t.prototype.dispose=function(){for(var e=0;e<this._manager.sprites.length;e++)this._manager.sprites[e]==this&&this._manager.sprites.splice(e,1);this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear()},t.prototype.serialize=function(){var e={};return e.name=this.name,e.position=this.position.asArray(),e.color=this.color.asArray(),e.width=this.width,e.height=this.height,e.angle=this.angle,e.cellIndex=this.cellIndex,e.cellRef=this.cellRef,e.invertU=this.invertU,e.invertV=this.invertV,e.disposeWhenFinishedAnimating=this.disposeWhenFinishedAnimating,e.isPickable=this.isPickable,e.isVisible=this.isVisible,e.useAlphaForPicking=this.useAlphaForPicking,e.animationStarted=this.animationStarted,e.fromIndex=this.fromIndex,e.toIndex=this.toIndex,e.loopAnimation=this.loopAnimation,e.delay=this.delay,e},t.Parse=function(e,n){var r=new t(e.name,n);return r.position=d.e.FromArray(e.position),r.color=M.b.FromArray(e.color),r.width=e.width,r.height=e.height,r.angle=e.angle,r.cellIndex=e.cellIndex,r.cellRef=e.cellRef,r.invertU=e.invertU,r.invertV=e.invertV,r.disposeWhenFinishedAnimating=e.disposeWhenFinishedAnimating,r.isPickable=e.isPickable,r.isVisible=e.isVisible,r.useAlphaForPicking=e.useAlphaForPicking,r.fromIndex=e.fromIndex,r.toIndex=e.toIndex,r.loopAnimation=e.loopAnimation,r.delay=e.delay,e.animationStarted&&r.playAnimation(r.fromIndex,r.toIndex,r.loopAnimation,r.delay),r},t}(function(){function i(){this.width=1,this.height=1,this.angle=0,this.invertU=!1,this.invertV=!1,this.isVisible=!0,this._animationStarted=!1,this._loopAnimation=!1,this._fromIndex=0,this._toIndex=0,this._delay=0,this._direction=1,this._time=0,this._onBaseAnimationEnd=null,this.position={x:1,y:1,z:1},this.color={r:1,g:1,b:1,a:1}}return Object.defineProperty(i.prototype,"animationStarted",{get:function(){return this._animationStarted},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"fromIndex",{get:function(){return this._fromIndex},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"toIndex",{get:function(){return this._toIndex},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"loopAnimation",{get:function(){return this._loopAnimation},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"delay",{get:function(){return Math.max(this._delay,1)},enumerable:!1,configurable:!0}),i.prototype.playAnimation=function(t,e,n,r,o){this._fromIndex=t,this._toIndex=e,this._loopAnimation=n,this._delay=r||1,this._animationStarted=!0,this._onBaseAnimationEnd=o,t<e?this._direction=1:(this._direction=-1,this._toIndex=t,this._fromIndex=e),this.cellIndex=t,this._time=0},i.prototype.stopAnimation=function(){this._animationStarted=!1},i.prototype._animate=function(t){this._animationStarted&&(this._time+=t,this._time>this._delay&&(this._time=this._time%this._delay,this.cellIndex+=this._direction,(this._direction>0&&this.cellIndex>this._toIndex||this._direction<0&&this.cellIndex<this._fromIndex)&&(this._loopAnimation?this.cellIndex=this._direction>0?this._fromIndex:this._toIndex:(this.cellIndex=this._toIndex,this._animationStarted=!1,this._onBaseAnimationEnd&&this._onBaseAnimationEnd()))))},i}());he.a.prototype._internalPickSprites=function(i,t,e,n){if(!Ia.a)return null;var r=null;if(!n){if(!this.activeCamera)return null;n=this.activeCamera}if(this.spriteManagers.length>0)for(var o=0;o<this.spriteManagers.length;o++){var u=this.spriteManagers[o];if(u.isPickable){var f=u.intersects(i,n,t,e);if(f&&f.hit&&(e||r==null||!(f.distance>=r.distance))&&(r=f,e))break}}return r||new Ia.a},he.a.prototype._internalMultiPickSprites=function(i,t,e){if(!Ia.a)return null;var n=new Array;if(!e){if(!this.activeCamera)return null;e=this.activeCamera}if(this.spriteManagers.length>0)for(var r=0;r<this.spriteManagers.length;r++){var o=this.spriteManagers[r];if(o.isPickable){var u=o.multiIntersects(i,e,t);u!==null&&(n=n.concat(u))}}return n},he.a.prototype.pickSprite=function(i,t,e,n,r){return this._tempSpritePickingRay?(this.createPickingRayInCameraSpaceToRef(i,t,this._tempSpritePickingRay,r),this._internalPickSprites(this._tempSpritePickingRay,e,n,r)):null},he.a.prototype.pickSpriteWithRay=function(i,t,e,n){if(!this._tempSpritePickingRay)return null;if(!n){if(!this.activeCamera)return null;n=this.activeCamera}return Qn.a.TransformToRef(i,n.getViewMatrix(),this._tempSpritePickingRay),this._internalPickSprites(this._tempSpritePickingRay,t,e,n)},he.a.prototype.multiPickSprite=function(i,t,e,n){return this.createPickingRayInCameraSpaceToRef(i,t,this._tempSpritePickingRay,n),this._internalMultiPickSprites(this._tempSpritePickingRay,e,n)},he.a.prototype.multiPickSpriteWithRay=function(i,t,e){if(!this._tempSpritePickingRay)return null;if(!e){if(!this.activeCamera)return null;e=this.activeCamera}return Qn.a.TransformToRef(i,e.getViewMatrix(),this._tempSpritePickingRay),this._internalMultiPickSprites(this._tempSpritePickingRay,t,e)},he.a.prototype.setPointerOverSprite=function(i){this._pointerOverSprite!==i&&(this._pointerOverSprite&&this._pointerOverSprite.actionManager&&this._pointerOverSprite.actionManager.processTrigger(g.a.ACTION_OnPointerOutTrigger,b.a.CreateNewFromSprite(this._pointerOverSprite,this)),this._pointerOverSprite=i,this._pointerOverSprite&&this._pointerOverSprite.actionManager&&this._pointerOverSprite.actionManager.processTrigger(g.a.ACTION_OnPointerOverTrigger,b.a.CreateNewFromSprite(this._pointerOverSprite,this)))},he.a.prototype.getPointerOverSprite=function(){return this._pointerOverSprite};var kE=function(){function i(t){this.name=dt.a.NAME_SPRITE,this.scene=t,this.scene.spriteManagers=new Array,this.scene._tempSpritePickingRay=Qn.a?Qn.a.Zero():null,this.scene.onBeforeSpritesRenderingObservable=new S.c,this.scene.onAfterSpritesRenderingObservable=new S.c,this._spritePredicate=function(e){return!!e.actionManager&&e.isPickable&&e.actionManager.hasPointerTriggers}}return i.prototype.register=function(){this.scene._pointerMoveStage.registerStep(dt.a.STEP_POINTERMOVE_SPRITE,this,this._pointerMove),this.scene._pointerDownStage.registerStep(dt.a.STEP_POINTERDOWN_SPRITE,this,this._pointerDown),this.scene._pointerUpStage.registerStep(dt.a.STEP_POINTERUP_SPRITE,this,this._pointerUp)},i.prototype.rebuild=function(){},i.prototype.dispose=function(){this.scene.onBeforeSpritesRenderingObservable.clear(),this.scene.onAfterSpritesRenderingObservable.clear();for(var t=this.scene.spriteManagers;t.length;)t[0].dispose()},i.prototype._pickSpriteButKeepRay=function(t,e,n,r,o){var u=this.scene.pickSprite(e,n,this._spritePredicate,r,o);return u&&(u.ray=t?t.ray:null),u},i.prototype._pointerMove=function(t,e,n,r,o){var u=this.scene;return r?u.setPointerOverSprite(null):(n=this._pickSpriteButKeepRay(n,t,e,!1,u.cameraToUseForPointers||void 0))&&n.hit&&n.pickedSprite?(u.setPointerOverSprite(n.pickedSprite),u.doNotHandleCursors||(u._pointerOverSprite&&u._pointerOverSprite.actionManager&&u._pointerOverSprite.actionManager.hoverCursor?o.style.cursor=u._pointerOverSprite.actionManager.hoverCursor:o.style.cursor=u.hoverCursor)):u.setPointerOverSprite(null),n},i.prototype._pointerDown=function(t,e,n,r){var o=this.scene;if(o._pickedDownSprite=null,o.spriteManagers.length>0&&(n=o.pickSprite(t,e,this._spritePredicate,!1,o.cameraToUseForPointers||void 0))&&n.hit&&n.pickedSprite&&n.pickedSprite.actionManager){switch(o._pickedDownSprite=n.pickedSprite,r.button){case 0:n.pickedSprite.actionManager.processTrigger(g.a.ACTION_OnLeftPickTrigger,b.a.CreateNewFromSprite(n.pickedSprite,o,r));break;case 1:n.pickedSprite.actionManager.processTrigger(g.a.ACTION_OnCenterPickTrigger,b.a.CreateNewFromSprite(n.pickedSprite,o,r));break;case 2:n.pickedSprite.actionManager.processTrigger(g.a.ACTION_OnRightPickTrigger,b.a.CreateNewFromSprite(n.pickedSprite,o,r))}n.pickedSprite.actionManager&&n.pickedSprite.actionManager.processTrigger(g.a.ACTION_OnPickDownTrigger,b.a.CreateNewFromSprite(n.pickedSprite,o,r))}return n},i.prototype._pointerUp=function(t,e,n,r){var o=this.scene;if(o.spriteManagers.length>0){var u=o.pickSprite(t,e,this._spritePredicate,!1,o.cameraToUseForPointers||void 0);u&&(u.hit&&u.pickedSprite&&u.pickedSprite.actionManager&&(u.pickedSprite.actionManager.processTrigger(g.a.ACTION_OnPickUpTrigger,b.a.CreateNewFromSprite(u.pickedSprite,o,r)),u.pickedSprite.actionManager&&(this.scene._inputManager._isPointerSwiping()||u.pickedSprite.actionManager.processTrigger(g.a.ACTION_OnPickTrigger,b.a.CreateNewFromSprite(u.pickedSprite,o,r)))),o._pickedDownSprite&&o._pickedDownSprite.actionManager&&o._pickedDownSprite!==u.pickedSprite&&o._pickedDownSprite.actionManager.processTrigger(g.a.ACTION_OnPickOutTrigger,b.a.CreateNewFromSprite(o._pickedDownSprite,o,r)))}return n},i}();Ye.a.IncludesShadersStore.imageProcessingCompatibility=`#ifdef IMAGEPROCESSINGPOSTPROCESS
gl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));
#endif`;var pN=`uniform bool alphaTest;
varying vec4 vColor;

varying vec2 vUV;
uniform sampler2D diffuseSampler;

#include<fogFragmentDeclaration>
void main(void) {
vec4 color=texture2D(diffuseSampler,vUV);
if (alphaTest)
{
if (color.a<0.95)
discard;
}
color*=vColor;
#include<fogFragment>
gl_FragColor=color;
#include<imageProcessingCompatibility>
}`;Ye.a.ShadersStore.spritesPixelShader=pN;var mN=`
attribute vec4 position;
attribute vec2 options;
attribute vec2 offsets;
attribute vec2 inverts;
attribute vec4 cellInfo;
attribute vec4 color;

uniform mat4 view;
uniform mat4 projection;

varying vec2 vUV;
varying vec4 vColor;
#include<fogVertexDeclaration>
void main(void) {
vec3 viewPos=(view*vec4(position.xyz,1.0)).xyz;
vec2 cornerPos;
float angle=position.w;
vec2 size=vec2(options.x,options.y);
vec2 offset=offsets.xy;
cornerPos=vec2(offset.x-0.5,offset.y-0.5)*size;

vec3 rotatedCorner;
rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);
rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);
rotatedCorner.z=0.;

viewPos+=rotatedCorner;
gl_Position=projection*vec4(viewPos,1.0);

vColor=color;

vec2 uvOffset=vec2(abs(offset.x-inverts.x),abs(1.0-offset.y-inverts.y));
vec2 uvPlace=cellInfo.xy;
vec2 uvSize=cellInfo.zw;
vUV.x=uvPlace.x+uvSize.x*uvOffset.x;
vUV.y=uvPlace.y+uvSize.y*uvOffset.y;

#ifdef FOG
vFogDistance=viewPos;
#endif
}`;Ye.a.ShadersStore.spritesVertexShader=mN;var _N=function(){function i(t,e,n,r){if(n===void 0&&(n=.01),r===void 0&&(r=null),this.blendMode=g.a.ALPHA_COMBINE,this.autoResetAlpha=!0,this.disableDepthWrite=!1,this.fogEnabled=!0,this._useVAO=!1,this._useInstancing=!1,this._vertexBuffers={},this._capacity=e,this._epsilon=n,this._engine=t,this._useInstancing=t.getCaps().instancedArrays,this._useVAO=t.getCaps().vertexArrayObject&&!t.disableVertexArrayObjects,this._scene=r,!this._useInstancing){for(var o=[],u=0,f=0;f<e;f++)o.push(u),o.push(u+1),o.push(u+2),o.push(u),o.push(u+2),o.push(u+3),u+=4;this._indexBuffer=t.createIndexBuffer(o)}this._vertexBufferSize=this._useInstancing?16:18,this._vertexData=new Float32Array(e*this._vertexBufferSize*(this._useInstancing?1:4)),this._buffer=new De.a(t,this._vertexData,!0,this._vertexBufferSize);var v,y=this._buffer.createVertexBuffer(De.b.PositionKind,0,4,this._vertexBufferSize,this._useInstancing),D=this._buffer.createVertexBuffer("options",4,2,this._vertexBufferSize,this._useInstancing),w=6;if(this._useInstancing){var F=new Float32Array([0,0,1,0,1,1,0,1]);this._spriteBuffer=new De.a(t,F,!1,2),v=this._spriteBuffer.createVertexBuffer("offsets",0,2)}else v=this._buffer.createVertexBuffer("offsets",w,2,this._vertexBufferSize,this._useInstancing),w+=2;var z=this._buffer.createVertexBuffer("inverts",w,2,this._vertexBufferSize,this._useInstancing),k=this._buffer.createVertexBuffer("cellInfo",w+2,4,this._vertexBufferSize,this._useInstancing),K=this._buffer.createVertexBuffer(De.b.ColorKind,w+6,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[De.b.PositionKind]=y,this._vertexBuffers.options=D,this._vertexBuffers.offsets=v,this._vertexBuffers.inverts=z,this._vertexBuffers.cellInfo=k,this._vertexBuffers[De.b.ColorKind]=K,this._effectBase=this._engine.createEffect("sprites",[De.b.PositionKind,"options","offsets","inverts","cellInfo",De.b.ColorKind],["view","projection","textureInfos","alphaTest"],["diffuseSampler"],""),this._scene&&(this._effectFog=this._scene.getEngine().createEffect("sprites",[De.b.PositionKind,"options","offsets","inverts","cellInfo",De.b.ColorKind],["view","projection","textureInfos","alphaTest","vFogInfos","vFogColor"],["diffuseSampler"],"#define FOG"))}return Object.defineProperty(i.prototype,"capacity",{get:function(){return this._capacity},enumerable:!1,configurable:!0}),i.prototype.render=function(t,e,n,r,o){if(o===void 0&&(o=null),this.texture&&this.texture.isReady()&&t.length){var u=this._effectBase,f=!1;if(this.fogEnabled&&this._scene&&this._scene.fogEnabled&&this._scene.fogMode!==0&&(u=this._effectFog,f=!0),u.isReady()){for(var v=this._engine,y=!(!this._scene||!this._scene.useRightHandedSystem),D=this.texture.getBaseSize(),w=Math.min(this._capacity,t.length),F=0,z=!0,k=0;k<w;k++){var K=t[k];K&&K.isVisible&&(z=!1,K._animate(e),this._appendSpriteVertex(F++,K,0,0,D,y,o),this._useInstancing||(this._appendSpriteVertex(F++,K,1,0,D,y,o),this._appendSpriteVertex(F++,K,1,1,D,y,o),this._appendSpriteVertex(F++,K,0,1,D,y,o)))}if(!z){this._buffer.update(this._vertexData);var oe=v.depthCullingState.cull||!0,ae=v.depthCullingState.zOffset;if(y&&this._scene.getEngine().setState(oe,ae,!1,!1),v.enableEffect(u),u.setTexture("diffuseSampler",this.texture),u.setMatrix("view",n),u.setMatrix("projection",r),f){var ue=this._scene;u.setFloat4("vFogInfos",ue.fogMode,ue.fogStart,ue.fogEnd,ue.fogDensity),u.setColor3("vFogColor",ue.fogColor)}this._useVAO?(this._vertexArrayObject||(this._vertexArrayObject=v.recordVertexArrayObject(this._vertexBuffers,this._indexBuffer,u)),v.bindVertexArrayObject(this._vertexArrayObject,this._indexBuffer)):v.bindBuffers(this._vertexBuffers,this._indexBuffer,u),v.depthCullingState.depthFunc=g.a.LEQUAL,this.disableDepthWrite||(u.setBool("alphaTest",!0),v.setColorWrite(!1),this._useInstancing?v.drawArraysType(g.a.MATERIAL_TriangleFanDrawMode,0,4,F):v.drawElementsType(g.a.MATERIAL_TriangleFillMode,0,F/4*6),v.setColorWrite(!0),u.setBool("alphaTest",!1)),v.setAlphaMode(this.blendMode),this._useInstancing?v.drawArraysType(g.a.MATERIAL_TriangleFanDrawMode,0,4,F):v.drawElementsType(g.a.MATERIAL_TriangleFillMode,0,F/4*6),this.autoResetAlpha&&v.setAlphaMode(g.a.ALPHA_DISABLE),y&&this._scene.getEngine().setState(oe,ae,!1,!0),v.unbindInstanceAttributes()}}}},i.prototype._appendSpriteVertex=function(t,e,n,r,o,u,f){var v=t*this._vertexBufferSize;if(n===0?n=this._epsilon:n===1&&(n=1-this._epsilon),r===0?r=this._epsilon:r===1&&(r=1-this._epsilon),f)f(e,o);else{e.cellIndex||(e.cellIndex=0);var y=o.width/this.cellWidth,D=e.cellIndex/y>>0;e._xOffset=(e.cellIndex-D*y)*this.cellWidth/o.width,e._yOffset=D*this.cellHeight/o.height,e._xSize=this.cellWidth,e._ySize=this.cellHeight}this._vertexData[v]=e.position.x,this._vertexData[v+1]=e.position.y,this._vertexData[v+2]=e.position.z,this._vertexData[v+3]=e.angle,this._vertexData[v+4]=e.width,this._vertexData[v+5]=e.height,this._useInstancing?v-=2:(this._vertexData[v+6]=n,this._vertexData[v+7]=r),this._vertexData[v+8]=u?e.invertU?0:1:e.invertU?1:0,this._vertexData[v+9]=e.invertV?1:0,this._vertexData[v+10]=e._xOffset,this._vertexData[v+11]=e._yOffset,this._vertexData[v+12]=e._xSize/o.width,this._vertexData[v+13]=e._ySize/o.height,this._vertexData[v+14]=e.color.r,this._vertexData[v+15]=e.color.g,this._vertexData[v+16]=e.color.b,this._vertexData[v+17]=e.color.a},i.prototype.dispose=function(){this._buffer&&(this._buffer.dispose(),this._buffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this.texture&&(this.texture.dispose(),this.texture=null)},i}(),jE=function(){function i(t,e,n,r,o,u,f,v,y){var D=this;u===void 0&&(u=.01),f===void 0&&(f=ke.a.TRILINEAR_SAMPLINGMODE),v===void 0&&(v=!1),y===void 0&&(y=null),this.name=t,this.sprites=new Array,this.renderingGroupId=0,this.layerMask=268435455,this.isPickable=!1,this.onDisposeObservable=new S.c,this.disableDepthWrite=!1,this._packedAndReady=!1,this._customUpdate=function(F,z){F.cellRef||(F.cellIndex=0);var k=F.cellIndex;typeof k=="number"&&isFinite(k)&&Math.floor(k)===k&&(F.cellRef=D._spriteMap[F.cellIndex]),F._xOffset=D._cellData[F.cellRef].frame.x/z.width,F._yOffset=D._cellData[F.cellRef].frame.y/z.height,F._xSize=D._cellData[F.cellRef].frame.w,F._ySize=D._cellData[F.cellRef].frame.h},o||(o=Ge.a.LastCreatedScene),o._getComponent(dt.a.NAME_SPRITE)||o._addComponent(new kE(o)),this._fromPacked=v,this._scene=o;var w=this._scene.getEngine();if(this._spriteRenderer=new _N(w,n,u,o),r.width&&r.height)this.cellWidth=r.width,this.cellHeight=r.height;else{if(r===void 0)return void(this._spriteRenderer=null);this.cellWidth=r,this.cellHeight=r}this._scene.spriteManagers.push(this),this.uniqueId=this.scene.getUniqueId(),e&&(this.texture=new ke.a(e,o,!0,!1,f)),this._fromPacked&&this._makePacked(e,y)}return Object.defineProperty(i.prototype,"onDispose",{set:function(t){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"children",{get:function(){return this.sprites},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"scene",{get:function(){return this._scene},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"capacity",{get:function(){return this._spriteRenderer.capacity},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"texture",{get:function(){return this._spriteRenderer.texture},set:function(t){t.wrapU=ke.a.CLAMP_ADDRESSMODE,t.wrapV=ke.a.CLAMP_ADDRESSMODE,this._spriteRenderer.texture=t,this._textureContent=null},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"cellWidth",{get:function(){return this._spriteRenderer.cellWidth},set:function(t){this._spriteRenderer.cellWidth=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"cellHeight",{get:function(){return this._spriteRenderer.cellHeight},set:function(t){this._spriteRenderer.cellHeight=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"fogEnabled",{get:function(){return this._spriteRenderer.fogEnabled},set:function(t){this._spriteRenderer.fogEnabled=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"blendMode",{get:function(){return this._spriteRenderer.blendMode},set:function(t){this._spriteRenderer.blendMode=t},enumerable:!1,configurable:!0}),i.prototype.getClassName=function(){return"SpriteManager"},i.prototype._makePacked=function(t,e){var n=this;if(e!==null)try{var r=void 0;if((r=typeof e=="string"?JSON.parse(e):e).frames.length){for(var o={},u=0;u<r.frames.length;u++){var f=r.frames[u];if(typeof Object.keys(f)[0]!="string")throw new Error("Invalid JSON Format.  Check the frame values and make sure the name is the first parameter.");o[f[Object.keys(f)[0]]]=f}r.frames=o}var v=Reflect.ownKeys(r.frames);this._spriteMap=v,this._packedAndReady=!0,this._cellData=r.frames}catch(z){throw this._fromPacked=!1,this._packedAndReady=!1,new Error("Invalid JSON from string. Spritesheet managed with constant cell size.")}else{var y=/\./g,D=void 0;do D=y.lastIndex,y.test(t);while(y.lastIndex>0);var w=t.substring(0,D-1)+".json",F=new XMLHttpRequest;F.open("GET",w,!0),F.onerror=function(){_.a.Error("JSON ERROR: Unable to load JSON file."),n._fromPacked=!1,n._packedAndReady=!1},F.onload=function(){try{var z=JSON.parse(F.response),k=Reflect.ownKeys(z.frames);n._spriteMap=k,n._packedAndReady=!0,n._cellData=z.frames}catch(K){throw n._fromPacked=!1,n._packedAndReady=!1,new Error("Invalid JSON format. Please check documentation for format specifications.")}},F.send()}},i.prototype._checkTextureAlpha=function(t,e,n,r,o){if(!t.useAlphaForPicking||!this.texture)return!0;var u=this.texture.getSize();this._textureContent||(this._textureContent=new Uint8Array(u.width*u.height*4),this.texture.readPixels(0,0,this._textureContent));var f=d.c.Vector3[0];f.copyFrom(e.direction),f.normalize(),f.scaleInPlace(n),f.addInPlace(e.origin);var v=(f.x-r.x)/(o.x-r.x)-.5,y=1-(f.y-r.y)/(o.y-r.y)-.5,D=t.angle,w=v*Math.cos(D)-y*Math.sin(D)+.5,F=v*Math.sin(D)+y*Math.cos(D)+.5,z=t._xOffset*u.width+w*t._xSize|0,k=t._yOffset*u.height+F*t._ySize|0;return this._textureContent[4*(z+k*u.width)+3]>.5},i.prototype.intersects=function(t,e,n,r){for(var o=Math.min(this.capacity,this.sprites.length),u=d.e.Zero(),f=d.e.Zero(),v=Number.MAX_VALUE,y=null,D=d.c.Vector3[0],w=d.c.Vector3[1],F=e.getViewMatrix(),z=0;z<o;z++){var k=this.sprites[z];if(k){if(n){if(!n(k))continue}else if(!k.isPickable)continue;if(d.e.TransformCoordinatesToRef(k.position,F,w),u.copyFromFloats(w.x-k.width/2,w.y-k.height/2,w.z),f.copyFromFloats(w.x+k.width/2,w.y+k.height/2,w.z),t.intersectsBoxMinMax(u,f)){var K=d.e.Distance(w,t.origin);if(v>K){if(!this._checkTextureAlpha(k,t,K,u,f))continue;if(v=K,y=k,r)break}}}}if(y){var oe=new Ia.a;F.invertToRef(d.c.Matrix[0]),oe.hit=!0,oe.pickedSprite=y,oe.distance=v;var ae=d.c.Vector3[2];return ae.copyFrom(t.direction),ae.normalize(),ae.scaleInPlace(v),t.origin.addToRef(ae,D),oe.pickedPoint=d.e.TransformCoordinates(D,d.c.Matrix[0]),oe}return null},i.prototype.multiIntersects=function(t,e,n){for(var r,o=Math.min(this.capacity,this.sprites.length),u=d.e.Zero(),f=d.e.Zero(),v=[],y=d.c.Vector3[0].copyFromFloats(0,0,0),D=d.c.Vector3[1].copyFromFloats(0,0,0),w=e.getViewMatrix(),F=0;F<o;F++){var z=this.sprites[F];if(z){if(n){if(!n(z))continue}else if(!z.isPickable)continue;if(d.e.TransformCoordinatesToRef(z.position,w,D),u.copyFromFloats(D.x-z.width/2,D.y-z.height/2,D.z),f.copyFromFloats(D.x+z.width/2,D.y+z.height/2,D.z),t.intersectsBoxMinMax(u,f)){if(r=d.e.Distance(D,t.origin),!this._checkTextureAlpha(z,t,r,u,f))continue;var k=new Ia.a;v.push(k),w.invertToRef(d.c.Matrix[0]),k.hit=!0,k.pickedSprite=z,k.distance=r;var K=d.c.Vector3[2];K.copyFrom(t.direction),K.normalize(),K.scaleInPlace(r),t.origin.addToRef(K,y),k.pickedPoint=d.e.TransformCoordinates(y,d.c.Matrix[0])}}}return v},i.prototype.render=function(){if(!this._fromPacked||this._packedAndReady&&this._spriteMap&&this._cellData){var t=this._scene.getEngine().getDeltaTime();this._packedAndReady?this._spriteRenderer.render(this.sprites,t,this._scene.getViewMatrix(),this._scene.getProjectionMatrix(),this._customUpdate):this._spriteRenderer.render(this.sprites,t,this._scene.getViewMatrix(),this._scene.getProjectionMatrix())}},i.prototype.dispose=function(){this._spriteRenderer&&(this._spriteRenderer.dispose(),this._spriteRenderer=null),this._textureContent=null;var t=this._scene.spriteManagers.indexOf(this);this._scene.spriteManagers.splice(t,1),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear()},i.prototype.serialize=function(t){t===void 0&&(t=!1);var e={};e.name=this.name,e.capacity=this.capacity,e.cellWidth=this.cellWidth,e.cellHeight=this.cellHeight,this.texture&&(t?e.texture=this.texture.serialize():(e.textureUrl=this.texture.name,e.invertY=this.texture._invertY)),e.sprites=[];for(var n=0,r=this.sprites;n<r.length;n++){var o=r[n];e.sprites.push(o.serialize())}return e},i.Parse=function(t,e,n){var r=new i(t.name,"",t.capacity,{width:t.cellWidth,height:t.cellHeight},e);t.texture?r.texture=ke.a.Parse(t.texture,e,n):t.textureName&&(r.texture=new ke.a(n+t.textureUrl,e,!1,t.invertY===void 0||t.invertY));for(var o=0,u=t.sprites;o<u.length;o++){var f=u[o];VE.Parse(f,r)}return r},i.ParseFromFileAsync=function(t,e,n,r){return r===void 0&&(r=""),new Promise(function(o,u){var f=new se.a;f.addEventListener("readystatechange",function(){if(f.readyState==4)if(f.status==200){var v=JSON.parse(f.responseText),y=i.Parse(v,n||Ge.a.LastCreatedScene,r);t&&(y.name=t),o(y)}else u("Unable to load the sprite manager")}),f.open("GET",e),f.send()})},i.CreateFromSnippetAsync=function(t,e,n){var r=this;return n===void 0&&(n=""),t==="_BLANK"?Promise.resolve(new i("Default sprite manager","//playground.babylonjs.com/textures/player.png",500,64,e)):new Promise(function(o,u){var f=new se.a;f.addEventListener("readystatechange",function(){if(f.readyState==4)if(f.status==200){var v=JSON.parse(JSON.parse(f.responseText).jsonPayload),y=JSON.parse(v.spriteManager),D=i.Parse(y,e||Ge.a.LastCreatedScene,n);D.snippetId=t,o(D)}else u("Unable to load the snippet "+t)}),f.open("GET",r.SnippetUrl+"/"+t.replace(/#/g,"/")),f.send()})},i.SnippetUrl="https://snippet.babylonjs.com",i}(),gN=`precision highp float;
varying vec3 vPosition;
varying vec2 vUV;
varying vec2 tUV;
uniform float time;
uniform float spriteCount;
uniform sampler2D spriteSheet;
uniform vec2 spriteMapSize;
uniform vec2 outputSize;
uniform vec2 stageSize;
uniform sampler2D frameMap;
uniform sampler2D tileMaps[LAYERS];
uniform sampler2D animationMap;
uniform vec3 colorMul;
float mt;
const float fdStep=1./4.;
const float aFrameSteps=1./MAX_ANIMATION_FRAMES;
mat4 getFrameData(float frameID){
float fX=frameID/spriteCount;
return mat4(
texture2D(frameMap,vec2(fX,0.),0.),
texture2D(frameMap,vec2(fX,fdStep*1.),0.),
texture2D(frameMap,vec2(fX,fdStep*2.),0.),
vec4(0.)
);
}
void main(){
vec4 color=vec4(0.);
vec2 tileUV=fract(tUV);
#ifdef FLIPU
tileUV.y=1.0-tileUV.y;
#endif
vec2 tileID=floor(tUV);
vec2 sheetUnits=1./spriteMapSize;
float spriteUnits=1./spriteCount;
vec2 stageUnits=1./stageSize;
for(int i=0; i<LAYERS; i++) {
float frameID;
#define LAYER_ID_SWITCH
vec4 animationData=texture2D(animationMap,vec2((frameID+0.5)/spriteCount,0.),0.);
if(animationData.y>0.) {
mt=mod(time*animationData.z,1.0);
for(float f=0.; f<MAX_ANIMATION_FRAMES; f++){
if(animationData.y>mt){
frameID=animationData.x;
break;
}
animationData=texture2D(animationMap,vec2((frameID+0.5)/spriteCount,aFrameSteps*f),0.);
}
}

mat4 frameData=getFrameData(frameID+0.5);
vec2 frameSize=(frameData[0].wz)/spriteMapSize;
vec2 offset=frameData[0].xy*sheetUnits;
vec2 ratio=frameData[2].xy/frameData[0].wz;

if (frameData[2].z == 1.){
tileUV.xy=tileUV.yx;
}
if (i == 0){
color=texture2D(spriteSheet,tileUV*frameSize+offset);
} else {
vec4 nc=texture2D(spriteSheet,tileUV*frameSize+offset);
float alpha=min(color.a+nc.a,1.0);
vec3 mixed=mix(color.xyz,nc.xyz,nc.a);
color=vec4(mixed,alpha);
}
}
color.xyz*=colorMul;
gl_FragColor=color;
}`;Ye.a.ShadersStore.spriteMapPixelShader=gN;var vN=`precision highp float;

attribute vec3 position;
attribute vec3 normal;
attribute vec2 uv;

varying vec3 vPosition;
varying vec2 vUV;
varying vec2 tUV;
varying vec2 stageUnits;
varying vec2 levelUnits;
varying vec2 tileID;

uniform float time;
uniform mat4 worldViewProjection;
uniform vec2 outputSize;
uniform vec2 stageSize;
uniform vec2 spriteMapSize;
uniform float stageScale;
void main() {
vec4 p=vec4( position,1. );
vPosition=p.xyz;
vUV=uv;
tUV=uv*stageSize;
gl_Position=worldViewProjection*p;
}`;Ye.a.ShadersStore.spriteMapVertexShader=vN;var Hi,bN=function(){function i(t,e,n,r,o){var u=this;this.name=t,this.sprites=[],this.atlasJSON=e,this.sprites=this.atlasJSON.frames,this.spriteSheet=n,this.options=r,r.stageSize=r.stageSize||new d.d(1,1),r.outputSize=r.outputSize||r.stageSize,r.outputPosition=r.outputPosition||d.e.Zero(),r.outputRotation=r.outputRotation||d.e.Zero(),r.layerCount=r.layerCount||1,r.maxAnimationFrames=r.maxAnimationFrames||0,r.baseTile=r.baseTile||0,r.flipU=r.flipU||!1,r.colorMultiply=r.colorMultiply||new d.e(1,1,1),this._scene=o,this._frameMap=this._createFrameBuffer(),this._tileMaps=new Array;for(var f=0;f<r.layerCount;f++)this._tileMaps.push(this._createTileBuffer(null,f));this._animationMap=this._createTileAnimationBuffer(null);var v=[];v.push("#define LAYERS "+r.layerCount),r.flipU&&v.push("#define FLIPU"),v.push("#define MAX_ANIMATION_FRAMES "+r.maxAnimationFrames+".0");var y,D=Ye.a.ShadersStore.spriteMapPixelShader;if(this._scene.getEngine().webGLVersion===1)for(y="",f=0;f<r.layerCount;f++)y+="if ("+f+" == i) { frameID = texture2D(tileMaps["+f+"], (tileID + 0.5) / stageSize, 0.).x; }";else{for(y="switch(i) {",f=0;f<r.layerCount;f++)y+="case "+f+" : frameID = texture(tileMaps["+f+"], (tileID + 0.5) / stageSize, 0.).x;",y+="break;";y+="}"}Ye.a.ShadersStore["spriteMap"+this.name+"PixelShader"]=D.replace("#define LAYER_ID_SWITCH",y),this._material=new Ah.a("spriteMap:"+this.name,this._scene,{vertex:"spriteMap",fragment:"spriteMap"+this.name},{defines:v,attributes:["position","normal","uv"],uniforms:["worldViewProjection","time","stageSize","outputSize","spriteMapSize","spriteCount","time","colorMul","mousePosition","curTile","flipU"],samplers:["spriteSheet","frameMap","tileMaps","animationMap"],needAlphaBlending:!0}),this._time=0,this._material.setFloat("spriteCount",this.spriteCount),this._material.setVector2("stageSize",r.stageSize),this._material.setVector2("outputSize",r.outputSize),this._material.setTexture("spriteSheet",this.spriteSheet),this._material.setVector2("spriteMapSize",new d.d(1,1)),this._material.setVector3("colorMul",r.colorMultiply);var w=0,F=function(){u.spriteSheet&&u.spriteSheet.isReady()&&u.spriteSheet._texture?u._material.setVector2("spriteMapSize",new d.d(u.spriteSheet._texture.baseWidth||1,u.spriteSheet._texture.baseHeight||1)):w<100&&setTimeout(function(){w++,F()},100)};F(),this._material.setVector3("colorMul",r.colorMultiply),this._material.setTexture("frameMap",this._frameMap),this._material.setTextureArray("tileMaps",this._tileMaps),this._material.setTexture("animationMap",this._animationMap),this._material.setFloat("time",this._time),this._output=Ne.a.CreatePlane(t+":output",1,o,!0),this._output.scaling.x=r.outputSize.x,this._output.scaling.y=r.outputSize.y,this.position=r.outputPosition,this.rotation=r.outputRotation,this._scene.onBeforeRenderObservable.add(function(){u._time+=u._scene.getEngine().getDeltaTime(),u._material.setFloat("time",u._time)}),this._output.material=this._material}return Object.defineProperty(i.prototype,"spriteCount",{get:function(){return this.sprites.length},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"position",{get:function(){return this._output.position},set:function(t){this._output.position=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"rotation",{get:function(){return this._output.rotation},set:function(t){this._output.rotation=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"animationMap",{get:function(){return this._animationMap},set:function(t){var e=t._texture._bufferView,n=this._createTileAnimationBuffer(e);this._animationMap.dispose(),this._animationMap=n,this._material.setTexture("animationMap",this._animationMap)},enumerable:!1,configurable:!0}),i.prototype.getTileID=function(){var t=this.getMousePosition();return t.multiplyInPlace(this.options.stageSize||d.d.Zero()),t.x=Math.floor(t.x),t.y=Math.floor(t.y),t},i.prototype.getMousePosition=function(){var t=this._output,e=this._scene.pick(this._scene.pointerX,this._scene.pointerY,function(r){return r===t});if(!e||!e.hit||!e.getTextureCoordinates)return new d.d(-1,-1);var n=e.getTextureCoordinates();return n||new d.d(-1,-1)},i.prototype._createFrameBuffer=function(){for(var t=new Array,e=0;e<this.spriteCount;e++)t.push(0,0,0,0),t.push(0,0,0,0),t.push(0,0,0,0),t.push(0,0,0,0);for(e=0;e<this.spriteCount;e++){var n=this.sprites[e].frame,r=this.sprites[e].spriteSourceSize,o=this.sprites[e].sourceSize,u=this.sprites[e].rotated?1:0,f=this.sprites[e].trimmed?1:0;t[4*e]=n.x,t[4*e+1]=n.y,t[4*e+2]=n.w,t[4*e+3]=n.h,t[4*e+4*this.spriteCount]=r.x,t[4*e+1+4*this.spriteCount]=r.y,t[4*e+3+4*this.spriteCount]=r.h,t[4*e+8*this.spriteCount]=o.w,t[4*e+1+8*this.spriteCount]=o.h,t[4*e+2+8*this.spriteCount]=u,t[4*e+3+8*this.spriteCount]=f}var v=new Float32Array(t);return Pr.CreateRGBATexture(v,this.spriteCount,4,this._scene,!1,!1,ke.a.NEAREST_NEAREST,Ge.a.TEXTURETYPE_FLOAT)},i.prototype._createTileBuffer=function(t,e){e===void 0&&(e=0);var n=new Array,r=this.options.stageSize.y||0,o=this.options.stageSize.x||0;if(t)n=t;else{var u=this.options.baseTile;e!=0&&(u=0);for(var f=0;f<r;f++)for(var v=0;v<4*o;v+=4)n.push(u,0,0,0)}var y=new Float32Array(n);return Pr.CreateRGBATexture(y,o,r,this._scene,!1,!1,ke.a.NEAREST_NEAREST,Ge.a.TEXTURETYPE_FLOAT)},i.prototype.changeTiles=function(t,e,n){var r;if(t===void 0&&(t=0),n===void 0&&(n=0),(r=this._tileMaps[t]._texture._bufferView)!==null){var o=new Array;e instanceof d.d?o.push(e):o=e;for(var u=this.options.stageSize.x||0,f=0;f<o.length;f++){var v=o[f];v.x=Math.floor(v.x),v.y=Math.floor(v.y),r[4*v.x+v.y*(4*u)]=n}var y=this._createTileBuffer(r);this._tileMaps[t].dispose(),this._tileMaps[t]=y,this._material.setTextureArray("tileMap",this._tileMaps)}},i.prototype._createTileAnimationBuffer=function(t){var e,n=new Array;if(t)e=t;else{for(var r=0;r<this.spriteCount;r++){n.push(0,0,0,0);for(var o=1;o<(this.options.maxAnimationFrames||4);)n.push(0,0,0,0),o++}e=new Float32Array(n)}return Pr.CreateRGBATexture(e,this.spriteCount,this.options.maxAnimationFrames||4,this._scene,!1,!1,ke.a.NEAREST_NEAREST,Ge.a.TEXTURETYPE_FLOAT)},i.prototype.addAnimationToTile=function(t,e,n,r,o){t===void 0&&(t=0),e===void 0&&(e=0),n===void 0&&(n=0),r===void 0&&(r=0),o===void 0&&(o=1);var u=this._animationMap._texture._bufferView,f=4*t+4*this.spriteCount*e;if(u){u[f]=n,u[f+1]=r,u[f+2]=o;var v=this._createTileAnimationBuffer(u);this._animationMap.dispose(),this._animationMap=v,this._material.setTexture("animationMap",this._animationMap)}},i.prototype.saveTileMaps=function(){for(var t="",e=0;e<this._tileMaps.length;e++)e>0&&(t+=`
\r`),t+=this._tileMaps[e]._texture._bufferView.toString();var n=document.createElement("a");n.href="data:octet/stream;charset=utf-8,"+encodeURI(t),n.target="_blank",n.download=this.name+".tilemaps",n.click(),n.remove()},i.prototype.loadTileMaps=function(t){var e=this,n=new XMLHttpRequest;n.open("GET",t);var r=this.options.layerCount||0;n.onload=function(){for(var o=n.response.split(`
\r`),u=0;u<r;u++){var f=o[u].split(",").map(Number),v=e._createTileBuffer(f);e._tileMaps[u].dispose(),e._tileMaps[u]=v}e._material.setTextureArray("tileMap",e._tileMaps)},n.send()},i.prototype.dispose=function(){this._output.dispose(),this._material.dispose(),this._animationMap.dispose(),this._tileMaps.forEach(function(t){t.dispose()}),this._frameMap.dispose()},i}(),yN=function(i){function t(e,n,r,o,u,f,v){u===void 0&&(u=null),f===void 0&&(f=.01),v===void 0&&(v=ke.a.TRILINEAR_SAMPLINGMODE);var y=i.call(this,e,n,r,64,o,f,v,!0,u)||this;return y.name=e,y}return Object(p.d)(t,i),t}(jE),TN=c(143),EN=c(141),SN=c(142),xN=c(139);(function(i){i[i.INIT=0]="INIT",i[i.RUNNING=1]="RUNNING",i[i.DONE=2]="DONE",i[i.ERROR=3]="ERROR"})(Hi||(Hi={}));var h_,Wi=function(){function i(t){this.name=t,this._isCompleted=!1,this._taskState=Hi.INIT}return Object.defineProperty(i.prototype,"isCompleted",{get:function(){return this._isCompleted},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"taskState",{get:function(){return this._taskState},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"errorObject",{get:function(){return this._errorObject},enumerable:!1,configurable:!0}),i.prototype._setErrorObject=function(t,e){this._errorObject||(this._errorObject={message:t,exception:e})},i.prototype.run=function(t,e,n){var r=this;this._taskState=Hi.RUNNING,this.runTask(t,function(){r.onDoneCallback(e,n)},function(o,u){r.onErrorCallback(n,o,u)})},i.prototype.runTask=function(t,e,n){throw new Error("runTask is not implemented")},i.prototype.reset=function(){this._taskState=Hi.INIT},i.prototype.onErrorCallback=function(t,e,n){this._taskState=Hi.ERROR,this._errorObject={message:e,exception:n},this.onError&&this.onError(this,e,n),t()},i.prototype.onDoneCallback=function(t,e){try{this._taskState=Hi.DONE,this._isCompleted=!0,this.onSuccess&&this.onSuccess(this),t()}catch(n){this.onErrorCallback(e,"Task is done, error executing success callback(s)",n)}},i}(),zE=function(i,t,e){this.remainingCount=i,this.totalCount=t,this.task=e},GE=function(i){function t(e,n,r,o){var u=i.call(this,e)||this;return u.name=e,u.meshesNames=n,u.rootUrl=r,u.sceneFilename=o,u}return Object(p.d)(t,i),t.prototype.runTask=function(e,n,r){var o=this;an.LoadAssetContainer(this.rootUrl,this.sceneFilename,e,function(u){o.loadedContainer=u,o.loadedMeshes=u.meshes,o.loadedParticleSystems=u.particleSystems,o.loadedSkeletons=u.skeletons,o.loadedAnimationGroups=u.animationGroups,n()},null,function(u,f,v){r(f,v)})},t}(Wi),HE=function(i){function t(e,n,r,o){var u=i.call(this,e)||this;return u.name=e,u.meshesNames=n,u.rootUrl=r,u.sceneFilename=o,u}return Object(p.d)(t,i),t.prototype.runTask=function(e,n,r){var o=this;an.ImportMesh(this.meshesNames,this.rootUrl,this.sceneFilename,e,function(u,f,v,y){o.loadedMeshes=u,o.loadedParticleSystems=f,o.loadedSkeletons=v,o.loadedAnimationGroups=y,n()},null,function(u,f,v){r(f,v)})},t}(Wi),WE=function(i){function t(e,n){var r=i.call(this,e)||this;return r.name=e,r.url=n,r}return Object(p.d)(t,i),t.prototype.runTask=function(e,n,r){var o=this;e._loadFile(this.url,function(u){o.text=u,n()},void 0,!1,!1,function(u,f){u&&r(u.status+" "+u.statusText,f)})},t}(Wi),XE=function(i){function t(e,n){var r=i.call(this,e)||this;return r.name=e,r.url=n,r}return Object(p.d)(t,i),t.prototype.runTask=function(e,n,r){var o=this;e._loadFile(this.url,function(u){o.data=u,n()},void 0,!0,!0,function(u,f){u&&r(u.status+" "+u.statusText,f)})},t}(Wi),YE=function(i){function t(e,n){var r=i.call(this,e)||this;return r.name=e,r.url=n,r}return Object(p.d)(t,i),t.prototype.runTask=function(e,n,r){var o=this,u=new Image;et.b.SetCorsBehavior(this.url,u),u.onload=function(){o.image=u,n()},u.onerror=function(f){r("Error loading image",f)},u.src=this.url},t}(Wi),KE=function(i){function t(e,n,r,o,u){o===void 0&&(o=!0),u===void 0&&(u=ke.a.TRILINEAR_SAMPLINGMODE);var f=i.call(this,e)||this;return f.name=e,f.url=n,f.noMipmap=r,f.invertY=o,f.samplingMode=u,f}return Object(p.d)(t,i),t.prototype.runTask=function(e,n,r){this.texture=new ke.a(this.url,e,this.noMipmap,this.invertY,this.samplingMode,function(){n()},function(o,u){r(o,u)})},t}(Wi),QE=function(i){function t(e,n,r,o,u){var f=i.call(this,e)||this;return f.name=e,f.url=n,f.extensions=r,f.noMipmap=o,f.files=u,f}return Object(p.d)(t,i),t.prototype.runTask=function(e,n,r){this.texture=new Ei(this.url,e,this.extensions,this.noMipmap,this.files,function(){n()},function(o,u){r(o,u)})},t}(Wi),qE=function(i){function t(e,n,r,o,u,f,v){o===void 0&&(o=!1),u===void 0&&(u=!0),f===void 0&&(f=!1),v===void 0&&(v=!1);var y=i.call(this,e)||this;return y.name=e,y.url=n,y.size=r,y.noMipmap=o,y.generateHarmonics=u,y.gammaSpace=f,y.reserved=v,y}return Object(p.d)(t,i),t.prototype.runTask=function(e,n,r){this.texture=new Th(this.url,e,this.size,this.noMipmap,this.generateHarmonics,this.gammaSpace,this.reserved,function(){n()},function(o,u){r(o,u)})},t}(Wi),ZE=function(i){function t(e,n,r,o,u){o===void 0&&(o=!1),u===void 0&&(u=!0);var f=i.call(this,e)||this;return f.name=e,f.url=n,f.size=r,f.noMipmap=o,f.gammaSpace=u,f}return Object(p.d)(t,i),t.prototype.runTask=function(e,n,r){this.texture=new W0(this.url,e,this.size,this.noMipmap,this.gammaSpace,function(){n()},function(o,u){r(o,u)})},t}(Wi),AN=function(){function i(t){this._isLoading=!1,this._tasks=new Array,this._waitingTasksCount=0,this._totalTasksCount=0,this.onTaskSuccessObservable=new S.c,this.onTaskErrorObservable=new S.c,this.onTasksDoneObservable=new S.c,this.onProgressObservable=new S.c,this.useDefaultLoadingScreen=!0,this.autoHideLoadingUI=!0,this._scene=t}return i.prototype.addContainerTask=function(t,e,n,r){var o=new GE(t,e,n,r);return this._tasks.push(o),o},i.prototype.addMeshTask=function(t,e,n,r){var o=new HE(t,e,n,r);return this._tasks.push(o),o},i.prototype.addTextFileTask=function(t,e){var n=new WE(t,e);return this._tasks.push(n),n},i.prototype.addBinaryFileTask=function(t,e){var n=new XE(t,e);return this._tasks.push(n),n},i.prototype.addImageTask=function(t,e){var n=new YE(t,e);return this._tasks.push(n),n},i.prototype.addTextureTask=function(t,e,n,r,o){o===void 0&&(o=ke.a.TRILINEAR_SAMPLINGMODE);var u=new KE(t,e,n,r,o);return this._tasks.push(u),u},i.prototype.addCubeTextureTask=function(t,e,n,r,o){var u=new QE(t,e,n,r,o);return this._tasks.push(u),u},i.prototype.addHDRCubeTextureTask=function(t,e,n,r,o,u,f){r===void 0&&(r=!1),o===void 0&&(o=!0),u===void 0&&(u=!1),f===void 0&&(f=!1);var v=new qE(t,e,n,r,o,u,f);return this._tasks.push(v),v},i.prototype.addEquiRectangularCubeTextureAssetTask=function(t,e,n,r,o){r===void 0&&(r=!1),o===void 0&&(o=!0);var u=new ZE(t,e,n,r,o);return this._tasks.push(u),u},i.prototype.removeTask=function(t){var e=this._tasks.indexOf(t);e>-1&&this._tasks.splice(e,1)},i.prototype._decreaseWaitingTasksCount=function(t){this._waitingTasksCount--;try{this.onProgress&&this.onProgress(this._waitingTasksCount,this._totalTasksCount,t),this.onProgressObservable.notifyObservers(new zE(this._waitingTasksCount,this._totalTasksCount,t))}catch(u){_.a.Error("Error running progress callbacks."),console.log(u)}if(this._waitingTasksCount===0){try{var e=this._tasks.slice();this.onFinish&&this.onFinish(e);for(var n=0,r=e;n<r.length;n++)if((t=r[n]).taskState===Hi.DONE){var o=this._tasks.indexOf(t);o>-1&&this._tasks.splice(o,1)}this.onTasksDoneObservable.notifyObservers(this._tasks)}catch(u){_.a.Error("Error running tasks-done callbacks."),console.log(u)}this._isLoading=!1,this.autoHideLoadingUI&&this._scene.getEngine().hideLoadingUI()}},i.prototype._runTask=function(t){var e=this,n=function(r,o){t._setErrorObject(r,o),e.onTaskError&&e.onTaskError(t),e.onTaskErrorObservable.notifyObservers(t),e._decreaseWaitingTasksCount(t)};t.run(this._scene,function(){try{e.onTaskSuccess&&e.onTaskSuccess(t),e.onTaskSuccessObservable.notifyObservers(t),e._decreaseWaitingTasksCount(t)}catch(r){n("Error executing task success callbacks",r)}},n)},i.prototype.reset=function(){return this._isLoading=!1,this._tasks=new Array,this},i.prototype.load=function(){if(this._isLoading)return this;if(this._isLoading=!0,this._waitingTasksCount=this._tasks.length,this._totalTasksCount=this._tasks.length,this._waitingTasksCount===0)return this._isLoading=!1,this.onFinish&&this.onFinish(this._tasks),this.onTasksDoneObservable.notifyObservers(this._tasks),this;this.useDefaultLoadingScreen&&this._scene.getEngine().displayLoadingUI();for(var t=0;t<this._tasks.length;t++){var e=this._tasks[t];e.taskState===Hi.INIT&&this._runTask(e)}return this},i.prototype.loadAsync=function(){var t=this;return new Promise(function(e,n){t._isLoading?e():(t.onTasksDoneObservable.addOnce(function(r){r&&r.length?n(r):e()}),t.load())})},i}(),PN=function(){function i(){var t=this;this.promise=new Promise(function(e,n){t._resolve=e,t._reject=n})}return Object.defineProperty(i.prototype,"resolve",{get:function(){return this._resolve},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"reject",{get:function(){return this._reject},enumerable:!1,configurable:!0}),i}(),CN=function(){function i(t,e){this._meshesOrigins=[],this._toCenterVectors=[],this._scaledDirection=d.e.Zero(),this._newPosition=d.e.Zero(),this._centerPosition=d.e.Zero(),this._meshes=t.slice(),e?this._centerMesh=e:this._setCenterMesh();var n=this._meshes.indexOf(this._centerMesh);n>=0&&this._meshes.splice(n,1),this._centerPosition=this._centerMesh.getAbsolutePosition().clone();for(var r=0;r<this._meshes.length;r++)if(this._meshes[r]){var o=this._meshes[r];this._meshesOrigins[r]=o.getAbsolutePosition().clone(),this._toCenterVectors[r]=d.e.Zero(),o._boundingInfo&&this._centerMesh._boundingInfo&&o._boundingInfo.boundingBox.centerWorld.subtractToRef(this._centerMesh._boundingInfo.boundingBox.centerWorld,this._toCenterVectors[r])}}return i.prototype._setCenterMesh=function(){for(var t=d.e.Zero(),e=d.e.Zero(),n=Number.MAX_VALUE,r=0;r<this._meshes.length;r++)this._meshes[r]&&(u=(o=this._meshes[r]).getBoundingInfo())&&e.addInPlace(u.boundingBox.centerWorld);for(t=e.scale(1/this._meshes.length),r=0;r<this._meshes.length;r++){var o,u;if(this._meshes[r]&&(u=(o=this._meshes[r]).getBoundingInfo())){var f=u.boundingBox.centerWorld.subtract(t).lengthSquared();f<n&&(this._centerMesh=o,n=f)}}},i.prototype.getClassName=function(){return"MeshExploder"},i.prototype.getMeshes=function(){var t=this._meshes.slice();return t.unshift(this._centerMesh),t},i.prototype.explode=function(t){t===void 0&&(t=1);for(var e=0;e<this._meshes.length;e++)this._meshes[e]&&this._meshesOrigins[e]&&this._toCenterVectors[e]&&(this._toCenterVectors[e].scaleToRef(t,this._scaledDirection),this._meshesOrigins[e].addToRef(this._scaledDirection,this._newPosition),this._meshes[e].setAbsolutePosition(this._newPosition));this._centerMesh.setAbsolutePosition(this._centerPosition)},i}(),RN=function(){function i(t,e,n,r,o,u,f,v,y){this.onProcessFileCallback=function(){return!0},this._engine=t,this._currentScene=e,this._sceneLoadedCallback=n,this._progressCallback=r,this._additionalRenderLoopLogicCallback=o,this._textureLoadingCallback=u,this._startingProcessingFilesCallback=f,this._onReloadCallback=v,this._errorCallback=y}return Object.defineProperty(i,"FilesToLoad",{get:function(){return Gp.a.FilesToLoad},enumerable:!1,configurable:!0}),i.prototype.monitorElementForDragNDrop=function(t){var e=this;t&&(this._elementToMonitor=t,this._dragEnterHandler=function(n){e.drag(n)},this._dragOverHandler=function(n){e.drag(n)},this._dropHandler=function(n){e.drop(n)},this._elementToMonitor.addEventListener("dragenter",this._dragEnterHandler,!1),this._elementToMonitor.addEventListener("dragover",this._dragOverHandler,!1),this._elementToMonitor.addEventListener("drop",this._dropHandler,!1))},Object.defineProperty(i.prototype,"filesToLoad",{get:function(){return this._filesToLoad},enumerable:!1,configurable:!0}),i.prototype.dispose=function(){this._elementToMonitor&&(this._elementToMonitor.removeEventListener("dragenter",this._dragEnterHandler),this._elementToMonitor.removeEventListener("dragover",this._dragOverHandler),this._elementToMonitor.removeEventListener("drop",this._dropHandler))},i.prototype.renderFunction=function(){if(this._additionalRenderLoopLogicCallback&&this._additionalRenderLoopLogicCallback(),this._currentScene){if(this._textureLoadingCallback){var t=this._currentScene.getWaitingItemsCount();t>0&&this._textureLoadingCallback(t)}this._currentScene.render()}},i.prototype.drag=function(t){t.stopPropagation(),t.preventDefault()},i.prototype.drop=function(t){t.stopPropagation(),t.preventDefault(),this.loadFiles(t)},i.prototype._traverseFolder=function(t,e,n,r){var o=this,u=t.createReader(),f=t.fullPath.replace(/^\//,"").replace(/(.+?)\/?$/,"$1/");u.readEntries(function(v){n.count+=v.length;for(var y=0,D=v;y<D.length;y++){var w=D[y];w.isFile?w.file(function(F){F.correctName=f+F.name,e.push(F),--n.count==0&&r()}):w.isDirectory&&o._traverseFolder(w,e,n,r)}--n.count==0&&r()})},i.prototype._processFiles=function(t){for(var e=0;e<t.length;e++){var n=t[e].correctName.toLowerCase(),r=n.split(".").pop();this.onProcessFileCallback(t[e],n,r)&&(an.IsPluginForExtensionAvailable("."+r)&&(this._sceneFileToLoad=t[e]),i.FilesToLoad[n]=t[e])}},i.prototype.loadFiles=function(t){var e=this;if(t&&t.dataTransfer&&t.dataTransfer.files&&(this._filesToLoad=t.dataTransfer.files),t&&t.target&&t.target.files&&(this._filesToLoad=t.target.files),this._filesToLoad&&this._filesToLoad.length!==0&&(this._startingProcessingFilesCallback&&this._startingProcessingFilesCallback(this._filesToLoad),this._filesToLoad&&this._filesToLoad.length>0)){for(var n=new Array,r=[],o=t.dataTransfer?t.dataTransfer.items:null,u=0;u<this._filesToLoad.length;u++){var f=this._filesToLoad[u],v=f.name.toLowerCase(),y=void 0;if(f.correctName=v,o){var D=o[u];D.getAsEntry?y=D.getAsEntry():D.webkitGetAsEntry&&(y=D.webkitGetAsEntry())}y&&y.isDirectory?r.push(y):n.push(f)}if(r.length===0)this._processFiles(n),this._processReload();else for(var w={count:r.length},F=0,z=r;F<z.length;F++){var k=z[F];this._traverseFolder(k,n,w,function(){e._processFiles(n),w.count===0&&e._processReload()})}}},i.prototype._processReload=function(){this._onReloadCallback?this._onReloadCallback(this._sceneFileToLoad):this.reload()},i.prototype.reload=function(){var t=this;this._sceneFileToLoad?(this._currentScene&&(_.a.errorsCount>0&&_.a.ClearLogCache(),this._engine.stopRenderLoop()),an.ShowLoadingScreen=!1,this._engine.displayLoadingUI(),an.LoadAsync("file:",this._sceneFileToLoad,this._engine,function(e){t._progressCallback&&t._progressCallback(e)}).then(function(e){t._currentScene&&t._currentScene.dispose(),t._currentScene=e,t._sceneLoadedCallback&&t._sceneLoadedCallback(t._sceneFileToLoad,t._currentScene),t._currentScene.executeWhenReady(function(){t._engine.hideLoadingUI(),t._engine.runRenderLoop(function(){t.renderFunction()})})}).catch(function(e){t._engine.hideLoadingUI(),t._errorCallback&&t._errorCallback(t._sceneFileToLoad,t._currentScene,e.message)})):_.a.Error("Please provide a valid .babylon file.")},i}(),$E=c(146),ON=c(145),Xi=function(){function i(t){t===void 0&&(t=0),this.priority=t}return i.prototype.getDescription=function(){return""},i.prototype.apply=function(t,e){return!0},i}(),kh=function(i){function t(e,n,r){e===void 0&&(e=0),n===void 0&&(n=1024),r===void 0&&(r=.5);var o=i.call(this,e)||this;return o.priority=e,o.maximumSize=n,o.step=r,o}return Object(p.d)(t,i),t.prototype.getDescription=function(){return"Reducing render target texture size to "+this.maximumSize},t.prototype.apply=function(e,n){for(var r=!0,o=0;o<e.textures.length;o++){var u=e.textures[o];if(u.canRescale&&!u.getContext){var f=u.getSize();Math.max(f.width,f.height)>this.maximumSize&&(u.scale(this.step),r=!1)}}return r},t}(Xi),d_=function(i){function t(e,n,r){e===void 0&&(e=0),n===void 0&&(n=2),r===void 0&&(r=.25);var o=i.call(this,e)||this;return o.priority=e,o.maximumScale=n,o.step=r,o._currentScale=-1,o._directionOffset=1,o}return Object(p.d)(t,i),t.prototype.getDescription=function(){return"Setting hardware scaling level to "+this._currentScale},t.prototype.apply=function(e,n){return this._currentScale===-1&&(this._currentScale=e.getEngine().getHardwareScalingLevel(),this._currentScale>this.maximumScale&&(this._directionOffset=-1)),this._currentScale+=this._directionOffset*this.step,e.getEngine().setHardwareScalingLevel(this._currentScale),this._directionOffset===1?this._currentScale>=this.maximumScale:this._currentScale<=this.maximumScale},t}(Xi),jh=function(i){function t(){return i!==null&&i.apply(this,arguments)||this}return Object(p.d)(t,i),t.prototype.getDescription=function(){return"Turning shadows on/off"},t.prototype.apply=function(e,n){return e.shadowsEnabled=n.isInImprovementMode,!0},t}(Xi),zh=function(i){function t(){return i!==null&&i.apply(this,arguments)||this}return Object(p.d)(t,i),t.prototype.getDescription=function(){return"Turning post-processes on/off"},t.prototype.apply=function(e,n){return e.postProcessesEnabled=n.isInImprovementMode,!0},t}(Xi),Gh=function(i){function t(){return i!==null&&i.apply(this,arguments)||this}return Object(p.d)(t,i),t.prototype.getDescription=function(){return"Turning lens flares on/off"},t.prototype.apply=function(e,n){return e.lensFlaresEnabled=n.isInImprovementMode,!0},t}(Xi),JE=function(i){function t(){return i!==null&&i.apply(this,arguments)||this}return Object(p.d)(t,i),t.prototype.getDescription=function(){return this.onGetDescription?this.onGetDescription():"Running user defined callback"},t.prototype.apply=function(e,n){return!this.onApply||this.onApply(e,n)},t}(Xi),Hh=function(i){function t(){return i!==null&&i.apply(this,arguments)||this}return Object(p.d)(t,i),t.prototype.getDescription=function(){return"Turning particles on/off"},t.prototype.apply=function(e,n){return e.particlesEnabled=n.isInImprovementMode,!0},t}(Xi),f_=function(i){function t(){return i!==null&&i.apply(this,arguments)||this}return Object(p.d)(t,i),t.prototype.getDescription=function(){return"Turning render targets off"},t.prototype.apply=function(e,n){return e.renderTargetsEnabled=n.isInImprovementMode,!0},t}(Xi),Wh=function(i){function t(){var e=i!==null&&i.apply(this,arguments)||this;return e._canBeMerged=function(n){if(!(n instanceof Ne.a))return!1;var r=n;return!r.isDisposed()&&!(!r.isVisible||!r.isEnabled())&&!(r.instances.length>0)&&!r.skeleton&&!r.hasLODLevels},e}return Object(p.d)(t,i),Object.defineProperty(t,"UpdateSelectionTree",{get:function(){return t._UpdateSelectionTree},set:function(e){t._UpdateSelectionTree=e},enumerable:!1,configurable:!0}),t.prototype.getDescription=function(){return"Merging similar meshes together"},t.prototype.apply=function(e,n,r){for(var o=e.meshes.slice(0),u=o.length,f=0;f<u;f++){var v=new Array,y=o[f];if(this._canBeMerged(y)){v.push(y);for(var D=f+1;D<u;D++){var w=o[D];this._canBeMerged(w)&&w.material===y.material&&w.checkCollisions===y.checkCollisions&&(v.push(w),u--,o.splice(D,1),D--)}v.length<2||Ne.a.MergeMeshes(v,void 0,!0)}}var F=e;return F.createOrUpdateSelectionOctree&&(r!=null?r&&F.createOrUpdateSelectionOctree():t.UpdateSelectionTree&&F.createOrUpdateSelectionOctree()),!0},t._UpdateSelectionTree=!1,t}(Xi),p_=function(){function i(t,e){t===void 0&&(t=60),e===void 0&&(e=2e3),this.targetFrameRate=t,this.trackerDuration=e,this.optimizations=new Array}return i.prototype.addOptimization=function(t){return this.optimizations.push(t),this},i.prototype.addCustomOptimization=function(t,e,n){n===void 0&&(n=0);var r=new JE(n);return r.onApply=t,r.onGetDescription=e,this.optimizations.push(r),this},i.LowDegradationAllowed=function(t){var e=new i(t),n=0;return e.addOptimization(new Wh(n)),e.addOptimization(new jh(n)),e.addOptimization(new Gh(n)),n++,e.addOptimization(new zh(n)),e.addOptimization(new Hh(n)),n++,e.addOptimization(new kh(n,1024)),e},i.ModerateDegradationAllowed=function(t){var e=new i(t),n=0;return e.addOptimization(new Wh(n)),e.addOptimization(new jh(n)),e.addOptimization(new Gh(n)),n++,e.addOptimization(new zh(n)),e.addOptimization(new Hh(n)),n++,e.addOptimization(new kh(n,512)),n++,e.addOptimization(new f_(n)),n++,e.addOptimization(new d_(n,2)),e},i.HighDegradationAllowed=function(t){var e=new i(t),n=0;return e.addOptimization(new Wh(n)),e.addOptimization(new jh(n)),e.addOptimization(new Gh(n)),n++,e.addOptimization(new zh(n)),e.addOptimization(new Hh(n)),n++,e.addOptimization(new kh(n,256)),n++,e.addOptimization(new f_(n)),n++,e.addOptimization(new d_(n,4)),e},i}(),MN=function(){function i(t,e,n,r){var o=this;if(n===void 0&&(n=!0),r===void 0&&(r=!1),this._isRunning=!1,this._currentPriorityLevel=0,this._targetFrameRate=60,this._trackerDuration=2e3,this._currentFrameRate=0,this._improvementMode=!1,this.onSuccessObservable=new S.c,this.onNewOptimizationAppliedObservable=new S.c,this.onFailureObservable=new S.c,this._options=e||new p_,this._options.targetFrameRate&&(this._targetFrameRate=this._options.targetFrameRate),this._options.trackerDuration&&(this._trackerDuration=this._options.trackerDuration),n)for(var u=0,f=0,v=this._options.optimizations;f<v.length;f++)v[f].priority=u++;this._improvementMode=r,this._scene=t||ne.a.LastCreatedScene,this._sceneDisposeObserver=this._scene.onDisposeObservable.add(function(){o._sceneDisposeObserver=null,o.dispose()})}return Object.defineProperty(i.prototype,"isInImprovementMode",{get:function(){return this._improvementMode},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"currentPriorityLevel",{get:function(){return this._currentPriorityLevel},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"currentFrameRate",{get:function(){return this._currentFrameRate},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"targetFrameRate",{get:function(){return this._targetFrameRate},set:function(t){this._targetFrameRate=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"trackerDuration",{get:function(){return this._trackerDuration},set:function(t){this._trackerDuration=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"optimizations",{get:function(){return this._options.optimizations},enumerable:!1,configurable:!0}),i.prototype.stop=function(){this._isRunning=!1},i.prototype.reset=function(){this._currentPriorityLevel=0},i.prototype.start=function(){var t=this;this._isRunning||(this._isRunning=!0,this._scene.executeWhenReady(function(){setTimeout(function(){t._checkCurrentState()},t._trackerDuration)}))},i.prototype._checkCurrentState=function(){var t=this;if(this._isRunning){var e=this._scene,n=this._options;if(this._currentFrameRate=Math.round(e.getEngine().getFps()),this._improvementMode&&this._currentFrameRate<=this._targetFrameRate||!this._improvementMode&&this._currentFrameRate>=this._targetFrameRate)return this._isRunning=!1,void this.onSuccessObservable.notifyObservers(this);for(var r=!0,o=!0,u=0;u<n.optimizations.length;u++){var f=n.optimizations[u];f.priority===this._currentPriorityLevel&&(o=!1,r=r&&f.apply(e,this),this.onNewOptimizationAppliedObservable.notifyObservers(f))}if(o)return this._isRunning=!1,void this.onFailureObservable.notifyObservers(this);r&&this._currentPriorityLevel++,e.executeWhenReady(function(){setTimeout(function(){t._checkCurrentState()},t._trackerDuration)})}},i.prototype.dispose=function(){this.stop(),this.onSuccessObservable.clear(),this.onFailureObservable.clear(),this.onNewOptimizationAppliedObservable.clear(),this._sceneDisposeObserver&&this._scene.onDisposeObservable.remove(this._sceneDisposeObserver)},i.OptimizeAsync=function(t,e,n,r){var o=new i(t,e||p_.ModerateDegradationAllowed(),!1);return n&&o.onSuccessObservable.add(function(){n()}),r&&o.onFailureObservable.add(function(){r()}),o.start(),o},i}(),Xh=[],m_=function(i,t){Xh[i.id]||i.doNotSerialize||(t.vertexData.push(i.serializeVerticeData()),Xh[i.id]=!0)},eS=function(i,t){var e={},n=i._geometry;return n&&(i.getScene().getGeometryByID(n.id)||m_(n,t.geometries)),i.serialize&&i.serialize(e),e},__=function(){function i(){}return i.ClearCache=function(){Xh=[]},i.Serialize=function(t){var e,n,r,o={};if(i.ClearCache(),o.useDelayedTextureLoading=t.useDelayedTextureLoading,o.autoClear=t.autoClear,o.clearColor=t.clearColor.asArray(),o.ambientColor=t.ambientColor.asArray(),o.gravity=t.gravity.asArray(),o.collisionsEnabled=t.collisionsEnabled,t.fogMode&&t.fogMode!==0&&(o.fogMode=t.fogMode,o.fogColor=t.fogColor.asArray(),o.fogStart=t.fogStart,o.fogEnd=t.fogEnd,o.fogDensity=t.fogDensity),t.isPhysicsEnabled()){var u=t.getPhysicsEngine();u&&(o.physicsEnabled=!0,o.physicsGravity=u.gravity.asArray(),o.physicsEngine=u.getPhysicsPluginName())}t.metadata&&(o.metadata=t.metadata),o.morphTargetManagers=[];for(var f=0,v=t.meshes;f<v.length;f++){var y=(ue=v[f]).morphTargetManager;y&&o.morphTargetManagers.push(y.serialize())}for(o.lights=[],e=0;e<t.lights.length;e++)(n=t.lights[e]).doNotSerialize||o.lights.push(n.serialize());for(o.cameras=[],e=0;e<t.cameras.length;e++){var D=t.cameras[e];D.doNotSerialize||o.cameras.push(D.serialize())}if(t.activeCamera&&(o.activeCameraID=t.activeCamera.id),B.a.AppendSerializedAnimations(t,o),t.animationGroups&&t.animationGroups.length>0){o.animationGroups=[];for(var w=0;w<t.animationGroups.length;w++){var F=t.animationGroups[w];o.animationGroups.push(F.serialize())}}if(t.reflectionProbes&&t.reflectionProbes.length>0)for(o.reflectionProbes=[],e=0;e<t.reflectionProbes.length;e++){var z=t.reflectionProbes[e];o.reflectionProbes.push(z.serialize())}for(o.materials=[],o.multiMaterials=[],e=0;e<t.materials.length;e++)(r=t.materials[e]).doNotSerialize||o.materials.push(r.serialize());for(o.multiMaterials=[],e=0;e<t.multiMaterials.length;e++){var k=t.multiMaterials[e];o.multiMaterials.push(k.serialize())}for(t.environmentTexture&&(o.environmentTexture=t.environmentTexture.name),o.environmentIntensity=t.environmentIntensity,o.skeletons=[],e=0;e<t.skeletons.length;e++){var K=t.skeletons[e];K.doNotSerialize||o.skeletons.push(K.serialize())}for(o.transformNodes=[],e=0;e<t.transformNodes.length;e++)t.transformNodes[e].doNotSerialize||o.transformNodes.push(t.transformNodes[e].serialize());o.geometries={},o.geometries.boxes=[],o.geometries.spheres=[],o.geometries.cylinders=[],o.geometries.toruses=[],o.geometries.grounds=[],o.geometries.planes=[],o.geometries.torusKnots=[],o.geometries.vertexData=[],Xh=[];var oe=t.getGeometries();for(e=0;e<oe.length;e++){var ae=oe[e];ae.isReady()&&m_(ae,o.geometries)}for(o.meshes=[],e=0;e<t.meshes.length;e++){var ue;if((ue=t.meshes[e])instanceof Ne.a){var de=ue;de.doNotSerialize||de.delayLoadState!==g.a.DELAYLOADSTATE_LOADED&&de.delayLoadState!==g.a.DELAYLOADSTATE_NONE||o.meshes.push(eS(de,o))}}for(o.particleSystems=[],e=0;e<t.particleSystems.length;e++)o.particleSystems.push(t.particleSystems[e].serialize(!1));for(o.postProcesses=[],e=0;e<t.postProcesses.length;e++)o.postProcesses.push(t.postProcesses[e].serialize());t.actionManager&&(o.actions=t.actionManager.serialize("scene"));for(var me=0,ye=t._serializableComponents;me<ye.length;me++)ye[me].serialize(o);return o},i.SerializeMesh=function(t,e,n){e===void 0&&(e=!1),n===void 0&&(n=!1);var r={};if(i.ClearCache(),t=t instanceof Array?t:[t],e||n)for(var o=0;o<t.length;++o)n&&t[o].getDescendants().forEach(function(u){u instanceof Ne.a&&t.indexOf(u)<0&&!u.doNotSerialize&&t.push(u)}),e&&t[o].parent&&t.indexOf(t[o].parent)<0&&!t[o].parent.doNotSerialize&&t.push(t[o].parent);return t.forEach(function(u){(function(f,v){if(f.delayLoadState===g.a.DELAYLOADSTATE_LOADED||f.delayLoadState===g.a.DELAYLOADSTATE_NONE){if(f.material&&!f.material.doNotSerialize)if(f.material instanceof wa.a){if(v.multiMaterials=v.multiMaterials||[],v.materials=v.materials||[],!v.multiMaterials.some(function(z){return z.id===f.material.id})){v.multiMaterials.push(f.material.serialize());for(var y=function(z){z&&(v.materials.some(function(k){return k.id===z.id})||v.materials.push(z.serialize()))},D=0,w=f.material.subMaterials;D<w.length;D++)y(w[D])}}else v.materials=v.materials||[],v.materials.some(function(z){return z.id===f.material.id})||v.materials.push(f.material.serialize());var F=f._geometry;F&&(v.geometries||(v.geometries={},v.geometries.boxes=[],v.geometries.spheres=[],v.geometries.cylinders=[],v.geometries.toruses=[],v.geometries.grounds=[],v.geometries.planes=[],v.geometries.torusKnots=[],v.geometries.vertexData=[]),m_(F,v.geometries)),f.skeleton&&!f.skeleton.doNotSerialize&&(v.skeletons=v.skeletons||[],v.skeletons.push(f.skeleton.serialize())),v.meshes=v.meshes||[],v.meshes.push(eS(f,v))}})(u,r)}),r},i}(),IN=c(37),DN=function(){function i(){}return i.CreateResizedCopy=function(t,e,n,r){r===void 0&&(r=!0);var o=t.getScene(),u=o.getEngine(),f=new qn("resized"+t.name,{width:e,height:n},o,!t.noMipmap,!0,t._texture.type,!1,t.samplingMode,!1);f.wrapU=t.wrapU,f.wrapV=t.wrapV,f.uOffset=t.uOffset,f.vOffset=t.vOffset,f.uScale=t.uScale,f.vScale=t.vScale,f.uAng=t.uAng,f.vAng=t.vAng,f.wAng=t.wAng,f.coordinatesIndex=t.coordinatesIndex,f.level=t.level,f.anisotropicFilteringLevel=t.anisotropicFilteringLevel,f._texture.isReady=!1,t.wrapU=ke.a.CLAMP_ADDRESSMODE,t.wrapV=ke.a.CLAMP_ADDRESSMODE;var v=new jo("pass",1,null,r?ke.a.BILINEAR_SAMPLINGMODE:ke.a.NEAREST_SAMPLINGMODE,u,!1,g.a.TEXTURETYPE_UNSIGNED_INT);return v.getEffect().executeWhenCompiled(function(){v.onApply=function(D){D.setTexture("textureSampler",t)};var y=f.getInternalTexture();y&&(o.postProcessManager.directRender([v],y),u.unBindFramebuffer(y),f.disposeFramebufferObjects(),v.dispose(),y.isReady=!0)}),f},i}(),wN=function(){function i(t,e){if(e===void 0&&(e=null),!i.IsSupported(t))throw"Your browser does not support recording so far.";var n=t.getRenderingCanvas();if(!n)throw"The babylon engine must have a canvas to be recorded";this._canvas=n,this._canvas.isRecording=!1,this._options=Object(p.a)(Object(p.a)({},i._defaultOptions),e);var r=this._canvas.captureStream(this._options.fps);if(this._options.audioTracks)for(var o=0,u=this._options.audioTracks;o<u.length;o++){var f=u[o];r.addTrack(f)}this._mediaRecorder=new MediaRecorder(r,{mimeType:this._options.mimeType}),this._mediaRecorder.ondataavailable=this._handleDataAvailable.bind(this),this._mediaRecorder.onerror=this._handleError.bind(this),this._mediaRecorder.onstop=this._handleStop.bind(this)}return i.IsSupported=function(t){var e=t.getRenderingCanvas();return!!e&&typeof e.captureStream=="function"},Object.defineProperty(i.prototype,"isRecording",{get:function(){return!!this._canvas&&this._canvas.isRecording},enumerable:!1,configurable:!0}),i.prototype.stopRecording=function(){this._canvas&&this._mediaRecorder&&this.isRecording&&(this._canvas.isRecording=!1,this._mediaRecorder.stop())},i.prototype.startRecording=function(t,e){var n=this;if(t===void 0&&(t="babylonjs.webm"),e===void 0&&(e=7),!this._canvas||!this._mediaRecorder)throw"Recorder has already been disposed";if(this.isRecording)throw"Recording already in progress";return e>0&&setTimeout(function(){n.stopRecording()},1e3*e),this._fileName=t,this._recordedChunks=[],this._resolve=null,this._reject=null,this._canvas.isRecording=!0,this._mediaRecorder.start(this._options.recordChunckSize),new Promise(function(r,o){n._resolve=r,n._reject=o})},i.prototype.dispose=function(){this._canvas=null,this._mediaRecorder=null,this._recordedChunks=[],this._fileName=null,this._resolve=null,this._reject=null},i.prototype._handleDataAvailable=function(t){t.data.size>0&&this._recordedChunks.push(t.data)},i.prototype._handleError=function(t){if(this.stopRecording(),!this._reject)throw new t.error;this._reject(t.error)},i.prototype._handleStop=function(){this.stopRecording();var t=new Blob(this._recordedChunks);this._resolve&&this._resolve(t),window.URL.createObjectURL(t),this._fileName&&et.b.Download(t,this._fileName)},i._defaultOptions={mimeType:"video/webm",fps:25,recordChunckSize:3e3},i}(),Pl=function(){function i(){}return i.CreateScreenshot=function(t,e,n,r,o){o===void 0&&(o="image/png");var u=i._getScreenshotSize(t,e,n),f=u.height,v=u.width;if(f&&v){et.b._ScreenshotCanvas||(et.b._ScreenshotCanvas=document.createElement("canvas")),et.b._ScreenshotCanvas.width=v,et.b._ScreenshotCanvas.height=f;var y=et.b._ScreenshotCanvas.getContext("2d"),D=t.getRenderWidth()/t.getRenderHeight(),w=v,F=w/D;F>f&&(w=(F=f)*D);var z=Math.max(0,v-w)/2,k=Math.max(0,f-F)/2,K=t.getRenderingCanvas();y&&K&&y.drawImage(K,z,k,w,F),et.b.EncodeScreenshotCanvasData(r,o)}else _.a.Error("Invalid 'size' parameter !")},i.CreateScreenshotAsync=function(t,e,n,r){return r===void 0&&(r="image/png"),new Promise(function(o,u){i.CreateScreenshot(t,e,n,function(f){f!==void 0?o(f):u(new Error("Data is undefined"))},r)})},i.CreateScreenshotUsingRenderTarget=function(t,e,n,r,o,u,f,v,y,D){o===void 0&&(o="image/png"),u===void 0&&(u=1),f===void 0&&(f=!1),y===void 0&&(y=!1),D===void 0&&(D=!1);var w=i._getScreenshotSize(t,e,n),F=w.height,z=w.width,k={width:z,height:F};if(F&&z){var K=t.getRenderingCanvas();if(K){var oe={width:K.width,height:K.height};t.setSize(z,F);var ae=e.getScene(),ue=null,de=ae.activeCameras;(ae.activeCamera!==e||ae.activeCameras&&ae.activeCameras.length)&&(ue=ae.activeCamera,ae.activeCamera=e),ae.render();var me=new qn("screenShot",k,ae,!1,!1,g.a.TEXTURETYPE_UNSIGNED_INT,!1,ke.a.NEAREST_SAMPLINGMODE,void 0,D);me.renderList=null,me.samples=u,me.renderSprites=y,me.onAfterRenderObservable.add(function(){et.b.DumpFramebuffer(z,F,t,r,o,v)});var ye=function(){ae.incrementRenderId(),ae.resetCachedMaterial(),me.render(!0),me.dispose(),ue&&(ae.activeCamera=ue),ae.activeCameras=de,t.setSize(oe.width,oe.height),e.getProjectionMatrix(!0)};if(f){var Ee=new Al("antialiasing",1,ae.activeCamera);me.addPostProcess(Ee),Ee.getEffect().isReady()?ye():Ee.getEffect().onCompiled=function(){ye()}}else ye()}else _.a.Error("No rendering canvas found !")}else _.a.Error("Invalid 'size' parameter !")},i.CreateScreenshotUsingRenderTargetAsync=function(t,e,n,r,o,u,f,v){return r===void 0&&(r="image/png"),o===void 0&&(o=1),u===void 0&&(u=!1),v===void 0&&(v=!1),new Promise(function(y,D){i.CreateScreenshotUsingRenderTarget(t,e,n,function(w){w!==void 0?y(w):D(new Error("Data is undefined"))},r,o,u,f,v)})},i._getScreenshotSize=function(t,e,n){var r=0,o=0;if(typeof n=="object"){var u=n.precision?Math.abs(n.precision):1;n.width&&n.height?(r=n.height*u,o=n.width*u):n.width&&!n.height?(o=n.width*u,r=Math.round(o/t.getAspectRatio(e))):n.height&&!n.width?(r=n.height*u,o=Math.round(r*t.getAspectRatio(e))):(o=Math.round(t.getRenderWidth()*u),r=Math.round(o/t.getAspectRatio(e)))}else isNaN(n)||(r=n,o=n);return o&&(o=Math.floor(o)),r&&(r=Math.floor(r)),{height:0|r,width:0|o}},i}();et.b.CreateScreenshot=Pl.CreateScreenshot,et.b.CreateScreenshotAsync=Pl.CreateScreenshotAsync,et.b.CreateScreenshotUsingRenderTarget=Pl.CreateScreenshotUsingRenderTarget,et.b.CreateScreenshotUsingRenderTargetAsync=Pl.CreateScreenshotUsingRenderTargetAsync,function(i){i[i.Checkbox=0]="Checkbox",i[i.Slider=1]="Slider",i[i.Vector3=2]="Vector3",i[i.Quaternion=3]="Quaternion",i[i.Color3=4]="Color3",i[i.String=5]="String"}(h_||(h_={}));var Us,LN=c(140),NN=function(){function i(t){this.byteOffset=0,this.buffer=t}return i.prototype.loadAsync=function(t){var e=this;return this.buffer.readAsync(this.byteOffset,t).then(function(n){e._dataView=new DataView(n.buffer,n.byteOffset,n.byteLength),e._dataByteOffset=0})},i.prototype.readUint32=function(){var t=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,t},i.prototype.readUint8Array=function(t){var e=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,t);return this._dataByteOffset+=t,this.byteOffset+=t,e},i.prototype.readString=function(t){return ui.a.Decode(this.readUint8Array(t))},i.prototype.skipBytes=function(t){this._dataByteOffset+=t,this.byteOffset+=t},i}(),FN=function(){function i(){}return i._GetStorage=function(){try{return localStorage.setItem("test",""),localStorage.removeItem("test"),localStorage}catch(e){var t={};return{getItem:function(n){var r=t[n];return r===void 0?null:r},setItem:function(n,r){t[n]=r}}}},i.ReadString=function(t,e){var n=this._Storage.getItem(t);return n!==null?n:e},i.WriteString=function(t,e){this._Storage.setItem(t,e)},i.ReadBoolean=function(t,e){var n=this._Storage.getItem(t);return n!==null?n==="true":e},i.WriteBoolean=function(t,e){this._Storage.setItem(t,e?"true":"false")},i.ReadNumber=function(t,e){var n=this._Storage.getItem(t);return n!==null?parseFloat(n):e},i.WriteNumber=function(t,e){this._Storage.setItem(t,e.toString())},i._Storage=i._GetStorage(),i}(),BN=function(){function i(){this._trackedScene=null}return i.prototype.track=function(t){this._trackedScene=t,this._savedJSON=__.Serialize(t)},i.prototype.getDelta=function(){if(!this._trackedScene)return null;var t=__.Serialize(this._trackedScene),e={};for(var n in t)this._compareCollections(n,this._savedJSON[n],t[n],e);return e},i.prototype._compareArray=function(t,e,n,r){if(e.length===0&&n.length===0)return!0;if(e.length&&!isNaN(e[0])||n.length&&!isNaN(n[0])){if(e.length!==n.length)return!1;if(e.length===0)return!0;for(var o=0;o<e.length;o++)if(e[o]!==n[o])return r[t]=n,!1;return!0}var u=[],f=function(){var w=e[o],F=w.uniqueId;u.push(F);var z=n.filter(function(oe){return oe.uniqueId===F});if(z.length){var k=z[0],K={};v._compareObjects(w,k,K)||(r[t]||(r[t]=[]),K.__state={id:k.id||k.name},r[t].push(K))}else K={__state:{deleteId:w.id||w.name}},r[t].push(K)},v=this;for(o=0;o<e.length;o++)f();for(o=0;o<n.length;o++){var y=n[o],D=y.uniqueId;u.indexOf(D)===-1&&(r[t]||(r[t]=[]),r[t].push(y))}return!0},i.prototype._compareObjects=function(t,e,n){var r=!1;for(var o in t)if(t.hasOwnProperty(o)){var u=t[o],f=e[o],v=!1;Array.isArray(u)?v=JSON.stringify(u)!==JSON.stringify(f):isNaN(u)&&Object.prototype.toString.call(u)!="[object String]"||(v=u!==f),v&&(r=!0,n[o]=f)}return!r},i.prototype._compareCollections=function(t,e,n,r){if(e!==n&&e&&n){if(Array.isArray(e)&&Array.isArray(n)){if(this._compareArray(t,e,n,r))return}else if(typeof e=="object"&&typeof n=="object"){var o={};return void(this._compareObjects(e,n,o)||(r[t]=o))}}},i.GetShadowGeneratorById=function(t,e){for(var n=0,r=t.lights.map(function(u){return u.getShadowGenerator()});n<r.length;n++){var o=r[n];if(o&&o.id===e)return o}return null},i.ApplyDelta=function(t,e){var n=this;typeof t=="string"&&(t=JSON.parse(t));var r=e;for(var o in t){var u=t[o],f=r[o];if(Array.isArray(f)||o==="shadowGenerators")switch(o){case"cameras":this._ApplyDeltaForEntity(u,e,e.getCameraByID.bind(e),function(v){return Pt.a.Parse(v,e)});break;case"lights":this._ApplyDeltaForEntity(u,e,e.getLightByID.bind(e),function(v){return uo.a.Parse(v,e)});break;case"shadowGenerators":this._ApplyDeltaForEntity(u,e,function(v){return n.GetShadowGeneratorById(e,v)},function(v){return Hr.Parse(v,e)});break;case"meshes":this._ApplyDeltaForEntity(u,e,e.getMeshByID.bind(e),function(v){return Ne.a.Parse(v,e,"")});break;case"skeletons":this._ApplyDeltaForEntity(u,e,e.getSkeletonById.bind(e),function(v){return xa.Parse(v,e)});break;case"materials":this._ApplyDeltaForEntity(u,e,e.getMaterialByID.bind(e),function(v){return pn.a.Parse(v,e,"")});break;case"multiMaterials":this._ApplyDeltaForEntity(u,e,e.getMaterialByID.bind(e),function(v){return wa.a.Parse(v,e,"")});break;case"transformNodes":this._ApplyDeltaForEntity(u,e,e.getTransformNodeByID.bind(e),function(v){return ys.a.Parse(v,e,"")});break;case"particleSystems":this._ApplyDeltaForEntity(u,e,e.getParticleSystemByID.bind(e),function(v){return er.Parse(v,e,"")});break;case"morphTargetManagers":this._ApplyDeltaForEntity(u,e,e.getMorphTargetById.bind(e),function(v){return Eh.Parse(v,e)});break;case"postProcesses":this._ApplyDeltaForEntity(u,e,e.getPostProcessByName.bind(e),function(v){return St.Parse(v,e,"")})}else isNaN(f)?f.fromArray&&f.fromArray(u):r[o]=u}},i._ApplyPropertiesToEntity=function(t,e){for(var n in t){var r=t[n],o=e[n];o!==void 0&&(!isNaN(o)||Array.isArray(o)?e[n]=r:o.fromArray&&o.fromArray(r))}},i._ApplyDeltaForEntity=function(t,e,n,r){for(var o=0,u=t;o<u.length;o++){var f=u[o];if(f.__state&&f.__state.id!==void 0){var v=n(f.__state.id);v&&this._ApplyPropertiesToEntity(f,v)}else if(f.__state&&f.__state.deleteId!==void 0){var y=n(f.__state.deleteId);y==null||y.dispose()}else r(f)}},i}();(function(i){var t=function(){function n(r,o,u,f){var v;o===void 0&&(o=null),u===void 0&&(u=null),f===void 0&&(f=null),o=o??function(){return 1},u=u??function(){return 1},f=f??function(w,F){return w===F?0:1},this._characterToIdx=new Map,this._insertionCosts=new Array(r.length),this._deletionCosts=new Array(r.length),this._substitutionCosts=new Array(r.length);for(var y=0;y<r.length;++y){v=r[y],this._characterToIdx.set(v,y),this._insertionCosts[y]=o(v),this._deletionCosts[y]=u(v),this._substitutionCosts[y]=new Array(r.length);for(var D=y;D<r.length;++D)this._substitutionCosts[y][D]=f(v,r[D])}}return n.prototype.serialize=function(){var r={},o=new Array(this._characterToIdx.size);return this._characterToIdx.forEach(function(u,f){o[u]=f}),r.characters=o,r.insertionCosts=this._insertionCosts,r.deletionCosts=this._deletionCosts,r.substitutionCosts=this._substitutionCosts,JSON.stringify(r)},n.Deserialize=function(r){var o=JSON.parse(r),u=new n(o.characters);return u._insertionCosts=o.insertionCosts,u._deletionCosts=o.deletionCosts,u._substitutionCosts=o.substitutionCosts,u},n.prototype.getCharacterIdx=function(r){return this._characterToIdx.get(r)},n.prototype.getInsertionCost=function(r){return this._insertionCosts[r]},n.prototype.getDeletionCost=function(r){return this._deletionCosts[r]},n.prototype.getSubstitutionCost=function(r,o){var u=Math.min(r,o),f=Math.max(r,o);return this._substitutionCosts[u][f]},n}();i.Alphabet=t;var e=function(){function n(r,o){var u=this;if(r.length>n.MAX_SEQUENCE_LENGTH)throw new Error("Sequences longer than "+n.MAX_SEQUENCE_LENGTH+" not supported.");this._alphabet=o,this._characters=r.map(function(f){return u._alphabet.getCharacterIdx(f)})}return n.prototype.serialize=function(){return JSON.stringify(this._characters)},n.Deserialize=function(r,o){var u=new n([],o);return u._characters=JSON.parse(r),u},n.prototype.distance=function(r){return n._distance(this,r)},n._distance=function(r,o){var u=r._alphabet;if(u!==o._alphabet)throw new Error("Cannot Levenshtein compare Sequences built from different alphabets.");var f=r._characters,v=o._characters,y=f.length,D=v.length,w=n._costMatrix;w[0][0]=0;for(var F=0;F<y;++F)w[F+1][0]=w[F][0]+u.getInsertionCost(f[F]);for(F=0;F<D;++F)w[0][F+1]=w[0][F]+u.getInsertionCost(v[F]);for(var z=0;z<y;++z)for(var k=0;k<D;++k)n._insertionCost=w[z+1][k]+u.getInsertionCost(v[k]),n._deletionCost=w[z][k+1]+u.getDeletionCost(f[z]),n._substitutionCost=w[z][k]+u.getSubstitutionCost(f[z],v[k]),w[z+1][k+1]=Math.min(n._insertionCost,n._deletionCost,n._substitutionCost);return w[y][D]},n.MAX_SEQUENCE_LENGTH=256,n._costMatrix=Object(p.f)(Array(n.MAX_SEQUENCE_LENGTH+1)).map(function(r){return new Array(n.MAX_SEQUENCE_LENGTH+1)}),n}();i.Sequence=e})(Us||(Us={}));var UN=function(){function i(t){t===void 0&&(t=.01),this._points=[],this._segmentLength=t}return i.prototype.serialize=function(){return JSON.stringify(this)},i.Deserialize=function(t){var e=JSON.parse(t),n=new i(e._segmentLength);return n._points=e._points.map(function(r){return new d.e(r._x,r._y,r._z)}),n},i.prototype.getLength=function(){return this._points.length*this._segmentLength},i.prototype.add=function(t){var e=this,n=this._points.length;if(n===0)this._points.push(t.clone());else for(var r=function(){return e._segmentLength/d.e.Distance(e._points[n-1],t)},o=r();o<=1;o=r()){var u=this._points[n-1].scale(1-o);t.scaleAndAddToRef(o,u),this._points.push(u),++n}},i.prototype.resampleAtTargetResolution=function(t){var e=new i(this.getLength()/t);return this._points.forEach(function(n){e.add(n)}),e},i.prototype.tokenize=function(t){for(var e=[],n=new d.e,r=2;r<this._points.length;++r)i._transformSegmentDirToRef(this._points[r-2],this._points[r-1],this._points[r],n)&&e.push(i._tokenizeSegment(n,t));return e},i._transformSegmentDirToRef=function(t,e,n,r){return e.subtractToRef(t,i._forwardDir),i._forwardDir.normalize(),e.scaleToRef(-1,i._inverseFromVec),i._inverseFromVec.normalize(),!(Math.abs(d.e.Dot(i._forwardDir,i._inverseFromVec))>.98)&&(d.e.CrossToRef(i._forwardDir,i._inverseFromVec,i._upDir),i._upDir.normalize(),d.a.LookAtLHToRef(t,e,i._upDir,i._lookMatrix),n.subtractToRef(e,i._fromToVec),i._fromToVec.normalize(),d.e.TransformNormalToRef(i._fromToVec,i._lookMatrix,r),!0)},i._tokenizeSegment=function(t,e){i._bestMatch=0,i._score=d.e.Dot(t,e[0]),i._bestScore=i._score;for(var n=1;n<e.length;++n)i._score=d.e.Dot(t,e[n]),i._score>i._bestScore&&(i._bestMatch=n,i._bestScore=i._score);return i._bestMatch},i._forwardDir=new d.e,i._inverseFromVec=new d.e,i._upDir=new d.e,i._fromToVec=new d.e,i._lookMatrix=new d.a,i}(),tS=function(){function i(t){this.chars=new Array(t)}return i.Generate=function(t,e,n,r,o){t===void 0&&(t=64),e===void 0&&(e=256),n===void 0&&(n=.1),r===void 0&&(r=.001),o===void 0&&(o=[]);for(var u,f,v=new i(t),y=0;y<t;++y)v.chars[y]=new d.e(Math.random()-.5,Math.random()-.5,Math.random()-.5),v.chars[y].normalize();for(y=0;y<o.length;++y)v.chars[y].copyFrom(o[y]);for(var D,w=new d.e,F=new d.e,z=0;z<e;++z){u=(1-(D=z/(e-1)))*n+D*r;var k=function(K){w.copyFromFloats(0,0,0),v.chars.forEach(function(oe){v.chars[K].subtractToRef(oe,F),(f=F.lengthSquared())>1e-6&&F.scaleAndAddToRef(1/(F.lengthSquared()*f),w)}),w.scaleInPlace(u),v.chars[K].addInPlace(w),v.chars[K].normalize()};for(y=o.length;y<v.chars.length;++y)k(y)}return v},i.prototype.serialize=function(){return JSON.stringify(this.chars)},i.Deserialize=function(t){for(var e=JSON.parse(t),n=new i(e.length),r=0;r<e.length;++r)n.chars[r]=new d.e(e[r]._x,e[r]._y,e[r]._z);return n},i}(),g_=function(){function i(){this._sequences=[]}return i.prototype.serialize=function(){return JSON.stringify(this._sequences.map(function(t){return t.serialize()}))},i.Deserialize=function(t,e){var n=new i;return n._sequences=JSON.parse(t).map(function(r){return Us.Sequence.Deserialize(r,e)}),n},i.CreateFromTrajectory=function(t,e,n){return i.CreateFromTokenizationPyramid(i._getTokenizationPyramid(t,e),n)},i.CreateFromTokenizationPyramid=function(t,e){var n=new i;return n._sequences=t.map(function(r){return new Us.Sequence(r,e)}),n},i._getTokenizationPyramid=function(t,e,n){n===void 0&&(n=i.FINEST_DESCRIPTOR_RESOLUTION);for(var r=[],o=n;o>4;o=Math.floor(o/2))r.push(t.resampleAtTargetResolution(o).tokenize(e.chars));return r},i.prototype.distance=function(t){for(var e=0,n=0;n<this._sequences.length;++n)e+=Math.pow(2,n)*this._sequences[n].distance(t._sequences[n]);return e},i.FINEST_DESCRIPTOR_RESOLUTION=32,i}(),nS=function(){function i(t){t===void 0&&(t=[]),this._descriptors=t,this._centroidIdx=-1,this._averageDistance=0,this._refreshDescription()}return i.prototype.serialize=function(){var t={};return t.descriptors=this._descriptors.map(function(e){return e.serialize()}),t.centroidIdx=this._centroidIdx,t.averageDistance=this._averageDistance,JSON.stringify(t)},i.Deserialize=function(t,e){var n=JSON.parse(t),r=new i;return r._descriptors=n.descriptors.map(function(o){return g_.Deserialize(o,e)}),r._centroidIdx=n.centroidIdx,r._averageDistance=n.averageDistance,r},i.prototype.add=function(t){this._descriptors.push(t),this._refreshDescription()},i.prototype.getMatchCost=function(t){return t.distance(this._descriptors[this._centroidIdx])/this._averageDistance},i.prototype.getMatchMinimumDistance=function(t){return Math.min.apply(Math,this._descriptors.map(function(e){return e.distance(t)}))},i.prototype._refreshDescription=function(){var t,e=this;this._centroidIdx=-1;for(var n=this._descriptors.map(function(o){return t=0,e._descriptors.forEach(function(u){t+=o.distance(u)}),t}),r=0;r<n.length;++r)(this._centroidIdx<0||n[r]<n[this._centroidIdx])&&(this._centroidIdx=r);this._averageDistance=0,this._descriptors.forEach(function(o){e._averageDistance+=o.distance(e._descriptors[e._centroidIdx])}),this._descriptors.length>0&&(this._averageDistance=Math.max(this._averageDistance/this._descriptors.length,i.MIN_AVERAGE_DISTANCE))},i.MIN_AVERAGE_DISTANCE=1,i}(),VN=function(){function i(){this._maximumAllowableMatchCost=4,this._nameToDescribedTrajectory=new Map}return i.prototype.serialize=function(){var t={};return t.maximumAllowableMatchCost=this._maximumAllowableMatchCost,t.vector3Alphabet=this._vector3Alphabet.serialize(),t.levenshteinAlphabet=this._levenshteinAlphabet.serialize(),t.nameToDescribedTrajectory=[],this._nameToDescribedTrajectory.forEach(function(e,n){t.nameToDescribedTrajectory.push(n),t.nameToDescribedTrajectory.push(e.serialize())}),JSON.stringify(t)},i.Deserialize=function(t){var e=JSON.parse(t),n=new i;n._maximumAllowableMatchCost=e.maximumAllowableMatchCost,n._vector3Alphabet=tS.Deserialize(e.vector3Alphabet),n._levenshteinAlphabet=Us.Alphabet.Deserialize(e.levenshteinAlphabet);for(var r=0;r<e.nameToDescribedTrajectory.length;r+=2)n._nameToDescribedTrajectory.set(e.nameToDescribedTrajectory[r],nS.Deserialize(e.nameToDescribedTrajectory[r+1],n._levenshteinAlphabet));return n},i.Generate=function(){for(var t=tS.Generate(64,256,.1,.001,[d.e.Forward()]),e=new Array(t.chars.length),n=0;n<e.length;++n)e[n]=n;var r=new Us.Alphabet(e,function(u){return u===0?0:1},function(u){return u===0?0:1},function(u,f){return Math.min(1-d.e.Dot(t.chars[u],t.chars[f]),1)}),o=new i;return o._vector3Alphabet=t,o._levenshteinAlphabet=r,o},i.prototype.addTrajectoryToClassification=function(t,e){this._nameToDescribedTrajectory.has(e)||this._nameToDescribedTrajectory.set(e,new nS),this._nameToDescribedTrajectory.get(e).add(g_.CreateFromTrajectory(t,this._vector3Alphabet,this._levenshteinAlphabet))},i.prototype.deleteClassification=function(t){return this._nameToDescribedTrajectory.delete(t)},i.prototype.classifyTrajectory=function(t){var e=this,n=g_.CreateFromTrajectory(t,this._vector3Alphabet,this._levenshteinAlphabet),r=[];if(this._nameToDescribedTrajectory.forEach(function(y,D){y.getMatchCost(n)<e._maximumAllowableMatchCost&&r.push(D)}),r.length===0)return null;for(var o,u=0,f=this._nameToDescribedTrajectory.get(r[u]).getMatchMinimumDistance(n),v=0;v<r.length;++v)(o=this._nameToDescribedTrajectory.get(r[v]).getMatchMinimumDistance(n))<f&&(f=o,u=v);return r[u]},i}(),kN=c(150),Yh=function(i){function t(e,n){n===void 0&&(n={});var r=i.call(this,e)||this;return r.options=n,r._direction=new d.e(0,0,-1),r._mat=new d.a,r._onSelectEnabled=!1,r._origin=new d.e(0,0,0),r.lastNativeXRHitResults=[],r.onHitTestResultObservable=new S.c,r._onHitTestResults=function(o){var u=o.map(function(f){var v=d.a.FromArray(f.hitMatrix);return r._xrSessionManager.scene.useRightHandedSystem||v.toggleModelMatrixHandInPlace(),r.options.worldParentNode&&v.multiplyToRef(r.options.worldParentNode.getWorldMatrix(),v),{xrHitResult:f,transformationMatrix:v}});r.lastNativeXRHitResults=o,r.onHitTestResultObservable.notifyObservers(u)},r._onSelect=function(o){r._onSelectEnabled&&t.XRHitTestWithSelectEvent(o,r._xrSessionManager.referenceSpace)},r.xrNativeFeatureName="hit-test",et.b.Warn("A newer version of this plugin is available"),r}return Object(p.d)(t,i),t.XRHitTestWithRay=function(e,n,r,o){return e.requestHitTest(n,r).then(function(u){var f=o||function(v){return!!v.hitMatrix};return u.filter(f)})},t.XRHitTestWithSelectEvent=function(e,n){var r=e.frame.getPose(e.inputSource.targetRaySpace,n);if(!r)return Promise.resolve([]);var o=new XRRay(r.transform);return this.XRHitTestWithRay(e.frame.session,o,n)},t.prototype.attach=function(){return!!i.prototype.attach.call(this)&&(this.options.testOnPointerDownOnly&&this._xrSessionManager.session.addEventListener("select",this._onSelect,!1),!0)},t.prototype.detach=function(){return!!i.prototype.detach.call(this)&&(this._onSelectEnabled=!1,this._xrSessionManager.session.removeEventListener("select",this._onSelect),!0)},t.prototype.dispose=function(){i.prototype.dispose.call(this),this.onHitTestResultObservable.clear()},t.prototype._onXRFrame=function(e){if(this.attached&&!this.options.testOnPointerDownOnly){var n=e.getViewerPose(this._xrSessionManager.referenceSpace);if(n){d.a.FromArrayToRef(n.transform.matrix,0,this._mat),d.e.TransformCoordinatesFromFloatsToRef(0,0,0,this._mat,this._origin),d.e.TransformCoordinatesFromFloatsToRef(0,0,-1,this._mat,this._direction),this._direction.subtractInPlace(this._origin),this._direction.normalize();var r=new XRRay({x:this._origin.x,y:this._origin.y,z:this._origin.z,w:0},{x:this._direction.x,y:this._direction.y,z:this._direction.z,w:0});t.XRHitTestWithRay(this._xrSessionManager.session,r,this._xrSessionManager.referenceSpace).then(this._onHitTestResults)}}},t.Name=Si.HIT_TEST,t.Version=1,t}(xi);hi.AddWebXRFeature(Yh.Name,function(i,t){return function(){return new Yh(i,t)}},Yh.Version,!1);var jN=0,Kh=function(i){function t(e,n){n===void 0&&(n={});var r=i.call(this,e)||this;return r._options=n,r._lastFrameDetected=new Set,r._trackedAnchors=[],r._futureAnchors=[],r.onAnchorAddedObservable=new S.c,r.onAnchorRemovedObservable=new S.c,r.onAnchorUpdatedObservable=new S.c,r._tmpVector=new d.e,r._tmpQuaternion=new d.b,r.xrNativeFeatureName="anchors",r}return Object(p.d)(t,i),Object.defineProperty(t.prototype,"referenceSpaceForFrameAnchors",{set:function(e){this._referenceSpaceForFrameAnchors=e},enumerable:!1,configurable:!0}),t.prototype._populateTmpTransformation=function(e,n){return this._tmpVector.copyFrom(e),this._tmpQuaternion.copyFrom(n),this._xrSessionManager.scene.useRightHandedSystem||(this._tmpVector.z*=-1,this._tmpQuaternion.z*=-1,this._tmpQuaternion.w*=-1),{position:this._tmpVector,rotationQuaternion:this._tmpQuaternion}},t.prototype.addAnchorPointUsingHitTestResultAsync=function(e,n,r){return n===void 0&&(n=new d.e),r===void 0&&(r=new d.b),Object(p.b)(this,void 0,void 0,function(){var o,u,f,v=this;return Object(p.e)(this,function(y){switch(y.label){case 0:if(this._populateTmpTransformation(n,r),o=new XRRigidTransform({x:this._tmpVector.x,y:this._tmpVector.y,z:this._tmpVector.z},{x:this._tmpQuaternion.x,y:this._tmpQuaternion.y,z:this._tmpQuaternion.z,w:this._tmpQuaternion.w}),e.xrHitResult.createAnchor)return[3,1];throw this.detach(),new Error("Anchors not enabled in this environment/browser");case 1:return y.trys.push([1,3,,4]),[4,e.xrHitResult.createAnchor(o)];case 2:return u=y.sent(),[2,new Promise(function(D,w){v._futureAnchors.push({nativeAnchor:u,resolved:!1,submitted:!0,xrTransformation:o,resolve:D,reject:w})})];case 3:throw f=y.sent(),new Error(f);case 4:return[2]}})})},t.prototype.addAnchorAtPositionAndRotationAsync=function(e,n,r){return n===void 0&&(n=new d.b),r===void 0&&(r=!1),Object(p.b)(this,void 0,void 0,function(){var o,u,f,v=this;return Object(p.e)(this,function(y){switch(y.label){case 0:return this._populateTmpTransformation(e,n),o=new XRRigidTransform({x:this._tmpVector.x,y:this._tmpVector.y,z:this._tmpVector.z},{x:this._tmpQuaternion.x,y:this._tmpQuaternion.y,z:this._tmpQuaternion.z,w:this._tmpQuaternion.w}),r&&this.attached&&this._xrSessionManager.currentFrame?[4,this._createAnchorAtTransformation(o,this._xrSessionManager.currentFrame)]:[3,2];case 1:return f=y.sent(),[3,3];case 2:f=void 0,y.label=3;case 3:return u=f,[2,new Promise(function(D,w){v._futureAnchors.push({nativeAnchor:u,resolved:!1,submitted:!1,xrTransformation:o,resolve:D,reject:w})})]}})})},Object.defineProperty(t.prototype,"anchors",{get:function(){return this._trackedAnchors},enumerable:!1,configurable:!0}),t.prototype.detach=function(){if(!i.prototype.detach.call(this))return!1;if(!this._options.doNotRemoveAnchorsOnSessionEnded)for(;this._trackedAnchors.length;){var e=this._trackedAnchors.pop();if(e){try{e.remove()}catch(n){}this.onAnchorRemovedObservable.notifyObservers(e)}}return!0},t.prototype.dispose=function(){this._futureAnchors.length=0,i.prototype.dispose.call(this),this.onAnchorAddedObservable.clear(),this.onAnchorRemovedObservable.clear(),this.onAnchorUpdatedObservable.clear()},t.prototype._onXRFrame=function(e){var n=this;if(this.attached&&e){var r=e.trackedAnchors;if(r){var o=this._trackedAnchors.filter(function(f){return!r.has(f.xrAnchor)}).map(function(f){return n._trackedAnchors.indexOf(f)}),u=0;o.forEach(function(f){var v=n._trackedAnchors.splice(f-u,1)[0];n.onAnchorRemovedObservable.notifyObservers(v),u++}),r.forEach(function(f){if(n._lastFrameDetected.has(f)){var v=n._findIndexInAnchorArray(f);D=n._trackedAnchors[v];try{n._updateAnchorWithXRFrame(f,D,e),D.attachedNode&&(D.attachedNode.rotationQuaternion=D.attachedNode.rotationQuaternion||new d.b,D.transformationMatrix.decompose(D.attachedNode.scaling,D.attachedNode.rotationQuaternion,D.attachedNode.position)),n.onAnchorUpdatedObservable.notifyObservers(D)}catch(F){et.b.Warn("Anchor could not be updated")}}else{var y={id:jN++,xrAnchor:f,remove:f.delete},D=n._updateAnchorWithXRFrame(f,y,e);n._trackedAnchors.push(D),n.onAnchorAddedObservable.notifyObservers(D);var w=n._futureAnchors.filter(function(F){return F.nativeAnchor===f})[0];w&&(w.resolve(D),w.resolved=!0)}}),this._lastFrameDetected=r}this._futureAnchors.forEach(function(f){f.resolved||f.submitted||(n._createAnchorAtTransformation(f.xrTransformation,e).then(function(v){f.nativeAnchor=v},function(v){f.resolved=!0,f.reject(v)}),f.submitted=!0)})}},t.prototype._findIndexInAnchorArray=function(e){for(var n=0;n<this._trackedAnchors.length;++n)if(this._trackedAnchors[n].xrAnchor===e)return n;return-1},t.prototype._updateAnchorWithXRFrame=function(e,n,r){var o=r.getPose(e.anchorSpace,this._xrSessionManager.referenceSpace);if(o){var u=n.transformationMatrix||new d.a;d.a.FromArrayToRef(o.transform.matrix,0,u),this._xrSessionManager.scene.useRightHandedSystem||u.toggleModelMatrixHandInPlace(),n.transformationMatrix=u,this._options.worldParentNode&&u.multiplyToRef(this._options.worldParentNode.getWorldMatrix(),u)}return n},t.prototype._createAnchorAtTransformation=function(e,n){var r;return Object(p.b)(this,void 0,void 0,function(){return Object(p.e)(this,function(o){if(!n.createAnchor)throw this.detach(),new Error("Anchors are not enabled in your browser");try{return[2,n.createAnchor(e,(r=this._referenceSpaceForFrameAnchors)!==null&&r!==void 0?r:this._xrSessionManager.referenceSpace)]}catch(u){throw new Error(u)}return[2]})})},t.Name=Si.ANCHOR_SYSTEM,t.Version=1,t}(xi);hi.AddWebXRFeature(Kh.Name,function(i,t){return function(){return new Kh(i,t)}},Kh.Version);var zN=0,Qh=function(i){function t(e,n){n===void 0&&(n={});var r=i.call(this,e)||this;return r._options=n,r._detectedPlanes=[],r._enabled=!1,r._lastFrameDetected=new Set,r.onPlaneAddedObservable=new S.c,r.onPlaneRemovedObservable=new S.c,r.onPlaneUpdatedObservable=new S.c,r.xrNativeFeatureName="plane-detection",r._xrSessionManager.session?r._init():r._xrSessionManager.onXRSessionInit.addOnce(function(){r._init()}),r}return Object(p.d)(t,i),t.prototype.detach=function(){if(!i.prototype.detach.call(this))return!1;if(!this._options.doNotRemovePlanesOnSessionEnded)for(;this._detectedPlanes.length;){var e=this._detectedPlanes.pop();e&&this.onPlaneRemovedObservable.notifyObservers(e)}return!0},t.prototype.dispose=function(){i.prototype.dispose.call(this),this.onPlaneAddedObservable.clear(),this.onPlaneRemovedObservable.clear(),this.onPlaneUpdatedObservable.clear()},t.prototype.isCompatible=function(){return typeof XRPlane!="undefined"},t.prototype._onXRFrame=function(e){var n=this;if(this.attached&&this._enabled&&e){var r=e.worldInformation.detectedPlanes;if(r){var o=this._detectedPlanes.filter(function(f){return!r.has(f.xrPlane)}).map(function(f){return n._detectedPlanes.indexOf(f)}),u=0;o.forEach(function(f){var v=n._detectedPlanes.splice(f-u,1)[0];n.onPlaneRemovedObservable.notifyObservers(v),u++}),r.forEach(function(f){if(n._lastFrameDetected.has(f)){if(f.lastChangedTime===n._xrSessionManager.currentTimestamp){var v=n.findIndexInPlaneArray(f);D=n._detectedPlanes[v],n._updatePlaneWithXRPlane(f,D,e),n.onPlaneUpdatedObservable.notifyObservers(D)}}else{var y={id:zN++,xrPlane:f,polygonDefinition:[]},D=n._updatePlaneWithXRPlane(f,y,e);n._detectedPlanes.push(D),n.onPlaneAddedObservable.notifyObservers(D)}}),this._lastFrameDetected=r}}},t.prototype._init=function(){var e,n,r=this,o=function(){r._enabled=!0,r._detectedPlanes.length&&(r._detectedPlanes.length=0)};this._xrSessionManager.session.updateWorldTrackingState?(this._xrSessionManager.session.updateWorldTrackingState({planeDetectionState:{enabled:!0}}),o()):((n=(e=this._xrSessionManager.session.worldTrackingState)===null||e===void 0?void 0:e.planeDetectionState)===null||n===void 0?void 0:n.enabled)&&o()},t.prototype._updatePlaneWithXRPlane=function(e,n,r){var o=this;n.polygonDefinition=e.polygon.map(function(v){var y=o._xrSessionManager.scene.useRightHandedSystem?1:-1;return new d.e(v.x,v.y,v.z*y)});var u=r.getPose(e.planeSpace,this._xrSessionManager.referenceSpace);if(u){var f=n.transformationMatrix||new d.a;d.a.FromArrayToRef(u.transform.matrix,0,f),this._xrSessionManager.scene.useRightHandedSystem||f.toggleModelMatrixHandInPlace(),n.transformationMatrix=f,this._options.worldParentNode&&f.multiplyToRef(this._options.worldParentNode.getWorldMatrix(),f)}return n},t.prototype.findIndexInPlaneArray=function(e){for(var n=0;n<this._detectedPlanes.length;++n)if(this._detectedPlanes[n].xrPlane===e)return n;return-1},t.Name=Si.PLANE_DETECTION,t.Version=1,t}(xi);hi.AddWebXRFeature(Qh.Name,function(i,t){return function(){return new Qh(i,t)}},Qh.Version);var qh=function(i){function t(e,n){n===void 0&&(n={});var r=i.call(this,e)||this;return r.options=n,r.onBackgroundStateChangedObservable=new S.c,r}return Object(p.d)(t,i),t.prototype.attach=function(){return this._setBackgroundState(!1),i.prototype.attach.call(this)},t.prototype.detach=function(){return this._setBackgroundState(!0),i.prototype.detach.call(this)},t.prototype.dispose=function(){i.prototype.dispose.call(this),this.onBackgroundStateChangedObservable.clear()},t.prototype._onXRFrame=function(e){},t.prototype._setBackgroundState=function(e){var n=this._xrSessionManager.scene;if(!this.options.ignoreEnvironmentHelper)if(this.options.environmentHelperRemovalFlags){if(this.options.environmentHelperRemovalFlags.skyBox){var r=n.getMeshByName("BackgroundSkybox");r&&r.setEnabled(e)}if(this.options.environmentHelperRemovalFlags.ground){var o=n.getMeshByName("BackgroundPlane");o&&o.setEnabled(e)}}else{var u=n.getMeshByName("BackgroundHelper");u&&u.setEnabled(e)}this.options.backgroundMeshes&&this.options.backgroundMeshes.forEach(function(f){return f.setEnabled(e)}),this.onBackgroundStateChangedObservable.notifyObservers(e)},t.Name=Si.BACKGROUND_REMOVER,t.Version=1,t}(xi);hi.AddWebXRFeature(qh.Name,function(i,t){return function(){return new qh(i,t)}},qh.Version,!0);var GN=function(){},Zh=function(i){function t(e,n){var r=i.call(this,e)||this;return r._options=n,r._attachController=function(o){if(!r._controllers[o.uniqueId])if(r._xrSessionManager.scene.isPhysicsEnabled()||_.a.Warn("physics engine not enabled, skipped. Please add this controller manually."),r._options.physicsProperties.useControllerMesh&&o.inputSource.gamepad)o.onMotionControllerInitObservable.addOnce(function(w){w.onModelLoadedObservable.addOnce(function(){var F=new Ut.a(w.rootMesh,Ut.a.MeshImpostor,Object(p.a)({mass:0},r._options.physicsProperties)),z=o.grip||o.pointer;r._controllers[o.uniqueId]={xrController:o,impostor:F,oldPos:z.position.clone(),oldRotation:z.rotationQuaternion.clone()}})});else{var u=r._options.physicsProperties.impostorType||Ut.a.SphereImpostor,f=r._options.physicsProperties.impostorSize||.1,v=zr.a.CreateSphere("impostor-mesh-"+o.uniqueId,{diameterX:typeof f=="number"?f:f.width,diameterY:typeof f=="number"?f:f.height,diameterZ:typeof f=="number"?f:f.depth});v.isVisible=r._debugMode,v.isPickable=!1,v.rotationQuaternion=new d.b;var y=o.grip||o.pointer;v.position.copyFrom(y.position),v.rotationQuaternion.copyFrom(y.rotationQuaternion);var D=new Ut.a(v,u,Object(p.a)({mass:0},r._options.physicsProperties));r._controllers[o.uniqueId]={xrController:o,impostor:D,impostorMesh:v}}},r._controllers={},r._debugMode=!1,r._delta=0,r._lastTimestamp=0,r._tmpQuaternion=new d.b,r._tmpVector=new d.e,r._options.physicsProperties||(r._options.physicsProperties={}),r}return Object(p.d)(t,i),t.prototype._enablePhysicsDebug=function(){var e=this;this._debugMode=!0,Object.keys(this._controllers).forEach(function(n){var r=e._controllers[n];r.impostorMesh&&(r.impostorMesh.isVisible=!0)})},t.prototype.addController=function(e){this._attachController(e)},t.prototype.attach=function(){var e=this;if(!i.prototype.attach.call(this))return!1;if(!this._options.xrInput)return!0;if(this._options.xrInput.controllers.forEach(this._attachController),this._addNewAttachObserver(this._options.xrInput.onControllerAddedObservable,this._attachController),this._addNewAttachObserver(this._options.xrInput.onControllerRemovedObservable,function(o){e._detachController(o.uniqueId)}),this._options.enableHeadsetImpostor){var n=this._options.headsetImpostorParams||{impostorType:Ut.a.SphereImpostor,restitution:.8,impostorSize:.3},r=n.impostorSize||.3;this._headsetMesh=zr.a.CreateSphere("headset-mesh",{diameterX:typeof r=="number"?r:r.width,diameterY:typeof r=="number"?r:r.height,diameterZ:typeof r=="number"?r:r.depth}),this._headsetMesh.rotationQuaternion=new d.b,this._headsetMesh.isVisible=!1,this._headsetImpostor=new Ut.a(this._headsetMesh,n.impostorType,Object(p.a)({mass:0},n))}return!0},t.prototype.detach=function(){var e=this;return!!i.prototype.detach.call(this)&&(Object.keys(this._controllers).forEach(function(n){e._detachController(n)}),this._headsetMesh&&this._headsetMesh.dispose(),!0)},t.prototype.getHeadsetImpostor=function(){return this._headsetImpostor},t.prototype.getImpostorForController=function(e){var n=typeof e=="string"?e:e.uniqueId;return this._controllers[n]?this._controllers[n].impostor:null},t.prototype.setPhysicsProperties=function(e){this._options.physicsProperties=Object(p.a)(Object(p.a)({},this._options.physicsProperties),e)},t.prototype._onXRFrame=function(e){var n=this;this._delta=this._xrSessionManager.currentTimestamp-this._lastTimestamp,this._lastTimestamp=this._xrSessionManager.currentTimestamp,this._headsetMesh&&(this._headsetMesh.position.copyFrom(this._options.xrInput.xrCamera.position),this._headsetMesh.rotationQuaternion.copyFrom(this._options.xrInput.xrCamera.rotationQuaternion)),Object.keys(this._controllers).forEach(function(r){var o=n._controllers[r],u=o.xrController.grip||o.xrController.pointer,f=o.oldPos||o.impostorMesh.position,v=o.oldRotation||o.impostorMesh.rotationQuaternion;if(u.position.subtractToRef(f,n._tmpVector),n._tmpVector.scaleInPlace(1e3/n._delta),o.impostor.setLinearVelocity(n._tmpVector),n._debugMode&&console.log(n._tmpVector,"linear"),!v.equalsWithEpsilon(u.rotationQuaternion)){v.conjugateInPlace().multiplyToRef(u.rotationQuaternion,n._tmpQuaternion);var y=Math.sqrt(n._tmpQuaternion.x*n._tmpQuaternion.x+n._tmpQuaternion.y*n._tmpQuaternion.y+n._tmpQuaternion.z*n._tmpQuaternion.z);if(n._tmpVector.set(n._tmpQuaternion.x,n._tmpQuaternion.y,n._tmpQuaternion.z),y<.001)n._tmpVector.scaleInPlace(2);else{var D=2*Math.atan2(y,n._tmpQuaternion.w);n._tmpVector.scaleInPlace(D/(y*(n._delta/1e3)))}o.impostor.setAngularVelocity(n._tmpVector),n._debugMode&&console.log(n._tmpVector,n._tmpQuaternion,"angular")}f.copyFrom(u.position),v.copyFrom(u.rotationQuaternion)})},t.prototype._detachController=function(e){var n=this._controllers[e];n&&(n.impostorMesh&&n.impostorMesh.dispose(),delete this._controllers[e])},t.Name=Si.PHYSICS_CONTROLLERS,t.Version=1,t}(xi);hi.AddWebXRFeature(Zh.Name,function(i,t){return function(){return new Zh(i,t)}},Zh.Version,!0);var $h=function(i){function t(e,n){n===void 0&&(n={});var r=i.call(this,e)||this;return r.options=n,r._tmpMat=new d.a,r._tmpPos=new d.e,r._tmpQuat=new d.b,r.initHitTestSource=function(o){if(o){var u=new XRRay(r.options.offsetRay||{}),f={space:r.options.useReferenceSpace?o:r._xrSessionManager.viewerReferenceSpace,offsetRay:u};r.options.entityTypes&&(f.entityTypes=r.options.entityTypes),f.space?r._xrSessionManager.session.requestHitTestSource(f).then(function(v){r._xrHitTestSource&&r._xrHitTestSource.cancel(),r._xrHitTestSource=v}):et.b.Warn("waiting for viewer reference space to initialize")}},r.autoCloneTransformation=!1,r.onHitTestResultObservable=new S.c,r.paused=!1,r.xrNativeFeatureName="hit-test",et.b.Warn("Hit test is an experimental and unstable feature."),r}return Object(p.d)(t,i),t.prototype.attach=function(){var e=this;if(!i.prototype.attach.call(this)||!this._xrSessionManager.session.requestHitTestSource)return!1;if(this.options.disablePermanentHitTest||(this._xrSessionManager.referenceSpace&&this.initHitTestSource(this._xrSessionManager.referenceSpace),this._xrSessionManager.onXRReferenceSpaceChanged.add(this.initHitTestSource)),this.options.enableTransientHitTest){var n=new XRRay(this.options.transientOffsetRay||{});this._xrSessionManager.session.requestHitTestSourceForTransientInput({profile:"generic-touchscreen",offsetRay:n,entityTypes:this.options.entityTypes}).then(function(r){e._transientXrHitTestSource=r})}return!0},t.prototype.detach=function(){return!!i.prototype.detach.call(this)&&(this._xrHitTestSource&&(this._xrHitTestSource.cancel(),this._xrHitTestSource=null),this._xrSessionManager.onXRReferenceSpaceChanged.removeCallback(this.initHitTestSource),this._transientXrHitTestSource&&(this._transientXrHitTestSource.cancel(),this._transientXrHitTestSource=null),!0)},t.prototype.dispose=function(){i.prototype.dispose.call(this),this.onHitTestResultObservable.clear()},t.prototype._onXRFrame=function(e){var n=this;if(this.attached&&!this.paused){if(this._xrHitTestSource){var r=e.getHitTestResults(this._xrHitTestSource);this._processWebXRHitTestResult(r)}this._transientXrHitTestSource&&e.getHitTestResultsForTransientInput(this._transientXrHitTestSource).forEach(function(o){n._processWebXRHitTestResult(o.results,o.inputSource)})}},t.prototype._processWebXRHitTestResult=function(e,n){var r=this,o=[];e.forEach(function(u){var f=u.getPose(r._xrSessionManager.referenceSpace);if(f){var v=f.transform.position,y=f.transform.orientation;r._tmpPos.set(v.x,v.y,v.z),r._tmpQuat.set(y.x,y.y,y.z,y.w),d.a.FromFloat32ArrayToRefScaled(f.transform.matrix,0,1,r._tmpMat),r._xrSessionManager.scene.useRightHandedSystem||(r._tmpPos.z*=-1,r._tmpQuat.z*=-1,r._tmpQuat.w*=-1,r._tmpMat.toggleModelMatrixHandInPlace());var D={position:r.autoCloneTransformation?r._tmpPos.clone():r._tmpPos,rotationQuaternion:r.autoCloneTransformation?r._tmpQuat.clone():r._tmpQuat,transformationMatrix:r.autoCloneTransformation?r._tmpMat.clone():r._tmpMat,inputSource:n,isTransient:!!n,xrHitResult:u};o.push(D)}}),this.onHitTestResultObservable.notifyObservers(o)},t.Name=Si.HIT_TEST,t.Version=2,t}(xi);hi.AddWebXRFeature($h.Name,function(i,t){return function(){return new $h(i,t)}},$h.Version,!1);var Jh=function(i){function t(e){var n=i.call(this,e)||this;return n._enabled=!1,n._featurePointCloud=[],n.onFeaturePointsAddedObservable=new S.c,n.onFeaturePointsUpdatedObservable=new S.c,n.xrNativeFeatureName="bjsfeature-points",n._xrSessionManager.session?n._init():n._xrSessionManager.onXRSessionInit.addOnce(function(){n._init()}),n}return Object(p.d)(t,i),Object.defineProperty(t.prototype,"featurePointCloud",{get:function(){return this._featurePointCloud},enumerable:!1,configurable:!0}),t.prototype.detach=function(){return!!i.prototype.detach.call(this)&&(this.featurePointCloud.length=0,!0)},t.prototype.dispose=function(){i.prototype.dispose.call(this),this._featurePointCloud.length=0,this.onFeaturePointsUpdatedObservable.clear(),this.onFeaturePointsAddedObservable.clear()},t.prototype._onXRFrame=function(e){if(this.attached&&this._enabled&&e){var n=e.featurePointCloud;if(n&&n.length!==0){if(n.length%5!=0)throw new Error("Received malformed feature point cloud of length: "+n.length);for(var r=n.length/5,o=new Array,u=new Array,f=0;f<r;f++){var v=5*f,y=n[v+4];this._featurePointCloud[y]?o.push(y):(this._featurePointCloud[y]={position:new d.e,confidenceValue:0},u.push(y)),this._featurePointCloud[y].position.x=n[v],this._featurePointCloud[y].position.y=n[v+1],this._featurePointCloud[y].position.z=n[v+2],this._featurePointCloud[y].confidenceValue=n[v+3]}u.length>0&&this.onFeaturePointsAddedObservable.notifyObservers(u),o.length>0&&this.onFeaturePointsUpdatedObservable.notifyObservers(o)}}},t.prototype._init=function(){this._xrSessionManager.session.trySetFeaturePointCloudEnabled&&this._xrSessionManager.session.trySetFeaturePointCloudEnabled(!0)&&(this._enabled=!0)},t.Name=Si.FEATURE_POINTS,t.Version=1,t}(xi);hi.AddWebXRFeature(Jh.Name,function(i){return function(){return new Jh(i)}},Jh.Version);var rS=function(){function i(t,e,n,r,o){this.xrController=t,this.trackedMeshes=e,this._handMesh=n,this._rigMapping=r,this._defaultHandMesh=!1,this._transformNodeMapping=[],this.handPartsDefinition=this.generateHandPartsDefinition(t.inputSource.hand),this._scene=e[0].getScene(),this._handMesh&&this._rigMapping?this._defaultHandMesh=!1:o||this._generateDefaultHandMesh(),this.xrController.motionController&&(this.xrController.motionController.rootMesh?this.xrController.motionController.rootMesh.setEnabled(!1):this.xrController.motionController.onModelLoadedObservable.add(function(u){u.rootMesh&&u.rootMesh.setEnabled(!1)})),this.xrController.onMotionControllerInitObservable.add(function(u){u.onModelLoadedObservable.add(function(f){f.rootMesh&&f.rootMesh.setEnabled(!1)}),u.rootMesh&&u.rootMesh.setEnabled(!1)})}return i.prototype.generateHandPartsDefinition=function(t){var e;return(e={}).wrist=[t.WRIST],e.thumb=[t.THUMB_METACARPAL,t.THUMB_PHALANX_PROXIMAL,t.THUMB_PHALANX_DISTAL,t.THUMB_PHALANX_TIP],e.index=[t.INDEX_METACARPAL,t.INDEX_PHALANX_PROXIMAL,t.INDEX_PHALANX_INTERMEDIATE,t.INDEX_PHALANX_DISTAL,t.INDEX_PHALANX_TIP],e.middle=[t.MIDDLE_METACARPAL,t.MIDDLE_PHALANX_PROXIMAL,t.MIDDLE_PHALANX_INTERMEDIATE,t.MIDDLE_PHALANX_DISTAL,t.MIDDLE_PHALANX_TIP],e.ring=[t.RING_METACARPAL,t.RING_PHALANX_PROXIMAL,t.RING_PHALANX_INTERMEDIATE,t.RING_PHALANX_DISTAL,t.RING_PHALANX_TIP],e.little=[t.LITTLE_METACARPAL,t.LITTLE_PHALANX_PROXIMAL,t.LITTLE_PHALANX_INTERMEDIATE,t.LITTLE_PHALANX_DISTAL,t.LITTLE_PHALANX_TIP],e},i.prototype.updateFromXRFrame=function(t,e,n){var r=this;n===void 0&&(n=2);var o=this.xrController.inputSource.hand;o&&this.trackedMeshes.forEach(function(u,f){var v=o[f];if(v){var y=t.getJointPose(v,e);if(!y||!y.transform)return;var D=y.transform.position,w=y.transform.orientation;u.position.set(D.x,D.y,D.z),u.rotationQuaternion.set(w.x,w.y,w.z,w.w);var F=(y.radius||.008)*n;u.scaling.set(F,F,F),r._handMesh&&r._rigMapping&&r._rigMapping[f]&&(r._transformNodeMapping[f]=r._transformNodeMapping[f]||r._scene.getTransformNodeByName(r._rigMapping[f]),r._transformNodeMapping[f]&&(r._transformNodeMapping[f].position.copyFrom(u.position),r._transformNodeMapping[f].rotationQuaternion.copyFrom(u.rotationQuaternion),u.isVisible=!1)),u.getScene().useRightHandedSystem||(u.position.z*=-1,u.rotationQuaternion.z*=-1,u.rotationQuaternion.w*=-1)}})},i.prototype.getHandPartMeshes=function(t){var e=this;return this.handPartsDefinition[t].map(function(n){return e.trackedMeshes[n]})},i.prototype.dispose=function(){this.trackedMeshes.forEach(function(t){return t.dispose()}),this._defaultHandMesh&&this._handMesh&&this._handMesh.dispose()},i.prototype._generateDefaultHandMesh=function(){return Object(p.b)(this,void 0,void 0,function(){var t,e,n,r,o,u,f,v;return Object(p.e)(this,function(y){switch(y.label){case 0:return y.trys.push([0,3,,4]),t=this.xrController.inputSource.handedness==="right"?"right":"left",e=(t==="right"?"r":"l")+"_hand_"+(this._scene.useRightHandedSystem?"r":"l")+"hs.glb",[4,an.ImportMeshAsync("","https://assets.babylonjs.com/meshes/HandMeshes/",e,this._scene)];case 1:return n=y.sent(),r={base:M.a.FromInts(116,63,203),fresnel:M.a.FromInts(149,102,229),fingerColor:M.a.FromInts(177,130,255),tipFresnel:M.a.FromInts(220,200,255)},[4,(o=new Dh("leftHandShader",this._scene,{emitComments:!1})).loadAsync("https://patrickryanms.github.io/BabylonJStextures/Demos/xrHandMesh/handsShader.json")];case 2:if(y.sent(),o.build(!1),o.needDepthPrePass=!0,o.transparencyMode=pn.a.MATERIAL_ALPHABLEND,o.alphaMode=Ge.a.ALPHA_COMBINE,(u={base:o.getBlockByName("baseColor"),fresnel:o.getBlockByName("fresnelColor"),fingerColor:o.getBlockByName("fingerColor"),tipFresnel:o.getBlockByName("tipFresnelColor")}).base.value=r.base,u.fresnel.value=r.fresnel,u.fingerColor.value=r.fingerColor,u.tipFresnel.value=r.tipFresnel,n.meshes[1].material=o,this._defaultHandMesh=!0,this._handMesh=n.meshes[0],this._rigMapping=["wrist_","thumb_metacarpal_","thumb_proxPhalanx_","thumb_distPhalanx_","thumb_tip_","index_metacarpal_","index_proxPhalanx_","index_intPhalanx_","index_distPhalanx_","index_tip_","middle_metacarpal_","middle_proxPhalanx_","middle_intPhalanx_","middle_distPhalanx_","middle_tip_","ring_metacarpal_","ring_proxPhalanx_","ring_intPhalanx_","ring_distPhalanx_","ring_tip_","little_metacarpal_","little_proxPhalanx_","little_intPhalanx_","little_distPhalanx_","little_tip_"].map(function(D){return D+(t==="right"?"R":"L")}),!(f=this._scene.getTransformNodeByName(this._rigMapping[0])))throw new Error("could not find the wrist node");return f.parent&&f.parent.rotate(Se.a.Y,Math.PI),[3,4];case 3:return v=y.sent(),et.b.Error("error loading hand mesh"),console.log(v),[3,4];case 4:return[2]}})})},i}(),ed=function(i){function t(e,n){var r=i.call(this,e)||this;return r.options=n,r.onHandAddedObservable=new S.c,r.onHandRemovedObservable=new S.c,r._hands={},r._attachHand=function(o){var u,f,v,y,D,w,F,z,k,K;if(o.inputSource.hand&&!r._hands[o.uniqueId]){var oe=o.inputSource.hand,ae=[],ue=((u=r.options.jointMeshes)===null||u===void 0?void 0:u.sourceMesh)||zr.a.CreateSphere("jointParent",{diameter:1});ue.isVisible=!!((f=r.options.jointMeshes)===null||f===void 0?void 0:f.keepOriginalVisible);for(var de=0;de<oe.length;++de){var me=ue.createInstance(o.uniqueId+"-handJoint-"+de);if((v=r.options.jointMeshes)===null||v===void 0?void 0:v.onHandJointMeshGenerated){var ye=r.options.jointMeshes.onHandJointMeshGenerated(me,de,o.uniqueId);ye&&ye!==me&&(me.dispose(),me=ye)}if(me.isPickable=!1,(y=r.options.jointMeshes)===null||y===void 0?void 0:y.enablePhysics){var Ee=r.options.jointMeshes.physicsProps||{},Ae=Ee.impostorType!==void 0?Ee.impostorType:Ut.a.SphereImpostor;me.physicsImpostor=new Ut.a(me,Ae,Object(p.a)({mass:0},Ee))}me.rotationQuaternion=new d.b,((D=r.options.jointMeshes)===null||D===void 0?void 0:D.invisible)&&(me.isVisible=!1),ae.push(me)}var Ie=o.inputSource.handedness==="right"?"right":"left",Re=((w=r.options.jointMeshes)===null||w===void 0?void 0:w.handMeshes)&&((F=r.options.jointMeshes)===null||F===void 0?void 0:F.handMeshes[Ie]),Pe=((z=r.options.jointMeshes)===null||z===void 0?void 0:z.rigMapping)&&((k=r.options.jointMeshes)===null||k===void 0?void 0:k.rigMapping[Ie]),Ce=new rS(o,ae,Re,Pe,(K=r.options.jointMeshes)===null||K===void 0?void 0:K.disableDefaultHandMesh);r._hands[o.uniqueId]={handObject:Ce,id:t._idCounter++},r.onHandAddedObservable.notifyObservers(Ce)}},r.xrNativeFeatureName="hand-tracking",r}return Object(p.d)(t,i),t.prototype.isCompatible=function(){return typeof XRHand!="undefined"},t.prototype.attach=function(){var e=this;return!!i.prototype.attach.call(this)&&(this.options.xrInput.controllers.forEach(this._attachHand),this._addNewAttachObserver(this.options.xrInput.onControllerAddedObservable,this._attachHand),this._addNewAttachObserver(this.options.xrInput.onControllerRemovedObservable,function(n){e._detachHand(n.uniqueId)}),!0)},t.prototype.detach=function(){var e=this;return!!i.prototype.detach.call(this)&&(Object.keys(this._hands).forEach(function(n){e._detachHand(n)}),!0)},t.prototype.dispose=function(){i.prototype.dispose.call(this),this.onHandAddedObservable.clear()},t.prototype.getHandByControllerId=function(e){var n;return((n=this._hands[e])===null||n===void 0?void 0:n.handObject)||null},t.prototype.getHandByHandedness=function(e){var n=this,r=Object.keys(this._hands).map(function(o){return n._hands[o].handObject.xrController.inputSource.handedness}).indexOf(e);return r!==-1?this._hands[r].handObject:null},t.prototype._onXRFrame=function(e){var n=this;Object.keys(this._hands).forEach(function(r){var o;n._hands[r].handObject.updateFromXRFrame(e,n._xrSessionManager.referenceSpace,(o=n.options.jointMeshes)===null||o===void 0?void 0:o.scaleFactor)})},t.prototype._detachHand=function(e){this._hands[e]&&(this.onHandRemovedObservable.notifyObservers(this._hands[e].handObject),this._hands[e].handObject.dispose())},t._idCounter=0,t.Name=Si.HAND_TRACKING,t.Version=1,t}(xi);hi.AddWebXRFeature(ed.Name,function(i,t){return function(){return new ed(i,t)}},ed.Version,!1);var iS=function(i){function t(e,n,r){var o=i.call(this,e,HN["left-right"],n,r)||this;return o._mapping={defaultButton:{valueNodeName:"VALUE",unpressedNodeName:"UNPRESSED",pressedNodeName:"PRESSED"},defaultAxis:{valueNodeName:"VALUE",minNodeName:"MIN",maxNodeName:"MAX"},buttons:{"xr-standard-trigger":{rootNodeName:"SELECT",componentProperty:"button",states:["default","touched","pressed"]},"xr-standard-squeeze":{rootNodeName:"GRASP",componentProperty:"state",states:["pressed"]},"xr-standard-touchpad":{rootNodeName:"TOUCHPAD_PRESS",labelAnchorNodeName:"squeeze-label",touchPointNodeName:"TOUCH"},"xr-standard-thumbstick":{rootNodeName:"THUMBSTICK_PRESS",componentProperty:"state",states:["pressed"]}},axes:{"xr-standard-touchpad":{"x-axis":{rootNodeName:"TOUCHPAD_TOUCH_X"},"y-axis":{rootNodeName:"TOUCHPAD_TOUCH_Y"}},"xr-standard-thumbstick":{"x-axis":{rootNodeName:"THUMBSTICK_X"},"y-axis":{rootNodeName:"THUMBSTICK_Y"}}}},o.profileId="microsoft-mixed-reality",o}return Object(p.d)(t,i),t.prototype._getFilenameAndPath=function(){return{filename:this.handedness==="left"?t.MODEL_LEFT_FILENAME:t.MODEL_RIGHT_FILENAME,path:t.MODEL_BASE_URL+"default/"}},t.prototype._getModelLoadingConstraints=function(){var e=an.IsPluginForExtensionAvailable(".glb");return e||_.a.Warn("glTF / glb loaded was not registered, using generic controller instead"),e},t.prototype._processLoadedModel=function(e){var n=this;this.rootMesh&&(this.getComponentIds().forEach(function(r,o){if(!n.disableAnimation&&r&&n.rootMesh){var u=n._mapping.buttons[r],f=u.rootNodeName;if(!f)return void _.a.Log("Skipping unknown button at index: "+o+" with mapped name: "+r);var v=n._getChildByName(n.rootMesh,f);if(!v)return void _.a.Warn("Missing button mesh with name: "+f);if(u.valueMesh=n._getImmediateChildByName(v,n._mapping.defaultButton.valueNodeName),u.pressedMesh=n._getImmediateChildByName(v,n._mapping.defaultButton.pressedNodeName),u.unpressedMesh=n._getImmediateChildByName(v,n._mapping.defaultButton.unpressedNodeName),u.valueMesh&&u.pressedMesh&&u.unpressedMesh){var y=n.getComponent(r);y&&y.onButtonStateChangedObservable.add(function(D){n._lerpTransform(u,D.value)},void 0,!0)}else _.a.Warn("Missing button submesh under mesh with name: "+f)}}),this.getComponentIds().forEach(function(r,o){var u=n.getComponent(r);u.isAxes()&&["x-axis","y-axis"].forEach(function(f){if(n.rootMesh){var v=n._mapping.axes[r][f],y=n._getChildByName(n.rootMesh,v.rootNodeName);y?(v.valueMesh=n._getImmediateChildByName(y,n._mapping.defaultAxis.valueNodeName),v.minMesh=n._getImmediateChildByName(y,n._mapping.defaultAxis.minNodeName),v.maxMesh=n._getImmediateChildByName(y,n._mapping.defaultAxis.maxNodeName),v.valueMesh&&v.minMesh&&v.maxMesh?u&&u.onAxisValueChangedObservable.add(function(D){var w=f==="x-axis"?D.x:D.y;n._lerpTransform(v,w,!0)},void 0,!0):_.a.Warn("Missing axis submesh under mesh with name: "+v.rootNodeName)):_.a.Warn("Missing axis mesh with name: "+v.rootNodeName)}})}))},t.prototype._setRootMesh=function(e){var n;this.rootMesh=new Ne.a(this.profileId+" "+this.handedness,this.scene),this.rootMesh.isPickable=!1;for(var r=0;r<e.length;r++){var o=e[r];o.isPickable=!1,o.parent||(n=o)}n&&n.setParent(this.rootMesh),this.scene.useRightHandedSystem||(this.rootMesh.rotationQuaternion=d.b.FromEulerAngles(0,Math.PI,0))},t.prototype._updateModel=function(){},t.MODEL_BASE_URL="https://controllers.babylonjs.com/microsoft/",t.MODEL_LEFT_FILENAME="left.glb",t.MODEL_RIGHT_FILENAME="right.glb",t}(Ps);Gr.RegisterController("windows-mixed-reality",function(i,t){return new iS(t,i.gamepad,i.handedness)});var HN={left:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{xr_standard_trigger_pressed:{componentProperty:"button",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_trigger_pressed_value",minNodeName:"xr_standard_trigger_pressed_min",maxNodeName:"xr_standard_trigger_pressed_max"}}},"xr-standard-squeeze":{type:"squeeze",gamepadIndices:{button:1},rootNodeName:"xr_standard_squeeze",visualResponses:{xr_standard_squeeze_pressed:{componentProperty:"button",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_squeeze_pressed_value",minNodeName:"xr_standard_squeeze_pressed_min",maxNodeName:"xr_standard_squeeze_pressed_max"}}},"xr-standard-touchpad":{type:"touchpad",gamepadIndices:{button:2,xAxis:0,yAxis:1},rootNodeName:"xr_standard_touchpad",visualResponses:{xr_standard_touchpad_pressed:{componentProperty:"button",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_pressed_value",minNodeName:"xr_standard_touchpad_pressed_min",maxNodeName:"xr_standard_touchpad_pressed_max"},xr_standard_touchpad_xaxis_pressed:{componentProperty:"xAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_xaxis_pressed_value",minNodeName:"xr_standard_touchpad_xaxis_pressed_min",maxNodeName:"xr_standard_touchpad_xaxis_pressed_max"},xr_standard_touchpad_yaxis_pressed:{componentProperty:"yAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_yaxis_pressed_value",minNodeName:"xr_standard_touchpad_yaxis_pressed_min",maxNodeName:"xr_standard_touchpad_yaxis_pressed_max"},xr_standard_touchpad_xaxis_touched:{componentProperty:"xAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_xaxis_touched_value",minNodeName:"xr_standard_touchpad_xaxis_touched_min",maxNodeName:"xr_standard_touchpad_xaxis_touched_max"},xr_standard_touchpad_yaxis_touched:{componentProperty:"yAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_yaxis_touched_value",minNodeName:"xr_standard_touchpad_yaxis_touched_min",maxNodeName:"xr_standard_touchpad_yaxis_touched_max"},xr_standard_touchpad_axes_touched:{componentProperty:"state",states:["touched","pressed"],valueNodeProperty:"visibility",valueNodeName:"xr_standard_touchpad_axes_touched_value"}},touchPointNodeName:"xr_standard_touchpad_axes_touched_value"},"xr-standard-thumbstick":{type:"thumbstick",gamepadIndices:{button:3,xAxis:2,yAxis:3},rootNodeName:"xr_standard_thumbstick",visualResponses:{xr_standard_thumbstick_pressed:{componentProperty:"button",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_thumbstick_pressed_value",minNodeName:"xr_standard_thumbstick_pressed_min",maxNodeName:"xr_standard_thumbstick_pressed_max"},xr_standard_thumbstick_xaxis_pressed:{componentProperty:"xAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_thumbstick_xaxis_pressed_value",minNodeName:"xr_standard_thumbstick_xaxis_pressed_min",maxNodeName:"xr_standard_thumbstick_xaxis_pressed_max"},xr_standard_thumbstick_yaxis_pressed:{componentProperty:"yAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_thumbstick_yaxis_pressed_value",minNodeName:"xr_standard_thumbstick_yaxis_pressed_min",maxNodeName:"xr_standard_thumbstick_yaxis_pressed_max"}}}},gamepadMapping:"xr-standard",rootNodeName:"microsoft-mixed-reality-left",assetPath:"left.glb"},right:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{xr_standard_trigger_pressed:{componentProperty:"button",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_trigger_pressed_value",minNodeName:"xr_standard_trigger_pressed_min",maxNodeName:"xr_standard_trigger_pressed_max"}}},"xr-standard-squeeze":{type:"squeeze",gamepadIndices:{button:1},rootNodeName:"xr_standard_squeeze",visualResponses:{xr_standard_squeeze_pressed:{componentProperty:"button",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_squeeze_pressed_value",minNodeName:"xr_standard_squeeze_pressed_min",maxNodeName:"xr_standard_squeeze_pressed_max"}}},"xr-standard-touchpad":{type:"touchpad",gamepadIndices:{button:2,xAxis:0,yAxis:1},rootNodeName:"xr_standard_touchpad",visualResponses:{xr_standard_touchpad_pressed:{componentProperty:"button",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_pressed_value",minNodeName:"xr_standard_touchpad_pressed_min",maxNodeName:"xr_standard_touchpad_pressed_max"},xr_standard_touchpad_xaxis_pressed:{componentProperty:"xAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_xaxis_pressed_value",minNodeName:"xr_standard_touchpad_xaxis_pressed_min",maxNodeName:"xr_standard_touchpad_xaxis_pressed_max"},xr_standard_touchpad_yaxis_pressed:{componentProperty:"yAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_yaxis_pressed_value",minNodeName:"xr_standard_touchpad_yaxis_pressed_min",maxNodeName:"xr_standard_touchpad_yaxis_pressed_max"},xr_standard_touchpad_xaxis_touched:{componentProperty:"xAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_xaxis_touched_value",minNodeName:"xr_standard_touchpad_xaxis_touched_min",maxNodeName:"xr_standard_touchpad_xaxis_touched_max"},xr_standard_touchpad_yaxis_touched:{componentProperty:"yAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_yaxis_touched_value",minNodeName:"xr_standard_touchpad_yaxis_touched_min",maxNodeName:"xr_standard_touchpad_yaxis_touched_max"},xr_standard_touchpad_axes_touched:{componentProperty:"state",states:["touched","pressed"],valueNodeProperty:"visibility",valueNodeName:"xr_standard_touchpad_axes_touched_value"}},touchPointNodeName:"xr_standard_touchpad_axes_touched_value"},"xr-standard-thumbstick":{type:"thumbstick",gamepadIndices:{button:3,xAxis:2,yAxis:3},rootNodeName:"xr_standard_thumbstick",visualResponses:{xr_standard_thumbstick_pressed:{componentProperty:"button",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_thumbstick_pressed_value",minNodeName:"xr_standard_thumbstick_pressed_min",maxNodeName:"xr_standard_thumbstick_pressed_max"},xr_standard_thumbstick_xaxis_pressed:{componentProperty:"xAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_thumbstick_xaxis_pressed_value",minNodeName:"xr_standard_thumbstick_xaxis_pressed_min",maxNodeName:"xr_standard_thumbstick_xaxis_pressed_max"},xr_standard_thumbstick_yaxis_pressed:{componentProperty:"yAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_thumbstick_yaxis_pressed_value",minNodeName:"xr_standard_thumbstick_yaxis_pressed_min",maxNodeName:"xr_standard_thumbstick_yaxis_pressed_max"}}}},gamepadMapping:"xr-standard",rootNodeName:"microsoft-mixed-reality-right",assetPath:"right.glb"}},v_=function(i){function t(e,n,r,o,u){u===void 0&&(u=!1);var f=i.call(this,e,WN[r],n,r)||this;return f._forceLegacyControllers=u,f.profileId="oculus-touch",f}return Object(p.d)(t,i),t.prototype._getFilenameAndPath=function(){return{filename:this.handedness==="left"?t.MODEL_LEFT_FILENAME:t.MODEL_RIGHT_FILENAME,path:this._isQuest()?t.QUEST_MODEL_BASE_URL:t.MODEL_BASE_URL}},t.prototype._getModelLoadingConstraints=function(){return!0},t.prototype._processLoadedModel=function(e){var n=this,r=this._isQuest(),o=this.handedness==="right"?-1:1;this.getComponentIds().forEach(function(u){var f=u&&n.getComponent(u);f&&f.onButtonStateChangedObservable.add(function(v){if(n.rootMesh&&!n.disableAnimation)switch(u){case"xr-standard-trigger":return void(r||(n._modelRootNode.getChildren()[3].rotation.x=.2*-v.value,n._modelRootNode.getChildren()[3].position.y=.005*-v.value,n._modelRootNode.getChildren()[3].position.z=.005*-v.value));case"xr-standard-squeeze":return void(r||(n._modelRootNode.getChildren()[4].position.x=o*v.value*.0035));case"xr-standard-thumbstick":return;case"a-button":case"x-button":return void(r||(v.pressed?n._modelRootNode.getChildren()[1].position.y=-.001:n._modelRootNode.getChildren()[1].position.y=0));case"b-button":case"y-button":return void(r||(v.pressed?n._modelRootNode.getChildren()[2].position.y=-.001:n._modelRootNode.getChildren()[2].position.y=0))}},void 0,!0)})},t.prototype._setRootMesh=function(e){this.rootMesh=new Ne.a(this.profileId+" "+this.handedness,this.scene),this.scene.useRightHandedSystem||(this.rootMesh.rotationQuaternion=d.b.FromEulerAngles(0,Math.PI,0)),e.forEach(function(n){n.isPickable=!1}),this._isQuest()?this._modelRootNode=e[0]:(this._modelRootNode=e[1],this.rootMesh.position.y=.034,this.rootMesh.position.z=.052),this._modelRootNode.parent=this.rootMesh},t.prototype._updateModel=function(){},t.prototype._isQuest=function(){return!!navigator.userAgent.match(/Quest/gi)&&!this._forceLegacyControllers},t.MODEL_BASE_URL="https://controllers.babylonjs.com/oculus/",t.MODEL_LEFT_FILENAME="left.babylon",t.MODEL_RIGHT_FILENAME="right.babylon",t.QUEST_MODEL_BASE_URL="https://controllers.babylonjs.com/oculusQuest/",t}(Ps);Gr.RegisterController("oculus-touch",function(i,t){return new v_(t,i.gamepad,i.handedness)}),Gr.RegisterController("oculus-touch-legacy",function(i,t){return new v_(t,i.gamepad,i.handedness,!0)});var WN={left:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{}},"xr-standard-squeeze":{type:"squeeze",gamepadIndices:{button:1},rootNodeName:"xr_standard_squeeze",visualResponses:{}},"xr-standard-thumbstick":{type:"thumbstick",gamepadIndices:{button:3,xAxis:2,yAxis:3},rootNodeName:"xr_standard_thumbstick",visualResponses:{}},"x-button":{type:"button",gamepadIndices:{button:4},rootNodeName:"x_button",visualResponses:{}},"y-button":{type:"button",gamepadIndices:{button:5},rootNodeName:"y_button",visualResponses:{}},thumbrest:{type:"button",gamepadIndices:{button:6},rootNodeName:"thumbrest",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"oculus-touch-v2-left",assetPath:"left.glb"},right:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{}},"xr-standard-squeeze":{type:"squeeze",gamepadIndices:{button:1},rootNodeName:"xr_standard_squeeze",visualResponses:{}},"xr-standard-thumbstick":{type:"thumbstick",gamepadIndices:{button:3,xAxis:2,yAxis:3},rootNodeName:"xr_standard_thumbstick",visualResponses:{}},"a-button":{type:"button",gamepadIndices:{button:4},rootNodeName:"a_button",visualResponses:{}},"b-button":{type:"button",gamepadIndices:{button:5},rootNodeName:"b_button",visualResponses:{}},thumbrest:{type:"button",gamepadIndices:{button:6},rootNodeName:"thumbrest",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"oculus-touch-v2-right",assetPath:"right.glb"}},oS=function(i){function t(e,n,r){var o=i.call(this,e,XN[r],n,r)||this;return o.profileId="htc-vive",o}return Object(p.d)(t,i),t.prototype._getFilenameAndPath=function(){return{filename:t.MODEL_FILENAME,path:t.MODEL_BASE_URL}},t.prototype._getModelLoadingConstraints=function(){return!0},t.prototype._processLoadedModel=function(e){var n=this;this.getComponentIds().forEach(function(r){var o=r&&n.getComponent(r);o&&o.onButtonStateChangedObservable.add(function(u){if(n.rootMesh&&!n.disableAnimation)switch(r){case"xr-standard-trigger":return void(n._modelRootNode.getChildren()[6].rotation.x=.15*-u.value);case"xr-standard-touchpad":case"xr-standard-squeeze":return}},void 0,!0)})},t.prototype._setRootMesh=function(e){this.rootMesh=new Ne.a(this.profileId+" "+this.handedness,this.scene),e.forEach(function(n){n.isPickable=!1}),this._modelRootNode=e[1],this._modelRootNode.parent=this.rootMesh,this.scene.useRightHandedSystem||(this.rootMesh.rotationQuaternion=d.b.FromEulerAngles(0,Math.PI,0))},t.prototype._updateModel=function(){},t.MODEL_BASE_URL="https://controllers.babylonjs.com/vive/",t.MODEL_FILENAME="wand.babylon",t}(Ps);Gr.RegisterController("htc-vive",function(i,t){return new oS(t,i.gamepad,i.handedness)});var XN={left:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{}},"xr-standard-squeeze":{type:"squeeze",gamepadIndices:{button:1},rootNodeName:"xr_standard_squeeze",visualResponses:{}},"xr-standard-touchpad":{type:"touchpad",gamepadIndices:{button:2,xAxis:0,yAxis:1},rootNodeName:"xr_standard_touchpad",visualResponses:{}},menu:{type:"button",gamepadIndices:{button:4},rootNodeName:"menu",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"htc_vive_none",assetPath:"none.glb"},right:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{}},"xr-standard-squeeze":{type:"squeeze",gamepadIndices:{button:1},rootNodeName:"xr_standard_squeeze",visualResponses:{}},"xr-standard-touchpad":{type:"touchpad",gamepadIndices:{button:2,xAxis:0,yAxis:1},rootNodeName:"xr_standard_touchpad",visualResponses:{}},menu:{type:"button",gamepadIndices:{button:4},rootNodeName:"menu",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"htc_vive_none",assetPath:"none.glb"},none:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{}},"xr-standard-squeeze":{type:"squeeze",gamepadIndices:{button:1},rootNodeName:"xr_standard_squeeze",visualResponses:{}},"xr-standard-touchpad":{type:"touchpad",gamepadIndices:{button:2,xAxis:0,yAxis:1},rootNodeName:"xr_standard_touchpad",visualResponses:{}},menu:{type:"button",gamepadIndices:{button:4},rootNodeName:"menu",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"htc-vive-none",assetPath:"none.glb"}}},function(h,s,c){c.d(s,"a",function(){return g});var E=c(34),m=function(){function O(){this.children=[]}return O.prototype.isValid=function(R){return!0},O.prototype.process=function(R,N){var V="";if(this.line){var U=this.line,L=N.processor;L&&(L.lineProcessor&&(U=L.lineProcessor(U,N.isFragment)),L.attributeProcessor&&E.a.StartsWith(this.line,"attribute")?U=L.attributeProcessor(this.line):L.varyingProcessor&&E.a.StartsWith(this.line,"varying")?U=L.varyingProcessor(this.line,N.isFragment):(L.uniformProcessor||L.uniformBufferProcessor)&&E.a.StartsWith(this.line,"uniform")&&(/uniform (.+) (.+)/.test(this.line)?L.uniformProcessor&&(U=L.uniformProcessor(this.line,N.isFragment)):L.uniformBufferProcessor&&(U=L.uniformBufferProcessor(this.line,N.isFragment),N.lookForClosingBracketForUniformBuffer=!0)),L.endOfUniformBufferProcessor&&N.lookForClosingBracketForUniformBuffer&&this.line.indexOf("}")!==-1&&(N.lookForClosingBracketForUniformBuffer=!1,U=L.endOfUniformBufferProcessor(this.line,N.isFragment))),V+=U+`\r
`}return this.children.forEach(function(j){V+=j.process(R,N)}),this.additionalDefineKey&&(R[this.additionalDefineKey]=this.additionalDefineValue||"true"),V},O}(),S=function(){function O(){}return Object.defineProperty(O.prototype,"currentLine",{get:function(){return this._lines[this.lineIndex]},enumerable:!1,configurable:!0}),Object.defineProperty(O.prototype,"canRead",{get:function(){return this.lineIndex<this._lines.length-1},enumerable:!1,configurable:!0}),Object.defineProperty(O.prototype,"lines",{set:function(R){this._lines=[];for(var N=0,V=R;N<V.length;N++){var U=V[N];if(U[0]!=="#")for(var L=U.split(";"),j=0;j<L.length;j++){var Y=L[j];(Y=Y.trim())&&this._lines.push(Y+(j!==L.length-1?";":""))}else this._lines.push(U)}},enumerable:!1,configurable:!0}),O}(),d=c(1),M=function(O){function R(){return O!==null&&O.apply(this,arguments)||this}return Object(d.d)(R,O),R.prototype.process=function(N,V){for(var U=0;U<this.children.length;U++){var L=this.children[U];if(L.isValid(N))return L.process(N,V)}return""},R}(m),C=function(O){function R(){return O!==null&&O.apply(this,arguments)||this}return Object(d.d)(R,O),R.prototype.isValid=function(N){return this.testExpression.isTrue(N)},R}(m),I=function(){function O(){}return O.prototype.isTrue=function(R){return!0},O.postfixToInfix=function(R){for(var N=[],V=0,U=R;V<U.length;V++){var L=U[V];if(O._OperatorPriority[L]===void 0)N.push(L);else{var j=N[N.length-1],Y=N[N.length-2];N.length-=2,N.push("("+Y+L+j+")")}}return N[N.length-1]},O.infixToPostfix=function(R){for(var N=[],V=-1,U=function(){(re=re.trim())!==""&&(N.push(re),re="")},L=function(_e){V<O._Stack.length-1&&(O._Stack[++V]=_e)},j=function(){return O._Stack[V]},Y=function(){return V===-1?"!!INVALID EXPRESSION!!":O._Stack[V--]},W=0,re="";W<R.length;){var ne=R.charAt(W),ge=W<R.length-1?R.substr(W,2):"";if(ne==="(")re="",L(ne);else if(ne===")"){for(U();V!==-1&&j()!=="(";)N.push(Y());Y()}else if(O._OperatorPriority[ge]>1){for(U();V!==-1&&O._OperatorPriority[j()]>=O._OperatorPriority[ge];)N.push(Y());L(ge),W++}else re+=ne;W++}for(U();V!==-1;)j()==="("?Y():N.push(Y());return N},O._OperatorPriority={")":0,"(":1,"||":2,"&&":3},O._Stack=["","","","","","","","","","","","","","","","","","","",""],O}(),b=function(O){function R(N,V){V===void 0&&(V=!1);var U=O.call(this)||this;return U.define=N,U.not=V,U}return Object(d.d)(R,O),R.prototype.isTrue=function(N){var V=N[this.define]!==void 0;return this.not&&(V=!V),V},R}(I),p=function(O){function R(){return O!==null&&O.apply(this,arguments)||this}return Object(d.d)(R,O),R.prototype.isTrue=function(N){return this.leftOperand.isTrue(N)||this.rightOperand.isTrue(N)},R}(I),x=function(O){function R(){return O!==null&&O.apply(this,arguments)||this}return Object(d.d)(R,O),R.prototype.isTrue=function(N){return this.leftOperand.isTrue(N)&&this.rightOperand.isTrue(N)},R}(I),P=function(O){function R(N,V,U){var L=O.call(this)||this;return L.define=N,L.operand=V,L.testValue=U,L}return Object(d.d)(R,O),R.prototype.isTrue=function(N){var V=N[this.define];V===void 0&&(V=this.define);var U=!1,L=parseInt(V),j=parseInt(this.testValue);switch(this.operand){case">":U=L>j;break;case"<":U=L<j;break;case"<=":U=L<=j;break;case">=":U=L>=j;break;case"==":U=L===j}return U},R}(I),A=c(21),T=/defined\s*?\((.+?)\)/g,_=/defined\s*?\[(.+?)\]/g,g=function(){function O(){}return O.Process=function(R,N,V,U){var L=this;this._ProcessIncludes(R,N,function(j){var Y=L._ProcessShaderConversion(j,N,U);V(Y)})},O._ProcessPrecision=function(R,N){var V=N.shouldUseHighPrecisionShader;return R.indexOf("precision highp float")===-1?R=V?`precision highp float;
`+R:`precision mediump float;
`+R:V||(R=R.replace("precision highp float","precision mediump float")),R},O._ExtractOperation=function(R){var N=/defined\((.+)\)/.exec(R);if(N&&N.length)return new b(N[1].trim(),R[0]==="!");for(var V="",U=0,L=0,j=["==",">=","<=","<",">"];L<j.length&&(V=j[L],!((U=R.indexOf(V))>-1));L++);if(U===-1)return new b(R);var Y=R.substring(0,U).trim(),W=R.substring(U+V.length).trim();return new P(Y,V,W)},O._BuildSubExpression=function(R){R=R.replace(T,"defined[$1]");for(var N=[],V=0,U=I.infixToPostfix(R);V<U.length;V++){var L=U[V];if(L!=="||"&&L!=="&&")N.push(L);else if(N.length>=2){var j=N[N.length-1],Y=N[N.length-2];N.length-=2;var W=L=="&&"?new x:new p;typeof j=="string"&&(j=j.replace(_,"defined($1)")),typeof Y=="string"&&(Y=Y.replace(_,"defined($1)")),W.leftOperand=typeof Y=="string"?this._ExtractOperation(Y):Y,W.rightOperand=typeof j=="string"?this._ExtractOperation(j):j,N.push(W)}}var re=N[N.length-1];return typeof re=="string"&&(re=re.replace(_,"defined($1)")),typeof re=="string"?this._ExtractOperation(re):re},O._BuildExpression=function(R,N){var V=new C,U=R.substring(0,N),L=R.substring(N);return L=L.substring(0,(L.indexOf("//")+1||L.length+1)-1).trim(),V.testExpression=U==="#ifdef"?new b(L):U==="#ifndef"?new b(L,!0):this._BuildSubExpression(L),V},O._MoveCursorWithinIf=function(R,N,V){for(var U=R.currentLine;this._MoveCursor(R,V);){var L=(U=R.currentLine).substring(0,5).toLowerCase();if(L==="#else"){var j=new m;return N.children.push(j),void this._MoveCursor(R,j)}if(L==="#elif"){var Y=this._BuildExpression(U,5);N.children.push(Y),V=Y}}},O._MoveCursor=function(R,N){for(;R.canRead;){R.lineIndex++;var V=R.currentLine,U=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/.exec(V);if(U&&U.length)switch(U[0]){case"#ifdef":var L=new M;N.children.push(L);var j=this._BuildExpression(V,6);L.children.push(j),this._MoveCursorWithinIf(R,L,j);break;case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":L=new M,N.children.push(L),j=this._BuildExpression(V,7),L.children.push(j),this._MoveCursorWithinIf(R,L,j);break;case"#if":L=new M,j=this._BuildExpression(V,3),N.children.push(L),L.children.push(j),this._MoveCursorWithinIf(R,L,j)}else{var Y=new m;if(Y.line=V,N.children.push(Y),V[0]==="#"&&V[1]==="d"){var W=V.replace(";","").split(" ");Y.additionalDefineKey=W[1],W.length===3&&(Y.additionalDefineValue=W[2])}}}return!1},O._EvaluatePreProcessors=function(R,N,V){var U=new m,L=new S;return L.lineIndex=-1,L.lines=R.split(`
`),this._MoveCursor(L,U),U.process(N,V)},O._PreparePreProcessors=function(R){for(var N={},V=0,U=R.defines;V<U.length;V++){var L=U[V].replace("#define","").replace(";","").trim().split(" ");N[L[0]]=L.length>1?L[1]:""}return N.GL_ES="true",N.__VERSION__=R.version,N[R.platformName]="true",N},O._ProcessShaderConversion=function(R,N,V){var U=this._ProcessPrecision(R,N);if(!N.processor)return U;if(U.indexOf("#version 3")!==-1)return U.replace("#version 300 es","");var L=N.defines,j=this._PreparePreProcessors(N);return N.processor.preProcessor&&(U=N.processor.preProcessor(U,L,N.isFragment)),U=this._EvaluatePreProcessors(U,j,N),N.processor.postProcessor&&(U=N.processor.postProcessor(U,L,N.isFragment,V)),U},O._ProcessIncludes=function(R,N,V){for(var U=this,L=/#include<(.+)>(\((.*)\))*(\[(.*)\])*/g,j=L.exec(R),Y=new String(R),W=!1;j!=null;){var re=j[1];if(re.indexOf("__decl__")!==-1&&(re=re.replace(/__decl__/,""),N.supportsUniformBuffers&&(re=(re=re.replace(/Vertex/,"Ubo")).replace(/Fragment/,"Ubo")),re+="Declaration"),!N.includesShadersStore[re]){var ne=N.shadersRepository+"ShadersInclude/"+re+".fx";return void O._FileToolsLoadFile(ne,function(q){N.includesShadersStore[re]=q,U._ProcessIncludes(Y,N,V)})}var ge=N.includesShadersStore[re];if(j[2])for(var _e=j[3].split(","),ce=0;ce<_e.length;ce+=2){var ie=new RegExp(_e[ce],"g"),Z=_e[ce+1];ge=ge.replace(ie,Z)}if(j[4]){var te=j[5];if(te.indexOf("..")!==-1){var B=te.split(".."),G=parseInt(B[0]),$=parseInt(B[1]),le=ge.slice(0);ge="",isNaN($)&&($=N.indexParameters[B[1]]);for(var se=G;se<$;se++)N.supportsUniformBuffers||(le=le.replace(/light\{X\}.(\w*)/g,function(q,H){return H+"{X}"})),ge+=le.replace(/\{X\}/g,se.toString())+`
`}else N.supportsUniformBuffers||(ge=ge.replace(/light\{X\}.(\w*)/g,function(q,H){return H+"{X}"})),ge=ge.replace(/\{X\}/g,te)}Y=Y.replace(j[0],ge),W=W||ge.indexOf("#include<")>=0,j=L.exec(R)}W?this._ProcessIncludes(Y.toString(),N,V):V(Y)},O._FileToolsLoadFile=function(R,N,V,U,L,j){throw A.a.WarnImport("FileTools")},O}()},function(h,s,c){c(26).a.prototype._readTexturePixels=function(E,m,S,d,M,C){d===void 0&&(d=-1),M===void 0&&(M=0),C===void 0&&(C=null);var I=this._gl;if(!I)throw new Error("Engine does not have gl rendering context.");if(!this._dummyFramebuffer){var b=I.createFramebuffer();if(!b)throw new Error("Unable to create dummy framebuffer");this._dummyFramebuffer=b}I.bindFramebuffer(I.FRAMEBUFFER,this._dummyFramebuffer),d>-1?I.framebufferTexture2D(I.FRAMEBUFFER,I.COLOR_ATTACHMENT0,I.TEXTURE_CUBE_MAP_POSITIVE_X+d,E._webGLTexture,M):I.framebufferTexture2D(I.FRAMEBUFFER,I.COLOR_ATTACHMENT0,I.TEXTURE_2D,E._webGLTexture,M);var p=E.type!==void 0?this._getWebGLTextureType(E.type):I.UNSIGNED_BYTE;switch(p){case I.UNSIGNED_BYTE:C||(C=new Uint8Array(4*m*S)),p=I.UNSIGNED_BYTE;break;default:C||(C=new Float32Array(4*m*S)),p=I.FLOAT}return I.readPixels(0,0,m,S,I.RGBA,p,C),I.bindFramebuffer(I.FRAMEBUFFER,this._currentFramebuffer),C}},function(h,s,c){var E="shadowsFragmentFunctions",m=`#ifdef SHADOWS
#ifndef SHADOWFLOAT

float unpack(vec4 color)
{
const vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);
return dot(color,bit_shift);
}
#endif
float computeFallOff(float value,vec2 clipSpace,float frustumEdgeFalloff)
{
float mask=smoothstep(1.0-frustumEdgeFalloff,1.00000012,clamp(dot(clipSpace,clipSpace),0.,1.));
return mix(value,1.0,mask);
}
#define inline
float computeShadowCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,vec2 depthValues)
{
vec3 directionToLight=vPositionW-lightPosition;
float depth=length(directionToLight);
depth=(depth+depthValues.x)/(depthValues.y);
depth=clamp(depth,0.,1.0);
directionToLight=normalize(directionToLight);
directionToLight.y=-directionToLight.y;
#ifndef SHADOWFLOAT
float shadow=unpack(textureCube(shadowSampler,directionToLight));
#else
float shadow=textureCube(shadowSampler,directionToLight).x;
#endif
return depth>shadow ? darkness : 1.0;
}
#define inline
float computeShadowWithPoissonSamplingCube(vec3 lightPosition,samplerCube shadowSampler,float mapSize,float darkness,vec2 depthValues)
{
vec3 directionToLight=vPositionW-lightPosition;
float depth=length(directionToLight);
depth=(depth+depthValues.x)/(depthValues.y);
depth=clamp(depth,0.,1.0);
directionToLight=normalize(directionToLight);
directionToLight.y=-directionToLight.y;
float visibility=1.;
vec3 poissonDisk[4];
poissonDisk[0]=vec3(-1.0,1.0,-1.0);
poissonDisk[1]=vec3(1.0,-1.0,-1.0);
poissonDisk[2]=vec3(-1.0,-1.0,-1.0);
poissonDisk[3]=vec3(1.0,-1.0,1.0);

#ifndef SHADOWFLOAT
if (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize))<depth) visibility-=0.25;
if (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize))<depth) visibility-=0.25;
if (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize))<depth) visibility-=0.25;
if (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize))<depth) visibility-=0.25;
#else
if (textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize).x<depth) visibility-=0.25;
if (textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize).x<depth) visibility-=0.25;
if (textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize).x<depth) visibility-=0.25;
if (textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize).x<depth) visibility-=0.25;
#endif
return min(1.0,visibility+darkness);
}
#define inline
float computeShadowWithESMCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,float depthScale,vec2 depthValues)
{
vec3 directionToLight=vPositionW-lightPosition;
float depth=length(directionToLight);
depth=(depth+depthValues.x)/(depthValues.y);
float shadowPixelDepth=clamp(depth,0.,1.0);
directionToLight=normalize(directionToLight);
directionToLight.y=-directionToLight.y;
#ifndef SHADOWFLOAT
float shadowMapSample=unpack(textureCube(shadowSampler,directionToLight));
#else
float shadowMapSample=textureCube(shadowSampler,directionToLight).x;
#endif
float esm=1.0-clamp(exp(min(87.,depthScale*shadowPixelDepth))*shadowMapSample,0.,1.-darkness);
return esm;
}
#define inline
float computeShadowWithCloseESMCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,float depthScale,vec2 depthValues)
{
vec3 directionToLight=vPositionW-lightPosition;
float depth=length(directionToLight);
depth=(depth+depthValues.x)/(depthValues.y);
float shadowPixelDepth=clamp(depth,0.,1.0);
directionToLight=normalize(directionToLight);
directionToLight.y=-directionToLight.y;
#ifndef SHADOWFLOAT
float shadowMapSample=unpack(textureCube(shadowSampler,directionToLight));
#else
float shadowMapSample=textureCube(shadowSampler,directionToLight).x;
#endif
float esm=clamp(exp(min(87.,-depthScale*(shadowPixelDepth-shadowMapSample))),darkness,1.);
return esm;
}
#ifdef WEBGL2
#define inline
float computeShadowCSM(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray shadowSampler,float darkness,float frustumEdgeFalloff)
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec2 uv=0.5*clipSpace.xy+vec2(0.5);
vec3 uvLayer=vec3(uv.x,uv.y,layer);
float shadowPixelDepth=clamp(depthMetric,0.,1.0);
#ifndef SHADOWFLOAT
float shadow=unpack(texture2D(shadowSampler,uvLayer));
#else
float shadow=texture2D(shadowSampler,uvLayer).x;
#endif
return shadowPixelDepth>shadow ? computeFallOff(darkness,clipSpace.xy,frustumEdgeFalloff) : 1.;
}
#endif
#define inline
float computeShadow(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float frustumEdgeFalloff)
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec2 uv=0.5*clipSpace.xy+vec2(0.5);
if (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)
{
return 1.0;
}
else
{
float shadowPixelDepth=clamp(depthMetric,0.,1.0);
#ifndef SHADOWFLOAT
float shadow=unpack(texture2D(shadowSampler,uv));
#else
float shadow=texture2D(shadowSampler,uv).x;
#endif
return shadowPixelDepth>shadow ? computeFallOff(darkness,clipSpace.xy,frustumEdgeFalloff) : 1.;
}
}
#define inline
float computeShadowWithPoissonSampling(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float mapSize,float darkness,float frustumEdgeFalloff)
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec2 uv=0.5*clipSpace.xy+vec2(0.5);
if (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)
{
return 1.0;
}
else
{
float shadowPixelDepth=clamp(depthMetric,0.,1.0);
float visibility=1.;
vec2 poissonDisk[4];
poissonDisk[0]=vec2(-0.94201624,-0.39906216);
poissonDisk[1]=vec2(0.94558609,-0.76890725);
poissonDisk[2]=vec2(-0.094184101,-0.92938870);
poissonDisk[3]=vec2(0.34495938,0.29387760);

#ifndef SHADOWFLOAT
if (unpack(texture2D(shadowSampler,uv+poissonDisk[0]*mapSize))<shadowPixelDepth) visibility-=0.25;
if (unpack(texture2D(shadowSampler,uv+poissonDisk[1]*mapSize))<shadowPixelDepth) visibility-=0.25;
if (unpack(texture2D(shadowSampler,uv+poissonDisk[2]*mapSize))<shadowPixelDepth) visibility-=0.25;
if (unpack(texture2D(shadowSampler,uv+poissonDisk[3]*mapSize))<shadowPixelDepth) visibility-=0.25;
#else
if (texture2D(shadowSampler,uv+poissonDisk[0]*mapSize).x<shadowPixelDepth) visibility-=0.25;
if (texture2D(shadowSampler,uv+poissonDisk[1]*mapSize).x<shadowPixelDepth) visibility-=0.25;
if (texture2D(shadowSampler,uv+poissonDisk[2]*mapSize).x<shadowPixelDepth) visibility-=0.25;
if (texture2D(shadowSampler,uv+poissonDisk[3]*mapSize).x<shadowPixelDepth) visibility-=0.25;
#endif
return computeFallOff(min(1.0,visibility+darkness),clipSpace.xy,frustumEdgeFalloff);
}
}
#define inline
float computeShadowWithESM(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float depthScale,float frustumEdgeFalloff)
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec2 uv=0.5*clipSpace.xy+vec2(0.5);
if (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)
{
return 1.0;
}
else
{
float shadowPixelDepth=clamp(depthMetric,0.,1.0);
#ifndef SHADOWFLOAT
float shadowMapSample=unpack(texture2D(shadowSampler,uv));
#else
float shadowMapSample=texture2D(shadowSampler,uv).x;
#endif
float esm=1.0-clamp(exp(min(87.,depthScale*shadowPixelDepth))*shadowMapSample,0.,1.-darkness);
return computeFallOff(esm,clipSpace.xy,frustumEdgeFalloff);
}
}
#define inline
float computeShadowWithCloseESM(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float depthScale,float frustumEdgeFalloff)
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec2 uv=0.5*clipSpace.xy+vec2(0.5);
if (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)
{
return 1.0;
}
else
{
float shadowPixelDepth=clamp(depthMetric,0.,1.0);
#ifndef SHADOWFLOAT
float shadowMapSample=unpack(texture2D(shadowSampler,uv));
#else
float shadowMapSample=texture2D(shadowSampler,uv).x;
#endif
float esm=clamp(exp(min(87.,-depthScale*(shadowPixelDepth-shadowMapSample))),darkness,1.);
return computeFallOff(esm,clipSpace.xy,frustumEdgeFalloff);
}
}
#ifdef WEBGL2
#define GREATEST_LESS_THAN_ONE 0.99999994

#define inline
float computeShadowWithCSMPCF1(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArrayShadow shadowSampler,float darkness,float frustumEdgeFalloff)
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));
uvDepth.z=clamp(uvDepth.z,0.,GREATEST_LESS_THAN_ONE);
vec4 uvDepthLayer=vec4(uvDepth.x,uvDepth.y,layer,uvDepth.z);
float shadow=texture(shadowSampler,uvDepthLayer);
shadow=mix(darkness,1.,shadow);
return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);
}



#define inline
float computeShadowWithCSMPCF3(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArrayShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));
uvDepth.z=clamp(uvDepth.z,0.,GREATEST_LESS_THAN_ONE);
vec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x;
uv+=0.5;
vec2 st=fract(uv);
vec2 base_uv=floor(uv)-0.5;
base_uv*=shadowMapSizeAndInverse.y;




vec2 uvw0=3.-2.*st;
vec2 uvw1=1.+2.*st;
vec2 u=vec2((2.-st.x)/uvw0.x-1.,st.x/uvw1.x+1.)*shadowMapSizeAndInverse.y;
vec2 v=vec2((2.-st.y)/uvw0.y-1.,st.y/uvw1.y+1.)*shadowMapSizeAndInverse.y;
float shadow=0.;
shadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[0]),layer,uvDepth.z));
shadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[0]),layer,uvDepth.z));
shadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[1]),layer,uvDepth.z));
shadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[1]),layer,uvDepth.z));
shadow=shadow/16.;
shadow=mix(darkness,1.,shadow);
return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);
}



#define inline
float computeShadowWithCSMPCF5(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArrayShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));
uvDepth.z=clamp(uvDepth.z,0.,GREATEST_LESS_THAN_ONE);
vec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x;
uv+=0.5;
vec2 st=fract(uv);
vec2 base_uv=floor(uv)-0.5;
base_uv*=shadowMapSizeAndInverse.y;


vec2 uvw0=4.-3.*st;
vec2 uvw1=vec2(7.);
vec2 uvw2=1.+3.*st;
vec3 u=vec3((3.-2.*st.x)/uvw0.x-2.,(3.+st.x)/uvw1.x,st.x/uvw2.x+2.)*shadowMapSizeAndInverse.y;
vec3 v=vec3((3.-2.*st.y)/uvw0.y-2.,(3.+st.y)/uvw1.y,st.y/uvw2.y+2.)*shadowMapSizeAndInverse.y;
float shadow=0.;
shadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[0]),layer,uvDepth.z));
shadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[0]),layer,uvDepth.z));
shadow+=uvw2.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[2],v[0]),layer,uvDepth.z));
shadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[1]),layer,uvDepth.z));
shadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[1]),layer,uvDepth.z));
shadow+=uvw2.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[2],v[1]),layer,uvDepth.z));
shadow+=uvw0.x*uvw2.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[2]),layer,uvDepth.z));
shadow+=uvw1.x*uvw2.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[2]),layer,uvDepth.z));
shadow+=uvw2.x*uvw2.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[2],v[2]),layer,uvDepth.z));
shadow=shadow/144.;
shadow=mix(darkness,1.,shadow);
return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);
}

#define inline
float computeShadowWithPCF1(vec4 vPositionFromLight,float depthMetric,sampler2DShadow shadowSampler,float darkness,float frustumEdgeFalloff)
{
if (depthMetric>1.0 || depthMetric<0.0) {
return 1.0;
}
else
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));
float shadow=texture2D(shadowSampler,uvDepth);
shadow=mix(darkness,1.,shadow);
return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);
}
}



#define inline
float computeShadowWithPCF3(vec4 vPositionFromLight,float depthMetric,sampler2DShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)
{
if (depthMetric>1.0 || depthMetric<0.0) {
return 1.0;
}
else
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));
vec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x;
uv+=0.5;
vec2 st=fract(uv);
vec2 base_uv=floor(uv)-0.5;
base_uv*=shadowMapSizeAndInverse.y;




vec2 uvw0=3.-2.*st;
vec2 uvw1=1.+2.*st;
vec2 u=vec2((2.-st.x)/uvw0.x-1.,st.x/uvw1.x+1.)*shadowMapSizeAndInverse.y;
vec2 v=vec2((2.-st.y)/uvw0.y-1.,st.y/uvw1.y+1.)*shadowMapSizeAndInverse.y;
float shadow=0.;
shadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[0]),uvDepth.z));
shadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[0]),uvDepth.z));
shadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[1]),uvDepth.z));
shadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[1]),uvDepth.z));
shadow=shadow/16.;
shadow=mix(darkness,1.,shadow);
return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);
}
}



#define inline
float computeShadowWithPCF5(vec4 vPositionFromLight,float depthMetric,sampler2DShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)
{
if (depthMetric>1.0 || depthMetric<0.0) {
return 1.0;
}
else
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));
vec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x;
uv+=0.5;
vec2 st=fract(uv);
vec2 base_uv=floor(uv)-0.5;
base_uv*=shadowMapSizeAndInverse.y;


vec2 uvw0=4.-3.*st;
vec2 uvw1=vec2(7.);
vec2 uvw2=1.+3.*st;
vec3 u=vec3((3.-2.*st.x)/uvw0.x-2.,(3.+st.x)/uvw1.x,st.x/uvw2.x+2.)*shadowMapSizeAndInverse.y;
vec3 v=vec3((3.-2.*st.y)/uvw0.y-2.,(3.+st.y)/uvw1.y,st.y/uvw2.y+2.)*shadowMapSizeAndInverse.y;
float shadow=0.;
shadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[0]),uvDepth.z));
shadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[0]),uvDepth.z));
shadow+=uvw2.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[0]),uvDepth.z));
shadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[1]),uvDepth.z));
shadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[1]),uvDepth.z));
shadow+=uvw2.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[1]),uvDepth.z));
shadow+=uvw0.x*uvw2.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[2]),uvDepth.z));
shadow+=uvw1.x*uvw2.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[2]),uvDepth.z));
shadow+=uvw2.x*uvw2.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[2]),uvDepth.z));
shadow=shadow/144.;
shadow=mix(darkness,1.,shadow);
return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);
}
}
const vec3 PoissonSamplers32[64]=vec3[64](
vec3(0.06407013,0.05409927,0.),
vec3(0.7366577,0.5789394,0.),
vec3(-0.6270542,-0.5320278,0.),
vec3(-0.4096107,0.8411095,0.),
vec3(0.6849564,-0.4990818,0.),
vec3(-0.874181,-0.04579735,0.),
vec3(0.9989998,0.0009880066,0.),
vec3(-0.004920578,-0.9151649,0.),
vec3(0.1805763,0.9747483,0.),
vec3(-0.2138451,0.2635818,0.),
vec3(0.109845,0.3884785,0.),
vec3(0.06876755,-0.3581074,0.),
vec3(0.374073,-0.7661266,0.),
vec3(0.3079132,-0.1216763,0.),
vec3(-0.3794335,-0.8271583,0.),
vec3(-0.203878,-0.07715034,0.),
vec3(0.5912697,0.1469799,0.),
vec3(-0.88069,0.3031784,0.),
vec3(0.5040108,0.8283722,0.),
vec3(-0.5844124,0.5494877,0.),
vec3(0.6017799,-0.1726654,0.),
vec3(-0.5554981,0.1559997,0.),
vec3(-0.3016369,-0.3900928,0.),
vec3(-0.5550632,-0.1723762,0.),
vec3(0.925029,0.2995041,0.),
vec3(-0.2473137,0.5538505,0.),
vec3(0.9183037,-0.2862392,0.),
vec3(0.2469421,0.6718712,0.),
vec3(0.3916397,-0.4328209,0.),
vec3(-0.03576927,-0.6220032,0.),
vec3(-0.04661255,0.7995201,0.),
vec3(0.4402924,0.3640312,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.)
);
const vec3 PoissonSamplers64[64]=vec3[64](
vec3(-0.613392,0.617481,0.),
vec3(0.170019,-0.040254,0.),
vec3(-0.299417,0.791925,0.),
vec3(0.645680,0.493210,0.),
vec3(-0.651784,0.717887,0.),
vec3(0.421003,0.027070,0.),
vec3(-0.817194,-0.271096,0.),
vec3(-0.705374,-0.668203,0.),
vec3(0.977050,-0.108615,0.),
vec3(0.063326,0.142369,0.),
vec3(0.203528,0.214331,0.),
vec3(-0.667531,0.326090,0.),
vec3(-0.098422,-0.295755,0.),
vec3(-0.885922,0.215369,0.),
vec3(0.566637,0.605213,0.),
vec3(0.039766,-0.396100,0.),
vec3(0.751946,0.453352,0.),
vec3(0.078707,-0.715323,0.),
vec3(-0.075838,-0.529344,0.),
vec3(0.724479,-0.580798,0.),
vec3(0.222999,-0.215125,0.),
vec3(-0.467574,-0.405438,0.),
vec3(-0.248268,-0.814753,0.),
vec3(0.354411,-0.887570,0.),
vec3(0.175817,0.382366,0.),
vec3(0.487472,-0.063082,0.),
vec3(-0.084078,0.898312,0.),
vec3(0.488876,-0.783441,0.),
vec3(0.470016,0.217933,0.),
vec3(-0.696890,-0.549791,0.),
vec3(-0.149693,0.605762,0.),
vec3(0.034211,0.979980,0.),
vec3(0.503098,-0.308878,0.),
vec3(-0.016205,-0.872921,0.),
vec3(0.385784,-0.393902,0.),
vec3(-0.146886,-0.859249,0.),
vec3(0.643361,0.164098,0.),
vec3(0.634388,-0.049471,0.),
vec3(-0.688894,0.007843,0.),
vec3(0.464034,-0.188818,0.),
vec3(-0.440840,0.137486,0.),
vec3(0.364483,0.511704,0.),
vec3(0.034028,0.325968,0.),
vec3(0.099094,-0.308023,0.),
vec3(0.693960,-0.366253,0.),
vec3(0.678884,-0.204688,0.),
vec3(0.001801,0.780328,0.),
vec3(0.145177,-0.898984,0.),
vec3(0.062655,-0.611866,0.),
vec3(0.315226,-0.604297,0.),
vec3(-0.780145,0.486251,0.),
vec3(-0.371868,0.882138,0.),
vec3(0.200476,0.494430,0.),
vec3(-0.494552,-0.711051,0.),
vec3(0.612476,0.705252,0.),
vec3(-0.578845,-0.768792,0.),
vec3(-0.772454,-0.090976,0.),
vec3(0.504440,0.372295,0.),
vec3(0.155736,0.065157,0.),
vec3(0.391522,0.849605,0.),
vec3(-0.620106,-0.328104,0.),
vec3(0.789239,-0.419965,0.),
vec3(-0.545396,0.538133,0.),
vec3(-0.178564,-0.596057,0.)
);





#define inline
float computeShadowWithCSMPCSS(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,int searchTapCount,int pcfTapCount,vec3[64] poissonSamplers,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));
uvDepth.z=clamp(uvDepth.z,0.,GREATEST_LESS_THAN_ONE);
vec4 uvDepthLayer=vec4(uvDepth.x,uvDepth.y,layer,uvDepth.z);
float blockerDepth=0.0;
float sumBlockerDepth=0.0;
float numBlocker=0.0;
for (int i=0; i<searchTapCount; i ++) {
blockerDepth=texture(depthSampler,vec3(uvDepth.xy+(lightSizeUV*lightSizeUVCorrection*shadowMapSizeInverse*PoissonSamplers32[i].xy),layer)).r;
if (blockerDepth<depthMetric) {
sumBlockerDepth+=blockerDepth;
numBlocker++;
}
}
if (numBlocker<1.0) {
return 1.0;
}
else
{
float avgBlockerDepth=sumBlockerDepth/numBlocker;

float AAOffset=shadowMapSizeInverse*10.;


float penumbraRatio=((depthMetric-avgBlockerDepth)*depthCorrection+AAOffset);
vec4 filterRadius=vec4(penumbraRatio*lightSizeUV*lightSizeUVCorrection*shadowMapSizeInverse,0.,0.);
float random=getRand(vPositionFromLight.xy);
float rotationAngle=random*3.1415926;
vec2 rotationVector=vec2(cos(rotationAngle),sin(rotationAngle));
float shadow=0.;
for (int i=0; i<pcfTapCount; i++) {
vec4 offset=vec4(poissonSamplers[i],0.);

offset=vec4(offset.x*rotationVector.x-offset.y*rotationVector.y,offset.y*rotationVector.x+offset.x*rotationVector.y,0.,0.);
shadow+=texture2D(shadowSampler,uvDepthLayer+offset*filterRadius);
}
shadow/=float(pcfTapCount);

shadow=mix(shadow,1.,min((depthMetric-avgBlockerDepth)*depthCorrection*penumbraDarkness,1.));

shadow=mix(darkness,1.,shadow);

return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);
}
}





#define inline
float computeShadowWithPCSS(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,int searchTapCount,int pcfTapCount,vec3[64] poissonSamplers)
{
if (depthMetric>1.0 || depthMetric<0.0) {
return 1.0;
}
else
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));
float blockerDepth=0.0;
float sumBlockerDepth=0.0;
float numBlocker=0.0;
for (int i=0; i<searchTapCount; i ++) {
blockerDepth=texture(depthSampler,uvDepth.xy+(lightSizeUV*shadowMapSizeInverse*PoissonSamplers32[i].xy)).r;
if (blockerDepth<depthMetric) {
sumBlockerDepth+=blockerDepth;
numBlocker++;
}
}
if (numBlocker<1.0) {
return 1.0;
}
else
{
float avgBlockerDepth=sumBlockerDepth/numBlocker;

float AAOffset=shadowMapSizeInverse*10.;


float penumbraRatio=((depthMetric-avgBlockerDepth)+AAOffset);
float filterRadius=penumbraRatio*lightSizeUV*shadowMapSizeInverse;
float random=getRand(vPositionFromLight.xy);
float rotationAngle=random*3.1415926;
vec2 rotationVector=vec2(cos(rotationAngle),sin(rotationAngle));
float shadow=0.;
for (int i=0; i<pcfTapCount; i++) {
vec3 offset=poissonSamplers[i];

offset=vec3(offset.x*rotationVector.x-offset.y*rotationVector.y,offset.y*rotationVector.x+offset.x*rotationVector.y,0.);
shadow+=texture2D(shadowSampler,uvDepth+offset*filterRadius);
}
shadow/=float(pcfTapCount);

shadow=mix(shadow,1.,depthMetric-avgBlockerDepth);

shadow=mix(darkness,1.,shadow);

return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);
}
}
}
#define inline
float computeShadowWithPCSS16(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)
{
return computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,16,PoissonSamplers32);
}
#define inline
float computeShadowWithPCSS32(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)
{
return computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,32,PoissonSamplers32);
}
#define inline
float computeShadowWithPCSS64(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)
{
return computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,32,64,PoissonSamplers64);
}
#define inline
float computeShadowWithCSMPCSS16(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)
{
return computeShadowWithCSMPCSS(layer,vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,16,PoissonSamplers32,lightSizeUVCorrection,depthCorrection,penumbraDarkness);
}
#define inline
float computeShadowWithCSMPCSS32(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)
{
return computeShadowWithCSMPCSS(layer,vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,32,PoissonSamplers32,lightSizeUVCorrection,depthCorrection,penumbraDarkness);
}
#define inline
float computeShadowWithCSMPCSS64(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)
{
return computeShadowWithCSMPCSS(layer,vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,32,64,PoissonSamplers64,lightSizeUVCorrection,depthCorrection,penumbraDarkness);
}
#endif
#endif
`;c(5).a.IncludesShadersStore[E]=m},function(h,s,c){var E="reflectionFunction",m=`vec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {

vec3 invOrigVec=vec3(1.0,1.0,1.0)/origVec;
vec3 halfSize=cubeSize*0.5;
vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;
vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;

vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);

float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);

vec3 intersectPositionWS=vertexPos+origVec*distance;

return intersectPositionWS-cubePos;
}
vec3 computeFixedEquirectangularCoords(vec4 worldPos,vec3 worldNormal,vec3 direction)
{
float lon=atan(direction.z,direction.x);
float lat=acos(direction.y);
vec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;
float s=sphereCoords.x*0.5+0.5;
float t=sphereCoords.y;
return vec3(s,t,0);
}
vec3 computeMirroredFixedEquirectangularCoords(vec4 worldPos,vec3 worldNormal,vec3 direction)
{
float lon=atan(direction.z,direction.x);
float lat=acos(direction.y);
vec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;
float s=sphereCoords.x*0.5+0.5;
float t=sphereCoords.y;
return vec3(1.0-s,t,0);
}
vec3 computeEquirectangularCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix)
{
vec3 cameraToVertex=normalize(worldPos.xyz-eyePosition);
vec3 r=normalize(reflect(cameraToVertex,worldNormal));
r=vec3(reflectionMatrix*vec4(r,0));
float lon=atan(r.z,r.x);
float lat=acos(r.y);
vec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;
float s=sphereCoords.x*0.5+0.5;
float t=sphereCoords.y;
return vec3(s,t,0);
}
vec3 computeSphericalCoords(vec4 worldPos,vec3 worldNormal,mat4 view,mat4 reflectionMatrix)
{
vec3 viewDir=normalize(vec3(view*worldPos));
vec3 viewNormal=normalize(vec3(view*vec4(worldNormal,0.0)));
vec3 r=reflect(viewDir,viewNormal);
r=vec3(reflectionMatrix*vec4(r,0));
r.z=r.z-1.0;
float m=2.0*length(r);
return vec3(r.x/m+0.5,1.0-r.y/m-0.5,0);
}
vec3 computePlanarCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix)
{
vec3 viewDir=worldPos.xyz-eyePosition;
vec3 coords=normalize(reflect(viewDir,worldNormal));
return vec3(reflectionMatrix*vec4(coords,1));
}
vec3 computeCubicCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix)
{
vec3 viewDir=normalize(worldPos.xyz-eyePosition);

vec3 coords=reflect(viewDir,worldNormal);
coords=vec3(reflectionMatrix*vec4(coords,0));
#ifdef INVERTCUBICMAP
coords.y*=-1.0;
#endif
return coords;
}
vec3 computeCubicLocalCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix,vec3 reflectionSize,vec3 reflectionPosition)
{
vec3 viewDir=normalize(worldPos.xyz-eyePosition);

vec3 coords=reflect(viewDir,worldNormal);
coords=parallaxCorrectNormal(worldPos.xyz,coords,reflectionSize,reflectionPosition);
coords=vec3(reflectionMatrix*vec4(coords,0));
#ifdef INVERTCUBICMAP
coords.y*=-1.0;
#endif
return coords;
}
vec3 computeProjectionCoords(vec4 worldPos,mat4 view,mat4 reflectionMatrix)
{
return vec3(reflectionMatrix*(view*worldPos));
}
vec3 computeSkyBoxCoords(vec3 positionW,mat4 reflectionMatrix)
{
return vec3(reflectionMatrix*vec4(positionW,1.));
}
#ifdef REFLECTION
vec3 computeReflectionCoords(vec4 worldPos,vec3 worldNormal)
{
#ifdef REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED
vec3 direction=normalize(vDirectionW);
return computeMirroredFixedEquirectangularCoords(worldPos,worldNormal,direction);
#endif
#ifdef REFLECTIONMAP_EQUIRECTANGULAR_FIXED
vec3 direction=normalize(vDirectionW);
return computeFixedEquirectangularCoords(worldPos,worldNormal,direction);
#endif
#ifdef REFLECTIONMAP_EQUIRECTANGULAR
return computeEquirectangularCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix);
#endif
#ifdef REFLECTIONMAP_SPHERICAL
return computeSphericalCoords(worldPos,worldNormal,view,reflectionMatrix);
#endif
#ifdef REFLECTIONMAP_PLANAR
return computePlanarCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix);
#endif
#ifdef REFLECTIONMAP_CUBIC
#ifdef USE_LOCAL_REFLECTIONMAP_CUBIC
return computeCubicLocalCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix,vReflectionSize,vReflectionPosition);
#else
return computeCubicCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix);
#endif
#endif
#ifdef REFLECTIONMAP_PROJECTION
return computeProjectionCoords(worldPos,view,reflectionMatrix);
#endif
#ifdef REFLECTIONMAP_SKYBOX
return computeSkyBoxCoords(vPositionUVW,reflectionMatrix);
#endif
#ifdef REFLECTIONMAP_EXPLICIT
return vec3(0,0,0);
#endif
}
#endif`;c(5).a.IncludesShadersStore[E]=m},function(h,s,c){var E="bumpFragmentMainFunctions",m=`#if defined(BUMP) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC) || defined(DETAIL)
#if defined(TANGENT) && defined(NORMAL)
varying mat3 vTBN;
#endif
#ifdef OBJECTSPACE_NORMALMAP
uniform mat4 normalMatrix;
#endif
vec3 perturbNormalBase(mat3 cotangentFrame,vec3 normal,float scale)
{
#ifdef NORMALXYSCALE
normal=normalize(normal*vec3(scale,scale,1.0));
#endif
return normalize(cotangentFrame*normal);
}
vec3 perturbNormal(mat3 cotangentFrame,vec3 textureSample,float scale)
{
return perturbNormalBase(cotangentFrame,textureSample*2.0-1.0,scale);
}

mat3 cotangent_frame(vec3 normal,vec3 p,vec2 uv,vec2 tangentSpaceParams)
{

uv=gl_FrontFacing ? uv : -uv;

vec3 dp1=dFdx(p);
vec3 dp2=dFdy(p);
vec2 duv1=dFdx(uv);
vec2 duv2=dFdy(uv);

vec3 dp2perp=cross(dp2,normal);
vec3 dp1perp=cross(normal,dp1);
vec3 tangent=dp2perp*duv1.x+dp1perp*duv2.x;
vec3 bitangent=dp2perp*duv1.y+dp1perp*duv2.y;

tangent*=tangentSpaceParams.x;
bitangent*=tangentSpaceParams.y;

float invmax=inversesqrt(max(dot(tangent,tangent),dot(bitangent,bitangent)));
return mat3(tangent*invmax,bitangent*invmax,normal);
}
#endif
`;c(5).a.IncludesShadersStore[E]=m},function(h,s,c){var E="bumpFragmentFunctions",m=`#if defined(BUMP)
#if BUMPDIRECTUV == 1
#define vBumpUV vMainUV1
#elif BUMPDIRECTUV == 2
#define vBumpUV vMainUV2
#else
varying vec2 vBumpUV;
#endif
uniform sampler2D bumpSampler;
vec3 perturbNormal(mat3 cotangentFrame,vec2 uv)
{
return perturbNormal(cotangentFrame,texture2D(bumpSampler,uv).xyz,vBumpInfos.y);
}
#endif
#if defined(DETAIL)
#if DETAILDIRECTUV == 1
#define vDetailUV vMainUV1
#elif DETAILDIRECTUV == 2
#define vDetailUV vMainUV2
#else
varying vec2 vDetailUV;
#endif
uniform sampler2D detailSampler;
#endif
#if defined(BUMP)
vec3 perturbNormal(mat3 cotangentFrame,vec3 color)
{
return perturbNormal(cotangentFrame,color,vBumpInfos.y);
}

mat3 cotangent_frame(vec3 normal,vec3 p,vec2 uv)
{
return cotangent_frame(normal,p,uv,vTangentSpaceParams);
}
#endif
#if defined(BUMP) && defined(PARALLAX)
const float minSamples=4.;
const float maxSamples=15.;
const int iMaxSamples=15;

vec2 parallaxOcclusion(vec3 vViewDirCoT,vec3 vNormalCoT,vec2 texCoord,float parallaxScale) {
float parallaxLimit=length(vViewDirCoT.xy)/vViewDirCoT.z;
parallaxLimit*=parallaxScale;
vec2 vOffsetDir=normalize(vViewDirCoT.xy);
vec2 vMaxOffset=vOffsetDir*parallaxLimit;
float numSamples=maxSamples+(dot(vViewDirCoT,vNormalCoT)*(minSamples-maxSamples));
float stepSize=1.0/numSamples;

float currRayHeight=1.0;
vec2 vCurrOffset=vec2(0,0);
vec2 vLastOffset=vec2(0,0);
float lastSampledHeight=1.0;
float currSampledHeight=1.0;
for (int i=0; i<iMaxSamples; i++)
{
currSampledHeight=texture2D(bumpSampler,vBumpUV+vCurrOffset).w;

if (currSampledHeight>currRayHeight)
{
float delta1=currSampledHeight-currRayHeight;
float delta2=(currRayHeight+stepSize)-lastSampledHeight;
float ratio=delta1/(delta1+delta2);
vCurrOffset=(ratio)* vLastOffset+(1.0-ratio)*vCurrOffset;

break;
}
else
{
currRayHeight-=stepSize;
vLastOffset=vCurrOffset;
vCurrOffset+=stepSize*vMaxOffset;
lastSampledHeight=currSampledHeight;
}
}
return vCurrOffset;
}
vec2 parallaxOffset(vec3 viewDir,float heightScale)
{

float height=texture2D(bumpSampler,vBumpUV).w;
vec2 texCoordOffset=heightScale*viewDir.xy*height;
return -texCoordOffset;
}
#endif`;c(5).a.IncludesShadersStore[E]=m},function(h,s,c){var E=`vec2 uvOffset=vec2(0.0,0.0);
#if defined(BUMP) || defined(PARALLAX) || defined(DETAIL)
#ifdef NORMALXYSCALE
float normalScale=1.0;
#elif defined(BUMP)
float normalScale=vBumpInfos.y;
#else
float normalScale=1.0;
#endif
#if defined(TANGENT) && defined(NORMAL)
mat3 TBN=vTBN;
#elif defined(BUMP)
mat3 TBN=cotangent_frame(normalW*normalScale,vPositionW,vBumpUV);
#else
mat3 TBN=cotangent_frame(normalW*normalScale,vPositionW,vDetailUV,vec2(1.,1.));
#endif
#elif defined(ANISOTROPIC)
#if defined(TANGENT) && defined(NORMAL)
mat3 TBN=vTBN;
#else
mat3 TBN=cotangent_frame(normalW,vPositionW,vMainUV1,vec2(1.,1.));
#endif
#endif
#ifdef PARALLAX
mat3 invTBN=transposeMat3(TBN);
#ifdef PARALLAXOCCLUSION
uvOffset=parallaxOcclusion(invTBN*-viewDirectionW,invTBN*normalW,vBumpUV,vBumpInfos.z);
#else
uvOffset=parallaxOffset(invTBN*viewDirectionW,vBumpInfos.z);
#endif
#endif
#ifdef DETAIL
vec4 detailColor=texture2D(detailSampler,vDetailUV+uvOffset);
vec2 detailNormalRG=detailColor.wy*2.0-1.0;
float detailNormalB=sqrt(1.-saturate(dot(detailNormalRG,detailNormalRG)));
vec3 detailNormal=vec3(detailNormalRG,detailNormalB);
#endif
#ifdef BUMP
#ifdef OBJECTSPACE_NORMALMAP
normalW=normalize(texture2D(bumpSampler,vBumpUV).xyz*2.0-1.0);
normalW=normalize(mat3(normalMatrix)*normalW);
#elif !defined(DETAIL)
normalW=perturbNormal(TBN,vBumpUV+uvOffset);
#else
vec3 bumpNormal=texture2D(bumpSampler,vBumpUV+uvOffset).xyz*2.0-1.0;

#if DETAIL_NORMALBLENDMETHOD == 0
detailNormal.xy*=vDetailInfos.z;
vec3 blendedNormal=normalize(vec3(bumpNormal.xy+detailNormal.xy,bumpNormal.z*detailNormal.z));
#elif DETAIL_NORMALBLENDMETHOD == 1
detailNormal.xy*=vDetailInfos.z;
bumpNormal+=vec3(0.0,0.0,1.0);
detailNormal*=vec3(-1.0,-1.0,1.0);
vec3 blendedNormal=bumpNormal*dot(bumpNormal,detailNormal)/bumpNormal.z-detailNormal;
#endif
normalW=perturbNormalBase(TBN,blendedNormal,vBumpInfos.y);
#endif
#elif defined(DETAIL)
detailNormal.xy*=vDetailInfos.z;
normalW=perturbNormalBase(TBN,detailNormal,vDetailInfos.z);
#endif`;c(5).a.IncludesShadersStore.bumpFragment=E},function(h,s,c){var E="lightFragment",m=`#ifdef LIGHT{X}
#if defined(SHADOWONLY) || defined(LIGHTMAP) && defined(LIGHTMAPEXCLUDED{X}) && defined(LIGHTMAPNOSPECULAR{X})

#else
#ifdef PBR

#ifdef SPOTLIGHT{X}
preInfo=computePointAndSpotPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);
#elif defined(POINTLIGHT{X})
preInfo=computePointAndSpotPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);
#elif defined(HEMILIGHT{X})
preInfo=computeHemisphericPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);
#elif defined(DIRLIGHT{X})
preInfo=computeDirectionalPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);
#endif
preInfo.NdotV=NdotV;

#ifdef SPOTLIGHT{X}
#ifdef LIGHT_FALLOFF_GLTF{X}
preInfo.attenuation=computeDistanceLightFalloff_GLTF(preInfo.lightDistanceSquared,light{X}.vLightFalloff.y);
preInfo.attenuation*=computeDirectionalLightFalloff_GLTF(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightFalloff.z,light{X}.vLightFalloff.w);
#elif defined(LIGHT_FALLOFF_PHYSICAL{X})
preInfo.attenuation=computeDistanceLightFalloff_Physical(preInfo.lightDistanceSquared);
preInfo.attenuation*=computeDirectionalLightFalloff_Physical(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w);
#elif defined(LIGHT_FALLOFF_STANDARD{X})
preInfo.attenuation=computeDistanceLightFalloff_Standard(preInfo.lightOffset,light{X}.vLightFalloff.x);
preInfo.attenuation*=computeDirectionalLightFalloff_Standard(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w,light{X}.vLightData.w);
#else
preInfo.attenuation=computeDistanceLightFalloff(preInfo.lightOffset,preInfo.lightDistanceSquared,light{X}.vLightFalloff.x,light{X}.vLightFalloff.y);
preInfo.attenuation*=computeDirectionalLightFalloff(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w,light{X}.vLightData.w,light{X}.vLightFalloff.z,light{X}.vLightFalloff.w);
#endif
#elif defined(POINTLIGHT{X})
#ifdef LIGHT_FALLOFF_GLTF{X}
preInfo.attenuation=computeDistanceLightFalloff_GLTF(preInfo.lightDistanceSquared,light{X}.vLightFalloff.y);
#elif defined(LIGHT_FALLOFF_PHYSICAL{X})
preInfo.attenuation=computeDistanceLightFalloff_Physical(preInfo.lightDistanceSquared);
#elif defined(LIGHT_FALLOFF_STANDARD{X})
preInfo.attenuation=computeDistanceLightFalloff_Standard(preInfo.lightOffset,light{X}.vLightFalloff.x);
#else
preInfo.attenuation=computeDistanceLightFalloff(preInfo.lightOffset,preInfo.lightDistanceSquared,light{X}.vLightFalloff.x,light{X}.vLightFalloff.y);
#endif
#else
preInfo.attenuation=1.0;
#endif


#ifdef HEMILIGHT{X}
preInfo.roughness=roughness;
#else
preInfo.roughness=adjustRoughnessFromLightProperties(roughness,light{X}.vLightSpecular.a,preInfo.lightDistance);
#endif

#ifdef HEMILIGHT{X}
info.diffuse=computeHemisphericDiffuseLighting(preInfo,light{X}.vLightDiffuse.rgb,light{X}.vLightGround);
#elif defined(SS_TRANSLUCENCY)
info.diffuse=computeDiffuseAndTransmittedLighting(preInfo,light{X}.vLightDiffuse.rgb,subSurfaceOut.transmittance);
#else
info.diffuse=computeDiffuseLighting(preInfo,light{X}.vLightDiffuse.rgb);
#endif

#ifdef SPECULARTERM
#ifdef ANISOTROPIC
info.specular=computeAnisotropicSpecularLighting(preInfo,viewDirectionW,normalW,anisotropicOut.anisotropicTangent,anisotropicOut.anisotropicBitangent,anisotropicOut.anisotropy,clearcoatOut.specularEnvironmentR0,specularEnvironmentR90,AARoughnessFactors.x,light{X}.vLightDiffuse.rgb);
#else
info.specular=computeSpecularLighting(preInfo,normalW,clearcoatOut.specularEnvironmentR0,specularEnvironmentR90,AARoughnessFactors.x,light{X}.vLightDiffuse.rgb);
#endif
#endif

#ifdef SHEEN
#ifdef SHEEN_LINKWITHALBEDO

preInfo.roughness=sheenOut.sheenIntensity;
#else
#ifdef HEMILIGHT{X}
preInfo.roughness=sheenOut.sheenRoughness;
#else
preInfo.roughness=adjustRoughnessFromLightProperties(sheenOut.sheenRoughness,light{X}.vLightSpecular.a,preInfo.lightDistance);
#endif
#endif
info.sheen=computeSheenLighting(preInfo,normalW,sheenOut.sheenColor,specularEnvironmentR90,AARoughnessFactors.x,light{X}.vLightDiffuse.rgb);
#endif

#ifdef CLEARCOAT

#ifdef HEMILIGHT{X}
preInfo.roughness=clearcoatOut.clearCoatRoughness;
#else
preInfo.roughness=adjustRoughnessFromLightProperties(clearcoatOut.clearCoatRoughness,light{X}.vLightSpecular.a,preInfo.lightDistance);
#endif
info.clearCoat=computeClearCoatLighting(preInfo,clearcoatOut.clearCoatNormalW,clearcoatOut.clearCoatAARoughnessFactors.x,clearcoatOut.clearCoatIntensity,light{X}.vLightDiffuse.rgb);
#ifdef CLEARCOAT_TINT

absorption=computeClearCoatLightingAbsorption(clearcoatOut.clearCoatNdotVRefract,preInfo.L,clearcoatOut.clearCoatNormalW,clearcoatOut.clearCoatColor,clearcoatOut.clearCoatThickness,clearcoatOut.clearCoatIntensity);
info.diffuse*=absorption;
#ifdef SPECULARTERM
info.specular*=absorption;
#endif
#endif

info.diffuse*=info.clearCoat.w;
#ifdef SPECULARTERM
info.specular*=info.clearCoat.w;
#endif
#ifdef SHEEN
info.sheen*=info.clearCoat.w;
#endif
#endif
#else
#ifdef SPOTLIGHT{X}
info=computeSpotLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDirection,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular.rgb,light{X}.vLightDiffuse.a,glossiness);
#elif defined(HEMILIGHT{X})
info=computeHemisphericLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular.rgb,light{X}.vLightGround,glossiness);
#elif defined(POINTLIGHT{X}) || defined(DIRLIGHT{X})
info=computeLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular.rgb,light{X}.vLightDiffuse.a,glossiness);
#endif
#endif
#ifdef PROJECTEDLIGHTTEXTURE{X}
info.diffuse*=computeProjectionTextureDiffuseLighting(projectionLightSampler{X},textureProjectionMatrix{X});
#endif
#endif
#ifdef SHADOW{X}
#ifdef SHADOWCSM{X}
for (int i=0; i<SHADOWCSMNUM_CASCADES{X}; i++)
{
#ifdef SHADOWCSM_RIGHTHANDED{X}
diff{X}=viewFrustumZ{X}[i]+vPositionFromCamera{X}.z;
#else
diff{X}=viewFrustumZ{X}[i]-vPositionFromCamera{X}.z;
#endif
if (diff{X}>=0.) {
index{X}=i;
break;
}
}
#ifdef SHADOWCSMUSESHADOWMAXZ{X}
if (index{X}>=0)
#endif
{
#if defined(SHADOWPCF{X})
#if defined(SHADOWLOWQUALITY{X})
shadow=computeShadowWithCSMPCF1(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#elif defined(SHADOWMEDIUMQUALITY{X})
shadow=computeShadowWithCSMPCF3(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#else
shadow=computeShadowWithCSMPCF5(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#endif
#elif defined(SHADOWPCSS{X})
#if defined(SHADOWLOWQUALITY{X})
shadow=computeShadowWithCSMPCSS16(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});
#elif defined(SHADOWMEDIUMQUALITY{X})
shadow=computeShadowWithCSMPCSS32(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});
#else
shadow=computeShadowWithCSMPCSS64(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});
#endif
#else
shadow=computeShadowCSM(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#endif
#ifdef SHADOWCSMDEBUG{X}
shadowDebug{X}=vec3(shadow)*vCascadeColorsMultiplier{X}[index{X}];
#endif
#ifndef SHADOWCSMNOBLEND{X}
float frustumLength=frustumLengths{X}[index{X}];
float diffRatio=clamp(diff{X}/frustumLength,0.,1.)*cascadeBlendFactor{X};
if (index{X}<(SHADOWCSMNUM_CASCADES{X}-1) && diffRatio<1.)
{
index{X}+=1;
float nextShadow=0.;
#if defined(SHADOWPCF{X})
#if defined(SHADOWLOWQUALITY{X})
nextShadow=computeShadowWithCSMPCF1(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#elif defined(SHADOWMEDIUMQUALITY{X})
nextShadow=computeShadowWithCSMPCF3(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#else
nextShadow=computeShadowWithCSMPCF5(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#endif
#elif defined(SHADOWPCSS{X})
#if defined(SHADOWLOWQUALITY{X})
nextShadow=computeShadowWithCSMPCSS16(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});
#elif defined(SHADOWMEDIUMQUALITY{X})
nextShadow=computeShadowWithCSMPCSS32(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});
#else
nextShadow=computeShadowWithCSMPCSS64(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});
#endif
#else
nextShadow=computeShadowCSM(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#endif
shadow=mix(nextShadow,shadow,diffRatio);
#ifdef SHADOWCSMDEBUG{X}
shadowDebug{X}=mix(vec3(nextShadow)*vCascadeColorsMultiplier{X}[index{X}],shadowDebug{X},diffRatio);
#endif
}
#endif
}
#elif defined(SHADOWCLOSEESM{X})
#if defined(SHADOWCUBE{X})
shadow=computeShadowWithCloseESMCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.depthValues);
#else
shadow=computeShadowWithCloseESM(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.shadowsInfo.w);
#endif
#elif defined(SHADOWESM{X})
#if defined(SHADOWCUBE{X})
shadow=computeShadowWithESMCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.depthValues);
#else
shadow=computeShadowWithESM(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.shadowsInfo.w);
#endif
#elif defined(SHADOWPOISSON{X})
#if defined(SHADOWCUBE{X})
shadow=computeShadowWithPoissonSamplingCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.x,light{X}.depthValues);
#else
shadow=computeShadowWithPoissonSampling(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#endif
#elif defined(SHADOWPCF{X})
#if defined(SHADOWLOWQUALITY{X})
shadow=computeShadowWithPCF1(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#elif defined(SHADOWMEDIUMQUALITY{X})
shadow=computeShadowWithPCF3(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#else
shadow=computeShadowWithPCF5(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#endif
#elif defined(SHADOWPCSS{X})
#if defined(SHADOWLOWQUALITY{X})
shadow=computeShadowWithPCSS16(vPositionFromLight{X},vDepthMetric{X},depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#elif defined(SHADOWMEDIUMQUALITY{X})
shadow=computeShadowWithPCSS32(vPositionFromLight{X},vDepthMetric{X},depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#else
shadow=computeShadowWithPCSS64(vPositionFromLight{X},vDepthMetric{X},depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#endif
#else
#if defined(SHADOWCUBE{X})
shadow=computeShadowCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.depthValues);
#else
shadow=computeShadow(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#endif
#endif
#ifdef SHADOWONLY
#ifndef SHADOWINUSE
#define SHADOWINUSE
#endif
globalShadow+=shadow;
shadowLightCount+=1.0;
#endif
#else
shadow=1.;
#endif
#ifndef SHADOWONLY
#ifdef CUSTOMUSERLIGHTING
diffuseBase+=computeCustomDiffuseLighting(info,diffuseBase,shadow);
#ifdef SPECULARTERM
specularBase+=computeCustomSpecularLighting(info,specularBase,shadow);
#endif
#elif defined(LIGHTMAP) && defined(LIGHTMAPEXCLUDED{X})
diffuseBase+=lightmapColor.rgb*shadow;
#ifdef SPECULARTERM
#ifndef LIGHTMAPNOSPECULAR{X}
specularBase+=info.specular*shadow*lightmapColor.rgb;
#endif
#endif
#ifdef CLEARCOAT
#ifndef LIGHTMAPNOSPECULAR{X}
clearCoatBase+=info.clearCoat.rgb*shadow*lightmapColor.rgb;
#endif
#endif
#ifdef SHEEN
#ifndef LIGHTMAPNOSPECULAR{X}
sheenBase+=info.sheen.rgb*shadow;
#endif
#endif
#else
#ifdef SHADOWCSMDEBUG{X}
diffuseBase+=info.diffuse*shadowDebug{X};
#else
diffuseBase+=info.diffuse*shadow;
#endif
#ifdef SPECULARTERM
specularBase+=info.specular*shadow;
#endif
#ifdef CLEARCOAT
clearCoatBase+=info.clearCoat.rgb*shadow;
#endif
#ifdef SHEEN
sheenBase+=info.sheen.rgb*shadow;
#endif
#endif
#endif
#endif`;c(5).a.IncludesShadersStore[E]=m},function(h,s,c){var E=`#ifdef FOG
float fog=CalcFogFactor();
color.rgb=fog*color.rgb+(1.0-fog)*vFogColor;
#endif`;c(5).a.IncludesShadersStore.fogFragment=E},function(h,s,c){var E="fogVertexDeclaration",m=`#ifdef FOG
varying vec3 vFogDistance;
#endif`;c(5).a.IncludesShadersStore[E]=m},function(h,s,c){var E="shadowsVertex",m=`#ifdef SHADOWS
#if defined(SHADOWCSM{X})
vPositionFromCamera{X}=view*worldPos;
for (int i=0; i<SHADOWCSMNUM_CASCADES{X}; i++) {
vPositionFromLight{X}[i]=lightMatrix{X}[i]*worldPos;
vDepthMetric{X}[i]=((vPositionFromLight{X}[i].z+light{X}.depthValues.x)/(light{X}.depthValues.y));
}
#elif defined(SHADOW{X}) && !defined(SHADOWCUBE{X})
vPositionFromLight{X}=lightMatrix{X}*worldPos;
vDepthMetric{X}=((vPositionFromLight{X}.z+light{X}.depthValues.x)/(light{X}.depthValues.y));
#endif
#endif`;c(5).a.IncludesShadersStore[E]=m},function(h,s,c){c.d(s,"a",function(){return E});var E=function(){function m(){}return m.Eval=function(S,d){return(S=S.match(/\([^\(\)]*\)/g)?S.replace(/\([^\(\)]*\)/g,function(M){return M=M.slice(1,M.length-1),m._HandleParenthesisContent(M,d)}):m._HandleParenthesisContent(S,d))==="true"||S!=="false"&&m.Eval(S,d)},m._HandleParenthesisContent=function(S,d){var M;d=d||function(A){return A==="true"};var C=S.split("||");for(var I in C)if(C.hasOwnProperty(I)){var b=m._SimplifyNegation(C[I].trim()),p=b.split("&&");if(p.length>1)for(var x=0;x<p.length;++x){var P=m._SimplifyNegation(p[x].trim());if(!(M=P!=="true"&&P!=="false"?P[0]==="!"?!d(P.substring(1)):d(P):P==="true")){b="false";break}}if(M||b==="true"){M=!0;break}M=b!=="true"&&b!=="false"?b[0]==="!"?!d(b.substring(1)):d(b):b==="true"}return M?"true":"false"},m._SimplifyNegation=function(S){return(S=(S=S.replace(/^[\s!]+/,function(d){return(d=d.replace(/[\s]/g,function(){return""})).length%2?"!":""})).trim())==="!true"?S="false":S==="!false"&&(S="true"),S},m}()},function(h,s,c){c.d(s,"a",function(){return E});var E=function(){function m(){}return m.ExponentialBackoff=function(S,d){return S===void 0&&(S=3),d===void 0&&(d=500),function(M,C,I){return C.status!==0||I>=S||M.indexOf("file:")!==-1?-1:Math.pow(2,I)*d}},m}()},function(h,s,c){c.d(s,"a",function(){return E});var E=function(){function m(){this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1,this.reset()}return Object.defineProperty(m.prototype,"isDirty",{get:function(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty||this._isFrontFaceDirty},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"zOffset",{get:function(){return this._zOffset},set:function(S){this._zOffset!==S&&(this._zOffset=S,this._isZOffsetDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"cullFace",{get:function(){return this._cullFace},set:function(S){this._cullFace!==S&&(this._cullFace=S,this._isCullFaceDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"cull",{get:function(){return this._cull},set:function(S){this._cull!==S&&(this._cull=S,this._isCullDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"depthFunc",{get:function(){return this._depthFunc},set:function(S){this._depthFunc!==S&&(this._depthFunc=S,this._isDepthFuncDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"depthMask",{get:function(){return this._depthMask},set:function(S){this._depthMask!==S&&(this._depthMask=S,this._isDepthMaskDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"depthTest",{get:function(){return this._depthTest},set:function(S){this._depthTest!==S&&(this._depthTest=S,this._isDepthTestDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"frontFace",{get:function(){return this._frontFace},set:function(S){this._frontFace!==S&&(this._frontFace=S,this._isFrontFaceDirty=!0)},enumerable:!1,configurable:!0}),m.prototype.reset=function(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cullFace=null,this._cull=null,this._zOffset=0,this._frontFace=null,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1},m.prototype.apply=function(S){this.isDirty&&(this._isCullDirty&&(this.cull?S.enable(S.CULL_FACE):S.disable(S.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(S.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(S.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?S.enable(S.DEPTH_TEST):S.disable(S.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(S.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset?(S.enable(S.POLYGON_OFFSET_FILL),S.polygonOffset(this.zOffset,0)):S.disable(S.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1),this._isFrontFaceDirty&&(S.frontFace(this.frontFace),this._isFrontFaceDirty=!1))},m}()},function(h,s,c){c.d(s,"a",function(){return m});var E=c(2),m=function(){function S(){this._isStencilTestDirty=!1,this._isStencilMaskDirty=!1,this._isStencilFuncDirty=!1,this._isStencilOpDirty=!1,this.reset()}return Object.defineProperty(S.prototype,"isDirty",{get:function(){return this._isStencilTestDirty||this._isStencilMaskDirty||this._isStencilFuncDirty||this._isStencilOpDirty},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"stencilFunc",{get:function(){return this._stencilFunc},set:function(d){this._stencilFunc!==d&&(this._stencilFunc=d,this._isStencilFuncDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"stencilFuncRef",{get:function(){return this._stencilFuncRef},set:function(d){this._stencilFuncRef!==d&&(this._stencilFuncRef=d,this._isStencilFuncDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"stencilFuncMask",{get:function(){return this._stencilFuncMask},set:function(d){this._stencilFuncMask!==d&&(this._stencilFuncMask=d,this._isStencilFuncDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"stencilOpStencilFail",{get:function(){return this._stencilOpStencilFail},set:function(d){this._stencilOpStencilFail!==d&&(this._stencilOpStencilFail=d,this._isStencilOpDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"stencilOpDepthFail",{get:function(){return this._stencilOpDepthFail},set:function(d){this._stencilOpDepthFail!==d&&(this._stencilOpDepthFail=d,this._isStencilOpDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"stencilOpStencilDepthPass",{get:function(){return this._stencilOpStencilDepthPass},set:function(d){this._stencilOpStencilDepthPass!==d&&(this._stencilOpStencilDepthPass=d,this._isStencilOpDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"stencilMask",{get:function(){return this._stencilMask},set:function(d){this._stencilMask!==d&&(this._stencilMask=d,this._isStencilMaskDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"stencilTest",{get:function(){return this._stencilTest},set:function(d){this._stencilTest!==d&&(this._stencilTest=d,this._isStencilTestDirty=!0)},enumerable:!1,configurable:!0}),S.prototype.reset=function(){this._stencilTest=!1,this._stencilMask=255,this._stencilFunc=S.ALWAYS,this._stencilFuncRef=1,this._stencilFuncMask=255,this._stencilOpStencilFail=S.KEEP,this._stencilOpDepthFail=S.KEEP,this._stencilOpStencilDepthPass=S.REPLACE,this._isStencilTestDirty=!0,this._isStencilMaskDirty=!0,this._isStencilFuncDirty=!0,this._isStencilOpDirty=!0},S.prototype.apply=function(d){this.isDirty&&(this._isStencilTestDirty&&(this.stencilTest?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this._isStencilTestDirty=!1),this._isStencilMaskDirty&&(d.stencilMask(this.stencilMask),this._isStencilMaskDirty=!1),this._isStencilFuncDirty&&(d.stencilFunc(this.stencilFunc,this.stencilFuncRef,this.stencilFuncMask),this._isStencilFuncDirty=!1),this._isStencilOpDirty&&(d.stencilOp(this.stencilOpStencilFail,this.stencilOpDepthFail,this.stencilOpStencilDepthPass),this._isStencilOpDirty=!1))},S.ALWAYS=E.a.ALWAYS,S.KEEP=E.a.KEEP,S.REPLACE=E.a.REPLACE,S}()},function(h,s,c){c.d(s,"a",function(){return E});var E=function(){function m(){this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1,this._alphaBlend=!1,this._blendFunctionParameters=new Array(4),this._blendEquationParameters=new Array(2),this._blendConstants=new Array(4),this.reset()}return Object.defineProperty(m.prototype,"isDirty",{get:function(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"alphaBlend",{get:function(){return this._alphaBlend},set:function(S){this._alphaBlend!==S&&(this._alphaBlend=S,this._isAlphaBlendDirty=!0)},enumerable:!1,configurable:!0}),m.prototype.setAlphaBlendConstants=function(S,d,M,C){this._blendConstants[0]===S&&this._blendConstants[1]===d&&this._blendConstants[2]===M&&this._blendConstants[3]===C||(this._blendConstants[0]=S,this._blendConstants[1]=d,this._blendConstants[2]=M,this._blendConstants[3]=C,this._isBlendConstantsDirty=!0)},m.prototype.setAlphaBlendFunctionParameters=function(S,d,M,C){this._blendFunctionParameters[0]===S&&this._blendFunctionParameters[1]===d&&this._blendFunctionParameters[2]===M&&this._blendFunctionParameters[3]===C||(this._blendFunctionParameters[0]=S,this._blendFunctionParameters[1]=d,this._blendFunctionParameters[2]=M,this._blendFunctionParameters[3]=C,this._isBlendFunctionParametersDirty=!0)},m.prototype.setAlphaEquationParameters=function(S,d){this._blendEquationParameters[0]===S&&this._blendEquationParameters[1]===d||(this._blendEquationParameters[0]=S,this._blendEquationParameters[1]=d,this._isBlendEquationParametersDirty=!0)},m.prototype.reset=function(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._blendEquationParameters[0]=null,this._blendEquationParameters[1]=null,this._blendConstants[0]=null,this._blendConstants[1]=null,this._blendConstants[2]=null,this._blendConstants[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1},m.prototype.apply=function(S){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?S.enable(S.BLEND):S.disable(S.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(S.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1),this._isBlendEquationParametersDirty&&(S.blendEquationSeparate(this._blendEquationParameters[0],this._blendEquationParameters[1]),this._isBlendEquationParametersDirty=!1),this._isBlendConstantsDirty&&(S.blendColor(this._blendConstants[0],this._blendConstants[1],this._blendConstants[2],this._blendConstants[3]),this._isBlendConstantsDirty=!1))},m}()},function(h,s,c){c.d(s,"a",function(){return E});var E=function(){function m(){this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null}return Object.defineProperty(m.prototype,"isAsync",{get:function(){return this.isParallelCompiled},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"isReady",{get:function(){return!!this.program&&(!this.isParallelCompiled||this.engine._isRenderingStateCompiled(this))},enumerable:!1,configurable:!0}),m.prototype._handlesSpectorRebuildCallback=function(S){S&&this.program&&S(this.program)},m.prototype._getVertexShaderCode=function(){return this.vertexShader?this.engine._getShaderSource(this.vertexShader):null},m.prototype._getFragmentShaderCode=function(){return this.fragmentShader?this.engine._getShaderSource(this.fragmentShader):null},m}()},function(h,s,c){var E;c.d(s,"a",function(){return d}),function(M){M[M.Pending=0]="Pending",M[M.Fulfilled=1]="Fulfilled",M[M.Rejected=2]="Rejected"}(E||(E={}));var m=function(){this.count=0,this.target=0,this.results=[]},S=function(){function M(C){var I=this;if(this._state=E.Pending,this._children=new Array,this._rejectWasConsumed=!1,C)try{C(function(b){I._resolve(b)},function(b){I._reject(b)})}catch(b){this._reject(b)}}return Object.defineProperty(M.prototype,"_result",{get:function(){return this._resultValue},set:function(C){this._resultValue=C,this._parent&&this._parent._result===void 0&&(this._parent._result=C)},enumerable:!1,configurable:!0}),M.prototype.catch=function(C){return this.then(void 0,C)},M.prototype.then=function(C,I){var b=this,p=new M;return p._onFulfilled=C,p._onRejected=I,this._children.push(p),p._parent=this,this._state!==E.Pending&&setTimeout(function(){if(b._state===E.Fulfilled||b._rejectWasConsumed){var x=p._resolve(b._result);if(x!=null)if(x._state!==void 0){var P=x;p._children.push(P),P._parent=p,p=P}else p._result=x}else p._reject(b._reason)}),p},M.prototype._moveChildren=function(C){var I,b=this;if((I=this._children).push.apply(I,C.splice(0,C.length)),this._children.forEach(function(T){T._parent=b}),this._state===E.Fulfilled)for(var p=0,x=this._children;p<x.length;p++)x[p]._resolve(this._result);else if(this._state===E.Rejected)for(var P=0,A=this._children;P<A.length;P++)A[P]._reject(this._reason)},M.prototype._resolve=function(C){try{this._state=E.Fulfilled;var I=null;if(this._onFulfilled&&(I=this._onFulfilled(C)),I!=null)if(I._state!==void 0){var b=I;b._parent=this,b._moveChildren(this._children),C=b._result}else C=I;this._result=C;for(var p=0,x=this._children;p<x.length;p++)x[p]._resolve(C);this._children.length=0,delete this._onFulfilled,delete this._onRejected}catch(P){this._reject(P,!0)}},M.prototype._reject=function(C,I){if(I===void 0&&(I=!1),this._state=E.Rejected,this._reason=C,this._onRejected&&!I)try{this._onRejected(C),this._rejectWasConsumed=!0}catch(P){C=P}for(var b=0,p=this._children;b<p.length;b++){var x=p[b];this._rejectWasConsumed?x._resolve(null):x._reject(C)}this._children.length=0,delete this._onFulfilled,delete this._onRejected},M.resolve=function(C){var I=new M;return I._resolve(C),I},M._RegisterForFulfillment=function(C,I,b){C.then(function(p){return I.results[b]=p,I.count++,I.count===I.target&&I.rootPromise._resolve(I.results),null},function(p){I.rootPromise._state!==E.Rejected&&I.rootPromise._reject(p)})},M.all=function(C){var I=new M,b=new m;if(b.target=C.length,b.rootPromise=I,C.length)for(var p=0;p<C.length;p++)M._RegisterForFulfillment(C[p],b,p);else I._resolve([]);return I},M.race=function(C){var I=new M;if(C.length)for(var b=0,p=C;b<p.length;b++)p[b].then(function(x){return I&&(I._resolve(x),I=null),null},function(x){I&&(I._reject(x),I=null)});return I},M}(),d=function(){function M(){}return M.Apply=function(C){C===void 0&&(C=!1),(C||typeof Promise=="undefined")&&(window.Promise=S)},M}()},function(h,s,c){c.d(s,"a",function(){return m}),c.d(s,"b",function(){return S});var E=c(57),m=function(){function d(M){M===void 0&&(M=30),this._enabled=!0,this._rollingFrameTime=new S(M)}return d.prototype.sampleFrame=function(M){if(M===void 0&&(M=E.a.Now),this._enabled){if(this._lastFrameTimeMs!=null){var C=M-this._lastFrameTimeMs;this._rollingFrameTime.add(C)}this._lastFrameTimeMs=M}},Object.defineProperty(d.prototype,"averageFrameTime",{get:function(){return this._rollingFrameTime.average},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"averageFrameTimeVariance",{get:function(){return this._rollingFrameTime.variance},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"instantaneousFrameTime",{get:function(){return this._rollingFrameTime.history(0)},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"averageFPS",{get:function(){return 1e3/this._rollingFrameTime.average},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"instantaneousFPS",{get:function(){var M=this._rollingFrameTime.history(0);return M===0?0:1e3/M},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"isSaturated",{get:function(){return this._rollingFrameTime.isSaturated()},enumerable:!1,configurable:!0}),d.prototype.enable=function(){this._enabled=!0},d.prototype.disable=function(){this._enabled=!1,this._lastFrameTimeMs=null},Object.defineProperty(d.prototype,"isEnabled",{get:function(){return this._enabled},enumerable:!1,configurable:!0}),d.prototype.reset=function(){this._lastFrameTimeMs=null,this._rollingFrameTime.reset()},d}(),S=function(){function d(M){this._samples=new Array(M),this.reset()}return d.prototype.add=function(M){var C;if(this.isSaturated()){var I=this._samples[this._pos];C=I-this.average,this.average-=C/(this._sampleCount-1),this._m2-=C*(I-this.average)}else this._sampleCount++;C=M-this.average,this.average+=C/this._sampleCount,this._m2+=C*(M-this.average),this.variance=this._m2/(this._sampleCount-1),this._samples[this._pos]=M,this._pos++,this._pos%=this._samples.length},d.prototype.history=function(M){if(M>=this._sampleCount||M>=this._samples.length)return 0;var C=this._wrapPosition(this._pos-1);return this._samples[this._wrapPosition(C-M)]},d.prototype.isSaturated=function(){return this._sampleCount>=this._samples.length},d.prototype.reset=function(){this.average=0,this.variance=0,this._sampleCount=0,this._pos=0,this._m2=0},d.prototype._wrapPosition=function(M){var C=this._samples.length;return(M%C+C)%C},d}()},function(h,s,c){c.d(s,"a",function(){return m});var E=c(0),m=function(){this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._surroundingMeshes=null,this._collider=null,this._oldPositionForCollisions=new E.e(0,0,0),this._diffPositionForCollisions=new E.e(0,0,0),this._collisionResponse=!0}},function(h,s,c){c.d(s,"a",function(){return d});var E=c(33),m=c(0),S=c(2),d=function(){function M(C,I,b,p,x){b===void 0&&(b=null),p===void 0&&(p=null),x===void 0&&(x=null),this.index=C,this._opaqueSubMeshes=new E.a(256),this._transparentSubMeshes=new E.a(256),this._alphaTestSubMeshes=new E.a(256),this._depthOnlySubMeshes=new E.a(256),this._particleSystems=new E.a(256),this._spriteManagers=new E.a(256),this._edgesRenderers=new E.b(16),this._scene=I,this.opaqueSortCompareFn=b,this.alphaTestSortCompareFn=p,this.transparentSortCompareFn=x}return Object.defineProperty(M.prototype,"opaqueSortCompareFn",{set:function(C){this._opaqueSortCompareFn=C,this._renderOpaque=C?this.renderOpaqueSorted:M.renderUnsorted},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"alphaTestSortCompareFn",{set:function(C){this._alphaTestSortCompareFn=C,this._renderAlphaTest=C?this.renderAlphaTestSorted:M.renderUnsorted},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"transparentSortCompareFn",{set:function(C){this._transparentSortCompareFn=C||M.defaultTransparentSortCompare,this._renderTransparent=this.renderTransparentSorted},enumerable:!1,configurable:!0}),M.prototype.render=function(C,I,b,p){if(C)C(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);else{var x=this._scene.getEngine();this._depthOnlySubMeshes.length!==0&&(x.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),x.setColorWrite(!0)),this._opaqueSubMeshes.length!==0&&this._renderOpaque(this._opaqueSubMeshes),this._alphaTestSubMeshes.length!==0&&this._renderAlphaTest(this._alphaTestSubMeshes);var P=x.getStencilBuffer();if(x.setStencilBuffer(!1),I&&this._renderSprites(),b&&this._renderParticles(p),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),this._transparentSubMeshes.length!==0&&(x.setStencilBuffer(P),this._renderTransparent(this._transparentSubMeshes),x.setAlphaMode(S.a.ALPHA_DISABLE)),x.setStencilBuffer(!1),this._edgesRenderers.length){for(var A=0;A<this._edgesRenderers.length;A++)this._edgesRenderers.data[A].render();x.setAlphaMode(S.a.ALPHA_DISABLE)}x.setStencilBuffer(P)}},M.prototype.renderOpaqueSorted=function(C){return M.renderSorted(C,this._opaqueSortCompareFn,this._scene.activeCamera,!1)},M.prototype.renderAlphaTestSorted=function(C){return M.renderSorted(C,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)},M.prototype.renderTransparentSorted=function(C){return M.renderSorted(C,this._transparentSortCompareFn,this._scene.activeCamera,!0)},M.renderSorted=function(C,I,b,p){for(var x,P=0,A=b?b.globalPosition:M._zeroVector;P<C.length;P++)(x=C.data[P])._alphaIndex=x.getMesh().alphaIndex,x._distanceToCamera=m.e.Distance(x.getBoundingInfo().boundingSphere.centerWorld,A);var T=C.data.slice(0,C.length);for(I&&T.sort(I),P=0;P<T.length;P++){if(x=T[P],p){var _=x.getMaterial();if(_&&_.needDepthPrePass){var g=_.getScene().getEngine();g.setColorWrite(!1),g.setAlphaMode(S.a.ALPHA_DISABLE),x.render(!1),g.setColorWrite(!0)}}x.render(p)}},M.renderUnsorted=function(C){for(var I=0;I<C.length;I++)C.data[I].render(!1)},M.defaultTransparentSortCompare=function(C,I){return C._alphaIndex>I._alphaIndex?1:C._alphaIndex<I._alphaIndex?-1:M.backToFrontSortCompare(C,I)},M.backToFrontSortCompare=function(C,I){return C._distanceToCamera<I._distanceToCamera?1:C._distanceToCamera>I._distanceToCamera?-1:0},M.frontToBackSortCompare=function(C,I){return C._distanceToCamera<I._distanceToCamera?-1:C._distanceToCamera>I._distanceToCamera?1:0},M.prototype.prepare=function(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this._spriteManagers.reset(),this._edgesRenderers.reset()},M.prototype.dispose=function(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()},M.prototype.dispatch=function(C,I,b){I===void 0&&(I=C.getMesh()),b===void 0&&(b=C.getMaterial()),b!=null&&(b.needAlphaBlendingForMesh(I)?this._transparentSubMeshes.push(C):b.needAlphaTesting()?(b.needDepthPrePass&&this._depthOnlySubMeshes.push(C),this._alphaTestSubMeshes.push(C)):(b.needDepthPrePass&&this._depthOnlySubMeshes.push(C),this._opaqueSubMeshes.push(C)),I._renderingGroup=this,I._edgesRenderer&&I._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(I._edgesRenderer))},M.prototype.dispatchSprites=function(C){this._spriteManagers.push(C)},M.prototype.dispatchParticles=function(C){this._particleSystems.push(C)},M.prototype._renderParticles=function(C){if(this._particleSystems.length!==0){var I=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(var b=0;b<this._particleSystems.length;b++){var p=this._particleSystems.data[b];if((I&&I.layerMask&p.layerMask)!==0){var x=p.emitter;x.position&&C&&C.indexOf(x)===-1||this._scene._activeParticles.addCount(p.render(),!1)}}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}},M.prototype._renderSprites=function(){if(this._scene.spritesEnabled&&this._spriteManagers.length!==0){var C=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(var I=0;I<this._spriteManagers.length;I++){var b=this._spriteManagers.data[I];(C&&C.layerMask&b.layerMask)!==0&&b.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}},M._zeroVector=m.e.Zero(),M}()},function(h,s,c){c.d(s,"a",function(){return E});var E=function(m,S){this.distance=m,this.mesh=S}},function(h,s,c){c.d(s,"a",function(){return E});var E=function(){function m(){}return m.GenerateBase64StringFromTexture=function(S,d,M){d===void 0&&(d=0),M===void 0&&(M=0);var C=S.getInternalTexture();if(!C)return null;var I=S.readPixels(d,M);if(!I)return null;var b=S.getSize(),p=b.width,x=b.height;if(I instanceof Float32Array){for(var P=I.byteLength/I.BYTES_PER_ELEMENT,A=new Uint8Array(P);--P>=0;){var T=I[P];T<0?T=0:T>1&&(T=1),A[P]=255*T}I=A}var _=document.createElement("canvas");_.width=p,_.height=x;var g=_.getContext("2d");if(!g)return null;var O=g.createImageData(p,x);if(O.data.set(I),g.putImageData(O,0,0),C.invertY){var R=document.createElement("canvas");R.width=p,R.height=x;var N=R.getContext("2d");return N?(N.translate(0,x),N.scale(1,-1),N.drawImage(_,0,0),R.toDataURL("image/png")):null}return _.toDataURL("image/png")},m}()},function(h,s,c){c.d(s,"a",function(){return P});var E=c(1),m=c(0),S=c(8),d=c(31),M=c(7),C=c(41),I=c(46),b=c(4),p=c(43),x=c(12);M.a._instancedMeshFactory=function(A,T){var _=new P(A,T);if(T.instancedBuffers)for(var g in _.instancedBuffers={},T.instancedBuffers)_.instancedBuffers[g]=T.instancedBuffers[g];return _};var P=function(A){function T(_,g){var O=A.call(this,_,g.getScene())||this;O._indexInSourceMeshInstanceArray=-1,g.addInstance(O),O._sourceMesh=g,O._unIndexed=g._unIndexed,O.position.copyFrom(g.position),O.rotation.copyFrom(g.rotation),O.scaling.copyFrom(g.scaling),g.rotationQuaternion&&(O.rotationQuaternion=g.rotationQuaternion.clone()),O.animations=x.b.Slice(g.animations);for(var R=0,N=g.getAnimationRanges();R<N.length;R++){var V=N[R];V!=null&&O.createAnimationRange(V.name,V.from,V.to)}return O.infiniteDistance=g.infiniteDistance,O.setPivotMatrix(g.getPivotMatrix()),O.refreshBoundingInfo(),O._syncSubMeshes(),O}return Object(E.d)(T,A),T.prototype.getClassName=function(){return"InstancedMesh"},Object.defineProperty(T.prototype,"lightSources",{get:function(){return this._sourceMesh._lightSources},enumerable:!1,configurable:!0}),T.prototype._resyncLightSources=function(){},T.prototype._resyncLightSource=function(_){},T.prototype._removeLightSource=function(_,g){},Object.defineProperty(T.prototype,"receiveShadows",{get:function(){return this._sourceMesh.receiveShadows},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"material",{get:function(){return this._sourceMesh.material},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"visibility",{get:function(){return this._sourceMesh.visibility},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"skeleton",{get:function(){return this._sourceMesh.skeleton},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"renderingGroupId",{get:function(){return this._sourceMesh.renderingGroupId},set:function(_){this._sourceMesh&&_!==this._sourceMesh.renderingGroupId&&S.a.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")},enumerable:!1,configurable:!0}),T.prototype.getTotalVertices=function(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0},T.prototype.getTotalIndices=function(){return this._sourceMesh.getTotalIndices()},Object.defineProperty(T.prototype,"sourceMesh",{get:function(){return this._sourceMesh},enumerable:!1,configurable:!0}),T.prototype.createInstance=function(_){return this._sourceMesh.createInstance(_)},T.prototype.isReady=function(_){return _===void 0&&(_=!1),this._sourceMesh.isReady(_,!0)},T.prototype.getVerticesData=function(_,g){return this._sourceMesh.getVerticesData(_,g)},T.prototype.setVerticesData=function(_,g,O,R){return this.sourceMesh&&this.sourceMesh.setVerticesData(_,g,O,R),this.sourceMesh},T.prototype.updateVerticesData=function(_,g,O,R){return this.sourceMesh&&this.sourceMesh.updateVerticesData(_,g,O,R),this.sourceMesh},T.prototype.setIndices=function(_,g){return g===void 0&&(g=null),this.sourceMesh&&this.sourceMesh.setIndices(_,g),this.sourceMesh},T.prototype.isVerticesDataPresent=function(_){return this._sourceMesh.isVerticesDataPresent(_)},T.prototype.getIndices=function(){return this._sourceMesh.getIndices()},Object.defineProperty(T.prototype,"_positions",{get:function(){return this._sourceMesh._positions},enumerable:!1,configurable:!0}),T.prototype.refreshBoundingInfo=function(_){if(_===void 0&&(_=!1),this._boundingInfo&&this._boundingInfo.isLocked)return this;var g=this._sourceMesh.geometry?this._sourceMesh.geometry.boundingBias:null;return this._refreshBoundingInfo(this._sourceMesh._getPositionData(_),g),this},T.prototype._preActivate=function(){return this._currentLOD&&this._currentLOD._preActivate(),this},T.prototype._activate=function(_,g){if(this._sourceMesh.subMeshes||S.a.Warn("Instances should only be created for meshes with geometry."),this._currentLOD){if(this._currentLOD._getWorldMatrixDeterminant()>0!=this._getWorldMatrixDeterminant()>0)return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0,!0;if(this._internalAbstractMeshDataInfo._actAsRegularMesh=!1,this._currentLOD._registerInstanceForRenderId(this,_),g){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0}return!1},T.prototype._postActivate=function(){this._sourceMesh.edgesShareWithInstances&&this._sourceMesh._edgesRenderer&&this._sourceMesh._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup?(this._sourceMesh._renderingGroup._edgesRenderers.pushNoDuplicate(this._sourceMesh._edgesRenderer),this._sourceMesh._edgesRenderer.customInstances.push(this.getWorldMatrix())):this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)},T.prototype.getWorldMatrix=function(){if(this._currentLOD&&this._currentLOD.billboardMode!==I.a.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){var _=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,m.c.Vector3[7].copyFrom(this._currentLOD.position),this._currentLOD.position.set(0,0,0),m.c.Matrix[0].copyFrom(this._currentLOD.computeWorldMatrix(!0)),this._currentLOD.position.copyFrom(m.c.Vector3[7]),this._currentLOD._masterMesh=_,m.c.Matrix[0]}return A.prototype.getWorldMatrix.call(this)},Object.defineProperty(T.prototype,"isAnInstance",{get:function(){return!0},enumerable:!1,configurable:!0}),T.prototype.getLOD=function(_){if(!_)return this;var g=this.getBoundingInfo();return this._currentLOD=this.sourceMesh.getLOD(_,g.boundingSphere),this._currentLOD===this.sourceMesh?this.sourceMesh:this._currentLOD},T.prototype._preActivateForIntermediateRendering=function(_){return this.sourceMesh._preActivateForIntermediateRendering(_)},T.prototype._syncSubMeshes=function(){if(this.releaseSubMeshes(),this._sourceMesh.subMeshes)for(var _=0;_<this._sourceMesh.subMeshes.length;_++)this._sourceMesh.subMeshes[_].clone(this,this._sourceMesh);return this},T.prototype._generatePointsArray=function(){return this._sourceMesh._generatePointsArray()},T.prototype._updateBoundingInfo=function(){return this._boundingInfo?this._boundingInfo.update(this.worldMatrixFromCache):this._boundingInfo=new p.a(this.absolutePosition,this.absolutePosition,this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this},T.prototype.clone=function(_,g,O){g===void 0&&(g=null);var R=this._sourceMesh.createInstance(_);if(C.a.DeepCopy(this,R,["name","subMeshes","uniqueId","parent","lightSources","receiveShadows","material","visibility","skeleton","sourceMesh","isAnInstance","facetNb","isFacetDataEnabled","isBlocked","useBones","hasInstances","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","isWorldMatrixFrozen","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances"],[]),this.refreshBoundingInfo(),g&&(R.parent=g),!O)for(var N=0;N<this.getScene().meshes.length;N++){var V=this.getScene().meshes[N];V.parent===this&&V.clone(V.name,R)}return R.computeWorldMatrix(!0),R},T.prototype.dispose=function(_,g){g===void 0&&(g=!1),this._sourceMesh.removeInstance(this),A.prototype.dispose.call(this,_,g)},T}(d.a);M.a.prototype.edgesShareWithInstances=!1,M.a.prototype.registerInstancedBuffer=function(A,T){if(this.removeVerticesData(A),!this.instancedBuffers){this.instancedBuffers={};for(var _=0,g=this.instances;_<g.length;_++)g[_].instancedBuffers={};this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{}}}this.instancedBuffers[A]=null,this._userInstancedBuffersStorage.strides[A]=T,this._userInstancedBuffersStorage.sizes[A]=32*T,this._userInstancedBuffersStorage.data[A]=new Float32Array(this._userInstancedBuffersStorage.sizes[A]),this._userInstancedBuffersStorage.vertexBuffers[A]=new b.b(this.getEngine(),this._userInstancedBuffersStorage.data[A],A,!0,!1,T,!0),this.setVerticesBuffer(this._userInstancedBuffersStorage.vertexBuffers[A]);for(var O=0,R=this.instances;O<R.length;O++)R[O].instancedBuffers[A]=null},M.a.prototype._processInstancedBuffers=function(A,T){var _=A.length;for(var g in this.instancedBuffers){for(var O=this._userInstancedBuffersStorage.sizes[g],R=this._userInstancedBuffersStorage.strides[g],N=(_+1)*R;O<N;)O*=2;this._userInstancedBuffersStorage.data[g].length!=O&&(this._userInstancedBuffersStorage.data[g]=new Float32Array(O),this._userInstancedBuffersStorage.sizes[g]=O,this._userInstancedBuffersStorage.vertexBuffers[g]&&(this._userInstancedBuffersStorage.vertexBuffers[g].dispose(),this._userInstancedBuffersStorage.vertexBuffers[g]=null));var V=this._userInstancedBuffersStorage.data[g],U=0;T&&((j=this.instancedBuffers[g]).toArray?j.toArray(V,U):j.copyToArray(V,U),U+=R);for(var L=0;L<_;L++){var j;(j=A[L].instancedBuffers[g]).toArray?j.toArray(V,U):j.copyToArray(V,U),U+=R}this._userInstancedBuffersStorage.vertexBuffers[g]?this._userInstancedBuffersStorage.vertexBuffers[g].updateDirectly(V,0):(this._userInstancedBuffersStorage.vertexBuffers[g]=new b.b(this.getEngine(),this._userInstancedBuffersStorage.data[g],g,!0,!1,R,!0),this.setVerticesBuffer(this._userInstancedBuffersStorage.vertexBuffers[g]))}},M.a.prototype._disposeInstanceSpecificData=function(){for(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(var A in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[A]&&this._userInstancedBuffersStorage.vertexBuffers[A].dispose();this.instancedBuffers={}}},function(h,s,c){c.d(s,"a",function(){return E});var E=function(){function m(){}return Object.defineProperty(m,"UniqueId",{get:function(){var S=this._UniqueIdCounter;return this._UniqueIdCounter++,S},enumerable:!1,configurable:!0}),m._UniqueIdCounter=0,m}()},function(h,s,c){var E=c(26),m=c(88);E.a.prototype.createUniformBuffer=function(S){var d=this._gl.createBuffer();if(!d)throw new Error("Unable to create uniform buffer");var M=new m.a(d);return this.bindUniformBuffer(M),S instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,S,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(S),this._gl.STATIC_DRAW),this.bindUniformBuffer(null),M.references=1,M},E.a.prototype.createDynamicUniformBuffer=function(S){var d=this._gl.createBuffer();if(!d)throw new Error("Unable to create dynamic uniform buffer");var M=new m.a(d);return this.bindUniformBuffer(M),S instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,S,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(S),this._gl.DYNAMIC_DRAW),this.bindUniformBuffer(null),M.references=1,M},E.a.prototype.updateUniformBuffer=function(S,d,M,C){this.bindUniformBuffer(S),M===void 0&&(M=0),C===void 0?d instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,M,d):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,M,new Float32Array(d)):d instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,d.subarray(M,M+C)):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,new Float32Array(d).subarray(M,M+C)),this.bindUniformBuffer(null)},E.a.prototype.bindUniformBuffer=function(S){this._gl.bindBuffer(this._gl.UNIFORM_BUFFER,S?S.underlyingResource:null)},E.a.prototype.bindUniformBufferBase=function(S,d){this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER,d,S?S.underlyingResource:null)},E.a.prototype.bindUniformBlock=function(S,d,M){var C=S.program,I=this._gl.getUniformBlockIndex(C,d);this._gl.uniformBlockBinding(C,I,M)}},function(h,s,c){var E="lightsFragmentFunctions",m=`
struct lightingInfo
{
vec3 diffuse;
#ifdef SPECULARTERM
vec3 specular;
#endif
#ifdef NDOTL
float ndl;
#endif
};
lightingInfo computeLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {
lightingInfo result;
vec3 lightVectorW;
float attenuation=1.0;
if (lightData.w == 0.)
{
vec3 direction=lightData.xyz-vPositionW;
attenuation=max(0.,1.0-length(direction)/range);
lightVectorW=normalize(direction);
}
else
{
lightVectorW=normalize(-lightData.xyz);
}

float ndl=max(0.,dot(vNormal,lightVectorW));
#ifdef NDOTL
result.ndl=ndl;
#endif
result.diffuse=ndl*diffuseColor*attenuation;
#ifdef SPECULARTERM

vec3 angleW=normalize(viewDirectionW+lightVectorW);
float specComp=max(0.,dot(vNormal,angleW));
specComp=pow(specComp,max(1.,glossiness));
result.specular=specComp*specularColor*attenuation;
#endif
return result;
}
lightingInfo computeSpotLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec4 lightDirection,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {
lightingInfo result;
vec3 direction=lightData.xyz-vPositionW;
vec3 lightVectorW=normalize(direction);
float attenuation=max(0.,1.0-length(direction)/range);

float cosAngle=max(0.,dot(lightDirection.xyz,-lightVectorW));
if (cosAngle>=lightDirection.w)
{
cosAngle=max(0.,pow(cosAngle,lightData.w));
attenuation*=cosAngle;

float ndl=max(0.,dot(vNormal,lightVectorW));
#ifdef NDOTL
result.ndl=ndl;
#endif
result.diffuse=ndl*diffuseColor*attenuation;
#ifdef SPECULARTERM

vec3 angleW=normalize(viewDirectionW+lightVectorW);
float specComp=max(0.,dot(vNormal,angleW));
specComp=pow(specComp,max(1.,glossiness));
result.specular=specComp*specularColor*attenuation;
#endif
return result;
}
result.diffuse=vec3(0.);
#ifdef SPECULARTERM
result.specular=vec3(0.);
#endif
#ifdef NDOTL
result.ndl=0.;
#endif
return result;
}
lightingInfo computeHemisphericLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,vec3 groundColor,float glossiness) {
lightingInfo result;

float ndl=dot(vNormal,lightData.xyz)*0.5+0.5;
#ifdef NDOTL
result.ndl=ndl;
#endif
result.diffuse=mix(groundColor,diffuseColor,ndl);
#ifdef SPECULARTERM

vec3 angleW=normalize(viewDirectionW+lightData.xyz);
float specComp=max(0.,dot(vNormal,angleW));
specComp=pow(specComp,max(1.,glossiness));
result.specular=specComp*specularColor;
#endif
return result;
}
#define inline
vec3 computeProjectionTextureDiffuseLighting(sampler2D projectionLightSampler,mat4 textureProjectionMatrix){
vec4 strq=textureProjectionMatrix*vec4(vPositionW,1.0);
strq/=strq.w;
vec3 textureColor=texture2D(projectionLightSampler,strq.xy).rgb;
return textureColor;
}`;c(5).a.IncludesShadersStore[E]=m},function(h,s,c){var E="logDepthFragment",m=`#ifdef LOGARITHMICDEPTH
gl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;
#endif`;c(5).a.IncludesShadersStore[E]=m},function(h,s,c){var E=`#if defined(BUMP) || defined(PARALLAX) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC)
#if defined(TANGENT) && defined(NORMAL)
vec3 tbnNormal=normalize(normalUpdated);
vec3 tbnTangent=normalize(tangentUpdated.xyz);
vec3 tbnBitangent=cross(tbnNormal,tbnTangent)*tangentUpdated.w;
vTBN=mat3(finalWorld)*mat3(tbnTangent,tbnBitangent,tbnNormal);
#endif
#endif`;c(5).a.IncludesShadersStore.bumpVertex=E},function(h,s,c){var E=`#ifdef FOG
vFogDistance=(view*worldPos).xyz;
#endif`;c(5).a.IncludesShadersStore.fogVertex=E},function(h,s,c){var E="logDepthVertex",m=`#ifdef LOGARITHMICDEPTH
vFragmentDepth=1.0+gl_Position.w;
gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;
#endif`;c(5).a.IncludesShadersStore[E]=m},function(h,s){var c;c=function(){return this}();try{c=c||new Function("return this")()}catch(E){typeof window=="object"&&(c=window)}h.exports=c},function(h,s,c){var E="prePassDeclaration",m=`#ifdef PREPASS
#extension GL_EXT_draw_buffers : require
#ifdef WEBGL2
layout(location=0) out highp vec4 glFragData[{X}];
highp vec4 gl_FragColor;
#endif
#ifdef PREPASS_DEPTHNORMAL
varying highp vec3 vViewPos;
#endif
#ifdef PREPASS_VELOCITY
varying highp vec4 vCurrentPosition;
varying highp vec4 vPreviousPosition;
#endif
#endif
`;c(5).a.IncludesShadersStore[E]=m},function(h,s,c){var E="fresnelFunction",m=`#ifdef FRESNEL
float computeFresnelTerm(vec3 viewDirection,vec3 worldNormal,float bias,float power)
{
float fresnelTerm=pow(bias+abs(dot(viewDirection,worldNormal)),power);
return clamp(fresnelTerm,0.,1.);
}
#endif`;c(5).a.IncludesShadersStore[E]=m},function(h,s,c){var E=`#ifdef DEPTHPREPASS
gl_FragColor=vec4(0.,0.,0.,1.0);
return;
#endif`;c(5).a.IncludesShadersStore.depthPrePass=E},function(h,s,c){var E="prePassVertexDeclaration",m=`#ifdef PREPASS
#ifdef PREPASS_DEPTHNORMAL
varying vec3 vViewPos;
#endif
#ifdef PREPASS_VELOCITY
uniform mat4 previousWorld;
uniform mat4 previousViewProjection;
varying vec4 vCurrentPosition;
varying vec4 vPreviousPosition;
#endif
#endif`;c(5).a.IncludesShadersStore[E]=m},function(h,s,c){var E="bumpVertexDeclaration",m=`#if defined(BUMP) || defined(PARALLAX) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC)
#if defined(TANGENT) && defined(NORMAL)
varying mat3 vTBN;
#endif
#endif
`;c(5).a.IncludesShadersStore[E]=m},function(h,s,c){var E="prePassVertex",m=`#ifdef PREPASS_DEPTHNORMAL
vViewPos=(view*worldPos).rgb;
#endif
#if defined(PREPASS_VELOCITY) && defined(BONES_VELOCITY_ENABLED)
vCurrentPosition=viewProjection*worldPos;
#if NUM_BONE_INFLUENCERS>0
mat4 previousInfluence;
previousInfluence=mPreviousBones[int(matricesIndices[0])]*matricesWeights[0];
#if NUM_BONE_INFLUENCERS>1
previousInfluence+=mPreviousBones[int(matricesIndices[1])]*matricesWeights[1];
#endif
#if NUM_BONE_INFLUENCERS>2
previousInfluence+=mPreviousBones[int(matricesIndices[2])]*matricesWeights[2];
#endif
#if NUM_BONE_INFLUENCERS>3
previousInfluence+=mPreviousBones[int(matricesIndices[3])]*matricesWeights[3];
#endif
#if NUM_BONE_INFLUENCERS>4
previousInfluence+=mPreviousBones[int(matricesIndicesExtra[0])]*matricesWeightsExtra[0];
#endif
#if NUM_BONE_INFLUENCERS>5
previousInfluence+=mPreviousBones[int(matricesIndicesExtra[1])]*matricesWeightsExtra[1];
#endif
#if NUM_BONE_INFLUENCERS>6
previousInfluence+=mPreviousBones[int(matricesIndicesExtra[2])]*matricesWeightsExtra[2];
#endif
#if NUM_BONE_INFLUENCERS>7
previousInfluence+=mPreviousBones[int(matricesIndicesExtra[3])]*matricesWeightsExtra[3];
#endif
vPreviousPosition=previousViewProjection*previousWorld*previousInfluence*vec4(positionUpdated,1.0);
#else
vPreviousPosition=previousViewProjection*previousWorld*vec4(positionUpdated,1.0);
#endif
#endif`;c(5).a.IncludesShadersStore[E]=m},function(h,s,c){var E=c(5),m=(c(115),c(110),"colorPixelShader"),S=`#ifdef VERTEXCOLOR
varying vec4 vColor;
#else
uniform vec4 color;
#endif
#include<clipPlaneFragmentDeclaration>
void main(void) {
#include<clipPlaneFragment>
#ifdef VERTEXCOLOR
gl_FragColor=vColor;
#else
gl_FragColor=color;
#endif
}`;E.a.ShadersStore[m]=S},function(h,s,c){var E=c(5),m=(c(78),c(117),c(79),c(80),c(81),c(111),"colorVertexShader"),S=`
attribute vec3 position;
#ifdef VERTEXCOLOR
attribute vec4 color;
#endif
#include<bonesDeclaration>
#include<clipPlaneVertexDeclaration>

#include<instancesDeclaration>
uniform mat4 viewProjection;
#ifdef MULTIVIEW
uniform mat4 viewProjectionR;
#endif

#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif
void main(void) {
#include<instancesVertex>
#include<bonesVertex>
vec4 worldPos=finalWorld*vec4(position,1.0);
#ifdef MULTIVIEW
if (gl_ViewID_OVR == 0u) {
gl_Position=viewProjection*worldPos;
} else {
gl_Position=viewProjectionR*worldPos;
}
#else
gl_Position=viewProjection*worldPos;
#endif
#include<clipPlaneVertex>
#ifdef VERTEXCOLOR

vColor=color;
#endif
}`;E.a.ShadersStore[m]=S},function(h,s,c){(function(E){c.d(s,"b",function(){return x}),c.d(s,"a",function(){return P});var m=c(1),S=c(8),d=c(13),M=c(102),C=c(27),I=c(2),b=c(89),p=c(74),x=function(){this.renderWidth=512,this.renderHeight=256,this.textureSize=512,this.deterministicLockstep=!1,this.lockstepMaxSteps=4},P=function(A){function T(_){_===void 0&&(_=new x);var g=A.call(this,null)||this;d.a.Instances.push(g),_.deterministicLockstep===void 0&&(_.deterministicLockstep=!1),_.lockstepMaxSteps===void 0&&(_.lockstepMaxSteps=4),g._options=_,p.a.SetMatrixPrecision(!!_.useHighPrecisionMatrix),g._caps={maxTexturesImageUnits:16,maxVertexTextureImageUnits:16,maxCombinedTexturesImageUnits:32,maxTextureSize:512,maxCubemapTextureSize:512,maxRenderTextureSize:512,maxVertexAttribs:16,maxVaryingVectors:16,maxFragmentUniformVectors:16,maxVertexUniformVectors:16,standardDerivatives:!1,astc:null,pvrtc:null,etc1:null,etc2:null,bptc:null,maxAnisotropy:0,uintIndices:!1,fragmentDepthSupported:!1,highPrecisionShaderSupported:!0,colorBufferFloat:!1,textureFloat:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloat:!1,textureHalfFloatLinearFiltering:!1,textureHalfFloatRender:!1,textureLOD:!1,drawBuffersExtension:!1,depthTextureExtension:!1,vertexArrayObject:!1,instancedArrays:!1,canUseTimestampForTimerQuery:!1,maxMSAASamples:1,blendMinMax:!1},S.a.Log("Babylon.js v"+d.a.Version+" - Null engine");var O=typeof self!="undefined"?self:E!==void 0?E:window;return typeof URL=="undefined"&&(O.URL={createObjectURL:function(){},revokeObjectURL:function(){}}),typeof Blob=="undefined"&&(O.Blob=function(){}),g}return Object(m.d)(T,A),T.prototype.isDeterministicLockStep=function(){return this._options.deterministicLockstep},T.prototype.getLockstepMaxSteps=function(){return this._options.lockstepMaxSteps},T.prototype.getHardwareScalingLevel=function(){return 1},T.prototype.createVertexBuffer=function(_){var g=new b.a;return g.references=1,g},T.prototype.createIndexBuffer=function(_){var g=new b.a;return g.references=1,g},T.prototype.clear=function(_,g,O,R){},T.prototype.getRenderWidth=function(_){return _===void 0&&(_=!1),!_&&this._currentRenderTarget?this._currentRenderTarget.width:this._options.renderWidth},T.prototype.getRenderHeight=function(_){return _===void 0&&(_=!1),!_&&this._currentRenderTarget?this._currentRenderTarget.height:this._options.renderHeight},T.prototype.setViewport=function(_,g,O){this._cachedViewport=_},T.prototype.createShaderProgram=function(_,g,O,R,N){return{__SPECTOR_rebuildProgram:null}},T.prototype.getUniforms=function(_,g){return[]},T.prototype.getAttributes=function(_,g){return[]},T.prototype.bindSamplers=function(_){this._currentEffect=null},T.prototype.enableEffect=function(_){this._currentEffect=_,_.onBind&&_.onBind(_),_._onBindObservable&&_._onBindObservable.notifyObservers(_)},T.prototype.setState=function(_,g,O,R){},T.prototype.setIntArray=function(_,g){return!0},T.prototype.setIntArray2=function(_,g){return!0},T.prototype.setIntArray3=function(_,g){return!0},T.prototype.setIntArray4=function(_,g){return!0},T.prototype.setFloatArray=function(_,g){return!0},T.prototype.setFloatArray2=function(_,g){return!0},T.prototype.setFloatArray3=function(_,g){return!0},T.prototype.setFloatArray4=function(_,g){return!0},T.prototype.setArray=function(_,g){return!0},T.prototype.setArray2=function(_,g){return!0},T.prototype.setArray3=function(_,g){return!0},T.prototype.setArray4=function(_,g){return!0},T.prototype.setMatrices=function(_,g){return!0},T.prototype.setMatrix3x3=function(_,g){return!0},T.prototype.setMatrix2x2=function(_,g){return!0},T.prototype.setFloat=function(_,g){return!0},T.prototype.setFloat2=function(_,g,O){return!0},T.prototype.setFloat3=function(_,g,O,R){return!0},T.prototype.setBool=function(_,g){return!0},T.prototype.setFloat4=function(_,g,O,R,N){return!0},T.prototype.setAlphaMode=function(_,g){g===void 0&&(g=!1),this._alphaMode!==_&&(this.alphaState.alphaBlend=_!==I.a.ALPHA_DISABLE,g||this.setDepthWrite(_===I.a.ALPHA_DISABLE),this._alphaMode=_)},T.prototype.bindBuffers=function(_,g,O){},T.prototype.wipeCaches=function(_){this.preventCacheWipeBetweenFrames||(this.resetTextureCache(),this._currentEffect=null,_&&(this._currentProgram=null,this.stencilState.reset(),this.depthCullingState.reset(),this.alphaState.reset()),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null)},T.prototype.draw=function(_,g,O,R){},T.prototype.drawElementsType=function(_,g,O,R){},T.prototype.drawArraysType=function(_,g,O,R){},T.prototype._createTexture=function(){return{}},T.prototype._releaseTexture=function(_){},T.prototype.createTexture=function(_,g,O,R,N,V,U,L,j,Y,W,re){N===void 0&&(N=I.a.TEXTURE_TRILINEAR_SAMPLINGMODE),V===void 0&&(V=null),Y===void 0&&(Y=null);var ne=new C.a(this,C.b.Url),ge=String(_);return ne.url=ge,ne.generateMipMaps=!g,ne.samplingMode=N,ne.invertY=O,ne.baseWidth=this._options.textureSize,ne.baseHeight=this._options.textureSize,ne.width=this._options.textureSize,ne.height=this._options.textureSize,Y&&(ne.format=Y),ne.isReady=!0,V&&V(),this._internalTexturesCache.push(ne),ne},T.prototype.createRenderTargetTexture=function(_,g){var O=new M.a;g!==void 0&&typeof g=="object"?(O.generateMipMaps=g.generateMipMaps,O.generateDepthBuffer=g.generateDepthBuffer===void 0||g.generateDepthBuffer,O.generateStencilBuffer=O.generateDepthBuffer&&g.generateStencilBuffer,O.type=g.type===void 0?I.a.TEXTURETYPE_UNSIGNED_INT:g.type,O.samplingMode=g.samplingMode===void 0?I.a.TEXTURE_TRILINEAR_SAMPLINGMODE:g.samplingMode):(O.generateMipMaps=g,O.generateDepthBuffer=!0,O.generateStencilBuffer=!1,O.type=I.a.TEXTURETYPE_UNSIGNED_INT,O.samplingMode=I.a.TEXTURE_TRILINEAR_SAMPLINGMODE);var R=new C.a(this,C.b.RenderTarget),N=_.width||_,V=_.height||_;return R._depthStencilBuffer={},R._framebuffer={},R.baseWidth=N,R.baseHeight=V,R.width=N,R.height=V,R.isReady=!0,R.samples=1,R.generateMipMaps=!!O.generateMipMaps,R.samplingMode=O.samplingMode,R.type=O.type,R._generateDepthBuffer=O.generateDepthBuffer,R._generateStencilBuffer=!!O.generateStencilBuffer,this._internalTexturesCache.push(R),R},T.prototype.updateTextureSamplingMode=function(_,g){g.samplingMode=_},T.prototype.bindFramebuffer=function(_,g,O,R,N){this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=_,this._currentFramebuffer=_._MSAAFramebuffer?_._MSAAFramebuffer:_._framebuffer,this._cachedViewport&&!N&&this.setViewport(this._cachedViewport,O,R)},T.prototype.unBindFramebuffer=function(_,g,O){this._currentRenderTarget=null,O&&(_._MSAAFramebuffer&&(this._currentFramebuffer=_._framebuffer),O()),this._currentFramebuffer=null},T.prototype.createDynamicVertexBuffer=function(_){var g=new b.a;return g.references=1,g.capacity=1,g},T.prototype.updateDynamicTexture=function(_,g,O,R,N){},T.prototype.areAllEffectsReady=function(){return!0},T.prototype.getError=function(){return 0},T.prototype._getUnpackAlignement=function(){return 1},T.prototype._unpackFlipY=function(_){},T.prototype.updateDynamicIndexBuffer=function(_,g,O){},T.prototype.updateDynamicVertexBuffer=function(_,g,O,R){},T.prototype._bindTextureDirectly=function(_,g){return this._boundTexturesCache[this._activeChannel]!==g&&(this._boundTexturesCache[this._activeChannel]=g,!0)},T.prototype._bindTexture=function(_,g){_<0||this._bindTextureDirectly(0,g)},T.prototype._deleteBuffer=function(_){},T.prototype.releaseEffects=function(){},T.prototype.displayLoadingUI=function(){},T.prototype.hideLoadingUI=function(){},T.prototype._uploadCompressedDataToTextureDirectly=function(_,g,O,R,N,V,U){},T.prototype._uploadDataToTextureDirectly=function(_,g,O,R){},T.prototype._uploadArrayBufferViewToTexture=function(_,g,O,R){},T.prototype._uploadImageToTexture=function(_,g,O,R){},T}(d.a)}).call(this,c(159))},function(h,s,c){c.r(s),function(E){c.d(s,"Debug",function(){return b});var m=c(127),S=c(99);c.d(s,"AbstractScene",function(){return m.AbstractScene}),c.d(s,"AbstractActionManager",function(){return m.AbstractActionManager}),c.d(s,"Action",function(){return m.Action}),c.d(s,"ActionEvent",function(){return m.ActionEvent}),c.d(s,"ActionManager",function(){return m.ActionManager}),c.d(s,"Condition",function(){return m.Condition}),c.d(s,"ValueCondition",function(){return m.ValueCondition}),c.d(s,"PredicateCondition",function(){return m.PredicateCondition}),c.d(s,"StateCondition",function(){return m.StateCondition}),c.d(s,"SwitchBooleanAction",function(){return m.SwitchBooleanAction}),c.d(s,"SetStateAction",function(){return m.SetStateAction}),c.d(s,"SetValueAction",function(){return m.SetValueAction}),c.d(s,"IncrementValueAction",function(){return m.IncrementValueAction}),c.d(s,"PlayAnimationAction",function(){return m.PlayAnimationAction}),c.d(s,"StopAnimationAction",function(){return m.StopAnimationAction}),c.d(s,"DoNothingAction",function(){return m.DoNothingAction}),c.d(s,"CombineAction",function(){return m.CombineAction}),c.d(s,"ExecuteCodeAction",function(){return m.ExecuteCodeAction}),c.d(s,"SetParentAction",function(){return m.SetParentAction}),c.d(s,"PlaySoundAction",function(){return m.PlaySoundAction}),c.d(s,"StopSoundAction",function(){return m.StopSoundAction}),c.d(s,"InterpolateValueAction",function(){return m.InterpolateValueAction}),c.d(s,"Animatable",function(){return m.Animatable}),c.d(s,"_IAnimationState",function(){return m._IAnimationState}),c.d(s,"Animation",function(){return m.Animation}),c.d(s,"TargetedAnimation",function(){return m.TargetedAnimation}),c.d(s,"AnimationGroup",function(){return m.AnimationGroup}),c.d(s,"AnimationPropertiesOverride",function(){return m.AnimationPropertiesOverride}),c.d(s,"EasingFunction",function(){return m.EasingFunction}),c.d(s,"CircleEase",function(){return m.CircleEase}),c.d(s,"BackEase",function(){return m.BackEase}),c.d(s,"BounceEase",function(){return m.BounceEase}),c.d(s,"CubicEase",function(){return m.CubicEase}),c.d(s,"ElasticEase",function(){return m.ElasticEase}),c.d(s,"ExponentialEase",function(){return m.ExponentialEase}),c.d(s,"PowerEase",function(){return m.PowerEase}),c.d(s,"QuadraticEase",function(){return m.QuadraticEase}),c.d(s,"QuarticEase",function(){return m.QuarticEase}),c.d(s,"QuinticEase",function(){return m.QuinticEase}),c.d(s,"SineEase",function(){return m.SineEase}),c.d(s,"BezierCurveEase",function(){return m.BezierCurveEase}),c.d(s,"RuntimeAnimation",function(){return m.RuntimeAnimation}),c.d(s,"AnimationEvent",function(){return m.AnimationEvent}),c.d(s,"AnimationKeyInterpolation",function(){return m.AnimationKeyInterpolation}),c.d(s,"AnimationRange",function(){return m.AnimationRange}),c.d(s,"KeepAssets",function(){return m.KeepAssets}),c.d(s,"InstantiatedEntries",function(){return m.InstantiatedEntries}),c.d(s,"AssetContainer",function(){return m.AssetContainer}),c.d(s,"Analyser",function(){return m.Analyser}),c.d(s,"AudioEngine",function(){return m.AudioEngine}),c.d(s,"AudioSceneComponent",function(){return m.AudioSceneComponent}),c.d(s,"Sound",function(){return m.Sound}),c.d(s,"SoundTrack",function(){return m.SoundTrack}),c.d(s,"WeightedSound",function(){return m.WeightedSound}),c.d(s,"AutoRotationBehavior",function(){return m.AutoRotationBehavior}),c.d(s,"BouncingBehavior",function(){return m.BouncingBehavior}),c.d(s,"FramingBehavior",function(){return m.FramingBehavior}),c.d(s,"AttachToBoxBehavior",function(){return m.AttachToBoxBehavior}),c.d(s,"FadeInOutBehavior",function(){return m.FadeInOutBehavior}),c.d(s,"MultiPointerScaleBehavior",function(){return m.MultiPointerScaleBehavior}),c.d(s,"PointerDragBehavior",function(){return m.PointerDragBehavior}),c.d(s,"SixDofDragBehavior",function(){return m.SixDofDragBehavior}),c.d(s,"Bone",function(){return m.Bone}),c.d(s,"BoneIKController",function(){return m.BoneIKController}),c.d(s,"BoneLookController",function(){return m.BoneLookController}),c.d(s,"Skeleton",function(){return m.Skeleton}),c.d(s,"ArcRotateCameraGamepadInput",function(){return m.ArcRotateCameraGamepadInput}),c.d(s,"ArcRotateCameraKeyboardMoveInput",function(){return m.ArcRotateCameraKeyboardMoveInput}),c.d(s,"ArcRotateCameraMouseWheelInput",function(){return m.ArcRotateCameraMouseWheelInput}),c.d(s,"ArcRotateCameraPointersInput",function(){return m.ArcRotateCameraPointersInput}),c.d(s,"ArcRotateCameraVRDeviceOrientationInput",function(){return m.ArcRotateCameraVRDeviceOrientationInput}),c.d(s,"FlyCameraKeyboardInput",function(){return m.FlyCameraKeyboardInput}),c.d(s,"FlyCameraMouseInput",function(){return m.FlyCameraMouseInput}),c.d(s,"FollowCameraKeyboardMoveInput",function(){return m.FollowCameraKeyboardMoveInput}),c.d(s,"FollowCameraMouseWheelInput",function(){return m.FollowCameraMouseWheelInput}),c.d(s,"FollowCameraPointersInput",function(){return m.FollowCameraPointersInput}),c.d(s,"FreeCameraDeviceOrientationInput",function(){return m.FreeCameraDeviceOrientationInput}),c.d(s,"FreeCameraGamepadInput",function(){return m.FreeCameraGamepadInput}),c.d(s,"FreeCameraKeyboardMoveInput",function(){return m.FreeCameraKeyboardMoveInput}),c.d(s,"FreeCameraMouseInput",function(){return m.FreeCameraMouseInput}),c.d(s,"FreeCameraMouseWheelInput",function(){return m.FreeCameraMouseWheelInput}),c.d(s,"FreeCameraTouchInput",function(){return m.FreeCameraTouchInput}),c.d(s,"FreeCameraVirtualJoystickInput",function(){return m.FreeCameraVirtualJoystickInput}),c.d(s,"CameraInputTypes",function(){return m.CameraInputTypes}),c.d(s,"CameraInputsManager",function(){return m.CameraInputsManager}),c.d(s,"Camera",function(){return m.Camera}),c.d(s,"TargetCamera",function(){return m.TargetCamera}),c.d(s,"FreeCamera",function(){return m.FreeCamera}),c.d(s,"FreeCameraInputsManager",function(){return m.FreeCameraInputsManager}),c.d(s,"TouchCamera",function(){return m.TouchCamera}),c.d(s,"ArcRotateCamera",function(){return m.ArcRotateCamera}),c.d(s,"ArcRotateCameraInputsManager",function(){return m.ArcRotateCameraInputsManager}),c.d(s,"DeviceOrientationCamera",function(){return m.DeviceOrientationCamera}),c.d(s,"FlyCamera",function(){return m.FlyCamera}),c.d(s,"FlyCameraInputsManager",function(){return m.FlyCameraInputsManager}),c.d(s,"FollowCamera",function(){return m.FollowCamera}),c.d(s,"ArcFollowCamera",function(){return m.ArcFollowCamera}),c.d(s,"FollowCameraInputsManager",function(){return m.FollowCameraInputsManager}),c.d(s,"GamepadCamera",function(){return m.GamepadCamera}),c.d(s,"AnaglyphArcRotateCamera",function(){return m.AnaglyphArcRotateCamera}),c.d(s,"AnaglyphFreeCamera",function(){return m.AnaglyphFreeCamera}),c.d(s,"AnaglyphGamepadCamera",function(){return m.AnaglyphGamepadCamera}),c.d(s,"AnaglyphUniversalCamera",function(){return m.AnaglyphUniversalCamera}),c.d(s,"StereoscopicArcRotateCamera",function(){return m.StereoscopicArcRotateCamera}),c.d(s,"StereoscopicFreeCamera",function(){return m.StereoscopicFreeCamera}),c.d(s,"StereoscopicGamepadCamera",function(){return m.StereoscopicGamepadCamera}),c.d(s,"StereoscopicUniversalCamera",function(){return m.StereoscopicUniversalCamera}),c.d(s,"UniversalCamera",function(){return m.UniversalCamera}),c.d(s,"VirtualJoysticksCamera",function(){return m.VirtualJoysticksCamera}),c.d(s,"VRCameraMetrics",function(){return m.VRCameraMetrics}),c.d(s,"VRDeviceOrientationArcRotateCamera",function(){return m.VRDeviceOrientationArcRotateCamera}),c.d(s,"VRDeviceOrientationFreeCamera",function(){return m.VRDeviceOrientationFreeCamera}),c.d(s,"VRDeviceOrientationGamepadCamera",function(){return m.VRDeviceOrientationGamepadCamera}),c.d(s,"OnAfterEnteringVRObservableEvent",function(){return m.OnAfterEnteringVRObservableEvent}),c.d(s,"VRExperienceHelper",function(){return m.VRExperienceHelper}),c.d(s,"WebVRFreeCamera",function(){return m.WebVRFreeCamera}),c.d(s,"Collider",function(){return m.Collider}),c.d(s,"DefaultCollisionCoordinator",function(){return m.DefaultCollisionCoordinator}),c.d(s,"PickingInfo",function(){return m.PickingInfo}),c.d(s,"IntersectionInfo",function(){return m.IntersectionInfo}),c.d(s,"_MeshCollisionData",function(){return m._MeshCollisionData}),c.d(s,"BoundingBox",function(){return m.BoundingBox}),c.d(s,"BoundingInfo",function(){return m.BoundingInfo}),c.d(s,"BoundingSphere",function(){return m.BoundingSphere}),c.d(s,"Octree",function(){return m.Octree}),c.d(s,"OctreeBlock",function(){return m.OctreeBlock}),c.d(s,"OctreeSceneComponent",function(){return m.OctreeSceneComponent}),c.d(s,"Ray",function(){return m.Ray}),c.d(s,"AxesViewer",function(){return m.AxesViewer}),c.d(s,"BoneAxesViewer",function(){return m.BoneAxesViewer}),c.d(s,"DebugLayerTab",function(){return m.DebugLayerTab}),c.d(s,"DebugLayer",function(){return m.DebugLayer}),c.d(s,"PhysicsViewer",function(){return m.PhysicsViewer}),c.d(s,"RayHelper",function(){return m.RayHelper}),c.d(s,"SkeletonViewer",function(){return m.SkeletonViewer}),c.d(s,"DeviceInputSystem",function(){return m.DeviceInputSystem}),c.d(s,"DeviceType",function(){return m.DeviceType}),c.d(s,"PointerInput",function(){return m.PointerInput}),c.d(s,"DualShockInput",function(){return m.DualShockInput}),c.d(s,"XboxInput",function(){return m.XboxInput}),c.d(s,"SwitchInput",function(){return m.SwitchInput}),c.d(s,"DeviceSource",function(){return m.DeviceSource}),c.d(s,"DeviceSourceManager",function(){return m.DeviceSourceManager}),c.d(s,"Constants",function(){return m.Constants}),c.d(s,"ThinEngine",function(){return m.ThinEngine}),c.d(s,"Engine",function(){return m.Engine}),c.d(s,"EngineStore",function(){return m.EngineStore}),c.d(s,"NullEngineOptions",function(){return m.NullEngineOptions}),c.d(s,"NullEngine",function(){return m.NullEngine}),c.d(s,"_OcclusionDataStorage",function(){return m._OcclusionDataStorage}),c.d(s,"_forceTransformFeedbackToBundle",function(){return m._forceTransformFeedbackToBundle}),c.d(s,"EngineView",function(){return m.EngineView}),c.d(s,"WebGLPipelineContext",function(){return m.WebGLPipelineContext}),c.d(s,"WebGL2ShaderProcessor",function(){return m.WebGL2ShaderProcessor}),c.d(s,"NativeEngine",function(){return m.NativeEngine}),c.d(s,"ShaderCodeInliner",function(){return m.ShaderCodeInliner}),c.d(s,"PerformanceConfigurator",function(){return m.PerformanceConfigurator}),c.d(s,"KeyboardEventTypes",function(){return m.KeyboardEventTypes}),c.d(s,"KeyboardInfo",function(){return m.KeyboardInfo}),c.d(s,"KeyboardInfoPre",function(){return m.KeyboardInfoPre}),c.d(s,"PointerEventTypes",function(){return m.PointerEventTypes}),c.d(s,"PointerInfoBase",function(){return m.PointerInfoBase}),c.d(s,"PointerInfoPre",function(){return m.PointerInfoPre}),c.d(s,"PointerInfo",function(){return m.PointerInfo}),c.d(s,"ClipboardEventTypes",function(){return m.ClipboardEventTypes}),c.d(s,"ClipboardInfo",function(){return m.ClipboardInfo}),c.d(s,"DaydreamController",function(){return m.DaydreamController}),c.d(s,"GearVRController",function(){return m.GearVRController}),c.d(s,"GenericController",function(){return m.GenericController}),c.d(s,"OculusTouchController",function(){return m.OculusTouchController}),c.d(s,"PoseEnabledControllerType",function(){return m.PoseEnabledControllerType}),c.d(s,"PoseEnabledControllerHelper",function(){return m.PoseEnabledControllerHelper}),c.d(s,"PoseEnabledController",function(){return m.PoseEnabledController}),c.d(s,"ViveController",function(){return m.ViveController}),c.d(s,"WebVRController",function(){return m.WebVRController}),c.d(s,"WindowsMotionController",function(){return m.WindowsMotionController}),c.d(s,"XRWindowsMotionController",function(){return m.XRWindowsMotionController}),c.d(s,"StickValues",function(){return m.StickValues}),c.d(s,"Gamepad",function(){return m.Gamepad}),c.d(s,"GenericPad",function(){return m.GenericPad}),c.d(s,"GamepadManager",function(){return m.GamepadManager}),c.d(s,"GamepadSystemSceneComponent",function(){return m.GamepadSystemSceneComponent}),c.d(s,"Xbox360Button",function(){return m.Xbox360Button}),c.d(s,"Xbox360Dpad",function(){return m.Xbox360Dpad}),c.d(s,"Xbox360Pad",function(){return m.Xbox360Pad}),c.d(s,"DualShockButton",function(){return m.DualShockButton}),c.d(s,"DualShockDpad",function(){return m.DualShockDpad}),c.d(s,"DualShockPad",function(){return m.DualShockPad}),c.d(s,"AxisDragGizmo",function(){return m.AxisDragGizmo}),c.d(s,"AxisScaleGizmo",function(){return m.AxisScaleGizmo}),c.d(s,"BoundingBoxGizmo",function(){return m.BoundingBoxGizmo}),c.d(s,"Gizmo",function(){return m.Gizmo}),c.d(s,"GizmoManager",function(){return m.GizmoManager}),c.d(s,"PlaneRotationGizmo",function(){return m.PlaneRotationGizmo}),c.d(s,"PositionGizmo",function(){return m.PositionGizmo}),c.d(s,"RotationGizmo",function(){return m.RotationGizmo}),c.d(s,"ScaleGizmo",function(){return m.ScaleGizmo}),c.d(s,"LightGizmo",function(){return m.LightGizmo}),c.d(s,"CameraGizmo",function(){return m.CameraGizmo}),c.d(s,"PlaneDragGizmo",function(){return m.PlaneDragGizmo}),c.d(s,"EnvironmentHelper",function(){return m.EnvironmentHelper}),c.d(s,"PhotoDome",function(){return m.PhotoDome}),c.d(s,"_forceSceneHelpersToBundle",function(){return m._forceSceneHelpersToBundle}),c.d(s,"VideoDome",function(){return m.VideoDome}),c.d(s,"EngineInstrumentation",function(){return m.EngineInstrumentation}),c.d(s,"SceneInstrumentation",function(){return m.SceneInstrumentation}),c.d(s,"_TimeToken",function(){return m._TimeToken}),c.d(s,"EffectLayer",function(){return m.EffectLayer}),c.d(s,"EffectLayerSceneComponent",function(){return m.EffectLayerSceneComponent}),c.d(s,"GlowLayer",function(){return m.GlowLayer}),c.d(s,"HighlightLayer",function(){return m.HighlightLayer}),c.d(s,"Layer",function(){return m.Layer}),c.d(s,"LayerSceneComponent",function(){return m.LayerSceneComponent}),c.d(s,"LensFlare",function(){return m.LensFlare}),c.d(s,"LensFlareSystem",function(){return m.LensFlareSystem}),c.d(s,"LensFlareSystemSceneComponent",function(){return m.LensFlareSystemSceneComponent}),c.d(s,"Light",function(){return m.Light}),c.d(s,"ShadowLight",function(){return m.ShadowLight}),c.d(s,"ShadowGenerator",function(){return m.ShadowGenerator}),c.d(s,"CascadedShadowGenerator",function(){return m.CascadedShadowGenerator}),c.d(s,"ShadowGeneratorSceneComponent",function(){return m.ShadowGeneratorSceneComponent}),c.d(s,"DirectionalLight",function(){return m.DirectionalLight}),c.d(s,"HemisphericLight",function(){return m.HemisphericLight}),c.d(s,"PointLight",function(){return m.PointLight}),c.d(s,"SpotLight",function(){return m.SpotLight}),c.d(s,"DefaultLoadingScreen",function(){return m.DefaultLoadingScreen}),c.d(s,"_BabylonLoaderRegistered",function(){return m._BabylonLoaderRegistered}),c.d(s,"BabylonFileLoaderConfiguration",function(){return m.BabylonFileLoaderConfiguration}),c.d(s,"SceneLoaderAnimationGroupLoadingMode",function(){return m.SceneLoaderAnimationGroupLoadingMode}),c.d(s,"SceneLoader",function(){return m.SceneLoader}),c.d(s,"SceneLoaderFlags",function(){return m.SceneLoaderFlags}),c.d(s,"BackgroundMaterial",function(){return m.BackgroundMaterial}),c.d(s,"ColorCurves",function(){return m.ColorCurves}),c.d(s,"EffectFallbacks",function(){return m.EffectFallbacks}),c.d(s,"Effect",function(){return m.Effect}),c.d(s,"FresnelParameters",function(){return m.FresnelParameters}),c.d(s,"ImageProcessingConfigurationDefines",function(){return m.ImageProcessingConfigurationDefines}),c.d(s,"ImageProcessingConfiguration",function(){return m.ImageProcessingConfiguration}),c.d(s,"Material",function(){return m.Material}),c.d(s,"MaterialDefines",function(){return m.MaterialDefines}),c.d(s,"ThinMaterialHelper",function(){return m.ThinMaterialHelper}),c.d(s,"MaterialHelper",function(){return m.MaterialHelper}),c.d(s,"MultiMaterial",function(){return m.MultiMaterial}),c.d(s,"PBRMaterialDefines",function(){return m.PBRMaterialDefines}),c.d(s,"PBRBaseMaterial",function(){return m.PBRBaseMaterial}),c.d(s,"PBRBaseSimpleMaterial",function(){return m.PBRBaseSimpleMaterial}),c.d(s,"PBRMaterial",function(){return m.PBRMaterial}),c.d(s,"PBRMetallicRoughnessMaterial",function(){return m.PBRMetallicRoughnessMaterial}),c.d(s,"PBRSpecularGlossinessMaterial",function(){return m.PBRSpecularGlossinessMaterial}),c.d(s,"PushMaterial",function(){return m.PushMaterial}),c.d(s,"ShaderMaterial",function(){return m.ShaderMaterial}),c.d(s,"StandardMaterialDefines",function(){return m.StandardMaterialDefines}),c.d(s,"StandardMaterial",function(){return m.StandardMaterial}),c.d(s,"BaseTexture",function(){return m.BaseTexture}),c.d(s,"ColorGradingTexture",function(){return m.ColorGradingTexture}),c.d(s,"CubeTexture",function(){return m.CubeTexture}),c.d(s,"DynamicTexture",function(){return m.DynamicTexture}),c.d(s,"EquiRectangularCubeTexture",function(){return m.EquiRectangularCubeTexture}),c.d(s,"HDRFiltering",function(){return m.HDRFiltering}),c.d(s,"HDRCubeTexture",function(){return m.HDRCubeTexture}),c.d(s,"HtmlElementTexture",function(){return m.HtmlElementTexture}),c.d(s,"InternalTextureSource",function(){return m.InternalTextureSource}),c.d(s,"InternalTexture",function(){return m.InternalTexture}),c.d(s,"_DDSTextureLoader",function(){return m._DDSTextureLoader}),c.d(s,"_ENVTextureLoader",function(){return m._ENVTextureLoader}),c.d(s,"_KTXTextureLoader",function(){return m._KTXTextureLoader}),c.d(s,"_TGATextureLoader",function(){return m._TGATextureLoader}),c.d(s,"_BasisTextureLoader",function(){return m._BasisTextureLoader}),c.d(s,"MirrorTexture",function(){return m.MirrorTexture}),c.d(s,"MultiRenderTarget",function(){return m.MultiRenderTarget}),c.d(s,"TexturePacker",function(){return m.TexturePacker}),c.d(s,"TexturePackerFrame",function(){return m.TexturePackerFrame}),c.d(s,"CustomProceduralTexture",function(){return m.CustomProceduralTexture}),c.d(s,"NoiseProceduralTexture",function(){return m.NoiseProceduralTexture}),c.d(s,"ProceduralTexture",function(){return m.ProceduralTexture}),c.d(s,"ProceduralTextureSceneComponent",function(){return m.ProceduralTextureSceneComponent}),c.d(s,"RawCubeTexture",function(){return m.RawCubeTexture}),c.d(s,"RawTexture",function(){return m.RawTexture}),c.d(s,"RawTexture2DArray",function(){return m.RawTexture2DArray}),c.d(s,"RawTexture3D",function(){return m.RawTexture3D}),c.d(s,"RefractionTexture",function(){return m.RefractionTexture}),c.d(s,"RenderTargetTexture",function(){return m.RenderTargetTexture}),c.d(s,"Texture",function(){return m.Texture}),c.d(s,"VideoTexture",function(){return m.VideoTexture}),c.d(s,"UniformBuffer",function(){return m.UniformBuffer}),c.d(s,"MaterialFlags",function(){return m.MaterialFlags}),c.d(s,"NodeMaterialBlockTargets",function(){return m.NodeMaterialBlockTargets}),c.d(s,"NodeMaterialBlockConnectionPointTypes",function(){return m.NodeMaterialBlockConnectionPointTypes}),c.d(s,"NodeMaterialBlockConnectionPointMode",function(){return m.NodeMaterialBlockConnectionPointMode}),c.d(s,"NodeMaterialSystemValues",function(){return m.NodeMaterialSystemValues}),c.d(s,"NodeMaterialModes",function(){return m.NodeMaterialModes}),c.d(s,"NodeMaterialConnectionPointCompatibilityStates",function(){return m.NodeMaterialConnectionPointCompatibilityStates}),c.d(s,"NodeMaterialConnectionPointDirection",function(){return m.NodeMaterialConnectionPointDirection}),c.d(s,"NodeMaterialConnectionPoint",function(){return m.NodeMaterialConnectionPoint}),c.d(s,"NodeMaterialBlock",function(){return m.NodeMaterialBlock}),c.d(s,"NodeMaterialDefines",function(){return m.NodeMaterialDefines}),c.d(s,"NodeMaterial",function(){return m.NodeMaterial}),c.d(s,"VertexOutputBlock",function(){return m.VertexOutputBlock}),c.d(s,"BonesBlock",function(){return m.BonesBlock}),c.d(s,"InstancesBlock",function(){return m.InstancesBlock}),c.d(s,"MorphTargetsBlock",function(){return m.MorphTargetsBlock}),c.d(s,"LightInformationBlock",function(){return m.LightInformationBlock}),c.d(s,"FragmentOutputBlock",function(){return m.FragmentOutputBlock}),c.d(s,"ImageProcessingBlock",function(){return m.ImageProcessingBlock}),c.d(s,"PerturbNormalBlock",function(){return m.PerturbNormalBlock}),c.d(s,"DiscardBlock",function(){return m.DiscardBlock}),c.d(s,"FrontFacingBlock",function(){return m.FrontFacingBlock}),c.d(s,"DerivativeBlock",function(){return m.DerivativeBlock}),c.d(s,"FragCoordBlock",function(){return m.FragCoordBlock}),c.d(s,"ScreenSizeBlock",function(){return m.ScreenSizeBlock}),c.d(s,"FogBlock",function(){return m.FogBlock}),c.d(s,"LightBlock",function(){return m.LightBlock}),c.d(s,"TextureBlock",function(){return m.TextureBlock}),c.d(s,"ReflectionTextureBlock",function(){return m.ReflectionTextureBlock}),c.d(s,"CurrentScreenBlock",function(){return m.CurrentScreenBlock}),c.d(s,"InputBlock",function(){return m.InputBlock}),c.d(s,"AnimatedInputBlockTypes",function(){return m.AnimatedInputBlockTypes}),c.d(s,"MultiplyBlock",function(){return m.MultiplyBlock}),c.d(s,"AddBlock",function(){return m.AddBlock}),c.d(s,"ScaleBlock",function(){return m.ScaleBlock}),c.d(s,"ClampBlock",function(){return m.ClampBlock}),c.d(s,"CrossBlock",function(){return m.CrossBlock}),c.d(s,"DotBlock",function(){return m.DotBlock}),c.d(s,"TransformBlock",function(){return m.TransformBlock}),c.d(s,"RemapBlock",function(){return m.RemapBlock}),c.d(s,"NormalizeBlock",function(){return m.NormalizeBlock}),c.d(s,"TrigonometryBlockOperations",function(){return m.TrigonometryBlockOperations}),c.d(s,"TrigonometryBlock",function(){return m.TrigonometryBlock}),c.d(s,"ColorMergerBlock",function(){return m.ColorMergerBlock}),c.d(s,"VectorMergerBlock",function(){return m.VectorMergerBlock}),c.d(s,"ColorSplitterBlock",function(){return m.ColorSplitterBlock}),c.d(s,"VectorSplitterBlock",function(){return m.VectorSplitterBlock}),c.d(s,"LerpBlock",function(){return m.LerpBlock}),c.d(s,"DivideBlock",function(){return m.DivideBlock}),c.d(s,"SubtractBlock",function(){return m.SubtractBlock}),c.d(s,"StepBlock",function(){return m.StepBlock}),c.d(s,"OneMinusBlock",function(){return m.OneMinusBlock}),c.d(s,"ViewDirectionBlock",function(){return m.ViewDirectionBlock}),c.d(s,"FresnelBlock",function(){return m.FresnelBlock}),c.d(s,"MaxBlock",function(){return m.MaxBlock}),c.d(s,"MinBlock",function(){return m.MinBlock}),c.d(s,"DistanceBlock",function(){return m.DistanceBlock}),c.d(s,"LengthBlock",function(){return m.LengthBlock}),c.d(s,"NegateBlock",function(){return m.NegateBlock}),c.d(s,"PowBlock",function(){return m.PowBlock}),c.d(s,"RandomNumberBlock",function(){return m.RandomNumberBlock}),c.d(s,"ArcTan2Block",function(){return m.ArcTan2Block}),c.d(s,"SmoothStepBlock",function(){return m.SmoothStepBlock}),c.d(s,"ReciprocalBlock",function(){return m.ReciprocalBlock}),c.d(s,"ReplaceColorBlock",function(){return m.ReplaceColorBlock}),c.d(s,"PosterizeBlock",function(){return m.PosterizeBlock}),c.d(s,"WaveBlockKind",function(){return m.WaveBlockKind}),c.d(s,"WaveBlock",function(){return m.WaveBlock}),c.d(s,"GradientBlockColorStep",function(){return m.GradientBlockColorStep}),c.d(s,"GradientBlock",function(){return m.GradientBlock}),c.d(s,"NLerpBlock",function(){return m.NLerpBlock}),c.d(s,"WorleyNoise3DBlock",function(){return m.WorleyNoise3DBlock}),c.d(s,"SimplexPerlin3DBlock",function(){return m.SimplexPerlin3DBlock}),c.d(s,"NormalBlendBlock",function(){return m.NormalBlendBlock}),c.d(s,"Rotate2dBlock",function(){return m.Rotate2dBlock}),c.d(s,"ReflectBlock",function(){return m.ReflectBlock}),c.d(s,"RefractBlock",function(){return m.RefractBlock}),c.d(s,"DesaturateBlock",function(){return m.DesaturateBlock}),c.d(s,"PBRMetallicRoughnessBlock",function(){return m.PBRMetallicRoughnessBlock}),c.d(s,"SheenBlock",function(){return m.SheenBlock}),c.d(s,"AnisotropyBlock",function(){return m.AnisotropyBlock}),c.d(s,"ReflectionBlock",function(){return m.ReflectionBlock}),c.d(s,"ClearCoatBlock",function(){return m.ClearCoatBlock}),c.d(s,"RefractionBlock",function(){return m.RefractionBlock}),c.d(s,"SubSurfaceBlock",function(){return m.SubSurfaceBlock}),c.d(s,"ParticleTextureBlock",function(){return m.ParticleTextureBlock}),c.d(s,"ParticleRampGradientBlock",function(){return m.ParticleRampGradientBlock}),c.d(s,"ParticleBlendMultiplyBlock",function(){return m.ParticleBlendMultiplyBlock}),c.d(s,"ModBlock",function(){return m.ModBlock}),c.d(s,"NodeMaterialOptimizer",function(){return m.NodeMaterialOptimizer}),c.d(s,"PropertyTypeForEdition",function(){return m.PropertyTypeForEdition}),c.d(s,"editableInPropertyPage",function(){return m.editableInPropertyPage}),c.d(s,"EffectRenderer",function(){return m.EffectRenderer}),c.d(s,"EffectWrapper",function(){return m.EffectWrapper}),c.d(s,"ShadowDepthWrapper",function(){return m.ShadowDepthWrapper}),c.d(s,"Scalar",function(){return m.Scalar}),c.d(s,"extractMinAndMaxIndexed",function(){return m.extractMinAndMaxIndexed}),c.d(s,"extractMinAndMax",function(){return m.extractMinAndMax}),c.d(s,"Space",function(){return m.Space}),c.d(s,"Axis",function(){return m.Axis}),c.d(s,"Coordinate",function(){return m.Coordinate}),c.d(s,"Color3",function(){return m.Color3}),c.d(s,"Color4",function(){return m.Color4}),c.d(s,"TmpColors",function(){return m.TmpColors}),c.d(s,"ToGammaSpace",function(){return m.ToGammaSpace}),c.d(s,"ToLinearSpace",function(){return m.ToLinearSpace}),c.d(s,"Epsilon",function(){return m.Epsilon}),c.d(s,"Frustum",function(){return m.Frustum}),c.d(s,"Orientation",function(){return m.Orientation}),c.d(s,"BezierCurve",function(){return m.BezierCurve}),c.d(s,"Angle",function(){return m.Angle}),c.d(s,"Arc2",function(){return m.Arc2}),c.d(s,"Path2",function(){return m.Path2}),c.d(s,"Path3D",function(){return m.Path3D}),c.d(s,"Curve3",function(){return m.Curve3}),c.d(s,"Plane",function(){return m.Plane}),c.d(s,"Size",function(){return m.Size}),c.d(s,"Vector2",function(){return m.Vector2}),c.d(s,"Vector3",function(){return m.Vector3}),c.d(s,"Vector4",function(){return m.Vector4}),c.d(s,"Quaternion",function(){return m.Quaternion}),c.d(s,"Matrix",function(){return m.Matrix}),c.d(s,"TmpVectors",function(){return m.TmpVectors}),c.d(s,"PositionNormalVertex",function(){return m.PositionNormalVertex}),c.d(s,"PositionNormalTextureVertex",function(){return m.PositionNormalTextureVertex}),c.d(s,"Viewport",function(){return m.Viewport}),c.d(s,"SphericalHarmonics",function(){return m.SphericalHarmonics}),c.d(s,"SphericalPolynomial",function(){return m.SphericalPolynomial}),c.d(s,"AbstractMesh",function(){return m.AbstractMesh}),c.d(s,"Buffer",function(){return m.Buffer}),c.d(s,"VertexBuffer",function(){return m.VertexBuffer}),c.d(s,"DracoCompression",function(){return m.DracoCompression}),c.d(s,"CSG",function(){return m.CSG}),c.d(s,"Geometry",function(){return m.Geometry}),c.d(s,"GroundMesh",function(){return m.GroundMesh}),c.d(s,"TrailMesh",function(){return m.TrailMesh}),c.d(s,"InstancedMesh",function(){return m.InstancedMesh}),c.d(s,"LinesMesh",function(){return m.LinesMesh}),c.d(s,"InstancedLinesMesh",function(){return m.InstancedLinesMesh}),c.d(s,"_CreationDataStorage",function(){return m._CreationDataStorage}),c.d(s,"_InstancesBatch",function(){return m._InstancesBatch}),c.d(s,"Mesh",function(){return m.Mesh}),c.d(s,"VertexData",function(){return m.VertexData}),c.d(s,"MeshBuilder",function(){return m.MeshBuilder}),c.d(s,"SimplificationSettings",function(){return m.SimplificationSettings}),c.d(s,"SimplificationQueue",function(){return m.SimplificationQueue}),c.d(s,"SimplificationType",function(){return m.SimplificationType}),c.d(s,"QuadraticErrorSimplification",function(){return m.QuadraticErrorSimplification}),c.d(s,"SimplicationQueueSceneComponent",function(){return m.SimplicationQueueSceneComponent}),c.d(s,"Polygon",function(){return m.Polygon}),c.d(s,"PolygonMeshBuilder",function(){return m.PolygonMeshBuilder}),c.d(s,"SubMesh",function(){return m.SubMesh}),c.d(s,"MeshLODLevel",function(){return m.MeshLODLevel}),c.d(s,"TransformNode",function(){return m.TransformNode}),c.d(s,"BoxBuilder",function(){return m.BoxBuilder}),c.d(s,"TiledBoxBuilder",function(){return m.TiledBoxBuilder}),c.d(s,"DiscBuilder",function(){return m.DiscBuilder}),c.d(s,"RibbonBuilder",function(){return m.RibbonBuilder}),c.d(s,"SphereBuilder",function(){return m.SphereBuilder}),c.d(s,"HemisphereBuilder",function(){return m.HemisphereBuilder}),c.d(s,"CylinderBuilder",function(){return m.CylinderBuilder}),c.d(s,"TorusBuilder",function(){return m.TorusBuilder}),c.d(s,"TorusKnotBuilder",function(){return m.TorusKnotBuilder}),c.d(s,"LinesBuilder",function(){return m.LinesBuilder}),c.d(s,"PolygonBuilder",function(){return m.PolygonBuilder}),c.d(s,"ShapeBuilder",function(){return m.ShapeBuilder}),c.d(s,"LatheBuilder",function(){return m.LatheBuilder}),c.d(s,"PlaneBuilder",function(){return m.PlaneBuilder}),c.d(s,"TiledPlaneBuilder",function(){return m.TiledPlaneBuilder}),c.d(s,"GroundBuilder",function(){return m.GroundBuilder}),c.d(s,"TubeBuilder",function(){return m.TubeBuilder}),c.d(s,"PolyhedronBuilder",function(){return m.PolyhedronBuilder}),c.d(s,"IcoSphereBuilder",function(){return m.IcoSphereBuilder}),c.d(s,"DecalBuilder",function(){return m.DecalBuilder}),c.d(s,"CapsuleBuilder",function(){return m.CapsuleBuilder}),c.d(s,"DataBuffer",function(){return m.DataBuffer}),c.d(s,"WebGLDataBuffer",function(){return m.WebGLDataBuffer}),c.d(s,"MorphTarget",function(){return m.MorphTarget}),c.d(s,"MorphTargetManager",function(){return m.MorphTargetManager}),c.d(s,"RecastJSPlugin",function(){return m.RecastJSPlugin}),c.d(s,"RecastJSCrowd",function(){return m.RecastJSCrowd}),c.d(s,"Node",function(){return m.Node}),c.d(s,"Database",function(){return m.Database}),c.d(s,"BaseParticleSystem",function(){return m.BaseParticleSystem}),c.d(s,"BoxParticleEmitter",function(){return m.BoxParticleEmitter}),c.d(s,"ConeParticleEmitter",function(){return m.ConeParticleEmitter}),c.d(s,"CylinderParticleEmitter",function(){return m.CylinderParticleEmitter}),c.d(s,"CylinderDirectedParticleEmitter",function(){return m.CylinderDirectedParticleEmitter}),c.d(s,"HemisphericParticleEmitter",function(){return m.HemisphericParticleEmitter}),c.d(s,"PointParticleEmitter",function(){return m.PointParticleEmitter}),c.d(s,"SphereParticleEmitter",function(){return m.SphereParticleEmitter}),c.d(s,"SphereDirectedParticleEmitter",function(){return m.SphereDirectedParticleEmitter}),c.d(s,"CustomParticleEmitter",function(){return m.CustomParticleEmitter}),c.d(s,"MeshParticleEmitter",function(){return m.MeshParticleEmitter}),c.d(s,"GPUParticleSystem",function(){return m.GPUParticleSystem}),c.d(s,"Particle",function(){return m.Particle}),c.d(s,"ParticleHelper",function(){return m.ParticleHelper}),c.d(s,"ParticleSystem",function(){return m.ParticleSystem}),c.d(s,"ParticleSystemSet",function(){return m.ParticleSystemSet}),c.d(s,"SolidParticle",function(){return m.SolidParticle}),c.d(s,"ModelShape",function(){return m.ModelShape}),c.d(s,"DepthSortedParticle",function(){return m.DepthSortedParticle}),c.d(s,"SolidParticleVertex",function(){return m.SolidParticleVertex}),c.d(s,"SolidParticleSystem",function(){return m.SolidParticleSystem}),c.d(s,"CloudPoint",function(){return m.CloudPoint}),c.d(s,"PointsGroup",function(){return m.PointsGroup}),c.d(s,"PointColor",function(){return m.PointColor}),c.d(s,"PointsCloudSystem",function(){return m.PointsCloudSystem}),c.d(s,"SubEmitterType",function(){return m.SubEmitterType}),c.d(s,"SubEmitter",function(){return m.SubEmitter}),c.d(s,"PhysicsEngine",function(){return m.PhysicsEngine}),c.d(s,"PhysicsEngineSceneComponent",function(){return m.PhysicsEngineSceneComponent}),c.d(s,"PhysicsHelper",function(){return m.PhysicsHelper}),c.d(s,"PhysicsRadialExplosionEventOptions",function(){return m.PhysicsRadialExplosionEventOptions}),c.d(s,"PhysicsUpdraftEventOptions",function(){return m.PhysicsUpdraftEventOptions}),c.d(s,"PhysicsVortexEventOptions",function(){return m.PhysicsVortexEventOptions}),c.d(s,"PhysicsRadialImpulseFalloff",function(){return m.PhysicsRadialImpulseFalloff}),c.d(s,"PhysicsUpdraftMode",function(){return m.PhysicsUpdraftMode}),c.d(s,"PhysicsImpostor",function(){return m.PhysicsImpostor}),c.d(s,"PhysicsJoint",function(){return m.PhysicsJoint}),c.d(s,"DistanceJoint",function(){return m.DistanceJoint}),c.d(s,"MotorEnabledJoint",function(){return m.MotorEnabledJoint}),c.d(s,"HingeJoint",function(){return m.HingeJoint}),c.d(s,"Hinge2Joint",function(){return m.Hinge2Joint}),c.d(s,"CannonJSPlugin",function(){return m.CannonJSPlugin}),c.d(s,"AmmoJSPlugin",function(){return m.AmmoJSPlugin}),c.d(s,"OimoJSPlugin",function(){return m.OimoJSPlugin}),c.d(s,"AnaglyphPostProcess",function(){return m.AnaglyphPostProcess}),c.d(s,"BlackAndWhitePostProcess",function(){return m.BlackAndWhitePostProcess}),c.d(s,"BloomEffect",function(){return m.BloomEffect}),c.d(s,"BloomMergePostProcess",function(){return m.BloomMergePostProcess}),c.d(s,"BlurPostProcess",function(){return m.BlurPostProcess}),c.d(s,"ChromaticAberrationPostProcess",function(){return m.ChromaticAberrationPostProcess}),c.d(s,"CircleOfConfusionPostProcess",function(){return m.CircleOfConfusionPostProcess}),c.d(s,"ColorCorrectionPostProcess",function(){return m.ColorCorrectionPostProcess}),c.d(s,"ConvolutionPostProcess",function(){return m.ConvolutionPostProcess}),c.d(s,"DepthOfFieldBlurPostProcess",function(){return m.DepthOfFieldBlurPostProcess}),c.d(s,"DepthOfFieldEffectBlurLevel",function(){return m.DepthOfFieldEffectBlurLevel}),c.d(s,"DepthOfFieldEffect",function(){return m.DepthOfFieldEffect}),c.d(s,"DepthOfFieldMergePostProcessOptions",function(){return m.DepthOfFieldMergePostProcessOptions}),c.d(s,"DepthOfFieldMergePostProcess",function(){return m.DepthOfFieldMergePostProcess}),c.d(s,"DisplayPassPostProcess",function(){return m.DisplayPassPostProcess}),c.d(s,"ExtractHighlightsPostProcess",function(){return m.ExtractHighlightsPostProcess}),c.d(s,"FilterPostProcess",function(){return m.FilterPostProcess}),c.d(s,"FxaaPostProcess",function(){return m.FxaaPostProcess}),c.d(s,"GrainPostProcess",function(){return m.GrainPostProcess}),c.d(s,"HighlightsPostProcess",function(){return m.HighlightsPostProcess}),c.d(s,"ImageProcessingPostProcess",function(){return m.ImageProcessingPostProcess}),c.d(s,"MotionBlurPostProcess",function(){return m.MotionBlurPostProcess}),c.d(s,"PassPostProcess",function(){return m.PassPostProcess}),c.d(s,"PassCubePostProcess",function(){return m.PassCubePostProcess}),c.d(s,"PostProcess",function(){return m.PostProcess}),c.d(s,"PostProcessManager",function(){return m.PostProcessManager}),c.d(s,"RefractionPostProcess",function(){return m.RefractionPostProcess}),c.d(s,"DefaultRenderingPipeline",function(){return m.DefaultRenderingPipeline}),c.d(s,"LensRenderingPipeline",function(){return m.LensRenderingPipeline}),c.d(s,"SSAO2RenderingPipeline",function(){return m.SSAO2RenderingPipeline}),c.d(s,"SSAORenderingPipeline",function(){return m.SSAORenderingPipeline}),c.d(s,"StandardRenderingPipeline",function(){return m.StandardRenderingPipeline}),c.d(s,"PostProcessRenderEffect",function(){return m.PostProcessRenderEffect}),c.d(s,"PostProcessRenderPipeline",function(){return m.PostProcessRenderPipeline}),c.d(s,"PostProcessRenderPipelineManager",function(){return m.PostProcessRenderPipelineManager}),c.d(s,"PostProcessRenderPipelineManagerSceneComponent",function(){return m.PostProcessRenderPipelineManagerSceneComponent}),c.d(s,"SharpenPostProcess",function(){return m.SharpenPostProcess}),c.d(s,"StereoscopicInterlacePostProcessI",function(){return m.StereoscopicInterlacePostProcessI}),c.d(s,"StereoscopicInterlacePostProcess",function(){return m.StereoscopicInterlacePostProcess}),c.d(s,"TonemappingOperator",function(){return m.TonemappingOperator}),c.d(s,"TonemapPostProcess",function(){return m.TonemapPostProcess}),c.d(s,"VolumetricLightScatteringPostProcess",function(){return m.VolumetricLightScatteringPostProcess}),c.d(s,"VRDistortionCorrectionPostProcess",function(){return m.VRDistortionCorrectionPostProcess}),c.d(s,"VRMultiviewToSingleviewPostProcess",function(){return m.VRMultiviewToSingleviewPostProcess}),c.d(s,"ScreenSpaceReflectionPostProcess",function(){return m.ScreenSpaceReflectionPostProcess}),c.d(s,"ScreenSpaceCurvaturePostProcess",function(){return m.ScreenSpaceCurvaturePostProcess}),c.d(s,"ReflectionProbe",function(){return m.ReflectionProbe}),c.d(s,"BoundingBoxRenderer",function(){return m.BoundingBoxRenderer}),c.d(s,"DepthRenderer",function(){return m.DepthRenderer}),c.d(s,"DepthRendererSceneComponent",function(){return m.DepthRendererSceneComponent}),c.d(s,"EdgesRenderer",function(){return m.EdgesRenderer}),c.d(s,"LineEdgesRenderer",function(){return m.LineEdgesRenderer}),c.d(s,"GeometryBufferRenderer",function(){return m.GeometryBufferRenderer}),c.d(s,"GeometryBufferRendererSceneComponent",function(){return m.GeometryBufferRendererSceneComponent}),c.d(s,"PrePassRenderer",function(){return m.PrePassRenderer}),c.d(s,"PrePassRendererSceneComponent",function(){return m.PrePassRendererSceneComponent}),c.d(s,"SubSurfaceSceneComponent",function(){return m.SubSurfaceSceneComponent}),c.d(s,"OutlineRenderer",function(){return m.OutlineRenderer}),c.d(s,"RenderingGroup",function(){return m.RenderingGroup}),c.d(s,"RenderingGroupInfo",function(){return m.RenderingGroupInfo}),c.d(s,"RenderingManager",function(){return m.RenderingManager}),c.d(s,"UtilityLayerRenderer",function(){return m.UtilityLayerRenderer}),c.d(s,"Scene",function(){return m.Scene}),c.d(s,"SceneComponentConstants",function(){return m.SceneComponentConstants}),c.d(s,"Stage",function(){return m.Stage}),c.d(s,"Sprite",function(){return m.Sprite}),c.d(s,"SpriteManager",function(){return m.SpriteManager}),c.d(s,"SpriteMap",function(){return m.SpriteMap}),c.d(s,"SpritePackedManager",function(){return m.SpritePackedManager}),c.d(s,"SpriteSceneComponent",function(){return m.SpriteSceneComponent}),c.d(s,"AlphaState",function(){return m.AlphaState}),c.d(s,"DepthCullingState",function(){return m.DepthCullingState}),c.d(s,"StencilState",function(){return m.StencilState}),c.d(s,"AndOrNotEvaluator",function(){return m.AndOrNotEvaluator}),c.d(s,"AssetTaskState",function(){return m.AssetTaskState}),c.d(s,"AbstractAssetTask",function(){return m.AbstractAssetTask}),c.d(s,"AssetsProgressEvent",function(){return m.AssetsProgressEvent}),c.d(s,"ContainerAssetTask",function(){return m.ContainerAssetTask}),c.d(s,"MeshAssetTask",function(){return m.MeshAssetTask}),c.d(s,"TextFileAssetTask",function(){return m.TextFileAssetTask}),c.d(s,"BinaryFileAssetTask",function(){return m.BinaryFileAssetTask}),c.d(s,"ImageAssetTask",function(){return m.ImageAssetTask}),c.d(s,"TextureAssetTask",function(){return m.TextureAssetTask}),c.d(s,"CubeTextureAssetTask",function(){return m.CubeTextureAssetTask}),c.d(s,"HDRCubeTextureAssetTask",function(){return m.HDRCubeTextureAssetTask}),c.d(s,"EquiRectangularCubeTextureAssetTask",function(){return m.EquiRectangularCubeTextureAssetTask}),c.d(s,"AssetsManager",function(){return m.AssetsManager}),c.d(s,"BasisTranscodeConfiguration",function(){return m.BasisTranscodeConfiguration}),c.d(s,"BasisTools",function(){return m.BasisTools}),c.d(s,"DDSTools",function(){return m.DDSTools}),c.d(s,"expandToProperty",function(){return m.expandToProperty}),c.d(s,"serialize",function(){return m.serialize}),c.d(s,"serializeAsTexture",function(){return m.serializeAsTexture}),c.d(s,"serializeAsColor3",function(){return m.serializeAsColor3}),c.d(s,"serializeAsFresnelParameters",function(){return m.serializeAsFresnelParameters}),c.d(s,"serializeAsVector2",function(){return m.serializeAsVector2}),c.d(s,"serializeAsVector3",function(){return m.serializeAsVector3}),c.d(s,"serializeAsMeshReference",function(){return m.serializeAsMeshReference}),c.d(s,"serializeAsColorCurves",function(){return m.serializeAsColorCurves}),c.d(s,"serializeAsColor4",function(){return m.serializeAsColor4}),c.d(s,"serializeAsImageProcessingConfiguration",function(){return m.serializeAsImageProcessingConfiguration}),c.d(s,"serializeAsQuaternion",function(){return m.serializeAsQuaternion}),c.d(s,"serializeAsMatrix",function(){return m.serializeAsMatrix}),c.d(s,"serializeAsCameraReference",function(){return m.serializeAsCameraReference}),c.d(s,"SerializationHelper",function(){return m.SerializationHelper}),c.d(s,"Deferred",function(){return m.Deferred}),c.d(s,"EnvironmentTextureTools",function(){return m.EnvironmentTextureTools}),c.d(s,"MeshExploder",function(){return m.MeshExploder}),c.d(s,"FilesInput",function(){return m.FilesInput}),c.d(s,"CubeMapToSphericalPolynomialTools",function(){return m.CubeMapToSphericalPolynomialTools}),c.d(s,"HDRTools",function(){return m.HDRTools}),c.d(s,"PanoramaToCubeMapTools",function(){return m.PanoramaToCubeMapTools}),c.d(s,"KhronosTextureContainer",function(){return m.KhronosTextureContainer}),c.d(s,"EventState",function(){return m.EventState}),c.d(s,"Observer",function(){return m.Observer}),c.d(s,"MultiObserver",function(){return m.MultiObserver}),c.d(s,"Observable",function(){return m.Observable}),c.d(s,"PerformanceMonitor",function(){return m.PerformanceMonitor}),c.d(s,"RollingAverage",function(){return m.RollingAverage}),c.d(s,"PromisePolyfill",function(){return m.PromisePolyfill}),c.d(s,"SceneOptimization",function(){return m.SceneOptimization}),c.d(s,"TextureOptimization",function(){return m.TextureOptimization}),c.d(s,"HardwareScalingOptimization",function(){return m.HardwareScalingOptimization}),c.d(s,"ShadowsOptimization",function(){return m.ShadowsOptimization}),c.d(s,"PostProcessesOptimization",function(){return m.PostProcessesOptimization}),c.d(s,"LensFlaresOptimization",function(){return m.LensFlaresOptimization}),c.d(s,"CustomOptimization",function(){return m.CustomOptimization}),c.d(s,"ParticlesOptimization",function(){return m.ParticlesOptimization}),c.d(s,"RenderTargetsOptimization",function(){return m.RenderTargetsOptimization}),c.d(s,"MergeMeshesOptimization",function(){return m.MergeMeshesOptimization}),c.d(s,"SceneOptimizerOptions",function(){return m.SceneOptimizerOptions}),c.d(s,"SceneOptimizer",function(){return m.SceneOptimizer}),c.d(s,"SceneSerializer",function(){return m.SceneSerializer}),c.d(s,"SmartArray",function(){return m.SmartArray}),c.d(s,"SmartArrayNoDuplicate",function(){return m.SmartArrayNoDuplicate}),c.d(s,"StringDictionary",function(){return m.StringDictionary}),c.d(s,"Tags",function(){return m.Tags}),c.d(s,"TextureTools",function(){return m.TextureTools}),c.d(s,"TGATools",function(){return m.TGATools}),c.d(s,"Tools",function(){return m.Tools}),c.d(s,"className",function(){return m.className}),c.d(s,"AsyncLoop",function(){return m.AsyncLoop}),c.d(s,"VideoRecorder",function(){return m.VideoRecorder}),c.d(s,"JoystickAxis",function(){return m.JoystickAxis}),c.d(s,"VirtualJoystick",function(){return m.VirtualJoystick}),c.d(s,"WorkerPool",function(){return m.WorkerPool}),c.d(s,"Logger",function(){return m.Logger}),c.d(s,"_TypeStore",function(){return m._TypeStore}),c.d(s,"FilesInputStore",function(){return m.FilesInputStore}),c.d(s,"DeepCopier",function(){return m.DeepCopier}),c.d(s,"PivotTools",function(){return m.PivotTools}),c.d(s,"PrecisionDate",function(){return m.PrecisionDate}),c.d(s,"ScreenshotTools",function(){return m.ScreenshotTools}),c.d(s,"WebRequest",function(){return m.WebRequest}),c.d(s,"InspectableType",function(){return m.InspectableType}),c.d(s,"BRDFTextureTools",function(){return m.BRDFTextureTools}),c.d(s,"RGBDTextureTools",function(){return m.RGBDTextureTools}),c.d(s,"ColorGradient",function(){return m.ColorGradient}),c.d(s,"Color3Gradient",function(){return m.Color3Gradient}),c.d(s,"FactorGradient",function(){return m.FactorGradient}),c.d(s,"GradientHelper",function(){return m.GradientHelper}),c.d(s,"PerfCounter",function(){return m.PerfCounter}),c.d(s,"RetryStrategy",function(){return m.RetryStrategy}),c.d(s,"CanvasGenerator",function(){return m.CanvasGenerator}),c.d(s,"LoadFileError",function(){return m.LoadFileError}),c.d(s,"RequestFileError",function(){return m.RequestFileError}),c.d(s,"ReadFileError",function(){return m.ReadFileError}),c.d(s,"FileTools",function(){return m.FileTools}),c.d(s,"StringTools",function(){return m.StringTools}),c.d(s,"DataReader",function(){return m.DataReader}),c.d(s,"MinMaxReducer",function(){return m.MinMaxReducer}),c.d(s,"DepthReducer",function(){return m.DepthReducer}),c.d(s,"DataStorage",function(){return m.DataStorage}),c.d(s,"SceneRecorder",function(){return m.SceneRecorder}),c.d(s,"KhronosTextureContainer2",function(){return m.KhronosTextureContainer2}),c.d(s,"Trajectory",function(){return m.Trajectory}),c.d(s,"TrajectoryClassifier",function(){return m.TrajectoryClassifier}),c.d(s,"TimerState",function(){return m.TimerState}),c.d(s,"setAndStartTimer",function(){return m.setAndStartTimer}),c.d(s,"AdvancedTimer",function(){return m.AdvancedTimer}),c.d(s,"CopyTools",function(){return m.CopyTools}),c.d(s,"WebXRCamera",function(){return m.WebXRCamera}),c.d(s,"WebXREnterExitUIButton",function(){return m.WebXREnterExitUIButton}),c.d(s,"WebXREnterExitUIOptions",function(){return m.WebXREnterExitUIOptions}),c.d(s,"WebXREnterExitUI",function(){return m.WebXREnterExitUI}),c.d(s,"WebXRExperienceHelper",function(){return m.WebXRExperienceHelper}),c.d(s,"WebXRInput",function(){return m.WebXRInput}),c.d(s,"WebXRInputSource",function(){return m.WebXRInputSource}),c.d(s,"WebXRManagedOutputCanvasOptions",function(){return m.WebXRManagedOutputCanvasOptions}),c.d(s,"WebXRManagedOutputCanvas",function(){return m.WebXRManagedOutputCanvas}),c.d(s,"WebXRState",function(){return m.WebXRState}),c.d(s,"WebXRTrackingState",function(){return m.WebXRTrackingState}),c.d(s,"WebXRSessionManager",function(){return m.WebXRSessionManager}),c.d(s,"WebXRDefaultExperienceOptions",function(){return m.WebXRDefaultExperienceOptions}),c.d(s,"WebXRDefaultExperience",function(){return m.WebXRDefaultExperience}),c.d(s,"WebXRFeatureName",function(){return m.WebXRFeatureName}),c.d(s,"WebXRFeaturesManager",function(){return m.WebXRFeaturesManager}),c.d(s,"WebXRAbstractFeature",function(){return m.WebXRAbstractFeature}),c.d(s,"WebXRHitTestLegacy",function(){return m.WebXRHitTestLegacy}),c.d(s,"WebXRAnchorSystem",function(){return m.WebXRAnchorSystem}),c.d(s,"WebXRPlaneDetector",function(){return m.WebXRPlaneDetector}),c.d(s,"WebXRBackgroundRemover",function(){return m.WebXRBackgroundRemover}),c.d(s,"WebXRMotionControllerTeleportation",function(){return m.WebXRMotionControllerTeleportation}),c.d(s,"WebXRControllerPointerSelection",function(){return m.WebXRControllerPointerSelection}),c.d(s,"IWebXRControllerPhysicsOptions",function(){return m.IWebXRControllerPhysicsOptions}),c.d(s,"WebXRControllerPhysics",function(){return m.WebXRControllerPhysics}),c.d(s,"WebXRHitTest",function(){return m.WebXRHitTest}),c.d(s,"WebXRFeaturePointSystem",function(){return m.WebXRFeaturePointSystem}),c.d(s,"WebXRHand",function(){return m.WebXRHand}),c.d(s,"WebXRHandTracking",function(){return m.WebXRHandTracking}),c.d(s,"WebXRAbstractMotionController",function(){return m.WebXRAbstractMotionController}),c.d(s,"WebXRControllerComponent",function(){return m.WebXRControllerComponent}),c.d(s,"WebXRGenericTriggerMotionController",function(){return m.WebXRGenericTriggerMotionController}),c.d(s,"WebXRMicrosoftMixedRealityController",function(){return m.WebXRMicrosoftMixedRealityController}),c.d(s,"WebXRMotionControllerManager",function(){return m.WebXRMotionControllerManager}),c.d(s,"WebXROculusTouchMotionController",function(){return m.WebXROculusTouchMotionController}),c.d(s,"WebXRHTCViveMotionController",function(){return m.WebXRHTCViveMotionController}),c.d(s,"WebXRProfiledMotionController",function(){return m.WebXRProfiledMotionController});var d=E!==void 0?E:typeof window!="undefined"?window:void 0;if(d!==void 0){d.BABYLON=M,d.BABYLON=d.BABYLON||{};var M=d.BABYLON;M.Debug=M.Debug||{};var C=[];for(var I in S)M.Debug[I]=S[I],C.push(I);for(var I in m)M[I]=m[I]}var b={AxesViewer:S.AxesViewer,BoneAxesViewer:S.BoneAxesViewer,PhysicsViewer:S.PhysicsViewer,SkeletonViewer:S.SkeletonViewer}}.call(this,c(159))}])})})(bp);var rq=vF(bp.exports),wq=Object.freeze($N({__proto__:null,[Symbol.toStringTag]:"Module",default:rq},[bp.exports])),iq={exports:{}};(function(a,l){(function(h,s){a.exports=s(bp.exports)})(typeof self!="undefined"?self:Fe,function(h){return function(s){var c={};function E(m){if(c[m])return c[m].exports;var S=c[m]={i:m,l:!1,exports:{}};return s[m].call(S.exports,S,S.exports,E),S.l=!0,S.exports}return E.m=s,E.c=c,E.d=function(m,S,d){E.o(m,S)||Object.defineProperty(m,S,{enumerable:!0,get:d})},E.r=function(m){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(m,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(m,"__esModule",{value:!0})},E.t=function(m,S){if(1&S&&(m=E(m)),8&S||4&S&&typeof m=="object"&&m&&m.__esModule)return m;var d=Object.create(null);if(E.r(d),Object.defineProperty(d,"default",{enumerable:!0,value:m}),2&S&&typeof m!="string")for(var M in m)E.d(d,M,function(C){return m[C]}.bind(null,M));return d},E.n=function(m){var S=m&&m.__esModule?function(){return m.default}:function(){return m};return E.d(S,"a",S),S},E.o=function(m,S){return Object.prototype.hasOwnProperty.call(m,S)},E.p="",E(E.s=20)}([function(s,c){s.exports=h},function(s,c,E){E.d(c,"a",function(){return d}),E.d(c,"b",function(){return M});var m=E(0),S=E(2),d=function(){function C(){}return C.Get=function(I,b,p){if(!b||p==null||!b[p])throw new Error(I+": Failed to find index ("+p+")");return b[p]},C.Assign=function(I){if(I)for(var b=0;b<I.length;b++)I[b].index=b},C}(),M=function(){function C(I){this._completePromises=new Array,this._forAssetContainer=!1,this._babylonLights=[],this._disableInstancedMesh=0,this._disposed=!1,this._state=null,this._extensions=new Array,this._defaultBabylonMaterialData={},this._parent=I}return C.RegisterExtension=function(I,b){C.UnregisterExtension(I)&&m.Logger.Warn("Extension with the name '"+I+"' already exists"),C._RegisteredExtensions[I]={factory:b}},C.UnregisterExtension=function(I){return!!C._RegisteredExtensions[I]&&(delete C._RegisteredExtensions[I],!0)},Object.defineProperty(C.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"gltf",{get:function(){return this._gltf},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"bin",{get:function(){return this._bin},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"parent",{get:function(){return this._parent},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"babylonScene",{get:function(){return this._babylonScene},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"rootBabylonMesh",{get:function(){return this._rootBabylonMesh},enumerable:!1,configurable:!0}),C.prototype.dispose=function(){if(!this._disposed){for(var I in this._disposed=!0,this._completePromises.length=0,this._extensions){var b=this._extensions[I];b.dispose&&b.dispose(),delete this._extensions[I]}this._gltf=null,this._babylonScene=null,this._rootBabylonMesh=null,this._parent.dispose()}},C.prototype.importMeshAsync=function(I,b,p,x,P,A,T){var _=this;return Promise.resolve().then(function(){_._babylonScene=b,_._rootUrl=P,_._fileName=T||"scene",_._forAssetContainer=p,_._loadData(x);var g=null;if(I){var O={};if(_._gltf.nodes)for(var R=0,N=_._gltf.nodes;R<N.length;R++){var V=N[R];V.name&&(O[V.name]=V.index)}g=(I instanceof Array?I:[I]).map(function(U){var L=O[U];if(L===void 0)throw new Error("Failed to find node '"+U+"'");return L})}return _._loadAsync(g,function(){return{meshes:_._getMeshes(),particleSystems:[],skeletons:_._getSkeletons(),animationGroups:_._getAnimationGroups(),lights:_._babylonLights,transformNodes:_._getTransformNodes(),geometries:_._getGeometries()}})})},C.prototype.loadAsync=function(I,b,p,x,P){var A=this;return Promise.resolve().then(function(){return A._babylonScene=I,A._rootUrl=p,A._fileName=P||"scene",A._loadData(b),A._loadAsync(null,function(){})})},C.prototype._loadAsync=function(I,b){var p=this;return Promise.resolve().then(function(){p._uniqueRootUrl=p._rootUrl.indexOf("file:")===-1&&p._fileName?p._rootUrl:""+p._rootUrl+Date.now()+"/",p._loadExtensions(),p._checkExtensions();var x=S.GLTFLoaderState[S.GLTFLoaderState.LOADING]+" => "+S.GLTFLoaderState[S.GLTFLoaderState.READY],P=S.GLTFLoaderState[S.GLTFLoaderState.LOADING]+" => "+S.GLTFLoaderState[S.GLTFLoaderState.COMPLETE];p._parent._startPerformanceCounter(x),p._parent._startPerformanceCounter(P),p._setState(S.GLTFLoaderState.LOADING),p._extensionsOnLoading();var A=new Array,T=p._babylonScene.blockMaterialDirtyMechanism;if(p._babylonScene.blockMaterialDirtyMechanism=!0,I)A.push(p.loadSceneAsync("/nodes",{nodes:I,index:-1}));else if(p._gltf.scene!=null||p._gltf.scenes&&p._gltf.scenes[0]){var _=d.Get("/scene",p._gltf.scenes,p._gltf.scene||0);A.push(p.loadSceneAsync("/scenes/"+_.index,_))}if(p.parent.loadAllMaterials&&p._gltf.materials)for(var g=0;g<p._gltf.materials.length;++g){var O=p._gltf.materials[g],R="/materials/"+g,N=m.Material.TriangleFillMode;A.push(p._loadMaterialAsync(R,O,null,N,function(U){}))}p._babylonScene.blockMaterialDirtyMechanism=T,p._parent.compileMaterials&&A.push(p._compileMaterialsAsync()),p._parent.compileShadowGenerators&&A.push(p._compileShadowGeneratorsAsync());var V=Promise.all(A).then(function(){return p._rootBabylonMesh&&p._rootBabylonMesh.setEnabled(!0),p._extensionsOnReady(),p._setState(S.GLTFLoaderState.READY),p._startAnimations(),b()});return V.then(function(){p._parent._endPerformanceCounter(x),m.Tools.SetImmediate(function(){p._disposed||Promise.all(p._completePromises).then(function(){p._parent._endPerformanceCounter(P),p._setState(S.GLTFLoaderState.COMPLETE),p._parent.onCompleteObservable.notifyObservers(void 0),p._parent.onCompleteObservable.clear(),p.dispose()},function(U){p._parent.onErrorObservable.notifyObservers(U),p._parent.onErrorObservable.clear(),p.dispose()})})}),V}).catch(function(x){throw p._disposed||(p._parent.onErrorObservable.notifyObservers(x),p._parent.onErrorObservable.clear(),p.dispose()),x})},C.prototype._loadData=function(I){if(this._gltf=I.json,this._setupData(),I.bin){var b=this._gltf.buffers;if(b&&b[0]&&!b[0].uri){var p=b[0];(p.byteLength<I.bin.byteLength-3||p.byteLength>I.bin.byteLength)&&m.Logger.Warn("Binary buffer length ("+p.byteLength+") from JSON does not match chunk length ("+I.bin.byteLength+")"),this._bin=I.bin}else m.Logger.Warn("Unexpected BIN chunk")}},C.prototype._setupData=function(){if(d.Assign(this._gltf.accessors),d.Assign(this._gltf.animations),d.Assign(this._gltf.buffers),d.Assign(this._gltf.bufferViews),d.Assign(this._gltf.cameras),d.Assign(this._gltf.images),d.Assign(this._gltf.materials),d.Assign(this._gltf.meshes),d.Assign(this._gltf.nodes),d.Assign(this._gltf.samplers),d.Assign(this._gltf.scenes),d.Assign(this._gltf.skins),d.Assign(this._gltf.textures),this._gltf.nodes){for(var I={},b=0,p=this._gltf.nodes;b<p.length;b++)if((g=p[b]).children)for(var x=0,P=g.children;x<P.length;x++)I[P[x]]=g.index;for(var A=this._createRootNode(),T=0,_=this._gltf.nodes;T<_.length;T++){var g,O=I[(g=_[T]).index];g.parent=O===void 0?A:this._gltf.nodes[O]}}},C.prototype._loadExtensions=function(){for(var I in C._RegisteredExtensions){var b=C._RegisteredExtensions[I].factory(this);b.name!==I&&m.Logger.Warn("The name of the glTF loader extension instance does not match the registered name: "+b.name+" !== "+I),this._extensions.push(b),this._parent.onExtensionLoadedObservable.notifyObservers(b)}this._extensions.sort(function(p,x){return(p.order||Number.MAX_VALUE)-(x.order||Number.MAX_VALUE)}),this._parent.onExtensionLoadedObservable.clear()},C.prototype._checkExtensions=function(){if(this._gltf.extensionsRequired)for(var I=function(P){if(!b._extensions.some(function(A){return A.name===P&&A.enabled}))throw new Error("Require extension "+P+" is not available")},b=this,p=0,x=this._gltf.extensionsRequired;p<x.length;p++)I(x[p])},C.prototype._setState=function(I){this._state=I,this.log(S.GLTFLoaderState[this._state])},C.prototype._createRootNode=function(){this._babylonScene._blockEntityCollection=this._forAssetContainer,this._rootBabylonMesh=new m.Mesh("__root__",this._babylonScene),this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.setEnabled(!1);var I={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case S.GLTFLoaderCoordinateSystemMode.AUTO:this._babylonScene.useRightHandedSystem||(I.rotation=[0,1,0,0],I.scale=[1,1,-1],C._LoadTransform(I,this._rootBabylonMesh));break;case S.GLTFLoaderCoordinateSystemMode.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error("Invalid coordinate system mode ("+this._parent.coordinateSystemMode+")")}return this._parent.onMeshLoadedObservable.notifyObservers(this._rootBabylonMesh),I},C.prototype.loadSceneAsync=function(I,b){var p=this,x=this._extensionsLoadSceneAsync(I,b);if(x)return x;var P=new Array;if(this.logOpen(I+" "+(b.name||"")),b.nodes)for(var A=0,T=b.nodes;A<T.length;A++){var _=T[A],g=d.Get(I+"/nodes/"+_,this._gltf.nodes,_);P.push(this.loadNodeAsync("/nodes/"+g.index,g,function(U){U.parent=p._rootBabylonMesh}))}if(this._gltf.nodes){for(var O=0,R=this._gltf.nodes;O<R.length;O++)if((g=R[O])._babylonTransformNode&&g._babylonBones)for(var N=0,V=g._babylonBones;N<V.length;N++)V[N].linkTransformNode(g._babylonTransformNode)}return P.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(P).then(function(){})},C.prototype._forEachPrimitive=function(I,b){if(I._primitiveBabylonMeshes)for(var p=0,x=I._primitiveBabylonMeshes;p<x.length;p++)b(x[p])},C.prototype._getGeometries=function(){var I=new Array,b=this._gltf.nodes;if(b)for(var p=0,x=b;p<x.length;p++){var P=x[p];this._forEachPrimitive(P,function(A){var T=A.geometry;T&&I.indexOf(T)===-1&&I.push(T)})}return I},C.prototype._getMeshes=function(){var I=new Array;I.push(this._rootBabylonMesh);var b=this._gltf.nodes;if(b)for(var p=0,x=b;p<x.length;p++){var P=x[p];this._forEachPrimitive(P,function(A){I.push(A)})}return I},C.prototype._getTransformNodes=function(){var I=new Array,b=this._gltf.nodes;if(b)for(var p=0,x=b;p<x.length;p++){var P=x[p];P._babylonTransformNode&&P._babylonTransformNode.getClassName()==="TransformNode"&&I.push(P._babylonTransformNode)}return I},C.prototype._getSkeletons=function(){var I=new Array,b=this._gltf.skins;if(b)for(var p=0,x=b;p<x.length;p++){var P=x[p];P._data&&I.push(P._data.babylonSkeleton)}return I},C.prototype._getAnimationGroups=function(){var I=new Array,b=this._gltf.animations;if(b)for(var p=0,x=b;p<x.length;p++){var P=x[p];P._babylonAnimationGroup&&I.push(P._babylonAnimationGroup)}return I},C.prototype._startAnimations=function(){switch(this._parent.animationStartMode){case S.GLTFLoaderAnimationStartMode.NONE:break;case S.GLTFLoaderAnimationStartMode.FIRST:(I=this._getAnimationGroups()).length!==0&&I[0].start(!0);break;case S.GLTFLoaderAnimationStartMode.ALL:for(var I,b=0,p=I=this._getAnimationGroups();b<p.length;b++)p[b].start(!0);break;default:return void m.Logger.Error("Invalid animation start mode ("+this._parent.animationStartMode+")")}},C.prototype.loadNodeAsync=function(I,b,p){var x=this;p===void 0&&(p=function(){});var P=this._extensionsLoadNodeAsync(I,b,p);if(P)return P;if(b._babylonTransformNode)throw new Error(I+": Invalid recursive node hierarchy");var A=new Array;this.logOpen(I+" "+(b.name||""));var T=function(O){if(C.AddPointerMetadata(O,I),C._LoadTransform(b,O),b.camera!=null){var R=d.Get(I+"/camera",x._gltf.cameras,b.camera);A.push(x.loadCameraAsync("/cameras/"+R.index,R,function(j){j.parent=O}))}if(b.children)for(var N=0,V=b.children;N<V.length;N++){var U=V[N],L=d.Get(I+"/children/"+U,x._gltf.nodes,U);A.push(x.loadNodeAsync("/nodes/"+L.index,L,function(j){j.parent=O}))}p(O)};if(b.mesh==null){var _=b.name||"node"+b.index;this._babylonScene._blockEntityCollection=this._forAssetContainer,b._babylonTransformNode=new m.TransformNode(_,this._babylonScene),this._babylonScene._blockEntityCollection=!1,T(b._babylonTransformNode)}else{var g=d.Get(I+"/mesh",this._gltf.meshes,b.mesh);A.push(this._loadMeshAsync("/meshes/"+g.index,b,g,T))}return this.logClose(),Promise.all(A).then(function(){return x._forEachPrimitive(b,function(O){O.geometry&&O.geometry.useBoundingInfoFromGeometry?O._updateBoundingInfo():O.refreshBoundingInfo(!0)}),b._babylonTransformNode})},C.prototype._loadMeshAsync=function(I,b,p,x){var P=p.primitives;if(!P||!P.length)throw new Error(I+": Primitives are missing");P[0].index==null&&d.Assign(P);var A=new Array;this.logOpen(I+" "+(p.name||""));var T=b.name||"node"+b.index;if(P.length===1){var _=p.primitives[0];A.push(this._loadMeshPrimitiveAsync(I+"/primitives/"+_.index,T,b,p,_,function(N){b._babylonTransformNode=N,b._primitiveBabylonMeshes=[N]}))}else{this._babylonScene._blockEntityCollection=this._forAssetContainer,b._babylonTransformNode=new m.TransformNode(T,this._babylonScene),this._babylonScene._blockEntityCollection=!1,b._primitiveBabylonMeshes=[];for(var g=0,O=P;g<O.length;g++)_=O[g],A.push(this._loadMeshPrimitiveAsync(I+"/primitives/"+_.index,T+"_primitive"+_.index,b,p,_,function(N){N.parent=b._babylonTransformNode,b._primitiveBabylonMeshes.push(N)}))}if(b.skin!=null){var R=d.Get(I+"/skin",this._gltf.skins,b.skin);A.push(this._loadSkinAsync("/skins/"+R.index,b,R))}return x(b._babylonTransformNode),this.logClose(),Promise.all(A).then(function(){return b._babylonTransformNode})},C.prototype._loadMeshPrimitiveAsync=function(I,b,p,x,P,A){var T=this,_=this._extensionsLoadMeshPrimitiveAsync(I,b,p,x,P,A);if(_)return _;this.logOpen(""+I);var g,O,R=this._disableInstancedMesh===0&&this._parent.createInstances&&p.skin==null&&!x.primitives[0].targets;if(R&&P._instanceData)g=P._instanceData.babylonSourceMesh.createInstance(b),O=P._instanceData.promise;else{var N=new Array;this._babylonScene._blockEntityCollection=this._forAssetContainer;var V=new m.Mesh(b,this._babylonScene);this._babylonScene._blockEntityCollection=!1,V.overrideMaterialSideOrientation=this._babylonScene.useRightHandedSystem?m.Material.CounterClockWiseSideOrientation:m.Material.ClockWiseSideOrientation,this._createMorphTargets(I,p,x,P,V),N.push(this._loadVertexDataAsync(I,P,V).then(function(Y){return T._loadMorphTargetsAsync(I,P,V,Y).then(function(){T._babylonScene._blockEntityCollection=T._forAssetContainer,Y.applyToMesh(V),T._babylonScene._blockEntityCollection=!1})}));var U=C._GetDrawMode(I,P.mode);if(P.material==null){var L=this._defaultBabylonMaterialData[U];L||(L=this._createDefaultMaterial("__GLTFLoader._default",U),this._parent.onMaterialLoadedObservable.notifyObservers(L),this._defaultBabylonMaterialData[U]=L),V.material=L}else{var j=d.Get(I+"/material",this._gltf.materials,P.material);N.push(this._loadMaterialAsync("/materials/"+j.index,j,V,U,function(Y){V.material=Y}))}O=Promise.all(N),R&&(P._instanceData={babylonSourceMesh:V,promise:O}),g=V}return C.AddPointerMetadata(g,I),this._parent.onMeshLoadedObservable.notifyObservers(g),A(g),this.logClose(),O.then(function(){return g})},C.prototype._loadVertexDataAsync=function(I,b,p){var x=this,P=this._extensionsLoadVertexDataAsync(I,b,p);if(P)return P;var A=b.attributes;if(!A)throw new Error(I+": Attributes are missing");var T=new Array,_=new m.Geometry(p.name,this._babylonScene);if(b.indices==null)p.isUnIndexed=!0;else{var g=d.Get(I+"/indices",this._gltf.accessors,b.indices);T.push(this._loadIndicesAccessorAsync("/accessors/"+g.index,g).then(function(R){_.setIndices(R)}))}var O=function(R,N,V){if(A[R]!=null){p._delayInfo=p._delayInfo||[],p._delayInfo.indexOf(N)===-1&&p._delayInfo.push(N);var U=d.Get(I+"/attributes/"+R,x._gltf.accessors,A[R]);T.push(x._loadVertexAccessorAsync("/accessors/"+U.index,U,N).then(function(L){if(L.getKind()===m.VertexBuffer.PositionKind&&!x.parent.alwaysComputeBoundingBox&&!p.skeleton){var j=U.min,Y=U.max;if(j!==void 0&&Y!==void 0){var W=m.TmpVectors.Vector3[0],re=m.TmpVectors.Vector3[1];W.copyFromFloats.apply(W,j),re.copyFromFloats.apply(re,Y),_._boundingInfo=new m.BoundingInfo(W,re),_.useBoundingInfoFromGeometry=!0}}_.setVerticesBuffer(L,U.count)})),N==m.VertexBuffer.MatricesIndicesExtraKind&&(p.numBoneInfluencers=8),V&&V(U)}};return O("POSITION",m.VertexBuffer.PositionKind),O("NORMAL",m.VertexBuffer.NormalKind),O("TANGENT",m.VertexBuffer.TangentKind),O("TEXCOORD_0",m.VertexBuffer.UVKind),O("TEXCOORD_1",m.VertexBuffer.UV2Kind),O("JOINTS_0",m.VertexBuffer.MatricesIndicesKind),O("WEIGHTS_0",m.VertexBuffer.MatricesWeightsKind),O("JOINTS_1",m.VertexBuffer.MatricesIndicesExtraKind),O("WEIGHTS_1",m.VertexBuffer.MatricesWeightsExtraKind),O("COLOR_0",m.VertexBuffer.ColorKind,function(R){R.type==="VEC4"&&(p.hasVertexAlpha=!0)}),Promise.all(T).then(function(){return _})},C.prototype._createMorphTargets=function(I,b,p,x,P){if(x.targets){if(b._numMorphTargets==null)b._numMorphTargets=x.targets.length;else if(x.targets.length!==b._numMorphTargets)throw new Error(I+": Primitives do not have the same number of targets");var A=p.extras?p.extras.targetNames:null;P.morphTargetManager=new m.MorphTargetManager(P.getScene());for(var T=0;T<x.targets.length;T++){var _=b.weights?b.weights[T]:p.weights?p.weights[T]:0,g=A?A[T]:"morphTarget"+T;P.morphTargetManager.addTarget(new m.MorphTarget(g,_,P.getScene()))}}},C.prototype._loadMorphTargetsAsync=function(I,b,p,x){if(!b.targets)return Promise.resolve();for(var P=new Array,A=p.morphTargetManager,T=0;T<A.numTargets;T++){var _=A.getTarget(T);P.push(this._loadMorphTargetVertexDataAsync(I+"/targets/"+T,x,b.targets[T],_))}return Promise.all(P).then(function(){})},C.prototype._loadMorphTargetVertexDataAsync=function(I,b,p,x){var P=this,A=new Array,T=function(_,g,O){if(p[_]!=null){var R=b.getVertexBuffer(g);if(R){var N=d.Get(I+"/"+_,P._gltf.accessors,p[_]);A.push(P._loadFloatAccessorAsync("/accessors/"+N.index,N).then(function(V){O(R,V)}))}}};return T("POSITION",m.VertexBuffer.PositionKind,function(_,g){var O=new Float32Array(g.length);_.forEach(g.length,function(R,N){O[N]=g[N]+R}),x.setPositions(O)}),T("NORMAL",m.VertexBuffer.NormalKind,function(_,g){var O=new Float32Array(g.length);_.forEach(O.length,function(R,N){O[N]=g[N]+R}),x.setNormals(O)}),T("TANGENT",m.VertexBuffer.TangentKind,function(_,g){var O=new Float32Array(g.length/3*4),R=0;_.forEach(g.length/3*4,function(N,V){(V+1)%4!=0&&(O[R]=g[R]+N,R++)}),x.setTangents(O)}),Promise.all(A).then(function(){})},C._LoadTransform=function(I,b){if(I.skin==null){var p=m.Vector3.Zero(),x=m.Quaternion.Identity(),P=m.Vector3.One();I.matrix?m.Matrix.FromArray(I.matrix).decompose(P,x,p):(I.translation&&(p=m.Vector3.FromArray(I.translation)),I.rotation&&(x=m.Quaternion.FromArray(I.rotation)),I.scale&&(P=m.Vector3.FromArray(I.scale))),b.position=p,b.rotationQuaternion=x,b.scaling=P}},C.prototype._loadSkinAsync=function(I,b,p){var x=this,P=this._extensionsLoadSkinAsync(I,b,p);if(P)return P;var A=function(O){x._forEachPrimitive(b,function(R){R.skeleton=O})};if(p._data)return A(p._data.babylonSkeleton),p._data.promise;var T="skeleton"+p.index;this._babylonScene._blockEntityCollection=this._forAssetContainer;var _=new m.Skeleton(p.name||T,T,this._babylonScene);this._babylonScene._blockEntityCollection=!1,_.overrideMesh=this._rootBabylonMesh,this._loadBones(I,p,_),A(_);var g=this._loadSkinInverseBindMatricesDataAsync(I,p).then(function(O){x._updateBoneMatrices(_,O)});return p._data={babylonSkeleton:_,promise:g},g},C.prototype._loadBones=function(I,b,p){for(var x={},P=0,A=b.joints;P<A.length;P++){var T=A[P],_=d.Get(I+"/joints/"+T,this._gltf.nodes,T);this._loadBone(_,b,p,x)}},C.prototype._loadBone=function(I,b,p,x){var P=x[I.index];if(P)return P;var A=null;I.parent&&I.parent._babylonTransformNode!==this._rootBabylonMesh&&(A=this._loadBone(I.parent,b,p,x));var T=b.joints.indexOf(I.index);return P=new m.Bone(I.name||"joint"+I.index,p,A,this._getNodeMatrix(I),null,null,T),x[I.index]=P,I._babylonBones=I._babylonBones||[],I._babylonBones.push(P),P},C.prototype._loadSkinInverseBindMatricesDataAsync=function(I,b){if(b.inverseBindMatrices==null)return Promise.resolve(null);var p=d.Get(I+"/inverseBindMatrices",this._gltf.accessors,b.inverseBindMatrices);return this._loadFloatAccessorAsync("/accessors/"+p.index,p)},C.prototype._updateBoneMatrices=function(I,b){for(var p=0,x=I.bones;p<x.length;p++){var P=x[p],A=m.Matrix.Identity(),T=P._index;b&&T!==-1&&(m.Matrix.FromArrayToRef(b,16*T,A),A.invertToRef(A));var _=P.getParent();_&&A.multiplyToRef(_.getInvertedAbsoluteTransform(),A),P.setBindPose(A),P.updateMatrix(A,!1,!1),P._updateDifferenceMatrix(void 0,!1)}},C.prototype._getNodeMatrix=function(I){return I.matrix?m.Matrix.FromArray(I.matrix):m.Matrix.Compose(I.scale?m.Vector3.FromArray(I.scale):m.Vector3.One(),I.rotation?m.Quaternion.FromArray(I.rotation):m.Quaternion.Identity(),I.translation?m.Vector3.FromArray(I.translation):m.Vector3.Zero())},C.prototype.loadCameraAsync=function(I,b,p){p===void 0&&(p=function(){});var x=this._extensionsLoadCameraAsync(I,b,p);if(x)return x;var P=new Array;this.logOpen(I+" "+(b.name||"")),this._babylonScene._blockEntityCollection=this._forAssetContainer;var A=new m.FreeCamera(b.name||"camera"+b.index,m.Vector3.Zero(),this._babylonScene,!1);switch(this._babylonScene._blockEntityCollection=!1,A.ignoreParentScaling=!0,A.rotation=new m.Vector3(0,Math.PI,0),b.type){case"perspective":var T=b.perspective;if(!T)throw new Error(I+": Camera perspective properties are missing");A.fov=T.yfov,A.minZ=T.znear,A.maxZ=T.zfar||Number.MAX_VALUE;break;case"orthographic":if(!b.orthographic)throw new Error(I+": Camera orthographic properties are missing");A.mode=m.Camera.ORTHOGRAPHIC_CAMERA,A.orthoLeft=-b.orthographic.xmag,A.orthoRight=b.orthographic.xmag,A.orthoBottom=-b.orthographic.ymag,A.orthoTop=b.orthographic.ymag,A.minZ=b.orthographic.znear,A.maxZ=b.orthographic.zfar;break;default:throw new Error(I+": Invalid camera type ("+b.type+")")}return C.AddPointerMetadata(A,I),this._parent.onCameraLoadedObservable.notifyObservers(A),p(A),this.logClose(),Promise.all(P).then(function(){return A})},C.prototype._loadAnimationsAsync=function(){var I=this._gltf.animations;if(!I)return Promise.resolve();for(var b=new Array,p=0;p<I.length;p++){var x=I[p];b.push(this.loadAnimationAsync("/animations/"+x.index,x))}return Promise.all(b).then(function(){})},C.prototype.loadAnimationAsync=function(I,b){var p=this._extensionsLoadAnimationAsync(I,b);if(p)return p;this._babylonScene._blockEntityCollection=this._forAssetContainer;var x=new m.AnimationGroup(b.name||"animation"+b.index,this._babylonScene);this._babylonScene._blockEntityCollection=!1,b._babylonAnimationGroup=x;var P=new Array;d.Assign(b.channels),d.Assign(b.samplers);for(var A=0,T=b.channels;A<T.length;A++){var _=T[A];P.push(this._loadAnimationChannelAsync(I+"/channels/"+_.index,I,b,_,x))}return Promise.all(P).then(function(){return x.normalize(0),x})},C.prototype._loadAnimationChannelAsync=function(I,b,p,x,P,A){var T=this;if(A===void 0&&(A=null),x.target.node==null)return Promise.resolve();var _=d.Get(I+"/target/node",this._gltf.nodes,x.target.node);if(x.target.path==="weights"&&!_._numMorphTargets||x.target.path!=="weights"&&!_._babylonTransformNode)return Promise.resolve();var g=d.Get(I+"/sampler",p.samplers,x.sampler);return this._loadAnimationSamplerAsync(b+"/samplers/"+x.sampler,g).then(function(O){var R,N;switch(x.target.path){case"translation":R="position",N=m.Animation.ANIMATIONTYPE_VECTOR3;break;case"rotation":R="rotationQuaternion",N=m.Animation.ANIMATIONTYPE_QUATERNION;break;case"scale":R="scaling",N=m.Animation.ANIMATIONTYPE_VECTOR3;break;case"weights":R="influence",N=m.Animation.ANIMATIONTYPE_FLOAT;break;default:throw new Error(I+"/target/path: Invalid value ("+x.target.path+")")}var V,U,L=0;switch(R){case"position":V=function(){var _e=m.Vector3.FromArray(O.output,L);return L+=3,_e};break;case"rotationQuaternion":V=function(){var _e=m.Quaternion.FromArray(O.output,L);return L+=4,_e};break;case"scaling":V=function(){var _e=m.Vector3.FromArray(O.output,L);return L+=3,_e};break;case"influence":V=function(){for(var _e=new Array(_._numMorphTargets),ce=0;ce<_._numMorphTargets;ce++)_e[ce]=O.output[L++];return _e}}switch(O.interpolation){case"STEP":U=function(_e){return{frame:O.input[_e],value:V(),interpolation:m.AnimationKeyInterpolation.STEP}};break;case"LINEAR":U=function(_e){return{frame:O.input[_e],value:V()}};break;case"CUBICSPLINE":U=function(_e){return{frame:O.input[_e],inTangent:V(),value:V(),outTangent:V()}}}for(var j=new Array(O.input.length),Y=0;Y<O.input.length;Y++)j[Y]=U(Y);if(R==="influence")for(var W=function(_e){var ce=P.name+"_channel"+P.targetedAnimations.length,ie=new m.Animation(ce,R,1,N);ie.setKeys(j.map(function(Z){return{frame:Z.frame,inTangent:Z.inTangent?Z.inTangent[_e]:void 0,value:Z.value[_e],outTangent:Z.outTangent?Z.outTangent[_e]:void 0}})),T._forEachPrimitive(_,function(Z){var te=Z.morphTargetManager.getTarget(_e),B=ie.clone();te.animations.push(B),P.addTargetedAnimation(B,te)})},re=0;re<_._numMorphTargets;re++)W(re);else{var ne=P.name+"_channel"+P.targetedAnimations.length,ge=new m.Animation(ne,R,1,N);ge.setKeys(j),A!=null&&A.animations!=null?(A.animations.push(ge),P.addTargetedAnimation(ge,A)):(_._babylonTransformNode.animations.push(ge),P.addTargetedAnimation(ge,_._babylonTransformNode))}})},C.prototype._loadAnimationSamplerAsync=function(I,b){if(b._data)return b._data;var p=b.interpolation||"LINEAR";switch(p){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(I+"/interpolation: Invalid value ("+b.interpolation+")")}var x=d.Get(I+"/input",this._gltf.accessors,b.input),P=d.Get(I+"/output",this._gltf.accessors,b.output);return b._data=Promise.all([this._loadFloatAccessorAsync("/accessors/"+x.index,x),this._loadFloatAccessorAsync("/accessors/"+P.index,P)]).then(function(A){var T=A[0],_=A[1];return{input:T,interpolation:p,output:_}}),b._data},C.prototype._loadBufferAsync=function(I,b,p,x){var P=this._extensionsLoadBufferAsync(I,b,p,x);if(P)return P;if(!b._data)if(b.uri)b._data=this.loadUriAsync(I+"/uri",b,b.uri);else{if(!this._bin)throw new Error(I+": Uri is missing or the binary glTF is missing its binary chunk");b._data=this._bin.readAsync(0,b.byteLength)}return b._data.then(function(A){try{return new Uint8Array(A.buffer,A.byteOffset+p,x)}catch(T){throw new Error(I+": "+T.message)}})},C.prototype.loadBufferViewAsync=function(I,b){var p=this._extensionsLoadBufferViewAsync(I,b);if(p)return p;if(b._data)return b._data;var x=d.Get(I+"/buffer",this._gltf.buffers,b.buffer);return b._data=this._loadBufferAsync("/buffers/"+x.index,x,b.byteOffset||0,b.byteLength),b._data},C.prototype._loadAccessorAsync=function(I,b,p){var x=this;if(b._data)return b._data;var P=C._GetNumComponents(I,b.type),A=P*m.VertexBuffer.GetTypeByteLength(b.componentType),T=P*b.count;if(b.bufferView==null)b._data=Promise.resolve(new p(T));else{var _=d.Get(I+"/bufferView",this._gltf.bufferViews,b.bufferView);b._data=this.loadBufferViewAsync("/bufferViews/"+_.index,_).then(function(O){if(b.componentType!==5126||b.normalized||_.byteStride&&_.byteStride!==A){var R=new p(T);return m.VertexBuffer.ForEach(O,b.byteOffset||0,_.byteStride||A,P,b.componentType,R.length,b.normalized||!1,function(N,V){R[V]=N}),R}return C._GetTypedArray(I,b.componentType,O,b.byteOffset,T)})}if(b.sparse){var g=b.sparse;b._data=b._data.then(function(O){var R=O,N=d.Get(I+"/sparse/indices/bufferView",x._gltf.bufferViews,g.indices.bufferView),V=d.Get(I+"/sparse/values/bufferView",x._gltf.bufferViews,g.values.bufferView);return Promise.all([x.loadBufferViewAsync("/bufferViews/"+N.index,N),x.loadBufferViewAsync("/bufferViews/"+V.index,V)]).then(function(U){var L,j=U[0],Y=U[1],W=C._GetTypedArray(I+"/sparse/indices",g.indices.componentType,j,g.indices.byteOffset,g.count),re=P*g.count;if(b.componentType!==5126||b.normalized){var ne=C._GetTypedArray(I+"/sparse/values",b.componentType,Y,g.values.byteOffset,re);L=new p(re),m.VertexBuffer.ForEach(ne,0,A,P,b.componentType,L.length,b.normalized||!1,function(Z,te){L[te]=Z})}else L=C._GetTypedArray(I+"/sparse/values",b.componentType,Y,g.values.byteOffset,re);for(var ge=0,_e=0;_e<W.length;_e++)for(var ce=W[_e]*P,ie=0;ie<P;ie++)R[ce++]=L[ge++];return R})})}return b._data},C.prototype._loadFloatAccessorAsync=function(I,b){return this._loadAccessorAsync(I,b,Float32Array)},C.prototype._loadIndicesAccessorAsync=function(I,b){if(b.type!=="SCALAR")throw new Error(I+"/type: Invalid value "+b.type);if(b.componentType!==5121&&b.componentType!==5123&&b.componentType!==5125)throw new Error(I+"/componentType: Invalid value "+b.componentType);if(b._data)return b._data;if(b.sparse){var p=C._GetTypedArrayConstructor(I+"/componentType",b.componentType);b._data=this._loadAccessorAsync(I,b,p)}else{var x=d.Get(I+"/bufferView",this._gltf.bufferViews,b.bufferView);b._data=this.loadBufferViewAsync("/bufferViews/"+x.index,x).then(function(P){return C._GetTypedArray(I,b.componentType,P,b.byteOffset,b.count)})}return b._data},C.prototype._loadVertexBufferViewAsync=function(I,b){var p=this;return I._babylonBuffer||(I._babylonBuffer=this.loadBufferViewAsync("/bufferViews/"+I.index,I).then(function(x){return new m.Buffer(p._babylonScene.getEngine(),x,!1)})),I._babylonBuffer},C.prototype._loadVertexAccessorAsync=function(I,b,p){var x=this;if(b._babylonVertexBuffer)return b._babylonVertexBuffer;if(b.sparse)b._babylonVertexBuffer=this._loadFloatAccessorAsync("/accessors/"+b.index,b).then(function(A){return new m.VertexBuffer(x._babylonScene.getEngine(),A,p,!1)});else if(b.byteOffset&&b.byteOffset%m.VertexBuffer.GetTypeByteLength(b.componentType)!=0)m.Logger.Warn("Accessor byte offset is not a multiple of component type byte length"),b._babylonVertexBuffer=this._loadFloatAccessorAsync("/accessors/"+b.index,b).then(function(A){return new m.VertexBuffer(x._babylonScene.getEngine(),A,p,!1)});else if(p===m.VertexBuffer.MatricesIndicesKind||p===m.VertexBuffer.MatricesIndicesExtraKind)b._babylonVertexBuffer=this._loadFloatAccessorAsync("/accessors/"+b.index,b).then(function(A){return new m.VertexBuffer(x._babylonScene.getEngine(),A,p,!1)});else{var P=d.Get(I+"/bufferView",this._gltf.bufferViews,b.bufferView);b._babylonVertexBuffer=this._loadVertexBufferViewAsync(P,p).then(function(A){var T=C._GetNumComponents(I,b.type);return new m.VertexBuffer(x._babylonScene.getEngine(),A,p,!1,!1,P.byteStride,!1,b.byteOffset,T,b.componentType,b.normalized,!0,1,!0)})}return b._babylonVertexBuffer},C.prototype._loadMaterialMetallicRoughnessPropertiesAsync=function(I,b,p){if(!(p instanceof m.PBRMaterial))throw new Error(I+": Material type not supported");var x=new Array;return b&&(b.baseColorFactor?(p.albedoColor=m.Color3.FromArray(b.baseColorFactor),p.alpha=b.baseColorFactor[3]):p.albedoColor=m.Color3.White(),p.metallic=b.metallicFactor==null?1:b.metallicFactor,p.roughness=b.roughnessFactor==null?1:b.roughnessFactor,b.baseColorTexture&&x.push(this.loadTextureInfoAsync(I+"/baseColorTexture",b.baseColorTexture,function(P){P.name=p.name+" (Base Color)",p.albedoTexture=P})),b.metallicRoughnessTexture&&(b.metallicRoughnessTexture.nonColorData=!0,x.push(this.loadTextureInfoAsync(I+"/metallicRoughnessTexture",b.metallicRoughnessTexture,function(P){P.name=p.name+" (Metallic Roughness)",p.metallicTexture=P})),p.useMetallnessFromMetallicTextureBlue=!0,p.useRoughnessFromMetallicTextureGreen=!0,p.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(x).then(function(){})},C.prototype._loadMaterialAsync=function(I,b,p,x,P){P===void 0&&(P=function(){});var A=this._extensionsLoadMaterialAsync(I,b,p,x,P);if(A)return A;b._data=b._data||{};var T=b._data[x];if(!T){this.logOpen(I+" "+(b.name||""));var _=this.createMaterial(I,b,x);T={babylonMaterial:_,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(I,b,_)},b._data[x]=T,C.AddPointerMetadata(_,I),this._parent.onMaterialLoadedObservable.notifyObservers(_),this.logClose()}return p&&(T.babylonMeshes.push(p),p.onDisposeObservable.addOnce(function(){var g=T.babylonMeshes.indexOf(p);g!==-1&&T.babylonMeshes.splice(g,1)})),P(T.babylonMaterial),T.promise.then(function(){return T.babylonMaterial})},C.prototype._createDefaultMaterial=function(I,b){this._babylonScene._blockEntityCollection=this._forAssetContainer;var p=new m.PBRMaterial(I,this._babylonScene);return this._babylonScene._blockEntityCollection=!1,p.fillMode=b,p.enableSpecularAntiAliasing=!0,p.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,p.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,p.transparencyMode=m.PBRMaterial.PBRMATERIAL_OPAQUE,p.metallic=1,p.roughness=1,p},C.prototype.createMaterial=function(I,b,p){var x=this._extensionsCreateMaterial(I,b,p);if(x)return x;var P=b.name||"material"+b.index;return this._createDefaultMaterial(P,p)},C.prototype.loadMaterialPropertiesAsync=function(I,b,p){var x=this._extensionsLoadMaterialPropertiesAsync(I,b,p);if(x)return x;var P=new Array;return P.push(this.loadMaterialBasePropertiesAsync(I,b,p)),b.pbrMetallicRoughness&&P.push(this._loadMaterialMetallicRoughnessPropertiesAsync(I+"/pbrMetallicRoughness",b.pbrMetallicRoughness,p)),this.loadMaterialAlphaProperties(I,b,p),Promise.all(P).then(function(){})},C.prototype.loadMaterialBasePropertiesAsync=function(I,b,p){if(!(p instanceof m.PBRMaterial))throw new Error(I+": Material type not supported");var x=new Array;return p.emissiveColor=b.emissiveFactor?m.Color3.FromArray(b.emissiveFactor):new m.Color3(0,0,0),b.doubleSided&&(p.backFaceCulling=!1,p.twoSidedLighting=!0),b.normalTexture&&(b.normalTexture.nonColorData=!0,x.push(this.loadTextureInfoAsync(I+"/normalTexture",b.normalTexture,function(P){P.name=p.name+" (Normal)",p.bumpTexture=P})),p.invertNormalMapX=!this._babylonScene.useRightHandedSystem,p.invertNormalMapY=this._babylonScene.useRightHandedSystem,b.normalTexture.scale!=null&&(p.bumpTexture.level=b.normalTexture.scale),p.forceIrradianceInFragment=!0),b.occlusionTexture&&(b.occlusionTexture.nonColorData=!0,x.push(this.loadTextureInfoAsync(I+"/occlusionTexture",b.occlusionTexture,function(P){P.name=p.name+" (Occlusion)",p.ambientTexture=P})),p.useAmbientInGrayScale=!0,b.occlusionTexture.strength!=null&&(p.ambientTextureStrength=b.occlusionTexture.strength)),b.emissiveTexture&&x.push(this.loadTextureInfoAsync(I+"/emissiveTexture",b.emissiveTexture,function(P){P.name=p.name+" (Emissive)",p.emissiveTexture=P})),Promise.all(x).then(function(){})},C.prototype.loadMaterialAlphaProperties=function(I,b,p){if(!(p instanceof m.PBRMaterial))throw new Error(I+": Material type not supported");switch(b.alphaMode||"OPAQUE"){case"OPAQUE":p.transparencyMode=m.PBRMaterial.PBRMATERIAL_OPAQUE;break;case"MASK":p.transparencyMode=m.PBRMaterial.PBRMATERIAL_ALPHATEST,p.alphaCutOff=b.alphaCutoff==null?.5:b.alphaCutoff,p.albedoTexture&&(p.albedoTexture.hasAlpha=!0);break;case"BLEND":p.transparencyMode=m.PBRMaterial.PBRMATERIAL_ALPHABLEND,p.albedoTexture&&(p.albedoTexture.hasAlpha=!0,p.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(I+"/alphaMode: Invalid value ("+b.alphaMode+")")}},C.prototype.loadTextureInfoAsync=function(I,b,p){var x=this;p===void 0&&(p=function(){});var P=this._extensionsLoadTextureInfoAsync(I,b,p);if(P)return P;if(this.logOpen(""+I),b.texCoord>=2)throw new Error(I+"/texCoord: Invalid value ("+b.texCoord+")");var A=d.Get(I+"/index",this._gltf.textures,b.index);A._textureInfo=b;var T=this._loadTextureAsync("/textures/"+b.index,A,function(_){_.coordinatesIndex=b.texCoord||0,C.AddPointerMetadata(_,I),x._parent.onTextureLoadedObservable.notifyObservers(_),p(_)});return this.logClose(),T},C.prototype._loadTextureAsync=function(I,b,p){p===void 0&&(p=function(){});var x=this._extensionsLoadTextureAsync(I,b,p);if(x)return x;this.logOpen(I+" "+(b.name||""));var P=b.sampler==null?C.DefaultSampler:d.Get(I+"/sampler",this._gltf.samplers,b.sampler),A=d.Get(I+"/source",this._gltf.images,b.source),T=this._createTextureAsync(I,P,A,p);return this.logClose(),T},C.prototype._createTextureAsync=function(I,b,p,x,P){var A=this;x===void 0&&(x=function(){});var T=this._loadSampler("/samplers/"+b.index,b),_=new Array,g=new m.Deferred;this._babylonScene._blockEntityCollection=this._forAssetContainer;var O=new m.Texture(null,this._babylonScene,T.noMipMaps,!1,T.samplingMode,function(){A._disposed||g.resolve()},function(R,N){A._disposed||g.reject(new Error(I+": "+(N&&N.message?N.message:R||"Failed to load texture")))},void 0,void 0,void 0,p.mimeType,P);return this._babylonScene._blockEntityCollection=!1,_.push(g.promise),_.push(this.loadImageAsync("/images/"+p.index,p).then(function(R){var N=p.uri||A._fileName+"#image"+p.index,V="data:"+A._uniqueRootUrl+N;O.updateURL(V,R)})),O.wrapU=T.wrapU,O.wrapV=T.wrapV,x(O),Promise.all(_).then(function(){return O})},C.prototype._loadSampler=function(I,b){return b._data||(b._data={noMipMaps:b.minFilter===9728||b.minFilter===9729,samplingMode:C._GetTextureSamplingMode(I,b),wrapU:C._GetTextureWrapMode(I+"/wrapS",b.wrapS),wrapV:C._GetTextureWrapMode(I+"/wrapT",b.wrapT)}),b._data},C.prototype.loadImageAsync=function(I,b){if(!b._data){if(this.logOpen(I+" "+(b.name||"")),b.uri)b._data=this.loadUriAsync(I+"/uri",b,b.uri);else{var p=d.Get(I+"/bufferView",this._gltf.bufferViews,b.bufferView);b._data=this.loadBufferViewAsync("/bufferViews/"+p.index,p)}this.logClose()}return b._data},C.prototype.loadUriAsync=function(I,b,p){var x=this,P=this._extensionsLoadUriAsync(I,b,p);if(P)return P;if(!C._ValidateUri(p))throw new Error(I+": '"+p+"' is invalid");if(m.Tools.IsBase64(p)){var A=new Uint8Array(m.Tools.DecodeBase64(p));return this.log("Decoded "+p.substr(0,64)+"... ("+A.length+" bytes)"),Promise.resolve(A)}return this.log("Loading "+p),this._parent.preprocessUrlAsync(this._rootUrl+p).then(function(T){return new Promise(function(_,g){x._parent._loadFile(T,x._babylonScene,function(O){x._disposed||(x.log("Loaded "+p+" ("+O.byteLength+" bytes)"),_(new Uint8Array(O)))},!0,function(O){g(new m.LoadFileError(I+": Failed to load '"+p+"'"+(O?": "+O.status+" "+O.statusText:""),O))})})})},C.AddPointerMetadata=function(I,b){var p=I.metadata=I.metadata||{},x=p.gltf=p.gltf||{};(x.pointers=x.pointers||[]).push(b)},C._GetTextureWrapMode=function(I,b){switch(b=b??10497){case 33071:return m.Texture.CLAMP_ADDRESSMODE;case 33648:return m.Texture.MIRROR_ADDRESSMODE;case 10497:return m.Texture.WRAP_ADDRESSMODE;default:return m.Logger.Warn(I+": Invalid value ("+b+")"),m.Texture.WRAP_ADDRESSMODE}},C._GetTextureSamplingMode=function(I,b){var p=b.magFilter==null?9729:b.magFilter,x=b.minFilter==null?9987:b.minFilter;if(p===9729)switch(x){case 9728:return m.Texture.LINEAR_NEAREST;case 9729:return m.Texture.LINEAR_LINEAR;case 9984:return m.Texture.LINEAR_NEAREST_MIPNEAREST;case 9985:return m.Texture.LINEAR_LINEAR_MIPNEAREST;case 9986:return m.Texture.LINEAR_NEAREST_MIPLINEAR;case 9987:return m.Texture.LINEAR_LINEAR_MIPLINEAR;default:return m.Logger.Warn(I+"/minFilter: Invalid value ("+x+")"),m.Texture.LINEAR_LINEAR_MIPLINEAR}else switch(p!==9728&&m.Logger.Warn(I+"/magFilter: Invalid value ("+p+")"),x){case 9728:return m.Texture.NEAREST_NEAREST;case 9729:return m.Texture.NEAREST_LINEAR;case 9984:return m.Texture.NEAREST_NEAREST_MIPNEAREST;case 9985:return m.Texture.NEAREST_LINEAR_MIPNEAREST;case 9986:return m.Texture.NEAREST_NEAREST_MIPLINEAR;case 9987:return m.Texture.NEAREST_LINEAR_MIPLINEAR;default:return m.Logger.Warn(I+"/minFilter: Invalid value ("+x+")"),m.Texture.NEAREST_NEAREST_MIPNEAREST}},C._GetTypedArrayConstructor=function(I,b){switch(b){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(I+": Invalid component type "+b)}},C._GetTypedArray=function(I,b,p,x,P){var A=p.buffer;x=p.byteOffset+(x||0);var T=C._GetTypedArrayConstructor(I+"/componentType",b);try{return new T(A,x,P)}catch(_){throw new Error(I+": "+_)}},C._GetNumComponents=function(I,b){switch(b){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(I+": Invalid type ("+b+")")},C._ValidateUri=function(I){return m.Tools.IsBase64(I)||I.indexOf("..")===-1},C._GetDrawMode=function(I,b){switch(b==null&&(b=4),b){case 0:return m.Material.PointListDrawMode;case 1:return m.Material.LineListDrawMode;case 2:return m.Material.LineLoopDrawMode;case 3:return m.Material.LineStripDrawMode;case 4:return m.Material.TriangleFillMode;case 5:return m.Material.TriangleStripDrawMode;case 6:return m.Material.TriangleFanDrawMode}throw new Error(I+": Invalid mesh primitive mode ("+b+")")},C.prototype._compileMaterialsAsync=function(){var I=this;this._parent._startPerformanceCounter("Compile materials");var b=new Array;if(this._gltf.materials)for(var p=0,x=this._gltf.materials;p<x.length;p++){var P=x[p];if(P._data)for(var A in P._data)for(var T=P._data[A],_=0,g=T.babylonMeshes;_<g.length;_++){var O=g[_];O.computeWorldMatrix(!0);var R=T.babylonMaterial;b.push(R.forceCompilationAsync(O)),b.push(R.forceCompilationAsync(O,{useInstances:!0})),this._parent.useClipPlane&&(b.push(R.forceCompilationAsync(O,{clipPlane:!0})),b.push(R.forceCompilationAsync(O,{clipPlane:!0,useInstances:!0})))}}return Promise.all(b).then(function(){I._parent._endPerformanceCounter("Compile materials")})},C.prototype._compileShadowGeneratorsAsync=function(){var I=this;this._parent._startPerformanceCounter("Compile shadow generators");for(var b=new Array,p=0,x=this._babylonScene.lights;p<x.length;p++){var P=x[p].getShadowGenerator();P&&b.push(P.forceCompilationAsync())}return Promise.all(b).then(function(){I._parent._endPerformanceCounter("Compile shadow generators")})},C.prototype._forEachExtensions=function(I){for(var b=0,p=this._extensions;b<p.length;b++){var x=p[b];x.enabled&&I(x)}},C.prototype._applyExtensions=function(I,b,p){for(var x=0,P=this._extensions;x<P.length;x++){var A=P[x];if(A.enabled){var T=A.name+"."+b,_=I;_._activeLoaderExtensionFunctions=_._activeLoaderExtensionFunctions||{};var g=_._activeLoaderExtensionFunctions;if(!g[T]){g[T]=!0;try{var O=p(A);if(O)return O}finally{delete g[T]}}}}return null},C.prototype._extensionsOnLoading=function(){this._forEachExtensions(function(I){return I.onLoading&&I.onLoading()})},C.prototype._extensionsOnReady=function(){this._forEachExtensions(function(I){return I.onReady&&I.onReady()})},C.prototype._extensionsLoadSceneAsync=function(I,b){return this._applyExtensions(b,"loadScene",function(p){return p.loadSceneAsync&&p.loadSceneAsync(I,b)})},C.prototype._extensionsLoadNodeAsync=function(I,b,p){return this._applyExtensions(b,"loadNode",function(x){return x.loadNodeAsync&&x.loadNodeAsync(I,b,p)})},C.prototype._extensionsLoadCameraAsync=function(I,b,p){return this._applyExtensions(b,"loadCamera",function(x){return x.loadCameraAsync&&x.loadCameraAsync(I,b,p)})},C.prototype._extensionsLoadVertexDataAsync=function(I,b,p){return this._applyExtensions(b,"loadVertexData",function(x){return x._loadVertexDataAsync&&x._loadVertexDataAsync(I,b,p)})},C.prototype._extensionsLoadMeshPrimitiveAsync=function(I,b,p,x,P,A){return this._applyExtensions(P,"loadMeshPrimitive",function(T){return T._loadMeshPrimitiveAsync&&T._loadMeshPrimitiveAsync(I,b,p,x,P,A)})},C.prototype._extensionsLoadMaterialAsync=function(I,b,p,x,P){return this._applyExtensions(b,"loadMaterial",function(A){return A._loadMaterialAsync&&A._loadMaterialAsync(I,b,p,x,P)})},C.prototype._extensionsCreateMaterial=function(I,b,p){return this._applyExtensions(b,"createMaterial",function(x){return x.createMaterial&&x.createMaterial(I,b,p)})},C.prototype._extensionsLoadMaterialPropertiesAsync=function(I,b,p){return this._applyExtensions(b,"loadMaterialProperties",function(x){return x.loadMaterialPropertiesAsync&&x.loadMaterialPropertiesAsync(I,b,p)})},C.prototype._extensionsLoadTextureInfoAsync=function(I,b,p){return this._applyExtensions(b,"loadTextureInfo",function(x){return x.loadTextureInfoAsync&&x.loadTextureInfoAsync(I,b,p)})},C.prototype._extensionsLoadTextureAsync=function(I,b,p){return this._applyExtensions(b,"loadTexture",function(x){return x._loadTextureAsync&&x._loadTextureAsync(I,b,p)})},C.prototype._extensionsLoadAnimationAsync=function(I,b){return this._applyExtensions(b,"loadAnimation",function(p){return p.loadAnimationAsync&&p.loadAnimationAsync(I,b)})},C.prototype._extensionsLoadSkinAsync=function(I,b,p){return this._applyExtensions(p,"loadSkin",function(x){return x._loadSkinAsync&&x._loadSkinAsync(I,b,p)})},C.prototype._extensionsLoadUriAsync=function(I,b,p){return this._applyExtensions(b,"loadUri",function(x){return x._loadUriAsync&&x._loadUriAsync(I,b,p)})},C.prototype._extensionsLoadBufferViewAsync=function(I,b){return this._applyExtensions(b,"loadBufferView",function(p){return p.loadBufferViewAsync&&p.loadBufferViewAsync(I,b)})},C.prototype._extensionsLoadBufferAsync=function(I,b,p,x){return this._applyExtensions(b,"loadBuffer",function(P){return P.loadBufferAsync&&P.loadBufferAsync(I,b,p,x)})},C.LoadExtensionAsync=function(I,b,p,x){if(!b.extensions)return null;var P=b.extensions[p];return P?x(I+"/extensions/"+p,P):null},C.LoadExtraAsync=function(I,b,p,x){if(!b.extras)return null;var P=b.extras[p];return P?x(I+"/extras/"+p,P):null},C.prototype.isExtensionUsed=function(I){return!!this._gltf.extensionsUsed&&this._gltf.extensionsUsed.indexOf(I)!==-1},C.prototype.logOpen=function(I){this._parent._logOpen(I)},C.prototype.logClose=function(){this._parent._logClose()},C.prototype.log=function(I){this._parent._log(I)},C.prototype.startPerformanceCounter=function(I){this._parent._startPerformanceCounter(I)},C.prototype.endPerformanceCounter=function(I){this._parent._endPerformanceCounter(I)},C._RegisteredExtensions={},C.DefaultSampler={index:-1},C}();S.GLTFFileLoader._CreateGLTF2Loader=function(C){return new M(C)}},function(s,c,E){E.r(c),E.d(c,"GLTFLoaderCoordinateSystemMode",function(){return m}),E.d(c,"GLTFLoaderAnimationStartMode",function(){return S}),E.d(c,"GLTFLoaderState",function(){return d}),E.d(c,"GLTFFileLoader",function(){return I});var m,S,d,M=E(0),C=E(3);(function(b){b[b.AUTO=0]="AUTO",b[b.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"})(m||(m={})),function(b){b[b.NONE=0]="NONE",b[b.FIRST=1]="FIRST",b[b.ALL=2]="ALL"}(S||(S={})),function(b){b[b.LOADING=0]="LOADING",b[b.READY=1]="READY",b[b.COMPLETE=2]="COMPLETE"}(d||(d={}));var I=function(){function b(){this.onParsedObservable=new M.Observable,this.coordinateSystemMode=m.AUTO,this.animationStartMode=S.FIRST,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.preprocessUrlAsync=function(p){return Promise.resolve(p)},this.onMeshLoadedObservable=new M.Observable,this.onTextureLoadedObservable=new M.Observable,this.onMaterialLoadedObservable=new M.Observable,this.onCameraLoadedObservable=new M.Observable,this.onCompleteObservable=new M.Observable,this.onErrorObservable=new M.Observable,this.onDisposeObservable=new M.Observable,this.onExtensionLoadedObservable=new M.Observable,this.validate=!1,this.onValidatedObservable=new M.Observable,this._loader=null,this._requests=new Array,this.name="gltf",this.extensions={".gltf":{isBinary:!1},".glb":{isBinary:!0}},this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled}return Object.defineProperty(b.prototype,"onParsed",{set:function(p){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),this._onParsedObserver=this.onParsedObservable.add(p)},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"onMeshLoaded",{set:function(p){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(p)},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"onTextureLoaded",{set:function(p){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(p)},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"onMaterialLoaded",{set:function(p){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(p)},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"onCameraLoaded",{set:function(p){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(p)},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"onComplete",{set:function(p){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(p)},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"onError",{set:function(p){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(p)},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"onDispose",{set:function(p){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(p)},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"onExtensionLoaded",{set:function(p){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(p)},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"loggingEnabled",{get:function(){return this._loggingEnabled},set:function(p){this._loggingEnabled!==p&&(this._loggingEnabled=p,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"capturePerformanceCounters",{get:function(){return this._capturePerformanceCounters},set:function(p){this._capturePerformanceCounters!==p&&(this._capturePerformanceCounters=p,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"onValidated",{set:function(p){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(p)},enumerable:!1,configurable:!0}),b.prototype.dispose=function(){this._loader&&(this._loader.dispose(),this._loader=null);for(var p=0,x=this._requests;p<x.length;p++)x[p].abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=function(P){return Promise.resolve(P)},this.onMeshLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.onDisposeObservable.notifyObservers(void 0),this.onDisposeObservable.clear()},b.prototype.requestFile=function(p,x,P,A,T,_){var g=this;if(this._progressCallback=A,T){if(this.useRangeRequests){this.validate&&M.Logger.Warn("glTF validation is not supported when range requests are enabled");var O={abort:function(){},onCompleteObservable:new M.Observable},R={readAsync:function(N,V){return new Promise(function(U,L){g._requestFile(x,p,function(j){U(new Uint8Array(j))},!0,function(j){L(j)},function(j){j.setRequestHeader("Range","bytes="+N+"-"+(N+V-1))})})},byteLength:0};return this._unpackBinaryAsync(new M.DataReader(R)).then(function(N){O.onCompleteObservable.notifyObservers(O),P(N)},_),O}return this._requestFile(x,p,function(N,V){var U=N;g._unpackBinaryAsync(new M.DataReader({readAsync:function(L,j){return Promise.resolve(new Uint8Array(U,L,j))},byteLength:U.byteLength})).then(function(L){P(L,V)},_)},!0,_)}return this._requestFile(x,p,function(N,V){g._validate(p,N,M.Tools.GetFolderPath(x),M.Tools.GetFilename(x)),P({json:g._parseJson(N)},V)},T,_)},b.prototype.readFile=function(p,x,P,A,T,_){var g=this;return p._readFile(x,function(O){if(g._validate(p,O,"file:",x.name),T){var R=O;g._unpackBinaryAsync(new M.DataReader({readAsync:function(N,V){return Promise.resolve(new Uint8Array(R,N,V))},byteLength:R.byteLength})).then(P,_)}else P({json:g._parseJson(O)})},A,T,_)},b.prototype.importMeshAsync=function(p,x,P,A,T,_){var g=this;return Promise.resolve().then(function(){return g.onParsedObservable.notifyObservers(P),g.onParsedObservable.clear(),g._log("Loading "+(_||"")),g._loader=g._getLoader(P),g._loader.importMeshAsync(p,x,!1,P,A,T,_)})},b.prototype.loadAsync=function(p,x,P,A,T){var _=this;return Promise.resolve().then(function(){return _.onParsedObservable.notifyObservers(x),_.onParsedObservable.clear(),_._log("Loading "+(T||"")),_._loader=_._getLoader(x),_._loader.loadAsync(p,x,P,A,T)})},b.prototype.loadAssetContainerAsync=function(p,x,P,A,T){var _=this;return Promise.resolve().then(function(){_.onParsedObservable.notifyObservers(x),_.onParsedObservable.clear(),_._log("Loading "+(T||"")),_._loader=_._getLoader(x);var g=new M.AssetContainer(p),O=[];_.onMaterialLoadedObservable.add(function(V){O.push(V),V.onDisposeObservable.addOnce(function(){var U=g.materials.indexOf(V);U>-1&&g.materials.splice(U,1),(U=O.indexOf(V))>-1&&O.splice(U,1)})});var R=[];_.onTextureLoadedObservable.add(function(V){R.push(V),V.onDisposeObservable.addOnce(function(){var U=g.textures.indexOf(V);U>-1&&g.textures.splice(U,1),(U=R.indexOf(V))>-1&&R.splice(U,1)})});var N=[];return _.onCameraLoadedObservable.add(function(V){N.push(V)}),_._loader.importMeshAsync(null,p,!0,x,P,A,T).then(function(V){return Array.prototype.push.apply(g.geometries,V.geometries),Array.prototype.push.apply(g.meshes,V.meshes),Array.prototype.push.apply(g.particleSystems,V.particleSystems),Array.prototype.push.apply(g.skeletons,V.skeletons),Array.prototype.push.apply(g.animationGroups,V.animationGroups),Array.prototype.push.apply(g.materials,O),Array.prototype.push.apply(g.textures,R),Array.prototype.push.apply(g.lights,V.lights),Array.prototype.push.apply(g.transformNodes,V.transformNodes),Array.prototype.push.apply(g.cameras,N),g})})},b.prototype.canDirectLoad=function(p){return p.indexOf("asset")!==-1&&p.indexOf("version")!==-1||M.StringTools.StartsWith(p,"data:base64,"+b.magicBase64Encoded)||M.StringTools.StartsWith(p,"data:application/octet-stream;base64,"+b.magicBase64Encoded)||M.StringTools.StartsWith(p,"data:model/gltf-binary;base64,"+b.magicBase64Encoded)},b.prototype.directLoad=function(p,x){if(M.StringTools.StartsWith(x,"base64,"+b.magicBase64Encoded)||M.StringTools.StartsWith(x,"application/octet-stream;base64,"+b.magicBase64Encoded)||M.StringTools.StartsWith(x,"model/gltf-binary;base64,"+b.magicBase64Encoded)){var P=M.Tools.DecodeBase64(x);return this._validate(p,P),this._unpackBinaryAsync(new M.DataReader({readAsync:function(A,T){return Promise.resolve(new Uint8Array(P,A,T))},byteLength:P.byteLength}))}return this._validate(p,x),Promise.resolve({json:this._parseJson(x)})},b.prototype.createPlugin=function(){return new b},Object.defineProperty(b.prototype,"loaderState",{get:function(){return this._loader?this._loader.state:null},enumerable:!1,configurable:!0}),b.prototype.whenCompleteAsync=function(){var p=this;return new Promise(function(x,P){p.onCompleteObservable.addOnce(function(){x()}),p.onErrorObservable.addOnce(function(A){P(A)})})},b.prototype._loadFile=function(p,x,P,A,T){var _=this,g=x._loadFile(p,P,function(O){_._onProgress(O,g)},void 0,A,T);return g.onCompleteObservable.add(function(O){_._requests.splice(_._requests.indexOf(O),1)}),this._requests.push(g),g},b.prototype._requestFile=function(p,x,P,A,T,_){var g=this,O=x._requestFile(p,P,function(R){g._onProgress(R,O)},void 0,A,T,_);return O.onCompleteObservable.add(function(R){g._requests.splice(g._requests.indexOf(R),1)}),this._requests.push(O),O},b.prototype._onProgress=function(p,x){if(this._progressCallback){x._lengthComputable=p.lengthComputable,x._loaded=p.loaded,x._total=p.total;for(var P=!0,A=0,T=0,_=0,g=this._requests;_<g.length;_++){var O=g[_];if(O._lengthComputable===void 0||O._loaded===void 0||O._total===void 0)return;P=P&&O._lengthComputable,A+=O._loaded,T+=O._total}this._progressCallback({lengthComputable:P,loaded:A,total:P?T:0})}},b.prototype._validate=function(p,x,P,A){var T=this;P===void 0&&(P=""),A===void 0&&(A=""),this.validate&&(this._startPerformanceCounter("Validate JSON"),C.GLTFValidation.ValidateAsync(x,P,A,function(_){return T.preprocessUrlAsync(P+_).then(function(g){return p._loadFileAsync(g,void 0,!0,!0)})}).then(function(_){T._endPerformanceCounter("Validate JSON"),T.onValidatedObservable.notifyObservers(_),T.onValidatedObservable.clear()},function(_){T._endPerformanceCounter("Validate JSON"),M.Tools.Warn("Failed to validate: "+_.message),T.onValidatedObservable.clear()}))},b.prototype._getLoader=function(p){var x=p.json.asset||{};this._log("Asset version: "+x.version),x.minVersion&&this._log("Asset minimum version: "+x.minVersion),x.generator&&this._log("Asset generator: "+x.generator);var P=b._parseVersion(x.version);if(!P)throw new Error("Invalid version: "+x.version);if(x.minVersion!==void 0){var A=b._parseVersion(x.minVersion);if(!A)throw new Error("Invalid minimum version: "+x.minVersion);if(b._compareVersion(A,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+x.minVersion)}var T={1:b._CreateGLTF1Loader,2:b._CreateGLTF2Loader}[P.major];if(!T)throw new Error("Unsupported version: "+x.version);return T(this)},b.prototype._parseJson=function(p){this._startPerformanceCounter("Parse JSON"),this._log("JSON length: "+p.length);var x=JSON.parse(p);return this._endPerformanceCounter("Parse JSON"),x},b.prototype._unpackBinaryAsync=function(p){var x=this;return this._startPerformanceCounter("Unpack Binary"),p.loadAsync(20).then(function(){var P=p.readUint32();if(P!==1179937895)throw new Error("Unexpected magic: "+P);var A=p.readUint32();x.loggingEnabled&&x._log("Binary version: "+A);var T,_=p.readUint32();if(p.buffer.byteLength!==0&&_!==p.buffer.byteLength)throw new Error("Length in header does not match actual data length: "+_+" != "+p.buffer.byteLength);switch(A){case 1:T=x._unpackBinaryV1Async(p,_);break;case 2:T=x._unpackBinaryV2Async(p,_);break;default:throw new Error("Unsupported version: "+A)}return x._endPerformanceCounter("Unpack Binary"),T})},b.prototype._unpackBinaryV1Async=function(p,x){var P=p.readUint32(),A=p.readUint32();if(A!==0)throw new Error("Unexpected content format: "+A);var T=x-p.byteOffset,_={json:this._parseJson(p.readString(P)),bin:null};if(T!==0){var g=p.byteOffset;_.bin={readAsync:function(O,R){return p.buffer.readAsync(g+O,R)},byteLength:T}}return Promise.resolve(_)},b.prototype._unpackBinaryV2Async=function(p,x){var P=this,A=1313821514,T=5130562,_=p.readUint32();if(p.readUint32()!==A)throw new Error("First chunk format is not JSON");return p.byteOffset+_===x?p.loadAsync(_).then(function(){return{json:P._parseJson(p.readString(_)),bin:null}}):p.loadAsync(_+8).then(function(){var g={json:P._parseJson(p.readString(_)),bin:null},O=function(){var R=p.readUint32();switch(p.readUint32()){case A:throw new Error("Unexpected JSON chunk");case T:var N=p.byteOffset;g.bin={readAsync:function(V,U){return p.buffer.readAsync(N+V,U)},byteLength:R},p.skipBytes(R);break;default:p.skipBytes(R)}return p.byteOffset!==x?p.loadAsync(8).then(O):Promise.resolve(g)};return O()})},b._parseVersion=function(p){if(p==="1.0"||p==="1.0.1")return{major:1,minor:0};var x=(p+"").match(/^(\d+)\.(\d+)/);return x?{major:parseInt(x[1]),minor:parseInt(x[2])}:null},b._compareVersion=function(p,x){return p.major>x.major?1:p.major<x.major?-1:p.minor>x.minor?1:p.minor<x.minor?-1:0},b.prototype._logOpen=function(p){this._log(p),this._logIndentLevel++},b.prototype._logClose=function(){--this._logIndentLevel},b.prototype._logEnabled=function(p){var x=b._logSpaces.substr(0,2*this._logIndentLevel);M.Logger.Log(""+x+p)},b.prototype._logDisabled=function(p){},b.prototype._startPerformanceCounterEnabled=function(p){M.Tools.StartPerformanceCounter(p)},b.prototype._startPerformanceCounterDisabled=function(p){},b.prototype._endPerformanceCounterEnabled=function(p){M.Tools.EndPerformanceCounter(p)},b.prototype._endPerformanceCounterDisabled=function(p){},b.IncrementalLoading=!0,b.HomogeneousCoordinates=!1,b.magicBase64Encoded="Z2xURg",b._logSpaces="                                ",b}();M.SceneLoader&&M.SceneLoader.RegisterPlugin(new I)},function(s,c,E){E.r(c),E.d(c,"GLTFValidation",function(){return M});var m=E(0);function S(C,I,b,p){var x={externalResourceFunction:function(P){return p(P).then(function(A){return new Uint8Array(A)})}};return b&&(x.uri=I==="file:"?b:I+b),C instanceof ArrayBuffer?GLTFValidator.validateBytes(new Uint8Array(C),x):GLTFValidator.validateString(C,x)}function d(){var C=[];onmessage=function(I){var b=I.data;switch(b.id){case"init":importScripts(b.url);break;case"validate":S(b.data,b.rootUrl,b.fileName,function(p){return new Promise(function(x,P){var A=C.length;C.push({resolve:x,reject:P}),postMessage({id:"getExternalResource",index:A,uri:p})})}).then(function(p){postMessage({id:"validate.resolve",value:p})},function(p){postMessage({id:"validate.reject",reason:p})});break;case"getExternalResource.resolve":C[b.index].resolve(b.value);break;case"getExternalResource.reject":C[b.index].reject(b.reason)}}}var M=function(){function C(){}return C.ValidateAsync=function(I,b,p,x){var P=this;return typeof Worker=="function"?new Promise(function(A,T){var _=S+"("+d+")()",g=URL.createObjectURL(new Blob([_],{type:"application/javascript"})),O=new Worker(g),R=function(V){O.removeEventListener("error",R),O.removeEventListener("message",N),T(V)},N=function(V){var U=V.data;switch(U.id){case"getExternalResource":x(U.uri).then(function(L){O.postMessage({id:"getExternalResource.resolve",index:U.index,value:L},[L])},function(L){O.postMessage({id:"getExternalResource.reject",index:U.index,reason:L})});break;case"validate.resolve":O.removeEventListener("error",R),O.removeEventListener("message",N),A(U.value);break;case"validate.reject":O.removeEventListener("error",R),O.removeEventListener("message",N),T(U.reason)}};O.addEventListener("error",R),O.addEventListener("message",N),O.postMessage({id:"init",url:m.Tools.GetAbsoluteUrl(P.Configuration.url)}),O.postMessage({id:"validate",data:I,rootUrl:b,fileName:p})}):(this._LoadScriptPromise||(this._LoadScriptPromise=m.Tools.LoadScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then(function(){return S(I,b,p,x)}))},C.Configuration={url:"https://preview.babylonjs.com/gltf_validator.js"},C}()},function(s,c,E){E.d(c,"b",function(){return S}),E.d(c,"a",function(){return d});/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var m=function(M,C){return(m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(I,b){I.__proto__=b}||function(I,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(I[p]=b[p])})(M,C)};function S(M,C){function I(){this.constructor=M}m(M,C),M.prototype=C===null?Object.create(C):(I.prototype=C.prototype,new I)}var d=function(){return(d=Object.assign||function(M){for(var C,I=1,b=arguments.length;I<b;I++)for(var p in C=arguments[I])Object.prototype.hasOwnProperty.call(C,p)&&(M[p]=C[p]);return M}).apply(this,arguments)}},function(s,c){var E;E=function(){return this}();try{E=E||new Function("return this")()}catch(m){typeof window=="object"&&(E=window)}s.exports=E},function(s,c,E){E.r(c)},function(s,c,E){E.r(c),E.d(c,"EXT_lights_image_based",function(){return M}),E.d(c,"EXT_mesh_gpu_instancing",function(){return C}),E.d(c,"EXT_texture_webp",function(){return I}),E.d(c,"KHR_draco_mesh_compression",function(){return b}),E.d(c,"KHR_lights",function(){return p}),E.d(c,"KHR_materials_pbrSpecularGlossiness",function(){return x}),E.d(c,"KHR_materials_unlit",function(){return P}),E.d(c,"KHR_materials_clearcoat",function(){return A}),E.d(c,"KHR_materials_sheen",function(){return T}),E.d(c,"KHR_materials_specular",function(){return _}),E.d(c,"KHR_materials_ior",function(){return g}),E.d(c,"KHR_materials_variants",function(){return O}),E.d(c,"KHR_materials_transmission",function(){return V}),E.d(c,"KHR_materials_translucency",function(){return U}),E.d(c,"KHR_mesh_quantization",function(){return L}),E.d(c,"KHR_texture_basisu",function(){return j}),E.d(c,"KHR_texture_transform",function(){return Y}),E.d(c,"MSFT_audio_emitter",function(){return W}),E.d(c,"MSFT_lod",function(){return re}),E.d(c,"MSFT_minecraftMesh",function(){return ne}),E.d(c,"MSFT_sRGBFactors",function(){return ge}),E.d(c,"ExtrasAsMetadata",function(){return _e});var m=E(0),S=E(1),d="EXT_lights_image_based",M=function(){function ce(ie){this.name=d,this._loader=ie,this.enabled=this._loader.isExtensionUsed(d)}return ce.prototype.dispose=function(){this._loader=null,delete this._lights},ce.prototype.onLoading=function(){var ie=this._loader.gltf.extensions;if(ie&&ie[this.name]){var Z=ie[this.name];this._lights=Z.lights}},ce.prototype.loadSceneAsync=function(ie,Z){var te=this;return S.b.LoadExtensionAsync(ie,Z,this.name,function(B,G){var $=new Array;$.push(te._loader.loadSceneAsync(ie,Z)),te._loader.logOpen(""+B);var le=S.a.Get(B+"/light",te._lights,G.light);return $.push(te._loadLightAsync("/extensions/"+te.name+"/lights/"+G.light,le).then(function(se){te._loader.babylonScene.environmentTexture=se})),te._loader.logClose(),Promise.all($).then(function(){})})},ce.prototype._loadLightAsync=function(ie,Z){var te=this;if(!Z._loaded){var B=new Array;this._loader.logOpen(""+ie);for(var G=new Array(Z.specularImages.length),$=function(q){var H=Z.specularImages[q];G[q]=new Array(H.length);for(var X=function(Q){var ee=ie+"/specularImages/"+q+"/"+Q;le._loader.logOpen(""+ee);var pe=H[Q],Te=S.a.Get(ee,le._loader.gltf.images,pe);B.push(le._loader.loadImageAsync("/images/"+pe,Te).then(function(ve){G[q][Q]=ve})),le._loader.logClose()},J=0;J<H.length;J++)X(J)},le=this,se=0;se<Z.specularImages.length;se++)$(se);this._loader.logClose(),Z._loaded=Promise.all(B).then(function(){var q=new m.RawCubeTexture(te._loader.babylonScene,null,Z.specularImageSize);if(q.name=Z.name||"environment",Z._babylonTexture=q,Z.intensity!=null&&(q.level=Z.intensity),Z.rotation){var H=m.Quaternion.FromArray(Z.rotation);te._loader.babylonScene.useRightHandedSystem||(H=m.Quaternion.Inverse(H)),m.Matrix.FromQuaternionToRef(H,q.getReflectionTextureMatrix())}var X=m.SphericalHarmonics.FromArray(Z.irradianceCoefficients);X.scaleInPlace(Z.intensity),X.convertIrradianceToLambertianRadiance();var J=m.SphericalPolynomial.FromHarmonics(X),Q=(G.length-1)/m.Scalar.Log2(Z.specularImageSize);return q.updateRGBDAsync(G,J,Q)})}return Z._loaded.then(function(){return Z._babylonTexture})},ce}();S.b.RegisterExtension(d,function(ce){return new M(ce)});var C=function(){function ce(ie){this.name="EXT_mesh_gpu_instancing",this._loader=ie,this.enabled=this._loader.isExtensionUsed("EXT_mesh_gpu_instancing")}return ce.prototype.dispose=function(){this._loader=null},ce.prototype.loadNodeAsync=function(ie,Z,te){var B=this;return S.b.LoadExtensionAsync(ie,Z,this.name,function(G,$){B._loader._disableInstancedMesh++;var le=B._loader.loadNodeAsync("/nodes/"+Z.index,Z,te);if(B._loader._disableInstancedMesh--,!Z._primitiveBabylonMeshes)return le;var se=new Array,q=0,H=function(X){if($.attributes[X]!=null){var J=S.a.Get(G+"/attributes/"+X,B._loader.gltf.accessors,$.attributes[X]);if(se.push(B._loader._loadFloatAccessorAsync("/accessors/"+J.bufferView,J)),q===0)q=J.count;else if(q!==J.count)throw new Error(G+"/attributes: Instance buffer accessors do not have the same count.")}else se.push(Promise.resolve(null))};return H("TRANSLATION"),H("ROTATION"),H("SCALE"),le.then(function(X){return Promise.all(se).then(function(J){var Q=J[0],ee=J[1],pe=J[2],Te=new Float32Array(16*q);m.TmpVectors.Vector3[0].copyFromFloats(0,0,0),m.TmpVectors.Quaternion[0].copyFromFloats(0,0,0,1),m.TmpVectors.Vector3[1].copyFromFloats(1,1,1);for(var ve=0;ve<q;++ve)Q&&m.Vector3.FromArrayToRef(Q,3*ve,m.TmpVectors.Vector3[0]),ee&&m.Quaternion.FromArrayToRef(ee,4*ve,m.TmpVectors.Quaternion[0]),pe&&m.Vector3.FromArrayToRef(pe,3*ve,m.TmpVectors.Vector3[1]),m.Matrix.ComposeToRef(m.TmpVectors.Vector3[1],m.TmpVectors.Quaternion[0],m.TmpVectors.Vector3[0],m.TmpVectors.Matrix[0]),m.TmpVectors.Matrix[0].copyToArray(Te,16*ve);for(var he=0,be=Z._primitiveBabylonMeshes;he<be.length;he++)be[he].thinInstanceSetBuffer("matrix",Te,16,!0);return X})})})},ce}();S.b.RegisterExtension("EXT_mesh_gpu_instancing",function(ce){return new C(ce)});var I=function(){function ce(ie){this.name="EXT_texture_webp",this._loader=ie,this.enabled=ie.isExtensionUsed("EXT_texture_webp")}return ce.prototype.dispose=function(){this._loader=null},ce.prototype._loadTextureAsync=function(ie,Z,te){var B=this;return S.b.LoadExtensionAsync(ie,Z,this.name,function(G,$){var le=Z.sampler==null?S.b.DefaultSampler:S.a.Get(ie+"/sampler",B._loader.gltf.samplers,Z.sampler),se=S.a.Get(G+"/source",B._loader.gltf.images,$.source);return B._loader._createTextureAsync(ie,le,se,function(q){te(q)})})},ce}();S.b.RegisterExtension("EXT_texture_webp",function(ce){return new I(ce)});var b=function(){function ce(ie){this.name="KHR_draco_mesh_compression",this._loader=ie,this.enabled=m.DracoCompression.DecoderAvailable&&this._loader.isExtensionUsed("KHR_draco_mesh_compression")}return ce.prototype.dispose=function(){delete this.dracoCompression,this._loader=null},ce.prototype._loadVertexDataAsync=function(ie,Z,te){var B=this;return S.b.LoadExtensionAsync(ie,Z,this.name,function(G,$){if(Z.mode!=null){if(Z.mode!==5&&Z.mode!==4)throw new Error(ie+": Unsupported mode "+Z.mode);if(Z.mode===5)throw new Error(ie+": Mode "+Z.mode+" is not currently supported")}var le={},se=function(H,X){var J=$.attributes[H];J!=null&&(te._delayInfo=te._delayInfo||[],te._delayInfo.indexOf(X)===-1&&te._delayInfo.push(X),le[X]=J)};se("POSITION",m.VertexBuffer.PositionKind),se("NORMAL",m.VertexBuffer.NormalKind),se("TANGENT",m.VertexBuffer.TangentKind),se("TEXCOORD_0",m.VertexBuffer.UVKind),se("TEXCOORD_1",m.VertexBuffer.UV2Kind),se("JOINTS_0",m.VertexBuffer.MatricesIndicesKind),se("WEIGHTS_0",m.VertexBuffer.MatricesWeightsKind),se("COLOR_0",m.VertexBuffer.ColorKind);var q=S.a.Get(G,B._loader.gltf.bufferViews,$.bufferView);return q._dracoBabylonGeometry||(q._dracoBabylonGeometry=B._loader.loadBufferViewAsync("/bufferViews/"+q.index,q).then(function(H){return(B.dracoCompression||m.DracoCompression.Default).decodeMeshAsync(H,le).then(function(X){var J=new m.Geometry(te.name,B._loader.babylonScene);return X.applyToGeometry(J),J}).catch(function(X){throw new Error(ie+": "+X.message)})})),q._dracoBabylonGeometry})},ce}();S.b.RegisterExtension("KHR_draco_mesh_compression",function(ce){return new b(ce)});var p=function(){function ce(ie){this.name="KHR_lights_punctual",this._loader=ie,this.enabled=this._loader.isExtensionUsed("KHR_lights_punctual")}return ce.prototype.dispose=function(){this._loader=null,delete this._lights},ce.prototype.onLoading=function(){var ie=this._loader.gltf.extensions;if(ie&&ie[this.name]){var Z=ie[this.name];this._lights=Z.lights}},ce.prototype.loadNodeAsync=function(ie,Z,te){var B=this;return S.b.LoadExtensionAsync(ie,Z,this.name,function(G,$){return B._loader.loadNodeAsync(ie,Z,function(le){var se,q=S.a.Get(G,B._lights,$.light),H=q.name||le.name;switch(B._loader.babylonScene._blockEntityCollection=B._loader._forAssetContainer,q.type){case"directional":se=new m.DirectionalLight(H,m.Vector3.Backward(),B._loader.babylonScene);break;case"point":se=new m.PointLight(H,m.Vector3.Zero(),B._loader.babylonScene);break;case"spot":var X=new m.SpotLight(H,m.Vector3.Zero(),m.Vector3.Backward(),0,1,B._loader.babylonScene);X.angle=2*(q.spot&&q.spot.outerConeAngle||Math.PI/4),X.innerAngle=2*(q.spot&&q.spot.innerConeAngle||0),se=X;break;default:throw B._loader.babylonScene._blockEntityCollection=!1,new Error(G+": Invalid light type ("+q.type+")")}B._loader.babylonScene._blockEntityCollection=!1,se.falloffType=m.Light.FALLOFF_GLTF,se.diffuse=q.color?m.Color3.FromArray(q.color):m.Color3.White(),se.intensity=q.intensity==null?1:q.intensity,se.range=q.range==null?Number.MAX_VALUE:q.range,se.parent=le,B._loader._babylonLights.push(se),S.b.AddPointerMetadata(se,G),te(le)})})},ce}();S.b.RegisterExtension("KHR_lights_punctual",function(ce){return new p(ce)});var x=function(){function ce(ie){this.name="KHR_materials_pbrSpecularGlossiness",this.order=200,this._loader=ie,this.enabled=this._loader.isExtensionUsed("KHR_materials_pbrSpecularGlossiness")}return ce.prototype.dispose=function(){this._loader=null},ce.prototype.loadMaterialPropertiesAsync=function(ie,Z,te){var B=this;return S.b.LoadExtensionAsync(ie,Z,this.name,function(G,$){var le=new Array;return le.push(B._loader.loadMaterialBasePropertiesAsync(ie,Z,te)),le.push(B._loadSpecularGlossinessPropertiesAsync(G,Z,$,te)),B._loader.loadMaterialAlphaProperties(ie,Z,te),Promise.all(le).then(function(){})})},ce.prototype._loadSpecularGlossinessPropertiesAsync=function(ie,Z,te,B){if(!(B instanceof m.PBRMaterial))throw new Error(ie+": Material type not supported");var G=new Array;return B.metallic=null,B.roughness=null,te.diffuseFactor?(B.albedoColor=m.Color3.FromArray(te.diffuseFactor),B.alpha=te.diffuseFactor[3]):B.albedoColor=m.Color3.White(),B.reflectivityColor=te.specularFactor?m.Color3.FromArray(te.specularFactor):m.Color3.White(),B.microSurface=te.glossinessFactor==null?1:te.glossinessFactor,te.diffuseTexture&&G.push(this._loader.loadTextureInfoAsync(ie+"/diffuseTexture",te.diffuseTexture,function($){$.name=B.name+" (Diffuse)",B.albedoTexture=$})),te.specularGlossinessTexture&&(te.specularGlossinessTexture.nonColorData=!0,G.push(this._loader.loadTextureInfoAsync(ie+"/specularGlossinessTexture",te.specularGlossinessTexture,function($){$.name=B.name+" (Specular Glossiness)",B.reflectivityTexture=$})),B.reflectivityTexture.hasAlpha=!0,B.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(G).then(function(){})},ce}();S.b.RegisterExtension("KHR_materials_pbrSpecularGlossiness",function(ce){return new x(ce)});var P=function(){function ce(ie){this.name="KHR_materials_unlit",this.order=210,this._loader=ie,this.enabled=this._loader.isExtensionUsed("KHR_materials_unlit")}return ce.prototype.dispose=function(){this._loader=null},ce.prototype.loadMaterialPropertiesAsync=function(ie,Z,te){var B=this;return S.b.LoadExtensionAsync(ie,Z,this.name,function(){return B._loadUnlitPropertiesAsync(ie,Z,te)})},ce.prototype._loadUnlitPropertiesAsync=function(ie,Z,te){if(!(te instanceof m.PBRMaterial))throw new Error(ie+": Material type not supported");var B=new Array;te.unlit=!0;var G=Z.pbrMetallicRoughness;return G&&(G.baseColorFactor?(te.albedoColor=m.Color3.FromArray(G.baseColorFactor),te.alpha=G.baseColorFactor[3]):te.albedoColor=m.Color3.White(),G.baseColorTexture&&B.push(this._loader.loadTextureInfoAsync(ie+"/baseColorTexture",G.baseColorTexture,function($){$.name=te.name+" (Base Color)",te.albedoTexture=$}))),Z.doubleSided&&(te.backFaceCulling=!1,te.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(ie,Z,te),Promise.all(B).then(function(){})},ce}();S.b.RegisterExtension("KHR_materials_unlit",function(ce){return new P(ce)});var A=function(){function ce(ie){this.name="KHR_materials_clearcoat",this.order=190,this._loader=ie,this.enabled=this._loader.isExtensionUsed("KHR_materials_clearcoat")}return ce.prototype.dispose=function(){this._loader=null},ce.prototype.loadMaterialPropertiesAsync=function(ie,Z,te){var B=this;return S.b.LoadExtensionAsync(ie,Z,this.name,function(G,$){var le=new Array;return le.push(B._loader.loadMaterialPropertiesAsync(ie,Z,te)),le.push(B._loadClearCoatPropertiesAsync(G,$,te)),Promise.all(le).then(function(){})})},ce.prototype._loadClearCoatPropertiesAsync=function(ie,Z,te){if(!(te instanceof m.PBRMaterial))throw new Error(ie+": Material type not supported");var B=new Array;return te.clearCoat.isEnabled=!0,te.clearCoat.useRoughnessFromMainTexture=!1,te.clearCoat.remapF0OnInterfaceChange=!1,Z.clearcoatFactor!=null?te.clearCoat.intensity=Z.clearcoatFactor:te.clearCoat.intensity=0,Z.clearcoatTexture&&B.push(this._loader.loadTextureInfoAsync(ie+"/clearcoatTexture",Z.clearcoatTexture,function(G){G.name=te.name+" (ClearCoat Intensity)",te.clearCoat.texture=G})),Z.clearcoatRoughnessFactor!=null?te.clearCoat.roughness=Z.clearcoatRoughnessFactor:te.clearCoat.roughness=0,Z.clearcoatRoughnessTexture&&(Z.clearcoatRoughnessTexture.nonColorData=!0,B.push(this._loader.loadTextureInfoAsync(ie+"/clearcoatRoughnessTexture",Z.clearcoatRoughnessTexture,function(G){G.name=te.name+" (ClearCoat Roughness)",te.clearCoat.textureRoughness=G}))),Z.clearcoatNormalTexture&&(Z.clearcoatNormalTexture.nonColorData=!0,B.push(this._loader.loadTextureInfoAsync(ie+"/clearcoatNormalTexture",Z.clearcoatNormalTexture,function(G){G.name=te.name+" (ClearCoat Normal)",te.clearCoat.bumpTexture=G})),te.invertNormalMapX=!te.getScene().useRightHandedSystem,te.invertNormalMapY=te.getScene().useRightHandedSystem,Z.clearcoatNormalTexture.scale!=null&&(te.clearCoat.bumpTexture.level=Z.clearcoatNormalTexture.scale)),Promise.all(B).then(function(){})},ce}();S.b.RegisterExtension("KHR_materials_clearcoat",function(ce){return new A(ce)});var T=function(){function ce(ie){this.name="KHR_materials_sheen",this.order=190,this._loader=ie,this.enabled=this._loader.isExtensionUsed("KHR_materials_sheen")}return ce.prototype.dispose=function(){this._loader=null},ce.prototype.loadMaterialPropertiesAsync=function(ie,Z,te){var B=this;return S.b.LoadExtensionAsync(ie,Z,this.name,function(G,$){var le=new Array;return le.push(B._loader.loadMaterialPropertiesAsync(ie,Z,te)),le.push(B._loadSheenPropertiesAsync(G,$,te)),Promise.all(le).then(function(){})})},ce.prototype._loadSheenPropertiesAsync=function(ie,Z,te){if(!(te instanceof m.PBRMaterial))throw new Error(ie+": Material type not supported");var B=new Array;return te.sheen.isEnabled=!0,te.sheen.intensity=1,Z.sheenColorFactor!=null?te.sheen.color=m.Color3.FromArray(Z.sheenColorFactor):te.sheen.color=m.Color3.Black(),Z.sheenColorTexture&&B.push(this._loader.loadTextureInfoAsync(ie+"/sheenColorTexture",Z.sheenColorTexture,function(G){G.name=te.name+" (Sheen Color)",te.sheen.texture=G})),Z.sheenRoughnessFactor!==void 0?te.sheen.roughness=Z.sheenRoughnessFactor:te.sheen.roughness=0,Z.sheenRoughnessTexture&&(Z.sheenRoughnessTexture.nonColorData=!0,B.push(this._loader.loadTextureInfoAsync(ie+"/sheenRoughnessTexture",Z.sheenRoughnessTexture,function(G){G.name=te.name+" (Sheen Roughness)",te.sheen.textureRoughness=G}))),te.sheen.albedoScaling=!0,te.sheen.useRoughnessFromMainTexture=!1,Promise.all(B).then(function(){})},ce}();S.b.RegisterExtension("KHR_materials_sheen",function(ce){return new T(ce)});var _=function(){function ce(ie){this.name="KHR_materials_specular",this.order=190,this._loader=ie,this.enabled=this._loader.isExtensionUsed("KHR_materials_specular")}return ce.prototype.dispose=function(){this._loader=null},ce.prototype.loadMaterialPropertiesAsync=function(ie,Z,te){var B=this;return S.b.LoadExtensionAsync(ie,Z,this.name,function(G,$){var le=new Array;return le.push(B._loader.loadMaterialPropertiesAsync(ie,Z,te)),le.push(B._loadSpecularPropertiesAsync(G,$,te)),Promise.all(le).then(function(){})})},ce.prototype._loadSpecularPropertiesAsync=function(ie,Z,te){if(!(te instanceof m.PBRMaterial))throw new Error(ie+": Material type not supported");var B=new Array;return Z.specularFactor!==void 0&&(te.metallicF0Factor=Z.specularFactor),Z.specularColorFactor!==void 0&&(te.metallicReflectanceColor=m.Color3.FromArray(Z.specularColorFactor)),Z.specularTexture&&(Z.specularTexture.nonColorData=!0,B.push(this._loader.loadTextureInfoAsync(ie+"/specularTexture",Z.specularTexture,function(G){G.name=te.name+" (Specular F0 Color)",te.metallicReflectanceTexture=G}))),Promise.all(B).then(function(){})},ce}();S.b.RegisterExtension("KHR_materials_specular",function(ce){return new _(ce)});var g=function(){function ce(ie){this.name="KHR_materials_ior",this.order=180,this._loader=ie,this.enabled=this._loader.isExtensionUsed("KHR_materials_ior")}return ce.prototype.dispose=function(){this._loader=null},ce.prototype.loadMaterialPropertiesAsync=function(ie,Z,te){var B=this;return S.b.LoadExtensionAsync(ie,Z,this.name,function(G,$){var le=new Array;return le.push(B._loader.loadMaterialPropertiesAsync(ie,Z,te)),le.push(B._loadIorPropertiesAsync(G,$,te)),Promise.all(le).then(function(){})})},ce.prototype._loadIorPropertiesAsync=function(ie,Z,te){if(!(te instanceof m.PBRMaterial))throw new Error(ie+": Material type not supported");return Z.ior!==void 0?te.indexOfRefraction=Z.ior:te.indexOfRefraction=ce._DEFAULT_IOR,Promise.resolve()},ce._DEFAULT_IOR=1.5,ce}();S.b.RegisterExtension("KHR_materials_ior",function(ce){return new g(ce)});var O=function(){function ce(ie){this.name="KHR_materials_variants",this._loader=ie,this.enabled=this._loader.isExtensionUsed("KHR_materials_variants")}return ce.prototype.dispose=function(){this._loader=null},ce.GetAvailableVariants=function(ie){var Z=this._GetExtensionMetadata(ie);return Z?Object.keys(Z.variants):[]},ce.prototype.getAvailableVariants=function(ie){return ce.GetAvailableVariants(ie)},ce.SelectVariant=function(ie,Z){var te=this._GetExtensionMetadata(ie);if(!te)throw new Error("Cannot select variant on a glTF mesh that does not have the KHR_materials_variants extension");var B=function(le){var se=te.variants[le];if(se)for(var q=0,H=se;q<H.length;q++){var X=H[q];X.mesh.material=X.material}};if(Z instanceof Array)for(var G=0,$=Z;G<$.length;G++)B($[G]);else B(Z);te.lastSelected=Z},ce.prototype.selectVariant=function(ie,Z){return ce.SelectVariant(ie,Z)},ce.Reset=function(ie){var Z=this._GetExtensionMetadata(ie);if(!Z)throw new Error("Cannot reset on a glTF mesh that does not have the KHR_materials_variants extension");for(var te=0,B=Z.original;te<B.length;te++){var G=B[te];G.mesh.material=G.material}Z.lastSelected=null},ce.prototype.reset=function(ie){return ce.Reset(ie)},ce.GetLastSelectedVariant=function(ie){var Z=this._GetExtensionMetadata(ie);if(!Z)throw new Error("Cannot get the last selected variant on a glTF mesh that does not have the KHR_materials_variants extension");return Z.lastSelected},ce.prototype.getLastSelectedVariant=function(ie){return ce.GetLastSelectedVariant(ie)},ce._GetExtensionMetadata=function(ie){var Z,te;return((te=(Z=ie==null?void 0:ie.metadata)===null||Z===void 0?void 0:Z.gltf)===null||te===void 0?void 0:te.KHR_materials_variants)||null},ce.prototype.onLoading=function(){var ie=this._loader.gltf.extensions;if(ie&&ie[this.name]){var Z=ie[this.name];this._variants=Z.variants}},ce.prototype._loadMeshPrimitiveAsync=function(ie,Z,te,B,G,$){var le=this;return S.b.LoadExtensionAsync(ie,G,this.name,function(se,q){var H=new Array;return H.push(le._loader._loadMeshPrimitiveAsync(ie,Z,te,B,G,function(X){if($(X),X instanceof m.Mesh){var J=S.b._GetDrawMode(ie,G.mode),Q=le._loader.rootBabylonMesh,ee=Q.metadata=Q.metadata||{},pe=ee.gltf=ee.gltf||{},Te=pe.KHR_materials_variants=pe.KHR_materials_variants||{lastSelected:null,original:[],variants:{}};Te.original.push({mesh:X,material:X.material});for(var ve=Te.variants,he=0,be=q.mappings;he<be.length;he++)for(var xe=be[he],Se=function(Ze){var Qe=S.a.Get(se+"/mapping/"+Ze,le._variants,Ze),Xe=S.a.Get("#/materials/",le._loader.gltf.materials,xe.material);H.push(le._loader._loadMaterialAsync("#/materials/"+xe.material,Xe,X,J,function(nt){ve[Qe.name]=ve[Qe.name]||[],ve[Qe.name].push({mesh:X,material:nt})}))},Ue=0,We=xe.variants;Ue<We.length;Ue++)Se(We[Ue])}})),Promise.all(H).then(function(X){return X[0]})})},ce}();S.b.RegisterExtension("KHR_materials_variants",function(ce){return new O(ce)});var R=E(4),N=function(){function ce(ie,Z){var te=this;this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._options=Object(R.a)(Object(R.a)({},ce._getDefaultOptions()),ie),this._scene=Z,this._scene._transmissionHelper=this,this.onErrorObservable=new m.Observable,this._scene.onDisposeObservable.addOnce(function(B){te.dispose()}),this._parseScene(),this._setupRenderTargets()}return ce._getDefaultOptions=function(){return{renderSize:512}},ce.prototype.updateOptions=function(ie){var Z=this;if(Object.keys(ie).filter(function(G){return Z._options[G]!==ie[G]}).length){var te=Object(R.a)(Object(R.a)({},this._options),ie),B=this._options;this._options=te,te.renderSize!==B.renderSize&&this._setupRenderTargets()}},ce.prototype.getOpaqueTarget=function(){return this._opaqueRenderTarget},ce.prototype.shouldRenderAsTransmission=function(ie){return!!ie&&!!(ie instanceof m.PBRMaterial&&ie.subSurface.isRefractionEnabled)},ce.prototype._addMesh=function(ie){ie instanceof m.Mesh&&(ie.onMaterialChangedObservable.add(this.onMeshMaterialChanged.bind(this)),this.shouldRenderAsTransmission(ie.material)?this._transparentMeshesCache.push(ie):this._opaqueMeshesCache.push(ie))},ce.prototype._removeMesh=function(ie){if(ie instanceof m.Mesh){ie.onMaterialChangedObservable.remove(this.onMeshMaterialChanged.bind(this));var Z=this._transparentMeshesCache.indexOf(ie);Z!==-1&&this._transparentMeshesCache.splice(Z,1),(Z=this._opaqueMeshesCache.indexOf(ie))!==-1&&this._opaqueMeshesCache.splice(Z,1)}},ce.prototype._parseScene=function(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))},ce.prototype.onMeshMaterialChanged=function(ie){if(ie instanceof m.Mesh){var Z=this._transparentMeshesCache.indexOf(ie),te=this._opaqueMeshesCache.indexOf(ie);this.shouldRenderAsTransmission(ie.material)?(ie.material instanceof m.PBRMaterial&&(ie.material.subSurface.refractionTexture=this._opaqueRenderTarget),te!==-1?(this._opaqueMeshesCache.splice(te,1),this._transparentMeshesCache.push(ie)):Z===-1&&this._transparentMeshesCache.push(ie)):Z!==-1?(this._transparentMeshesCache.splice(Z,1),this._opaqueMeshesCache.push(ie)):te===-1&&this._opaqueMeshesCache.push(ie)}},ce.prototype._setupRenderTargets=function(){var ie=this,Z=-1;if(this._scene.layers&&this._opaqueRenderTarget)for(var te=0,B=this._scene.layers;te<B.length;te++){var G=(se=B[te]).renderTargetTextures.indexOf(this._opaqueRenderTarget);G>=0&&se.renderTargetTextures.splice(G,1)}if(this._opaqueRenderTarget&&(Z=this._scene.customRenderTargets.indexOf(this._opaqueRenderTarget),this._opaqueRenderTarget.dispose()),this._opaqueRenderTarget=new m.RenderTargetTexture("opaqueSceneTexture",this._options.renderSize,this._scene,!0),this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.gammaSpace=!0,this._opaqueRenderTarget.lodGenerationScale=1,this._opaqueRenderTarget.lodGenerationOffset=-4,Z>=0?this._scene.customRenderTargets.splice(Z,0,this._opaqueRenderTarget):(Z=this._scene.customRenderTargets.length,this._scene.customRenderTargets.push(this._opaqueRenderTarget)),this._scene.layers&&this._opaqueRenderTarget)for(var $=0,le=this._scene.layers;$<le.length;$++){var se;(se=le[$]).renderTargetTextures.push(this._opaqueRenderTarget)}this._transparentMeshesCache.forEach(function(q){ie.shouldRenderAsTransmission(q.material)&&q.material instanceof m.PBRMaterial&&(q.material.refractionTexture=ie._opaqueRenderTarget)})},ce.prototype.dispose=function(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]},ce}(),V=function(){function ce(ie){this.name="KHR_materials_transmission",this.order=175,this._loader=ie,this.enabled=this._loader.isExtensionUsed("KHR_materials_transmission"),this.enabled&&(ie.parent.transparencyAsCoverage=!0)}return ce.prototype.dispose=function(){this._loader=null},ce.prototype.loadMaterialPropertiesAsync=function(ie,Z,te){var B=this;return S.b.LoadExtensionAsync(ie,Z,this.name,function(G,$){var le=new Array;return le.push(B._loader.loadMaterialBasePropertiesAsync(ie,Z,te)),le.push(B._loader.loadMaterialPropertiesAsync(ie,Z,te)),le.push(B._loadTransparentPropertiesAsync(G,Z,te,$)),Promise.all(le).then(function(){})})},ce.prototype._loadTransparentPropertiesAsync=function(ie,Z,te,B){if(!(te instanceof m.PBRMaterial))throw new Error(ie+": Material type not supported");var G=te;if(G.subSurface.isRefractionEnabled=!0,G.subSurface.volumeIndexOfRefraction=1,G.subSurface.useAlbedoToTintRefraction=!0,B.transmissionFactor===void 0)return G.subSurface.refractionIntensity=0,G.subSurface.isRefractionEnabled=!1,Promise.resolve();G.subSurface.refractionIntensity=B.transmissionFactor;var $=G.getScene();return G.subSurface.refractionIntensity&&!$._transmissionHelper&&new N({},G.getScene()),B.transmissionTexture?(B.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(ie+"/transmissionTexture",B.transmissionTexture,void 0).then(function(le){G.subSurface.thicknessTexture=le,G.subSurface.useMaskFromThicknessTextureGltf=!0})):Promise.resolve()},ce}();S.b.RegisterExtension("KHR_materials_transmission",function(ce){return new V(ce)});var U=function(){function ce(ie){this.name="KHR_materials_translucency",this.order=175,this._loader=ie,this.enabled=this._loader.isExtensionUsed("KHR_materials_translucency"),this.enabled&&(ie.parent.transparencyAsCoverage=!0)}return ce.prototype.dispose=function(){this._loader=null},ce.prototype.loadMaterialPropertiesAsync=function(ie,Z,te){var B=this;return S.b.LoadExtensionAsync(ie,Z,this.name,function(G,$){var le=new Array;return le.push(B._loader.loadMaterialBasePropertiesAsync(ie,Z,te)),le.push(B._loader.loadMaterialPropertiesAsync(ie,Z,te)),le.push(B._loadTranslucentPropertiesAsync(G,Z,te,$)),Promise.all(le).then(function(){})})},ce.prototype._loadTranslucentPropertiesAsync=function(ie,Z,te,B){if(!(te instanceof m.PBRMaterial))throw new Error(ie+": Material type not supported");var G=te;return G.subSurface.isTranslucencyEnabled=!0,G.subSurface.volumeIndexOfRefraction=1,G.subSurface.minimumThickness=0,G.subSurface.maximumThickness=0,G.subSurface.useAlbedoToTintRefraction=!0,B.translucencyFactor===void 0?(G.subSurface.translucencyIntensity=0,G.subSurface.isTranslucencyEnabled=!1,Promise.resolve()):(G.subSurface.translucencyIntensity=B.translucencyFactor,B.translucencyTexture?this._loader.loadTextureInfoAsync(ie+"/translucencyTexture",B.translucencyTexture).then(function($){G.subSurface.thicknessTexture=$,G.subSurface.useMaskFromThicknessTextureGltf=!0}):Promise.resolve())},ce}();S.b.RegisterExtension("KHR_materials_translucency",function(ce){return new U(ce)});var L=function(){function ce(ie){this.name="KHR_mesh_quantization",this.enabled=ie.isExtensionUsed("KHR_mesh_quantization")}return ce.prototype.dispose=function(){},ce}();S.b.RegisterExtension("KHR_mesh_quantization",function(ce){return new L(ce)});var j=function(){function ce(ie){this.name="KHR_texture_basisu",this._loader=ie,this.enabled=ie.isExtensionUsed("KHR_texture_basisu")}return ce.prototype.dispose=function(){this._loader=null},ce.prototype._loadTextureAsync=function(ie,Z,te){var B=this;return S.b.LoadExtensionAsync(ie,Z,this.name,function(G,$){var le=Z.sampler==null?S.b.DefaultSampler:S.a.Get(ie+"/sampler",B._loader.gltf.samplers,Z.sampler),se=S.a.Get(G+"/source",B._loader.gltf.images,$.source);return B._loader._createTextureAsync(ie,le,se,function(q){te(q)},Z._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0)})},ce}();S.b.RegisterExtension("KHR_texture_basisu",function(ce){return new j(ce)});var Y=function(){function ce(ie){this.name="KHR_texture_transform",this._loader=ie,this.enabled=this._loader.isExtensionUsed("KHR_texture_transform")}return ce.prototype.dispose=function(){this._loader=null},ce.prototype.loadTextureInfoAsync=function(ie,Z,te){var B=this;return S.b.LoadExtensionAsync(ie,Z,this.name,function(G,$){return B._loader.loadTextureInfoAsync(ie,Z,function(le){if(!(le instanceof m.Texture))throw new Error(G+": Texture type not supported");$.offset&&(le.uOffset=$.offset[0],le.vOffset=$.offset[1]),le.uRotationCenter=0,le.vRotationCenter=0,$.rotation&&(le.wAng=-$.rotation),$.scale&&(le.uScale=$.scale[0],le.vScale=$.scale[1]),$.texCoord!=null&&(le.coordinatesIndex=$.texCoord),te(le)})})},ce}();S.b.RegisterExtension("KHR_texture_transform",function(ce){return new Y(ce)});var W=function(){function ce(ie){this.name="MSFT_audio_emitter",this._loader=ie,this.enabled=this._loader.isExtensionUsed("MSFT_audio_emitter")}return ce.prototype.dispose=function(){this._loader=null,this._clips=null,this._emitters=null},ce.prototype.onLoading=function(){var ie=this._loader.gltf.extensions;if(ie&&ie[this.name]){var Z=ie[this.name];this._clips=Z.clips,this._emitters=Z.emitters,S.a.Assign(this._clips),S.a.Assign(this._emitters)}},ce.prototype.loadSceneAsync=function(ie,Z){var te=this;return S.b.LoadExtensionAsync(ie,Z,this.name,function(B,G){var $=new Array;$.push(te._loader.loadSceneAsync(ie,Z));for(var le=0,se=G.emitters;le<se.length;le++){var q=se[le],H=S.a.Get(B+"/emitters",te._emitters,q);if(H.refDistance!=null||H.maxDistance!=null||H.rolloffFactor!=null||H.distanceModel!=null||H.innerAngle!=null||H.outerAngle!=null)throw new Error(B+": Direction or Distance properties are not allowed on emitters attached to a scene");$.push(te._loadEmitterAsync(B+"/emitters/"+H.index,H))}return Promise.all($).then(function(){})})},ce.prototype.loadNodeAsync=function(ie,Z,te){var B=this;return S.b.LoadExtensionAsync(ie,Z,this.name,function(G,$){var le=new Array;return B._loader.loadNodeAsync(G,Z,function(se){for(var q=function(J){var Q=S.a.Get(G+"/emitters",B._emitters,J);le.push(B._loadEmitterAsync(G+"/emitters/"+Q.index,Q).then(function(){for(var ee=0,pe=Q._babylonSounds;ee<pe.length;ee++){var Te=pe[ee];Te.attachToMesh(se),Q.innerAngle==null&&Q.outerAngle==null||(Te.setLocalDirectionToMesh(m.Vector3.Forward()),Te.setDirectionalCone(2*m.Tools.ToDegrees(Q.innerAngle==null?Math.PI:Q.innerAngle),2*m.Tools.ToDegrees(Q.outerAngle==null?Math.PI:Q.outerAngle),0))}}))},H=0,X=$.emitters;H<X.length;H++)q(X[H]);te(se)}).then(function(se){return Promise.all(le).then(function(){return se})})})},ce.prototype.loadAnimationAsync=function(ie,Z){var te=this;return S.b.LoadExtensionAsync(ie,Z,this.name,function(B,G){return te._loader.loadAnimationAsync(ie,Z).then(function($){var le=new Array;S.a.Assign(G.events);for(var se=0,q=G.events;se<q.length;se++){var H=q[se];le.push(te._loadAnimationEventAsync(B+"/events/"+H.index,ie,Z,H,$))}return Promise.all(le).then(function(){return $})})})},ce.prototype._loadClipAsync=function(ie,Z){if(Z._objectURL)return Z._objectURL;var te;if(Z.uri)te=this._loader.loadUriAsync(ie,Z,Z.uri);else{var B=S.a.Get(ie+"/bufferView",this._loader.gltf.bufferViews,Z.bufferView);te=this._loader.loadBufferViewAsync("/bufferViews/"+B.index,B)}return Z._objectURL=te.then(function(G){return URL.createObjectURL(new Blob([G],{type:Z.mimeType}))}),Z._objectURL},ce.prototype._loadEmitterAsync=function(ie,Z){var te=this;if(Z._babylonSounds=Z._babylonSounds||[],!Z._babylonData){for(var B=new Array,G=Z.name||"emitter"+Z.index,$={loop:!1,autoplay:!1,volume:Z.volume==null?1:Z.volume},le=function(X){var J="/extensions/"+se.name+"/clips",Q=S.a.Get(J,se._clips,Z.clips[X].clip);B.push(se._loadClipAsync(J+"/"+Z.clips[X].clip,Q).then(function(ee){var pe=Z._babylonSounds[X]=new m.Sound(G,ee,te._loader.babylonScene,null,$);pe.refDistance=Z.refDistance||1,pe.maxDistance=Z.maxDistance||256,pe.rolloffFactor=Z.rolloffFactor||1,pe.distanceModel=Z.distanceModel||"exponential",pe._positionInEmitterSpace=!0}))},se=this,q=0;q<Z.clips.length;q++)le(q);var H=Promise.all(B).then(function(){var X=Z.clips.map(function(Q){return Q.weight||1}),J=new m.WeightedSound(Z.loop||!1,Z._babylonSounds,X);Z.innerAngle&&(J.directionalConeInnerAngle=2*m.Tools.ToDegrees(Z.innerAngle)),Z.outerAngle&&(J.directionalConeOuterAngle=2*m.Tools.ToDegrees(Z.outerAngle)),Z.volume&&(J.volume=Z.volume),Z._babylonData.sound=J});Z._babylonData={loaded:H}}return Z._babylonData.loaded},ce.prototype._getEventAction=function(ie,Z,te,B,G){switch(te){case"play":return function($){var le=(G||0)+($-B);Z.play(le)};case"stop":return function($){Z.stop()};case"pause":return function($){Z.pause()};default:throw new Error(ie+": Unsupported action "+te)}},ce.prototype._loadAnimationEventAsync=function(ie,Z,te,B,G){var $=this;if(G.targetedAnimations.length==0)return Promise.resolve();var le=G.targetedAnimations[0],se=B.emitter,q=S.a.Get("/extensions/"+this.name+"/emitters",this._emitters,se);return this._loadEmitterAsync(ie,q).then(function(){var H=q._babylonData.sound;if(H){var X=new m.AnimationEvent(B.time,$._getEventAction(ie,H,B.action,B.time,B.startOffset));le.animation.addEvent(X),G.onAnimationGroupEndObservable.add(function(){H.stop()}),G.onAnimationGroupPauseObservable.add(function(){H.pause()})}})},ce}();S.b.RegisterExtension("MSFT_audio_emitter",function(ce){return new W(ce)});var re=function(){function ce(ie){this.name="MSFT_lod",this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new m.Observable,this.onMaterialLODsLoadedObservable=new m.Observable,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=ie,this.enabled=this._loader.isExtensionUsed("MSFT_lod")}return ce.prototype.dispose=function(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()},ce.prototype.onReady=function(){for(var ie=this,Z=function(le){var se=Promise.all(te._nodePromiseLODs[le]).then(function(){le!==0&&(ie._loader.endPerformanceCounter("Node LOD "+le),ie._loader.log("Loaded node LOD "+le)),ie.onNodeLODsLoadedObservable.notifyObservers(le),le!==ie._nodePromiseLODs.length-1&&(ie._loader.startPerformanceCounter("Node LOD "+(le+1)),ie._loadBufferLOD(ie._nodeBufferLODs,le+1),ie._nodeSignalLODs[le]&&ie._nodeSignalLODs[le].resolve())});te._loader._completePromises.push(se)},te=this,B=0;B<this._nodePromiseLODs.length;B++)Z(B);var G=function(le){var se=Promise.all($._materialPromiseLODs[le]).then(function(){le!==0&&(ie._loader.endPerformanceCounter("Material LOD "+le),ie._loader.log("Loaded material LOD "+le)),ie.onMaterialLODsLoadedObservable.notifyObservers(le),le!==ie._materialPromiseLODs.length-1&&(ie._loader.startPerformanceCounter("Material LOD "+(le+1)),ie._loadBufferLOD(ie._materialBufferLODs,le+1),ie._materialSignalLODs[le]&&ie._materialSignalLODs[le].resolve())});$._loader._completePromises.push(se)},$=this;for(B=0;B<this._materialPromiseLODs.length;B++)G(B)},ce.prototype.loadSceneAsync=function(ie,Z){var te=this._loader.loadSceneAsync(ie,Z);return this._loadBufferLOD(this._bufferLODs,0),te},ce.prototype.loadNodeAsync=function(ie,Z,te){var B=this;return S.b.LoadExtensionAsync(ie,Z,this.name,function(G,$){var le,se=B._getLODs(G,Z,B._loader.gltf.nodes,$.ids);B._loader.logOpen(""+G);for(var q=function(X){var J=se[X];X!==0&&(B._nodeIndexLOD=X,B._nodeSignalLODs[X]=B._nodeSignalLODs[X]||new m.Deferred);var Q=B._loader.loadNodeAsync("/nodes/"+J.index,J,function(ee){ee.setEnabled(!1)}).then(function(ee){if(X!==0){var pe=se[X-1];pe._babylonTransformNode&&(B._disposeTransformNode(pe._babylonTransformNode),delete pe._babylonTransformNode)}return ee.setEnabled(!0),ee});B._nodePromiseLODs[X]=B._nodePromiseLODs[X]||[],X===0?le=Q:(B._nodeIndexLOD=null,B._nodePromiseLODs[X].push(Q))},H=0;H<se.length;H++)q(H);return B._loader.logClose(),le})},ce.prototype._loadMaterialAsync=function(ie,Z,te,B,G){var $=this;return this._nodeIndexLOD?null:S.b.LoadExtensionAsync(ie,Z,this.name,function(le,se){var q,H=$._getLODs(le,Z,$._loader.gltf.materials,se.ids);$._loader.logOpen(""+le);for(var X=function(Q){var ee=H[Q];Q!==0&&($._materialIndexLOD=Q);var pe=$._loader._loadMaterialAsync("/materials/"+ee.index,ee,te,B,function(Te){Q===0&&G(Te)}).then(function(Te){if(Q!==0){G(Te);var ve=H[Q-1]._data;ve[B]&&($._disposeMaterials([ve[B].babylonMaterial]),delete ve[B])}return Te});$._materialPromiseLODs[Q]=$._materialPromiseLODs[Q]||[],Q===0?q=pe:($._materialIndexLOD=null,$._materialPromiseLODs[Q].push(pe))},J=0;J<H.length;J++)X(J);return $._loader.logClose(),q})},ce.prototype._loadUriAsync=function(ie,Z,te){var B=this;if(this._nodeIndexLOD!==null){this._loader.log("deferred");var G=this._nodeIndexLOD-1;return this._nodeSignalLODs[G]=this._nodeSignalLODs[G]||new m.Deferred,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then(function(){return B._loader.loadUriAsync(ie,Z,te)})}return this._materialIndexLOD!==null?(this._loader.log("deferred"),G=this._materialIndexLOD-1,this._materialSignalLODs[G]=this._materialSignalLODs[G]||new m.Deferred,this._materialSignalLODs[G].promise.then(function(){return B._loader.loadUriAsync(ie,Z,te)})):null},ce.prototype.loadBufferAsync=function(ie,Z,te,B){if(this._loader.parent.useRangeRequests&&!Z.uri){if(!this._loader.bin)throw new Error(ie+": Uri is missing or the binary glTF is missing its binary chunk");var G=function($,le){var se=te,q=se+B-1,H=$[le];return H?(H.start=Math.min(H.start,se),H.end=Math.max(H.end,q)):(H={start:se,end:q,loaded:new m.Deferred},$[le]=H),H.loaded.promise.then(function(X){return new Uint8Array(X.buffer,X.byteOffset+te-H.start,B)})};return this._loader.log("deferred"),this._nodeIndexLOD!==null?G(this._nodeBufferLODs,this._nodeIndexLOD):this._materialIndexLOD!==null?G(this._materialBufferLODs,this._materialIndexLOD):G(this._bufferLODs,0)}return null},ce.prototype._loadBufferLOD=function(ie,Z){var te=ie[Z];te&&(this._loader.log("Loading buffer range ["+te.start+"-"+te.end+"]"),this._loader.bin.readAsync(te.start,te.end-te.start+1).then(function(B){te.loaded.resolve(B)},function(B){te.loaded.reject(B)}))},ce.prototype._getLODs=function(ie,Z,te,B){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");for(var G=new Array,$=B.length-1;$>=0;$--)if(G.push(S.a.Get(ie+"/ids/"+B[$],te,B[$])),G.length===this.maxLODsToLoad)return G;return G.push(Z),G},ce.prototype._disposeTransformNode=function(ie){var Z=this,te=new Array,B=ie.material;B&&te.push(B);for(var G=0,$=ie.getChildMeshes();G<$.length;G++){var le=$[G];le.material&&te.push(le.material)}ie.dispose();var se=te.filter(function(q){return Z._loader.babylonScene.meshes.every(function(H){return H.material!=q})});this._disposeMaterials(se)},ce.prototype._disposeMaterials=function(ie){for(var Z={},te=0,B=ie;te<B.length;te++){for(var G=0,$=(X=B[te]).getActiveTextures();G<$.length;G++){var le=$[G];Z[le.uniqueId]=le}X.dispose()}for(var se in Z)for(var q=0,H=this._loader.babylonScene.materials;q<H.length;q++){var X;(X=H[q]).hasTexture(Z[se])&&delete Z[se]}for(var se in Z)Z[se].dispose()},ce}();S.b.RegisterExtension("MSFT_lod",function(ce){return new re(ce)});var ne=function(){function ce(ie){this.name="MSFT_minecraftMesh",this._loader=ie,this.enabled=this._loader.isExtensionUsed("MSFT_minecraftMesh")}return ce.prototype.dispose=function(){this._loader=null},ce.prototype.loadMaterialPropertiesAsync=function(ie,Z,te){var B=this;return S.b.LoadExtraAsync(ie,Z,this.name,function(G,$){if($){if(!(te instanceof m.PBRMaterial))throw new Error(G+": Material type not supported");var le=B._loader.loadMaterialPropertiesAsync(ie,Z,te);return te.needAlphaBlending()&&(te.forceDepthWrite=!0,te.separateCullingPass=!0),te.backFaceCulling=te.forceDepthWrite,te.twoSidedLighting=!0,le}return null})},ce}();S.b.RegisterExtension("MSFT_minecraftMesh",function(ce){return new ne(ce)});var ge=function(){function ce(ie){this.name="MSFT_sRGBFactors",this._loader=ie,this.enabled=this._loader.isExtensionUsed("MSFT_sRGBFactors")}return ce.prototype.dispose=function(){this._loader=null},ce.prototype.loadMaterialPropertiesAsync=function(ie,Z,te){var B=this;return S.b.LoadExtraAsync(ie,Z,this.name,function(G,$){if($){if(!(te instanceof m.PBRMaterial))throw new Error(G+": Material type not supported");var le=B._loader.loadMaterialPropertiesAsync(ie,Z,te);return te.albedoTexture||te.albedoColor.toLinearSpaceToRef(te.albedoColor),te.reflectivityTexture||te.reflectivityColor.toLinearSpaceToRef(te.reflectivityColor),le}return null})},ce}();S.b.RegisterExtension("MSFT_sRGBFactors",function(ce){return new ge(ce)});var _e=function(){function ce(ie){this.name="ExtrasAsMetadata",this.enabled=!0,this._loader=ie}return ce.prototype._assignExtras=function(ie,Z){if(Z.extras&&Object.keys(Z.extras).length>0){var te=ie.metadata=ie.metadata||{};(te.gltf=te.gltf||{}).extras=Z.extras}},ce.prototype.dispose=function(){this._loader=null},ce.prototype.loadNodeAsync=function(ie,Z,te){var B=this;return this._loader.loadNodeAsync(ie,Z,function(G){B._assignExtras(G,Z),te(G)})},ce.prototype.loadCameraAsync=function(ie,Z,te){var B=this;return this._loader.loadCameraAsync(ie,Z,function(G){B._assignExtras(G,Z),te(G)})},ce.prototype.createMaterial=function(ie,Z,te){var B=this._loader.createMaterial(ie,Z,te);return this._assignExtras(B,Z),B},ce}();S.b.RegisterExtension("ExtrasAsMetadata",function(ce){return new _e(ce)})},function(s,c,E){E.r(c),E.d(c,"GLTFBinaryExtension",function(){return X}),E.d(c,"GLTFLoaderBase",function(){return se}),E.d(c,"GLTFLoader",function(){return q}),E.d(c,"GLTFLoaderExtension",function(){return H}),E.d(c,"EComponentType",function(){return m}),E.d(c,"EShaderType",function(){return S}),E.d(c,"EParameterType",function(){return d}),E.d(c,"ETextureWrapMode",function(){return M}),E.d(c,"ETextureFilterType",function(){return C}),E.d(c,"ETextureFormat",function(){return I}),E.d(c,"ECullingType",function(){return b}),E.d(c,"EBlendingFunction",function(){return p}),E.d(c,"GLTFUtils",function(){return T}),E.d(c,"GLTFMaterialsCommonExtension",function(){return J});var m,S,d,M,C,I,b,p,x=E(4);(function(Q){Q[Q.BYTE=5120]="BYTE",Q[Q.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",Q[Q.SHORT=5122]="SHORT",Q[Q.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",Q[Q.FLOAT=5126]="FLOAT"})(m||(m={})),function(Q){Q[Q.FRAGMENT=35632]="FRAGMENT",Q[Q.VERTEX=35633]="VERTEX"}(S||(S={})),function(Q){Q[Q.BYTE=5120]="BYTE",Q[Q.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",Q[Q.SHORT=5122]="SHORT",Q[Q.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",Q[Q.INT=5124]="INT",Q[Q.UNSIGNED_INT=5125]="UNSIGNED_INT",Q[Q.FLOAT=5126]="FLOAT",Q[Q.FLOAT_VEC2=35664]="FLOAT_VEC2",Q[Q.FLOAT_VEC3=35665]="FLOAT_VEC3",Q[Q.FLOAT_VEC4=35666]="FLOAT_VEC4",Q[Q.INT_VEC2=35667]="INT_VEC2",Q[Q.INT_VEC3=35668]="INT_VEC3",Q[Q.INT_VEC4=35669]="INT_VEC4",Q[Q.BOOL=35670]="BOOL",Q[Q.BOOL_VEC2=35671]="BOOL_VEC2",Q[Q.BOOL_VEC3=35672]="BOOL_VEC3",Q[Q.BOOL_VEC4=35673]="BOOL_VEC4",Q[Q.FLOAT_MAT2=35674]="FLOAT_MAT2",Q[Q.FLOAT_MAT3=35675]="FLOAT_MAT3",Q[Q.FLOAT_MAT4=35676]="FLOAT_MAT4",Q[Q.SAMPLER_2D=35678]="SAMPLER_2D"}(d||(d={})),function(Q){Q[Q.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",Q[Q.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",Q[Q.REPEAT=10497]="REPEAT"}(M||(M={})),function(Q){Q[Q.NEAREST=9728]="NEAREST",Q[Q.LINEAR=9728]="LINEAR",Q[Q.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",Q[Q.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",Q[Q.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",Q[Q.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(C||(C={})),function(Q){Q[Q.ALPHA=6406]="ALPHA",Q[Q.RGB=6407]="RGB",Q[Q.RGBA=6408]="RGBA",Q[Q.LUMINANCE=6409]="LUMINANCE",Q[Q.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA"}(I||(I={})),function(Q){Q[Q.FRONT=1028]="FRONT",Q[Q.BACK=1029]="BACK",Q[Q.FRONT_AND_BACK=1032]="FRONT_AND_BACK"}(b||(b={})),function(Q){Q[Q.ZERO=0]="ZERO",Q[Q.ONE=1]="ONE",Q[Q.SRC_COLOR=768]="SRC_COLOR",Q[Q.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",Q[Q.DST_COLOR=774]="DST_COLOR",Q[Q.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",Q[Q.SRC_ALPHA=770]="SRC_ALPHA",Q[Q.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",Q[Q.DST_ALPHA=772]="DST_ALPHA",Q[Q.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",Q[Q.CONSTANT_COLOR=32769]="CONSTANT_COLOR",Q[Q.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",Q[Q.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",Q[Q.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",Q[Q.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE"}(p||(p={}));var P,A=E(0),T=function(){function Q(){}return Q.SetMatrix=function(ee,pe,Te,ve,he){var be=null;if(Te.semantic==="MODEL"?be=pe.getWorldMatrix():Te.semantic==="PROJECTION"?be=ee.getProjectionMatrix():Te.semantic==="VIEW"?be=ee.getViewMatrix():Te.semantic==="MODELVIEWINVERSETRANSPOSE"?be=A.Matrix.Transpose(pe.getWorldMatrix().multiply(ee.getViewMatrix()).invert()):Te.semantic==="MODELVIEW"?be=pe.getWorldMatrix().multiply(ee.getViewMatrix()):Te.semantic==="MODELVIEWPROJECTION"?be=pe.getWorldMatrix().multiply(ee.getTransformMatrix()):Te.semantic==="MODELINVERSE"?be=pe.getWorldMatrix().invert():Te.semantic==="VIEWINVERSE"?be=ee.getViewMatrix().invert():Te.semantic==="PROJECTIONINVERSE"?be=ee.getProjectionMatrix().invert():Te.semantic==="MODELVIEWINVERSE"?be=pe.getWorldMatrix().multiply(ee.getViewMatrix()).invert():Te.semantic==="MODELVIEWPROJECTIONINVERSE"?be=pe.getWorldMatrix().multiply(ee.getTransformMatrix()).invert():Te.semantic==="MODELINVERSETRANSPOSE"&&(be=A.Matrix.Transpose(pe.getWorldMatrix().invert())),be)switch(Te.type){case d.FLOAT_MAT2:he.setMatrix2x2(ve,A.Matrix.GetAsMatrix2x2(be));break;case d.FLOAT_MAT3:he.setMatrix3x3(ve,A.Matrix.GetAsMatrix3x3(be));break;case d.FLOAT_MAT4:he.setMatrix(ve,be)}},Q.SetUniform=function(ee,pe,Te,ve){switch(ve){case d.FLOAT:return ee.setFloat(pe,Te),!0;case d.FLOAT_VEC2:return ee.setVector2(pe,A.Vector2.FromArray(Te)),!0;case d.FLOAT_VEC3:return ee.setVector3(pe,A.Vector3.FromArray(Te)),!0;case d.FLOAT_VEC4:return ee.setVector4(pe,A.Vector4.FromArray(Te)),!0;default:return!1}},Q.GetWrapMode=function(ee){switch(ee){case M.CLAMP_TO_EDGE:return A.Texture.CLAMP_ADDRESSMODE;case M.MIRRORED_REPEAT:return A.Texture.MIRROR_ADDRESSMODE;case M.REPEAT:default:return A.Texture.WRAP_ADDRESSMODE}},Q.GetByteStrideFromType=function(ee){switch(ee.type){case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16;default:return 1}},Q.GetTextureFilterMode=function(ee){switch(ee){case C.LINEAR:case C.LINEAR_MIPMAP_NEAREST:case C.LINEAR_MIPMAP_LINEAR:return A.Texture.TRILINEAR_SAMPLINGMODE;case C.NEAREST:case C.NEAREST_MIPMAP_NEAREST:return A.Texture.NEAREST_SAMPLINGMODE;default:return A.Texture.BILINEAR_SAMPLINGMODE}},Q.GetBufferFromBufferView=function(ee,pe,Te,ve,he){Te=pe.byteOffset+Te;var be=ee.loadedBufferViews[pe.buffer];if(Te+ve>be.byteLength)throw new Error("Buffer access is out of range");var xe=be.buffer;switch(Te+=be.byteOffset,he){case m.BYTE:return new Int8Array(xe,Te,ve);case m.UNSIGNED_BYTE:return new Uint8Array(xe,Te,ve);case m.SHORT:return new Int16Array(xe,Te,ve);case m.UNSIGNED_SHORT:return new Uint16Array(xe,Te,ve);default:return new Float32Array(xe,Te,ve)}},Q.GetBufferFromAccessor=function(ee,pe){var Te=ee.bufferViews[pe.bufferView],ve=pe.count*Q.GetByteStrideFromType(pe);return Q.GetBufferFromBufferView(ee,Te,pe.byteOffset,ve,pe.componentType)},Q.DecodeBufferToText=function(ee){for(var pe="",Te=ee.byteLength,ve=0;ve<Te;++ve)pe+=String.fromCharCode(ee[ve]);return pe},Q.GetDefaultMaterial=function(ee){if(!Q._DefaultMaterial){A.Effect.ShadersStore.GLTFDefaultMaterialVertexShader=["precision highp float;","","uniform mat4 worldView;","uniform mat4 projection;","","attribute vec3 position;","","void main(void)","{","    gl_Position = projection * worldView * vec4(position, 1.0);","}"].join(`
`),A.Effect.ShadersStore.GLTFDefaultMaterialPixelShader=["precision highp float;","","uniform vec4 u_emission;","","void main(void)","{","    gl_FragColor = u_emission;","}"].join(`
`);var pe={attributes:["position"],uniforms:["worldView","projection","u_emission"],samplers:new Array,needAlphaBlending:!1};Q._DefaultMaterial=new A.ShaderMaterial("GLTFDefaultMaterial",ee,{vertex:"GLTFDefaultMaterial",fragment:"GLTFDefaultMaterial"},pe),Q._DefaultMaterial.setColor4("u_emission",new A.Color4(.5,.5,.5,1))}return Q._DefaultMaterial},Q._DefaultMaterial=null,Q}(),_=E(2);(function(Q){Q[Q.IDENTIFIER=1]="IDENTIFIER",Q[Q.UNKNOWN=2]="UNKNOWN",Q[Q.END_OF_INPUT=3]="END_OF_INPUT"})(P||(P={}));var g=function(){function Q(ee){this._pos=0,this.currentToken=P.UNKNOWN,this.currentIdentifier="",this.currentString="",this.isLetterOrDigitPattern=/^[a-zA-Z0-9]+$/,this._toParse=ee,this._maxPos=ee.length}return Q.prototype.getNextToken=function(){if(this.isEnd())return P.END_OF_INPUT;if(this.currentString=this.read(),this.currentToken=P.UNKNOWN,this.currentString==="_"||this.isLetterOrDigitPattern.test(this.currentString))for(this.currentToken=P.IDENTIFIER,this.currentIdentifier=this.currentString;!this.isEnd()&&(this.isLetterOrDigitPattern.test(this.currentString=this.peek())||this.currentString==="_");)this.currentIdentifier+=this.currentString,this.forward();return this.currentToken},Q.prototype.peek=function(){return this._toParse[this._pos]},Q.prototype.read=function(){return this._toParse[this._pos++]},Q.prototype.forward=function(){this._pos++},Q.prototype.isEnd=function(){return this._pos>=this._maxPos},Q}(),O=["MODEL","VIEW","PROJECTION","MODELVIEW","MODELVIEWPROJECTION","JOINTMATRIX"],R=["world","view","projection","worldView","worldViewProjection","mBones"],N=["translation","rotation","scale"],V=["position","rotationQuaternion","scaling"],U=function(Q,ee,pe){for(var Te in Q){var ve=Q[Te];pe[ee][Te]=ve}},L=function(Q){if(Q)for(var ee=0;ee<Q.length/2;ee++)Q[2*ee+1]=1-Q[2*ee+1]},j=function(Q){if(Q.semantic==="NORMAL")return"normal";if(Q.semantic==="POSITION")return"position";if(Q.semantic==="JOINT")return"matricesIndices";if(Q.semantic==="WEIGHT")return"matricesWeights";if(Q.semantic==="COLOR")return"color";if(Q.semantic&&Q.semantic.indexOf("TEXCOORD_")!==-1){var ee=Number(Q.semantic.split("_")[1]);return"uv"+(ee===0?"":ee+1)}return null},Y=function(Q){var ee=null;if(Q.translation||Q.rotation||Q.scale){var pe=A.Vector3.FromArray(Q.scale||[1,1,1]),Te=A.Quaternion.FromArray(Q.rotation||[0,0,0,1]),ve=A.Vector3.FromArray(Q.translation||[0,0,0]);ee=A.Matrix.Compose(pe,Te,ve)}else ee=A.Matrix.FromArray(Q.matrix);return ee},W=function(Q,ee,pe,Te){for(var ve=0;ve<Te.bones.length;ve++)if(Te.bones[ve].name===pe)return Te.bones[ve];var he=Q.nodes;for(var be in he){var xe=he[be];if(xe.jointName){var Se=xe.children;for(ve=0;ve<Se.length;ve++){var Ue=Q.nodes[Se[ve]];if(Ue.jointName&&Ue.jointName===pe){var We=Y(xe),Ze=new A.Bone(xe.name||"",Te,W(Q,ee,xe.jointName,Te),We);return Ze.id=be,Ze}}}}return null},re=function(Q,ee){for(var pe=0;pe<Q.length;pe++)for(var Te=Q[pe],ve=0;ve<Te.node.children.length;ve++)if(Te.node.children[ve]===ee)return Te.bone;return null},ne=function(Q,ee){var pe=Q.nodes,Te=pe[ee];if(Te)return{node:Te,id:ee};for(var ve in pe)if((Te=pe[ve]).jointName===ee)return{node:Te,id:ve};return null},ge=function(Q,ee){for(var pe=0;pe<Q.jointNames.length;pe++)if(Q.jointNames[pe]===ee)return!0;return!1},_e=function(Q,ee,pe,Te,ve){if(Te||(Te=new A.Skeleton(ee.name||"","",Q.scene)),!ee.babylonSkeleton)return Te;var he=[],be=[];(function(At,wt,Qt,Wt){for(var Ft in At.nodes){var Ht=At.nodes[Ft],fn=Ft;if(Ht.jointName&&!ge(Qt,Ht.jointName)){var ln=Y(Ht),Ln=new A.Bone(Ht.name||"",wt,null,ln);Ln.id=fn,Wt.push({bone:Ln,node:Ht,id:fn})}}for(var Ne=0;Ne<Wt.length;Ne++)for(var vr=Wt[Ne],On=vr.node.children,$n=0;$n<On.length;$n++){for(var Ge=null,zn=0;zn<Wt.length;zn++)if(Wt[zn].id===On[$n]){Ge=Wt[zn];break}Ge&&(Ge.bone._parent=vr.bone,vr.bone.children.push(Ge.bone))}})(Q,Te,ee,he),Te.bones=[];for(var xe=0;xe<ee.jointNames.length;xe++)if(gt=ne(Q,ee.jointNames[xe])){var Se=gt.node;if(Se){ve=gt.id;var Ue=Q.scene.getBoneByID(ve);if(Ue)Te.bones.push(Ue);else{for(var We=!1,Ze=null,Qe=0;Qe<xe;Qe++){var Xe=ne(Q,ee.jointNames[Qe]);if(Xe){var nt=Xe.node;if(nt){var Ke=nt.children;if(Ke){We=!1;for(var ct=0;ct<Ke.length;ct++)if(Ke[ct]===ve){Ze=W(Q,ee,ee.jointNames[Qe],Te),We=!0;break}if(We)break}}else A.Tools.Warn("Joint named "+ee.jointNames[Qe]+" does not exist when looking for parent")}}var ot=Y(Se);!Ze&&he.length>0&&(Ze=re(he,ve))&&be.indexOf(Ze)===-1&&be.push(Ze),new A.Bone(Se.jointName||"",Te,Ze,ot).id=ve}}else A.Tools.Warn("Joint named "+ee.jointNames[xe]+" does not exist")}var _t=Te.bones;for(Te.bones=[],xe=0;xe<ee.jointNames.length;xe++){var gt;if(gt=ne(Q,ee.jointNames[xe])){for(Qe=0;Qe<_t.length;Qe++)if(_t[Qe].id===gt.id){Te.bones.push(_t[Qe]);break}}}for(Te.prepare(),xe=0;xe<be.length;xe++)Te.bones.push(be[xe]);return Te},ce=function(Q,ee,pe,Te,ve){if(ve||(Q.scene._blockEntityCollection=Q.forAssetContainer,ve=new A.Mesh(ee.name||"",Q.scene),Q.scene._blockEntityCollection=!1,ve.id=Te),!ee.babylonNode)return ve;for(var he,be=[],xe=null,Se=new Array,Ue=new Array,We=new Array,Ze=new Array,Qe=0;Qe<pe.length;Qe++){var Xe=pe[Qe];if(Ln=Q.meshes[Xe])for(var nt=0;nt<Ln.primitives.length;nt++){var Ke=new A.VertexData,ct=Ln.primitives[nt];ct.mode;var ot=ct.attributes,_t=null,gt=null;for(var At in ot)if(_t=Q.accessors[ot[At]],gt=T.GetBufferFromAccessor(Q,_t),At==="NORMAL")Ke.normals=new Float32Array(gt.length),Ke.normals.set(gt);else if(At==="POSITION"){if(_.GLTFFileLoader.HomogeneousCoordinates){Ke.positions=new Float32Array(gt.length-gt.length/4);for(var wt=0;wt<gt.length;wt+=4)Ke.positions[wt]=gt[wt],Ke.positions[wt+1]=gt[wt+1],Ke.positions[wt+2]=gt[wt+2]}else Ke.positions=new Float32Array(gt.length),Ke.positions.set(gt);Ue.push(Ke.positions.length)}else if(At.indexOf("TEXCOORD_")!==-1){var Qt=Number(At.split("_")[1]),Wt=A.VertexBuffer.UVKind+(Qt===0?"":Qt+1),Ft=new Float32Array(gt.length);Ft.set(gt),L(Ft),Ke.set(Ft,Wt)}else At==="JOINT"?(Ke.matricesIndices=new Float32Array(gt.length),Ke.matricesIndices.set(gt)):At==="WEIGHT"?(Ke.matricesWeights=new Float32Array(gt.length),Ke.matricesWeights.set(gt)):At==="COLOR"&&(Ke.colors=new Float32Array(gt.length),Ke.colors.set(gt));if(_t=Q.accessors[ct.indices])gt=T.GetBufferFromAccessor(Q,_t),Ke.indices=new Int32Array(gt.length),Ke.indices.set(gt),Ze.push(Ke.indices.length);else{var Ht=[];for(wt=0;wt<Ke.positions.length/3;wt++)Ht.push(wt);Ke.indices=new Int32Array(Ht),Ze.push(Ke.indices.length)}xe?xe.merge(Ke):xe=Ke;var fn=Q.scene.getMaterialByID(ct.material);be.push(fn===null?T.GetDefaultMaterial(Q.scene):fn),Se.push(Se.length===0?0:Se[Se.length-1]+Ue[Ue.length-2]),We.push(We.length===0?0:We[We.length-1]+Ze[Ze.length-2])}}Q.scene._blockEntityCollection=Q.forAssetContainer,be.length>1?(he=new A.MultiMaterial("multimat"+Te,Q.scene)).subMaterials=be:he=new A.StandardMaterial("multimat"+Te,Q.scene),be.length===1&&(he=be[0]),ve.material||(ve.material=he),new A.Geometry(Te,Q.scene,xe,!1,ve),ve.computeWorldMatrix(!0),Q.scene._blockEntityCollection=!1,ve.subMeshes=[];var ln=0;for(Qe=0;Qe<pe.length;Qe++){var Ln;if(Xe=pe[Qe],Ln=Q.meshes[Xe])for(nt=0;nt<Ln.primitives.length;nt++)Ln.primitives[nt].mode,A.SubMesh.AddToMesh(ln,Se[ln],Ue[ln],We[ln],Ze[ln],ve,ve,!0),ln++}return ve},ie=function(Q,ee,pe,Te){Q.position&&(Q.position=ee),(Q.rotationQuaternion||Q.rotation)&&(Q.rotationQuaternion=pe),Q.scaling&&(Q.scaling=Te)},Z=function(Q,ee,pe,Te){var ve=null;if(Q.importOnlyMeshes&&(ee.skin||ee.meshes)&&Q.importMeshesNames&&Q.importMeshesNames.length>0&&Q.importMeshesNames.indexOf(ee.name||"")===-1)return null;if(ee.skin){if(ee.meshes){var he=Q.skins[ee.skin];(be=ce(Q,ee,ee.meshes,pe,ee.babylonNode)).skeleton=Q.scene.getLastSkeletonByID(ee.skin),be.skeleton===null&&(be.skeleton=_e(Q,he,0,he.babylonSkeleton,ee.skin),he.babylonSkeleton||(he.babylonSkeleton=be.skeleton)),ve=be}}else if(ee.meshes){var be;ve=be=ce(Q,ee,ee.mesh?[ee.mesh]:ee.meshes,pe,ee.babylonNode)}else if(!ee.light||ee.babylonNode||Q.importOnlyMeshes){if(ee.camera&&!ee.babylonNode&&!Q.importOnlyMeshes){var xe=Q.cameras[ee.camera];if(xe){if(Q.scene._blockEntityCollection=Q.forAssetContainer,xe.type==="orthographic"){var Se=new A.FreeCamera(ee.camera,A.Vector3.Zero(),Q.scene,!1);Se.name=ee.name||"",Se.mode=A.Camera.ORTHOGRAPHIC_CAMERA,Se.attachControl(),ve=Se}else if(xe.type==="perspective"){var Ue=xe[xe.type],We=new A.FreeCamera(ee.camera,A.Vector3.Zero(),Q.scene,!1);We.name=ee.name||"",We.attachControl(),Ue.aspectRatio||(Ue.aspectRatio=Q.scene.getEngine().getRenderWidth()/Q.scene.getEngine().getRenderHeight()),Ue.znear&&Ue.zfar&&(We.maxZ=Ue.zfar,We.minZ=Ue.znear),ve=We}Q.scene._blockEntityCollection=!1}}}else{var Ze=Q.lights[ee.light];if(Ze){if(Ze.type==="ambient"){var Qe=Ze[Ze.type],Xe=new A.HemisphericLight(ee.light,A.Vector3.Zero(),Q.scene);Xe.name=ee.name||"",Qe.color&&(Xe.diffuse=A.Color3.FromArray(Qe.color)),ve=Xe}else if(Ze.type==="directional"){var nt=Ze[Ze.type],Ke=new A.DirectionalLight(ee.light,A.Vector3.Zero(),Q.scene);Ke.name=ee.name||"",nt.color&&(Ke.diffuse=A.Color3.FromArray(nt.color)),ve=Ke}else if(Ze.type==="point"){var ct=Ze[Ze.type],ot=new A.PointLight(ee.light,A.Vector3.Zero(),Q.scene);ot.name=ee.name||"",ct.color&&(ot.diffuse=A.Color3.FromArray(ct.color)),ve=ot}else if(Ze.type==="spot"){var _t=Ze[Ze.type],gt=new A.SpotLight(ee.light,A.Vector3.Zero(),A.Vector3.Zero(),0,0,Q.scene);gt.name=ee.name||"",_t.color&&(gt.diffuse=A.Color3.FromArray(_t.color)),_t.fallOfAngle&&(gt.angle=_t.fallOfAngle),_t.fallOffExponent&&(gt.exponent=_t.fallOffExponent),ve=gt}}}if(!ee.jointName){if(ee.babylonNode)return ee.babylonNode;if(ve===null){Q.scene._blockEntityCollection=Q.forAssetContainer;var At=new A.Mesh(ee.name||"",Q.scene);Q.scene._blockEntityCollection=!1,ee.babylonNode=At,ve=At}}if(ve!==null){if(ee.matrix&&ve instanceof A.Mesh)(function(Ft,Ht,fn){if(Ht.matrix){var ln=new A.Vector3(0,0,0),Ln=new A.Quaternion,Ne=new A.Vector3(0,0,0);A.Matrix.FromArray(Ht.matrix).decompose(Ne,Ln,ln),ie(Ft,ln,Ln,Ne)}else Ht.translation&&Ht.rotation&&Ht.scale&&ie(Ft,A.Vector3.FromArray(Ht.translation),A.Quaternion.FromArray(Ht.rotation),A.Vector3.FromArray(Ht.scale));Ft.computeWorldMatrix(!0)})(ve,ee);else{var wt=ee.translation||[0,0,0],Qt=ee.rotation||[0,0,0,1],Wt=ee.scale||[1,1,1];ie(ve,A.Vector3.FromArray(wt),A.Quaternion.FromArray(Qt),A.Vector3.FromArray(Wt))}ve.updateCache(!0),ee.babylonNode=ve}return ve},te=function(Q,ee,pe,Te){Te===void 0&&(Te=!1);var ve=Q.nodes[ee],he=null;if(Te=!(Q.importOnlyMeshes&&!Te&&Q.importMeshesNames)||Q.importMeshesNames.indexOf(ve.name||"")!==-1||Q.importMeshesNames.length===0,!ve.jointName&&Te&&(he=Z(Q,ve,ee))!==null&&(he.id=ee,he.parent=pe),ve.children)for(var be=0;be<ve.children.length;be++)te(Q,ve.children[be],he,Te)},B=function(Q){var ee=Q.currentScene;if(ee)for(var pe=0;pe<ee.nodes.length;pe++)te(Q,ee.nodes[pe],null);else for(var Te in Q.scenes)for(ee=Q.scenes[Te],pe=0;pe<ee.nodes.length;pe++)te(Q,ee.nodes[pe],null);for(function(he){for(var be in he.animations){var xe=he.animations[be];if(xe.channels&&xe.samplers)for(var Se=null,Ue=0;Ue<xe.channels.length;Ue++){var We=xe.channels[Ue],Ze=xe.samplers[We.sampler];if(Ze){var Qe=null,Xe=null;xe.parameters?(Qe=xe.parameters[Ze.input],Xe=xe.parameters[Ze.output]):(Qe=Ze.input,Xe=Ze.output);var nt=T.GetBufferFromAccessor(he,he.accessors[Qe]),Ke=T.GetBufferFromAccessor(he,he.accessors[Xe]),ct=We.target.id,ot=he.scene.getNodeByID(ct);if(ot===null&&(ot=he.scene.getNodeByName(ct)),ot!==null){var _t=ot instanceof A.Bone,gt=We.target.path,At=N.indexOf(gt);At!==-1&&(gt=V[At]);var wt=A.Animation.ANIMATIONTYPE_MATRIX;_t||(gt==="rotationQuaternion"?(wt=A.Animation.ANIMATIONTYPE_QUATERNION,ot.rotationQuaternion=new A.Quaternion):wt=A.Animation.ANIMATIONTYPE_VECTOR3);var Qt=null,Wt=[],Ft=0,Ht=!1;_t&&Se&&Se.getKeys().length===nt.length&&(Qt=Se,Ht=!0),Ht||(he.scene._blockEntityCollection=he.forAssetContainer,Qt=new A.Animation(be,_t?"_matrix":gt,1,wt,A.Animation.ANIMATIONLOOPMODE_CYCLE),he.scene._blockEntityCollection=!1);for(var fn=0;fn<nt.length;fn++){var ln=null;if(gt==="rotationQuaternion"?(ln=A.Quaternion.FromArray([Ke[Ft],Ke[Ft+1],Ke[Ft+2],Ke[Ft+3]]),Ft+=4):(ln=A.Vector3.FromArray([Ke[Ft],Ke[Ft+1],Ke[Ft+2]]),Ft+=3),_t){var Ln=ot,Ne=A.Vector3.Zero(),vr=new A.Quaternion,On=A.Vector3.Zero(),$n=Ln.getBaseMatrix();Ht&&Se&&($n=Se.getKeys()[fn].value),$n.decompose(On,vr,Ne),gt==="position"?Ne=ln:gt==="rotationQuaternion"?vr=ln:On=ln,ln=A.Matrix.Compose(On,vr,Ne)}Ht?Se&&(Se.getKeys()[fn].value=ln):Wt.push({frame:nt[fn],value:ln})}!Ht&&Qt&&(Qt.setKeys(Wt),ot.animations.push(Qt)),Se=Qt,he.scene.stopAnimation(ot),he.scene.beginAnimation(ot,0,nt[nt.length-1],!0,1)}else A.Tools.Warn("Creating animation named "+be+". But cannot find node named "+ct+" to attach to")}}}}(Q),pe=0;pe<Q.scene.skeletons.length;pe++){var ve=Q.scene.skeletons[pe];Q.scene.beginAnimation(ve,0,Number.MAX_VALUE,!0,1)}},G=function(Q,ee,pe,Te,ve,he){return function(be){(function(xe,Se,Ue,We,Ze){var Qe=We.values||Ue.parameters,Xe=Ue.uniforms;for(var nt in Ze){var Ke=Ze[nt],ct=Ke.type,ot=Qe[Xe[nt]];if(ot===void 0&&(ot=Ke.value),ot){var _t=function(gt){return function(At){Ke.value&&gt&&(Se.setTexture(gt,At),delete Ze[gt])}};ct===d.SAMPLER_2D?H.LoadTextureAsync(xe,We.values?ot:Ke.value,_t(nt),function(){return _t(null)}):Ke.value&&T.SetUniform(Se,nt,We.values?ot:Ke.value,ct)&&delete Ze[nt]}}})(Q,ee,pe,Te,ve),ee.onBind=function(xe){(function(Se,Ue,We,Ze,Qe,Xe,nt){var Ke=Xe.values||Qe.parameters;for(var ct in We){var ot=We[ct],_t=ot.type;if(_t===d.FLOAT_MAT2||_t===d.FLOAT_MAT3||_t===d.FLOAT_MAT4)if(!ot.semantic||ot.source||ot.node){if(ot.semantic&&(ot.source||ot.node)){var gt=Ue.scene.getNodeByName(ot.source||ot.node||"");if(gt===null&&(gt=Ue.scene.getNodeByID(ot.source||ot.node||"")),gt===null)continue;T.SetMatrix(Ue.scene,gt,ot,ct,Ze.getEffect())}}else T.SetMatrix(Ue.scene,Se,ot,ct,Ze.getEffect());else{var At=Ke[Qe.uniforms[ct]];if(!At)continue;if(_t===d.SAMPLER_2D){var wt=Ue.textures[Xe.values?At:ot.value].babylonTexture;if(wt==null)continue;Ze.getEffect().setTexture(ct,wt)}else T.SetUniform(Ze.getEffect(),ct,At,_t)}}nt(Ze)})(xe,Q,ve,ee,pe,Te,he)}}},$=function(Q,ee,pe){for(var Te in ee.uniforms){var ve=ee.uniforms[Te],he=ee.parameters[ve];if(Q.currentIdentifier===Te&&he.semantic&&!he.source&&!he.node){var be=O.indexOf(he.semantic);if(be!==-1)return delete pe[Te],R[be]}}return Q.currentIdentifier},le=function(Q){for(var ee in Q.materials)H.LoadMaterialAsync(Q,ee,function(pe){},function(){})},se=function(){function Q(){}return Q.CreateRuntime=function(ee,pe,Te){var ve={extensions:{},accessors:{},buffers:{},bufferViews:{},meshes:{},lights:{},cameras:{},nodes:{},images:{},textures:{},shaders:{},programs:{},samplers:{},techniques:{},materials:{},animations:{},skins:{},extensionsUsed:[],scenes:{},buffersCount:0,shaderscount:0,scene:pe,rootUrl:Te,loadedBufferCount:0,loadedBufferViews:{},loadedShaderCount:0,importOnlyMeshes:!1,dummyNodes:[],forAssetContainer:!1};return ee.extensions&&U(ee.extensions,"extensions",ve),ee.extensionsUsed&&U(ee.extensionsUsed,"extensionsUsed",ve),ee.buffers&&function(he,be){for(var xe in he){var Se=he[xe];be.buffers[xe]=Se,be.buffersCount++}}(ee.buffers,ve),ee.bufferViews&&U(ee.bufferViews,"bufferViews",ve),ee.accessors&&U(ee.accessors,"accessors",ve),ee.meshes&&U(ee.meshes,"meshes",ve),ee.lights&&U(ee.lights,"lights",ve),ee.cameras&&U(ee.cameras,"cameras",ve),ee.nodes&&U(ee.nodes,"nodes",ve),ee.images&&U(ee.images,"images",ve),ee.textures&&U(ee.textures,"textures",ve),ee.shaders&&function(he,be){for(var xe in he){var Se=he[xe];be.shaders[xe]=Se,be.shaderscount++}}(ee.shaders,ve),ee.programs&&U(ee.programs,"programs",ve),ee.samplers&&U(ee.samplers,"samplers",ve),ee.techniques&&U(ee.techniques,"techniques",ve),ee.materials&&U(ee.materials,"materials",ve),ee.animations&&U(ee.animations,"animations",ve),ee.skins&&U(ee.skins,"skins",ve),ee.scenes&&(ve.scenes=ee.scenes),ee.scene&&ee.scenes&&(ve.currentScene=ee.scenes[ee.scene]),ve},Q.LoadBufferAsync=function(ee,pe,Te,ve,he){var be=ee.buffers[pe];A.Tools.IsBase64(be.uri)?setTimeout(function(){return Te(new Uint8Array(A.Tools.DecodeBase64(be.uri)))}):A.Tools.LoadFile(ee.rootUrl+be.uri,function(xe){return Te(new Uint8Array(xe))},he,void 0,!0,function(xe){xe&&ve(xe.status+" "+xe.statusText)})},Q.LoadTextureBufferAsync=function(ee,pe,Te,ve){var he=ee.textures[pe];if(he&&he.source)if(he.babylonTexture)Te(null);else{var be=ee.images[he.source];A.Tools.IsBase64(be.uri)?setTimeout(function(){return Te(new Uint8Array(A.Tools.DecodeBase64(be.uri)))}):A.Tools.LoadFile(ee.rootUrl+be.uri,function(xe){return Te(new Uint8Array(xe))},void 0,void 0,!0,function(xe){xe&&ve(xe.status+" "+xe.statusText)})}else ve("")},Q.CreateTextureAsync=function(ee,pe,Te,ve,he){var be=ee.textures[pe];if(be.babylonTexture)ve(be.babylonTexture);else{var xe=ee.samplers[be.sampler],Se=xe.minFilter===C.NEAREST_MIPMAP_NEAREST||xe.minFilter===C.NEAREST_MIPMAP_LINEAR||xe.minFilter===C.LINEAR_MIPMAP_NEAREST||xe.minFilter===C.LINEAR_MIPMAP_LINEAR,Ue=A.Texture.BILINEAR_SAMPLINGMODE,We=Te==null?new Blob:new Blob([Te]),Ze=URL.createObjectURL(We),Qe=function(){return URL.revokeObjectURL(Ze)},Xe=new A.Texture(Ze,ee.scene,!Se,!0,Ue,Qe,Qe);xe.wrapS!==void 0&&(Xe.wrapU=T.GetWrapMode(xe.wrapS)),xe.wrapT!==void 0&&(Xe.wrapV=T.GetWrapMode(xe.wrapT)),Xe.name=pe,be.babylonTexture=Xe,ve(Xe)}},Q.LoadShaderStringAsync=function(ee,pe,Te,ve){var he=ee.shaders[pe];if(A.Tools.IsBase64(he.uri)){var be=atob(he.uri.split(",")[1]);Te&&Te(be)}else A.Tools.LoadFile(ee.rootUrl+he.uri,Te,void 0,void 0,!1,function(xe){xe&&ve&&ve(xe.status+" "+xe.statusText)})},Q.LoadMaterialAsync=function(ee,pe,Te,ve){var he=ee.materials[pe];if(he.technique){var be=ee.techniques[he.technique];if(!be){ee.scene._blockEntityCollection=ee.forAssetContainer;var xe=new A.StandardMaterial(pe,ee.scene);return ee.scene._blockEntityCollection=!1,xe.diffuseColor=new A.Color3(.5,.5,.5),xe.sideOrientation=A.Material.CounterClockWiseSideOrientation,void Te(xe)}var Se=ee.programs[be.program],Ue=be.states,We=A.Effect.ShadersStore[Se.vertexShader+"VertexShader"],Ze=A.Effect.ShadersStore[Se.fragmentShader+"PixelShader"],Qe="",Xe="",nt=new g(We),Ke=new g(Ze),ct={},ot=[],_t=[],gt=[];for(var At in be.uniforms){var wt=be.uniforms[At],Qt=be.parameters[wt];if(ct[At]=Qt,!Qt.semantic||Qt.node||Qt.source)Qt.type===d.SAMPLER_2D?gt.push(At):ot.push(At);else{var Wt=O.indexOf(Qt.semantic);Wt!==-1?(ot.push(R[Wt]),delete ct[At]):ot.push(At)}}for(var Ft in be.attributes){var Ht=be.attributes[Ft];if((Ln=be.parameters[Ht]).semantic){var fn=j(Ln);fn&&_t.push(fn)}}for(;!nt.isEnd()&&nt.getNextToken();)if(nt.currentToken===P.IDENTIFIER){var ln=!1;for(var Ft in be.attributes){Ht=be.attributes[Ft];var Ln=be.parameters[Ht];if(nt.currentIdentifier===Ft&&Ln.semantic){Qe+=j(Ln),ln=!0;break}}ln||(Qe+=$(nt,be,ct))}else Qe+=nt.currentString;for(;!Ke.isEnd()&&Ke.getNextToken();)Ke.currentToken===P.IDENTIFIER?Xe+=$(Ke,be,ct):Xe+=Ke.currentString;var Ne={vertex:Se.vertexShader+pe,fragment:Se.fragmentShader+pe},vr={attributes:_t,uniforms:ot,samplers:gt,needAlphaBlending:Ue&&Ue.enable&&Ue.enable.indexOf(3042)!==-1};A.Effect.ShadersStore[Se.vertexShader+pe+"VertexShader"]=Qe,A.Effect.ShadersStore[Se.fragmentShader+pe+"PixelShader"]=Xe;var On=new A.ShaderMaterial(pe,ee.scene,Ne,vr);if(On.onError=function(zn,No,et){return function(dr,Qr){No.dispose(!0),et("Cannot compile program named "+zn.name+". Error: "+Qr+". Default material will be applied")}}(Se,On,ve),On.onCompiled=G(ee,On,be,he,ct,Te),On.sideOrientation=A.Material.CounterClockWiseSideOrientation,Ue&&Ue.functions){var $n=Ue.functions;$n.cullFace&&$n.cullFace[0]!==b.BACK&&(On.backFaceCulling=!1);var Ge=$n.blendFuncSeparate;Ge&&(Ge[0]===p.SRC_ALPHA&&Ge[1]===p.ONE_MINUS_SRC_ALPHA&&Ge[2]===p.ONE&&Ge[3]===p.ONE?On.alphaMode=A.Constants.ALPHA_COMBINE:Ge[0]===p.ONE&&Ge[1]===p.ONE&&Ge[2]===p.ZERO&&Ge[3]===p.ONE?On.alphaMode=A.Constants.ALPHA_ONEONE:Ge[0]===p.SRC_ALPHA&&Ge[1]===p.ONE&&Ge[2]===p.ZERO&&Ge[3]===p.ONE?On.alphaMode=A.Constants.ALPHA_ADD:Ge[0]===p.ZERO&&Ge[1]===p.ONE_MINUS_SRC_COLOR&&Ge[2]===p.ONE&&Ge[3]===p.ONE?On.alphaMode=A.Constants.ALPHA_SUBTRACT:Ge[0]===p.DST_COLOR&&Ge[1]===p.ZERO&&Ge[2]===p.ONE&&Ge[3]===p.ONE?On.alphaMode=A.Constants.ALPHA_MULTIPLY:Ge[0]===p.SRC_ALPHA&&Ge[1]===p.ONE_MINUS_SRC_COLOR&&Ge[2]===p.ONE&&Ge[3]===p.ONE&&(On.alphaMode=A.Constants.ALPHA_MAXIMIZED))}}else ve&&ve("No technique found.")},Q}(),q=function(){function Q(){this.state=null}return Q.RegisterExtension=function(ee){Q.Extensions[ee.name]?A.Tools.Error('Tool with the same name "'+ee.name+'" already exists'):Q.Extensions[ee.name]=ee},Q.prototype.dispose=function(){},Q.prototype._importMeshAsync=function(ee,pe,Te,ve,he,be,xe,Se){var Ue=this;return pe.useRightHandedSystem=!0,H.LoadRuntimeAsync(pe,Te,ve,function(We){We.forAssetContainer=he,We.importOnlyMeshes=!0,ee===""?We.importMeshesNames=[]:typeof ee=="string"?We.importMeshesNames=[ee]:!ee||ee instanceof Array?(We.importMeshesNames=[],A.Tools.Warn("Argument meshesNames must be of type string or string[]")):We.importMeshesNames=[ee],Ue._createNodes(We);var Ze=new Array,Qe=new Array;for(var Xe in We.nodes){var nt=We.nodes[Xe];nt.babylonNode instanceof A.AbstractMesh&&Ze.push(nt.babylonNode)}for(var Ke in We.skins){var ct=We.skins[Ke];ct.babylonSkeleton instanceof A.Skeleton&&Qe.push(ct.babylonSkeleton)}Ue._loadBuffersAsync(We,function(){Ue._loadShadersAsync(We,function(){le(We),B(We),!_.GLTFFileLoader.IncrementalLoading&&be&&be(Ze,Qe)})},xe),_.GLTFFileLoader.IncrementalLoading&&be&&be(Ze,Qe)},Se),!0},Q.prototype.importMeshAsync=function(ee,pe,Te,ve,he,be){var xe=this;return new Promise(function(Se,Ue){xe._importMeshAsync(ee,pe,ve,he,Te,function(We,Ze){Se({meshes:We,particleSystems:[],skeletons:Ze,animationGroups:[],lights:[],transformNodes:[],geometries:[]})},be,function(We){Ue(new Error(We))})})},Q.prototype._loadAsync=function(ee,pe,Te,ve,he,be,xe){var Se=this;ee.useRightHandedSystem=!0,H.LoadRuntimeAsync(ee,pe,Te,function(Ue){H.LoadRuntimeExtensionsAsync(Ue,function(){Se._createNodes(Ue),Se._loadBuffersAsync(Ue,function(){Se._loadShadersAsync(Ue,function(){le(Ue),B(Ue),_.GLTFFileLoader.IncrementalLoading||he()})}),_.GLTFFileLoader.IncrementalLoading&&he()},xe)},xe)},Q.prototype.loadAsync=function(ee,pe,Te,ve){var he=this;return new Promise(function(be,xe){he._loadAsync(ee,pe,Te,!1,function(){be()},ve,function(Se){xe(new Error(Se))})})},Q.prototype._loadShadersAsync=function(ee,pe){var Te=!1,ve=function(xe,Se){H.LoadShaderStringAsync(ee,xe,function(Ue){Ue instanceof ArrayBuffer||(ee.loadedShaderCount++,Ue&&(A.Effect.ShadersStore[xe+(Se.type===S.VERTEX?"VertexShader":"PixelShader")]=Ue),ee.loadedShaderCount===ee.shaderscount&&pe())},function(){A.Tools.Error("Error when loading shader program named "+xe+" located at "+Se.uri)})};for(var he in ee.shaders){Te=!0;var be=ee.shaders[he];be?ve.bind(this,he,be)():A.Tools.Error("No shader named: "+he)}Te||pe()},Q.prototype._loadBuffersAsync=function(ee,pe,Te){var ve=!1,he=function(Se,Ue){H.LoadBufferAsync(ee,Se,function(We){ee.loadedBufferCount++,We&&(We.byteLength!=ee.buffers[Se].byteLength&&A.Tools.Error("Buffer named "+Se+" is length "+We.byteLength+". Expected: "+Ue.byteLength),ee.loadedBufferViews[Se]=We),ee.loadedBufferCount===ee.buffersCount&&pe()},function(){A.Tools.Error("Error when loading buffer named "+Se+" located at "+Ue.uri)})};for(var be in ee.buffers){ve=!0;var xe=ee.buffers[be];xe?he.bind(this,be,xe)():A.Tools.Error("No buffer named: "+be)}ve||pe()},Q.prototype._createNodes=function(ee){var pe=ee.currentScene;if(pe)for(var Te=0;Te<pe.nodes.length;Te++)te(ee,pe.nodes[Te],null);else for(var ve in ee.scenes)for(pe=ee.scenes[ve],Te=0;Te<pe.nodes.length;Te++)te(ee,pe.nodes[Te],null)},Q.Extensions={},Q}(),H=function(){function Q(ee){this._name=ee}return Object.defineProperty(Q.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0}),Q.prototype.loadRuntimeAsync=function(ee,pe,Te,ve,he){return!1},Q.prototype.loadRuntimeExtensionsAsync=function(ee,pe,Te){return!1},Q.prototype.loadBufferAsync=function(ee,pe,Te,ve,he){return!1},Q.prototype.loadTextureBufferAsync=function(ee,pe,Te,ve){return!1},Q.prototype.createTextureAsync=function(ee,pe,Te,ve,he){return!1},Q.prototype.loadShaderStringAsync=function(ee,pe,Te,ve){return!1},Q.prototype.loadMaterialAsync=function(ee,pe,Te,ve){return!1},Q.LoadRuntimeAsync=function(ee,pe,Te,ve,he){Q.ApplyExtensions(function(be){return be.loadRuntimeAsync(ee,pe,Te,ve,he)},function(){setTimeout(function(){ve&&ve(se.CreateRuntime(pe.json,ee,Te))})})},Q.LoadRuntimeExtensionsAsync=function(ee,pe,Te){Q.ApplyExtensions(function(ve){return ve.loadRuntimeExtensionsAsync(ee,pe,Te)},function(){setTimeout(function(){pe()})})},Q.LoadBufferAsync=function(ee,pe,Te,ve,he){Q.ApplyExtensions(function(be){return be.loadBufferAsync(ee,pe,Te,ve,he)},function(){se.LoadBufferAsync(ee,pe,Te,ve,he)})},Q.LoadTextureAsync=function(ee,pe,Te,ve){Q.LoadTextureBufferAsync(ee,pe,function(he){he&&Q.CreateTextureAsync(ee,pe,he,Te,ve)},ve)},Q.LoadShaderStringAsync=function(ee,pe,Te,ve){Q.ApplyExtensions(function(he){return he.loadShaderStringAsync(ee,pe,Te,ve)},function(){se.LoadShaderStringAsync(ee,pe,Te,ve)})},Q.LoadMaterialAsync=function(ee,pe,Te,ve){Q.ApplyExtensions(function(he){return he.loadMaterialAsync(ee,pe,Te,ve)},function(){se.LoadMaterialAsync(ee,pe,Te,ve)})},Q.LoadTextureBufferAsync=function(ee,pe,Te,ve){Q.ApplyExtensions(function(he){return he.loadTextureBufferAsync(ee,pe,Te,ve)},function(){se.LoadTextureBufferAsync(ee,pe,Te,ve)})},Q.CreateTextureAsync=function(ee,pe,Te,ve,he){Q.ApplyExtensions(function(be){return be.createTextureAsync(ee,pe,Te,ve,he)},function(){se.CreateTextureAsync(ee,pe,Te,ve,he)})},Q.ApplyExtensions=function(ee,pe){for(var Te in q.Extensions)if(ee(q.Extensions[Te]))return;pe()},Q}();_.GLTFFileLoader._CreateGLTF1Loader=function(){return new q};var X=function(Q){function ee(){return Q.call(this,"KHR_binary_glTF")||this}return Object(x.b)(ee,Q),ee.prototype.loadRuntimeAsync=function(pe,Te,ve,he,be){var xe=Te.json.extensionsUsed;return!(!xe||xe.indexOf(this.name)===-1||!Te.bin)&&(this._bin=Te.bin,he(se.CreateRuntime(Te.json,pe,ve)),!0)},ee.prototype.loadBufferAsync=function(pe,Te,ve,he){return pe.extensionsUsed.indexOf(this.name)!==-1&&Te==="binary_glTF"&&(this._bin.readAsync(0,this._bin.byteLength).then(ve,function(be){return he(be.message)}),!0)},ee.prototype.loadTextureBufferAsync=function(pe,Te,ve,he){var be=pe.textures[Te],xe=pe.images[be.source];if(!xe.extensions||!(this.name in xe.extensions))return!1;var Se=xe.extensions[this.name],Ue=pe.bufferViews[Se.bufferView];return ve(T.GetBufferFromBufferView(pe,Ue,0,Ue.byteLength,m.UNSIGNED_BYTE)),!0},ee.prototype.loadShaderStringAsync=function(pe,Te,ve,he){var be=pe.shaders[Te];if(!be.extensions||!(this.name in be.extensions))return!1;var xe=be.extensions[this.name],Se=pe.bufferViews[xe.bufferView],Ue=T.GetBufferFromBufferView(pe,Se,0,Se.byteLength,m.UNSIGNED_BYTE);return setTimeout(function(){var We=T.DecodeBufferToText(Ue);ve(We)}),!0},ee}(H);q.RegisterExtension(new X);var J=function(Q){function ee(){return Q.call(this,"KHR_materials_common")||this}return Object(x.b)(ee,Q),ee.prototype.loadRuntimeExtensionsAsync=function(pe,Te,ve){if(!pe.extensions)return!1;var he=pe.extensions[this.name];if(!he)return!1;var be=he.lights;if(be)for(var xe in be){var Se=be[xe];switch(Se.type){case"ambient":var Ue=new A.HemisphericLight(Se.name,new A.Vector3(0,1,0),pe.scene),We=Se.ambient;We&&(Ue.diffuse=A.Color3.FromArray(We.color||[1,1,1]));break;case"point":var Ze=new A.PointLight(Se.name,new A.Vector3(10,10,10),pe.scene),Qe=Se.point;Qe&&(Ze.diffuse=A.Color3.FromArray(Qe.color||[1,1,1]));break;case"directional":var Xe=new A.DirectionalLight(Se.name,new A.Vector3(0,-1,0),pe.scene),nt=Se.directional;nt&&(Xe.diffuse=A.Color3.FromArray(nt.color||[1,1,1]));break;case"spot":var Ke=Se.spot;Ke&&(new A.SpotLight(Se.name,new A.Vector3(0,10,0),new A.Vector3(0,-1,0),Ke.fallOffAngle||Math.PI,Ke.fallOffExponent||0,pe.scene).diffuse=A.Color3.FromArray(Ke.color||[1,1,1]));break;default:A.Tools.Warn('GLTF Material Common extension: light type "'+Se.type+"\u201D not supported")}}return!1},ee.prototype.loadMaterialAsync=function(pe,Te,ve,he){var be=pe.materials[Te];if(!be||!be.extensions)return!1;var xe=be.extensions[this.name];if(!xe)return!1;var Se=new A.StandardMaterial(Te,pe.scene);return Se.sideOrientation=A.Material.CounterClockWiseSideOrientation,xe.technique==="CONSTANT"&&(Se.disableLighting=!0),Se.backFaceCulling=xe.doubleSided!==void 0&&!xe.doubleSided,Se.alpha=xe.values.transparency===void 0?1:xe.values.transparency,Se.specularPower=xe.values.shininess===void 0?0:xe.values.shininess,typeof xe.values.ambient=="string"?this._loadTexture(pe,xe.values.ambient,Se,"ambientTexture",he):Se.ambientColor=A.Color3.FromArray(xe.values.ambient||[0,0,0]),typeof xe.values.diffuse=="string"?this._loadTexture(pe,xe.values.diffuse,Se,"diffuseTexture",he):Se.diffuseColor=A.Color3.FromArray(xe.values.diffuse||[0,0,0]),typeof xe.values.emission=="string"?this._loadTexture(pe,xe.values.emission,Se,"emissiveTexture",he):Se.emissiveColor=A.Color3.FromArray(xe.values.emission||[0,0,0]),typeof xe.values.specular=="string"?this._loadTexture(pe,xe.values.specular,Se,"specularTexture",he):Se.specularColor=A.Color3.FromArray(xe.values.specular||[0,0,0]),!0},ee.prototype._loadTexture=function(pe,Te,ve,he,be){se.LoadTextureBufferAsync(pe,Te,function(xe){se.CreateTextureAsync(pe,Te,xe,function(Se){return ve[he]=Se},be)},be)},ee}(H);q.RegisterExtension(new J)},function(s,c,E){E.r(c),E.d(c,"ArrayItem",function(){return m.a}),E.d(c,"GLTFLoader",function(){return m.b}),E.d(c,"EXT_lights_image_based",function(){return S.EXT_lights_image_based}),E.d(c,"EXT_mesh_gpu_instancing",function(){return S.EXT_mesh_gpu_instancing}),E.d(c,"EXT_texture_webp",function(){return S.EXT_texture_webp}),E.d(c,"KHR_draco_mesh_compression",function(){return S.KHR_draco_mesh_compression}),E.d(c,"KHR_lights",function(){return S.KHR_lights}),E.d(c,"KHR_materials_pbrSpecularGlossiness",function(){return S.KHR_materials_pbrSpecularGlossiness}),E.d(c,"KHR_materials_unlit",function(){return S.KHR_materials_unlit}),E.d(c,"KHR_materials_clearcoat",function(){return S.KHR_materials_clearcoat}),E.d(c,"KHR_materials_sheen",function(){return S.KHR_materials_sheen}),E.d(c,"KHR_materials_specular",function(){return S.KHR_materials_specular}),E.d(c,"KHR_materials_ior",function(){return S.KHR_materials_ior}),E.d(c,"KHR_materials_variants",function(){return S.KHR_materials_variants}),E.d(c,"KHR_materials_transmission",function(){return S.KHR_materials_transmission}),E.d(c,"KHR_materials_translucency",function(){return S.KHR_materials_translucency}),E.d(c,"KHR_mesh_quantization",function(){return S.KHR_mesh_quantization}),E.d(c,"KHR_texture_basisu",function(){return S.KHR_texture_basisu}),E.d(c,"KHR_texture_transform",function(){return S.KHR_texture_transform}),E.d(c,"MSFT_audio_emitter",function(){return S.MSFT_audio_emitter}),E.d(c,"MSFT_lod",function(){return S.MSFT_lod}),E.d(c,"MSFT_minecraftMesh",function(){return S.MSFT_minecraftMesh}),E.d(c,"MSFT_sRGBFactors",function(){return S.MSFT_sRGBFactors}),E.d(c,"ExtrasAsMetadata",function(){return S.ExtrasAsMetadata});var m=E(1),S=(E(6),E(7))},function(s,c,E){E.r(c),E.d(c,"MTLFileLoader",function(){return S}),E.d(c,"OBJFileLoader",function(){return d});var m=E(0),S=function(){function M(){this.materials=[]}return M.prototype.parseMTL=function(C,I,b,p){if(!(I instanceof ArrayBuffer)){for(var x,P=I.split(`
`),A=/\s+/,T=null,_=0;_<P.length;_++){var g=P[_].trim();if(g.length!==0&&g.charAt(0)!=="#"){var O=g.indexOf(" "),R=O>=0?g.substring(0,O):g;R=R.toLowerCase();var N=O>=0?g.substring(O+1).trim():"";R==="newmtl"?(T&&this.materials.push(T),C._blockEntityCollection=p,T=new m.StandardMaterial(N,C),C._blockEntityCollection=!1):R==="kd"&&T?(x=N.split(A,3).map(parseFloat),T.diffuseColor=m.Color3.FromArray(x)):R==="ka"&&T?(x=N.split(A,3).map(parseFloat),T.ambientColor=m.Color3.FromArray(x)):R==="ks"&&T?(x=N.split(A,3).map(parseFloat),T.specularColor=m.Color3.FromArray(x)):R==="ke"&&T?(x=N.split(A,3).map(parseFloat),T.emissiveColor=m.Color3.FromArray(x)):R==="ns"&&T?T.specularPower=parseFloat(N):R==="d"&&T?T.alpha=parseFloat(N):R==="map_ka"&&T?T.ambientTexture=M._getTexture(b,N,C):R==="map_kd"&&T?T.diffuseTexture=M._getTexture(b,N,C):R==="map_ks"&&T?T.specularTexture=M._getTexture(b,N,C):R==="map_ns"||(R==="map_bump"&&T?T.bumpTexture=M._getTexture(b,N,C):R==="map_d"&&T&&(T.opacityTexture=M._getTexture(b,N,C)))}}T&&this.materials.push(T)}},M._getTexture=function(C,I,b){if(!I)return null;var p=C;if(C==="file:"){var x=I.lastIndexOf("\\");x===-1&&(x=I.lastIndexOf("/")),p+=x>-1?I.substr(x+1):I}else p+=I;return new m.Texture(p,b,!1,M.INVERT_TEXTURE_Y)},M.INVERT_TEXTURE_Y=!0,M}(),d=function(){function M(C){this.name="obj",this.extensions=".obj",this.obj=/^o/,this.group=/^g/,this.mtllib=/^mtllib /,this.usemtl=/^usemtl /,this.smooth=/^s /,this.vertexPattern=/v(\s+[\d|\.|\+|\-|e|E]+){3,7}/,this.normalPattern=/vn(\s+[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)/,this.uvPattern=/vt(\s+[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)/,this.facePattern1=/f\s+(([\d]{1,}[\s]?){3,})+/,this.facePattern2=/f\s+((([\d]{1,}\/[\d]{1,}[\s]?){3,})+)/,this.facePattern3=/f\s+((([\d]{1,}\/[\d]{1,}\/[\d]{1,}[\s]?){3,})+)/,this.facePattern4=/f\s+((([\d]{1,}\/\/[\d]{1,}[\s]?){3,})+)/,this.facePattern5=/f\s+(((-[\d]{1,}\/-[\d]{1,}\/-[\d]{1,}[\s]?){3,})+)/,this._forAssetContainer=!1,this._meshLoadOptions=C||M.currentMeshLoadOptions}return Object.defineProperty(M,"INVERT_TEXTURE_Y",{get:function(){return S.INVERT_TEXTURE_Y},set:function(C){S.INVERT_TEXTURE_Y=C},enumerable:!1,configurable:!0}),Object.defineProperty(M,"currentMeshLoadOptions",{get:function(){return{ComputeNormals:M.COMPUTE_NORMALS,ImportVertexColors:M.IMPORT_VERTEX_COLORS,InvertY:M.INVERT_Y,InvertTextureY:M.INVERT_TEXTURE_Y,UVScaling:M.UV_SCALING,MaterialLoadingFailsSilently:M.MATERIAL_LOADING_FAILS_SILENTLY,OptimizeWithUV:M.OPTIMIZE_WITH_UV,SkipMaterials:M.SKIP_MATERIALS}},enumerable:!1,configurable:!0}),M.prototype._loadMTL=function(C,I,b,p){var x=m.Tools.BaseUrl+I+C;m.Tools.LoadFile(x,b,void 0,void 0,!1,function(P,A){p(x,A)})},M.prototype.createPlugin=function(){return new M(M.currentMeshLoadOptions)},M.prototype.canDirectLoad=function(C){return!1},M.prototype.importMeshAsync=function(C,I,b,p,x,P){return this._parseSolid(C,I,b,p).then(function(A){return{meshes:A,particleSystems:[],skeletons:[],animationGroups:[],transformNodes:[],geometries:[],lights:[]}})},M.prototype.loadAsync=function(C,I,b,p,x){return this.importMeshAsync(null,C,I,b,p).then(function(){})},M.prototype.loadAssetContainerAsync=function(C,I,b,p,x){var P=this;return this._forAssetContainer=!0,this.importMeshAsync(null,C,I,b).then(function(A){var T=new m.AssetContainer(C);return A.meshes.forEach(function(_){return T.meshes.push(_)}),A.meshes.forEach(function(_){var g=_.material;g&&T.materials.indexOf(g)==-1&&(T.materials.push(g),g.getActiveTextures().forEach(function(O){T.textures.indexOf(O)==-1&&T.textures.push(O)}))}),P._forAssetContainer=!1,T}).catch(function(A){throw P._forAssetContainer=!1,A})},M.prototype._parseSolid=function(C,I,b,p){for(var x,P=this,A=[],T=[],_=[],g=[],O=[],R=[],N=[],V=[],U=[],L=[],j=[],Y=0,W=!1,re=[],ne=[],ge=[],_e=[],ce=[],ie="",Z="",te=new S,B=1,G=!0,$=new m.Color4(.5,.5,.5,1),le=function(Ke,ct,ot,_t,gt,At,wt){var Qt;(Qt=P._meshLoadOptions.OptimizeWithUV?function(Wt,Ft){Wt[Ft[0]]||(Wt[Ft[0]]={normals:[],idx:[],uv:[]});var Ht=Wt[Ft[0]].normals.indexOf(Ft[1]);return Ht!=1&&Ft[2]===Wt[Ft[0]].uv[Ht]?Wt[Ft[0]].idx[Ht]:-1}(j,[Ke,ot,ct]):function(Wt,Ft){Wt[Ft[0]]||(Wt[Ft[0]]={normals:[],idx:[]});var Ht=Wt[Ft[0]].normals.indexOf(Ft[1]);return Ht===-1?-1:Wt[Ft[0]].idx[Ht]}(j,[Ke,ot]))===-1?(R.push(N.length),N.push(_t),V.push(gt),L.push(At),wt!==void 0&&U.push(wt),j[Ke].normals.push(ot),j[Ke].idx.push(Y++),P._meshLoadOptions.OptimizeWithUV&&j[Ke].uv.push(ct)):R.push(Qt)},se=function(){for(var Ke=0;Ke<N.length;Ke++)re.push(N[Ke].x,N[Ke].y,N[Ke].z),ge.push(L[Ke].x,L[Ke].y,L[Ke].z),_e.push(V[Ke].x,V[Ke].y),P._meshLoadOptions.ImportVertexColors===!0&&ne.push(U[Ke].r,U[Ke].g,U[Ke].b,U[Ke].a);N=[],L=[],V=[],U=[],j=[],Y=0},q=function(Ke,ct){for(var ot=ct;ot<Ke.length-1;ot++)ce.push(Ke[0],Ke[ot],Ke[ot+1])},H=function(Ke,ct){q(Ke,ct);for(var ot=0;ot<ce.length;ot++){var _t=parseInt(ce[ot])-1;le(_t,0,0,A[_t],m.Vector2.Zero(),m.Vector3.Up(),P._meshLoadOptions.ImportVertexColors===!0?g[_t]:void 0)}ce=[]},X=function(Ke,ct){q(Ke,ct);for(var ot=0;ot<ce.length;ot++){var _t=ce[ot].split("/"),gt=parseInt(_t[0])-1,At=parseInt(_t[1])-1;le(gt,At,0,A[gt],_[At],m.Vector3.Up(),P._meshLoadOptions.ImportVertexColors===!0?g[gt]:void 0)}ce=[]},J=function(Ke,ct){q(Ke,ct);for(var ot=0;ot<ce.length;ot++){var _t=ce[ot].split("/"),gt=parseInt(_t[0])-1,At=parseInt(_t[1])-1,wt=parseInt(_t[2])-1;le(gt,At,wt,A[gt],_[At],T[wt])}ce=[]},Q=function(Ke,ct){q(Ke,ct);for(var ot=0;ot<ce.length;ot++){var _t=ce[ot].split("//"),gt=parseInt(_t[0])-1,At=parseInt(_t[1])-1;le(gt,1,At,A[gt],m.Vector2.Zero(),T[At],P._meshLoadOptions.ImportVertexColors===!0?g[gt]:void 0)}ce=[]},ee=function(Ke,ct){q(Ke,ct);for(var ot=0;ot<ce.length;ot++){var _t=ce[ot].split("/"),gt=A.length+parseInt(_t[0]),At=_.length+parseInt(_t[1]),wt=T.length+parseInt(_t[2]);le(gt,At,wt,A[gt],_[At],T[wt],P._meshLoadOptions.ImportVertexColors===!0?g[gt]:void 0)}ce=[]},pe=function(){O.length>0&&(x=O[O.length-1],se(),R.reverse(),x.indices=R.slice(),x.positions=re.slice(),x.normals=ge.slice(),x.uvs=_e.slice(),P._meshLoadOptions.ImportVertexColors===!0&&(x.colors=ne.slice()),R=[],re=[],ne=[],ge=[],_e=[])},Te=b.split(`
`),ve=0;ve<Te.length;ve++){var he,be=Te[ve].trim().replace(/\s\s/g," ");if(be.length!==0&&be.charAt(0)!=="#")if(this.vertexPattern.test(be))he=be.match(/[^ ]+/g),A.push(new m.Vector3(parseFloat(he[1]),parseFloat(he[2]),parseFloat(he[3]))),this._meshLoadOptions.ImportVertexColors===!0&&(he.length>=7?g.push(new m.Color4(parseFloat(he[4]),parseFloat(he[5]),parseFloat(he[6]),he.length===7||he[7]===void 0?1:parseFloat(he[7]))):g.push($));else if((he=this.normalPattern.exec(be))!==null)T.push(new m.Vector3(parseFloat(he[1]),parseFloat(he[2]),parseFloat(he[3])));else if((he=this.uvPattern.exec(be))!==null)_.push(new m.Vector2(parseFloat(he[1])*M.UV_SCALING.x,parseFloat(he[2])*M.UV_SCALING.y));else if((he=this.facePattern3.exec(be))!==null)J(he[1].trim().split(" "),1);else if((he=this.facePattern4.exec(be))!==null)Q(he[1].trim().split(" "),1);else if((he=this.facePattern5.exec(be))!==null)ee(he[1].trim().split(" "),1);else if((he=this.facePattern2.exec(be))!==null)X(he[1].trim().split(" "),1);else if((he=this.facePattern1.exec(be))!==null)H(he[1].trim().split(" "),1);else if(this.group.test(be)||this.obj.test(be)){var xe={name:be.substring(2).trim(),indices:void 0,positions:void 0,normals:void 0,uvs:void 0,colors:void 0,materialName:""};pe(),O.push(xe),W=!0,G=!0,B=1}else this.usemtl.test(be)?(ie=be.substring(7).trim(),(!G||!W)&&(pe(),xe={name:"mesh_mm"+B.toString(),indices:void 0,positions:void 0,normals:void 0,uvs:void 0,colors:void 0,materialName:ie},B++,O.push(xe),W=!0),W&&G&&(O[O.length-1].materialName=ie,G=!1)):this.mtllib.test(be)?Z=be.substring(7).trim():this.smooth.test(be)||console.log("Unhandled expression at line : "+be)}W&&(x=O[O.length-1],R.reverse(),se(),x.indices=R,x.positions=re,x.normals=ge,x.uvs=_e,this._meshLoadOptions.ImportVertexColors===!0&&(x.colors=ne)),W||(R.reverse(),se(),O.push({name:m.Geometry.RandomId(),indices:R,positions:re,colors:ne,normals:ge,uvs:_e,materialName:ie}));for(var Se=[],Ue=new Array,We=0;We<O.length;We++){if(C&&O[We].name){if(C instanceof Array){if(C.indexOf(O[We].name)===-1)continue}else if(O[We].name!==C)continue}x=O[We],I._blockEntityCollection=this._forAssetContainer;var Ze=new m.Mesh(O[We].name,I);I._blockEntityCollection=!1,Ue.push(O[We].materialName);var Qe=new m.VertexData;if(Qe.uvs=x.uvs,Qe.indices=x.indices,Qe.positions=x.positions,this._meshLoadOptions.ComputeNormals===!0){var Xe=new Array;m.VertexData.ComputeNormals(x.positions,x.indices,Xe),Qe.normals=Xe}else Qe.normals=x.normals;this._meshLoadOptions.ImportVertexColors===!0&&(Qe.colors=x.colors),Qe.applyToMesh(Ze),this._meshLoadOptions.InvertY&&(Ze.scaling.y*=-1),Se.push(Ze)}var nt=[];return Z!==""&&this._meshLoadOptions.SkipMaterials===!1&&nt.push(new Promise(function(Ke,ct){P._loadMTL(Z,p,function(ot){try{te.parseMTL(I,ot,p,P._forAssetContainer);for(var _t=0;_t<te.materials.length;_t++){for(var gt,At=0,wt=[];(gt=Ue.indexOf(te.materials[_t].name,At))>-1;)wt.push(gt),At=gt+1;if(gt===-1&&wt.length===0)te.materials[_t].dispose();else for(var Qt=0;Qt<wt.length;Qt++)Se[wt[Qt]].material=te.materials[_t]}Ke()}catch(Wt){m.Tools.Warn("Error processing MTL file: '"+Z+"'"),P._meshLoadOptions.MaterialLoadingFailsSilently?Ke():ct(Wt)}},function(ot,_t){m.Tools.Warn("Error downloading MTL file: '"+Z+"'"),P._meshLoadOptions.MaterialLoadingFailsSilently?Ke():ct(_t)})})),Promise.all(nt).then(function(){return Se})},M.OPTIMIZE_WITH_UV=!0,M.INVERT_Y=!1,M.IMPORT_VERTEX_COLORS=!1,M.COMPUTE_NORMALS=!1,M.UV_SCALING=new m.Vector2(1,1),M.SKIP_MATERIALS=!1,M.MATERIAL_LOADING_FAILS_SILENTLY=!0,M}();m.SceneLoader&&m.SceneLoader.RegisterPlugin(new d)},function(s,c,E){E.r(c),E.d(c,"STLFileLoader",function(){return S});var m=E(0),S=function(){function d(){this.solidPattern=/solid (\S*)([\S\s]*?)endsolid[ ]*(\S*)/g,this.facetsPattern=/facet([\s\S]*?)endfacet/g,this.normalPattern=/normal[\s]+([\-+]?[0-9]+\.?[0-9]*([eE][\-+]?[0-9]+)?)+[\s]+([\-+]?[0-9]*\.?[0-9]+([eE][\-+]?[0-9]+)?)+[\s]+([\-+]?[0-9]*\.?[0-9]+([eE][\-+]?[0-9]+)?)+/g,this.vertexPattern=/vertex[\s]+([\-+]?[0-9]+\.?[0-9]*([eE][\-+]?[0-9]+)?)+[\s]+([\-+]?[0-9]*\.?[0-9]+([eE][\-+]?[0-9]+)?)+[\s]+([\-+]?[0-9]*\.?[0-9]+([eE][\-+]?[0-9]+)?)+/g,this.name="stl",this.extensions={".stl":{isBinary:!0}}}return d.prototype.importMesh=function(M,C,I,b,p,x,P){var A;if(typeof I!="string"){if(this._isBinary(I)){var T=new m.Mesh("stlmesh",C);return this._parseBinary(T,I),p&&p.push(T),!0}for(var _=new Uint8Array(I),g="",O=0;O<I.byteLength;O++)g+=String.fromCharCode(_[O]);I=g}for(;A=this.solidPattern.exec(I);){var R=A[1];if(R!=A[3])return m.Tools.Error("Error in STL, solid name != endsolid name"),!1;if(M&&R){if(M instanceof Array){if(!M.indexOf(R))continue}else if(R!==M)continue}R=R||"stlmesh",T=new m.Mesh(R,C),this._parseASCII(T,A[2]),p&&p.push(T)}return!0},d.prototype.load=function(M,C,I){return this.importMesh(null,M,C,I,null,null,null)},d.prototype.loadAssetContainer=function(M,C,I,b){var p=new m.AssetContainer(M);return M._blockEntityCollection=!0,this.importMesh(null,M,C,I,p.meshes,null,null),M._blockEntityCollection=!1,p},d.prototype._isBinary=function(M){var C;if(84+50*(C=new DataView(M)).getUint32(80,!0)===C.byteLength)return!0;for(var I=C.byteLength,b=0;b<I;b++)if(C.getUint8(b)>127)return!0;return!1},d.prototype._parseBinary=function(M,C){for(var I=new DataView(C),b=I.getUint32(80,!0),p=0,x=new Float32Array(3*b*3),P=new Float32Array(3*b*3),A=new Uint32Array(3*b),T=0,_=0;_<b;_++){for(var g=84+50*_,O=I.getFloat32(g,!0),R=I.getFloat32(g+4,!0),N=I.getFloat32(g+8,!0),V=1;V<=3;V++){var U=g+12*V;x[p]=I.getFloat32(U,!0),x[p+2]=I.getFloat32(U+4,!0),x[p+1]=I.getFloat32(U+8,!0),P[p]=O,P[p+2]=R,P[p+1]=N,p+=3}A[T]=T++,A[T]=T++,A[T]=T++}M.setVerticesData(m.VertexBuffer.PositionKind,x),M.setVerticesData(m.VertexBuffer.NormalKind,P),M.setIndices(A),M.computeWorldMatrix(!0)},d.prototype._parseASCII=function(M,C){for(var I,b=[],p=[],x=[],P=0;I=this.facetsPattern.exec(C);){var A=I[1],T=this.normalPattern.exec(A);if(this.normalPattern.lastIndex=0,T){for(var _,g=[Number(T[1]),Number(T[5]),Number(T[3])];_=this.vertexPattern.exec(A);)b.push(Number(_[1]),Number(_[5]),Number(_[3])),p.push(g[0],g[1],g[2]);x.push(P++,P++,P++),this.vertexPattern.lastIndex=0}}this.facetsPattern.lastIndex=0,M.setVerticesData(m.VertexBuffer.PositionKind,b),M.setVerticesData(m.VertexBuffer.NormalKind,p),M.setIndices(x),M.computeWorldMatrix(!0)},d}();m.SceneLoader&&m.SceneLoader.RegisterPlugin(new S)},function(s,c,E){(function(m){var S=E(2),d=E(3);E.d(c,"a",function(){return S.GLTFFileLoader}),E.d(c,"b",function(){return S.GLTFLoaderAnimationStartMode}),E.d(c,"c",function(){return S.GLTFLoaderCoordinateSystemMode}),E.d(c,"d",function(){return S.GLTFLoaderState}),E.d(c,"e",function(){return d.GLTFValidation});var M=m!==void 0?m:typeof window!="undefined"?window:void 0;if(M!==void 0){for(var C in M.BABYLON=M.BABYLON||{},S)M.BABYLON[C]=S[C];for(var C in d)M.BABYLON[C]=d[C]}}).call(this,E(5))},function(s,c,E){(function(m){var S=E(8);E.d(c,"a",function(){return S});var d=m!==void 0?m:typeof window!="undefined"?window:void 0;if(d!==void 0)for(var M in d.BABYLON=d.BABYLON||{},d.BABYLON.GLTF1=d.BABYLON.GLTF1||{},S)d.BABYLON.GLTF1[M]=S[M]}).call(this,E(5))},function(s,c,E){(function(m){var S=E(7),d=E(6),M=E(9);E.d(c,"a",function(){return M});var C=m!==void 0?m:typeof window!="undefined"?window:void 0;if(C!==void 0){C.BABYLON=C.BABYLON||{};var I=C.BABYLON;I.GLTF2=I.GLTF2||{},I.GLTF2.Loader=I.GLTF2.Loader||{},I.GLTF2.Loader.Extensions=I.GLTF2.Loader.Extensions||{};var b=[];for(var p in S)I.GLTF2.Loader.Extensions[p]=S[p],b.push(p);for(var p in d)I.GLTF2.Loader[p]=d[p],b.push(p);for(var p in M)b.indexOf(p)>-1||(I.GLTF2[p]=M[p])}}).call(this,E(5))},function(s,c,E){E.r(c),function(m){var S=E(10);E.d(c,"MTLFileLoader",function(){return S.MTLFileLoader}),E.d(c,"OBJFileLoader",function(){return S.OBJFileLoader});var d=m!==void 0?m:typeof window!="undefined"?window:void 0;if(d!==void 0)for(var M in S)d.BABYLON[M]=S[M]}.call(this,E(5))},function(s,c,E){E.r(c),function(m){var S=E(11);E.d(c,"STLFileLoader",function(){return S.STLFileLoader});var d=m!==void 0?m:typeof window!="undefined"?window:void 0;if(d!==void 0)for(var M in S)d.BABYLON[M]=S[M]}.call(this,E(5))},,,,function(s,c,E){E.r(c),E.d(c,"GLTFLoaderCoordinateSystemMode",function(){return m.c}),E.d(c,"GLTFLoaderAnimationStartMode",function(){return m.b}),E.d(c,"GLTFLoaderState",function(){return m.d}),E.d(c,"GLTFFileLoader",function(){return m.a}),E.d(c,"GLTFValidation",function(){return m.e}),E.d(c,"GLTF1",function(){return S.a}),E.d(c,"GLTF2",function(){return d.a}),E.d(c,"MTLFileLoader",function(){return M.MTLFileLoader}),E.d(c,"OBJFileLoader",function(){return M.OBJFileLoader}),E.d(c,"STLFileLoader",function(){return C.STLFileLoader}),E(2),E(3),E(8),E(9),E(10),E(11);var m=E(12),S=E(13),d=E(14),M=E(15),C=E(16)}])})})(iq);export{Gt as A,cO as B,Oq as C,Sq as D,Rq as E,fq as F,pq as G,oY as H,hq as I,Dl as J,yB as K,iH as L,vq as M,Mq as Q,Cq as S,gq as T,aY as V,pB as _,bq as a,yq as b,mq as c,pr as d,_q as e,Iq as f,Eq as g,$6 as h,Pq as i,Aq as j,xq as k,un as l,Dq as m,hB as n,aq as o,lq as p,cq as q,ZK as r,sq as s,gB as t,wq as u,$e as v,oq as w,uB as x,Vt as y,Tq as z};
//# sourceMappingURL=vendor.c5d5e6f7.js.map
