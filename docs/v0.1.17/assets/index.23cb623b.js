import{v as e,i as G,l as C,A as v,I as E,S as K,d as O,_ as k,y as b,M as L,D as M,a as q,b as P,B as w,G as J,c as S,T as Q,H as U,e as B,C as Y,f as A,g as F,h as _,j as X,k as Z,m as ee,n as N,r as te,o as H,p as R,q as ne,s as re,t as z,u as oe,w as ae,x as W,E as se,Q as le,z as ie,V as $,F as ce,J as ue,K as de,L as me}from"./vendor.c5d5e6f7.js";const fe=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))o(l);new MutationObserver(l=>{for(const s of l)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function r(l){const s={};return l.integrity&&(s.integrity=l.integrity),l.referrerpolicy&&(s.referrerPolicy=l.referrerpolicy),l.crossorigin==="use-credentials"?s.credentials="include":l.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(l){if(l.ep)return;l.ep=!0;const s=r(l);fetch(l.href,s)}};fe();const pe=({mode:n,value:t,setValue:r,theme:o})=>e(G,{defaultLanguage:n,theme:o,options:{minimap:{enabled:!1}},onChange:r,value:t,width:"100%",height:"70vh"}),he=(n,t)=>{const[r,o]=C(n);return b(()=>{let l=n.concat([]);n.forEach(s=>{s.type==="option"&&s.suboptions&&t&&Object.keys(t).forEach(a=>{const d=t[a];d&&s?.suboptions?.[d]&&(l=l.concat(s.suboptions[d]))})}),o(l)},[t,o,n]),[r]},ge=({hashkey:n,options:t})=>{const[r,o]=C(!1),l=v(()=>{o(!r)},[r]);return e(O,null,e(E,{verticalAlign:"top","aria-label":"Metaframe settings",icon:e(K,null),size:"md",onClick:l}),e(ve,{hashkey:n,isOpen:r,setOpen:o,options:t}))},ve=({hashkey:n,isOpen:t,setOpen:r,options:o})=>{const[l,s]=k(n||"options",Object.fromEntries(o.filter(i=>i.default).map(i=>[i.name,i.default]))),[a,d]=C(l||{}),[y]=he(o,a),[j,h]=C(void 0),D=v(i=>{const{name:f,value:c}=i.target;let m=o.concat([]);o.forEach(x=>{x.suboptions&&Object.values(x.suboptions).forEach(V=>m=m.concat(V))});const g=m.find(x=>x.name===f);if(!g){console.error(`No option found for name=${f}`);return}g.type==="boolean"?d({...a,[f]:c==="1"}):d({...a,[f]:c})},[a,d,o]),T=v(()=>{r(!t)},[r,t]),I=v(()=>{const i={};if(Object.keys(a).forEach(c=>{const m=o.find(g=>g.name===c);if(m&&m.validator&&m.type!=="boolean"){const g=m.validator(a[c]);g&&(i[c]=g)}}),Object.keys(i).length>0){h(i);return}h(void 0);const f={};Object.keys(a).forEach(c=>{const m=y.find(g=>g.name===c);m?m.map?f[c]=m.map(a[c]):m.type==="boolean"?f[c]=a[c]===!0||a[c]==="1"||a[c]==="true":f[c]=a[c]:f[c]=a[c]}),r(!t),s(f)},[r,t,o,a,y,s,h]);return b(()=>{if(!t)return;const i=f=>{f.key==="Enter"&&t&&I()};return window.addEventListener("keyup",i),()=>{window.removeEventListener("keyup",i)}},[I,t]),e(F,{placement:"top",onClose:I,isOpen:t},e(L,null,e(M,null,e(q,{borderBottomWidth:"0px"},"Configure metaframe (stored in URL hash params )"),e(P,null,e(w,{maxW:"80%",p:2,borderWidth:"4px",borderRadius:"lg",overflow:"hidden"},e(J,{templateColumns:"repeat(12, 1fr)",gap:6},y.map(i=>e(O,null,e(S,{rowSpan:1,colSpan:4},e(w,{w:"100%",h:"100%",display:"flex",alignItems:"center",justifyContent:"flex-end"},e(Q,{textAlign:"right",verticalAlign:"bottom"},i.displayName||i.name,":"))),e(S,{rowSpan:1,colSpan:8}," ",ye(i,a[i.name],D)))),e(S,{rowSpan:1,colSpan:12}),e(S,{rowSpan:1,colSpan:12}),e(S,{rowSpan:1,colSpan:12}),e(S,{rowSpan:1,colSpan:12},e(U,{spacing:2,direction:"row"},e(B,null),e(E,{size:"lg",color:"red",icon:e(Y,null),onClick:T}),e(E,{size:"lg",color:"green",icon:e(A,null),onClick:I})))))))))},ye=(n,t,r)=>{switch(n.type){case"option":return e(Z,{name:n.name,value:t,onChange:r,placeholder:"Select option"},n.options.map(o=>e("option",{value:o},o)));case"boolean":return e(X,{name:n.name,rightIcon:e(A,null),onChange:r,isChecked:t===!0||t==="1",value:t?0:1});default:return e(w,{w:"100%",h:"10"},e(_,{name:n.name,type:"text",placeholder:"",value:t===void 0?n.default:t,onInput:r}))}};var u;(function(n){n[n.Start=0]="Start",n[n.Editing=1]="Editing",n[n.Running=2]="Running",n[n.Finished=3]="Finished"})(u||(u={}));const p=ee(n=>({code:void 0,result:void 0,mode:0,setCode:t=>n(r=>({code:t})),setResult:t=>n(r=>({result:t})),setMode:t=>n(r=>({mode:t}))})),be=()=>{const n=p(o=>o.mode),t=p(o=>o.result),[r]=N("presentation");return u.Running===n?e(te.BeatLoader,{size:8,color:"blue"}):!t||r?null:t.failure?e(O,null,e(H,{status:"error"},e(R,null),e(re,{mr:2},"Error",t?.failure?.phase?" in phase "+t.failure.phase:"")),e(H,{status:"error"},e(R,null),e(ne,null,`${t.failure?.error}`))):e(H,{status:"success"},e(R,null))},we=Object.getPrototypeOf(async function(){}).constructor,Se=(n,t)=>{let r=null,o=Object.keys(t);try{r=we("exports",`"use strict"; return (async function(${o.join(", ")}){${n}})`)({})}catch(s){return Promise.resolve({failure:{error:s,phase:"compile"}})}if(r){var l="exec";let s=Object.values(t);return r.apply?r.apply(null,s).then(a=>({result:a})).catch(a=>({failure:{error:a,phase:l}})):r.then(a=>a.apply(null,s)).then(a=>({result:a})).catch(a=>({failure:{error:a,phase:l}}))}return Promise.resolve({failure:{error:"compile failed",phase:"compile"}})},Ce=()=>{const n=z(),t=p(s=>s.setMode),r=p(s=>s.setResult),o=p(s=>s.result);return b(()=>()=>{if(o?.result&&typeof o?.result=="function")try{o.result()}catch(s){console.error("Failed to cancel without error:",s)}},[o]),[v(async s=>{if(!s||s.trim().length===0){t(u.Finished),r(void 0);return}if(!!n.metaframe){r(void 0);try{const a=await Se(s,{metaframe:n.metaframe,BABYLON:oe,HASHTOOLS:ae});r(a)}catch(a){console.error(a),r({failure:{error:a}})}t(u.Finished)}},[n.metaframe,t,r]),o]},Ee=()=>{const n=z(),t=p(d=>d.mode),r=p(d=>d.setMode),o=p(d=>d.code),[l,s]=W("text",void 0),a=v(()=>{switch(t){case u.Editing:l!==o&&s(o),r(u.Running);break;case u.Finished:r(u.Editing);break;case u.Running:r(u.Editing);break;case u.Start:break}},[n.metaframe,o,l,s,t,r]);return e(E,{verticalAlign:"top","aria-label":"Help",colorScheme:t===u.Editing?"blue":void 0,icon:t===u.Editing?e(A,null):e(se,null),size:"md",onClick:a,mr:"4"})},Ie=({url:n})=>{const[t,r]=C(!1);n=n||`${window.location.origin}${window.location.pathname}/README.md`;const o=v(()=>{r(!t)},[t]);return e(O,null,e(E,{verticalAlign:"top","aria-label":"Help",icon:e(le,null),size:"md",onClick:o,mr:"2"}),e(xe,{url:n,isOpen:t,setOpen:r}))},xe=({isOpen:n,setOpen:t,url:r})=>{const o=v(()=>{t(!n)},[t,n]),l=v(()=>{t(!1)},[t]),s=`https://metapages.github.io/metaframe-markdown/#?url=${r}`;return e(F,{size:"full",placement:"top",onClose:o,isOpen:n,onOverlayClick:l},e(L,null,e(M,null,e(ie,{size:"lg",bg:"gray.100"}),e(P,null,e("iframe",{width:"100%",height:"100%",src:s})))))},Oe=[{name:"canvasWidth",displayName:"Canvas width",default:300,type:"number"},{name:"canvasHeight",displayName:"Canvas height",default:100,type:"number"},{name:"theme",displayName:"Light/Dark theme",default:"light",type:"option",options:["light","vs-dark"]},{name:"stretch",displayName:"Stretch to fill container",default:!1,type:"boolean"}],Ae=()=>{const[n]=k("options",{canvasWidth:300,canvasHeight:100,theme:"light",stretch:!1}),[t]=N("presentation"),r=p(h=>h.code),o=p(h=>h.setCode),l=p(h=>h.mode),s=p(h=>h.setMode),[a]=Ce(),[d]=W("text",void 0);b(()=>{l===u.Start&&s(u.Running)},[l,s]),b(()=>{l===u.Running&&a&&a(r)},[l,r,a]),b(()=>{o(d),a&&a(d)},[d,o,a]);const y=e("canvas",{style:n?.stretch?{width:"100%",minWidth:n?.canvasWidth||300}:void 0,width:n?.canvasWidth||300,height:n?.canvasHeight||100,id:"renderCanvas"});if(t)return y;const j=e($,{spacing:2,alignItems:"flex-start"},e(ce,{width:"100%"},e(Ee,null),e(B,null),e(Ie,null),e(ge,{options:Oe})),e(be,null));return e(w,{w:"100%",p:2},e($,{spacing:2,alignItems:"flex-start"},l===u.Editing?e(w,{w:"100%"},e(pe,{mode:"javascript",theme:n?.theme||"light",setValue:o,value:r})):r&&r.length>0?y:null,e(w,{w:"30%"},j)))},He=()=>e(Ae,null);ue(e(me,null,e(de,null,e(He,null))),document.getElementById("root"));
//# sourceMappingURL=index.23cb623b.js.map
