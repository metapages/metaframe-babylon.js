import{v as e,i as T,l as b,A as h,I as w,S as V,d as x,_ as L,y as S,M as P,D as B,a as G,b as M,B as g,G as K,c as v,T as U,H as R,e as q,C as J,f as A,g as k,h as Q,j as Y,k as _,m as X,r as Z,n as H,o as j,p as ee,q as te,s as ne,t as re,u as oe,w as N,x as z,E as ae,Q as se,z as le,V as ie,F as ce,J as ue,K as de}from"./vendor.027897e7.js";const fe=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const l of s)if(l.type==="childList")for(const o of l.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&a(o)}).observe(document,{childList:!0,subtree:!0});function r(s){const l={};return s.integrity&&(l.integrity=s.integrity),s.referrerpolicy&&(l.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?l.credentials="include":s.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function a(s){if(s.ep)return;s.ep=!0;const l=r(s);fetch(s.href,l)}};fe();const me=({mode:n,value:t,setValue:r,theme:a})=>e(T,{defaultLanguage:n,theme:a,options:{minimap:{enabled:!1}},onChange:r,value:t,width:"100%",height:"70vh"}),pe=(n,t)=>{const[r,a]=b(n);return S(()=>{let s=n.concat([]);n.forEach(l=>{l.type==="option"&&l.suboptions&&t&&Object.keys(t).forEach(o=>{const i=t[o];i&&l?.suboptions?.[i]&&(s=s.concat(l.suboptions[i]))})}),a(s)},[t,a,n]),[r]},he=({hashkey:n,options:t})=>{const[r,a]=b(!1),s=h(()=>{a(!r)},[r]);return e(x,null,e(w,{verticalAlign:"top","aria-label":"Metaframe settings",icon:e(V,null),size:"md",onClick:s}),e(ge,{hashkey:n,isOpen:r,setOpen:a,options:t}))},ge=({hashkey:n,isOpen:t,setOpen:r,options:a})=>{const[s,l]=L(n||"options",Object.fromEntries(a.filter(c=>c.default).map(c=>[c.name,c.default]))),[o,i]=b(s||{}),[y]=pe(a,o),[C,O]=b(void 0),D=h(c=>{const{name:f,value:u}=c.target;let d=a.concat([]);a.forEach(E=>{E.suboptions&&Object.values(E.suboptions).forEach(F=>d=d.concat(F))});const p=d.find(E=>E.name===f);if(!p){console.error(`No option found for name=${f}`);return}p.type==="boolean"?i({...o,[f]:u==="1"}):i({...o,[f]:u})},[o,i,a]),$=h(()=>{r(!t)},[r,t]),I=h(()=>{const c={};if(Object.keys(o).forEach(u=>{const d=a.find(p=>p.name===u);if(d&&d.validator&&d.type!=="boolean"){const p=d.validator(o[u]);p&&(c[u]=p)}}),Object.keys(c).length>0){O(c);return}O(void 0);const f={};Object.keys(o).forEach(u=>{const d=y.find(p=>p.name===u);d?d.map?f[u]=d.map(o[u]):d.type==="boolean"?f[u]=o[u]===!0||o[u]==="1"||o[u]==="true":f[u]=o[u]:f[u]=o[u]}),r(!t),l(f)},[r,t,a,o,y,l,O]);return S(()=>{if(!t)return;const c=f=>{f.key==="Enter"&&t&&I()};return window.addEventListener("keyup",c),()=>{window.removeEventListener("keyup",c)}},[I,t]),e(k,{placement:"top",onClose:I,isOpen:t},e(P,null,e(B,null,e(G,{borderBottomWidth:"0px"},"Configure metaframe (stored in URL hash params )"),e(M,null,e(g,{maxW:"80%",p:2,borderWidth:"4px",borderRadius:"lg",overflow:"hidden"},e(K,{templateColumns:"repeat(12, 1fr)",gap:6},y.map(c=>e(x,null,e(v,{rowSpan:1,colSpan:4},e(g,{w:"100%",h:"100%",display:"flex",alignItems:"center",justifyContent:"flex-end"},e(U,{textAlign:"right",verticalAlign:"bottom"},c.displayName||c.name,":"))),e(v,{rowSpan:1,colSpan:8}," ",ve(c,o[c.name],D)))),e(v,{rowSpan:1,colSpan:12}),e(v,{rowSpan:1,colSpan:12}),e(v,{rowSpan:1,colSpan:12}),e(v,{rowSpan:1,colSpan:12},e(R,{spacing:2,direction:"row"},e(q,null),e(w,{size:"lg",color:"red",icon:e(J,null),onClick:$}),e(w,{size:"lg",color:"green",icon:e(A,null),onClick:I})))))))))},ve=(n,t,r)=>{switch(n.type){case"option":return e(_,{name:n.name,value:t,onChange:r,placeholder:"Select option"},n.options.map(a=>e("option",{value:a},a)));case"boolean":return e(Y,{name:n.name,rightIcon:e(A,null),onChange:r,isChecked:t===!0||t==="1",value:t?0:1});default:return e(g,{w:"100%",h:"10"},e(Q,{name:n.name,type:"text",placeholder:"",value:t===void 0?n.default:t,onInput:r}))}},m=X(n=>({code:void 0,result:void 0,running:!1,mode:"running",setCode:t=>n(r=>({code:t})),setMode:t=>n(r=>({mode:t})),setResult:t=>n(r=>({result:t})),setRunning:t=>n(r=>({running:t}))})),ye=()=>{const n=m(r=>r.running),t=m(r=>r.result);return n?e(Z.BeatLoader,{size:8,color:"blue"}):t?t.failure?e(x,null,e(H,{status:"error"},e(j,null),e(te,{mr:2},"Error",t?.failure?.phase?" in phase "+t.failure.phase:"")),e(H,{status:"error"},e(j,null),e(ee,null,`${t.failure?.error}`))):e(H,{status:"success"},e(j,null)):null},be=Object.getPrototypeOf(async function(){}).constructor,we=(n,t)=>{let r=null,a=Object.keys(t);try{r=be("exports",`"use strict"; return (async function(${a.join(", ")}){${n}})`)({})}catch(l){return Promise.resolve({failure:{error:l,phase:"compile"}})}if(r){var s="exec";let l=Object.values(t);return r.apply?r.apply(null,l).then(o=>({result:o})).catch(o=>({failure:{error:o,phase:s}})):r.then(o=>o.apply(null,l)).then(o=>({result:o})).catch(o=>({failure:{error:o,phase:s}}))}return Promise.resolve({failure:{error:"compile failed",phase:"compile"}})},W=()=>{const n=ne(),t=m(o=>o.setRunning),r=m(o=>o.setResult),a=m(o=>o.result),s=m(o=>o.running);return S(()=>()=>{if(a?.result&&typeof a?.result=="function")try{a.result()}catch(o){console.error("Failed to cancel without error:",o)}},[a]),[h(async o=>{if(!o||o.trim().length===0){t(!1),r(void 0);return}if(!!n.metaframe){t(!0),r(void 0);try{const i=await we(o,{metaframe:n.metaframe,BABYLON:re,HASHTOOLS:oe});r(i)}catch(i){console.error(i),r({failure:{error:i}})}t(!1)}},[n.metaframe,t,r]),s,a]},Se=()=>{const[n,t]=N("mode");m(i=>i.running);const r=m(i=>i.code),[a]=W(),[s,l]=z("text",void 0),o=h(()=>{s!==r&&l(r),t(n==="editing"?"running":"editing")},[n,t,r,s,l]);return S(()=>{n==="running"&&r&&a&&a(r)},[n,r,a]),e(w,{"aria-label":"edit/run",colorScheme:n==="editing"?"green":"blue",onClick:o,icon:n==="editing"?e(A,null):e(ae,null),size:"md"})},Ce=({url:n})=>{const[t,r]=b(!1);n=n||`${window.location.origin}${window.location.pathname}/README.md`;const a=h(()=>{r(!t)},[t]);return e(x,null,e(w,{verticalAlign:"top","aria-label":"Help",icon:e(se,null),size:"md",onClick:a,mr:"2"}),e(Ie,{url:n,isOpen:t,setOpen:r}))},Ie=({isOpen:n,setOpen:t,url:r})=>{const a=h(()=>{t(!n)},[t,n]),s=h(()=>{t(!1)},[t]),l=`https://metapages.github.io/metaframe-markdown/#?url=${r}`;return e(k,{size:"full",placement:"top",onClose:a,isOpen:n,onOverlayClick:s},e(P,null,e(B,null,e(le,{size:"lg",bg:"gray.100"}),e(M,null,e("iframe",{width:"100%",height:"100%",src:l})))))},Ee=[{name:"canvasWidth",displayName:"Canvas width",default:300,type:"number"},{name:"canvasHeight",displayName:"Canvas height",default:100,type:"number"},{name:"theme",displayName:"Light/Dark theme",default:"light",type:"option",options:["light","vs-dark"]},{name:"stretch",displayName:"Stretch to fill container",default:!1,type:"boolean"}],xe=()=>{const[n]=L("options",{canvasWidth:300,canvasHeight:100,theme:"light",stretch:!1}),t=m(C=>C.code),r=m(C=>C.setCode),[a]=W(),[s]=N("mode"),[l,o]=z("text",void 0);S(()=>{r(l),a&&a(l)},[l,r,a]);const i=e(R,{spacing:2},e(Se,null),e(he,{options:Ee}),e(Ce,null)),y=e(g,{w:"100%"},s==="editing"?e(me,{mode:"javascript",theme:n?.theme||"light",setValue:r,value:t}):t&&t.length>0?e("canvas",{style:n?.stretch?{width:"100%",minWidth:n?.canvasWidth||300}:void 0,width:n?.canvasWidth||300,height:n?.canvasHeight||100,id:"renderCanvas"}):null);return e(g,{w:"100%",p:2},e(ie,{stretch:!0,spacing:2,alignItems:"flex-start"},y,e(g,null,i),e(ye,null)))},Oe=()=>e(xe,null);ce(e(de,null,e(ue,null,e(Oe,null))),document.getElementById("root"));
//# sourceMappingURL=index.7c1dfbee.js.map
