import{j as V,a as G,F as K,i as U,l as S,b as v,I as C,S as q,_ as k,y as O,D as R,M as B,c as F,d as J,e as M,B as y,G as Q,f as b,T as Y,H as N,g as _,C as X,h as H,k as Z,m as ee,n as te,o as ne,A as re,r as ae,p as L,q as P,s as oe,t as se,u as $,v as ie,w as ce,x as z,E as le,Q as de,z as ue,J as he,V as me,K as fe,L as pe,N as ge}from"./vendor.a9c7ac17.js";const ve=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&a(s)}).observe(document,{childList:!0,subtree:!0});function r(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerpolicy&&(o.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?o.credentials="include":i.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(i){if(i.ep)return;i.ep=!0;const o=r(i);fetch(i.href,o)}};ve();const n=V,u=G,j=K,ye=({mode:t,value:e,setValue:r,theme:a})=>n(U,{defaultLanguage:t,theme:a,options:{minimap:{enabled:!1}},onChange:r,value:e,width:"100%",height:"80vh"}),be=(t,e)=>{const[r,a]=S(t);return O(()=>{let i=t.concat([]);t.forEach(o=>{o.type==="option"&&o.suboptions&&e&&Object.keys(e).forEach(s=>{const d=e[s];d&&o?.suboptions?.[d]&&(i=i.concat(o.suboptions[d]))})}),a(i)},[e,a,t]),[r]},we=({hashkey:t,options:e})=>{const[r,a]=S(!1),i=v(()=>{a(!r)},[r]);return u(j,{children:[n(C,{verticalAlign:"top","aria-label":"Metaframe settings",icon:n(q,{}),size:"md",onClick:i}),n(Se,{hashkey:t,isOpen:r,setOpen:a,options:e})]})},Se=({hashkey:t,isOpen:e,setOpen:r,options:a})=>{const[i,o]=k(t||"options",Object.fromEntries(a.filter(c=>c.default).map(c=>[c.name,c.default]))),[s,d]=S(i||{}),[w]=be(a,s),[E,A]=S(void 0),W=v(c=>{const{name:f,value:l}=c.target;let m=a.concat([]);a.forEach(I=>{I.suboptions&&Object.values(I.suboptions).forEach(T=>m=m.concat(T))});const g=m.find(I=>I.name===f);if(!g){console.error(`No option found for name=${f}`);return}g.type==="boolean"?d({...s,[f]:l==="1"}):d({...s,[f]:l})},[s,d,a]),D=v(()=>{r(!e)},[r,e]),x=v(()=>{const c={};if(Object.keys(s).forEach(l=>{const m=a.find(g=>g.name===l);if(m&&m.validator&&m.type!=="boolean"){const g=m.validator(s[l]);g&&(c[l]=g)}}),Object.keys(c).length>0){A(c);return}A(void 0);const f={};Object.keys(s).forEach(l=>{const m=w.find(g=>g.name===l);m?m.map?f[l]=m.map(s[l]):m.type==="boolean"?f[l]=s[l]===!0||s[l]==="1"||s[l]==="true":f[l]=s[l]:f[l]=s[l]}),r(!e),o(f)},[r,e,a,s,w,o,A]);return O(()=>{if(!e)return;const c=f=>{f.key==="Enter"&&e&&x()};return window.addEventListener("keyup",c),()=>{window.removeEventListener("keyup",c)}},[x,e]),n(R,{placement:"top",onClose:x,isOpen:e,children:n(B,{children:u(F,{children:[n(J,{borderBottomWidth:"0px",children:"Configure metaframe (stored in URL hash params )"}),n(M,{children:n(y,{maxW:"80%",p:2,borderWidth:"4px",borderRadius:"lg",overflow:"hidden",children:u(Q,{templateColumns:"repeat(12, 1fr)",gap:6,children:[w.map(c=>u(j,{children:[n(b,{rowSpan:1,colSpan:4,children:n(y,{w:"100%",h:"100%",display:"flex",alignItems:"center",justifyContent:"flex-end",children:u(Y,{textAlign:"right",verticalAlign:"bottom",children:[c.displayName||c.name,":"]})})}),u(b,{rowSpan:1,colSpan:8,children:[" ",Ce(c,s[c.name],W)]})]})),n(b,{rowSpan:1,colSpan:12}),n(b,{rowSpan:1,colSpan:12}),n(b,{rowSpan:1,colSpan:12}),n(b,{rowSpan:1,colSpan:12,children:u(N,{spacing:2,direction:"row",children:[n(_,{}),n(C,{size:"lg",color:"red",icon:n(X,{}),onClick:D}),n(C,{size:"lg",color:"green",icon:n(H,{}),onClick:x})]})})]})})})]})})})},Ce=(t,e,r)=>{switch(t.type){case"option":return n(te,{name:t.name,value:e,onChange:r,placeholder:"Select option",children:t.options.map(a=>n("option",{value:a,children:a}))});case"boolean":return n(ee,{name:t.name,rightIcon:n(H,{}),onChange:r,isChecked:e===!0||e==="1",value:e?0:1});default:return n(y,{w:"100%",h:"10",children:n(Z,{name:t.name,type:"text",placeholder:"",value:e===void 0?t.default:e,onInput:r})})}};var h;(function(t){t[t.Start=0]="Start",t[t.Editing=1]="Editing",t[t.Running=2]="Running",t[t.Finished=3]="Finished"})(h||(h={}));const p=ne(t=>({code:void 0,result:void 0,mode:0,setCode:e=>t(r=>({code:e})),setResult:e=>t(r=>({result:e})),setMode:e=>t(r=>({mode:e}))})),Ee=()=>{const t=p(a=>a.mode),e=p(a=>a.result),[r]=re("presentation");return h.Running===t?n(ae.BeatLoader,{size:8,color:"blue"}):!e||r?null:e.failure?u(j,{children:[u(L,{status:"error",children:[n(P,{}),u(oe,{mr:2,children:["Error",e?.failure?.phase?" in phase "+e.failure.phase:""]})]}),u(L,{status:"error",children:[n(P,{}),n(se,{children:`${e.failure?.error}`})]})]}):n(L,{status:"success",children:n(P,{})})},xe=Object.getPrototypeOf(async function(){}).constructor,Ie=(t,e)=>{let r=null,a=Object.keys(e);try{r=xe("exports",`"use strict"; return (async function(${a.join(", ")}){${t}})`)({})}catch(o){return Promise.resolve({failure:{error:o,phase:"compile"}})}if(r){var i="exec";let o=Object.values(e);return r.apply?r.apply(null,o).then(s=>({result:s})).catch(s=>({failure:{error:s,phase:i}})):r.then(s=>s.apply(null,o)).then(s=>({result:s})).catch(s=>({failure:{error:s,phase:i}}))}return Promise.resolve({failure:{error:"compile failed",phase:"compile"}})},Oe=()=>{const t=$(),e=p(o=>o.setMode),r=p(o=>o.setResult),a=p(o=>o.result);return O(()=>()=>{if(a?.result&&typeof a?.result=="function")try{a.result()}catch(o){console.error("Failed to cancel without error:",o)}},[a]),[v(async o=>{if(!o||o.trim().length===0){e(h.Finished),r(void 0);return}if(!!t.metaframe){r(void 0);try{const s=await Ie(o,{metaframe:t.metaframe,BABYLON:ie,HASHTOOLS:ce});r(s)}catch(s){console.error(s),r({failure:{error:s}})}e(h.Finished)}},[t.metaframe,e,r]),a]},je=()=>{const t=$(),e=p(d=>d.mode),r=p(d=>d.setMode),a=p(d=>d.code),[i,o]=z("text",void 0),s=v(()=>{switch(e){case h.Editing:i!==a&&o(a),r(h.Running);break;case h.Finished:r(h.Editing);break;case h.Running:r(h.Editing);break;case h.Start:break}},[t.metaframe,a,i,o,e,r]);return n(C,{verticalAlign:"top","aria-label":"Help",colorScheme:e===h.Editing?"blue":void 0,icon:e===h.Editing?n(H,{}):n(le,{}),size:"md",onClick:s,mr:"4"})},Ae=({url:t})=>{const[e,r]=S(!1);t=t||`${window.location.origin}${window.location.pathname}/README.md`;const a=v(()=>{r(!e)},[e]);return u(j,{children:[n(C,{verticalAlign:"top","aria-label":"Help",icon:n(de,{}),size:"md",onClick:a,mr:"2"}),n(He,{url:t,isOpen:e,setOpen:r})]})},He=({isOpen:t,setOpen:e,url:r})=>{const a=v(()=>{e(!t)},[e,t]),i=v(()=>{e(!1)},[e]),o=`https://metapages.github.io/metaframe-markdown/#?url=${r}`;return n(R,{size:"full",placement:"top",onClose:a,isOpen:t,onOverlayClick:i,children:n(B,{children:u(F,{children:[n(ue,{size:"lg",bg:"gray.100"}),n(M,{children:n("iframe",{width:"100%",height:"100%",src:o})})]})})})},Le=[{name:"canvasWidth",displayName:"Canvas width",default:300,type:"number"},{name:"canvasHeight",displayName:"Canvas height",default:100,type:"number"},{name:"theme",displayName:"Light/Dark theme",default:"light",type:"option",options:["light","vs-dark"]},{name:"stretch",displayName:"Stretch to fill container",default:!1,type:"boolean"}],Pe=()=>{const[t]=k("options",{canvasWidth:300,canvasHeight:100,theme:"light",stretch:!1}),e=p(E=>E.code),r=p(E=>E.setCode),[a]=Oe(),[i]=he("mode"),[o,s]=z("text",void 0);O(()=>{r(o),a&&a(o)},[o,r,a]);const d=u(N,{spacing:2,children:[n(je,{}),n(we,{options:Le}),n(Ae,{})]}),w=n(y,{w:"100%",children:i==="editing"?n(ye,{mode:"javascript",theme:t?.theme||"light",setValue:r,value:e}):e&&e.length>0?n("canvas",{style:t?.stretch?{width:"100%",minWidth:t?.canvasWidth||300}:void 0,width:t?.canvasWidth||300,height:t?.canvasHeight||100,id:"renderCanvas"}):null});return n(y,{w:"100%",p:2,children:u(me,{stretch:!0,spacing:2,alignItems:"flex-start",children:[w,n(y,{children:d}),n(Ee,{})]})})},ke=()=>n(Pe,{});fe(n(pe,{children:n(ge,{children:n(ke,{})})}),document.getElementById("root"));
//# sourceMappingURL=index.bcc71775.js.map
